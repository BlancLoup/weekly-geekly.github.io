<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HHVM: testing performance and compatibility with Joomla, Bitrix and Wordpress</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About HHVM already wrote on Habr√©. In short: HHVM is a Facebook virtual machine that, due to the translation and JIT compilation of the code, allows y...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HHVM: testing performance and compatibility with Joomla, Bitrix and Wordpress</h1><div class="post__text post__text-html js-mediator-article">  About HHVM <a href="http://habrahabr.ru/post/188056/">already wrote</a> on Habr√©.  In short: HHVM is a Facebook virtual machine that, due to the translation and JIT compilation of the code, allows you to speed up PHP several times.  The developers also promise almost complete compatibility with PHP 5.4. <br><br>  I decided to compare HHVM with the native interpreter on several tests, as well as try to run CMS on it. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Test conditions </h2><br>  Testing was carried out in a virtual machine with the configuration of a processor 2 core Core i5 @ 3.3 GHz, 8 GB of RAM. <br>  OS: Ubuntu 12.04 x86_64. <br>  PHP: 5.3.10-1ubuntu3.7 <br>  Nginx: 1.1.19 <br>  Apache: 2.2.22 <br>  HHVM: 2.1.0-dev <br>  In the settings, the execution timeout and memory_limit were increased, APC was enabled.  No additional tuning was made. <br><br>  HHVM is installed from source according to the <a href="">instructions</a> . <br><br><h2>  Benchmarks </h2><br>  Several scripts were prepared, each of which was launched 50 times: 10 times in PHP CLI, HHVM CLI, Apache + mod_php, nginx + php-fpm, and nginx + HHVM.  The average execution time in seconds is presented in the table.  The last two columns show the gain in execution speed when using HHVM. <br><br><table><tbody><tr><td></td><td colspan="2" align="center">  CLI </td><td colspan="3" align="center">  HTTP </td><td colspan="2">  Increase speed compared </td></tr><tr><td>  Test </td><td>  Php </td><td>  HHVM </td><td>  Apache + mod_php </td><td>  Nginx + php_fpm </td><td>  Nginx + HHVM </td><td>  PHP CLI </td><td>  PHP-FPM </td></tr><tr><td>  asort </td><td>  42.4 </td><td>  17.9 </td><td>  <font color="#890014"><b>N / A</b></font> <sup>1</sup> </td><td>  40.9 </td><td>  18.9 </td><td>  <font color="#008914"><b>137.0%</b></font> </td><td>  <font color="#008914"><b>116.7%</b></font> </td></tr><tr><td>  bcmath_factorial </td><td>  3.4 </td><td>  3.0 </td><td>  3.4 </td><td>  3.4 </td><td>  2.8 </td><td>  13.9% </td><td>  21.5% </td></tr><tr><td>  curl_multi </td><td>  8.6 </td><td>  8.4 </td><td>  9.7 </td><td>  9.0 </td><td>  9.7 </td><td>  2.3% </td><td>  -7.0% </td></tr><tr><td>  domdocument </td><td>  50.2 </td><td>  51.0 </td><td>  54.3 </td><td>  50.1 </td><td>  50.1 </td><td>  -1.5% </td><td>  0.0% </td></tr><tr><td>  for </td><td>  60.5 </td><td>  36.9 </td><td>  60,8 </td><td>  61.0 </td><td>  211.2 </td><td>  <font color="#008914"><b>63.7%</b></font> </td><td>  <font color="#890014"><b>-71.1%</b></font> </td></tr><tr><td>  geoip </td><td>  14.4 </td><td>  15.6 </td><td>  14.7 </td><td>  14.9 </td><td>  5.0 </td><td>  -7.8% </td><td>  <font color="#008914"><b>198.0%</b></font> </td></tr><tr><td>  getid3 </td><td>  46.5 </td><td>  26.9 </td><td>  46.2 </td><td>  45.6 </td><td>  8.5 </td><td>  <font color="#008914"><b>72.4%</b></font> </td><td>  <font color="#008914"><b>435.5%</b></font> </td></tr><tr><td>  mb_strings </td><td>  22,8 </td><td>  16.8 </td><td>  7.0 </td><td>  22.2 </td><td>  17.0 </td><td>  <font color="#008914"><b>35.8%</b></font> </td><td>  <font color="#008914"><b>31.0%</b></font> </td></tr><tr><td>  md5 </td><td>  36.8 </td><td>  35.7 </td><td>  37.0 </td><td>  37.2 </td><td>  27.2 </td><td>  3.2% </td><td>  <font color="#008914"><b>36.7%</b></font> </td></tr><tr><td>  preg </td><td>  11.6 </td><td>  10.9 </td><td>  11.6 </td><td>  11.7 </td><td>  10.9 </td><td>  6.1% </td><td>  7.9% </td></tr><tr><td>  prime </td><td>  4.2 </td><td>  5.6 </td><td>  4.2 </td><td>  4.3 </td><td>  2.5 </td><td>  -24,1% </td><td>  <font color="#008914"><b>71.8%</b></font> </td></tr><tr><td>  sort </td><td>  46.3 </td><td>  17,8 </td><td>  <font color="#890014"><b>N / A</b></font> <sup>1</sup> </td><td>  44.1 </td><td>  17.5 </td><td>  <font color="#008914"><b>160.1%</b></font> </td><td>  <font color="#008914"><b>151.8%</b></font> </td></tr><tr><td>  sqlite </td><td>  12.4 </td><td>  10.0 </td><td>  12.6 </td><td>  12.2 </td><td>  15.2 </td><td>  23.7% </td><td>  -19.9% </td></tr><tr><td>  strings </td><td>  38.6 </td><td>  37.5 </td><td>  37,8 </td><td>  38.2 </td><td>  36.0 </td><td>  3.0% </td><td>  6.3% </td></tr><tr><td>  tcp_client </td><td>  15.4 </td><td>  13.2 </td><td>  15.5 </td><td>  17.3 </td><td>  13.6 </td><td>  16.9% </td><td>  27.7% </td></tr><tr><td>  tcpdf </td><td>  3.3 </td><td>  2.4 </td><td>  3.4 </td><td>  4.4 </td><td>  1.4 </td><td>  <font color="#008914"><b>38.7%</b></font> </td><td>  <font color="#008914"><b>215.1%</b></font> </td></tr><tr><td>  thumbnail </td><td>  100.8 </td><td>  94.8 </td><td>  93.7 </td><td>  99.9 </td><td>  94.2 </td><td>  6.3% </td><td>  6.1% </td></tr></tbody></table><br><br>  <sup>1 - Apache could not execute asort.php and sort.php - dropped from out of memory</sup> <br><br>  <b>asort</b> - sorting an associative array of strings with 10 million elements <br>  <b>bcmath_factorial</b> - factorial calculation of the number 1000 by the bcmul function <br>  <b>curl_multi</b> - download 100 files of 1 MB in 10 streams from the Internet <br>  <b>domdocument</b> - analysis of large XML (122 thousand tags) - for example, took sitemap ag.ru <br>  <b>for</b> - 3 nested for for 1000 iterations (total 1 billion) <br>  <b>geoip</b> - 100 thousand IP searches based on <a href="http://dev.maxmind.com/geoip/geoip2/geolite2/">GeoIP</a> <br>  <b>getid3</b> - getting ID3 tags from MP3 using <a href="http://getid3.sourceforge.net/">getID3</a> library <a href="http://getid3.sourceforge.net/">()</a> - 10 thousand times <br>  <b>mb_strings</b> - use mb_strlen, mb_ereg_replace, mb_substr, mb_strpos, mb_strtolower 1000 times on the first volume of "War and Peace" <br>  <b>md5</b> - generation of md5 from numbers from 1 to 100 million <br>  <b>preg</b> - search preg_match_all hex codes of colors, tags and URLs on an HTML page - 1000 times (for example, the main Habra is taken) <br>  <b>prime</b> - getting all prime numbers from 2 to 1 million by bruising "in the forehead" <br>  <b>sort</b> - sorting an array of rows of 10 million items with numeric indices <br>  <b>sqlite</b> - 10 thousand SELECT queries to the sqlite3 database <br>  <b>strings</b> - use strlen, str_replace, substr, strpos, strtolower 10 thousand times on the first volume of "War and Peace" <br>  <b>tcp_client</b> - 10 thousand connections to localhost and reading 2 Mb by TCP ( <a href="http://ru.wikipedia.org/wiki/CHARGEN">CHARGEN</a> ) <br>  <b>tcpdf</b> - generation of multipage PDF by <a href="http://www.tcpdf.org/">TCPDF</a> library - 10 times (taken example_061.php) <br>  <b>thumbnail</b> - 10 thousand thumbnail creations using GD imagecopyresized () <br><br>  I also wanted to get rid of the test with <b>Smarty</b> , but HHVM was unable to perform it. <br><br><h2>  Interpretation of results </h2><br>  Of course, benchmarks can not fully show the situation with performance.  But still some conclusions can be drawn. <br><br><ol><li>  The execution time of each test run differed slightly from the average, which means that the result can be considered stable. </li><li>  There are two anomalous results: the mb_string test on Apache + mod_php is too fast and the for for nginx + HHVM is too slow.  I rechecked the tests, but I do not know what was the matter. </li><li>  What is in the CLI version, that when used for web HHVM gives an advantage in half the tests. </li><li>  In some cases, using HHVM as a nginx backend (i.e., not as a CLI) gives an even greater increase - apparently, due to JIT activation.  Notice how much faster getid3 and TCPDF libraries work. </li></ol><br><br><h2>  CMS testing </h2><br><br><h3>  Wordpress </h3><br>  The fact that Wordpress runs on HHVM <a href="http://www.hhvm.com/blog/%3Fp%3D113">was known in advance</a> .  Only a small adjustment in one file is needed. <br><br>  A simple test: loading the main page 100 times in one thread. <br>  nginx + HHVM: <font color="#008914"><b>4.498 s</b></font> <br>  Apache + mod_php: 9.997 c <br>  Apache + mod_php + APC: 6.567 c <br>  nginx + php-fpm + APC: 5.460 s <br><br>  I draw your attention that this was a test of the page response time, and not load testing in several streams. <br><br><h3>  Bitrix and Joomla </h3><br>  Bitrix and Joomla on HHVM refused to start, giving a fatal error.  I suspect that Bitrix has no hope of launching at all, since  it uses the deprecated functions and mbstring.func_overload. <br><br>  Internet review has shown that it is Worpress that is easiest to launch under HHVM for now.  With other CMS and frameworks, things are not so bright, for example, in a recent topic on Habr√©, <a href="http://habrahabr.ru/post/189960/">Symfony2 did not take off</a> . <br><br>  Perhaps, for whom productivity is very important, you should immediately write a framework for HHVM? <br><br><h2>  findings </h2><br>  1) HHVM gives a good performance boost on some tasks - it is possible to use it to start the processes of background processing of something.  Remember that HHVM is not effective when using global variables. <br><br>  2) Currently, the use of existing libraries, frameworks and CMS with HHVM is difficult.  HHVM is sharpened for performance and may not support various beautiful designs.  However, in the future the situation will improve, because  and HHVM may start supporting a better language, and developers may be puzzled by adapting their code to HHVM. <br><br>  3) On Wordpress, HHVM showed an impressive performance increase - 2 times compared to mod_php. <br><br>  PS <a href="">test scripts</a> , <a href="http://ross.pp.ru/misc/hhvm.xls">raw data (Excel)</a> </div><p>Source: <a href="https://habr.com/ru/post/190566/">https://habr.com/ru/post/190566/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190552/index.html">Fluid Dynamics Simulation: Lattice Boltzmann Method</a></li>
<li><a href="../190556/index.html">Localization of projects on .NET with an interpreter of functions</a></li>
<li><a href="../190560/index.html">Apportable SDK - Objective-C / Cocoa Touch for Android</a></li>
<li><a href="../190562/index.html">Meetings of the Meet Magento Russia 2013 Conference</a></li>
<li><a href="../190564/index.html">Support for Advanced Format - optimal work with high-capacity disks</a></li>
<li><a href="../190572/index.html">The process of developing and rolling out releases in Badoo. Automatic testing. Developer Environment</a></li>
<li><a href="../190580/index.html">Studio Trailers returned to Habr</a></li>
<li><a href="../190582/index.html">Moscow, September 12, Windows Camp - come, it will be interesting!</a></li>
<li><a href="../190584/index.html">The whole truth about the UTF-8 flag</a></li>
<li><a href="../190592/index.html">Dell Latitude 10: Tablet or PC?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>