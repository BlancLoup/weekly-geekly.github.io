<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Convert conversations to mp3 - Elastix 2.5 (FreePBX 2.11)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will give a brief description of how to save recordings of conversations in mp3 format but with the .wav extension, thereby reducin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Convert conversations to mp3 - Elastix 2.5 (FreePBX 2.11)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/11d/f30/bf8/11df30bf8b944a9c969a817fa1c2a6b3.png" align="left"><br>  In this article, I will give a brief description of how to save recordings of conversations in mp3 format but with the .wav extension, thereby reducing the size of files and retaining the ability to listen to files from the control panel (file names will not change).  I will also give a couple of tips on how to reduce the load on the disk subsystem, getting rid of unnecessary logs (when the system is loaded, the load reduction is quite noticeable). <br><br>  In older versions, the record files were stored by default in the same folder, creating problems with a large number of them.  In Elastix 2.5, we switched to FreeBPX 2.11, and there, as we know, telephone recordings are arranged in folders for each day. <br>  Accordingly, the variables have been changed (added) for use with the script for converting records after the call. <br><br>  Moreover, in older versions, it was possible to add the ‚ÄúRun after record‚Äù parameter directly through the Elastix control panel, in the ‚ÄúGeneral Settings‚Äù section.  In the new version, in order to add this parameter (by the way, the parameter also changed the name - ‚ÄúPost Call Recording Script‚Äù), you need to use the FreePBX control panel. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, what's the point: we will convert the file after talking into mp3 format using lame, then, using ffmpeg, we will add the header to the recording file and change the extension back to .wav.  As a result, everything will remain unchanged for the system itself, but the size of the stored files will be significantly reduced, in my opinion, by 7-10 times. <br><a name="habracut"></a><br>  The first step is to install the ffpmpeg and lame packages on the system: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># rpm -Uhv http://pkgs.repoforge.org/rpmforge-release/rpmforge-release-0.5.3-1.el5.rf.x86_64.rpm # yum --disablerepo=commercial-addons install ffmpeg lame</span></span></code> </pre> <br><br>  The parameter --disablerepo = commercial-addons is necessary because, in the commercial-addons repository, there is a package ffmpeg, which does not suit us. <br><br>  Create a folder for our script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkdir -p /etc/asterisk/scripts; chown asterisk. /etc/asterisk/scripts</span></span></code> </pre><br><br>  Taking the script from github: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># wget https://raw.githubusercontent.com/andrey0001/fpbx-elastix/master/mixmon-mp3-2.sh -O /etc/asterisk/scripts/mixmon-mp3-2.sh</span></span></code> </pre><br><br>  Set file permissions <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># chown asterisk. /etc/asterisk/scripts/mixmon-mp3-2.sh # chmod a+x /etc/asterisk/scripts/mixmon-mp3-2.sh</span></span></code> </pre><br><br>  The repository itself on <a href="https://github.com/andrey0001/fpbx-elastix">github</a> . <br><br>  Run the visudo command and add it to the end of the file: <br><pre> <code class="bash hljs">asterisk ALL = NOPASSWD: /bin/nice asterisk ALL = NOPASSWD: /usr/bin/ionice asterisk ALL = NOPASSWD: /bin/chown</code> </pre><br>  <s>asterisk ALL = NOPASSWD: / bin / chmod</s> <s><br></s>  <s>asterisk ALL = NOPASSWD: / bin / rm</s> <s><br></s>  <s>asterisk ALL = NOPASSWD: / bin / touch</s> <br><br>  Now, we have completed all the necessary actions in the console, and we can safely move on to the FreePBX control panel: <br>  Go to the ‚ÄúSettings -&gt; Advanced Settings‚Äù section and enable 2 parameters (Display Readonly Settings, Override Readonly Settings) <br><img src="https://habrastorage.org/files/271/039/183/271039183dab48a7af619970601c1439.png"><br><br>  Apply changes.  We now have the opportunity to edit additional parameters. <br>  In the parameter ‚ÄúPost Call Recording Script‚Äù insert the value: <br><img src="https://habrastorage.org/files/ca8/675/6c6/ca86756c6bbf44dfb00464e67fb27dad.png"><br><pre> <code class="bash hljs">/etc/asterisk/scripts/mixmon-mp3-2.sh ^{YEAR} ^{MONTH} ^{DAY} ^{CALLFILENAME} ^{MIXMON_FORMAT} ^{MIXMON_DIR}</code> </pre><br>  In the parameter ‚ÄúOverride Call Recording Location‚Äù insert the value: <br><img src="https://habrastorage.org/files/5fe/698/b08/5fe698b08f614d7790ee3882715757a7.png"><br><pre> <code class="bash hljs">/var/spool/asterisk/monitor/</code> </pre><br><br>  Apply all changes. <br>  Everything, now all the recordings of telephone conversations, after the conversation, will be converted into mp3 format, with the extension of the extension .wav. <br><br>  For older versions, the script file is <a href="">mixmon-mp3.sh</a> , and the ‚ÄúRun after record‚Äù <a href="">parameter</a> : <br><img src="https://habrastorage.org/files/51a/d73/645/51ad736453914a89878f3095d75349ae.png"><br><pre> <code class="bash hljs">/etc/asterisk/scripts/mixmon-mp3.sh ^{MIXMON_DIR} ^{CALLFILENAME} ^{MIXMON_FORMAT}</code> </pre><br><br>  And yet, before you turn it all on, there is no doubt that you will want to convert your phone call records.  For this, the script file <a href="">conv.sh</a> and run the command from the console: <br><pre> <code class="bash hljs">find /var/spool/asterisk/monitor/ -name <span class="hljs-string"><span class="hljs-string">'*.wav'</span></span> -<span class="hljs-built_in"><span class="hljs-built_in">exec</span></span> ./conv.sh {} \;</code> </pre><br>  The process is not fast. <br><br>  Now, when you listen to record files, the format will be mp3 - pay attention to the picture: <br><img src="https://habrastorage.org/files/8e4/76f/b55/8e476fb55c4f4173bbc74abc7888ace8.png"><br><br>  As for the logs: <br>  By default, Elastix writes full logs, and puts the CDR in three places (mysql, sqlite and csv file): <br>  /etc/asterisk/logger.conf and its attendants, leave only: <br>  console =&gt; notice, warning, error <br>  /etc/asterisk/cdr.conf and its attendants, leave only an entry in mysql. <br><br>  That's all! <br><br>  Good luck in the settings. <br><br>  <b>UPD</b> : for <a href="http://habrahabr.ru/post/258583/">comments</a> , removed sudo from the script.  Add via visudo enough nice, ionice and chown </div><p>Source: <a href="https://habr.com/ru/post/258583/">https://habr.com/ru/post/258583/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258573/index.html">Image and video analysis. Detection of text on images</a></li>
<li><a href="../258575/index.html">Why Windows Phone has become the best platform to launch the game "Torque"</a></li>
<li><a href="../258577/index.html">Proper performance evaluation for diagnosing and fixing issues with .Net serialization</a></li>
<li><a href="../258579/index.html">Post reinforced retro</a></li>
<li><a href="../258581/index.html">My experience with Apache Cassandra</a></li>
<li><a href="../258585/index.html">Smart quest in reality: demons and wiring</a></li>
<li><a href="../258587/index.html">Animation of characters in Blender 3D is just</a></li>
<li><a href="../258593/index.html">On the issue of programming style</a></li>
<li><a href="../258595/index.html">The sad state of the sysadmin in the era of containers</a></li>
<li><a href="../258597/index.html">The application that I need</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>