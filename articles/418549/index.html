<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a bot for participation in the AI ‚Äã‚Äãmini cup 2018 based on a recurrent neural network (part 3)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Final part. 


 In the previous chapters ( part 1 , part 2 , part about GPU ) we touched on the conditions of the competition, the neural network, the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a bot for participation in the AI ‚Äã‚Äãmini cup 2018 based on a recurrent neural network (part 3)</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/zr/tn/pk/zrtnpklse4rsewo5v-bnimmxpzi.png"></p><br><p>  Final part. </p><br><p>  In the previous chapters ( <a href="https://habr.com/post/417311/">part 1</a> , <a href="https://habr.com/post/417657/">part 2</a> , <a href="https://habr.com/post/417757/">part about GPU</a> ) we touched on the conditions of the competition, the neural network, the genetic algorithm, so we continue. </p><a name="habracut"></a><br><p>  But before continuing, a <a href="https://github.com/geotyper/Agairo-Bot">link to GitHub</a> with the source code of the program in c ++ and to support the title of the article - an executable file under Windows OS in the <a href="https://github.com/geotyper/Agairo-Bot/tree/master/Bin">bin</a> folder, which is quite similar to screeen saver.  In the basement of the article organized the "Hall of Fame" of past championships. </p><br><p>  So, we stopped on the program architecture, which consists of two separate parts (programs), the part containing only the neural network and the communication protocol with the game server of the competition organizers (the gaming bot itself) and the main part consisting of the following blocks: </p><br><p><img src="https://habrastorage.org/webt/ra/3x/kr/ra3xkrzknknp8xeusypi4ta73-m.png"></p><br><p>  Briefly about each of the parts. </p><br><p>  Physical engine.  The basis is the physics calculation module from official sources, converted under the GPU, and calculations of the bot sensors, fitness functions, bot collisions are added.  In the source, I removed the viruses and bot attempts to share, the division is an unstable part of the program.  Therefore, I did not share the mistakes. </p><br><p>  Neural network.  We talked about it in some detail last time, including about the implementation in the code, so I will assume that much is also clear here, especially since there were no special questions from readers. </p><br><p>  Genetic algorithm.  There are gaps in the coverage of its implementation.  Now most likely I will repeat, but it is easier to repeat once again. </p><br><p><img src="https://habrastorage.org/webt/1u/jp/ca/1ujpcazasznq0j3emwawnrja0-a.png"></p><br><p>  From the slide presentation a lot came to mind.  Therefore, the main question remains: how to move evolution?  For this, the Fitness function was invented.  The main task of the fitness function is the selection of genotypes for transmission from the current population of bots to the next. </p><br><p><img src="https://habrastorage.org/webt/o1/va/ad/o1vaadmn62bwxgw5hlt6euraxwc.png"></p><br><p><img src="https://habrastorage.org/webt/s-/rt/j2/s-rtj2mpkbazv8cgtptrejp3d7m.png"></p><br><p>  How the choice of fitness function happens is most likely clear.  Crossing issue remained. <br>  There are several basic methods of crossing, <a href="http://www.aiportal.ru/articles/genetic-algorithms/methods-crossing.html">more details on the link</a> .  But the basic principle is the random exchange of genes between the genotypes of the parents.  There are usually two parents who are chosen; there are also several methods for choosing parents from the population; <a href="https://www.nastroy.net/post/geneticheskie-algoritmyi-sut-opisanie-primeryi-primenenie">here</a> you can read more <a href="https://www.nastroy.net/post/geneticheskie-algoritmyi-sut-opisanie-primeryi-primenenie">about the link</a> .  Although the choice of parents is made randomly, but the probability of choosing a specific parent increases in proportion to its fitness function. </p><br><p>  Next, <a href="https://refdb.ru/look/1069794.html">the mutation function is</a> applied to the finished genotype. <br>  In our case, from time to time, the algorithm changes an arbitrary selected gene to a random gene, in other words, one of the weights of the neural network changes to a random one. </p><br><p><img src="https://habrastorage.org/webt/xl/oj/ev/xlojevo4nrjxbcckamtd7hwsr2e.png"></p><br><p> We received a new population and further evolution continues to the desired result.  There are several points, the first: the more bots in the population, the faster the genetic algorithm will find the optimal solution or converge to the solution (the optimal ratio of weights in the neural network).  For example, if a bot has 1000 genes, the search space expands significantly with a population size of 3,000 bots, compared to a population of 300 bots.  But another problem arises, if you release all 3000 bots to the arena designed for 4-8 bots, then most likely the bots on it will be physically cramped and if they learn something, then definitely not playing Agario.  Therefore, there are two main ways to avoid arena overpopulation: first, select several bots from the population alternately and hold their competition in the arena, and so many times until we accumulate game statistics for each bot.  The second one, which the author went to, is launching in parallel several arenas, say 50-300, everything depends on the power of a specific computer and in parallel the entire bots population participate in contests.  The population can be divided into subpopulations with their fitness functions and indifiers (corresponds to the number of arenas), and then exchange the genotypes between the subpopulations.  Or imagine all as one large population of bots playing in different arenas.  The author tried both options, but in the source version of the version with a single population of bots.  The parameter in the <code>Depth</code> program is the arena number. </p><br><p>  That told the basic principles of building a program.  Who wants to see live welcome link on <a href="https://github.com/geotyper/Agairo-Bot">GitHub</a> . </p><br><p><img src="https://habrastorage.org/webt/dj/jk/g3/djjkg3ppchlvczphhxky1lrmkee.png"></p><br><p>  if you fail to start, then a short video will brighten up this moment: </p><br><iframe width="560" height="315" src="https://www.youtube.com/embed/uy0hPthpJqM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><p>  <strong>Announcement:</strong> In August, mail.ru organizes another AI mini cup, the official announcement has not yet seen the truth.  But according to the information from the group's telegrams, the physics engine is again the basis of the competition, something on the subject of machines.  Therefore, briefly about the principles of creating a bot, those who will be interested of course: </p><br><p><img src="https://habrastorage.org/webt/2i/uj/pk/2iujpkyubbs5qlhsxnhts77um04.png"></p><br><p>  Here, like our national football team, it is desirable to leave the group, the final is a separate song.  Let the finalists write about victories, but we have the main participation. <br>  The most understandable and simple: </p><br><p><img src="https://habrastorage.org/webt/c8/2v/oy/c82voy1pg3ftparyeqh8da2qxoq.png"></p><br><p>  Write in the body of the bot code more different conditions, for example if (fossa) -&gt; jump, etc.  Simple conditions are effective at the beginning of the championship, then the complexity of bots will grow and the advantage of conditional solutions will go away. </p><br><p>  And so is the most promising method in many strategic games: </p><br><p><img src="https://habrastorage.org/webt/r9/ek/pn/r9ekpnkvcj-zs9mupd2nehsd3yk.png"></p><br><p>  The method of PP ( <a href="https://habr.com/post/262181/">or potential fields</a> ).  The idea is beautiful, searching for a high or low in a dynamic environment.  The grid of the selected dimension is built on the whole playing field or only on the area around the bot, it all depends on the bot's scope.  Further, at each nodal point of this grid, we consider the distances to the objects of interest to us or, alternatively, the potentials immediately, they can be positive (attraction, this is what interests the bot) and negative (danger to the bot).  Accordingly, the potentials at the point are summed and we obtain the total potentials at each grid point.  Potential field.  The bot can only choose the lowest or greatest potential, depending on the task at the moment.  Basically, the potential fields are 2D implementations, although 3D will look cool, but there will be a lot of resources for calculations. </p><br><p><img src="https://habrastorage.org/webt/yd/br/ik/ydbriks8uznkorkvziqk0zadjgy.png"></p><br><p><img src="https://habrastorage.org/webt/rv/cl/cj/rvclcjrknm2siz3xyxfv3xyyweu.png"></p><br><p>  The most difficult: </p><br><p><img src="https://habrastorage.org/webt/iw/1w/i0/iw1wi0j4wzn4lf_xzfrbki-wsm0.png"></p><br><p>  The two main implementations are the <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BE%25D1%2580">Brute Force</a> method ( <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25BE%25D0%25BB%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B1%25D0%25BE%25D1%2580">Brute</a> force) or the <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%259C%25D0%25BE%25D0%25BD%25D1%2582%25D0%25B5-%25D0%259A%25D0%25B0%25D1%2580%25D0%25BB%25D0%25BE">Monte Carlo method</a> .  Each of them is a topic for a separate article, but according to the feeling, it is these methods that will lead you to the final.  If tezisno, the bot can not only look at the current time or the past, but if you want, you can look into the future, here there is a funnel (cone) of possible outcomes and the further the bot wants to see the more options appear.  For example, at the time point of Tik Zol, the bot decides to go in one of eight directions, in Tick + 1 step in each of the eight new coordinates it has the opportunity to go again in eight directions, etc.  must take into account the possible movement of the enemy during this time.  Every possible outcome of the calculation is charged with possible benefit or harm.  Based on which the bot makes a move in one of the directions.  And then such a calculation into the depth of the future time goes every tick.  The depth of the views of the moves is determined by the possible resources of the computer.  Therefore, when computer resources are low, the problem arises of optimizing these calculations. </p><br><p>  About the source, if there is interest in editing the comments to the code, while laid out as it was. <br>  In the source code, the input of the neuron is given by the signals of the current Tick and the previous Tick, it has become more interesting, thanks to the reader: tongohiti for the idea. </p><br><p>  Those who remember the thesis on the initial distribution of weights in the neural network, an interesting topic is the Initialization of Xavire. </p><br><p>  Thanks for attention.  Meet me at the AI ‚Äã‚Äãcompetitions. </p><br><p>  Articles on the topic of the participants, but first <a href="https://ilibrary.ru/text/1772/p.1/index.html">lyrical digression</a> : </p><br><p>  She sat on the floor <br>  And a pile of letters sorted out, <br>  And, as the cooled ash, <br>  I took them in my hands and threw them. </p><br><p>  She took the familiar sheets <br>  And looking at them wonderfully, <br>  How souls are viewed from on high <br>  On them the thrown body ... </p><br><p>  Oh, how much life was here, <br>  Irreversibly experienced! <br>  Oh, how many sad minutes, <br>  Love and joy killed! .. </p><br><p>  <a href="https://habr.com/post/345566/">My strategy for the Russian AI Cup 2017</a> <br>  <a href="https://habr.com/post/318878/">History of participation (and almost victory) in the annual competition Russian AI Cup 2016</a> <br>  <a href="https://habr.com/post/273649/">The history of victory at the annual competition Russian AI Cup 2015</a> <br>  <a href="https://habr.com/post/241553/">Russian AI Cup 2014: winning strategy</a> <br>  <a href="https://habr.com/post/206680/">Gold Medal at the Russian AI Cup 2013 - how it was</a> <br>  <a href="https://habr.com/post/161501/">The path to the silver medal at the Russian AI Cup 2012</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/418549/">https://habr.com/ru/post/418549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418537/index.html">When throwing trash the main thing - do not start to consider it. Part 1?</a></li>
<li><a href="../418539/index.html">Encryption vulnerability in various Bluetooth implementations</a></li>
<li><a href="../418543/index.html">Five teams winning the 3D-Printed Habitat Centennial Challenge will share a $ 100,000 prize pool</a></li>
<li><a href="../418545/index.html">Creating "artificial life" on the computer</a></li>
<li><a href="../418547/index.html">Asynchronous example programming: reconstructing java.util.concurrent.CompletableFuture methods</a></li>
<li><a href="../418551/index.html">How much should a programmer know math?</a></li>
<li><a href="../418553/index.html">Kotlin + React vs Javasript + React</a></li>
<li><a href="../418557/index.html">Calculation of wave processes in the hydraulic line by the method of characteristics</a></li>
<li><a href="../418559/index.html">NL2API: Creating Natural Language Interfaces for the Web API</a></li>
<li><a href="../418561/index.html">State machines in the service of MVP. Yandex lecture</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>