<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Home server - AMD, Debian x64, Bind9, Apache 2, PHP5, MySQL5, Trac, Subversion and a lot of fun</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Shilo in a famous place still does not give me rest. 
 And I decided to experiment with installing the server at home. 

 So, given: 

 1. Home Intern...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Home server - AMD, Debian x64, Bind9, Apache 2, PHP5, MySQL5, Trac, Subversion and a lot of fun</h1><div class="post__text post__text-html js-mediator-article"> Shilo in a famous place still does not give me rest. <br>  And I decided to experiment with installing the server at home. <br><br>  <b>So, given:</b> <br><br>  1. Home Internet with external ip on the router, back / forth channel - 8 Mbps, provider - QWERTY * <br>  2. The budget is not more than 10 thousand rubles - the less, the better.  ** <br>  3. The burning desire of experiments and <b>something like that</b> *** 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <sub><b>*</b> Unfortunately, my house does not connect Corbin, which has wider channels.</sub>  <sub>It is necessary to be content with what is</sub> <sub><br></sub>  <sub><b>**</b> It turned out by more or less real calculation of the cost of components on an average computer</sub> <sub><br></sub>  <sub><b>***</b> For those who hmyknet and say - "Eka nevidal, I do this regularly" - I do not so often tune something, write more under the already tuned, and for me it is pure entertainment - do something with your own hands =)</sub> <sub><br></sub> <br>  Well, all the procedures here, under the cut. <br><br>  <b>Just want to say that it works for me - the way it is.</b>  <b>Additionally, I didn‚Äôt dance with a tambourine - but here I‚Äôm drawing from my googling and manual smoking.</b> <b><br><br></b>  <b>Probably, something can be customized more flexibly or efficiently, and I will be extremely happy with tips or solutions =)</b> <br><br><a name="habracut"></a><br>  I thought I should buy: <br><br>  1. Motherboard <br>  2. Processor <br>  3. Hard disk <br>  4. Memory <br>  5. Housing <br>  6. CPU cooler <br><br>  I chose the Oldi store, assembled online components for an amount of just about 10 thousand - putting it on Intel.  I turned over all night, I thought, and the next morning I re-assembled the order, resting on AMD.  The difference in money turned out to be about two thousand, and the AMD configuration is more susceptible to future upgrades.  For example, on Socket 775 in Oldi there were no motherboards up to 2k, allowing to finish the RAM up to 16 gigabytes.  In general, I decided to try it - because I have not dealt with AMD for a long time. <br>  Prots - AMD x64 2.4 GHz, the hard disk took one, SATAII 320 gigabytes (as an option - I will buy another expansion to raid 1), memory - Kingston 800 MHz, two strips of 2 gigabytes (put in Dual), the cheapest case and cooler Igloo is not very expensive, but it is quite cooling (for several days the temperature did not exceed 60 degrees, judging by the sensors). <br><br>  Solemnly, with all this, I came home, assembled, connected to a monitor, connected a keyboard, a wire from a router, an external USB drive, and after half an hour I already looked at the newly released Debian. <br><br>  Configured port forwarding on the router: <br><br> <code>53  =&gt; Bind9 <br> 80  =&gt; Apache <br> 21  =&gt; FTP <br> 22  =&gt; SSH <br></code> <br><br>  After that, he executed three commands: <br><br> <code>apt-get update <br> apt-get upgrade <br> apt-get install ssh <br></code> <br><br>  and lay down on the sofa with the laptop, continuing the dialogue with the server already through Putty. <br><br>  The goals were prosaic: <br><br>  1. Bind9 <br>  2. Apache2 <br>  3. PHP5 <br>  4. MySQL 5 <br>  5. SVN <br>  6. Trac <br><br>  All this was supposed to be done on one recently purchased domain (suppose, habr.ru), which has not been implemented anywhere yet. <br><br><h1>  Bind9.  Set up the kettle. </h1><br><br>  Considering that I only heard about setting up Bind9, I immediately got into manuals and examples. <br>  As a result, the configuration was made <a href="http://sudouser.com/ustanovka-i-nastrojka-dns-servera-bind9-ubuntu-debian-howto.html">according to this instruction</a> , changing only the configuration of a specific zone for the domain. <br>  In addition, I wanted to immediately connect <a href="http://www.google.com/a/">Google Applications</a> for the domain, in order not to have to deal with the configuration of sendmail - they are easily observed in the settings below. <br>  It turned out the following: <br><br>  1. Created the / etc / bind / sites folder <br><br>  2. In the /etc/bind/named.conf settings, at the very end: <br><br> <code>include "/etc/bind/named.conf.skazkin"; <br></code> <br><br>  3. In /etc/bind/named.conf.skazkin: <br><br> <code>zone "habr.ru" { <br> type master; <br> file "/etc/bind/sites/habr.ru"; <br> }; <br></code> <br><br>  4. In /etc/bind/sites/habr.ru: <br><br> <code>$ORIGIN habr.ru. <br> $TTL 86400 ; 1 day <br> @ IN SOA habr.ru. master.habr.com. ( <br> 2008291104; serial <br> 10800 ; refresh (3 hours) <br> 3600 ; retry (15 minutes) <br> 3600000 ; expire (1 week) <br> 86400 ; minimum (1 day) <br> ) <br> @ IN NS ns.habr.ru. <br> @ IN NS ns.vds.ru. <br> @ IN A 111.222.333.444 <br> @ IN MX 10 ASPMX.L.GOOGLE.COM. <br> @ IN MX 20 ALT1.ASPMX.L.GOOGLE.COM. <br> @ IN MX 20 ALT2.ASPMX.L.GOOGLE.COM. <br> @ IN MX 30 ASPMX2.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX3.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX4.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX5.GOOGLEMAIL.COM. <br> <br> ns IN A 111.222.333.444 <br> svn IN CNAME habr.ru. <br> trac IN CNAME habr.ru. <br> www IN CNAME habr.ru. <br></code> <br><br>  What is enough understanding of the manual. <br>  It was not clear that when I tried to register everything without the @ -sign, the bandage ceased to understand what they wanted from him - another breakthrough by Google, I suspect that this was due to incorrect indents (* hic *)? <br><br>  In general, here I somehow got out of here - the fact remains that the domain has been moved.  But more about that later. <br><br>  In addition to the primary zone, I also needed to create a Slave.  I went to the VDS I bought a long time ago with a strangely installed debian, I registered there: <br><br>  1. /etc/bind/named.conf <br> <code>zone "habr.ru" { <br> type slave; <br> file "/var/cache/bind/habr.ru"; <br> masters { <br> 111.222.333.444; <br> }; <br> }; <br></code> <br>  2. Accordingly, in /var/cache/bind/habr.ru everything is the same as on the home server: <br><br> <code>$ORIGIN habr.ru. <br> $TTL 86400 ; 1 day <br> @ IN SOA habr.ru. master.habr.com. ( <br> 2008291104; serial <br> 10800 ; refresh (3 hours) <br> 3600 ; retry (15 minutes) <br> 3600000 ; expire (1 week) <br> 86400 ; minimum (1 day) <br> ) <br> @ IN NS ns.habr.ru. <br> @ IN NS ns.vds.ru. <br> @ IN A 111.222.333.444 <br> @ IN MX 10 ASPMX.L.GOOGLE.COM. <br> @ IN MX 20 ALT1.ASPMX.L.GOOGLE.COM. <br> @ IN MX 20 ALT2.ASPMX.L.GOOGLE.COM. <br> @ IN MX 30 ASPMX2.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX3.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX4.GOOGLEMAIL.COM. <br> @ IN MX 30 ASPMX5.GOOGLEMAIL.COM. <br> <br> ns IN A 111.222.333.444 <br> svn IN CNAME habr.ru. <br> trac IN CNAME habr.ru. <br> www IN CNAME habr.ru. <br></code> <br><br>  After that, both at home and on VDS did <br> <code>/etc/init.d/bind9 restart #    -       <br> nslookup habr.ru 127.0.0.1 <br></code> <br><br>  From lukapa should get a successful resolv: <br> <code>bash:/etc/bind# nslookup habr.ru 127.0.0.1 <br> Server: 127.0.0.1 <br> Address: 127.0.0.1#53 <br> <br> Name: habr.ru <br> Address: 111.222.333.444 <br></code> <br><br>  After that, with the following changes on the home server, I only did <br><br> <code>rnds reload <br></code> <br><br>  On the VDS for some reason this was not, I had to restart the demon.  Well, really, there is Bind8. <br><br>  After 6 hours, at 23 o'clock, having received a successful delegation and having had time to have dinner, drink tea and watch TV, went to tune everything attached. <br><br><h1>  Apache2, PHP, MySQL </h1><br><br>  To install Apache in Debian is easier than easy. <br><br> <code>apt-get install apache2 <br> apt-get install mysql-client mysql-server <br> apt-get install php5 php5-mysql php5-xmlrpc php5-cli php5-gd php5-curl php5-xsl <br></code> <br><br>  In the end, I caught up with the heat - with the heat running Apache2, MySQL 5, PHP5 with the right modules. <br><br>  Considering the fact that MySQL is set with a blank password by default - <br><br> <code>mysqladmin -uroot password  <br></code> <br><br>  Well, configure virtual hosts. <br><br>  I decide to keep everything in / home / sites / <br><br> <code>mkdir /home/sites <br> mkdir /home/sites/habr.ru <br></code> <br><br>  I'm going to / etc / apache2 / sites-availible <br><br>  I create there <br><br> <code>touch habr.ru <br> ln -s /etc/apache2/sites-availible/habr.ru /etc/apache2/sites-enabled/habr.ru <br></code> <br><br>  And in habr.ru: <br><br> <code><a href="http://www.habr.ru/"></a> &lt;VirtualHost *&gt; <br> ServerAdmin master@habr.ru <br> DocumentRoot "/home/sites/habr.ru" <br> ServerName habr.ru <br> ServerAlias www.habr.ru <br> ErrorLog "/var/log/apache2/habr.ru.error.log" <br> CustomLog "/var/log/apache2/habr.ru.access.log" common <br> &lt;/VirtualHost&gt; <br></code> <br><br>  Then - restart apache <br><br> <code>/etc/init.d/apache2 restart <br></code> <br><br>  There remained <a href="http://skazkin.habrahabr.ru/blog/29716/">what I already wrote about earlier</a> , but about VDS and setting it up for the first time - namely - <br><br><h1>  SVN + TRAC </h1><br><br>  As usual - <br><br> <code>apt-get install subversion <br> apt-get install libapache2-svn <br> apt-get install trac <br></code> <br><br>  Truck pulled up his dependencies, and I proceeded. <br><br>  I chose the /home/sites/habr.ru folder for the site‚Äôs storage, so I decided to spin around this: <br><br>  Started with SVN, focusing on <a href="http://www.howtoforge.com/debian_subversion_websvn">this manual.</a> <br> <code>mkdir /home/sites/svn <br> svnadmin create --fs-type fsfs /home/sites/svn <br> groupadd subversion <br> adduser svn_user --ingroup subversion <br></code> <br><br>  Having omitted the lines about authorization and generation of authorization keys, I immediately got into Apache <br><br>  Again I go to / etc / apache2 / sites-availible <br><br> <code>cd /etc/apache2/sites-availible <br> touch svn.habr.ru <br> ln -s /etc/apache2/sites-availible/svn.habr.ru /etc/apache2/sites-enabled/svn.habr.ru <br></code> <br><br>  In svn.habr.ru: <br><br> <code>&lt;VirtualHost *&gt; <br> ServerAdmin master@habr.ru <br> DocumentRoot "/home/sites/svn" <br> ServerName svn.habr.ru <br> ErrorLog "/var/log/apache2/svn.habr.ru.error.log" <br> CustomLog "/var/log/apache2/svn.habr.ru.access.log" common <br> &lt;Location /&gt; <br> DAV svn <br> SVNPath /home/sites/svn <br> &lt;/Location&gt; <br> &lt;/VirtualHost&gt; <br></code> <br><br>  Again I restart Apache: <br><br> <code>/etc/init.d/apache2 restart <br></code> <br><br>  And - according to <a href="http://svn.habr.ru/">svn.habr.ru</a> - I have a repository. <br><br>  I drank tea, proceeded to Trac. <br><br>  Trak decided to put in / home / sites / trac <br>  First create the base and user: <br> <code>mysqladmin -uroot -p create trac <br>  : GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP ON trac.* TO 'trac'@'localhost' IDENTIFIED BY 'tracmegapassword'; <br> <br> mkdir /home/sites/trac <br> trac-admin initenv /home/sites/trac <br></code> <br><br>  SVN indicates the one that has already been done: / home / sites / svn <br><br>  And when the trac asked about the DB storage, he replied: <br> <code>mysql://trac:tracmegapassword@localhost:3306/trac <br></code> <br><br>  I corrected my hands /home/sites/trac/conf/trac.ini - all sorts of small parameters, and in the [trac] section I indicated: <br><br> <code>[trac] <br> ... <br> htdocs_location = /tracdocs/ <br></code> <br><br>  Then I got into the Apache config - create a host. <br><br> <code>cd /etc/apache2/sites-availible/ <br> touch trac.habr.ru <br> ln -s /etc/apache2/sites-availible/trac.habr.ru /etc/apache2/sites-enabled/trac.habr.ru <br></code> <br><br>  In trac.habr.ru itself: <br> <code>&lt;VirtualHost *&gt; <br> ServerAdmin master@habr.ru <br> DocumentRoot "/home/sites/trac/htdocs" <br> ServerName trac.habr.ru <br> ErrorLog "/var/log/apache2/trac.habr.ru.error.log" <br> CustomLog "/var/log/apache2/trac.habr.ru.access.log" common <br> <br> &lt;Location /&gt; <br> SetHandler mod_python <br> PythonInterpreter main_interpreter <br> PythonHandler trac.web.modpython_frontend <br> PythonOption TracEnv /home/sites/trac <br> PythonOption TracUriRoot / <br> &lt;/Location&gt; <br> Alias /tracdocs /usr/share/trac/htdocs <br> &lt;Location /tracdocs&gt; <br> SetHandler None <br> &lt;/Location&gt; <br> &lt;/VirtualHost&gt; <br></code> <br><br>  After that - restart apache <br><br> <code>/etc/init.d/apache2 restart <br></code> <br><br>  And in the end, we have <b>non</b> -password- <b>protected</b> (carefully with this, I later logged in globally - and who will set up - do not forget about security) of the SVN and Trac at the appropriate addresses: <br><br>  <a href="http://svn.habr.ru/">svn.habr.ru</a> <br>  <a href="http://trac.habr.ru/">trac.habr.ru</a> <br><br>  As a result, I have a working (in the near future on mezzanine) server on which I have raised Trac, SVN, Apache2, MySQL, PHP, Bind9 and several websites are spinning. <br><br>  And also I had a lot of fun and brought benefits not only to myself, but also to my family - by outweighing the home mail on one of my domains on google.apps. <br><br>  In addition, I got rid of the need to pay for a slow VDS (I will soon transfer the secondary-zone to a friend), now I know what happens when my sites are unavailable (and not ‚Äúwe have technical problems‚Äù), and I can also do so many domains, subdomains and Other things you want, and not how much it costs in the limits of the host account. <br><br>  And also, now the torrent shakes without "technical" pauses (when I'm at work with a laptop). <br><br>  The only minus of all this is a narrow return channel.  But this QWERTY, in which I‚Äôm watching, has traffic-limiting ‚Äúwide‚Äù channels - so maybe in the near future I will be able to unfasten them another 300 rubles per 100 Mbps (if the reverse traffic is not charged), and I will experiment with the second network card (so that the torrent from the server poured without limits on another wire) <br><br>  Here, somehow.) A lot of fun for me and a good mood for a week =) <br><br>  <b>Additionally, a question for TV viewers:</b> which blog is better to move for the general public - ‚ÄúI am smart‚Äù, or ‚ÄúLinux for all‚Äù, or ‚ÄúSystem administration‚Äù? =) Considering not very deep instructions for use?) <br><br>  <b>UPDATE:</b> That's just that the little gray has turned gray - the server has stopped responding.  I forgot to configure the most important thing - static ip! <br><br>  I called my wife, gave instructions about new redirects, and - voila - <br><br> <code>mcedit /etc/network/interfaces <br> #  ,    eth1  : <br> auto eth1 <br> iface eth1 inet static <br> address 192.168.1.5 <br> netmask 255.255.255.0 <br> network 192.168.1.0 <br> broadcast 192.168.0.255 <br> gateway 192.168.1.1 <br> #,   ... <br> /etc/init.d/networking restart <br></code> <br>  One problem less =) <br><br>  Today I will come home and plug in Wi-Fi there - and update this post taking into account Wi-Fi-settings =) <br><br>  <b>UPDATE2:</b> <br><br>  I did not check the performance of ProFTPD from the outside! <br>  You need to open /etc/proftpd/proftpd.conf and go there: <br><br> <code>DefaultAddress 111.222.333.444 <br> Port 21 <br> PassivePorts 60000 60010 <br> MasqueradeAddress 111.222.333.444 <br></code> <br><br>  And make the appropriate port forwarding on the router!  (for passive ports.).  I have 10 of them - because not many connections are expected. </div><p>Source: <a href="https://habr.com/ru/post/45921/">https://habr.com/ru/post/45921/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45911/index.html">Twiddler2</a></li>
<li><a href="../45912/index.html">Setting up backup in Ubuntu</a></li>
<li><a href="../45913/index.html">Live cook book: our culinary and software hobby</a></li>
<li><a href="../45914/index.html">Using third-party brands in a startup</a></li>
<li><a href="../45919/index.html">Monty Hall's paradox: is there any difference?</a></li>
<li><a href="../45924/index.html">kawaii phone for motorola</a></li>
<li><a href="../45925/index.html">Glasses display: Teleglass by Scalar</a></li>
<li><a href="../45926/index.html">habra</a></li>
<li><a href="../45927/index.html">Portlet Basics</a></li>
<li><a href="../45929/index.html">MySpace in Russia: details</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>