<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ruby -e for easy console operation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As I think many people know, Ruby was created under the influence of Perl, so there is nothing surprising in the fact that Ruby can replace Perl in it...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ruby -e for easy console operation</h1><div class="post__text post__text-html js-mediator-article"><p>  As I think many people know, Ruby was created under the influence of Perl, so there is nothing surprising in the fact that Ruby can replace Perl in its niche of "practical data extraction and reporting."  In this small post we will discuss the use of ruby ‚Äã‚Äãfor fine text processing in the console. </p><a name="habracut"></a><br><h1 id="tldr">  TL; DR </h1><br><p>  We remember two designs: </p><br><ol><li><code>... | ruby -lne &lt;CODE&gt;</code> </li> <li> <code>ruby -lne &lt;CODE&gt; file1, file2, ...</code> </li> </ol><br><p>  In the first case, the input data will be the output of the previous command, and in the second - the concatenation of the contents of the files. </p><br><p>  CODE will be executed for each line of input data that will be written to the <code>$_</code> variable.  <strong>Important</strong> : the lines will be without the terminating <code>\n</code> (the <code>-l</code> flag is responsible for this). </p><br><h3 id="primery">  Examples </h3><br><p>  Reflected <code>cat</code> : </p><br><pre> <code class="bash hljs">ruby -lne <span class="hljs-string"><span class="hljs-string">'puts $_.reverse'</span></span> file-to-show.txt</code> </pre> <br><p>  Display only the first 10 characters of the file name in the current directory: </p><br><pre> <code class="bash hljs">ls | ruby -lne <span class="hljs-string"><span class="hljs-string">'puts $_[0..9]'</span></span></code> </pre> <br><h1 id="nemnogo-podrobnostey">  Few details </h1><br><h3 id="predopredelennye-peremennye">  Predefined variables </h3><br><p>  Ruby has many predefined variables, many of which you and I may not even know.  Among them are migrated from Perl, for example, <code>$_</code> and <code>$&lt;</code> (in fact, in Perl there is no such variable, but there is a construction of an input operator <code>&lt;&gt;</code> , reading from / stdin files and setting <code>$_</code> ). </p><br><p>  A list of them can be found <a href="https://ruby-doc.org/core-2.4.2/doc/globals_rdoc.html">here</a> . </p><br><p>  As part of the topic of the post I advise you to pay attention to the above <code>$_</code> and <code>$&lt;</code> , and in addition to them on: <code>$~</code> , <code>$1</code> , <code>$stdin</code> , <code>ARGV</code> , <code>$stdout</code> , <code>STDIN</code> and <code>STDOUT</code> . </p><br><h3 id="strashnyy-sekret-gets">  Terrible secret gets </h3><br><p>  Perhaps many used <code>gets</code> to request keyboard input.  However, not everyone knows that he is checking the contents of the <code>ARGV</code> - arguments command line. </p><br><p>  When <code>ARGV</code> non-empty, our <code>gets</code> considers that the list of files is listed there, takes the first one and tries to read the line from there. </p><br><p>  Take the script: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># myscript.rb puts gets</span></span></code> </pre> <br><p>  And run it using <code>ruby myscript.rb</code> .  As expected, the program is waiting for our input. </p><br><p>  Now run it like this: </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ruby</span></span> myscript.rb <span class="hljs-literal"><span class="hljs-literal">no</span></span>-such-file</code> </pre> <br><p>  An error will occur: the file "no-such-file" does not exist.  And now change the script: </p><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># myscript.rb ARGV.pop puts gets</span></span></code> </pre> <br><p>  Now the interpreter is waiting for our input again, because  With the help of pop, we threw out our "no-such-file". </p><br><h3 id="opcii-interpretatora">  Interpreter options </h3><br><p>  This is what my one-liner template looks like: </p><br><pre> <code class="ruby hljs">ruby -lne &lt;CODE&gt; [file1, file2, ...]</code> </pre> <br><p>  (often without <code>-l</code> ) </p><br><p>  Description of the used and some potentially useful options: </p><br><ul><li>  <code>-e &lt;CODE&gt;</code> - forces the interpreter not to try to search the script among the arguments and execute <code>CODE</code> . </li><li>  <code>-n</code> - wraps the script (or the code passed by <code>-e</code> ) into a <code>while gets</code> .  The <code>gets</code> method implicitly sets the return value of the <code>$_</code> variable (hello, Perl!), Which we should use.  <strong>Important: the</strong> string will end <code>\n</code> . </li><li>  <code>-l</code> - for simplicity, we can assume that it simply removes the newline character <code>\n</code> from <code>$_</code> . </li><li>  <code>-p</code> - works in the same way as <code>-n</code> , but after each iteration it displays the contents of <code>$_</code> .  Those.  implies that you will change it.  For example: <code>ls | ruby -pe '$_.upcase!'</code> <code>ls | ruby -pe '$_.upcase!'</code> </li><li>  <code>-C &lt;DIR&gt;</code> - changes the working directory. </li><li>  <code>-a</code> (from auto-split) - used in conjunction with <code>-n</code> or <code>-p</code> and sets the variable <code>$F</code> , equal to <code>$_.split</code> . </li><li>  <code>-F</code> - sets the standard separator for <code>String#split</code> ( <code>$;</code> ).  In theory, it can be useful in conjunction with <code>-a</code> .  For example, you can handle simple .csv </li></ul><br><h1 id="zaklyuchenie">  Conclusion </h1><br><p>  For the first time, the <code>cut</code> command prompted me to use <code>ruby -e</code> .  I had to use it a couple of times, and each time I had to open a manual that my tight head did not want to quickly understand. </p><br><p>  In the end, I thought, "Yes, I do not know how to use <code>cut</code> / <code>awk</code> / <code>sed</code> . But I know Ruby well, why can't I use it for small things?" </p><br><p>  Actually, in the end, instead of memorizing a multitude of commands, it was enough for me to memorize only the construction obtained experimentally: </p><br><p> <code>ruby -lne CODE</code> </p> <br><p>  And that's all.  All my problems with line processing text solved. </p><br><p>  There is nothing innovative here, as far as I know, bearded system administrators have long been using perl in this vein.  And among you, I bet, there are many people who know about it, but do not use it, although it would be worth it.  Surely, the pythonists also have something similar. </p><br><p>  PS Finally, here is an example of use: </p><br><p>  I downloaded the season of the series, and there the files are ugly, like "s01e01 - super release by super-mega-macho.mkv", I want to rename them so that everything is beautiful in the media library.  You are welcome: </p><br><pre> <code class="bash hljs">ls | ruby -lne <span class="hljs-string"><span class="hljs-string">'File.rename($_, "#{$_[0..5]}.mkv")'</span></span></code> </pre> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/339544/">https://habr.com/ru/post/339544/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339528/index.html">How to become a programmer</a></li>
<li><a href="../339532/index.html">Multimodal Emotion Recognition Challenge by Neurodata Lab</a></li>
<li><a href="../339534/index.html">Classic 2D quest or how our two years of development went. Part of the final</a></li>
<li><a href="../339536/index.html">Security Week 40: Yahoo, do not leak, Google is caulking holes, as Netgear bugs catches</a></li>
<li><a href="../339538/index.html">Part 2: MVVM: Complete Understanding (+ WPF)</a></li>
<li><a href="../339546/index.html">Program copy counter or usage statistics collection</a></li>
<li><a href="../339548/index.html">Will high-frequency trading disappear?</a></li>
<li><a href="../339550/index.html">Uneducated youth. Life in the outback</a></li>
<li><a href="../339552/index.html">Lower bones? Easy</a></li>
<li><a href="../339554/index.html">How to create a quality map for metro</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>