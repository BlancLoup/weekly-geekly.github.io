<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Shared laptop with session time limit</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings habrovchane 

 I recently asked to set up a laptop in one of the small cafes so that visitors could use it for free , and with a time limit ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Shared laptop with session time limit</h1><div class="post__text post__text-html js-mediator-article">  Greetings habrovchane <br><br>  I recently asked to set up a laptop in one of the small cafes so that visitors could use it <b>for free</b> , and with a time limit without worrying about their data. <br><br>  So, the <b>initial situation and the required functionality</b> : <br><ul><li>  Acer i3 laptop, 4GB RAM, WIFI / USB, 640GB HDD (1 Recovery Partition + 1 System / Data), Win 7 Home Premium; </li><li>  the required session time is limited to 30 minutes; </li><li>  a break between sessions (minimum between logins) at 2 minutes; </li><li>  session data is not saved, moreover - must be removed from the laptop at the end of the session; </li><li>  the ability to work a specific user (cafe worker) without time limit; </li><li>  the ability to use if necessary pre-installed Windows 7. </li></ul><br>  After an intensive search on the Internet for programs on Internet cafes, I decided that I shouldn‚Äôt shoot from a cannon on sparrows, and chose the following tools to solve the problem: <br><ul><li>  Linux as the second, and the main operating system (Ubuntu 12.04 LTS, because it will be supported by updates for a couple of years); </li><li>  guest account, which is present at 12.04 and after the end of the session deletes all user data; </li><li>  double hidden boot, with optional windows boot. </li></ul><br><a name="habracut"></a><br>  <b>Now in order.</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  System installation </h4><br>  In windows, through ‚ÄúSystem-Management-Disk Management‚Äù, the main partition (labeled ‚ÄúAcer‚Äù) was reduced by 200 GB, we got a free unformatted area of ‚Äã‚Äãthe disk (200GB), and put it there ubuntu. <br><br>  Ubuntu installation is carried out as standard, boot from cd / dvd. <br>  When installing, you can choose the option "next to the existing operating system", I chose manual partitioning: <br><ul><li>  root (extended) root partition (use as ‚Äú/‚Äù) 20 GB ext4 (/ dev / sda5); </li><li>  home partition (use as ‚Äû/ home‚Äú) 176 GB ext4 (/ dev / sda6); </li><li>  paging file partition (use as swap) 4 GB (/ dev / sda7), although in principle is not needed, because  deep sleep with saving to disk is not expected, but for internet surfing it is not needed. </li></ul><br>  We install the system with the username administrator ("admin" is already reserved for ubuntu). <br><br>  After the first reboot, we connect the network / WIFI (if you have not connected yet) and install all updates, plus a couple of necessary additions for normal operation: <br><br><pre><code class="bash hljs">sudo apt-get update sudo apt-get dist-upgrade sudo apt-get install flashplugin-downloader sudo apt-get install gimp</code> </pre> <br>  If you plan to use java (for example, online banking, etc.), put it too: <br><br><pre> <code class="bash hljs">sudo apt-get install openjdk-7-jre icedtea-7-plugin</code> </pre><br>  In this notebook, the first partition (/ dev / sda1) is the Windows recovery partition, so it is advisable to remove it from harm's way from the GRUB boot menu. <br>  I did this: <br><br>  from <i>/boot/grub/grub.conf</i> copied the necessary section to <i>/etc/grub.d/40_custom</i> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh exec tail -n +3 $0 # This file provides an easy way to add custom menu entries. Simply type the # menu entries you want to add after this comment. Be careful not to change # the 'exec tail' line above. menuentry "Windows 7 (loader) (on /dev/sda2)" --class windows --class os { insmod part_msdos insmod ntfs set root='(hd0,msdos2)' search --no-floppy --fs-uuid --set=root 70E253CBE25393E6 chainloader +1 }</span></span></code> </pre><br>  append to the end of the file / etc / default / grub <br><br><pre> <code class="bash hljs">GRUB_DISABLE_OS_PROBER=<span class="hljs-string"><span class="hljs-string">"true"</span></span></code> </pre><br>  and launch the GRUB menu update in the terminal <br><br><pre> <code class="bash hljs">sudo update-grub</code> </pre><br>  Now when you reboot, only the Linux related items and the last boot item of the installed Windows are visible in the menu. <br><br>  If you need to hide the boot menu, you will have to bypass one bug present in ubuntu 12.04, namely, just by changing the parameters in <i>/ etc / default / grub</i> <br><br><pre> <code class="bash hljs">GRUB_HIDDEN_TIMEOUT=<span class="hljs-string"><span class="hljs-string">"5"</span></span> GRUB_HIDDEN_TIMEOUT_QUIET=<span class="hljs-string"><span class="hljs-string">"false"</span></span></code> </pre><br>  hide the menu when loading fails. <br>  This is treated by adding a fragment to the end of the <i>/etc/grub.d/00_header</i> file. <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">### BEGIN Hidden Menu Test ### cat &lt;&lt; EOF if [ ${timeout} != -1 ]; then if sleep --verbose --interruptible ${GRUB_HIDDEN_TIMEOUT} ; then set timeout=0 fi fi EOF ### END Hidden Menu Test ###</span></span></code> </pre><br>  In the end, the file <i>/ etc / default / grub</i> has the following form: <br><br><pre> <code class="bash hljs">GRUB_DEFAULT=<span class="hljs-string"><span class="hljs-string">"0"</span></span> GRUB_HIDDEN_TIMEOUT=<span class="hljs-string"><span class="hljs-string">"5"</span></span> GRUB_HIDDEN_TIMEOUT_QUIET=<span class="hljs-string"><span class="hljs-string">"false"</span></span> GRUB_TIMEOUT=<span class="hljs-string"><span class="hljs-string">"5"</span></span> GRUB_DISTRIBUTOR=<span class="hljs-string"><span class="hljs-string">"`lsb_release -i -s 2&gt; /dev/null || echo Debian`"</span></span> GRUB_CMDLINE_LINUX_DEFAULT=<span class="hljs-string"><span class="hljs-string">"quiet splash"</span></span> GRUB_CMDLINE_LINUX=<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-comment"><span class="hljs-comment"># Uncomment to enable BadRAM filtering, modify to suit your needs # This works with Linux (no patch required) and with any kernel that obtains # the memory map information from GRUB (GNU Mach, kernel of FreeBSD ...) #GRUB_BADRAM="0x01234567,0xfefefefe,0x89abcdef,0xefefefef" # Uncomment to disable graphical terminal (grub-pc only) #GRUB_TERMINAL="console" # The resolution used on graphical terminal # note that you can use only modes which your graphic card supports via VBE # you can see them in real GRUB with the command `vbeinfo' GRUB_GFXMODE="640x480" # Uncomment if you don't want GRUB to pass "root=UUID=xxx" parameter to Linux #GRUB_DISABLE_LINUX_UUID="true" # Uncomment to disable generation of recovery mode menu entries #GRUB_DISABLE_RECOVERY="true" # Uncomment to get a beep at grub start #GRUB_INIT_TUNE="480 440 1" GRUB_DISABLE_OS_PROBER="true"</span></span></code> </pre><br>  and of course, do not forget to update grub before rebooting: <br><br><pre> <code class="bash hljs">sudo update-grub</code> </pre><br>  Now if, after the BIOS disappears, press ESC for 5 seconds, the GRUB menu will appear, otherwise the first menu item by default (Ubuntu) will be silently loaded. <br><br><h4>  Configuring the guest session </h4><br><ul><li>  Create a new user user (this will first be our sample for the guest, then the login for the cafe employee); </li><li>  Change wallpaper; </li><li>  We expose the necessary shortcuts to the desktop / configure the Unity panel to taste; </li><li>  Change settings LibreOffice, Gimp, etc. </li></ul><br>  Log out and log in again as administrator. <br>  Create the <i>/ etc / guest-session / skel</i> folder: <br><br><pre> <code class="bash hljs">sudo mkdir -p /etc/guest-session/skel</code> </pre><br>  and copy the home directory of our user there: <br><br><pre> <code class="bash hljs">sudo cp -a /home/user/* /etc/guest-session/skel/ sudo cp -a /home/user/.* /etc/guest-session/skel/</code> </pre><br>  If you now log in as a guest, the desktop and environment should look exactly the same as that of the user. <br><br><h4>  Guest session time limit </h4><br>  Login as administrator. <br>  Add to the <i>/ usr / sbin / guest-account</i> file at the end of the <i>remove_account ()</i> function (executed when the guest logs off) the lines: <br><br><pre> <code class="bash hljs"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove_account</span></span></span></span> () { ‚Ä¶ ‚Ä¶ rm -f /tmp/*.guest touch /tmp/$(date -d <span class="hljs-string"><span class="hljs-string">"today"</span></span> +<span class="hljs-string"><span class="hljs-string">"%Y%m%d%H%M"</span></span>).guest }</code> </pre><br>  Create the file <i>/etc/guest-session/skel/.guest.sh</i> with the following contents: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh if [ -f /tmp/*.guest ] then TIMEOUT=2 TIMESTAMP=`date -d "today" +"%Y%m%d%H%M"` for FNAME in /tmp/*.guest do OLDTIME="$(basename $FNAME .guest)" done if [ $(($TIMESTAMP-$OLDTIME)) -lt $TIMEOUT ] then sleep 10 notify-send -u critical "      !" "   (     )." sleep 10 gnome-session-quit --logout --no-prompt fi fi sleep 10 notify-send -u critical "  " "  30  .\n\n!" sleep 600 notify-send -u critical " 20 ..." sleep 600 notify-send -u critical " 10 ..." sleep 300 notify-send -u critical " 5       !\n     ." sleep 300 notify-send -u critical " " "   10 .\n     ." sleep 10 gnome-session-quit --logout --no-prompt</span></span></code> </pre><br>  and make it executable: <br><br><pre> <code class="bash hljs">sudo chmod a+x /etc/guest-session/skel/.guest.sh</code> </pre><br>  It remains only to add a line to the end of the <i>/etc/guest-session/skel/.profile</i> file <i>.</i> <br><br><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$HOME</span></span>/.guest.sh &amp;</code> </pre><br>  and actually that's all. <br><br><h4>  Result </h4><br>  As a result, I received a laptop that without warning and displaying the menu is loaded into ubuntu, with three users: administrator, user and guest, and with a time limit for the guest session of 30 minutes with a forced pause of 2 minutes.  Pause can be reset by restarting the laptop.  If this is undesirable, then you should save the .guest file not in / tmp, but, say, in / var / log (see <i>/ usr / sbin / guest-account</i> ). <br>  At certain intervals, the user is notified of the remaining session time. <br>  During the session it is possible to change the user (for example, user, and back to the guest without the need to completely log out the user). <br><br><h4>  disadvantages </h4><br>  Although the .guest.sh script is not visible in the home folder (at least right away), it is visible in the process list, and this process is quietly killed by the guest (if he knows how), which in principle removes the restriction on the session time. <br><br>  <b>Constructive criticism and suggestions for improving this solution are welcome!</b> </div><p>Source: <a href="https://habr.com/ru/post/179237/">https://habr.com/ru/post/179237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../179227/index.html">What happens when a project that receives Kickstarter funding fails?</a></li>
<li><a href="../179229/index.html">Non-standard option of monetization of social services with the involvement of new users</a></li>
<li><a href="../179231/index.html">BitTorrent Bundle and Network Marketing</a></li>
<li><a href="../179233/index.html">History of visiting sites through Mikrotik router logs</a></li>
<li><a href="../179235/index.html">Apache Thrift RPC Server. We are friends with C ++ and Java</a></li>
<li><a href="../179239/index.html">We include Samsung Multi Window in another application</a></li>
<li><a href="../179241/index.html">Integration of 1C and Megaplan or why web services are good</a></li>
<li><a href="../179243/index.html">jQuery EasyUI Datagrid + Yii Framework</a></li>
<li><a href="../179247/index.html">Cone model, with space-time jump</a></li>
<li><a href="../179249/index.html">The US government has blocked the distribution of drawings of the gun, which can be printed on a 3D printer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>