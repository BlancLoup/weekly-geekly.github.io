<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>One-dimensional linear regression, SQL and machine learning</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. This is my first article on Habr√©, I will be glad to criticism and comments. 


 The article is devoted to a simple but convenient way of const...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>One-dimensional linear regression, SQL and machine learning</h1><div class="post__text post__text-html js-mediator-article"><p>  Hello.  This is my first article on Habr√©, I will be glad to criticism and comments. </p><br><p>  The article is devoted to a simple but convenient way of constructing predictors of a special kind in SQL-like languages.  These predictors describe a linear trend in the data that can be used to solve machine learning problems.  The idea is to calculate linear trends quickly and efficiently using transactional data. </p><br><a name="habracut"></a><br><p>  We will consider the problem of learning with the teacher - the problem of regression or classification.  The solution of such problems can be divided into many stages, and we will be interested in the stage of creating new predictors.  We will assume that in the initial raw data we have, among other things, data on transactions.  Details are not important, so we will assume that we have users who perform some actions in time that characterize their activity (Amount field), as well as actions that we want to predict (Target field): </p><br><table><thead><tr><th>  Userid </th><th>  Timeid </th><th>  Amount </th><th>  Target </th></tr></thead><tbody><tr><td>  101 </td><td>  one </td><td>  20.0 </td><td>  0 </td></tr><tr><td>  101 </td><td>  2 </td><td>  30.0 </td><td>  one </td></tr><tr><td>  101 </td><td>  3 </td><td>  50.0 </td><td>  0 </td></tr><tr><td>  102 </td><td>  2 </td><td>  80.0 </td><td>  0 </td></tr><tr><td>  102 </td><td>  four </td><td>  50.0 </td><td>  0 </td></tr><tr><td>  102 </td><td>  five </td><td>  50.0 </td><td>  0 </td></tr><tr><td>  102 </td><td>  7 </td><td>  30.0 </td><td>  one </td></tr></tbody></table><br><p>  In this case, time is indexed by integers.  When creating such an index, it is important that the indexes <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.395ex" height="1.455ex" viewBox="0 -520.7 600.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6E" x="0" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-1"> n </script>  and <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>n</mi><mo>+</mo><mn>1</mn></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.398ex" height="2.057ex" viewBox="0 -728.2 2323.9 885.9" role="img" focusable="false" style="vertical-align: -0.366ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6E" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-2B" x="822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-31" x="1823" y="0"></use></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi><mo>+</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-2"> n + 1 </script>  corresponded to the time units that really follow each other (from the following it will be clear why this is important).  For example, if you need to index days, then each day can be assigned an index equal to the number of days from the very first day among all those considered.  If the very first day on the tablet is January 1, 2017, then January 2 will correspond to index 1, January 28 - index 27, and on February 4 - index 34. Sometimes it is appropriate for each user to add entries for all missing values ‚Äã‚Äãof the time index, filling the field amount zeroes  For example, we may be interested in data on the consumption of a certain product during each of the previous three months - for each user there will always be three entries in the table. </p><br><p>  The Target field in this example stores information about a binary event that either occurred or did not occur during the corresponding point in time. </p><br><p>  It is important to note that in practice, if there is such an opportunity, I always separate the creation of predictors from modeling.  Usually, most of the transformations and frills that can be done in R th, python or elsewhere, can also be done in SQL.  Therefore, whenever possible, I always create datasets and all predictors in SQL.  The advantages are that, firstly, the stages of machine learning are separated from each other and, secondly, all data manipulations are done immediately and only in the database.  Moreover, predictive transformations are sometimes even easier to do using SQL. </p><br><p>  So, we have a table with transactional data: users, integer points in time and a quantitative description of the actions of these users.  Our goal is to find a linear trend in this data for each user.  Since the predictor is one, we will use <a href="https://en.wikipedia.org/wiki/Simple_linear_regression">simple linear regression</a> .  Since we are interested in the trend, we will calculate the slope coefficient: </p><br><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mtext>&amp;#xA0;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mo>=</mo><mtext>&amp;#xA0;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi><mi>y</mi></mrow><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>y</mi></mrow></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mtext>&amp;#xA0;</mtext><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>x</mi><mn>2</mn></msup></mrow><mo>&amp;#x2212;</mo><mtext>&amp;#xA0;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>x</mi></mrow><mn>2</mn></msup></mrow></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="59.358ex" height="2.78ex" viewBox="0 -935.7 25556.8 1197.1" role="img" focusable="false" style="vertical-align: -0.607ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6C" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-70" x="1078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-68" x="1581" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="2158" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-3D" x="2965" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-66" x="4271" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="4822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="5273" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-63" x="5803" y="0"></use><g transform="translate(6236,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-76" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-65" x="1221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="1687" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6C" x="2139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-69" x="2437" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6E" x="2783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-65" x="3383" y="0"></use><g transform="translate(3850,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-78" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-79" x="572" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-2212" x="5142" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-62" x="6392" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="6822" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="7351" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-78" x="7803" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-62" x="8625" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="9055" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="9584" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-79" x="10036" y="0"></use></g><g transform="translate(16770,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6F" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-76" x="735" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-65" x="1221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="1687" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6C" x="2139" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-69" x="2437" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-6E" x="2783" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-65" x="3383" y="0"></use><g transform="translate(3850,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-32" x="809" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-2212" x="5098" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-62" x="6349" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-61" x="6778" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-72" x="7308" y="0"></use><g transform="translate(7759,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMATHI-78" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/326124/&amp;xid=17259,15700021,15700186,15700190,15700248,15700253&amp;usg=ALkJrhhPqjEgbP74UWmCbB7WFSmQJcbx4A#MJMAIN-32" x="809" y="513"></use></g></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mtext>&nbsp;</mtext><mi>a</mi><mi>l</mi><mi>p</mi><mi>h</mi><mi>a</mi><mo>=</mo><mtext>&nbsp;</mtext><mi>f</mi><mi>r</mi><mi>a</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi><mi>y</mi></mrow><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><mrow class="MJX-TeXAtom-ORD"><mi>y</mi></mrow></mrow><mrow class="MJX-TeXAtom-ORD"><mtext>&nbsp;</mtext><mi>o</mi><mi>v</mi><mi>e</mi><mi>r</mi><mi>l</mi><mi>i</mi><mi>n</mi><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><msup><mi>x</mi><mn>2</mn></msup></mrow><mo>‚àí</mo><mtext>&nbsp;</mtext><mi>b</mi><mi>a</mi><mi>r</mi><msup><mrow class="MJX-TeXAtom-ORD"><mi>x</mi></mrow><mn>2</mn></msup></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3"> \ alpha = \ frac {\ overline {xy} - \ bar {x} \ bar {y}} {\ overline {x ^ 2} - \ bar {x} ^ 2} </script><br><p>  From the formula it is clear that the slope depends only on the averages and their products.  Consequently, it should be possible to calculate it "on the fly" in SQL, as it is quite self-sharpened for such operations.  It is also clear that it is possible to calculate changes in this coefficient: for example, we fix the fact that the trend is calculated by five time values, then for each set of five consecutive records we calculate the trend.  Those who are familiar with SQL already understand how this can be done - <a href="https://www.simple-talk.com/sql/t-sql-programming/window-functions-in-sql/">window functions</a> should be used.  Window functions allow you to calculate the moving average, and that is what we need.  The goal is to calculate moving averages for both the Amount field and the TimeID field.  The first will play the role of a dependent variable, the second - independent: </p><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> UserID , TimeID, Amount, , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Amount) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> UserID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> TimeID <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [y_bar] , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>*TimeID) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> UserID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> TimeID <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [x_bar] , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(Amount*TimeID) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> UserID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> TimeID <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [xy_bar] , <span class="hljs-keyword"><span class="hljs-keyword">AVG</span></span>(<span class="hljs-number"><span class="hljs-number">1.0</span></span>*TimeID*TimeID) <span class="hljs-keyword"><span class="hljs-keyword">OVER</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">PARTITION</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> UserID <span class="hljs-keyword"><span class="hljs-keyword">ORDER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> TimeID <span class="hljs-keyword"><span class="hljs-keyword">ROWS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BETWEEN</span></span> <span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">PRECEDING</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> [x2_bar] <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-comment"><span class="hljs-comment">#tmp_LinearTrendAmount FROM MyTransTable</span></span></code> </pre> <br><p>  After doing this select, we will have all the necessary components at our disposal to calculate the slope coefficient.  Another select-m can be collected in the desired indicator, doing the necessary checks (for example, division by zero, which can occur if the user has only one entry).  In this example, the slope is calculated from 5 records preceding this one (in the code we use ... AND 1 PRECEDING).  The fact is that the Target field refers to a point in time from its own line, so taking records up to it would be "looking into the future." </p><br><p>  So, using window functions, you can quickly get the slope coefficients.  Importantly, we will get these coefficients for all the records in the table, because SQL will go through the entire table, calculate the moving averages and write them in new columns (taking into account that the slope values ‚Äã‚Äãfor the first four records for each user will be inaccurate).  As a result, you can train the model on the entire table, since each record can be considered as a separate observation.  Window functions work fairly quickly, especially when compared with some other implementation of linear regression. </p><br><p>  Remark 1. On the question of why all this is necessary.  For learning tasks with a teacher, in the case when there is data on transactions, I usually use predictors of various kinds ‚Äî averages, medians, and modes that describe the magnitude of the predictor values;  standard deviations and variation coefficients to describe variability, as well as trends in predictor values.  In general, this is a good approach, because at least one predictor of each type usually falls into the model. </p><br><p>  Note 2. Now it should be clear why it was important to correctly calculate TimeID indexation.  Because it is our independent variable and it must be correctly calculated. </p><br><p>  Note 3. The devil is in the details.  For example, if you take a fixed number of time values, then trends can be calculated over different time intervals ‚Äî for one user, 5 times will cover 1 week, for another - 1 month.  Of course, logic must allow such use.  If, for example, for each user we store consumption for each of the previous 3 months, then this problem disappears. </p><br><p>  Instead of a conclusion.  Applications are always individual: a lot depends on what data, what transactions, at what intervals, how the target variable is calculated.  To a greater extent, my idea was to talk about an approach that can be adapted to the solution of many problems - the one-dimensional linear trend depends only on averages, and they can be easily calculated, including in SQL-e, using window functions. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/326124/">https://habr.com/ru/post/326124/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../326114/index.html">Primitives for implementing 1-Wire master using PWM and ICP for STM8L and STM32</a></li>
<li><a href="../326116/index.html">The subtleties of Scala: we study CanBuildFrom</a></li>
<li><a href="../326118/index.html">Editors ONLYOFFICE v.4.3: yes, we added footnotes</a></li>
<li><a href="../326120/index.html">5 courses that will help start your way in the design of games</a></li>
<li><a href="../326122/index.html">Test Lossless Image Optimizers (PNG and JPG)</a></li>
<li><a href="../326126/index.html">Lectures Tehnotreka. Designing a DBMS (Fall 2016)</a></li>
<li><a href="../326128/index.html">Protection of confidential data: the main features of IBM Security Guardium</a></li>
<li><a href="../326130/index.html">Agile everyone has his own: how to go with the flow, manage projects and not to suffer</a></li>
<li><a href="../326132/index.html">Subproject allocation in a separate repository on github</a></li>
<li><a href="../326134/index.html">Spring semester online courses from Academic University and CS Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>