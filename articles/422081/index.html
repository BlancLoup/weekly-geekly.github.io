<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application for the multiplatform bot framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chatbots tightly entered our information life, all social networks and messengers respecting themselves have bots support, they provide a convenient A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application for the multiplatform bot framework</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/10c/297/311/10c2973112bf3e696147b9c86d6d333e.jpg" alt="image"><br><br>  Chatbots tightly entered our information life, all social networks and messengers respecting themselves have bots support, they provide a convenient API for their development and use, everything for the convenience of users and programmers.  Now, to create a bot in Telegram it is not even necessary to know any programming language.  There are services that allow you to design a bot using the web interface.  And this is really good, but quite recently I ran into a problem and was surprised that in all this wave of popularity of chatbots, which, moreover, are now not just a cool feature, but also an income generating tool - there is practically no answer. <br><br>  And the question is: what if I want to create more than one bot for one service?  For example, I know that Central Asia is sitting in Vkontakte and Telegram, how can I write with minimal effort to write bots that work with people both there and there?  If suddenly I (for example, as the owner of an online store) also want to use the bots to work with the audience already on Facebook, will it really be necessary to develop a new bot from scratch and rewrite all the logic under it or try to penetrate into the new API or library.  And I tried to find the answer under the cut, I ask to the table. <br><a name="habracut"></a><br>  In fact, there are solutions, and there are a lot of them, but they all boil down to the fact that you have to host your bot with a service that also provides a platform.  That is, as a boxed solution is not obtained.  Perhaps I am wrong and have not fully studied what actually is, but the fact that the first link in Google does not lead to a solution is already alarming.  There is also a <a href="https://botman.io/">Botman</a> .  This is a really powerful full-fledged developing opensource library with a bunch of chips and comprehensive documentation.  And it is written in <i>PHP.</i>  I have nothing against <i>PHP</i> , in any case I do not admit it publicly, so as not to breed unnecessary holivar, but I don‚Äôt want to develop it at all.  I decided to look for something similar to Python, besides for Python there are a lot of libraries that allow you to work with the Telegram Bot API.  And I did not find anything, so soon I came to the conclusion that it was worth writing myself.  <i>(Maybe someone knows the appropriate solutions for multi-platform bots with an open system, I will be glad to any information)</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here, by the way, another problem is brewing.  I absolutely can not imagine where else you can share your work with the audience in the form of an article except on Habr√©.  I would be very happy to help in this matter <br><br>  The name <a href="https://github.com/OlegYurchik/botovod">Botovod</a> came by itself. <br><br>  In general, I will give a small code using Botovod, and explain it briefly. <br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> botovod <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Botovod, Message, utils @utils.convert_to_text <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, text)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) @utils.convert_to_images <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_images</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, images)</span></span></span><span class="hljs-function">:</span></span> message = Message() message.text = <span class="hljs-string"><span class="hljs-string">"  "</span></span> agent.send_message(chat, message) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler_echo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> agent.send_message(chat, message) settings = [ { <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"agent"</span></span>: <span class="hljs-string"><span class="hljs-string">"botovod.agents.telegram"</span></span>, <span class="hljs-string"><span class="hljs-string">"settings"</span></span>: {<span class="hljs-string"><span class="hljs-string">"token"</span></span>: <span class="hljs-string"><span class="hljs-string">"462755273:AzBZBQ7AAnqFEXqZ_P8Z-qvCddmjqTVAYPI"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"polling"</span></span>} }, ] botovod = Botovod(settings) botovod.add_handler(handler_message) botovod.add_handler(handler_images) botovod.add_handler(handler_echo) botovod.start()</code> </pre> <br></div></div><br><br>  Here we define 3 handlers for incoming messages, each sending something in response.  The first: ‚ÄúI received a message,‚Äù the second: ‚ÄúI see a photo,‚Äù the third will simply send back what I received.  Then we create the bot manager (Botovod) and pass it the settings for the bots, in the given one for the bot in Telegram.  Then we add message handlers in sequence.  If a message arrives at the bot, it will go to the first processor that agrees to accept it.  For example, if an audio was sent to us, the first handler will try to accept it first, but will refuse, since this is not text.  Then he will accept the second one, but he will also refuse, since this is not a picture, then he will accept the third one, which has no restrictions - thus he will send the audio in the same way.  Restrictions are imposed as decorators from the utils module. <br><br>  Now I will try to tell in detail what is what: <br><br>  There is a bot manager - an object of the Botovod class - the bot name is transferred to it in the constructor (each has its own unique one), the agent class that will process it and the settings for the bot.  Also handlers are added to the bot manager in turn.  If a message arrives at the bot, the manager will check them one by one until the handler that does not throw the NotPassed exception is found.  The first added handler is checked first, the last, respectively, last.  If you are going to use the webbooks, then the bot manager can be connected to the web server.  To do this, the bot manager has a listen method that takes the bot name, headers, and request body.  Next, it passes this data to the agent's parser, which returns the generated message, after this message is pushed by handlers.  In response, the listen method returns the dictionary {"status": any_code, "headers": dict (), "body": "any_text"}, where in headers are the response headers, and in body - the response body.  Sometimes the messenger / social network requires the server to return an object, so I think this behavior is convenient. <br><br>  I will give an example for the Vkontakte bot under the name ‚Äúvk-bot‚Äù, and Botovod will connect to the Django server <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">view</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(request)</span></span></span><span class="hljs-function">:</span></span> response = manager.listen(<span class="hljs-string"><span class="hljs-string">"vk-bot"</span></span>, request.headers, request.text) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpResponse(status = response[<span class="hljs-string"><span class="hljs-string">"status"</span></span>], headers = response[<span class="hljs-string"><span class="hljs-string">"headers"</span></span>], response[<span class="hljs-string"><span class="hljs-string">"body"</span></span>])</code> </pre><br><br>  The generated message is an object of the Message class.  It includes the following fields: text - the text of the message;  images - list with images;  audios - a list with audio files;  videos - list with video;  documents - list with documents;  locations - a list with places on the map;  raw - the raw message body or additional information to it (the dictionary). <br><br>  Also, each list of the Message object (images, audios, videos, documents) contains special objects whose classes are inherited from Attachment.  The class Attachment by default has the url and file_path methods in it, in which the agent parsers usually put information about the received file.  The list of locations contains Location objects, in the constructor to which you need to transfer longitude and latitude (longitude and latitude). <br><br>  Below is an example of constructing messages in handlers. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handler</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(agent, chat, message)</span></span></span><span class="hljs-function">:</span></span> out = botovod.Message() image = botovod.Image() image.file_path = <span class="hljs-string"><span class="hljs-string">"/tmp/1.png"</span></span> location = botovod.Location() out.images.append(image) out.text = <span class="hljs-string"><span class="hljs-string">" ,   "</span></span> agent.send_message(chat, out)</code> </pre><br><br>  This is all that is in it, but I hope that this solution will be interesting to someone and someone will want to help with advice, comment, an idea, and maybe their own participation in the development.  Thank you all for reading! <br><br>  <a href="https://github.com/OlegYurchik/botovod">Github link</a> </div><p>Source: <a href="https://habr.com/ru/post/422081/">https://habr.com/ru/post/422081/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../422069/index.html">PHP Digest number 138 (August 20 - September 2, 2018)</a></li>
<li><a href="../422071/index.html">Enough for everyone, or how to deliver the Internet to developing countries</a></li>
<li><a href="../422073/index.html">The easiest way to support the integration of java-client with java-server</a></li>
<li><a href="../422077/index.html">Is the problem of injection in javascript relevant?</a></li>
<li><a href="../422079/index.html">The digest of fresh materials from the world of the frontend for the last week No. 329 (August 27 - September 2, 2018)</a></li>
<li><a href="../422083/index.html">One-page site on Kotlin and SpringBoot without using JSP</a></li>
<li><a href="../422085/index.html">Sort by selection</a></li>
<li><a href="../422087/index.html">Computer vision in industry. Lecture in Yandex</a></li>
<li><a href="../422089/index.html">Execution Context and Call Stack in JavaScript</a></li>
<li><a href="../422091/index.html">Effective use of array methods in javascript</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>