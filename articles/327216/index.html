<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Publication of Vkontakte posts through Trello</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Suppose there is a group in Vkontakte about the movie, which publishes announcements of new films and some other information. It is necessary to prepa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Publication of Vkontakte posts through Trello</h1><div class="post__text post__text-html js-mediator-article"><p>  Suppose there is a group in Vkontakte about the movie, which publishes announcements of new films and some other information.  It is necessary to prepare posts in advance and publish according to the schedule.  For this, I am going to use the Trello board, where the posts and Vkontakte API are stored to publish these posts in a group. </p><br><p><img src="https://habrastorage.org/files/c04/ce3/77e/c04ce377efa6425cbdfcafcf0d4a7d2b.jpeg" alt="image"></p><a name="habracut"></a><br><p>  Let's create a board in Trello with the name "Cinema", and in it two sheets of "New Week" and "Soon at the box office".  Add there 4 cards, 2 with the publication for today, 1 for tomorrow and 1 without a date. </p><br><p>  To work with the Trello API and Vkontakte API, we will need the following libraries. </p><br><pre><code class="bash hljs">$ pip3 install py-trello $ pip3 install py-vkontakte</code> </pre> <br><h4 id="dostup-k-trello-api">  Access to the Trello API </h4><br><p>  <em>KEY</em> and <em>TOKEN</em> get here <a href="https://trello.com/app-key">https://trello.com/app-key</a> </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> trello client = trello.TrelloClient(api_key=KEY, token=TOKEN) board = client.get_board(ID) <span class="hljs-comment"><span class="hljs-comment">#  https://trello.com/b/nC8QJJoZ/,  ID ‚Äî nC8QJJoZ</span></span></code> </pre> <br><p>  With the help of "Due Date" in the Trello card we set the time when it is necessary to publish it on Vkontakte. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_card_can_published</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(trello_card)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> trello_card.due_date: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> now_unixtime = datetime.datetime.utcnow().replace(tzinfo=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>).timestamp() card_due_unixtime = trello_card.due_date.replace(tzinfo=<span class="hljs-keyword"><span class="hljs-keyword">None</span></span>).timestamp() delta = card_due_unixtime - now_unixtime <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> delta &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> card_items = (card <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> card <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> board.open_cards() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_card_can_published(card))</code> </pre> <br><p>  The publication schedule can be viewed using the Trello internal calendar. </p><br><p><img src="https://habrastorage.org/files/002/631/0ec/0026310ec2a64c62b2a9e29777039e35.jpeg" alt="image"></p><br><p>  You can attach any file to the card, so first check the extension of the file.  The function <code>get_attachment_in_card</code> returns a tuple "file name" and "image byte string", which are used to load in VK. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">is_image_file</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(attachment_url)</span></span></span><span class="hljs-function">:</span></span> _, file_extension = os.path.splitext(attachment_url) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> file_extension <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> (<span class="hljs-string"><span class="hljs-string">'.jpg'</span></span>, <span class="hljs-string"><span class="hljs-string">'.gif'</span></span>, <span class="hljs-string"><span class="hljs-string">'.png'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">download_attachment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(attachment_url)</span></span></span><span class="hljs-function">:</span></span> response = requests.get(attachment_url, stream=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response.content <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attachment_in_card</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(card)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> attachment <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> card.get_attachments(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> is_image_file(attachment.url): <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> binary_content = download_attachment(attachment.url) _, filename = os.path.split(attachment.url) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> (filename, binary_content)</code> </pre> <br><h4 id="dostup-k-vkontakte-api">  Access to Vkontakte API </h4><br><ol><li>  Create a standalone application <a href="https://vk.com/editapp%3Fact%3Dcreate">https://vk.com/editapp?act=create</a> </li><li>  In the settings of the application, we need "application_id" and "Protected_key" </li></ol><br><p>  <a href="https://vk.com/dev/authcode_flow_user">https://vk.com/dev/authcode_flow_user</a> </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk &gt;&gt;&gt; vk.create_url_get_code(<span class="hljs-string"><span class="hljs-string">"ID_"</span></span>, <span class="hljs-string"><span class="hljs-string">'https://oauth.vk.com/blank.html'</span></span>, scope=<span class="hljs-string"><span class="hljs-string">'wall, photos'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#    CODE &gt;&gt;&gt; vk.create_access_token("ID_", "_", "https://oauth.vk.com/blank.html", "CODE") #  ACCESS_TOKEN</span></span></code> </pre> <br><p>  Get the VK group via <code>py-vkontakte</code> </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> vk vk.set_access_token(ACCESS_TOKEN) group = vk.get_group(ID) <span class="hljs-comment"><span class="hljs-comment"># vk.com/apiclub,  ID ‚Äî apiclub  vk.com/club1,  ID ‚Äî 1</span></span></code> </pre> <br><p>  Use our <code>"get_attachment_in_card"</code> function to get the image from the Trello card.  We load images in VK and we create the publication in group.  After the post is published in Vkontakte, "due date" is marked as completed. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> vk.photos <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Photo <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> card <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> card_items: attachment_items = \ {filename: binary_content <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> filename, binary_content <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> get_attachment_in_card(card)} photo_items = Photo.upload_wall_photos_for_group(group.id, attachment_items.items()) group.wall_post(message=card.name + <span class="hljs-string"><span class="hljs-string">'\n'</span></span> + card.description, attachments=photo_items) card.set_due_complete()</code> </pre> <br><p>  ‚Üí <a href="https://github.com/sgaynetdinov/postin-in-vk-from-trello">GitHub</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/327216/">https://habr.com/ru/post/327216/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../327206/index.html">GoTo Data Science Challenge 2: Summer School Grants</a></li>
<li><a href="../327208/index.html">Webinar "Overview of the SAP Cloud Platform Platform"</a></li>
<li><a href="../327210/index.html">Does your webcam work in new Firefox 53?</a></li>
<li><a href="../327212/index.html">Live Typing vs. Evernote: how we lay on an elephant</a></li>
<li><a href="../327214/index.html">Broadcast RTMP video stream from Live Encoder to WebRTC</a></li>
<li><a href="../327218/index.html">Understanding Bitcoin Replace-By-Fee Transactions</a></li>
<li><a href="../327220/index.html">Nalivator-9000: robot barman on Raspberry Pi and Go</a></li>
<li><a href="../327222/index.html">3D modeling and high performance computing (HPC) in the development of new products</a></li>
<li><a href="../327224/index.html">From engineers to managers: maintaining technical skills</a></li>
<li><a href="../327226/index.html">Open source databases on large machines: disk speed and innodb_io_capacity. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>