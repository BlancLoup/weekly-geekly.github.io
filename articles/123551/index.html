<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Rails custom scaffolding</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably everyone at the beginning of working with ROR was impressed by the possibility of Scaffolding, which allows one team to create migrations, co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Rails custom scaffolding</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/storage1/04ad039d/3a3d960d/b611e898/28e19ad4.jpeg"><br>  Probably everyone at the beginning of working with ROR was impressed by the possibility of Scaffolding, which allows one team to create migrations, controllers, models and views. <br><br>  But what to do if you use non-standard Rails utilities: erb, Test :: Unit, fixturies, and third-party tools: Haml, Rspec, Cucumber, Factory Girl and more, in your project, do you want to add your own templates? <br><br>  Interesting?  GOTO next line. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Initial data:</b> <br>  Ruby on Rails;  Rspec;  will-paginate;  Haml;  Factory-girl <br><br>  <b>Task:</b> <br> <code><b>% rails generate scaffold post post:string</b></code> <br>  Generates: <br><ol><li>  contoller's with will_paginate support, Russian-language messages </li><li>  model's with will_paginate support </li><li>  view's with the content we specified and in haml format </li><li>  Rspec tests, instead of Test :: Unit </li><li>  Factory girl factories instead of standard fixtures </li></ol><br><a name="habracut"></a><br><br>  For a start, briefly about Scaffold.  Scaffold is a built-in generator, by itself it does not generate anything, but it starts up other generators. <br><br>  The current scaffold settings can be checked using: <br> <code><b>% rails g scaffold --help</b></code> <br> <br>  The generators are configured using the file <i>RAILS_ROOT / config / application.rb</i> , inside of which you can set parameters using this design: <br><pre> <code class="ruby hljs">config.generators <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|g|</span></span> <span class="hljs-comment"><span class="hljs-comment">#   end</span></span></code> </pre> <br><h3>  Custom controls </h3><br>  To begin with, we will replace the standard controller pattern with our own. <br>  It is necessary to copy the template from the heme used in the project to the project itself. <br>  The path to the gems of your project can be found in this way: <br> <code><b>RAILS_ROOT% rails console</b> <br> <b>puts $LOAD_PATH</b> <br> ... <br> ... <br> ...        </code> <br> <br>  Copy the controller.rb template from <i>GEMS_PATH / railties [version] / lib / rails / generators / rails / scaffold_controller / templates</i> to <i>RAILS_ROOT / lib / templates / rails / scaffold_controller / controller.rb</i> <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#      controller.rb class &lt;%= controller_class_name %&gt;Controller &lt; ApplicationController # GET &lt;%= route_url %&gt; # GET &lt;%= route_url %&gt;.xml def index @&lt;%= plural_table_name %&gt; = &lt;%= orm_class.all(class_name) %&gt; respond_to do |format| format.html # index.html.erb format.xml { render :xml =&gt; @&lt;%= plural_table_name %&gt; } end end ...</span></span></code> </pre> <br>  We customize it a bit by adding support for the Russian language, padzhinatsiyu and cutting off excess text <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># encoding: UTF-8 class &lt;%= controller_class_name %&gt;Controller &lt; ApplicationController # GET &lt;%= route_url %&gt; def index @&lt;%= plural_table_name %&gt; = &lt;%= class_name %&gt;.paginate :page =&gt; params[:page], :order =&gt; 'id DESC' end ...</span></span></code> </pre> <br>  After working scaffold we get such a pretty code <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># encoding: UTF-8 class PostsController &lt; ApplicationController # GET /posts def index </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@posts</span></span></span><span class="hljs-comment"> = Post.paginate :page =&gt; params[:page], :order =&gt; 'id DESC' end ...</span></span></code> </pre> <br><h3>  Custom models </h3><br>  Copy the template file model.rb with <i>GEMS_PATH / activerecord [version] / lib / rails / generators / active_record / model / templates</i> in <i>RAILS_ROOT / lib / templates / active_record / model / model.rb</i> <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#   model.rb class &lt;%= class_name %&gt; &lt; &lt;%= parent_class_name.classify %&gt; &lt;% attributes.select {|attr| attr.reference? }.each do |attribute| -%&gt; belongs_to :&lt;%= attribute.name %&gt; &lt;% end -%&gt; end</span></span></code> </pre> <br><br>  Add support for the Russian language and 2 parameters for will_paginate <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># encoding: UTF-8 class &lt;%= class_name %&gt; &lt; &lt;%= parent_class_name.classify %&gt; cattr_reader :per_page @</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@per</span></span></span><span class="hljs-comment">_page = 20 &lt;% attributes.select {|attr| attr.reference? }.each do |attribute| -%&gt; belongs_to :&lt;%= attribute.name %&gt; &lt;% end -%&gt; end</span></span></code> </pre> <br><br>  At the output we get: <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment"># encoding: UTF-8 class Post &lt; ActiveRecord::Base cattr_reader :per_page @</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@per</span></span></span><span class="hljs-comment">_page = 20 end</span></span></code> </pre><br><h3>  Custom view </h3><br>  In our example, we use HAML instead of .erb.  How to force Rails to generate not erb, a haml view's? <br>  Very simple, just install the gem "haml-rails". <br>  We finish in Gemfile <br><pre> <code class="ruby hljs">gem <span class="hljs-string"><span class="hljs-string">'haml-rails'</span></span></code> </pre> <br>  And run <i>bundle install</i> <br><br>  Done!  Now the rail generator makes file_name.html.haml files for us <br><br>  Let us turn to our templates.  Copy 5 files (edit.html.haml, _form.html.haml, index.html.haml, new.html.haml, show.html.haml) from <i>GEMS_PATH / haml-rails [version] / lib / generators / haml / scaffold / templates</i> to <i>RAILS_ROOT / lib / templates / haml / scaffold,</i> already loved by us <br><br>  I will not give the code here, it can be viewed on the links below <br><br>  Source Templates - <a href="https://github.com/indirect/haml-rails/tree/master/lib/generators/haml/scaffold/templates">haml-rails</a> <br>  Template after editing - <a href="https://github.com/vltsu/custom_scaffold/tree/master/lib/templates/haml/scaffold">link</a> <br>  Result - <a href="https://github.com/vltsu/custom_scaffold/tree/master/app/views/posts">link</a> <br><br><h3>  RSPEC </h3><br>  As in the case of haml, to replace the standard tests with RSpecs, it is enough to install the gem "rspec-rails". <br><br>  By default, scaffold will create rspec files for testing models, controllers, helpers, views, routing, and queries. <br><br>  Surely you and I don‚Äôt need so many rspec files, fortunately ROR allows us to configure this item. <br><br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#RAILS_ROOT/config/application.rb config.generators do |g| #    rspec   , ,    #..    spec's     g.test_framework :rspec, :view_specs =&gt; false, :helper_specs =&gt; false, :routing_specs =&gt; false, :request_specs =&gt; false end</span></span></code> </pre> <br><h3>  FACTORY GIRL </h3><br>  To add scaffolding for FG, install the gem "rails3-generators" <br>  And add the following line to the config <br><pre> <code class="ruby hljs"><span class="hljs-comment"><span class="hljs-comment">#RAILS_ROOT/config/application.rb config.generators do |g| g.test_framework :rspec, :view_specs =&gt; false, :helper_specs =&gt; false, :routing_specs =&gt; false, :request_specs =&gt; false g.fixture_replacement :factory_girl, :dir =&gt; "spec/factories" end</span></span></code> </pre> <br>  In addition to factory_girls, the rails3-generators gem adds generators for DataMapper, Authlogic, Mongomapper, Shoulda, Formtastic and SimpleForm <br><h3>  What have we got? </h3><br> <code><b>% rails g scaffold final final:string</b></code> <br> <pre>  invoke active_record
       create db / migrate / 20110713193843_create_finals.rb
       create app / models / final.rb
       invoke rspec
       create spec / models / final_spec.rb
       invoke factory_girl
       create spec / factories / finals.rb
        route resources: finals
       invoke scaffold_controller
       create app / controllers / finals_controller.rb
       invoke haml
       create app / views / finals
       create app / views / finals / index.html.haml
       create app / views / finals / edit.html.haml
       create app / views / finals / show.html.haml
       create app / views / finals / new.html.haml
       create app / views / finals / _form.html.haml
       invoke rspec
       create spec / controllers / finals_controller_spec.rb
       invoke helper
       invoke rspec
       invoke helper
       create app / helpers / finals_helper.rb
       invoke rspec
       invoke stylesheets
    identical public / stylesheets / scaffold.css </pre><br>  Own MVC templates;  haml view's;  factory_girl factories;  RSpec's for models and controllers;  built-in padzhination <br><br>  Everything we wanted.  Enjoy)) <br><br><h5>  View full code </h5><br>  <a href="https://github.com/vltsu/custom_scaffold">Github</a> <br><br><h5>  Read </h5><br>  <a href="http://guides.rubyonrails.org/generators.html">Generators manual</a> <br>  <a href="http://paulbarry.com/articles/2010/01/13/customizing-generators-in-rails-3">Paul's Barry Article: Customizing generators in rails 3</a> <br>  <a href="https://github.com/rspec/rspec-rails/issues/35">Rspec generators detail</a> <br>  <a href="http://railscasts.com/episodes/216-generators-in-rails-3">Podcast about generators</a> <br>  <a href="https://github.com/indirect/rails3-generators">rails3-generators gem</a> <br>  <a href="https://github.com/indirect/haml-rails">haml-rails gem</a> </div><p>Source: <a href="https://habr.com/ru/post/123551/">https://habr.com/ru/post/123551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123540/index.html">Closed community of freelancers</a></li>
<li><a href="../123542/index.html">How to get the most benefit from Crash Reports or simplify your life</a></li>
<li><a href="../123546/index.html">Full-text articles from RSS for your reader using Caliber</a></li>
<li><a href="../123549/index.html">Google removed 11 million .co.cc sites from search results</a></li>
<li><a href="../123550/index.html">HTC bought S3 Graphics for $ 300 million</a></li>
<li><a href="../123555/index.html">XGI Technology, the story of an ambitious company</a></li>
<li><a href="../123556/index.html">Beginners self-study tips for Microsoft exams</a></li>
<li><a href="../123559/index.html">Unlimited cloud storage</a></li>
<li><a href="../123560/index.html">HBase + Thrift + PHP</a></li>
<li><a href="../123561/index.html">The method of calculating the coefficient reflecting the quality of the released software product</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>