<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Let's cut off Susanin's foot?" (C)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The overwhelming majority of those working with microcontrollers once faced a difficult choice: 
 - So, on this leg of PWM, on this - button, on these...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Let's cut off Susanin's foot?" (C)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/a63/a6c/6ab/a63a6c6abba42967cd6c100d4ade2fe5.jpg" align="left" alt="image">  The overwhelming majority of those working with microcontrollers once faced a difficult choice: <br>  - So, on this leg of PWM, on this - button, on these - LEDs ... Op-pa ... And the legs are over.  Without LEDs ugly, without buttons non-functional.  We'll have to take the crystal fatter: ( <br>  Or another situation - the board with a microcontroller is hidden from sight, but the wiring harness to the indicator with a sad snake pierces the bowels of the device. <br>  It is time to tame this cable-legged monster by truncating the extra legs, and help us in this. <br><a name="habracut"></a><br>  The ADC is such a simple circuit: <br><img src="https://habrastorage.org/storage2/77b/2da/460/77b2da4604f1b6ed5faf6c18759af754.png"><br>  And now for those interested in a brief principle of operation. <br>  Most of the time the circuit is engaged in the display.  By giving on one leg 1, and on the other 0, we light the corresponding LED.  One combination gives green color, the second red, and if you quickly pull back and forth, you get orange. <br>  With the display sorted out, and now about the buttons.  Suppose that on Port2 we provide a logical 0, and we turn on Port1 as an input for the built-in ADC.  In this case, thanks to the resistor R1, we get some small potential on the LED.  Please note that the green LED is turned on in the forward direction.  As you know, green (and yellow, by the way, too) LEDs have a noticeably greater direct voltage drop than red ones.  In our case, this voltage is quite enough to reliably read the state of the pressed buttons.  When you press any of them, a voltage divider is obtained, and now it is enough just to digitize the received signal and transcode to the button press.  By the way, even if you confuse the polarity of the inclusion of wires - with the correct selection of dividers, the buttons will remain operable, unless the display is messed up.  The choice of resistors R3 and R4 is quite free, the main thing to remember are two rules - a smaller resistor should not interfere with lighting the LEDs, and a larger resistor should give a voltage drop sufficient for reliable detection.  I just put the nominal values ‚Äã‚Äãon the diagram from those that were lying around at hand, and then I simply registered the resulting voltages in the program.  R2 - current-limiting, selected on the basis of the LEDs used and the parameters of the legs of the microcontroller, sometimes you can do without it at all. <br><br>  And now the actual library to work with this scheme.  In this particular case, ATMega48 was used as a platform, but I tried to write the code as iron-independent as possible, and to switch to another crystal, it is enough to change the initialization of the port and the ADC. <br><pre><code class="hljs cs"><span class="hljs-comment"><span class="hljs-comment">/* * biwire.h */</span></span> <span class="hljs-meta"><span class="hljs-meta">#ifndef BIWIRE_H_ #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BIWIRE_H_ // Define connections (PORTC only!) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BWPORT1 1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> BWPORT2 2 // Set pin functions #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> ADCPORT BWPORT1 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> GNDPORT BWPORT2</span></span></code> </pre>  If suddenly you had one extra leg, then it is quite possible to use its pull-up in this place instead of the resistor R1 <br><pre> <code class="hljs pgsql">// State <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> interrupt <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> #define ADC_SET <span class="hljs-number"><span class="hljs-number">0x01</span></span> #define ADC_WAIT <span class="hljs-number"><span class="hljs-number">0x02</span></span> // LED flashing frequency (<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> parrots, <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> small wing) #define SCAN_FREQ <span class="hljs-number"><span class="hljs-number">48</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">Work</span></span> together <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> SCAN_FREQ <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> orange color #define MAX_COLOR_MIX <span class="hljs-number"><span class="hljs-number">50</span></span> // Event bits <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> scan complete // Main keyboard event indicator - must be cleared <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> handle #define BW_EVENT <span class="hljs-number"><span class="hljs-number">0x80</span></span> // Button pressed #define BW_EVBT1 <span class="hljs-number"><span class="hljs-number">0x01</span></span> #define BW_EVBT2 <span class="hljs-number"><span class="hljs-number">0x02</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> additional flags here, <span class="hljs-keyword"><span class="hljs-keyword">like</span></span> BW_EVBT3=<span class="hljs-number"><span class="hljs-number">0x04</span></span> // EVFIN - event "Indication finished" #define BW_EVFIN <span class="hljs-number"><span class="hljs-number">0x10</span></span> // Button released #define BW_EVOPN <span class="hljs-number"><span class="hljs-number">0x20</span></span> // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> button holds more than BW_LONG_PRESS cycles #define BW_EVLNG <span class="hljs-number"><span class="hljs-number">0x40</span></span> // How long we wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-string"><span class="hljs-string">'LongPress'</span></span> #define BW_LONG_PRESS <span class="hljs-number"><span class="hljs-number">10</span></span></code> </pre>  Here you can write approximate values ‚Äã‚Äãplus or minus bus stop.  The main thing for us is to set boundaries for the precise definition of buttons. <br><pre> <code class="hljs pgsql">// ADC compare <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> #define BW_VBTN1 <span class="hljs-number"><span class="hljs-number">0x1F</span></span> #define BW_VBTN2 <span class="hljs-number"><span class="hljs-number">0xFE</span></span> // Define names <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> signal <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> enum SignalNames { LedOff = <span class="hljs-number"><span class="hljs-number">0</span></span>, OneGreen = <span class="hljs-number"><span class="hljs-number">1</span></span>, OneRed = <span class="hljs-number"><span class="hljs-number">2</span></span>, OneOrange = <span class="hljs-number"><span class="hljs-number">3</span></span>, TwoGreen = <span class="hljs-number"><span class="hljs-number">4</span></span>, TwoRed = <span class="hljs-number"><span class="hljs-number">5</span></span>, Alarm = <span class="hljs-number"><span class="hljs-number">6</span></span>, OrangeRG = <span class="hljs-number"><span class="hljs-number">7</span></span></code> </pre>  Similarly, add your signals to taste <br><pre> <code class="hljs pgsql">}; // ====== Externals ======= // LED <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> indicate extern <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> enum SignalNames BwIndicate; // Data about button events extern <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t BwButton; // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> - delay <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> led indication, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> switch LED <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> extern <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t BwLedDelay; // <span class="hljs-keyword"><span class="hljs-keyword">Call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> <span class="hljs-keyword"><span class="hljs-keyword">start</span></span> <span class="hljs-type"><span class="hljs-type">void</span></span> biwire_init(<span class="hljs-type"><span class="hljs-type">void</span></span>); #endif <span class="hljs-comment"><span class="hljs-comment">/* BIWIRE_H_ */</span></span></code> </pre><br>  <a href="http://pastebin.com/download.php%3Fi%3D6JM6adPe">Download .h</a> <br>  Well, the source itself: <br><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/* * biwire.c */</span></span> #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;avr/io.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;avr/interrupt.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> &lt;stdint.h&gt; #<span class="hljs-keyword"><span class="hljs-keyword">include</span></span> "biwire.h" // Led blink matrix. <span class="hljs-keyword"><span class="hljs-keyword">Only</span></span> upper <span class="hljs-number"><span class="hljs-number">6</span></span> bits used <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> indication <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> static uint8_t bwsignalsR[] = { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>,<span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0xFC</span></span> }; static uint8_t bwsignalsG[] = { <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span>,<span class="hljs-number"><span class="hljs-number">0xA0</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x50</span></span>, <span class="hljs-number"><span class="hljs-number">0xC0</span></span> }; // LED <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> indicate <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> enum SignalNames BwIndicate; // FSM <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sequence</span></span> counter static <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t BwState; // "LongPress" counter static <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t btn_cnt; // Data about button events <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t BwButton; // Orange color created <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> mixing green <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> red static <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t color_mix; // <span class="hljs-keyword"><span class="hljs-keyword">If</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> - delay <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> led indication, <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> switch LED <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> uint8_t BwLedDelay; <span class="hljs-type"><span class="hljs-type">void</span></span> biwire_init(<span class="hljs-type"><span class="hljs-type">void</span></span>) { // Timer interrupt TCCR0B = _BV(CS00) | _BV(CS01) | _BV(WGM02); // use CLK/<span class="hljs-number"><span class="hljs-number">64</span></span> prescale <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>, clear timer/counter <span class="hljs-keyword"><span class="hljs-keyword">on</span></span> compareA match OCR0A = SCAN_FREQ; // preset timer0 OCR byte TIMSK0 = _BV(OCIE0A); // <span class="hljs-keyword"><span class="hljs-keyword">enable</span></span> Output Compare <span class="hljs-number"><span class="hljs-number">0</span></span> overflow interrupt // PIN init DDRC |= _BV(BWPORT1) | _BV(BWPORT2); // ADC init ADCSRA = _BV(ADEN) | _BV(ADPS2); // Activate ADC <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> Prescaler <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-comment"><span class="hljs-comment">--&gt; 1Mhz/16 = 62.5kHz ADMUX = ADCPORT | _BV(REFS0) | _BV(REFS1) | _BV(ADLAR); // Select input pin using MUX, left adjust and Internal reference</span></span></code> </pre>  Atmel's internal reference is just 1.1 volts, which in the absence of pressed buttons gives a reliable and impenetrable 0xFF at the ADC output. <br><pre> <code class="hljs pgsql"> DIDR0 = _BV(ADCPORT); // <span class="hljs-keyword"><span class="hljs-keyword">disable</span></span> digital <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ADC // <span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> initial state <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> bw BwState = ADC_SET; BwIndicate = OneGreen; BwButton = BW_EVOPN; color_mix = <span class="hljs-number"><span class="hljs-number">0</span></span>; BwLedDelay = <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre>  Timer interruption can be customized to your liking.  Playing dividers and color_mix you can select the speed of the flash and the reaction time at the touch of a button. <br><pre> <code class="hljs pgsql">SIGNAL (SIG_OUTPUT_COMPARE0A) // <span class="hljs-keyword"><span class="hljs-keyword">handler</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Output Compare <span class="hljs-number"><span class="hljs-number">0</span></span> overflow interrupt { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwState&amp;ADC_SET) { // <span class="hljs-keyword"><span class="hljs-keyword">Prepare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> keyscan PORTC &amp;= ~_BV(GNDPORT); DDRC &amp;= ~_BV(ADCPORT); ADCSRA |= _BV(ADSC); //<span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> <span class="hljs-keyword"><span class="hljs-keyword">conversion</span></span> BwState = ADC_WAIT; color_mix = MAX_COLOR_MIX; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwLedDelay) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(<span class="hljs-comment"><span class="hljs-comment">--BwLedDelay)) { BwIndicate = LedOff; BwButton |= BW_EVFIN; } } else { if (BwState&amp;ADC_WAIT) { // Check if ADC complete if (ADCSRA &amp; _BV(ADSC) ) return; // Wait another tick PORTB = ADCH; if (ADCH &gt; BW_VBTN2) { // Both buttons open if (BwButton &amp; (BW_EVBT1|BW_EVBT2)) { BwButton = BW_EVENT + BW_EVOPN; btn_cnt = 0; } } else if (ADCH &gt; BW_VBTN1) { // Button 2 pressed PORTB ^= 0xff; if (BwButton &amp; (BW_EVBT1|BW_EVOPN)) { BwButton = BW_EVENT + BW_EVBT2; btn_cnt = 1; }</span></span></code> </pre>  Similarly, you can determine the range for the third and all subsequent buttons, but with accuracy of operation you will have to tinker <br><pre> <code class="hljs pgsql"> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { // Button <span class="hljs-number"><span class="hljs-number">1</span></span> pressed. <span class="hljs-keyword"><span class="hljs-keyword">Add</span></span> compare <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> here <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you need more than <span class="hljs-number"><span class="hljs-number">2</span></span> buttons <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwButton &amp; (BW_EVBT2|BW_EVOPN)) { BwButton = BW_EVENT + BW_EVBT1; btn_cnt = <span class="hljs-number"><span class="hljs-number">1</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (btn_cnt) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(++btn_cnt &gt; BW_LONG_PRESS) { // <span class="hljs-built_in"><span class="hljs-built_in">New</span></span> event - long press BwButton |= BW_EVENT + BW_EVLNG; btn_cnt = <span class="hljs-number"><span class="hljs-number">0</span></span>; } } // Cleanup <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(BwButton&amp;(BW_EVBT1|BW_EVBT2|BW_EVOPN))) BwButton = BW_EVOPN; }</code> </pre>  If you don‚Äôt skip through the ADC_WAIT state here, then you can add the seventh bit to the LED blinking cycle.  But I have six bits enough.  And for a sixteen-bit BwState, you can make a crazy disco in general from LEDs. <br><pre> <code class="hljs ruby"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (color_mix++ &gt; MAX_COLOR_MIX) { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> Get <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> state (LED sequence) BwState = (BwState <span class="hljs-meta"><span class="hljs-meta">&gt;&gt; </span></span><span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-params"><span class="hljs-params">| (BwState &lt;&lt; 1); // rotate left, replace by _asm to compact code // Indicate DDRC |</span></span>= _BV(ADCPORT); PORTC &amp;= ~(_BV(GNDPORT)<span class="hljs-params"><span class="hljs-params">|_BV(ADCPORT)); </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span><span class="hljs-params">(bwsignalsR[BwIndicate]&amp;BwState) PORTC |</span></span>= _BV(BWPORT2); if((bwsignalsG[BwIndicate]&amp;BwState) &amp;&amp; (!(bwsignalsR[BwIndicate]&amp;BwState)) ) PORTC <span class="hljs-params"><span class="hljs-params">|= _BV(BWPORT1); color_mix = 0; } </span><span class="hljs-keyword"><span class="hljs-params"><span class="hljs-keyword">if</span></span></span><span class="hljs-params">((bwsignalsR[BwIndicate]&amp;BwState) &amp;&amp; (bwsignalsG[BwIndicate]&amp;BwState)){ PORTC ^= (_BV(BWPORT1) |</span></span> _BV(BWPORT2)); } } }</code> </pre><br>  <a href="http://pastebin.com/download.php%3Fi%3DMdvEJFsX">Download .c</a> <br><br>  That's all.  Paste this code into your sources and save wires and legs.  Of the minuses - perhaps a somewhat "stupid" reaction to the button, but you get used to it quickly. <br>  You can also add a third array after bwsignalsR / bwsignalsG, for example bwsignalsB, and use it to make dimming for smooth on-off.  I will leave it to you as a homework :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Oh yeah, I almost forgot.  Example of working with the library: <br><pre> <code class="hljs lua">#include <span class="hljs-string"><span class="hljs-string">"biwire.h"</span></span> int main(void) { biwire_init(); sei(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( BwButton &amp; BW_EVENT ) { BwButton &amp;= ~BW_EVENT; // Clear event flag <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwButton &amp; BW_EVLNG) { BwIndicate = OrangeRG; BwLedDelay = <span class="hljs-number"><span class="hljs-number">5</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwButton &amp; BW_EVOPN) { //BwIndicate = LedOff; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwButton &amp; BW_EVBT1) { BwIndicate = OneRed; BwLedDelay = <span class="hljs-number"><span class="hljs-number">5</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (BwButton &amp; BW_EVBT2) { BwIndicate = OneGreen; BwLedDelay = <span class="hljs-number"><span class="hljs-number">5</span></span>; } } } }</code> </pre><br><br>  PS: Strange, is something vaguely remembered to me that in the old engine it was possible to directly paste source files from PasteBin?  Why was such a good opportunity removed?  Or am I confusing something? </div><p>Source: <a href="https://habr.com/ru/post/141696/">https://habr.com/ru/post/141696/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../141691/index.html">Practical use of a thermistor with Arduino</a></li>
<li><a href="../141692/index.html">What part of your life does a computer take?</a></li>
<li><a href="../141693/index.html">EnerGenie EG-PMS-LAN Surge Protector with LAN</a></li>
<li><a href="../141694/index.html">IPTV head station</a></li>
<li><a href="../141695/index.html">Yii discrete projects based on a common core</a></li>
<li><a href="../141697/index.html">Will interstellar travel become a reality? Orientation problem</a></li>
<li><a href="../141698/index.html">Shellcodes, exploits ... Tulsa under Win</a></li>
<li><a href="../141699/index.html">Identify all the classes that the Java application uses.</a></li>
<li><a href="../141701/index.html">Creating Windows 8 and IE10 - a selection of materials for March'12</a></li>
<li><a href="../141702/index.html">The art of negotiation is just business, nothing personal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>