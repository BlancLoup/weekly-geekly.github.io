<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How i taught the arab sheikhs sap sap</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Women in veils, men in traditional Arab robes, carved walls and lots and lots of gilding, and all this inside a huge wooden ship. This is what the Kuw...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How i taught the arab sheikhs sap sap</h1><div class="post__text post__text-html js-mediator-article">  Women in veils, men in traditional Arab robes, carved walls and lots and lots of gilding, and all this inside a huge wooden ship.  This is what the <a href="http://www.promediakw.com/2012/infosec/">Kuwait Info Security</a> Information Security Conference <a href="http://www.promediakw.com/2012/infosec/">2012</a> looks like. <br><br><img src="https://habrastorage.org/storage2/340/a95/df2/340a95df29430b0558a82e915c858b3b.jpg"><br><br>  On duty in Digital Security, promoting the security of SAP to the masses, and indeed for the sake of high points and new acquaintances, I occasionally speak at various international security conferences ... although it would be more accurate to call them conferences on danger, since the leading researchers talk about new interesting ways to hack information systems.  Despite two dozen speeches at events like BlackHat and HITB, I still remember the conference in Kuwait as one of the most unusual. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><img src="https://habrastorage.org/storage2/9b9/33a/35a/9b933a35a31d4f5e46123ff7bb9b0acd.jpg"><br><br>  <b>ÿßŸáÿ™ŸÖÿßŸÖ!</b> <br>  <u><b>Who is interested in reading only the technical details of the SAP vulnerabilities - for you this information is kindly in italics and cleared of the author's emotional experiences during the trip.</b></u>  <u><b>An example of SAP hacked video is available at the end of the article.</b></u> <br><br>  Frankly, I initially had little idea where I belonged, and joked that I would go to teach Arabs cyberterrorism.  As it turned out later, Kuwait, though an Arab country, is not poor enough, if not to say the opposite.  Having about 10% of world oil reserves, the country exists at the expense of its production, which is, according to various sources, from 90 to 98% of exports (by the way, it‚Äôs a huge question for me what is the remaining 2%). <br><br><img src="https://habrastorage.org/storage2/cf5/4c5/ba5/cf54c5ba5fb16d11bb24ffdf54825316.jpg"><br><br>  There are about 1 million indigenous people in the country to whom this wealth is actually distributed.  In addition to the indigenous population, there are also about 3.5 million immigrants in Kuwait - mostly Indians and Asians.  So to communicate in shops, hotels, restaurants and in general everywhere, as a rule, it is necessary with Hindus: Arabs have succeeded in their life, and they don‚Äôt want to work. <br><br>  So, the May holidays I had to spend in a country where alcohol is not even in the Duty Free, which for many would be a fatal blow, but I was not a bit upset.  Having spent 2 days in Kuwait and having traveled from Saudi Arabia to the very border with Iraq (I‚Äôm not as cool as Tema to go there), <br><img src="https://habrastorage.org/storage2/13b/f27/3a3/13bf273a3ae686dd097e56a12faa1c63.jpg"><br><br>  After watching the oil rigs and endless construction projects, I went to the hotel where the conference was held. <br><br>  At first it seemed that the hotel was not even completed, and all this is some kind of joke - in fact, how could a conference take place here in the middle of the desert? .. Nevertheless, a huge wooden ship moored to the shore (by the way, the ship is listed in the Guinness Book of Records as the world's largest wooden ship).  He was the hotel, or rather, the conference hall in which the event took place. <br><br><img src="https://habrastorage.org/storage2/a42/0c8/ad9/a420c8ad9933b09e9b2fbeb40ef077df.jpg"><br><br><br>  The hall was equipped not with boring rows of chairs, as at any other conference, but with round tables at which local sheikhs sat down and a separate throne-bench at the place of the first rows.  Before the start there were about five minutes, I was tormented only by one thought: <br><br><img src="https://habrastorage.org/storage2/227/c4d/cf5/227c4dcf5891cefdca2e6df5044d89f9.jpg"><br><br>  <i>... is this really the place where I have to talk about buffer overflow in the SAP NetWeaver application‚Äôs nuclear function and then exploit this overflow through a transaction call, through which a vulnerable report must be run, which calls the kernel module and sends 108 bytes to overwrite EIP and about 100 for shellcode, and how difficult it was to stuff it, given that the size of the input value is limited to 255 bytes ...</i> <br><br>  And then my thoughts were interrupted by the general bustle, everyone fled somewhere.  I realized that it seemed like the most important sheikh had come for whom the place on the first bench was cleared.  After all the media representatives who had gathered, finished photographing him, he went to the stage and ... no, did not begin to read keynote, as it would be logical to assume taking into account the subject matter of the conference, but began to pray. <br><br>  <i>.... At this time, thoughts were bothering again in my head: would you like to go to the room and redo the presentation, throwing everything out and leaving only 3 pictures a la: oil, terrorist, ERPScan ... No, really, what is the refusal in service, they imagine, and, perhaps, better than I, which means a denial of service vulnerability in the SAP NetWeaver ABAP WEB interface, which occurs when processing the XML request for the WEBRFC service, can be explained.</i>  <i>Well, in fact, everything is simple there: there is a web application interface that any user of the system has access to, as well as an attacker who was not too lazy to search the Internet for a <a href="http://dsecrg.blogspot.com/2010/11/sap-aapplication-server-security.html">list of</a> SAP users and passwords by default.</i>  <i>There are many RFC-functions that allow you to do various actions in the system, but require additional rights, and there is a function RFC_PING, which does not require any rights.</i>  <i>The XML parser, in turn, as my colleague <a href="http://habrahabr.ru/users/d00kie/" class="user_link">d00kie</a> discovered long ago, is written by Indians, in a sense, has a vulnerability called XML Entity Expansion and XML Blowup (examples below).</i>  <i>It lies in the fact that inside the XML package we form a set of recursive calls to variables defined in the ENTITY tag, which causes the XML parser to mercilessly eat system resources.</i>  <i>Thus, having sent hundreds of requests, you can easily ‚Äúput in‚Äù a server with SAP, and all business processes of the company will be covered with a copper basin for the duration of the attack ....</i> <br><br><pre><code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE root [ &lt;!ENTITY ha "Ha !"&gt; &lt;!ENTITY ha2 "&amp;ha; &amp;ha;"&gt; &lt;!ENTITY ha3 "&amp;ha2; &amp;ha2;"&gt; &lt;!ENTITY ha4 "&amp;ha3; &amp;ha3;"&gt; &lt;!ENTITY ha5 "&amp;ha4; &amp;ha4;"&gt; ... &lt;!ENTITY ha128 "&amp;ha127; &amp;ha127;"&gt; ]&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;ha128;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0"?&gt;</span></span> <span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE foobar [&lt;!ENTITY x "AAAAA‚Ä¶ [100KB of them] ‚Ä¶ AAAA"&gt;</span></span>]&gt; <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hi</span></span></span><span class="hljs-tag">&gt;</span></span>&amp;x;&amp;x;‚Ä¶.[30000 of them] ‚Ä¶ &amp;x;&amp;x;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hi</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">root</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  The introductory word ended, and the reports from Qualys and Symantec began on the security of your cloud and the trends in information security, which traditionally included mobility, cloud and industrial networks, which I had already heard enough, and therefore went to the exhibition hall, where I met colleagues from ELCOMSOFT companies, which also decided to take part in this conference.  Special thanks to them for the nice company and pictures. <br><br><img src="https://habrastorage.org/storage2/07e/3e5/868/07e3e5868eb4f851b4623ed63fc503d5.jpg"><br><br>  Soon, Andrei Belenko‚Äôs report was due to start - I decided to listen to him and look at the reaction of the audience, as he traditionally had enough technical reports, and there was a great opportunity to understand how to build a speech and what to focus on. <br><br>  <i>... Excellent, I thought: Andrey's report was about passwords and encryption algorithms, and this is what I need, I have one of the vulnerabilities in SAP dedicated to encryption.</i>  <i>The trick is that the SAP GUI application - in fact, the main client utility for connecting to SAP - allows you to store passwords in shortcuts.</i>  <i>This function is prohibited by default in new versions, but you yourself understand: when it is necessary for an accountant to make it convenient, often passwords are prescribed in these labels, which I have often found during audits.</i>  <i>Naturally, passwords are not stored there in clear text - they are encrypted.</i>  <i>Although "encrypted" - it says loudly: for such encryption, Diffi and Hellman would have awarded the author with the Order of Facepalm in a cube.</i>  <i>Not that Caesar's cipher, but, in general, practically he.</i>  <i>XOR was used for encryption.</i>  <i>With a static key.</i>  <i>The key is the same for all installations of all versions ... In general, a notable FAIL, and most importantly, no one will fix it, since SAP considered that this was not a vulnerability.</i>  <i>Well, if it's not a bug, it means a feature, so let everyone know if you suddenly need to decrypt the ‚Äúforgotten‚Äù password.</i>  <i>By the way, getting access to the workstation itself is also not labor, and this can be implemented through the ActiveX-vulnerabilities of the SAP GUI, which I have <a href="http://erpscan.com/publications/sap-security-attacking-sap-clients/">talked about for a</a> long time, or with, for example, Teensy USB, which you can read about in my <a href="http://habrahabr.ru/company/dsec/blog/141838/">colleague‚Äôs</a> article.</i> <br><br>  Actually, more than the first day I didn‚Äôt remember anything, and I was slightly cheered about the fact that the students seemed to be rather well-versed in my area, although they look unusual.  The next day, the reports were more technical, and from one even managed to draw a couple of interesting thoughts.  While I was sitting in the hall, I realized that the Kuwaitis are generally strange people.  The passion to stand out among them is no less developed than that of the Russians, and many look and behave like children who have inherited their grandmother‚Äôs inheritance, and they really do not know what to do with it properly.  So, for example, almost every self-respecting Kuwaiti has 2 smartphones, often 2 iPhones - black and white.  Well, they can not decide which is cooler, so just in case they wear two. <br><br>  So time flew by, and the report began, let's say, of SAP security colleagues, who talked about GRC and the issues of separation of powers.  Actually, to this area, unfortunately, the majority equates the security of SAP, although since the company SAP has closed its two thousandth software vulnerability (and 80% of these 2000 were closed in the last 3 years), the opinion that the security of SAP is this is only a separation of powers, it looks especially strange.  However, I think, on this subject I will somehow break apart a separate post. <br><br>  <i>... After this report, I became even more bored because, first, the students were clearly at least aware of what SAP is, and they are minimally familiar with what SAP consists of, and even understood that there are problems security, at a minimum, concerning the separation of powers.</i>  <i>And therefore you can tell them that there are many other problems - for example, the internal language of ABAP, in which the programs are written in the SAP system.</i>  <i>He, like many other languages, may contain vulnerabilities and indeed contains them.</i>  <i>All the same SQL injections, directory traversal when accessing the file system, ABAP code injections, cross-site scripting, if we are talking about BSP (these are web scripts written in a mixture of ABAP and HTML), and other problems, as well as many unique vulnerabilities inherent in code developed by ABAP.</i>  <i>One of the interesting vulnerabilities that we found in SAP, which is common in WEB applications and is known to everyone else from CGI scripts, is called ‚ÄúOS command injection‚Äù.</i>  <i>The logic here is the same: in ABAP there are kernel calls that allow you to call OS commands.</i>  <i>Sometimes the parameters in these calls get from the user and are not filtered.</i>  <i>Thus, using the ‚Äú&amp;‚Äù symbol that separates commands in Windows, you can add your own to the called command, for example: ‚Äúnet user hacker QWERTY / add‚Äù - thereby creating a new account in the OS</i> . <br><br>  Detailed demo, how to log in with user EARLYWATCH and password support and execute OS command, look at the video. <br><br><iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/hBpfrvmw3vk%3Ffeature%3Doembed&amp;xid=17259,15700022,15700043,15700186,15700191,15700253,15700255,15700259&amp;usg=ALkJrhhD6pU4VQ73PNhpUmSlw-1DrUKQXA" frameborder="0" allowfullscreen=""></iframe><br><br>  As a result, having told my entire report ‚ÄúTOP 10 of the most interesting SAP vulnerabilities‚Äù, I received quite positive reviews and laughter from the audience over especially funny vulnerabilities. <br><br><img src="https://habrastorage.org/storage2/e18/2ed/bef/e182edbef0ca72ce911488d408875466.jpg"><br><br>  I will consider other vulnerabilities in more detail in the following posts.  Everything related to SAP security is also available on the project website erpscan.com /erpscan.ru in the sections of research and publications. <br><br>  In general, Kuwait, of course, is not a tourist country, and people who are used to excursions and proper service are unlikely to appreciate this place, and even more so want to return, but, nevertheless, the rudiments of the United Arab Emirates and Dubai are present there.  You see, after 5 years, Kuwait can become the second Dubai, but for now - the houses are not completed, the water is dirty, the food is American, there is no alcohol even in Duty Free, but very friendly people, unique types of desert, Arabic flavor and just unbanal place. </div><p>Source: <a href="https://habr.com/ru/post/144383/">https://habr.com/ru/post/144383/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144375/index.html">80% of mobile banking applications have vulnerabilities</a></li>
<li><a href="../144377/index.html">Stringer Java Obfuscation Toolkit: Protecting Java and Android Applications</a></li>
<li><a href="../144379/index.html">The answer is before the question</a></li>
<li><a href="../144380/index.html">Google Maps Updates for Russia</a></li>
<li><a href="../144382/index.html">Yandex launched a system for displaying facts and figures in search tips</a></li>
<li><a href="../144384/index.html">Myths about the protection of personal data in the cloud</a></li>
<li><a href="../144385/index.html">Knut - wireless sensors for home or office</a></li>
<li><a href="../144386/index.html">Putting the vigilance of users to notice Vkontakte</a></li>
<li><a href="../144387/index.html">The application Mamba Hiring: IT-specialists need to look for IT-methods</a></li>
<li><a href="../144388/index.html">How and why to measure FLOPS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>