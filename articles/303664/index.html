<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are looking for anomalies in the X-Ray Engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="X-Ray Engine is a game engine that is used in STALKER games on September 16, 2014. Its source code was made publicly available, and since then fans ha...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are looking for anomalies in the X-Ray Engine</h1><div class="post__text post__text-html js-mediator-article">  X-Ray Engine is a game engine that is used in STALKER games on September 16, 2014. Its source code was made publicly available, and since then fans have been developing it.  The large size of the project, a huge number of bugs in the games - all this has an excellent demonstration of the capabilities of the PVS-Studio static code analyzer. <br><br><img src="https://habrastorage.org/files/f4c/a0c/326/f4ca0c3264c4438e932d860eb33d310d.png"><br><a name="habracut"></a><br><br><h2>  Introduction </h2><br>  X-Ray was created by the Ukrainian company GSC GameWorld for the game STALKER: Shadow of Chernobyl.  The engine includes a render with support for DirectX 8.1 / 9.0c / 10 / 10.1 / 11, physical and sound engines, multiplayer and A-Life artificial intelligence system.  Subsequently, the company created the version 2.0 engine for its new game, but development was discontinued and the source codes leaked to the network. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project, along with all its dependencies, is easily assembled in Visual Studio 2015. For verification, we used the source code of the 1.6 engine from the <a href="https://github.com/OpenXRay/xray-16">repository on GitHub</a> and the PVS-Studio 6.04 static code analyzer, which can be downloaded by <a href="http://www.viva64.com/en/pvs-studio-download/">reference</a> . <br><br><h2>  Copy-paste </h2><br>  To begin, consider the errors associated with copying code.  The scenario of their occurrence in different cases is usually similar: they copied the code, changed some of the variables, and forgot a few.  Such errors can quickly spread through the code base, and it is very easy to skip them without a static analyzer. <br><br><img src="https://habrastorage.org/files/247/e8a/b67/247e8ab67c7946fa96ba8aa99758e15e.png"><br><br><pre><code class="cpp hljs">MxMatrix&amp; MxQuadric::homogeneous(MxMatrix&amp; H) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i, j; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;A.dim(); i++) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;A.dim(); i++) H(i,j) = A(i,j); .... }</code> </pre> <br>  <b>PVS-Studio warning</b> : <a href="http://www.viva64.com/ru/d/0122/">V533</a> It is likely that a variable is being increased inside the 'for' operator.  Consider reviewing 'i'.  mxqmetric.cpp 76 <br><br>  The analyzer found that in the nested <i>for</i> loop, the variable <i>i is</i> incremented, and the variable <i>j is</i> checked, which leads to an infinite loop.  Most likely, when copying it they simply forgot to change it. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CBaseMonster::settings_read(CInifile <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> * ini, LPCSTR section, SMonsterSettings &amp;data) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ini-&gt;line_exist(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_base"</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(ini-&gt;r_string(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_base"</span></span>), <span class="hljs-string"><span class="hljs-string">"%f,%f,%f"</span></span>, &amp;data.m_attack_effector.ppi.color_base.r, &amp;data.m_attack_effector.ppi.color_base.g, &amp;data.m_attack_effector.ppi.color_base.b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ini-&gt;line_exist(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_base"</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(ini-&gt;r_string(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_gray"</span></span>), <span class="hljs-string"><span class="hljs-string">"%f,%f,%f"</span></span>, &amp;data.m_attack_effector.ppi.color_gray.r, &amp;data.m_attack_effector.ppi.color_gray.g, &amp;data.m_attack_effector.ppi.color_gray.b); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ini-&gt;line_exist(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_base"</span></span>)) <span class="hljs-built_in"><span class="hljs-built_in">sscanf</span></span>(ini-&gt;r_string(ppi_section,<span class="hljs-string"><span class="hljs-string">"color_add"</span></span>), <span class="hljs-string"><span class="hljs-string">"%f,%f,%f"</span></span>, &amp;data.m_attack_effector.ppi.color_add.r, &amp;data.m_attack_effector.ppi.color_add.g, &amp;data.m_attack_effector.ppi.color_add.b); .... }</code> </pre> <br>  <b>PVS-Studio warnings</b> : <ul><li>  <a href="http://www.viva64.com/ru/d/0183/">V581</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 445, 447. base_monster_startup.cpp 447 </li><li>  <a href="http://www.viva64.com/ru/d/0183/">V581</a> The conditional expressions of the 'if' are located alongside each other are identical.  Check lines: 447, 449. base_monster_startup.cpp 449 </li></ul><br>  In this fragment, several identical conditional expressions are used in succession.  Obviously, it is necessary to replace <i>color_base</i> with <i>color_gray</i> and <i>color_add</i> in accordance with the code in the <i>if</i> branch body <i>.</i> <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* process a single statement */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ProcessStatement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *buff, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> len)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(buff,<span class="hljs-string"><span class="hljs-string">"\\pauthr\\"</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ProcessPlayerAuth(buff, len); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(buff,<span class="hljs-string"><span class="hljs-string">"\\getpidr\\"</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ProcessGetPid(buff, len); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(buff,<span class="hljs-string"><span class="hljs-string">"\\getpidr\\"</span></span>,<span class="hljs-number"><span class="hljs-number">9</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ProcessGetPid(buff, len); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(buff,<span class="hljs-string"><span class="hljs-string">"\\getpdr\\"</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ProcessGetData(buff, len); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(buff,<span class="hljs-string"><span class="hljs-string">"\\setpdr\\"</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) { ProcessSetData(buff, len); } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0106/">warning</a> : <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 1502, 1505. gstats.c 1502 <br><br>  As in the previous example, two identical conditions are used here ( <i>strncmp (buff, "\\ getpidr \\", 9) == 0</i> ).  It is difficult to say for sure whether this is an error or just an unreachable code, but you should definitely pay attention to this.  It is possible that there should be blocks with <i>getpidr</i> / <i>setpidr</i> by analogy with <i>getpdr</i> / <i>setpdr</i> . <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RGBAMipMappedCubeMap</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> height() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cubeFaces[<span class="hljs-number"><span class="hljs-number">0</span></span>].height(); } <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> width() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cubeFaces[<span class="hljs-number"><span class="hljs-number">0</span></span>].height(); } .... };</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0113/">warning</a> : <a href="http://www.viva64.com/ru/d/0113/">V524</a> It‚Äôs odd that it‚Äôs a function of the body‚Äôs width.  tpixel.h 1090 <br><br>  The <i>height ()</i> and <i>width ()</i> methods have the same body.  Given that the dimensions of the faces of the cube are calculated, perhaps there is no error here.  But it is better to rewrite the <i>width ()</i> method as follows: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> width() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cubeFaces[<span class="hljs-number"><span class="hljs-number">0</span></span>].width(); }</code> </pre> <br><h2>  Incorrect use of C ++ </h2><br>  C ++ is a wonderful language that gives a programmer many opportunities ... to shoot yourself a leg in a particularly cruel way.  Indefinite behavior, memory leaks and, of course, typos - errors of this kind will be discussed in the current section. <br><br><img src="https://habrastorage.org/files/e4d/940/d94/e4d940d94d4e462db160b11be9ab31b6.png"><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">matrix33</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> _matrix33&lt;T&gt;Self; <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> Self&amp; SelfRef; .... <span class="hljs-function"><span class="hljs-function">IC SelfRef </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sMTxV</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Tvector&amp; R, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> s1, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Tvector&amp; V1)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ Rx = s1*(m[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] * V1.x + m[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] * V1.y + m[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] * V1.z); Ry = s1*(m[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] * V1.x + m[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] * V1.y + m[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>] * V1.z); Rz = s1*(m[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] * V1.x + m[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] * V1.y + m[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">2</span></span>] * V1.z); } .... }</code> </pre><br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0195/">warning</a> : <a href="http://www.viva64.com/ru/d/0195/">V591</a> Non-void function should return a value.  _matrix33.h 435 <br><br>  At the end of the method skipped <i>return * this</i> .  By standard, this code will lead to undefined behavior.  Since the return value is a reference, it is likely to cause the program to crash when trying to access the return value. <br><pre> <code class="cpp hljs">ETOOLS_API <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> __<span class="hljs-function"><span class="hljs-function">stdcall </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ogg_enc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... FILE *in, *out = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... input_format *format; .... in = fopen(in_fn, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(in == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; format = open_audio_file(in, &amp;enc_opts); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!format){ fclose(in); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }; out = fopen(out_fn, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(out == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>){ fclose(out); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0175/">warning</a> : <a href="http://www.viva64.com/ru/d/0175/">V575</a> The null pointer is passed into the 'fclose' function.  Inspect the first argument.  ogg_enc.cpp 47 <br><br>  Quite an interesting example.  The analyzer detected that the argument in the <i>fclose</i> call is <i>nullptr</i> , which makes the function call meaningless.  It can be assumed that they should have closed the in stream <i>.</i> <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> NVI_Image::ABGR8_To_ARGB8() { <span class="hljs-comment"><span class="hljs-comment">// swaps RGB for all pixels assert(IsDataValid()); assert(GetBytesPerPixel() == 4); UINT hxw = GetNumPixels(); for (UINT i = 0; i &lt; hxw; i++) { DWORD col; GetPixel_ARGB8(&amp;col, i); DWORD a = (col &gt;&gt; 24) &amp;&amp; 0x000000FF; DWORD b = (col &gt;&gt; 16) &amp;&amp; 0x000000FF; DWORD g = (col &gt;&gt; 8) &amp;&amp; 0x000000FF; DWORD r = (col &gt;&gt; 0) &amp;&amp; 0x000000FF; col = (a &lt;&lt; 24) | (r &lt;&lt; 16) | (g &lt;&lt; 8) | b; SetPixel_ARGB8(i, col); } }</span></span></code> </pre> <br>  <b>PVS-Studio warnings:</b> <ul><li>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true: 0x000000FF.  nvi_image.cpp 170 </li><li>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true: 0x000000FF.  nvi_image.cpp 171 </li><li>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true: 0x000000FF.  nvi_image.cpp 172 </li><li>  <a href="http://www.viva64.com/ru/d/0153/">V560</a> A part of the conditional expression is always true: 0x000000FF.  nvi_image.cpp 173 </li></ul><br>  In this section of the code logical and bit operations are confused.  The result will not be what the programmer expected: <i>col</i> will always be 0x01010101 regardless of the input data. <br><br>  The correct option is: <br><pre> <code class="cpp hljs">DWORD a = (col &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>; DWORD b = (col &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>; DWORD g = (col &gt;&gt; <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>; DWORD r = (col &gt;&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x000000FF</span></span>;</code> </pre><br>  Another example of strange code: <br><pre> <code class="cpp hljs">VertexCache::VertexCache() { VertexCache(<span class="hljs-number"><span class="hljs-number">16</span></span>); }</code> </pre> <br>  <b>PVS-Studio warning</b> : <a href="http://www.viva64.com/ru/d/0215/">V603</a> The object was not used.  If you wish to call the constructor, 'this-&gt; VertexCache :: VertexCache (....)' should be used.  vertexcache.cpp 6 <br><br>  Instead of calling one constructor from another to initialize the instance, a new object of type <i>VertexCache</i> will be created and immediately destroyed.  As a result, the members of the object being created will remain uninitialized. <br><pre> <code class="cpp hljs">BOOL CActor::net_Spawn(CSE_Abstract* DC) { .... m_States.empty(); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0119/">warning</a> : <a href="http://www.viva64.com/ru/d/0119/">V530</a> The return value of the function is 'empty' is required to be utilized.  actor_network.cpp 657 <br><br>  The analyzer warns that the return value is not used.  It seems that the programmer has confused the methods <i>empty ()</i> and <i>clear ()</i> : <i>empty ()</i> does not clear the array, but checks whether it is empty. <br><br>  Such errors are <a href="http://www.viva64.com/ru/examples/V530/">often found</a> in various projects.  The problem is that the name <i>empty () is</i> not obvious: some perceive it as an action - deletion.  In order to avoid such ambiguity it is better to add the verb has, is to the beginning of the method: indeed, <i>isEmpty ()</i> with <i>clear () is</i> difficult to confuse. <br><br>  Similar warning: <br><br>  V530  uidragdroplistex.cpp 780 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> xrDebug::BuildStackTrace(EXCEPTION_POINTERS* exPtrs, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *buffer, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> capacity, <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> lineCapacity) { <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(buffer, capacity*lineCapacity, <span class="hljs-number"><span class="hljs-number">0</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0175/">warning</a> : <a href="http://www.viva64.com/ru/d/0175/">V575</a> The 'memset' function processes '0' elements.  Inspect the third argument.  xrdebug.cpp 104 <br><br>  When <i>memset was</i> called, the arguments were mixed up in places and, as a result, the buffer is not reset, as originally intended.  Such an error can live in a project for a very long time, since it is very difficult to detect.  In such places a static analyzer comes to the rescue of the programmer. <br><br>  Proper use of <i>memset</i> : <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, capacity*lineCapacity);</code> </pre> <br>  The following error is related to an incorrectly composed logical expression. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> configs_dumper::dumper_thread(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>* my_ptr) { .... DWORD wait_result = WaitForSingleObject( this_ptr-&gt;m_make_start_event, INFINITE); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ( wait_result != WAIT_ABANDONED) || (wait_result != WAIT_FAILED)) .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0137/">warning</a> : <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always true.  Probably the '&amp;&amp;' operator should be used here.  configs_dumper.cpp 262 <br><br>  Expressions of the form 'x! = A ||  x! = b 'are always true.  Most likely instead of the operator ||  the &amp;&amp; operator was implied. <br><br>  More information about errors in logical expressions can be found in the article " <a href="http://www.viva64.com/ru/b/0390/">Logical expressions in C / C ++. How professionals are mistaken</a> ." <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> SBoneProtections::reload(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> shared_str&amp; bone_sect, IKinematics* kinematics) { .... CInifile::Sect &amp;protections = pSettings-&gt;r_section(bone_sect); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (CInifile::SectCIt i=protections.Data.begin(); protections.Data.end() != i; ++i) { string256 buffer; BoneProtection BP; .... BP.BonePassBullet = (BOOL) ( atoi( _GetItem(i-&gt;second.c_str(), <span class="hljs-number"><span class="hljs-number">2</span></span>, buffer) )&gt;<span class="hljs-number"><span class="hljs-number">0.5f</span></span>); .... } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0308/">warning</a> : <a href="http://www.viva64.com/ru/d/0308/">V674</a> The '0.5f' literal of the 'float' type is compared to a value of the 'int' type.  boneprotections.cpp 54 <br><br>  The analyzer detected a comparison of an integer value with a real constant.  It is possible that, by analogy, the <i>atof</i> function should be used instead of <i>atoi</i> , in the other case it is worth rewriting this comparison so that it does not look suspicious.  However, to say for sure whether this example is erroneous or not, can only the developer who wrote it. <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IGameObject</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IFactoryObject, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISpatial, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ISheduled, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> IRenderable, <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">virtual</span></span> ICollidable { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> u16 </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>= <span class="hljs-number"><span class="hljs-number">0</span></span>; .... } BOOL CBulletManager::test_callback( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> collide::ray_defs&amp; rd, IGameObject* object, LPVOID params) { bullet_test_callback_data* pData = (bullet_test_callback_data*)params; SBullet* bullet = pData-&gt;pBullet; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( (object-&gt;ID() == bullet-&gt;parent_id) &amp;&amp; (bullet-&gt;fly_dist&lt;parent_ignore_distance) &amp;&amp; (!bullet-&gt;flags.ricochet_was)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; BOOL bRes = TRUE; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (object){ .... } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bRes; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0205/">warning</a> : <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'object' pointer was used before it was verified against nullptr.  Check lines: 42, 47. level_bullet_manager_firetrace.cpp 42 <br><br>  Checking the <i>object</i> pointer for equality <i>nullptr</i> comes after dereferencing <i>object-&gt; ID ()</i> .  In the case where <i>object</i> is nullptr, this will cause the program to crash. <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> _EDITOR BOOL WINAPI DllEntryPoint(....) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> BOOL WINAPI DllMain(....) #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> { switch (ul_reason_for_call) { .... case DLL_THREAD_ATTACH: </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (!strstr(GetCommandLine(), </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"-editor"</span></span></span><span class="hljs-meta">)) CoInitializeEx(NULL, COINIT_MULTITHREADED); timeBeginPeriod(1); break; .... } return TRUE; }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0359/">warning</a> : <a href="http://www.viva64.com/ru/d/0359/">V718</a> The 'CoInitializeEx' function should not be called from the 'DllMain' function.  xrcore.cpp 205 <br><br>  In the body of <i>DllMain</i> you cannot use part of the WinAPI functions, including <i>CoInitializeEx.</i>  You can verify this by reading <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms695279%2528v%3Dvs.85%2529.aspx">the MSDN documentation</a> .  It is impossible to give any definite advice on how to rewrite this function, but it is worth understanding that this situation is dangerous, since it can lead to a mutual blocking of threads or an abnormal termination. <br><br><h2>  Priority Errors </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sgetI1</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">unsigned</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> **bp )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( flen == FLEN_ERROR ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; i = **bp; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( i &gt; <span class="hljs-number"><span class="hljs-number">127</span></span> ) i -= <span class="hljs-number"><span class="hljs-number">256</span></span>; flen += <span class="hljs-number"><span class="hljs-number">1</span></span>; *bp++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> i; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0121/">warning</a> : <a href="http://www.viva64.com/ru/d/0121/">V532</a> Consider inspecting the statement of '* pointer ++' pattern.  Probably meant: '(* pointer) ++'.  lwio.c 316 <br><br>  Error associated with the use of increment.  For clarity, we rewrite this expression by placing brackets: <br><pre> <code class="cpp hljs">*(bp++);</code> </pre> <br>  That is, there will be a shift not in the content at <i>bp,</i> but in the pointer itself, which is meaningless in this context.  Below the code there are fragments of the form <i>* bp + = N</i> , which is why I concluded that this is a mistake. <br><br>  To avoid such an error would help the arrangement of brackets, which would make the order of calculations more understandable.  Also a good technique is the use of <i>const</i> for arguments that should not change. <br><br>  Similar warnings: <ul><li>  V532 Consider inspecting the statement of '* pointer ++' pattern.  Probably meant: '(* pointer) ++'.  lwio.c 354 </li><li>  V532 Consider inspecting the statement of '* pointer ++' pattern.  Probably meant: '(* pointer) ++'.  lwob.c 80 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CHitMemoryManager::load (IReader &amp;packet) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!spawn_callback || !spawn_callback-&gt;m_object_callback) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!g_dedicated_server) Level().client_spawn_manager().add( delayed_object.m_object_id,m_object-&gt;ID(),callback); <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifdef</span></span></span><span class="hljs-meta"> DEBUG </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (spawn_callback &amp;&amp; spawn_callback-&gt;m_object_callback) { VERIFY(spawn_callback-&gt;m_object_callback == callback); } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endif</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">// DEBUG }</span></span></span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0158/">warning</a> : <a href="http://www.viva64.com/ru/d/0158/">V563</a> It is possible that this 'else' branch must apply to the previous 'if' statement.  hit_memory_manager.cpp 368 <br><br>  In this fragment, the <i>else</i> branch refers to the second <i>if if</i> due to its right associativity, which does not coincide with the code formatting.  Fortunately, this case does not affect the work of the program, however, it can complicate the process of debugging and testing. <br><br>  The recommendation is simple - put curly braces in more or less complex branches. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> HUD_SOUND_ITEM::PlaySound(HUD_SOUND_ITEM&amp; hud_snd, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Fvector&amp; position, <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> IGameObject* parent, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> b_hud_mode, <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> looped, u8 index) { .... hud_snd.m_activeSnd-&gt;snd.set_volume( hud_snd.m_activeSnd-&gt;volume * b_hud_mode?psHUDSoundVolume:<span class="hljs-number"><span class="hljs-number">1.0f</span></span>); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0091/">warning</a> : <a href="http://www.viva64.com/ru/d/0091/">V502</a> Perhaps the '?:' Operator works in a different way.  The '?:' Operator has a lower limit than the '*' operator.  hudsound.cpp 108 <br><br>  The ternary conditional operator has lower priority than multiplication, so the order of operations will be as follows: <br><pre> <code class="cpp hljs">(hud_snd.m_activeSnd-&gt;volume * b_hud_mode)?psHUDSoundVolume:<span class="hljs-number"><span class="hljs-number">1.0f</span></span></code> </pre> <br>  Obviously, the correct code should look like this: <br><pre> <code class="cpp hljs">hud_snd.m_activeSnd-&gt;volume * (b_hud_mode?psHUDSoundVolume:<span class="hljs-number"><span class="hljs-number">1.0f</span></span>)</code> </pre> <br>  Expressions containing a ternary operator, several <i>if-else</i> branches or AND / OR operations are those cases when it is better to put extra brackets. <br><br>  Similar warnings: <ul><li>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '+' operator.  uihudstateswnd.cpp 487 </li><li>  V502 Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '+' operator.  uicellcustomitems.cpp 106 </li></ul><br><h2>  Extra comparisons </h2><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CDestroyablePhysicsObject::OnChangeVisual() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_pPhysicsShell){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(m_pPhysicsShell)m_pPhysicsShell-&gt;Deactivate(); .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0169/">warning</a> : <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (m_pPhysicsShell)' condition was already verified in line 32. destroyableysyssobject.cpp 33 <br><br>  In this example, <i>m_pPhysicsShell is</i> double checked.  Most likely, the second check is superfluous. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CSE_ALifeItemPDA::STATE_Read(NET_Packet &amp;tNetPacket, u16 size) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_wVersion &gt; <span class="hljs-number"><span class="hljs-number">89</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( (m_wVersion &gt; <span class="hljs-number"><span class="hljs-number">89</span></span>)&amp;&amp;(m_wVersion &lt; <span class="hljs-number"><span class="hljs-number">98</span></span>) ) { .... }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ .... } }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0169/">warning</a> : <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'm_wVersion&gt; 89' condition was already verified in line 987. xrserver_objects_alife_items.cpp 989 <br><br>  Very strange code.  Whether the expression was forgotten here after <i>if (m_wVersion&gt; 89)</i> , or the whole series of <i>else-if</i> .  This method requires more detailed consideration by the project developer. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ELogCallback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *context, LPCSTR txt)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bDlg = (<span class="hljs-string"><span class="hljs-string">'#'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">0</span></span>])||((<span class="hljs-number"><span class="hljs-number">0</span></span>!=txt[<span class="hljs-number"><span class="hljs-number">1</span></span>])&amp;&amp;(<span class="hljs-string"><span class="hljs-string">'#'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">1</span></span>])); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bDlg){ <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mt = (<span class="hljs-string"><span class="hljs-string">'!'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">0</span></span>])||((<span class="hljs-number"><span class="hljs-number">0</span></span>!=txt[<span class="hljs-number"><span class="hljs-number">1</span></span>])&amp;&amp;(<span class="hljs-string"><span class="hljs-string">'!'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">1</span></span>]))?<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>; .... } }</code> </pre> <br>  <b>PVS-Studio warnings</b> : <ul><li>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting the '(0! = Txt [1]) &amp;&amp; (' # '== txt [1])' expression.  The expression is misprint.  elog.cpp 29 </li><li>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting the '(0! = Txt [1]) &amp;&amp; ('! '== txt [1])' expression.  The expression is misprint.  elog.cpp 31 </li></ul><br>  In the initialization expressions for the variables <i>bDlg</i> and <i>mt, the</i> check <i>(0! = Txt [1])</i> is redundant.  If you omit it, expressions will become much easier to read: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bDlg = (<span class="hljs-string"><span class="hljs-string">'#'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">0</span></span>])||(<span class="hljs-string"><span class="hljs-string">'#'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">1</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> mt = (<span class="hljs-string"><span class="hljs-string">'!'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">0</span></span>])||(<span class="hljs-string"><span class="hljs-string">'!'</span></span>==txt[<span class="hljs-number"><span class="hljs-number">1</span></span>])?<span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>;</code> </pre> <br><h2>  Errors in data types </h2><br><img src="https://habrastorage.org/files/455/b04/ff8/455b04ff8b6e470c81deb484396d8655.png"><br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">float</span></span> CRenderTarget::im_noise_time; CRenderTarget::CRenderTarget() { .... param_blur = <span class="hljs-number"><span class="hljs-number">0.f</span></span>; param_gray = <span class="hljs-number"><span class="hljs-number">0.f</span></span>; param_noise = <span class="hljs-number"><span class="hljs-number">0.f</span></span>; param_duality_h = <span class="hljs-number"><span class="hljs-number">0.f</span></span>; param_duality_v = <span class="hljs-number"><span class="hljs-number">0.f</span></span>; param_noise_fps = <span class="hljs-number"><span class="hljs-number">25.f</span></span>; param_noise_scale = <span class="hljs-number"><span class="hljs-number">1.f</span></span>; im_noise_time = <span class="hljs-number"><span class="hljs-number">1</span></span>/<span class="hljs-number"><span class="hljs-number">100</span></span>; im_noise_shift_w = <span class="hljs-number"><span class="hljs-number">0</span></span>; im_noise_shift_h = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0254/">warning</a> : <a href="http://www.viva64.com/ru/d/0254/">V636</a> The ' <a href="http://www.viva64.com/ru/d/0254/">1/100</a> ' expression was implicitly cast from 'int' type to 'float' type.  Consider using a fractional part.  An example: double A = (double) (X) / Y ;.  gl_rendertarget.cpp 245 <br><br>  The value of the 1/100 expression is 0, since the integer division operation is performed.  To get the value of 0.01f, you need to use the real literal by rewriting the expression: 1 / 100.0f.  Although it is possible that this behavior was provided by the author, and there is no error here. <br><pre> <code class="cpp hljs">CSpaceRestriction::merge(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { .... LPSTR S = xr_alloc&lt;<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>&gt;(acc_length); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ( ; I != E; ++I) temp = strconcat(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(S),S,*temp,<span class="hljs-string"><span class="hljs-string">","</span></span>,*(*I)-&gt;name()); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0181/">warning</a> : <a href="http://www.viva64.com/ru/d/0181/">V579</a>  It is possibly a mistake.  Inspect the first argument.  space_restriction.cpp 201 <br><br>  The <i>strconcat</i> function takes the length of the buffer as the first parameter.  Buffer <i>S is</i> declared as <i>LPSTR</i> , that is, as a pointer to a string.  <i>sizeof (S)</i> will be equal to the size of the pointer in bytes, that is, <i>sizeof (char *)</i> , and not the number of characters in the string.  To calculate the length, use <i>strlen (S)</i> . <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XRCDB_API</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MODEL</span></span></span><span class="hljs-class"> {</span></span> .... u32 status; <span class="hljs-comment"><span class="hljs-comment">// 0=ready, 1=init, 2=building .... } void MODEL::build (Fvector* V, int Vcnt, TRI* T, int Tcnt, build_callback* bc, void* bcp) { .... BTHREAD_params P = { this, V, Vcnt, T, Tcnt, bc, bcp }; thread_spawn(build_thread,"CDB-construction",0,&amp;P); while (S_INIT == status) Sleep(5); .... }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0353/">warning</a> : <a href="http://www.viva64.com/ru/d/0353/">V712</a> Be advised that compiler may delete this cycle or make it infinity.  Use volatile variable (s) or synchronization primitives to avoid this.  xrcdb.cpp 100 <br><br>  The compiler can remove the <i>S_INIT == status</i> check as an optimization, since the <i>status</i> variable is not modified in a loop.  To avoid this behavior, you need to use <i>volatile</i> variables or types of data synchronization between threads. <br><br>  Similar warnings: <ul><li>  Or make it infinity.  Use volatile variable (s) or synchronization primitives to avoid this.  levelcompilerloggerwindow.cpp 23 </li><li>  Or make it infinity.  Use volatile variable (s) or synchronization primitives to avoid this.  levelcompilerloggerwindow.cpp 232 </li></ul><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAI_Rat::UpdateCL() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Useful()) { inherited::UpdateCL (); Exec_Look (Device.fTimeDelta); CMonsterSquad *squad = monster_squad().get_squad(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (squad &amp;&amp; ((squad-&gt;GetLeader() != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> &amp;&amp; !squad-&gt;GetLeader()-&gt;g_Alive()) || squad-&gt;get_index(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) == u32(<span class="hljs-number"><span class="hljs-number">-1</span></span>))) squad-&gt;SetLeader(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); .... } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0137/">warning</a> : <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'squad-&gt; get_index (this) == u32 (- 1)' is always false.  The value range of unsigned char type: [0, 255].  ai_rat.cpp 480 <br><br>  In order to understand why this expression is always false, let's calculate the values ‚Äã‚Äãof individual operands.  u32 (-1) is 0xFFFFFFFF or 4294967295. The type returned by the <i>squad-&gt; get_index (....)</i> method is u8, hence its maximum value is 0xFF or 255, which is strictly less than u32 (-1).  Accordingly, the value of such a comparison will always be <i>false</i> .  This code is easy to fix by changing the data type to u8: <br><pre> <code class="cpp hljs">squad-&gt;get_index(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) == u8(<span class="hljs-number"><span class="hljs-number">-1</span></span>)</code> </pre> <br>  The same diagnostics also work for redundant comparisons of unsigned variables: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> ALife { <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> u64 _TIME_ID; } ALife::_TIME_ID CScriptActionCondition::m_tLifeTime; IC <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CScriptEntityAction::CheckIfTimeOver() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>((m_tActionCondition.m_tLifeTime &gt;= <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; ((m_tActionCondition.m_tStartTime + m_tActionCondition.m_tLifeTime) &lt; Device.dwTimeGlobal)); }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0137/">warning</a> : <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'm_tActionCondition.m_tLifeTime&gt; = 0' is always true.  Unsigned type value is always&gt; = 0. script_entity_action_inline.h 115 <br><br>  The <i>m_tLifeTime</i> variable is unsigned; accordingly, it is always greater than or equal to zero.  Is this an extra check or is there an error in logic here, judged by the developer. <br><br>  Similar warning: <br><br>  V547 Expression 'm_tActionCondition.m_tLifeTime &lt;0' is always false.  Unsigned type value is never &lt;0. script_entity_action_inline.h 143 <br><pre> <code class="cpp hljs">ObjectFactory::ServerObjectBaseClass * CObjectItemScript::server_object (LPCSTR section) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { ObjectFactory::ServerObjectBaseClass *object = <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { object = m_server_creator(section); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception e) { Msg(<span class="hljs-string"><span class="hljs-string">"Exception [%s] raised while creating server object from "</span></span> <span class="hljs-string"><span class="hljs-string">"section [%s]"</span></span>, e.what(),section); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span>); } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0436/">warning</a> : <a href="http://www.viva64.com/ru/d/0436/">V746</a> Type slicing.  By reference rather than by value.  object_item_script.cpp 39 <br><br>  The <i>std :: exception :: what ()</i> function is virtual and can be redefined in inherited classes.  In this example, the exception is caught by value, therefore, an instance of the class will be copied and all information about the polymorphic type will be lost.  Refer to <i>what ()</i> in this case is meaningless.  The exception is to intercept the link: <br><pre> <code class="cpp hljs"> <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::exception&amp; e) {</code> </pre><br><h2>  miscellanea </h2><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">compute_cover_value</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> value [<span class="hljs-number"><span class="hljs-number">8</span></span>]; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (value[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">.999</span></span>f) { value[<span class="hljs-number"><span class="hljs-number">0</span></span>] = value[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0168/">warning</a> : <a href="http://www.viva64.com/ru/d/0168/">V570</a> The 'value [0]' variable is assigned to itself.  compiler_cover.cpp 260 <br><br>  The variable <i>value [0] is</i> assigned to itself.  Why do this - it is not clear.  Perhaps she should have been assigned a different value. <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CActor::g_SetSprintAnimation(u32 mstate_rl, MotionID &amp;head, MotionID &amp;torso, MotionID &amp;legs) { SActorSprintState&amp; sprint = m_anims-&gt;m_sprint; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> jump = (mstate_rl&amp;mcFall) || (mstate_rl&amp;mcLanding) || (mstate_rl&amp;mcLanding) || (mstate_rl&amp;mcLanding2) || (mstate_rl&amp;mcJump); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0090/">warning</a> : <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions '(mstate_rl &amp; mcLanding)' to the left and the right of the '||'  operator.  actoranimation.cpp 290 <br><br>  Most likely there is just an extra check of <i>mstate_rl &amp; mcLanding</i> , but often such warnings signal an error in the logic and unexamined enum values. <br><br>  Similar warnings: <ul><li>  V501 There are identical sub-expressions "HudItemData ()"  huditem.cpp 338 </li><li>  V501 There are identical sub-expressions 'list_idx == e_outfit'  operator.  uimptradewnd_misc.cpp 392 </li><li>  V501 There are identical sub-expressions' (D3DFMT_UNKNOWN == fTarget) 'to the left and to the right of the' ||  operator.  hw.cpp 312 </li></ul><br><pre> <code class="cpp hljs">RELATION_REGISTRY::RELATION_MAP_SPOTS::RELATION_MAP_SPOTS() { .... spot_names[ALife::eRelationTypeWorstEnemy] = <span class="hljs-string"><span class="hljs-string">"enemy_location"</span></span>; spot_names[ALife::eRelationTypeWorstEnemy] = <span class="hljs-string"><span class="hljs-string">"enemy_location"</span></span>; .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0108/">warning</a> : <a href="http://www.viva64.com/ru/d/0108/">V519</a> The variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 57, 58. relation_registry.cpp 58 <br><br>  The analyzer has found that two values ‚Äã‚Äãare assigned to one variable in a row.  In this case, it looks like it's just a dead code and should be deleted. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safe_verify</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"FATAL ERROR (%s): failed to verify data\n"</span></span>); .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="http://www.viva64.com/ru/d/0176/">warning</a> : <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  A different number of actual arguments is expected while calling 'printf' function.  Expected: 2. Present: 1. entry_point.cpp 41 <br><br>  An insufficient number of arguments are passed to the <i>printf</i> function: the format '% s' indicates that a pointer must be passed to the string.  Such a situation may lead to a memory access error and emergency program termination. <br><br><h2>  Conclusion </h2><br><img src="https://habrastorage.org/files/608/74c/f41/60874cf4154a4727afb437caf29dd0bd.png"><br><br>  Checking the source code X-Ray Engine revealed a large number of both superfluous or suspicious code, as well as uniquely erroneous and dangerous moments.  It is worth noting that the static analyzer perfectly helps to detect errors at an early stage of development, which makes life much easier for the programmer and frees up time to create new versions of the application. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0405/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Pavel Belikov.  <a href="http://www.viva64.com/en/b/0405/">Anomalies in X-Ray Engine</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/303664/">https://habr.com/ru/post/303664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../303654/index.html">Interview with python-developer Alexander Koshkin about the Python language and life in the USA</a></li>
<li><a href="../303656/index.html">Russian social media - the most important trends in 2016</a></li>
<li><a href="../303658/index.html">DConf2016</a></li>
<li><a href="../303660/index.html">JS Programming Contest: Word Classifier (Final Results)</a></li>
<li><a href="../303662/index.html">Do you see well</a></li>
<li><a href="../303666/index.html">We develop a weather bot in the IBM Bluemix environment based on Facebook</a></li>
<li><a href="../303668/index.html">Solving common business problems: there are no magic recipes</a></li>
<li><a href="../303670/index.html">How to make Intel Edison and Galileo iBeacon-beacons</a></li>
<li><a href="../303672/index.html">From the communication tool of scientists to the world standard: A brief history of e-mail</a></li>
<li><a href="../303674/index.html">The book ‚ÄúSwift 2.2. Basics of developing applications for iOS and OS X ¬ª</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>