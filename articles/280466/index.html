<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PowerWare new extortionist using PowerShell</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Black Carbon Threat Research Team recently discovered a new family of extortionists, called PowerWare. They target structures using Microsoft Word...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PowerWare new extortionist using PowerShell</h1><div class="post__text post__text-html js-mediator-article">  The Black Carbon Threat Research Team recently discovered a new family of extortionists, called PowerWare.  They target structures using Microsoft Word and PowerShell.  PowerShell is a scripting language for Microsoft operating systems. <br><br><img src="https://habrastorage.org/files/f90/2ae/a5c/f902aea5c54f45a6b612370b93c7e202.png"><a name="habracut"></a><br><br>  PowerWare is a new instance of ransomware using its own operating system tools, such as PowerShell.  As a rule, ‚Äútraditional‚Äù variants of ransomware install new malicious files in the system, which in some cases are easier to detect.  PowerWare uses PowerShell, a basic utility for current Windows systems to do all the dirty work.  Using PowerShell, this ransomware tries to avoid creating new files on the disk and disguise its actions under the actions of already installed, legal scripts. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The deceptively simple PowerWare code is a new approach to extortionists, reflecting a growing trend among malware authors that go beyond standard malicious solutions. <br><br>  The prevalence and popularity of ransomware has recently been staggering, thousands of organizations had to pay a ransom to unlock their encrypted files.  Over the past few days, successful and loud extortion attacks in three American hospitals have been identified.  The research group Carbon Black Threat Research discovered PowerWare after an unsuccessful attack aimed at organizing health care that was in the Carbon Black client base.  This used an e-mail phishing campaign. <br><br>  The study showed that PowerWare is loaded using a Microsoft Word document with macro-inclusions.  A Word document uses macros to create cmd.exe, which in turn invokes PowerShell with the necessary options.  Options download and distribute malicious PowerWare code.  Quite an interesting point - the authors of PowerWare initially ask for a $ 500 redemption, which increases to $ 1,000 in two weeks. <br><br><h4>  PowerWare - how it happens </h4><br>  For the PowerWare test sample, a ‚Äúmalicious‚Äù Word document is used. <br><br><img src="https://habrastorage.org/files/5a0/2ba/e58/5a02bae58298479ba39ae6df74fab9d8.png"><br><br>  In this example, when the user turns on macros, cmd.exe is created, which immediately starts a couple of instances of PowerShell.  One of them loads the ransomware script, the other runs PowerShell with the script as input. <br><br>  You can see the process of running PowerWare on the command line in the screenshot below. <br><br><img src="https://habrastorage.org/files/6ea/c5c/977/6eac5c97724c4ae1a7e4e7b53c3b00b7.png"><br><br>  Below is a snippet from a PowerWare script.  The first lines generate several random numbers that will be used to calculate the encryption key, as well as for the UUID assigned to this end point.  Then the URL to send the determined key.  This information is sent in plain text to the controlling host of the attacker using HTTP. <br><br>  (Note: there is good news for those who have already undergone such an attack - you can self-correct the malicious script when it sends a request home. The script does this using a simple text protocol, which makes it easy to track the movement of traffic. This raises the simple question of identifying the correct domain and IP from network traffic to get the encryption key. For its users, Carbon Black provides information on how to protect against this kind of extortionist.) <br><br><img src="https://habrastorage.org/files/981/a91/ccc/981a91cccab946388b7d97a2b4236163.png"><br><br>  Next comes the command to create the actual key that will be used in encryption, initialization vector and other crypto parameters. <br><br>  Finally, the script goes through the file system, encrypting each file with the specified extension (extensions are shown below). <br><br>  The attackers also included an HTML file in each folder with encrypted files named FILES_ENCRYPTED-READ_ME.HTML.  All the details of how the victim can get his data back are detailed in the files. <br><br>  The key phrase is: <br><blockquote>  You'd better hurry!  The price will double in a couple of weeks! </blockquote><br><img src="https://habrastorage.org/files/280/ec3/fd5/280ec3fd5ab94a58af598c809eef29d4.png"><br><br><h4>  PowerWare Detection </h4><br>  Users of the Carbon Black Enterprise Protection can block the original cmd.exe executable from Word.  There is a rule that blocks cmd.exe from running at startup using winword.exe.  Making the same rules for other office applications, like excel.exe, powerpnt.exe and outlook.exe, can be a good solution.  As always when creating rules, it is recommended that you first create them, like report rules, and monitor the console to evaluate any potential impacts.  As soon as you make sure that the rules do not harm the work of your environment - you can set its action to ‚ÄúBlock‚Äù mode. <br><br>  A similar rule for browsers to block apps from running PowerShell.  It should also help protect against other types of malicious software using Office documents. <br><br>  To detect the following requests Carbon Black Enterprise Protection must identify the action, as well as (other types of malicious software): <br><br>  process_name: cmd.exe PARENT_NAME: winword.exe chilproc_name: powershell.exe: <br><br>  process_name: powershell.exe filemod_count: [1000 *] <br><br>  While this sample uses cmd.exe as an intermediary, you should watch for PowerShell that was created directly - process_name: powershell.exe PARENT_NAME: winword.exe. <br><br>  And even the cmd.exe file created from office applications for more general detection: <br><br>  Process_name: cmd.exe and (PARENT_NAME: winword.exe or PARENT_NAME: excel.exe or PARENT_NAME: Powerpnt.exe or PARENT_NAME: outlook.exe). <br><br><h4>  Details on the file </h4><br><img src="https://habrastorage.org/files/6fd/b88/b50/6fdb88b506fe4a67b4f178c5318dc341.png"><br><br><h4>  Network details </h4><br><img src="https://habrastorage.org/files/4d6/5eb/aaa/4d65ebaaab4243e4afe5b40329a66a8e.png"><br><br><h4>  PowerWare encrypts the following formats: </h4><br><img src="https://habrastorage.org/files/b0a/4b3/db5/b0a4b3db5b9a4f35b08cf65c4d36d8d5.png"><br><br>  You can find the original article on the official <a href="https://www.carbonblack.com/2016/03/25/threat-alert-powerware-new-ransomware-written-in-powershell-targets-organizations-via-microsoft-word/">Carbon Black</a> website. </div><p>Source: <a href="https://habr.com/ru/post/280466/">https://habr.com/ru/post/280466/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../280454/index.html">Step by step: Transmit data to flightradar24</a></li>
<li><a href="../280456/index.html">New at PHDays: Hardware Village Playground</a></li>
<li><a href="../280460/index.html">Again about IDS or ELK for suricata</a></li>
<li><a href="../280462/index.html">JBreak Java Conference: The Conquest of Siberia</a></li>
<li><a href="../280464/index.html">Check your site from Mars? Nothing is impossible</a></li>
<li><a href="../280468/index.html">Tale about how GOST-disk encryption in Android implemented</a></li>
<li><a href="../280470/index.html">Frequency dictionary banned sites</a></li>
<li><a href="../280472/index.html">Video tutorials running computational tasks in Python, R, C ++, Octave and Blender in FlyElephant</a></li>
<li><a href="../280474/index.html">Glitter and poverty Big Data</a></li>
<li><a href="../280476/index.html">Automation of paperwork</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>