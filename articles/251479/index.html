<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a bot for MMORPG with assembler and draenei. Part 4</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi% username%! So, let's continue writing our bot. From past articles, we learned how to find the address of the intercepted function for DirectX 9 an...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a bot for MMORPG with assembler and draenei. Part 4</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/708/53f/a39/70853fa39f3f4d4f82bc6525a2ebc41f.png" align="left">  Hi% username%!  So, let's continue writing our bot.  From past articles, we learned how to find the address of the intercepted function for DirectX 9 and 11, execute arbitrary assembly code in the main thread of the game by hiding it from various methods of protection and receive information about the world.  In other words, we can perform deliberate actions in the game.  And for starters, I propose to learn how to move! <a name="habracut"></a><br><br><h6>  <b>Disclaimer: The author is not responsible for your use of the knowledge gained in this article or damage as a result of their use.</b>  <b>All information here is for educational purposes only.</b>  <b>Especially for companies developing MMORPG, that would help them to fight with the bot.</b>  <b>And, of course, the author of the article is not a botmaster, not a cheater, and never was.</b> <br></h6><br><hr><br><br>  For those who missed past articles, here is the content, and who read everything, we go further: <br><h6>  <b>Content</b> </h6><br><ol><li>  <a href="http://habrahabr.ru/post/251137/">Part 0 - Search for a code injection point</a> </li><li>  <a href="http://habrahabr.ru/post/251149/">Part 1 - Implementing and executing third-party code</a> </li><li>  <a href="http://habrahabr.ru/post/251199/">Part 2 - Hide the code from prying eyes</a> </li><li>  <a href="http://habrahabr.ru/post/251353/">Part 3 - Under the gun World of Warcraft 5.4.x (Structures)</a> </li><li>  <a href="http://habrahabr.ru/post/251479/">Part 4 - Under the gun World of Warcraft 5.4.x (Moving)</a> </li><li>  Part 5 - Under the gun World of Warcraft 5.4.x (Casting Fireball) </li></ol><br>  It just so happened that interaction with the game object and clicking on it in World of Warcraft is possible with a mouse click.  But we will not simulate clicks, through WinApi, we will make it cooler.  We intercept the place where the click is already processed by the game, like a click on the screen, and it will already be transferred from the coordinates of the screen to the coordinates of the game world.  To begin with, we‚Äôll get the addresses of some functions; we‚Äôll really need them in the process; this is simply done with the help of our beloved IDA debugger: <br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> FunctionWow { ClntObjMgrGetActivePlayer = <span class="hljs-number"><span class="hljs-number">0x39B615</span></span>, ClntObjMgrGetActivePlayerObj = <span class="hljs-number"><span class="hljs-number">0x4FC6</span></span>, FrameScript_ExecuteBuffer = <span class="hljs-number"><span class="hljs-number">0x4fd12</span></span>, Spell_C_HandleTerrainClick = <span class="hljs-number"><span class="hljs-number">0x38f129</span></span>, FrameScript__GetLocalizedText = <span class="hljs-number"><span class="hljs-number">0x414267</span></span>, IsOutdoors = <span class="hljs-number"><span class="hljs-number">0x414b53</span></span>, UnitCanAttack = <span class="hljs-number"><span class="hljs-number">0x41ad3c</span></span>, CGUnit_C__InitializeTrackingState = <span class="hljs-number"><span class="hljs-number">0x41fb57</span></span>, CGWorldFrame__Intersect = <span class="hljs-number"><span class="hljs-number">0x5eef7b</span></span>, CGUnit_C__Interact = <span class="hljs-number"><span class="hljs-number">0x8D01D0</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ClickToMove { CTM = <span class="hljs-number"><span class="hljs-number">0x420543</span></span>, CTM_PUSH = <span class="hljs-number"><span class="hljs-number">0xD0EEBC</span></span>, CTM_X = <span class="hljs-number"><span class="hljs-number">0xD0EF2C</span></span>, CTM_Y = CTM_X+<span class="hljs-number"><span class="hljs-number">4</span></span>, CTM_Z = CTM_Y+<span class="hljs-number"><span class="hljs-number">4</span></span>, }</code> </pre> <br>  Let's declare the WorldClick class: <br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> ClickType { FaceTarget = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, Face = <span class="hljs-number"><span class="hljs-number">0x2</span></span>, StopThrowsException = <span class="hljs-number"><span class="hljs-number">0x3</span></span>, Move = <span class="hljs-number"><span class="hljs-number">0x4</span></span>, NpcInteract = <span class="hljs-number"><span class="hljs-number">0x5</span></span>, Loot = <span class="hljs-number"><span class="hljs-number">0x6</span></span>, ObjInteract = <span class="hljs-number"><span class="hljs-number">0x7</span></span>, FaceOther = <span class="hljs-number"><span class="hljs-number">0x8</span></span>, Skin = <span class="hljs-number"><span class="hljs-number">0x9</span></span>, AttackPosition = <span class="hljs-number"><span class="hljs-number">0xa</span></span>, AttackGuid = <span class="hljs-number"><span class="hljs-number">0xb</span></span>, ConstantFace = <span class="hljs-number"><span class="hljs-number">0xc</span></span>, None = <span class="hljs-number"><span class="hljs-number">0xd</span></span>, Attack = <span class="hljs-number"><span class="hljs-number">0x10</span></span>, Idle = <span class="hljs-number"><span class="hljs-number">0x13</span></span>, } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WorldClick</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ClickTo</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ulong</span></span></span></span><span class="hljs-function"><span class="hljs-params"> guid, ClickType action, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">float</span></span></span></span><span class="hljs-function"><span class="hljs-params"> precision</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Mathf.Abs(x) &lt; <span class="hljs-number"><span class="hljs-number">0.1</span></span> &amp;&amp; Mathf.Abs(y) &lt; <span class="hljs-number"><span class="hljs-number">0.1</span></span> &amp;&amp; (Mathf.Abs(z) &lt; <span class="hljs-number"><span class="hljs-number">0.1</span></span> &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">long</span></span>)guid == <span class="hljs-number"><span class="hljs-number">0L</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-comment"><span class="hljs-comment">//  3  var positionAddress = Memory.Process.AllocateMemory(3 * sizeof(float)); //guid  ulong  8  var guidAddress = Memory.Process.AllocateMemory(sizeof(ulong)); // ,    ,   0.5f var precisionAddress = Memory.Process.AllocateMemory(sizeof(float)); if (positionAddress &lt;= 0U || guidAddress &lt;= 0U || precisionAddress &lt;= 0U) return; Memory.Process.Write&lt;ulong&gt;(guidAddress, guid); Memory.Process.Write&lt;float&gt;(precisionAddress, precision); Memory.Process.Write&lt;float&gt;(positionAddress, x); Memory.Process.Write&lt;float&gt;(positionAddress + IntPtr.Size, y); Memory.Process.Write&lt;float&gt;(positionAddress + IntPtr.Size * 2, z); var asm = new[] { "call " + Memory.Process.GetAbsolute(FunctionWow.ClntObjMgrGetActivePlayer ), //     "test eax, eax", "je @out", //    -   "call " + Memory.Process.GetAbsolute(FunctionWow.ClntObjMgrGetActivePlayerObjAddress), "test eax, eax", "je @out", "mov edx, [" + precisionAddress + "]", "push edx", "push " + positionAddress, "push " + guidAddress, "push " + (int)action, "mov ecx, eax", // ClickToMove() "call " + Memory.Process.GetAbsolute((int)ClickToMove.CTM), "@out:", "retn" }; Memory.Hook.InjectAndExecute(asm); Memory.Process.FreeMemory(positionAddress); Memory.Process.FreeMemory(guidAddress); Memory.Process.FreeMemory(precisionAddress); } public static ClickType GetClickTypePush() { return (ClickToMoveType)Memory.Process.Read&lt;int&gt;((int)ClickToMove.CTM_PUSH, true); } public static Vector3 GetClickPosition() { return new Vector3( Memory.Process.Read&lt;float&gt;((int)ClickToMove.CTM_X, true), Memory.Process.Read&lt;float&gt;((int)ClickToMove.CTM_Y, true), Memory.Process.Read&lt;float&gt;((int)ClickToMove.CTM_Z, true)); } }</span></span></code> </pre><br>  That's all, now you can run across the expanses of Azeroth with: <br><pre> <code class="cs hljs">WorldClick.ClickTo(x,y,z, <span class="hljs-number"><span class="hljs-number">0</span></span>, ClickType.Move, <span class="hljs-number"><span class="hljs-number">0.5f</span></span>);</code> </pre><br>  That's all for today.  You have learned a lot of interesting and practical.  You can check it on some pirate, and if you are sure of your obfuscation of the code, then you can even run on the official server, with some starting record, so as not to risk it.  After all, suddenly the staff of Blizzard, too, read Habr. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/251479/">https://habr.com/ru/post/251479/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../251467/index.html">React v0.13 RC</a></li>
<li><a href="../251469/index.html">How Internet giants have turned the network hardware business upside down</a></li>
<li><a href="../251471/index.html">Big Data Training: Spark MLlib</a></li>
<li><a href="../251473/index.html">The site from scratch on a full stack of BEM technologies. Yandex Methodology</a></li>
<li><a href="../251477/index.html">Honest private properties in the prototype</a></li>
<li><a href="../251487/index.html">Draining data 180 thousand users FL.ru</a></li>
<li><a href="../251489/index.html">A router from the operator? - No thanks!</a></li>
<li><a href="../251491/index.html">MS Dynamics CRM and PostSharp</a></li>
<li><a href="../251493/index.html">DevCon Digest # 3. Immerse yourself in Visual Studio</a></li>
<li><a href="../251497/index.html">OpenCage is the most powerful geocoding tool.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>