<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Practical examples of attacks inside the GSM network</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article about the Osmocom cycle, we will look at the practical implementation of attacks on subscribers of GSM networks. The attacks will be c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Practical examples of attacks inside the GSM network</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/web/992/bda/830/992bda8309ba4793a77eaa8cb294ad35.jpg"><br><br>  In this article about the Osmocom cycle, we will look at the practical implementation of attacks on subscribers of GSM networks.  The attacks will be considered as using voice calls and SMS as well as attacks while the subscriber is working with GPRS. <br><a name="habracut"></a><br>  To work we need everything that I described earlier.  Therefore, for those who have joined us just now, I recommend reading the materials of previous articles. <br><br>  <b>Cycle articles:</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <a href="https://habrahabr.ru/company/pentestit/blog/331406/">We start GSM network at home</a> <br>  <a href="https://habrahabr.ru/company/pentestit/blog/332778/">Analysis of GSM network traffic in Wireshark</a> <br>  <a href="https://habrahabr.ru/company/pentestit/blog/334100/">Add GPRS to your home GSM network</a> <br>  <a href="https://habrahabr.ru/company/pentestit/blog/334708/">Practical examples of attacks inside the GSM network</a> <br><br><blockquote>  <b>Attention!</b> <br>  This article is provided solely for educational purposes and the author does not bear any responsibility for the actions of other users, their interference with commercial GSM networks and the damage of their own equipment.  Before you start anything, make sure you understand what you are doing. </blockquote><br><h2>  Training </h2><br>  To work we need another component, which we mentioned only briefly earlier - <a href="https://osmocom.org/projects/osmo-sip-conector/wiki/Osmo-sip-connector">osmo-sip-connector</a> . <br><br>  We will connect our base station based on two osmocombb-compatible phones to the IP PBX <a href="https://ru.wikipedia.org/wiki/Asterisk">Asterisk</a> using this component. <br><br><img src="https://habrastorage.org/web/731/aad/e35/731aade350004e708fde0f8015d74ac4.png"><br><br>  This will allow us to record conversations of subscribers working in our network, as well as redirect their outgoing calls to answering machines and the like. <br><br>  I failed to install the osmo-sip-connector on Ubuntu 14.04 due to dependencies and I decided to go the other way and just installed all the components on Debian 9 (32-bits) through the <a href="https://osmocom.org/projects/cellular-infrastructure/wiki/Nightly_Builds">Nightly Builds deb packages</a> .  During the installation of the packages I did not get any errors and problems with dependencies.  The only thing I got was some texinfo errors when building the old toolchain.  But this was easily corrected by editing gcc / doc / gcc.texi.  I want to warn you that the osmocombb jolly / testing branch build should be done using the old toolchain.  Even if you correct a compilation error when using the new toolchain, you will get an unstable transceiver / TRX firmware in the future. <br><br>  <b>Install osmo-sip-connector and asterisk</b> <br><br><pre><code class="bash hljs">apt-get install osmo-sip-connector apt-get install libsofia-sip-ua-glib-dev apt-get install asterisk</code> </pre> <br>  Create an osmo-sip-connector.cfg file in your directory with other configuration files. <br><br><pre> <code class="bash hljs">app mncc socket-path /tmp/bsc_mncc sip <span class="hljs-built_in"><span class="hljs-built_in">local</span></span> 127.0.0.1 5069 remote 127.0.0.1 5060</code> </pre> <br>  <b>Configuring asterisk</b> <br><br>  Asterisk's very basic configuration might look like this. <br><br>  Add to the end of the /etc/asterisk/sip.conf file <br><br><pre> <code class="bash hljs">[GSM] <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=friend host=127.0.0.1 dtmfmode=rfc2833 canreinvite=no allow=all context=gsmsubscriber port=5069</code> </pre> <br>  Add to the end of the /etc/asterisk/extensions.conf file <br><br><pre> <code class="bash hljs">[gsmsubscriber] exten=&gt;_XXXXX,1,Dial(SIP/GSM/<span class="hljs-variable"><span class="hljs-variable">${EXTEN}</span></span>) exten=&gt;_XXXXX,n,Playback(vm-nobodyavail) exten=&gt;_XXXXX,n,HangUp()</code> </pre> <br>  Restart asterisk. <br><br><h2>  Capture subscriber in our GSM network </h2><br>  <b>2G / 3G / 4G</b> <br><br>  Immediately consider two options: <br><br><ol><li>  The target subscriber uses the old phone without 3G / 4G support. </li><li>  The target subscriber uses a modern smartphone that supports 4G. </li></ol><br>  In the second case, the smartphone will first look for 4G networks, then 3G networks and only then 2G networks.  Thus, if you are in a place where there is a good signal from the 3G / 4G base station of the home operator of the subscriber, then it will not connect to your 2G base station. <br><br>  To solve this problem, you must either create interference on the 3G / 4G frequencies of the operator, or be with the subscriber in a location where there is no 3G or 4G coverage.  Contrary to the doubts of many people, so many places so far. <br><br>  In the first case, when the target phone does not support 3G / 4G, everything becomes simpler and our base station should simply be within reach of the target phone and have a fairly powerful signal. <br><br>  <b>MCC / MNC</b> <br><br>  In order for the phone to automatically connect to our GSM network, it must be a home for the SIM card installed in the target phone. <br><br>  A home network is defined by three parameters: <br><br><ul><li>  <a href="https://ru.wikipedia.org/wiki/MNC">MNC</a> (Mobile Network Code) </li><li>  <a href="https://ru.wikipedia.org/wiki/Mobile_Country_Code">MCC</a> (Mobile Country Code) </li><li>  Networ Name </li></ul><br>  All these values ‚Äã‚Äãare not secret and you can easily find them out even from Wikipedia. <br>  These parameters are transmitted to the base station in SI (System Information) messages on the BCCH logical channel (Timelot 0). <br><br>  Now we have the following in the OpenBSC settings: <br><br><pre> <code class="bash hljs">network country code 1 mobile network code 1 short name MyNet long name MyNet</code> </pre><br>  You can find out the MCC and MNC subscriber based on the phone number.  There are many sites with this information, for example <a href="http://www.mtt.ru/ru/defcodes/">this one</a> .  Finding the name in the Latin network is also not difficult.  Please note that the name is case sensitive. <br><br>  At home, you will also need to change the auth-policy to closed, so that <u><b>only your</b></u> phones have the right to connect to the network with the real MCC and MNC. <br><br>  To do this, add subscribers to the HLR with IMSI of their personal SIM-cards, if they are not already in the HLR. <br><br><pre> <code class="bash hljs">telnet localhost 4242 en conf t subscriber create imsi _IMSI_1 subscriber imsi _IMSI_1 authorized 1 subscriber create imsi _IMSI_2 subscriber imsi _IMSI_2 authorized 1 ... write file end</code> </pre> <br>  And change the authentication policy <br><br><pre> <code class="bash hljs">telnet localhost 4242 en conf t network auth policy closed write file end</code> </pre> <br>  Restart OsmoNITB. <br><br>  Now subscribers not represented in the HLR will not be able to connect to your network. <br><br>  <b>IMEI</b> <br><br>  <a href="https://ru.wikipedia.org/wiki/IMEI">IMEI</a> - International Mobile Equipment Identity. <br><br>  When subscribers start connecting to your network, how do you know who exactly you need?  You do not see phone numbers, you only see IMSI and IMEI.  Knowing IMEI, you can uniquely identify the model of the phone in which the SIM card is inserted.  For example using the site <a href="http://www.imei.info/">http://www.imei.info/</a> .  The model and the origin of the phone are described by the first <a href="https://en.wikipedia.org/wiki/Type_Allocation_Code">8 digits of IMEI</a> .  Phones that support simultaneous work with multiple SIM-cards are assigned several IMEI numbers. <br><br>  Thus, if you know that the target subscriber uses Apple iPhone 5, you can download the database with TAC codes and find out TAC for iPhone 5. This database is available from osmocom - <a href="http://tacdb.osmocom.org/">http://tacdb.osmocom.org/</a> <br><br><img src="https://habrastorage.org/web/629/c0e/e79/629c0ee79f994afd972bdef1924fcf4f.PNG"><br><br>  In order not to capture subscribers with unsuitable TACs in their network, it would be good to refuse subscribers during registration if their equipment has a TAC not for iPhone 5. <br><br>  At the moment I have not found the settings for <a href="http://celnet.ru/EIR.php">EIR</a> in OsmoNITB, but <a href="https://osmocom.org/projects/osmomsc/wiki">soon</a> we will have separate MSC, HLR, and possibly EIR, and there it will be. <br><br>  At the moment we will manually monitor the connected subscribers.  You can just put "authorized 0" for everyone, if its IMEI does not suit us. <br><br><pre> <code class="bash hljs">OpenBSC<span class="hljs-comment"><span class="hljs-comment"># subscriber imsi 123456789012345 authorized 0</span></span></code> </pre> <br>  Now, all that remains is to get close to the subscriber and launch CalypsoBTS. <br><br><h2>  MITM during GPRS-surfing </h2><br>  When a subscriber enters our network, it becomes unavailable for external calls and cannot call anywhere (usually, see the exception below). <br><br>  However, we can <a href="https://habrahabr.ru/company/pentestit/blog/334100/">provide it with access to the Internet</a> using GPRS / EDGE packet data services.  Since the machine that provides access to the Internet for the subscriber is completely under our control, we can do whatever you want with TCP / IP traffic. <br><br>  The easiest way is for us to work with this site. <br><br><img src="https://habrastorage.org/web/06c/710/e71/06c710e71e054dcba851e2173332fbd7.png"><br><br>  I remind you that the speed of data transmission in GPRS is very low, at the same time, modern phones, when they access the network, immediately begin the process of checking updates, mail, and news.  All your applications are starting to update their data.  This can make it difficult for the subscriber to open something in the browser, since, in addition to low bandwidth, packet loss can occur if you use unproductive equipment like CalypsoBTS. <br><br>  Therefore, when planning an MITM attack, you need to keep this in mind.  It is possible, for example, to block access to everything, except for the resource, through iptables, the interaction of the victim with which we are interested. <br><br>  Further, using the <a href="https://github.com/byt3bl33d3r/MITMf">MITMf</a> framework, <a href="https://github.com/byt3bl33d3r/MITMf">you</a> can directly attack. <br><br>  We will redirect all HTTP subscriber requests to our web server. <br><br><pre> <code class="bash hljs">iptables -t nat -A PREROUTING -i tun0 -p tcp -m tcp --dport 80 -j DNAT --to-destination 192.168.1.32:80</code> </pre> <br>  Where 192.168.1.32 is the IP address of the Kali Linux machine that I will use to attack. <br><br>  Additionally, you can prohibit all other requests on port 443 and others, in order to increase the download speed of the phishing site. <br><br>  Use the <a href="https://github.com/trustedsec/social-engineer-toolkit/">SE Toolkit</a> to copy the site and conduct a phishing attack. <br><br>  Run SET <br><br><img src="https://habrastorage.org/web/74f/e7e/4b8/74fe7e4b83b046de8925c8933debdc66.PNG"><br><br>  We want to get credentials from a specific site.  Configure SET. <br><br><img src="https://habrastorage.org/web/19e/f7e/d5d/19ef7ed5d0bb4f57a11fed06728bfa34.PNG"><br><br><img src="https://habrastorage.org/web/05e/840/142/05e840142fe54deba9dca95f2e76a5dd.PNG"><br><br><img src="https://habrastorage.org/web/f7b/65c/20c/f7b65c20ca1f4721924301a12f741f0a.PNG"><br><br>  We create phishing authentication page defcon.ru <br><br><img src="https://habrastorage.org/web/d4c/075/204/d4c0752042ee49ec90409105fd20ee42.PNG"><br><br>  When trying to go to any website via the attacker's GPRS network service, the victim gets to the phishing page (note the URL). <br><br><img src="https://habrastorage.org/web/a59/1e8/3cc/a591e83cc7f04b9aa1adc0528ad0047e.png"><br><br>  In this case, my network has MCC 001 and MNC 01, so we see the roaming icon.  In this case, in order to gain access to the Internet, the victim will have to allow packet data in roaming, which is inconvenient.  Therefore, for this attack, you need to use the MCC / MNC and the network name of the operator of the target subscriber (see below).  In the laboratory, you can not do this. <br><br>  After entering the credentials SET displays the username and password <br><br><img src="https://habrastorage.org/web/243/801/cc7/243801cc787a475b942984b2b00169ff.PNG"><br><br><h2>  SMS phishing </h2><br>  When phishing mailings are made pretending to be banks or relatives, they are sent from an unknown number to the subscriber, which is suspicious.  When a subscriber enters a hostile GSM network, he can send SMS from any number. <br><br>  To send SMS you just need to do the following: <br><br>  Connect to OsmoNITB VTY and create a subscriber on whose behalf an SMS will be sent. <br><br><pre> <code class="bash hljs">telnet localhost 4242 OpenBSC<span class="hljs-comment"><span class="hljs-comment"># en OpenBSC# subscriber create imsi 123456789012345 OpenBSC# subscriber imsi 123456789012345 extension 89001234567</span></span></code> </pre><br>  Where <br>  123456789012345 - IMSI is controlled by the phone included in the attacker's network. <br>  89001234567 - The phone number from which the victim will receive SMS. <br><br><img src="https://habrastorage.org/web/ee5/223/ee4/ee5223ee465f4519b8e5fe317594a4a4.png"><br><br>  And you can send SMS from the same VTY interface OsmoNITB <br><br><pre> <code class="bash hljs">OpenBSC<span class="hljs-comment"><span class="hljs-comment"># subscriber imsi 987654321987654 sms sender extension 890012345678 send Your bank...</span></span></code> </pre><br>  Where 987654321987654 - IMSI phone victim, captured in the network. <br><br><img src="https://habrastorage.org/web/ffc/189/5bd/ffc1895bdc1d433994f1f70dfb1249c6.png"><br><br>  If the victim responds to the SMS, you will receive a response to the phone under control.  You can also easily get the answer by viewing the Wireshark traffic dump, while not having a controlled telephone on the network. <br><br>  Please note that there is no roaming icon in the screenshot at this time, as the MCC, MNC and the home network name of the SIM card of the target subscriber are used, and the SMS came from the subscriber listed in the phone book, i.e.  detect such an attack is impossible. <br><br>  Sending Binary-SMS is another vector.  OsmoNITB allows you to send Siltent SMS, <s>but I did not find how to send a binary using OsmoNITB.</s>  <s>At the moment, you can try to use something <a href="https://github.com/PavelBansky/SharpSMS">like that</a> .</s>  <s>However, this vector still needs to be studied and the implementation of specific attacks in each case will be different.</s> <br><br>  Using OsmoNITB, you can send binary SMS via SMPP interface. <br>  Thanks <a href="https://habrahabr.ru/users/axilirator/" class="user_link">axilirator</a> for the info! <br><br><h2>  Redirect and record voice calls </h2><br>  If the victim tries to call the number from which the SMS came (89001234567), then her call will be redirected to the phone controlled by the attacker. <br><br>  To use Asterisk to route calls, you need to add the -M switch to the osmo-nitb command. <br><br><pre> <code class="bash hljs">-M /tmp/bsc_mncc</code> </pre> <br>  And run osmo-sip-connector <br><br><pre> <code class="bash hljs">osmo-sip-connector -c ___</code> </pre> <br>  Now our calls will be routed through Asterisk, we can set any dialplan and fully define how the call will go.  The attacker can, for example, direct all calls to an answering machine, where a robotic female voice will ask the caller for confidential information.  Nobody will think that a robot can harm a person? <br><br>  Call recording can be performed using standard Asterisk constructs and in the /etc/extensions.conf file you can use Monitor () and MixMonitor (). <br><br><h2>  Radio Resource LCS (Location Service) Protocol </h2><br>  RRLP - GSM protocol that allows the network to request the current coordinates of the subscriber. <br>  RRLP does not require user authentication and consent to provide this data. <br>  We, through OsmoNITB, can also send an RRLP request to the captured subscriber. <br>  If you are using CalypsoBTS, then you are next to the subscriber and this is unlikely to be useful, however, using more powerful transceivers RRLP allows you to monitor the subscriber. <br><br>  <s>Unfortunately, I didn‚Äôt have enough time to try it, but</s> I suppose I need to use the <a href="http://cgit.osmocom.org/osmocom-lcs/">osmocom-lcs module</a> .  When the RRLP request mode is activated in OsmoNITB VTY, RRLP requests will be sent to the subscriber each time a channel is allocated to him. <br><br>  You can activate RRLP <br><br><pre> <code class="bash hljs">telnet localhost 4242 en conf t network rrlp mode  write file end</code> </pre><br>  Requests and responses can be seen in Wireshark.  In this case, my phone returned Not Supported to the RRLP request. <br><br><img src="https://habrastorage.org/web/292/ebe/1bb/292ebe1bb8c14e51875d14097632ee01.png"><br><br>  Thanks <a href="https://habrahabr.ru/users/axilirator/" class="user_link">axilirator</a> for the info. <br><br>  There are other attacks to which 2G networks are susceptible and most cell phones still support GSM.  To avoid becoming a victim of such attacks, be careful when receiving suspicious calls, CMC or when surfing from a mobile phone, as well as pay attention to the 3G / LTE icons, which usually indicate what generation of the network you are currently working on. </div><p>Source: <a href="https://habr.com/ru/post/334708/">https://habr.com/ru/post/334708/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334696/index.html">Machine learning in skiing</a></li>
<li><a href="../334698/index.html">Three laws of configydynamics</a></li>
<li><a href="../334700/index.html">Vulnerability in Alfa-Bank Ukraine: getting the full name of the client by phone number</a></li>
<li><a href="../334702/index.html">Development under Sailfish OS in the eyes of an iOS developer</a></li>
<li><a href="../334704/index.html">Unified Style Language</a></li>
<li><a href="../334710/index.html">Dagger 2. Subcomponents. Best practice</a></li>
<li><a href="../334712/index.html">Character development for the game "Allods Online"</a></li>
<li><a href="../334714/index.html">"Man in the middle" using revoked certificates. Part 2</a></li>
<li><a href="../334716/index.html">Create offline facial recognition with an accuracy of 99.38% in Python and Node.js</a></li>
<li><a href="../334718/index.html">The first Mail.Ru Group specialization is Coursera, the largest educational platform.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>