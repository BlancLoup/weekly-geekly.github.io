<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building Unity3D builds on Jenkins on Mac OS X. Part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 There is a project on Unity3D . There are already several years (born in February 2012). After six months, I started working on it as a p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building Unity3D builds on Jenkins on Mac OS X. Part 1</h1><div class="post__text post__text-html js-mediator-article"><h4>  Prehistory </h4><br>  There is a project on <b>Unity3D</b> .  There are already several years (born in February 2012).  After six months, I started working on it as a programmer, and after two years I was not lucky and I became responsible for building the builds.  I inherited <b>MacMini</b> with the <b>Jenkins</b> collector installed, a minimum of documentation and the lack of an adequate build for <b>iOS</b> . <br><br>  I would like to finally write an adequate instruction - for the initial setting was killed a few weeks, and when you transfer to the <b>iMac,</b> my old practices are already outdated.  So‚Ä¶ <br><a name="habracut"></a><br><h4>  Technical task </h4><br><ol><li>  The project is being developed on the <b>Unity3D</b> engine.  Since development has been going on for a long time, the engine version has changed from 3.5.6 to 4.6.6 (at the time of this writing, support version 5 is not planned yet).  Each version has its glitches, some versions contain vital edits for one platform and at the same time kill the assembly for another.  For example, support for 64b for <b>iOS has been</b> added in recent versions, in early 4.x versions there was an assembly for the <b>Google Chrome</b> and <b>Flash</b> plugin, the recommended <b>Android SDK</b> changes from version to version.  You need to have everything. <br></li><li>  The project is on the <b>svn</b> server.  Specifically - <b>subversion.assembla.com</b> .  Need support for the assembly of different branches, different subprojects, as well as projects that include parts of other projects. <br></li><li>  The build should be carried out for <b>Android</b> ( <b>Google Play</b> , <b>Amazon App Store</b> , <b>Yandex Store</b> ...), <b>iOS</b> , <b>Windows</b> , <b>Mac OS</b> , <b>Linux</b> (all with the possibility of publishing on <b>Steam</b> ).  Some parts are set to run in the browser.  Here we consider only the features of the assembly for each configuration. <br></li><li>  You need access to builds from the local network so that the tester can download, install and test. <br></li><li>  Standalone build, autorun after failure (power off) <br></li></ol><br><h4>  Iron </h4><br>  Why we collect on apple products?  Because you need to collect <b>iOS</b> applications and send them to the <b>AppStore</b> .  Have a hackintosh or virtualka - have problems. <br><br>  So, there is an old <a href="http://www.apple.com/ru/mac-mini/">MacMini</a> in the office and the newest <a href="http://www.apple.com/ru/imac-with-retina/">iMac</a> at home.  Both cope with their work, the difference in performance and approach - there is no guarantee for the first one and it is not a pity for him (the desire to kill him on the table occurs every week), the second one is lovingly wiped with a rag and protected. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, for those who want - to get acquainted with the assembly and disassembly of the first device - welcome <a href="http://geektimes.ru/post/96690/">here</a> .  The need for assembly arose after the death of the old disk.  Thanks to the instructions, the new 1 TB disk has been successfully opened and inserted. <br><br>  It is worth making a digression here - I prefer to have a hard disk with several partitions, and maybe even with several operating systems.  However, if the type of drive is <a href="https://ru.wikipedia.org/wiki/Fusion_Drive">Fusion Drive</a> , this will not work (my <b>iMac</b> has a maximum of two disks on the disk, and the second one is inhabited by <b>Windows</b> ).  If the drive is normal - no problems.  You can store all the important data in one section (and backup it with <a href="https://support.apple.com/ru-ru/HT201250">Time Machine</a> ), and store heavyweight copies of the project on another. <br><br><h4>  System installation </h4><br>  Deserves a separate article.  Briefly: <br><br><ol><li>  On the latest poppies there is an online installation.  Otherwise - you need a drive or flash drive with the image of the system.  Enter the <b>Cmd + R</b> installation menu. </li><li>  All disks and sections we call clear names.  Sections with system and working data are formatted necessarily in <b>Mac OS Extended (Journaled)</b> .  Required - <b>not Case-sentive</b> . </li><li>  To install the software, you need an <b>Apple Id</b> .  It is desirable that this <b>Apple Id</b> match the account of the <a href="https://developer.apple.com/membercenter/">Apple developer</a> , which is used in the preparation and pouring builds. </li><li>  In addition to the administrator account, we do not need to bind an account with normal rights.  We call it <b>jenkins</b> , password also. </li><li>  If someone needs remote access via <a href="https://chrome.google.com/webstore/detail/chrome-remote-desktop/gbchcmhmhahfdphkhkmpfmihenigjmpp">Chrome Remote Desktop</a> , you‚Äôll have to give the account administrator privileges. </li><li>  We put a normal browser and useful software at will. </li><li>  If you have problems with the display of pages - <b>Steam Community</b> , <b>YouTube</b> and others - we look <a href="https://developers.google.com/speed/public-dns/docs/using">once</a> and <a href="http://superuser.com/questions/726646/troubleshooting-acute-latency-of-akamai-cdn">twice</a> . </li></ol><br><h4>  Install Xcode </h4><br><ol><li>  The latest version is usually put from the store. </li><li>  When installing multiple versions - it is desirable to select a separate folder and put it there.  For example - in <b>/ Applications / Xcode</b> are <b>Xcode_5_1_1.app</b> and <b>Xcode_6_1_1.app</b> . </li><li>  Old versions can be found <a href="https://developer.apple.com/downloads/index.action">here</a> . </li></ol><br><h4>  Install Unity3D </h4><br>  The engine can be downloaded on <a href="http://unity3d.com/ru/">offsite</a> (need <b>Mac</b> version) version or on <a href="https://inmac.org/auth/">your favorite tracker</a> .  On the off-line, we <b>register</b> and <b>purchase the necessary license</b> , depending on the needs of the project. <br><br>  By default, after installing <b>Unity.app</b> , <b>MonoDevelop.app</b> and the documentation are in <b>/ Applications / Unity</b> .  If you need to install several versions, first rename the old installation folder, for example <b>/ Applications / Unity_4_6_6_f2</b> , only after that we install the new version and rename the installation location too.  All versions and patches can be found <a href="http://unity3d.com/ru/get-unity/download/archive">here</a> . <br><br>  <b>MonoDevelop is</b> sufficient to leave the freshest, having written the path in the settings of each <b>Unity</b> .  In the folder <b>/ Users / Shared,</b> you can find the default <b>Unity</b> project - it can be demolished. <br><br>  For the user <b>jenkins,</b> you must <b>add</b> rights to run all files.  If necessary - and all the contents <b>.app</b> . <br><br>  Also in the settings disable the auto-discovery of the last project and register each copy. <br><br><h4>  Install Java, JDK, Android SDK </h4><br>  <b>JDK</b> and <b>JRE</b> can be downloaded from <a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">offsite</a> .  <b>Android SDK</b> download <a href="http://developer.android.com/sdk/index.html">from here</a> .  After installation, we update the <b>SDK</b> and set the path to it in each <b>Unity</b> and check it on the test build.  An example of a working configuration: <br><ul><li>  OS X 10.10.5 </li><li>  Unity 4.6.6f2 </li><li>  jdk-8u60-macosx-x64 </li><li>  Android SDK: Tools 24.3.4 </li><li>  Android SDK: Platform-tools 23.0.1 </li><li>  Android SDK: Build-tools 23.0.1 </li><li>  Android SDK: SDK Platform API 23 </li></ul><br>  The configuration is selected only by experience.  There is no guarantee that when upgrading one of these components, the build of the build will not fall ... <br><br><h4>  SVN installation </h4><br>  According to <a href="http://www.apple.com/opensource/">this</a> - <b>subversion</b> comes with the system.  To install a specific version - I recommend using <b>Homebrew</b> , we <a href="https://subversion.apache.org/packages.html">are</a> looking for more details <a href="https://subversion.apache.org/packages.html">here</a> . <br><br><h4>  Install Jenkins </h4><br><ol><li>  All operations are performed under the user <b>jenkins</b> </li><li>  Downloading from the <a href="http://jenkins-ci.org/">offsite</a> installer.  We put, move to a convenient place, for example in <b>/Users/jenkins/WORK/JENKINS_WAR/jenkins.war</b> </li><li>  Go to the terminal, execute the command to start the collector: <br><br><pre><code class="bash hljs">java -jar /Users/jenkins/WORK/JENKINS_WAR/jenkins.war</code> </pre> <br></li><li>  Check in the browser - <a href="http://127.0.0.1:8080/">127.0.0.1:8080</a> for the presence of a collector.  After closing the terminal (the collector is disabled) </li><li>  Create a folder for temporary files.  For example - <b>/ Users / jenkins / WORK / JENKINS_TMP</b> </li><li>  Create a folder for the collector.  For example - <b>/ Users / jenkins / WORK / JENKINS_HOME</b> .  In it we copy the contents of the <b>/Users/jenkins/.jenkins</b> folder, and delete the folder itself. </li><li>  Go to the terminal and log in as administrator: <br><br><pre> <code class="bash hljs">login dimamatik</code> </pre><br></li><li>  Delete the old configuration file: <br><br><pre> <code class="bash hljs">sudo rm /Library/Preferences/org.jenkins-ci.plist</code> </pre><br></li><li>  Enter the following parameters (can be changed, if desired): <br><br><pre> <code class="bash hljs">pp=<span class="hljs-string"><span class="hljs-string">"/Library/Preferences/org.jenkins-ci.plist"</span></span> sudo defaults write <span class="hljs-variable"><span class="hljs-variable">$pp</span></span> JENKINS_HOME <span class="hljs-string"><span class="hljs-string">"/Users/jenkins/WORK/JENKINS_HOME"</span></span> sudo defaults write <span class="hljs-variable"><span class="hljs-variable">$pp</span></span> tmpdir <span class="hljs-string"><span class="hljs-string">"/Users/jenkins/WORK/JENKINS_TMP"</span></span> sudo defaults write <span class="hljs-variable"><span class="hljs-variable">$pp</span></span> war <span class="hljs-string"><span class="hljs-string">"/Users/jenkins/WORK/JENKINS_WAR/jenkins.war"</span></span> sudo defaults write <span class="hljs-variable"><span class="hljs-variable">$pp</span></span> httpPort 4242</code> </pre><br></li><li>  Checking: <br><br><pre> <code class="bash hljs">defaults <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> <span class="hljs-variable"><span class="hljs-variable">$pp</span></span></code> </pre><br></li><li>  We install the rights: <br><br><pre> <code class="bash hljs">sudo chown root:wheel <span class="hljs-variable"><span class="hljs-variable">$pp</span></span> sudo chmod 644 <span class="hljs-variable"><span class="hljs-variable">$pp</span></span></code> </pre><br></li><li>  We unload the jenkins demon with the command: <br><br><pre> <code class="bash hljs">sudo launchctl unload /Library/LaunchDaemons/org.jenkins-ci.plist</code> </pre><br></li><li>  Remove the demon: <br><br><pre> <code class="bash hljs">sudo rm /Library/LaunchDaemons/org.jenkins-ci.plist</code> </pre><br></li><li>  We leave from the administrator: <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">logout</span></span></code> </pre><br></li><li>  We start the collector through the terminal once again (the page is now <a href="http://127.0.0.1:4242/">127.0.0.1:4242</a> ).  Everything should <a href="http://lurkmore.co/%25D0%25A3_%25D0%25BC%25D0%25B5%25D0%25BD%25D1%258F_%25D0%25B2%25D1%2581%25D0%25B5_%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0%25D0%25B5%25D1%2582">work</a> . </li></ol><br>  More details can be found <a href="https://wiki.jenkins-ci.org/display/JENKINS/Thanks%2Bfor%2Busing%2BOSX%2BInstaller">here</a> and <a href="https://wiki.jenkins-ci.org/display/JENKINS/Starting%2Band%2BAccessing%2BJenkins">here</a> . <br><br><h4>  Autoload, restart, death </h4><br>  The problem of death and resuscitation of the collector is aggravated by the use of <b>Mac</b> and assembly on <b>Unity</b> .  We write and save scripts: <br><br><ul><li>  The <b>jenkins-runner.sh</b> collector launch script: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh "/Library/Application Support/Jenkins/jenkins-runner.sh" &amp;</span></span></code> </pre><br></li><li>  Script killing collector <b>jenkins-killer.sh</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh ps xa | grep jenkins.war | grep -v grep | awk '{print $1}' | xargs kill -9</span></span></code> </pre><br></li><li>  <b>Jenkins-restart.sh</b> restart <b>script</b> : <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash (sh ~jenkins/jenkins-killer.sh) &amp;&amp; (sh ~jenkins/jenkins-runner.sh)</span></span></code> </pre><br></li></ul><br>  To automatically start the collector, create a special application using <a href="https://support.apple.com/ru-ru/ht2488">Automator</a> .  Select the <b>AppleScript Run</b> template and create <b>jenkins-restart.app</b> in the same folder as the rest of the scripts.  Program code below: <br><br><pre> <code class="objectivec hljs"> on run {input, parameters} tell application <span class="hljs-string"><span class="hljs-string">"Terminal"</span></span> activate <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (the (count of the window) = <span class="hljs-number"><span class="hljs-number">0</span></span>) or (the busy of window <span class="hljs-number"><span class="hljs-number">1</span></span> = <span class="hljs-literal"><span class="hljs-literal">true</span></span>) then tell application <span class="hljs-string"><span class="hljs-string">"System Events"</span></span> keystroke <span class="hljs-string"><span class="hljs-string">"n"</span></span> using command down end tell end <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> script <span class="hljs-string"><span class="hljs-string">"sh ~jenkins/jenkins-restart.sh"</span></span> end tell <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> input end run</code> </pre><br><br>  If the scripts are not in the home folder, edit the paths accordingly. <br><br>  In the <b>jenkins</b> user <b>settings</b> we set the automatic launch of the written application.  If desired, it can be used manually.  We put the user on the automatic login when the system starts (if it is an office collector, and we are too lazy to come early to start it). <br><br>  Learn more about the daemon - look <a href="https://wiki.jenkins-ci.org/display/JENKINS/Thanks%2Bfor%2Busing%2BOSX%2BInstaller">at the wiki</a> or in the <a href="https://developer.apple.com/library/mac/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html">general help</a> .  Generally speaking, it would be possible not to use <b>Automator</b> , but to leave this mechanism by adding unloading and loading of the daemon in the scripts.  However, the plug-in and reboot plugins may not work correctly. <br><br><h4>  What we have </h4><br>  At the moment, the system should <a href="http://lurkmore.co/%25D0%25A1%25D0%25BB%25D0%25B0%25D0%25B2%25D0%25B0_%25D1%2580%25D0%25BE%25D0%25B1%25D0%25BE%25D1%2582%25D0%25B0%25D0%25BC">work</a> .  The collector (while empty) automatically starts at system startup.  Any project on <b>Unity</b> should normally be assembled (by hand) from under the <b>jenkins</b> user.  If errors occur - we look at the permissions, the installed components, we pay debts for the license.  The most interesting thing to come ... <br><br>  The second part can be found <a href="http://habrahabr.ru/post/268365/">here</a> . <br><br><h5>  Update 10/6/15 </h5><br><ol><li>  Added paragraph on the <b>Jenkins</b> daemon, fixed instructions for disabling it. </li><li>  Added link to offsite in the section about downloading and installing the collector. </li><li>  Comment for script and application restart. </li></ol><br><h5>  Update 10/13/15 </h5><br><ol><li>  Added link to the second part. </li><li>  Added die tutorial. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/268233/">https://habr.com/ru/post/268233/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../268223/index.html">The publication in the incentive with minimal cost</a></li>
<li><a href="../268225/index.html">Price unsubscribe</a></li>
<li><a href="../268227/index.html">Why minimalist design still rules the web</a></li>
<li><a href="../268229/index.html">Alternative to .NET MVC and WEB Forms</a></li>
<li><a href="../268231/index.html">Fantasy on WebDAV. ... make a fairy tale come true?</a></li>
<li><a href="../268235/index.html">Candy Challenge (improving the result)</a></li>
<li><a href="../268237/index.html">Gartner's Magic Quadrant for Data Center Networking Technologies</a></li>
<li><a href="../268239/index.html">A couple of goodies for CodeIgniter</a></li>
<li><a href="../268241/index.html">We invite to student hackathons of Imagine Cup</a></li>
<li><a href="../268243/index.html">Kaspersky Industrial CTF: time to protect substations, and time to break substations</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>