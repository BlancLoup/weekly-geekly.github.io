<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>File synchronization between servers in a cluster</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hosting applications with high load and constantly growing traffic requires additional power and settings to handle a large flow of requests. The solu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>File synchronization between servers in a cluster</h1><div class="post__text post__text-html js-mediator-article">  Hosting applications with high load and constantly growing traffic requires additional power and settings to handle a large flow of requests.  The solution in this case can be the addition of servers to the environment to support the full functioning of the application. <br><br>  As a result, you face another difficulty ‚Äî a more complicated installation than using a single server.  The main problem is that such applications as <b>WordPress, Drupal, Joomla, Liferay, Redmine</b> , etc.  By default, all downloaded files are saved on one server only and do not synchronize them between servers in the cluster.  In other words, only the server that processed the file download request will contain the new content. <br><br>  Therefore, in today's article we will describe a possible solution to the problem of <b>file synchronization</b> , which is provided by the Jelastic platform. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/859/c9d/c44/859c9dc440adc3c7d222e0ebab2d2bf0.png" alt="file synchronization"><br><a name="habracut"></a><br><br>  <i>At the moment, this is just a temporary solution that helps automate content synchronization across multiple application servers.</i>  <i>In the future (after processing reviews) we are going to integrate this functionality into the core of the Jelastic system.</i> <br><br>  This solution is a combination of a <a href="http://ru.wikipedia.org/wiki/Bookmarklet">bookmarklet</a> and server side script.  Basically, the server script is executed using a utility like <a href="http://code.google.com/p/lsyncd/">lsyncd</a> and crown. <br><br>  <b>Lsyncd</b> is a lightweight solution for synchronizing application servers.  In combination with <a href="http://en.wikipedia.org/wiki/Inotify">inotify,</a> lsyncd initiates file synchronization only when it detects actual changes in the system.  As a result, you do not spend a lot of resources on synchronization and reduce the load on the CPU. <br><br>  Using the bookmarklet, lsyncd is automatically installed on each application server in the environment.  Before installation, the list of folders for synchronization is refined.  As a result, any changes in the specified folders on one server will be automatically synchronized with the other servers. <br><br>  Thus, this solution maximally simplifies the file synchronization system.  Now let's take a look at how it works. <br><br>  In our example, we will use <b>WordPress</b> deployed in a two-server environment.  This instruction is also completely suitable for other PHP, Java or Ruby applications such as Drupal, Joomla, Liferay, Redmine and others. <br><br><h4>  <b>Application Installation</b> </h4><br>  1. Deploy the <b>WordPress</b> application manually or by using our JPS widget for installation in one click.  The instructions and the widget can be found in the <a href="http://docs.jelastic.com/wordpress">WordPress document</a> . <br><br>  2. Now let's create a cluster by increasing the number of servers in the environment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d4/fbc/82b/7d4fbc82b29fbf0e434736da5639fe48.png" alt="application server"><br><br>  Using the documentation, you can easily add additional application servers, enable high availability, or even configure a clustered solution: <br><ul><li>  <a href="http://docs.jelastic.com/horizontal-scaling">horizontal scaling</a> </li><li>  <a href="http://docs.jelastic.com/session-replication">high availability</a> </li><li>  <a href="http://docs.jelastic.com/cluster-in-cloud">software clustering</a> </li></ul><br>  In our case, we simply added another server to the environment.  You can also use a more sophisticated <a href="http://docs.jelastic.com/wordpress-cluster">cluster solution</a> customization script for your WordPress application. <br><br>  3. Click <b>Open in browser</b> in environment settings. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/556/af0/ea4/556af0ea4d0027632347ccc253393ad3.png" alt="open in browser"><br><br>  4. Enter the necessary information to complete the installation of <b>WordPress</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5b/bbd/f60/c5bbbdf6094eec409b868b757b9384e4.png" alt="install wordpress"><br><br><h4>  <b>Testing file downloads without synchronization</b> </h4><br>  Let's check the processing of downloaded files by the server without synchronization enabled. <br><br>  1. Go to <b>the control panel</b> and make changes: upload images or files, edit themes, etc.  As an example, we uploaded one image to the <b>Media</b> section. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/242/e67/b31/242e67b315627999b4de008a5bd5aeb4.png" alt="upload a picture in wordpress"><br><br>  2. Return to the Jelastic control panel and click <b>Configuration</b> next to the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/309/c32/384/309c32384e6a69834e79931cdfced6fa.png" alt="server settings"><br><br>  3. Navigate to the <b>webroot&gt; ROOT&gt; wp-content</b> folder. <br>  There, on one of the application servers, a new <b>uploads</b> folder will appear, in which the added files are placed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cfb/109/8bf/cfb1098bf6d4ebdf36665591b630e59f.png" alt="download files"><br><br>  <i>The folder for downloading files depends on the application that you host.</i> <i><br><br></i>  <i>Below is a list of such folders for some popular applications:</i> <i><br></i>  <i><b>WordPress</b> : webroot / ROOT / wp-content</i> <i><br></i>  <i><b>Drupal</b> : webroot / ROOT / sites</i> <i><br></i>  <i><b>Joomla</b> : webroot / ROOT / images</i> <i><br></i>  <i><b>Liferay</b> : webroot / home / liferay / data</i> <br><br>  4. Please note that on the second server the <b>uploads</b> folder does not exist at all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/90e/26b/9d2/90e26b9d2ccc4fccc38bbae57fff0312.png" alt="server without files"><br><br>  As we see, the added images are placed only on the server that performed the file download. <br><br><h4>  <b>File Sync Setup</b> </h4><br>  And now let's move on to solving the problem of file synchronization in a cluster. <br><br>  1. First of all, follow the <a href="http://blog.jelastic.com/2014/02/12/file-synchronization-between-several-application-servers-in-the-cluster/">link to our blog</a> and drag the <b>File synchronization</b> bookmarklet to your browser's bookmarks bar as shown in the figure below (the bookmarklet is placed in the <i>Apply File Synchronization</i> paragraph). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9a5/aab/f29/9a5aabf290bac4a820dd5354ee2e34bf.png" alt="sync bookmarklet"><br><br>  2. Go to <b>the Jelastic control panel</b> and run the script by clicking <b>File Synchronization</b> on the bookmarks bar. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e15/1c2/83e/e151c283e0f6f1b9598733d04a21f6db.png" alt="bookmarklet"><br><br>  3. In the window that opens, select the environment with your application and select the folder (or several folders) that you want to synchronize.  Click <b>Install</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b6d/f74/3a6/b6df743a6550e48af85b8a08bcf4c089.png" alt="sync setting"><br><br>  <i>Do not select the entire <b>webroot</b> folder, in this case the synchronization will not work.</i> <br><br>  4. Wait a little (about 2 minutes) to apply the settings.  First of all, the <b>install.sh</b> and <b>replication.tar</b> files and the <b>lsyncd</b> folder will appear on the servers. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c5/0fd/21d/8c50fd21df557c865eaf245d72294d0a.png"><img src="https://habrastorage.org/getpro/habr/post_images/f83/d12/558/f83d12558d908059e02527a2bf31a998.png"><br><br>  5. After that, check the <b>webroot&gt; ROOT&gt; wp-content</b> folder on all application servers. <br>  As you can see, the previously uploaded image is located in the <b>uploads</b> folder on each node. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/398/277/1e2/3982771e2985243de87488f231dee6a2.png" alt="files synchronized"><br><br>  It's pretty simple.  As a result, the synchronization will work automatically every time you add or change something in your WordPress (or any other) application. <br><br><h4>  <b>Saving synchronization when changing topology</b> </h4><br>  If you change the environment topology by adding application servers, then you need to run the script again to provide synchronization for the new nodes. <br><br>  1. Click <b>Change Environment Topology</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/655/889/347/6558893474df7f91d66dafc3b3048e1e.png" alt="change topology"><br><br>  2. Add additional servers and <b>apply the</b> changes. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/79a/949/82d/79a94982d0f185280918bc208f5771a9.png" alt="add server"><br><br>  3. Follow steps 2-4 in the <b>Configure File Synchronization</b> section to adjust the internal synchronization processes. <br><br>  <i>After the additional launch of the script, the previous settings will be reset and the new configurations selected this time will be applied.</i> <br><br><h4>  <b>Check logs</b> </h4><br>  The synchronization process can be monitored using logs. <br><br>  1. Navigate to the <b>webroot / lsyncd / var / log</b> folder. <br><br>  2. You can see the synchronization status in the <b>lsyncd.log</b> and <b>lsyncd.status files</b> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bf9/aa8/443/bf9aa8443701165da11ac5bdc5e1ab8a.png" alt="logs"><br><br>  We hope our decision will be useful.  Feel free to download even more exciting content and attract more users! <br><br>  Do you solve the synchronization problem differently?  Please share your experiences in the comments below. <br><br>  Lead Research Engineer, <br>  Alexey Alexandrov </div><p>Source: <a href="https://habr.com/ru/post/213001/">https://habr.com/ru/post/213001/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212989/index.html">Everybody shit on your performance</a></li>
<li><a href="../212991/index.html">Manage Intel Galileo through the cloud</a></li>
<li><a href="../212993/index.html">How to monetize an idea. Experience and mistakes</a></li>
<li><a href="../212997/index.html">Dangerous entertainment: easy-to-repeat high voltage generator</a></li>
<li><a href="../212999/index.html">Bing code search</a></li>
<li><a href="../213005/index.html">AllDataCenter.ru: all about data centers for those who want to know more!</a></li>
<li><a href="../213007/index.html">Install Windows Server 2008 over a network with a Linux PXE server. WinPE Customization</a></li>
<li><a href="../213009/index.html">Using comments to store static data in Javascript</a></li>
<li><a href="../213011/index.html">March 11 will be a fight in ping-pong between the machine and the man (Timo Boll)</a></li>
<li><a href="../213017/index.html">Integration with the hub "Photos" on Windows Phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>