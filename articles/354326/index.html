<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using the MVC pattern when designing the tableview</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I present to your attention the translation of the article "iOS Tableview with MVC" , published in October 2016 on Medium.com by the develop...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using the MVC pattern when designing the tableview</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I present to your attention the translation of the article <a href="https://medium.com/ios-os-x-development/ios-tableview-with-mvc-a05103c01110">"iOS Tableview with MVC"</a> , published in October 2016 on Medium.com by the developer Stan Ostrovskiy. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/o5/yr/zh/o5yrzhlegxyny0ddrp4nphywpek.png"></div><br>  <i>An example of using UITableView in an application</i> <br><br>  In this article, using a specific example, you can familiarize yourself with the use of the popular MVC pattern, when designing one of the most popular elements of the <i>UITableView</i> interface.  Also, this article in a fairly clear and accessible form makes it possible to understand the basic architectural principles when designing your application, and also gives you the opportunity to become familiar with the <i>UITableView</i> element.  Considering the fact that a considerable number of developers often neglect any architectural solutions when creating their applications, I believe that this article will be very useful for both novice developers and programmers with a certain experience.  The MVC pattern is promoted by Apple itself and is the most popular pattern used in iOS development.  This does not mean that it is suitable for any tasks and is always the optimal choice, but, first, with MVC, the easiest way is to get a general understanding of the architecture of your application, and, second, quite often MVC is really well suited for solving certain problems. project tasks.  This article will help you structure your code, make it convenient, reusable, readable and compact. <br><a name="habracut"></a><br>  If you are developing iOS projects, then you already know that one of the most used components is <i>UITableView</i> .  If you are not yet developing for iOS, then in any case you can see that <i>UITableView is</i> used in many modern applications, such as Youtube, Facebook, Twitter, Medium, as well as in the vast majority of instant messengers, etc.  Simply put, every time you need to display a variable number of data objects, you use a <i>UITableView</i> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>Another basic component for this purpose is the CollectionView, which I personally prefer to use because it is more flexible than the TableView.</i> <br><br>  So you want to add a <i>UITableView</i> to your project. <br><br>  The most obvious way that <i>UITableViewController</i> usually goes, in which a <i>UITableView</i> is immediately integrated.  Its setup is quite simple; you need to add your own data array and create a table cell.  It looks simple and works the way we want, except for a few moments: firstly, the <i>UITableViewController</i> code becomes huge and secondly, it breaks the whole concept of the MVC pattern. <br><br>  <i>Even if you don‚Äôt want to deal with any design patterns, in any case you probably want to break apart a <i>UITableViewController</i> code consisting of several thousand lines.</i> <br><br>  There are several methods for transferring data between the Model and the Controller, in this article I will use delegation.  This approach allows you to get clear, modular and reusable code. <br><br>  Instead of using a single <i>UITableViewController</i> , we split it into several classes: <br><br><ul><li>  DRHTableViewController: we will make it a subclass of <i>UIViewController</i> , and add a <i>UITableView</i> as its subview </li><li>  DRHTableViewCell: a subclass of <i>UITableViewCell</i> </li><li>  DRHTableViewDataModel: this class will deal with API requests, generate data and return them to <i>DRHTableViewController</i> using delegation </li><li>  DRHTableViewDataModelItem: a simple class that contains data that we will display in a cell <i>DRHTableViewCell</i> </li></ul><br>  Let's start with UITableViewCell <br><br>  <b>Part 1: TableViewCell</b> <br><br>  Create a new project as ‚ÄúSingle View Application‚Äù, and delete the standard ViewController.swift and Main.storyboard files.  We will create all the files that we need later, step by step. <br><br>  First, create a subclass of <i>UITableViewCell</i> .  If you want to use a XIB file, check the ‚ÄúAlso create XIB file‚Äù option. <br><br><img src="https://habrastorage.org/webt/c6/jc/sy/c6jcsyjbvqcx20q6oo42fj8e3ww.png"><br><br>  For this example, we use a table cell with the following fields: <br><br><ol><li>  Avatar Image (user image) </li><li>  Name Label (username) </li><li>  Date Label </li><li>  Article Title (article title) </li><li>  Article Preview (article preview) </li></ol><br>  You can use Autolayout as you like, because the design of the table cell does not affect anything, from what we do in this guide.  Create an outlet for each subview.  Your <i>DRHTableViewCell.swift</i> file should look like this: <br><br><pre><code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewCell</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewCell</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> avatarImageView: <span class="hljs-type"><span class="hljs-type">UIImageView?</span></span> <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authorNameLabel: <span class="hljs-type"><span class="hljs-type">UILabel?</span></span> <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> postDateLabel: <span class="hljs-type"><span class="hljs-type">UILabel?</span></span> <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> titleLabel: <span class="hljs-type"><span class="hljs-type">UILabel?</span></span> <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previewLabel: <span class="hljs-type"><span class="hljs-type">UILabel?</span></span> }</code> </pre> <br>  <i>As you can see, I changed all the default @IBOutlet values ‚Äã‚Äãwith "!"</i>  <i>on "?".</i>  <i>Each time you add a UILabel from InterfaceBuilder to your code, a ‚Äú!‚Äù Is automatically added to the variable at the end, which means that the variable is declared as an implicitly retrievable optional.</i>  <i>This is done to ensure compatibility with the Objective-C API, but I prefer not to use forced extraction, so I use the usual optionals instead.</i> <br><br>  Next, we need to add a method to initialize all the elements of the table cell (labels, images, etc.).  Instead of using separate variables for each item, let's create a small class <i>DRHTableViewDataModelItem</i> . <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewDataModelItem</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> avatarImageURL: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> authorName: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> date: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> title: <span class="hljs-type"><span class="hljs-type">String?</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> previewText: <span class="hljs-type"><span class="hljs-type">String?</span></span> }</code> </pre> <br>  <i>The date is of course better stored as the Date type, but for simplicity, in our example we will store it as a String.</i> <br><br>  All variables are optional, so you can not worry about their default values.  We will write Init () a little later, and now let's go back to <i>DRHTableViewCell.swift</i> and add the following code that initializes all the elements in our table cell. <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureWithItem</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item: DRHTableViewDataModelItem)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// setImageWithURL(url: item.avatarImageURL) authorNameLabel?.text = item.authorName postDateLabel?.text = item.date titleLabel?.text = item.title previewLabel?.text = item.previewText }</span></span></code> </pre> <br>  <i>The SetImageWithURL method depends on how you are going to work by loading images in a project, so I will not describe it in this article.</i> <br><br>  Now that we have a cell ready, we can go to the TableView table. <br><br>  <b>Part 2: TableView</b> <br><br>  In this example, we will use the <i>viewController</i> in the Storyboard.  First create a subclass of <i>UIViewController</i> : <br><br><img src="https://habrastorage.org/webt/q0/ii/wq/q0iiwqrsuii1ofm4g3zj66fnkaq.png"><br><br>  In this project, I will use <i>UIViewController</i> instead of <i>UITableViewController</i> to extend the control on elements.  Also, using <i>UITableView</i> as a sub- <i>view</i> will allow you to place the table as you please, with <i>Autolayout</i> .  Next, create a storyboard file and give it the same name <i>DRHTableViewController</i> .  Drag the <i>ViewController</i> from the library with the objects and type the class name into it: <br><br><img src="https://habrastorage.org/webt/ju/io/ym/juioymrbslae_j5dkooqqpkvg1s.png"><br><br>  Add a <i>UITableView</i> link to all four edges of the controller: <br><br><img src="https://habrastorage.org/webt/ea/j9/lm/eaj9lmtnvupfrwosjzkri9zhffs.png"><br><br>  And at the end add the <i>tableView</i> outlet to the <i>DRHTableViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIViewController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@IBOutlet</span></span> <span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> tableView: <span class="hljs-type"><span class="hljs-type">UITableView?</span></span> }</code> </pre> <br>  We have already created the <i>DRHTableViewDataModelItem</i> , so we can add the following local variable to the class: <br><br><pre> <code class="hljs markdown">fileprivate var dataArray = [<span class="hljs-string"><span class="hljs-string">DRHTableViewDataModelItem</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>)</code> </pre> <br>  This variable stores the data that we will display in the table. <br><br>  <i>Note that we do not initialize this array in the ViewController class: this is just an empty array for the data.</i>  <i>We will fill it with data later, with the help of delegation.</i> <br><br>  Now set all the basic <i>tableView</i> properties in the <i>viewDidLoad</i> method.  You can customize the colors and styles as you like, the only property that we definitely need in this example is <i>registerNib</i> : <br><br><pre> <code class="hljs vhdl">tableView?.<span class="hljs-keyword"><span class="hljs-keyword">register</span></span>(nib: UINib?, forCellReuseIdentifier: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>)</code> </pre> <br>  Instead of creating a nib before calling this method and entering the long and complex identifier of our cell, we will make both the Nib and ReuseIdentifier properties of the <i>DRHTableViewCell</i> class <br><br>  <i>Always try to avoid using long and complex identifiers in the project body.</i>  <i>If there are no other options, you can make a string variable and assign this value to it.</i> <br><br>  Open <i>DRHTableViewCell</i> and add the following code to the top of the class: <br><br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DRHMainTableViewCell: <span class="hljs-built_in"><span class="hljs-built_in">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> var identifier: String { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> String(describing: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> var nib: <span class="hljs-built_in"><span class="hljs-built_in">UINib</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">UINib</span></span>(nibName: identifier, bundle: <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) } ..... }</code> </pre> <br>  Save the changes and return to DRHTableViewController.  Calling the registerNib method will look much simpler: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">tableView</span></span>?<span class="hljs-selector-class"><span class="hljs-selector-class">.register</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">DRHTableViewCell</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.nib</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">forCellReuseIdentifier</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">DRHTableViewCell</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.identifier</span></span>)</code> </pre> <br>  Do not forget to set the <i>tableViewDataSource</i> and <i>TableViewDelegate</i> to self. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewDidLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewDidLoad() tableView?.register(<span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.nib, forCellReuseIdentifier: <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.identifier) tableView?.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> tableView?.dataSource = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span> }</code> </pre> <br>  As soon as you do this, the compiler will give the error: ‚Äú <i>Cannot assign value of DRHTableViewController to type UITableViewDelegate</i> ‚Äù (I cannot assign a value of type <i>DRHTableViewController to</i> type <i>UITableViewDelegate</i> ). <br><br>  <i>When you use a subclass of UITableViewController, you already have a built-in delegate and datasource.</i>  <i>If you add UITableView as a subtype of UIViewController, you need to implement the UIViewController compliance with the UITableViewControllerDelegate and UITableViewControllerDataSource protocols yourself.</i> <br><br>  To get rid of this error, simply add two extensions to the <i>DRHTableViewController</i> class: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDelegate</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  After that, another error will appear: <i>‚ÄúType DRHTableViewController does not conform to protocol UITableViewDataSource‚Äù</i> (Type <i>DRHTableViewController</i> does not comply with the <i>UITableViewDataSource</i> protocol).  This is because there are several required methods that need to be implemented in these extensions. <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITableViewDataSource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { } }</code> </pre> <br>  <i>All methods in UITableViewDelegate are optional, so there will be no error unless you override them.</i>  <i>Click the mouse with ‚ÄúCommand‚Äù clamped on UITableViewDelegate to see which methods are available.</i>  <i>The most frequently used methods are the selection of table cells, the setting of the height of the table cell, and the configuration of the upper and lower table headers.</i> <br><br>  As you may have noticed, the two methods mentioned above should return a value, so you see again the error <i>‚ÄùMissing return type‚Äù</i> .  Let's fix it.  First, let's set the number of columns in the section: we have already declared the <i>dataArray</i> data <i>array</i> , so we can simply take its number of elements: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, numberOfRowsInSection section: Int)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">Int</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dataArray.<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> }</code> </pre> <br>  Some may have noticed that I did not override another method: <i>numberOfSectionsInTableView</i> , which is commonly used in <i>UITableViewController</i> .  This method is optional and it returns a default value of one.  In this example, we have only one section in the <i>tableView</i> , so there is no need to override this method. <br><br>  The final step in configuring the <i>UITableViewDataSource</i> is to set up a table cell in the <i>cellForRowAtIndexPath</i> method: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.identifier, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() }</code> </pre> <br>  Let's look at it line by line. <br><br>  To create a table cell, we call the <i>dequeueReusableCell</i> method with the identifier <i>DRHTableViewCell</i> .  It returns a <i>UITableViewCell</i> , and, accordingly, we use optional type conversion from <i>UITableViewCell</i> to <i>DRHTableViewCell</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.identifier, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span></code> </pre> <br>  Next, we make a safe extraction of the optional and, if successful, return the cell: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.identifier, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell }</code> </pre> <br>  If, however, the value could not be retrieved, then we return the default <i>UITableViewCell</i> cell <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let cell = tableView.dequeueReusableCell(withIdentifier: DRHTableViewCell.identifier, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? DRHTableViewCell { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> UITableViewCell()</code> </pre> <br>  Maybe we still forgot something?  Yes, we need to initialize the cell with data: <br><br><pre> <code class="hljs swift"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tableView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> tableView: UITableView, cellForRowAt indexPath: IndexPath)</span></span></span></span> -&gt; <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cell = tableView.dequeueReusableCell(withIdentifier: <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span>.identifier, <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>: indexPath) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span>? <span class="hljs-type"><span class="hljs-type">DRHTableViewCell</span></span> { cell.configureWithItem(item: dataArray[indexPath.item]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> cell } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">UITableViewCell</span></span>() }</code> </pre> <br>  Now we are ready for the final part: we need to create and connect the <i>DataSource</i> to our <i>TableView</i> <br><br>  <b>Part 3: DataModel</b> <br><br>  Create a class <i>DRHDataModel</i> . <br><br>  Inside this class, we request data either from a JSON file or using HTTP <br>  request or simply from a local data file.  This is not something that I would like to focus on in this article, so therefore I will assume that we have already made an API request and it returned to us an optional array of type AnyObject and an optional Error Error: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DRHTableViewDataModel { func requestData() { // code <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> request data <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> API <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-type"><span class="hljs-type">JSON</span></span> file will go here // this two vars were returned <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wherever: // var response: [AnyObject]? // var error: Error? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let error = error { // handle error } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let response = response { // parse response <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> [DRHTableViewDataModelItem] setDataWithResponse(response: response) } } }</code> </pre> <br>  In the <i>setDataWithResponse</i> method <i>,</i> we will populate an array from <i>DRHTableViewDataModelItem</i> using the array received in the request.  Add the following code below <i>requestData</i> : <br><br><pre> <code class="hljs markdown">private func setDataWithResponse(response: [<span class="hljs-string"><span class="hljs-string">AnyObject</span></span>]) { var data = [<span class="hljs-string"><span class="hljs-string">DRHTableViewDataModelItem</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>) for item in response { // create DRHTableViewDataModelItem out of AnyObject } }</code> </pre> <br>  As you remember, we have not yet created any initializer for the <i>DRHTableViewDataModel</i> .  So let's go back to the <i>DRHTableViewDataModel</i> class and add a method to initialize.  In this case, we will use an optional initializer with the [String: String] dictionary? .. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">init</span></span>?(data: [<span class="hljs-type"><span class="hljs-type">String</span></span>: <span class="hljs-type"><span class="hljs-type">String</span></span>]?) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> data = data, <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> avatar = data[‚ÄúavatarImageURL‚Äù], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> name = data[‚ÄúauthorName‚Äù], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> date = data[‚Äúdate‚Äù], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> title = data[‚Äútitle‚Äù], <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> previewText = data[‚ÄúpreviewText‚Äù] { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.avatarImageURL = avatar <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.authorName = name <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.date = date <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.title = title <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.previewText = previewText } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">nil</span></span> } }</code> </pre> <br>  If any field is absent in the dictionary, or the dictionary itself is nil, initialization will fail (return nil). <br><br>  Having this initializer, we can create the <i>setDataWithResponse</i> method in the <i>DRHTableViewDataModel</i> class: <br><br><pre> <code class="hljs markdown">private func setDataWithResponse(response: [<span class="hljs-string"><span class="hljs-string">AnyObject</span></span>]) { var data = [<span class="hljs-string"><span class="hljs-string">DRHTableViewDataModelItem</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>) for item in response { if let drhTableViewDataModelItem = DRHTableViewDataModelItem(data: item as? [String: String]) { data.append(drhTableViewDataModelItem) } } }</code> </pre> <br>  After the completion of the for loop, we will have a ready-filled array of <i>DRHTableViewDataModelItem</i> .  How now to transfer this array to the <i>TableView</i> ? <br><br>  <b>Part 4: Delegate</b> <br><br>  First create the <i>DRHTableViewDataModelDelegate</i> delegate <i>protocol</i> in the <i>DRHTableViewDataModel.swift</i> file immediately above the <i>DRHTableViewDataModel</i> class <i>declaration</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewDataModelDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ }</code> </pre> <br>  Inside this protocol we will also create two methods: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">protocol</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewDataModelDelegate</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didRecieveDataUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: [DRHTableViewDataModelItem])</span></span></span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didFailDataUpdateWithError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error: Error)</span></span></span></span> }</code> </pre> <br>  <i>The key word ‚Äúclass‚Äù in the protocol limits the applicability of the protocol to class types (excluding structures and enumerations).</i>  <i>This is important if we are going to use a weak reference to the delegate.</i>  <i>We must be sure that we will not create a cycle of strong links between the delegate and the delegated objects, so we use a weak link (see below)</i> <br><br>  Next, add an optional weak variable to the <i>DRHTableViewDataModel</i> class: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">weak</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> delegate: <span class="hljs-type"><span class="hljs-type">DRHTableViewDataModelDelegate?</span></span></code> </pre> <br>  Now we need to add a delegate method.  In this example, we need to pass the Error error, if the data request fails, in the case of a successful request, we will create an array of data.  The error handler method is inside the <i>requestData</i> method <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> DRHTableViewDataModel { func requestData() { // code <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> request data <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> API <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">local</span></span> <span class="hljs-type"><span class="hljs-type">JSON</span></span> file will go here // this two vars were returned <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> wherever: // var response: [AnyObject]? // var error: Error? <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let error = error { delegate?.didFailDataUpdateWithError(error: error) } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> let response = response { // parse response <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> [DRHTableViewDataModelItem] setDataWithResponse(response: response) } } }</code> </pre> <br>  Finally, add the second delegate method to the end of the <i>setDataWithResponse</i> method: <br><br><pre> <code class="hljs markdown">private func setDataWithResponse(response: [<span class="hljs-string"><span class="hljs-string">AnyObject</span></span>]) { var data = [<span class="hljs-string"><span class="hljs-string">DRHTableViewDataModelItem</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>) for item in response { if let drhTableViewDataModelItem = DRHTableViewDataModelItem(data: item as? [String: String]) { data.append(drhTableViewDataModelItem) } } delegate?.didRecieveDataUpdate(data: data) }</code> </pre> <br>  Now we are ready to transfer the data to <i>tableView</i> . <br><br>  <b>Part 5: Data Mapping</b> <br><br>  With the <i>DRHTableViewDataModel,</i> we can fill our <i>tableView with</i> data.  First we need to create a link to the <i>dataModel</i> inside the <i>DRHTableViewController</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dataSource = <span class="hljs-type"><span class="hljs-type">DRHTableViewDataModel</span></span>()</code> </pre> <br>  Next, we need to make a data request.  I'll do it inside <i>ViewWillAppear</i> so that the data is updated each time the page opens. <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewWillAppear</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">_</span></span></span></span><span class="hljs-function"><span class="hljs-params"> animated: Bool)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.viewWillAppear(<span class="hljs-literal"><span class="hljs-literal">true</span></span>) dataSource.requestData() }</code> </pre> <br>  <i>This is a simple example, so I query the data in viewWillAppear.</i>  <i>In a real application, this will depend on many factors, such as data caching time, use of the API, and application logic.</i> <br><br>  Next, set the delegate to self, in the <i>ViewDidLoad</i> method: <br><br><pre> <code class="hljs objectivec">dataSource.delegate = <span class="hljs-keyword"><span class="hljs-keyword">self</span></span></code> </pre> <br>  You will see the error again, because <i>DRHTableViewController</i> does not yet implement the <i>DRHTableViewDataModelDelegate</i> function.  Correct this by adding the following code to the end of the file: <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewDataModelDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didFailDataUpdateWithError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error: Error)</span></span></span></span> { } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didRecieveDataUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(data: [DRHTableViewDataModelItem])</span></span></span></span> { } }</code> </pre> <br>  And finally, we need to handle <i>didFailDataUpdateWithError</i> and <i>didRecieveDataUpdate events</i> : <br><br><pre> <code class="hljs swift"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extension</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewController</span></span></span><span class="hljs-class">: </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DRHTableViewDataModelDelegate</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">func</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">didFailDataUpdateWithError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(error: Error)</span></span></span></span> { <span class="hljs-comment"><span class="hljs-comment">// handle error case appropriately (display alert, log an error, etc.) } func didRecieveDataUpdate(data: [DRHTableViewDataModelItem]) { dataArray = data } }</span></span></code> </pre> <br>  As soon as we initialize our local <i>dataArray with the data</i> , we are ready to update the table.  But instead of doing this in the <i>didRecieveDataUpdate</i> method, we use the browser's <i>dataArray</i> property: <br><br><pre> <code class="hljs markdown">fileprivate var dataArray = [<span class="hljs-string"><span class="hljs-string">DRHTableViewDataModelItem</span></span>](<span class="hljs-link"></span><span class="hljs-link"></span>) { didSet { tableView?.reloadData() } }</code> </pre> <br>  The code inside <i>didSet</i> will be executed immediately after the <i>dataArray is</i> initialized, that is, exactly when we need to. <br><br>  That's all!  You now have a working <i>tableView</i> prototype, with an individually configured table cell and initialized data.  And you don't have any <i>tableViewController</i> classes with a few thousand lines of code.  Each block of code you have created is reusable and can be reused anywhere in the project, which gives undeniable advantages. <br><br>  For your convenience, you can view the full project code at the following <a href="https://github.com/Stan-Ost/DRHTableViewTutorial/tree/master/DRHTableViewTutorial">link</a> on Github. </div><p>Source: <a href="https://habr.com/ru/post/354326/">https://habr.com/ru/post/354326/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354312/index.html">How to optimize power consumption in iOS</a></li>
<li><a href="../354314/index.html">Roskomnadzor‚Äôs locks in the Telegram case reached the mining pools</a></li>
<li><a href="../354318/index.html">Hypothesis parameters</a></li>
<li><a href="../354322/index.html">Flask Mega-Tutorial, Part XXI: User Notifications</a></li>
<li><a href="../354324/index.html">Make Windows slower! Part One: File Access</a></li>
<li><a href="../354328/index.html">HOPE X. Conference "Breaking the elevator: from the basement to the penthouse." Part 1. "Elevator equipment"</a></li>
<li><a href="../354332/index.html">Edimax Office1-2-3 and what it is eaten with</a></li>
<li><a href="../354334/index.html">How we build DevOps in a team of 125 developers</a></li>
<li><a href="../354336/index.html">Technical diary: the second half year of the development of a new mobile PvP</a></li>
<li><a href="../354338/index.html">Miners will not pass</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>