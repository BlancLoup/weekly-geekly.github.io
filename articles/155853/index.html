<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Take advantage of the built-in PHP server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of the coolest innovations in php 5.4 is a built-in server designed specifically for development and testing. Now you can write and test your code...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Take advantage of the built-in PHP server</h1><div class="post__text post__text-html js-mediator-article">  One of the coolest innovations in php 5.4 is a built-in server designed specifically for development and testing.  Now you can write and test your code without having a full-fledged web server - just start the built-in server, test your code, and turn it off when you're done. <br>  The server also provides the opportunity for creative use.  For example, you can distribute a portable web application on CD or USB, or even as a desktop application created in PHP without using GTK or other graphical libraries. <br><a name="habracut"></a><br>  The PHP manual emphasizes that the built-in server is designed for development and it is recommended not to use it on the combat server.  There are no INI directives responsible for the server (except for coloring the output in the console), and it seems that the main idea of ‚Äã‚Äãthe documentation: ‚Äúwe now also have a Web server, leave us alone‚Äù. <br>  Despite this, I believe that embedded server can be a valuable tool for development and testing.  For example, on my machine I use the pre-installed Apache with a custom configuration that is suitable for me, but sometimes I want to try some new Web applications.  With the embedded web server, I can test the application directly from the ‚Äúdownloads‚Äù folder or temporary folder and move it to a normal environment only when it is needed. <br>  But for a start, this is not so easy, because many written applications use .htaccess and mod_rewrite.  But I'm sure that someone (maybe one of you, why not?) Will write an adapter for this, and I would like to be the first to test it. <br>  In this article I will explain some basic examples of using an embedded server and show you how to make it useful for development and testing. <br><h4>  We use the built-in server </h4><br>  So, to use the server, we need php 5.4 or higher.  To check the PHP version, run: <br><pre><code class="bash hljs">php -v</code> </pre> <br>  You can also determine if the server is available in your build by running: <br><pre> <code class="bash hljs">php -h</code> </pre><br>  and find the description of the "-S" and "-t" parameters, which are used only for the server. <br>  To check the server, you can create an index.php file in the current directory that will contain a call to the phpinfo () function and then start the server: <br><pre> <code class="bash hljs">[ec2-user@ip-10-229-67-156 ~]$ php -S 127.0.0.1:8080 PHP 5.4.0RC7 Development Server started at Fri Feb 26 18:49:29 2012 Listening on 127.0.0.1:8080 Document root is /home/ec2-user Press Ctrl-C to quit.</code> </pre><br>  And now you can see the content sent by the embedded web server: <br><img src="https://habrastorage.org/storage2/75e/ac5/2a1/75eac52a156e2a83a82b9be88175305f.jpg" alt="image"><br>  Each client request will be written to the console: <br><pre> <code class="bash hljs">[Sun Feb 26 18:55:30 2012] 80.180.55.37:36318 [200]: / [Sun Feb 26 18:56:23 2012] 80.180.55.37:36584 [200]: /</code> </pre><br>  Returning back, let's analyze the command line parameter "-S", which is used to specify the address from which the server will be accessible.  Possible values: <br>  <b>localhost</b> - the server will be accessible only from the local machine, <br>  <b>0.0.0.0</b> - on any machine interface, <br>  <b>Any external or gray IP</b> - only on the specified IP <br>  The "-t" parameter sets the specified directory "directory root".  For example: <br><pre> <code class="bash hljs">[ec2-user@ip-10-229-67-156 ~]$ php -S &lt;localhost or your public IP&gt;:8090 -t /home/ec2-user/public</code> </pre><br>  Besides,.  You can specify the name of a specific file router.  For example: <br><pre> <code class="bash hljs">[ec2-user@ip-10-229-67-156 ~]$ php -S &gt;localhost or your public IP&gt;:8080 -t /home/ec2-user/public public/index.php</code> </pre><br>  The output of this router will be parsed and executed by the server.  A simple example: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $extensions = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">"php"</span></span>, <span class="hljs-string"><span class="hljs-string">"jpg"</span></span>, <span class="hljs-string"><span class="hljs-string">"jpeg"</span></span>, <span class="hljs-string"><span class="hljs-string">"gif"</span></span>, <span class="hljs-string"><span class="hljs-string">"css"</span></span>); $path = parse_url($_SERVER[<span class="hljs-string"><span class="hljs-string">"REQUEST_URI"</span></span>], PHP_URL_PATH); $ext = pathinfo($path, PATHINFO_EXTENSION); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($ext, $extensions)) { <span class="hljs-comment"><span class="hljs-comment">// let the server handle the request as-is return false; } echo "&lt;p&gt;Welcome to PHP&lt;/p&gt;";</span></span></code> </pre><br>  If the script returns FALSE, then the requested URI will be processed by the server that will issue the requested resource, or will return a 404 error.  If the script returns anything else, the output of the script is passed to the client. <br>  Although this approach gives us more control, there are a few things you should know.  First, the PHP server gives only a minimal set of HTTP headers: <br><pre> <code class="bash hljs">Connection: closed Content-Type: text/html Host: aws-dev-01.vtardia.com X-Powered-By: PHP/5.4.0RC7</code> </pre>  D <br>  Compare this with the headers returned by the Apache server: <br><pre> <code class="bash hljs">Accept-Ranges: bytes Connection: Keep-Alive Content-Length: 631 Content-Type: text/html Date: Sat, 04 Feb 2012 18:24:42 GMT Etag: <span class="hljs-string"><span class="hljs-string">"bbb99-277-4ace8c5470a40"</span></span> Keep-Alive: timeout=15, max=100 Last-Modified: Wed, 14 Sep 2011 15:54:09 GMT Server: Apache/2.2.21 (Unix) DAV/2</code> </pre><br>  If your application uses headers, then it should take into account the difference in the development-environment and in production. <br>  Secondly, the embedded server has another SAPI (Server API).  Thus, by routing in index, php you can determine the script to be accessed on a test or combat server.  php_sapi_name () will return the ‚Äúcli-server‚Äù on the embedded server: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (php_sapi_name() == <span class="hljs-string"><span class="hljs-string">"cli-server"</span></span>) { <span class="hljs-comment"><span class="hljs-comment">// running under built-in server so // route static assets and return false $extensions = array("php", "jpg", "jpeg", "gif", "css"); $path = parse_url($_SERVER["REQUEST_URI"], PHP_URL_PATH); $ext = pathinfo($path, PATHINFO_EXTENSION); if (in_array($ext, $extensions)) { return false; } }</span></span></code> </pre><br>  There is one special INI directive - cli_server.color.  This directive returns the colored output to the console.  Create an empty file called <b>cli-server.ini</b> and paste this line: <br><pre> <code class="bash hljs">cli_server.color = on</code> </pre><br>  You can create a unique environment configuration for your server by specifying the necessary directives in your INI file.  Undeclared directives will accept default values.  Now we have declared only one directive - <b>cli_server.color</b> . <br>  Start the server with the parameter "-c" indicating the INI file: <br><pre> <code class="bash hljs">[ec2-user@ip-10-229-67-156 ~]$ php -S localhost -c cli-server.ini</code> </pre><br>  If your terminal supports colors, then you can see the ‚Äúcolor‚Äù output in the console.  200 status will be highlighted in green, 404 in orange, and script errors will be highlighted in red. <br><h4>  Create a personal server </h4><br>  Now that you know everything you need to know about the built-in server, let's do something cool.  Create your own portable server! <br>  I will start with the following structure of our application: <br><img src="http://habrastorage.org/storage2/7c8/481/6a7/7c84816a7c395af5b240fcc4708c8209.jpg"><br>  The ‚Äúlibrary‚Äù folder contains the application code, ‚Äúpublic‚Äù is the root directory, contains index.php and several static files.  Particular attention in this guide will be given to the folder "server", and therefore our application will consist of a simple "Hello Word!" And a few pictures and css. <br>  Our goal is to be able to start the server from the application directory with one command, and our server will take care of routing, HTTP headers and errors. <br><pre> <code class="bash hljs">[ec2-user@ip-10-229-67-156 myapp]$ ./start.sh</code> </pre><br>  Let's look at the startup script: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#! /bin/bash INIFILE="$(pwd)/server/server.ini" DOCROOT="$(pwd)/public" ROUTER="$(pwd)/server/router.php" HOST=0.0.0.0 PORT=8080 PHP=$(which php) if [ $? != 0 ] ; then echo "Unable to find PHP" exit 1 fi $PHP -S $HOST:$PORT -c $INIFILE -t $DOCROOT $ROUTER</span></span></code> </pre><br>  I assume that the script is launched from the application directory, so INIFILE, DOCROOT, ROUTER are defined using pwd.  The path to php is determined using the which command.  If php was not found in user $ PATH, then the script will terminate with an error. <br>  This method works quite well, but let's give the user the opportunity to change any of the specified parameters from the command line, for example: <br><pre> <code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ ! -z <span class="hljs-variable"><span class="hljs-variable">$INIFILE</span></span> ]; <span class="hljs-keyword"><span class="hljs-keyword">then</span></span>    INIFILE=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$(pwd)</span></span></span><span class="hljs-string">/server/server.ini"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre><br>  Let's continue, the ‚Äúerrors‚Äù folder contains files for HTTP error messages.  Here is an example of the 403 error: although I used only HTML, the script will be included using the <b>include</b> , so you can use any php code: <br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!doctype html&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">lang</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"en"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>403<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>403: Forbidden<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span>Sorry, the requested resource is not accessible.<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now look at router.php.  The task of this file is to receive and manage all requests and transfer them to the server only if this file exists.  All error pages are displayed by connecting a template. <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-comment"><span class="hljs-comment">// Set timezone date_default_timezone_set("UTC"); // Directory that contains error pages define("ERRORS", dirname(__FILE__) . "/errors"); // Default index file define("DIRECTORY_INDEX", "index.php"); // Optional array of authorized client IPs for a bit of security $config["hostsAllowed"] = array(); function logAccess($status = 200) { file_put_contents("php://stdout", sprintf("[%s] %s:%s [%s]: %s\n", date("DM j H:i:s Y"), $_SERVER["REMOTE_ADDR"], $_SERVER["REMOTE_PORT"], $status, $_SERVER["REQUEST_URI"])); } // Parse allowed host list if (!empty($config['hostsAllowed'])) { if (!in_array($_SERVER['REMOTE_ADDR'], $config['hostsAllowed'])) { logAccess(403); http_response_code(403); include ERRORS . '/403.php'; exit; } } // if requesting a directory then serve the default index $path = parse_url($_SERVER["REQUEST_URI"], PHP_URL_PATH); $ext = pathinfo($path, PATHINFO_EXTENSION); if (empty($ext)) { $path = rtrim($path, "/") . "/" . DIRECTORY_INDEX; } // If the file exists then return false and let the server handle it if (file_exists($_SERVER["DOCUMENT_ROOT"] . $path)) { return false; } // default behavior logAccess(404); http_response_code(404); include ERRORS . "/404.php";</span></span></code> </pre><br>  In the first lines, I define some global parameters, such as DIRECTORY_INDEX, an error template directory.  The date_default_timezone_set () parameter must match the OS settings, otherwise there will be inconsistencies between the records in the log and on the server.  I also added a list of allowed IP addresses to increase security. <br>  The logAccess () function is necessary, because when the routing script accepts the request, the server log is ignored by default.  The function accepts only the status code, and the output format fully corresponds to the server format. <br>  Our first task is a security check.  If the client's IP is not in the array of allowed IPs, output an error message and exit the script.  We need to give a status code different from 200 and the function header () will not work in here, so we use the new function - http_response_code. <br>  If the client's IP is in the allowed IP array, then our next step is to get the requested path and file extension.  If the extension is empty, we assume that the user is requesting a folder and we are building the path using the first defined DIRECTORY_INDEX. <br>  Finally, if the requested file exists, we return FALSE, and allow the server to access the file.  If not, a 404 error message is displayed. <br><h4>  Summary </h4><br>  It's all.  As you can see, the php server is easy to use.  Our personal server is very simple.  The code can be optimized and included in more complex and functional classes.  Happy coding! <br><br>  <i>ps With pleasure I will accept criticism and remarks to transfer to lichku.</i> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/155853/">https://habr.com/ru/post/155853/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../155837/index.html">Plugin to record file editing process</a></li>
<li><a href="../155841/index.html">Course lectures "Startup". Peter Thiel. Stanford 2012. Session 3</a></li>
<li><a href="../155845/index.html">The network has flowed Citadel</a></li>
<li><a href="../155847/index.html">Something about garbage collection and generations</a></li>
<li><a href="../155851/index.html">Digital barrier</a></li>
<li><a href="../155857/index.html">Nokia introduced the Lumia 510 for $ 200</a></li>
<li><a href="../155859/index.html">Exercises for brain training</a></li>
<li><a href="../155865/index.html">Report from the Apple presentation on October 23</a></li>
<li><a href="../155867/index.html">Blog on node.js</a></li>
<li><a href="../155869/index.html">Internet thermometer or telemetry of a country house</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>