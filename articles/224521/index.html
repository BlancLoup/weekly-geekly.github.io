<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CC1101 running a PIC controller or building a peer-to-peer network for a radio engineer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Prehistory 
 Some time ago, I participated in the design of a single data collection network. The network used the 869 MHz band and the SimpliciTI pro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CC1101 running a PIC controller or building a peer-to-peer network for a radio engineer</h1><div class="post__text post__text-html js-mediator-article"><h6>  Prehistory </h6><br>  Some time ago, I participated in the design of a single data collection network.  The network used the 869 MHz band and the <a href="http://www.ti.com/tool/SIMPLICITI%3FkeyMatch%3Dsimpliciti%26tisearch%3DSearch-EN">SimpliciTI</a> protocol.  By its structure, the network was essentially peer-to-peer with the central node of data accumulation.  However, the network was also provided with the option of data retransmission, although it was rather an auxiliary one. <br><br>  It didn‚Äôt go further than the prototypes, although the case was very serious, right up to EMC certification. <br>  One of the reasons for the failure was that the staff programmer failed to fully master the control of the <a href="http://www.ti.com/product/cc1101%3FkeyMatch%3DCC1101%26tisearch%3DSearch-EN">CC1101</a> . <br><br>  The thing is, the SimpliciTI package, taken from Texas Instruments, already has some default settings.  These settings are far from optimal for the task of rarely collecting data (once a month) on a network that is located in a house with reinforced concrete walls, and is also affected by interference from various sources. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      From the very beginning it was clear that the parameters should be, say, such, and not such.  To set the parameters in the CC1101 there are a number of registers.  This is all described, somewhat confused, but in the end, after some effort, it is mastered. <br><br>  And so <a href="http://www.ti.com/tool/smartrftm-studio%3FkeyMatch%3DSmartRF%26tisearch%3DSearch-EN">SmartRF Studio</a> is taken, the necessary parameters are set in it, checked.  After successful verification, these parameters would need to be transferred to real hardware.  To do this, an application using SimpliciTI makes settings at the beginning of the program. <br><br>  But it was not there!  After a successful start, somewhere on some function from the SimpliciTI package, a rollback occurs to the parameters that were set by the developers of the package.  And the programmer never found where this is going.  In particular, it never managed to launch packets with a fixed length and FEC.  And without the latter, the operation of the system in terms of signal fading and interference is almost impossible. <br><a name="habracut"></a><br><h6>  Naked CC1101 with PIC </h6><br>  The CC1101 has a built-in controller, so it can be controlled with the help of a quite clear command system via the SPI interface. <br><br>  There was an idea, but what if you use the capabilities of the CC1101 itself in its pure form?  Of course, it was not about creating something like One-Net, but about some elementary tools for building a peer-to-peer network with full use of the capabilities of the CC1101 chip. <br><br>  Since the standard radio engineer is for the most part far from programming controllers, the PIC platform was chosen, since for these controllers there is such a language as <a href="http://melabs.com/">PICBASIC</a> . <br><br>  I don‚Äôt know if C is taught today for radio engineers, but earlier they taught BASIC exactly, and it‚Äôs not a question to study it.  Of course, TCP / IP cannot be written on BASIC, but simple actions like sending something somewhere to an address or accepting something, and even more so, this language perfectly describes reading registers through SPI.  And the entire dialogue with CC1101 is a continuous exchange on SPI with registers and nothing else! <br><br><h6>  Practical implementation </h6><br>  Such a board based on PIC18F2455 was assembled. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/61a/9de/ee3/61a9deee33d2d26c7898008aaaa19c7d.jpg" alt="image"><br><br>  It must be said that this prototype was assembled only to check the quality of communication when changing the parameters of the radio channel, so there are no interface connectors for connecting any sensors or other external devices.  As can be seen in the picture, there are: <br>  - indicator LED (2 color); <br>  - sound emitter; <br>  - 32768 Hz quartz for a real-time clock; <br>  - USB interface; <br>  - chip antenna; <br>  - battery rechargeable from USB. <br><br>  The scheme is presented <a href="http://www.bosco-lab.com/pdf/CC1101_Tester.PDF">here</a> . <br><br>  The circuit does not have a power switch, the antenna is shown conditionally. <br><br>  This post does not provide a complete program, but it did not use absolutely all the features of the CC1101. <br><br>  In particular, the WOR mode was not involved.  The standby mode with the signal presence check was implemented directly with the PIC18F2455 and the real-time timer. <br><br>  The main program is, of course, the exchange of SPI.  On the other hand, when receiving, an interrupt to start processing should be triggered.  An interrupt by the presence of a received packet is triggered by a GDO0 signal, appropriately configured.  In order not to complicate the interrupt handler, the exchange over SPI is made in the polling variant based on the example presented <a href="http://melabs.com/samples/PBP-mixed/spimast.htm">here</a> . <br><br>  The main block of routines for managing the CC1101 via SPI is as follows: <br><br>  <i>wt_rd_reg:</i> <i><br></i>  <i>'Read / Write Register</i> <i><br></i>  <i>'</i> <i><br></i>  <i>CS =% 0</i> <i><br></i>  <i>pauseus 300</i> <i><br></i>  <i>SSPBUF = NOW</i> <i><br></i>  <i>Go clear</i> <i><br></i>  <i>a [0] = SSPBUF 'read the first byte</i> <i><br></i>  <i>SSPBUF = DAT '</i> <i><br></i>  <i>Go clear</i> <i><br></i>  <i>a [1] = SSPBUF 'read second byte</i> <i><br></i>  <i>CS =% 1</i> <i><br></i>  <i>return</i> <i><br><br></i>  <i>wt_rd_fifo:</i> <i><br></i>  <i>'Read-write FIFO</i> <i><br></i>  <i>'</i> <i><br></i>  <i>SSPBUF = DAT</i> <i><br></i>  <i>Go clear</i> <i><br></i>  <i>d [i] = SSPBUF 'read response byte</i> <i><br></i>  <i>return</i> <i><br><br></i>  <i>sndstrobe:</i> <i><br></i>  <i>'Send control strobe to CC1101</i> <i><br></i>  <i>'</i> <i><br></i>  <i>CS =% 0</i> <i><br></i>  <i>pauseus 300</i> <i><br></i>  <i>SSPBUF = NOW</i> <i><br></i>  <i>Go clear</i> <i><br></i>  <i>a [0] = SSPBUF 'read the first byte</i> <i><br></i>  <i>pauseus 800</i> <i><br></i>  <i>SSPBUF = SNOP 'empty</i> <i><br></i>  <i>Go clear</i> <i><br></i>  <i>a [1] = SSPBUF 'read second byte</i> <i><br></i>  <i>CS =% 1</i> <i><br></i>  <i>return</i> <i><br><br><br></i>  <i>let clear:</i> <i><br></i>  <i>IF SSPIF = 0 Then let clear 'wait for SPI interupt flag</i> <i><br></i>  <i>PauseUs 25 '25uS fudge factor</i> <i><br></i>  <i>SSPIF = 0 'reset flag</i> <br><br>  Here: <br>  NOW is the current command, <br>  DAT - current data <br>  d [i] - an array for storing data from a FIFO, cannot be less than the length of a FIFO, <br>  CS - chip select. <br><br>  Pauses are set experimentally.  It is possible that other delays will require different delays or they can be significantly reduced. <br><br>  For command codes you need to look at the basic <a href="http://www.ti.com/lit/gpn/cc1101">description</a> . <br><br>  Register values ‚Äã‚Äãwere recorded in the EEPROM PIC18F2455, from where they were read as needed, and the address in the EEPROM corresponds to the register address, which makes it easy to load the necessary values ‚Äã‚Äãand always check the settings. <br><br><h6>  Practical results </h6><br>  After the program was written, to the great joy it turned out that ALL functions could be started, including hardware filtering, whitening, FEC, etc.  etc.  Transfer of packages went from a half-kick. <br><br>  The main thing is that it is clearly understood where a parameter changes, and how it happens, and what to do with it, and how to apply it.  Using PICBASIC, everything is clear to the radio engineer without any knowledge of the C language and special skills in writing embedded applications. <br><br>  There was no goal to lay out the program (s) in full.  If it is interesting, it can be posted, but not on this site.  Actually, if it is burningly interesting, then you can even organize something like a library. <br><br><h6>  <u>References used</u> </h6><br>  1. <a href="http://www.ti.com/product/cc1101%3FkeyMatch%3DCC1101%26tisearch%3DSearch-EN">CC1101, all documentation</a> <br>  2. <a href="http://www.ti.com/tool/smartrftm-studio%3FkeyMatch%3DSmartRF%26tisearch%3DSearch-EN">SmartRF Studio</a> <br>  3. <a href="http://melabs.com/">Microengineering Labs, company website</a> <br>  4. <a href="http://www.bosco-lab.com/pdf/CC1101_Tester.PDF">CC1101_Tester, electrical circuit diagram</a> <br>  5. <a href="http://melabs.com/samples/PBP-mixed/spimast.htm">SPI, management in PICBASIC</a> <br>  6. <a href="http://www.ti.com/lit/gpn/cc1101">CC1101, datasheet</a> </div><p>Source: <a href="https://habr.com/ru/post/224521/">https://habr.com/ru/post/224521/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224509/index.html">Learn Three.js.Glava 1: Create our first 3D scene using Three.js</a></li>
<li><a href="../224511/index.html">Desktop on the palm</a></li>
<li><a href="../224515/index.html">Non-standard solutions to complex problems</a></li>
<li><a href="../224517/index.html">How to make friends with Android, Visual Studio and Parallels Desktop</a></li>
<li><a href="../224519/index.html">How not to get stuck in the wheel of failures and build the right business. Implementation of business processes</a></li>
<li><a href="../224523/index.html">Selection of RSA cipher parameters and possible consequences</a></li>
<li><a href="../224525/index.html">Creating a Zero Player Game using libgdx</a></li>
<li><a href="../224527/index.html">Why does Intel make an alliance with Rockchip?</a></li>
<li><a href="../224535/index.html">Ext JS 5: MVC, MVVM, etc</a></li>
<li><a href="../224537/index.html">Coursera experiments with on-demand model</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>