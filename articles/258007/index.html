<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HP P2000 G3 MSA Array System Firmware Update</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The HP MSA P2000 is a popular entry-level disk array from HP (actually Dothill). Simple, reliable, relatively inexpensive, with an acceptable speed of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HP P2000 G3 MSA Array System Firmware Update</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/7cc/4f6/7b7/7cc4f67b7bdb442e95df4b0251f678c6.png" alt="image"><br><br>  The HP MSA P2000 is a popular entry-level disk array from HP (actually Dothill).  Simple, reliable, relatively inexpensive, with an acceptable speed of work. <br>  In 2014, HP released a new line of arrays - HP MSA 1040/2040, <a href="http://habrahabr.ru/company/hp/blog/183530/">promising to remove the old version from sales</a> . <br>  But while no one is in a hurry to decommission old systems, they are ready to serve more than one year. <br>  In this article I would like to share some of the nuances that arise when upgrading an array and updating the firmware. <br><a name="habracut"></a><br><h5>  <b>Choose the right shelf</b> </h5><br>  You can increase the capacity of the array by connecting one or more additional disk shelves. <br>  Despite the fact that the array is discontinued, additional shelves are available for order.  HP offers several shelves with SAS interfaces: <br><br>  1. HP D2600 (AJ940A) Hard Drives LFF, 3.5 ": 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/8b0/729/70b/8b072970b7ec4ff19dcb49a63f3e6409.png" alt="image"><br><br>  2. HP D2700 (AJ941A), SFF Hard Drives, 2.5 ": <br><br><img src="https://habrastorage.org/files/b2d/31a/f45/b2d31af45bd049469e5ad0d8fb9936d1.png" alt="image"><br><br>  Often, these shelves are referred to as D2600 / D2700, from which it can be concluded that this is the same model, but with a different form factor of hard drives.  Perhaps it is, but!  The HP MSA P2000 is officially only compatible with the HP D2700 disk shelf.  Not so easy to find this information.  This non-obvious point follows from the description of the HP P2000 array and the modest mention in the ‚ÄúHP D2000 Disk Enclosures Quick Specs‚Äù document: <blockquote>  "The HP P2000 G3 Modular Smart Array System family is also supported." <br></blockquote><br>  From this we can conclude that the shelf D2600 is officially incompatible with the HP P2000.  But, <b>tested in practice</b> , in fact, quite workable.  Do not buy this shelf, if the array is still under warranty, and you do not want unnecessary problems. <br><br><h5>  <b>Firmware upgrade</b> </h5><br>  The current version of the firmware of the array is <a href="http://h20565.www2.hp.com/hpsc/swd/public/detail%3Fsp4ts.oid%3D4118563%26swItemId%3DMTX_8253fde8ed454cdf9d477d29df%26swEnvOid%3D4064">TS251P006-02 dated September 9, 2014</a> . <br><br><h6>  <b>Do not install firmware from another model.</b> </h6><br>  From the HP documentation, it follows that up to TS230 for each model of the array (FC / iSCSI, iSCSI, SAS) separate firmware was released. <br><blockquote>  IMPORTANT: HP P2000 G3 firmware for all HP P2000 firmware for all controllers The control system has been used for all of the P2000 G3 MSA controllers. </blockquote><br>  It would seem, why bother with such an old version at all?  You will find out when the update utility refuses to flash directly from your version to the latest, suggesting you first flash the intermediate one. <br><br><img src="https://habrastorage.org/files/a66/529/993/a6652999399742d3beaccb83e176dfbb.png" alt="image"><br><br>  If you do not want to trust the master, but will download the intermediate firmware yourself, carefully read the section ‚ÄúInstallation Instructions‚Äù.  Having met the warning: <br><blockquote>  NOTE: This is an upgrade for the HP StorageWorks P2000 G3 MSA FC and FC / iSCSI (combo) for the P2000 / MSA2000 iSCSI MSA arrays . </blockquote><br>  think about whether you are going to pour. <br><br><h6>  <b>Flash twice</b> </h6><br>  Also, an unpleasant surprise awaits the owners of the array with one controller and firmware up to TS230.  Most likely, the array will not be able to directly upgrade to the latest version.  The flasher hangs with the message <a href="http://h30499.www3.hp.com/t5/Disk-Array/P2000-G3-firmware-upgrade-stuck-on-Restarting-MC/td-p/6708415">"Restarting MC ... Please Wait ..."</a> .  Presumably, this is due to the fact that the script is trying to restart the second non-existent controller. <br><br>  The way out of this situation is the following - check via telnet that the controller is still alive, kill the flash driver process.  After that, flush to TS230-008 (B), and only after that to the latest version. <br>  Do not like the extra risk - immediately shake in two stages, first TS230-008 (B), then TS251. <br><br><h6>  <b>Problems, problems, problems</b> </h6><br>  Do you think that problems arise only for those who saved on the purchase of a second controller?  Then it will be interesting to you to read about the <a href="http://www.petenetlive.com/KB/Article/0000248.htm">"Infinite upgrade loop"</a> .  Not scared?  Then look through the selection of documents <a href="http://h20566.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/troubleshootResults/%3Fjavax.portlet.begCacheTok%3Dcom.vignette.cachetoken%26javax.portlet.endCacheTok%3Dcom.vignette.cachetoken%26javax.portlet.prp_e97ce00a6f76436cc859bfdeb053ce01%3Dwsrp-navigationalState%253Daction%25253Ddoclist%25257Cviewall%25253Dtrue%26javax.portlet.tpst%3De97ce00a6f76436cc859bfdeb053ce01%26sp4ts.oid%3D4118559%26ac.admitted%3D1431615077220.876444892.199480143">"Troubleshooting"</a> . <br>  Favorites: <br><ul><li>  <a href="http://h20565.www2.hp.com/hpsc/doc/public/display%3FdocId%3Demr_na-c03153230%26lang%3Den%26cc%3Dus">HP P2000 / MSA2000 SAN Array Systems - Unable to Access Management Controller: MC and SC Unable to Communicate</a> </li><li>  <a href="http://h20565.www2.hp.com/hpsc/doc/public/display%3Fsp4ts.oid%3D4118559%26docId%3Demr_na-c03190947%26docLocale%3Den_US">HP Storageworks P2000 G3 MSA - MSA Management Controller Failed to Upgrade: ‚ÄúController version Mismatch !!!</a>  <a href="http://h20565.www2.hp.com/hpsc/doc/public/display%3Fsp4ts.oid%3D4118559%26docId%3Demr_na-c03190947%26docLocale%3Den_US">Flash Status is 7 "</a> </li></ul><br><h5>  <b>You never know what you can do till you try</b> </h5><br>  Having come to terms with possible difficulties, you can proceed to upgrade.  Detailed instructions can be found in the section ‚ÄúInstallation Instructions‚Äù for each firmware file. <br><br><img src="https://habrastorage.org/files/697/032/554/6970325548ad4baf97c33e3d1b1870fa.png" alt="image"><br><br>  HP strongly recommends updating from Smart Component Updater, an update utility in the form of an .exe file (flash driver).  It is possible to flash from the CLI (command line interface) or the Storage Management Utility (web-based array management interface).  The last two possibilities will be spare, in case of impossibility of firmware from SCU. <br><br>  A typical update sequence will be as follows: <br><ol><li>  Download the update file.  Check the hash (for example, the fciv.exe utility). </li><li>  Conduct an update from a computer on the same subnet as the controller in the nearest switch, so that network errors or the firewall do not interrupt the process. </li><li>  Pre-install the <a href="http://h20564.www2.hp.com/hpsc/swd/public/detail%3FswItemId%3DMTX_8de10954d645450f9e3c0d015d">driver to control the controller</a> from the command line via a USB cable in case of loss of network access. </li><li>  Enable the Telnet and FTP protocols in the array.  SSH will not work. </li><li>  Reduce the load on the array.  In the case of an array with one controller, the disks will be inaccessible, since the controller will be repeatedly rebooted. </li><li>  Run the flash driver, follow the wizard‚Äôs instructions.  Firmware is a long process, each controller is stitched for 30 minutes, have patience. </li></ol><br><br>  After updating the controller, it is desirable to update and firmware hard drives. <br><br>  Good luck. <br><br>  UPD 2018-10-15: After updating the P2000 G3 controller on the TS252P005, the shelf in the interface was lit up with Warning, but everything is still working. <br><div class="spoiler">  <b class="spoiler_title">and that's why</b> <div class="spoiler_text"> Due to the absence of a second controller, the IO-module B lights up red. <br>  I tried to disable it, but it did not work: <br> <code>set expander-phy encl 2 controller B type ingress phy 0 disabled <br> # set expander-phy encl 2 controller B type ingress phy 0 disabled <br> Error: PHY control is not supported for the specified enclosure.</code> <br> </div></div><br><br>  Useful links: <br><ul><li>  <b><a href="http://h20564.www2.hp.com/hpsc/swd/public/readIndex%3Fsp4ts.oid%3D4118572%26swLangOid%3D8%26swEnvOid%3D4064">Array software</a></b> </li><li>  <b><a href="http://h20566.www2.hp.com/portal/site/hpsc/template.PAGE/public/psi/manualsResults/%3Fsp4ts.oid%3D4118559%26spf_p.tpst%3DpsiContentResults%26spf_p.prp_psiContentResults%3Dwsrp-navigationalState%253Daction%25253Dmanualslist%25257Cviewall%25253Dtrue%25257Clang%25253Den%26javax.portlet.begCacheTok%3Dcom.vignette.cachetoken%26javax.portlet.endCacheTok%3Dcom.vignette.cachetoken">Documentation</a></b> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/258007/">https://habr.com/ru/post/258007/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257981/index.html">Automatically Testing JavaFX Applications</a></li>
<li><a href="../257985/index.html">Development of MMO RPG - a practical guide. Server (Part 1)</a></li>
<li><a href="../257991/index.html">Features of API development on symfony2</a></li>
<li><a href="../258003/index.html">Artificial Intelligence in Wolfram Language: Image Identification Project</a></li>
<li><a href="../258005/index.html">Development for Microsoft SQL Server (and not only): version control, continuous integration and procedures - as we do</a></li>
<li><a href="../258009/index.html">Lock for the designer</a></li>
<li><a href="../258015/index.html">Ensuring backward compatibility of .NET applications when using WinRT</a></li>
<li><a href="../258019/index.html">Asm.js came to Chakra and Microsoft Edge</a></li>
<li><a href="../258023/index.html">To the question of fitting resistors</a></li>
<li><a href="../258025/index.html">Part 2 - Synesis. Why is the demonstration of video analytics in offices so different from the real work in life?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>