<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RAID-4 / RAID-DP - turning disadvantages into advantages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I wrote in my last post that Snapshots were, at the time of the appearance of NetApp systems, their main features, I kind of lied (and partially ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RAID-4 / RAID-DP - turning disadvantages into advantages</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/bc/06/bc06b37193d5bf9d0d75a036380d2072.jpg" alt="image"><br>  When I wrote in my last post that Snapshots were, at the time of the appearance of NetApp systems, their main features, I kind of lied (and partially just forgot), because at that time they had at least one more feature that markedly One of the ‚Äútraditional‚Äù storage systems among them is ‚ÄúRAID type 4‚Äù. <br>  This is all the more interesting since no one else uses this type of RAID for use in disk storage systems. <br>  Why was this type chosen, what are its advantages, and why no one else uses this type of RAID today? <br><a name="habracut"></a><br>  For those who are far from the theory of raid construction, let me remind you that of the six standard RAID types described in the scientific work that initiated their use, RAID type 2 (with the protection of the Hamming code) was not used in ‚Äúwildlife‚Äù, remaining an amusing theoretical exercise, RAID-1 (and its variant RAID-10, or, sometimes, like RAID-0 + 1) is data protection by automatic synchronous mirroring on a pair (or several pairs) of physical disks, and RAID-3, 4, and 5 (later RAID type 6 was added) - this is the so-called "RAID with interleaving and parity".  Between themselves, they differ in the way they organize and store parity data, as well as in the order in which data is interleaved.  In a well-known RAID-5, data alternates across disks along with parity information, that is, parity does not occupy a special disk. <br>  In RAID-3 and 4, a separate disk is allocated for parity information (Between 3 and 4, the difference in the size of an interleaved block is a sector in type 3 and a group of sectors, a block in type 4). <br><br><img src="https://habrastorage.org/storage/habraeffect/b1/4d/b14da12c47a43406f8ce9185fb1962d9.png" alt="image"><br><br>  RAID-4, that is, ‚Äúblock-wise RAID and parity on a dedicated disk,‚Äù has one important advantage.  It can be increased in size simply by adding physical disks to the RAID, and there is no need to rebuild the entire RAID, as is the case for RAID-5, for example.  If you use 5 disks for data (and one for parity) in RAID-4, then in order to increase its capacity, you can simply add one, two, and so on disks to it, and the capacity of the RAID array will immediately increase by volume of added disks.  No lengthy process of rebuilding an inaccessible RAID array, as in the case of RAID-5, is necessary.  Obvious, and very convenient in practice advantage. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage/habraeffect/0c/f1/0cf1d136141919e8891b25f00eba0cd5.png" alt="image"><br><br>  Why, then, do not use RAID-4 everywhere instead of RAID-5? <br>  It has one, but very serious problem - write performance. <br>  The fact is that each block write operation on RAID disks is accompanied by a record for updating the parity block on the Parity disk.  This means that no matter how much we add to our disk array, between which I / O will be parallelized, it will still rest on a single disk - the parity disk.  In fact, the performance of RAID-4, in its "classic" application, is limited by the performance of the Parity disk.  Until this disk has recorded the update of the contents of the parity blocks lying on it, all other disks storing data are spinning and waiting for the completion of this operation. <br><br>  In part, this problem was solved in RAID-5, where parity blocks are also parallelized on disks, like data blocks, and the bottleneck problem on parity disk was partially solved, which, however, does not mean that RAID-5 is deprived of all disadvantages, rather the opposite, is the worst type of RAID of all widely used today, suffering from both unreliability and poor performance, which I wrote about in the article <a href="http://habrahabr.ru/blogs/hardware/78311/">‚ÄúWhy is RAID-5 a mustdie?‚Äù</a> . <br><br>  Particularly focusing on performance issues (read about the reliability of the article above), it should be noted that RAID-5 has one, but very serious ‚Äúbirth injury‚Äù, initially structurally inherent in this type of RAID in general (types 3,4,5 and 6 - ‚Äúalternating with parity ") - low performance on an arbitrary (random) record.  This aspect is very important in real life, since the volumes of arbitrary, random in nature, records in the general storage traffic are quite significant (reaching 30-50%), and a drop in performance on the records directly affects the performance of the storage in general. <br><br>  This problem is ‚Äúsick‚Äù, I repeat, all ‚Äúclassic‚Äù storage systems using this type of RAID (3, 4, 5 and 6). <br>  Everything except NetApp. <br><br>  How did NetApp manage to solve the ‚Äúbottleneck‚Äù problem with the parity disk and the problem of poor performance with random write at once? <br>  Here we will again have to recall the structure of WAFL, which I have already written about earlier. <br>  As NetApp engineer <a href="http://blog.aboutnetapp.ru/archives/282">Kostadis Roussos</a> said about this: ‚ÄúAlmost every file system today lies on top of a RAID.  But only WAFL and RAID on NetApp at the same time know about each other so much to mutually use the opportunities and compensate each other‚Äôs shortcomings. ‚Äù  This is true, because for WAFL, the RAID level is just another logical data layout level inside the file system itself.  Let me remind you that NetApp does not use hardware RAID controllers, preferring to build RAID using its own file system (a similar approach later chose ZFS with its RAID-Z) <br><br>  What is this "mutual opportunity"? <br>  As you remember from my story about WAFL, it is designed in such a way that the data on it, once recorded, are not further overwritten.  If it is necessary to make changes to the contents inside an already recorded file, space is allocated in the free block space, the modified block is written there, and then the pointer to the contents of the old block is rearranged to the new block, which was empty and now carries the new contents. <br><br>  Such a write strategy allows us to turn a random entry into a sequential (sequental).  And if so, we can record as efficiently as possible - with a ‚Äúfull stripe‚Äù by preparing it beforehand, and collecting all the ‚Äúrewrites‚Äù aimed at different parts of the discs into one convenient area for recording.  That is, instead of rewriting individual blocks, recording in one step the finished, formed ‚Äústrip‚Äù of data, all of the time on all the RAID disks, including the previously calculated parity of the entire stripe to its corresponding disk.  Instead of three read-write operations, one. <br>  It's no secret that sequental operations are much faster and more convenient for the system than random operations. <br><br><img src="https://habrastorage.org/storage/habraeffect/68/f8/68f82cad6e700abbcd5c240e73081859.png" alt="image"><br><br><img src="https://habrastorage.org/storage/habraeffect/91/f9/91f930758a453f811fd4c81b50cc7360.png" alt="image"><br><br>  Writing a ‚Äúfull stripe‚Äù, that is, on all interleaved RAID disks, is the most desirable write algorithm for this type of RAID.  For this purpose, RAID-controllers increase the amount of cache memory, reaching on high-end systems very impressive sizes (and cost).  The larger the write cache in traditional arrays, and the longer the data block that comes from the server to write to the disk freezes, the more chances are there that once this cache is collected from such ‚Äúfull stripe‚Äù blocks, and it will be possible to drain on the disks as profitably as possible <br>  That is why write-back caches of RAID controllers tend to flush data onto disks less often, and they definitely need battery power supply to save their data blocks that are waiting for their turn in the cache. <br><br>  With the growth of disk volumes, NetApp, like all others, faced the need to provide increased reliability of RAID data storage.  For this reason, since 2005, RAID-DP, NetApp's implementation of RAID-6, is the recommended, preferred, and generally ‚Äúdefault configuration‚Äù.  In this, NetApp also excels because RAID-DPD, protecting, like RAID-6, from data loss when two disks are lost at once (for example, a failure during a rebuild of a previously failed disk), does not degrade performance, unlike RAID- 6, in comparison with RAID-5 or RAID-10. <br><br>  The reasons for this are the same.  The situation with "other vendors" with RAID-6, in comparison with RAID-5, is even worse.  It is believed that the performance of RAID-6 falls compared with RAID-5 by 10-15%, and compared to RAID-10 by 25-35%.  Now we need to carry out not only the read-write of one parity block, but we must do this for two different groups of blocks. <br>  However, RAID-DP still does not need this; the reasons for this are still the same ‚Äî randomly writing to an arbitrary place in the array is transformed by WAFL into sequential writing into a pre-allocated space, and such writing is much faster and more profitable. <br><br>  Confirming that the use of RAID-4 (and its version - RAID-DP, analog of RAID-6) on NetApp systems does not objectively lead to performance degradation - authoritative tests of the performance of SAN disk systems (Storage Performance Council, <a href="http://www.storageperformance.org/results/benchmark_results_spc1">SPC-1 / SPC-1E</a> ) and NAS ( <a href="http://www.spec.org/sfs2008/results/sfs2008.html">SPECsfs2008</a> ), which NetApp demonstrates on RAID-4 (and RAID-DP since 2005). <br>  Moreover, NetApp systems with RAID-DP compete on equal terms with systems with RAID-10, that is, they show performance significantly higher than usual for ‚ÄúRAID with interleaved and parity‚Äù, while maintaining high space efficiency, because, as you know, on RAID -10 can be used for data of only 50% of purchased capacity, while on RAID-DP, with higher reliability, but comparable to RAID-10 speed, and for a standard group size, more than 87% of available data space is obtained. . <br><br>  Thus, the ingenious use of two features together ‚Äî RAID-4 and the WAFL recording mode ‚Äî made it possible to take advantage of both of them while at the same time getting rid of their disadvantages.  And the further development of RAID-4 in RAID-DP, which provides protection against double disk failure, has increased the reliability of data storage without sacrificing the traditionally high performance.  And it is not easy.  Suffice it to say that using RAID-6 (similar to RAID-DP, with an equivalently high level of protection), due to poor write performance, is not practiced and is not recommended for primary data by any other manufacturer of storage systems. <br><br>  How to become rich, strong and healthy at the same time (and so that nothing is for it)?  How to ensure a high degree of data protection from failure without sacrificing either high performance or disk space? <br>  The answer knows NetApp. <br>  Contact his partner companies;) <br><br>  UPD: starring in the photo in the article's screensaver - NetApp FAS2020A from the foboss <a href="http://habrahabr.ru/users/foboss/" class="user_link">habrauser farm</a> . </div><p>Source: <a href="https://habr.com/ru/post/113427/">https://habr.com/ru/post/113427/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113420/index.html">KISS + Ruby = load server fast</a></li>
<li><a href="../113421/index.html">Using the experience of testing a relational database for NoSQL technology</a></li>
<li><a href="../113423/index.html">Who is cheaper?</a></li>
<li><a href="../113425/index.html">iPad and news: a small overview of the best apps</a></li>
<li><a href="../113426/index.html">Release Flash Player 10.2</a></li>
<li><a href="../113429/index.html">C ++, C-style coercion and unexpected consequences of their combination</a></li>
<li><a href="../113430/index.html">Ubiquity RouterStation Pro: a small overview and installation of Debian GNU / Linux</a></li>
<li><a href="../113431/index.html">DHCP over VLAN on Cisco switches</a></li>
<li><a href="../113433/index.html">A joint project of Toshiba and Royal Opera House. Watch the opera ‚ÄúCarmen‚Äù in 3D (update!)</a></li>
<li><a href="../113434/index.html">David O'Reilly</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>