<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write MVC application on Ext JS 4 with the possibility of offline work</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Until recently, if it was necessary to allow the user to work offline, that is, without an active Internet connection, they had to develop fat clients...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write MVC application on Ext JS 4 with the possibility of offline work</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/storage2/992/cec/745/992cec745fb34f5981af67803ec6a2e1.png"></div><br>  Until recently, if it was necessary to allow the user to work offline, that is, without an active Internet connection, they had to develop fat clients.  With this approach, the user enters data into the application, which is stored locally, then, sticking the net lace, presses the Sync magic button and, satisfied with himself, goes to drink tea. <br><br>  The described scheme has all the disadvantages of a fat client.  This is the need to develop a separate application to work from browsers (which is a normal requirement in the modern world), the need to install additional software, the problem of updating it, and the general need to hire desktop application development specialists.  Agree to us, as web developers, the problem of working offline has always been a bone in the throat. <br><br>  Today this issue is solved elegantly - using HTML5 with its local storage (local storage), Ext JS 4 with the ability to work transparently with this storage, and HTML5 application cache (Application Cache).  The combination of these technologies makes it possible to implement the following scheme: if there is a network, static files (HTML / CSS / JS code and pictures) are downloaded from the site and we work with a server-based centralized database, in the absence of a network, static is loaded from Application Cache and we work with local storage, which is stored in the server database when access to the Internet.  At the same time, without an active connection to the URL of the page, the browser displays not a network access error, but a functional system working with <i>local</i> storage.  Explanations and a <a href="http://livedev.ru/offline/">working example</a> (yes my vds will not fall under the hardware effect) - under the cut.  The article turned out to be rather big, but, I hope, very informative. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  HTML5 </h3><br>  If you are familiar with HTML 5, feel free to <a href="https://habr.com/ru/post/138054/">skip this chapter</a> , if not, here you will find a brief description of the technologies used. <br><br>  <b>Application cache</b> <br><br>  Application Cache - application cache, allows you to save locally static files and use them without connecting to the network.  The list of files to be cached is in the manifest file, the address of which is indicated in the html tag, for example: <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">manifest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://site.ru/names.appcache"</span></span></span><span class="hljs-tag">&gt;</span></span>‚Ä¶<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The mime-type of the manifest file must be set to text / cache-manifest.  For Apache web server, for example, add to the configuration file: <br><br><pre> <code class="hljs pgsql">AddType <span class="hljs-type"><span class="hljs-type">text</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">cache</span></span>-manifest .appcache</code> </pre> <br>  For Java, add to web.xml: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mime-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span>appcache<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mime-type</span></span></span><span class="hljs-tag">&gt;</span></span>text/cache-manifest<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mime-type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mime-mapping</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  An example of the simplest manifest file: <br><br><pre> <code class="hljs objectivec"><span class="hljs-built_in"><span class="hljs-built_in">CACHE</span></span> MANIFEST index.html stylesheet.css images/logo.png scripts/main.js</code> </pre> <br>  The first line (CACHE MANIFEST) is required.  If you want to add resources that always require a network, add them after the NETWORK line: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">CACHE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MANIFEST</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">index</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.html</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">NETWORK</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">login</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.php</span></span></code> </pre> <br>  Take a closer look at the manifest file format here.  Application Cache can be updated in three ways: it can be forcibly deleted by the user in the browser, the cache will be updated when the manifest file is updated, and finally the cache can be forcedly updated from JavaScript. <br>  Browser support: Chrome 4+, Firefox 4+, Safari 4+, Opera 11+, IE 10, iOS 5+, Android 3+. <br><br>  <b>Local storage</b> <br><br>  Local storage in HTML5 allows you to save data locally, the recommended size limit is 5 Mb, however, in a number of browsers it can be increased.  Data does not disappear after closing the page or browser. <br><br>  The storage is one domain, that is, the same data is available from different pages of your site.  Moreover, you can track changes in data in the repository from all pages open simultaneously.  For example, one of the pages may cause a repository change that will lead to changes on another page that is open in the adjacent tab.  Cool, is not it? <br><br>  Working with local storage is simple - this is just a key-value structure: <br><br><pre> <code class="javascript hljs">localStorage.setItem(<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello World!'</span></span>); localStorage.getItem(<span class="hljs-string"><span class="hljs-string">'name'</span></span>); localStorage.removeItem(<span class="hljs-string"><span class="hljs-string">'name'</span></span>);</code> </pre> <br>  Supported browsers: Chrome 5+, Firefox 3.6+, Opera 10+, Safari 4+, IE 8+. <br><br><a name="localStorageExtJS4"></a><h3>  Local storage in Ext JS 4 </h3><br>  The fourth Ext JS allows you to work with local storage transparently, providing a separate proxy for it.  Thus, you simply change the proxy type from ajax to localstorage - and all the Ext JS data of the store (store) is downloaded not from the server, but from the local store of the browser. <br><br><h3>  Drove? </h3><br><img src="https://habrastorage.org/storage2/00b/f61/8a6/00bf618a64b2a3e42d9b0a96de92f0db.png" align="right">  Let's write an application that allows you to maintain a list of people - a screenshot of which you observed in the title of the article.  In the absence of a network, the ability to enter new persons should remain, when a network appears, the data previously entered into the local storage should automatically be loaded into the server database. <br><br>  The file structure is shown in the screenshot, the index.html, /app.js files and the / app / directory are actually important for us. <br><br>  The fourth version of Ext JS suggests using the MVC model for interface development, we will follow it: <br><ul><li>  / app / model / - directory of models.  Model in this case is a description of the storage fields, that is, a data structure (similar to Record in the third version of the framework) and, if necessary, a description of the proxy.  A proxy describes how to get data - Ajax, JSON-P, local storage, etc.  A proxy can be tied to a model or repository using this model. </li><li>  / app / view / - directory mappings.  View - visual elements (widgets) </li><li>  / app / controller / - controllers directory.  Controller - display logic, instantiation of models, etc., that is, everything that connects models, storages and widgets </li></ul><br>  The application will consist of two widgets - a window (window) with a table (grid) inside.  The table, depending on the Internet connection, will use server or local storage. <br><br>  So everything, of course, begins with HTML: <br><br><pre> <code class="html hljs xml"><span class="hljs-comment"><span class="hljs-comment">&lt;!--     - Application Cache --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">manifest</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"UsersApp.appcache"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ext-4.0.7-gpl/resources/css/ext-all.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"style.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ext-4.0.7-gpl/ext-dev.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"app.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">style</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"padding: 25px;"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"console"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h2</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  There is nothing special here - the manifest file is specified with the resources required for caching, the framework styles and custom styles are connected, the Ext JS kernel and the entry point of the app.js. application are loaded.  In Ext JS 4, a <a href="http://docs.sencha.com/ext-js/4-0/">dynamic loading</a> mechanism is implemented, which allows you to include the necessary JS files on the fly - thus, only one JS file of the app.js application is written directly to html. <br><br>  The input javascript file is simple: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    JS  Ext.Loader.setConfig({ enabled: true, disableCaching: false, paths: {UsersApp: 'app', Ext: 'ext-4.0.7-gpl/src'} }); //  ,     Ext.require(["UsersApp.view.win"]); Ext.application({ name: 'UsersApp', launch: function(){ Ext.create("UsersApp.view.win").show(); }, controllers: ["Main"] });</span></span></code> </pre> <br>  The Ext.require () construct is intended to indicate dependencies, that is, objects that must be loaded beforehand - before launching the application by calling the launch () method.  Generally speaking, if such dependencies are not specified - when the Ext.Loader boot loader is configured, they will load automatically during execution, but this may slow down somewhat and is not kosher at all, Ext.Loader will display a message in the JS browser in the course of such non-optimal loading appropriateness of using Ext.require (). <br><br>  Note that the actual names of the objects correspond to the paths in which these objects are stored.  For example, the UsersApp.store.storeLocal object is stored in the /app/store/storeLocal.js directory, while the mapping of the name of the UsersApp application to the name of the app's physical directory is specified in the Ext.Loader bootloader settings. <br><br>  <i>Note: the dynamic loading mechanism is convenient at the development stage, in a production system it is better to collect all JS code into one file using <a href="http://www.sencha.com/products/sdk-tools">Sencha SDK Tools</a> ( <a href="http://docs.sencha.com/ext-js/4-0/">example</a> ) to avoid downloading a large number of files with code, generating unnecessary requests to the server, etc.</i> <br><br>  So, our application creates the UsersApp.view.win widget and uses the Main controller.  The controller is always called <i>before</i> the launch () method is called; it performs all the necessary preparatory work for linking the system components. <br><br>  The code of the UsersApp.view.win window is simple (hereinafter the main configuration parameters are shown, visual configs such as height-width and other unimportant moments can be viewed in the source code at the link at the end of the article): <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'UsersApp.view.win'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.Window'</span></span>, <span class="hljs-attr"><span class="hljs-attr">requires</span></span>: [<span class="hljs-string"><span class="hljs-string">'UsersApp.view.grid'</span></span>], <span class="hljs-attr"><span class="hljs-attr">itemId</span></span>: <span class="hljs-string"><span class="hljs-string">'usersWindow'</span></span>, <span class="hljs-attr"><span class="hljs-attr">layout</span></span>: <span class="hljs-string"><span class="hljs-string">'fit'</span></span>, <span class="hljs-attr"><span class="hljs-attr">items</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">xtype</span></span>: <span class="hljs-string"><span class="hljs-string">'NamesGridPanel'</span></span>, <span class="hljs-attr"><span class="hljs-attr">itemId</span></span>: <span class="hljs-string"><span class="hljs-string">'NamesGrid'</span></span> } ] });</code> </pre> <br>  Here we define the UsersApp.view.win class, which extends the standard Ext.Window class, and requires the UsersApp.view.grid load.  Table code: <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'UsersApp.view.grid'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.grid.Panel'</span></span>, <span class="hljs-attr"><span class="hljs-attr">alias</span></span>: <span class="hljs-string"><span class="hljs-string">'widget.NamesGridPanel'</span></span>, <span class="hljs-attr"><span class="hljs-attr">requires</span></span>: [<span class="hljs-string"><span class="hljs-string">'Ext.grid.plugin.CellEditing'</span></span>, <span class="hljs-string"><span class="hljs-string">'Ext.form.field.*'</span></span>], <span class="hljs-attr"><span class="hljs-attr">itemId</span></span>: <span class="hljs-string"><span class="hljs-string">'usersGrid'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//   -      initComponent : function() { //        //    ,  //   CellEditing this.cellEditing = Ext.create('Ext.grid.plugin.CellEditing', { clicksToEdit: 2 }); this.plugins = this.cellEditing; this.columns = this.columnsGet(); this.tbar = this.tbarGet(); //       this.callParent(); }, tbarGet: function(){ return[ { text: '', iconCls: 'add', handler: this._onUserAddClick }, { text: '', iconCls: 'delete', handler: this._onUserDelClick } ] }, columnsGet: function(){ return [ { text: '', field: 'textfield', dataIndex: 'firstName' }, { text : '', field: 'textfield', dataIndex: 'secondName' } ] }, _onUserAddClick: function(button){ //      }, _onUserDelClick: function(button){ //      } })</span></span></code> </pre><br>  Nothing new here - a table class is created, columns are set up, a Toolbar is added with add / delete records buttons (the implementation of these methods is hidden for better readability of the code).  Please note that the table is not yet attached storage, it will be done in the controller. <br><br>  It's time to create two repositories - server and local.  Both of these storages will have the same model (as they actually contain data of the same structure), but different proxies.  The model is described by the UsersApp.model.Names class: <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'UsersApp.model.Names'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fields</span></span>: [{<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'int'</span></span>, <span class="hljs-attr"><span class="hljs-attr">useNull</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'firstName'</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'secondName'</span></span>}], <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.data.Model'</span></span>, <span class="hljs-comment"><span class="hljs-comment">//       ,   validations: [{ type: 'length', field: 'firstName', min: 1 },{ type: 'length', field: 'secondName', min: 1 } ] });</span></span></code> </pre><br>  The model consists of three fields - the identifier of a person, his name and surname.  For the identifier, an integer type is specified and the useNull parameter is used, setting the value to null if it cannot be recognized as an integer (otherwise it will be equal to 0).  Also, validators are specified for the model - the name and surname of the person must be no shorter than 1 character. <br><br>  Create a repository with server data loading: <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'UsersApp.store.store'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.data.Store'</span></span>, <span class="hljs-attr"><span class="hljs-attr">requires</span></span> : [<span class="hljs-string"><span class="hljs-string">'UsersApp.model.Names'</span></span>, <span class="hljs-string"><span class="hljs-string">'Ext.data.proxy.Ajax'</span></span>], <span class="hljs-attr"><span class="hljs-attr">model</span></span>: <span class="hljs-string"><span class="hljs-string">'UsersApp.model.Names'</span></span>, <span class="hljs-attr"><span class="hljs-attr">proxy</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'ajax'</span></span>, <span class="hljs-attr"><span class="hljs-attr">api</span></span>: { <span class="hljs-attr"><span class="hljs-attr">read</span></span>: <span class="hljs-string"><span class="hljs-string">'crud.php?act=read'</span></span>, <span class="hljs-attr"><span class="hljs-attr">update</span></span>: <span class="hljs-string"><span class="hljs-string">'crud.php?act=update'</span></span>, <span class="hljs-attr"><span class="hljs-attr">create</span></span>: <span class="hljs-string"><span class="hljs-string">'crud.php?act=create'</span></span>, <span class="hljs-attr"><span class="hljs-attr">destroy</span></span>: <span class="hljs-string"><span class="hljs-string">'crud.php?act=delete'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">reader</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">root</span></span>: <span class="hljs-string"><span class="hljs-string">'names'</span></span>, <span class="hljs-attr"><span class="hljs-attr">idProperty</span></span>: <span class="hljs-string"><span class="hljs-string">'id'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">writer</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">writeAllFields</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">root</span></span>: <span class="hljs-string"><span class="hljs-string">'names'</span></span> } } });</code> </pre> <br>  So, the server-loaded model uses the created model that describes the data structure, and the Ajax proxy with the reader configured and the writer written to read and write data, respectively.  The api parameter specifies the URL of addresses to which Ext JS will access for read, update, add, and delete operations. <br><br>  Local Storage Code: <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">'UsersApp.store.storeLocal'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.data.Store'</span></span>, <span class="hljs-attr"><span class="hljs-attr">requires</span></span> : [<span class="hljs-string"><span class="hljs-string">'UsersApp.model.Names'</span></span>, <span class="hljs-string"><span class="hljs-string">'Ext.data.proxy.LocalStorage'</span></span>], <span class="hljs-attr"><span class="hljs-attr">model</span></span>: <span class="hljs-string"><span class="hljs-string">"UsersApp.model.Names"</span></span>, <span class="hljs-attr"><span class="hljs-attr">proxy</span></span>: { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'localstorage'</span></span>, <span class="hljs-attr"><span class="hljs-attr">id</span></span> : <span class="hljs-string"><span class="hljs-string">'Names'</span></span> } });</code> </pre><br>  We specify localstorage as a proxy - all data will be loaded from the local storage.  As id, specify the unique proxy identifier used to create names in the key-value local storage. <br><br>  Let's sum up.  We have a window containing a table with customized columns, but not connected storage, there are two storages - server and local - with one model.  You need to tie all this stuff into a working application!  The controller will do this: <br><br><pre> <code class="javascript hljs">Ext.define(<span class="hljs-string"><span class="hljs-string">"UsersApp.controller.Main"</span></span>, { <span class="hljs-attr"><span class="hljs-attr">extend</span></span>: <span class="hljs-string"><span class="hljs-string">'Ext.app.Controller'</span></span>, <span class="hljs-attr"><span class="hljs-attr">requires</span></span>: [ <span class="hljs-comment"><span class="hljs-comment">//     - ""  'UsersApp.Utils', 'UsersApp.store.storeLocal', 'UsersApp.store.store' ], init: function(){ //  getStore    , //     -    var storeLocal = this.getStore("storeLocal"); var store = this.getStore("store"); //       ,    //  __   storeLocal.addListener('load', function(){ //    -   // ,     . UsersApp.Utils.ping  //    callback  UsersApp.Utils.ping({ success: this._onPingSuccess, //   failure: this._onPingFailure //   }, this); }, this); //     storeLocal.load(); }, _onPingSuccess: function(){ //   var win = Ext.ComponentQuery.query('#usersWindow')[0]; var storeLocal = this.getStore('storeLocal'); var store = this.getStore('store'); var grid = win.getComponent('NamesGrid'); win.setTitle(", ") //       localCnt = storeLocal.getCount(); //    , // ,    if (localCnt &gt; 0){ //  ,   //      //   for (i = 0; i &lt; localCnt; i++){ var localRecord = storeLocal.getAt(i); var deletedId = localRecord.data.id; delete localRecord.data.id; store.add(localRecord.data); localRecord.data.id = deletedId; } //    store.sync(); //    for (i = 0; i &lt; localCnt; i++){ storeLocal.removeAt(0); } } store.load(); //      grid.reconfigure(store); grid.store.autoSync = true; }, _onPingFailure: function(){ //  ,     var win = Ext.ComponentQuery.query('#usersWindow')[0]; var storeLocal = this.getStore('storeLocal'); var store = this.getStore('store'); var grid = win.getComponent('NamesGrid'); win.setTitle(", ") //      grid.reconfigure(storeLocal); grid.store.autoSync = true; } });</span></span></code> </pre><br>  Lots of code?  Let's go in order.  First of all, the controller needs to specify the dependencies it needs - in our case these are the internal utilities of UsersApp.Utils and our two repositories.  The init method will be called when the controller is initialized, that is, before starting the application, all preparatory actions must be performed in it.  We create storage instances and load the local storage (it works regardless of network access), having previously specified the callback - after loading we check the network availability by calling the UsersApp.Utils.ping method.  The ping function sends an Ajax request to a file on the server, and if successful, calls the callback function success, otherwise failure is called. <br><br>  So, if there is a network, records of the local storage are added to the server storage, after which the table storage is installed on the server storage.  If there is no network, the table storage is simply installed on the local one. <br><br>  An example of the work can be found <a href="http://livedev.ru/offline/">here</a> .  Sources (as a server part of PHP, I also wrote in Java - if anyone needs it, I‚Äôll post it) <a href="">here</a> . <br><br>  Ps.  Connoisseurs with the new album of Rustaveli - and warm winter programmer evenings to you :) </div><p>Source: <a href="https://habr.com/ru/post/138054/">https://habr.com/ru/post/138054/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../138047/index.html">Chrome (dev) implements future JavaScript features</a></li>
<li><a href="../138048/index.html">LeechCraft 0.5 released</a></li>
<li><a href="../138049/index.html">Multilateral exchange</a></li>
<li><a href="../138051/index.html">Studying Skype - edit quotes</a></li>
<li><a href="../138053/index.html">Vim + Python. For beginners</a></li>
<li><a href="../138055/index.html">Embedded custom blog engines for Ruby on Rails</a></li>
<li><a href="../138056/index.html">The authors of the amendments to the Civil Code of the Russian Federation finally decided to destroy Linux, Wikipedia, OpenStreetMap, Firefox, Chromium and LibreOffice?</a></li>
<li><a href="../138057/index.html">Watch vBulletin or attempt to cache dynamic content</a></li>
<li><a href="../138058/index.html">Freelance vs business</a></li>
<li><a href="../138059/index.html">Cheap RFID printed on paper</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>