<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write logging system in InterSystems Cach√©</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In the previous article, we looked at the main uses of macros, and now let's move on to writing a more extensive example using macros. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write logging system in InterSystems Cach√©</h1><div class="post__text post__text-html js-mediator-article"><img alt="Monet impression sunrise" title="Monet impression sunrise" src="https://habrastorage.org/files/c16/e69/e5e/c16e69e5ee5f4d49b5b869985a8cf479.jpg"><br><br><h2>  Introduction </h2><br>  In the <a href="http://habrahabr.ru/company/intersystems/blog/258081/">previous</a> article, we looked at the main uses of macros, and now let's move on to writing a more extensive example using macros.  We will write a logging system. <br><a name="habracut"></a><br><h2>  Logging system </h2><br>  This is a necessary and useful tool for logging the application.  Significantly saves time spent on debugging and catching various bugs.  The system consists of two parts: <br><ul><li>  Log storage class </li><li>  A set of macros to automatically add a new entry to the log </li></ul><br><br><h3>  Log storage class </h3><br>  We will draw up a table of what we need to store, we will immediately write when it is possible to obtain this data ‚Äî at the time of compilation or execution of the program.  This will be required when writing the second part of the system - macros, where we obviously strive to find out as much of the logged data as possible during compilation: <br><table><tbody><tr><th>  <b>Information</b> </th><th>  <b>Time of receipt</b> </th></tr><tr><td>  Event type </td><td>  Compilation </td></tr><tr><td>  Class name </td><td>  Compilation </td></tr><tr><td>  Method name </td><td>  Compilation </td></tr><tr><td>  Arguments passed to the method </td><td>  Compilation </td></tr><tr><td>  Line number of ref.  Coda </td><td>  Performance </td></tr><tr><td>  Username </td><td>  Performance </td></tr><tr><td>  Date Time </td><td>  Performance </td></tr><tr><td>  Message </td><td>  Performance </td></tr><tr><td>  IP address </td><td>  Performance </td></tr></tbody></table>  Create an App.Log class.  In it we will create all the above properties.  When creating an App.Log class object, the Username, Date / Time, and IP address properties are filled automatically. <br><div class="spoiler">  <b class="spoiler_title">Class App.Log</b> <div class="spoiler_text">  <font color="#000080">Class App.Log Extends% Persistent</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Substitution of non-existent values</font> <font color="#000080"><br></font>  <font color="#000080">Parameter</font> <font color="#000000">Null =</font> <font color="#800080">"Null"</font> <font color="#000000">;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Event Type</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">EventType</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">10</font> <font color="#000000">,</font> <font color="#000080">VALUELIST</font> <font color="#000000">=</font> <font color="#800080">", NONE, FATAL, ERROR, WARN, INFO, STAT, DEBUG, RAW"</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// class name</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">ClassName</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">256</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Method Name</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">MethodName</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">128</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// String int code</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">Source</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">2000</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Username</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">UserName</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">128</font> <font color="#000000">) [</font> <font color="#000080">InitialExpression</font> <font color="#000000">= {</font> <font color="#0000ff">$ username</font> <font color="#000000">}];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Arguments passed to the method</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">Arguments</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">32000</font> <font color="#000000">,</font> <font color="#000080">TRUNCATE</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Date Time</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">TimeStamp</font> <font color="#000080">As% TimeStamp</font> <font color="#000000">[</font> <font color="#000080">InitialExpression</font> <font color="#000000">= {</font> <font color="#0000ff">$ zdt</font> <font color="#000000">(</font> <font color="#0000ff">$ h</font> <font color="#000000">, 3, 1)}]];</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Random Message</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">Message</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">32000</font> <font color="#000000">,</font> <font color="#000080">TRUNCATE</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">);</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Network address of the user</font> <font color="#000080"><br></font>  <font color="#000080">Property</font> <font color="#000000">ClientIPAddress</font> <font color="#000080">As% String</font> <font color="#000000">(</font> <font color="#000080">MAXLEN</font> <font color="#000000">=</font> <font color="#000080">32</font> <font color="#000000">) [</font> <font color="#000080">InitialExpression</font> <font color="#000000">= {..</font> <font color="#0000ff">GetClientAddress</font> <font color="#000000">()}];</font> <font color="#000000">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </font>  <font color="#000080">Index</font> <font color="#000000">idxEventType On EventType [</font> <font color="#000080">Type</font> <font color="#000000">= bitmap];</font> <font color="#000000"><br></font>  <font color="#000080">Index</font> <font color="#000000">idxUserName On UserName [</font> <font color="#000080">Type</font> <font color="#000000">= bitmap];</font> <font color="#000000"><br></font>  <font color="#000080">Index</font> <font color="#000000">idxClassName On ClassName [</font> <font color="#000080">Type</font> <font color="#000000">= bitmap];</font> <font color="#000000"><br></font>  <font color="#000080">Index</font> <font color="#000000">idxTimeStamp On TimeStamp [</font> <font color="#000080">Type</font> <font color="#000000">= bitslice];</font> <font color="#000000"><br></font>  <font color="#000080">Index</font> <font color="#000000">idxClientIPAddress On ClientIPAddress;</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Determine the network address of the user</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">GetClientAddress ()</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">// If there is a CSP session, then take from there</font> <font color="#008000"><br></font>  <font color="#0000ff">#dim</font> <font color="#800000">% request</font> <font color="#0000ff">As</font> <font color="#008080">% CSP.Request</font> <font color="#008080"><br></font>  <font color="#0000ff">If</font> <font color="#000000">(</font> <font color="#0000ff">$ d</font> <font color="#000000">(</font> <font color="#800000">% request</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">Return</font> <font color="#800000">% request</font> <font color="#000000">.</font>  <font color="#0000ff">CgiEnvs</font> <font color="#000000">(</font> <font color="#008000">"REMOTE_ADDR"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">Return $ system</font> <font color="#008080">.Process</font> <font color="#000000">.</font>  <font color="#0000ff">ClientIPAddress</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font> <br>  <font color="#000080">/// Adding an event.</font> <font color="#000080"><br></font>  <font color="#000080">/// Use not directly, but through the $$$ LogEventTYPE () macros.</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">AddRecord (</font> <font color="#ff00ff">ClassName</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">,</font> <font color="#ff00ff">MethodName</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">,</font> <font color="#ff00ff">Source</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">,</font> <font color="#ff00ff">EventType</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">,</font> <font color="#ff00ff">Arguments</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">,</font> <font color="#ff00ff">Message</font> <font color="#000080">As% String</font> <font color="#000000">=</font> <font color="#800080">""</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">= ..</font> <font color="#0000ff">% New</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">Arguments</font> <font color="#000000">=</font> <font color="#800000">Arguments</font> <font color="#800000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">ClassName</font> <font color="#000000">=</font> <font color="#800000">ClassName</font> <font color="#800000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">EventType</font> <font color="#000000">=</font> <font color="#800000">EventType</font> <font color="#800000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">Message</font> <font color="#000000">=</font> <font color="#800000">Message</font> <font color="#800000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">MethodName</font> <font color="#000000">=</font> <font color="#800000">MethodName</font> <font color="#800000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">Source</font> <font color="#000000">=</font> <font color="#800000">Source</font> <font color="#800000"><br></font>  <font color="#0000ff">Do</font> <font color="#800000">record</font> <font color="#000000">.</font>  <font color="#0000ff">% Save</font> <font color="#000000">()</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br><br><h3>  Logging macros </h3><br>  Usually, macros are separated into separate inc files, where only the definitions of the macros themselves are stored.  <font color="#000080">Include the</font> necessary files to the classes with the command <font color="#000080">Include</font> <font color="#ff0000">MacroFileName</font> .  In this case, <font color="#000080">Include</font> <font color="#ff0000">App</font> <font color="#000000">.</font>  <font color="#ff0000">LogMacro</font> . <br>  First, let's define the main macro, which the user will add to the code of his application: <br>  <font color="#0000ff">#define</font> <font color="#000000">LogEvent (% type,% message)</font> <font color="#0000ff">Do ## class (App.Log) .AddRecord ($$$ CurrentClass, $$$ CurrentMethod, $$$ StackPlace,% type,</font> <font color="#0000ff"><br></font>  <font color="#0000ff">$$$ MethodArguments,% message)</font> <br>  This macro takes 2 arguments as input - Event type and Message.  The user sets the message himself, but for the transfer of the event type we will write additional macros with different names and transmitting the Event Type without the need of any actions from the user: <br><br><div class="spoiler">  <b class="spoiler_title">LogTYPE macros</b> <div class="spoiler_text">  <font color="#0000ff">#define</font> <font color="#000000">LogNone (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"NONE"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogError (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"ERROR"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogFatal (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"FATAL"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogWarn (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"WARN"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogInfo (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"INFO"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogStat (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"STAT"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogDebug (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"DEBUG"</font> <font color="#000000">,</font> <font color="#800000">% message</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">LogRaw (% message)</font> <font color="#0000ff">$$$ LogEvent</font> <font color="#000000">(</font> <font color="#008000">"RAW"</font> <font color="#000000">,</font> <font color="#800000">% message</font> ) <br></div></div><br>  Thus, a user can use logging to set the <font color="#0000ff">$$$ LogError</font> <font color="#000000">(</font> <font color="#008000">"Additional Message"</font> ) macro in the application code. <br>  It remains to define the macros <font color="#0000ff">$$$ CurrentClass, $$$ CurrentMethod, $$$ StackPlace, $$$ MethodArguments</font> .  Let's start with the first three: <br>  <font color="#0000ff">#define</font> <font color="#000000">CurrentClass</font> <font color="#0000ff">## Expression ($$$ quote</font> <font color="#000000">(</font> <font color="#800000">% classname</font> <font color="#000000">)</font> <font color="#0000ff">)</font> <font color="#0000ff"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">CurrentMethod</font> <font color="#0000ff">## Expression ($$$ quote</font> <font color="#000000">(</font> <font color="#800000">% methodname</font> <font color="#000000">)</font> <font color="#0000ff">)</font> <font color="#0000ff"><br></font>  <font color="#0000ff">#define</font> <font color="#000000">StackPlace</font> <font color="#0000ff">$ st ($ st (-1),</font> <font color="#008000">"PLACE"</font> <font color="#0000ff">)</font> <br><br>  The variables <font color="#800000">% classname,% methodname are</font> described in the macro <a href="">documentation</a> .  To get the line number of int code, use the <a href="">$ stack</a> function. <br>  To get the list of method arguments and their values, we use the% Dictionary package.  All class descriptions are stored there, including method descriptions.  In particular, the% Dictionary.CompiledMethod class and its FormalSpecParsed property are of interest: a $ lb structure of the following form: <font color="#0000ff">$ lb</font> <font color="#000000">(</font> <font color="#0000ff">$ lb</font> <font color="#000000">(</font> <font color="#008000">"Name"</font> <font color="#000000">,</font> <font color="#008000">"Class"</font> <font color="#000000">,</font> <font color="#008000">"Type (Output / ByRef)"</font> <font color="#000000">,</font> <font color="#008000">"Default Value"</font> <font color="#000000">), ...)</font> <font color="#000000"><br></font>  <font color="#000000">corresponding to the method signature.</font>  <font color="#000000">For example, the <font color="#000080">ClassMethod</font> <font color="#000000">Test</font> method <font color="#000000">(</font> <font color="#ff00ff">a</font> <font color="#000080">As% Integer</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">b</font> <font color="#000000">=</font> <font color="#000080">2</font> <font color="#000000">,</font> <font color="#000080">Output</font> <font color="#ff00ff">c</font> <font color="#000000">) will have the following FormalSpecParsed:</font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#000000"><font color="#0000ff">$ lb</font> <font color="#000000">(</font></font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#000000"><font color="#0000ff">$ lb</font> <font color="#000000">(</font> <font color="#008000">"a"</font> <font color="#000000">,</font> <font color="#008000">"% Library.Integer"</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">,</font> <font color="#008000">"1"</font> <font color="#000000">),</font></font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#000000"><font color="#0000ff">$ lb</font> <font color="#000000">(</font> <font color="#008000">"b"</font> <font color="#000000">,</font> <font color="#008000">"% Library.String"</font> <font color="#000000">,</font> <font color="#008000">"&amp;"</font> <font color="#000000">,</font> <font color="#008000">"2"</font> <font color="#000000">),</font></font></font> <font color="#000000"><font color="#000000"><br></font></font>  <font color="#000000"><font color="#000000"><font color="#0000ff">$ lb</font> <font color="#000000">(</font> <font color="#008000">"c"</font> <font color="#000000">,</font> <font color="#008000">"% Library.String"</font> <font color="#000000">,</font> <font color="#008000">"*"</font> <font color="#000000">,</font> <font color="#008000">""</font> <font color="#000000">))</font></font></font> <font color="#000000"><font color="#000000"><font color="#000000"><br></font></font></font>  <font color="#000000"><font color="#000000"><font color="#000000">As a result of the <font color="#0000ff">$$$ MethodArguments</font> macro, you need to get the following code (for the Test method): <font color="#008000">"a ="</font> <font color="#000000">_</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">a</font> <font color="#000000">,</font> <font color="#008000">"Null"</font> <font color="#000000">) _</font> <font color="#008000">"; b ="</font> <font color="#000000">_</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">b</font> <font color="#000000">,</font> <font color="#008000">"Null"</font> <font color="#000000">) _</font> <font color="#008000">" ; c = "</font> <font color="#000000">_</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">c</font> <font color="#000000">,</font> <font color="#008000">" Null "</font> <font color="#000000">) _</font> <font color="#008000">"; "</font></font></font></font> <font color="#000000"><font color="#000000"><font color="#000000"><font color="#008000"><br></font> <br></font></font></font>  <font color="#000000"><font color="#000000"><font color="#000000">To do this, at the compilation stage you need:</font></font></font> <font color="#000000"><font color="#000000"><font color="#000000"><br></font></font></font> <ul><li>  Get class name and method name </li><li>  Open the corresponding instance of the% Dictionary.CompiledMethod class and get the FormalSpec property </li><li>  Convert it to source line </li></ul><br>  Add the appropriate methods to the App.Log class: <br><div class="spoiler">  <b class="spoiler_title">Methods GetMethodArguments, GetMethodArgumentsList, ArgumentsListToString</b> <div class="spoiler_text">  <font color="#000080">ClassMethod</font> <font color="#000000">GetMethodArguments (</font> <font color="#ff00ff">ClassName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">MethodName</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">list</font> <font color="#000000">= ..</font> <font color="#0000ff">GetMethodArgumentsList</font> <font color="#000000">(</font> <font color="#800000">ClassName</font> <font color="#000000">,</font> <font color="#800000">MethodName</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">string</font> <font color="#000000">= ..</font> <font color="#0000ff">ArgumentsListToString</font> <font color="#000000">(</font> <font color="#800000">list</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">Return</font> <font color="#800000">string</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">GetMethodArgumentsList (</font> <font color="#ff00ff">ClassName</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">MethodName</font> <font color="#000080">As% String</font> <font color="#000000">)</font> <font color="#000080">As% List</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">result</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">def</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Dictionary.CompiledMethod</font> <font color="#000000">).</font>  <font color="#0000ff">% OpenId</font> <font color="#000000">(</font> <font color="#800000">ClassName</font> <font color="#000000">_</font> <font color="#008000">"||"</font> <font color="#000000">_</font> <font color="#800000">MethodName</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">If</font> <font color="#000000">(</font> <font color="#0000ff">$ IsObject</font> <font color="#000000">(</font> <font color="#800000">def</font> <font color="#000000">))</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">result</font> <font color="#000000">=</font> <font color="#800000">def</font> <font color="#000000">.</font>  <font color="#0000ff">FormalSpecParsed</font> <font color="#0000ff"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">Return</font> <font color="#800000">result</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">ArgumentsListToString (</font> <font color="#ff00ff">List</font> <font color="#000080">As% List</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">result</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">For</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ ll</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">result</font> <font color="#000000">=</font> <font color="#800000">result</font> <font color="#000000">_</font> <font color="#0000ff">$$$ quote</font> <font color="#000000">(</font> <font color="#0000ff">$ s</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">&gt; 1 = 0:</font> <font color="#008000">""</font> <font color="#000000">, 1:</font> <font color="#008000">";"</font> <font color="#000000">) _</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)) _</font> <font color="#008000">"="</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">_</font> <font color="#008000">"_ $ g ("</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)) _</font> <font color="#008000">","</font> <font color="#000000">_</font> <font color="#0000ff">$$$ quote</font> <font color="#000000">(..</font> <font color="#0000ff">#Null</font> <font color="#000000">) _</font> <font color="#008000">") _"</font> <font color="#008000"><br></font>  <font color="#000000">_</font> <font color="#0000ff">$ s</font> <font color="#000000">(</font> <font color="#800000">i</font> <font color="#000000">=</font> <font color="#0000ff">$ ll</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">) = 0:</font> <font color="#008000">""</font> <font color="#000000">, 1:</font> <font color="#0000ff">$$$ quote</font> <font color="#000000">(</font> <font color="#008000">";"</font> <font color="#000000">))</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">Return</font> <font color="#800000">result</font> <font color="#800000"><br></font>  } <br></div></div><br>  Now we define the <font color="#0000ff">$$$ MethodArguments</font> macro as: <font color="#0000ff">#define</font> <font color="#000000">MethodArguments</font> <font color="#0000ff">## Expression (## class (App.Log) .GetMethodArguments (% classname,% methodname))</font> <font color="#0000ff"><br></font> <br><h3>  Usage example </h3><br>  Create an App.Use class with the Test method to demonstrate the capabilities of the logging system <br><div class="spoiler">  <b class="spoiler_title">App.Use</b> <div class="spoiler_text">  <font color="#000080">Include</font> <font color="#ff0000">App</font> <font color="#000000">.</font>  <font color="#ff0000">Logmacro</font> <font color="#ff0000"><br></font>  <font color="#000080">Class App.Use</font> <font color="#000000">[</font> <font color="#000080">CompileAfter</font> <font color="#000000">=</font> <font color="#000080">App.Log</font> <font color="#000000">]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#000080">/// Do ## class (App.Use) .Test ()</font> <font color="#000080"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">Test (</font> <font color="#ff00ff">a</font> <font color="#000080">As% Integer</font> <font color="#000000">=</font> <font color="#000080">1</font> <font color="#000000">,</font> <font color="#000080">ByRef</font> <font color="#ff00ff">b</font> <font color="#000000">=</font> <font color="#000080">2</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">$$$ LogWarn</font> <font color="#000000">(</font> <font color="#008000">"Text"</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <br></div></div><br>  As a result, the <font color="#0000ff">$$$ LogWarn</font> <font color="#000000">(</font> <font color="#008000">"Text"</font> ) macro in int code is converted to a string: <br>  <font color="#0000ff">Do</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">App</font> .Log <font color="#000000">)</font> .  <font color="#0000ff">AddRecord</font> <font color="#000000">(</font> <font color="#008000">"App.Use"</font> <font color="#000000">,</font> <font color="#008000">"Test"</font> <font color="#000000">,</font> <font color="#0000ff">$ st</font> <font color="#000000">(</font> <font color="#0000ff">$ st</font> <font color="#000000">(</font> -1), <font color="#008000">"PLACE"</font> <font color="#000000">)</font> , <font color="#008000">"WARN"</font> <font color="#000000">,</font> <font color="#008000">"a ="</font> <font color="#000000">_</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">a</font> <font color="#000000">,</font> <font color="#008000">"Null"</font> <font color="#000000">)</font> _ <font color="#008000">"; b = "</font> <font color="#000000">_</font> <font color="#0000ff">$ g</font> <font color="#000000">(</font> <font color="#800000">b</font> <font color="#000000">,</font> <font color="#008000">" Null "</font> <font color="#000000">)</font> _ <font color="#008000">"; "</font> <font color="#000000">,</font> <font color="#008000">" Text "</font> ) <br><br>  After executing this code, a new object of class App.Log is created: <br><img src="https://habrastorage.org/files/f96/a50/577/f96a505774cc43ddbe285a424f8d89e3.PNG"><br><br><h2>  Improvements </h2><br>  Having written the basis of the logging system, we will think about how it can be improved. <br>  First, let's add the ability to process object arguments, because at the moment only <a href="">oref</a> objects will be written. <br>  Secondly, we add the ability to open the context - in that case, from the stored values ‚Äã‚Äãof the arguments, restore the context (arguments) of the method. <br><br><h3>  Handling Object Arguments </h3><br>  Generating a string that writes the value of the argument to the log occurs in the ArgumentsListToString method and looks like: <font color="#008000">"_ $ g ("</font> <font color="#000000">_</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)) _</font> <font color="#008000">","</font> <font color="#000000">_</font> <font color="#0000ff">$$$ quote</font> <font color="#000000">(..</font> <font color="#0000ff">#Null</font> <font color="#000000">) _</font> <font color="#008000">") _"</font> .  Let's refactor and select it into a separate method GetArgumentValue, which will take the input variable name and its class (and we know all this from FormalSpecParsed) and the output will be the code that converts the variable into a string.  For data types, this will be the already existing code, the objects will be converted to JSON using the methods SerializeObject (to be called from client code) and WriteJSONFromObject (to convert the object to JSON): <br><br><div class="spoiler">  <b class="spoiler_title">The GetArgumentValue, SerializeObject, and WriteJSONFromObject methods:</b> <div class="spoiler_text">  <font color="#000080">ClassMethod</font> <font color="#000000">GetArgumentValue (</font> <font color="#ff00ff">Name</font> <font color="#000080">As% String</font> <font color="#000000">,</font> <font color="#ff00ff">ClassName</font> <font color="#000080">As% Dictionary.CacheClassname</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">If $ ClassMethod</font> <font color="#000000">(</font> <font color="#800000">ClassName</font> <font color="#000000">,</font> <font color="#008000">"% Extends"</font> <font color="#000000">,</font> <font color="#008000">"% RegisteredObject"</font> <font color="#000000">)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">// it's an object</font> <font color="#008000"><br></font>  <font color="#0000ff">Return</font> <font color="#008000">"_ ## class (App.Log) .SerializeObject ("</font> <font color="#000000">_</font> <font color="#800000">Name</font> <font color="#000000">_</font> <font color="#008000">") _"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#0000ff">Else</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">// it's a datatype</font> <font color="#008000"><br></font>  <font color="#0000ff">Return</font> <font color="#008000">"_ $ g ("</font> <font color="#000000">_</font> <font color="#800000">Name</font> <font color="#000000">_</font> <font color="#008000">","</font> <font color="#000000">_</font> <font color="#0000ff">$$$ quote</font> <font color="#000000">(..</font> <font color="#0000ff">#Null</font> <font color="#000000">) _</font> <font color="#008000">") _"</font> <font color="#008000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">SerializeObject (</font> <font color="#ff00ff">Object</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Return</font> <font color="#000000">: '</font> <font color="#0000ff">$ IsObject</font> <font color="#000000">(</font> <font color="#800000">Object</font> <font color="#000000">)</font> <font color="#800000">Object</font> <font color="#800000"><br></font>  <font color="#0000ff">Return</font> <font color="#000000">..</font> <font color="#0000ff">WriteJSONFromObject</font> <font color="#000000">(</font> <font color="#800000">Object</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">WriteJSONFromObject (</font> <font color="#ff00ff">Object</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000000">[</font> <font color="#000080">ProcedureBlock</font> <font color="#000000">= 0]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#008000">// Create a string that we will redirect to</font> <font color="#008000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">Str</font> <font color="#000000">=</font> <font color="#008000">""</font> <font color="#008000"><br></font>  <font color="#0000ff">Use $ io</font> <font color="#000000">: :(</font> <font color="#008000">"^"</font> <font color="#000000">_</font> <font color="#0000ff">$ ZNAME</font> <font color="#000000">)</font> <font color="#000000"><br><br></font>  <font color="#008000">// Enable redirection</font> <font color="#008000"><br></font>  <font color="#0000ff">Do</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Device</font> <font color="#000000">).</font>  <font color="#0000ff">ReDirectIO</font> <font color="#000000">(1)</font> <font color="#000000"><br><br></font>  <font color="#008000">// Any statements can be written below.</font> <font color="#008000"><br></font>  <font color="#0000ff">Do</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% ZEN.Auxiliary.jsonProvider</font> <font color="#000000">).</font>  <font color="#0000ff">% ObjectToJSON</font> <font color="#000000">(</font> <font color="#800000">Object</font> <font color="#000000">)</font> <font color="#000000"><br><br></font>  <font color="#008000">// Disable redirection</font> <font color="#008000"><br></font>  <font color="#0000ff">Do</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% Device</font> <font color="#000000">).</font>  <font color="#0000ff">ReDirectIO</font> <font color="#000000">(0)</font> <font color="#000000"><br><br></font>  <font color="#0000ff">Return</font> <font color="#800000">Str</font> <font color="#800000"><br><br></font>  <font color="#008000">// Labels that allow for IO redirection</font> <font color="#008000"><br></font>  <font color="#008000">// Read Character - we don't care</font> <font color="#008000"><br></font>  <font color="#ff0000">rchr</font> <font color="#000000">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font>  <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Read a string - we don't care</font> <font color="#008000"><br></font>  <font color="#ff0000">rstr</font> <font color="#000000">(sz, to)</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Write a character - call the output label</font> <font color="#008000"><br></font>  <font color="#ff0000">wchr</font> <font color="#000000">(s)</font> <font color="#0000ff">Do</font> <font color="#ff0000">output</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(</font> <font color="#800000">s</font> <font color="#000000">))</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Write a form feed - call the output label</font> <font color="#008000"><br></font>  <font color="#ff0000">wff</font> <font color="#000000">()</font> <font color="#0000ff">Do</font> <font color="#ff0000">output</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(12))</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Write a newline - call the output label</font> <font color="#008000"><br></font>  <font color="#ff0000">wnl</font> <font color="#000000">()</font> <font color="#0000ff">Do</font> <font color="#ff0000">output</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(13,10))</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Write a string - call the output label</font> <font color="#008000"><br></font>  <font color="#ff0000">wstr</font> <font color="#000000">(s)</font> <font color="#0000ff">Do</font> <font color="#ff0000">output</font> <font color="#000000">(</font> <font color="#800000">s</font> <font color="#000000">)</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Write a tab - call the output label</font> <font color="#008000"><br></font>  <font color="#ff0000">wtab</font> <font color="#000000">(s)</font> <font color="#0000ff">Do</font> <font color="#ff0000">output</font> <font color="#000000">(</font> <font color="#0000ff">$ char</font> <font color="#000000">(9))</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  <font color="#008000">// Output label - you really want to do.</font> <font color="#008000"><br></font>  <font color="#008000">// in our case, we want to write to Str</font> <font color="#008000"><br></font>  <font color="#ff0000">output</font> <font color="#000000">(s)</font> <font color="#0000ff">Set</font> <font color="#800000">Str</font> <font color="#000000">=</font> <font color="#800000">Str</font> <font color="#000000">_</font> <font color="#800000">s</font> <font color="#0000ff">Quit</font> <font color="#0000ff"><br></font>  } <br></div></div><br>  Writing to the log with an object argument looks like this: <br><img src="https://habrastorage.org/files/a23/ad9/178/a23ad917869a4f1fbf97a75b551fcded.PNG"><br><br><h3>  Opening context </h3><br>  The idea of ‚Äã‚Äãthis method is to make all the arguments available in the current context (mostly the terminal, for debugging the application).  For this, the parameter of the <a href="">ProcedureBlock</a> method is used; if set to 0, then all variables declared inside such a method will be available even after the output of their method.  Our method, accordingly, will open an App.Log class object and deserialize the Arguments property. <br><br><div class="spoiler">  <b class="spoiler_title">Methods LoadContext and DeserializeObject</b> <div class="spoiler_text">  <font color="#000080">ClassMethod</font> <font color="#000000">LoadContext (</font> <font color="#ff00ff">Id</font> <font color="#000000">)</font> <font color="#000080">As% Status</font> <font color="#000000">[</font> <font color="#000080">ProcedureBlock</font> <font color="#000000">= 0]</font> <font color="#000000"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">Return</font> <font color="#000000">: '..</font> <font color="#0000ff">% ExistsId</font> <font color="#000000">(</font> <font color="#800000">Id</font> <font color="#000000">)</font> <font color="#0000ff">$$$ OK</font> <font color="#0000ff"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">Obj</font> <font color="#000000">= ..</font> <font color="#0000ff">% OpenId</font> <font color="#000000">(</font> <font color="#800000">Id</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">Arguments</font> <font color="#000000">=</font> <font color="#800000">Obj</font> <font color="#000000">.</font>  <font color="#0000ff">Arguments</font> <font color="#0000ff"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">List</font> <font color="#000000">= ..</font> <font color="#0000ff">GetMethodArgumentsList</font> <font color="#000000">(</font> <font color="#800000">Obj</font> <font color="#000000">.</font> <font color="#0000ff">ClassName</font> <font color="#000000">,</font> <font color="#800000">Obj</font> <font color="#000000">.</font> <font color="#0000ff">MethodName</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">For</font> <font color="#800000">i</font> <font color="#000000">= 1: 1:</font> <font color="#0000ff">$ Length</font> <font color="#000000">(</font> <font color="#800000">Arguments</font> <font color="#000000">,</font> <font color="#008000">";"</font> <font color="#000000">) -1</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">Argument</font> <font color="#000000">=</font> <font color="#0000ff">$ Piece</font> <font color="#000000">(</font> <font color="#800000">Arguments</font> <font color="#000000">,</font> <font color="#008000">";"</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">Set</font> <font color="#000000">@</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">)) = ..</font> <font color="#0000ff">DeserializeObject</font> <font color="#000000">(</font> <font color="#0000ff">$ Piece</font> <font color="#000000">(</font> <font color="#800000">Argument</font> <font color="#000000">,</font> <font color="#008000">"="</font> <font color="#000000">, 2),</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#0000ff">$ lg</font> <font color="#000000">(</font> <font color="#800000">List</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">), 2))</font> <font color="#000000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">Kill</font> <font color="#800000">Obj</font> <font color="#000000">,</font> <font color="#800000">Arguments</font> <font color="#000000">,</font> <font color="#800000">Argument</font> <font color="#000000">,</font> <font color="#800000">i</font> <font color="#000000">,</font> <font color="#800000">Id</font> <font color="#000000">,</font> <font color="#800000">List</font> <font color="#800000"><br></font>  <font color="#000000">}</font> <font color="#000000"><br></font>  <font color="#000080">ClassMethod</font> <font color="#000000">DeserializeObject (</font> <font color="#ff00ff">String</font> <font color="#000000">,</font> <font color="#ff00ff">ClassName</font> <font color="#000000">)</font> <font color="#000080">As% String</font> <font color="#000080"><br></font>  <font color="#000000">{</font> <font color="#000000"><br></font>  <font color="#0000ff">If $ ClassMethod</font> <font color="#000000">(</font> <font color="#800000">ClassName</font> <font color="#000000">,</font> <font color="#008000">"% Extends"</font> <font color="#000000">,</font> <font color="#008000">"% RegisteredObject"</font> <font color="#000000">)</font> <font color="#800080">{</font> <font color="#800080"><br></font>  <font color="#008000">// it's an object</font> <font color="#008000"><br></font>  <font color="#0000ff">Set</font> <font color="#800000">st</font> <font color="#000000">=</font> <font color="#000080">## class</font> <font color="#000000">(</font> <font color="#008080">% ZEN.Auxiliary.jsonProvider</font> <font color="#000000">).</font>  <font color="#0000ff">% ConvertJSONToObject</font> <font color="#000000">(</font> <font color="#800000">String</font> <font color="#000000">,,.</font> <font color="#800000">Obj</font> <font color="#000000">)</font> <font color="#000000"><br></font>  <font color="#0000ff">Return</font> <font color="#000000">:</font> <font color="#0000ff">$$$ ISOK</font> <font color="#000000">(</font> <font color="#800000">st</font> <font color="#000000">)</font> <font color="#800000">obj</font> <font color="#800000"><br></font>  <font color="#800080">}</font> <font color="#800080"><br></font>  <font color="#0000ff">Return</font> <font color="#800000">string</font> <font color="#800000"><br></font>  } <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">In the terminal, it looks like this:</b> <div class="spoiler_text"><pre><code class="hljs mel">zw &gt; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> ##class(App.Log).LoadContext(<span class="hljs-number"><span class="hljs-number">9</span></span>) zw &gt;a=<span class="hljs-number"><span class="hljs-number">3</span></span> &gt;b=&lt;OBJECT REFERENCE&gt;[<span class="hljs-number"><span class="hljs-number">2</span></span>@%ZEN.proxyObject] zw b &gt; +----------------- general information --------------- | oref value: <span class="hljs-number"><span class="hljs-number">2</span></span> | class name: %ZEN.proxyObject | <span class="hljs-keyword"><span class="hljs-keyword">reference</span></span> count: <span class="hljs-number"><span class="hljs-number">2</span></span> +----------------- attribute values ------------------ | %changed = <span class="hljs-number"><span class="hljs-number">1</span></span> | %data(<span class="hljs-string"><span class="hljs-string">"A"</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span> | %data(<span class="hljs-string"><span class="hljs-string">"B"</span></span>) = <span class="hljs-string"><span class="hljs-string">"stringvalue"</span></span> | %index = <span class="hljs-string"><span class="hljs-string">""</span></span></code> </pre> <br></div></div><br><br><h2>  What's next? </h2><br>  The main improvement that can be made here is the addition of another argument to the main macro with an arbitrary list of variables already created inside the method. <br><br><h2>  findings </h2><br>  Macros allow you to implement at the compilation stage a part of the application logic, thus reducing the load in runtime. <br><br><h2>  Links </h2><br>  <a href="http://habrahabr.ru/company/intersystems/blog/258081/">Part I. Macros</a> <br>  <a href="https://github.com/intersystems-ru/Log">GitHub logging repository</a> <br>  <a href="">Logging System Classes</a> <br><br>  The author is grateful to Daimor <a href="http://habrahabr.ru/users/daimor/" class="user_link">Habrawers</a> , <a href="http://habrahabr.ru/users/greyder/" class="user_link">Greyder,</a> and another very competent engineer who wished to remain anonymous, for help in writing the code. </div><p>Source: <a href="https://habr.com/ru/post/258805/">https://habr.com/ru/post/258805/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../258793/index.html">Problems of weak gaming ecosystems</a></li>
<li><a href="../258797/index.html">Geek approach to a simple browser game</a></li>
<li><a href="../258799/index.html">Reboot the brain to Tabtabus 2015 Summer Fest</a></li>
<li><a href="../258801/index.html">Dismantling the tutorial cult, trends in mobile development outsourcing and adult VR content - and other news of the week for a mobile developer</a></li>
<li><a href="../258803/index.html">Through hardship to the stars. How we stuffed bumps</a></li>
<li><a href="../258807/index.html">The path of the analyst. Practical guide IT-specialist</a></li>
<li><a href="../258809/index.html">Hello, SaaS | Remote work 2</a></li>
<li><a href="../258811/index.html">New experimental C ++ operators</a></li>
<li><a href="../258815/index.html">Docker workflow</a></li>
<li><a href="../258817/index.html">Simulation of aircraft flap fault scenarios using Wolfram SystemModeler</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>