<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>"Digital Lab" NR05: make a combination lock</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue the series of articles on using the capabilities of the Digital Lab NR05 for studying the programming of microcontrollers using the exampl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>"Digital Lab" NR05: make a combination lock</h1><div class="post__text post__text-html js-mediator-article">  We continue the series of articles on using the capabilities of the Digital Lab <a href="http://masterkit.ru/shop/studygoods/2016109">NR05</a> for studying the programming of microcontrollers using the example of Arduino and the design of useful electronic devices. <br><br><img src="https://habrastorage.org/files/065/aff/685/065aff685db2414dab7e68421ca07561.JPG" width="600"><br><br>  Our material does not pretend to a complete design, but, as you will see, it fully performs all the basic functions of a combination lock, and can serve as a good illustration of the capabilities of microcontrollers and the use of external plug-ins.  The program for the microcontroller can be altered at your discretion, adding or changing the functions of the lock, and increasing the level of your knowledge in programming. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We will use, first of all, the fact that the expansion board, which is part of the set, has a two-line LCD display, as well as 5 buttons.  We use these elements to build a code lock. <br><a name="habracut"></a><br>  Let us set the following requirements: <br>  1. There are 5 buttons to enter the code that opens the lock; <br>  2. The leftmost button corresponds to code 1, then from left to right - 2,3,4,5; <br>  3. The number of digits of the entered code can be any (within reasonable limits) and simply installed in the program; <br>  4. The dialed code is displayed as asterisks; <br>  5. If the entered code coincides with the model code, a positive impulse of the duration specified in the program is given to the actuator; <br>  6. In the event of an erroneous code entry, an error message appears; <br>  7. If the code is partially typed, after some time the typed values ‚Äã‚Äãare reset. <br>  8. We use the display, RGB-LED and emitter included in the set to display information that is understandable to the user. <br>  9. We will open a real electromechanical lock, powered by 12 volts. <br><br>  Now we will select the device that will supply the opening voltage to the lock.  This voltage in accordance with the passport of the electromechanical lock, which we will open, is 12 volts at a current of about 1 ampere.  The NR05 expansion board cannot work with such voltages and currents, therefore an additional switching module is needed.  Such modules can be <a href="http://masterkit.ru/shop/smarthome/executive-devices/1931906">MP515</a> relays offered by Master Kit, or <a href="http://masterkit.ru/shop/smarthome/executive-devices/1328374">MP2211</a> , <a href="http://masterkit.ru/shop/smarthome/executive-devices/1334457">MP4411</a> relay <a href="http://masterkit.ru/shop/smarthome/executive-devices/1328374">units</a> , depending on whether we want to control not only the lock, but also other devices, for example, turn on the light when opening the door.  All of these devices are compatible with Arduino control signal levels.  In our particular case, we use the MP2211 module with two relays. <br><br>  Considering the above, let's draw a wiring diagram of the devices used: <br><br><img src="https://habrastorage.org/files/c2a/fbe/51f/c2afbe51f49648b49386b9bfb007c72a.jpg" width="600"><br><br>  If you look closely at the marking of the expansion card, we will see that the green channel of the RGB LED GREEN and the output to the CH3 relay are connected to the same D9 Arduino Nano pin.  In this case, this is permissible, since the input of the control circuit of the relay has a rather high input resistance, and the output D9 is used only as a digital output.  In the general case, you should check whether the conclusions of the board you are using are not connected to the same Arduino output, and avoid such a situation. <br><br>  The lock consumes a fairly large current during operation, so we power it and the control circuit separately. <br><br><div class="spoiler">  <b class="spoiler_title">Here is a sketch, working in Arduino, spoiler</b> <div class="spoiler_text">  // Code lock on the five buttons with the display on the LCD and RGB-LED <br>  // based on the expansion card from the set NR05 <br>  // ------------------------------------------------ ------------------- <br>  // we connect the libraries LiquidCrystalRus <br>  #include &lt;LiquidCrystalRus.h&gt; <br>  #include &lt;LineDriver.h&gt; <br>  #include &lt;LiquidCrystalExt.h&gt; <br>  // determine the pins for the RGB LED and sound emitter <br>  #define red 5 <br>  #define blue 6 <br>  #define green 9 <br>  #define beep 12 <br>  // determine how many buttons we have connected <br>  #define NUM_KEYS 5 <br>  // for each button enter calibration values ‚Äã‚Äã(derived experimentally) <br>  int adcKeyVal [NUM_KEYS] = {30, 150, 360, 535, 760}; <br>  ////////////////////////////////////////////////// ///////// <br>  // length of the code that opens the lock <br>  #define codeLength 6 <br>  // array containing the code that opens the lock.  The number of array elements must be equal to codeLength <br>  const int codeOrigin [codeLength] = {1, 2, 3, 4, 5, 3}; <br>  // lock unlock time, milliseconds <br>  const int unlockTime = 400; <br>  ////////////////////////////////////////////////// ///////// <br>  // array to record the number of keys pressed <br>  int codePressed [codeLength]; <br>  // push counter (the lock is unlocked by the fifth push) <br>  int pressCount; <br>  // variables for the code dialing inactivity counter <br>  unsigned long oldTime; <br>  unsigned long currentTime; <br>  const int timeout = 5;  // timeout time when typing code, sec.  After a timeout, the incomplete dialed code is reset. <br>  // ------------------------------------------------ ----------------------- <br>  // initialize the display, explaining to the program where the RS, EN, DB4, DB5, DB6, DB7 lines are connected <br>  LiquidCrystalRus lcd (A1, A2, A3, 2, 4, 7); <br><br>  // ------------------------------------------------ ----------------------- <br>  // This function will be executed 1 time at the time of launching the Arduino program <br>  void setup () <br>  { <br>  // initialize the LCD: 16 characters and 2 lines <br>  lcd.begin (16, 2); <br>  // the cursor is on the first line (top) and the first left character <br>  // write on the display "Master Kit" <br>  lcd.print ("Master Kit"); <br>  // set the cursor to the first position in the second line <br>  lcd.setCursor (0,1); <br>  lcd.print ("totcr .:"); <br>  lcd.print (unlockTime); <br>  lcd.print (‚Äúms‚Äù); <br>  // pause for 2000 milliseconds = 2 seconds <br>  delay (2000); <br>  // clear the display <br>  lcd.clear (); <br>  // reset the click counter <br>  pressCount = 0; <br>  // set the mode "on output" for connecting the RGB-LED and sound emitter <br>  pinMode (red, OUTPUT); <br>  pinMode (blue, OUTPUT); <br>  pinMode (green, OUTPUT); <br>  pinMode (beep, OUTPUT); <br>  } <br><br>  // ------------------------------------------------ ----------------------- <br>  // This function will be executed after the setup function and will repeat an infinite number of times after it has finished. <br><br>  void loop () { <br>  // write the current time (in milliseconds) elapsed since the program began to run <br>  currentTime = millis (); <br>  // check if the timeout for entering the code has not reached <br>  if (currentTime - oldTime &lt;= timeout * 1000) { <br>  // start a variable named key <br>  int key; <br>  // write to this variable number of the pressed button, invoking the get_key function described below <br>  key = get_key (); <br>  lcd.setCursor (0, 0); <br>  lcd.print ("Enter the code:"); <br>  // turn on the blue LED <br>  digitalWrite (blue, HIGH); <br>  if (key&gt; 0) {// if the button is pressed <br>  codePressed [pressCount] = key;  // write the number of the pressed button to the array <br>  // short signal of the emitter (50 ms) <br>  digitalWrite (beep, HIGH); <br>  delay (50); <br>  digitalWrite (beep, LOW); <br>  // typing on the second line of the asterisk, flashing blue LED <br>  lcd.setCursor (pressCount, 1); <br>  lcd.print ('*'); <br>  digitalWrite (blue, LOW); <br>  delay (200); <br>  digitalWrite (blue, HIGH); <br>  pressCount ++;  // increment the hit count <br>  // reset the timeout timer <br>  oldTime = currentTime; <br>  } <br>  } <br>  // if the timeout is reached, reset the partially dialed code <br>  else { <br>  pressCount = 0; <br>  lcd.clear (); <br>  oldTime = currentTime; <br>  } <br>  // if all code is entered, compare two arrays element by element: codeOrigin and codePressed <br>  if (pressCount == codeLength) { <br>  int compareResult = 1; <br>  for (int i = 0; i &lt;codeLength; i ++) <br>  if (codeOrigin [i]! = codePressed [i]) <br>  compareResult = 0;  // if at least one pair of elements is not equal <br>  // if the correct code is entered <br>  if (compareResult == 1) {// if arrays match <br>  digitalWrite (blue, LOW); <br>  digitalWrite (green, HIGH); <br>  lcd.setCursor (0, 0); <br>  lcd.print ("Open"); <br>  delay (unlockTime); <br>  digitalWrite (green, LOW); <br>  pressCount = 0; <br>  delay (1000); <br>  lcd.clear (); <br>  digitalWrite (blue, HIGH); <br>  } <br>  // if wrong code is entered <br>  else { <br>  lcd.setCursor (0, 1); <br>  lcd.print (‚ÄúInvalid code"); <br>  digitalWrite (blue, LOW); <br>  digitalWrite (red, HIGH); <br>  digitalWrite (beep, HIGH); <br>  delay (2000); <br>  pressCount = 0; <br>  lcd.clear (); <br>  digitalWrite (beep, LOW); <br>  digitalWrite (blue, HIGH); <br>  digitalWrite (red, LOW); <br>  } <br>  } <br>  } <br><br>  // ------------------------------------------------ ----------------------- <br>  // This function will be executed only when it was called from the program. <br>  // The function reads the value from the ADC, where the analog keyboard is connected <br>  // and compares with the calibration values, identifying the number of the pressed button <br>  int get_key () <br>  { <br>  int input = analogRead (A6); <br>  int k; <br>  for (k = 0; k &lt;NUM_KEYS; k ++) <br>  if (input &lt;adcKeyVal [k]) <br>  return k + 1; <br>  return 0; <br>  } <br>  // end of the sketch <br></div></div><br><br>  The listing of the sketch is provided with detailed comments that will help you understand the program. <br>  Nevertheless, we draw your attention to some of its features. <br>  As we have already written, in the expansion card a button connection scheme is applied, using only one Arduino output.  This scheme saves microprocessor pins, but does not allow to process simultaneous pressing of several buttons simultaneously, but in our case it is not necessary.  Notice the get_key function at the end of the sketch.  If no button is pressed, the function returns 0; if pressed, the number of the button pressed. <br>  Also look at the implementation of the comparison of two arrays: reference and dialed codes: <br><br>  int compareResult = 1; <br>  for (int i = 0; i &lt;codeLength; i ++) <br>  if (codeOrigin [i]! = codePressed [i]) <br>  compareResult = 0;  // if at least one pair of elements is not equal <br><br>  The question of the algorithm for such a comparison is quite often discussed in programming forums, but each time it comes down to element-by-element comparison, which is used in our case.  The variable compareResult remains equal to 1 if the elements of arrays with identical indices are equal, and becomes equal to 0 if at least one pair of elements does not match. <br>  For displaying Cyrillic characters, the LiquidCrystalRus library, developed by Ilya Danilov, is used.  For the library to work correctly, three lines must be present in the header of our sketch: <br><br>  #include &lt;LiquidCrystalRus.h&gt; <br>  #include &lt;LineDriver.h&gt; <br>  #include &lt;LiquidCrystalExt.h&gt; <br><br>  And the initialization of the display should look like this: <br><br>  LiquidCrystalRus lcd (A1, A2, A3, 2, 4, 7); <br><br>  The length of the entered code is given by a predefined codeLength constant, for example, for a code of six taps <br><br>  #define codeLength 6 <br><br>  The array of reference values ‚Äã‚Äãfor a code with a length of 6 clicks is given by the following line: <br><br>  const int codeOrigin [codeLength] = {1, 2, 3, 4, 5, 3}; <br><br>  The number of values ‚Äã‚Äãin curly brackets must be equal to codeLength.  If there are more values, the compiler will give an error, if less, there will be no error, but random values ‚Äã‚Äãwill be used as missing elements, which will not give an opportunity to type the code that will open the lock. <br><br>  Every 5 seconds, the program resets dialed code elements.  If the button was pressed, the pressing time is remembered, and the countdown of the five-second interval begins again.  This is implemented with the millis () built-in functions, which returns the number of milliseconds elapsed since the start of the sketch, and the variables oldTime and currentTime. <br><br>  We give a short video showing the operation of the code lock: <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/BxoMflYEYxI%3Ffeature%3Doembed&amp;xid=17259,15700023,15700043,15700186,15700191,15700248,15700253&amp;usg=ALkJrhiVNkHTavel2_i55koZ7TTTAWUwyg" frameborder="0" allowfullscreen=""></iframe><br><br>  For the curious and inquisitive electronic programmers, you can throw a few more ideas for self-completion of the sketch and the inclusion in the scheme of modules that expand the capabilities of the castle.  For example, enter a master code into the program, with the help of which the lock is transferred to the programming mode and remembers the pressed buttons as a reference code, in order not to change this code in the sketch.  Programming a new code ends if the interval between clicks exceeds a certain time. <br><br>  Or, based on the <a href="https://geektimes.ru/company/masterkit/blog/272340/">material</a> devoted to the interaction of Arduino with a smartphone via Bluetooth, make a lock that opens with the code sent by this smartphone itself. <br><br>  You can also simply enter into our device a wireless control channel.  To do this, it is enough to use two modules: the <a href="http://masterkit.ru/shop/smarthome/distant-control-433/1339180">MP910</a> transmitter and one-channel receiver with a relay output <a href="http://masterkit.ru/shop/smarthome/distant-control-433/1339179">MP911</a> , operating at a frequency of 433 MHz.  The relay contacts of the MP2211 module are connected in parallel with the remote control button, and the relay of the receiver module is connected to the lock.  The control distance can be up to 100 m. <br><br>  Study Arduino, study microcontrollers and their programming - and you can create a lot of smart and useful electronic devices! </div><p>Source: <a href="https://habr.com/ru/post/392559/">https://habr.com/ru/post/392559/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../392545/index.html">IBM Watson analyzed Star Wars characters, describing the main characters</a></li>
<li><a href="../392547/index.html">Will the ‚Äúartificial gills‚Äù allow the aqualung to leave the house?</a></li>
<li><a href="../392549/index.html">Give the astronaut and the hero of the Cosmonaut and the Hero</a></li>
<li><a href="../392553/index.html">Scientists launch life expectancy project</a></li>
<li><a href="../392555/index.html">The world through the eyes of a WiFi router</a></li>
<li><a href="../392565/index.html">Opportunities for using 360 ¬∞ video technology to present cultural events</a></li>
<li><a href="../392573/index.html">WhatsApp has introduced full end-to-end encryption of all data for a billion of its users.</a></li>
<li><a href="../392575/index.html">32 birch sticks or rocket engine ignition systems</a></li>
<li><a href="../392577/index.html">In Mexico City, introduced a weekly "Earth Day" for cars</a></li>
<li><a href="../392579/index.html">Recently launched Russian site for registration of UAVs was unreal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>