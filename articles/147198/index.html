<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MVC approach to developing user interfaces in Delphi. Part 2. Lists</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The previous article was devoted to just one tick. It's time to move on to something a little more serious. Today's topic is the presentation of lists...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MVC approach to developing user interfaces in Delphi. Part 2. Lists</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/da0/ba7/056/da0ba7056c28fac12a51b1652c6f95cb.png"><br><br>  <a href="http://habrahabr.ru/post/147133/">The previous article</a> was devoted to just one tick.  It's time to move on to something a little more serious.  Today's topic is the presentation of lists and the association of GUI lists with internal data.  The article is intended for Delphi-developers. <br><a name="habracut"></a><br><br><h5>  Where to begin </h5><br>  In order not to pour water, I will go straight to the living example shown in the figure above.  Suppose you need to create a primitive form of setting user rights. <br>  The list of all users of the system is shown in the left part of the window, and the list of rights and roles of the currently selected user is shown in the right.  The logic of the window is that when you select a user in the left part of the window, the list of rights and roles in the right part is updated.  Also in the right side there are ‚ÄúAdd‚Äù / ‚ÄúDelete‚Äù buttons, which allow either to add a new role to the user or to delete selected existing roles.  When you add new roles, a pop-up window appears in the role guide in which you can select the roles to be added.  That's all. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Model </h5><br>  Suppose that the internal representation of the data consists of the class TUser, which describes the employee, and the directory of roles, which is able to return the name of the role by numeric ID.  It‚Äôs not practical to create classes for roles.  this is too simple an entity: <br><br><pre><code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">uses</span></span> Generics.Collections; <span class="hljs-comment"><span class="hljs-comment">//      TObjectList type TIntList = array of Integer; //        TUser = class strict private FID: Integer; FFullFio: String; FRoles: TIntList; public property ID: Integer read FID; property FullFio: String read FFullFio; property Roles: TIntList read FRoles write SetRoles; end; TUsersList = class(TObjectList&lt;TUser&gt;) public function UserByID(const aID: Integer): TUser; end;</span></span></code> </pre> <br><br>  It can be seen that user roles are presented in an extremely simple way - a list of IDs. <br><br>  I add the appropriate fields to the form class: <br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TfmUserRights</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) ... lbUsers: TListBox; lbRoles: TListBox; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FUsers: TUsersList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> Users: TUsersList <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FUsers; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Notice that I used a typed TObjectList.  Before Delphi 2009 there was no such possibility and TObjectList always kept just TObjects.  Each time a list item was accessed, it had to lead to the correct class: FUsers [i] as TUser (well, or an option for kamikazes: TUser (FUsers [i])).  It was inconvenient and it was easy to make a mistake by doing the conversion to the wrong class.  With the advent of generic types (generics), you can now use a hard-typed TObjectList.  It is incredibly comfortable!  Referring to the elements of such a list through FUsers [i], we immediately get an object of class TUser. <br><br>  I will not give the code to get the list of employees, because  in each system, depending on its architecture, it will be its own.  This may be a SQL query to the database, a call to some client cache, or a call to an application server (in a multi-tier architecture).  Suppose simply that you have the opportunity to get this list from somewhere. <br><br><h5>  Display list items </h5><br>  So, we want to get a list of employees and display it on the screen: <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FillUsers; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  The Fill method is designed to simply [re] fill the user list <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillUsers</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FUsers.Free; <span class="hljs-comment"><span class="hljs-comment">//   ,    FUsers := GetUsers; lbUsers.Items.BeginUpdate; try lbUsers.Items.Clear; for i := 0 to Users.Count-1 do lbUsers.AddItem(FUsers[i].FullFio, FUsers[i]); //         FUsers[i], //          ID' (  , ) finally lbUsers.Items.EndUpdate; end; end;</span></span></code> </pre><br><br>  Just filling out the list of employees is not enough.  You still need to show the roles of the currently selected employee.  And for this you need to learn to determine which employee is currently selected?  Inexperienced programmers are beginning to actively contact lbUsers.Items.Objects [lbUsers.ItemIndex] from different places.  However, if you read the <a href="http://habrahabr.ru/post/147133/">previous part of the</a> article, you already guess that we will go some other way.  We will get a property from the form class that returns and sets the currently selected employee.  You can return either the TUser object itself or a numeric user ID.  Returning an ID seemed to me more convenient, although one could argue with that. <br><br><pre> <code class="delphi hljs"><span class="hljs-title"><span class="hljs-title">TfmUserRights</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>(TForm) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> FSelUserID: Integer; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">property</span></span> SelUserID: Integer <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> FSelUserID <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> SetSelUserID; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetSelUserID</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Value: Integer)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> FSelUserID &lt;&gt; Value <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FSelUserID := Value; UpdateSelUser; <span class="hljs-comment"><span class="hljs-comment">// !!! end; end;</span></span></code> </pre><br><br>  The key point here in the UpdateSelUser method, which brings the interface to the state where the specified user is selected: <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UpdateSelUser</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vSelInd: Integer; i: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> vSelInd := -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> lbUsers <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> Items.Count-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Items.Objects[i] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TUser).ID = SelUserID <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> vSelInd := i; <span class="hljs-keyword"><span class="hljs-keyword">Break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; lbUsers.ItemIndex := vSelInd; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> SelUserID &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> gbRoles.Caption := <span class="hljs-string"><span class="hljs-string">'  :'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> gbRoles.Caption := <span class="hljs-string"><span class="hljs-string">'  : '</span></span> + Users.UserByID(SelUserID).FullFio FillUserRoles; <span class="hljs-comment"><span class="hljs-comment">// !!! end;</span></span></code> </pre><br><br>  We see that the installation method of the current user always causes the roles list to be full (FillUserRoles). <br><br>  As in the previous article, since we implemented the direction of synchronization Model-&gt; View, we also need reverse synchronization.  Therefore, in the OnClick event of the lbUsers list, add the following code: <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">lbUsersClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> SelUserID := (lbUsers.Items.Objects[lbUsers.ItemIndex] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> TUser).ID; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  When setting SelUserID, if another user was previously selected, the set method will call UpdateSelUser, which in turn will completely synchronize the presentation with the model, namely, update the list of roles.  Those.  I no longer need to call the update method for the list of roles from within the lbUsersClick handler, everything will happen automatically. <br><br>  I will give the method of filling the list of roles (it is trivial): <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillUserRoles</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: Integer; vSelUser: TUser; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> lbRoles.BeginUpdate; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> lbRoles.Clear; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> SelUserID &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Exit</span></span>; vSelUser := Users.UserByID(SelUserID); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> High(vSelUser.Roles) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> lbRoles.AddItem(DictRoles.NameByID(vSelUser.Roles[i]), TObject(vSelUser.Roles[i])); <span class="hljs-comment"><span class="hljs-comment">//            ,   ID',     TObject' ( ) finally SomeList.EndUpdate; end; end;</span></span></code> </pre><br><br>  I will supplement the form initialization code with initializing the first user in the list: <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FillUsers; FSelUserID := -<span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ,   Set- SelUserID := -1; //       end;</span></span></code> </pre><br><br>  What did we get?  Now it is possible to access the currently selected user via SelUserID.  Moreover, both when programmatically setting the value of the SelUserID property, and when the user is selected via the GUI list, the list of roles will be automatically updated. <br><br>  To work with roles (add, delete), you can add a SelRoles property to the form class.  It is easier to make it completely virtual (do not start a separate field for it): <br><pre> <code class="delphi hljs"><span class="hljs-keyword"><span class="hljs-keyword">property</span></span> SelRoles: TIntList <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> GetSelRoles <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> SetSelRoles; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetSelRoles</span></span></span><span class="hljs-function">:</span></span> TIntList; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Result := <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lbRoles.Items.Count-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lbRoles.Selected[i] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> AddIntToList(Integer(lbRoles.Items.Objects[i]), Result); <span class="hljs-comment"><span class="hljs-comment">//    ?     Objects' //   ,  ID' ,      Integer end; procedure TfmReportMain.SetSelRoles(const aSelRoles: TIntList); var i: Integer; begin lbRoles.Items.BeginUpdate; try for i := 0 to lbRoles.Items.Count-1 do lbRoles.Selected[i] := IntInList(Integer(lbRoles.Items.Objects[i]), aSelRoles); finally lbRoles.Items.EndUpdate; end; UpdateSelRoles; //      .     ,  ,   " N "     -  end;</span></span></code> </pre><br><br>  The IntInList and AddIntToList methods respectively check whether an element is in the array and add a new element to the array. <br><br><h5>  Adding and deleting roles </h5><br>  Adding Roles: <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btAddRoleClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vSelUser: TUser; vRoles: TIntList; vAddRoles: TIntList; i: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> vAddRoles := <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>; vAddRoles := TfmDictionary.GelDictIDs(DictRoles); <span class="hljs-comment"><span class="hljs-comment">//   ID'       vSelUser := Users.UserByID(SelUserID); vRoles := vSelUser.Roles; for i := 0 to High(vAddRoles) do AddIntToList(vAddRoles[i], vRoles); vSelUser.Roles := vRoles; //           (  ) SelRoles := vAddRoles; end;</span></span></code> </pre><br>  Removing roles: <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">btDelRoleClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vSelUser: TUser; vDelRoles: TIntList; vRoles: TIntList; vNewRoles: TIntList; i, vInd: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> lbAllowRightsRoles.SelCount = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> Exception.Create(<span class="hljs-string"><span class="hljs-string">'     .'</span></span>); vDelRoles := SelRoles; vSelUser := Users.UserByID(SelUserID); vRoles := vSelUser.Roles; SetLength(vNewRoles, Length(vRoles)); <span class="hljs-comment"><span class="hljs-comment">//     //  vNewRoles    ,       vInd := 0; for i := 0 to High(vRoles) do begin if IntInList(vRoles[i], vDelRoles) then Continue; vNewRoles[vInd] := vRoles[i]; inc(vInd); end; SetLength(vNewRoles, vInd); //     vSelUser.Roles := vNewRoles; end;</span></span></code> </pre><br><br>  Where to save the changes to the TUser object in the database is up to you.  Someone might want to do this immediately, right inside the SetRoles class of TUser (so that all changes are reflected in the database instantly).  Someone implements saving changed TUser objects when clicking on the OK button in the window.  The third option is to save the OK button, as well as when trying to switch between users, if the current user‚Äôs roles have been changed (because the window interface above doesn‚Äôt visually track which employees have changed roles, and which ones haven‚Äôt, when switching from one employee to another, which can lead to an error). <br><br><h5>  Total </h5><br>  It turned out the user rights management window.  The window implements the following logic: <br>  1) Request a list of employees. <br>  2) Displays a list of employees. <br>  3) Getting the ID of the currently selected employee via SelUserID. <br>  4) Installation of the selected employee by ID with automatic updating of the list of his roles. <br>  5) Getting a list of selected employee roles through SelRoles. <br>  6) Adding and deleting roles. <br><br><h5>  Addition.  Refreshing the list with saving the selected item </h5><br>  It would be possible to stop here, but still I want to show how you can update the list of employees, without losing the current selected employee.  The functionality of manually updating the list of employees can be useful if adding employees via another window, and the mechanism for automatically notifying the window for changing rights to add a new employee is not implemented.  Also, a new employee can be added by another user of the system on another machine, and you do not want to restart to the rights configuration window so that the added user appears in the list. <br><br>  So, let's say you added another button ‚ÄúUpdate employee list‚Äù in the rights settings window.  Obviously, it should lead to a simple call to the FillUsers method.  But then the current selected employee will be lost (since the GUI list will be cleared and re-filled again), which will be very inconvenient and strange for the user. <br><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillUsers</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: Integer; vSavedSelUserID: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-comment"><span class="hljs-comment">//        if SelUserID &gt; 0 then vSavedSelUserID := SelUserID else vSavedSelUserID := -1; ... //   FUsers    ... //     if vSavedSelUserID &gt; 0 then begin FSelUserID := -1; SelUserID := vSavedSelUserID; end else SelUserID := -1; end;</span></span></code> </pre><br><br>  In the future, you may need even more: remember the last selected employee between repeated logins to the rights configuration window or even between application sessions.  In this case, you can add a parameter to FillUsers that determines which user to position on after rebuilding the list.  In this case, the logic of remembering the current user will have to complicate a little <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FillUsers</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> aSelUserID: Integer = -1)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i: Integer; vNeedSelUserID: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> aSelUserID &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment">//     ,    vNeedSelUserID := aSelUserID else if SelUserID &gt; 0 then //     -    vNeedSelUserID := SelUserID else vNeedSelUserID := -1; ... //   FUsers    ... if vNeedSelUserID &gt; 0 then begin FSelUserID := -1; SelUserID := vNeedSelUserID; end else SelUserID := -1; end;</span></span></code> </pre><br><br>  At the same time, FormCreate will change to <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> FillUsers(Config.RightsFormSavedUserID); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  and FormDestroy on <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TfmUserRights</span></span></span><span class="hljs-function">.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FormCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Sender: TObject)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> Config.RightsFormSavedUserID := SelUserID; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br><br>  Most of the above code is invented from the head, do not judge too strictly for typos and inaccuracies.  It is very similar to a real project, but in reality there are much more details in a real project that I don‚Äôt want to talk about now. <br><br>  Gradually, I am getting closer to linking the classes of internal data with the GUI controls.  I have not done that yet.  In the next part of the article, I will look at the notification subscription template and show how the GUI interface can react to changes in the objects themselves. <br><br>  Good luck! <br><br>  PS <br><br>  <a href="http://habrahabr.ru/post/147133/">1st part of the article</a> <br>  <a href="http://habrahabr.ru/post/147466/">3rd part of the article</a> </div><p>Source: <a href="https://habr.com/ru/post/147198/">https://habr.com/ru/post/147198/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147193/index.html">View RAW files with Windows</a></li>
<li><a href="../147194/index.html">Haipai I9220 - How the Chinese copied the Galaxy Note, but it turned out 5 "tablet</a></li>
<li><a href="../147195/index.html">API Rambler Maps</a></li>
<li><a href="../147196/index.html">Email marketing as brand management</a></li>
<li><a href="../147197/index.html">What can be seen on satellite images? Part 1. Places forbidden to view</a></li>
<li><a href="../147199/index.html">Chinese toothpaste maker is suing Apple because of the name "Snow Leopard"</a></li>
<li><a href="../147200/index.html">The creator of MeeGo and Nokia N9 left Nokia</a></li>
<li><a href="../147201/index.html">What pay for the success of IT-specialists</a></li>
<li><a href="../147204/index.html">Quick start of the first project in Windows Azure. Web sites</a></li>
<li><a href="../147205/index.html">Yandex.Search for a site: good news for site owners based on CMS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>