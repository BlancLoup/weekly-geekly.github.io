<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Programmable light switch with remote control</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuation of previously published articles, first , second . 
 This article will focus on a programmable light switch with a remote control. Like p...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Programmable light switch with remote control</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/900/f3c/af2/900f3caf26fdd4f21c15bd9a3d4c324b.png" alt="image"><br>  Continuation of previously published articles, <a href="http://habrahabr.ru/post/144180/">first</a> , <a href="http://habrahabr.ru/post/145639/">second</a> . <br>  This article will focus on a programmable light switch with a remote control.  Like past projects for debugging and prototyping, I use <a href="http://carmonitor.ru/ru/product_info.php%3Fproducts_id%3D120">Carduino Nano V.7</a> <br><a name="habracut"></a><br><br><h4>  Required functionality </h4><br>  The ability to control the switch with any household IR remote control. <br>  Program the switch to any button of the household IR remote control. <br>  Turn on / off the light, both from the switch key and from the remote, regardless of each other. <br><br><h4>  Scheme and accessories </h4><br><img src="https://habrastorage.org/getpro/geektimes/post_images/dad/8b8/f7e/dad8b8f7eb708f94dd2e7c43df6e7530.png" alt="image"><br>  To build the prototype used the following components: <br>  <a href="http://carmonitor.ru/ru/product_info.php%3Fproducts_id%3D120">Carduino Nano V.7 Controller</a> <br>  <a href="http://carmonitor.ru/ru/product_info.php%3Fproducts_id%3D172">Relay Module</a> <br>  <a href="http://carmonitor.ru/ru/product_info.php%3Fproducts_id%3D117">IR receiver TSOP</a> <br>  <a href="http://carmonitor.ru/ru/product_info.php%3Fproducts_id%3D126">Bread board</a> <br>  <a href="http://www.chipdip.ru/product/hc0905a.aspx">Sound Emitter</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Photograph of components <br><img src="https://habrastorage.org/getpro/geektimes/post_images/1f4/460/9af/1f44609af25edeb3ebd2f8bf9a51494c.jpg" alt="image"><br><br><h4>  Switch operation description </h4><br>  At first we add the code of the button of the control panel to the memory of the switch.  To do this, we take the most suitable remote control for us (the remote control from the air conditioner will not work) and select a free button on it that you never use (usually the colored teletext buttons).  We enter the switch programming mode, for this you need to press the on / off key and hold for 5 seconds, a long beep will sound, then it remains to press the previously selected remote control button and your switch is ready for operation.  Now the light switch will understand the command of your IR remote control added to it.  The button code is stored in the non-volatile memory of the controller and will be stored in memory even after the power supply to the circuit is turned off. <br><br>  The operation of the prototype switch, see the video <br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/G8MzeUVB2OM%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700190,15700253,15700255,15700259&amp;usg=ALkJrhi_u7lSZRhAnAbL-fNV0D1dYMPMkQ" frameborder="0" allowfullscreen=""></iframe><br><br><h4>  Code for Arduino controller </h4><br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;IRremote.h&gt; #include &lt;avr/delay.h&gt; #include &lt;EEPROM.h&gt; #define button 7 #define speaker 11 #define lamp 6 IRrecv irrecv(2); //    decode_results results; unsigned long ir_command; uint8_t swt, count, state = 0; //  void setup() { pinMode(speaker, OUTPUT);// pinMode(button, INPUT);//   digitalWrite(button,HIGH);//  pinMode(lamp, OUTPUT);// irrecv.enableIRIn(); //   } void loop() { swt=digitalRead(button); count=0; while(swt==0) { if(count&gt;30) { beep(100,400); for(unsigned long i=0; i&lt;2000000; i++) { if (irrecv.decode(&amp;results)) { SaveEEPROM(results.value); irrecv.resume(); break; } } beep(30,900); break; } count++; swt=digitalRead(button); _delay_ms(100); } ir_command=LoadEEPROM(); if (irrecv.decode(&amp;results)) { if(ir_command==results.value) { state=~state; digitalWrite(lamp, state); beep(10,300); _delay_ms(700); } irrecv.resume(); } else if(count&gt;1) { state=~state; digitalWrite(lamp, state); beep(10,500); _delay_ms(100); } } void SaveEEPROM(unsigned long ir_code) { EEPROM.write(0, ir_code &amp; 0xFF); EEPROM.write(1, (ir_code &amp; 0xFF00) &gt;&gt; 8); EEPROM.write(2, (ir_code &amp; 0xFF0000) &gt;&gt; 16); EEPROM.write(3, (ir_code &amp; 0xFF000000) &gt;&gt; 24); } unsigned long LoadEEPROM() { byte val = EEPROM.read(3); unsigned long ir_code=val; val = EEPROM.read(2); ir_code= (ir_code &lt;&lt; 8) | val; val = EEPROM.read(1); ir_code= (ir_code &lt;&lt; 8) | val; val = EEPROM.read(0); ir_code= (ir_code &lt;&lt; 8) | val; return ir_code; } void beep(byte dur, word frq) { dur=(1000/frq)*dur; for(byte i=0; i&lt;dur; i++) { digitalWrite(speaker, HIGH); _delay_us(frq); digitalWrite(speaker, LOW); _delay_us(frq); } }</span></span></span></span></code> </pre> <br><br>  To compile the code you need to add the library <a href="http://www.compcar.ru/forum/attachment.php%3Fattachmentid%3D12229%26d%3D1306179619">IRemote</a> .  The library is different from the original, as I added several protocols to it, including the new protocol of Samsung LED TVs <br><br><h4>  Circuit Breaker </h4><br>  After debugging the device on the arduino, I drew the final circuit of the future switch.  Since I already wrote earlier that Arduino is a convenient tool for debugging and writing code, but it will not work for the final circuit. <br><img src="http://cyber-place.ru/attachment.php?attachmentid=381&amp;d=1339065121" alt="image"><br><br>  <a href="http://cyber-place.ru/attachment.php%3Fattachmentid%3D382%26d%3D1339082814">Hex file</a> for Atmega168 controller firmware <br>  The power supply can be used from a mobile phone charger. <br>  Power supply circuits. <br><br>  If you have questions, ask, I will answer them with pleasure. </div><p>Source: <a href="https://habr.com/ru/post/145653/">https://habr.com/ru/post/145653/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../145648/index.html">Salt the passwords</a></li>
<li><a href="../145649/index.html">Effective web development with Visual Studio 2012: innovations in the editors HTML / CSS and JavaScript</a></li>
<li><a href="../145650/index.html">A series of database leaks continues, this time Riot Games</a></li>
<li><a href="../145651/index.html">YoungYear Electronics introduced a wire case for PC</a></li>
<li><a href="../145652/index.html">Duracell and Powermat show off new charging system</a></li>
<li><a href="../145654/index.html">Broadcast from Apple WWDC 2012</a></li>
<li><a href="../145656/index.html">Apple has updated a bit and Mac Pro</a></li>
<li><a href="../145657/index.html">CSS is my LSD</a></li>
<li><a href="../145658/index.html">30 most popular passwords stolen from LinkedIn</a></li>
<li><a href="../145659/index.html">Artificial intelligence, intelligence, life ... How long to wait for them?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>