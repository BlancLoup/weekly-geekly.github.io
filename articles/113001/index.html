<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We are trying to make a PDF book from a web comic with Haskell using the example of xkcd</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After reading the article I decided to check how suitable Haskell is for this. I‚Äôll say right away that Haskell itself is quite good, but, having run ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We are trying to make a PDF book from a web comic with Haskell using the example of xkcd</h1><div class="post__text post__text-html js-mediator-article">  After reading the <a href="http://habrahabr.ru/blogs/net/112965/">article</a> I decided to check how suitable Haskell is for this.  I‚Äôll say right away that Haskell itself is quite good, but, having run through <a href="http://hackage.haskell.org/">hackage.haskell.org</a> , I immediately found problems with libraries for working with PDF, which put an end to full implementation. <br>  But I decided to still do some of the work in order to show how the same task <i>could be done</i> in Haskell, if only if ... <br><a name="habracut"></a><br><h5>  Get comic strip info </h5><br>  Since we will have to request information in the form of JSON, we will immediately write a useful function: <br> <code><nobr>rethrow</nobr> <font color="#60af11">::</font> <font color="#60af11">(</font> <font color="#d1cb06">Show</font> e <font color="#60af11">)</font> <font color="#60af11">=&gt;</font> <font color="#d1cb06">Exceptional</font> ea <font color="#60af11">-&gt;</font> <font color="#d1cb06">IO</font> a&lt;br&gt; <br> rethrow <font color="#60af11">=</font> switch <font color="#60af11">(</font> throwIO <font color="#60af11">.</font> userError <font color="#60af11">.</font> show <font color="#60af11">)</font> return&lt;br&gt; <br> &lt;br&gt; <br> jsonAt url <font color="#60af11">=</font> simpleHTTP <font color="#60af11">(</font> getRequest url <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> getResponseBody <font color="#60af11">&gt;&gt;=</font> rethrow <font color="#60af11">.</font> decode_ json&lt;br&gt; <br> &lt;br&gt; <br> str s <font color="#60af11">=</font> member_ <font color="#60af11">(</font> literal s <font color="#60af11">)</font> <font color="#d1cb06">JSON</font> <font color="#60af11">.</font> string&lt;br&gt; <br> num n <font color="#60af11">=</font> member_ <font color="#60af11">(</font> literal n <font color="#60af11">)</font> <font color="#d1cb06">JSON</font> <font color="#60af11">.</font> number&lt;br&gt; <br> <br></code> <br>  The <code>rethrow</code> function <code>rethrow</code> throw an exception in case of erroneous parsing, and <code>str</code> and <code>num</code> will simplify specifying the required fields in JSON. <br><br>  Then the code for the latest comic and comic by number will look like this: <br> <code><nobr>comics</nobr> <font color="#60af11">=</font> jsonAt <font color="#db2b72">"http://xkcd.com/info.0.json"</font> <font color="#60af11">&gt;&gt;=</font> fmap <font color="#60af11">(</font> fromIntegral <font color="#60af11">.</font> numerator <font color="#60af11">)</font> <font color="#60af11">.</font> rethrow <font color="#60af11">.</font> decode_ <font color="#60af11">(</font> num <font color="#db2b72">"num"</font> <font color="#60af11">)</font> &lt;br&gt; <br> &lt;br&gt; <br> comic n <font color="#60af11">=</font> jsonAt <font color="#60af11">(</font> concat <font color="#60af11">[</font> <font color="#db2b72">"http://xkcd.com/"</font> <font color="#60af11">,</font> show n <font color="#60af11">,</font> <font color="#db2b72">"/info.0.json"</font> <font color="#60af11">]</font> <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> rethrow <font color="#60af11">.</font> decode_ <font color="#60af11">(</font> str <font color="#db2b72">"img"</font> <font color="#60af11">&lt;&amp;&gt;</font> str <font color="#db2b72">"title"</font> <font color="#60af11">)</font> &lt;br&gt; <br></code> <br>  The <code>decode_</code> function <code>decode_</code> received data in accordance with the specified pattern.  In the case of <code><nobr>num</nobr> <font color="#db2b72">"num"</font> <br></code> <code><nobr>num</nobr> <font color="#db2b72">"num"</font> <br></code>  we get from JSON a numeric term named <i>num</i> , in the case of <code><nobr>str</nobr> <font color="#db2b72">"img"</font> <font color="#60af11">&lt;&amp;&gt;</font> str <font color="#db2b72">"title"</font> <br></code> <code><nobr>str</nobr> <font color="#db2b72">"img"</font> <font color="#60af11">&lt;&amp;&gt;</font> str <font color="#db2b72">"title"</font> <br></code>  - stupid of two lines for the picture and the title, respectively. <br><br>  The code for getting the image by URL: <br> <code><nobr>image url</nobr> <font color="#60af11">=</font> simpleHTTP <font color="#60af11">(</font> getRequest url <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> getResponseBody&lt;br&gt; <br></code> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Download stream </h5><br>  Let's write down download of one comic book in separate function. <br> <code><nobr>retrieve ch li</nobr> <font color="#60af11">=</font> tryGet <font color="#60af11">`onException`</font> onFail <font color="#2080bc">where</font> &lt;br&gt; <br> onFail <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> writeChan ch <font color="#60af11">(</font> i <font color="#60af11">,</font> <font color="#d1cb06">Nothing</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Error</font> <font color="#60af11">$</font> <font color="#db2b72">"Comic "</font> <font color="#60af11">++</font> show i <font color="#60af11">++</font> <font color="#db2b72">" failed to download"</font> &lt;br&gt; <br> tryGet <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> <font color="#60af11">(</font> imgUrl <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">&lt;-</font> comic i&lt;br&gt; <br> imgData <font color="#60af11">&lt;-</font> image imgUrl&lt;br&gt; <br> jpg <font color="#60af11">&lt;-</font> writeBinaryFile fname imgData <font color="#60af11">&gt;&gt;</font> readJpegFile fname <font color="#60af11">&gt;&gt;=</font> either <font color="#60af11">(</font> throwIO <font color="#60af11">.</font> userError <font color="#60af11">.</font> show <font color="#60af11">)</font> return&lt;br&gt; <br> writeChan ch <font color="#60af11">(</font> i <font color="#60af11">,</font> <font color="#d1cb06">Just</font> <font color="#60af11">(</font> jpg <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#60af11">$</font> <font color="#db2b72">"Comic "</font> <font color="#60af11">++</font> show i <font color="#60af11">++</font> <font color="#db2b72">" downloaded"</font> &lt;br&gt; <br> fname <font color="#60af11">=</font> show i <font color="#60af11">++</font> <font color="#db2b72">".jpg"</font> &lt;br&gt; <br></code> <br><br>  Here we used the <code>ch</code> channel ( <code>Control.Concurrent.Chan</code> ), to which we will send the download results, as well as the thread-safe <code>l</code> log. <br><br>  <i>Because of the curve of the HPDF library, you must first save the image to a file, and then load it from there again.</i>  <i>It‚Äôs not at all clear to me why the author wrote JPEG parsing from scratch himself (and only from a file), and did not use the finished library.</i> <br><br><h5>  PDF generation </h5><br>  Now it‚Äôs worth writing a function that, according to the list of pictures, will generate the resulting PDF for us. <br> <code><nobr>pdf imgs</nobr> <font color="#60af11">=</font> runPdf <font color="#db2b72">"Xkcd.pdf"</font> doc <font color="#60af11">(</font> <font color="#d1cb06">PDFRect</font> <font color="#db2b72">0</font> <font color="#db2b72">0</font> <font color="#db2b72">800</font> <font color="#db2b72">600</font> <font color="#60af11">)</font> <font color="#60af11">$</font> forM_ imgs genPage <font color="#2080bc">where</font> &lt;br&gt; <br> genPage <font color="#60af11">(</font> jpeg <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> img <font color="#60af11">&lt;-</font> createPDFJpeg jpeg&lt;br&gt; <br> page <font color="#60af11">&lt;-</font> addPage <font color="#d1cb06">Nothing</font> &lt;br&gt; <br> drawWithPage page <font color="#60af11">(</font> drawText <font color="#60af11">(</font> text <font color="#60af11">(</font> <font color="#d1cb06">PDFFont</font> <font color="#d1cb06">Times_Roman</font> <font color="#db2b72">12</font> <font color="#60af11">)</font> <font color="#db2b72">0</font> <font color="#db2b72">0</font> <font color="#60af11">(</font> toPDFString title <font color="#60af11">)</font> <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;</font> drawXObject img <font color="#60af11">)</font> &lt;br&gt; <br> doc <font color="#60af11">=</font> <font color="#d1cb06">PDFDocumentInfo</font> <font color="#60af11">{</font> &lt;br&gt; <br> author <font color="#60af11">=</font> toPDFString <font color="#db2b72">"xkcd"</font> <font color="#60af11">,</font> &lt;br&gt; <br> subject <font color="#60af11">=</font> toPDFString <font color="#db2b72">"xkcd"</font> <font color="#60af11">,</font> &lt;br&gt; <br> pageMode <font color="#60af11">=</font> <font color="#d1cb06">UseNone</font> <font color="#60af11">,</font> &lt;br&gt; <br> pageLayout <font color="#60af11">=</font> <font color="#d1cb06">OneColumn</font> <font color="#60af11">,</font> &lt;br&gt; <br> viewerPreferences <font color="#60af11">=</font> standardViewerPrefs <font color="#60af11">,</font> &lt;br&gt; <br> compressed <font color="#60af11">=</font> <font color="#d1cb06">False</font> <font color="#60af11">}</font> &lt;br&gt; <br></code> <br>  In general, there is nothing interesting in this function.  We call corresponding functions from libraries.  It is only the nuance that the list of pictures is lazy that is important, so the function starts as soon as the first picture appears. <br><br><h5>  Putting it together </h5><br>  In the main function, we initialize the log, create a channel to which lightweight threads will write the result, and call the PDF generation with a lazy list of pictures from this channel. <br> <code><nobr>main</nobr> <font color="#60af11">=</font> bracket <font color="#60af11">(</font> newLogger <font color="#d1cb06">Console</font> <font color="#60af11">)</font> closeLogger <font color="#60af11">$</font> <font color="#60af11">\</font> l <font color="#60af11">-&gt;</font> <font color="#2080bc">do</font> &lt;br&gt; <br> n <font color="#60af11">&lt;-</font> comics&lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#60af11">$</font> <font color="#db2b72">"Number of comics to download: "</font> <font color="#60af11">++</font> show n&lt;br&gt; <br> ch <font color="#60af11">&lt;-</font> newChan&lt;br&gt; <br> mapM_ <font color="#60af11">(</font> fork <font color="#60af11">.</font> retrieve ch l <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br> cts <font color="#60af11">&lt;-</font> fmap <font color="#60af11">(</font> take n <font color="#60af11">)</font> <font color="#60af11">$</font> getChanContents ch&lt;br&gt; <br> <font color="#2080bc">let</font> imgs <font color="#60af11">=</font> catMaybes <font color="#60af11">$</font> mapMaybe <font color="#60af11">(</font> <font color="#60af11">`lookup`</font> cts <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br> pdf imgs <font color="#60af11">`onException`</font> <font color="#60af11">(</font> writeLogger l <font color="#d1cb06">Error</font> <font color="#db2b72">"Unable to generate PDF"</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#db2b72">"PDF generated."</font> &lt;br&gt; <br></code> <br>  The <code>bracket</code> function is similar to <code>using</code> , guaranteeing the closure of the log. <br>  <code><nobr>mapM_</nobr> <font color="#60af11">(</font> fork <font color="#60af11">.</font> retrieve ch l <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br></code> <code><nobr>mapM_</nobr> <font color="#60af11">(</font> fork <font color="#60af11">.</font> retrieve ch l <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br></code>  we create an injection stream for each number, i.e.  call <code>retrieve ch li</code> in a separate thread. <br> <code><nobr>fmap</nobr> <font color="#60af11">(</font> take n <font color="#60af11">)</font> <font color="#60af11">$</font> getChanContents ch&lt;br&gt; <br></code>  returns us a lazy list with the first <code>n</code> results.  Take the whole list does not make sense, since the channel is endless. <br>  Then we use the <code>lookup</code> function, with each index in order, from <code>1</code> to <code>n</code> .  It is necessary to get a lazy list as a result, but in which the pictures are strictly in order.  Thus, we will always write pictures in the correct order. <br><br><h5>  Full listing </h5><br> <code><nobr>main</nobr> <font color="#60af11">=</font> bracket <font color="#60af11">(</font> newLogger <font color="#d1cb06">Console</font> <font color="#60af11">)</font> closeLogger <font color="#60af11">$</font> <font color="#60af11">\</font> l <font color="#60af11">-&gt;</font> <font color="#2080bc">do</font> &lt;br&gt; <br> n <font color="#60af11">&lt;-</font> comics&lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#60af11">$</font> <font color="#db2b72">"Number of comics to download: "</font> <font color="#60af11">++</font> show n&lt;br&gt; <br> ch <font color="#60af11">&lt;-</font> newChan&lt;br&gt; <br> mapM_ <font color="#60af11">(</font> fork <font color="#60af11">.</font> retrieve ch l <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br> cts <font color="#60af11">&lt;-</font> fmap <font color="#60af11">(</font> take n <font color="#60af11">)</font> <font color="#60af11">$</font> getChanContents ch&lt;br&gt; <br> <font color="#2080bc">let</font> imgs <font color="#60af11">=</font> catMaybes <font color="#60af11">$</font> mapMaybe <font color="#60af11">(</font> <font color="#60af11">`lookup`</font> cts <font color="#60af11">)</font> <font color="#60af11">[</font> <font color="#db2b72">1</font> <font color="#60af11">..</font> n <font color="#60af11">]</font> &lt;br&gt; <br> pdf imgs <font color="#60af11">`onException`</font> <font color="#60af11">(</font> writeLogger l <font color="#d1cb06">Error</font> <font color="#db2b72">"Unable to generate PDF"</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#db2b72">"PDF generated."</font> &lt;br&gt; <br> &lt;br&gt; <br> retrieve ch li <font color="#60af11">=</font> tryGet <font color="#60af11">`onException`</font> onFail <font color="#2080bc">where</font> &lt;br&gt; <br> onFail <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> writeChan ch <font color="#60af11">(</font> i <font color="#60af11">,</font> <font color="#d1cb06">Nothing</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Error</font> <font color="#60af11">$</font> <font color="#db2b72">"Comic "</font> <font color="#60af11">++</font> show i <font color="#60af11">++</font> <font color="#db2b72">" failed to download"</font> &lt;br&gt; <br> tryGet <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> <font color="#60af11">(</font> imgUrl <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">&lt;-</font> comic i&lt;br&gt; <br> imgData <font color="#60af11">&lt;-</font> image imgUrl&lt;br&gt; <br> jpg <font color="#60af11">&lt;-</font> writeBinaryFile fname imgData <font color="#60af11">&gt;&gt;</font> readJpegFile fname <font color="#60af11">&gt;&gt;=</font> either <font color="#60af11">(</font> throwIO <font color="#60af11">.</font> userError <font color="#60af11">.</font> show <font color="#60af11">)</font> return&lt;br&gt; <br> writeChan ch <font color="#60af11">(</font> i <font color="#60af11">,</font> <font color="#d1cb06">Just</font> <font color="#60af11">(</font> jpg <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">)</font> &lt;br&gt; <br> writeLogger l <font color="#d1cb06">Info</font> <font color="#60af11">$</font> <font color="#db2b72">"Comic "</font> <font color="#60af11">++</font> show i <font color="#60af11">++</font> <font color="#db2b72">" downloaded"</font> &lt;br&gt; <br> fname <font color="#60af11">=</font> show i <font color="#60af11">++</font> <font color="#db2b72">".jpg"</font> &lt;br&gt; <br> &lt;br&gt; <br> pdf imgs <font color="#60af11">=</font> runPdf <font color="#db2b72">"Xkcd.pdf"</font> doc <font color="#60af11">(</font> <font color="#d1cb06">PDFRect</font> <font color="#db2b72">0</font> <font color="#db2b72">0</font> <font color="#db2b72">800</font> <font color="#db2b72">600</font> <font color="#60af11">)</font> <font color="#60af11">$</font> forM_ imgs genPage <font color="#2080bc">where</font> &lt;br&gt; <br> genPage <font color="#60af11">(</font> jpeg <font color="#60af11">,</font> title <font color="#60af11">)</font> <font color="#60af11">=</font> <font color="#2080bc">do</font> &lt;br&gt; <br> img <font color="#60af11">&lt;-</font> createPDFJpeg jpeg&lt;br&gt; <br> page <font color="#60af11">&lt;-</font> addPage <font color="#d1cb06">Nothing</font> &lt;br&gt; <br> drawWithPage page <font color="#60af11">(</font> drawText <font color="#60af11">(</font> text <font color="#60af11">(</font> <font color="#d1cb06">PDFFont</font> <font color="#d1cb06">Times_Roman</font> <font color="#db2b72">12</font> <font color="#60af11">)</font> <font color="#db2b72">0</font> <font color="#db2b72">0</font> <font color="#60af11">(</font> toPDFString title <font color="#60af11">)</font> <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;</font> drawXObject img <font color="#60af11">)</font> &lt;br&gt; <br> doc <font color="#60af11">=</font> <font color="#d1cb06">PDFDocumentInfo</font> <font color="#60af11">{</font> &lt;br&gt; <br> author <font color="#60af11">=</font> toPDFString <font color="#db2b72">"voidex"</font> <font color="#60af11">,</font> &lt;br&gt; <br> subject <font color="#60af11">=</font> toPDFString <font color="#db2b72">"xkcd"</font> <font color="#60af11">,</font> &lt;br&gt; <br> pageMode <font color="#60af11">=</font> <font color="#d1cb06">UseNone</font> <font color="#60af11">,</font> &lt;br&gt; <br> pageLayout <font color="#60af11">=</font> <font color="#d1cb06">OneColumn</font> <font color="#60af11">,</font> &lt;br&gt; <br> viewerPreferences <font color="#60af11">=</font> standardViewerPrefs <font color="#60af11">,</font> &lt;br&gt; <br> compressed <font color="#60af11">=</font> <font color="#d1cb06">False</font> <font color="#60af11">}</font> &lt;br&gt; <br> &lt;br&gt; <br> rethrow <font color="#60af11">::</font> <font color="#60af11">(</font> <font color="#d1cb06">Show</font> e <font color="#60af11">)</font> <font color="#60af11">=&gt;</font> <font color="#d1cb06">Exceptional</font> ea <font color="#60af11">-&gt;</font> <font color="#d1cb06">IO</font> a&lt;br&gt; <br> rethrow <font color="#60af11">=</font> switch <font color="#60af11">(</font> throwIO <font color="#60af11">.</font> userError <font color="#60af11">.</font> show <font color="#60af11">)</font> return&lt;br&gt; <br> &lt;br&gt; <br> jsonAt url <font color="#60af11">=</font> simpleHTTP <font color="#60af11">(</font> getRequest url <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> getResponseBody <font color="#60af11">&gt;&gt;=</font> rethrow <font color="#60af11">.</font> decode_ json&lt;br&gt; <br> &lt;br&gt; <br> str s <font color="#60af11">=</font> member_ <font color="#60af11">(</font> literal s <font color="#60af11">)</font> <font color="#d1cb06">JSON</font> <font color="#60af11">.</font> string&lt;br&gt; <br> num n <font color="#60af11">=</font> member_ <font color="#60af11">(</font> literal n <font color="#60af11">)</font> <font color="#d1cb06">JSON</font> <font color="#60af11">.</font> number&lt;br&gt; <br> &lt;br&gt; <br> comics <font color="#60af11">=</font> jsonAt <font color="#db2b72">"http://xkcd.com/info.0.json"</font> <font color="#60af11">&gt;&gt;=</font> fmap <font color="#60af11">(</font> fromIntegral <font color="#60af11">.</font> numerator <font color="#60af11">)</font> <font color="#60af11">.</font> rethrow <font color="#60af11">.</font> decode_ <font color="#60af11">(</font> num <font color="#db2b72">"num"</font> <font color="#60af11">)</font> &lt;br&gt; <br> &lt;br&gt; <br> comic n <font color="#60af11">=</font> jsonAt <font color="#60af11">(</font> concat <font color="#60af11">[</font> <font color="#db2b72">"http://xkcd.com/"</font> <font color="#60af11">,</font> show n <font color="#60af11">,</font> <font color="#db2b72">"/info.0.json"</font> <font color="#60af11">]</font> <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> rethrow <font color="#60af11">.</font> decode_ <font color="#60af11">(</font> str <font color="#db2b72">"img"</font> <font color="#60af11">&lt;&amp;&gt;</font> str <font color="#db2b72">"title"</font> <font color="#60af11">)</font> &lt;br&gt; <br> &lt;br&gt; <br> image url <font color="#60af11">=</font> simpleHTTP <font color="#60af11">(</font> getRequest url <font color="#60af11">)</font> <font color="#60af11">&gt;&gt;=</font> getResponseBody&lt;br&gt; <br> &lt;br&gt; <br> writeBinaryFile fname str <font color="#60af11">=</font> withBinaryFile fname <font color="#d1cb06">WriteMode</font> <font color="#60af11">(</font> <font color="#60af11">\</font> h <font color="#60af11">-&gt;</font> hPutStr h str <font color="#60af11">)</font> &lt;br&gt; <br></code> <br><br><h5>  Swearing </h5><br>  Unfortunately, due to the lack of a decent library for working with PDF, the result did not pay off. <br>  Most of the pictures HPDF refuses to accept (thanks to the regular bicycle implementation of the JPEG download), I did not even begin to understand the scaling of the pictures. <br><br><h5>  Praises </h5><br>  It was very convenient to test the request right in GHCi, then disassemble one of them, download and save the picture.  All development was carried out there, and then the code was transferred to a file.  Multithreading was bolted on without adding interfaces and any extra code.  Instead of returning the result, we simply write it to the channel, on the other end of which is the handler.  And we add a <code>fork</code> to the asynchronous function.  In the general case, not everything is so simple, of course, but from my own experience I will say that I have never had to change the architecture for this. <br><br>  In general, look at <a href="http://hackage.haskell.org/">hackage.haskell.org</a> , look for the necessary libraries, and if found, do not miss the chance to write everything in Haskell! </div><p>Source: <a href="https://habr.com/ru/post/113001/">https://habr.com/ru/post/113001/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112993/index.html">DDoS attacks exceeded 100 Gbps</a></li>
<li><a href="../112995/index.html">EDITOR fruustration</a></li>
<li><a href="../112996/index.html">Operational Amplifiers (Based on Simplest Examples): Part 3</a></li>
<li><a href="../112997/index.html">File paths</a></li>
<li><a href="../112998/index.html">Performance Comparison of Jacket and PCT / GPU from Stanford</a></li>
<li><a href="../113002/index.html">Chrome ranked more than 10% of the browser market</a></li>
<li><a href="../113003/index.html">Brains and Motors</a></li>
<li><a href="../113004/index.html">Networking - what happens behind the scenes?</a></li>
<li><a href="../113008/index.html">Avaya IP Office for Dummies. The conference</a></li>
<li><a href="../113009/index.html">Splash! - development of the game for Windows Phone 7. Part I</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>