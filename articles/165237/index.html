<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Guide to using Dependency Injection in symfony2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article provides an example of creating a simple blog site using the Dependency Injection pattern. A dependency-injection approach is applied to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Guide to using Dependency Injection in symfony2</h1><div class="post__text post__text-html js-mediator-article">  This article provides an example of creating a simple blog site using the <a href="http://ru.wikipedia.org/wiki/%25D0%2592%25D0%25BD%25D0%25B5%25D0%25B4%25D1%2580%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5_%25D0%25B7%25D0%25B0%25D0%25B2%25D0%25B8%25D1%2581%25D0%25B8%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D0%25B8">Dependency Injection</a> pattern.  A dependency-injection approach is applied to all possible symfony components: controllers, doctrine repositories, forms. <br><br>  To simplify the article, we reduce the number of pages to two: <br><ul><li>  Adding a new post (/ add) </li><li>  Displays a list of all posts (/ list) </li></ul><br>  The final architecture of the application will look like this: <br><img src="https://habrastorage.org/storage2/1ad/0c0/254/1ad0c025444925b70b96ff89b623101e.png"><br><a name="habracut"></a><br><h2>  Step 1. Creating an arbitrary service </h2><br>  <abbr title="Dependency Injection">DI</abbr> as part of symfony has already been <a href="http://habrahabr.ru/post/117572/">considered</a> on the habre, and also described in detail in the <a href="http://symfony.com/doc/current/book/service_container.html">documentation</a> .  Therefore, we will immediately begin to create our own services and dependencies.  This can be done in three ways: specifying dependencies in the bundle code, through configuration files (YAML, XML, PHP) and using annotations (using the <a href="http://jmsyst.com/bundles/JMSDiExtraBundle">JMSDiExtraBundle</a> bundle that <a href="http://jmsyst.com/bundles/JMSDiExtraBundle">comes</a> standard with Symfony).  Each method has its pros and cons.  We will use annotations for clarity and reduce the amount of code.  Let's start with a class that implements business logic.  Let it be a PostManager that handles the addition of a new post: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Manager/PostManager.php</b> <div class="spoiler_text"><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Manager</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">DiExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DI</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">User</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Service("app.manager.post", public=false) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostManager</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("doctrine.orm.entity_manager") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Doctrine\ORM\EntityManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $em; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addPost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Post $post, User $user)</span></span></span><span class="hljs-function"> </span></span>{ $post-&gt;setAuthor($user); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em-&gt;persist($post); $user-&gt;setLastPost($post); $user-&gt;increasePostsCount(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em-&gt;flush(); } }</code> </pre> <br></div></div><br>  <b>@DI \ Service</b> - turns the class into a service.  The annotation parameters specify the name of the service (app.manager.post) and its attributes. <br>  <b>public = false</b> - this attribute <a href="http://symfony.com/doc/current/components/dependency_injection/advanced.html">indicates</a> that the created service cannot be called directly from <abbr title="Dependency Injection Container">DIC</abbr> ($ container-&gt; get ('app.manager.post') will result in an error).  The created service will be able to use only services that depend on it explicitly (hereinafter, in the example with the controller, it will become clearer). <br>  <b>@DI \ Inject</b> - an indication of the services on which the created service depends.  This annotation can only be used with public variables.  For private / protected dependency variables, you can use <a href="http://jmsyst.com/bundles/JMSDiExtraBundle/master/usage">@DI \ InjectParams</a> for the constructor or other ways to create services. <br><br>  So, we have created the <b>app.manager.post</b> service, which depends on <b>doctrine.orm.entity_manager</b> : <br><img src="https://habrastorage.org/storage2/070/429/6ac/0704296accfa59cb8ae651845dec86d9.png"><br>  A graphical display of services and links is available in a convenient web interface with the installation of the <a href="http://jmsyst.com/bundles/JMSDebuggingBundle">JMSDebuggingBundle</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Step 2. Creating a controller </h2><br>  By default, symfony controllers are not services, but there is a <a href="http://symfony.com/doc/2.0/cookbook/controller/service.html">note</a> in the documentation that allows them to be made.  Create a PostController using the previously created PostManager: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Controller/PostController.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">DiExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DI</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sensio</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Configuration</span></span>\<span class="hljs-title"><span class="hljs-title">Route</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Sensio</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Configuration</span></span>\<span class="hljs-title"><span class="hljs-title">Template</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">SecurityExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Secure</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Symfony</span></span>\<span class="hljs-title"><span class="hljs-title">Bundle</span></span>\<span class="hljs-title"><span class="hljs-title">FrameworkBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>\<span class="hljs-title"><span class="hljs-title">Controller</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>\<span class="hljs-title"><span class="hljs-title">Post</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>\<span class="hljs-title"><span class="hljs-title">PostType</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Service("app.controller.post", scope="request") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">(service="app.controller.post") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("service_container") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $container; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("app.manager.post") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \AppBundle\Manager\PostManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $postManager; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">("/add", name="post_add") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Template</span></span></span><span class="hljs-comment"> * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Secure</span></span></span><span class="hljs-comment">(roles="ROLE_USER") */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $post = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Post(); $form = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createForm(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PostType(), $post); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()-&gt;getMethod() == <span class="hljs-string"><span class="hljs-string">'POST'</span></span>) { $form-&gt;bind(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($form-&gt;isValid()) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;postManager-&gt;addPost($post, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getUser()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;generateUrl(<span class="hljs-string"><span class="hljs-string">'post_list'</span></span>)); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'form'</span></span> =&gt; $form-&gt;createView() ); } }</code> </pre><br></div></div><br>  <b>scope = "request"</b> - this attribute is <a href="http://symfony.com/doc/current/cookbook/service_container/scopes.html">described</a> in detail in the documentation. <br>  <b>@ Route (service = "app.controller.post")</b> - informs the routing system that this controller is used as a service.  In this case, the string values ‚Äã‚Äãof the redirection rules will change from 'AppBundle: Post: add' to 'app.controller.post:addAction'. <br>  Using the <b>@DI \ Inject dependency ("service_container")</b> requires the parent controller class Symfony \ Bundle \ FrameworkBundle \ Controller \ Controller.  As a controller, any classes are allowed, not necessarily derived from a standard controller - in this case, the dependence on <abbr title="Dependency Injection Container">DIC</abbr> can be excluded. <br><br>  Thus, we have created the <b>app.controller.post</b> service, dependent on <b>service_container</b> and <b>app.manager.post</b> : <br><img src="https://habrastorage.org/storage2/68b/f25/63e/68bf2563e1109832b04ebabb328b1474.png"><br>  Service access to service_container means that it has access to all public services of the project at once (through $ this-&gt; container-&gt; get ('...')).  This makes it easier to use the framework, but it‚Äôs almost impossible to track communications between services with this approach.  Therefore, for application services, it is recommended to use the public attribute = false and follow the rule: <br><img src="https://habrastorage.org/storage2/26b/44b/bd4/26b44bbd4abc334df2bd5a0f7c9d218f.png"><br><br><h2>  Step 3. Creating a form </h2><br>  This step is not mandatory and rather serves to demonstrate the possibilities and consolidate the material.  But in large projects that use a large number of forms, it can be useful to control connections. <br>  In the created controller, we used the PostType form, we will try to define it as a service: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Form/PostType.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Form</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">DiExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DI</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Service("app.form.post", public=false) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostType</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractType</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br></div></div><br>  Let's use the created service in the controller: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Controller/PostController.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("app.form.post") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \AppBundle\Form\PostType */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $postType; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $post = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Post(); $form = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createForm(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;postType, $post); <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> } }</code> </pre><br></div></div><br>  Now we can trace the connection between the form and the controller: <br><img src="https://habrastorage.org/storage2/149/fbe/d1b/149fbed1b431e882d2a6dae8b049d877.png"><br><br><h2>  Step 4. Creating a repository </h2><br><h3>  First way: factory creation </h3><br>  Using Doctrine repositories as services is complicated by the fact that they are not part of Symfony, but are part of Doctrine.  But such an opportunity is still there, through the <a href="http://symfony.com/doc/current/components/dependency_injection/factories.html">factory</a> creation of services.  Unfortunately, at the moment it is <a href="https://github.com/schmittjoh/JMSDiExtraBundle/issues/65">not supported</a> through annotations, so you will have to use configs. <br>  In the Doctrine-entity file, specify the path to the repository: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Entity/Post.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity(repositoryClass="AppBundle\Repository\PostRepository") */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br></div></div><br>  Create a PostRepository to get the page list of posts: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Repository/PostRepository.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">EntityRepository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Tools</span></span>\<span class="hljs-title"><span class="hljs-title">Pagination</span></span>\<span class="hljs-title"><span class="hljs-title">Paginator</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EntityRepository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getListPaginator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($first, $max)</span></span></span><span class="hljs-function"> </span></span>{ $qb = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createQueryBuilder(<span class="hljs-string"><span class="hljs-string">'p'</span></span>) -&gt;orderBy(<span class="hljs-string"><span class="hljs-string">'p.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>) -&gt;setFirstResult($first) -&gt;setMaxResults($max); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paginator($qb-&gt;getQuery()); } }</code> </pre><br></div></div><br>  We define the created class as the <b>app.repository.post</b> service: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Resources/config/services.yml</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">services</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">app</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.repository</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.post</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">class</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">AppBundle</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Repository</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">PostRepository</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">factory_service</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">doctrine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.orm</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.entity_manager</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">factory_method</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">getRepository</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">public</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">false</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">arguments</span></span>: <span class="hljs-selector-attr"><span class="hljs-selector-attr">[AppBundle\Entity\Post]</span></span></code> </pre><br></div></div><br>  Add a repository and a list page to the controller: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Controller/PostController.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("app.repository.post") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \AppBundle\Repository\PostRepository */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $postRepository; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $itemsPerPage = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">("/list/{page}", requirements={"page"="\d+"}, defaults={"page"=1}, name="post_list") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Template</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($page)</span></span></span><span class="hljs-function"> </span></span>{ $posts = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;postRepository-&gt;getListPaginator( $first = ($page<span class="hljs-number"><span class="hljs-number">-1</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage, $max = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'posts'</span></span> =&gt; $posts, <span class="hljs-string"><span class="hljs-string">'page'</span></span> =&gt; $page, <span class="hljs-string"><span class="hljs-string">'pagesCount'</span></span> =&gt; ceil(count($posts)/<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage), ); } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br></div></div><br><h3>  The second way: the creation of repositories-wrappers </h3><br>  This method uses the <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25B4%25D0%25B0%25D0%25BF%25D1%2582%25D0%25B5%25D1%2580_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">Adapter</a> pattern.  The standard Doctrine repository is included in our own service repository.  Unlike the first method, here everything is realizable by annotations. <br>  In the Doctrine-entity file, we remove the repository directive: <br><div class="spoiler">  <b class="spoiler_title">src / AppBundle / Entity / Post.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Entity</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Mapping</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">ORM</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Table() * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span><span class="hljs-comment">\Entity() */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Post</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br></div></div><br>  We will need a parent class Repository, dependent on doctrine.orm.entity_manager and implementing the necessary functions of the repository.  To do this, we use the <a href="http://symfony.com/doc/current/components/dependency_injection/parentservices.html">inheritance of services</a> : <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Repository/Repository.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">DiExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DI</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Service("app.repository", abstract=true) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("doctrine.orm.entity_manager") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \Doctrine\ORM\EntityManager */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $em; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $repositoryName; <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Doctrine\ORM\EntityRepository */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getDoctrineRepository</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;em-&gt;getRepository(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;repositoryName); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">find</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrineRepository()-&gt;find($id); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findOneBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $criteria)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrineRepository()-&gt;findOneBy($criteria); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findBy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $criteria, array $orderBy = null, $limit = null, $offset = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrineRepository()-&gt;findBy($criteria, $orderBy, $limit, $offset); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">findAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrineRepository()-&gt;findAll(); } <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> \Doctrine\ORM\QueryBuilder */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createQueryBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($alias)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getDoctrineRepository()-&gt;createQueryBuilder($alias); } }</code> </pre><br></div></div><br>  The service definition will now be in the wrapper repository class itself: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Repository/PostRepository.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">AppBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Repository</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">JMS</span></span>\<span class="hljs-title"><span class="hljs-title">DiExtraBundle</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span> <span class="hljs-title"><span class="hljs-title">as</span></span> <span class="hljs-title"><span class="hljs-title">DI</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Doctrine</span></span>\<span class="hljs-title"><span class="hljs-title">ORM</span></span>\<span class="hljs-title"><span class="hljs-title">Tools</span></span>\<span class="hljs-title"><span class="hljs-title">Pagination</span></span>\<span class="hljs-title"><span class="hljs-title">Paginator</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Service("app.repository.post", parent="app.repository", public=false) */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostRepository</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Repository</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $repositoryName = <span class="hljs-string"><span class="hljs-string">'AppBundle:Post'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getListPaginator</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($first, $max)</span></span></span><span class="hljs-function"> </span></span>{ $qb = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createQueryBuilder(<span class="hljs-string"><span class="hljs-string">'p'</span></span>) -&gt;orderBy(<span class="hljs-string"><span class="hljs-string">'p.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>) -&gt;setFirstResult($first) -&gt;setMaxResults($max); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Paginator($qb-&gt;getQuery()); } }</code> </pre><br></div></div><br>  Note: when using annotations, specifying the parameter parent = "app.repository" is not required.  JMSDiExtraBundle substitutes it automatically, based on the parent class. <br><br>  Both methods implement the same functionality and are interchangeable.  Therefore, the controller code will not change: <br><div class="spoiler">  <b class="spoiler_title">/src/AppBundle/Controller/PostController.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PostController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Controller</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@DI</span></span></span><span class="hljs-comment">\Inject("app.repository.post") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> \AppBundle\Repository\PostRepository */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $postRepository; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $itemsPerPage = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Route</span></span></span><span class="hljs-comment">("/list/{page}", requirements={"page"="\d+"}, defaults={"page"=1}, name="post_list") * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Template</span></span></span><span class="hljs-comment"> */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($page)</span></span></span><span class="hljs-function"> </span></span>{ $posts = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;postRepository-&gt;getListPaginator( $first = ($page<span class="hljs-number"><span class="hljs-number">-1</span></span>)*<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage, $max = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'posts'</span></span> =&gt; $posts, <span class="hljs-string"><span class="hljs-string">'page'</span></span> =&gt; $page, <span class="hljs-string"><span class="hljs-string">'pagesCount'</span></span> =&gt; ceil(count($posts)/<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;itemsPerPage), ); } <span class="hljs-comment"><span class="hljs-comment">/* ... */</span></span> }</code> </pre><br></div></div><br>  As a result, the dependency graph of the application will take the following form: <br><img src="https://habrastorage.org/storage2/b2b/1d4/fdb/b2b1d4fdbf1b08955f0b435475f2994c.png"><br>  To control relationships with this approach, you must follow the rule: <br><img src="https://habrastorage.org/storage2/03d/c54/9ce/03dc549ce3342285d6a5179e273e2c56.png"><br><br><h2>  Step 5. Optimization </h2><br>  As you have already noticed, all dependencies of the service are its variables and are created along with the creation of this service.  In turn, when creating dependencies, their dependencies are created, thus all the elements of the subtree of dependencies, including unused ones, are created.  By the example of app.controller.post, we see that the addAction function uses app.manager.post and app.form.post, and the listAction function is app.repository.post.  But all the variables are created when creating the controller, therefore, no matter what function we call, some of the variables will be unused: in the case of addAction, this is app.repository.post, in the case of listAction, app.manager.post and app.form.post.  This class consists of two independent parts, in which case they say that it has a low <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B2%25D1%258F%25D0%25B7%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">connectivity</a> .  The more methods a method works with a large number of variables, the higher the connectivity of this method with its class.  The class in which each variable is used by each method has maximum connectivity.  Creating classes with maximum connectivity is not always possible, but in our case this is easily achieved by dividing app.controller.post into two independent classes: <br><img src="https://habrastorage.org/storage2/e21/986/214/e2198621460b801414815c1102ae7bff.png"><br><br><h2>  Conclusion </h2><br>  The introduction of dependencies in all classes of the system improves the quality of the architecture, but increases its complexity and development time.  Therefore, this approach is justified only in large projects.  When creating small projects like the site created in an article, you should give it up, however, as well as from using Symfony (in favor of lightweight frameworks). <br><br>  The working source can be downloaded / viewed here: <br>  <a href="https://github.com/cerritus/demoblog">github.com/cerritus/demoblog</a> </div><p>Source: <a href="https://habr.com/ru/post/165237/">https://habr.com/ru/post/165237/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165221/index.html">Creating an interactive prototype with Fireworks and TAP (touch application prototyping)</a></li>
<li><a href="../165223/index.html">How do transactions work in Redis</a></li>
<li><a href="../165227/index.html">PowerShell Web Access: Configuring</a></li>
<li><a href="../165231/index.html">Microsoft R & D office robbed, only iPad tablets stolen</a></li>
<li><a href="../165233/index.html">How to make a non-standard pop-up window when clicking on a label in iOS maps</a></li>
<li><a href="../165239/index.html">Simple-Science - Simple Experiments (Digest # 13)</a></li>
<li><a href="../165241/index.html">What inquiries got into QUERY CACHE</a></li>
<li><a href="../165243/index.html">Yet another python Chat client</a></li>
<li><a href="../165247/index.html">Android updates: why is Cyanogen so much faster than Google / OEMs?</a></li>
<li><a href="../165251/index.html">Programming on Android for a web developer or a quick start for the little ones. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>