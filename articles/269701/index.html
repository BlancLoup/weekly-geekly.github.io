<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring is handy on IxoraRMS. Quick and tasteful</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometimes the problem with the application translates into a small nightmare, rebus. Call it what you want. I want to share about the experience of us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring is handy on IxoraRMS. Quick and tasteful</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/e9f/e0b/5c2/e9fe0b5c202b4aba8adc356212e6633b.jpg" alt="image" align="left"><br>  Sometimes the problem with the application translates into a small nightmare, rebus.  Call it what you want.  I want to share about the experience of using monitoring tools by developers on one of the projects.  Habr has many faces and there are already dozens of articles about products that facilitate understanding of what is happening: cacti - <a href="http://habrahabr.ru/post/179391%3B">habrahabr.ru/post/179391;</a>  zabbix - <a href="http://habrahabr.ru/post/137641%3B">habrahabr.ru/post/137641;</a>  collectd - <a href="http://habrahabr.ru/post/93205%3B">habrahabr.ru/post/93205;</a>  JVM standard tools - <a href="http://habrahabr.ru/post/147008">habrahabr.ru/post/147008</a> (supplement). <br><br>  I will try to tell about one more small universal and lightweight product in this category - IxoraRMS. <br>  All interested, welcome under cat. <br><a name="habracut"></a><br><h1>  Prehistory </h1><br>  We have CentOS 6.5, JDK 1.7, JBoss AS 7.1, DBMS Linter and Hibernate / JPA application, Seam, RichFaces and strange behavior.  After about a week of work, the application's performance degrades significantly, the web interface is criticized by users and ‚Äúgiven‚Äù to developers (in one place). <br><br>  Debugging, profiling tools show a problem in one of the functions -autoFlushIfRequired.  Having studied a ton of articles about optimization and Hibernate problems, having tracked its code in the debugger, we decide to monitor the picture more widely. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      You can, of course, set up a system for collecting statistics and monitoring Cacti / Munin / Zabbix, etc., but if you do it well and correctly, then this is another task and within the organization it is not our responsibility.  Therefore, we take a simple one that will require a minimum of gestures on a local machine.  There are separate tools for Java profiling and monitoring, but I want to see the whole picture (OS, DBMS, application server, java and the application itself), since  the source of the problems is elusive.  Since we love Java, we choose IxoraRMS in terms of the tool (it's Java! Hurray!) (I‚Äôll make a reservation right away, I don‚Äôt have anything to do with the product or its authors).  Product open source, so that the field for improvements is open.  You can look at <a href="http://www.ixorarms.com/">www.ixorarms.com</a> , <a href="https://code.google.com/p/ixora-rms">code.google.com/p/ixora-rms</a> , <a href="https://github.com/danielm777/ixora-rms">github.com/danielm777/ixora-rms</a> . <br><br>  Highlights why from Munin, Cacti, collectd chose IxoraRMS: <br><ul><li>  Lightweight and usability (this is a simple desktop Java + Swing application, without a database, the need for in-depth knowledge of Linux administration and the build process from source code) </li><li>  To collect all the indicators there are agents and providers, many are ready to use.  In many cases, receiving data from the system / source can be simply described in the interface without lines of code. </li><li>  Examples of monitoring OS, DBMS, web server and JMX out of the box (not without a file in a specific configuration) </li><li>  A lot of graphs, ready-made control panels. </li><li>  If a disk, service, EJB component, or something else is added / removed, then the information on the graphs can change dynamically, without the need for reconfiguration. </li><li>  It runs the same under Linux / Windows (important, since most of the developers in the project work with us in the Windows environment). </li></ul><br><div class="spoiler">  <b class="spoiler_title">Examples of what can be seen on the screen after setting</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c80/2dd/ce9/c802ddce9a9fbb13f6041e3a36fe63b6.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8bd/4dc/125/8bd4dc1255e67c9efd70873254bc5796.png" alt="image"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/39a/efc/391/39aefc3918ac8fc767a0d1ce7939062e.png" alt="image"></div><br>  The remaining screenshots can be viewed <a href="http://www.ixorarms.com/screenshots">here.</a> <br></div></div><br><h1>  IxoraRMS in brief </h1><br>  This is a java application that can be run as a gui client, or as a console application.  In this case, an agent can be used to start and collect statistics on a remote machine (we did not want to put anything on the production server) or the collection can be carried out locally with a network connection to the remote machine (our case).  This option may also be useful when you come to the customer to diagnose the problem (yours or someone else's). <br>  What can IxoraRMS: <br><ul><li>  Group all the information on the control panels and screens. </li><li>  Draw graphs of various indicators. </li><li>  Display tables and lists with indicators, including non-numeric, there is filtering. </li><li>  Log to record and play, including the status of all control panels and graphs, tables, lists in time. </li><li>  It has many customized agents for OS, DBMS, web servers and application servers, java (JMX) for collecting indicators and customized control panels for them in one click. </li><li>  All other agents and providers are refined based on Process, SQL or Java templates via a graphical interface or by hand in XML.  If you wish, you can add the provider in Java </li><li>  Baseline indicators using built-in functions and javascript can be processed. </li><li>  It has a system for setting alerts when an event occurs (for example, the processor load is more than 80% for 3 minutes). </li><li>  It is possible to launch tasks (scripts) on a schedule or on monitoring events. </li></ul><br><br><h1>  Concept </h1><br>  For each server, at the start of monitoring, an entity tree with indicators is built (analogy of the JMX model), which contains hosts, agents, entities, and indicators (counter) by nodes.  All this is updated, by default, with an interval of 5 seconds.  The node scheme is not rigid, i.e.  nodes can be formed dynamically (for example, on each disk, process, processor, etc.) depending on the current configuration / situation on the server and monitoring settings. <br><br>  Agents are added to each host to determine the source of the information.  For each agent, providers are defined that provide small pieces of information in the form of indicators in the tree.  Providers can be described for each version of their software. <br><br>  There is an initial set of ready-made agents with providers. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/cd1/191/801/cd1191801b2544f39898bd17074df67e.png" alt="image"></div><br><br>  All the rest can be constructed using the interface or by editing XML files in the config folder.  Charts, tables, lists can be built by selecting indicators or defining a list of them with regular expressions.  Ready views and control panels can be formed for any level of the tree: global for the session / all hosts, for the current host, for the agent, etc.  down the entity hierarchy.  The agent and providers can optionally provide a different set of entities and indicators depending on the monitoring level of detail set (maximum, high, medium, low).  If necessary, you can write the code of the provider in Java. <br><br>  After adding an agent, each entity (node) in the tree can have two D (ashboard), V (iew) icons next to it, which means that there are ready-made settings for viewing indicators.  This can and should be used to minimize effort.  Here is an example when you added an agent for Linux. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/023/d2c/804/023d2c804bbb4c89b7495cfee92b7de2.png" alt="image"></div><br><br>  Dark blue arrows show that the nodes have currently updated indicators for monitoring (it is convenient to use when debugging new providers and presentations). <br><br>  And immediately ready panel with indicators (picture after a few minutes of work and changing the names of the panel and windows with views): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/447/b02/ece/447b02ececb24a2b8f79f789a7de2e80.png" alt="image"></div><br><br><h1>  Now short and in steps </h1><br><h2>  Step 1. Download and run the IxoraRMS GUI </h2><br>  In the folder with the installed distribution run: <br><br><pre><code class="bash hljs">console.bat</code> </pre> <br>  Note: It is possible to start and stop the local agent (host manager, hmStart and hmStop, respectively) and start in batch mode (batchStart, batchStop). <br><br>  We create a session and add our host (on it CentOS 6.5) to the list of servers for monitoring. <br><br>  For our host, select Add Agents from the context menu.  We can see which agents are already present in the repository.  For our tasks, we need agents for CentOS (Linux), Linter, Java (HotSpot or JMX), JBoss 7.1 (JBoss or JMX).  Due to the lack of development since 2011, agents for software products are either outdated or initially lacked support.  Therefore, the next steps are devoted to customizing the application to our requirements. <br><br>  In order for the interface to make corrections to the built-in agents and providers, we restart the console with the <i>-Dapplication.dev = true</i> parameter <i>specified</i> when running for java.  We rule and run the console.launch.bat file for this (it is regenerated when console.bat is launched, be careful!). <br><br><h2>  Step 2. Monitor the OS </h2><br>  For CentOS 6.x, a suitable agent exists (Linux), but the supported versions are only RedHat 9 and RedHat AS 3. If you select RedHat 9 and then start monitoring, not all graphs come to life, errors appear in the IxoraRMS log.  Providers for the Linux agent are working using the iostat, mpstat, and vmstat utilities, so we install the sysstat and procps packages from the repository to the host. <br><br><pre> <code class="bash hljs">yum install sysstat procps</code> </pre><br>  For example, one provider try to figure out how they are configured.  For this: <br>  ‚Ä¢ open the menu Tools / Agents Installer <br>  ‚Ä¢ find Linux and click Edit <br>  ‚Ä¢ add ‚ÄúCentOS 6.x‚Äù to the System versions list <br><div style="text-align:center;"><img src="https://habrastorage.org/files/b90/ab2/38d/b90ab238d178400abf26e9f8de889cc2.png" alt="image"></div><br>  When displaying the control panel for RedHat 9 errors appear in the log related to the File system data and Disk data providers.  To correct, we proceed as follows: <br>  ‚Ä¢ open the Tools / Provider manager menu; <br>  ‚Ä¢ we select agent Linux, provider Disks data (RedaHat 9, RedHat AS 3) <br>  ‚Ä¢ create on its basis a copy using Create Like, specifying the same name and a different version; <br><div style="text-align:center;"><img src="https://habrastorage.org/files/545/650/329/5456503293514af3bf09918b23ce59b8.png" alt="image"></div><br>  ‚Ä¢ in our case, Process is used as the provider, which redirects the standard output stream from the specified command to the parser.  The stream is obtained from running the command locally or via telnet / ssh with the transfer of the command to them; <br>  ‚Ä¢ you can run this iostat ‚Äìd ‚Äìx 5 command on the host console with CentOS to see the output format ({tick} is a standard parameter with the current monitoring interval) <br><div style="text-align:center;"><img src="https://habrastorage.org/files/7cf/096/21a/7cf09621a2854e97975a46459257f69e.png" alt="image"></div><br>  ‚Ä¢ Now let's compare the output to the screen and parser settings; <br>  ‚Ä¢ switch to the Parser tab; <br><br>  Here are the rules by which nodes (entities) and indicators are formed in the tree.  Each source data column can form an entity by specifying the path of the entity relative to the agent and the indicator value based on the column number.  In short, a data model for monitoring is formed here. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7ed/761/1d9/7ed7611d9ddb4fe4bea9350144a79ce4.png" alt="image"></div><br>  ‚Ä¢ the columns in the iostat output referring to the 7th and 8th columns of the ‚ÄúKilobytes read per second‚Äù and ‚ÄúKilobytes written per second‚Äù output are not available on CentOS with the same command line, so we delete them; <br>  ‚Ä¢ The Descriptors tab contains types of indicators and their description for the legend.  In our case, the rows for the deleted indicators will simply disappear; <br>  ‚Ä¢ save the provider. <br><br>  Thus, comparing the output of the utilities used with the specified parameters, we present the providers for CentOS in order.  The same work can be done by hand, correcting the files: <br>  ‚Ä¢ config / agents / agents.linux / agent - general description of the agent; <br>  ‚Ä¢ config / repository / agents.linux / agent.db ‚Äî agent-level control panels; <br>  ‚Ä¢ config / repository / agents.linux / agent.pi ‚Äî customized provider instances; <br>  ‚Ä¢ config / repository / agents.linux / entity.db - control panels for entities; <br>  ‚Ä¢ config / repository / agents.linux / entity.dv - customized views for entities <br><br>  These providers use a telnet / SSH connection to the host, through which the utility is remotely launched, and all the output is converted into parities and indicators after parsing.  Therefore, when adding an agent, you have to specify a login and password to connect.  The password is stored in the session description on disk in encrypted form. <br><br>  The agent as a whole has a lot of collected indicators from different utilities and when running on the host, in our case, there are 5-6 open ssh sessions (if we try using HostManager, I will write later, the developers do not recommend this option so that the agent does not introduce large distortions by preprocessing into the observed system).  Total resource consumption &lt;1%. <br><br>  After adjusting the agent and providers, remove the Linux agent from the host from the entity tree and add it again with a choice of CentOS 6.x version.  We start monitoring and immediately turn on the ready control panel System overview (available in the agent tree).  Now we see everything that was interesting to us in the OS. <br><br>  The final Linux agent file with the version for CentOS 6.x for import can be taken <a href="https://github.com/vmmelnikov/ixora-agents/raw/master/agents/agents.linux.agent">here</a> (Ixora RMS has import / export). <br><br>  So the OS is monitored, then the DBMS. <br><br><h2>  Step 3. Analyzing the work of the DBMS </h2><br>  There is no ready agent for <a href="http://linter.ru/">DBMS Linter</a> .  Therefore, in this case, the path is slightly longer. <br><br>  We will monitor the work of the DBMS on the basis of the following available information: <br>  ‚Ä¢ SYSTEM. $$$ CHAN system view with channel list; <br>  ‚Ä¢ SYSTEM.SYSINFO system view with aggregated I / O information from the moment it was started. <br><br>  To connect to the database, we use the JDBC driver from the LINTER distribution kit - jdbc / linjdbc-1.4.jar.  It is better to copy it to the &lt;Ixora&gt; / lib folder. <br><br>  Based on these tables, the following information is available to us: <br>  ‚Ä¢ the number of open channels (Connection + Statements); <br>  ‚Ä¢ the maximum possible number of open channels; <br>  ‚Ä¢ the number of blocked channels; <br>  ‚Ä¢ the number of active (open) transactions by channels (kernel 6.0.16.x and higher); <br>  ‚Ä¢ lifetime of the ‚Äúoldest‚Äù active transaction (s) (kernel 6.0.16.x and higher); <br>  ‚Ä¢ total number of completed transactions; <br>  ‚Ä¢ the total number of logical entries (in the cache); <br>  ‚Ä¢ the total number of pages of logical read (from the cache); <br>  ‚Ä¢ total number of physical write operations (per disk); <br>  ‚Ä¢ total number of physical reads (from disk); <br>  ‚Ä¢ total number of SELECT operations. <br><br>  It is proposed to split these indicators into 3 providers with the following data model <br>  Connection data: Connection / [Opened, Locked, MaxAvailable] <br>  Transaction data: Transaction / [Total, Active, MaxAge] <br>  Input / Output: Statistics / [Block reads, Block reads, Block reads, Block writes, Selects] <br><br>  Now create a new agent as follows: <br>  ‚Ä¢ open the Tools / Agents Installer menu and press the Install button in the dialog; <br>  ‚Ä¢ Next, select the Custom agent installation; <br>  ‚Ä¢ as the Agent Template, select SQL; <br>  ‚Ä¢ Fill in the properties of the Linter agent as follows: <br><div style="text-align:center;"><img src="https://habrastorage.org/files/101/19c/38e/10119c38e4944edeb379f982bd003e5e.png" alt="image"></div><br>  ‚Ä¢ now open the Tools / Provider Manager menu; <br>  ‚Ä¢ select the Linter agent and click Add to create the Connection Data provider; <br>  ‚Ä¢ select the type of SQL provider and fill in the appropriate fields <br><div style="text-align:center;"><img src="https://habrastorage.org/files/a69/a14/629/a69a146292de449eb354b6e042234a1d.png"></div><br>  ‚Ä¢ as the field values, you can specify special variables {host}, {agent.Username}, etc., which are defined in the session or the properties of the agent when it is added to the host; <br>  ‚Ä¢ to obtain the required indicators we use a SQL query of the form: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Opened <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$CHAN <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATUS</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">''</span></span>) a, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Locked</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$CHAN <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATUS</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> LOCKED_BY&lt;&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) b, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*)<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MaxAvail <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$CHAN) c</code> </pre><br>  ‚Ä¢ on the Parser tab, we describe the formed entities and indicators based on the values ‚Äã‚Äãof the columns in the sample; <br><div style="text-align:center;"><img src="https://habrastorage.org/files/f79/524/c4e/f79524c4e09c468e8904e9de99d32dc2.png"></div><br>  ‚Ä¢ on the Descriptors tab, we describe the types of indicators and their description <br><div style="text-align:center;"><img src="https://habrastorage.org/files/41b/46b/5ff/41b46b5ff6304c48b5e709611d06e3b0.png"></div><br>  Similarly, we add 2 more providers based on the following SQL queries: <br>  one. <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> TRANSACTIONS_COUNT <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Total <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$sysinfo) a, (<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>(*) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Active, NVL(DIVTIME(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(TRANSACTION_START), <span class="hljs-keyword"><span class="hljs-keyword">SYSDATE</span></span>),<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MaxAge <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$chan <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">STATUS</span></span>&lt;&gt;<span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> PARENT_CHANNEL!=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> TRANSACTION_START &gt; <span class="hljs-string"><span class="hljs-string">'01.01.1900'</span></span>) b</code> </pre><br>  2 <pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> READ_BLOCKS, READ_LOGICAL_BLOCKS, WRITE_BLOCKS, WRITE_LOGICAL_BLOCKS,SELECT_COUNT <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> $$$sysinfo</code> </pre><br>  Now you can add an agent to the host by filling in the database connection parameters under the user SYSTEM. <br>  To display indicators, we build a control panel from these providers using the context menu Add / Use Wizards in the Views section. <br><br>  For large indicators, we use a small trick: instead of absolute values, we show the indicator increment over the monitoring interval, thereby observing the intensity of the load.  To do this, we add a description of the function in XML with a description of the view (view) by clicking the Edit button on the finished view. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/af2/f99/57f/af2f9957fea444a3a0f0bdd45879aa9b.png"></div><br>  IxoraRMS has built-in functions for aggregation and JavaScript integration for arbitrary manipulations (see <a href="http://www.ixorarms.com/documentation/user-guide/functions">www.ixorarms.com/documentation/user-guide/functions for details</a> ). <br><br>  You can also set alarm events for the view.  For example, for a channel pool in a DBMS, if you use it more than 90%, you can notify the administrator within 10 seconds. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/258/e94/307/258e9430711d44cfa7cc99b29c669290.png"></div><br>  Settings for the distribution server are configured in the General Configuration / Setting menu. <br><br>  After simple manipulations with constructions of representations through the master we receive the following control panel for a DBMS. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c15/0c2/bcf/c150c2bcfe2b416289292dbd1ec4ef53.png"></div><br>  To simplify the configuration of the control panel, its description is given in the description of the agent by editing the XML files in the repository folder.  Now, to view the control panel for any host, it is enough to connect an agent and activate a ready-made panel. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/62c/d2a/26c/62cd2a26c1dc4a9c89453fc9b9a20e26.png"></div><br>  The final agent for DBMS Linter can be found <a href="https://github.com/vmmelnikov/ixora-agents/raw/master/agents/Linter.agent">here</a> . <br><br><h2>  Step 4. JVM </h2><br>  According to JVM, I wanted to see: distribution of memory pools of Survivor / Eden / Old / PermGen, costs for garbage collection, threads.  To monitor the JVM from Oracle / Sun, there is a ready-made HotSpotJVM agent that uses the JMX connection.  To connect to a virtual machine running JBoss AS, you can use the remoting-jmx protocol, which is open by default on port 9999 and supports the authorization of users included in the ManagementRealm. <br><br>  To enable the HotSpot JVM agent to use this protocol, put the jboss-client.jar file from the JBoss As 7.1 distribution kit into the / jars folder and replace the version of the log4j.jar file with version 1.2.12 and higher (for example, the JBoss AS 7.1 distribution package includes log4j -1.2.16.jar).  The agent description in the config \ agents \ agents.hotspotjvm \ agent file is adjusted, we add jboss-client.jar to the description. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">agent</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶. <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jars</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span>/jars/AgentHotspotJVM.jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span>/jars/RMSJMX.jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span>/lib/javax77.jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span>/jars/jboss-client.jar<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jar</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">jars</span></span></span><span class="hljs-tag">&gt;</span></span> ‚Ä¶. <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">agent</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  After changing the description of the agent, we are overloading IxoraRMS. <br><br>  To add a user to the ManagementRealm, use the script &lt;JBOSS_HOME&gt; / bin / add-user.  Run it and follow the prompts. <br><br>  Now you can add an agent to the host by specifying the appropriate parameters: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/b07/684/31b/b0768431be5348e09aa4661f1e65f4ac.png"></div><br>  After adding an agent for him immediately available to the control panel.  If we use it, we get the following picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/187/0ce/223/1870ce223be24c08a8f21478dca41b8b.png"></div><br>  Only the JVM Throughput view showing the performance as a percentage of total time consumed minus time for garbage collection is not functional.  Since  In the calculations, the parameters of specific garbage collectors are used, then the presentation needs to be adjusted for each JVM launch option.  We did not correct this view. <br><br>  An agent with our configuration fixes can be downloaded <a href="https://github.com/vmmelnikov/ixora-agents/raw/master/agents/agents.hotspotjvm.agent">here</a> . <br><br><h2>  Step 5. Now the application server queue </h2><br>  What I want to know: <br>  ‚Ä¢ Number of open web sessions, errors and information transfer load (received / transmitted bytes). <br>  ‚Ä¢ Number of transactions (total and completed with rollback). <br>  ‚Ä¢ JMS message queues (current queue size). <br>  ‚Ä¢ Hibernate (Infinispan) second level cache statistics (by region: cache size, hit percentage, read / write ratio). <br>  ‚Ä¢ EJB / MDB pool of components (by component: how many are created / free / used) <br>  ‚Ä¢ Statistics on web services (by entry points: the number of requests is total and with errors). <br><br>  Ready Agent for JBoss AS only supports server versions 4.0.  and 4.2 through JNDI with access via jnp protocol.  Therefore, to monitor JBoss AS 7.1, you need to use the standard JMX JSR160 agent (see the example and setting above for the HotSpot JVM agent, including adjusting the agent description to work through remoting-jmx). <br><br>  Note: The latest Ixora RMS source code already contains JBoss AS 5.x support based on JMX JSR 160, but the compiled version is not yet available. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a15/751/aac/a15751aacdae47fe8dda5947239e0016.png"></div><br>  Specifying values ‚Äã‚Äãin the Root folder and classpath fields is not enough, because  the SPI mechanism is used to search for the protocol, and the jar files from the Classpath field for the agent are loaded by a separate classloader. <br><br>  After successful connection of the agent to the host, a hierarchy of JMX entities (nodes) is immediately displayed in the tree. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/3a6/cdb/5f2/3a6cdb5f2f8a4291a13d95e14d6c54fa.png"></div><br>  For an example of building graphs and lists we need, consider how to organize monitoring of information on the second-level cache. <br><br>  Information about the regions of Infinispan is presented in JMX with the following entities and indicators: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/623/d18/a1e/623d18a1ee9840039ec23c0f3edf9e26.png"></div><br>  To display the number and percentage of hits in the cache in the form of a table with columns, you can use the XML editor from the context menu on the Views tab.  Before this, it is better to activate the jboss.infinispan node in the tree in order to save the constructed view to this node.  After editing, we get the following XML: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rms</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.ixora.rms.ui.dataviewboard.tables.definitions.TableDef"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>Cache regions statistics<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Infinispan cache regions hits statistics<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"region"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-/-/root/jboss.infinispan/(jboss.infinispan:type=Cache,name="</span></span></span><span class="hljs-tag">(</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span><span class="hljs-tag">*)",</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">.</span></span></span><span class="hljs-tag">*,</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">component</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">Statistics)</span></span></span><span class="hljs-tag">"/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hits"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1/$counter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1/$counter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-/-/root/jboss.infinispan/(jboss.infinispan:type=Cache,name=(.*),.*,component=Statistics)/[hits]"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">resource</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hitRatio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">iname</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1/$counter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$1/$counter"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rid</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"-/-/root/jboss.infinispan/(jboss.infinispan:type=Cache,name=(.*),.*,component=Statistics)/[hitRatio]"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">query</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">agentVersions</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span>customer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">author</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">category</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"region"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hits"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">column</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hitRatio"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">view</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rms</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  A few comments on it: resource - this is the source of data (indicators from the tree) for display.  They are specified using the absolute path in the tree or relative.  The path may include regular expressions that define multiple sources.  For each source, you can define the attributes iname, name, which define the unique identifier of the resource and its displayed name.  For a detailed description, see the website at <a href="http://www.ixorarms.com/documentation/user-guide/concepts">http://www.ixorarms.com/documentation/user-guide/concepts.</a> <br><br>  For display, various display options can be used: graphs, tables with multiple columns, lists of properties, and viewing logs.  In our case, the simplest table is used. <br><br>  We define the elements we need in the tree of indicators for the JBoss AS server and, to simplify access to them, we then form all representations at the entity level jboss.as, jboss.infinispan, jboss.ws, respectively.  To monitor various services, we use the following entities and their indicators in the IxoraRMS notation: <br><table><tbody><tr><td>  Web server </td><td>  <b>- / - / root / jboss.as / jboss.as: subsystem = web, connector = http. *</b> , metrics: bytesSent, bytesReceived, requestCount, errorCount </td></tr><tr><td>  Cache </td><td>  <b>- / - / root / jboss.infinispan / (jboss.infinispan: type = Cache, name = (. *)</b> ,. <b>*, component = Statistics)</b> , indicators: hits, hitRatio, readWriteRatio, numberOfEntries, evictions </td></tr><tr><td>  Web services </td><td>  <b>- / - / root / jboss.ws / jboss.ws: context =. *, endpoint = \ w + $</b> , indicators: RequestCount, FaultCount </td></tr><tr><td>  EJB components </td><td>  <b>- / - / root / jboss.as / jboss.as: deployment =. *, subsystem = ejb3, stateless-session-bean =. *</b> , <br>  <b>- / - / root / jboss.as / jboss.as: deployment =. *, subsystem = ejb3, message-drive-bean-bean =. *</b> , performance: poolAvailableCount, poolCurrentSize, poolCreateCount </td></tr><tr><td>  Message Queues </td><td>  <b>- / - / root / jboss.as / jboss.as: subsystem = messaging, hournetq-server = default, jms-queue =. *</b> , <br>  <b>- / - / root / jboss.as / jboss.as: subsystem = messaging, hournetq-server = default, jms-topic =. *</b> , indicators: messageCount </td></tr><tr><td>  Transactions </td><td>  <b>- / - / root / jboss.as / jboss.as: subsystem = transactions</b> , performance: numberOfTransactions, numberOfInflightTransactions, <br>  , numberOfCommitedTransactions, numberOfAbortedTransactions, numberOfApplicationRollbacks </td></tr></tbody></table><br>  Regular expressions allow you to specify whole samples of entities instead of specific ones here. <br><br>  As a result, the settings for JBoss AS will get a control panel with graphs and tables below (after pressing the Start button). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a45/fe8/141/a45fe81415364670a01504004308554e.png"></div><br>  All views are combined into a single control panel and saved at the level of the JMX JSR 160 agent under the name ‚ÄúJBoss AS 7.x Overview‚Äù.  This is done by the wizard on the Dashboards tab for the entity selected in the tree.  All settings for views and control panels are automatically saved in agent settings.  A JMX JSR 160 agent with settings for JBoss AS can be downloaded for import <a href="https://github.com/vmmelnikov/ixora-agents/raw/master/agents/agents.jmxjsr160.agent">here</a> . <br><br>  All control panels can be placed on different screens (screen) in IxoraRMS and switch between them to monitor various system indicators. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/428/01a/706/42801a706fe943f4948392139cf0d67e.png"></div><br><h1>  Total for our experiments </h1><br>  Pros: <br><ul><li>  got the settings of the providers for our configuration; </li><li>  if necessary, we quickly complete graphs and tables in the monitoring process without restarting; </li><li>  we see in a complex everything that happens with our server; </li><li>  to monitor the test server now work for a minute connecting the right agent. </li></ul><br>  And a few drawbacks: <br><ul><li>  The project is not supported since 2011 and it is necessary to update the agents and providers, if necessary; </li><li>  In case of several unsuccessful interrupts of the monitoring application, the JMX interface on the JBoss side does not respond at all (this is most likely a JBoss problem, but the production server will have to be restarted if further monitoring is needed); </li><li>  The log player on the monitoring interval of 2-3 days and more inconvenient, responds slowly in the interface, slows down.  True and the size of logs in XML format is about 2-4 GB, the initial viewing phase contains settings for the level of aggregation of indicators by minutes, hours, but games with settings have not increased usability.  Note: the ability to write a log to the database was later discovered in the last source code, but did not have time to try. </li><li>  For continuous monitoring of the system is not suitable, you can connect occasionally and monitor performance on servers for up to 1-2 days in continuous mode. </li></ul><br>  At this, the monitoring of our application did not end and we attempted to monitor the logic of the application itself according to the following list without major intervention in the application: <br><ul><li>  a list of the most costly in terms of total time for the execution of service methods; </li><li>  a list of the most costly in terms of average time for the execution of service methods; </li><li>  a list of the most frequently called service methods; </li><li>  a list of the most expensive in terms of total SQL query execution; </li><li>  a list of the most expensive in terms of average SQL query execution; </li><li>  list of the most frequently called SQL queries; </li><li>  errors in the log </li></ul><br>  But about it in the following part.  Successes in debugging! <br><br>  PS A complete understanding of the original problem never came.  Indicator Context switches per second for the OS clearly goes into the range of 8000-10000 in a week.  At the same time, the number of threads grows insignificantly.  Synchronization?  Hibernate's AutoFlushIfRequired takes a very long time: from fractions of a second to 30-70 seconds in total after degradation on some service calls.  The first level cache is the same in size for this service request (about 8000 entities), but the execution time increases.  Synchronization inside the HIbernate and Infinispan bundles?  By hook or by crook, the time of degradation of the system has increased and is already close to the 2nd week, but I want more. </div><p>Source: <a href="https://habr.com/ru/post/269701/">https://habr.com/ru/post/269701/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269691/index.html">Telecommunications giant TalkTalk suffered from cyber attack</a></li>
<li><a href="../269693/index.html">Parallel processing of a large select in several sessions</a></li>
<li><a href="../269695/index.html">From Java to Scala: 7 reasons to learn a new language</a></li>
<li><a href="../269697/index.html">Cold perfection: news on the data center cooling systems market</a></li>
<li><a href="../269699/index.html">Compare me completely. Reflection in the service of .NET developer</a></li>
<li><a href="../269705/index.html">Sharing checkstyle and gerrit</a></li>
<li><a href="../269707/index.html">Duke, take out the trash! - Part 2</a></li>
<li><a href="../269709/index.html">Validation of complex structures with PHPixie Validate</a></li>
<li><a href="../269711/index.html">Another build Vivaldi 1.0.303.37 - Beta Candidate</a></li>
<li><a href="../269717/index.html">Maybe monad on steroids</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>