<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Object in a case or Optional in Java 8 and Java 9: ‚Äã‚ÄãPart 5: Untold and a poster as a gift</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the fifth and final article in the series on the use of the Optional class when processing objects with dynamic structure. The first article w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Object in a case or Optional in Java 8 and Java 9: ‚Äã‚ÄãPart 5: Untold and a poster as a gift</h1><div class="post__text post__text-html js-mediator-article"> <a href="https://habrahabr.ru/post/350904/"><img src="https://habrastorage.org/webt/ys/0h/kg/ys0hkgszo0x804sxkfr0q6svqcm.jpeg" alt="Object in the case"></a> <br><br>  This is the fifth and final article in the series on the use of the Optional class when processing objects with dynamic structure.  The <a href="https://habrahabr.ru/post/347480/">first article</a> was about ways to avoid NullPointerException in situations where you can‚Äôt or don‚Äôt want to use Optional.  <a href="https://habrahabr.ru/post/347576/">The second article</a> describes the methods of the Optional class as it appeared in Java 8. <a href="https://habrahabr.ru/post/347748/">The third</a> describes the methods added to the class in Java 9. In the <a href="https://habrahabr.ru/post/347836/">fourth article,</a> I introduced a class that extends the capabilities of the Optional class when it fails in data processing in the method we need to handle information about this failure. <br><br>  In this article we will look at the question of whether it is worth using Optional in all those places where zero values ‚Äã‚Äãmay appear.  I will also cite the opinion of Brian Goetz, the architect of the Java v Oracle language about this class, and of course, I will fulfill the promise made in the last article - I will encourage every reader who has read all the articles in the series with a valuable gift. <br><a name="habracut"></a><br><h3>  But it could not be so </h3><br>  Before we proceed to the consideration of practical, practical issues of using Optional in different roles within our classes, I would like to make one small, but from my point of view, necessary, historical digression. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      When the problem of extending Java with the elements of the OP (Functional Programming) is overdue, the range of possible solutions seemed very wide.  In the maximal version, one could try to extend Java with the implementation of the most important paradigms of OP tested by that time in such programming languages ‚Äã‚Äãas LISP, ML, Haskell, OCaml, F #, Erlang, Clojure and Scala. <br>  Critics of the maximalist approach warned that the implementation of certain paradigms of the OP may hamper the architectural decisions previously adopted in the implementation of the language.  In addition, they feared that the introduction of some paradigms too difficult to master would lead to their poor use.  And this, in turn, threatened that the whole complex of innovations would be ignored by the majority of Java users. <br><br>  One way or another, in the end, the approach proclaimed as ‚Äúpragmatic‚Äù won.  In Java 8, only the main elements of the OP appeared in the form of threads, functions, lambda and Optional. <br><br>  Within the framework of the winning approach, the Optional in the official documentation did not claim to be one of the implementation of the paradigm of the monad from the OP.  (Not claiming a role does not mean not playing it, see details <a href="https://www.slideshare.net/mobile/mariofusco/monadic-java">here.</a> Instead, the Optional class was positioned in the <a href="http://www.oracle.com/technetwork/articles/java/java8-optional-2175753.html">official ‚Äúexplanatory‚Äù article</a> as a container for potentially zero objects. <br><br><h3>  And where else to apply it? </h3><br>  And if so, then some users have asked themselves a natural question: It turns out that everywhere where null might appear in a class, should we now use Optional? <br><br>  The aforementioned Oracle article clarifies ‚ÄúNo!‚Äù <br><br>  Namely (in my translation): <br><blockquote>  ‚ÄúThe purpose of the Optional class is not to replace every reference to a potentially null object.  The goal is to be able to develop <b>more understandable APIs</b> so that, simply by the signature of the method, determine what Optional is returned.  This forces you to actively parse Optional to understand its value. " </blockquote>  So be it.  But where, in what "places" or "roles" in the class, could one use Optional? <br><br><h4>  Optional as field value? </h4><br>  Let's see specifically and start with the class variable (field).  Let's see the mentioned article.  There is such a code: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Computer</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Optional&lt;Soundcard&gt; soundcard; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Optional&lt;Soundcard&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSoundcard</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ... } ... }</code> </pre> <br>  Aha  So you can use Optional as a class variable? <br><br>  You can, but here's what you need to remember: <br><br><ol><li>  The Optional class does not implement the Serializeble interface.  This means that the variable will not be correctly saved or read from the media using the frameworks used by this property. </li><li>  Optional is a so-called value-based object.  This implies, in particular, special rules for comparing instances of objects among themselves, which can be read in detail <a href="https://docs.oracle.com/javase/8/docs/api/java/lang/doc-files/ValueBased.html">here</a> .  This in turn means that some frameworks that use the Reflection mechanisms inside may incorrectly process such fields. </li></ol><br>  Thus, before using Optional as the custodian of the field value in your class, make sure that potential users of your class will not have to serialize it or process it with non-ready frameworks. <br><br>  Therefore, some authors advise not to get involved in these potential headaches and store the objects themselves in the fields instead of Optional, remembering when programming a class that they may be null.  And only ‚Äúreleasing‚Äù the object outwards as a return value place it in the Optional case. <br><br><h4>  Using Optional in setters </h4><br>  Well, what about the methods for setting potentially null class fields?  When should you suggest a method in your API with a signature of type setSomeObject (Optional &lt;SomeObject&gt; opt) and when not? <br>  An obvious case is when you build a facade around an existing class that has a setSomeObject method (SomeObject obj) and obj may be null.  In this case, at least in the covering ‚Äúfacade‚Äù method, you are explicitly notified to the user about the possibility of using a null object. <br><br>  In the remaining cases, it is almost always better to create a normal setter-method with a restriction (and possibly a check) that the passed parameter is not null.  At the design stage, this limitation can be checked using assert.  Whether to check it in production and, if so, how - this is a separate interesting question that goes beyond our discussion. <br><br>  Thus, after many authors, I urge you not to assume and not to allow null transmission in setters. <br><br>  As so, attentive reader exclaim.  In the second article of the series, the author himself suggested using this interface: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInput2</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nullable CupOfWater water, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span></span>; }</code> </pre> <br>  with the water parameter, which can be null, and now it says that it is bad?  Yes.  Exactly.  In order to focus your attention on the main aspect, I allowed myself this in the educational example.  But when developing real APIs that other developers can use, this should be avoided.  But how? <br><br>  Let's take a closer look at the situation.  Passing null as a parameter value means, as a rule, changing the configuration of an object, disabling part of its capabilities, or switching its behavior to a new mode.  Match the appropriate term describing such a <b>switch</b> . <br><br>  The interface mentioned above would change something like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IBoilerInputX</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWater</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Nonnull CupOfWater water)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setWaterDisabled</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setPowerAvailable</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">boolean</span></span></span></span><span class="hljs-function"><span class="hljs-params"> powerAvailable)</span></span></span></span>; }</code> </pre> <br>  The new setWaterDisabled method clearly indicates the impending change in the behavior of the device, in contrast to the previous version in IBoilerInput2, where this was achieved by calling a parameter with a zero value. <br><br><h4>  Using Optional in a parameter group </h4><br>  In some cases, however, for some conceptual or technical reasons, some group of parameters cannot be broken up into separate pairs of setters and switches, and you just need to pass the entire group of parameters in one call.  Very often this happens with class constructors.  However, some parameters of the group may be missing, unprepared, etc.  - i.e.  be null.  In this case, using the Optional case is much better than transferring potentially null parameters directly.  The likelihood that some parameter mistakenly set in previous calculations will fall inside your class and then cause NPE or incorrect behavior, in this case, is significantly reduced. <br><br><h4>  Final recommendations </h4><br>  Let's summarize the preliminary results in the form of pragmatic recommendations: <br><br><ol><li>  Use Optional in setter or in methods with a single parameter (only) if you build a facade for a method that explicitly implies a parameter that can be null. </li><li>  In most cases, if a parameter can take a zero value, pass it through a setter with a non-zero value restriction and an accompanying method of switching the mode of operation of the object.  Inside the switch, zoom in the value of the corresponding field. </li><li>  If your method should have many parameters, some of which can take zero values, pass such parameters inside the Optional case.  This will force the client calling your method to clearly deal with the situation before ‚Äúinserting‚Äù the object into the case. </li></ol><br><h3>  "Defective" return values </h3><br>  In the first and second articles of this series, I have long convinced readers that potentially zero return values ‚Äã‚Äãmust be packaged in a case before the release - Optional.  Is it always good?  Unfortunately, where the light is, there is a shadow. <br><br>  Complex objects, especially in enterprise systems, are often aggregations or hierarchies of simpler objects that are accessible from the outside by calling getter methods.  The fact that an object returns an ‚Äúempty‚Äù object (whether it is packaged in a case or not) often does not mean that there is no such object inside an aggregate or hierarchy.  In real systems, this often means that the object is in some sense ‚Äúinferior‚Äù or the configuration of the aggregate-object containing it does not allow its use in the external world.  From this point of view, the return of Optional.empty () is justified.  However, if we want to use the external framework (without using Reflection or manipulating the baicode), save the object on external media or transmit over the network, the ‚Äúinferiority‚Äù of the object or the inappropriate configuration of the aggregate containing it should not interfere with us.  It turns out that getter does not allow us to use the optional return case in this case.  How so?  What did you fight for? <br><br>  In fact, everything just got better.  Yes, we will have to implement special methods for the persistence of parts of a large aggregate.  But at the same time, it is better to assemble them into one separate interface, and methods of implementing business logic into another.  Thus, we will be able to separate the business aspect and the technical aspect of using the same object. <br><br><h3>  Optional instead of "magic" numbers </h3><br>  Analogous to null from the world of objects in the world of numbers are the "magic" numbers.  Those.  such parameter values ‚Äã‚Äãthat are associated with a radically different semantics than with "normal" numbers. <br><br>  Even standard Java libraries do this.  Documentation for the java.net.Socket class constructor: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Socket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, InetAddress localAddr, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> localPort)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException</span></span></code> </pre> <br>  tells us about the localPort parameter, that if it is set to non-zero, the system will use it.  And if the value of the parameter is 0, it will look for a free port for you. <br><br>  We have a radically different behavior of the method with a non-zero and zero value of the parameter. <br><br>  To avoid such situations in the future, the classes OptionalInt and OptionalDouble were introduced in Java 8.  Use these classes if your method should return a certain number if successful, but non-success is also possible. <br><br><h3>  And instead of the conclusion - think for yourself! </h3><br>  I dedicated five articles to describing the use cases for the Optional class methods.  I think in Java there are not so many classes that cause so many questions and disputes. <br><br>  And by the way, dear readers, how do you think, how many lines of code (apart from comments and with them) does this class contain? <br><br><div class="spoiler">  <b class="spoiler_title">The answer to the question.</b>  <b class="spoiler_title">You will surely be surprised</b> <div class="spoiler_text">  The Optional class contains only 100 lines of code, not counting comments.  Comments take up 250 lines. </div></div><br>  Some of the articles in this series have generated very sharp and interesting discussions.  But this is not even a drop in the sea, but a drop molecule compared to discussions and questions that appeared in the English language sector of the Boarding School after the appearance of the Optional in Java 8. One of the hottest and most interesting discussions about the Optional was this: <a href="https://stackoverflow.com/questions/26327957/should-java-8-getters-return-optional-type">Should Java 8 getters return optional type ?</a> <br><br>  Brian Goetz, taking the position of Java Language Architect in Oracle, took part in the discussion.  Seeing how Java programmers use his brainchild, this is what he wrote in the forum (my translation): <br><blockquote>  Of course, people will do what they want.  But we had a clear intention when adding this functionality, and we did not set a goal to create a mechanism like Maybe or Some in other languages.  Although many of this is possible and wanted.  Our goal was to provide a compact mechanism for determining the types of return values ‚Äã‚Äãwith a clear selection of the ‚Äúno result‚Äù situation as an alternative to using the zero value, which in most cases can cause errors. <br><br>  For example, you probably should never use it for something that returns an array of results or a list of results;  instead, return an empty array or list.  You will almost never use it as a field for anything or a method parameter. <br><br>  I think that its regular use as a return value for getters will definitely be excessive. <br><br>  In Optional, there is nothing bad about which to avoid it.  This is simply not what many would like to see in its place.  And so we were very concerned about the risk of overuse. <br><br>  Handling: NEVER call Optional.get if you cannot prove that it (in this context) is always non-zero.  Instead, use one of the safe methods, such as orElse or ifPresent.  In retrospect, we can say that instead of get, we would have to provide something like getOrElseThrowNoSuchElementException, which would make its use more clear.  But this is Lesson learned. </blockquote>  In other words, the creators of the language do not always expand it as I would like some (advanced) users.  Users do not always use new language features as conceived by their creators.  And the creators sometimes regret the mistakes made, which are no longer corrected. <br><br>  So, dear readers, think for yourself, decide for yourself how to use Optional in your projects.  And it remains for me to hope that this series of articles and the promised gift, the poster about the Optional, will help you with this. <br><br><div class="spoiler">  <b class="spoiler_title">Poster about Optional</b> <div class="spoiler_text">  I advise you to print <a href="https://www.sirotin.eu/DOWNLOAD/OptionalInJavaPoster.pdf">‚ÄúOptional Poster Poster‚Äù</a> and hang it on the wall, if you have one near your desk.  If not, just download and sometimes look into it. <br><br>  Pay attention to the names of the groups of class methods on the left.  They will help you quickly find the desired method. <br><br>  The nine in the circle indicates that the method is available starting with Java 9. <br>  The last column covers the semantics of the parameters. <br><br>  The semantics of the types of input parameters (left) and results (right) will allow you to quickly remember what the method does in the case of a zero and non-zero value of the parameter. <br><br>  For example, for the Optional.of () method: <br><br> <code>(x, √ò)=&gt;(O(x),¬•)</code> <br> <br>  the non-zero parameter x is displayed in Optional from it, which is displayed as O (x), <br>  and if you try to use a null input parameter (denoted as √ò), you will get Exception, denoted by the Yen symbol: ¬•. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/350904/">https://habr.com/ru/post/350904/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350894/index.html">Digest of interesting materials for the mobile developer # 244 (March 5 - March 11)</a></li>
<li><a href="../350896/index.html">Effective data compression methods when training neural networks. Lecture in Yandex</a></li>
<li><a href="../350898/index.html">10 main qualities of a manager according to Google</a></li>
<li><a href="../350900/index.html">Multi-classification of Google queries using neural network in Python</a></li>
<li><a href="../350902/index.html">Podcast "Rules of the Game": accounting subtleties for technological (and other) business</a></li>
<li><a href="../350906/index.html">Remember everything. Waiting and reality in IT: 2017 vs 2018</a></li>
<li><a href="../350908/index.html">Programming for network engineers: the first case</a></li>
<li><a href="../350910/index.html">Create your cryptocics (Part 2)</a></li>
<li><a href="../350912/index.html">Why GitHub won't help hiring a developer</a></li>
<li><a href="../350914/index.html">MDM system without primary normalization. Actual approach to solving old problems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>