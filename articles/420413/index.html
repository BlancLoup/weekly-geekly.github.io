<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQLite and NW.js - step by step instructions for creating a strong friendship</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr and its inhabitants! I wanted to sculpt something on HTML and JS, so that it was desktop and convenient. What is needed for this? Right. Node...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQLite and NW.js - step by step instructions for creating a strong friendship</h1><div class="post__text post__text-html js-mediator-article"> Hi, Habr and its inhabitants!  I wanted to sculpt something on HTML and JS, so that it was desktop and convenient.  What is needed for this?  Right.  Node.js and NW.js or Electron.  Having looked at the weak attempts of holivar NW vs Electron and after reading the documentation of both of them, it was decided to start to touch NW.js. <br><br>  But here's an ambush.  Running <code>npm i sqlite3</code> installs only those libraries that can be executed during a direct launch through node.  And if you try to connect the script in html and run this html in NW.js, then nothing will come of it.  Google associates give out only one recipe for including sqlite in a project on nw.js, and that one has to be pulled out of the cache.  Yes, and it is outdated.  Therefore, it took a couple of days to study the problems and find a working solution.  I ask under the cat. <br><a name="habracut"></a><br>  So.  For a start, a machine ‚Äúfrom what it was‚Äù was assembled and Windows 7 x32 with .NET 4.7.1 package installed (required for Visual C ++).  Why 32 bits?  I decided to start small.  Although, as it turned out, the creation of a module for x64 does not require execution on the x64 system. <br><br>  Then Node.js version 10.8.0 was delivered. Although at the end of the experiments 10.9.0 had already appeared.  But then I decided to listen to knowledgeable people: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/yn/ee/nn/yneennrfp9beyodsjsei8ysk2l4.png"><br><br>  After deliberation, I decided that I was still doing for the LTS, although it is not entirely clear where all of them have LTS, and where not.  Assumed that non-LTS - is beta, alpha and nightly build. <br><br>  Although, like any dropout, I did everything in half and did not fulfill the following recommendation: <br><br><div class="spoiler">  <b class="spoiler_title">Recommendation from the documentation for LTS-releases</b> <div class="spoiler_text">  On Windows, you need to replace the file <br>  &lt;npm-path&gt; \ node_modules \ node-gyp \ src \ win_delay_load_hook.cc <br><br>  Well, I did not find this file on my computer.  Probably because I did not install node-gyp. <br></div></div><br>  For the node set (it is imperative to do from the command line with administrator rights) <br><br> <code>npm i -g nw-gyp</code> <br> <br><div class="spoiler">  <b class="spoiler_title">In fact, the replacement node-gyp</b> <div class="spoiler_text">  NW-GYP to support NW.js specific headers and libraries. <br></div></div><br>  Next - download Visual Studio Community Edition (the current link is easily found in your favorite search engine) - at the time of this writing, the current version is 2017. What is important for us - it contains Build Tools 2015 - while the native modules in the node are only assembled with this version and more fresh do not support.  Download the installer, run and put one tick in the tab ‚ÄúIndividual Components‚Äù - <u>VC ++ 2015.3 v14.00 Toolkit (v140) for PC</u> <br><br> <a href=""><img src="https://habrastorage.org/webt/v3/5o/pd/v35opdwxd9uqyk7-xdar7xrs2f8.png"></a> <br><br>  The new Windows 8.1 SDK is also required, so we install all three items.  Installation in this form leads to a jump of 2.89 gigabytes of all necessary. <br><br>  Going further - swing the snake.  Moreover, version 2.7.  Set by default in C: \ Python27. <br>  And now - <b>attention!</b>  <b>Ambush.</b> <br><br>  The default installer assumes that it is not necessary to add the location of the python in PATH, therefore we eliminate this misunderstanding during the installation phase. <br><br><img src="https://habrastorage.org/webt/er/rh/im/errhim35p7i9q1yxtrfibs4hpf8.png"><br><br>  A similar ambush haunts many developers when building a wide variety of modules for a node.  And all because the small-scale corporation also does not consider it necessary to prescribe the path to their creations.  The githab is simply overwhelmed with assembly errors due to the fact that after installation, the path to the assembly tools is not included in the PATH.  We also correct this misunderstanding - we correct the environment variable so that it allows the assembly to go through, if not very smoothly, then at least without errors.  That's what happened with me (broken into lines for better perception) <br><br> <code>&gt;echo %PATH% <br> C:\Python27\; <br> C:\Python27\Scripts; <br> C:\Windows\system32; <br> C:\Windows; <br> C:\Windows\System32\Wbem; <br> C:\Windows\System32\WindowsPowerShell\v1.0\; <br> C:\Program Files\nodejs\; <br> C:\Users\Den\AppData\Roaming\npm; <br> <b>C:\Program Files\Microsoft Visual Studio\2017\Community\MSBuild\15.0\Bin; <br> C:\Program Files\MSBuild\Microsoft.Cpp\v4.0\v140;</b> <br></code> <br>  Bold is what you need to add manually.  Naturally, making sure that these paths exist. <br><br>  Required item - <b>reboot</b> . <br><br>  Well, now the actual assembly.  I used the manager FAR, but no one forbids the old school cmd <br><br> <code>c:\ <br> md app <br> cd \app <br> npm init <br> npm install sqlite3 --build-from-source --runtime=node-webkit --target_arch=ia32 --target=0.32.1 --msvs_version=2015 <br></code> <br>  for x64, change --target_arch = x64. <br><br>  Well, that's all.  If done correctly, the build runs with a number of messages like <br><br> <code>..\src\database.cc(672): warning C4996: 'Nan::MakeCallback':  deprecate [C:\app\node_modules\sqlite3\build\node_sqlite3.vcxproj] <br> C:\app\node_modules\nan\nan.h(929): note: .  "Nan::MakeCallback" <br> c:\app\node_modules\nan\nan_new.h(208): warning C4244: :  "sqlite3_int64"  "double",    (   ..\src\database.cc) [C:\app\node_modules\sqlite3\build\node_sqlite3.vcxproj] <br></code> <br>  but in the end the module is assembled and located in <br> <code>C:/app/node_modules/sqlite3/lib/binding/node-webkit-v0.32.1-win32-ia32\node_sqlite3.node</code> <br> <br>  The nuance of the assembly - with each assembly the node_modules / sqlite3 / lib folder is deleted by the collector.  Therefore, if there is a need to assemble two modules (for each architecture), save the intermediate result. <br><br>  Thank you for your attention, finally the result of the experiment: <br><br>  <a href="https://drive.google.com/file/d/1emlUJF0_r01Bo7HAG8KeZJXGmqhGkzSt/view%3Fusp%3Dsharing">Assembled modules for NW.js 0.32.1 ia32 &amp;&amp; x64 on googledisk</a> </div><p>Source: <a href="https://habr.com/ru/post/420413/">https://habr.com/ru/post/420413/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../420395/index.html">‚ÄúFree‚Äù plates for prisoners are not free</a></li>
<li><a href="../420397/index.html">Scientists have found a way to reverse cell aging</a></li>
<li><a href="../420405/index.html">Research IT-sales process</a></li>
<li><a href="../420407/index.html">C is not a low-level language.</a></li>
<li><a href="../420409/index.html">Learn OpenGL. Lesson 5.7 - HDR</a></li>
<li><a href="../420415/index.html">Everything you wanted to know about testing Wi-Fi adapters, but were afraid to ask</a></li>
<li><a href="../420419/index.html">Runners for those who love humiliation or how we changed and modified PixJam</a></li>
<li><a href="../420423/index.html">Ground transition interface problems</a></li>
<li><a href="../420425/index.html">Theory and practice of using HBase</a></li>
<li><a href="../420427/index.html">How to stretch images without losing quality in Photoshop in a quick way</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>