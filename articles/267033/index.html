<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple Optimization Technique Using Intel System Studio</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, we describe a simple optimization technique using the Intel Cilk Plus and the Intel C ++ compiler based on the results of a performan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple Optimization Technique Using Intel System Studio</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/files/a71/58a/f59/a7158af59f63423ebb30518cc4aaceb4.jpg">  In this article, we describe a simple optimization technique using the Intel Cilk Plus and the Intel C ++ compiler based on the results of a performance analysis conducted using the Intel VTune Amplifier.  <a href="https://software.intel.com/en-us/intel-system-studio">Intel System Studio 2015</a> contains the mentioned components used for this article. <br>  ‚Ä¢ <a href="https://software.intel.com/en-us/intel-vtune-amplifier-xe">Intel VTune Amplifier</a> - an integrated performance analysis tool that helps developers analyze complex code and quickly detect bottlenecks. <br>  ‚Ä¢ <a href="https://software.intel.com/en-us/c-compilers">The Intel C ++ compiler</a> generates optimized code for IA-32 and Intel 64 architectures. It also provides various features that help developers improve the performance of their programs. <br>  ‚Ä¢ <a href="https://software.intel.com/en-us/intel-cilk-plus">Intel Cilk Plus</a> is an extension of the C / C ++ language, which is part of the Intel C ++ compiler, which allows you to increase performance by parallelizing new or existing C or C ++ programs. <br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Editor's note</b> <div class="spoiler_text">  <s>In this post, the author uses the debug version of the application for profiling, which is not entirely correct, since the compiler‚Äôs optimizations are completely absent in this version.</s>  <s>After automatic optimization, the application profile will change significantly, and you first need to do it.</s>  <s>However, from the point of view of methodology, the whole process is described correctly, so we decided to publish this post.</s> <br>  Original corrected and translation too. <br></div></div><br><h2>  <font color="#0071c5">Strategy</font> </h2><br>  We use one of the code examples in the VTune <a href="https://software.intel.com/en-us/vtuneampxe_2013_hotspots_win_c">tutorial tachyon_amp_xe</a> as the target code for performance.  This example displays an image of complex objects. <br><br>  The performance optimization technique applicable to this example is described below. <br><ol><li>  Run a simple bottleneck analysis or general analysis for a sample project in an integrated development environment, such as Visual Studio * 2013. </li><li>  Identify bottlenecks and other optimization options. </li><li>  Applying code changes to detected bottlenecks. </li><li>  Exploring compiler optimization options. </li><li>  Parallel code. </li></ol><br><br><h2>  <font color="#0071c5">Optimization</font> </h2><br>  <b>Test environment</b> <br>  OS: Windows 8.1 <br>  Tool Kit: Intel System Studio for Windows Update 3 <br>  Development Environment: Microsoft Visual Studio 2013 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Step 1. Interpretation and analysis of results data </h4><br>  Run a general analysis (if this is not possible, go to a simple analysis of bottlenecks) and detect bottlenecks.  This sample code is created as an example for detecting bottlenecks and improving performance.  Therefore, to work with it, you can use the <a href="http://software.intel.com/en-us/vtuneampxe_2013_hotspots_win_c">sample</a> page of <a href="http://software.intel.com/en-us/vtuneampxe_2013_hotspots_win_c">the tachyon_amp_ex</a> .  After running the example in VTune, we get the following results. <br><br><img src="https://habrastorage.org/files/735/57d/bfd/73557dbfdf064f0c9e22f6417e57dd4d.PNG"><br><br>  It can be seen that the time spent by this application was <b>44.834 seconds</b> , and we will try to improve this basic level of performance. <br>  In addition, in this application example, the <i>initialize_2D_buffer</i> function consumes the most time ‚Äî <b>18.945 seconds</b> , so it occupies the top line in the list of resource-intensive functions.  We will try to optimize this particular function, which takes the most time. <br><br><img src="https://habrastorage.org/files/d23/615/616/d236156162e24716b860d0dbd77e5e03.PNG"><br><br>  The CPU histogram shown above shows that in this example parallel processing is not used.  Therefore, it is possible to use a multi-threaded architecture to speed up the processing of resource-intensive tasks. <br><br><h4>  Step 2. Algorithmic approach for the function initialize_2D_buffer </h4><br><br><img src="https://habrastorage.org/files/36b/039/cc1/36b039cc11c74407b31c5cbfd9bd73e7.PNG"><br><br>  As we have seen, the execution of the <i>initialize_2D_buffer</i> function takes the most time, and this function involves the largest number of instructions.  From this it follows that if somewhere and you can achieve increased productivity, then this is where the effect will be greatest. <br><br><img src="https://habrastorage.org/files/116/ef4/2cb/116ef42cbf8344d88b5d71bada33e50f.PNG"><br><br>  Double-click the function name.  VTune Amplifier will open the source file on the very line where this function takes the most time.  For the <i>initialize_2D_buffer</i> function, this string is used to initialize the memory array using scattered memory locations (not in a row).  This sample code already has a faster alternative to the for loop. <br><br>  Below is the actual code of the <i>initialize_2D_buffer</i> function.  The first for loop fills the target array inconsistently, while the second for loop performs the same task sequentially.  You can improve performance by using the second for loop. <br><br><img src="https://habrastorage.org/files/ace/c1a/d23/acec1ad232894e41a77757b3cf4079c9.PNG"><br><br><img src="https://habrastorage.org/files/5e8/a4c/136/5e8a4c13669d43beaf33ce6fa66ec5c9.PNG"><br><br>  After replacing the for loop with the second one, we notice some performance gains.  Consider the new results of profiling in VTune. <br><br>  Compared with the previous result, the total execution time decreased from <b>44.834</b> to <b>35.742 seconds</b> , that is, approximately <b>1.25 times</b> .  The operating time of our objective function was reduced from <b>18.945</b> to <b>11.318 seconds</b> , that is, approximately <b>1.67 times</b> . <br><br><h4>  Step 3. Compiler optimization options </h4><br>  We often lose sight of the automatic optimization capabilities available in compilers.  In this case, we simply enable Intel C ++ compiler built-in optimization, specifying the / O3 parameter when compiling.  The same can be done with a graphical user interface.  To use the ‚Äú/ O3‚Äù parameter, you must first install the Intel C ++ compiler as the default compiler for this project. <br><br><img src="https://habrastorage.org/files/7da/006/534/7da006534faa4f1cb5911c07cc37ec5b.PNG"><br><br><img src="https://habrastorage.org/files/6c8/889/273/6c88892733964c68a3f2c3b95739ad48.PNG"><br><br>  Adding this parameter alone is sometimes enough to significantly improve performance.  For details on the optimization parameter / O [n], see <a href="https://software.intel.com/en-us/node/522813">here</a> .  New results: <b>24.979 seconds is</b> enough to complete the task.  First it took <b>35.742 seconds</b> , that is, the program now works <b>1.43 times</b> faster. <br><br><img src="https://habrastorage.org/files/477/dac/56c/477dac56cf5b4fcea425c72cdf2eb7cd.PNG"><br><br><h4>  Step 4. Parallelizing with Cilk Plus </h4><br>  Parallel programming in itself is a vast area.  There are many ways to implement parallel computing in the system, designed to work on multi-core platforms.  This time we use Intel Cilk Plus - this is a fairly simple language extension that works very well. <br><br>  When studying and analyzing code using VTune results, we can find a point at which the code repeatedly calls the most resource-intensive procedure.  This is where the greatest potential for parallelization.  Usually this is done as follows: we study the tree of the calling and called objects and return to the original narrow place until a fragment is found that is suitable for parallelization. <br><br>  This time we will simply work with the <i>draw_trace</i> function in the <i>find_hotspots.cpp</i> file.  Simply add cilk_for to parallelize the task we need: instead of one stream, several will be involved.  After that, the work of four threads is clearly visible (the code was tested on a dual-core processor with hyper-trading technology), which simultaneously draw different lines. <br><br><img src="https://habrastorage.org/files/6ef/31a/882/6ef31a8820d74c6396ed6331320e0ee1.PNG"><br><br><img src="https://habrastorage.org/files/284/04e/668/28404e6680ff4064b46f190c1d68d316.PNG"><br><br><img src="https://habrastorage.org/files/f50/4a5/de1/f504a5de150b49518333022bdcb58352.jpg"><br><br>  Now, <b>11.656 seconds is</b> enough to complete the work, which is significantly better than the initial time.  Consider the results of VTune. <br>  The total running time is <b>13.117 seconds</b> , that is, <b>1.9 times faster</b> than before.  We see that the multi-core architecture is effectively used. <br><br><img src="https://habrastorage.org/files/128/290/f85/128290f858b548cbb4f136434a3b11b2.PNG"><br><br><h2>  <font color="#0071c5">Conclusion</font> </h2><br>  The operating time of the entire program decreased from <b>44.834</b> to <b>13.117 seconds</b> , that is, <b>3.41 times</b> . <br>  This level of optimization was achieved only with the help of a simple analysis in VTune, the addition of an Intel C ++ compiler parameter and the use of Cilk Plus. <br>  Intel System Studio components help developers effortlessly improve their software. </div><p>Source: <a href="https://habr.com/ru/post/267033/">https://habr.com/ru/post/267033/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267021/index.html">Zero Security: A - Beginner Ethical Hacking Courses</a></li>
<li><a href="../267023/index.html">Comparison of mobile applications for 3D reconstruction</a></li>
<li><a href="../267025/index.html">git punish - whose team I always lacked</a></li>
<li><a href="../267027/index.html">FZ-188: who will soon categorically not be able to buy foreign software, if there is a Russian equivalent</a></li>
<li><a href="../267029/index.html">We make a network printer from HP LJ1000</a></li>
<li><a href="../267035/index.html">The time series forecasting model for the maximum similarity sample: an explanation and an example</a></li>
<li><a href="../267037/index.html">A simple algorithm for determining the intersection of two segments</a></li>
<li><a href="../267039/index.html">Private Cloud Appliance - the best virtualization and private cloud for data centers</a></li>
<li><a href="../267041/index.html">Dissect t-SNE</a></li>
<li><a href="../267045/index.html">System backup of virtual machines or how to save money organization</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>