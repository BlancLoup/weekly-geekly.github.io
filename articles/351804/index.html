<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How and why to move from service-oriented architecture to microservices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Alexey, I am the chief IT architect of Renaissance Credit Bank. Ten years ago, we, like many companies, accelerated their developmen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How and why to move from service-oriented architecture to microservices</h1><div class="post__text post__text-html js-mediator-article">  Hello, my name is Alexey, I am the chief IT architect of Renaissance Credit Bank.  Ten years ago, we, like many companies, accelerated their development thanks to a service-oriented architecture (SOA).  But over time, the requirements for architecture changed, and serious questions began to arise about this paradigm.  In the end, we decided to move from the ESB integration bus to microservices.  In our example, I will tell you why you should think about the effectiveness of SOA and what you can do if this model does not suit you either. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/888/566/0e4/8885660e4e981b5e6644fd09a995c02c.jpg"><br><a name="habracut"></a><br><h2>  New ESB Problems </h2><br>  It all started with the fact that we appreciated the structure of our integration bus.  The diagram shows a typical integration flow situation for an ESB. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4eb/ce7/506/4ebce750603f7cef989b3be9737b71d6.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There may be several dozens of such blocks (up to a hundred!), And they are closely intertwined.  If you need to make a new product and make some changes, then there will not be enough resources to process this hefty monolith.  And this is just a general view.  We studied SOA from all sides and identified seven major issues: <br><br><ul><li>  <i>Focus on service reuse.</i>  This rule was the cornerstone of SOA, but in the end it led to the fact that all the teams (front, back and integration) were so tightly coupled that any update to the integration required a regression test of almost the entire bus! <br></li><li>  <i>Heavy technological stack.</i>  Initially, a single ESB container was an advantage, and this allowed us to quickly deploy services.  But today, a limited stack of technologies, libraries, and programming languages ‚Äã‚Äãis already noticeably hindering development. <br></li><li>  <i>Turning the ESB into a bottleneck for all processes.</i>  Over time, the tire acquires functions and turns into a full-fledged bank information system, with a waterfall approach and ‚Äúcutting‚Äù integration flows.  The load of the ESB team is greatly increasing, which hinders the work of other development teams. <br></li><li>  <i>DataSilo.</i>  In SOA, service interfaces are separate from implementation.  But how separated are the <i>data</i> used by the services?  One service accesses the data of another, the dblink mechanism is used, confusion arises and a ‚Äúdata silo‚Äù. <br></li><li>  <i>Mixing integration patterns.</i>  Strictly speaking, there are two of them for SOA: the classic MessageBroker, where messages go between systems for exchanging chunks of data, and the hub of services, where we host some services that ‚Äúhave nowhere else to stick‚Äù.  When mixing these templates, the ESB turns into an absolutely ‚Äúblack box‚Äù. <br></li><li>  <i>The formation of "shadow IT".</i>  Business customers often form their own IT-teams for the development of critical systems for themselves, but they cannot use the bus for integration.  This is how the number of ‚Äúleft‚Äù connections to information systems grows. <br></li><li>  <i>Lack of ITSec (information security) support at the concept level.</i>  A little explanation needs to be made here: firstly, the completely ‚ÄúWestern‚Äù concept of the ESB does not take into account the peculiarities of Russian legislation (for example, the protection of personal data during transmission from the source to the receiver), and secondly, the ESB container is a perimeter that works effectively, when inside it is no longer required to comply with the special requirements of ITSec. <br></li></ul><br><h2>  New customer needs </h2><br>  The traditional service bus, focused on waterfall, with its complex and slow processes does not fit into the market conditions.  Today, customers are aware of flexible development methodologies.  They may not know the differences between agile and waterfall, but they want to get the first results - from the appearance of the idea to the prototype in operation - not in 6-8, but in 2-3 months, but better in general after one.  Let it be the MVP, but it is important for the customer to check the business idea as soon as possible, to understand that the decision will ‚Äútake off‚Äù. <br><br>  In such conditions, traditional, horizontally oriented teams are inferior to vertically oriented teams that work with all the components of the product - from the interaction channel to the back end.  The question arises: what to do with the integration bus, which has turned into a monolith because of the reuse of services?  We need a new technological approach. <br><br><h2>  The foundation of the new approach </h2><br>  We began to develop an alternative to SOA with the wording of the basic requirements: <br><br><ol><li>  <i>The possibility of rapid piloting of ideas.</i>  This will require a simple (regular, repetitive) structure of links between systems, rapid deployment and versioning. <br></li><li>  <i>Support for agile development.</i>  Easy connection of new, vertical commands, access to the level of ‚Äúdevelopment factory‚Äù, with automation of routine tasks. <br></li><li>  <i>Presence of an ecosystem with development teams of different types</i> : internal, external, partnership.  Providing interfaces for external access, control of this access and billing. <br></li></ol><br><h2>  Technology pyramid </h2><br>  In accordance with the requirements, we have formed a pyramid of technologies: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/838/f80/2c0/838f802c0b56a419eb9f03028388837f.png"></div><br>  Now about the components of each level separately: <br><br>  <b>1. Methodology level</b> <br><br><ul><li>  <b>Agile</b> .  The flexible approach now causes a lot of emotions and opposing opinions (on the topic of applicability in organizations of various sizes).  For ourselves, we have formulated the most important thing: this approach is the basis for structuring requirements, rapid prototyping and creating MVP - testing ideas of products. <br></li><li>  <b>DevOps.</b>  This paradigm requires maximum automation and ‚Äúblurring the boundaries‚Äù between the development and maintenance of systems.  It allows you to avoid wasting time on routine deployment and tracking operations. <br></li><li>  <b>Factory development</b> .  The movement of artifacts from the analytics stage to the deployment and operation of the created product must be continuous, without re-creating artifacts at each next stage.  For example, there should not be a situation when the service interface is first described in some format by an analyst, and then the developer manually creates the same interface anew, but in a different tool. <br></li></ul><br>  <b>2. The level of infrastructure</b> <br><br><ul><li>  <b>Containerization (Docker)</b> .  The only option to provide microservices at this level is to leave a single bus container and use separate containers for each service instance.  This means that the use of "heavy" application servers that run a wide range of libraries at startup, is also not suitable.  The container should be as lightweight and configurable as possible in order to ensure that only the set of functionality necessary for the service is launched.  And from this point of view, Docker is a great fit. <br></li><li>  <b>Container orchestrator</b> .  Containers should be managed by a tool that solves typical problems of fault tolerance, balancing and unification of deployment / shutdown / launch.  At the same time, this tool cannot be an analogue of a tire with its monolithic container. <br></li></ul><br>  <b>3. Applied architecture</b> <br><br><ul><li>  <b>Microservice architecture (MSA)</b> .  The question of the exact definition of microservice is still open.  But for the full development of integration architectures and systems, we identified the following key properties of microservices: <br></li></ul><br><table><tbody><tr><td></td><td width="150">  <b>Property</b> <br></td><td>  <b>Explanation</b> <br></td></tr><tr><td>  one <br></td><td>  Interface separation and service implementation <br></td><td>  This property is inherited from SOA and requires that the implementation change does not require an interface change.  And the service call required only interface knowledge, without understanding the subtleties of the service implementation. <br></td></tr><tr><td>  2 <br></td><td>  Good granularity <br></td><td>  Microservices should be relatively small (‚Äúthe rule of two pizzas‚Äù) and separated from each other so that changes in functionality in any subject area are concentrated as much as possible in one microservice. <br></td></tr><tr><td>  3 <br></td><td>  Separation of services at all levels <br></td><td>  Microservices must be completely separated from each other.  At the interface level and at the execution level - each has its own execution container.  At the data level, microservice has access only to "its" data and knows nothing about the features of the database of the neighboring microservice. <br></td></tr><tr><td>  four <br></td><td>  Unified interaction <br></td><td>  If microservice requires data that is accessed by another microservice, the interface call should work.  In no case do not access through the database in the neighboring scheme. <br></td></tr></tbody></table><br>  Please note: <i>there is no</i> mandatory reuse requirement for MSA! <br><br>  <b>4. The level of the data model</b> <br><br><ul><li> <b>DDD (Domain Driven Design)</b> .  One of the most difficult issues is the set of rules by which microservices are created, and ensuring their connection with the earlier stages of analytic software development.  We tried to push off from the concept of DDD with two main objectives.  First, it allows you to create domains in the domain and successfully link them with product teams (agile!).  Secondly, it helps to form microservice as an API for working with a specific business object - corresponding to a resource for a RESTful service. <br></li><li>  <b>Domains correspond to the products of the bank.</b>  This allows you to move away from the classical division to the front, back and integration, to come to unity with the product teams. <br></li></ul><br>  <b>5. Level of integration.</b> <br><br><ul><li>  <b>API Management and API First Approach</b> .  Integration with the use of the bus means ‚Äúcutting‚Äù integration flows from the front to the back with the reuse of services.  In the new version, we focus on the API First approach.  Back-to-back systems prepare the most common APIs.  The integration is based on the principle of the base crystal: the developers of the frontal systems select the API calls they need, published on the API Management portal. <br></li><li>  <b>Open API</b> .  Open API implies the use of API Management system for organizing access and operation of fundamentally different categories of developers - external, internal, partner ecosystem participants.  In fact, we get the public API of the organization. <br></li></ul><br><h2>  Architecture changes </h2><br>  Based on the new combination of technologies, we presented what we want to come to.  The figure below is a diagram of our current infrastructure with an integration bus.  Next - the scheme to which we aspire. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/596/eec/82b/596eec82bd089419e7dfc0527e1e70e7.png"><br><br>  What is changing?  Initially, at the back office level, any ABS has business logic and a data source.  We strive to ensure that back-office systems are reduced exclusively to storage and "nuclear" functionality, where changes would be rare.  And the product logic went to the level of microservices, allowing flexible change and create products, divided by domain. <br><br>  On the scale of the channel, we are planning on the basis of microservices to form and manage the logic ‚Äúspread‚Äù over the front end layer.  As a result, the front-end applications themselves will contain only channel logic, that is, native applications for automating the necessary query service channels. <br><br>  All access control will be implemented through the API Management portal, where all APIs will be described and published.  Here, any developer will be able to get all the information about them and join the development factory.  It uses a continuous cycle of work using GitLab technologies - planning, development, testing, production and operation. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b16/dd1/bf4/b16dd1bf4a30a0169d6785401e3b02eb.png"><br>  <i>API Management and Open API</i> <br><br><h2>  What's next? </h2><br>  Changes of this scale do not pass without difficulties.  They are mainly related to the breaking up of monolithic box systems into microservices, as well as the restoration of connections in the ‚Äúblack boxes‚Äù of our ESB and Data Silo.  With the model of microservices, the use of the BPM engine for building business processes is no longer relevant.  And now the question of its alternative becomes very important for us - event-driven-architecture and choreography.  We also plan to move from pure DevOps to DevSecOps, which will include ITSec requirements, and divide our Data Silo into domains.  Accomplishing these tasks will require actively collecting experience to test and maximize the use of the concepts described. </div><p>Source: <a href="https://habr.com/ru/post/351804/">https://habr.com/ru/post/351804/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351794/index.html">Seminar Dino Esposito March 29 in Moscow</a></li>
<li><a href="../351796/index.html">Conference DEFCON 19. "The Art of trolling." Matt "OpenFly" Joyce</a></li>
<li><a href="../351798/index.html">Alert in Telegram and Slack in real time. Or How to Make an Alert in Splunk - Part 2</a></li>
<li><a href="../351800/index.html">Elegant patterns of modern javascript: Ice Factory</a></li>
<li><a href="../351802/index.html">How JS works: web page rendering engines and tips for optimizing their performance</a></li>
<li><a href="../351806/index.html">"Calendar tester" for March. Test security</a></li>
<li><a href="../351808/index.html">Using kubernetes to develop blockchain projects on Hyperledger Fabric</a></li>
<li><a href="../351810/index.html">Live broadcast from Vue.js Moscow Meetup # 1</a></li>
<li><a href="../351812/index.html">Analysis of performance tasks with JBreak (part 4)</a></li>
<li><a href="../351816/index.html">The peaceful atom: Japan will build the most powerful supercomputer for nuclear research</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>