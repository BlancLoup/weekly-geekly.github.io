<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Vulnerability in Telegram can compromise secret chats.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Publication for the anniversary of Telegram 
 The secret telegram chats use ‚Äúend-to-end encryption‚Äù, and so what? End to end encryption Telegram poorl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Vulnerability in Telegram can compromise secret chats.</h1><div class="post__text post__text-html js-mediator-article"><h3>  Publication for the anniversary of Telegram </h3><br>  The secret telegram chats use ‚Äúend-to-end encryption‚Äù, and so what?  End to end encryption Telegram poorly protects user correspondence.  A simple example: an attacker got a private key.pgp Alice, of course, to decrypt a message encrypted for Alice, you need a password from this key, which you cannot unlock by adhering to the modern doctrine of password protection.  In Telegram end to end encryption on Android - this becomes possible with a probability of 100%.  Bypassing two-factor authentication, pin-code recovery and hijacking secret chats in Telegram about this vulnerability will be an article. <br><a name="habracut"></a><br>  In my work, I will try to describe a detailed manual on vulnerabilities in Telegram on Android devices, I will give examples on restoring local code Telegram on Android, Desktop Linux / Windows.  I will compromise the secret chat Telegram.  In this confrontation with the team of Durov, my company will help me: I (Root);  Android 7.0;  Android 6.0 (root);  Android 4.4.2 (root);  PC with OS GNU / Linux / Windows (root).  At first glance, it seems the forces are not equal, let's see ... <br><br><h4>  IMHO.  How it all began </h4><br>  In my case, I felt the power of a PR company around the Telegram platform.  On the huge wheels of the ‚ÄúCart‚Äù, the hyip rolled from month to month, having neither center nor boundaries.  The influence of E. Snowden on the popularization of ubiquitous user encryption of correspondence.  Recall the iconic ICQ messenger with its QIP 2005 application on the Desktop, all the correspondence was stored on a PC in open access in the .txt files.  Telegram about the encryption of correspondence "who first began to encrypt private correspondence in large quantities" not immediately, but later said that the pioneer was him.  The history of Telegram did not <a href="https://habr.com/ru/users/durov/" class="user_link">stand</a> out in any way: the competition for the security of the MTProto protocol from <a href="https://habr.com/ru/users/durov/" class="user_link">durov</a> ;  Kolyma for artists and painters (drawing stickers);  API to create bots / applications;  ICO TON, which brought a lot of money to the owners of Telegram;  blocking the messenger in Iran, the Russian Federation and again in Iran;  as well as the inflow of rare online stuffing Telegram.  In July 2018  "The cart sped along for me."  When the ‚Äúnext Telegram‚Äù appeared on the mass messenger market with its own slogan and a small reservation (this is super fast, easy and free).  "Telegram is a messaging application with an emphasis on speed and security."  At the expense of the latter in such a steep slogan, <a href="https://habr.com/ru/users/durov/" class="user_link">durov</a> and his team (at the expense of Nikolai Durov, the technical side of the team is strong) openly interact with security / bug specialists who find / try to find vulnerabilities in the MTProto protocol or bugs on the Telegram platform.  Experts send their material to the security@telegram.org mail - this is the official method of such interaction between ‚Äúhead hunters‚Äù and Telegram developers, this is also mentioned <a href="https://hackerone.com/telegram">here.</a> <br><blockquote>  In fact, we welcome security experts to audit our system and will be grateful <b>for any feedback</b> (security@telegram.org) </blockquote><br>  The unofficial format of communication, when the letters are ignored by Telegram developers, and then specialists usually post their tweets in the microblogging, where some of them comment on <a href="https://habr.com/ru/users/durov/" class="user_link">durov</a> . <br><br>  At the service of the <s>Black Prince,</s> user privacy on the Telegram mobile platform is presented as impregnable, formidable, new-fashioned development of MTProto from Nikolay Durov.  Secret chats in Telegram (hereinafter referred to as MF) are chats that are present on the Telegram mobile platform and are protected by end-to-end encryption, the keys are stored only on the devices that were generated, and this is also the pride of Telegram-Dubai (as I will call them).  Midrange Telegram are considered very secure chat rooms all over the world, in the Telegram-Dubai world.  Several times <a href="https://habr.com/ru/users/durov/" class="user_link">durov</a> shook the air, comparing its product with competitors in a public belligerent form and always won. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Bypassing the end-to-end encryption Telegram of the messenger on Android, the bug report sent a letter to the above-mentioned e-mail.  I received no answer, after a few days I wrote to Telegram volunteers for technical support.  Volunteers answered me that they would bring my thought to the Telegram management, asking me for a clarification: from where and when I sent my letter.  After two weeks of silence, I once again recalled my letter to the volunteers, this time the messenger volunteers completely ignored my reminder.  A week later, I again repeated sending a letter to the official Telegram mail - there is no answer.  What remains, what to do?  bother with your bug report on Telegram via microblogging ?, besiege unofficial sources of communication team <a href="https://habr.com/ru/users/durov/" class="user_link">durov</a> ?  Or write and post an article for the media?  Some kind of cyber bureaucracy was formed in the Telegram ranks.  I can not fail to note <a href="https://habr.com/ru/users/w9w/" class="user_link">w9w</a> from habr.com, which, in my opinion, found the best vulnerability on the Telegram platform: vulnerability in telegra.ph.  Essence - ‚Äúany‚Äù user could edit someone else‚Äôs article on telegra.ph.  With his vulnerability report <a href="https://habr.com/ru/users/w9w/" class="user_link">w9w</a> (he found several of them), he was also unable to reach security@telegram.org.  After completing the bureaucratic quest, <a href="https://habr.com/ru/users/w9w/" class="user_link">w9w</a> received a small financial reward for the vulnerabilities found.  I wonder if this is Telegram greed?  or some other reason?  Let's return to the Telegram, some reviews about it. <br><br><img src="https://habrastorage.org/webt/bt/qy/qa/btqyqapjuur9cnzfm5itije2vgk.jpeg"><br><br>  Many people have their own family photo album, the baghunters have their own track record of ‚Äúfound bugs / errors / vulnerabilities‚Äù.  In my PS, at the end of the work on the article, I will indifferently paint the cell B30 red, thereby leaving my question to the Telegram team open. <br><br><h4>  Part 1. Restore local code Telegram on Android OS Linux / Windows Desktop.  Based on real events </h4><br>  In July in the summer of 2018.  On Github, one of the developers of the <s>informal grouping</s> version of John The Ripper (hereinafter referred to as JTR) posted the source code for the parsing module ‚Äútelegram2john.py‚Äù written in Python.  From the name of the program it becomes clear why and to whom this module serves.  Who does not understand the meaning of such modules, these are modules that extend the functionality of JTR.  The official JTR can gut 8 formats, and the JTR jumbo-1-bleeding has 263 formats, and one of these formats is Telegram local code.  Having tested ‚Äútelegram2john.py‚Äù, I found a mistake in it: one of the three functions of parsing the local code Telegram did not work correctly, which I reported to the JTR developers on Github.  <a href="https://vk.cc/8Mcn0A">The fix</a> for ‚Äútelegram2john.py‚Äù came out promptly.  This is not the first appeal to JTR developers for found bugs, and every time a quick response and no less rapid error correction is just nice when there are such everyday streamlined communication channels.  A couple of days later, <s>the</s> module ‚Äútelegram2john.py‚Äù was approved and sent to the JTR repository in a secret meeting. <br><br>  <b>The recovery scheme of the local code Telegram is a <a href="https://vk.cc/8McpsZ">multi-step process</a> :</b> <br><br> <code>Read the salt (32 bytes), encrypted data and sha1 of decrypted data from a file. <br> Compute a PKCS5_PBKDF2_HMAC_SHA1 on the UTF8 (passcode), using the salt, 4000 iterations, keysize of 256 bytes <br> Use a Telegram-specific KDF to get the AesKey and AesIV (Relatively cheap - bunch of memcpy and 4x sha1) <br> Perform an AES-IGE-DECRYPT on the encrypted data using the derived key and IV from step 3. <br> Compare sha1 of decrypted data with the sha1 read in step 1. If they match - passcode is correct. <br></code> <br>  For the JTR user, the ‚Äúbleeding‚Äù operation is simplified to a two-step process: using the ‚Äútelegram2john.py‚Äù module, ‚Äúhash-pull‚Äù for the John's processor from the userconfing.xml file belonging to the Telegram application (instantaneous operation) and the brute force of this ‚Äúhash‚Äù using JTR.  With such an operation, the probability of recovery of the local code on Android is 100% success, the wait time is several milliseconds.  The probability of recovery of the local code on the Linux-Windows Desktop-e is X% success, the waiting time is undefined.  Why?  Because, firstly, the local code is a normal digital pin code on a four-digit Telegram (10 ^ 4 of all possible pin-a combinations) no more nor less, and secondly, the local code Telegram encryption algorithm on Android is not <b>cryptographic</b> , hence high speed brute force password.  The situation is different with Telegram's Desktop applications where there are no secret chats: in the Desktop application, encryption of local code is crypto-resistant (the speed of the Desktop / Telegram hash on the CPU is 10,000 times slower than the Anroid / Telegram hash search speed), and most importantly local code on Desktope / Telegram, you can set "any" length and use any characters. <br><br><img src="https://habrastorage.org/webt/ls/ub/b0/lsubb0cle23xy2pkv_wkzmm7fi4.png"><br>  <i>The cryptographic strength of the local code Desktop Telegram is high, the brute force speed is 10k times slower than the brute force local code Android Telegram.</i> <br><br>  Personally, I get the impression that Telegram developers worked on creating a unique and secure MTProto protocol, and not on the user's overall confidentiality, for example, an open application cache stored in a non-Android root directory, or non-cryptographic local code, which, as it turns out, recovered with 100% probability. <br><br>  At the time of this writing, the JTRs from the box in the new OS, Kali Linux and Parrot Security have not been updated since 2015, have bugs that do not allow to parse the local code Telegram (JTR jumbo-1-bleeding always has some bugs, but its functionality develops cooler than you think, if you think about Hashcat software).  So, the sophisticated user Kali / Parrot cannot restore the local code Telegram, in Windows / Android the JTRs truncated by functionality are also not suitable.  Therefore, you need to install on your OS JTR c Github (for Linux-based systems).  In order to successfully compile JTR software, before compiling the program, deliver the package to your OS ‚Äúlibssl-dev‚Äù, further <br><br><pre> <code class="bash hljs">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/magnumripper/JohnTheRipper -b bleeding-jumbo john &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> john/src ./configure &amp;&amp; make -s clean &amp;&amp; make -sj4 john/run/telegram2john.py userconfing.xml &gt;  <span class="hljs-comment"><span class="hljs-comment">#  "telegram2john.py"   GNU/Linux ,   : python telegram2john.py userconfing.xml &gt;  JohnTheRipper/run/john  --mask=?d?d?d?d #    ‚Äì  local code Android Telegram   .</span></span></code> </pre><br><img src="https://habrastorage.org/webt/99/l7/mg/99l7mgbd_gjlbyfxzaae_f7tvwa.png"><br>  <i>Restored local code Android Telegram.</i>  <i>Pin 5369.</i> <br><br>  Similarly, with the Linux code / Linux desktop application‚Äôs local code Telegram, the path to the Telegram directory is specified instead of the ‚Äúuserconfing.xml‚Äù file: <br><br>  (Linux): ~ / telegram2john.py ~ / .local / share / TelegramDesktop; <br>  (Windows): ~ / telegram2john.py "C: / Users / Name / AppData / Roaming / Telegram Desktop" (for the outdated Telegram application on Windows); <br>  (Windows): ~ / telegram2john.py "Telegram Desktop" (for the updated Telegram application on Windows). <br><br>  Note, if you want to re-parse the local code Telegram, JTR will issue ‚ÄúNo password‚Äù.  The reason - the password has already been found earlier.  Johnny, never restores the password on the second and subsequent times, instead, use the ‚Äú--show hash‚Äù option, but sometimes bugs can happen, and the ‚Äú--show‚Äù option will not work as expected (with other hashes I have encountered such bugs, but all have already corrected the developers JTR).  In this case, look in the file ~ / run / john.pot, all found passwords are stored in it, if you clear it, you can re-brush hashes with the found passwords. <br><br><img src="https://habrastorage.org/webt/4l/ta/gz/4ltagz1y7hbtdec1le1mxt2pabi.png"><br>  <i>John The Ripper is not going to re-"dirty hands <s>in the blood</s> " about the local code Android Telegram</i> <br><br>  <b>The userconfing.xml file</b> , which is a target for JTR, is located under the Android root directory: <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/shared_prefs/userconfing.xml</code> </pre> <br>  So you can get to the file with root rights, either through TWRP or using digital forensics. <br><br>  Detailed video manual for restoring local code Telegram on Android / Linux / Windows link at the end of the article. <br><br><h4>  Part 2. White starts and loses.  Hijack secret chats in Telegram.  Also based on real events. </h4><br>  <b>How is Telegram protection based:</b> <br><br><ol><li>  Enter the phone number; </li><li>  Receive SMS, or code in the application on another device - if desired, enter the SMS code or the code received in the application on another device. </li><li>  Temporary account blocking with frequent (including successful) user login. </li></ol><br>  When intercepting such a text message, you can break into the user‚Äôs account, but you can‚Äôt get access to the <s>terrorist</s> ‚Äôs secret chats, as they exist and live only on the devices of the <s>ISIS minion</s> where they were generated, which means that those who keep mobile telephony operators under control do not play around. <br><br>  <b>Optional, basic + enhanced Telegram protection:</b> <br><br><ol><li>  Enter the phone number; </li><li>  Receive SMS, or code in the application on another device - if desired, enter SMS code or code from the application; </li><li>  Enter the cloud code Telegram (stored on the Telegram server and in your mind, reset / bind via e-mail); </li><li>  Installation of local code (on Android, settings - privacy and security - password code); </li><li>  Checking the current / latest sessions of the entrance to the messenger; </li><li>  Exit from all sessions except the current one; </li><li>  Cleaning the contents of the midrange timer; </li><li>  The ban on the screen / screen recording midrange; </li><li>  Temporary account blocking with frequent (including successful) user login; </li><li>  As it turned out when hijacking the MF (logging into someone else‚Äôs account from another ip), a temporary ban of a real / compromised account ~ in 5 minutes and cancellation of the MF in a Telegram.  In the same network of real / compromised accounting, Telegram forgets to ban the account hijacking. </li></ol><br>  <b>Below I will show that the MFs are vulnerable, I‚Äôm hijacking one of these MFs (my test account in the Telegram) and will impersonate the user "Master"</b> <b><br></b> <br>  After successfully restoring the local code Telegram, I decided to touch the files next to the userconfing.xml file on Android.  Created a secret chat, looked at which files and in which subdirectories are updated in time.  I tried to copy these files from OS Android 4.4.2 to another gadget with OS Android 6.0 (transfer files between gadgets through the rar; zip archives).  Installed with GP the latest version of Telegram on Android 6.0.  Transferred from Android 4.4.2&gt; Android 6.0 updated files to similar directories <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/shared_prefs /data/data/org.telegram.messenger/files /data/data/org.telegram.messenger/no_backup</code> </pre><br>  According to the <s>stolen</s> test of his uchetka, Telegram restored the rights (which were on 4.4.2) for each file and folder personally, the operation is not fast (different rights are different for different files), he assigned a UID GID "Telegram". <br><br><img src="https://habrastorage.org/webt/9q/at/oh/9qatohryqpk8h29khwslvmemi8o.jpeg"><br><br>  Launched the application.  Immediately all the stolen files were updated in time, and the ‚Äúnew user‚Äù screen greeted me.  Telegram behaved as if I were a new user and offered to login or log in via the phone (standard procedure when Telegram was initially installed on Android).  That is, I could not break into someone else's account.  Sneaked up more and more times from different sides, but in the end - <b>Fail</b> . <br><br>  <b>I tried another way - backup Telegram test account via Titanium backup.</b> <br>  I made a backup of the application on Android 4.4.2, I deployed a backup of 4.4.2.  on Android 6.0. <br><br><img src="https://habrastorage.org/webt/iu/eb/7v/iueb7vcq3h-upyl2_xxyl3qewoc.jpeg"><br><br>  You do not need the rights to the ‚Äústolen‚Äù application, changing the UID / GID - Titanium Bacup will do everything.  I launch Telegram of the compromised account on Android 6.0 and the magic!  I get a request to enter the local code of the user "Master".  Such a middle game with a backup provided a two-factor authentication bypass without victims and frills.  Telegram, for its part, requested only the local code from the stolen account.  Sending a stolen file <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/shared_prefs/userconfing.xml</code> </pre> <br>  on VDS with the installed OS Kali Linux, where JohnTheRipper no longer slept in the running processes, it was time for him to act.  The next moment hell hit the local code!  Hash could not stand a second, gave a crack. <br><br><img src="https://habrastorage.org/webt/_9/bu/lu/_9buluigh-7cdh1bhltdbbl4rfa.png"><br><br>  Red highlighted (top to bottom) received: <br><br><ul><li>  Hash for JTR using the telegram2john.py module; </li><li>  Restored local code Android Telegram; </li><li>  Johnny full time job (indecent-high speed brute force password, option - - -mask =? D? D? D? D, telling Johnny to pick up the 4-digit numeric code did not turn on, so that the JTR overclocked and showed its <s>rage</s> speed); </li><li>  Request to JTR of the restored local code. </li></ul><br>  Cool Johnny!  is not it? <br><br>  <s>Having outraged the ‚Äúpart‚Äù of the property of Telegram,</s> Restored with the help of the JTR Android local code Telegram, I entered my test account from another ip, which was originally located on Android 4.4.2., And now linked to Android 6.0.  At the same time I see all the secret chats of the victim and all the correspondence in them.  I tried to write, in the SC created earlier, to the Android 7.0 user and the message was sent successfully.  The user of Android 7.0 sent the answer, the response message was not just received, but received on two gadgets: on Android 6.0 and on Android 4.4.2.  I checked the last login sessions: the real user displayed his ip and his gadget Teclast Android 4.4.2 (settings-privacy and security-active sessions);  the attacker Android 6.0 in the "active sessions" was displayed device Teclast Android 4.4.2, ip Virginia.  That is, a real user does not receive information through ‚ÄúActive Sessions‚Äù, that his account was compromised, but receives ‚Äúfalse‚Äù information that he is in the network from one of his devices and from one of his ip. <br><br><img src="https://habrastorage.org/webt/ps/5h/vi/ps5hviqijte1q-4ltk_1ucmhc48.jpeg"><br><br>  A real user through active sessions does not see that he is compromised.  In the history of the last sessions are not recorded entry point of the attacker.  Moreover, in the real account of the ‚ÄúHost‚Äù I clicked ‚Äúexit from all sessions except the current one‚Äù.  The attacker is not thrown out of the session, regardless of the online / offline status of the attacker. <br><br>  I tried the same operation regarding the compromised account - the result is similar: the ‚ÄúHost‚Äù was not thrown out of the Telegram, the session keys are the same.  Incredible, yes? <br><br>  Can graphic keys mean security indicator?  The keys of secret chats are not a security indicator, in this experiment they are all three fighting among themselves. <br><br><img src="https://habrastorage.org/webt/am/ei/zy/ameizyvemokjmzivi6o6wf2ig1y.jpeg"><br>  <i>All keys are the same, including the compromised account.</i> <br><br>  Telegram declares that if keys are beating on 2 devices, you are safe - this is not so.  <i>(Retreat. I still need to verify the keys, after installing Telegram on Android and creating the very first midrange, the midrange users lacked key replicas, and the graphic images of the keys differed on the devices. The midrange worked as usual, which I did not understand, and It was an isolated case when the keys did not fight among themselves).</i> <br><br>  <b>Returned to the first method of "copy-paste", which I initially failed.</b> <br><br>  I repeated all my previous steps, adding an intermediate 3rd action. <br><br>  1) Install the latest version of Telegram from GP. <br><br>  2) Transferred directories from OS 4.4.2 to another gadget with OS 6.0 (transferred only sensitive data. Telegram and its other directories did not copy) <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/shared_prefs /data/data/org.telegram.messenger/files /data/data/org.telegram.messenger/no_backup</code> </pre> <br>  3) <b>Delete the folder on Android 6.0</b> , check <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/code_cache</code> </pre> <br>  4) I did not restore the rights personally; instead, I distributed ‚Äúrecursive‚Äù rights 777 (full access) to all the above directories.  I assigned the owner and owner of the group (UID / GID) ‚ÄúTelegram‚Äù to the same directories (in fact, ‚Äúrecursively‚Äù in the root directory does not work well in TC, so I had to recheck the assignment of rights). <br><br>  5) Forward!  I launch Telegram in another network with another ip - failure, again this greeting of a new user in English. <br><br>  6) Forward!  Restart Telegram, check and checkmate!  Telegram issued a warning to enter the user's local code, which was on Android-e 4.4.2 (and which recovers with 100% probability), while there were no requests from Telegram for a cloud code or SMS and is still completely missing.  Bypass two-factor authentication, no!  End to end encryption Telegram was successful. <br><br>  Result: the attacker's messages in the MF were also successfully sent on behalf of the real user, and all the MF correspondence was also available.  After ~ 400 beats of my anxious heart, the fears were confirmed: the hijacked account was blocked by Telegram from the attacker and from the real user;  SC - canceled. <br><br><img src="https://habrastorage.org/webt/zc/u4/hj/zcu4hjtgqr1sspqp0l3qnqvq9le.jpeg"><br>  <i>Temporary blocking of Telegram account.</i> <br><br>  After logging in to Telegram again (sometimes a ban happens for a day, but I was lucky, for some reason all the bans were given out on that day for seconds), the real user had everything as usual, and the attacker couldn‚Äôt sniff the compromised account (session keys were updated). <br><br><h4>  Several telegram approvals I managed to refute </h4><br><blockquote>  telegram.org/faq - ‚ÄúMidrange can only be on midrange origin devices‚Äù. </blockquote>  I - "As you can see, the midrange can be not only on devices of origin of the midrange, but also on devices where there is a root key and the midrange, regardless of the Android OS version." <br><blockquote>  telegram.org/faq - ‚ÄúYou can compare this image (note: the image of the MF key) with the one your friend has - if both images are the same, you can be sure that the secret chat is safe‚Äù </blockquote>  I - ‚ÄúYes, it is safe, but only in the Telegram-Dubai world‚Äù;  "You can not be sure that the chat is safe." <br><blockquote>  telegram.org/faq - ‚ÄúWe also recommend that you enable two-step authentication and set a strong access code to block your application, you will find both options in the settings - Privacy and Security.‚Äù </blockquote>  I - ‚ÄúStrong access code can be set only in Telegram Desktop Linux / Windows applications, but not pin /‚Äú password ‚Äùin the Android application‚Äù <br><blockquote>  telegram.org/faq - ‚ÄúA user with root access can easily bypass security functions built into the operating system, read the process memory, or access restricted areas, such as internal storage.  Once the attacker has access to the root, any threat mitigation efforts become useless.  No application can be called safe in these circumstances, no matter how strongly encrypted. ‚Äù </blockquote>  I - ‚ÄúOr restore the Android local code and get / clone the account.  With each new incorrect attempt to enter a pin, Telegram increases the waiting time between attempts to enter a pin.  Apparently, with this algorithm, Telegram is satisfied in protecting the user from manual brute force 10 ^ 4 various pin combinations, but is the user satisfied when it is easy to compromise him?  If the Telegram developers would like to mitigate the threats in these circumstances, they could implement this as a temporary lock for a few seconds for incorrect input of the local code, and replace the Android function with the Telegram function with a pin for password, with PBKDF2 encryption - this will slow down the brute attack force.  As an example of good protection - the password at the entrance to the encrypted password database Keepass2Android. <br><blockquote>  telegram.org/faq ‚ÄúYou can access secret chat messages from your device of origin.  They are safe as long as your device is safe in your pocket. " </blockquote>  I - "That's where it turns out to be true!" <br><br><h4>  findings </h4><br><ul><li>  Local code Telegram (pin) on Android is hacked into JTR instantly and with a probability of 100%, this leads to the following consequences: hijacking secret chats, breaking the midpoint correspondence, passing off an intruder as a real user.  Protection against this "trick" - a temporary ban from Telegram and new session keys for a real user. </li><li>  The operation to steal the MF is similar to theft cookie + hacking pin + "zamochka with rights" if you use the method of "copy-paste". </li><li>  To restore Telegram pin on Android, you need to work with the messenger application file located in <br><br><pre> <code class="plaintext hljs">/data/data/org.telegram.messenger/shared_prefs/userconfing.xml</code> </pre> <br>  You can get to sensitive files with root rights, either through TWRP or using digital forensics. </li><li>  For an intruder, hijacking a uchetka is an opportunity not only to drop the correspondence, but also an opportunity to cause damage to the real account owner: for example, to clear "your" cloud.  In this case, the real user will irrevocably lose their data in the "favorites". </li><li>  Often, users put the local code on the Telegram Desktop-e the same as the pin on the Android-e is a trap, 4-digit local code Telegram on Windows / Linux gets &lt;1 minute, and access to a PC is often easier than access to a gadget. </li><li>  Telegram developers should replace ‚Äúpin‚Äù with Android with ‚Äúpassword‚Äù, with crypto-resistant encryption (as implemented on Telegram Desktop-e or in other mobile applications, such as Keepass ...) using PBKDF2, thus the problem will actually be solved. </li><li>  security@telegram.org, and in general, technical support in Telegram, as a user-developer service for responding and interacting, is not up to par. </li><li>  During the period of "silence", Telegram released an update to the GP, but the update was planned and was related to the Passport telegram, another update also came out, but the vulnerability that I demonstrated in this article is still valid, and anyone can take advantage of it. </li><li>  Telegram did not respond to the bug report (the discovered vulnerability).  The answer is likely and will not follow. </li></ul><br><div class="spoiler">  <b class="spoiler_title">spoiler</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/sb/ph/vl/sbphvlz_lw0gpvghmd3oug28myg.jpeg"><br></div></div><br>  <b>Demonstration of restoring local code Telegram on Android / Linux / Windows.</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/OzFAyOJ5MPw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <b>Demonstration of the vulnerability of Telegram secret chats.</b> <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/zRO_KsPZJto" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>PS: the date / time on individual screens or screen videos may not be the same, as Telegram experiments and screenshots were made as the article was being written, and because of the distribution of bans by Telegram, the article was written for several days.</i> <br><br>  <i>PPS: in the comments of some users, the root-rights properties are of interest.</i>  <i>On many gadgets, users have root (see spoiler), and more tech-savvy users tend to get full root over their device.</i> <i> ,    GNU/Linux     ¬´  ¬ª (Android ‚Äî  Linux  GNU   ).      Windows  ¬´¬ª       ?  Android-     ,   . <br>  :      gpg/pgp ,    keepassdroid,       rar.  ¬´¬ª  /      root        .  Telegram Android    pin,          100% .</i> <br><div class="spoiler"> <b class="spoiler_title">...</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/rz/cf/oy/rzcfoywf1y9lphimjjal0l-2nqe.jpeg"><br></div></div><br> <i>       local code  Android-e ¬´password¬ª  ¬´pin¬ª. <u> </u> (  / ),   <s></s> ,      (  CPU)   <b>~5  /</b> .  :   RAR    <b>~100 /</b> ;  LUKS/VeraCrypt (AES) <b>~30 /</b> ;   keepass <b>~1 /</b> (-   ).</i> </div><p>Source: <a href="https://habr.com/ru/post/419551/">https://habr.com/ru/post/419551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419535/index.html">Toaster Update</a></li>
<li><a href="../419537/index.html">Cyberdemona: artificial intelligence DOOM 2016</a></li>
<li><a href="../419545/index.html">Material 2.0 for developers. Overview of new components</a></li>
<li><a href="../419547/index.html">Organizing regular digest logs with python and ansible using asterisk as an example</a></li>
<li><a href="../419549/index.html">Voice assistants do not learn from the Turing test</a></li>
<li><a href="../419557/index.html">Figak and figak in production. We released RegionSoft CRM 7.0</a></li>
<li><a href="../419559/index.html">How to search for users on GitHub using React + RxJS 6 + Recompose</a></li>
<li><a href="../419561/index.html">Cellular operators still cancel national roaming charges</a></li>
<li><a href="../419567/index.html">Roskomnadzor and the Prosecutor General's Office exceeded authority when blocking Telegram</a></li>
<li><a href="../419569/index.html">Slurm: activity videos and organizational packs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>