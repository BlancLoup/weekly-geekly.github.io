<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we did a project about the presidential elections in Russia in 2018</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the fall of 2017, the guys from GOLOS thought that the online broadcast of the elections should be brought to a new level: 



- Firstly, it was fr...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we did a project about the presidential elections in Russia in 2018</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/rl/iq/lg/rliqlgbozltchav9hcajjcrn4_o.png"></div><br>  In the fall of 2017, the guys from GOLOS thought that the online broadcast of the elections should be brought to a new level: <br><br><ul><li>  Firstly, it was frustrating that until now there are no details on the maps of the subjects of the Russian Federation to the territorial commissions, </li><li>  secondly, the extreme complexity and intricacy of the CEC website, which does not allow to quickly find out the results in their polling station, </li><li>  and thirdly, it was decided to start making the basis for an encyclopedia of results, when you can see the results for different elections for one polling station.  Roughly speaking, find out how the neighbors voted. </li></ul><br>  And all this is not only to find out in which region 39% of voters live for Grudinin, but also to check whether there is such a place in a country where Putin did not win the election. <br><a name="habracut"></a><br>  It quickly became clear that, alas, it was not worth waiting for financial investments in this project, and then everyone worked on almost pure enthusiasm. <br><blockquote>  Association of non-profit organizations "In Defense of Voters' Rights" Golos "" is a Russian public organization.  Founded in 2000.  The declared objective of the organization is the protection of the rights of voters.  In mid-2013, the organization was active in 40 regions of Russia. <br><br>  In its work, Golos informs citizens about the electoral legislation of Russia, conducts long-term and short-term observation of elections at all stages of elections. </blockquote><br>  I joined the project when the guys had a clear idea: where they would get the data from, the structure of the project and the design.  The team needed a man to deal with the server part, I took this position. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The project was structurally divided into two principal parts. <br><br><h2>  <b>First part</b> : before the election </h2><br>  <b>The first part</b> : before the elections ( <a href="https://uik.golosinfo.org/">uik.golosinfo.org</a> ), was supposed to start a week before the elections, and provide opportunities: <br><br><ol><li>  find your polling station; </li><li>  see where it is on the map; </li><li>  recall exactly how people voted on this site. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/le/q_/-q/leq_-qiytlna7_3ajricnpii-ju.png"></div><br>  At this stage, everything starts with a search in the base of addresses of voters for more than 17 million records, which can be parsed from the CEC website.  In this database, each component of the address like house number, street, city or district is a separate field and there are 16 types of such components.  The set of non-empty components for different addresses is very different.  A simple search for even one address in this database took more than a minute, which in itself is too long, and if we talk about a loaded project, it is not allowed.  Then <a href="http://www.sphinxsearch.com/">Sphinx</a> came to the rescue and the search time was reduced to hundredths of a second. <br><blockquote>  Sphinx (born SQL Phrase Index) is a full-text search system developed by Andrey Aksyonov and distributed under the GNU GPL license.  A distinctive feature is the high speed of indexing and searching, as well as integration with existing DBMS (MySQL, PostgreSQL) and API for common web programming languages ‚Äã‚Äã(PHP, Python, Java are officially supported; there are community-implemented APIs for Perl, Ruby, .NET and C ++ ). </blockquote>  If you are not familiar with Sphinx yet, then I highly recommend it, working with it is like magic, it is easy to configure and just works.  By the way, there are rumors that Habr's search also uses this search engine. <br><br>  Searching the address database allows you to determine which electoral commission a voter belongs to in 2018, but not in 2012 (the time of the last election).  At first glance, it seems that nothing could change much, and people both went to vote in the nearest school and will go.  But in fact, there were changes and there were a lot of them: in 2013, the numbers of polling stations changed in more than half of the PECs (precinct election commissions).  In order to show how the polling station voted in the last presidential election, it is necessary to establish a correspondence between the number of the polling station in 2018 and the number in 2012. <br><br>  There is a great difficulty in this comparison. <br><br>  Unfortunately, it was not possible to find an address base for 2012 anywhere (otherwise it was possible to implement a direct correspondence of the address to a section).  Therefore, we had to match the addresses of PECs 12 and 18th.  Addresses were in a different format, so a script was written, highlighting the name of the settlement and the street (avenue, lane, etc.).  Thus, about 60 thousand PECs were managed.  On the same day, we started and faced dissatisfaction with users who reported that they could not find their PEC.  Quickly on the same day, thanks to the help of caring people, we spent the remaining PECs matching the coordinates using the Python geopy library, and as a result, almost every address was able to give a turnout and the number of votes for candidates in the last election. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x0/jb/d1/x0jbd1rq2-366qhjpxaysl1n8pq.png"></div><br><br>  According to the data of the 16th year (Elections to the State Duma) everything was ready, but they didn‚Äôt have time to put them in the backend and frontend, it is in the plans. <br><br><h2>  <b>Second part</b> : election day </h2><br>  In the process of discussing plans in the fall, appetites for the children from GOLOS were so intense that it was decided to show real-time results with detail to each segment!  However, on this idea we are stung. <br><br>  So, according to the plan on the election day, the site was supposed to show on-line voter turnout with details from the country to individual polling stations, and when the counting of votes is over switch to the display mode of how Russians from different regions voted. <br><br>  The second part of the project was to start with the beginning of the elections and show the dynamics of voter turnout on the map with some delay.  It was planned that, at first, the Far Eastern regions will begin to light up on the map, and as the polling stations open, the color border will move to the west. <br><br>  Precinct commissions during voting must submit turnout data at 10, 12, 15 and 18 hours, then the counting of votes and commissions submit detailed statistics for their polling station.  We had a parser set up that was ready to accurately collect data from the CEC site as soon as they were updated and load it into the database on the server so that site visitors could see how events are developing with minimal delay. <br><br>  The whole logic of the backend and the frontend was built on the assembly of data from the underlying levels from the underlying (PEC).  However, this was our deliberate mistake, since we assumed that the results would be immediately for all PECs in the region, in reality this is not the case.  In reality, it turned out that not all data appeared on the CEC website in a timely manner.  In truth, almost from where did not come complete data.  As a result, something like this happened: data could only come from a single PEC in the region. <br><br>  In addition, we parse the pages of territorial commissions which host a summary table with statistics on district commissions, which is a long time, because there are as many as 2800 of such pages. For example, there are only 85 pages with statistics on TECs, as the number of subjects of the Russian Federation.  We had to write separate parsers to the country, subjects of the Russian Federation and LICs, and update them in a timely manner, and PECs as soon as they are ready, then it would all work. <br><br>  Due to the fact that we did not foresee the complexity in advance in the voting process, it was decided not to move to the second stage of the project until there is complete reliable data.  So the project has lost the ability to monitor turnout almost in real time.  But the opportunity to examine the turnout card carefully and study the distribution of votes for candidates did not disappear anywhere, when we had complete data (by the evening of the next day) we switched <a href="https://2018.golosinfo.org/">our project</a> to the mode of displaying election results. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/8l/2c/cc/8l2ccc5woxjzicle4z4xisb5ka0.png"></div><br>  As a result, all three global megacystalts were closed (map, search for their PECs at, viewing the results of past elections), but did not work online.  Although all the errors have been scrupulously studied and now we know how to do it, we are still waiting for the CEC to be more communicative and that they will finally begin to give their real-time data through the API. <br><br>  And also: <br><br><ul><li>  I learned that there are no addresses and names in Russia alone.  It turns out that there are many people who live all the time and are registered in a dead end. </li><li>  It turned out very sticky thing, you can endlessly drive on the map and watch the tsiferki changing </li></ul><br>  <i>We thank all those involved in this project, in particular, the DataMap laboratory team that made the map (a lot of work!): Andreev Vyacheslav, Anton Balashov, Mandzhiev Hongor, and also Elena Nikitin, Gleb Suvorov, Sergey Ustinov, Valeria Viskalin, Marat Khaliulina.</i> </div><p>Source: <a href="https://habr.com/ru/post/353120/">https://habr.com/ru/post/353120/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353110/index.html">Mitap Cocoaheads in Tutu.ru office</a></li>
<li><a href="../353112/index.html">Security violations of mobile applications as a result of insufficient attention of the developers</a></li>
<li><a href="../353114/index.html">Kubernetes 1.10: a review of major innovations</a></li>
<li><a href="../353116/index.html">Dagaz: Looking for talents</a></li>
<li><a href="../353118/index.html">Sberbank Business Online on Windows 10 - a new solution for customers, or why UWP applications are driving</a></li>
<li><a href="../353122/index.html">Figma web-API - an interface that allows you to connect to other tools</a></li>
<li><a href="../353124/index.html">UL 3223: New Data Center Certification Standard introduced</a></li>
<li><a href="../353126/index.html">What's New in PostgreSQL 11: INCLUDE Indexes</a></li>
<li><a href="../353128/index.html">How I (re) made a bagel in a week</a></li>
<li><a href="../353130/index.html">Open webinar "Examples of patterns"</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>