<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Launch .NET MicroFramework on STM32F4Discovery (translation)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A few months ago, STMicroelectronics distributed the STM32F4 Discovery debug card for free. I became one of those lucky enough to get it for free. Las...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Launch .NET MicroFramework on STM32F4Discovery (translation)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/8fb/f09/904/8fbf09904da95b5b8eae690c3c9a1eab.jpg" alt="image"><br>  A few months ago, STMicroelectronics distributed the STM32F4 Discovery debug card for free.  I became one of those lucky enough to get it for free.  Last semester, I used a fee for my project (realtime and embedded OS) using Keil.  I also have a Netduino debug board, which is my favorite among my debug boards because I can use Visual Studio and C #.  I know about the limitations of managed code related to the cost of resources on the CLR, but my program is not a real-time program.  In the last week, I accidentally stumbled upon the site <a href="http://netmf4stm32.codeplex.com/">netmf4stm32.codeplex.com</a> and was pleasantly surprised that .NET MicroFramework was ported to STM32F4 debugging boards.  So why not try?  At the same time I described the whole process, diluting the text with screenshots.  The source of this work was the post <a href="http://netmf4stm32.codeplex.com/discussions/400293">netmf4stm32.codeplex.com/discussions/400293</a> .  Thanks to LouisCPro and members at <a href="http://netmf4stm32.codeplex.com/team/view">netmf4stm32.codeplex.com/team/view</a> .  All this took me no more than 2 hours (including the installation of Visual C # Express 2010).  Let's start ... <br><a name="habracut"></a><br>  We will need the following <br><ul><li>  STM32F4 Discovery debug card </li><li>  Micro USB and Mini USB cables (both needed) </li><li>  STM32 ST-LINK Utility (to fill the bootloader on the debug board, it is necessary for the driver) <a href="">www.st.com/internet/com/SOFTWARE_RESOURCES/TOOL/DEVICE_PROGRAMMER/stm32_st-link_utility.zip</a> </li><li>  Download stm32f4discovery.zip and STM32_WinUSB_drivers_ (for_evaluation_purposes_only) .zip at this link <a href="http://netmf4stm32.codeplex.com/">netmf4stm32.codeplex.com</a> </li><li>  Visual C # Express or Visual Studio 2010 (version 2012 not yet supported) <a href="http://www.microsoft.com/visualstudio/eng/downloads">www.microsoft.com/visualstudio/eng/downloads#d-2010-express</a> </li><li>  .NET MicroFramework SDK (in our case version 4.2) <a href="http://netmf.codeplex.com/releases/view/91594">netmf.codeplex.com/releases/view/91594</a> </li><li>  One LED (we will blink LEDs) </li></ul><br>  After you have installed everything (please install everything), connect the miniUSB cable. <br><img src="https://habrastorage.org/getpro/habr/post_images/f36/cdf/58a/f36cdf58a2e1b32a8b8c89f79e1cac1d.png"><br>  <i>Connect MiniUSB cable to STM32F4</i> <br>  (I had another firmware installed, so everything started up easily) <br>  As soon as you plug in the card, the search for drivers begins.  If you have already installed the STLink utility, the drivers will be installed automatically.  If you missed it, please install it.  Run STLink (by default STM32 ST-LINK Utility.exe is located in the folder C: \ Program Files (x86) \ STMicroelectronics \ STM32 ST-LINK Utility \ ST-LINK Utility \) <br><img src="https://habrastorage.org/getpro/habr/post_images/002/a23/485/002a23485079d579e0fa0cbf9d2246b3.png" alt="image"><br>  <i>STLink is connected to the board</i> <br>  After connecting to the utility, clear the STM32F4 (do not worry, you will not get a brick) by following the screenshots below (in turn, run Erase Chip and Erase Sectors ...) <br><img src="https://habrastorage.org/getpro/habr/post_images/5eb/1b6/509/5eb1b6509d25c68086661cce8e35d127.png" alt="image"><br>  <i>Cleaning menu</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/c1e/261/3bb/c1e2613bbc10a93c0c6d51853d767c86.png" alt="image"><br>  <i>Sector Clearing</i> <br>  Now the chip is cleared.  Remember point 4 at the beginning, where are the links to two zip archives?  Unpack them in a convenient place (we will use them).  In stm32f4discovery.zip you will see 3 files: Tinybooter.hex, ER_Flash.hex and ER_Config.hex.  Using the ST Link utility, load Tinybooter.hex into the chip (follow the instructions in the screenshot below) <br><img src="https://habrastorage.org/getpro/habr/post_images/0a0/ba5/c92/0a0ba5c925bb3292501cc0f85c828c62.png" alt="image"><br>  <i>Program Section</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/1bc/5d9/ff0/1bc5d9ff053cfdb5ce8c846b450c48e0.png" alt="image"><br>  <i>Tinibooter.hex</i> <br>  Then press the reset button on the board (or pull out and insert the usb cable).  Once you have downloaded Tinibooter.hex, the miniUSB cable will only act as a power source for our project.  After rebooting your board, plug in the Micro USB cable (another cable).  I used a cable to charge my smartphone. <br><img src="https://habrastorage.org/getpro/habr/post_images/ec7/e75/7b6/ec7e757b63366697e67d7c1738d23254.jpg" alt="image"><br>  <i>Micro and Mini USB cables are connected</i> <br>  As soon as you plug in the Micro USB cable, the system will start searching for drivers and will not find them.  Install a driver that is in another file named ‚ÄúSTM32_WinUSB_drivers_ (for evaluation purposes only) .zip‚Äù.  Use the screenshots below if you don‚Äôt know how to do this. <br>  Go to Devices and Printers from the Start menu, and then <br><img src="https://habrastorage.org/getpro/habr/post_images/672/4cc/fc7/6724ccfc74a4e61688933300e656e97f.png" alt="image"><br>  <i>Right-click on the shortcut STM32.Net Test</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/f6a/f07/e69/f6af07e69f768fb226a27fdfb3c132c3.png" alt="image"><br>  <i>Properties -&gt; Change Settings</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/85e/0d5/7c5/85e0d57c53ba1e2a33c068a92bd345c0.png" alt="image"><br>  <i>Search for a new driver</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/117/daa/7bd/117daa7bdea01a6f0a7910dd1f086aed.png" alt="image"><br>  <i>Ignore the warning (as usual)))</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/a3a/bb1/798/a3abb1798eb1ad699393782414b43edf.png" alt="image"><br>  <i>There are no mistakes now!</i> <br>  Now MFDeploy should be able to detect the board.  MFDeploy is MicroFramework Deployer.  With this program we will install the CLR, on which our .net code will run.  Ok, run MFDeploy.exe (you will find it in the folder C: \ Program Files (x86) \ Microsoft .NET Micro Framework \ v4.2 \ Tools \), which you should have after installing the SDK.  To make sure that MFDeploy sees the board, do as shown below. <br><img src="https://habrastorage.org/getpro/habr/post_images/4a5/271/8f2/4a52718f268e34c51998e0341351d778.png" alt="image"><br>  <i>MFDeploy ping</i> <br>  If you see the answer, then everything is done correctly.  Download 2 other .hex files (ER_Config.hex and ER_Flash.hex) unpacked from stm32f4discovery.zip to the board using MFDeploy as shown below <br><img src="https://habrastorage.org/getpro/habr/post_images/a46/619/c1c/a46619c1c6da913eebe8eb0161fe1cca.png" alt="image"><br>  <i>Click Browse to download the hex files.</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/15c/dc4/6c1/15cdc46c1aebb264b4402a9dbc31667c.png" alt="image"><br>  <i>Install them in any order.</i> <br>  Reboot the card. <br>  <b>Congratulations!</b>  <b>You now have a board with .NET Microframework!</b> <br>  Now we need to test our board.  Open Visual C # Express / Visual Studio.  I am sure you have already installed the Microframework SDK.  Select project type <br><img src="https://habrastorage.org/getpro/habr/post_images/f96/c74/c9d/f96c74c9d7d50782cca837d2f572954a.png" alt="image"><br>  <i>MicroFramework Project</i> <br>  Now we need to change the properties so that Visual Express / Studio loads the project into our board.  Set as shown below. <br><img src="https://habrastorage.org/getpro/habr/post_images/041/362/838/0413628381c12ee8006e32e38fedf939.png" alt="image"><br>  <i>Settings</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/d3c/a90/b9c/d3ca90b9c5f8cbd55576250dcbba3d36.png" alt="image"><br>  <i>Using USB</i> <br>  Now we need to add a class so that we can blink the LEDs. <br><img src="https://habrastorage.org/getpro/habr/post_images/1a9/e91/969/1a9e91969d519b820b6f76ecf169c244.png" alt="image"><br>  <i>Add a class</i> <br><img src="https://habrastorage.org/getpro/habr/post_images/3aa/9f7/8c9/3aa9f78c9783916a19ed67fdbc813360.png" alt="image"><br>  <i>Microsoft.SPOT.Hardware</i> <br>  My test code <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.SPOT; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.SPOT.Hardware; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">STM32F_Test</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Program</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OutputPort led = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> OutputPort(Cpu.Pin.GPIO_Pin1, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-comment"><span class="hljs-comment">//PA1 on discovery board while (true) { led.Write(true); Thread.Sleep(500); led.Write(false); Thread.Sleep(500); } } } }</span></span></code> </pre> <br>  You can find out the card pin map in this file ‚ÄúC: \ MicroFrameworkPK_v4_2 \ DeviceCode \ Targets \ Native \ STM32 \ ManagedCode \ Hardware \ CPU.cs‚Äù which you will find if you installed the porting kit (not included in the list above). <br>  Original article: <a href="http://singularengineer.wordpress.com/category/electronics/">singularengineer.wordpress.com/category/electronics</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/175989/">https://habr.com/ru/post/175989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../175979/index.html">Why fantom?</a></li>
<li><a href="../175981/index.html">Intel announced the new Thunderbolt: 2 times faster speed and 4k video support</a></li>
<li><a href="../175983/index.html">Silicon Valley in Ulyanovsk</a></li>
<li><a href="../175985/index.html">Quick Start: Visual Database Design in MySQL Workbench</a></li>
<li><a href="../175987/index.html">Continuation of the video lectures of the course "Operating Systems" with Alexei Bragin in MSTU. Bauman</a></li>
<li><a href="../175991/index.html">LibreOffice in the corporate sector - from theory to practice</a></li>
<li><a href="../175993/index.html">Open government and all other state structures as platforms</a></li>
<li><a href="../175995/index.html">10 Tips for Initially Setting Up a Hyper-V Environment</a></li>
<li><a href="../175999/index.html">ASP.NET MVC. Lesson 0. Introduction</a></li>
<li><a href="../176001/index.html">ASP.NET MVC Lesson 1. Start</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>