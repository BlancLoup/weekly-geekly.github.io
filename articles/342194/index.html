<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to programmatically manage the TP-Link WiFi router using Python requests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I faced the task of implementing software control by one of the common home Wi-Fi routers TP-Link TL-WR841N, which, unfortunately, does not have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to programmatically manage the TP-Link WiFi router using Python requests</h1><div class="post__text post__text-html js-mediator-article">  Once I faced the task of implementing software control by one of the common home Wi-Fi routers TP-Link TL-WR841N, which, unfortunately, does not have a management interface via the command line (telnet, SSH).  I wanted my Telegram bot, implemented in Python based on SBC on the local home network, based on my commands to perform the following router management functions: <br><br><ul><li>  Router reboot </li><li>  Open / close NAT Port Forwarding to internal WEB services </li><li>  Opening / closing remote access to the router from the WAN (Internet) </li><li>  Identify devices registered in the router's local WiFi network </li></ul><a name="habracut"></a><br>  Of course, the user can do all this himself manually using the WEB interface, but, first, I wanted to automate these functions, secondly, sometimes I had to do it remotely, but I didn‚Äôt want to keep the access to the router unencrypted HTTP over the Internet for security reasons.  Management with the help of the ‚Äúclosed‚Äù Telegram bot seemed to me more reliable. <br><br>  To access the management of the router, I used the only available interface - the user WEB interface, the interaction with which I implemented using HTTP requests Python requests.  In order to determine which HTTP GET requests should be sent to the router, I used the well-known Wireshark traffic sniffer.  Simply put, I used Python requests to reproduce the requests I saw in Wireshark, in the required sequence. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Import, authorization and source parameters </h4><br>  So, first of all, we import the requests library into Python, on the basis of which we will implement HTTP requests. <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests</code> </pre> <br>  As the initial parameters, we specify the internal IP address of the router as an HTTP request string.  In my case, this is 192.168.0.1. <br><br><pre> <code class="python hljs">router_ip=<span class="hljs-string"><span class="hljs-string">'http://192.168.0.1'</span></span></code> </pre> <br>  For authorization, we need a token, the calculation of which is based on the username and password of the user.  The token calculation function is defined in the JS script on the router <a href="">192.168.0.1/login/encrypt.js</a> .  He looks like this. <br><br><div class="spoiler">  <b class="spoiler_title">encrypt.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">hex_md5</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> binl2hex(core_md5(str2binl(s), s.length * <span class="hljs-number"><span class="hljs-number">8</span></span>)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">core_md5</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, len</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/* append padding */</span></span> x[len &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>] |= <span class="hljs-number"><span class="hljs-number">0x80</span></span> &lt;&lt; ((len) % <span class="hljs-number"><span class="hljs-number">32</span></span>); x[(((len + <span class="hljs-number"><span class="hljs-number">64</span></span>) &gt;&gt;&gt; <span class="hljs-number"><span class="hljs-number">9</span></span>) &lt;&lt; <span class="hljs-number"><span class="hljs-number">4</span></span>) + <span class="hljs-number"><span class="hljs-number">14</span></span>] = len; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> a = <span class="hljs-number"><span class="hljs-number">1732584193</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> b = <span class="hljs-number"><span class="hljs-number">-271733879</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> c = <span class="hljs-number"><span class="hljs-number">-1732584194</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> d = <span class="hljs-number"><span class="hljs-number">271733878</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; x.length; i += <span class="hljs-number"><span class="hljs-number">16</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> olda = a; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldb = b; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldc = c; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldd = d; a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> , <span class="hljs-number"><span class="hljs-number">-680876936</span></span>); d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">-389564586</span></span>); c = md5_ff(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">606105819</span></span>); b = md5_ff(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">-1044525330</span></span>); a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> , <span class="hljs-number"><span class="hljs-number">-176418897</span></span>); d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">1200080426</span></span>); c = md5_ff(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">-1473231341</span></span>); b = md5_ff(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">7</span></span>], <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">-45705983</span></span>); a = md5_ff(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> , <span class="hljs-number"><span class="hljs-number">1770035416</span></span>); d = md5_ff(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">-1958414417</span></span>); c = md5_ff(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">-42063</span></span>); b = md5_ff(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">11</span></span>], <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">-1990404162</span></span>); a = md5_ff(a, b, c, d, x[i+<span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-number"><span class="hljs-number">7</span></span> , <span class="hljs-number"><span class="hljs-number">1804603682</span></span>); d = md5_ff(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">13</span></span>], <span class="hljs-number"><span class="hljs-number">12</span></span>, <span class="hljs-number"><span class="hljs-number">-40341101</span></span>); c = md5_ff(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-number"><span class="hljs-number">-1502002290</span></span>); b = md5_ff(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">15</span></span>], <span class="hljs-number"><span class="hljs-number">22</span></span>, <span class="hljs-number"><span class="hljs-number">1236535329</span></span>); a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-number"><span class="hljs-number">-165796510</span></span>); d = md5_gg(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-number"><span class="hljs-number">-1069501632</span></span>); c = md5_gg(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">11</span></span>], <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">643717713</span></span>); b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">-373897302</span></span>); a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-number"><span class="hljs-number">-701558691</span></span>); d = md5_gg(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-number"><span class="hljs-number">38016083</span></span>); c = md5_gg(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">15</span></span>], <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">-660478335</span></span>); b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">-405537848</span></span>); a = md5_gg(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-number"><span class="hljs-number">568446438</span></span>); d = md5_gg(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-number"><span class="hljs-number">-1019803690</span></span>); c = md5_gg(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">-187363961</span></span>); b = md5_gg(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">1163531501</span></span>); a = md5_gg(a, b, c, d, x[i+<span class="hljs-number"><span class="hljs-number">13</span></span>], <span class="hljs-number"><span class="hljs-number">5</span></span> , <span class="hljs-number"><span class="hljs-number">-1444681467</span></span>); d = md5_gg(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">9</span></span> , <span class="hljs-number"><span class="hljs-number">-51403784</span></span>); c = md5_gg(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">7</span></span>], <span class="hljs-number"><span class="hljs-number">14</span></span>, <span class="hljs-number"><span class="hljs-number">1735328473</span></span>); b = md5_gg(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">-1926607734</span></span>); a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-number"><span class="hljs-number">-378558</span></span>); d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">-2022574463</span></span>); c = md5_hh(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">11</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">1839030562</span></span>); b = md5_hh(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">-35309556</span></span>); a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-number"><span class="hljs-number">-1530992060</span></span>); d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">1272893353</span></span>); c = md5_hh(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">7</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">-155497632</span></span>); b = md5_hh(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">-1094730640</span></span>); a = md5_hh(a, b, c, d, x[i+<span class="hljs-number"><span class="hljs-number">13</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-number"><span class="hljs-number">681279174</span></span>); d = md5_hh(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">-358537222</span></span>); c = md5_hh(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">-722521979</span></span>); b = md5_hh(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">76029189</span></span>); a = md5_hh(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">4</span></span> , <span class="hljs-number"><span class="hljs-number">-640364487</span></span>); d = md5_hh(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-number"><span class="hljs-number">11</span></span>, <span class="hljs-number"><span class="hljs-number">-421815835</span></span>); c = md5_hh(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">15</span></span>], <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">530742520</span></span>); b = md5_hh(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">23</span></span>, <span class="hljs-number"><span class="hljs-number">-995338651</span></span>); a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-number"><span class="hljs-number">-198630844</span></span>); d = md5_ii(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">7</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">1126891415</span></span>); c = md5_ii(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">14</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">-1416354905</span></span>); b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">5</span></span>], <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">-57434055</span></span>); a = md5_ii(a, b, c, d, x[i+<span class="hljs-number"><span class="hljs-number">12</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-number"><span class="hljs-number">1700485571</span></span>); d = md5_ii(d, a, b, c, x[i+ <span class="hljs-number"><span class="hljs-number">3</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">-1894986606</span></span>); c = md5_ii(c, d, a, b, x[i+<span class="hljs-number"><span class="hljs-number">10</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">-1051523</span></span>); b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">-2054922799</span></span>); a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">8</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-number"><span class="hljs-number">1873313359</span></span>); d = md5_ii(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">15</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">-30611744</span></span>); c = md5_ii(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">6</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">-1560198380</span></span>); b = md5_ii(b, c, d, a, x[i+<span class="hljs-number"><span class="hljs-number">13</span></span>], <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">1309151649</span></span>); a = md5_ii(a, b, c, d, x[i+ <span class="hljs-number"><span class="hljs-number">4</span></span>], <span class="hljs-number"><span class="hljs-number">6</span></span> , <span class="hljs-number"><span class="hljs-number">-145523070</span></span>); d = md5_ii(d, a, b, c, x[i+<span class="hljs-number"><span class="hljs-number">11</span></span>], <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">-1120210379</span></span>); c = md5_ii(c, d, a, b, x[i+ <span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">718787259</span></span>); b = md5_ii(b, c, d, a, x[i+ <span class="hljs-number"><span class="hljs-number">9</span></span>], <span class="hljs-number"><span class="hljs-number">21</span></span>, <span class="hljs-number"><span class="hljs-number">-343485551</span></span>); a = safe_add(a, olda); b = safe_add(b, oldb); c = safe_add(c, oldc); d = safe_add(d, oldd); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(a, b, c, d); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5_cmn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">q, a, b, x, s, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> safe_add(bit_rol(safe_add(safe_add(a, q), safe_add(x, t)), s),b); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5_ff</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c, d, x, s, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> md5_cmn((b &amp; c) | ((~b) &amp; d), a, b, x, s, t); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5_gg</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c, d, x, s, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> md5_cmn((b &amp; d) | (c &amp; (~d)), a, b, x, s, t); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5_hh</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c, d, x, s, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> md5_cmn(b ^ c ^ d, a, b, x, s, t); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">md5_ii</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">a, b, c, d, x, s, t</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> md5_cmn(c ^ (b | (~d)), a, b, x, s, t); } <span class="hljs-comment"><span class="hljs-comment">/* * Add integers, wrapping at 2^32. This uses 16-bit operations internally * to work around bugs in some JS interpreters. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">safe_add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> lsw = (x &amp; <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>) + (y &amp; <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> msw = (x &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (y &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>) + (lsw &gt;&gt; <span class="hljs-number"><span class="hljs-number">16</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (msw &lt;&lt; <span class="hljs-number"><span class="hljs-number">16</span></span>) | (lsw &amp; <span class="hljs-number"><span class="hljs-number">0xFFFF</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bit_rol</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num, cnt</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (num &lt;&lt; cnt) | (num &gt;&gt;&gt; (<span class="hljs-number"><span class="hljs-number">32</span></span> - cnt)); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">str2binl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">str</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> bin = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> mask = (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; <span class="hljs-number"><span class="hljs-number">8</span></span>) - <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; str.length * <span class="hljs-number"><span class="hljs-number">8</span></span>; i += <span class="hljs-number"><span class="hljs-number">8</span></span>) bin[i&gt;&gt;<span class="hljs-number"><span class="hljs-number">5</span></span>] |= (str.charCodeAt(i / <span class="hljs-number"><span class="hljs-number">8</span></span>) &amp; mask) &lt;&lt; (i%<span class="hljs-number"><span class="hljs-number">32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bin; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">binl2hex</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">binarray</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hex_tab = <span class="hljs-string"><span class="hljs-string">"0123456789abcdef"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; binarray.length * <span class="hljs-number"><span class="hljs-number">4</span></span>; i++) { str += hex_tab.charAt((binarray[i&gt;&gt;<span class="hljs-number"><span class="hljs-number">2</span></span>] &gt;&gt; ((i%<span class="hljs-number"><span class="hljs-number">4</span></span>)*<span class="hljs-number"><span class="hljs-number">8</span></span>+<span class="hljs-number"><span class="hljs-number">4</span></span>)) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>) + hex_tab.charAt((binarray[i&gt;&gt;<span class="hljs-number"><span class="hljs-number">2</span></span>] &gt;&gt; ((i%<span class="hljs-number"><span class="hljs-number">4</span></span>)*<span class="hljs-number"><span class="hljs-number">8</span></span> )) &amp; <span class="hljs-number"><span class="hljs-number">0xF</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Base64Encoding</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">input</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> keyStr = <span class="hljs-string"><span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> output = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> chr1, chr2, chr3, enc1, enc2, enc3, enc4; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">//input = utf8_encode(input); while (i &lt; input.length) { chr1 = input.charCodeAt(i++); chr2 = input.charCodeAt(i++); chr3 = input.charCodeAt(i++); enc1 = chr1 &gt;&gt; 2; enc2 = ((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4); enc3 = ((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6); enc4 = chr3 &amp; 63; if (isNaN(chr2)) { enc3 = enc4 = 64; } else if (isNaN(chr3)) { enc4 = 64; } output = output + keyStr.charAt(enc1) + keyStr.charAt(enc2) + keyStr.charAt(enc3) + keyStr.charAt(enc4); } return output; } function utf8_encode (string) { string = string.replace(/\r\n/g,"\n"); var utftext = ""; for (var n = 0; n &lt; string.length; n++) { var c = string.charCodeAt(n); if (c &lt; 128) { utftext += String.fromCharCode(c); } else if((c &gt; 127) &amp;&amp; (c &lt; 2048)) { utftext += String.fromCharCode((c &gt;&gt; 6) | 192); utftext += String.fromCharCode((c &amp; 63) | 128); } else { utftext += String.fromCharCode((c &gt;&gt; 12) | 224); utftext += String.fromCharCode(((c &gt;&gt; 6) &amp; 63) | 128); utftext += String.fromCharCode((c &amp; 63) | 128); } } return utftext; }</span></span></code> </pre> <br></div></div><br>  But, I confess, I did not begin to port this function from JS to Python.  I simplified the approach and looked at the value of the parameter that my browser sends to Wireshark. <br><br><img src="https://habrastorage.org/webt/hm/ic/nw/hmicnwi5m7j4yohdr0jfv40gouu.jpeg"><br><br>  The highlighted request is an authorization request, which we will reproduce later.  Thus, I copied the cookie pair parameter in the authorization request <br><br><pre> <code class="python hljs">auth_token=<span class="hljs-string"><span class="hljs-string">'Authorization=Basic%20YWRtaW46YjAxYzZmYzYyMDgwMzA5Y2ZiMzc2ZTE4NzI3YzMwNzk%3D'</span></span></code> </pre> <br>  Perhaps this is not the most elegant, but simple approach.  In addition, we will not store the login and password from the router in plain text, which, in my opinion, is not so bad. <br><br>  Let's go to the authorization function. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> r = requests.get(router_ip+<span class="hljs-string"><span class="hljs-string">'/userRpm/LoginRpm.htm?Save=Save'</span></span>,headers={<span class="hljs-string"><span class="hljs-string">'Referer'</span></span>:router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>,<span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>: auth_token}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code==<span class="hljs-number"><span class="hljs-number">200</span></span>: x=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> x&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: session_id=r.text[r.text.index(router_ip)+len(router_ip)+<span class="hljs-number"><span class="hljs-number">1</span></span>:r.text.index(<span class="hljs-string"><span class="hljs-string">'userRpm'</span></span>)<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session_id <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Login error'</span></span> x+=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'IP unreachable'</span></span></code> </pre> <br>  I used the while loop, as the router did not always authorize my bot the first time.  Perhaps you can do without him. <br><br>  In case of successful authorization, the function returns the session_id value.  This is the session ID that the router generates during authorization.  After authorization, session_id must be present in all subsequent HTTP requests to the router. <br><br>  Next, we implement the logout output function. <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(session_id)</span></span></span><span class="hljs-function">:</span></span> r = requests.get(router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+session_id+<span class="hljs-string"><span class="hljs-string">'/userRpm/LogoutRpm.htm'</span></span>,headers={<span class="hljs-string"><span class="hljs-string">'Referer'</span></span>:router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+session_id+<span class="hljs-string"><span class="hljs-string">'/userRpm/MenuRpm.htm'</span></span>,<span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>: auth_token}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code==<span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Loging out: '</span></span>+str(r.status_code) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Unable to logout'</span></span><span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre> <br>  I logout after each operation, since the router allows only one user to connect at a time.  Therefore, if your bot is authorized and does not exit the router, then you will not be able to log in until the router closes the open session on a timeout in a few minutes.  Thus, I decided to strictly adhere to the sequence ‚Äúlogin -&gt; operation -&gt; logout‚Äù. <br><br>  By the way, it is worth considering that if someone is already authorized on the router, the bot will obviously not be able to log in until the user logs out, or the active session closes on timeout.  In short, "who first got up, that and sneakers." It is worth noting that the Python bot performs router management operations in a fraction of seconds.  Thus, your router will not be occupied by the bot for a long time. <br><br><h4>  Reboot, NAP Port Forwarding </h4><br>  Let us turn to the operations that we can perform after successful authorization. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># r = requests.get(router_ip+'/'+session+'/userRpm/SysRebootRpm.htm?Reboot=%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C',headers={'Referer':router_ip+'/'+session+'/userRpm/SysRebootRpm.htm','Cookie': auth_token}) # Port Forwarding r = requests.get(router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm?doAll=EnAll&amp;Page=1',headers={'Referer':router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm','Cookie': auth_token}) # Port Forwarding r = requests.get(router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm?doAll=DisAll&amp;Page=1',headers={'Referer':router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm','Cookie': auth_token})</span></span></code> </pre> <br>  Here I would like to emphasize that these requests activate / deactivate <u>all the</u> Port Forwarding <u>rules</u> created earlier in the corresponding section of the router management. <br><br><img src="https://habrastorage.org/webt/se/xv/sm/sexvsmntbpslhmz6hvztc3pjbqm.jpeg"><br><br>  Simply put, requests are similar to clicking the "Enable All" and "Disable All" buttons.  By analogy, you can implement and create / activate individual rules. <br><br><h4>  Remote access to the router from the WAN (Internet) </h4><br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># IP    r = requests.get(router_ip+'/'+session+'/userRpm/ManageControlRpm.htm?port=5110&amp;ip='+remote_ip+'&amp;Save=%D0%A1%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D1%8C',headers={'Referer':router_ip+'/'+session+'/userRpm/SysRebootRpm.htm','Cookie': auth_token})</span></span></code> </pre> <br>  Here, the remote_ip parameter specifies the IP address of the remote control, i.e.  the IP address from which you can remotely access the router via the Internet. <br><br><img src="https://habrastorage.org/webt/sp/kl/2l/spkl2lbxzivuku310otir883pxu.jpeg"><br><br><pre> <code class="python hljs">remote_ip=<span class="hljs-string"><span class="hljs-string">'255.255.255.255'</span></span> <span class="hljs-comment"><span class="hljs-comment">#  . remote_ip='0.0.0.0' #  .</span></span></code> </pre> <br>  If desired, you can specify a specific IP address from which you want to connect remotely to the router. <br><br><h4>  Determining the list of connected devices </h4><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#   r = requests.get(router_ip+'/'+session+'/userRpm/WlanStationRpm.htm',headers={'Referer':router_ip+'/'+session+'/userRpm/MenuRpm.htm','Cookie': auth_token}) presence=' :' if 'DC-31-54-97-51-06' in r.text: presence=presence+'\n'+'DC-31-54-97-51-06'</span></span></code> </pre> <br>  What is the need for the definition of devices registered in the home WiFi network?  Suppose I have a smartphone with WiFi and MAC address DC-31-54-97-51-06.  When I get home, my smartphone registers on my home WiFi network.  In this simple way, I can track my presence (or rather, the presence of my smartphone) on my home network (that is, at home).  This functionality allows you to automate a number of functions related to the definition of my presence.  For example, when I come home, the surveillance camera's motion detector turns off, etc.  Earlier, I used Ping to detect the presence of devices on the network using their IP addresses, but in the end I was disappointed in this method, as smartphones, as it turned out, were reluctant and do not always respond to Ping.  Additionally, I use the ARP packet sniffer implemented in Python, which allows you to track the moment of registration of the device with a specific MAC address on the WiFi network. <br><br>  So, r.text in the code above returns, among other things, a list of MAC addresses of devices registered in the router‚Äôs WiFi network.  What you will do with this list depends only on your imagination. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> hostList = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>( <span class="hljs-string"><span class="hljs-string">"94-36-44-8F-2F-ED"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">23487</span></span>, <span class="hljs-number"><span class="hljs-number">10618</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"60-46-37-C0-43-FC"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">27088</span></span>, <span class="hljs-number"><span class="hljs-number">10126</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"EF-71-44-63-51-E1"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>, <span class="hljs-number"><span class="hljs-number">364</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"77-25-9D-99-ED-33"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">1547</span></span>, <span class="hljs-number"><span class="hljs-number">1722</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> );</code> </pre> <br>  So, I can only summarize.  All code looks like this. <br><br><div class="spoiler">  <b class="spoiler_title">router.py</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> requests router_ip=<span class="hljs-string"><span class="hljs-string">'http://192.168.0.1'</span></span> auth_token=<span class="hljs-string"><span class="hljs-string">'Authorization=Basic%20YWRtaW46YjAxYzZmYzYyMDgwMzA5Y2ZiMzc2ZTE4NzI3YzMwNzk%3D'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">logout</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(session_id)</span></span></span><span class="hljs-function">:</span></span> r = requests.get(router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+session_id+<span class="hljs-string"><span class="hljs-string">'/userRpm/LogoutRpm.htm'</span></span>,headers={<span class="hljs-string"><span class="hljs-string">'Referer'</span></span>:router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+session_id+<span class="hljs-string"><span class="hljs-string">'/userRpm/MenuRpm.htm'</span></span>,<span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>: auth_token}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code==<span class="hljs-number"><span class="hljs-number">200</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Loging out: '</span></span>+str(r.status_code) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Unnable to logout'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> r = requests.get(router_ip+<span class="hljs-string"><span class="hljs-string">'/userRpm/LoginRpm.htm?Save=Save'</span></span>,headers={<span class="hljs-string"><span class="hljs-string">'Referer'</span></span>:router_ip+<span class="hljs-string"><span class="hljs-string">'/'</span></span>,<span class="hljs-string"><span class="hljs-string">'Cookie'</span></span>: auth_token}) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> r.status_code==<span class="hljs-number"><span class="hljs-number">200</span></span>: x=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> x&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: session_id=r.text[r.text.index(router_ip)+len(router_ip)+<span class="hljs-number"><span class="hljs-number">1</span></span>:r.text.index(<span class="hljs-string"><span class="hljs-string">'userRpm'</span></span>)<span class="hljs-number"><span class="hljs-number">-1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session_id <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'Login error'</span></span> x+=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'IP unreachable'</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routercontrol</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(operation,remote_ip=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'255.255.255.255'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># if login()=='IP unreachable' or login()=='Login error': return login() exit(0) else: session=login() print ('Login OK: '+session) if operation=='Enable ports': # Port Forwarding r = requests.get(router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm?doAll=EnAll&amp;Page=1',headers={'Referer':router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm','Cookie': auth_token}) status=str(r.status_code) print (logout(session)) return 'Enable all ports: '+status+' http://31.207.73.10:8082' elif operation=='Disable ports': # Port Forwarding r = requests.get(router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm?doAll=DisAll&amp;Page=1',headers={'Referer':router_ip+'/'+session+'/userRpm/VirtualServerRpm.htm','Cookie': auth_token}) status=str(r.status_code) print (logout(session)) return 'Disable all ports: '+status elif operation=='Reboot': # r = requests.get(router_ip+'/'+session+'/userRpm/SysRebootRpm.htm?Reboot=%D0%9F%D0%B5%D1%80%D0%B5%D0%B7%D0%B0%D0%B3%D1%80%D1%83%D0%B7%D0%B8%D1%82%D1%8C',headers={'Referer':router_ip+'/'+session+'/userRpm/SysRebootRpm.htm','Cookie': auth_token}) status=str(r.status_code) print (logout(session)) return 'Reboot: '+status elif operation=='Remote IP': # IP    r = requests.get(router_ip+'/'+session+'/userRpm/ManageControlRpm.htm?port=5110&amp;ip='+remote_ip+'&amp;Save=%D0%A1%D0%BE%D1%85%D1%80%D0%B0%D0%BD%D0%B8%D1%82%D1%8C',headers={'Referer':router_ip+'/'+session+'/userRpm/SysRebootRpm.htm','Cookie': auth_token}) status=str(r.status_code) print (logout(session)) return 'Remote IP '+remote_ip+': '+status elif operation=='Check presence': #   r = requests.get(router_ip+'/'+session+'/userRpm/WlanStationRpm.htm',headers={'Referer':router_ip+'/'+session+'/userRpm/MenuRpm.htm','Cookie': auth_token}) status=str(r.status_code) print (logout(session)) presence=' :' if 'DC-31-54-97-51-06' in r.text: presence=presence+'\n'+'DC-31-54-97-51-06' return presence else: return 'Wrong command'</span></span></code> </pre> <br></div></div><br>  Obviously, similarly, you can automate other functions of managing devices without a command line using access to the WEB interface.  For example, I implemented a reboot of the DLink IP camera in a similar way using HTTP Post.  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/342194/">https://habr.com/ru/post/342194/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../342184/index.html">CatalogBox - the idea of ‚Äã‚ÄãComboBox development</a></li>
<li><a href="../342186/index.html">Scarless Face or First Steps in Multicad.NET API 7 (for Nanocad 8.1)</a></li>
<li><a href="../342188/index.html">Roles, their modeling in IC</a></li>
<li><a href="../342190/index.html">Convenient solution for the gaming database based on EditorWindow</a></li>
<li><a href="../342192/index.html">Sir Markdown. Yandex lecture</a></li>
<li><a href="../342196/index.html">How we set up the CI / CD process for our SOA projects</a></li>
<li><a href="../342198/index.html">The digest of interesting materials for the mobile developer # 229 (November 6 - November 12)</a></li>
<li><a href="../342200/index.html">Ethereum renewable smart contracts</a></li>
<li><a href="../342202/index.html">Compressing the incompressible - how to reduce the distribution of a mobile application</a></li>
<li><a href="../342206/index.html">Skyrim, rendered in text</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>