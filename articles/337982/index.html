<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Methods for developing motion software flow sensors that work with Arduino</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! I want to propose the implementation of two approaches to the development of motion sensor software that works in conjunction with the Ardui...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Methods for developing motion software flow sensors that work with Arduino</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr!  I want to propose the implementation of two approaches to the development of motion sensor software that works in conjunction with the Arduino board.  Neither motion sensor [1], nor Arduino [2].  additional advertising is not needed. <br><br>  Let's compare existing programming methods in terms of simplicity and ease of use.  We suggest starting the article with an introduction to the characteristics of the selected motion sensor. <br><br>  The main sensor that will be used is the <b>PIR motion sensor [3]</b> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      PIR sensors are small, inexpensive, consume less power and are compatible with hardware platforms such as the Arduino. <br><br>  It uses a pair of pyroelectric sensors that detect infrared radiation.  It has a range of up to 6 meters, which is enough for the project. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/d1d/dc6/9c5/d1ddc69c51924b04a375fe544cf1f610.JPG"></div><br>  In addition, you will need LEDs: green and red.  Cords, resistors and layout: you need a bundle of wires and a layout to complete the connections.  You will also need two resistors for 220 ohms and one 10 kŒ©. <br><br>  The next components will be the Arduino board: the Arduino Uno board.  To connect the Arduino board with a computer, use a USB cable. <a name="habracut"></a><br><br><h3>  Software flow development </h3><br>  Before you start working with the hardware system, you need to sketch a project in the form of a block diagram.  We use the project with the cycle shown in the figure. <br><br>  The project is executed in a cycle as soon as movement is detected, and the corresponding LED actions are performed: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/de5/aed/476/de5aed476dc041349aaacad3d470a1f8.JPG"></div><br>  With a single Arduino instruction, you can turn the LED on or off. <br><br>  To perform a blink operation, it will be necessary to perform the on and off actions again with a time delay between actions so that the output of the PIR sensor can calm down. <br><br>  We will use the same thread when writing code for both programming methods. <br><br><h3>  Hardware design </h3><br>  The simplest way to design hardware for such projects is prototyping.  The tool used for this purpose is called fritzing. <br><br>  Fritzing actively supports Arduino and other popular open source hardware platforms.  The following figure shows the layout for a project developed using Fritzing.  We connect the components as shown in the picture: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/086/fe4/249/086fe424907542a991f3bfe2edb72e9e.JPG"></div><br>  <b>To complete the circuit assembly, perform the following steps:</b> <br><br><ol><li>  Connect VCC (+ 5V) and ground from the Arduino to the layout. </li><li>  Connect the anode (long wire) of the red LED to the digital output 12 of the Arduino board.  Connect the cathode (short wire) of the red LED to ground with the help of 220 Ohm resistors. </li><li>  Connect the anode (long wire) of the green LED to the digital output 13 of the Arduino board.  Connect the cathode (short wire) of the green LED to the ground using 220 ohm resistors. </li><li>  Connect the VDD of the PIR sensor to the VCC on the layout.  Use the same posting color to represent the same category of connections.  This will greatly assist in troubleshooting the circuit. </li><li>  Connect the signal (middle output) of the PIR sensor to the Arduino digital axis 7 using a 10 kŒ© load resistor. </li></ol><br>  Below is a schematic diagram of the electronics circuit that we developed earlier.  The diagram is also obtained using Fritzing: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/52a/ed5/76b/52aed576bd0d45e0908bd45962505156.JPG"></div><br>  Now the system is ready to launch the Arduino program. <br><br><h3>  Testing equipment connections </h3><br>  After completing the connection of the circuit go directly to the programming sections.  It is recommended to use to check the connection circuit and check the status of the sensor. <br><br>  We assume that the Arduino board is already equipped with a StandardFirmata sketch.  Otherwise, you need to upload a StandardFirmata sketch to the Arduino board. <br><br>  The best way to verify the implementation of the scheme is to use the Firmata testing program, which was described in a previous article.  According to the project settings, the PIR sensor issues events to the Arduino pin 7. <br><br>  In the test program, change the output type 7 to Input and wave your hand over the sensor, and you can see the status of the pin as shown in the following screenshot: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/1b4/abc/c83/1b4abcc838fe4a62a98937e3ae4d1390.JPG"></div><br>  Check the LED connections by setting pins 12 and 13 as output contacts and switching buttons to set the status of the contacts.  If the LEDs blink when the button is switched, the connections work flawlessly. <br><br><h3>  Method 1 - Use the Arduino Standalone Sketch </h3><br>  <b>To launch the project we perform:</b> <br><br><ol><li>  View Arduino IDE. </li><li>  In the menu "File" open a new album. </li><li>  Copy the following Arduino code into a sketch and save it: <br><br><div class="spoiler">  <b class="spoiler_title">Code</b> <div class="spoiler_text"><pre><code class="python hljs">int pirPin = <span class="hljs-number"><span class="hljs-number">7</span></span>; //Pin number <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> PIR sensor int redLedPin = <span class="hljs-number"><span class="hljs-number">12</span></span>; //Pin number <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Red LED int greenLedPin = <span class="hljs-number"><span class="hljs-number">13</span></span>; //Pin number <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Green LED void setup(){ Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); pinMode(pirPin, INPUT); pinMode(redLedPin, OUTPUT); pinMode(greenLedPin, OUTPUT); } void loop(){ // Function which blinks LED at specified pin number void blinkLED(int pin, String message){ digitalWrite(pin,HIGH); Serial.println(message); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); digitalWrite(pin,LOW); d int pirVal = digitalRead(pirPin); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(pirVal == LOW){ //was motion detected blinkLED(greenLedPin, <span class="hljs-string"><span class="hljs-string">"No motion detected."</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { blinkLED(redLedPin, <span class="hljs-string"><span class="hljs-string">"Motion detected."</span></span>); } } elay(<span class="hljs-number"><span class="hljs-number">2000</span></span>); }</code> </pre> <br></div></div></li><li>  Compile and upload a sketch to the Arduino board. </li></ol><br>  Like any other Arduino program, the code has two mandatory functions: setup () and loop ().  It also has a custom function blinkLED () for a specific action, which will be explained later. <br><br><h3>  Setup () function </h3><br>  In the previous code snippet, variables were assigned for output by the Arduino at the beginning of the program.  In the setup () function, we configured these variables to define as input or output pins: <br><br><pre> <code class="python hljs">pinMode(pirPin, INPUT); pinMode(redLedPin, OUTPUT); pinMode(greenLedPin, OUTPUT);</code> </pre> <br>  Here, pirPin, redLedPin, and greenLedPin are digital pins 7, 12, and 13, respectively.  In the same function, we also configured the Arduino board for a serial connection at a speed of 9600 bps: <br><br><pre> <code class="python hljs">Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>);</code> </pre> <br><h3>  Loop () function </h3><br>  In the loop () function, we repeatedly control the input signal from the pirPin digital contact for motion detection.  The output of this contact is HIGH when movement is detected, and LOW otherwise. <br><br>  This logic is implemented using a simple if-else statement.  When this condition is met, the function calls the user-defined function blinkLED () to perform the corresponding action on the LEDs.  User functions are a very important aspect of any programming language. <br><br><h3>  Work with custom Arduino functions </h3><br>  Functions are used when a code segment is re-executed to perform the same action.  The user can create a custom function to organize code or perform repetitive actions.  To successfully use a custom function, the user must call them from the required Arduino functions, such as loop (), setup (), or any other function that leads to these mandatory functions: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span>-type function_name (parameters){ <span class="hljs-comment"><span class="hljs-comment"># Action to be performed Action_1; Action_2; Return expression; }</span></span></code> </pre> <br>  The following is a custom function that was used in the project code: <br><br><pre> <code class="python hljs">void blinkLED(int pin, String message){ digitalWrite(pin,HIGH); Serial.println(message); delay(<span class="hljs-number"><span class="hljs-number">1000</span></span>); digitalWrite(pin,LOW); delay(<span class="hljs-number"><span class="hljs-number">2000</span></span>); }</code> </pre> <br>  In the project, the blinkLED () function does not reconfigure any value when it is called from the loop () function.  Therefore, the return type is void.  When calling a function, we pass the pin number and the message as parameters: <br><br><pre> <code class="python hljs">blinkLED(greenLedPin, <span class="hljs-string"><span class="hljs-string">"No motion detected."</span></span>);</code> </pre> <br>  These parameters are then used in the action taken (writing a message to the serial port and setting the status of the LED) using the blinkLED () function.  This function also introduces a delay for flashing using the delay () function. <br><br><h3>  Testing </h3><br>  The designed system was tested in the ‚ÄúHardware Testing‚Äù section using manual inputs through the Firmata testing program.  It is necessary to make sure that the project performs objective tasks autonomously and repeatedly. <br><br>  With the USB port connected to the computer, you need to open the sequential monitoring tool from the IDEArduino environment by going to the ‚ÄúTools‚Äù menu |  SerialMonitor or by pressing Ctrl + Shift + M. A message similar to the one shown should appear on the serial monitor: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/6fc/06a/7b1/6fc06a7b1eb14aedad6b8b031db58649.JPG"></div><br><br>  When writing the function blinkLED () to perform actions, we included an action for writing a string through the serial port.  Move your hand over the PIR sensor so that the PIR sensor can detect movement. <br><br>  This event should cause the system to flash with a red LED and display the line detected by the movement on the serial monitor.  If there is no movement for a while, you can see the green LED blinking until the next movement through the PIR sensor is detected. <br><br><h3>  Method 2 - Using Python and Firmata </h3><br>  You can use the editor of your choice, but make sure that files with the .py extension are saved.  Copy the following lines of code into a new file and save it as test.py: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/python a = "Python" b = "Programming" print a + " "+ b</span></span></code> </pre> <br>  To run this file, run the following command on the terminal where the test.py file is saved: <br><br><pre> <code class="python hljs">$ python test.py</code> </pre> <br>  You should be able to see the PythonProgramming text printed on the terminal.  As you can see, the file starts with #!  / Usr / bin / python, which is the default installation location for Python.  By adding this line to your Python code, you can directly execute the Python file from the terminal.  On Unix-based operating systems, you need to make the test.py executable file using the following command: <br><br><pre> <code class="python hljs">$ chmod +x test.py</code> </pre> <br>  Now, since your file is executable, you can directly run the file using the following command: <br><br><pre> <code class="python hljs">$. / test.py</code> </pre> <br>  Now create a new Python file with the following code snippet and run it.  It is necessary to change the value of the port variable in accordance with your operating system: <br><br><div class="spoiler">  <b class="spoiler_title">Spoiler header</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># pir_1.py #    import pyfirmata from time import sleep #       Blink def blinkLED(pin, message): print (message) board.digital[pin].write(1) sleep(1) board.digital[pin].write(0) sleep(1) #      pyFirmata port = 'COM3' board = pyfirmata.Arduino(port) #   ,     it = pyfirmata.util.Iterator(board) it.start() # Define pins pirPin = board.get_pin('d:7:i') print(pirPin) redPin = 12 greenPin = 13 # Check for PIR sensor input while True: # Ignore case when receiving None value from pin value = pirPin.read() while value is None: pass print(value) if value is True: # Perform Blink using custom function blinkLED(redPin, "Motion Detected") else: blinkLED(greenPin, "No motion Detected") #   board.exit()</span></span></code> </pre><br></div></div><br>  There are two main programming components in this code: the pyFirmata methods and the Python function to perform the flashing action.  The program repeatedly detects motion events and performs a blinking action. <br><br>  In this method, we implemented a while statement to keep the program in a loop until the user completes the work manually.  You can complete the code using the key combination Ctrl + C. <br><br><h3>  Working with pyFirmata methods </h3><br>  Work with the Arduino board and the Firmata protocol needs to be started by initializing the Arduino board as a variable.  The pyFirmata method, which allows the user to assign the board to a Python variable, looks like this: <br><br><pre> <code class="python hljs">board = pyfirmata.Arduino(port)</code> </pre> <br>  Once the value of the variable is assigned, you can perform various actions, such as reading a pin or sending a signal for output using this variable.  To assign a role to a contact, use the get_pin () method.  In the next line of the code, d represents the digital output, 7 is the output number, and i means that the output type is the input output: <br><br><pre> <code class="python hljs">pirPin = board.get_pin(<span class="hljs-string"><span class="hljs-string">'d:7:i'</span></span>)</code> </pre> <br>  Once pin and its role are assigned to a variable, this variable can be used to read or write values ‚Äã‚Äãon the output: <br><br><pre> <code class="python hljs">Value = pirPin.read ()</code> </pre> <br>  You can directly write data to a specific output, as described in the following code: <br><br><pre> <code class="python hljs">board.digital[pin].write(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br>  Here, the write (1) method sends a HIGH signal to the output. <br><br><h3>  Work with Python functions </h3><br>  The Python function begins with the def keyword, followed by the function name and input parameters or arguments.  The function definition ends with a colon (:) and then indents.  The return statement completes the function.  It also passes this expression to the place where the function is called. <br><br>  If the return statement is saved without an expression, it is considered that it passed the return value to None: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">function_name</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(parameters)</span></span></span><span class="hljs-function">:</span></span> action_1 action_2 <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [expression]</code> </pre> <br>  The previous structure can be used to create custom functions for performing repetitive tasks.  In our project, we have the function blinkLED (pin, message) to execute the flashing LED.  This function sends a 1 (HIGH) and 0 (LOW) value to the specified digital contact, and also prints a message on the terminal.  It also introduces a delay to simulate a blinking action: <br><br><pre> <code class="python hljs">defblinkLED(pin, message): <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> message board.digital[pin].write(<span class="hljs-number"><span class="hljs-number">1</span></span>) sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) board.digital[pin].write(<span class="hljs-number"><span class="hljs-number">0</span></span>) sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>)</code> </pre> <br><h3>  Testing </h3><br>  After running the Python code on the terminal, you can begin testing.  If everything goes according to the project, you should be able to see the following output in the terminal: <br><br><img src="https://habrastorage.org/web/d37/6b6/2b6/d376b62b69c24ee0abb03a28ee549454.JPG"><br><br>  You should be able to see the motion detection line on the terminal when any movement is detected by the PIR sensor.  The advantage of using Python is that minor changes, such as changing the blinking speed or replacing LED roles, can be accomplished by simply changing the Python code without using an Arduino or an electrical circuit. <br><br><h3>  findings </h3><br>  A comparative analysis of the results of the practical implementation of the project by the two programming methods that we used in this work shows that the method that uses only the Arduino sketch represents the traditional programming paradigm of the microcontroller.  Although this method is simpler to implement, it lacks the extensiveness achieved by the Python-Arduino interface.  Thus, for practical use, we make a choice in favor of the Python-Arduino method. <br><br><h3>  Links </h3><br><ol><li>  <a href="http://1.%09">What is the motion sensor for lighting?</a> </li><li>  <a href="https://yadi.sk/i/v8APE4HakdTVT">Book: "Arduino Basic Connections".</a> </li><li>  <a href="http://3.%09">PIR Motion Sensor.</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/337982/">https://habr.com/ru/post/337982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../337970/index.html">People's Privacy Policy</a></li>
<li><a href="../337972/index.html">On the factor of the case when playing "Monopoly"</a></li>
<li><a href="../337974/index.html">Overview of one Russian RTOS, part 5. First application</a></li>
<li><a href="../337976/index.html">RTP Bleed: Dangerous vulnerability to intercept VoIP traffic</a></li>
<li><a href="../337978/index.html">Telegram bot for Mikrotik with Webhook and JSON parser</a></li>
<li><a href="../337984/index.html">About smart contracts in simple words</a></li>
<li><a href="../337986/index.html">Prototyping in the Python-Arduino environment</a></li>
<li><a href="../337990/index.html">Android web applications without Cordova, Phonegap and SMS</a></li>
<li><a href="../337992/index.html">Journey from Node to Crystal</a></li>
<li><a href="../337994/index.html">Approach to the separation of schemes (users) in the design of OLTP databases</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>