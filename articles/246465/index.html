<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Integration Testing in Java EE, Adam Bean</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Pragmatic integration testing can improve your productivity and ensure the deployment of a JavaEE application. 

 Adam Bean (Germany) is a consultant,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Integration Testing in Java EE, Adam Bean</h1><div class="post__text post__text-html js-mediator-article">  <i><b>Pragmatic integration testing can improve your productivity and ensure the deployment of a JavaEE application.</b></i> <br><br>  <b>Adam Bean (Germany)</b> is a consultant, trainer, architect, member of the Java EE 6 and 7 expert group, EJB 3.X, JAX-RS, and JPA 2.X JSRs.  Java Champion, Top Java Ambassador 2012 and JavaOne Rock Star 2009, 2011, 2012 and 2013.  Author of the books ‚ÄúReal World Java EE Patterns ‚Äì Rethinking Best Practices‚Äù and ‚ÄúReal World Java EE Night Hacks ‚Äì Dissecting the Business Tier‚Äù. <br><br>  We invite you to familiarize yourself with the translation of Adam's article " <a href="http://www.oracle.com/technetwork/articles/java/integrationtesting-487452.html)">Integration Testing for Java EE</a> " <br><a name="habracut"></a>  . <br><h1>  Introduction </h1><br>  In a previous article, <a href="http://www.oracle.com/technetwork/articles/java/unittesting-455385.html">Unit Testing for Java EE</a> , I reviewed the unit testing approaches for Java applications and applications written using Java EE 6 by simulating all external dependencies using the Mokito library.  Unit tests are important for validating business logic, but do not guarantee the deployment of your Java EE 6 application. <br>  Note: On Java.Net, you will find the Maven 3 project for this article (TestingEJBAndCDI), which was tested using NetBeans 7 and GlassFish v3.x. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Note: On Java.Net, you will find the Maven 3 project for this article ( <a href="https://kenai.com/projects/javaee-patterns/sources/hg/show/TestingEJBAndCDI%3Frev%3D227">TestingEJBAndCDI</a> ), which was tested using NetBeans 7 and GlassFish v3.x. <br><br><h1>  Using different approaches in testing </h1><br>  Unit tests - fast and "fine-grained".  Integration tests are slow and coarse-grained.  Instead of using arbitrary division of modular and integration tests into fast and slow, respectively, we‚Äôll take their specifics into account to improve performance.  Fine grain tests should be performed quickly.  Typically, tests are written for small parts of the functional, before they are integrated into a larger subsystem.  Unit tests are incredibly fast - hundreds of tests can be run in milliseconds.  Using unit tests, it is possible to perform fast iterations and not wait for the integration tests to be completed. <br>  Integration tests are performed after successfully passing unit tests.  Unit tests often do not work, so integration tests are run less frequently.  Due to strict division into modular and integration tests, it is possible to save a few minutes (or even hours) on each test cycle. <br><br><h1>  Performance Testing </h1><br>  Pragmatic integration testing will really increase your productivity.  Another thing is testing mappings and Java Persistence API (JPA) requests.  Downloading the entire application to the server only to check the correctness of the syntax of mappings and requests takes too much time. <br>  JPA can be used directly from the unit test.  Then the cost of restarting will be insignificant.  To do this, you just need to get an instance of EntityManager from the EntityManagerFactory.  For example, to test the mapping of the Prediction class, the EntityManager is embedded in the PredictionAudit class (see Example 1). <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PredictionAuditIT</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PredictionAudit cut; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EntityTransaction transaction; <span class="hljs-meta"><span class="hljs-meta">@Before</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">initializeDependencies</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ cut = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PredictionAudit(); cut.em = Persistence.createEntityManagerFactory(<span class="hljs-string"><span class="hljs-string">"integration"</span></span>). createEntityManager(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.transaction = cut.em.getTransaction(); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savingSuccessfulPrediction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Result expectedResult = Result.BRIGHT; Prediction expected = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Prediction(expectedResult, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); transaction.begin(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cut.onSuccessfulPrediction(expectedResult); transaction.commit(); List&lt;Prediction&gt; allPredictions = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cut.allPredictions(); assertNotNull(allPredictions); assertThat(allPredictions.size(),is(<span class="hljs-number"><span class="hljs-number">1</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">savingRolledBackPrediction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Result expectedResult = Result.BRIGHT; Prediction expected = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Prediction(expectedResult, <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.cut.onFailedPrediction(expectedResult); } }</code> </pre> <br>  <i>Example 1. Embedding EntityManager in the PredictionAudit class</i> <br><br>  As in Example 1 the EntityManager works outside the container, transactions can only be managed by unit tests.  Declarative transactions are not available in this case.  This makes testing even easier, since the transaction boundary can be explicitly set inside the test method.  You can easily clear the EntityManager cache by calling the EntityTransaction # commit () method.  Immediately after clearing the cache, data becomes available in the database and can be checked during the testing process (see the savingSuccessfulPrediction () method in Example 1). <br><br><h1>  Standalone JPA configurations </h1><br><br>  EntityManager is part of the JPA specification, and was also included in glassfish-embedded-all-dependency.  The same dependency is performed in EclipseLink.  You only need an external database to store data.  Derby database does not require installation, it can run in server mode or in embedded database mode (embedded) and can store data in in-memory or on disk. <br><br><pre> <code class="java hljs">dependency&gt; &lt;groupId&gt;org.apache.derby&lt;/groupId&gt; &lt;artifactId&gt;derbyclient&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">10.7</span></span>.1.1&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> </pre><br>  <i>Example 2. ‚ÄúInstalling‚Äù the Derby database</i> <br><br>  Derby is supported by the standard Maven repository and can be added to the project as a single dependency (see example 2).  In this case, the dependency is defined for the test scope, since the JDBC driver is only needed during testing and should not be deployed or installed on the server. <br>  When conducting unit testing without a container, it is impossible to use <i>Java Transaction</i> (JTA) functionality and <i>javax.sql.DataSource</i> . <br><br><pre> <code class="java hljs">&lt;persistence version=‚Äú<span class="hljs-number"><span class="hljs-number">1.0</span></span>‚Äù xmlns=<span class="hljs-string"><span class="hljs-string">"#"</span></span> xmlns:xsi=<span class="hljs-string"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span> xsi:schemaLocation=<span class="hljs-string"><span class="hljs-string">"# "</span></span>&gt; &lt;persistence-unit name=<span class="hljs-string"><span class="hljs-string">"integration"</span></span> transaction-type=<span class="hljs-string"><span class="hljs-string">"RESOURCE_LOCAL"</span></span>&gt; &lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abien</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">oracle</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">entity</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Prediction</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exclude</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unlisted</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">classes</span></span></span><span class="hljs-class">&gt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">true</span></span></span><span class="hljs-class">&lt;/</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">exclude</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">unlisted</span></span></span><span class="hljs-class">-</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">classes</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">properties</span></span></span><span class="hljs-class">&gt; &lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">name</span></span></span></span>=<span class="hljs-string"><span class="hljs-string">"javax.persistence.jdbc.url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"jdbc:derby:memory:testDB;create=true"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"javax.persistence.jdbc.driver"</span></span> value=<span class="hljs-string"><span class="hljs-string">"org.apache.derby.jdbc.EmbeddedDriver"</span></span>/&gt; &lt;property name=<span class="hljs-string"><span class="hljs-string">"eclipselink.ddl-generation"</span></span> value=<span class="hljs-string"><span class="hljs-string">"create-tables"</span></span>/&gt; &lt;/properties&gt; &lt;/persistence-unit&gt; &lt;/persistence&gt;</code> </pre><br>  <i>Example 3. A persistence file configured for unit testing.</i> <br><br>  An additional persistence.xml file is created in the <i>src / test / java / META-INF</i> package and is used exclusively for testing.  Since there is no deployment process, all entities have to be explicitly described.  Also, the transaction type is set to RESOURCE_LOCAL, which allows you to process transactions manually.  Instead of declaring a data source, EntityManager accesses the database directly through a configured JDBC driver.  Derby database in embedded mode is best suited for unit testing.  EmbeddedDriver supports two URL configuration options: storing data in a file or in memory.  For testing JPA-mapping and queries, the in-memory connection string is used (in-memory, see example 3).  All tables are created on the fly in RAM before the next test and are deleted after the test.  Since there is no need to delete your data after testing, this is the most convenient way to smoke test JPA. <br><br>  More complex JPA tests require a specific set of test data, and using the in-memory configuration for such cases is inconvenient.  Derby database instead of RAM can use files to store and load data.  To do this, just change the connection string: <br><br><pre> <code class="java hljs"> &lt;property name=<span class="hljs-string"><span class="hljs-string">"javax.persistence.jdbc.url"</span></span> value=<span class="hljs-string"><span class="hljs-string">"jdbc:derby:./sample;create=true‚Äù/&gt;</span></span></code> </pre><br><br>  In particular, tests that require a predefined dataset can be easily implemented using a database configuration with state recording to a file.  The completed database will have to be copied to the project folder before the test is executed, and it must be deleted after testing.  Thus, the database will be deleted after each launch.  No need to worry about cleaning or any modifications. <br><br><h1>  The unit test is not an integration test. </h1><br><br>  You've probably already noticed a strange IT suffix in the name of the <i>PredictionAuditIT</i> class.  The suffix is ‚Äã‚Äãused to distinguish unit tests from integration tests.  The standard failsafe Maven framework executes all tests ending in IT or ITCase, or starting with IT, but these classes are ignored by Maven with the Surefire plugin and JUnit tests.  You just need to add the following dependency to separate the unit and integration tests: <br><pre> <code class="java hljs"> &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.7</span></span>.1&lt;/version&gt; &lt;/plugin&gt;</code> </pre><br>  <i>Example 4. FailSafe plugin configuration</i> <br><br>  Unit tests are performed during the standard mvn clean install, and can also be explicitly started using the mvn surefire: test command.  Integration tests can also be added to the Maven phases using the execution tag: <br><pre> <code class="java hljs">&lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-failsafe-plugin&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">2.7</span></span>.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;integration-test&lt;/id&gt; &lt;phase&gt;integration-test&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;integration-test&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;execution&gt; &lt;id&gt;verify&lt;/id&gt; &lt;phase&gt;verify&lt;/phase&gt; &lt;goals&gt; &lt;goal&gt;verify&lt;/goal&gt; &lt;/goals&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;/plugin&gt;</code> </pre><br>  <i>Example 5. Registering the Failsafe plugin</i> <br><br>  When using the <i>execution</i> tag, the <i>Failsafe</i> plugin starts automatically with the <i>mvn</i> <i>install</i> , <i>mvn verify,</i> or <i>mvn integration-test</i> commands.  First, unit tests are performed, and then integration tests. <br>  Strict division into integration and unit tests significantly speeds up the testing cycle.  Thus, unit tests test the functionality of a method in a simulated environment, and they are several orders of magnitude faster than integration tests.  Instant result is obtained after the execution of unit tests. <br>  Only the successful completion of all unit tests starts the initially slower integration tests.  It is also possible to configure Continuous Integration separately for unit testing and integration testing.  The <i>mvn clean install</i> command launches the <i>mvn integration-tests</i> command.  Separating processes gives you more flexibility;  You can restart the tasks separately and receive notifications about the progress of each task. <br><br><h1>  Killer use case for embedded integration tests </h1><br>  Most integration tests can be performed without running the container.  JPA functionality can be tested using an <i>EntityManager</i> created locally.  Business logic can also be conveniently and efficiently tested outside the container.  For it is necessary to create mock-objects for all dependent classes, services and everything else. <br>  Let's assume that we need to output two error messages and keep them in one place for the convenience of support.  Instances of the String class can be embedded and used for configuration (see Example 6). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> String javaIsDeadError; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> String noConsultantError; <span class="hljs-comment"><span class="hljs-comment">//‚Ä¶ if(JAVA_IS_DEAD.equals(prediction)){ throw new IllegalStateException(this.javaIsDeadError); } //‚Ä¶ if(company.isUnsatisfied()){ throw new IllegalStateException(this.noConsultantError);</span></span></code> </pre><br>  <i>Example 6. Throwing exceptions using embedded strings</i> <br><br>  The <i>MessageProvider</i> class supports configuration and returns a string using property values ‚Äã‚Äã(see Example 7). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String NO_CONSULTANT_ERROR = <span class="hljs-string"><span class="hljs-string">"No consultant to ask!"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String JAVA_IS_DEAD_MESSAGE = <span class="hljs-string"><span class="hljs-string">"Please perform a sanity / reality check"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Map&lt;String,String&gt; defaults; <span class="hljs-meta"><span class="hljs-meta">@PostConstruct</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">populateDefaults</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.defaults = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, String&gt;(){{ put(<span class="hljs-string"><span class="hljs-string">"javaIsDeadError"</span></span>, JAVA_IS_DEAD_MESSAGE); put(<span class="hljs-string"><span class="hljs-string">"noConsultantError"</span></span>, NO_CONSULTANT_ERROR); }}; } <span class="hljs-meta"><span class="hljs-meta">@Produces</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InjectionPoint ip)</span></span></span></span>{ String key = ip.getMember().getName(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> defaults.get(key); } }</code> </pre><br>  <i>Example 7. General configurator</i> <br><br>  If you look at the <i>MessageProvider</i> class (example 7), you can see that there is nothing left to be tested.  Is it possible to create a mock object for the <i>InjectionPoint</i> parameter of the <i>Map defaults</i> field to test the search.  The only untested part after <i>dependency injection</i> remains <i>dependency injection</i> itself and using them in the <i>getString ()</i> method.  Obtaining the field name, the search and the implementation itself can be fully tested only inside the container.  The implementation target is the <i>OracleResource</i> class, which uses embedded values ‚Äã‚Äãto create exceptions.  (See the article " <a href="http://www.oracle.com/technetwork/articles/java/unittesting-455385.html">Unit Testing for Java EE</a> .") In order to test this mechanism, you will have to either display the embedded values, or extract the message from the exceptions.  With this approach, it will not be possible to test "critical moments", for example, unconfigured fields.  An auxiliary class created solely for testing purposes will give more flexibility and greatly simplify testing. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configurable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String shouldNotExist; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String javaIsDeadError; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getShouldNotExist</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> shouldNotExist; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getJavaIsDeadError</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> javaIsDeadError; } }</code> </pre><br>  <i>Example 8. Auxiliary class for integration testing</i> <br><br>  The <i>Configurable</i> class (see Example 8) is located in the <i>src / test / java</i> folder and was specifically designed to simplify integration testing for the <i>MessageProvider</i> class.  It is assumed that the <i>javaIsDeadError</i> field will be embedded, and the <i>shouldNotExist</i> field <i>will</i> not need to be configured, and during testing it will be <i>null</i> . <br><br><h1>  "Aliens" can help you </h1><br><br>  Arquillian is an interesting creature of unearthly origin (see the film ‚ÄúMen in Black‚Äù), but at the same time it is also an open source framework integrated into the TestRunner class of the JUnit framework.  With it, you have the opportunity of complete control over which classes are deployed and implemented.  Arquillian performs JUnit tests and has full access to the contents of the <i>src / test / java</i> folder.  Special classes for testing, such as <i>Configurable</i> (see Example 8), can be used to simplify testing, while the tests will not fall into the folder with the main application code src / main / java, and there is no need to include them in the delivery. <br><br>  Arquillian consists of two parts: the control part and the container.  The control part of <i>arquillian-junit</i> performs tests and implements the dependency injection mechanism inside the test case. <br><br><pre> <code class="java hljs">&lt;dependency&gt; &lt;groupId&gt;org.jboss.arquillian&lt;/groupId&gt; &lt;artifactId&gt;arquillian-junit&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">1.0</span></span>.0.Alpha5&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.jboss.arquillian.container&lt;/groupId&gt; &lt;artifactId&gt;arquillian-glassfish-embedded-<span class="hljs-number"><span class="hljs-number">3.1</span></span>&lt;/artifactId&gt; &lt;version&gt;<span class="hljs-number"><span class="hljs-number">1.0</span></span>.0.Alpha5&lt;/version&gt; &lt;scope&gt;test&lt;/scope&gt; &lt;/dependency&gt;</code> </pre><br>  <i>Example 9. Arquillian configuration for Maven 3</i> <br><br>  The dependency <i>arquillian-glassfish-embedded-3.1</i> integrates with the application server.  You can use both version 3.1 and 3.0. <br><br>  Instead of <i>glassfish,</i> you can use the <i>JBoss</i> embedded server using the <i>arquillian-jbossas-embedded-6</i> artifact, or Tomcat and Weld servers. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jboss.shrinkwrap.api.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.inject.Inject; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jboss.arquillian.junit.Arquillian; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.junit.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.junit.Assert.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> org.hamcrest.CoreMatchers.*; <span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(Arquillian.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MessageProviderIT</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> MessageProvider messageProvider; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> Configurable configurable; <span class="hljs-meta"><span class="hljs-meta">@Deployment</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> JavaArchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createArchiveAndDeploy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShrinkWrap.create(JavaArchive.class, <span class="hljs-string"><span class="hljs-string">"configuration.jar"</span></span>). addClasses(MessageProvider.class, Configurable.class). addAsManifestResource( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayAsset(<span class="hljs-string"><span class="hljs-string">"&lt;beans/&gt;"</span></span>.getBytes()), ArchivePaths.create(<span class="hljs-string"><span class="hljs-string">"beans.xml"</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">injectionWithExistingConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String expected = MessageProvider.JAVA_IS_DEAD_MESSAGE; String actual = configurable.getJavaIsDeadError(); assertNotNull(actual); assertThat(actual,is(expected)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">injectionWithMissingConfiguration</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ String shouldNotExist = configurable.getShouldNotExist(); assertNull(shouldNotExist); }</code> </pre><br>  <i>Example 10. Integration tests using Arquillian</i> <br><br>  After configuring dependencies, Arquillian can be used as a test management system.  Unit tests are performed transparently in Arquillian.  Maven, Ant or even your IDE will simply use Arquillian instead of the native test execution system.  Although this redirection is transparent, it allows Arquillian to deploy deployed Contexts and Dependency Injection (CDI) or Enterprise JavaBeans (EJB) components, or other Java EE resources directly into your tests.  Arquillian is just a thin layer above the application server implementation.  It silently loads GlassFish, JBoss or Tomcat and runs tests on a native embedded application server.  For example, it can use Embedded GlassFish. <br><br>  To start using Arquillian, we need to close the JAR archive.  In the <i>createArchiveAndDeploy</i> method (see Example 10), a JAR is created and deployed with the <i>MessageProvider</i> and <i>Configurable</i> classes and with an empty beans.xml file.  Deployed classes can be directly embedded in the unit test itself, which greatly simplifies testing.  The <i>injectionWithExistingConfiguration</i> method refers to the <i>Configurable</i> class, which returns the <i>javaIsDeadError</i> and <i>shouldNotExist values</i> (see Example 8).  You can test the code as if it were running inside an application server.  On the one hand, this is only an illusion, on the other hand, no, because the tests actually launch the container. <br><br><h1>  Testing the impossible </h1><br><br>  It is difficult to predict what will happen if the dependence of <i>Instance Consultant&gt;</i> company is not satisfied.  This cannot happen in actual operation, since at this time there are always enough implementations of the <i>Consultant</i> class.  This situation makes testing impossible in an integration environment.  But Arquillian makes it easy to test unsatisfied and undefined dependencies by controlling the deployment module. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(Arquillian.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OracleResourceIT</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> OracleResource cut; <span class="hljs-meta"><span class="hljs-meta">@Deployment</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> JavaArchive </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createArchiveAndDeploy</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ShrinkWrap.create(JavaArchive.class, <span class="hljs-string"><span class="hljs-string">"oracle.jar"</span></span>). addClasses(OracleResource.class,MessageProvider.class, Consultant.class). addAsManifestResource( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ByteArrayAsset(<span class="hljs-string"><span class="hljs-string">"&lt;beans/&gt;"</span></span>.getBytes()), ArchivePaths.create(<span class="hljs-string"><span class="hljs-string">"beans.xml"</span></span>)); } <span class="hljs-meta"><span class="hljs-meta">@Test</span></span>(expected=IllegalStateException.class) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predictFutureWithoutConsultants</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { cut.predictFutureOfJava(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (EJBException e) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> e.getCausedByException(); } } }</code> </pre><br>  <i>Example 11. Testing the impossible</i> <br><br>  Only the most needed <i>OracleResource</i> , <i>MessageProvider,</i> and <i>Consultant</i> classes are placed in the <i>oracle.jar</i> archive using <i>createArchiveAndDeploy</i> from Example 11. Although the <i>OracleResource</i> class also uses <i>Event</i> to send a Result (see Example 12), we ignore the <i>PredictionAudit</i> event and do not deploy it. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Path</span></span>(<span class="hljs-string"><span class="hljs-string">"javafuture"</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Stateless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OracleResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> Instance&lt;Consultant&gt; company; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> Event&lt;Result&gt; eventListener; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String javaIsDeadError; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String noConsultantError; <span class="hljs-comment"><span class="hljs-comment">// -  }</span></span></code> </pre><br>  <i>Example 12. Required dependencies of the OracleResource class.</i> <br><br>  We assume that the event <i>Event</i> will be swallowed.  The <i>predictFutureWithoutConsultants</i> method calls the <i>OracleResource # predictFutureOfJava method</i> and waits for an <i>IllegalStateException thrown</i> after checking the condition in <i>checkConsultantAvailability</i> (see Example 13). <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">predictFutureOfJava</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ checkConsultantAvailability(); Consultant consultant = getConsultant(); Result prediction = consultant.predictFutureOfJava(); eventListener.fire(prediction); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(JAVA_IS_DEAD.equals(prediction)){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.javaIsDeadError); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> prediction.name(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">checkConsultantAvailability</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(company.isUnsatisfied()){ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.noConsultantError); } }</code> </pre><br>  <i>Example 13. OracleResource precondition check</i> <br><br>  Note that a <i>javax.ejb.EJBException is thrown</i> instead of the expected <i>IllegalStateException</i> (see Example 14). <br><br>  WARNING: A system exception occurred during a call on the EJB side. <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OracleResource</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">public</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lang</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">String</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abien</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">oracle</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boundary</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OracleResource</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">predictFutureOfJava</span></span></span><span class="hljs-class">() </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">javax</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ejb</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EJBException</span></span></span><span class="hljs-class"> //    </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">stacktrace</span></span></span><span class="hljs-class">‚Ä¶ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> $</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Proxy126</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">predictFutureOfJava</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unknown</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Source</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">abien</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">testing</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">oracle</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">boundary</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">__EJB31_Generated__OracleResource__</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">__Intf____Bean__</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">predictFutureOfJava</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Unknown</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Source</span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  <i>Example 14. Implementing the Stack Trace class using an EJB Proxy.</i> <br><br>  The unit test accesses a real EJB 3.1 component through a <i>public</i> interface.  <i>IllegalStateException</i> is an unchecked exception that causes the current transaction to be <i>rolled</i> back, and its action is wrapped in a <i>javax.ejb.EJBException</i> exception.  You have to get an <i>IllegalStateException</i> exception from an <i>EJBException</i> and re-throw it. <br><br><h1>  Rollback testing </h1><br><br>  Behavior in the event of a rollback of a transaction can be easily tested by introducing an auxiliary class: <i>TransactionRollbackValidator</i> .  This is a regular EJB 3.1 component with access to <i>SessionContext</i> . <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Stateless</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TransactionRollbackValidator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Resource</span></span> SessionContext sc; <span class="hljs-meta"><span class="hljs-meta">@EJB</span></span> OracleResource os; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isRollback</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { os.predictFutureOfJava(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { <span class="hljs-comment"><span class="hljs-comment">//swallow all exceptions intentionally //    } return sc.getRollbackOnly(); } }</span></span></code> </pre><br>  <i>Example 15. EJB 3.1 components for testing</i> <br><br>  The <i>TransactionRollbackValidator</i> test class calls the <i>OracleResource</i> class, handles all exceptions and returns the current rollback status of the transaction.  You only have to slightly expand the deployment and testing section of the <i>OracleResourceIT</i> class to verify the success of a transaction rollback (see Example 16). <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@RunWith</span></span>(Arquillian.class) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OracleResourceIT</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    @Inject TransactionRollbackValidator validator; @Deployment public static JavaArchive createArchiveAndDeploy() { return ShrinkWrap.create(JavaArchive.class, "oracle.jar"). addClasses(TransactionRollbackValidator.class, OracleResource.class,MessageProvider.class, Consultant.class). addAsManifestResource( new ByteArrayAsset("&lt;beans/&gt;".getBytes()), ArchivePaths.create("beans.xml")); } @Test public void rollbackWithoutConsultants(){ assertTrue(validator.isRollback()); } // ,    ,  }</span></span></code> </pre><br>  <i>Example 16. We test transaction rollback</i> <br><br>  <i>TransactionRollbackValidator</i> is a component of EJB 3.1, so it is deployed by default using the transaction attribute <i>Required</i> .  According to the EJB specification, the <i>TransactionRollbackValidator # isRollback method is</i> always executed as part of a transaction.  Either a new transaction is started, or an existing one is reused.  In our test case, <i>TransactionRollbackValidator</i> invokes a new transaction class <i>OracleResource</i> .  The newly launched transaction extends to the <i>OracleResource</i> class, which throws an <i>EJBException</i> due to the lack of consultants.  The <i>TransactionRollbackValidator</i> class simply returns the result of calling the <i>SessionContext # getRollbackOnly method</i> . <br><br>  Such a test would be impossible without modifying the source code or introducing additional auxiliary classes into the <i>src / main / java</i> folder.  Such frameworks as Arquillian provide a unique opportunity to easily test the infrastructure without littering the source code with the code for testing. <br><br><h1>  ... and continuous deployment? </h1><br><br>  Testing the code outside and inside the container guarantees the correct behavior of your application only under well-defined working conditions.  Even a slight server configuration change or a forgotten resource will break the deployment.  All modern application servers are configured either through scripts or through a stripped-down API.  Running the server from the configuration in your source code not only minimizes possible errors, but also makes manual intervention unnecessary.  You can even deploy the application to industrial servers whenever you change the code in the repository.  Comprehensive integration and modular tests are the first prerequisite for "continuous deployment." <br><br><h1>  Abuse harms performance </h1><br><br>  Testing all the functionality inside the embedded container is convenient but unproductive.  Java EE 6 components are annotated Plain Old Java Objects (POJOs) and can be easily tested and mocked using Java SE tools such as JUnit, TestNG or Mockito.  Using the built-in container to check the business logic is not only unproductive, but also conceptually wrong.  Unit tests should check only the business logic, not the behavior of the container.  In addition, most integration tests can be easily launched using a local EntityManager (see Example 1) or by imitating container infrastructure.  For only a small part of integration tests, you should use embedded containers or test frameworks, such as Arquillian.     ‚Äì       ,      .      -,   ,             . <br><br> <b>17  19    JavaOne Rock Star   <a href="http://www.luxoft-training.ru/master-class/adam_bien/%3Fsphrase_id%3D773005%26utm_source%3Dhabrahabr%26utm_medium%3Dnews%26utm_campaign%3Dbien_2">¬´, ,        Java EE 7¬ª</a></b> </div><p>Source: <a href="https://habr.com/ru/post/246465/">https://habr.com/ru/post/246465/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246451/index.html">Sensomotor coordination (SMK). Professional research / pilot training</a></li>
<li><a href="../246455/index.html">R reference manual</a></li>
<li><a href="../246459/index.html">Interval repetition of foreign words: Anki, LinguaLeo, Memrise</a></li>
<li><a href="../246461/index.html">I am a certified PHP specialist</a></li>
<li><a href="../246463/index.html">We write the most effective test case</a></li>
<li><a href="../246467/index.html">A simple solution for using EDS</a></li>
<li><a href="../246469/index.html">Yet another AOP in .NET</a></li>
<li><a href="../246471/index.html">My personal Sony Hack</a></li>
<li><a href="../246473/index.html">Club of anonymous Santa Clauses in Habr√© 2014-2015</a></li>
<li><a href="../246477/index.html">Yii 1.1.16</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>