<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Insert the code generator into the qmake assembly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Laziness is the engine of progress. Working in programming for the second decade, I still agree with this thesis. But in every joke, as you know, ther...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Insert the code generator into the qmake assembly</h1><div class="post__text post__text-html js-mediator-article">  Laziness is the engine of progress.  Working in programming for the second decade, I still agree with this thesis.  But in every joke, as you know, there is a bit of joke. <br>  This article will discuss how to make a computer write routine code for you.  And as much as possible to automate this process and integrate with the project assembly.  Qmake will help us in all this <br><br><h5>  Why do you need it </h5><br>  In my current project, it became necessary to apply an object-based approach when working with data physically stored in a relational database.  So ORM.  It just so happened that this corporate segment project is being developed on Qt.  Yes, even though this is the most beautiful framework, it is not quite suitable for programming complex corporate applications.  Nevertheless, the choice in favor of Qt was made for a number of very compelling reasons. <br>  So, there is a small relational database of about 100 tables.  It is necessary to write a thin layer of business logic, which in the future will become overgrown with fat.  There is a description of the structure of the database in XML. <br>  You can roll up your sleeves and write 100 business logic classes of the same type in a week.  Write numerous tests comparing these classes, an XML description of the metadata and the database structure itself.  But, this is not the approach of a real Jedi!  Indeed, because we already have everything necessary to describe the prototypes of business logic classes, we just need to turn .xml into .h. <a name="habracut"></a><br><br><h5>  Code generator </h5><br>  To begin with, let's deal with XML.  The description of the tables looks like this: <br><pre><code class="hljs pgsql">&lt;<span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-type"><span class="hljs-type">name</span></span>="TestTable" &gt; &lt;field <span class="hljs-type"><span class="hljs-type">name</span></span>="id" <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="INTEGER" /&gt; &lt;field <span class="hljs-type"><span class="hljs-type">name</span></span>="name" <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>="VARCHAR(100)" /&gt; &lt;/<span class="hljs-keyword"><span class="hljs-keyword">table</span></span>&gt;</code> </pre> <br>  Of course, using the same QDomDocument you can quite quickly write your own preprocessor generator, but it would be more correct to use XSL.  For XSLT transformations, it is convenient to use some kind of console processor.  I used <b>xsltproc</b> .  This simple utility takes as input XML, XSL and prints the resulting text to where it will be said.  You can use another tool, you can write yourself, it does not matter.  Using a simple template we get <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">TestTable</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">id</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; <span class="hljs-function"><span class="hljs-function">QString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">name</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>; };</code> </pre><br>  Yes, while this is a thin-thin skeleton, which should be fat, even at the stage of automatic generation, but these details will be omitted.  We are still important principle itself. <br>  So, we already know how to automatically generate code in any quantities, it remains to automate this process. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Automation </h5><br>  I work in QtCreator and I want to include my XML files with a description of the data structure directly in the project.  For files that are not involved in the standard build process, there is a ‚ÄúOther Files‚Äù project section.  In the .pro file it is called OTHER_FILES, which is typical.  But we will not interfere with flies with cutlets, we will get our section right away.  Add our description there, and then add our section to the ‚ÄúOther files‚Äù: <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ORM_FILES</span></span> += classes.qoc OTHER_FILES += $<span class="hljs-variable"><span class="hljs-variable">$ORM_FILES</span></span></code> </pre><br>  Now the fun begins.  QMake is an incredibly sophisticated thing.  There are more than a hundred keywords for describing pro-files.  One of the features is QMAKE_EXTRA_COMPILERS.  This is a mechanism for specifying the rules for launching additional compilers, preprocessors and other code interpreters in the pro-file.  This is how moc and uic are called.  The original description can be found <a href="http://www.qtcentre.org/wiki/index.php%3Ftitle%3DUndocumented_qmake">here</a> .  True, it is quite concise.  In our profile, the following should be added: <br><pre> <code class="hljs mel">orm.output = ${QMAKE_FILE_IN_PATH}/${QMAKE_FILE_IN_BASE}_qoc.h #  orm.input = ORM_FILES #   orm.commands = xsltproc -o ${QMAKE_FILE_OUT} ${QMAKE_FILE_IN} # orm.variable_out = HEADERS #     orm.name = ORM # (   qmake) QMAKE_EXTRA_COMPILERS += orm</code> </pre><br>  You can try to collect, at this stage, everything should already work. <br><br><h5>  Restore order </h5><br>  The above piece actually resembles qmake .prf files that are located in / usr / share / qt4 / mkspecs / features if you are using Linux.  When we write <pre> <code class="hljs pgsql">CONFIG += <span class="hljs-type"><span class="hljs-type">xml</span></span></code> </pre>  for example, the xml.prf config is connected.  Thus, you can put these instructions in the orm.prf file and put it in the specified folder.  Then to process our XML-ek it will be enough to write <br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">CONFIG</span></span> += orm</code> </pre><br><br><h5>  Instead of conclusion </h5><br>  Now a few words about possible pitfalls.  I almost immediately wrote this config on the manual, but nothing happened.  In the build console, there was no launch of xsltproc and the header was not generated.  Having tried various options, I found that xsltproc is at least called if you write orm.variable_out = SOURCES.  Then I discovered that I forgot to write # define protection in the XSL template to prevent the header from being re-enabled, and after correcting the template EXTREMELY, the config worked and started to generate the generated header regularly.  I do not believe in miracles, I wrote it off at four in the morning.  But, if you find something like this - I warned you. </div><p>Source: <a href="https://habr.com/ru/post/139607/">https://habr.com/ru/post/139607/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139598/index.html">Apple event March 7, 2012 - New iPad and new Apple TV, iOS 5.1, iPhoto</a></li>
<li><a href="../139601/index.html">STM32F1xx - Developer Tools and FreeRTOS</a></li>
<li><a href="../139603/index.html">Congratulations! We are all under the hood</a></li>
<li><a href="../139604/index.html">Tracking user‚Äôs browser and OS settings as a measure to prevent account hijacking (updated)</a></li>
<li><a href="../139606/index.html">iOS 5.1 available for download</a></li>
<li><a href="../139611/index.html">The company Carl Zeiss has released "virtual" glasses</a></li>
<li><a href="../139612/index.html">WebSence has discovered a new massive Wordpress blog infection.</a></li>
<li><a href="../139614/index.html">What is wrong with Android?</a></li>
<li><a href="../139615/index.html">New server configurations based on Intel Xeon E5</a></li>
<li><a href="../139616/index.html">New Three Features from Amazon Web Services</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>