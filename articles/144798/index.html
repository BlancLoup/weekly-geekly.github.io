<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Modeling in MongoDB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One of MongoDB‚Äôs most-advertised features is flexibility. I myself have repeatedly emphasized this in countless conversations about MongoDB. However, ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Modeling in MongoDB</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/792/ea2/b42/792ea2b42ac93af6157170c0e1d8ed72.png" align="left" alt="image">  One of MongoDB‚Äôs most-advertised features is flexibility.  I myself have repeatedly emphasized this in countless conversations about MongoDB.  However, flexibility is a double-edged sword: more flexibility means a wider choice of data modeling solutions.  However, I like the flexibility that MongoDB provides; I just need to keep some recommendations in mind before I start developing a data model. <br><br>  In this article, we will look at how to model a structure containing mailing lists and data about the people who are included in these lists. <br><a name="habracut"></a><br><br>  The following are the requirements: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ul><li>  A person may have one or more e-mail addresses; </li><li>  A person can be on any number of mailing lists; </li><li>  A person can choose any name for any mailing list in which he is. </li></ul><br><h4>  Strategy "without embedding" </h4><br>  Let's see what our data model will look like if no data is embedded anywhere. <br><br>  We have <b>People</b> subscribers with names and passwords: <br><pre><code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: PERSON_ID, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">pw</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span> }</code> </pre> <br>  We have a collection of Addresses addresses in which each document contains an e-mail address and a link to a specific subscriber: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: ADDRESS_ID, <span class="hljs-attr"><span class="hljs-attr">person</span></span>: PERSON_ID, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: <span class="hljs-string"><span class="hljs-string">"vpupkin@gmail.com"</span></span> }</code> </pre> <br>  We have <b>Groups</b> , each of which contains only a group identifier (it, of course, may contain other data, but we specifically omit this point in order to concentrate on subscriptions) <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: GROUP_ID }</code> </pre> <br>  Finally, we have a collection of <b>Membership</b> subscriptions.  Each Subscription brings people to the Groups, in addition, contains the name that the person has chosen for this Group, and a link to the e-mail address that he wants to use to receive the newsletter in this Group: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: MEMBERSHIP_ID, <span class="hljs-attr"><span class="hljs-attr">person</span></span>: PERSON_ID, <span class="hljs-attr"><span class="hljs-attr">group</span></span>: GROUP_ID, <span class="hljs-attr"><span class="hljs-attr">address</span></span>: ADDRESS_ID, <span class="hljs-attr"><span class="hljs-attr">group_name</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }</code> </pre> <br>  This data model is understandable, easy to develop, and easy to maintain.  We have created a model that is convenient to use in a relational database.  However, we did not take into account the MongoDB document-oriented approach at all.  Let's take a look at what we will do to get, for example, the e-mail addresses of all members of one Group, having one known e-mail address and the name of this Group: <br><br><ol><li>  In the <b>Addresses</b> collection by the well-known e-mail, we find <code>PERSON_ID</code> ; </li><li>  In the <b>Memberships</b> collection, using the received <code>PERSON_ID</code> and the well-known name of the Group, we find <code>GROUP_ID</code> ; </li><li>  Again in the <b>Memberships</b> collection, by the received <code>GROUP_ID</code> we find the list of Subscriptions of this Group; </li><li>  And finally, from the <b>Addresses</b> collection on <code>ADDRESS_ID</code> , after passing through each Subscription from the received list, we get a list of e-mail addresses. </li></ol><br>  Slightly complicated, isn't it? <br><br><h4>  All-built strategy </h4><br>  Now consider the case when all the data is embedded in one document.  To do this, we will take all the Group Subscriptions and embed them in the Group model.  With a plus in each Subscription we will integrate information about the Subscriber and his e-mail addresses: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: GROUP_ID, <span class="hljs-attr"><span class="hljs-attr">memberships</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">address</span></span>: <span class="hljs-string"><span class="hljs-string">"vpupkin@gmail.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">pw</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">person_addresses</span></span>: [<span class="hljs-string"><span class="hljs-string">"vpupkin@gmail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"vpupkin@mail.ru"</span></span>, ...], <span class="hljs-attr"><span class="hljs-attr">group_name</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> }, ...] }</code> </pre> <br>  The point of embedding all linked data in one document is that now some data queries are much easier to do.  The request from the previous part of the article becomes quite simple (remember, we need, having one known e-mail address and the name of the Group, find out the e-mail addresses of the other members of this Group): <br><br><ol><li>  In the <b>Groups</b> collection, we find the Group containing the Subscription, in which <code>group_name</code> matches the known name of the Group and the <code>person_addresses</code> array contains the e-mail known to us; </li><li>  Let us analyze the resulting document to retrieve the remaining e-mail addresses. </li></ol><br>  Much easier.  But what if Subscriber wants to change his name or password?  We will have to change his name or password in each built-in Subscription of each Group in which this Subscriber consists.  This also applies to adding a new e-mail address or deleting an existing e-mail address from the <code>person_addresses</code> array.  Such moments tell us about a certain character of this model: it is well suited for specific requests (because all the necessary data is already inside, such as pre-join), but it can become nightmares in the long run in terms of maintenance. <br><br><h4>  Strategy of "partial embedding" </h4><br>  The approach that I most often recommend is to start thinking about the data model without embedding.  Once you have a draft model, you can begin to distinguish cases where embedding makes sense.  As a rule, these are one-to-many relationships. <br><br>  For example, a few email addresses from the <b>Addresses</b> collection belong to the same Subscriber (they also participate in the Subscription model) and usually change less frequently.  Therefore, we will combine them into an array and add a Subscriber to our model, making it a bit similar to the mental model. <br><br>  Each Subscription is associated with a specific Subscriber and a specific Group, so you can embed Subscriptions in both the Subscriber model and the Group model.  In such cases, it is important to think about both the data access model and the size of the embedded data.  We expect that people are unlikely to subscribe to mailings from more than 1000 different groups, and a single group, in turn, is also unlikely to reach more than 1000 subscribers.  In this case, the numbers do not tell us anything useful.  However, our data access model, on the contrary, tells us that when displaying on a screen, it is necessary to see all the subscriptions of a specific person.  To simplify the query, we embed Subscriptions in the Subscriber model.  The advantage is that the list of e-mail addresses of the Subscriber is in the Subscriber model, and in the Subscription one of the addresses of this list is used, and if we need to change or delete the e-mail address, it can be done in one place. <br><br>  Now our data model looks like this: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">_id</span></span>: PERSON_ID, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">pw</span></span>: <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-attr"><span class="hljs-attr">addresses</span></span>: [<span class="hljs-string"><span class="hljs-string">"vpupkin@gmail.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"vpupkin@mail.ru"</span></span>, ...], <span class="hljs-attr"><span class="hljs-attr">memberships</span></span>: [{ <span class="hljs-attr"><span class="hljs-attr">address</span></span>: <span class="hljs-string"><span class="hljs-string">"vpupkin@gmail.com"</span></span>, <span class="hljs-attr"><span class="hljs-attr">group_name</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">group</span></span>: GROUP_ID }, ...] }</code> </pre> <br>  This is a Subscriber model, besides it there is also a Group model, which is identical to the one that is considered in the description of the ‚Äúwithout embedding‚Äù strategy. <br><br>  The query that we discussed above will now look like this: <br><br><ol><li>  In the <b>People</b> collection, we find a Subscriber with the desired e-mail address, among whose Subscriptions there is a Subscription with the desired name; </li><li>  Using the <code>GROUP_ID</code> found Subscription, find in the <b>People</b> collection the other Subscribers of this Group and take their e-mail addresses directly from the Subscription. </li></ol><br>  This is still almost as simple as when everything is built in, but now our data model is much cleaner and easier to maintain.  Hope this article was helpful to you. <br><br><h6>  <b>From the translator:</b> in general, this is a rather free translation and was made purely for personal purposes, so all the blows, please, in a personal.  I will also make a reservation that some concepts have been replaced for subjective reasons, some points have been omitted, since they did not play a significant role for the transmission of the essence.  In any case, please refer to the original. </h6></div><p>Source: <a href="https://habr.com/ru/post/144798/">https://habr.com/ru/post/144798/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../144793/index.html">Russian Code Cup 2012: a detailed analysis of the tasks from the first qualification</a></li>
<li><a href="../144794/index.html">Solving problems with the horizon and vertical video on camera phones</a></li>
<li><a href="../144795/index.html">Application to prepare for the exam on the "Russian" - free until June 13!</a></li>
<li><a href="../144796/index.html">About EMC Captiva InputAccel and Kofax Capture Industrial Mass Input, Image Processing and OCR Systems</a></li>
<li><a href="../144797/index.html">Visual Studio 11 -> Visual Studio 2012?</a></li>
<li><a href="../144799/index.html">Skype maintains independence inside Microsoft</a></li>
<li><a href="../144800/index.html">Continuous integration with Jabber. Inventing a bicycle?</a></li>
<li><a href="../144802/index.html">Doctrine ORM behaviors, or how to effectively use traits</a></li>
<li><a href="../144804/index.html">Twig. IPhone Multifunction Cable</a></li>
<li><a href="../144808/index.html">Seminar "Bitrix High School" - as it were, presentations, video</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>