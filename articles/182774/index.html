<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make iPhone external buttons work for you</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear readers Habr! 

 I've been working as a freelancer for quite some time and sometimes I take a couple of simple projects for $ 100-200 for ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make iPhone external buttons work for you</h1><div class="post__text post__text-html js-mediator-article"><img align="right" src="https://habrastorage.org/storage2/c32/67e/943/c3267e9435bef3b57b9b3f9d09c11da0.png">  Hello, dear readers Habr! <br><br>  I've been working as a freelancer for quite some time and sometimes I take a couple of simple projects for $ 100-200 for brain unloading.  This time the client asked to use the external volume buttons on the iPhone.  The problem was that the built-in API for external buttons in iOS does not exist: until recently, the use of hardware elements of the device, other than system behavior, was prohibited.  Therefore, various applications such as Camera + and Camera Pro could not bring such functionality to the user.  However, fortunately, in iOS 5, the Apple developers themselves began using a similar approach to the interface: you can now take a photo in the camera's system application by pressing the volume up key. <br><br>  How to implement a similar behavior of external keys in your application, look under the cut.  Sources are attached at the end of the article. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A little googling about the problem, you can stumble upon an open solution <a href="https://github.com/blladnar/RBVolumeButtons">RBVolumeButtons</a> , which opens the audio session and begins to listen to the change in volume.  In my case, this class unpleasantly influenced the work of the camera: by activating a new audio session, we interrupted the camera's audio session.  I decided to assemble my bike, approaching the process from a slightly different side;  write a separate class NKVolumeButtons, hiding in itself all the necessary functionality. <br><br>  After a short debriefing, I decided to use the MPMusicPlayer class from the built-in MediaPlayer framework.  In this class there are two Siglton music player: one for the application and the second system, common to the entire phone.  We will listen to changes in the volume of the music player for our application.  To do this, add some code to the initialization method of the NKVolumeButtons object: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre><code class="objectivec hljs">[[<span class="hljs-built_in"><span class="hljs-built_in">MPMusicPlayerController</span></span> applicationMusicPlayer] addObserver:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> forKeyPath:<span class="hljs-string"><span class="hljs-string">@"volume"</span></span> options:<span class="hljs-built_in"><span class="hljs-built_in">NSKeyValueObservingOptionNew</span></span> context:<span class="hljs-literal"><span class="hljs-literal">nil</span></span>];</code> </pre> </div></div><br>  All according to the canons of <a href="https://developer.apple.com/library/mac/">KVO</a> : instead of our own bike, we use the good old category inherited from NSObject.  Accordingly, we also need an event handler ‚Äî when the parameter that we listen to changes, we need to somehow accept this information.  Feel free to add a method to NKVolumeButtons! <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)observeValueForKeyPath:(<span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *)keyPath ofObject:(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>)object change:(<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *)change context:(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *)context { <span class="hljs-comment"><span class="hljs-comment">//    ,   keyPath  ;  ?   ,    -  volume [self checkVolumeButtons]; } - (void)checkVolumeButtons { // 1 float currentVolume = [[MPMusicPlayerController applicationMusicPlayer] volume]; // 2 if (currentVolume &gt; 0.5) { [self volumeUp]; } else if (currentVolume &lt; 0.5) { [self volumeDown]; } // 3 [[MPMusicPlayerController applicationMusicPlayer] setVolume:0.5]; }</span></span></code> </pre></div></div><br>  Let's sort the code in order: <br><br><ol><li>  We get the current volume of the application </li><li>  Check if the volume has increased or decreased </li><li>  We return the volume to the original value </li></ol><br>  What is the original value?  I explain: if the user came into our application, and the volume is at zero?  Then pressing the volume down key will not make sense - nothing will work.  Therefore, from the very beginning we need to set the volume at a certain level, from which we will dance.  The volume parameter can take values ‚Äã‚Äãfrom 0 to 1, so we choose the middle - 0.5.  Add the following code to the initialization of the NKVolumeButtons object: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">[[<span class="hljs-built_in"><span class="hljs-built_in">MPMusicPlayerController</span></span> applicationMusicPlayer] setVolume:<span class="hljs-number"><span class="hljs-number">0.5</span></span>];</code> </pre></div></div><br>  Now let's start implementing the volumeUp and volumeDown methods.  For convenience, we add two parameters to the NKVolumeButtons class that are accessible from the outside ‚Äî upBlock and downBlock.  Let's take the NKVolumeButtons.h file to the following form: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> (^ButtonBlock)(); <span class="hljs-meta"><span class="hljs-meta">#import </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><span class="hljs-meta"> @interface NKVolumeButtons : NSObject @property (nonatomic, copy) ButtonBlock upBlock; @property (nonatomic, copy) ButtonBlock downBlock; @end</span></span></code> </pre></div></div><br>  Here we simply added the ability to install externally blocks of code, which will be called up when pressing the volume keys, in a convenient key.  Do not forget about the synthesis of our parameters.  Add the following to the NKVolumeButtons implementation: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">@synthesize</span></span> upBlock = _upBlock; <span class="hljs-keyword"><span class="hljs-keyword">@synthesize</span></span> downBlock = _downBlock;</code> </pre></div></div><br>  And, of course, calling our blocks at the right time: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)volumeUp { <span class="hljs-comment"><span class="hljs-comment">//   ,      if(self.upBlock) { self.upBlock(); } } - (void)volumeDown { //   ,      if(self.downBlock) { self.downBlock(); } }</span></span></code> </pre></div></div><br>  And here's another problem!  Each time we change the volume, a volume indicator appears on the screen.  Well, let's use a ready-made solution, which was already in RBVolumeButtons.  That's why he opensource to help each other, right?  Add the following code to NKVolumeButtons.m: <br><br><div class="spoiler">  <b class="spoiler_title">Push me!</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//    CGRect frame = CGRectMake(0, -100, 10, 0); UIView *volumeView = [[MPVolumeView alloc] initWithFrame:frame]; [volumeView sizeToFit]; [[[[UIApplication sharedApplication] windows] objectAtIndex:0] addSubview:volumeView];</span></span></code> </pre></div></div><br>  That's all!  We only need to add this class to the project, initialize the NKVolumeButtons object and set the necessary code blocks.  This simple crutch solves the problem of lack of external keys API. <br><br>  Thank you for reading to the end!  Sources are available on <a href="https://github.com/backmeupplz/NKVolumeButtons">github</a> . <br>  If you suddenly find any inaccuracies or typographical errors, you are <a href="http://habrahabr.ru/users/backmeupplz/">welcome</a> to <a href="http://habrahabr.ru/users/backmeupplz/">my cozy habrakabinet</a> . </div><p>Source: <a href="https://habr.com/ru/post/182774/">https://habr.com/ru/post/182774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../182762/index.html">Legal tax minimization in Ukraine for IT companies</a></li>
<li><a href="../182764/index.html">CONFidence. Again about how cool it is</a></li>
<li><a href="../182766/index.html">KidsReview.ru - entry with children is allowed</a></li>
<li><a href="../182770/index.html">Grodnohost closes?</a></li>
<li><a href="../182772/index.html">Second chance or how I fixed the monitor outside the box</a></li>
<li><a href="../182776/index.html">Algorithms and JDK data structures</a></li>
<li><a href="../182778/index.html">Technology of ‚Äúdrawn sound‚Äù: sound synthesis in the USSR of the 30s of the XX century</a></li>
<li><a href="../182780/index.html">Simple Android app framework</a></li>
<li><a href="../182782/index.html">HTML5 ASCII Art Generator</a></li>
<li><a href="../182784/index.html">Voxel graphics do-it-yourself - first steps</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>