<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Formatting phone numbers in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The problem arose of automatically formatting telephone numbers in the form of a country (city) number , and first of all I turned to existing solutio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Formatting phone numbers in PHP</h1><div class="post__text post__text-html js-mediator-article">  The problem arose of automatically formatting telephone numbers in the form of a <b>country (city) number</b> , and first of all I turned to existing solutions. <br>  Unfortunately, it turned out that all the solutions found are based on the usual fitting of a string to a custom format, having limited scope and errors when going beyond its limits. <a name="habracut"></a><br><br>  First, I will give an overview of the solutions found.  For those who are not interested, I recommend scrolling below to the heading ‚ÄúTelephone Number Formats‚Äù - my version of the number analysis is already presented there with a link to the code. <br><br><h4>  All-Destructive Primitive </h4>  <u>(Found solution. Mine below)</u> <br>  The first thing I stumbled upon were messages on forums and script banks offering solutions for the following plan: <br><blockquote>  <font color="#cc6633">&lt;?</font> <br>  <font color="#0000ff">function</font> phone_number ( <font color="#cc6633">$ sPhone</font> ) { <br>  <font color="#cc6633">$ sPhone</font> = <a href="http://www.php.net/manual/en/function.ereg-replace.php">ereg_replace</a> ( <font color="#008000">"[^ 0-9]"</font> , <font color="#008000">''</font> , <font color="#cc6633">$ sPhone</font> ); <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ sPhone</font> )! = <font color="#008000">10</font> ) <font color="#0000ff">return</font> (False); <br>  <font color="#cc6633">$ sArea</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ sPhone</font> , <font color="#008000">0</font> , <font color="#008000">3</font> ); <br>  <font color="#cc6633">$ sPrefix</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ sPhone</font> , <font color="#008000">3</font> , <font color="#008000">3</font> ); <br>  <font color="#cc6633">$ sNumber</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ sPhone</font> , <font color="#008000">6</font> , <font color="#008000">4</font> ); <br>  <font color="#cc6633">$ sPhone</font> = <font color="#008000">"("</font> . <font color="#cc6633">$ sArea</font> . <font color="#008000">")"</font> .  <font color="#cc6633">$ sPrefix</font> .  <font color="#008000">"-"</font> .  <font color="#cc6633">$ sNumber</font> ; <br>  <font color="#0000ff">return</font> ( <font color="#cc6633">$ sPhone</font> ); <br>  } <br>  <font color="#cc6633">?&gt;</font> </blockquote><br>  One of the simplest options for smartly formatting phone numbers, but each such solution is focused on phone numbers from a specific local zone and is not a solution to the problem. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Formatting with sscanf </h4>  <u>(Found solution. Mine below)</u> <br><blockquote>  <font color="#0000ff">function</font> formatPhone ( <font color="#cc6633">$ phone</font> ) { <br>  <font color="#0000ff">if</font> ( <font color="#0000ff">empty</font> ( <font color="#cc6633">$ phone</font> )) <font color="#0000ff">return</font> <font color="#008000">""</font> ; <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) == <font color="#008000">7</font> ) <br>  <a href="http://www.php.net/manual/en/function.sscanf.php">sscanf</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">"% 3s% 4s"</font> , <font color="#cc6633">$ prefix</font> , <font color="#cc6633">$ exchange</font> ); <br>  <font color="#0000ff">else if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) == <font color="#008000">10</font> ) <br>  <a href="http://www.php.net/manual/en/function.sscanf.php">sscanf</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">"% 3s% 3s% 4s"</font> , <font color="#cc6633">$ area</font> , <font color="#cc6633">$ prefix</font> , <font color="#cc6633">$ exchange</font> ); <br>  <font color="#0000ff">else if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> )&gt; <font color="#008000">10</font> ) <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#008000">1</font> ) == <font color="#008000">'1'</font> ) { <br>  <a href="http://www.php.net/manual/en/function.sscanf.php">sscanf</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">"% 1s% 3s% 3s% 4s"</font> , <font color="#cc6633">$ country</font> , <font color="#cc6633">$ area</font> , <font color="#cc6633">$ prefix</font> , <font color="#cc6633">$ exchange</font> ); <br>  } <br>  <font color="#0000ff">else</font> { <br>  <a href="http://www.php.net/manual/en/function.sscanf.php">sscanf</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">"% 3s% 3s% 4s% s"</font> , <font color="#cc6633">$ area</font> , <font color="#cc6633">$ prefix</font> , <font color="#cc6633">$ exchange</font> , <font color="#cc6633">$ extension</font> ); <br>  } <br>  <font color="#0000ff">else</font> <br>  <font color="#0000ff">return</font> <font color="#008000">"unknown phone format: $ phone"</font> ; <br>  <font color="#cc6633">$ out</font> = <font color="#008000">""</font> ; <br>  <font color="#cc6633">$ out</font> . = <font color="#0000ff">isset</font> ( <font color="#cc6633">$ country</font> )?  <font color="#cc6633">$ country</font> .  <font color="#008000">''</font> : <font color="#008000">''</font> ; <br>  <font color="#cc6633">$ out</font> . = <font color="#0000ff">isset</font> ( <font color="#cc6633">$ area</font> )?  <font color="#008000">'('</font> . <font color="#cc6633">$ area</font> . <font color="#008000">')'</font> : <font color="#008000">''</font> ; <br>  <font color="#cc6633">$ out</font> . = <font color="#cc6633">$ prefix</font> .  <font color="#008000">'-'</font> .  <font color="#cc6633">$ exchange</font> ; <br>  <font color="#cc6633">$ out</font> . = <font color="#0000ff">isset</font> ( <font color="#cc6633">$ extension</font> )?  <font color="#008000">'x'</font> .  <font color="#cc6633">$ extension</font> : <font color="#008000">''</font> ; <br>  <font color="#0000ff">return</font> <font color="#cc6633">$ out</font> ; <br>  } </blockquote><br>  Despite the simple solution, this function is already able to format numbers with a length of 7, 10 or more digits, but if it gets a number from the Russian backland, it will choke and give an erroneous result. <br><br><h4>  Symfony, lib / helpers / PhoneHelper.php, format_phone </h4>  <u>(Found solution. Mine below)</u> <br><blockquote>  <font color="#cc6633">&lt;? php</font> <br>  <font color="#0000ff">function</font> format_phone ( <font color="#cc6633">$ phone</font> = <font color="#008000">''</font> , <font color="#cc6633">$ convert</font> = <font color="#0000ff">false</font> , <font color="#cc6633">$ trim</font> = <font color="#0000ff">true</font> ) <br>  { <br>  <font color="#696969">// If you have not entered</font> <br>  <font color="#0000ff">if</font> ( <font color="#0000ff">empty</font> ( <font color="#cc6633">$ phone</font> )) { <br>  <font color="#0000ff">return</font> <font color="#008000">''</font> ; <br>  } <br><br>  <font color="#696969">// Keep out the letters and numbers</font> <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.preg-replace.php">preg_replace</a> ( <font color="#008000">"/ [^ 0-9A-Za-z] /"</font> , <font color="#008000">""</font> , <font color="#cc6633">$ phone</font> ); <br><br>  <font color="#696969">// Do you want to convert?</font> <br>  <font color="#696969">// Samples are: 1-800-TERMINIX, 1-800-FLOWERS, 1-800-Petmeds</font> <br>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ convert</font> == <font color="#0000ff">true</font> ) { <br>  <font color="#cc6633">$ replace</font> = <font color="#0000ff">array</font> ( <font color="#008000">'2'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'a'</font> , <font color="#008000">'b'</font> , <font color="#008000">'c'</font> ), <br>  <font color="#008000">'3'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'d'</font> , <font color="#008000">'e'</font> , <font color="#008000">'f'</font> ), <br>  <font color="#008000">'4'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'g'</font> , <font color="#008000">'h'</font> , <font color="#008000">'i'</font> ), <br>  <font color="#008000">'5'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'j'</font> , <font color="#008000">'k'</font> , <font color="#008000">'l'</font> ), <br>  <font color="#008000">'6'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'m'</font> , <font color="#008000">'n'</font> , <font color="#008000">'o'</font> ), <br>  <font color="#008000">'7'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'p'</font> , <font color="#008000">'q'</font> , <font color="#008000">'r'</font> , <font color="#008000">'s'</font> ), <br>  <font color="#008000">'8'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'t'</font> , <font color="#008000">'u'</font> , <font color="#008000">'v'</font> ), <font color="#008000">'9'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'w'</font> , <font color="#008000">'x'</font> , <font color="#008000">'y'</font> , <font color="#008000">'z'</font> )); <br><br>  <font color="#696969">// Replace each letter with a number</font> <br>  <font color="#696969">// Notice this is case insensitive with the str_ireplace instead of str_replace</font> <br>  <font color="#0000ff">foreach</font> ( <font color="#cc6633">$ replace</font> <font color="#0000ff">as</font> <font color="#cc6633">$ digit</font> =&gt; <font color="#cc6633">$ letters</font> ) { <br>  <font color="#cc6633">$ phone</font> = str_ireplace ( <font color="#cc6633">$ letters</font> , <font color="#cc6633">$ digit</font> , <font color="#cc6633">$ phone</font> ); <br>  } <br>  } <br><br>  <font color="#696969">// If we have a number longer than 11 digits cut the string down to only 11</font> <br>  <font color="#696969">// This is also an order.</font> <br>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ trim</font> == <font color="#0000ff">true</font> &amp;&amp; <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> )&gt; <font color="#008000">11</font> ) { <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#008000">11</font> ); <br>  } <br><br>  <font color="#696969">// Perform phone number formatting here</font> <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) == <font color="#008000">7</font> ) { <br>  <font color="#0000ff">return</font> <a href="http://www.php.net/manual/en/function.preg-replace.php">preg_replace</a> ( <font color="#008000">"/ ([0-9a-zA-Z] {3}) ([0-9a-zA-Z] {4}) /"</font> , <font color="#008000">"$ 1- $ 2"</font> , <font color="#cc6633">$ phone</font> ); <br>  } <font color="#0000ff">elseif</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) == <font color="#008000">10</font> ) { <br>  <font color="#0000ff">return</font> <a href="http://www.php.net/manual/en/function.preg-replace.php">preg_replace</a> ( <font color="#008000">"/ ([0-9a-zA-Z] {3}) ([0-9a-zA-Z] {3}) ([0-9a-zA-Z] {4}) /"</font> , <font color="#008000">"($ 1) $ 2- $ 3"</font> , <font color="#cc6633">$ phone</font> ); <br>  } <font color="#0000ff">elseif</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) == <font color="#008000">11</font> ) { <br>  <font color="#0000ff">return</font> <a href="http://www.php.net/manual/en/function.preg-replace.php">preg_replace</a> ( <font color="#008000">"/ ([0-9a-zA-Z] {1}) ([0-9a-zA-Z] {3}) ([0-9a-zA-Z] {3}) ([0 -9a-zA-Z] {4}) / "</font> , <font color="#008000">" $ 1 ($ 2) $ 3- $ 4 "</font> , <font color="#cc6633">$ phone</font> ); <br>  } <br><br>  <font color="#696969">// Return original phone if not 7, 10 or 11 digits long</font> <br>  <font color="#0000ff">return</font> <font color="#cc6633">$ phone</font> ; <br>  } <br>  <font color="#cc6633">?&gt;</font> </blockquote><br>  The function allows not only formatting in XXX-XXXX, (XXX) XXX-XXXX and X (XXX) XXX-XXXX, but also convert numbers written in numbers.  The limited function in formatting numbers of length 7, 10 and 11 characters does not fit. <br><br><h4>  Phone Number Formats </h4>  From the <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BB%25D0%25B5%25D1%2584%25D0%25BE%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BF%25D0%25BB%25D0%25B0%25D0%25BD_%25D0%25BD%25D1%2583%25D0%25BC%25D0%25B5%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8">wiki article,</a> it is clear that there is no simple and convenient pattern for fast formatting of all numbers.  Country codes are registered, like domain zones, and city codes remain on the conscience of each country. <br><br>  In other words, call routing follows a mask, starting with a country code: a call directed to a specific country further punches a route in accordance with the codes of the region, city, region, etc.  starting from the leftmost digit until the last link transfers it to a specific telephone / fax machine.  The problem is further complicated by the fact that the codes of cities within countries likewise defy unified end-to-end standardization, i.e.  in the worst of cases, to correctly format the numbers, you will have to use a two-dimensional array with the codes of countries and their cities. <br><br>  <b>In fact, everything was not so scary.</b>  In each country, you can divide all the codes of cities into two parts: those that mostly coincide in length, and all the rest.  This is enough to drastically reduce the code search area when comparing.  Those.  You can create an array of data for each country of the form: <br><blockquote>  <font color="#cc6633">&lt;?</font> <br>  <font color="#cc6633">$ data</font> = Array ( <br>  <font color="#008000">'Country Code'</font> =&gt; Array ( <br>  <font color="#008000">'name'</font> =&gt; <font color="#008000">'Country Name'</font> , <font color="#696969">// for convenience.</font>  <font color="#696969">Will not be used.</font> <br>  <font color="#008000">'cityCodeLength'</font> =&gt; regular_length_code_city_for_this_country, <br>  <font color="#008000">'exceptions'</font> =&gt; Array (city_exclusion_ codes), <br>  ) <br>  ); <br>  <font color="#cc6633">?&gt;</font> <br></blockquote>  Then, pre-process the data, complementing it with fields narrowing the brute force area, <i>exceptions_max</i> and <i>exceptions_min</i> - with the maximum and minimum code of the cities of exceptions, respectively.  It is also necessary to take into account countries in which city codes start with 0 - we will reflect this ‚Äúfeature‚Äù by the <i>zeroHack</i> field.  As an example: <blockquote>  <font color="#cc6633">&lt;?</font> <br>  <font color="#cc6633">$ data</font> = Array ( <br>  <font color="#008000">'886'</font> =&gt; Array ( <br>  <font color="#008000">'name'</font> =&gt; <font color="#008000">'Taiwan'</font> , <br>  <font color="#008000">'cityCodeLength'</font> =&gt; <font color="#008000">1</font> , <br>  <font color="#008000">'zeroHack'</font> =&gt; <font color="#0000ff">false</font> , <br>  <font color="#008000">'exceptions'</font> =&gt; Array ( <font color="#008000">89</font> , <font color="#008000">90</font> , <font color="#008000">91</font> , <font color="#008000">92</font> , <font color="#008000">93</font> , <font color="#008000">96</font> , <font color="#008000">60</font> , <font color="#008000">70</font> , <font color="#008000">94</font> , <font color="#008000">95</font> ), <br>  <font color="#008000">'exceptions_max'</font> =&gt; <font color="#008000">2</font> , <br>  <font color="#008000">'exceptions_min'</font> =&gt; <font color="#008000">2</font> <br>  ), <br>  ); <br>  <font color="#cc6633">?&gt;</font> </blockquote>  After that, we take the appropriate sections of the code from the solutions above and make the formatting function: <blockquote>  <font color="#cc6633">&lt;?</font> <br>  <font color="#0000ff">function</font> phone ( <font color="#cc6633">$ phone</font> = <font color="#008000">''</font> , <font color="#cc6633">$ convert</font> = <font color="#0000ff">true</font> , <font color="#cc6633">$ trim</font> = <font color="#0000ff">true</font> ) <br>  { <br>  <font color="#0000ff">global</font> <font color="#cc6633">$ phoneCodes</font> ;  <font color="#696969">// for example only!</font>  <font color="#696969">When implemented, get rid of the global variable.</font> <br>  <font color="#0000ff">if</font> ( <font color="#0000ff">empty</font> ( <font color="#cc6633">$ phone</font> )) { <br>  <font color="#0000ff">return</font> <font color="#008000">''</font> ; <br>  } <br>  <font color="#696969">// cleaning of excess garbage with saving information about the "plus" at the beginning of the number</font> <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.trim.php">trim</a> ( <font color="#cc6633">$ phone</font> ); <br>  <font color="#cc6633">$ plus</font> = ( <font color="#cc6633">$ phone</font> [ <font color="#008000">0</font> ] == <font color="#008000">'+'</font> ); <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.preg-replace.php">preg_replace</a> ( <font color="#008000">"/ [^ 0-9A-Za-z] /"</font> , <font color="#008000">""</font> , <font color="#cc6633">$ phone</font> ); <br>  <font color="#cc6633">$ OriginalPhone</font> = <font color="#cc6633">$ phone</font> ; <br><br>  <font color="#696969">// convert the letter number to digital</font> <br>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ convert</font> == <font color="#0000ff">true</font> &amp;&amp;! <a href="http://www.php.net/manual/en/function.is-numeric.php">is_numeric</a> ( <font color="#cc6633">$ phone</font> )) { <br>  <font color="#cc6633">$ replace</font> = <font color="#0000ff">array</font> ( <font color="#008000">'2'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'a'</font> , <font color="#008000">'b'</font> , <font color="#008000">'c'</font> ), <br>  <font color="#008000">'3'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'d'</font> , <font color="#008000">'e'</font> , <font color="#008000">'f'</font> ), <br>  <font color="#008000">'4'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'g'</font> , <font color="#008000">'h'</font> , <font color="#008000">'i'</font> ), <br>  <font color="#008000">'5'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'j'</font> , <font color="#008000">'k'</font> , <font color="#008000">'l'</font> ), <br>  <font color="#008000">'6'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'m'</font> , <font color="#008000">'n'</font> , <font color="#008000">'o'</font> ), <br>  <font color="#008000">'7'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'p'</font> , <font color="#008000">'q'</font> , <font color="#008000">'r'</font> , <font color="#008000">'s'</font> ), <br>  <font color="#008000">'8'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'t'</font> , <font color="#008000">'u'</font> , <font color="#008000">'v'</font> ), <br>  <font color="#008000">'9'</font> =&gt; <font color="#0000ff">array</font> ( <font color="#008000">'w'</font> , <font color="#008000">'x'</font> , <font color="#008000">'y'</font> , <font color="#008000">'z'</font> )); <br><br>  <font color="#0000ff">foreach</font> ( <font color="#cc6633">$ replace</font> <font color="#0000ff">as</font> <font color="#cc6633">$ digit</font> =&gt; <font color="#cc6633">$ letters</font> ) { <br>  <font color="#cc6633">$ phone</font> = str_ireplace ( <font color="#cc6633">$ letters</font> , <font color="#cc6633">$ digit</font> , <font color="#cc6633">$ phone</font> ); <br>  } <br>  } <br><br>  <font color="#696969">// replace 00 at the beginning of the number with +</font> <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#008000">2</font> ) == <font color="#008000">"00"</font> ) <br>  { <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">2</font> , <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) - <font color="#008000">2</font> ); <br>  <font color="#cc6633">$ plus</font> = <font color="#0000ff">true</font> ; <br>  } <br><br>  <font color="#696969">// if the phone is longer than 7 characters, start the search for the country</font> <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> )&gt; <font color="#008000">7</font> ) <br>  <font color="#0000ff">foreach</font> ( <font color="#cc6633">$ phoneCodes</font> <font color="#0000ff">as</font> <font color="#cc6633">$ countryCode</font> =&gt; <font color="#cc6633">$ data</font> ) <br>  { <br>  <font color="#cc6633">$ codeLen</font> = <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ countryCode</font> ); <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#cc6633">$ codeLen</font> ) == <font color="#cc6633">$ countryCode</font> ) <br>  { <br>  <font color="#696969">// as soon as the country is detected, we cut the phone down to the level of the city code</font> <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#cc6633">$ codeLen</font> , <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) - <font color="#cc6633">$ codeLen</font> ); <br>  <font color="#cc6633">$ zero</font> = <font color="#0000ff">false</font> ; <br>  <font color="#696969">// check for the presence of zeros in the city code</font> <br>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ data</font> [ <font color="#008000">'zeroHack'</font> ] &amp;&amp; <font color="#cc6633">$ phone</font> [ <font color="#008000">0</font> ] == <font color="#008000">'0'</font> ) <br>  { <br>  <font color="#cc6633">$ zero</font> = <font color="#0000ff">true</font> ; <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">1</font> , <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) - <font color="#008000">1</font> ); <br>  } <br><br>  <font color="#cc6633">$ cityCode</font> = NULL; <br>  <font color="#696969">// first compare to exception cities</font> <br>  <font color="#0000ff">if</font> ( <font color="#cc6633">$ data</font> [ <font color="#008000">'exceptions_max'</font> ]! = <font color="#008000">0</font> ) <br>  <font color="#0000ff">for</font> ( <font color="#cc6633">$ cityCodeLen</font> = <font color="#cc6633">$ data</font> [ <font color="#008000">'exceptions_max'</font> ]; <font color="#cc6633">$ cityCodeLen</font> &gt; = <font color="#cc6633">$ data</font> [ <font color="#008000">'exceptions_min'</font> ]; <font color="#cc6633">$ cityCodeLen</font> -) <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.in-array.php">in_array</a> ( <a href="http://www.php.net/manual/en/function.intval.php">intval</a> ( <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#cc6633">$ cityCodeLen</font> )), <font color="#cc6633">$ data</font> [ <font color="#008000">'exceptions'</font> ])) <br>  { <br>  <font color="#cc6633">$ cityCode</font> = ( <font color="#cc6633">$ zero</font> ? <font color="#008000">"0"</font> : <font color="#008000">""</font> ).  <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#cc6633">$ cityCodeLen</font> ); <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#cc6633">$ cityCodeLen</font> , <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) - <font color="#cc6633">$ cityCodeLen</font> ); <br>  <font color="#0000ff">break</font> ; <br>  } <br>  <font color="#696969">// in case of failure with exceptions, cut the area code in accordance with the default length</font> <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.is-null.php">is_null</a> ( <font color="#cc6633">$ cityCode</font> )) <br>  { <br>  <font color="#cc6633">$ cityCode</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#008000">0</font> , <font color="#cc6633">$ data</font> [ <font color="#008000">'cityCodeLength'</font> ]); <br>  <font color="#cc6633">$ phone</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ phone</font> , <font color="#cc6633">$ data</font> [ <font color="#008000">'cityCodeLength'</font> ], <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ phone</font> ) - <font color="#cc6633">$ data</font> [ <font color="#008000">'cityCodeLength'</font> ]); <br>  } <br>  <font color="#696969">// return the result</font> <br>  <font color="#0000ff">return</font> ( <font color="#cc6633">$ plus</font> ? <font color="#008000">"+"</font> : <font color="#008000">""</font> ).  <font color="#cc6633">$ countryCode</font> .  <font color="#008000">'('</font> . <font color="#cc6633">$ cityCode</font> . <font color="#008000">')'</font> .phoneBlocks ( <font color="#cc6633">$ phone</font> ); <br>  } <br>  } <br>  <font color="#696969">// return the result without a country and city code</font> <br>  <font color="#0000ff">return</font> ( <font color="#cc6633">$ plus</font> ? <font color="#008000">"+"</font> : <font color="#008000">""</font> ) .phoneBlocks ( <font color="#cc6633">$ phone</font> ); <br>  } <br><br>  <font color="#696969">// the function turns any number into a string of format XX-XX -... or XXX-XX-XX -... depending on the parity of the number of digits</font> <br>  <font color="#0000ff">function</font> phoneBlocks ( <font color="#cc6633">$ number</font> ) { <br>  <font color="#cc6633">$ add</font> = <font color="#008000">''</font> ; <br>  <font color="#0000ff">if</font> ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ number</font> )% <font color="#008000">2</font> ) <br>  { <br>  <font color="#cc6633">$ add</font> = <font color="#cc6633">$ number</font> [ <font color="#008000">0</font> ]; <br>  <font color="#cc6633">$ add</font> . = ( <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ number</font> ) &lt;= 5? "-": ""); <br>  <font color="#cc6633">$ number</font> = <a href="http://www.php.net/manual/en/function.substr.php">substr</a> ( <font color="#cc6633">$ number</font> , <font color="#008000">1</font> , <a href="http://www.php.net/manual/en/function.strlen.php">strlen</a> ( <font color="#cc6633">$ number</font> ) - <font color="#008000">1</font> ); <br>  } <br>  <font color="#0000ff">return</font> <font color="#cc6633">$ add</font> .  <a href="http://www.php.net/manual/en/function.implode.php">implode</a> ( <font color="#008000">"-"</font> , str_split ( <font color="#cc6633">$ number</font> , <font color="#008000">2</font> )); <br>  } <br><br>  <font color="#696969">// tests</font> <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"+38 (044) 226-22-04"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"0038 (044) 226-22-04"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"+79263874814"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"4816145"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"+44 (0) 870 770 5370"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"0044 (0) 870 770 5370"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"+436764505509"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"(+ 38-048) 784-15-46"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"(38-057) 706-34-03"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#0000ff">echo</font> phone ( <font color="#008000">"+38 (044) 244 12 01"</font> ).  <font color="#008000">"&lt;br /&gt;"</font> ; <br>  <font color="#cc6633">?&gt;</font> </blockquote><br>  where <i>global $ phoneCodes;</i>  - the same array of information for all countries. <br><br>  <b>Will output</b> <br><blockquote><code>+380(44)226-22-04&lt;br/&gt;+380(44)226-22-04&lt;br/&gt;+7(926)387-48-14&lt;br/&gt;481-61-45&lt;br/&gt;+44(0870)770-53-70&lt;br/&gt;+44(0870)770-53-70&lt;br/&gt;+43(6764)50-55-09&lt;br/&gt;380(4878)415-46&lt;br/&gt;380(5770)634-03&lt;br/&gt;+380(44)244-12-01</code> </blockquote> <br>  <b>The function completely solves</b> the task. <br>  <b>Among the shortcomings of the function,</b> it is necessary to note the lack of analysis of slow areas for the purpose of optimization, as well as the processing of telephone numbers, where there is a city code, but no country code (in this case it is enough to beat the blocks with the <i>phoneBlocks</i> function or use one of the solutions above).  When using it in any implementation, it is necessary to replace the global variable with a reference in the parameter, and you can also refine or replace the output format for which the <i>phoneBlocks</i> function is <i>responsible</i> . <br><br><h4>  The most interesting </h4>  Using information from sites: <br>  <a href="">http://www.mtt.ru/info/def/index.wbp</a> <br>  <a href="http://www.hella.ru/code/codeuro.htm">http://www.hella.ru/code/codeuro.htm</a> <br>  <a href="http://www.scross.ru/guide/phone-global/">http://www.scross.ru/guide/phone-global/</a> <br>  I collected an array of data for all the countries represented, including exception cities, <i>zeroHack</i> flags, and mobile network codes.  The code can be downloaded <a href="https://github.com/mrXCray/PhoneCodes">here</a> . <br><br><h4>  Speed ‚Äã‚Äãperformance </h4>  Contrary to all the most pessimistic expectations, the code fulfills 10,000 numbers in less than 2 seconds. <br><br>  <b>UPD</b> Preparing amendments: <ol><li>  support for formatting patterns adopted within specific countries (‚Äúlocally-accepted‚Äù number mapping norms); </li><li>  adding a flag to indicate which country to format the number for; </li><li>  adding a parameter to specify the output format (in the case of personal preferences and exceptions); </li><li>  support for non-Latin letter numbers </li><li>  determining cell numbers and replacing brackets with spaces </li></ol>  <b>UPD:</b> Archive disappeared from the server, posted on <a href="https://github.com/mrXCray/PhoneCodes">https://github.com/mrXCray/PhoneCodes</a> Soon there will be an update on the amendments above + bonus. </div><p>Source: <a href="https://habr.com/ru/post/102352/">https://habr.com/ru/post/102352/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../102334/index.html">HTML5 Experiments</a></li>
<li><a href="../102336/index.html">Google is preparing a search interface that allows you to see results as you print the query.</a></li>
<li><a href="../102340/index.html">Google Live Search: searches as you type</a></li>
<li><a href="../102343/index.html">Twitter bookmarklet: share links from any page</a></li>
<li><a href="../102344/index.html">Ritmix is ‚Äã‚Äãnot just mp3 players</a></li>
<li><a href="../102357/index.html">Intellectual board SmartBoard 690</a></li>
<li><a href="../102360/index.html">How it was: Intel Summer School 2010 to the equator</a></li>
<li><a href="../102361/index.html">New digg (from the creators of digg.com) [+ distribution of invites]</a></li>
<li><a href="../102362/index.html">Install FAR in Ubuntu using Wine</a></li>
<li><a href="../102363/index.html">PI Design: Learning from the mistakes of others</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>