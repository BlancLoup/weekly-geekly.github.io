<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>C # console to run simple "scripts"</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Have you ever performed a massive file renaming, or some other, seemingly trivial, but routine task? Never created bat'niki, but you know C #? 

 Bein...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>C # console to run simple "scripts"</h1><div class="post__text post__text-html js-mediator-article">  Have you ever performed a massive file renaming, or some other, seemingly trivial, but routine task?  Never created bat'niki, but you know C #? <br><br>  Being in a similar situation, within 15 minutes a fairly simple application was created that looks like a console, but which understands C #. <br><br><img src="https://habrastorage.org/storage2/678/a6c/1cc/678a6c1cc6561c96d4733c352477cfe7.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  The application works on the principle of memorizing code, and executing the resulting script.  The script is supported from the file that appears in the directory with the application when it is first executed. <br><br>  The basic commands that are required to create a script through the console and execute it have been added: <br>  ! show - shows the memorized script entirely <br>  ! del - removes the last line in the script <br>  ! clear - erases the script <br>  ! run - executes the script and saves its contents to the file ‚Äúscript.cs‚Äù <br>  ! runsc - executes the script from the file ‚Äúscript.cs‚Äù (for the case if you are editing the file with a text editor) <br><br>  Source Program.cs (actually the entire application): <br><br><blockquote>  <font color="#0600FF">using</font> <font color="#008080">System</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">System.CodeDom.Compiler</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">System.Collections.Generic</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">System.IO</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">System.Reflection</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">System.Text</font> <font color="#008000">;</font> <br>  <font color="#0600FF">using</font> <font color="#008080">Microsoft.CSharp</font> <font color="#008000">;</font> <br><br>  <font color="#0600FF">namespace</font> SharpConsole <br>  <font color="#000000">{</font> <br>  <font color="#FF0000">class</font> program <br>  <font color="#000000">{</font> <br>  <font color="#0600FF">const</font> <font color="#FF0000">string</font> header <font color="#008000">=</font> <font color="#666666">@ "</font> <font color="#666666"><br></font>  <font color="#666666">using System;</font> <font color="#666666"><br></font>  <font color="#666666">using System.IO;</font> <font color="#666666"><br></font>  <font color="#666666">using System.Net;</font> <font color="#666666"><br></font>  <font color="#666666">using System.Threading;</font> <font color="#666666"><br></font>  <font color="#666666">using System.Collections.Generic;</font> <font color="#666666"><br><br></font>  <font color="#666666">namespace CScript</font> <font color="#666666"><br></font>  <font color="#666666">{</font> <font color="#666666"><br></font>  <font color="#666666">public class Script</font> <font color="#666666"><br></font>  <font color="#666666">{</font> <font color="#666666"><br></font>  <font color="#666666">public static void ScriptMethod ()</font> <font color="#666666"><br></font>  <font color="#666666">{</font> <font color="#666666"><br></font>  <font color="#666666">"</font> <font color="#008000">;</font> <br>  <font color="#0600FF">const</font> <font color="#FF0000">string</font> footer <font color="#008000">=</font> <font color="#666666">@ "</font> <font color="#666666"><br></font>  <font color="#666666">}</font> <font color="#666666"><br></font>  <font color="#666666">}</font> <font color="#666666"><br></font>  <font color="#666666">} "</font> <font color="#008000">;</font> <br><br>  <font color="#0600FF">static</font> <font color="#0600FF">void</font> Main <font color="#000000">(</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> args <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  Console.  <font color="#0000FF">Title</font> <font color="#008000">=</font> <font color="#666666">"SharpConsole"</font> <font color="#008000">;</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#666666">"Welcome to SharpConsole v0.1. Type! Help for help."</font> <font color="#000000">)</font> <font color="#008000">;</font> <br><br>  List <font color="#008000">&lt;</font> <font color="#FF0000">string</font> <font color="#008000">&gt;</font> code <font color="#008000">=</font> <font color="#008000">new</font> List <font color="#008000">&lt;</font> <font color="#FF0000">string</font> <font color="#008000">&gt;</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#0600FF">while</font> <font color="#000000">(</font> <font color="#0600FF">true</font> <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  Console.  <font color="#0000FF">Write</font> <font color="#000000">(</font> <font color="#666666">"csharp&gt;"</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#FF0000">string</font> line <font color="#008000">=</font> Console.  <font color="#0000FF">ReadLine</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#0600FF">switch</font> <font color="#000000">(</font> line <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! run"</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  <font color="#FF0000">string</font> program <font color="#008000">=</font> FormatSources <font color="#000000">(</font> code <font color="#000000">)</font> <font color="#008000">;</font> <br>  File.  <font color="#0000FF">WriteAllText</font> <font color="#000000">(</font> <font color="#666666">"script.cs"</font> , program <font color="#000000">)</font> <font color="#008000">;</font> <br>  ExecuteScript <font color="#000000">(</font> program <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! show"</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> FormatSources <font color="#000000">(</font> code <font color="#000000">)</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! del"</font> <font color="#008000">:</font> <br>  code.  <font color="#0000FF">RemoveAt</font> <font color="#000000">(</font> code. <font color="#0000FF">Count</font> <font color="#008000">-</font> <font color="#FF0000">1</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! clear"</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  code <font color="#008000">=</font> <font color="#008000">new</font> List <font color="#008000">&lt;</font> <font color="#FF0000">string</font> <font color="#008000">&gt;</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#666666">"Done."</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! runsc"</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  <font color="#FF0000">string</font> script <font color="#008000">=</font> File.  <font color="#0000FF">ReadAllText</font> <font color="#000000">(</font> <font color="#666666">"script.cs"</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  ExecuteScript <font color="#000000">(</font> script <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">case</font> <font color="#666666">"! help"</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> commands <font color="#008000">=</font> <font color="#008000">new</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> <br>  <font color="#000000">{</font> <br>  <font color="#666666">"1. Type your code in it</font> , <font color="#666666">"</font> <br>  <font color="#666666">"2.! Show will shows your code"</font> , <br>  <font color="#666666">"3.! Del remove last line from your code"</font> , <br>  <font color="#666666">"4.! Clear remove all lines from your code"</font> , <br>  <font color="#666666">"5.! Run will run the script in memory in script.cs"</font> , <br>  <font color="#666666">"6.! Runsc will run script.cs"</font> , <br>  <font color="#666666">"Have fun! :)"</font> , <br>  <font color="#000000">}</font> <font color="#008000">;</font> <br>  <font color="#0600FF">foreach</font> <font color="#000000">(</font> var str <font color="#0600FF">in</font> commands <font color="#000000">)</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> str <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#0600FF">default</font> <font color="#008000">:</font> <br>  <font color="#000000">{</font> <br>  code.  <font color="#0000FF">Add</font> <font color="#000000">(</font> <font color="#666666">""</font> <font color="#008000">+</font> line <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  break <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br><br><br><br>  <font color="#000000">}</font> <br>  <font color="#000000">}</font> <br><br>  <font color="#0600FF">private</font> <font color="#0600FF">static</font> <font color="#0600FF">void</font> ExecuteScript <font color="#000000">(</font> <font color="#FF0000">string</font> program <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  var CSHarpProvider <font color="#008000">=</font> CSharpCodeProvider.  <font color="#0000FF">CreateProvider</font> <font color="#000000">(</font> <font color="#666666">"CSharp"</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  CompilerParameters compilerParams <font color="#008000">=</font> <font color="#008000">new</font> CompilerParameters <font color="#000000">(</font> <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  GenerateExecutable <font color="#008000">=</font> <font color="#0600FF">false</font> , <br>  GenerateInMemory <font color="#008000">=</font> <font color="#0600FF">true</font> <br>  <font color="#000000">}</font> <font color="#008000">;</font> <br>  compilerParams.  <font color="#0000FF">ReferencedAssemblies</font> .  <font color="#0000FF">AddRange</font> <font color="#000000">(</font> <font color="#008000">new</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> <br>  <font color="#000000">{</font> <br>  <font color="#666666">"System.dll"</font> , <br>  <font color="#666666">"System.Core.dll"</font> , <br>  <font color="#666666">"System.Net.dll"</font> , <br>  <font color="#000000">}</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  var compilerResult <font color="#008000">=</font> CSHarpProvider.  <font color="#0000FF">CompileAssemblyFromSource</font> <font color="#000000">(</font> compilerParams, program <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#0600FF">if</font> <font color="#000000">(</font> compilerResult. <font color="#0000FF">Errors</font> . <font color="#0000FF">Count</font> <font color="#008000">==</font> <font color="#FF0000">0</font> <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#666666">"Executing ..."</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#0600FF">try</font> <br>  <font color="#000000">{</font> <br>  compilerResult.  <font color="#0000FF">CompiledAssembly</font> .  <font color="#0000FF">GetType</font> <font color="#000000">(</font> <font color="#666666">"CScript.Script"</font> <font color="#000000">)</font> .  <font color="#0000FF">GetMethod</font> <font color="#000000">(</font> <font color="#666666">"ScriptMethod"</font> <font color="#000000">)</font> .  <font color="#0000FF">Invoke</font> <font color="#000000">(</font> <font color="#0600FF">null</font> , <font color="#0600FF">null</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> <font color="#666666">"Done."</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  <font color="#0600FF">catch</font> <font color="#000000">(</font> Exception e <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> e. <font color="#0000FF">InnerException</font> . <font color="#0000FF">Message</font> <font color="#008000">+</font> <font color="#666666">"rn"</font> <font color="#008000">+</font> e. <font color="#0000FF">InnerException</font> . <font color="#0000FF">StackTrace</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  <font color="#000000">}</font> <br>  <font color="#0600FF">else</font> <br>  <font color="#000000">{</font> <br>  <font color="#0600FF">foreach</font> <font color="#000000">(</font> var oline <font color="#0600FF">in</font> compilerResult. <font color="#0000FF">Output</font> <font color="#000000">)</font> <br>  Console.  <font color="#0000FF">WriteLine</font> <font color="#000000">(</font> oline <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  <font color="#000000">}</font> <br><br>  <font color="#0600FF">private</font> <font color="#0600FF">static</font> <font color="#FF0000">string</font> FormatSources <font color="#000000">(</font> List <font color="#008000">&lt;</font> <font color="#FF0000">string</font> <font color="#008000">&gt;</font> code <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  <font color="#FF0000">string</font> program <font color="#008000">=</font> header <font color="#008000">;</font> <br>  StringBuilder sb <font color="#008000">=</font> <font color="#008000">new</font> StringBuilder <font color="#000000">(</font> program <font color="#000000">)</font> <font color="#008000">;</font> <br><br>  <font color="#0600FF">foreach</font> <font color="#000000">(</font> var sc <font color="#0600FF">in</font> code <font color="#000000">)</font> <br>  <font color="#000000">{</font> <br>  sb.  <font color="#0000FF">AppendLine</font> <font color="#000000">(</font> sc <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  sb.  <font color="#0000FF">AppendLine</font> <font color="#000000">(</font> footer <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#0600FF">return</font> sb.  <font color="#0000FF">ToString</font> <font color="#000000">(</font> <font color="#000000">)</font> <font color="#008000">;</font> <br>  <font color="#000000">}</font> <br>  <font color="#000000">}</font> <br>  <font color="#000000">}</font> </blockquote><br><br>  By default, when executing the script, 3 references are connected to the assembly: <br><br><blockquote>  compilerParams.  <font color="#0000FF">ReferencedAssemblies</font> .  <font color="#0000FF">AddRange</font> <font color="#000000">(</font> <font color="#008000">new</font> <font color="#FF0000">string</font> <font color="#000000">[</font> <font color="#000000">]</font> <br>  <font color="#000000">{</font> <br>  <font color="#666666">"System.dll"</font> , <br>  <font color="#666666">"System.Core.dll"</font> , <br>  <font color="#666666">"System.Net.dll"</font> , <br>  <font color="#000000">}</font> <font color="#000000">)</font> <font color="#008000">;</font> </blockquote><br><br>  But you can add others for your needs. <br><br>  VS project: <a href="">download</a> <br><br>  I hope it will be useful to someone!  I will be glad to answer questions. </div><p>Source: <a href="https://habr.com/ru/post/170385/">https://habr.com/ru/post/170385/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170369/index.html">Build a large HTPC / NAS based on Ivy Bridge</a></li>
<li><a href="../170371/index.html">IPoE problem</a></li>
<li><a href="../170373/index.html">180 VPS history</a></li>
<li><a href="../170375/index.html">Creating your own control based on TabControl in C #</a></li>
<li><a href="../170379/index.html">About great bikes, or why sometimes you need to write from scratch</a></li>
<li><a href="../170389/index.html">Basics of thin allocation of volumes on storage systems (or anniversary 3PAR thin provisioning)</a></li>
<li><a href="../170391/index.html">Unusual reflections on intellectual property rights</a></li>
<li><a href="../170397/index.html">W3 conference. Video broadcast. Second day</a></li>
<li><a href="../170401/index.html">Moving time on the fly for JVM</a></li>
<li><a href="../170403/index.html">FaceCode. Plugin for SublimeText2 (Linux OS)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>