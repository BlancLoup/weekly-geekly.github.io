<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pulling out Direct from all information about competitors campaigns</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the article by Evgeny Cheskidov ‚ÄúYandex. Direct. Analyzing the competitive environment ‚Äù I want to show how, using not very complic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pulling out Direct from all information about competitors campaigns</h1><div class="post__text post__text-html js-mediator-article">  In continuation of the article by Evgeny Cheskidov <a href="http://habrahabr.ru/blogs/context/107790/">‚ÄúYandex.</a>  <a href="http://habrahabr.ru/blogs/context/107790/">Direct.</a>  <a href="http://habrahabr.ru/blogs/context/107790/">Analyzing the competitive environment ‚Äù</a> I want to show how, using not very complicated calculations and the Yandex API, to pull literally all the information about competitors' advertising campaigns from Yandex.Direct.  I‚Äôll say right away that the idea hasn‚Äôt been tested in practice yet, the very fact of having all the information and, accordingly, the possibility of this calculation was shown by Cheskidov only yesterday, and the algorithm was born literally now.  But mathematically everything seems to fit.  Carefully, under the cut a lot of formulas. <br><a name="habracut"></a><br><h4>  1. To begin with, we introduce the notation: </h4><br>  <b>i</b> is the ordinal number of the ad on the "show all advertising results" page. <br><br>  <b>b</b> [i] = bid, while the unknown maximum bid for the i-th ad.  It follows from the rules of Yandex.Direct that <br>  20 ‚â• b [1] ‚â• b [2] ‚â• b [3] ‚â•‚Ä¶ ‚â• b [i] ‚â• b [i + 1] ‚â•‚Ä¶ ‚â• 0.01 (1) <br><br>  <b>c</b> [i] - while unknown to us CTR of the i-th announcement, 0.01 ‚â§ c [i] ‚â§ 1.0 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>a</b> [i] is the ‚Äúeffective bid‚Äù by which ads in the SERP are sorted, by definition <br>  a [i] = b [i] ‚àô c [i] (2) <br><br>  <b>o</b> [i] - position of the i-th announcement in the SERP (search results page).  The order in the SERP is determined by a, and not by b, therefore, in the general case, o [i] ‚â† i.  This fact is discussed in detail in the article by Cheskidov. <br><br>  <b>r</b> [j] - is the inverse function to o [i], that is, r [o [i]] = o [r [i]] = i.  Physically, this is the ad index i, which occupies the j-th position in the SERP, if we assume that there are ads with numbers j = 1 ... 3 in the special placement, and in the right-hand block - with numbers j = 4 ... 10. <br><br>  From the rules of the competition of the Directive in issuing SERPa, we know that <br>  a [r [1]] ‚â• a [r [2]] ‚â•‚Ä¶ ‚â• a [r [j]] ‚â• a [r [j + 1]] ‚â•‚Ä¶ (3) <br><br>  <b>s</b> [i] is the number of impressions strategy for close key phrases selected for the i-th ad: <br>  ‚Ä¢ s [i] = 0, if the phrase without quotes and negative keywords is used as the key phrase <br>  ‚Ä¢ s [i] = 1 if the keyword phrase with negative keywords is used <br>  ‚Ä¢ s [i] = 2, if you use the keyword phrase in quotes <br>  The case s [i] = 2 can be determined by noting the absence of an ad for a key phrase with a non-existent word, for example, [pink elephants fv243ae].  To determine the case of s [i] = 1, you need to find in the WordState the most obvious (frequency) negative keyword for the query and check the availability of an ad on request with this negative word, for example [pink elephants free]. <br><br>  For the ‚Äúbudget forecast‚Äù for each strategy s, one can pull out the averaged values ‚Äã‚Äãof the initial conditions b0, c0 and, accordingly, a0: <br>  b0 [s, 1] - forecast of the price of the first place in the special placement <br>  b0 [s, 3] - forecast for the price of entry to the special placement <br>  c0 [s, 3] - CTR forecast in special placement <br>  b0 [s, 4] - first place price forecast <br>  c0 [s, 4] - first place CTR forecast <br>  b0 [s, 10] - forecast of the entrance price to guaranteed impressions <br>  c0 [s, 10] - CTR forecast in guaranteed impressions. <br><br>  Once again, we note that these are averaged forecasts, and not real values ‚Äã‚Äãof parameters, that is, <br>  b0 [s, i] ‚â† b [i] for all i&gt; 1 <br><br>  But it can be argued that the effective rate a [i] in the forecast is exactly equal to the real effective rate of the i-th place, i.e. <br>  a0 [s [i], i] = a [r [i]], and more specifically <br><br>  a0 [s [3], 3] = a [r [3]] (4) <br>  a0 [s [4], 4] = a [r [4]] (5) <br>  a0 [s [10], 10] = a [r [10]] (6) <br><br>  Finally, let us denote by <b>K</b> [s] the total number of requests per month for the key phrase for each strategy. <br><br><h4>  2. The statistical model of the user Yandex </h4><br>  How does a person view a results page?  Reads the first ad, with some probability <b>p</b> clicks on it, otherwise reads the second ad, again with some probability clicks, and so on.  We translate this into the language of formulas and denote by Xi a discrete event equal to 1 if the user clicked on the i-th declaration, and 0 if not clicked: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/176/dd8/065/176dd8065b2452053cd8f225672634c8.png" alt="image"><br><br>  Since the SERP is viewed by thousands of users, such events are independent.  Mathematicians have proved that in such a model, the probability of a click on the i-th position obeys the <a href="http://ru.wikipedia.org/wiki/%25D0%2593%25D0%25B5%25D0%25BE%25D0%25BC%25D0%25B5%25D1%2582%25D1%2580%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25BE%25D0%25B5_%25D1%2580%25D0%25B0%25D1%2581%25D0%25BF%25D1%2580%25D0%25B5%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5">law of geometric distribution</a> and is equal to <br><br>  <b>P</b> (n) = p ‚àô (1-p) <sup>n</sup> , (7) <br>  where n is the number of the announcement, starting from zero, and <b>p</b> is a certain parameter depending on the specific keyword phrase. <br><br>  By itself, the P (n) function is not yet a CTR, since it only takes into account the position of the ad on the page.  In Direct, the CTR is also affected by the sample for which a particular ad is shown (that is, the impression strategy), the position history (accumulated CTR), and the quality of the ad itself.  History can be gained by systematically scanning the SERP.  As for the quality of the ads themselves, in competitive topics it is about the same, and, as users do not read the output, and view it diagonally, it does not play a big role. <br><br>  Translating from mathematical to Russian, an ad for the 8th position cannot have a CTR of 70% or at least 20%.  And vice versa, you, of course, can place a disgusting advertisement in the first place of special placement and ‚Äúcrush money‚Äù, but whatever your budget, as the statistics from the CTR users of this ad fall, you will inevitably fall first from the first place, and then generally from the shows. <br>  So in this article, for simplicity, I will consider the CTR as a function of position and strategy.  Interested readers can take into account such factors as the history of a change in positions, the occurrence of a key phrase in the ad text, or the relevance of the ad text to the other ads on the page. <br>  It should be noted that there is still a slight fatal discrepancy between theory and practice: in mathematics, the sequence is assumed to be infinite, and the actual output is limited.  This leads to the fact that the actual CTR of the most recent announcements in the block is slightly overestimated relative to the theoretical probability. <br>  To make it at least a little clear what was discussed in the previous paragraphs, here are two graphs: <br><br>  The first one shows a graph of CTR dependence on the position from the <a href="http://download.yandex.ru/company/experience/cybermarketing2009/Sadovskiy-Search.pdf">report by Alexander Sadovsky</a> : <br><img src="https://habrastorage.org/storage/habraeffect/d4/03/d403156328b130c52fbe3217e9d728d2.jpg" alt="CTR"><br><br>  The second graph shows the probability function for the geometric distribution with different parameters p (from Wikipedia) <br><img src="https://habrastorage.org/getpro/habr/post_images/cf9/cbf/726/cf9cbf726e86bb5f131ec19ac31c1afc.jpg" alt="image"><br><br><h4>  3. Calculation of theoretical CTR </h4><br>  Knowing for each ad its position and strategy, we need to estimate the expected CTR of this ad, that is, calculate the parameter p from formula (7). <br><br>  For the right block, everything is simple, the expected CTR of the first place in the right block is given to us by Yandex, that is, <br><br>  pr [s] = c0 [s, 4] (8) <br>  which must be calculated for all strategies s. <br><br>  Knowing pr, we can calculate theoretical values ‚Äã‚Äãof c1 for all i using the formula <br><br>  c1 [s, r [i]] = pr [s] ‚àô (1 - pr [s]) <sup>r [i] -4</sup> (9) <br><br>  For the upper block (there is another parameter p), everything is a bit more complicated, since Yandex does not disclose the CTR value for the third ad, not for the first announcement in special allocation.  We'll have to look for a math reference book and solve a cubic equation <br><br>  p <sup>3</sup> - 2p <sup>2</sup> + p - c0 [s, 3] = 0 (10) <br><br>  Further, similar to (8), only the exponent will be r [i] -1. <br><br><h4>  4. Putting the system of equations. </h4><br>  We write out expressions (1) and (3) in the form of a system of ordinary inequalities <br>  b [1] ‚â• b [2] <br>  b [2] ‚â• b [3] <br>  ... <br>  b [9] ‚â• b [10] <br><br>  b [r [1]] ‚àô with [r [1]] ‚â• b [r [2]] ‚àô c [r [2]] <br>  b [r [2]] ‚àô with [r [2]] ‚â• b [r [3]] ‚àô c [r [3]] <br>  ... <br>  b [r [9]] ‚àô with [r [9]] ‚â• b [r [9]] ‚àô c [r [9]] <br><br>  (for the case with N = 10 ads) <br><br>  <i>Note:</i> we will not be able to solve the system, if there are more than 10 ads - we simply will not see the ‚Äúsecond page of direct‚Äù and will not know the relationship between a [r [i]] for i&gt; 10.  Ads-outsiders will have to throw out the calculations. <br><br>  Add to the system the boundary conditions on b and c and the initial values ‚Äã‚Äãgiven by equations (4) ... (6). <br><br>  Thus, we obtain a system of second-order inequalities with 2N unknowns, 3N inequalities, and three equations.  The property of this system is such that for each pair of unknowns b [i], c [i] there is a small hyperbolic region in which these parameters can change without violating the conditions of inequalities. <br>  To resolve this uncertainty, we need to add additional restrictions on b and c in such a way that b [i] tend to zero while maintaining positions (no one will overpay just like that), and c [i] tend to theoretically expected values. <br>  With these additional restrictions, we will not be able to find the real value of the maximum bids, but only the minimum required values ‚Äã‚Äãfor the ads to take their place.  In practice, this means that if the most expensive ad has a bid of $ 10, but in reality for the first place you need only $ 3.01, we will find the value of 3.01.  But in our case it does not matter, because Yandex already tells us the highest bid for a keyword, and all other bets are consistently lower than the previous one. <br><br>  We introduce a ‚Äúpenalty function‚Äù into the system ‚Äî a measure indicating how far the approximate solution does not satisfy our conditions. <br>  The structure of the penalty function will be something like this: <br>  1. A large penalty for failure to comply with inequalities (1) (ordering b [i]), a small penalty for over-fulfilling these inequalities; <br>  2. Large penalty for failure to comply with inequalities (2) (ordering a [i]), zero penalty for their implementation. <br>  3. A very large penalty for non-compliance with the boundary conditions on c [i] <br>  4. A large penalty for non-compliance with equations (4) ... (6). <br>  5. Some penalty for deviation of c [i] -th from theoretical values. <br><br>  Thus, we obtain the usual problem of optimizing the penalty function, that is, searching for such values ‚Äã‚Äãof b [i] and c [i], for which the value of the penalty function will be minimal.  Algorithms for finding such a solution have long been known from the section of mathematics, which is called ‚Äúoptimization methods‚Äù.  Applying the appropriate algorithm, we will eventually get the values ‚Äã‚Äãof b [i] and c [i], that is, the rates and CTR for all competing ads. <br><br><h4>  5. PROFIT! </h4><br>  Now the most interesting thing: knowing for each ad the rate, CTR, strategy and number of impressions K [s], we can estimate the maximum monthly budget of each ad for this keyword.  Knowing CTR and K [s] - estimate the number of conversions and, thus, the targeted traffic on the competitor's site.  And knowing the budget and the number of transitions, we can estimate the cost of each transition, that is, the quality of setting up an advertising campaign.  Knowing the quality of the advertising campaign, we can make far-reaching conclusions, which, however, are no longer described by any mathematics) <br><br>  Finally, knowing the semantic core of the domain and connecting to the direct via the API, we can calculate the total budget of all advertising campaigns of competitors across the core in almost automatic mode.  ‚ÄúAlmost‚Äù - because the core and negative keywords will still have to be manually selected. <br>  And knowing the real budgets of all competitors ... well, you understand. <br><br>  In general, Yandex provided all the information to play with open eyes. <br>  Here is such an applied Data Mining in action. </div><p>Source: <a href="https://habr.com/ru/post/107898/">https://habr.com/ru/post/107898/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../107892/index.html">HackDay # 8 in Yaroslavl November 20-21</a></li>
<li><a href="../107893/index.html">Configuring a Canon LBP3010 Printer in Ubuntu 10.10</a></li>
<li><a href="../107894/index.html">Complete Genomics goes IPO</a></li>
<li><a href="../107895/index.html">Tomorrow the start of open domain registration. RF</a></li>
<li><a href="../107896/index.html">Budget router Dlink dir-615, alternative firmware DD-WRT and IPTV</a></li>
<li><a href="../107900/index.html">Ask.com closes search service</a></li>
<li><a href="../107901/index.html">Questions to Vladimir Ofitserov (worked at Inktomi, Yahoo, Yandex, Google)</a></li>
<li><a href="../107903/index.html">Telephony on Cisco (Call Manager Express) - Part 2</a></li>
<li><a href="../107905/index.html">Download content via YQL</a></li>
<li><a href="../107906/index.html">Published a stop list of domains. RF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>