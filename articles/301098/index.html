<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ACM ICPC Live Webcast: How it works</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About championship 
 ACM ICPC International Olympiad is the largest event among the team student programming competitions in the world. The Olympiad h...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ACM ICPC Live Webcast: How it works</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/spbifmo/blog/301098/"><img src="https://habrastorage.org/files/a2b/5fd/84d/a2b5fd84dc5040fca4e371ac31904ba8.png" width="700"></a> <br><br><h4>  About championship </h4><br>  ACM ICPC International Olympiad is the largest event among the team student programming competitions in the world.  The Olympiad has been held since the 70s (at that time it was more like a competition between US universities), since the late 90s other countries have been actively participating in it.  ITMO University in 2015 became the six-time winner of ACM ICPC. <br><br>  Naturally, interest in the Olympiad is shown not only by the participating universities themselves, but also by thousands of people around the world.  And in order for ACM ICPC to be not a ‚Äúchamber‚Äù event for the participants and their coaches, there is an online broadcast of the Olympiad final, which can be watched ‚Äúlive‚Äù even after the event (the broadcast of the 2015 final can be viewed <a href="https://www.youtube.com/watch%3Fv%3DxIvFJYo9928">here</a> ).  We will tell today ‚Äúfirst-hand‚Äù on behalf of its organizers about how the broadcast is organized, what interesting technical solutions are used in its process. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  ACM ICPC Broadcast History </h4><br>  For the first time, the online broadcast of the World Cup final was presented in 2009 in Stockholm.  From 2009 to 2012, the team of the Sustainable Communications Center of the Royal Institute of Technology (Sweden) was involved in broadcasting.  Their specialty was remote video editing, but the shooting and transmission was carried out in the traditional video way: SDI cameras and video editing. <br><br><img src="https://habrastorage.org/files/b19/db2/a65/b19db2a652b146df845e04fa5f0829c3.png"><br><br>  <i>It looked like a studio in 2011</i> <br><br>  However, ACM ICPC is a programming competition, and besides standard cameras on the site, which provide video for broadcast, a webcam is installed on each computer of the team, which streams the video of the team throughout the competition.  In addition, the script launched in the background on the computers of the teams records and similarly transmits the screencast of each command. <br><br><img src="https://habrastorage.org/files/23f/55a/e8a/23f55ae8ae70410b9ce6490e519a707a.png"><br><br>  <i>Studio in 2012 - work is still being done in the traditional way</i> <br><br>  Therefore, when the ITMO University team began to answer for the online broadcast of the championship, it was decided to switch from standard video production technologies to more interesting solutions - streaming broadcast on Youtube and twitch, using powerful computers and VLC / ffmpeg for video editing and editing (as opposed to the previously used hardware solutions from Blackmagic). <br><br>  This decision was made primarily due to the fact that the ACM ICPC finals are held in different countries every year, so the transportation of purchased equipment can be a significant problem for the organizers.  In addition, the software for broadcasting can be used in other competitions. <br><br><h4>  Diagram of the broadcast device: the stage of receiving content </h4><br><h5>  Technology and Hardware </h5><br>  The competition system provides us with a stream of webcams and a screen of all teams that participate in the competition, a feed of parcels from participants (the parcel is a solution to the problem sent for review), including the jury's verdict. <br><br>  For shooting general views of the hall, two AXIS V5915 network PTZ cameras are used.  This camera allows you to shoot video in 1080p resolution and is regulated using a web interface.  In order to power the cameras installed in hard-to-reach places, we use PoE-injectors (this is a convenient way to supply power to network devices: a standard power supply is connected to the PoE-injector, the injector itself is connected to the Ethernet cable, and then connect the camera, while the power will be transmitted via Ethernet-cable). <br><br><img src="https://habrastorage.org/files/585/9a8/0d6/5859a80d603f411e995e812c4bb8ce87.png" width="250" align="left"><br><br><img src="https://habrastorage.org/files/c65/064/eeb/c65064eeba58445b9c61f87d84b6e9a7.png" width="250"><br><br>  In addition to the above, we use four portable video cameras, the signal from which is transmitted using four <a href="http://teradek.com/pages/clip">Teradek Clip</a> , powered by SWIT batteries (they can work on these batteries during the entire contest). <br><br><img src="https://habrastorage.org/files/ef0/52e/097/ef052e097af24d76a0bd2773e9599a03.png" width="250" align="left"><br><br><img src="https://habrastorage.org/files/2f9/95e/2eb/2f995e2ebcee4fb78defee02cd2d2030.png" width="250"><br><br>  On the basis of one of the Clip'ov we collected a mobile complex.  It is a backpack with batteries, on one of the straps of which with the help of Velcro Clip and GoPro is attached.  We plan to wear it on a volunteer who distributes balls to teams. <br><br><img src="https://habrastorage.org/files/d31/1b5/424/d311b54241e24cff8a940065a0c4eaa7.jpg" width="400"><br><br>  <i>Balloons are distributed to teams for correctly solved tasks.</i> <br><br><h5>  ICPC Analytics </h5><br>  The team of analysts is constantly developing its Katalyzer application, which receives not only the parcel log, but also regular backups from the participants' computers.  Their analysis allows us to understand what task the team is working on (for example, if the a.cpp file is being actively modified, most likely on task A).  In addition, analysts are watching the screens of the leading teams, they know who is in the team in which programming language they write, and they regularly evaluate everything that happens. <br><br><h5>  Team </h5><br>  The video group employed during the online broadcast consists of ten videographers, who in turn provide us with video from the venue of the championship and flash-zone for live interviews, as well as a recording of the analysis of tasks. <br><br><img src="https://habrastorage.org/files/0b4/f41/57b/0b4f4157b9544f61ad1b63502347eae5.png" width="700"><br><br>  <i>Hall for the championship</i> <br><br>  The team of analysts usually consists of fifteen people who (besides preparing and recording analyzes) watch interesting events from the autoanalyzer ( <a href="https://github.com/icpc-live/autoanalyst">AutoAnalyst</a> is an application designed specifically for the ACM ICPC championship, tracking the list of packages, backups of computers and screens of participants) and add interesting news to the event log manually.  In addition, analysts prepare in advance for each team and for each participant a profile that we show when presenting the team. <br><br><img src="https://habrastorage.org/files/632/767/6b9/6327676b9a6d434eb73ccfa8237fbc69.png" width="700"><br><br>  <i>Peking University team.</i>  <i>Shot from the championship broadcast</i> <br><br>  The ICPCLive team consists of fifteen people - director, director, designer, programmers, video editors.  If everything goes well, during the competition it remains only to choose which teams' screens to show at what point, add new videos to the schedule and connect the view from the most interesting camera in time. <br><br><h5>  Optional: media service rollers and video footage </h5><br>  In the online broadcast, we use pre-recorded video.  They include the videos of the ICPCNews media service (these videos are further <a href="https://www.youtube.com/user/ICPCNews/videos">available</a> on their youtube channel), interviews of key people, championship favorites and sponsors.  Most of these videos are recorded in advance. <br><br>  With video of tasks, the situation is different.  The conditions of the tasks are an object of increased secrecy, so the recording of video footage begins simultaneously with the start of the competition, when all teams are already reliably isolated from the outside world on the court.  Analysts prepare, record and, together with ICPCNews, assemble the analyzes and broadcast them, the director decides when to put them on the air. <br><br><h4>  Content Processing Phase </h4><br><h5>  Technology and Hardware </h5><br>  Our video stream can be divided into two completely different parts: a picture from the cameras and an infographic that is overlaid on top with the help of a standard chroma key.  Let's start with the simplest, namely with the cameras.  To control the flow of information from them, the easiest and most reasonable solution for us was the external <a href="http://telestream.net/wirecast/">Wirecast</a> software. <br><br>  Wirecast turned out to be surprisingly convenient for downloading pre-recorded videos using the API, which we also used to schedule the upcoming videos.  At the same time, Wirecast is relatively inexpensive, especially if you compare the cost of software with the payment of contractor services during the broadcast. <br><br>  The entire infographics for the project is also created in-house, by the team.  Java was chosen as the programming language.  At the same time, the simplest solution in terms of creating infographics turned out to be the most elegant at the same time - all graphics are drawn on the canvas;  widgets are redrawn every 1/25 second.  As for the small video blocks in the corner of the screen, for their creation we managed the vlcj library, which is a Java wrapper for the native function call of the vlc player. <br><br>  The main difficulty in working with a video stream is not in creating one or another of its components, but in managing them.  Last year, management was conducted through standard Java forms that reported tcp information to infographics.  In the same year we went further and wrote a special http-server that supports changes from several users at the same time and gives all the information (what and how to show) on a tcp computer drawing an infographic. <br><br><img src="https://habrastorage.org/files/a2b/5fd/84d/a2b5fd84dc5040fca4e371ac31904ba8.png" width="700"><br><br>  <i>What it looks like: video plus infographics</i> <br><br>  After reviewing the existing frameworks for writing Java http servers, we chose <a href="https://vaadin.com/home">Vaadin</a> .  Perhaps this solution was not optimal, as in the process of working with the framework, there were occasional problems with the streams and the network.  However, in the end we managed to solve them and get a distributed system that allows anyone (with a login and password) to influence the output image. <br><br>  For those who want to get a similar exotic experience in the future, it makes sense to highlight the small technical difficulties that we encountered: <br><br><ul><li>  Streaming video over the network does not load instantly, so we had to set 3 to 10 seconds of waiting before the show to the viewer. </li><li>  The infographic in the form of overlay was not so easy to transfer with a sufficient number of frames per second because of our desire to broadcast the picture in Full-HD.  Therefore, for its transmission to Wirecast, we used not a software, but a hardware (at the same time, quite expensive) <a href="http://www.epiphan.com/products/dvi2usb-3-0/">solution</a> that simply takes an HDMI image from the monitor.  For home solutions, we recommend getting rid of the animations of the appearance of overlays, generate them at a lower resolution and use vlc to capture video. </li><li>  Wirecast is extremely demanding of resources, and the process of encoding video for sending to Wowza "eats" a lot of RAM, so we carried it out to another computer through a similar device. </li></ul><br><h5>  Split Screen Mode </h5><br>  Last year, as well as in this one, the second screen has two control modes.  Initially, as part of last year‚Äôs contest, we launched an automatic mode that operates according to the following logic: <br><br><ul><li>  The team could get on the screen for about 10 seconds (this is the very reaction after getting the result) if she passed the task. </li><li>  When there were no packages, the webcams of the first 12 teams were displayed in a circle, approximately 20 seconds each.  These 12 teams were selected at the beginning of the championship as the most interesting. </li></ul><br>  During the first hour of the contest, it became clear that this algorithm did not meet the requirements of the audience at all: the majority were not interested in the first 12 teams, while everyone was much more interested in looking at the code, and not watching the work of the teams on the webcam.  Therefore, we decided to switch Split Screen to manual mode: we ourselves watched comments on youtube, twitch and twitter, and chose which commands to show. <br><br>  Therefore, this year this direction has undergone the greatest changes.  First, now the viewer always sees two video streams - one from the screen and the other from a webcam;  in most cases, the ‚Äúbig‚Äù video will contain code. <br><br>  Secondly, this year we are testing automatic ‚Äúvoting‚Äù for a team that will work according to the following algorithm: it tracks twitter messages from # ICPC2016, ‚Äúpulls out‚Äù the first hashtag corresponding to the command on the <a href="http://myicpc.icpcnews.com/World-Finals-2016/teams">myicpc</a> website and increases the number of votes for the selected command per unit. <br><br><img src="https://habrastorage.org/files/667/b2d/c21/667b2dc21da84ec1b09eec0e5ca51983.jpg" width="700"><br><br>  <i>ITMO-2016 University team: Adam Bardashevich, Anton Kovsharov, Andrey Stankevich (coach) and Vladimir Smykalov</i> <br><br>  When the number of votes for a team reaches 5, it is added to the queue at the show (the command is never added to the queue twice, and if the command is in the queue, then the number of votes for it does not increase).  To reduce the automatic tamping of votes, we plan to count only one tweet per user per minute.  Third, in addition to user automation, we still plan to show the first 12 teams at some points. <br><br><h4>  Stage of content output to the network </h4><br>  Since we needed to ensure broadcasting not only to the Internet, but also to the internal network at the competition (out of 1,500 Olympiad participants, only 384 compete, the rest - coaches, guests, organizers - follow the competition), we decided to use the Wowza server as an intermediary which the video stream came from Wirecast, then transmitted to clients.  Among other things, it solved the problem of recording video on a disk and made it possible to assemble a commentary studio without too much difficulty. <br><br>  There will be two commentator studios this year: one for English-language comments, the other for Russian speakers.  At the same time, as part of the experiment, we decided to assemble them with the help of various equipment: for the ‚ÄúEnglish‚Äù studio we purchased good headsets and an audio console, and the ‚ÄúRussian‚Äù studio would be made from the cheapest materials at hand.  The main point of the experiment is to check what is really important for ensuring high-quality broadcasting and what is not.  In the future we plan to make more localized commentary studios. <br><br>  For the Wowza server and the two main streams (the main stream with Wirecast and the second with Split Screen) we use MSI GE 62 Apache pro loaded ‚Äúto the eye‚Äù.  To each of them we generously added usb 3.0 and HDMI splitters. <br><br>  From the point of view of the software, both studios will work in the same way: ffmpeg will be launched on them, which takes the video stream from Wowza, adds sound from the microphones and transmits the received video stream with comments back to Wowza.  For example, the following is a line that adds audio commentary to a ready stream: <br><br><pre><code class="bash hljs">ffmpeg -re -i <span class="hljs-string"><span class="hljs-string">"rtmp://%ip%:1935/icpclive/main"</span></span> -f dshow -i audio=<span class="hljs-string"><span class="hljs-string">"Microphone"</span></span> -filter_complex <span class="hljs-string"><span class="hljs-string">"[0:a][1:a]amerge,pan=stereo:c0&lt;c0+2*c2:c1&lt;c1+2*c3[out]"</span></span> -map 0:v -map <span class="hljs-string"><span class="hljs-string">"[out]"</span></span> -vcodec copy -acodec aac -ab 100000 -ac 2 -f flv rtmp://%ip%:1935/icpclive/comments/rus</code> </pre> <br><br><h4>  What had to change </h4><br>  In 2015, when our ICPCLive development team made an online broadcast for the first time, working with mobile cameras and final editing was carried out by the hands of contractors.  It turned out that only one additional node between the director and the video editing significantly impairs the quality of the channel.  To control the sound in 2015, an application was used on the iMac - as it turned out, clicking the mouse to select the sound channel turned out to be inconvenient and too slow, so this year we use audio controls. <br><br>  Initially, as HDMI2WiFi transmitters, we did not use Teradek Clip, but their <a href="http://teradek.com/pages/vidiu">Teradek Vidiu</a> ‚Äúrechargeable brothers‚Äù, but we encountered an interesting feature.  When streaming video on a local network, you can use one of many different data transfer protocols.  A computer, for example, using the ffmpeg command can ‚Äúraise‚Äù an http stream on itself, which will be available to computers on the local network. <br><br>  However, it is quite difficult to ‚Äúshove‚Äù into the size of a portable transmitter the capabilities of streaming hosting, therefore, transmitters are often limited to supporting the RTMP protocol, which is designed to transmit the stream to the restrimer. <br><br>  As a restramer, Wowza used by us is perfectly able to act, but it turned out that the transmission of an RTMP stream through Wowza creates a delay of about ten seconds, which we were not ready to go to, and in addition, two such streams load the monster computer with the Wowza server up to 70% CPU, which did not leave this option no chance of survival. <br><br><h4>  ICPCLive and New Broadcast Format </h4><br>  Usually the live broadcast of events consists of kilometers of SDI-wires and ready-made hardware solutions that allow you to switch the signal, embed the picture in the picture and mix the sound correctly.  This makes online broadcasting services very expensive, virtually accessible only to the units of companies in each country that have the appropriate equipment. <br><br>  Using Wi-Fi and computers for the entire broadcast chain makes it ultra-portable - we can look at the camera where the wires do not reach, automatically show the most interesting things during the competition, show the screens and webcams of interesting teams to viewers and make special broadcasts for the competition. different languages. <br><br>  The code for our great project is <a href="https://github.com/Aksenov239/icpc-live-v2">here</a> . <br><br>  Have questions?  Want to help?  Email us at icpc-live-team@googlegroups.com! <br><br>  On the morning of May 19, connect to the live broadcast of the ACM ICPC 2016 student team championship on programming on <a href="http://icpclive.com/">ICPCLive</a> , subscribe to <a href="https://www.youtube.com/icpclive">youtube</a> and twitch channels (English broadcast <a href="https://www.twitch.tv/icpclive1">here</a> , Russian - <a href="https://www.twitch.tv/icpclive_ru">here</a> , second screen - <a href="https://www.twitch.tv/icpclive2">here</a> ) - we promise spontaneous inclusions and the most interesting details. <br><br>  And, of course, support ITMO University! </div><p>Source: <a href="https://habr.com/ru/post/301098/">https://habr.com/ru/post/301098/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301084/index.html">The evolution of neural networks for image recognition in Google: GoogLeNet</a></li>
<li><a href="../301086/index.html">Google turns its data centers into works of art.</a></li>
<li><a href="../301092/index.html">Urho3D: Post Effects</a></li>
<li><a href="../301094/index.html">Deterministic number factorization method based on mod 6 and mod 4</a></li>
<li><a href="../301096/index.html">Recognize faces in the photo using Python and OpenCV</a></li>
<li><a href="../301100/index.html">How successful people cope with procrastination</a></li>
<li><a href="../301102/index.html">Methods for determining whether a point belongs to a polygon</a></li>
<li><a href="../301104/index.html">"Hackers and Artists". How we have been translating all the runet Paul Graham for 13 years</a></li>
<li><a href="../301106/index.html">Features of the distribution of the wage fund in large enterprises of the Russian Federation</a></li>
<li><a href="../301108/index.html">The life of great bugs Microsoft Exchange (and not only)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>