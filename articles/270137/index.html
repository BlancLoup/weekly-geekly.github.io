<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Start using Rust</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Recently, I began to learn the beautiful language Rust. I see practical application of this language for myself in embedding code into criti...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Start using Rust</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/ead/446/897/ead446897dd3461d9d25bab26a17dd8f.png"><br><br>  Hello! <br><br>  Recently, I began to learn the beautiful language Rust.  I see practical application of this language for myself in embedding code into critical places of performance (at least until the moment of ‚Äúripening‚Äù and fouling with libraries and frameworks). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To consolidate the theoretical skills, I decided to make a small project, the essence of which is as follows: the dynamic library on Rust implements a simplified version of the <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D1%2588%25D0%25B8%25D0%25BD%25D0%25B3%25D0%25BB%25D0%25BE%25D0%25B2">Shingle algorithm</a> and, through FFI, allows you to connect it (the library).  Anyone interested is asking for cat. <br><a name="habracut"></a><br>  First, a little theory - what is FFI?  Here is my free translation of the material from the <a href="https://en.wikipedia.org/wiki/Foreign_function_interface">English-language Wikipedia</a> : <br>  FFI (Foreign function interface) is a mechanism that allows to execute code written in one language with another (language).  The term comes from the Lisp programming language (more precisely, its Common Lisp dialect), also called Haskell and Python.  In Java, it is called JNI (Java Native Interface) or JNA (Java Native Access). <br><br>  In most cases, FFI is declared in high-level languages ‚Äã‚Äã(python, ruby, js), so that it is possible to use the service declared and implemented in a low-level language (C, C ++).  This allows one programming language to be used by the OS API, in which they are not defined (but defined in another programming language) or improve performance. <br><br>  The main function of FFI is the binding of semantics and calling conventions of one language (host) with the semantics and calling conventions of another (guest).  This process should take into account the runtime environment and / or the binary interface of both. <br><br>  So enough theory, let's get down to practice. <br><br>  <b>Rusty</b> <br>  First you need to create a new project using the command (before that you need to <a href="https://www.rust-lang.org/downloads.html">install Rust on your system</a> ): <br><pre><code class="bash hljs">cargo new [ ]</code> </pre> <br>  After this, a folder with the name you specified appears with the following contents. <br><img src="https://habrastorage.org/files/baf/b86/8a9/bafb868a9a6e45159467d7072a4a05bd.png"><br><br>  In the configuration file Cargo.toml we write the following code: <br><div class="spoiler">  <b class="spoiler_title">Cargo.toml</b> <div class="spoiler_text"><pre> <code class="rust hljs">[package] name = <span class="hljs-string"><span class="hljs-string">"libshingles"</span></span> version = <span class="hljs-string"><span class="hljs-string">"0.1.0"</span></span> authors = [<span class="hljs-string"><span class="hljs-string">"Andrey Ivanov &lt;lekkion@gmail.com&gt;"</span></span>] [dependencies] regex = <span class="hljs-string"><span class="hljs-string">"0.1.41"</span></span> rust-crypto = <span class="hljs-string"><span class="hljs-string">"^0.2"</span></span> libc = <span class="hljs-string"><span class="hljs-string">"0.1"</span></span> [lib] name = <span class="hljs-string"><span class="hljs-string">"libshingles"</span></span> crate_type = [<span class="hljs-string"><span class="hljs-string">"dylib"</span></span>]</code> </pre><br></div></div><br>  In the [package] block we specify information about your packages, in [dependencies] - connectable containers, and [lib] instructs to compile the library as a standard dynamic library (by default, compiles into a specific rlib format). <br><br>  Now directly the lib.rs code: <br><div class="spoiler">  <b class="spoiler_title">lib.rs</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> regex; <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> crypto; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::ffi::CStr; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::thread; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> regex::Regex; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::cmp::min; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> crypto::md5::Md5; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> crypto::digest::Digest; <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">count_same</span></span></span></span>(text1: *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> libc::c_char, text2: *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> libc::c_char, length: libc::uint16_t) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buf1 = <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { CStr::from_ptr(text1).to_bytes() }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text1_ = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from_utf8(buf1.to_vec()) { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(val) =&gt; val, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(e) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buf2 = <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { CStr::from_ptr(text2).to_bytes() }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text2_ = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from_utf8(buf2.to_vec()) { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(val) =&gt; val, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(e) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(), }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">canonize</span></span></span></span>(text: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> html = Regex::new(<span class="hljs-string"><span class="hljs-string">r"&lt;[^&gt;]*&gt;|[:punct:]"</span></span>).unwrap(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> stop_words = Regex::new(<span class="hljs-string"><span class="hljs-string">r"(?i)\b[-]{1,2}\b"</span></span>).unwrap(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> temp = html.replace_all(&amp;text, <span class="hljs-string"><span class="hljs-string">" "</span></span>); temp = stop_words.replace_all(&amp;temp, <span class="hljs-string"><span class="hljs-string">" "</span></span>); temp } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_shingles</span></span></span></span>(text: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>, len: <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span>) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text = canonize(text); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> split: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;&amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>&gt; = text.split_whitespace().collect(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> length = len <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(split.len()&lt;length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-built_in"><span class="hljs-built_in">str</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>..(split.len()-length+<span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> buf = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> i..i+length { buf = buf + <span class="hljs-string"><span class="hljs-string">" "</span></span> + split[y]; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> el = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from(buf.trim()).to_lowercase(); <span class="hljs-built_in"><span class="hljs-built_in">str</span></span>.push(el); } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> handles: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;_&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::with_capacity(<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>.len()); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-built_in"><span class="hljs-built_in">str</span></span> { handles.push( thread::spawn(<span class="hljs-keyword"><span class="hljs-keyword">move</span></span> || { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> bytes: &amp;[<span class="hljs-built_in"><span class="hljs-built_in">u8</span></span>] = item.as_bytes(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> hash = Md5::new(); hash.input(bytes); hash.result_str() }) ) } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> res: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">String</span></span>&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> h <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> handles { <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> h.join() { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(r) =&gt; res.push(r), <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(err) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"error {:?}"</span></span>, err), }; } res } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shingles1 = get_shingles(text1_, length); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> shingles2 = get_shingles(text2_, length); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(shingles1.len()==<span class="hljs-number"><span class="hljs-number">0</span></span> || shingles2.len()==<span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> same = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> item <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &amp;shingles1 { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> el <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &amp;shingles2 { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(*item == *el) { same += <span class="hljs-number"><span class="hljs-number">1</span></span>; } } } same = same*<span class="hljs-number"><span class="hljs-number">100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> length_text = min(shingles1.len(), shingles2.len()); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> length_text_f = length_text <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> same_f = same <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = same_f/length_text_f; result }</code> </pre><br></div></div><br>  I have already mentioned that the algorithm of shingles is largely simplified: the stage of canonization is reduced to clearing punctuation marks and removing words less than two characters long (such words are usually devoid of any semantic meaning).  In an amicable way, it was necessary to clear the text of adjectives and discard the words of the end, leaving only the roots.  But to solve my problems, this implementation fits more than. <br><br>  In the library code I will focus only on points related to the implementation of the FFI. <br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-keyword"><span class="hljs-keyword">crate</span></span> libc;</code> </pre><br>  The purpose of this container is to provide all the definitions needed to interact with the C-code on each platform that supports Rust: the definition of types, constants, and function headers. <br><br>  Attribute <pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span></code> </pre>  allows you to turn off default behavior that changes function names. <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-string"><span class="hljs-string">"C"</span></span></code> </pre>  indicates that this function adheres to the calling agreement outside of this module on the binary interface C. <br><br><pre> <code class="rust hljs">text1: *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> libc::c_char text2: *<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> libc::c_char</code> </pre>  These are signature types for CString. <br><br><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buf1 = <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { CStr::from_ptr(text1).to_bytes() }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text1_ = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from_utf8(buf1.to_vec()) { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(val) =&gt; val, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(e) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(), }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buf2 = <span class="hljs-keyword"><span class="hljs-keyword">unsafe</span></span> { CStr::from_ptr(text2).to_bytes() }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text2_ = <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::from_utf8(buf2.to_vec()) { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(val) =&gt; val, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(e) =&gt; <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(), };</code> </pre>  Here we denote as unsafe code extraction of bytes by a raw pointer to a CString.  And convert these bytes to type String. <br><br>  That's all.  <b>Important note - do not panic when writing a dynamic library using FFI!</b>  Using macro panic!  leads to indefinite behavior.  If you use panic !, you need to move it to another stream, so that panic does not pop up to C. <br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::thread; <span class="hljs-meta"><span class="hljs-meta">#[no_mangle]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-keyword"><span class="hljs-keyword">extern</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">oh_no</span></span></span></span>() -&gt; <span class="hljs-built_in"><span class="hljs-built_in">i32</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> h = thread::spawn(|| { <span class="hljs-built_in"><span class="hljs-built_in">panic!</span></span>(<span class="hljs-string"><span class="hljs-string">"Oops!"</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> h.join() { <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(_) =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-literal"><span class="hljs-literal">Err</span></span>(_) =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, } }</code> </pre><br></div></div><br>  Compile the library with the command <pre> <code class="bash hljs">cargo build</code> </pre> <br>  The compiled library will be located along the way. <pre> <code class="bash hljs">/target/debug/</code> </pre>  with the .so extension.  Let's start connecting our library in other languages. <br><br>  <b>Node.js</b> <br>  To connect our dynamic library on this platform, we use the library called in npm as <a href="https://github.com/node-ffi/node-ffi">‚Äúffi‚Äù</a> . <br>  Here is an example of connecting the library: <br><div class="spoiler">  <b class="spoiler_title">index.js</b> <div class="spoiler_text"><pre> <code class="rust hljs">var FFI = require(<span class="hljs-symbol"><span class="hljs-symbol">'ffi</span></span>'); var lib = FFI.Library('./target/debug/liblibshingles.so', { <span class="hljs-symbol"><span class="hljs-symbol">'count_same</span></span>': [ <span class="hljs-symbol"><span class="hljs-symbol">'float</span></span>', [ <span class="hljs-symbol"><span class="hljs-symbol">'string</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'string</span></span>', <span class="hljs-symbol"><span class="hljs-symbol">'int</span></span>' ] ] }); module.exports = lib.count_same; var text1 = <span class="hljs-string"><span class="hljs-string">"   ,      , -              ,            ,  -    . ¬´   ,        2010-,  2011-   ,     .     , ‚Äî   . ‚Äî     - ,       ,    .    ‚Äî  ¬ª.    , , -           ,      .   , ,   ,          ,     . ¬´  ,      ,     .      , ‚Äî   . ‚Äî   .    .     ,      ,        .             ‚Äî   ¬ª."</span></span>; var text2 = <span class="hljs-string"><span class="hljs-string">"          ¬´ ¬ª,      ,   ,      ,  -    .              . ¬´      .    25 ,    .          50  ,         ¬ª, ‚Äî   . ¬´ ¬ª     , , , , , , , ,    ."</span></span>; lib.count_same.async(text1, text2, <span class="hljs-number"><span class="hljs-number">2</span></span>, function(err, res) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(err) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> console.log(<span class="hljs-symbol"><span class="hljs-symbol">'err</span></span>', err); } console.log(res) });</code> </pre><br></div></div><br>  The <b>ffi</b> package allows you to execute plug-in code in another thread, using <b>libuv</b> - to preserve the concept of asynchronous code.  More information <a href="https://github.com/node-ffi/node-ffi/wiki/Node-FFI-Tutorial">here</a> . <br><br>  The materials used in writing the article: <br>  <a href="http://oppenlander.me/articles/rust-ffi">RUST FFI Embedding projects for safe, concurrent, and fast code anywhere</a> <br>  <a href="https://github.com/node-ffi/node-ffi/wiki/Node-FFI-Tutorial">Node FFI Tutorial</a> <br>  <a href="https://en.wikipedia.org/wiki/Foreign_function_interface">Foreign function interface</a> <br>  <a href="https://doc.rust-lang.org/book/ffi.html">Foreign Function Interface Rust book</a> <br><br>  Also thanks to comrade <a href="https://habrahabr.ru/users/mkpankov/" class="user_link">mkpankov</a> <br><br>  <a href="https://github.com/stalehard/algorithm-shingles-rust">Githaba code</a> </div><p>Source: <a href="https://habr.com/ru/post/270137/">https://habr.com/ru/post/270137/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../270125/index.html">Asterisk: We will provide VIP clients with the first place in the call queue, as well as we will connect the client with a specific operator for a specified time.</a></li>
<li><a href="../270127/index.html">On projects on open data, the search for funding for public projects and on open data on public finances</a></li>
<li><a href="../270129/index.html">Unobvious features of product sorting and "dance of reality"</a></li>
<li><a href="../270131/index.html">Kaggle competition for analyzing population survey data</a></li>
<li><a href="../270133/index.html">Cocos2d-x - simple game development</a></li>
<li><a href="../270141/index.html">Online compilation on a static site, a recipe for beginners</a></li>
<li><a href="../270143/index.html">Pirate metrics: how to create an email campaign based on the AARRR principle. Part 3</a></li>
<li><a href="../270145/index.html">Street magic in scripts or what connects Groovy, Ivy and Maven?</a></li>
<li><a href="../270147/index.html">PHP html generation</a></li>
<li><a href="../270149/index.html">Microsoft raises prices for its software in the Russian Federation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>