<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Serious errors in the code CryEngine V</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In May 2016, the German company Crytek decided to publish the source code for the CryEngine V game engine on GitHub. The project is under active devel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Serious errors in the code CryEngine V</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8c9/d12/e27/8c9d12e2765248d26fda2c655fca4acc.png"></div><p></p><br>  In May 2016, the German company Crytek decided to publish the source code for the CryEngine V game engine on GitHub. The project is under active development, which entails the appearance of many errors in the code.  We have already checked the project with PVS-Studio for Windows, and now we were able to test the project with PVS-Studio for Linux.  The material again scored on a large article describing only very serious errors. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  <a href="https://www.cryengine.com/">CryEngine</a> is a game engine created by the German company <a href="http://www.crytek.com/">Crytek</a> in 2002, and originally used in the first-person shooter Far Cry.  On CryEngine of different versions, many excellent games were made from several game studios that licensed the engine: Far Cry, Crysis, Entropia Universe, Blue Mars, Warface, Homefront: The Revolution, Sniper: Ghost Warrior, Armored Warfare, Evolve and <a href="https://en.wikipedia.org/wiki/List_of_CryEngine_games">many others</a> .  In March 2016, Crytek announced the release of its new engine, the CryEngine V, and soon published the source code on <a href="https://github.com/CRYTEK-CRYENGINE/CRYENGINE">GitHub</a> . <br><br>  To check the open source code, we used the <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static analyzer version 6.14 for Linux.  Now, developers of cross-platform projects have become even more convenient to monitor the quality of the code with a single code analysis tool.  Download version for Linux can be in the form of an archive or package for the package manager.  For most distributions, you can customize the <a href="https://www.viva64.com/ru/m/0039/">installation and upgrade</a> using our repository. <br><br>  The article includes general-purpose warnings and only the ‚ÄúHigh‚Äù confidence level (there is also Medium and Low).  Honestly, I did not master to watch carefully all the ‚ÄúHigh‚Äù warnings, because  almost immediately picked up errors for the article with a quick review.  I took up the project several times and for a long time could not find the time to write a review article, so I can say about the given bugs that they have been living in the code for more than one month.  Also, some errors were not corrected from the <a href="https://www.viva64.com/ru/b/0417/">previous</a> article on the verification of the project. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Downloading and testing source code in Linux was very easy.  Here is a list of all the necessary commands: <br><br><pre><code class="cpp hljs">mkdir ~/projects &amp;&amp; cd ~/projects git clone https:<span class="hljs-comment"><span class="hljs-comment">//github.com/CRYTEK/CRYENGINE.git cd CRYENGINE/ git checkout main chmod +x ./download_sdks.py ./download_sdks.py pvs-studio-analyzer trace -- \ sh ./cry_waf.sh build_linux_x64_clang_profile -p gamesdk pvs-studio-analyzer analyze \ -l /path/to/PVS-Studio.lic \ -o ~/projects/CRYENGINE/cryengine.log \ -r ~/projects/CRYENGINE/ \ -C clang++-3.8 -C clang-3.8 \ -e ~/projects/CRYENGINE/Code/SDKs \ -j4 plog-converter -a GA:1,2 -t tasklist \ -o ~/projects/CRYENGINE/cryengine_ga.tasks \ ~/projects/CRYENGINE/cryengine.log</span></span></code> </pre> <br>  The <i>cryengine_ga.tasks</i> report <i>file</i> can be opened and viewed in QtCreator.  What did you find in the source code of CryEngine V? <br><br><h2>  Unhappy Active () Function </h2><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> operator: bActive == bActive LightEntity.h 124 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bActive)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bActive == bActive) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; m_bActive = bActive; OnResetState(); }</code> </pre> <br>  Because of the typo, the function does nothing.  It seems to me that if there was a Miss Misprint contest, then this piece of code would definitely take first place.  I think this error has every chance of getting into the " <a href="https://hownot2code.com/category/cc-bugs-of-the-month/">C / C ++ bugs of the month</a> " section. <br><br>  But this is not all, here is a function from another class: <br><br>  <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions 'm_staticObjects'  operator.  FeatureCollision.h 66 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CFeatureCollision</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CParticleFeature { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CRY_PFX2_DECLARE_FEATURE <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: CFeatureCollision(); .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsActive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> m_terrain || m_staticObjects || m_staticObjects; } .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_terrain; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_staticObjects; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> m_dynamicObjects; };</code> </pre> <br>  Here, in the <i>IsActive ()</i> function, the <i>m_staticObjects</i> variable is used <i>twice</i> , although there is an unused variable <i>m_dynamicObjects next to it</i> .  Perhaps in the code they wanted to use it. <br><br><h2>  Code above has no bugs </h2><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'outArrIndices [i] &lt;0' is always false.  Unsigned type value is never &lt;0. CGFLoader.cpp 881 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CompactBoneVertices</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(...., DynArray&lt;uint16&gt;&amp; outArrIndices, ....)</span></span></span><span class="hljs-function"> </span><span class="hljs-comment"><span class="hljs-function"><span class="hljs-comment">// &lt;= uint16 { .... outArrIndices.resize(3 * inFaceCount, -1); int outVertexCount = 0; for (int i = 0; i &lt; verts.size(); ++i) { .... outArrIndices[....] = outVertexCount - 1; } // Making sure that the code above has no bugs // &lt;= LOL for (int i = 0; i &lt; outArrIndices.size(); ++i) { if (outArrIndices[i] &lt; 0) // &lt;= LOL { return false; } } return true; }</span></span></span></span></code> </pre> <br>  This error is worth a separate section.  In general, in the CryEngine code, there are a lot of places where unsigned variables are meaninglessly compared to zero.  There are <b>hundreds of</b> such places, but I would like to pay special attention to this fragment, since  The code was written intentionally. <br><br>  So, there is an array of unsigned numbers - <i>outArrIndices</i> .  Next, the array is filled by some algorithm.  After that, a brilliant check of each element of the array is performed, so that among them there are no negative numbers.  The array elements are of type <i>uint16</i> . <br><br><h2>  Errors when working with memory </h2><br>  <a href="http://www.viva64.com/ru/d/0101/">V512</a> A call of the memcpy function will lead to hashableData.  GeomCacheRenderNode.cpp 285 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CGeomCacheRenderNode::Render(....) { .... CREGeomCache* pCREGeomCache = iter-&gt;second.m_pRenderElement; .... uint8 hashableData[] = { <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, (uint8)<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::distance(pCREGeomCache-&gt;....-&gt;begin(), &amp;meshData), (uint8)<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::distance(meshData....-&gt;....begin(), &amp;chunk), (uint8)<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::distance(meshData.m_instances.begin(), &amp;instance) }; <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(hashableData, pCREGeomCache, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(pCREGeomCache)); .... }</code> </pre> <br>  Pay attention to the <i>memcpy ()</i> function arguments.  The <i>pCREGeomCache</i> object <i>is</i> planned to be copied into the <i>hashableData</i> array, but by chance the size of the pointer was not calculated using the <i>sizeof</i> operator, but the size of the object.  Due to an error, the object is not completely copied, but only 4 or 8 bytes. <br><br>  <a href="http://www.viva64.com/ru/d/0163/">If you‚Äôre a</a> sizeof () ‚Äô  ClipVolumeManager.cpp 145 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CClipVolumeManager::GetMemoryUsage(class ICrySizer* pSizer) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { pSizer-&gt;AddObject(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; m_ClipVolumes.size(); ++i) pSizer-&gt;AddObject(m_ClipVolumes[i].m_pVolume); }</code> </pre> <br>  A similar error was made by calculating instead of the class size, the size of the pointer <i>this</i> .  The correct option is <i>sizeof (* this)</i> . <br><br>  <a href="http://www.viva64.com/ru/d/0119/">V530</a>  ClipVolumes.cpp 492 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;CFullscreenPass&gt;&gt; m_jitteredDepthPassArray; <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CClipVolumesStage::PrepareVolumetricFog() { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int32 i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; m_jitteredDepthPassArray.size(); ++i) { m_jitteredDepthPassArray[i].release(); } m_jitteredDepthPassArray.resize(depth); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int32 i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; depth; ++i) { m_jitteredDepthPassArray[i] = CryMakeUnique&lt;....&gt;(); m_jitteredDepthPassArray[i]-&gt;SetViewport(viewport); m_jitteredDepthPassArray[i]-&gt;SetFlags(....); } .... }</code> </pre> <br>  If you refer to the documentation for the class <i>std :: unique_ptr</i> , then the <i>release ()</i> function should be used approximately as follows: <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">unique_ptr</span></span>&lt;Foo&gt; up(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Foo()); Foo* fp = up.release(); <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> fp;</code> </pre> <br>  Most likely, in this code snippet, we wanted to use the <i>reset ()</i> function instead of <i>release ()</i> . <br><br>  <a href="http://www.viva64.com/ru/d/0139/">V549</a> memcpy function is equal to the second argument.  ObjectsTree_Serialize.cpp 1135 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> COctreeNode::LoadSingleObject(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>* pAuxDataDst = pObj-&gt;GetAuxSerializationDataPtr(....); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>* pAuxDataSrc = StepData&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(....); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(pAuxDataDst, pAuxDataDst, min(....) * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>)); .... }</code> </pre> <br>  Forgot to pass <i>pAuxDataSrc</i> to the <i>memcpy ()</i> function.  Instead, the same <i>pAuxDataDst</i> variable is used as the source and <i>destination</i> .  No one is immune from typos.  By the way, those who wish can check their attentiveness by passing our test to identify such errors: <a href="http://q.viva64.com/">q.viva64.com</a> . <br><br><h2>  Strange code </h2><br>  <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical to the left and the right of the | ||  operator: val == 0 ||  val == - 0 XMLCPB_AttrWriter.cpp 363 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAttrWriter::PackFloatInSemiConstType(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> val, ....) { uint32 type = PFSC_VAL; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val == <span class="hljs-number"><span class="hljs-number">0</span></span> || val == <span class="hljs-number"><span class="hljs-number">-0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= type = PFSC_0; else if (val == 1) type = PFSC_1; else if (val == -1) type = PFSC_N1; .... }</span></span></code> </pre> <br>  The developers planned to compare the real variable <i>val</i> with zero and negative zero (signed zero / negative zero), but they did it wrong.  By declaring integer constants, the values ‚Äã‚Äãof the zeros are the same. <br><br>  Most likely, the code should be corrected as follows, declaring constants of real type: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (val == <span class="hljs-number"><span class="hljs-number">0.0f</span></span> || val == <span class="hljs-number"><span class="hljs-number">-0.0f</span></span>) type = PFSC_0;</code> </pre> <br>  On the other hand, the conditional expression is redundant, since  it is enough to compare a variable with a normal zero.  For this reason, the original code is executed as the programmer expects. <br><br>  But if it is necessary to identify exactly negative zero, then correctly do it with the help of the function <a href="http://en.cppreference.com/w/cpp/numeric/math/signbit">std :: signbit</a> . <br><br>  <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions' m_joints [i] .limits [1] [j]  articulatedentity.cpp 1326 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CArticulatedEntity::Step(<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> time_interval) { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>;j++) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(m_joints[i].flags &amp; angle0_locked&lt;&lt;j)&amp;&amp; isneg(m_joints[i].limits[<span class="hljs-number"><span class="hljs-number">0</span></span>][j]-m_joints[i].qext[j]) + isneg(m_joints[i].qext[j]-m_joints[i].limits[<span class="hljs-number"><span class="hljs-number">1</span></span>][j]) + isneg(m_joints[i].limits[<span class="hljs-number"><span class="hljs-number">1</span></span>][j]-m_joints[i].limits[<span class="hljs-number"><span class="hljs-number">1</span></span>][j]) &lt; <span class="hljs-number"><span class="hljs-number">2</span></span>) { .... }</code> </pre> <br>  The last part of the conditional expression contains subtraction from the <i>m_joints [i] .limits [1] [j]</i> variable.  The code looks suspicious.  There are many indexes in the expression, perhaps one of them has an error. <br><br>  Another such place: <br><br><ul><li>  V501 There are identical sub-expressions 'm_joints [op [1]]. Limits [1] [i]' to the left and to the right of the '-' operator.  articulatedentity.cpp 513 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0194/">V590</a> Consider inspecting this expression.  The expression is misprint.  GoalOp_Crycd2.cpp 3779 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> COPCrysis2FlightFireWeapons::ParseParam(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> paused; value.GetValue(paused); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (paused &amp;&amp; (m_State != eFP_PAUSED) &amp;&amp; (m_State != eFP_PAUSED_OVERRIDE)) { m_NextState = m_State; m_State = eFP_PAUSED; m_PausedTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; m_PauseOverrideTime = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!paused &amp;&amp; (m_State == eFP_PAUSED) &amp;&amp; <span class="hljs-comment"><span class="hljs-comment">// &lt;= (m_State != eFP_PAUSED_OVERRIDE)) // &lt;= { m_State = m_NextState; m_NextState = eFP_STOP; m_PausedTime = 0.0f; m_PauseOverrideTime = 0.0f; } .... }</span></span></code> </pre> <br>  The conditional expression is written in such a way that the result does not depend on the <i>m_State</i> subexpression <i>! = EFP_PAUSED_OVERRIDE</i> .  Although I‚Äôm telling someone, the developers haven‚Äôt fixed this code snippet after the first article. <br><br>  If anyone is interested, then I described this kind of errors earlier in a separate article " <a href="https://www.viva64.com/ru/b/0390/">Logical expressions in C / C ++. How professionals are mistaken</a> ." <br><br>  <a href="http://www.viva64.com/ru/d/0118/">V529</a> Odd semicolon ';'  after 'for' operator.  boolean3d.cpp 1077 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CTriMesh::Slice(...) { .... pmd-&gt;pMesh[<span class="hljs-number"><span class="hljs-number">0</span></span>]=pmd-&gt;pMesh[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; AddRef();AddRef(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(pmd0=m_pMeshUpdate; pmd0-&gt;next; pmd0=pmd0-&gt;next); <span class="hljs-comment"><span class="hljs-comment">// &lt;= pmd0-&gt;next = pmd; .... }</span></span></code> </pre> <br>  Another piece of code, uncorrected since the previous check.  The code is still not clear: is there an erroneous formatting or a logical error? <br><br><h2>  About pointers </h2><br>  <a href="http://www.viva64.com/ru/d/0111/">V522</a> Dereferencing of the null pointer 'pCEntity' might take place.  BreakableManager.cpp 2396 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> CBreakableManager::HandlePhysics_UpdateMeshEvent(....) { CEntity* pCEntity = <span class="hljs-number"><span class="hljs-number">0</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pmu &amp;&amp; pSrcStatObj &amp;&amp; GetSurfaceType(pSrcStatObj)) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pEffect) { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (normal.len2() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) pEffect-&gt;Spawn(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, pCEntity-&gt;GetSlotWorldTM(...); <span class="hljs-comment"><span class="hljs-comment">// &lt;= } } .... if (iForeignData == PHYS_FOREIGN_ID_ENTITY) { pCEntity = (CEntity*)pForeignData; if (!pCEntity || !pCEntity-&gt;GetPhysicalProxy()) return 1; } .... }</span></span></code> </pre> <br>  The analyzer detected null pointer dereferencing.  The function code is written or refactored in such a way that a code branch is formed in which the <i>pCEntity</i> pointer initialized by zero will be used. <br><br>  Now consider a potential null pointer dereference. <br><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'pTrack' pointer was used before it was counted against nullptr.  Check lines: 60, 61. AudioNode.cpp 60 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CAudioNode::Animate(SAnimContext&amp; animContext) { .... <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> bMuted = gEnv-&gt;IsEditor() &amp;&amp; (pTrack-&gt;GetFlags() &amp; IAnimTrack::eAnimTrackFlags_Muted); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pTrack || pTrack-&gt;GetNumKeys() == <span class="hljs-number"><span class="hljs-number">0</span></span> || pTrack-&gt;GetFlags() &amp; IAnimTrack::eAnimTrackFlags_Disabled) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } .... }</code> </pre> <br>  The author of this code fragment first used the <i>pTrack</i> pointer, and on the very next line of the code checks its validity before dereferencing.  Most likely, this is a potential place for incorrect operation of the program. <br><br>  <a href="http://www.viva64.com/ru/w/V595/">There</a> are a lot of warnings for the <a href="http://www.viva64.com/ru/w/V595/">V595</a> , and they won't fit in the article.  Very often such code is a real mistake, but thanks to luck, it works correctly. <br><br>  <a href="http://www.viva64.com/ru/d/0169/">V571</a> Recurring check.  The 'if (rLightInfo.m_pDynTexture)' condition was already verified in line 69. ObjMan.cpp 70 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Safe memory helpers #define SAFE_RELEASE(p){ if (p) { (p)-&gt;Release(); (p) = NULL; } } void CObjManager::UnloadVegetationModels(bool bDeleteAll) { .... SVegetationSpriteLightInfo&amp; rLightInfo = ....; if (rLightInfo.m_pDynTexture) SAFE_RELEASE(rLightInfo.m_pDynTexture); .... }</span></span></code> </pre> <br>  There is no serious error in this code snippet, but you should not write an extra code if the corresponding checks are already included in the special macro. <br><br>  Another place with extra code: <br><br><ul><li>  V571 Recurring check.  The 'if (m_pSectorGroups)' condition was already verified in line 48. PartitionGrid.cpp 50 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0175/">V575</a> The memcpy function doesn't copy the whole string.  Use 'strcpy / strcpy_s' function to preserve terminal null.  SystemInit.cpp 4045 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CLvlRes_finalstep</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> CLvlRes_base { .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;; ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (*p == <span class="hljs-string"><span class="hljs-string">'/'</span></span> || *p == <span class="hljs-string"><span class="hljs-string">'\\'</span></span> || *p == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> cOldChar = *p; *p = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">// create zero termination _finddata_t fd; bool bOk = FindFile(szFilePath, szFile, fd); if (bOk) assert(strlen(szFile) == strlen(fd.name)); *p = cOldChar; // get back the old separator if (!bOk) return; memcpy((void*)szFile, fd.name, strlen(fd.name)); // &lt;= if (*p == 0) break; ++p; szFile = p; } else ++p; } .... }</span></span></code> </pre> <br>  This code may have an error.  When copying a string, the last <a href="https://www.viva64.com/ru/t/0088/">terminal zero</a> is lost.  In this case, you must copy <i>strlen () + 1</i> character, or use special functions to copy strings: <i>strcpy</i> or <i>strcpy_s</i> . <br><br><h2>  Comma problems </h2><br>  <a href="http://www.viva64.com/ru/d/0110/">V521</a> Such expressions using the ',' operator are dangerous.  Make sure the expression! SWords [iWord] .empty (), iWord ++ 'is correct.  TacticalPointSystem.cpp 3243 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CTacticalPointSystem::Parse(....) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sInput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(sSpec)</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MAXWORDS = <span class="hljs-number"><span class="hljs-number">8</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> sWords[MAXWORDS]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iC = <span class="hljs-number"><span class="hljs-number">0</span></span>, iWord = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; iWord &lt; MAXWORDS; !sWords[iWord].empty(), iWord++) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { sWords[iWord] = sInput.Tokenize("_", iC); } .... }</span></span></code> </pre> <br>  Note the section of the <i>for</i> loop with counters.  What does a logical expression do there?  Most likely, it should be moved to another place and write like this: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (; iWord &lt; MAXWORDS &amp;&amp; !sWords[iWord].empty(); iWord++) {...}</code> </pre> <br>  <a href="http://www.viva64.com/ru/w/V521/">V521</a> Such expressions using the ',' operator are dangerous.  Make sure the expression is correct.  HommingSwarmProjectile.cpp 187 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CHommingSwarmProjectile::HandleEvent(....) { .... explodeDesc.normal = -pCollision-&gt;n,pCollision-&gt;vloc[<span class="hljs-number"><span class="hljs-number">0</span></span>]; .... }</code> </pre> <br>  Another strange code snippet with the operator ','. <br><br><h2>  Suspicious conditions </h2><br>  <a href="http://www.viva64.com/ru/w/V571/">V571</a> Recurring check.  The 'if (pos == npos)' condition was already verified in line 1530. CryString.h 1539 <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//! Find last single character. // \return -1 if not found, distance from beginning otherwise. template&lt;class T&gt; inline typename CryStringT&lt;T&gt;::....::rfind(....) const { const_str str; if (pos == npos) { // find last single character str = _strrchr(m_str, ch); // return -1 if not found, distance from beginning otherwise return (str == NULL) ? (size_type) - 1 : (size_type)(str - m_str); } else { if (pos == npos) { pos = length(); } if (pos &gt; length()) { return npos; } value_type tmp = m_str[pos + 1]; m_str[pos + 1] = 0; str = _strrchr(m_str, ch); m_str[pos + 1] = tmp; } return (str == NULL) ? (size_type) - 1 : (size_type)(str - m_str); }</span></span></code> </pre> <br>  The analyzer detected a repeated check of the <i>pos</i> variable.  Because of this error, part of the code is never executed.  There is also duplicate code in the function, so the function should be rewritten better. <br><br>  This code was successfully duplicated in another place: <br><br><ul><li>  V571 Recurring check.  The 'if (pos == npos)' condition was already verified in line 1262. CryFixedString.h 1271 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0112/">V523</a> The 'then' statement is equivalent to the 'else' statement.  ScriptTable.cpp 789 <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> CScriptTable::AddFunction(<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> SUserFunctionDesc&amp; fd) { .... <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> sFuncSignature[<span class="hljs-number"><span class="hljs-number">256</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fd.sGlobalName[<span class="hljs-number"><span class="hljs-number">0</span></span>] != <span class="hljs-number"><span class="hljs-number">0</span></span>) cry_sprintf(sFuncSignature, <span class="hljs-string"><span class="hljs-string">"%s.%s(%s)"</span></span>, fd.sGlobalName, fd.sFunctionName, fd.sFunctionParams); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> cry_sprintf(sFuncSignature, <span class="hljs-string"><span class="hljs-string">"%s.%s(%s)"</span></span>, fd.sGlobalName, fd.sFunctionName, fd.sFunctionParams); .... }</code> </pre> <br>  Regardless of the contents of the line, it is still trying to print the same way.  This code is also very much in the project, here are some warnings: <br><br><ul><li>  V523 The 'then' statement is equivalent to the 'else' statement.  BudgetingSystem.cpp 718 </li><li>  V523 The 'then' statement is equivalent to the 'else' statement.  D3DShadows.cpp 627 </li><li>  V523 The 'then' statement is equivalent to the 'else' statement.  livingentity.cpp 967 </li></ul><br><h2>  Undefined behavior </h2><br>  <a href="http://www.viva64.com/ru/d/0225/">V610</a> Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  physicalplaceholder.h 25 <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CPhysicalEntity</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> NO_GRID_REG = <span class="hljs-number"><span class="hljs-number">-1</span></span>&lt;&lt;<span class="hljs-number"><span class="hljs-number">14</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GRID_REG_PENDING = NO_GRID_REG+<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> GRID_REG_LAST = NO_GRID_REG+<span class="hljs-number"><span class="hljs-number">2</span></span>;</code> </pre> <br>  The analyzer is able to find several types of errors leading to undefined behavior.  According to the modern standard of language, a shift of a negative number to the left leads to undefined behavior. <br><br>  Here are some more questionable places: <br><br><ul><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '~ (TFragSeqStorage (0))' is negative.  UDPDatagramSocket.cpp 757 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The right operand ('cpu' = [0..1023]) is the operand.  CryThreadUtil_posix.h 115 </li><li>  V610 Undefined behavior.  Check the shift operator '&gt;&gt;'.  The right operand is negative ('comp' = [-1..3]).  ShaderComponents.cpp 399 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  trimesh.cpp 4126 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  trimesh.cpp 4559 </li><li>  V610 Unspecified behavior.  Check the shift operator '&gt;&gt;'.  The left operand '-NRAYS' is negative.  trimesh.cpp 4618 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  tetrlattice.cpp 324 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  tetrlattice.cpp 350 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  tetrlattice.cpp 617 </li><li>  V610 Undefined behavior.  Check the shift operator '&lt;&lt;'.  The left operand '-1' is negative.  tetrlattice.cpp 622 </li></ul><br>  Another type of indefinite behavior is associated with repeated changes in the variable between two points of repetition: <br><br>  <a href="http://www.viva64.com/ru/d/0162/">V567</a> Undefined behavior.  The variable "m_current" variable  OperatorQueue.cpp 101 <br><br><pre> <code class="cpp hljs">boolCOperatorQueue::Prepare(....) { ++m_current &amp;= <span class="hljs-number"><span class="hljs-number">1</span></span>; m_ops[m_current].clear(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; }</code> </pre> <br>  Unfortunately, this place is not the only one in the code: <br><br><ul><li>  V567 Undefined behavior.  The 'm_commandBufferIndex' variable is modified while being used between sequence points.  XConsole.cpp 180 </li><li>  V567 Undefined behavior.  The variable is variable.  trimesh.cpp 3119 </li><li>  V567 Undefined behavior.  The variable is variable.  trimesh.cpp 3126 </li><li>  V567 Undefined behavior.  I'tvtx variable  boolean3d.cpp 957 </li><li>  V567 Undefined behavior.  I'tvtx variable  boolean3d.cpp 965 </li><li>  V567 Undefined behavior.  I'tvtx variable  boolean3d.cpp 983 </li><li>  V567 Undefined behavior.  The m_iNextAnimIndex variable is modified.  HitDeathReactionsDefs.cpp 192 </li></ul><br><h2>  Questions to the developers </h2><br>  In the code of CryEngine V, I found an interesting way for developers to communicate through comments in the code. <br><br>  Here is the funniest comment I found with the warning: <br><br>  <a href="http://www.viva64.com/ru/w/V763/">V763</a> Parameter 'enable' is always rewritten in function body before being used. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> CNetContext::EnableBackgroundPassthrough(<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> enable) { SCOPED_GLOBAL_LOCK; <span class="hljs-comment"><span class="hljs-comment">// THIS IS A TEMPORARY HACK TO MAKE THE GAME PLAY NICELY, // ASK peter@crytek WHY IT'S STILL HERE enable = false; .... }</span></span></code> </pre> <br>  Then I decided to search for similar texts with the help of searching through the contents of files and wrote out several places: <br><br><pre> <code class="cpp hljs">.... <span class="hljs-comment"><span class="hljs-comment">// please ask me when you want to change [tetsuji] .... // please ask me when you want to change [dejan] .... //if there are problems with this function, ask Ivo uint32 numAnims = pCharacter-&gt;GetISkeletonAnim()-&gt;GetNumAnimsInFIFO(layer); if (numAnims) return pH-&gt;EndFunction(true); .... //ask Ivo for details //if (pCharacter-&gt;GetCurAnimation() &amp;&amp; // pCharacter-&gt;GetCurAnimation()[0] != '\0') // return pH-&gt;EndFunction(pCharacter-&gt;GetCurAnimation()); .... ///////////////////////////////////////////////////////////////// // Strange, !do not remove... ask Timur for the meaning of this. ///////////////////////////////////////////////////////////////// if (m_nStrangeRatio &gt; 32767) { gEnv-&gt;pScriptSystem-&gt;SetGCFrequency(-1); // lets get nasty. } ///////////////////////////////////////////////////////////////// // Strange, !do not remove... ask Timur for the meaning of this. ///////////////////////////////////////////////////////////////// if (m_nStrangeRatio &gt; 1000) { if (m_pProcess &amp;&amp; (m_pProcess-&gt;GetFlags() &amp; PROC_3DENGINE)) m_nStrangeRatio += cry_random(1, 11); } ///////////////////////////////////////////////////////////////// .... // tank specific: // avoid steering input around 0.5 (ask Anton) .... CryWarning(VALIDATOR_MODULE_EDITOR, VALIDATOR_WARNING, "....: Wrong edited item. Ask AlexL to fix this."); .... // If this renders black ask McJohn what's wrong. glGenerateMipmap(GL_TEXTURE_2D); ....</span></span></code> </pre> <br>  Well and the most important question to developers: why they do not use specialized tools to improve the quality of the code?  Of course, I mean PVS-Studio.  :) <br><br>  Once again I want to note that the article contains only a fraction of the errors.  I have not watched the end of even High level warnings.  So the project is still waiting for those who carefully check it.  I, unfortunately, can not find so much time, dozens of other projects <a href="https://github.com/viva64/pvs-studio-check-list">are waiting for</a> me. <br><br><h2>  Conclusion </h2><br>  For many years of developing a static code analyzer, I came to the conclusion that in development teams with a certain number of people it is already impossible to write code without errors.  No, I am not against Code Review, but calculate for yourself how long it will take a manager to review the code of 10 people?  And the next day?  And more people?  In such circumstances, Code Review is required when only key product components are changed.  In large volumes, this approach is extremely inefficient.  Automated code checking with static analyzers will help to significantly improve the situation for the better.  This is not a replacement for existing tests, but a completely different approach to code quality control (by the way, the tests also contain errors using static code analysis).  Correction of errors at the time of writing the code is almost worthless, in contrast to those that are at the stage of the testers, and errors in the released product already incur enormous costs. <br><br>  Download and try PVS-Studio at <a href="https://www.viva64.com/ru/pvs-studio/">this</a> link. <br><br>  Discuss licensing options, prices and options for discounts you can write to us in <a href="https://www.viva64.com/ru/about-feedback/">support</a> . <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/155/2e8/844/1552e884478a68aa15094982454f64c3.png" alt="Picture 3"></p><br><br>  Do not grieve the unicorn with your code ... <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0495/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0495/">Critical errors in CryEngine V code</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/325600/">https://habr.com/ru/post/325600/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325582/index.html">Fail-safe processing of 10M OAuth tokens on Tarantool</a></li>
<li><a href="../325586/index.html">Automation of printing in corporate systems or how to make friends with your ‚Äúbike‚Äù with a printer</a></li>
<li><a href="../325590/index.html">Recursive Moving Average Filter</a></li>
<li><a href="../325592/index.html">Azure-IaaS-Digest # 14 (March)</a></li>
<li><a href="../325596/index.html">This is Science: observing plant growth</a></li>
<li><a href="../325602/index.html">Pentestit Corporate Laboratories: Case Analysis for Penetration Testing</a></li>
<li><a href="../325604/index.html">How a ‚Äútower‚Äù turns into a ‚Äúpyramid‚Äù - using the example of the DNS analysis and filtering example</a></li>
<li><a href="../325606/index.html">Interview with IOHK developer Alexander Chepurny about programming cryptocurrencies and the future of blockchain</a></li>
<li><a href="../325608/index.html">Added the ability to embed JS-scripts in the boards. How we make our project management system</a></li>
<li><a href="../325610/index.html">The book "UX-strategy. What users want and how to give it to them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>