<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is wrong with for loops?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The possible appearance of closures in Java has become a hot topic for discussion. A proposal is being prepared to add closures to the upcoming versio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is wrong with for loops?</h1><div class="post__text post__text-html js-mediator-article">  The possible appearance of closures in Java has become a hot topic for discussion.  A proposal is being prepared to add closures to the upcoming version of the language, but the proposed syntax, coupled with the complexity of the language, is being criticized by many Java programmers. <br><br>  Today, Elliotte Rusty Harold has published his doubts about possible changes.  One of the main questions he asked was: ‚ÄúWhy do you hate the for loop‚Äù ( <a href="http://cafe.elharo.com/java/why-hate-the-for-loop/">‚ÄúWhy Hate the for Loop?‚Äù</a> )? <br><a name="habracut"></a><br><blockquote>  I don't know what makes people dream so passionately about getting rid of for loops.  This is not the first or even the second time when theorists from the computer science world rebel against them. </blockquote><br>  It would be wrong to think that Elliott alone questions the need for poor and unhappy closures.  Mostly, he complains that he didn‚Äôt see after reading Bruce Tate‚Äôs <a href="http://www-128.ibm.com/developerworks/java/library/j-cb01097.html">recent article</a> (Bruce Tate) any value in possibly introducing closures in Java (the latter uses Ruby for examples): <br><br><blockquote>  Listing 1. The simplest closure. <br><pre><code class="hljs smalltalk"><span class="hljs-number"><span class="hljs-number">3.</span></span>times {puts <span class="hljs-comment"><span class="hljs-comment">"Inside the times method."</span></span>}</code> </pre> <br>  Results: <br>  Inside the times method. <br>  Inside the times method. <br>  Inside the times method. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Here times is the method of object 3, it executes the closure code three times. <br><pre> <code class="hljs smalltalk">{puts <span class="hljs-comment"><span class="hljs-comment">"Inside the times method."</span></span>}</code> </pre>  and there is a closure.  This is an anonymous function that, when passed to the times method, prints the string ‚ÄúInside the times method.‚Äù To print.  This code is much clearer and simpler than its alternative using the for loop: <br><br>  Listing 2. A loop without closures. <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">1.</span></span><span class="hljs-number"><span class="hljs-number">.3</span></span> puts "Inside the times method." <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> </blockquote><br>  Even I, seeing such a pale and lifeless introduction to closures, would hardly see their real meaning.  The first thing that comes to mind at the sight of these examples: "Yes, perhaps there is some <i>subtle</i> tint here."  The remaining examples from Bruce's article are just as trivial, unclear, and do not shed any light on the subject of discussion at all. <br><br>  I will not discuss Elliot‚Äôs claims for code written in Ruby ‚Äî this topic is not worth a damn.  I will also get round the debate about the syntax proposed for closures in Java, and the question of whether they fit into this language at the current stage of its development.  I am not interested in this issue, and, frankly, it does not matter to me when and how these problems will be resolved and whether they will be resolved at all. <br><br>  However, Elliott raises a really important question: ‚ÄúWhy do you hate the for loop‚Äù? <br><br>  Here is a common example: <br><br><pre> <code class="hljs matlab">double sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; array.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { sum += array[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]; }</code> </pre><br>  What is he doing?  I have been programming for many years, and understanding a piece of this code does not take me much time - this is an ordinary summation of array elements.  However, in order to <i>read</i> this example, I have to sequentially look at about thirty lexemes sprayed in four lines.  Of course, when writing this code one could use syntactic sugar, which would reduce its volume.  However, the point is that there are many places where you can potentially make a mistake when writing ordinary summations. <br><br>  Do you want evidence?  Please give you the following example from the Elliott article: <br><br><pre> <code class="hljs matlab">String s = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; args.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { s += array[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>]; }</code> </pre><br>  Notice a bug?  Even if this code is compiled and revisited, weeks may pass before the first error message is received and several more before the release of the fix.  And these are just <i>simple</i> for loops.  And now imagine how much more difficult the work becomes in the case of strongly overgrown, and, perhaps, nested cycles.  (If you are still not worried about bugs, think about common typos. And then think about how often you write such cycles.) <br><br>  If you had the opportunity to write a simple for loop in one line, with fewer characters, it would be much easier to read.  Because a shorter form of writing leads to much less likelihood of errors in the code, and when they do appear, they are (mostly) much easier to catch. <br><br>  How could closures help in this situation?  Here is the first Haskell example: <br><br><pre> <code class="hljs pgsql">total = sum <span class="hljs-keyword"><span class="hljs-keyword">array</span></span></code> </pre><br>  Well, okay, okay, it was not entirely fair.  The sum function does not use closures ‚Äî it is defined through convolution (note of the translator: the English version is fold), which, in turn, uses closures. <br><br><pre> <code class="hljs lisp">total = foldl (<span class="hljs-name"><span class="hljs-name">+</span></span>) <span class="hljs-number"><span class="hljs-number">0</span></span> array</code> </pre><br>  Here is the second example of applying closures: <br><br><pre> <code class="hljs pgsql">s = concat <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> s = foldr (++) [] <span class="hljs-keyword"><span class="hljs-keyword">array</span></span></code> </pre> <br>  Perhaps the example of using the strange-looking functions foldl and foldr to explain closures is not so obvious to programmers who are familiar only with cyclic constructions.  However, he emphasizes the main weakness of for loops ‚Äî they try to combine three different operations ‚Äî filtering, folding, and converting. <br><br>  The two examples above show how you can take a list and collapse it into one item.  In the world of functional programming, such operations are called convolutions.  For its work, convolution takes the function (closure), the initial value (approx. Translator: hereinafter referred to as ‚Äúaccumulator‚Äù) and visits the first element of the list.  The closure is applied to the battery and the first item in the list, the result is put into the battery.  The convolution then applies the closure to the updated accumulator value and the second list item.  This process continues to the end of the list when the last value of the accumulator is the result of the convolution. <br><br>  Here is a visual explanation: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">s</span></span> = foldl (+) <span class="hljs-number"><span class="hljs-number">0</span></span> [<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] = foldl (+) (<span class="hljs-number"><span class="hljs-number">0</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] = foldl (+) <span class="hljs-number"><span class="hljs-number">1</span></span> [<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>] = foldl (+) (<span class="hljs-number"><span class="hljs-number">1</span></span> + <span class="hljs-number"><span class="hljs-number">2</span></span>) [<span class="hljs-number"><span class="hljs-number">3</span></span>] = foldl (+) <span class="hljs-number"><span class="hljs-number">3</span></span> [<span class="hljs-number"><span class="hljs-number">3</span></span>] = foldl (+) (<span class="hljs-number"><span class="hljs-number">3</span></span> + <span class="hljs-number"><span class="hljs-number">3</span></span>) [] = foldl (+) <span class="hljs-number"><span class="hljs-number">6</span></span> [] = <span class="hljs-number"><span class="hljs-number">6</span></span></code> </pre> <br>  Haskell provides several convolution functions: foldl starts processing the list from its first element, and passes sequentially to the last element;  foldr, on the contrary, begins with the last element, and moves towards the first element.  There are other options, but these two are major. <br><br>  Of course, convolutions are very primitive operations, and it would be very unwise to throw the for loops overboard and replace them with various fold-shaped ‚Äúspells‚Äù.  Instead, higher-level operations, such as sum, prod, and concat, are defined in terms of convolutions.  You, in turn, program in terms of these high-level operations, getting more concise code, code that is much easier to read, write and understand. <br><br>  However, not every cycle is a folding of the list into one element.  Consider the following example: <br><br><pre> <code class="hljs matlab"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; array.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { array[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] *= <span class="hljs-number"><span class="hljs-number">2</span></span>; }</code> </pre> <br>  In this case, we are dealing with a transformation, in functional languages ‚Äã‚Äãthis is called a map: <br><br><pre> <code class="hljs lisp">new_array = map (<span class="hljs-name"><span class="hljs-name">*2</span></span>) array</code> </pre><br>  The map function visits each element of the list, applies the closure passed to it to the [element] and creates a new list from the values ‚Äã‚Äãreturned by the closure.  (Some languages ‚Äã‚Äãinstead of creating a new list replace the old elements of the original list with new ones).  Such an operation is much easier to understand.  sort does something similar, in the sense that it takes a list and returns a new list (or modifies the old one). <br><br>  The third type of for loop is the filter loop.  Consider an example: <br><br><pre> <code class="hljs matlab">int tmp[] = new int [nums.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>]; int <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (int <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; nums.<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((nums[<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>] <span class="hljs-comment"><span class="hljs-comment">% 2) == 1) { tmp[j] = nums[i]; j++; } }</span></span></code> </pre> <br>  Very simple code, the meaning of which, nevertheless, is almost completely buried under the unnecessary complexity, which led to the use of a for loop and two indices.  If filtering is the same fundamental operation as fold and map, applying it should be just as simple, and, generally speaking, it is: <br><br><pre> <code class="hljs pgsql">odds = <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> (\i -&gt; (i `mod` <span class="hljs-number"><span class="hljs-number">2</span></span>) == <span class="hljs-number"><span class="hljs-number">1</span></span>) nums odds = <span class="hljs-keyword"><span class="hljs-keyword">filter</span></span> odd nums <span class="hljs-comment"><span class="hljs-comment">--  </span></span></code> </pre><br>  Here, strictly speaking, all the shortcomings of the for loop: it combines (at least) three types of operations, and focuses attention on a secondary detail - the passage of a sequence (indices) of values.  But in fact, minimizing, transforming, and filtering are three different ways to handle the list and they should be perceived differently.  The use of closures in the body of the cycle allows a much clearer to separate <i>what</i> from <i>how</i> .  I could write anonymous functions whenever I need to process a list, or use functions written before me (for example, odd, (+) or sqrt). <br><br>  If closures are not an esoteric tool, but are deeply embedded in the language and its standard library, we do not need to bother with these low-level operations (note of the translator: here we mean map, fold and filter).  Instead, we can create high-level operations with talking names, such as sum or product. <br><br>  In addition, working with such terms makes it much easier to understand more complex operations, such as transforming a tree (mapping a tree), filtering a vector (filtering a vector), or folding a list into a hash (note of the translator: it‚Äôs not quite clear what I meant the author under the words ‚Äúfolding a list into a hash‚Äù - folding the list into a single value, or the function of obtaining a hash table from a list of tuples, available in the standard library). <br><br>  In the end, Elliott threw up his hands on the topic of parallel execution of code on several cores, and complained that <br><pre> <code class="hljs">3.times {...}</code> </pre>  will almost certainly be worse than a similar for loop.  It seems to me that he misses one thing.  Yes, there are calculations that must be performed in series, there are also those that can be performed in parallel.  But separating one from the other is difficult for the compiler if the only tool you use is a for loop.  If you can separate sequential calculations (that is, foldl and foldr) and (possibly) parallel (map and filter), then, by this, you seriously simplify the task of the compiler.  Moreover, you can even explicitly <i>request a</i> serial or parallel version of map if you know the nature of the data you are processing better than the compiler. <br><br><h4>  From translator </h4><br>  In the text, references to closures often slip.  If I correctly understand the <a href="http://www.haskell.org/haskellwiki/Closure">definition of closures</a> , then I must say that the author confuses anonymous functions and closures - in the examples he cites there are no functions that work with variables from the environment that are not listed in the parameter list. </div><p>Source: <a href="https://habr.com/ru/post/140439/">https://habr.com/ru/post/140439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140434/index.html">PHPShop Editor supports multisite support.</a></li>
<li><a href="../140435/index.html">Microsoft Office 365: now with us</a></li>
<li><a href="../140436/index.html">Saving flash drive based on Linux Debian / Ubuntu distribution</a></li>
<li><a href="../140437/index.html">OS templates with pre-configured applications have been updated in our cloud.</a></li>
<li><a href="../140438/index.html">Payment from mobile phones</a></li>
<li><a href="../140440/index.html">Sandbox wars - Part 3: ARP-Spoofing, the uselessness of filtering by MAC address and the danger of installing unsigned software</a></li>
<li><a href="../140441/index.html">Writing features and possible features of LR-generators</a></li>
<li><a href="../140442/index.html">Ready to break into the top travel apps - insights of startups iOS apps</a></li>
<li><a href="../140443/index.html">Release mc-4.8.2</a></li>
<li><a href="../140445/index.html">PHPDocumentor teamed up with Docblox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>