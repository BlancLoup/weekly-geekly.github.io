<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>JSOC: how to prepare incidents</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Colleagues, good afternoon. 

 We slightly delayed with the release of our next article. Nevertheless, she is ready and I want to submit an article by...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>JSOC: how to prepare incidents</h1><div class="post__text post__text-html js-mediator-article">  Colleagues, good afternoon. <br><br>  We slightly delayed with the release of our next article.  Nevertheless, she is ready and I want to submit an article by our new analyst and author - Alexey Pavlov - <a href="http://habrahabr.ru/users/avpavlov/" class="user_link">avpavlov</a> . <br><br>  In this article, we will look at the most important aspect of the ‚Äúlivelihoods‚Äù of any Security Operation Center ‚Äî the identification and operational analysis of emerging threats to information security.  We will describe how the rules are set up, as well as the detection and recording of incidents in our outsourced monitoring and response center JSOC. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  About how JSOC works, we talked in our previous articles: <br><br>  <a href="http://habrahabr.ru/company/jetinfosystems/blog/233885/">JSOC: the experience of the young Russian MSSP</a> <br><br>  <a href="http://habrahabr.ru/company/jetinfosystems/blog/236347/">JSOC: how to measure availability of the Security Operation Center?</a> <a href="http://habrahabr.ru/company/jetinfosystems/blog/236347/"><br></a> <br>  Among them, it was mentioned that the core of the JSOC is the HP ArcSight ESM SIEM system.  In this article we will focus on the description of its settings and improvements that were implemented to reduce the number of false-positive-events, operational connection of new systems and GIS, as well as increasing the speed and transparency of the process of analyzing potential incidents for our customers. <br><br>  Any SIEM has a ‚Äúout of the box‚Äù set of predefined correlation rules, which, by comparing events from sources, can alert the client about the threat.  Why, then, need an expensive configuration of this system, as well as its support by the integrator and its own analyst? <br><br>  To answer this question, it is necessary to tell how the life cycle of events that fall into the JSOC from sources is arranged, what is the path from triggering the rule to creating an incident. <br><br>  Primary event handling occurs on the connectors of the SIEM system.  Processing includes filtering, categorization, prioritization, aggregation, and normalization.  The event in CEF (Common Event Format) format is then sent to the core of the HP ArcSight system, where its correlation and visualization occurs.  These are standard mechanisms for handling any SIEM event.  As part of the JSOC, we have refined them to enhance our ability to monitor incidents and obtain information about end systems. <br><br><h3>  Filtering and categorization </h3><br>  One of the main functions of the SIEM are filtering and categorizing the events that occur on the connectors.  In an average SIEM system, 6000‚Äì8000 EPS (Event per Second) is considered a normal flow of events, while the number of event types from 50‚Äì80 sources is in the thousands.  For the convenience of processing such a volume of information, event categories were invented. <br><br>  <em>Note that on the equipment and in the systems of different vendors, the same events are often called differently.</em>  <em>For example, the start of a session as part of a TCP connection for Cisco has the name ‚ÄúBuilt inbound TCP connection‚Äù, for Juniper - ‚Äúsession created‚Äù, and for Checkpoint these are two events: depending on the success of the connection - ‚Äúaccept‚Äù or ‚Äúblock‚Äù.</em>  <em>In order to avoid modifying the correlation rules "under the new vendor" when devices appeared, event categories were introduced that determine the action to be performed.</em> <em><br><br></em>  <em>Example: event from Juniper firewall - ‚Äúsession start‚Äù</em> <em><br><br></em>  <em>Category Significance: / Informational - message type - informational</em> <em><br><br></em>  <em>Category Device Type: Firewall - firewall event</em> <em><br><br></em>  <em>Category Behavior: / Access / Start - open session</em> <em><br><br></em>  <em>Category Outcome: / Success - Successful</em> <em><br><br></em>  <em>Thus, if we need to track successful access events from all devices in the correlation rule, we simply specify Category Behavior: / Access / Start, Category Device Type: Firewall, Category Outcome: / Success.</em> <em><br></em> <br>  In addition to the standard categorization within the JSOC framework, we implemented an additional one to minimize possible changes in the rules that generate incidents.  These rules work for different customers, and changing the parameters under one of them can lead to a temporary and / or complete inoperability of the solution for all. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c8e/302/b3c/c8e302b3cc10c35b548daba68b04e1a1.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/7f1/3e5/046/7f13e504654f6c8e74a2f57c3e38bed7.jpg"><br><br>  <b>Fig.</b>  <b>1. Event categorization by the example of the ‚ÄúINC_Password Change Needed‚Äù rule</b> <br><br>  <em>As an example, we give the rule "INC_Password Change Needed".</em>  <em>Its main task is to notify if authentication has occurred in the system under an account with an expired password.</em>  <em>The period is calculated according to corporate rules and varies depending on the customer.</em>  <em>This rule uses the JSOC ‚ÄúDevice Event Category starts with / JSOC / Authentication /‚Äù categorization, which includes all authentication events from various sources, and the standard categorization ‚ÄúHP Arcsight - Category Outcome = / Success‚Äù - a successful connection event.</em> <br><br><h3>  Basic and profiling rules </h3><br>  To handle certain types of events that fall into the core of the system, special profiling and basic rules have been introduced in JSOC.  Mapping rules for a wide variety of activities play one of the most important roles.  They form the primary data recorded in the active list and later used in the calculations of average, maximum and fluctuation indicators.  Such rules include data on authentication, access to resources, daily traffic, white lists of IP addresses for access to key systems, etc. After typical activity profiles are filled, we can create rules that will fix the deviation from normal activity. <br><br>  Basic rules I would like to highlight a separate item.  Adding missing information to events ‚Äî username to events from firewalls, account owner information from the personnel system, additional description of hosts from the CMDB ‚Äî is implemented in JSOC to speed up the incident resolution process and get all the necessary information in one event. <br><br>  <em>A striking example of the use of basic rules is the "CISCO_VPN_User Session Started".</em>  <em>This rule allows you to associate the IP address of the employee connecting via VPN with his username (this information is in different events coming from the Cisco ASA).</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ea/93a/96c/3ea93a96c13611b1d512ba643190bd56.jpg"><img src="https://habrastorage.org/getpro/habr/post_images/928/1c3/c1f/9281c3c1fac119bc85fb964ba33ef1fb.jpg"><br><br>  <b>Fig.</b>  <b>2. Example of basic rule settings</b> <br><br><h3>  Creating and configuring correlation rules </h3><br>  There are several options for registering anomalous activities: <br><ol><li>  On a specific event from the source </li><li>  On several consecutive events from sources for a certain period; </li><li>  Upon reaching the threshold number of events of the same type for a certain period; </li><li>  By the deviation of any indicators from the reference (or average) value. </li></ol><br>  Let's look at each option in more detail. <br><br>  The easiest way to use correlation rules is to trigger when a single event from a source occurs.  This works great if the SIEM system is used in conjunction with customized GIS. <br><br>  <em>When stopping a critical service on a monitored server, the INC_Critical Service Stopped rule is triggered.</em>  <em>This event may indicate malicious user behavior or malware.</em>  <em>But the majority of directed attacks on the company, as well as internal incidents, cannot be identified by a single event.</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/83d/5a4/169/83d5a4169236b7bae2fb750a10b12f68.jpg"><br><br>  <b>Fig.</b>  <b>3. Example of triggering a rule on a single event from a source</b> <br><br>  The second way - triggering correlation rules for several consecutive events over a period - ideally falls into infrastructure security. <br><br>  <em>Logging in under one account to the workstation and further logging into the target system under another (or the same scenario with VPN and information system) indicates the possibility of theft of these accounts.</em>  <em>Such a potential threat is common, especially in the day-to-day work of administrators (domain: a.andronov, Database: oracle_admin), and causes a large number of false positives, so the creation of white lists and additional profiling are required.</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/eee/e4c/3c1/eeee4c3c18458a3d737870d38235f490.jpg"><br><br>  <b>Fig.</b>  <b>4. An example of triggering a rule on a sequence of events from several sources</b> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/70b/852/886/70b8528861968bbe43fef1a9b418a9f2.jpg"><br><br>  <b>Fig.</b>  <b>5. Example of comparison of events on the incident "unauthorized access to resources from outside"</b> <b><br></b> <br>  The third way to set up rules is great for detecting various scans, brute force, epidemics, and also DDoS. <br><br>  <em>A large number of unsuccessful attempts to log in may indicate a brute force attack.</em>  <em>The ‚ÄúBF_INC_SSH_Dictionary Attack‚Äù rule is configured to track 20 unsuccessful login attempts on Unix systems.</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/675/c9a/aca/675c9aaca47f690933a1d4221535b68a.jpg"><br><br>  <b>Fig.</b>  <b>6. An example of triggering a rule for a certain number of events of the same type</b> <br><br>  The most difficult, at the same time effective and universal way of registering anomalous activities is the use of profiles. <br><br>  <em>An example is the INC_AV_Virus Anomaly Activity correlation rule, which tracks the excess of the average antivirus response rate (calculated on the basis of the profile) for a certain period.</em> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ed2/fd5/8fc/ed2fd58fc3807e11103a528099ea172b.jpg"><br><br>  <b>Fig.</b>  <b>7. Example of rule triggering on exceeding the average</b> <br><br>  Developing JSOC, we drew certain lessons that became the basis for the following recommendations for creating correlation rules: <br><ol><li>  You must use profiling.  For one client, it can be absolutely normal to use TOR on a host, and for another, it is a direct way to dismiss an employee.  Some VPN-access has only trusted administrators who can work with the entire infrastructure, others have access to half of the employees, but they only work with their station.  But at the same time, the overwhelming majority of the company's employees work according to the same scenario on a daily basis, it is easy to profile it, therefore, it is easy to register anomalies.  Therefore, in JSOC we use the same rules, but the parameters, lists, filters in them are individual for each client; </li><li>  Difficult rules do not work: if you pile up a dozen conditions for triggering rules to minimize the number of False Positive, the chance of their triggering is low, and the risk of missing something important is high; </li><li> SIEM should solve only its own tasks.  No need to try to drop everything on it, if for these purposes there are specialized solutions.  For example, you need to configure a rule that should work if an external IP address attempts to make more than 1000 connections to an external resource in 1 minute.  It is much easier to configure this rule on IPS, which is intended for this without loading SIEM with extra work. </li></ol><br>  At the same time, I would like to note: no matter how well the SIEM system is configured, False Positive events will always be present.  If not, then SIEM is dead.  That is why it is important to have qualified monitoring engineers who can identify the real incident.  The specialist should have a set of knowledge on information security, profiles of possible attacks and know the final systems for analyzing events. <br><br><h3>  Conclusion </h3><br>  As a final word, I would like to summarize the recommendations for organizing my own SOC in a company: <br><ol><li>  The most important element of SOC is the SIEM-system, the issues of its selection were discussed in the first article of the cycle, but the most important point is its adjustment to the requirements of the business and infrastructure features; </li><li>  Creating correlation rules to detect various attack scenarios and the activities of intruders is a huge layer of work that never ends due to the constant development of threats.  That is why you need to have your own qualified analyst; </li><li>  The first line of monitoring engineers should be formed on the basis of the information security department.  The specialist should be able to distinguish False Positive responses from real incidents and conduct a basic analysis of events.  This requires skills in the field of information security and an understanding of possible attack vectors. </li></ol></div><p>Source: <a href="https://habr.com/ru/post/246205/">https://habr.com/ru/post/246205/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../246195/index.html">6 games in 6 weeks - the second game</a></li>
<li><a href="../246197/index.html">Security scanners: automatic validation of vulnerabilities using fuzzy sets and neural networks</a></li>
<li><a href="../246199/index.html">We use standard ListFragment elements for their intended purpose.</a></li>
<li><a href="../246201/index.html">A practical example of reusing code, how to improve quality and speed development</a></li>
<li><a href="../246203/index.html">Online project user support: 3 working tools</a></li>
<li><a href="../246211/index.html">What tests do you need? Part 1. On the goals and objectives that affect the choice of tests</a></li>
<li><a href="../246213/index.html">Toaster. Related tags, first page of tag subscriptions</a></li>
<li><a href="../246221/index.html">A chance to learn from Yandex what he knows best</a></li>
<li><a href="../246223/index.html">Installing and configuring a VPS with a CentOS 6.x pair of commands with VestaCP</a></li>
<li><a href="../246235/index.html">Habr, meet - new LinguaLeo with a personalized system of learning a foreign language</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>