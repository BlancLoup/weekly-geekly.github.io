<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mahou updated to version 2.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably you have already read my introductory article about Mahou , in it I described how I created the first function and described what the program...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mahou updated to version 2.0</h1><div class="post__text post__text-html js-mediator-article"><p><img src="http://i.imgur.com/89okhxP.jpg"><br>  Probably you have already read my introductory <a href="https://habrahabr.ru/post/321518/">article about Mahou</a> , in it I described how I created the first function and described what the program does in general.  Since then, not a little time has passed in Mahou. A lot of things have changed and been added, and this article will be discussed in fact. </p><br><a name="habracut"></a><br><h2 id="izmeneniya-v-interfeyse">  Interface changes </h2><br><p>  The interface has changed a lot, for the better, everything has become convenient and visible, this is how Mahou looked like before: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/2a4/006/ea9/2a4006ea980f42df8b170885fbd4eda6.png"></p><br><p>  And now it looks like this: </p><br><p><img src="http://i.imgur.com/gDMYOUq.jpg"></p><br><h2 id="kak-ya-pisal-plagin-dlya-sublime-text-3">  As I wrote a plugin for Sublime Text 3 </h2><br><p>  The function "Hint of the current layout near the text cursor (carriage)" got the ability to display in Sublime Text 3, using a <a href="https://github.com/BladeMight/MahouCaretDisplayServer">plugin</a> which I wrote specifically for this. </p><br><p> It all started when I was looking for an opportunity to take a position on which the text cursor is now, searched for a method and found it on the Sublime Text ‚Üí <code>view.rowcol(view.sel()[0].begin())</code> that returned a line and the number of letters on which is now a text cursor, it was what you need.  Then I thought, "How do you transfer this data to Mahou from Sublime Text?", And remembered the sockets (I knew about them quite a bit) and decided to write a server that will work on 127.0.0.1 (localhost) and port 7777 , at first nothing worked, then I read a couple of articles about sockets and began to understand how they work.  Then I started reading the <a href="https://www.sublimetext.com/docs/3/api_reference.html">Sublime Text 3 API</a> , then I started creating a plugin: </p><br><p>  First, I initialized the server to which the data will be issued, then I created EvenListener with listening to the events: </p><br><ol><li>  on_window_command When showing / hiding, etc.  windows (window), in particular, I used it for the sidebar. </li><li>  on_modified When the view is changed. </li><li>  on_activated When activating the editor / tab / panel. </li><li>  on_text_command When you press any key on the keyboard / mouse. </li></ol><br><p>  Then I began to look for a way to get the X, Y coordinates of the carriage position, from ST3API I learned that you can get the height of the line and the width of the text, if you multiply them by lines and the number of letters, you can get the necessary coordinates.  But there was one problem - the tab character was considered as 1 character, so I decided that it was necessary to count the number of Tabs per line and multiply them by 3 and add to the number of letters - and it worked! </p><br><p>  Then I added the definition of the sidebar width, but it wasn‚Äôt as simple as when it was hidden / shown, it uses animation, and the EventListener returned the width before the animation finished, looking at other possible APIs, I came to the conclusion that another solution to this problem except how to add time to wait for the end of the animation before sending data to the server - no, and added 300 ms of waiting - and it worked fine! </p><br><p>  Then I created the settings for the plugin, created a client that received data from the server in Mahou and everything worked. </p><br><h2 id="silno-uluchsheny-funkcii-ispolzuyuschie-taymery">  Strongly improved functions using timers. </h2><br><h3 id="funkcii-kotorye-ispolzuyut-taymery">  Functions that use timers: </h3><br><ul><li>  Language tips near the mouse / carriage. </li><li>  Timer switch CapsLock. </li><li>  Highlight Scroll-Lock when layout # 1 is active. </li><li>  Flags of countries in the tray. </li></ul><br><h3 id="kak-ya-uluchshil-ih">  How I improved them: </h3><br><p>  Previously, when a timer tick is valid for the flags of countries in the tray, the icon always changed, which ultimately put a heavy load on the CPU and sometimes even drove GDI +, so I decided to implement a variable that will store the name of the last changed language, and the condition that The current language is equal to the previous one, then not to change the icon, which <strong>significantly</strong> reduced the load on the CPU, I improved the other functions in a similar way. </p><br><h2 id="mahou-teper-ispolzuet-nastroyki-v-ozu">  Mahou now uses settings in RAM. </h2><br><p>  What does it mean?  This means that earlier when reading a particular setting, a disk was used, creating an extra load, I decided to create variables for each setting in order not to use the disk but to use them (RAM).  Now, reading / writing from / to disk occurs only when saving / loading settings. </p><br><h2 id="chto-esche-novogo">  What are other news? </h2><br><ul><li>  Text case conversion functions. </li><li>  Memory clearing, now Mahou consumes 3 ~ 5MB of RAM. </li><li>  Improved support for Microsoft applications (Office, Skype, etc.) </li><li>  Added the ability to change the text for language tips. </li><li>  Updated debug information. </li><li>  Updated Wiki for Mahou 2.0. </li></ul><br><h2 id="ssylki">  Links </h2><br><ul><li>  <a href="https://github.com/BladeMight/Mahou">Repository</a> </li><li>  <a href="http://blademight.github.io/Mahou/">Site</a> </li><li>  <a href="https://github.com/BladeMight/Mahou/wiki">Wiki</a> </li><li>  <a href="https://github.com/BladeMight/Mahou/releases">Releases</a> (download) </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/324592/">https://habr.com/ru/post/324592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../324580/index.html">Asterisk queues, minor tricks</a></li>
<li><a href="../324582/index.html">Spring Games KIPS. Or master the budget for information security in $ 300.000</a></li>
<li><a href="../324586/index.html">Employees and social networks</a></li>
<li><a href="../324588/index.html">Continuous integration with Drone CI, Docker and Ansible</a></li>
<li><a href="../324590/index.html">The history of the 3rd place on ML Boot Camp III</a></li>
<li><a href="../324594/index.html">JNI Receive and Connect to JVM in Delphi</a></li>
<li><a href="../324596/index.html">Statistics on property values ‚Äã‚Äã- visualization on the map</a></li>
<li><a href="../324598/index.html">Quadstor - performance and reliability</a></li>
<li><a href="../324600/index.html">GitHub introduces SHA-1 collision detection system</a></li>
<li><a href="../324604/index.html">Detection and elimination of hacker attacks: how the system GOSPKA works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>