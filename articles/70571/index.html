<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Qt + Kinetic = Eye-candy for half an hour</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the process of developing a new version of QutIM, there was a need to rewrite the notification system, since the old one had many drawbacks. 

 Not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Qt + Kinetic = Eye-candy for half an hour</h1><div class="post__text post__text-html js-mediator-article">  In the process of developing a new version of QutIM, there was a need to rewrite the notification system, since the old one had many drawbacks. <br><br>  Not too long ago, a <a href="http://habrahabr.ru/blogs/qt_software/69316/">topic</a> devoted to new features that appeared in Qt appeared on Habr√©.  In particular, it describes a new framework designed to facilitate the creation of an animated user interface.  If the dear reader is not yet up to date, then I advise you first to get acquainted with this article. <br><br>  A short video demonstrating the possibilities: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <iframe width="420" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/Po4qdoqKJOs%3Ffeature%3Doembed&amp;xid=25657,15700023,15700186,15700190,15700253,15700256,15700259&amp;usg=ALkJrhhvNJ-EFuMqO9gJRf3OkLnwYWFMwA" frameborder="0" allowfullscreen=""></iframe><br><br><a name="habracut"></a><br><h5>  Introduction </h5><br>  In the review article, one worthy framework was found that I found in Qt.Labs, namely <a href="http://labs.trolltech.com/page/Projects/Graphics/Kinetic">Kinetic</a> . <br>  The authors promise us the following: <br><ul><li>  <b>Animation framework</b> - the ability to create both simple and complex types of animation for any type of widget.  Providing finished animation, the ability to add and create custom. </li><li>  <b>The declarative creation of an interface</b> is the task of an interface by describing its properties, and not by manipulating ready-made templates. </li><li>  <b>Advanced graphics capabilities</b> - add shadows, transparency, filters, and so on. </li></ul>  It looks delicious, right?  Therefore, I, armed with patience and readiness for the unknown, wrote a small example.  I note that it took much less time than expected. <br>  Movements of notifications turned out smooth.  They themselves are always lined up so as not to overlap the neighboring ones, and in the case when the text does not fit, the window will automatically be scaled. <br><habracut><br>  What is needed in order to create a library that can display these notifications? <br><ul><li>  <b>KineticNotifications</b> - through this class and notifications will be sent.  The class is responsible for displaying and animating notifications. </li><li>  <b>NotificationWidget</b> - pamo popup notification, is a QTextBrowser with a frame removed and an alpha channel added. </li><li>  <b>Notification Manager</b> is a singleton that stores pointers to all running notifications, controls their placement, and also provides settings. </li></ul><h5>  Program code </h5><br>  In order to trigger a notification, a couple of lines are enough: <br><blockquote><ol><li>  KineticNotification <font color="#006E28">*</font> notify <font color="#006E28">=</font> <font color="#000000">new</font> KineticNotification <font color="#006E28">(</font> <font color="#BF0303">"id"</font> <font color="#006E28">,</font> timeout <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  notify <font color="#006E28">-&gt;</font> <font color="#2B74C7">setMessage</font> <font color="#006E28">(</font> <font color="#22aadd">QString</font> <font color="#006E28">::</font> <font color="#2B74C7">fromUtf8</font> <font color="#006E28">(</font> <font color="#BF0303">"Test"</font> <font color="#006E28">)</font> <font color="#006E28">,</font> </li><li>  <font color="#22aadd">QString</font> <font color="#006E28">::</font> <font color="#2B74C7">fromUtf8</font> <font color="#006E28">(</font> <font color="#BF0303">"Message"</font> <font color="#006E28">)</font> <font color="#006E28">,</font> </li><li>  <font color="#BF0303">"./images/avatar.jpg"</font> </li><li>  <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#0057AE">connect</font> <font color="#006E28">(</font> notify <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> action2Activated <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> <font color="#22aadd">QApplication</font> <font color="#006E28">::</font> <font color="#2B74C7">instance</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">,</font> SLOT <font color="#006E28">(</font> quit <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#0057AE">connect</font> <font color="#006E28">(</font> notify <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> action1Activated <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> SLOT <font color="#006E28">(</font> nextNotify <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  notify <font color="#006E28">-&gt;</font> <font color="#2B74C7">send</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li></ol></blockquote><br>  Each notification is assigned its own identifier, which must be unique.  This allows you to get by the identifier a pointer to an already existing notification, in order, for example, to add a line to it. <br><br>  This is done in a very simple way: <br><blockquote><ol><li>  KineticNotification <font color="#006E28">*</font> notify <font color="#006E28">=</font> NotificationsManager <font color="#006E28">::</font> <font color="#2B74C7">self</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">getById</font> <font color="#006E28">(</font> <font color="#BF0303">"id"</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#000000">if</font> <font color="#006E28">(</font> notify <font color="#006E28">! =</font> <font color="#B08000">0</font> <font color="#006E28">)</font> <font color="#006E28">{</font> </li><li>  notify <font color="#006E28">-&gt;</font> <font color="#2B74C7">appendMessage</font> <font color="#006E28">(</font> <font color="#22aadd">QString</font> <font color="#006E28">::</font> <font color="#2B74C7">fromUtf8</font> <font color="#006E28">(</font> <font color="#BF0303">"Add a string of text"</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#006E28">}</font> </li></ol></blockquote><br>  It is important to remember that if there is no notification with the requested id, the function will return 0. <br><br>  We now turn to the most important thing: the description of the State machine. <br>  First you need to create all the states of the machine.  In total there will be three: <br><ul><li>  <b>show_state</b> - the notification is shown on the screen </li><li>  <b>hide_state</b> - notification is hidden </li><li>  <b>final_state</b> - this position stops the state machine </li></ul>  Set the sequence of states: <br><br><blockquote><ol><li>  show_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">addTransition</font> <font color="#006E28">(</font> notification_widget <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> action1Activated <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> hide_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  show_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">addTransition</font> <font color="#006E28">(</font> notification_widget <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> action2Activated <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> hide_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  hide_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">addTransition</font> <font color="#006E28">(</font> hide_state <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> polished <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> final_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  show_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">addTransition</font> <font color="#006E28">(</font> <font color="#000000">this</font> <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> updated <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> show_state <font color="#006E28">)</font> <font color="#006E28">;</font>  <font color="#888888">// a little trick</font> </li></ol></blockquote><br>  The last line allows you to do without the additional state of the machine if you need to change the position on the screen of the previously drawn notification.  After that, you need to set the starting position for the notification (on the right-hand side of the screen) and the position that the notification will take, going to the show_state state.  The position and size of the widget can be set using the setGeometry method, whose argument is a QRect, which is nothing more than a rectangle that has the coordinate of the upper left point, as well as its height and height. <br>  To find out at which point on the screen you need to create a notification and where to move it then we need to know the position of the previous widget or, in the absence of such a lower right corner: <br><blockquote><ol><li>  <font color="#22aadd">QRect</font> geom <font color="#006E28">=</font> <font color="#22aadd">QApplication</font> <font color="#006E28">::</font> <font color="#2B74C7">desktop</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">availableGeometry</font> <font color="#006E28">(</font> <font color="#22aadd">QCursor</font> <font color="#006E28">::</font> <font color="#2B74C7">pos</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li></ol></blockquote><br>  And as a result, we get the angle of the monitor on which the mouse pointer! <br><br>  The starting point has been obtained, now you can set the text, change the height of the widget to the optimum, so that it can fit all the displayed text and images. <br><blockquote><ol><li>  this <font color="#006E28">-&gt;</font> <font color="#2B74C7">document</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">setHtml</font> <font color="#006E28">(</font> data <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  this <font color="#006E28">-&gt;</font> <font color="#2B74C7">document</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">setTextWidth</font> <font color="#006E28">(</font> NotificationsManager <font color="#006E28">::</font> <font color="#2B74C7">self</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">defaultSize</font> . <font color="#2B74C7">width</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#0057AE">int</font> width <font color="#006E28">=</font> NotificationsManager <font color="#006E28">::</font> <font color="#2B74C7">self</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">defaultSize</font> .  <font color="#2B74C7">width</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#0057AE">int</font> height <font color="#006E28">=</font> this <font color="#006E28">-&gt;</font> <font color="#2B74C7">document</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">size</font> <font color="#006E28">(</font> <font color="#006E28">)</font> .  <font color="#2B74C7">height</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li></li><li>  <font color="#000000">return</font> <font color="#22aadd">QSize</font> <font color="#006E28">(</font> width <font color="#006E28">,</font> height <font color="#006E28">)</font> <font color="#006E28">;</font> </li></ol></blockquote><br>  Be sure to ask what stage follows what and what condition is necessary to move the machine from one stage to another. <br><blockquote><ol><li>  <font color="#000000">if</font> <font color="#006E28">(</font> timeOut <font color="#006E28">&gt;</font> <font color="#B08000">0</font> <font color="#006E28">)</font> <font color="#006E28">{</font> </li><li>  startTimer <font color="#006E28">(</font> timeOut <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  show_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">addTransition</font> <font color="#006E28">(</font> <font color="#000000">this</font> <font color="#006E28">,</font> SIGNAL <font color="#006E28">(</font> timeoutReached <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">)</font> <font color="#006E28">,</font> hide_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  <font color="#006E28">}</font> </li><li></li><li>  machine.  <font color="#2B74C7">addState</font> <font color="#006E28">(</font> show_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  machine.  <font color="#2B74C7">addState</font> <font color="#006E28">(</font> hide_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  machine.  <font color="#2B74C7">addState</font> <font color="#006E28">(</font> final_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  machine.  <font color="#2B74C7">setInitialState</font> <font color="#006E28">(</font> show_state <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li></li></ol></blockquote><br>  But the position and size of notifications periodically have to be changed, for example, if the bottom widget disappears, then all other notifications should be moved down so as not to create empty space.  The same applies to adding text: sooner or later you will have to resize the widget and, accordingly, move all the others so that none of them overlaps the other.  In addition, it is very important to know the final position of the notification, since it is necessary for correct recalculation of the position of the entire chain.  Otherwise, the instantaneous position and size of the notification in the process of its movement can be obtained, as a result of which the widgets will assume the wrong position. <br>  To update, it is enough to call a function in the singleton that will recalculate the positions of the widgets from the bottom right edge of the screen. <br><blockquote><ol><li>  NotificationsManager <font color="#006E28">::</font> <font color="#2B74C7">self</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">updateGeometry</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li></ol></blockquote><br>  Calls in each of the widgets the function of updating the position and size. <br><blockquote><ol><li>  show_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">assignProperty</font> <font color="#006E28">(</font> notification_widget <font color="#006E28">,</font> <font color="#BF0303">"geometry"</font> <font color="#006E28">,</font> geom <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  updateGeometry <font color="#006E28">(</font> geom <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  geom.  <font color="#2B74C7">moveRight</font> <font color="#006E28">(</font> geom. <font color="#2B74C7">right</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">+</font> notification_widget <font color="#006E28">-&gt;</font> <font color="#2B74C7">width</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">+</font> NotificationsManager <font color="#006E28">::</font> <font color="#2B74C7">self</font> <font color="#006E28">(</font> <font color="#006E28">)</font> <font color="#006E28">-&gt;</font> <font color="#2B74C7">margin</font> <font color="#006E28">)</font> <font color="#006E28">;</font> </li><li>  hide_state <font color="#006E28">-&gt;</font> <font color="#2B74C7">assignProperty</font> <font color="#006E28">(</font> notification_widget <font color="#006E28">,</font> <font color="#BF0303">"geometry"</font> <font color="#006E28">,</font> geom <font color="#006E28">)</font> <font color="#006E28">;</font> </li></ol></blockquote><br>  Thus, it is sufficient for any event that may lead to a change in the position or size of the widget to trigger the update function.  These events include the removal of the widget and the addition of additional lines to it. <br>  In general, it turned out very functional and rather succinctly. <br><br><h5>  Conclusion </h5><br>  For those who are interested in the implementation of the notification widget, and who are interested in learning more about the work of the library, and also use it, <a href="http://sauron.me/kineticnotifications/src/">link</a> to the source code, the LGPL license.  This program was tested on Qt4.6tp1, kinetic brunch 4.5 branches and should work with QAnimationFramework from Qt Solutions. <br>  Enjoy using <br><br>  <s><b>NB</b> Published at the request of one good person from the QutIM development team, who does not have an account on Habr√©, but would like to participate in the community life.</s>  <s>Here is his mail: sauron@citadelspb.com</s> <br><br>  <b>UPD:</b> Welcome <a href="http://habrahabr.ru/users/gorthauer87/" class="user_link">Gorthauer87</a> ! </habracut></div><p>Source: <a href="https://habr.com/ru/post/70571/">https://habr.com/ru/post/70571/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../70563/index.html">"Faith and Heart" - an online release from Knowing Existence</a></li>
<li><a href="../70566/index.html">Web agencies are invited to the Moscow Microsoft Forum for software development companies.</a></li>
<li><a href="../70567/index.html">Nemerle language</a></li>
<li><a href="../70569/index.html">Microsoft has released an incredibly tedious video and banned its discussion.</a></li>
<li><a href="../70570/index.html">Emulation></a></li>
<li><a href="../70575/index.html">Snow Leopard megabytes</a></li>
<li><a href="../70576/index.html">Big Beta: New Evernote for Windows</a></li>
<li><a href="../70577/index.html">Pilot video podcast SOUS TV</a></li>
<li><a href="../70578/index.html">How I was an open source ...</a></li>
<li><a href="../70579/index.html">Are you well prepared for using Windows 7? Several hot keys</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>