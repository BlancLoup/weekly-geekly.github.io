<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a simple audio editor</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We offer readers the continuation of the article from our partners, Music Paradise. Last time, the team presented a tutorial on extracting audio data ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a simple audio editor</h1><div class="post__text post__text-html js-mediator-article">  We offer readers the continuation of the article from our partners, Music Paradise.  <a href="https://habrahabr.ru/company/everydaytools/blog/325828/">Last time, the</a> team presented a tutorial on extracting audio data from wav files;  Today we will discuss how to use this functionality in a wider context - when developing a full-fledged audio editor with a standard set of functions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/6f5/317/639/6f53176399e84ac981efa35b611f289a.jpg"></div><br>  ‚ÄúIn the previous article we looked at the process of extracting audio data and even managed to build a graph based on them.  However, we did not make any changes to the audio data and, accordingly, there was no need to save the audio file.  We only noted that the process of preservation is inverse to reading.  Therefore, in order not to be unfounded, we decided to back up the words with a deed and consider the full cycle of working with an audio file.  The expediency of this undertaking is confirmed by numerous questions on this subject on the Internet, and most of them remain open. <br><a name="habracut"></a><br>  Having set a goal to shed light on this problem until the end and give a ready solution for working with audio data, we will describe the process of creating a simple application in the arsenal of which will be all the basic operations for editing an audio file: copy, cut, paste, delete and, of course, save the result to device.  For the sake of consistency of presentation and simplicity of perception, we will take the implementation of part of the functional from the previous article, having previously subjected the code to some changes. <br><br>  Without losing time, we immediately transfer to our new project the already familiar GraphicalWavePlot structure and the PlottingGraphImg class, but add the method to the latter: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task&lt;SoftwareBitmapSource&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetImage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (softwareBitmap.BitmapPixelFormat != BitmapPixelFormat.Bgra8 || softwareBitmap.BitmapAlphaMode == BitmapAlphaMode.Straight) { softwareBitmap = SoftwareBitmap.Convert(softwareBitmap, BitmapPixelFormat.Bgra8, BitmapAlphaMode.Premultiplied); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> source = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SoftwareBitmapSource(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> source.SetBitmapAsync(softwareBitmap); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> source; }</code> </pre> <br>  We need it to control the visual state of the audio track. <br><br>  In addition to the added method, do not forget to change the color of the wave drawing.  In the previous article we used white, but here it is not the best idea - on a white background, the plot will be indistinguishable. <br><br>  Another class known to us, WavFile, will undergo multiple changes.  We must bring it to the following form: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">WavFile</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> PathAudioFile { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> FileName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> TimeSpan duration; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> TimeSpan Duration { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> duration; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ticksInSecond = <span class="hljs-number"><span class="hljs-number">10000000</span></span>; <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> HeadData int headSize; int chunkID; int fileSize; int riffType; int fmtID; int fmtSize; int fmtCode; int channels; int sampleRate; int byteRate; int fmtBlockAlign; int bitDepth; int fmtExtraSize; int dataID; int dataSize; public int Channels { get { return channels; } } public int SampleRate { get { return sampleRate; } } #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">region</span></span></span><span class="hljs-meta"> AudioData private List&lt;float&gt; floatAudioBuffer = new List&lt;float&gt;(); #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">endregion</span></span></span><span class="hljs-meta"> public WavFile(string _path) { PathAudioFile = _path; FileName = Path.GetFileName(PathAudioFile); ReadWavFile(_path); } public float[] GetFloatBuffer() { return floatAudioBuffer.ToArray(); } public void SetFloatBuffer(float[] _buffer) { floatAudioBuffer.Clear(); floatAudioBuffer.AddRange(_buffer); CalculateDurationTrack(); CalculateDataSize(); CalculateFileSize(); } public void CalculateDurationTrack() =&gt; duration = TimeSpan.FromTicks((long)(((double)floatAudioBuffer.Count / SampleRate / Channels) * ticksInSecond)); public void CalculateDataSize() =&gt; dataSize = floatAudioBuffer.Count * sizeof(Int16); public void CalculateFileSize() =&gt; fileSize = headSize + dataSize; void ReadWavFile(string filename) { try { using (FileStream fileStream = File.Open(filename, FileMode.Open)) { BinaryReader reader = new BinaryReader(fileStream); chunkID = reader.ReadInt32(); fileSize = reader.ReadInt32(); riffType = reader.ReadInt32(); long _position = reader.BaseStream.Position; int zeroChunkSize = 0; while (_position != reader.BaseStream.Length - 1) { reader.BaseStream.Position = _position; int _fmtId = reader.ReadInt32(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (_fmtId == 544501094) { fmtID = _fmtId; break; } </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">else</span></span></span><span class="hljs-meta"> { _position++; zeroChunkSize++; } } fmtSize = reader.ReadInt32(); fmtCode = reader.ReadInt16(); channels = reader.ReadInt16(); sampleRate = reader.ReadInt32(); byteRate = reader.ReadInt32(); fmtBlockAlign = reader.ReadInt16(); bitDepth = reader.ReadInt16(); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (fmtSize == 18) { fmtExtraSize = reader.ReadInt16(); reader.ReadBytes(fmtExtraSize); } dataID = reader.ReadInt32(); dataSize = reader.ReadInt32(); headSize = fileSize - dataSize - zeroChunkSize; byte[] byteArray = reader.ReadBytes(dataSize); int bytesInSample = bitDepth / 8; int sampleAmount = dataSize / bytesInSample; float[] tempArray = null; switch (bitDepth) { case 16: Int16[] int16Array = new Int16[sampleAmount]; System.Buffer.BlockCopy(byteArray, 0, int16Array, 0, dataSize); IEnumerable&lt;float&gt; tempInt16 = from i in int16Array select i / (float)Int16.MaxValue; tempArray = tempInt16.ToArray(); break; default: return; } floatAudioBuffer.AddRange(tempArray); CalculateDurationTrack(); } } catch { Debug.WriteLine("File </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">error</span></span></span><span class="hljs-meta">"); } } public void WriteWavFile() { WriteWavFile(PathAudioFile); } public void WriteWavFile(string filename) { using (FileStream fs = File.Create(filename)) { fs.Write(BitConverter.GetBytes(chunkID), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(fileSize), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(riffType), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(fmtID), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(fmtSize), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(fmtCode), 0, sizeof(Int16)); fs.Write(BitConverter.GetBytes(channels), 0, sizeof(Int16)); fs.Write(BitConverter.GetBytes(sampleRate), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(byteRate), 0, sizeof(Int32)); fs.Write(BitConverter.GetBytes(fmtBlockAlign), 0, sizeof(Int16)); fs.Write(BitConverter.GetBytes(bitDepth), 0, sizeof(Int16)); </span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">if</span></span></span><span class="hljs-meta"> (fmtSize == 18) fs.Write(BitConverter.GetBytes(fmtExtraSize), 0, sizeof(Int16)); fs.Write(BitConverter.GetBytes(dataID), 0, sizeof(Int32)); float[] audioBuffer; audioBuffer = floatAudioBuffer.ToArray(); fs.Write(BitConverter.GetBytes(dataSize), 0, sizeof(Int32)); // Add Audio Data to wav file byte[] byteBuffer = new byte[dataSize]; Int16[] asInt16 = new Int16[audioBuffer.Length]; IEnumerable&lt;Int16&gt; temp = from g in audioBuffer select (Int16)(g * (float)Int16.MaxValue); asInt16 = temp.ToArray(); Buffer.BlockCopy(asInt16, 0, byteBuffer, 0, dataSize); fs.Write(byteBuffer, 0, dataSize); } } }</span></span></code> </pre> <br></div></div><br>  It is impossible not to notice the overloaded WriteWavFile method.  Thanks to him, our class can now not only receive audio data, but also save it into an accessible file.  Now you can see for yourself: we were not deceitful when we said that the writing process is inverse to reading.  It uses the same FileStream, only this time for recording.  It also became clear why the fields needed to store the data of the file structure became publicly available within the current class.  We draw your attention to the fact that some of them - duration, dataSize, fileSize - need to be controlled.  To find the fileSize, we did not complicate the algorithm and used the simplest version of the calculation. <br><br>  These are all fragments that we can transfer from the previous article, the rest will be written from scratch.  Let's go in order. <br><br>  Add the AudioDataEditor class to our project.  Note that it is derived from WavFile: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">AudioDataEditor</span></span>:<span class="hljs-title"><span class="hljs-title">WavFile</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; audioBufferInMemory = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; AudioBufferInMemory { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> audioBufferInMemory; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { audioBufferInMemory = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AudioDataEditor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> path</span></span></span><span class="hljs-function">) : </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">base</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">path</span></span></span><span class="hljs-function">)</span></span>{ } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetExactPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> startPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> endPosition, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length</span></span></span><span class="hljs-function">)</span></span> { SetExactPosition(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> startPosition, length); SetExactPosition(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> endPosition, length); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetExactPosition</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> length</span></span></span><span class="hljs-function">)</span></span> { position = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(length * position); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Channels == <span class="hljs-number"><span class="hljs-number">2</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position % <span class="hljs-number"><span class="hljs-number">2</span></span> == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (position + <span class="hljs-number"><span class="hljs-number">1</span></span> &gt;= length) position--; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> position++; } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Copy</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeStartPos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeEndPos</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] audioData = GetFloatBuffer(); AudioBufferInMemory.Clear(); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> startPosition = relativeStartPos; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> endPosition = relativeEndPos; SetExactPosition(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> startPosition, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> endPosition, audioData.Length); <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[] temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span>[(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(endPosition - startPosition)]; Array.Copy(audioData.ToArray(), (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)startPosition, temp, <span class="hljs-number"><span class="hljs-number">0</span></span>, temp.Length); AudioBufferInMemory.AddRange(temp); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cut</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeStartPos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeEndPos</span></span></span><span class="hljs-function">)</span></span> { Copy(relativeStartPos, relativeEndPos); Delete(relativeStartPos, relativeEndPos); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Paste</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeStartPos</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AudioBufferInMemory.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(); temp.AddRange(GetFloatBuffer()); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> startPosition = relativeStartPos; SetExactPosition(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> startPosition, temp.Count); temp.InsertRange((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)startPosition, AudioBufferInMemory); SetFloatBuffer(temp.ToArray()); WriteWavFile(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeStartPos, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> relativeEndPos</span></span></span><span class="hljs-function">)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt; _temp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">float</span></span>&gt;(); _temp.AddRange(GetFloatBuffer()); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> startPosition = relativeStartPos; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> endPosition = relativeEndPos; SetExactPosition(<span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> startPosition, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> endPosition, _temp.Count); _temp.RemoveRange((<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)startPosition, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(endPosition - startPosition)); SetFloatBuffer(_temp.ToArray()); WriteWavFile(); } }</code> </pre><br></div></div><br>  The AudioDataEditor class implements the operations we talked about at the beginning;  their implementation will not seem difficult for you to study in detail. <br><br>  And each process of changing audio data is accompanied by their saving in the current file.  We only note that when working with two-channel audio data, it is worth being more careful with alternating samples. <br><br>  So, in part, we implemented the main mechanism of our application.  But for the full functioning of this is not enough, you need an interface that can correctly control the application.  Moreover, editing and performing basic operations with an audio track requires a perfect mechanism, like modern editors, and not just entering the beginning and end of the space to be copied or deleted.  Here we also need the display of the audio wave obtained earlier.  By highlighting its fragment, we will mark the desired segments. <br><br>  We will implement the mechanism for selecting a fragment of an audio track by creating our own interface element.  Perform the following steps: select Add ‚Üí NewItem ... from the context menu, select UserControl in the window that appears and name it GraphicsEditor, then click the Add button. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/09c/c76/c58/09cc76c58482438eba4f4bfc4c3fab55.png"></div><br><br>  Created by GraphicsEditor.xaml as a result of the changes, it looked as follows: <br><br><pre> <code class="cs hljs">&lt;UserControl x:Class=<span class="hljs-string"><span class="hljs-string">"AudioEditorTest.GraphicsEditor"</span></span> xmlns=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span> xmlns:x=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/winfx/2006/xaml"</span></span> xmlns:local=<span class="hljs-string"><span class="hljs-string">"using:AudioEditorTest"</span></span> xmlns:d=<span class="hljs-string"><span class="hljs-string">"http://schemas.microsoft.com/expression/blend/2008"</span></span> xmlns:mc=<span class="hljs-string"><span class="hljs-string">"http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span> mc:Ignorable=<span class="hljs-string"><span class="hljs-string">"d"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>&gt; &lt;Grid&gt; &lt;Image Name=<span class="hljs-string"><span class="hljs-string">"BackgroundImage"</span></span> Stretch=<span class="hljs-string"><span class="hljs-string">"Fill"</span></span>/&gt; &lt;Canvas Name=<span class="hljs-string"><span class="hljs-string">"MainContainer"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"#0001FFFF"</span></span>&gt; &lt;Rectangle Name=<span class="hljs-string"><span class="hljs-string">"SelectedChunk"</span></span> Visibility=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"150"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"50"</span></span> Fill=<span class="hljs-string"><span class="hljs-string">"#19000000"</span></span>/&gt; &lt;/Canvas&gt; &lt;/Grid&gt; &lt;/UserControl&gt;</code> </pre> <br><br>  GraphicsEditor.xaml.cs: <br><br><div class="spoiler">  <b class="spoiler_title">Expand</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">GraphicsEditor</span></span> : <span class="hljs-title"><span class="hljs-title">UserControl</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GraphicsEditor</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.InitializeComponent(); DataContext = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; MainContainer.PointerPressed += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PointerEventHandler(PointerPressed); MainContainer.PointerMoved += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PointerEventHandler(PointerMoved); MainContainer.PointerReleased += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PointerEventHandler(PointerReleased); MainContainer.PointerExited += <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PointerEventHandler(PointerReleased); } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> leftPos; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> rightPos; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> minSelectionWidth = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isPressed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> startSelectionPosition = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> currentSelectionWidth = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">event</span></span> EventHandler SelectionChanged = <span class="hljs-keyword"><span class="hljs-keyword">delegate</span></span> { }; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> enableSelection = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> EnableSelection { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> enableSelection; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { enableSelection = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> SoftwareBitmapSource imageSource; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> SoftwareBitmapSource ImageSource { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> imageSource; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { imageSource = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; BackgroundImage.Source = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> LeftPos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> leftPos; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { leftPos = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; SetRightSelectionMargin(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> RelativeLeftPos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> leftPos / ActualWidth; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> RightPos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rightPos; } <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> { rightPos = <span class="hljs-keyword"><span class="hljs-keyword">value</span></span>; SetRightSelectionMargin(); } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> RelativeRightPos { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> rightPos / ActualWidth; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetRightSelectionMargin</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { currentSelectionWidth = Math.Abs(rightPos - leftPos); ManageGraphics(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ManageGraphics</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { SelectedChunk.SetValue(Canvas.LeftProperty, LeftPos); SelectedChunk.Width = currentSelectionWidth; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointerReleased</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PointerRoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { isPressed = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Math.Abs(startSelectionPosition - GetPointerPositionX(e)) &lt; minSelectionWidth) { EnableSelection = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointerMoved</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PointerRoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isPressed) { EnableSelection = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> xPosition = GetPointerPositionX(e); currentSelectionWidth = Math.Abs(startSelectionPosition - xPosition); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (currentSelectionWidth &gt; minSelectionWidth) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &lt; startSelectionPosition) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { LeftPos = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &lt; RightPos - minSelectionWidth) { LeftPos = xPosition; } RightPos = startSelectionPosition; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &gt; startSelectionPosition) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ActualWidth) { RightPos = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ActualWidth; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xPosition &gt; LeftPos + minSelectionWidth) { RightPos = xPosition; } LeftPos = startSelectionPosition; } } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PointerPressed</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, PointerRoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { SelectedChunk.Visibility = Visibility.Visible; isPressed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; startSelectionPosition = GetPointerPositionX(e); LeftPos = startSelectionPosition; RightPos = LeftPos + <span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPointerPositionX</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">PointerRoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { PointerPoint pt = e.GetCurrentPoint(MainContainer); Point position = pt.Position; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> position.X; } }</code> </pre> <br></div></div><br>  Briefly about the operation of this element: GraphicsEditor allows you to track the position of the mouse cursor on the screen and respond to a click, changing the Rectangle parameters as a result, which, in turn, when applied to the drawn wave, allows you to visually select an arbitrary fragment of the audio track. <br><br>  Everything is ready to integrate our practices in the files of the main page of the application.  In MainPage.xaml.cs, we declare variables of the reference type: <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> StorageFile currentFile, sourceFile; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> PlottingGraphImg imgFile; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> AudioDataEditor editor;</code> </pre> <br>  Repeat the methods already implemented in the previous article: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenFileDialog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> picker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Windows.Storage.Pickers.FileOpenPicker(); picker.SuggestedStartLocation = Windows.Storage.Pickers.PickerLocationId.MusicLibrary; picker.FileTypeFilter.Add(<span class="hljs-string"><span class="hljs-string">".mp4"</span></span>); picker.FileTypeFilter.Add(<span class="hljs-string"><span class="hljs-string">".mp3"</span></span>); picker.FileTypeFilter.Add(<span class="hljs-string"><span class="hljs-string">".wav"</span></span>); sourceFile = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> picker.PickSingleFileAsync(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (sourceFile == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> OpenFileDialog(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConvertToWaveFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { OpenLoadWindow(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); MediaTranscoder transcoder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MediaTranscoder(); MediaEncodingProfile profile = MediaEncodingProfile.CreateWav(AudioEncodingQuality.Medium); CancellationTokenSource cts = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CancellationTokenSource(); <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> fileName = String.Format(<span class="hljs-string"><span class="hljs-string">"{0}_{1}.wav"</span></span>, sourceFile.DisplayName, Guid.NewGuid()); currentFile = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> ApplicationData.Current.TemporaryFolder.CreateFileAsync(fileName); Debug.WriteLine(currentFile.Path.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> preparedTranscodeResult = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> transcoder.PrepareFileTranscodeAsync(sourceFile, currentFile, profile); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (preparedTranscodeResult.CanTranscode) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> progress = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Progress&lt;<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>&gt;((percent) =&gt; { Debug.WriteLine(<span class="hljs-string"><span class="hljs-string">"Converting file: "</span></span> + percent + <span class="hljs-string"><span class="hljs-string">"%"</span></span>); }); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> preparedTranscodeResult.TranscodeAsync().AsTask(cts.Token, progress); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Debug.WriteLine(<span class="hljs-string"><span class="hljs-string">"Error: Convert fail"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> { Debug.WriteLine(<span class="hljs-string"><span class="hljs-string">"Error: Exception in ConvertToWaveFile"</span></span>); } OpenLoadWindow(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); }</code> </pre><br>  Hiding the user interface during the audio file conversion will be the line: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OpenLoadWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> enable</span></span></span><span class="hljs-function">)</span></span> =&gt; LoadDummy.Visibility = enable ? Visibility.Visible : Visibility.Collapsed;</code> </pre> <br>  To play an audio track, use the logic: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetAudioClip</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">StorageFile file</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stream = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> file.OpenReadAsync(); Player.SetSource(stream, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Playback_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Player.CurrentState == MediaElementState.Playing) { Player.Stop(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Player.Play(); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Player_CurrentStateChanged</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> =&gt; PlayBtn.IsChecked = Player.CurrentState == MediaElementState.Playing;</code> </pre><br>  We update content using methods: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BuildImageFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { editor = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AudioDataEditor(currentFile.Path.ToString()); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> Update(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Update</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { imgFile = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PlottingGraphImg(editor, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)AudioEditorControl.ActualWidth, (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)AudioEditorControl.ActualHeight); AudioEditorControl.ImageSource = <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> imgFile.GetImage(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> SetAudioClip(currentFile); }</code> </pre> <br>  When you start the application or when you try to load a new track, the method will work: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadAudioFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> OpenFileDialog(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> ConvertToWaveFile(); <span class="hljs-keyword"><span class="hljs-keyword">await</span></span> BuildImageFile(); }</code> </pre> <br>  Now there are calls of operations: copy, cut, paste, delete. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Copy_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AudioEditorControl.EnableSelection) editor.Copy(AudioEditorControl.RelativeLeftPos, AudioEditorControl.RelativeRightPos); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Cut_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AudioEditorControl.EnableSelection) editor.Cut(AudioEditorControl.RelativeLeftPos, AudioEditorControl.RelativeRightPos); Update(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Paste_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { editor.Paste(AudioEditorControl.RelativeLeftPos); Update(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Delete_Click</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (AudioEditorControl.EnableSelection) editor.Delete(AudioEditorControl.RelativeLeftPos, AudioEditorControl.RelativeRightPos); Update(); }</code> </pre> <br>  Go to the file MainPage.xaml and implement the following interface: <br><br><pre> <code class="cs hljs">&lt;Grid Background=<span class="hljs-string"><span class="hljs-string">"{ThemeResource ApplicationPageBackgroundThemeBrush}"</span></span>&gt; &lt;Grid&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>/&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"*"</span></span>/&gt; &lt;RowDefinition Height=<span class="hljs-string"><span class="hljs-string">"Auto"</span></span>/&gt; &lt;/Grid.RowDefinitions&gt; &lt;StackPanel HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Left"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"OpenFileBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE8E5;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"LoadAudioFile"</span></span>/&gt; &lt;Rectangle Height=<span class="hljs-string"><span class="hljs-string">"50"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"2"</span></span> Fill=<span class="hljs-string"><span class="hljs-string">"Black"</span></span>/&gt; &lt;ToggleButton x:Name=<span class="hljs-string"><span class="hljs-string">"PlayBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE768;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Playback_Click"</span></span>/&gt; &lt;/StackPanel&gt; &lt;StackPanel Grid.Row=<span class="hljs-string"><span class="hljs-string">"1"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Vertical"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span>&gt; &lt;local:GraphicsEditor x:Name=<span class="hljs-string"><span class="hljs-string">"AudioEditorControl"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"150"</span></span>/&gt; &lt;/StackPanel&gt; &lt;StackPanel Grid.Row=<span class="hljs-string"><span class="hljs-string">"2"</span></span> HorizontalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> VerticalAlignment=<span class="hljs-string"><span class="hljs-string">"Center"</span></span> Orientation=<span class="hljs-string"><span class="hljs-string">"Horizontal"</span></span>&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"CopyBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE8C8;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Copy_Click"</span></span>/&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"CutBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE8C6;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Cut_Click"</span></span>/&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"PasteBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE77F;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Paste_Click"</span></span>/&gt; &lt;Button x:Name=<span class="hljs-string"><span class="hljs-string">"DeleteBtn"</span></span> FontFamily=<span class="hljs-string"><span class="hljs-string">"Segoe MDL2 Assets"</span></span> FontSize=<span class="hljs-string"><span class="hljs-string">"36"</span></span> Content=<span class="hljs-string"><span class="hljs-string">" xE74D;"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"White"</span></span> Margin=<span class="hljs-string"><span class="hljs-string">"5"</span></span> Click=<span class="hljs-string"><span class="hljs-string">"Delete_Click"</span></span>/&gt; &lt;MediaElement Name=<span class="hljs-string"><span class="hljs-string">"Player"</span></span> AutoPlay=<span class="hljs-string"><span class="hljs-string">"False"</span></span> CurrentStateChanged=<span class="hljs-string"><span class="hljs-string">"Player_CurrentStateChanged"</span></span> /&gt; &lt;/StackPanel&gt; &lt;/Grid&gt; &lt;Grid x:Name=<span class="hljs-string"><span class="hljs-string">"LoadDummy"</span></span> Visibility=<span class="hljs-string"><span class="hljs-string">"Collapsed"</span></span> Background=<span class="hljs-string"><span class="hljs-string">"#7F000000"</span></span>&gt; &lt;ProgressRing IsActive=<span class="hljs-string"><span class="hljs-string">"True"</span></span> Width=<span class="hljs-string"><span class="hljs-string">"100"</span></span> Height=<span class="hljs-string"><span class="hljs-string">"100"</span></span> Foreground=<span class="hljs-string"><span class="hljs-string">"White"</span></span>/&gt; &lt;/Grid&gt; &lt;/Grid&gt;</code> </pre><br><div style="text-align:center;"><img src="https://habrastorage.org/web/e95/9d8/bec/e959d8bec347450cadafc5cd311dcd8e.png"></div><br>  Fine!  Our application is ready, it remains to add the missing libraries and check the code for errors.  We have created a simple audio editor, but even in it there are possible experiments with personal audio files.  Similar logic is implemented in our various projects.  Say, <a href="http://go.everydaytools.mobi/nff1XS">Audio Editor</a> has similar functionality, but its advantage is to work with each channel of the audio file separately.  Another application, <a href="http://go.everydaytools.mobi/TqTtv6">Audio Genesis</a> , has a difference in the number of audio tracks processed at the same time and the ability to mix them into one track.  Each of the developed applications has its own field of application, perhaps, you will come up with the idea of ‚Äã‚Äãa unique tool. ‚Äù </div><p>Source: <a href="https://habr.com/ru/post/330418/">https://habr.com/ru/post/330418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330408/index.html">PyConRu 2017 preliminary program: speakers from Disney, Facebook, Yandex, JetBrains, Tinkoff Bank</a></li>
<li><a href="../330410/index.html">Features ‚Äìwebkit-box or how to ‚Äúfriend‚Äù flexbox with old Safari</a></li>
<li><a href="../330412/index.html">Why it is worth switching completely to Ceylon or Kotlin (part 1)</a></li>
<li><a href="../330414/index.html">Journey inside Avito: platform</a></li>
<li><a href="../330416/index.html">Intelligence is a new milestone in the development of localization systems</a></li>
<li><a href="../330422/index.html">Redux: an attempt to get rid of the need to think during API requests</a></li>
<li><a href="../330424/index.html">Joint security in the cloud according to RUVDS, HUAWEI and Kaspersky Labs</a></li>
<li><a href="../330426/index.html">XoruX - free monitoring of virtual infrastructure, data storage and transmission systems</a></li>
<li><a href="../330428/index.html">The story of one landing</a></li>
<li><a href="../330432/index.html">Interview with Josh Patridge (Shazam) about marketing, business, strategy and new products</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>