<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The history of one diploma or how to make a sharabota</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The history of this project begins in 2014, when I was studying for the 4th year in the leading technical university of Russia at the Department of Ro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The history of one diploma or how to make a sharabota</h1><div class="post__text post__text-html js-mediator-article"><p>  The history of this project begins in 2014, when I was studying for the 4th year in the leading technical university of Russia at the Department of Robotic Systems.  At that time I started to think about the subject of the diploma and was looking for a project that would be interesting to me, and at the same time there was some novelty in it.  Then one day, after seeing the video of the scarabber <a href="https://www.youtube.com/watch%3Fv%3DsB9IowB8nx8">Rezero</a> , my friends and I wanted to try to repeat the success.  Who cares what came out of it - I ask for cat. </p><br><img src="https://habrastorage.org/files/653/b6a/47e/653b6a47e6a24d36844d905167d0af10.jpg" width="500"><a name="habracut"></a><br><br><h2>  Introduction </h2><br><p>  In the beginning I would like to talk about the merits of the sharabota.  Thanks to a single point of contact with the surface, the sharabot is equally easy to move in all directions, being extremely mobile and maneuverable, compared to conventional wheeled robots.  The maneuverability of the sharabot is limited only by its dynamics, in contrast to the mechanical limitations imposed by the wheels (for example, the impossibility of moving sideways). </p><br><p>  The next important advantage is that a robot can be high, and the higher it is, the more stable it will be.  Why steadier?  This is evident from the <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D0%25B1%25D1%2580%25D0%25B0%25D1%2582%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25BC%25D0%25B0%25D1%258F%25D1%2582%25D0%25BD%25D0%25B8%25D0%25BA">equation of the</a> dynamics of the inverse pendulum.  Acceleration of the deviation from the vertical equilibrium position is inversely proportional to the distance to the center of mass, i.e.  the higher reverse pendulum will fall more slowly.  This reduces the response speed requirements of the control system, but perhaps increases the moment that the drive should develop. </p><br><p>  Another advantage is that it can travel on inclined and moving surfaces, for example, the deck of a ship or the floor of an aircraft during takeoff.  And you see, it moves much more beautifully than ordinary wheeled robots. </p><br><p> One of the main drawbacks of the sharabota is the possibility of losing the vertical position of balance.  But personally, I think this is a completely solvable engineering problem.  The engineers of the robots <a href="http://www.aidorobot.com/">Aido</a> and <a href="https://www.youtube.com/watch%3Fv%3DZL4hCCTmd9Y">Mobi</a> decided it as follows: when a certain angle of deflection is exceeded, the ‚Äúlegs‚Äù are advanced so that the robot does not lose stability. </p><br><p>  My story consists of the following parts: <br>  <a href="https://habr.com/ru/post/306456/">- Mathematical model</a> <br>  <a href="https://habr.com/ru/post/306456/">- Development of control algorithms</a> <br>  <a href="https://habr.com/ru/post/306456/">- Construction</a> <br>  <a href="https://habr.com/ru/post/306456/">- Hardware and software</a> <br>  <a href="https://habr.com/ru/post/306456/">- Results</a> </p><br><br><h2>  1 Mathematical model </h2><br><p>  The derivation of the equations of motion is necessary for the further synthesis of control and the simulation of motion.  In this section there will be some math and mechanics. </p><br><p>  At the moment, all existing mathematical models of the sharabota are made taking into account some simplifications using the Lagrange equations of the 2nd kind.  And since the scarabot is a nonholonomic mechanical system, it is incorrect to apply the Lagrange equations of the 2nd kind to such a system.  In the <a href="http://www.msl.ri.cmu.edu/projects/ballbot/">CMU</a> robot, the scarab model is considered as three independent flat models, thereby not taking into account the mutual influence of these models.  Rezero developed a three-dimensional mathematical model, which does not take into account the gyroscopic effects that occur during the rotation of the omnic wheel. </p><br><p>  I set a goal to create the most complete mathematical model of the robot with the minimum number of assumptions.  My scientific adviser S.L. helped me to achieve this goal.  Krutikov, for which I express my deep gratitude to him. </p><br><h3>  1.1 Kinematics </h3><br><p>  For the kinematic description of the system, I introduced the moving coordinate systems shown in the figure. </p><br><img src="https://habrastorage.org/files/0be/b80/f1f/0beb80f1fa094f9f8aa652b259a28d73.jpg" width="300"><br><p>  Inertial coordinate system is designated as <img src="https://tex.s2cms.ru/svg/xyz" alt="xyz">  .  Coordinate system <img src="https://tex.s2cms.ru/svg/%D0%A1x_1y_1z_1" alt="x_1y_1z_1">  located in the center of the ball.  To go from the inertial frame of reference to the center of the ball, the following homogeneous matrix is ‚Äã‚Äãused: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%5Cm%7BA%7D_c%3D%5Cbegin%7Bpmatrix%7D%20%5Cnonumber%0A1%20%20%20%26%200%20%20%20%20%20%26%200%20%20%20%20%20%26%20x%20%5C%5C%0A0%20%20%20%26%201%20%20%20%20%20%26%200%20%20%20%20%20%26%20y%5C%5C%0A0%20%20%20%26%200%20%20%20%20%20%26%201%20%20%20%20%20%26%20r_{ball}%20%20%5C%5C%0A0%20%20%20%26%200%20%20%20%20%20%26%200%20%20%20%20%20%26%231%1A%5Cend%7Bpmatrix%7D%2C%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {A} _c = \ begin {pmatrix} \ nonumber 1 &amp; amp;  0 &amp; amp;  0 &amp; amp;  x \\ 0 &amp; amp;  1 &amp; amp;  0 &amp; amp;  y \\ 0 &amp; amp;  0 &amp; amp;  1 &amp; amp;  r_ {ball} \\ 0 &amp; amp;  0 &amp; amp;  0 &amp; amp;  1 \ end {pmatrix}, \ end {equation *}"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/x" alt="x">  and <img src="https://tex.s2cms.ru/svg/y" alt="y">  the displacement of the center of the ball along the axis <img src="https://tex.s2cms.ru/svg/x" alt="x">  and <img src="https://tex.s2cms.ru/svg/y" alt="y">  respectively. </p><br><p>  To describe the rotation of the ball, it is convenient to use the gimbal angles or the <a href="https://en.wikipedia.org/wiki/Euler_angles">Tait ‚Äì Bryan</a> angles.  So the coordinate system <img src="https://tex.s2cms.ru/svg/x'_1y'_1z'_1" alt="x'_1y'_1z'_1">  associated with a ball is obtained by turning <img src="https://tex.s2cms.ru/svg/x_1y_1z_1" alt="Cx_1y_1z_1">  on the corners <img src="https://tex.s2cms.ru/svg/%5Cvarphi_%7Bx%7D" alt="\ varphi_ {x}">  , <img src="https://tex.s2cms.ru/svg/%5Cvarphi_%7By%7D" alt="\ varphi_ {y}">  and <img src="https://tex.s2cms.ru/svg/%5Cvarphi_%7Bz%7D" alt="\ varphi_ {z}">  around the axes <img src="https://tex.s2cms.ru/svg/x_1%2C%20y_1" alt="x_1, y_1">  and <img src="https://tex.s2cms.ru/svg/z_1" alt="z_1">  respectively.  This sequence of turns can be represented as a product of turning matrices: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%20%5Clabel%7Beq%3Am_rotaion_ball%7D%0A%20%20%20%20%5Cm%7BR%7D_%7B%5Cvarphi%7D%20%3D%20%5Cm%7BR%7D_x(%5Cvarphi_x)%20%5Cm%7BR%7D_y(%5Cvarphi_y)%20R_z(%5Cvarphi_z).%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ label {eq: m_rotaion_ball} \ m {R} _ {\ varphi} = \ m {R} _x (\ varphi_x) \ m {R} _y (\ varphi_y) R_z (\ varphi_z).  \ end {equation *}"></div><p></p><br><p>  Similarly, one can describe the rotation of the body of a scarabot in space.  Coordinate system <img src="https://tex.s2cms.ru/svg/x_2y_2z_2" alt="x_2y_2z_2">  The 2nd link associated with the body is obtained by turning <img src="https://tex.s2cms.ru/svg/x_1y_1z_1" alt="x_1y_1z_1">  on the corners <img src="https://tex.s2cms.ru/svg/%5Cvartheta_%7Bx%7D" alt="\ vartheta_ {x}">  , <img src="https://tex.s2cms.ru/svg/%5Cvartheta_%7By%7D" alt="\ vartheta_ {y}">  and <img src="https://tex.s2cms.ru/svg/%5Cvartheta_%7Bz%7D" alt="\ vartheta_ {z}">  around the axes <img src="https://tex.s2cms.ru/svg/x_1%2C%20y_1" alt="x_1, y_1">  and <img src="https://tex.s2cms.ru/svg/z_1" alt="z_1">  respectively.  This sequence of turns can also be represented as a product of turning matrices: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation%7D%20%5Clabel%7Beq%3Am_rotaion_body%7D%0A%20%20%20%20%5Cm%7BR%7D_%7B%5Cvartheta%7D%20%3D%20%5Cm%7BR%7D_x(%5Cvartheta_%7Bx%7D)%20%5Cm%7BR%7D_y(%5Cvartheta_%7By%7D)%20%5Cm%7BR%7D_z(%5Cvartheta_%7Bz%7D).%20%5Cnonumber%0A%5Cend%7Bequation%7D%20%0A" alt="\ begin {equation} \ label {eq: m_rotaion_body} \ m {R} _ {\ vartheta} = \ m {R} _x (\ vartheta_ {x}) \ m {R} _y (\ vartheta_ {y}) \ m {R} _z (\ vartheta_ {z}).  \ nonumber \ end {equation}"></div><p></p><br><p>  The 3rd, 4th and 5th coordinate systems are associated with omniwheels.  To move from the body's coordinate system to the omni-wheel coordinate system, you need to perform a series of elementary transformations (two rotations, transference, then rotation again), I will not describe them here. </p><br><p>  The sequence of transitions is represented as the following kinematic graph: </p><br><p><img src="https://habrastorage.org/files/f6a/89c/abb/f6a89cabb85844878dd04b914485154f.png" width="500"><br></p><br><p>  To describe the position of the system, the following vector of generalized coordinates is used: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation%7D%0A%20%20%20%20%5Cve%7Bq%7D%3D(x%2C%20y%2C%20%5Cvarphi_x%2C%20%5Cvarphi_y%2C%20%5Cvarphi_z%2C%20%5Cvartheta_x%2C%20%5Cvartheta_y%2C%20%5Cvartheta_z%2C%20%5Cpsi_1%2C%20%5Cpsi_2%2C%20%5Cpsi_3)%5ET%2C%20%5Cnonumber%0A%5Cend%7Bequation%7D%5C%5C%0A" alt="\ begin {equation} \ ve {q} = (x, y, \ varphi_x, \ varphi_y, \ varphi_z, \ vartheta_x, \ vartheta_y, \ vartheta_z, \ psi_1, \ psi_2, \ psi_3) ^ T, \ nonumber \ end {equation} \\"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/x%2C%20y" alt="x, y">  - coordinates of the center of the ball, <img src="https://tex.s2cms.ru/svg/%5Cvarphi_x%2C%20%5Cvarphi_y%2C%20%5Cvarphi_z%2C%20%5Cvartheta_x%2C%20%5Cvartheta_y%2C%20%5Cvartheta_z" alt="\ varphi_x, \ varphi_y, \ varphi_z, \ vartheta_x, \ vartheta_y, \ vartheta_z">  - cardan angles describing the rotation of the ball and the body, respectively, <img src="https://tex.s2cms.ru/svg/%5Cpsi_1%2C%20%5Cpsi_2%2C%20%5Cpsi_3" alt="\ psi_1, \ psi_2, \ psi_3">  - angles of rotation of omnic wheel around the axis of the engine. </p><br><h3>  1.2 Dynamics </h3><br><p>  On the basis of the nonholonomicity of the system, it was decided to use the <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F_%25D0%2590%25D0%25BF%25D0%25BF%25D0%25B5%25D0%25BB%25D1%258F">Appel</a> equations to compose the differential equations of motion of the sharabota. </p><br><p>  6 nonholonomic constraints are imposed on the system: three omniwheel rolling bonds along the ball, two bonds for the ball center speed and one bond of the ball spinning.  Thus, the number of generalized coordinates is m = 11, the number of constraints is s = 6, and the number of degrees of freedom is n = 5.  We will use the following pseudo-velocity vector: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%20%20%20%20%5Cbm%7B%5Cdot%7B%5Cpi%7D%7D%20%3D%20(%5Cdot%7Bx%7D%2C%20%5Cdot%7By%7D%2C%20%5Cdot%7B%5Cvartheta_x%7D%2C%20%5Cdot%7B%5Cvartheta_y%7D%2C%20%5Cdot%7B%5Cvartheta_z%7D)%5ET.%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ bm {\ dot {\ pi}} = (\ dot {x}, \ dot {y}, \ dot {\ vartheta_x}, \ dot {\ vartheta_y}, \ dot {\ vartheta_z} ) ^ T. \ end {equation *}"></div><p></p><br><p>  To compile the equations of motion, it is necessary to calculate the acceleration energy for each link: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%20%20%20%20S%3D%20%5Csum%5Climits_%7Bi%3D1%7D%5EN%20%20%5Cfrac%7B1%7D%7B2%7D%20%5Ccdot%20tr(%20%5Cddot%7B%5Cm%7BT%7D%7D_%7Bi%7D%20%5Cm%7BH%7D_%7Bi%7D%20%5Cddot%7B%5Cm%7BT%7D%7D%5E%5Cm%7BT%7D_%7Bi%7D%7D)%2C%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} S = \ sum \ limits_ {i = 1} ^ N \ frac {1} {2} \ cdot tr (\ ddot {\ m {T}} _ {i} \ m {H} _ {i} \ ddot {\ m {T}} ^ \ m {T} _ {i}}), \ end {equation *}"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/%20N%20" alt="N">  - the number of links <img src="https://tex.s2cms.ru/svg/%5Cm%7BT%7D_%7Bi%7D" alt="\ m {T} _ {i}">  - transition matrix from inertial coordinate system to coordinate system <img src="https://tex.s2cms.ru/svg/i" alt="i">  link, <img src="https://tex.s2cms.ru/svg/%5Cm%7BH%7D_%7Bi%7D" alt="\ m {H} _ {i}">  - inertia matrix <img src="https://tex.s2cms.ru/svg/i" alt="i">  link, and <img src="https://tex.s2cms.ru/svg/tr" alt="tr">  - <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BB%25D0%25B5%25D0%25B4_%25D0%25BC%25D0%25B0%25D1%2582%25D1%2580%25D0%25B8%25D1%2586%25D1%258B">trace matrix</a> .  In general <img src="https://tex.s2cms.ru/svg/S" alt="S">  is a function of <img src="https://tex.s2cms.ru/svg/%20%5Cddot%7Bq%7D_1%2C...%2C%5Cddot%7Bq%7D_m%2C%20t" alt="\ ddot {q} _1, ..., \ ddot {q} _m, t">  .  Using the equations of the coupling, the acceleration energy is reduced to a function depending only on <img src="https://tex.s2cms.ru/svg/%5Cddot%7B%5Cpi%7D_1%2C...%2C%5Cddot%7B%5Cpi%7D_n%2C%20t" alt="\ ddot {\ pi} _1, ..., \ ddot {\ pi} _n, t">  . </p><br><div class="spoiler">  <b class="spoiler_title">Mass inertia parameters</b> <div class="spoiler_text"><p>  The matrix of inertia of the ball has a diagonal view, since  coordinate system axes <img src="https://tex.s2cms.ru/svg/Ox_1y_1z_1" alt="Ox_1y_1z_1">  are the main central axes of inertia: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%5Cm%7BH%7D_%7B1%7D%3D%5Cbegin%7Bpmatrix%7D%20%25%5Cnonumber%0AI_%7B1%2Cxx%7D%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%26%200%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%20I_%7B1%2Cyy%7D%20%20%26%200%20%20%20%20%20%26%200%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%26%20I_%7B1%2Czz%7D%20%20%26%200%5C%5C%20%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%26%20m_%7B1%7D%20%0A%5Cend%7Bpmatrix%7D.%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {H} _ {1} = \ begin {pmatrix}% \ nonumber I_ {1, xx} &amp; amp; 0 &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; I_ {1, yy} &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; 0 &amp; amp; I_ {1, zz} &amp; amp; 0 \\ 0 &amp; amp; 0 &amp; amp; 0 &amp; amp; m_ {1} \ end {pmatrix}. \ end {equation *}"></div><p></p><br><p>  Since  plane <img src="https://tex.s2cms.ru/svg/Cx_2z_2" alt="Cx_2z_2">  and <img src="https://tex.s2cms.ru/svg/Cy_2z_2" alt="Cy_2z_2">  are the planes of symmetry of the body, the centrifugal moments of inertia <img src="https://tex.s2cms.ru/svg/I_%7Bxy%7D%2C%20I_%7Bxz%7D" alt="I_ {xy}, I_ {xz}">  and <img src="https://tex.s2cms.ru/svg/I_%7Byz%7D" alt="I_ {yz}">  are zero.  The body inertia matrix will look like this: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%5Cm%7BH%7D_%7B2%7D%3D%5Cbegin%7Bpmatrix%7D%20%25%5Cnonumber%0AI_%7B2%2Cxx%7D%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%20I_%7B2%2Cyy%7D%20%20%26%200%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%20I_%7B2%2Czz%7D%20%20%20%20%20%20%20%20%20%20%26%20m_%7B2%7D%20%5Ccdot%20l%20%5C%5C%20%0A0%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%20m_%7B2%7D%20%5Ccdot%20l%20%20%20%20%20%26%20m_%7B2%7D%20%0A%5Cend%7Bpmatrix%7D%2C%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {H} _ {2} = \ begin {pmatrix}% \ nonumber I_ {2, xx} &amp; amp; 0 &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; I_ {2, yy} &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; 0 &amp; amp; I_ {2, zz} &amp; amp; m_ {2} \ cdot l \\ 0 &amp; amp; 0 &amp; amp; m_ {2} \ cdot l &amp; amp; m_ {2} \ end {pmatrix}, \ end {equation *}"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/l" alt="l">  - distance from the center of the ball to the center of mass of the body along the axis <img src="https://tex.s2cms.ru/svg/Cz_2" alt="Cz_2">  . </p><br><p>  The omni-wheel inertia matrix has a diagonal view, since  The axes of the omni-wheel coordinate system form planes of symmetry: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%5Cm%7BH%7D_%7B3%2C4%2C5%7D%3D%5Cbegin%7Bpmatrix%7D%20%25%5Cnonumber%0AI_%7Bw%2C%20xx%7D%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%200%20%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%26%20I_%7Bw%2C%20yy%7D%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%200%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%20I_%7Bw%2C%20zz%7D%20%26%200%20%20%5C%5C%0A0%20%20%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%200%20%20%20%20%20%20%20%20%20%26%20m_%7Bwheel%7D%0A%5Cend%7Bpmatrix%7D.%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {H} _ {3,4,5} = \ begin {pmatrix}% \ nonumber I_ {w, xx} &amp; amp; 0 &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; I_ {w, yy} &amp; amp; 0 &amp; amp; 0 \\ 0 &amp; amp; 0 &amp; amp; I_ {w, zz} &amp; amp; 0 \\ 0 &amp; amp; 0 &amp; amp; 0 &amp; amp; m_ {wheel} \ end {pmatrix}. \ end {equation *}"></div><p></p><br><p>  In the moment of inertia <img src="https://tex.s2cms.ru/svg/I_%7Bw%2Czz%7D" alt="I_ {w, zz}">  it is also necessary to take into account the moment of inertia of the rotor of the engine: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%20I_%7Bw%2Czz%7D%20%3DI'_%7Bw%2Czz%7D%20%2B%20i%5E2%20%5Ccdot%20I_%7B%5Ctext%7B%D1%80%D0%BE%D1%82%7D%7D%2C%20" alt="I_ {w, zz} = I '_ {w, zz} + i ^ 2 \ cdot I _ {\ text {mouth}},"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/i" alt="i">  - The gear ratio of the gearbox. </p></div></div><br><p>  Appel's differential equation of motion in pseudo-coordinates: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation%7D%20%5Clabel%7Beq%3Aappel%7D%0A%20%20%20%20%5Cfrac%7B%5Cpartial%7BS%7D%7D%7B%5Cpartial%7B%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%20%7D%7D%20%3D%20%5Cm%7BQ%7D_1%20%2B%20%5Cm%7BQ%7D_2%2C%0A%5Cend%7Bequation%7D%0A" alt="\ begin {equation} \ label {eq: appel} \ frac {\ partial {S}} {\ partial {\ boldsymbol {\ ddot {\ pi}}}} = \ m {Q} _1 + \ m {Q} _2, \ end {equation}"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/%5Cm%7BQ%7D_1" alt="\ m {Q} _1">  - the generalized force from the moments of the drives, <img src="https://tex.s2cms.ru/svg/%5Cm%7BQ%7D_2" alt="\ m {Q} _2">  - generalized force from gravity. </p><br><p>  Write the Appel equations in matrix form and decide on <img src="https://tex.s2cms.ru/svg/%5Cddot%7B%5Cpi%7D" alt="\ ddot {\ pi}">  : </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%20%0A%20%20%20%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%20%3D%20%5Cm%7BA%7D%5E%7B-1%7D(%5Cboldsymbol%7B%5Cve%7Bq%7D%7D)%20(%5Cm%7BQ%7D_%7B1%7D%20-%20%5Cboldsymbol%7Bb(%5Cve%7Bq%7D%2C%20%5Cdot%7B%5Cpi%7D)%7D%20-%20%5Cboldsymbol%7Bc(%5Cve%7Bq%7D)%7D)%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ boldsymbol {\ ddot {\ pi}} = \ m {A} ^ {- 1} (\ boldsymbol {\ ve {q}}) (\ m {Q} _ {1} - \ boldsymbol {b (\ ve {q}, \ dot {\ pi})} - \ boldsymbol {c (\ ve {q})}) \ end {equation *}"></div><p></p><br><div class="spoiler">  <b class="spoiler_title">A little bit more</b> <div class="spoiler_text"><p>  The equations of motion can be written in matrix form. </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%20%20%20%20%5Cboldsymbol%7Bf%7D(%5Cboldsymbol%7Bq%7D%2C%20%5Cboldsymbol%7B%5Cdot%7B%5Cpi%7D%7D%2C%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%2C%20%5Cboldsymbol%7B%5Ctau%7D%2C%20t)%20%3D%20%5Cm%7BA%7D(%5Cboldsymbol%7Bq%7D)%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%20%2B%20%5Cboldsymbol%7Bb%7D(%5Cboldsymbol%7Bq%7D%2C%20%5Cboldsymbol%7B%5Cdot%7B%5Cpi%7D%7D)%20%2B%20%5Cboldsymbol%7Bc%7D(%5Cboldsymbol%7Bq%7D)%20-%20%5Cm%7BQ%7D_1%20%3D%200%2C%0A%5Cend%7Bequation%7D%0A" alt="\ begin {equation *} \ boldsymbol {f} (\ boldsymbol {q}, \ boldsymbol {\ dot {\ pi}}, \ boldsymbol {\ ddot {\ pi}}, \ boldsymbol {\ tau}, t) = \ m {A} (\ boldsymbol {q}) \ boldsymbol {\ ddot {\ pi}} + \ boldsymbol {b} (\ boldsymbol {q}, \ boldsymbol {\ dot {\ pi}}) + \ boldsymbol { c} (\ boldsymbol {q}) - \ m {Q} _1 = 0, \ end {equation}"></div><p></p><br><p>  Where </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%20%20%20%20%20%5Cm%7BA%7D(%5Cboldsymbol%7Bq%7D)%20%3D%20%5Cfrac%7B%5Cpartial%7B%5Cboldsymbol%7Bf%7D%7D%7D%7B%20%5Cpartial%7B%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%7D%20%7D%2C%20%5C%5C%0A%20%20%20%20%20%5Cboldsymbol%7Bb%7D(%5Cboldsymbol%7Bq%7D%2C%20%5Cboldsymbol%7B%5Cdot%7B%5Cpi%7D%7D)%20%3D%20%5Cboldsymbol%7Bf%7D%20-%20%5Cm%7BA%7D%20%5Ccdot%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%2C%20%5C%5C%0A%20%20%20%20%20%26%5Cboldsymbol%7Bc%7D(%5Cboldsymbol%7Bq%7D)%20%3D%20-%20%5Cm%7BQ%7D_%7B2%7D.%20%20%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {A} (\ boldsymbol {q}) = \ frac {\ partial {\ boldsymbol {f}}} {\ partial {\ boldsymbol {\ ddot {\ pi}}}}, \ \ \ boldsymbol {b} (\ boldsymbol {q}, \ boldsymbol {\ dot {\ pi}}) = \ boldsymbol {f} - \ m {A} \ cdot \ boldsymbol {\ ddot {\ pi}}, \ \ &amp; amp; \ boldsymbol {c} (\ boldsymbol {q}) = - \ m {Q} _ {2}. \ end {equation *}"></div><p></p></div></div><br><p>  All calculations were performed symbolically using Maple.  Then the resulting equations were transferred from Maple to Matlab for modeling. </p>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  2 Development of control algorithms </h2><br><p>  A little more control theory and the match ends here.  In control theory, methods for analyzing linear systems are well developed.  For completely <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B1%25D0%25BB%25D1%258E%25D0%25B4%25D0%25B0%25D0%25B5%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">observable</a> systems, optimal control with a quadratic functional (linear quadratic regulator, LQR) <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B1%25D0%25BB%25D1%258E%25D0%25B4%25D0%25B0%25D0%25B5%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">is</a> most often used, which guarantees the stabilization of the system if the system is completely controllable.  Sharobot is a completely observable system, since  state vector can be fully measured.  Having calculated the rank of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A3%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D1%258F%25D0%25B5%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_(%25D1%2582%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D1%2583%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F)">controllability</a> matrix, I was also convinced of the controllability of the system. </p><br><p>  To obtain a linear-quadratic controller at the beginning, it is necessary to linearize the system in the vicinity of the vertical position of unstable equilibrium <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bq%7D%20%3D%200%2C%20%5Cboldsymbol%7B%5Cdot%7B%5Cpi%7D%7D%20%3D%200%2C%20%5Cboldsymbol%7B%5Cddot%7B%5Cpi%7D%7D%20%3D%200" alt="\ boldsymbol {q} = 0, \ boldsymbol {\ dot {\ pi}} = 0, \ boldsymbol {\ ddot {\ pi}} = 0"></p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%20%0A%20%20%20%20%5Cboldsymbol%7B%5Cdot%7Bx%7D%7D%20%26%3D%20%5Cm%7BA%7D%20%5Ccdot%20%5Cboldsymbol%7Bx%7D%20%2B%20%5Cm%7BB%7D%20%5Ccdot%20%5Cboldsymbol%7Bu%7D%2C%20%5Cnonumber%20%5C%5C%0A%20%20%20%20%5Cboldsymbol%7By%7D%20%26%3D%20%5Cm%7BC%7D%20%5Ccdot%20%5Cboldsymbol%7Bx%7D%20%2B%20%5Cm%7BD%7D%20%5Ccdot%20%5Cboldsymbol%7Bu%7D%2C%20%20%5Cnonumber%20%5C%5C%0A%20%20%20%20%5Cboldsymbol%7Bx%7D%20%26%3D%20(x%2C%20y%2C%20%5Cvartheta_x%2C%20%5Cvartheta_y%2C%20%5Cvartheta_z%2C%20%5Cdot%7Bx%7D%2C%20%5Cdot%7By%7D%2C%20%5Cdot%7B%5Cvartheta_x%7D%2C%20%5Cdot%7B%5Cvartheta_y%7D%2C%20%5Cdot%7B%5Cvartheta_z%7D)%5ET%2C%20%5Cnonumber%20%5C%5C%0A%20%20%20%20%5Cm%7BC%7D%20%26%3D%20%5Cm%7BE%7D_%7B10%7D%2C%20%5Cquad%0A%20%20%20%20%5Cm%7BD%7D%20%3D%200.%20%5Cnonumber%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ boldsymbol {\ dot {x}} &amp; amp; = \ m {A} \ cdot \ boldsymbol {x} + \ m {B} \ cdot \ boldsymbol {u}, \ nonumber \\ \ boldsymbol {y} &amp; amp; = \ m {C} \ cdot \ boldsymbol {x} + \ m {D} \ cdot \ boldsymbol {u}, \ nonumber \\ \ boldsymbol {x} &amp; amp; (x, y, \ vartheta_x, \ vartheta_y, \ vartheta_z, \ dot {x}, \ dot {y}, \ dot {\ vartheta_x}, \ dot {\ vartheta_y}, \ dot {\ vartheta_z}) ^ T, \ nonumber \\ \ m {C} &amp; amp; = \ m {E} _ {10}, \ quad \ m {D} = 0. \ nonumber \ end {equation *}"></div><p></p><br><p>  Vector <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bx%7D" alt="\ boldsymbol {x}">  - state vector or phase vector, <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7By%7D%3D%5Cboldsymbol%7Bx%7D" alt="\ boldsymbol {y} = \ boldsymbol {x}">  - vector of measurement and <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bu%7D%3D(%5Ctau_1%2C%20%5Ctau_2%2C%20%5Ctau_3)%5ET" alt="\ boldsymbol {u} = (\ tau_1, \ tau_2, \ tau_3) ^ T">  - control (drive moments). </p><br><p>  The LQR controller has the following optimality criterion: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%20%5Clabel%7Beq%3Acost%7D%0A%20%20%20%20%5Cm%7BJ%7D%20%3D%20%5Cint%5Climits_%7B0%7D%5E%7B%5Cinfty%7D(%5Cboldsymbol%7Bx%7D%5ET%20%5Cm%7BQ%7D%20%5Cboldsymbol%7Bx%7D%20%2B%20%5Cboldsymbol%7Bu%7D%5ET%20%5Cm%7BR%7D%20%5Cboldsymbol%7Bu%7D)dt%2C%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ label {eq: cost} \ m {J} = \ int \ limits_ {0} ^ {\ infty} (\ boldsymbol {x} ^ T \ m {Q} \ boldsymbol {x} + \ boldsymbol {u} ^ T \ m {R} \ boldsymbol {u}) dt, \ end {equation *}"></div><p></p><br><p>  Where <img src="https://tex.s2cms.ru/svg/%5Cm%7BQ%7D" alt="\ m {Q}">  and <img src="https://tex.s2cms.ru/svg/%5Cm%7BR%7D" alt="\ m {R}">  - positive definite matrix.  The task of minimizing this functional is reduced to solving a matrix algebraic Riccati equation: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%20%5Clabel%7Beq%3Aricatti%7D%0A%20%20%20%20%5CPhi%20%5Ccdot%20%5Cm%7BB%7D%20%5Ccdot%20%5Cm%7BR%7D%5E%7B-1%7D%20%5Ccdot%20%5Cm%7BB%7D%5ET%20%5Ccdot%20%5CPhi%20-%20%5CPhi%20%5Ccdot%20%5Cm%7BA%7D%20-%20%5Cm%7BA%7D%5ET%20%5Ccdot%20%5CPhi%20-%20%5Cm%7BQ%7D%20%3D%200.%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ label {eq: ricatti} \ Phi \ cdot \ m {B} \ cdot \ m {R} ^ {- 1} \ cdot \ m {B} ^ T \ cdot \ Phi - \ Phi \ cdot \ m {A} - \ m {A} ^ T \ cdot \ Phi - \ m {Q} = 0. \ end {equation *}"></div><p></p><br><p>  For a linear-quadratic controller, the control is written as <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bu%7D%3D-%5Cm%7BK%7D%5Cboldsymbol%7Bx%7D" alt="\ boldsymbol {u} = - \ m {K} \ boldsymbol {x}">  where <img src="https://tex.s2cms.ru/svg/%5Cm%7BK%7D%3D%5Cm%7BR%7D%5E%7B-1%7D%5Cm%7BB%7D%5CPhi" alt="\ m {K} = \ m {R} ^ {- 1} \ m {B} \ Phi">  , <img src="https://tex.s2cms.ru/svg/%20%5CPhi%20" alt="\ Phi">  - solution of the Riccati equation.  As a result, we have a matrix of feedback coefficients: </p><br><p></p><div style="text-align:center;"><img src="https://tex.s2cms.ru/svg/%0A%5Cbegin%7Bequation*%7D%0A%5Cm%7BK%7D%20%3D%20%5Cbegin%7Bpmatrix%7D%0A%20%20%20%200%20%20%20%20%20%20%20%26%20-1.0%20%20%20%20%20%20%26%209.63%20%26%200%20%20%20%20%20%20%20%20%20%20%26%20-0.7%20%26%200%20%20%20%20%20%20%20%20%20%20%26%20-1.34%20%26%201.88%20%20%20%20%20%20%26%200%20%20%20%20%20%26%20-0.18%20%5C%5C%0A%20%20%20%200.86%20%20%20%20%26%200.5%20%20%20%20%20%20%20%26%20-4.81%20%26%208.34%20%20%20%20%20%20%26%20-0.7%20%26%201.16%20%20%20%20%20%20%20%26%200.67%20%20%26%20-0.9%20%20%20%20%20%20%26%201.63%20%20%26%20-0.18%20%5C%5C%0A%20%20%20%20-0.86%20%20%20%26%200.5%20%20%20%20%20%20%20%26%20-4.81%20%26%20-8.34%20%20%20%20%20%26%20-0.7%20%26%20-1.16%20%20%20%20%20%20%26%200.67%20%20%26%20-0.9%20%20%20%20%20%20%26%20-1.63%20%26%20-0.18%20%5C%5C%0A%5Cend%7Bpmatrix%7D.%20%5Cnonumber%0A%5Cend%7Bequation*%7D%0A" alt="\ begin {equation *} \ m {K} = \ begin {pmatrix} 0 &amp; amp; -1.0 &amp; amp; 9.63 &amp; amp; 0 &amp; amp; -0.7 &amp; amp; 0 &amp; amp; -1.34 &amp; amp; 1.88 &amp; amp; 0 &amp; amp; -0.18 \ 0.86 &amp; amp; 0.5 &amp; amp; -4.81 &amp; amp; 8.34 &amp; amp; -0.7 &amp; amp; 1.16 &amp; amp; 0.67 &amp; amp; -0.9 &amp; amp; 1.63 &amp; amp; -0.18 \\ -0.86 &amp; amp; 0.5 &amp; amp; -4.81 &amp; amp; -8.34 &amp; amp; -0.7 &amp; amp; -1.16 &amp; amp; 0.67 &amp; amp; -0.9 &amp; amp; -1.63 &amp; amp; -0.18 \\ \ end {pmatrix}. \ nonumber \ end {equation *}"></div><p></p><br><p>  When multiplying this matrix by the state vector <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bx%7D" alt="\ boldsymbol {x}">  we get three points that need to be applied to the engines to stabilize the system.  LQR is a PD regulator if the state vector consists of coordinates and their derivatives.  As you understand, it is almost impossible to use the usual PID controller and manually select coefficients in such a system. </p><br><div class="spoiler">  <b class="spoiler_title">Model in Matlab simulink c three-dimensional visualization</b> <div class="spoiler_text"><p>  I will give a small explanation of each unit.  In the block ‚ÄúBallbot 3D model‚Äù the Appel equations are realized.  At the entrance is administered <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bu%7D" alt="\ boldsymbol {u}">  (three moments), the output is the state vector <img src="https://tex.s2cms.ru/svg/%20%5Cboldsymbol%7Bx%7D%20" alt="\ boldsymbol {x}">  (see item 2). </p><br><p>  The VRML transform block transforms the state vector into coordinates for visualization.  ‚ÄúVR Sink‚Äù contains a model in vrml format and it is this block that draws the graphics. </p><br><p>  The state vector is fed to the input of the ‚Äúcontroller‚Äù block <img src="https://tex.s2cms.ru/svg/%20%5Cboldsymbol%7Bx%7D%20" alt="\ boldsymbol {x}">  and the desired state vector <img src="https://tex.s2cms.ru/svg/%20%5Cboldsymbol%7Bx%7D_d%20" alt="\ boldsymbol {x} _d">  , with which you can set the trajectory of movement and speed.  The block produces elementary deceleration of the matrices for three moments. <img src="https://tex.s2cms.ru/svg/%5Cboldsymbol%7Bu%7D%3D-%5Cm%7BK%7D(%5Cboldsymbol%7Bx%7D-%5Cboldsymbol%7Bx%7D_d)" alt="\ boldsymbol {u} = - \ m {K} (\ boldsymbol {x} - \ boldsymbol {x} _d)">  . </p><br><p>  Since the moment that the drive develops is limited, I added a saturation link. </p><br><img src="https://habrastorage.org/files/698/b18/8ca/698b188ca9a9464fa9984bcaa256c629.png"><br><p><br clear="all"></p><br><p>  For the three-dimensional visualization was made a simple model of a scaffold in SolidWorks.  It was then exported in vrml format and added to the VR Sink block. </p><br><img src="https://habrastorage.org/files/9dd/5f5/94a/9dd5f594aa25469a8c97d3ae9c0ea8f4.png" width="300"><br><p><br clear="all">  Simulation results with an initial deviation of 10 degrees </p><br><img src="https://habrastorage.org/files/5be/f41/1a7/5bef411a7b454da2af362ba479f96ef7.jpg" width="450"></div></div><br><br><h2>  3 Construction </h2><br><p>  The design of the robot is developed in the Siemens NX CAD system.  On the basis of the constructed model, the mass and inertial characteristics of the robot links were determined. </p><br><img src="https://habrastorage.org/files/86e/8a5/63e/86e8a563e2874f638e2a64c3f8ce67b0.jpg" width="450"><br><p>  The design consists of two aluminum bases.  Three engines are mounted on the lower base, which drive the omnic wheel.  The upper base is attached to the bottom with shock absorbers and guides.  The task of shock absorbers was to reduce the vibrations of the upper part of the body, where all the electronics are located, although this did not help in practice. </p><br><p>  The shelves are made of plexiglass to facilitate construction.  They contain all the onboard electronics: battery, drive controllers, microcontroller, inertial, etc. </p><br><p>  The ball is a basketball with a diameter of 240 mm.  The ball holders press it against omnic wheels, thereby increasing friction.  Unfortunately, they could not be made, as there is no 3D printer in our department, and printing on order is expensive, because  they are not small and the fill factor is needed big for durability. </p><br><p>  Omnicoles were purchased on Aliexpress for $ 120 apiece.  The most expensive part of the robot, after the drives, of course. </p><br><p>  All metal parts are made of duralumin to order at one Moscow factory.  At the same factory we made shelves of plexiglass.  The order came in the amount of 30 000r, approximately. </p><br><div class="spoiler">  <b class="spoiler_title">Some photos of the assembly with comments</b> <div class="spoiler_text"><p>  A friend helped me dissolve the board on which the DC-DC converter, IMU and logical level converter for I2C are located.  ODROID stuck on top </p><br><img src="https://habrastorage.org/files/aa4/92b/ee5/aa492bee556440e3be7ea385b2b01dae.jpg"><br><img src="https://habrastorage.org/files/904/002/dad/904002dadc4f4b7e8f00807562578b58.jpg"><br><p><br clear="all">  This is the very first design with Dynamixel MX64 drives.  Drive boxes are printed. </p><br><img src="https://habrastorage.org/files/79e/295/e37/79e295e37c804b55a39faf95bc38ba24.jpg"><br><p><br clear="all">  HSP shock absorbers for radio-controlled models with a scale of 1:10. </p><br><img src="https://habrastorage.org/files/711/b23/717/711b2371758a432da1bdf7c314a35602.jpg"><br><p><br clear="all">  As such, I got a set of drives and controllers. </p><br><img src="https://habrastorage.org/files/eeb/86d/e0b/eeb86de0b5bf4391ab1e35a88fcb5f22.jpg"><br><p><br clear="all">  In order to put the omniwire on the motor shaft, the sleeve had to be turned out. </p><br><img src="https://habrastorage.org/files/6b0/7d3/029/6b07d30295e54c1c81fde0facb6f60bf.jpg"><br><p><br clear="all">  This is the final result. </p><br><img src="https://habrastorage.org/files/5ca/8d8/013/5ca8d8013d924dbebe9e0cb840122633.jpg"></div></div><br><br><h2>  4 Hardware and software </h2><br><p>  Almost all hardware components of a scarab are represented in a functional diagram.  I will say a few words about each element, moving "from the bottom up." </p><br><p><img src="https://habrastorage.org/files/9b9/a24/b8a/9b9a24b8aa2a45819e4ffd812d8b0400.jpg" width="800"><br></p><br><h3>  4.1 Drives and Drive Controllers </h3><br><p>  It was harder for everyone to find drives and drive controllers.  At the output of the LQR regulator we have a moment, therefore we need to have a controller with the ability to control current (i.e. by moment).  Apparently, this task is very rare in everyday life, and we found only one affordable solution, Dynamixel.  We bought and tried a Dynamixel MX64 drive, which has a current control mode.  Unfortunately, their speed was not enough to stabilize the robot. </p><br><p>  I had already lost hope of creating a real sharabota, but fortunately Yaroslav from the RCC Robotics helped us and provided for some time three Maxon drives with controllers, for which we are very grateful.  As a result, we had a Maxon EC-max 30 40W brushless DC motor with the following characteristics: </p><br><ul><li>  Rated voltage 24V </li><li>  Nominal rotational speed of 7220 rev / s </li><li>  Nominal torque of 33.8 mNm </li><li>  Holding moment 160 mNm </li></ul><br><p>  Maxon GP 32 planetary gearbox with a ratio of n = 14 and Maxon EPOS 24/5 drive controller, which has a current control mode. </p><br><p>  As you can see, the drive is not very powerful and the gear ratio is small, so the moment at the output is hardly enough to stabilize the scatter beam.  The Rezero, for example, uses 200W motors and a gearbox with a gear ratio of 51. </p><br><h3>  4.2 Microcontroller, inertial module, transceiver </h3><br><p>  The STM32F4-Discovery was used as a microcontroller, which has the interfaces we need: CAN, UART and I2C.  It receives data from the gyroscope and accelerometer via I2C and encoders via CAN bus.  Based on the received data, it calculates the control and sends the task to the drive controllers via CAN bus.  In order not to implement the protocol for communicating with EPOS controllers myself, I used the library of <a href="https://github.com/kralf/libepos">libepos</a> .  In order to connect the STM to the CAN network, a CAN transceiver (transceiver) for $ 4 is needed. </p><br><p>  As an inertial module, we used a $ 3 GY-521 board based on the MPU6050 chip, which includes a 3-axis gyroscope and a 3-axis accelerometer.  For processing the readings of these sensors, I used the filter <a href="http://www.x-io.co.uk/open-source-imu-and-ahrs-algorithms/">Madjvika</a> , which recently so loved kopterovody. </p><br><p>  To simplify development under STM, I used the STM32Cube HAL (hardware abstraction layer). </p><br><p>  The frequency at which the control works is about 300 Hz, i.e.  300 times a second, we read all the sensors, calculate the control and send the task to the drive.  All this happens in an infinite loop, which can be represented as the following pseudocode: </p><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ initialize_imu();<span class="hljs-comment"><span class="hljs-comment">/*  IMU  I2C */</span></span> initialize_motors(); <span class="hljs-comment"><span class="hljs-comment">/*    CAN */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>) { read_imu(); <span class="hljs-comment"><span class="hljs-comment">/*     IMU */</span></span> get_omniwheels_speed(); <span class="hljs-comment"><span class="hljs-comment">/*     CAN */</span></span> <span class="hljs-comment"><span class="hljs-comment">/*    UART  odroid */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (uart_rx_flag) { uart_rx_flag = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">joystick_data</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">joystick</span></span></span><span class="hljs-class"> = (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">joystick_data</span></span></span><span class="hljs-class">*)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UARTdev_Get_RX_buf</span></span></span><span class="hljs-class">();</span></span> process_joystick_input(joystick); } calculate_control(); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> set_torque(); <span class="hljs-comment"><span class="hljs-comment">/*      CAN */</span></span> } }</code> </pre> <br><h3>  4.3 Single board computer, battery, DC-DC converter, joystick </h3><br><p>  The onboard single board computer ODROID U3 receives data from the joystick via a Bluetooth adapter and transmits it to the microcontroller via the UART.  It has a lubuntu operating system with Linux 3.8.13.26-rt31 kernel with real-time support. </p><br><img align="left" src="https://habrastorage.org/files/eff/db0/9b7/effdb09b756d4dfcb5fa4ee892bb0a31.jpg" width="100"><br><p>  Lead-acid battery Delta 12045 with a capacity of C = 4.5 Ah.  It lasts about an hour of work. </p><br><p><br clear="left"><img align="left" src="https://habrastorage.org/files/849/f2d/b9b/849f2db9b3d241b49cf3bb79ebcd981c.jpg" width="100"><br>  The voltage of the single-board computer Odroid-U3 5V, the maximum current consumption of 2A.  Since  power supply 12V, a buck $ 2 LM2596S DC-DC converter is needed. </p><br><p><br clear="left"><img align="left" src="https://habrastorage.org/files/b99/ad5/d40/b99ad5d40cae45e3a2cf53ea291a9cb4.jpg" width="100"><br>  To control the scarab, Bluetooth uses a Terios joystick.  The joystick transmits commands via Bluetooth to the ODROID, which contains the Asus USB-BT400 adapter.  To read the commands of the joystick, I used the following <a href="https://github.com/drewnoakes/joystick">library</a> .  The incoming command is parsed, packed and sent over the UART to the STM32, where an interrupt occurs at the reception of each byte. </p><br><img align="left" src="https://habrastorage.org/files/2ad/346/346/2ad3463468c1492182ca61b101a695ae.jpg" width="100"><br><p>  You can also connect to ODROID via SSH.  When started, the odroyd creates an ad-hoc network via a wifi adapter. </p><br><br><h2>  results </h2><br><p>  Total we managed to collect a working sharabota.  It took exactly 2 years to implement this project.  Let's just say that we didn‚Äôt manage to get close to the results of Rezero, as there were no such human, industrial and financial resources as students from Switzerland.  I think if there were more powerful engines and a more advanced inertial module, the results would be much better. </p><br><p>  The source code I do not open for some reason.  If you want to know the details of implementation - write to us, we will be happy to share with you the developments.  The engines had to be returned and at the moment the piece of iron stands without them.  Perhaps the project will be further developed by students, if there are suitable engines and there are those who wish.  For example, it would be interesting to develop nonlinear control algorithms and improve the IMU filtering algorithm. </p><br><p>  I spoke rather superficially about the development process, so I will be glad to answer your questions. </p><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/_hd1qgXshoo%3Ffeature%3Doembed&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhgU0FZam9kFbIllSbL0qcd-FOoIvw" frameborder="0" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/306456/">https://habr.com/ru/post/306456/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306446/index.html">Drupal Critical Vulnerabilities: Details and Exploits</a></li>
<li><a href="../306448/index.html">Mongoose: a tool for testing the performance of storage</a></li>
<li><a href="../306450/index.html">Part 2. DSS Universal Algorithms - Support Service Algorithm</a></li>
<li><a href="../306452/index.html">Keep data under control</a></li>
<li><a href="../306454/index.html">AI 101: An Introduction to Automation and Artificial Intelligence in Outsourcing</a></li>
<li><a href="../306458/index.html">AMOcrm and Hive: high-tech business model for online stores</a></li>
<li><a href="../306460/index.html">Testing Product Integration at Netflix Speed</a></li>
<li><a href="../306464/index.html">Radar for pokemon</a></li>
<li><a href="../306466/index.html">New version of OpenVZ</a></li>
<li><a href="../306468/index.html">Joker 2016 Release Notes: 100 technical sessions in 2 days</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>