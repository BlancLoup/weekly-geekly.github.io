<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Carding and ‚Äúblack boxes‚Äù: how to hack ATM today</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The iron boxes with money on the streets of the city can not fail to attract the attention of lovers of quick money. And if earlier purely physical me...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Carding and ‚Äúblack boxes‚Äù: how to hack ATM today</h1><div class="post__text post__text-html js-mediator-article"><p>  The iron boxes with money on the streets of the city can not fail to attract the attention of lovers of quick money.  And if earlier purely physical methods were used to empty ATMs, now more and more skillful tricks related to computers are used.  Now the most relevant of them is the ‚Äúblack box‚Äù with a single-board microcomputer inside.  How it works, we'll talk in this article. </p><br><p>  <a href="https://habr.com/ru/post/455210/">- The evolution of ATM carding</a> <br>  <a href="https://habr.com/ru/post/455210/">- The first acquaintance with the "black box"</a> <br>  <a href="https://habr.com/ru/post/455210/">- Analysis of ATM communications</a> <br>  <a href="https://habr.com/ru/post/455210/">- Where do the black boxes come from?</a> <br>  <a href="https://habr.com/ru/post/455210/">- ‚ÄúLast mile‚Äù and fake processing center</a> </p><br><p><img src="https://habrastorage.org/webt/px/mr/h-/pxmrh-bvwugrkw89rxqbiicszms.jpeg"></p><a name="habracut"></a><br><p>  <em>The head of the International Association of Manufacturers of ATMs (ATMIA) <a href="https://www.ncr.com/company/blogs/financial/what-security-threats-will-the-financial-institutions-face-in-2018">identified</a> "black boxes" as the most dangerous threat to ATMs.</em> </p><br><p>  A typical ATM is a collection of ready-made electromechanical components placed in a single package.  ATM manufacturers build their iron creations from a banknote dispenser, a card reader and other components already developed by third-party suppliers.  A sort of designer LEGO for adults.  The finished components are located in the ATM housing, which usually consists of two compartments: the upper compartment (‚Äúcabinet‚Äù or ‚Äúservice area‚Äù), and the lower compartment (safe).  All electromechanical components are connected via USB and COM ports to the system unit, which in this case acts as a host.  On older ATM models, you can also find connections via the SDC bus. </p><br><a name="a1"></a><br><h1 id="evolyuciya-bankomatnogo-kardinga">  The evolution of ATM carding </h1><br><p>  ATMs with huge amounts inside, invariably beckon carders to themselves.  At first, carders exploited only gross physical shortcomings of ATM protection - they used skimmers and shimmers to steal data from magnetic strips;  fake pin-pads and pinhole cameras;  and even fake ATMs. </p><br><p>  Then, when ATMs began to be equipped with unified software that operated according to uniform standards, such as XFS (eXtensions for Financial Services), carders began attacking ATMs with computer viruses. </p><br><p>  Among them are Trojan.Skimmer, Backdoor.Win32.Skimer, Ploutus, ATMii and other numerous named and unnamed malware that carders pitch to the ATM host either via a bootable USB flash drive or via a TCP remote control port. </p><br><p><img src="https://habrastorage.org/webt/oc/ty/5a/octy5ah4nznpjxvoxqgzbf8c-zy.jpeg"><br>  <em>ATM infection process</em> </p><br><p>  Having captured the XFS subsystem, the malware can issue commands to the dispenser, without authorization.  Or give commands to the card reader: read / write a magnetic stripe of a bank card and even extract transaction history stored on an EMV card chip.  Special note deserves EPP (Encrypting PIN Pad; encrypted pinpad).  It is considered that the pincode entered on it cannot be intercepted.  However, XFS allows you to use the EPP pinpad in two modes: 1) open mode (for entering various numeric parameters, such as the amount to be cashed);  2) safe mode (EPP switches to it when you need to enter a pincode or encryption key).  This XFS feature allows a card to perform a MiTM attack: intercept the safe mode activation command that is sent from the host to the EPP, and then tell the EPP pinpad that the operation should continue in open mode.  In response to this message, EPP sends keystrokes in clear text. </p><br><p><img src="https://habrastorage.org/webt/0o/b3/y0/0ob3y07xfafvxs8ccctfsugvvug.png"><br>  <em>The principle of the "black box"</em> </p><br><p>  In recent years, <a href="https://m.itcafe.hu/dl/cnt/2017-09/140653/atm.pdf">according to</a> Europol, malware for ATMs has evolved markedly.  Carders no longer need physical access to an ATM to infect it.  They can infect ATMs via remote network attacks using the corporate network of the bank.  <a href="https://www.theguardian.com/technology/2018/jan/29/jackpotting-hackers-atm-cash-machine-give-away">According to</a> Group IB, in 2016, in more than 10 countries in Europe, ATMs were subjected to remote attack. </p><br><p><img src="https://habrastorage.org/webt/g7/8t/ch/g78tchty2b0nr2k7datjm6pbvai.jpeg"><br>  <em>ATM attack via remote access</em> </p><br><p>  Antiviruses, blocking firmware updates, blocking USB ports and encrypting the hard disk - to some extent, protect the ATM from virus attacks of carders.  But what if the carder does not attack the host, but connects directly to the periphery (via RS232 or USB) - to the card reader, pin-pad or cash dispenser? </p><br><a name="a2"></a><br><h1 id="pervoe-znakomstvo-s-chyornym-yaschikom">  The first acquaintance with the "black box" </h1><br><p>  Today, technically savvy carders <a href="https://www.youtube.com/watch%3Fv%3Dq5tQWe6YsLM">do just that</a> , using a so-called ATM to steal cash from an ATM.  ‚ÄúBlack boxes‚Äù are specifically programmed single board microcomputers, like the Raspberry Pi.  ‚ÄúBlack boxes‚Äù empty ATMs cleanly, completely magical (from the point of view of bankers) way.  Carders connect their magic device directly to the banknote dispenser;  to extract from it all the money available.  Such an attack acts to bypass all software protection deployed on the ATM host (antivirus, integrity monitoring, full disk encryption, etc.). </p><br><p><img src="https://habrastorage.org/webt/_6/9y/ji/_69yjiwzmxqqwucj_dxzroftavc.jpeg"><br>  <em>"Black Box" based on Raspberry Pi</em> </p><br><p>  The largest manufacturers of ATMs and government intelligence agencies, faced with several implementations of the "black box", <a href="https://www.theguardian.com/technology/2018/jan/29/jackpotting-hackers-atm-cash-machine-give-away">warned</a> that these clever computers are encouraging ATMs to spit out all the available cash;  40 banknotes every 20 seconds.  Also, special services warn that carders often target ATMs in pharmacies, shopping centers;  and also on ATMs that serve motorists "on the go." </p><br><p>  At the same time, in order not to glow in front of the cameras, the most cautious carders take to the aid of some not too valuable partner, a mule.  And so that he could not assign the "black box" to himself, use the <a href="http://krebsonsecurity.com/2015/01/thieves-jackpot-atms-with-black-box-attack/">following scheme</a> .  Key functionality is removed from the ‚Äúblack box‚Äù and a smartphone is connected to it, which is used as a channel for remote transmission of commands to the trimmed ‚Äúblack box‚Äù via IP protocol. </p><br><p><img src="https://habrastorage.org/webt/zp/yu/yl/zpyuylsxomrqvikw7zdyfywm_x8.png"><br>  <em>Modification of the "black box", with activation via remote access</em> </p><br><p>  How does it look from the point of view of bankers?  On the records from the camcorder clips, something like this happens: a certain personality opens the upper compartment (service area), connects the magic box to the ATM, closes the upper compartment and leaves.  After a while, a few people, seemingly ordinary customers, approach the ATM, and withdraw huge amounts of money.  Then the carder returns and removes his little magical device from the ATM.  Usually, the fact of an ATM attack with a ‚Äúblack box‚Äù is revealed only after a few days: when the empty safe and the cash withdrawal journal do not match.  As a result, bank employees can only <a href="https://gsec.hitb.org/materials/sg2016/whitepapers/ATMs%2520and%2520Their%2520Dirty%2520Little%2520Secrets%2520-%2520Olga%2520Kochetova%2520%26%2520Alexey%2520Osipov.pdf">scratch their heads</a> . </p><br><a name="a3"></a><br><h1 id="analiz-bankomatnyh-kommunikaciy">  ATM Communications Analysis </h1><br><p> As noted above, the interaction between the system unit and peripheral devices is carried out via USB, RS232 or SDC.  Carder connects directly to the port of the peripheral device and sends him commands - bypassing the host.  It's quite simple, because standard interfaces do not require any specific drivers.  And the proprietary protocols, through which the periphery and the host interact, do not require authorization (after all, the device is inside the trusted zone);  therefore, these unprotected protocols, in which the periphery and the host interact, are easy to listen to and easily replayable. </p><br><p>  So  Carders can use a software or hardware traffic analyzer, connecting it directly to the port of a specific peripheral device (for example, to a card reader) - to collect the transmitted data.  Using the traffic analyzer, the carder learns all the technical details of the operation of the ATM, including the undocumented functions of its periphery (for example, the function of changing the firmware of the peripheral device).  As a result, the carder gains full control of the ATM.  At the same time, detecting the presence of a traffic analyzer is rather difficult. </p><br><p>  Direct control over the banknote dispenser device means that the ATM cassettes can be emptied without any fixation in the logs that the software deployed on the host makes in normal mode.  For those who are not familiar with the ATM hardware and software architecture, this is really how magic can look. </p><br><a name="a4"></a><br><h1 id="otkuda-berutsya-chyornye-yaschiki">  Where do the black boxes come from? </h1><br><p>  ATM vendors and subcontractors are developing debugging utilities to diagnose the hardware of the ATM, including electrical engineers who are responsible for cash withdrawals.  Among such utilities: <a href="https://www.atmdesk.com/">ATMDesk</a> , <a href="http://www.afferentsoftware.com/rapidfire-range">RapidFire ATM XFS</a> .  The figure below shows some more of these diagnostic tools. </p><br><p><img src="https://habrastorage.org/webt/gu/cg/w7/gucgw7wyiax5e5quokuz65zwxpi.jpeg"><br>  <em>ATMDesk Control Panel</em> </p><br><p><img src="https://habrastorage.org/webt/1f/eq/v-/1feqv-gagwitly29u4gddp6x10y.png"><br>  <em>RapidFire ATM XFS Control Panel</em> </p><br><p><img src="https://habrastorage.org/webt/ru/4i/3o/ru4i3o7mw02vzaf43nm35jgswuk.png"><br>  <em>Comparative characteristics of several diagnostic tools</em> </p><br><p>  Access to such utilities is normally limited to personalized tokens;  and they work only with the open door of an ATM safe.  However, simply replacing a few bytes in a binary code utility, carders <a href="https://securelist.com/malware-and-non-malware-ways-for-atm-jackpotting-extended-cut/74533">can</a> "test" cash withdrawal - bypassing the checks provided by the utility manufacturer.  Carders install these modified utilities on their laptop or single-board microcomputer, which are then connected directly to a banknote dispenser for unauthorized cash withdrawals. </p><br><a name="a5"></a><br><h1 id="poslednyaya-milya-i-poddelnyy-processingovyy-centr">  Last mile and fake processing center </h1><br><p>  Direct interaction with the periphery, without communication with the host is only one of the effective methods of carding.  Other techniques rely on the fact that we have a wide variety of network interfaces through which an ATM connects to the outside world.  From X.25 to Ethernet and cellular.  Many ATMs can be identified and localized through the Shodan service (the most concise instructions on its use are presented <a href="http://magazine.hitb.org/issues/HITB-Ezine-Issue-007.pdf">here</a> ), followed by an attack parasitizing the vulnerable security configuration, the administrator‚Äôs laziness, and vulnerable communications between different departments of the bank. </p><br><p>  The ‚Äúlast mile‚Äù of communication between the ATM and the processing center is rich in a wide variety of technologies that can serve as an entry point for the card.  The interaction can be carried out through a wired (telephone line or Ethernet) or wireless (Wi-Fi, cellular communication: CDMA, GSM, UMTS, LTE) method of communication.  Security mechanisms can include: 1) hardware or software tools to support VPN (both standard, built-in operating systems, and from third-party manufacturers);  2) SSL / TLS (both specific to a specific ATM model, and from third-party manufacturers);  3) encryption;  4) message authentication. </p><br><p>  However, <a href="https://gsec.hitb.org/materials/sg2016/whitepapers/ATMs%2520and%2520Their%2520Dirty%2520Little%2520Secrets%2520-%2520Olga%2520Kochetova%2520%26%2520Alexey%2520Osipov.pdf">it seems</a> that for the banks the listed technologies are very complex, and therefore they do not bother with special network protection;  or implement it with errors.  At best, the ATM communicates with the VPN server, and already within the private network it connects to the processing center.  In addition, even if the banks manage to implement the above-mentioned defense mechanisms, the carder already has effective attacks against them.  So  even if security complies with the PCI DSS standard, ATMs are still vulnerable. </p><br><p>  One of the basic requirements of PCI DSS: all sensitive data, when transferred over a public network, must be encrypted.  And after all, we really have networks that were originally designed so that the data is completely encrypted in them!  Therefore, there is a temptation to say: "We have the data encrypted, because we use Wi-Fi and GSM."  However, many of these networks do not provide sufficient protection.  Cellular networks of all generations have long been hacked.  Finally and irrevocably.  And even there are suppliers who offer devices to intercept the data transmitted through them. </p><br><p>  Therefore, either in unsafe communication or in a ‚Äúprivate‚Äù network, where each ATM broadcasts itself to other ATMs, a MiTM-attack ‚Äúfake processing center‚Äù can be initiated - which will cause the cardder to seize control of the data flows transmitted between ATM and processing center. </p><br><p>  Thousands of ATMs are potentially susceptible to <a href="https://gsec.hitb.org/materials/sg2016/whitepapers/ATMs%2520and%2520Their%2520Dirty%2520Little%2520Secrets%2520-%2520Olga%2520Kochetova%2520%26%2520Alexey%2520Osipov.pdf">such MiTM attacks</a> .  On the way to the authentic processing center - the cardrer inserts his fake.  This fake processing center gives the ATM a team to issue banknotes.  At the same time, the cardder adjusts its processing center so that cash withdrawal takes place regardless of which card is inserted into the ATM - even if its validity period has expired, or there is a zero balance on it.  The main thing is that the fake processing center ‚Äúrecognizes‚Äù it.  As a fake processing center, either an artisanal hand-made article or a processing center simulator, originally developed for debugging network settings (another gift from the ‚Äúmanufacturer‚Äù to carders), can be used. </p><br><p>  The following figure <a href="https://securelist.com/malware-and-non-malware-ways-for-atm-jackpotting-extended-cut/74533">shows a</a> dump of commands for issuing 40 banknotes from the fourth cassette, sent from a fake processing center and stored in ATM-software logs.  They look almost like real ones. </p><br><p><img src="https://habrastorage.org/webt/ct/y2/ye/cty2ye8htk-id1cztykv3tbdpsy.png"><br>  <em>Dump commands fake processing center</em> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/455210/">https://habr.com/ru/post/455210/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../455200/index.html">Dynamic JavaScript Import</a></li>
<li><a href="../455202/index.html">Big data in hotel management: use cannot be ignored</a></li>
<li><a href="../455204/index.html">The hatch of the Soyuz MS-14 spaceship turned out to be narrow for the FEDOR robot</a></li>
<li><a href="../455206/index.html">5 test questions for a quick job search in Germany</a></li>
<li><a href="../45521/index.html">Blizzard gives out StarCraft for free</a></li>
<li><a href="../455212/index.html">Linux network application performance. Introduction</a></li>
<li><a href="../455214/index.html">Stanford, it seems we have a problem ...</a></li>
<li><a href="../455216/index.html">Doppler speed meter</a></li>
<li><a href="../455218/index.html">Ecosystem Approach to Business Technologies</a></li>
<li><a href="../455224/index.html">Finger Music: Play Anything With Sphero SpecDrums</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>