<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The course of the young fighter: protect the router itself</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Following the axioms of security, we will assume that any node in the network is a potential goal. Therefore, it would be good to know what potential ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The course of the young fighter: protect the router itself</h1><div class="post__text post__text-html js-mediator-article">  Following the axioms of security, we will assume that any node in the network is a potential goal.  Therefore, it would be good to know what potential vulnerabilities these nodes have.  Consider a cisco router.  Immediately, there will be objections: there are many of them, the services supported are different and in general it is difficult to dump CRS-1 and the ancient 1600 into one heap. However, I don‚Äôt set myself to cover everything, but I will describe some common things. <br><a name="habracut"></a><br>  So, the first thing to remember is that the default router does not block any normal traffic on the interface (frames with an incorrect checksum is not counted).  However, part of the packets, with a more in-depth review (by the processor), the router recognizes as unnecessary, for example: <br>  1. Packages with TTL = 0 or less <br>  2. Packages that are not known where to send (the destination network of the packet is not present in the routing table and there is no explicit packet sending rule (PBR)) <br>  3. Packets related to service protocols (for example, routing protocols) that are not running on the router. <br>  These destroyed packets can play a cruel joke: if there is a lot of such traffic, it can significantly load the router's processor. <br>  Further, in addition to transit traffic, the router handles some service traffic (directed to itself).  Often, by default (or ignorance), unnecessary protocols are running on the router.  They are dangerous because the router handles packets of this protocol.  And you can arrange, for example, a DoS attack, learn remotely information that is not intended for distribution, or explore the network topology.  These protocols include <br>  1. TFTP (the router can act as a TFTP server). <br>  2. BOOTP (can distribute their configuration files to diskless stations) <br>  3. DHCP (Router can act as server and client) <br>  4. TCP Small Servers (TCP Echo, Finger, etc.) <br>  5. UDP Small Servers (UDP Echo, Discard, etc.) <br>  6. CDP (Cisco Discovery Protocol) <br>  7. NTP (Network Time Protocol. The router can act as a server and client) <br>  8. DNS (Enabled by default broadad DNS servers in the segment) <br>  9. PAD (Packet Accembler / Disaccembler) <br>  10. SNMP (Default community is often configured) <br><br>  As a rule, if these protocols are not needed, they are better off. <br>  1. <i>no tftp-server</i> <br>  2. <i>no ip bootp server</i> (old <i>no service bootp</i> command) <br>  3. <i>no ip dhcp pool (no service dhcp)</i> <br>  4. <i>no service tcp-small-servers</i> <br>  5. <i>no service udp-small-servers</i> <br>  6. <i>no cdp run</i> (globally), <i>no cdp enable</i> (on a specific interface).  Do not turn this protocol off if a cisco ip phone is connected to the interface, because  It is according to this protocol that the autodetection of the connected device occurs (this recommendation is more typical for switches, but still) <br>  7. <i>no ntp master, no ntp server</i> <br>  8. <i>no ip domain-lookup</i> .  Remember that often the DNS on the router is needed, so it is not always necessary to disable <br>  9. <i>no service pad</i> <br>  10. <i>no snmp-server community {public | private}</i> <br><br>  However, even if you turn off these and other service protocols (for example, http, https, ssh), the packets of these protocols coming to the router interface will get into the brain and only there will be thrown back.  Those.  even turning off everything, you can try to load the router's processor by discarding garbage. <br>  I would like to learn how to discard such packets without loading the brain.  Also, there is often a problem to limit the load of service traffic to the processor.  For example, specifying the maximum number of service packets (total or by individual protocols) in the queue or the number of service packets per second. <br>  These tasks are solved with the help of a special mode. <br>  <i>control-plane host</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To use this technology, you can create special traffic classes. <br><br>  <i>class-map type?</i> <i><br></i>  <i><b>access-control</b> access-control specific class-map</i> <i><br></i>  <i><b>control</b> Configure a control policy class-map</i> <i><br></i>  <i><b>inspect</b> Configure CBAC Class Map</i> <i><br></i>  <i><b>logging</b> Class map for control-plane packet logging</i> <i><br></i>  <i><b>port-filter</b> Class map for port filter</i> <i><br></i>  <i><b>queue-threshold</b> Class map for queue threshold</i> <i><br></i>  <i><b>stack</b> class-map for protocol header stack specification</i> <i><br></i> <br>  Create a special policy (Policy-map type) <br>  <i>policy-map type?</i> <i><br></i>  <i><b>access-control</b> access-control specific policy-map</i> <i><br></i>  <i><b>control</b> Configure a control policy policy</i> <i><br></i>  <i><b>inspect</b> Configure CBAC Policy Map</i> <i><br></i>  <i><b>logging</b> control-plane packet logging</i> <i><br></i>  <i><b>port-filter</b> Control-plane tcp / udp port filtering</i> <i><br></i>  <i><b>queue-threshold</b> Control-plane protocol queue limiting</i> <i><br></i> <br>  And apply it in this mode: <br>  <i>control-plane host</i> <i><br></i>  <i>service-policy type?</i> <i><br></i>  <i><b>logging</b> control-plane packet logging</i> <i><br></i>  <i><b>port-filter</b> Control-plane tcp / udp port filtering</i> <i><br></i>  <i><b>queue-threshold</b> Control-plane protocol queue limiting</i> <i><br></i> <br>  Restriction of the load on the brain by service packets is organized, it seems, but for this it is enough to describe the usual class of traffic, the usual policy, where as an action specify the restriction with the word police <br>  <i>police rate [units] pps</i> <br>  Let's look at examples: <br>  1. Limit the number of Telnet packets from all networks except the host 10.1.1.100 to 100 packets per second <br>  To do this, we write an access list <br>  <i>ip access-list extended TELNET</i> <i><br></i>  <i>deny tcp host 10.1.1.100 any eq 23</i> <i><br></i>  <i>permit tcp any any eq 23</i> <i><br></i> <br>  Next, create a traffic class. <br>  <i>class-map TELNET</i> <i><br></i>  <i>match access-group TELNET</i> <i><br></i> <br>  We describe the policy <br>  <i>policy-map TELNET</i> <i><br></i>  <i>class TELNET</i> <i><br></i>  <i>police rate 100 pps</i> <i><br></i> <br>  And hang policy in control-plane <br>  <i>control-plane host</i> <i><br></i>  <i>service-policy input TELNET</i> <i><br></i> <br>  2. Block packets directed to application ports that are not used by the router. <br>  Create a special traffic class <br>  <i>class-map type port-filter PORTS</i> <i><br></i>  <i>match closed-ports</i> <i><br></i> <br>  We describe a special policy <br>  <i>policy-map type port-filter PORTS</i> <i><br></i>  <i>class PORTS</i> <i><br></i>  <i>drop</i> <i><br></i> <br>  And hang policy in control-plane <br>  <i>control-plane host</i> <i><br></i>  <i>service-policy type port-filter input PORTS</i> <i><br></i> <br><br>  To protect the management-plane, i.e.  router management must remember the following points: <br>  1. If possible, use secure control protocols: ssh, https.  To do this, you need to develop a key pair of RSA, specify authentication rules and enable https support (ip http secure-server) <br>  2. Even when using secure control protocols, and especially if it is impossible to use them, it is necessary to restrict administrative access from the outside and from the inside using access lists applied on interfaces, terminal lines (line vty) or in control-plane host mode <br>  3. It is advisable to use complex passwords with a minimum length of 8 characters and containing numbers, letters of different case and symbols.  And so that some young administrator of the router does not violate this password creation rule, there is a command <br><br>  <i>security passwords min-length [length]</i> <br><br>  4. Passwords in the config is better to have hashed.  Then there will be no opportunity to peep the password.  To do this, use not the word ‚Äúpassword‚Äù, but the word ‚Äúsecret‚Äù <br>  Examples: <br>  <i>username admin secret {password}</i> <i><br></i>  <i>enable secret {password}</i> <i><br></i> <br>  5. Do not forget about the port AUX.  This is almost the same console and having access to the hardware can connect using AUX to the command line.  If there is no password for AUX, then the person who connected will be able to get into at least unprivileged mode. <br>  6. Many routers have a password protection feature.  You can block a user after N incorrectly entered passwords, or after several attempts to insert a delay. <br>  Example: <br>  <i>security authentication failure rate [attempts] [log]</i> <br><br>  After N incorrect passwords (10 by default), a 15 second delay will be inserted.  The word log allows you to log such events. <br>  7. Remember that when using the SNMP protocol, it is advisable to use the 3rd version of the protocol with authentication and encryption.  When using earlier, practically unprotected versions, be sure to ensure that the default community is disabled. <br>  8. In networks with a large number of devices, it makes sense to allocate the so-called network for management (OOB, Out-of-Band management).  This is a separate network segment that does not intersect with the data network.  Until recently, a router could only be placed in an OOB via a console server, but on new IOSs you can administer the interface from which you can configure the router and only from it.  This is done in the same control-plane host mode by explicitly specifying the interface and allowed protocols. <br>  Example: <br>  <i>control-plane host</i> <i><br></i>  <i>management-interface f0 / 0 allow ssh snmp</i> <i><br></i> <br>  Routing Protocol Security <br>  Protection of dynamic routing protocols is also a very important topic, because  if the attacker manages to damage the routing table, the necessary packets will simply be destroyed or go "not there."  Therefore, I highly recommend using update authentication when working with dynamic routing protocols, preferably MD5 sum (hash).  Almost all protocols support this technology: BGP, OSPF, RIPv2, EIGRP.  Some protocols also support clear text authentication (just a key), but since  the key is transmitted in the update package itself; to call such a mechanism a protected language does not turn. <br>  To configure MD5 authentication, you usually need: <br>  1. Describe the same key on all routers working on the same protocol (or on a specific interface, in a specific zone) <br>  2. Configure the protection method (without protection, clear text, MD5) <br><br>  3. Enable the mechanism <br><br>  Example: OSPF protocol <br>  <i>Ro (config-if) # ip ospf authentication message-digest</i> <i><br></i>  <i>Ro (config-if) # ip ospf message-digest-key 1234 md5 cisco</i> <i><br></i> <br>  Where 1234 is the key number, and md5 hash will be calculated from the word ‚Äúcisco‚Äù. </div><p>Source: <a href="https://habr.com/ru/post/69782/">https://habr.com/ru/post/69782/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../69772/index.html">A small selection of how to turn to Firefox 3.7 Mockup interface</a></li>
<li><a href="../69774/index.html">Form Controls in html 5</a></li>
<li><a href="../69775/index.html">Kqueue FreeBSD Vulnerability</a></li>
<li><a href="../69779/index.html">We announce the start of registration of applications for participation in Google Developer Day 2009 in Moscow</a></li>
<li><a href="../69780/index.html">Pros and cons of open source licenses</a></li>
<li><a href="../69783/index.html">Plum counted, or Sales in Russian</a></li>
<li><a href="../69785/index.html">Why Beeline Kamaz for 5 million?</a></li>
<li><a href="../69788/index.html">Pirate Bay with a taste of Wi-Fi</a></li>
<li><a href="../69789/index.html">Typedia font encyclopedia</a></li>
<li><a href="../69790/index.html">Watchman: on guard system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>