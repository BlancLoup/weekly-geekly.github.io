<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP extension or everything will be in Zephir</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably every PHP developer (and not only PHP) has a dream - to write his own extension for PHP, which by definition works faster than interpreted co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP extension or everything will be in Zephir</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d00/0a4/b6b/d000a4b6bb4929e64cb0085397c6c0ca.jpg" alt="image" align="left">  Probably every PHP developer (and not only PHP) has a dream - to write his own extension for PHP, which by definition works faster than interpreted code, without delving into the subtleties of the Zend Engine, and even better without knowing C ++.  And that day is nearing when the dream will come true.  I want to tell you about a very interesting programming language called Zephir.  Who is too lazy to read, go to the <a href="http://zephir-lang.com/">site</a> and follow the instructions, and I will tell you how to write your extension and about the pitfalls that are encountered on this way. <br><a name="habracut"></a><br>  What is Zephir?  Zephir is a high-level open source programming language for quickly and easily creating an extension for PHP with an emphasis on types (typed) and security.  Its syntax is very similar to PHP itself. <br>  So, let's begin.  First we need to install the missing components: <br><pre><code class="bash hljs">$ sudo apt-get install php5-dev re2c libjson0-dev libpcre3-dev</code> </pre> <br><ul><li>  php5-dev - package with files for developing extensions </li><li>  re2c - regular expression compiler </li><li>  libjson0-dev - library headers, json-c package for working with json format </li><li>  libpcre3-dev - headers for a library that provides functions for working with regular expressions </li></ul><br>  Then make a clone from the repository: <br><pre> <code class="bash hljs">$ git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> https://github.com/phalcon/zephir.git</code> </pre><br>  The version in the repository is not always stable, I used commit 6eda047f512b6600cf8afc79348381c64198fcb5. <br>  Go to the directory with Zephir and configure everything for your extension.  Now there is a test extension ‚Äútest‚Äù in the repository - it won't bother us too much. <br><pre> <code class="bash hljs">$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> zephir $ cp -r ext/ .ext/ $ mkdir app</code> </pre><br>  create a class version of our extension <br><pre> <code class="bash hljs">$ nano app/version.zep</code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">App</span></span>; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Version</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"0.0.1 super beta"</span></span>; } }</code> </pre><br>  and tweak the config.json configuration file <br><pre> <code class="bash hljs">$ nano config.json</code> </pre><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"namespace"</span></span>:<span class="hljs-string"><span class="hljs-string">"app"</span></span>}</code> </pre><br>  <b>Attention!</b> <br><ul><li>  The namespace in the config is the namespace namekeys in the class and it is the name of the directory with extension sorts. </li><li>  Classes in an extension must begin with a namespace extension (for example, Test \ TestCase is incorrect) </li><li>  Each namespace must be represented by a directory, and the class is represented by a file with a <b>.zep</b> extension <b>.</b> </li><li>  All the files and directories of the expansion in the lovecourse </li></ul><br>  Now is the time to try our creation.  Remember that we are still in the zephir root directory.  Now you need to deploy zephir, and then compile our extension. <br><pre> <code class="bash hljs">$ sudo ./install $ sudo ./bin/zephir compile</code> </pre><br>  As a result, we will have the app.so library in the / usr / lib / php5 / 20121212 / directory (depending on the PHP version).  It needs to be connected to our PHP.  To do this, we will do the following (an example for cli, but you yourself will be able to reproduce these actions for your particular case): <br><pre> <code class="bash hljs">$ sudo nano /etc/php5/mods-available/app.ini</code> </pre><br>  Insert rows <br><pre> <code class="dos hljs">; configuration <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> php Our Awesome App module ; priority=<span class="hljs-number"><span class="hljs-number">50</span></span> extension=app.so</code> </pre><br>  And let's zink <br><pre> <code class="bash hljs">$ sudo ln -s ../../mods-available/app.ini /etc/php5/cli/conf.d/50-app.ini</code> </pre><br>  Now it's time to check out our first extension: <br><pre> <code class="bash hljs">$ php -r <span class="hljs-string"><span class="hljs-string">"echo App\Version::get() . PHP_EOL;"</span></span></code> </pre><br>  And we see these wonderful lines: <br><pre> <code class="bash hljs">0.0.1 super beta</code> </pre><br>  While compiling an extension, you may see a message about missing tests.  Zephir has the ability to run tests before compiling.  Examples of tests can be found in the unit-tests directory. <br>  <b>PS</b> Cake real <br>  <b>PSS</b> Please all comments and amendments to the PM. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/194838/">https://habr.com/ru/post/194838/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194822/index.html">Copyright: you have to take the initiative</a></li>
<li><a href="../194830/index.html">It seems that the next Android will also be "flat"</a></li>
<li><a href="../194832/index.html">ILC: why do scientists need the second Big Collider?</a></li>
<li><a href="../194834/index.html">Recipe schemes for pizzeria cuisine. Fast food plus design</a></li>
<li><a href="../194836/index.html">Why is the frequency not increasing?</a></li>
<li><a href="../194842/index.html">play rock, or comand-line internet radio</a></li>
<li><a href="../194844/index.html">The Startup AddVenture conference offers a new interactive format of interaction with venture capital investors and experts from Silicon Valley.</a></li>
<li><a href="../194848/index.html">We clean the HTML code when pasting text from MS Word to HTML5 WYSIWYG editor (contenteditable)</a></li>
<li><a href="../194850/index.html">Billing in a big project</a></li>
<li><a href="../194852/index.html">Rejecting jParser (in favor of working directly with Node.js buffers) speeds up the script by an order of magnitude</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>