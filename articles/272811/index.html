<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Raising a complex project on Django using Docker</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, colleagues. 

 Today I will talk about the not quite simple concept of fast (up to an hour after several workouts) deploying a project...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Raising a complex project on Django using Docker</h1><div class="post__text post__text-html js-mediator-article">  Good afternoon, colleagues. <br><br>  Today I will talk about the not quite simple concept of fast (up to an hour after several workouts) deploying a project for a team consisting of at least individual frontend and backend developers. <br><br>  We have the baseline data: the development of the project begins, in which a ‚Äúthin backend‚Äù is planned.  Those.  our back-up consists of cached pages (rendered by any template engine), three-dimensional models with accompanying logic (ORM), and a REST API acting as a controller.  In fact, View in such a system is reduced and rendered to JS, since there are various reagents, angulyar and other things that allow front-line workers to consider themselves ‚Äúwhite people‚Äù. <br><a name="habracut"></a><br>  Our development environment looks like this: Ubuntu LTS (14.04), PyCharm, Python of any version (we will take 2.7 to launch a virtual environment on which there will be a similar version).  Django (1.8) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We solve the following problems: <br><ol><li>  You must fully emulate the Production space, and even better, supply the code to the participants in the development process along with the environment. </li><li>  It is necessary to separate the execution environment of our project from the operating system environment.  We don‚Äôt need problems with Python versions, node.js settings, or database deployment.  Let our desktop system be clean and bright. </li><li>  It is necessary to automate the deployment of the project, which will work on more and the guru JS, and possibly a cool layout designer.  Yes, so that the project can be raised and the tester, and the manager with basic knowledge in the technical field. </li><li>  It is necessary to separate the dev version from production without any problems.  Downtime should be minimal.  No one will wait for the lead programmer to fix all the variables in settings and fix other problems. </li><li>  It is necessary to make so that participants of development did not solve problems each other.  JS developer should not delve into the subtleties of launching Celery, merging JS files, etc.  The formatter should not be interested in what compiles his Sass code, etc.  This refers to the deployment automation, but it is important to emphasize that these problems can be inconvenient and it will take time to write detailed deployment instructions if it occurs in manual mode. </li></ol><br><br><h2>  Docker installation </h2><br>  For our application, we will use <a href="https://www.docker.com/">Docker</a> .  About this tool on Habr√© said a lot.  At once I will make a reservation that we are not planning to complicate the Production server yet.  It is important for us to build a development environment with a basis for the subsequent application of the CI concept.  But, in the framework of the current article we will work only with docker-compose and do not touch on the quick deployment methods.  Fortunately, those of Docker are abundant. <br><br>  Docker can be installed on Mac and Windows machines with varying success.  But we will consider installing it on Ubuntu 14.04.  There is an <a href="http://docs.docker.com/engine/installation/ubuntulinux/">instruction</a> for installing Docker on this system, but it can cause problems.  From the part, you can write them off from this instruction note: <br><br><blockquote>  Note: Ubuntu Utopic 14.10 is not officially supported. </blockquote><br><br>  Therefore, we do not show off and set as recommended by <a href="http://docs.docker.com/linux/step_one/">another instruction</a> : <br><br><pre><code class="bash hljs">$ sudo apt-get update $ sudo apt-get install wget wget -qO- https://get.docker.com/ | sh</code> </pre> <br><br>  And check the installation with the command: <br><br><pre> <code class="bash hljs">$ docker run hello-world</code> </pre><br><br>  Now let's create a virtual environment for running Docker: <br><pre> <code class="bash hljs">$ mkdir ~/venvs $ virtualenv ~/venvs/docker $ <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> ~/venvs/docker/bin/activate (docker) $ pip install docker-compose (docker) $ docker-compose -v</code> </pre><br><br><h2>  Create a project </h2><br>  Open PyCharm and create a project for work. <br><br><img src="https://habrastorage.org/files/4a8/d9d/247/4a8d9d2470bf4901a8a09518e04ef48a.png" alt="The minimum composition of the project"><br><br>  We create a project for any interpreter.  Let it be a pure python project.  In the diagram above, you see the minimum composition of the project.  Supervisord will be responsible for starting the server.  The .gitignore and .dockerignore files will allow you to specify those files that will not be committed to the project repository or will not be mounted in docker containers.  Containers will be managed by the docker-compose.yml file, since it is simple as a stick and effective as a Kalashnikov rifle.  For the main project, we will additionally create a Dockerfile to install the missing libraries. <br><br>  The dockerfiles folder has a pgdata subfolder - in it we will have a PostgreSQL database in case we want to transfer data from one place to another.  In dockerfiles / sshdconf let's put the settings for the SSH server.  For the direct connection, we will not need it, but for setting up the environment in PyCharm - how.  The id_rsa.pub key will allow PyCharm to connect to the container without dancing around the password.  All you need is to create a bunch of SSH keys and copy (or transfer) the public key to the dockerfiles directory. <br><br>  The src directory is the root of our project.  Now our task is to expand the containers. <br><br><h2>  Create containers </h2><br>  The docker-compose.yml file will look like this: <br><br><pre> <code class="hljs javascript">postgresql: image: postgres:<span class="hljs-number"><span class="hljs-number">9.3</span></span> env_file: .env volumes: - ./dockerfiles/pgdata:<span class="hljs-regexp"><span class="hljs-regexp">/var/</span></span>lib/postgresql/data/pgdata ports: - <span class="hljs-string"><span class="hljs-string">"5433:5432"</span></span> project: build: ./ env_file: .env working_dir: <span class="hljs-regexp"><span class="hljs-regexp">/opt/</span></span>project command: bash -c <span class="hljs-string"><span class="hljs-string">"sleep 3 &amp;&amp; /etc/init.d/ssh start &amp;&amp; supervisord -n"</span></span> volumes: - ./src:<span class="hljs-regexp"><span class="hljs-regexp">/opt/</span></span>project - ./dockerfiles/sshdconf/sshd_config:<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>ssh/sshd_config - ./dockerfiles/id_rsa.pub:<span class="hljs-regexp"><span class="hljs-regexp">/root/</span></span>.ssh/authorized_keys - <span class="hljs-regexp"><span class="hljs-regexp">/home/</span></span>USERNAME/.pycharm_helpers/:<span class="hljs-regexp"><span class="hljs-regexp">/root/</span></span>.pycharm_helpers/ - ./supervisord.conf:<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>supervisord.conf - ./djangod.conf:<span class="hljs-regexp"><span class="hljs-regexp">/etc/</span></span>djangod.conf links: - postgresql ports: - <span class="hljs-string"><span class="hljs-string">"2225:22"</span></span> - <span class="hljs-string"><span class="hljs-string">"8005:8000"</span></span></code> </pre><br><br>  Notice the first container, postgresql.  We uniquely give it the .env for the formation of primary data.  The ports directive is responsible for port forwarding.  The first digit before the colon is the port number by which this base will be available in our ubunt.  The second digit is the port number that is forwarded from the container.  Default PostgreSQL Port <br><br>  We will collect the second container from the Dockerfile.  Therefore, there is a build here.  The launch command comes with a slight delay - in case we need time to launch the database and other tools inside the containers.  Here we see all the connected directories and files.  When forwarding ports, we have port 2225 - for SSH and 8005 - for the server.  In sshd_config, we need to configure these directives for ourselves: <br><br>  PermitRootLogin without-password <br>  StrictModes no <br><br>  RSAAuthentication yes <br>  PubkeyAuthentication yes <br>  AuthorizedKeysFile% h / .ssh / authorized_keys <br><br>  Remember that all this stuff will work only on the development team.  On the production, we will not post it.  Although, in principle, the ssh server will be available only locally. <br><br>  /home/USERNAME/.pycharm_helpers/:/root/.pycharm_helpers/ - This mount command will allow us to run tests and debugs directly from PyCharm.  Do not forget to register your USERNAME here. <br><br>  <b>In supervisord.conf we write the following:</b> <br><br>  [unix_http_server] <br>  file = / opt / project / daemons / supervisor.sock;  path to your socket file <br><br>  [supervisord] <br>  logfile = / opt / project / logs / supervisord.log;  supervisord log file <br>  logfile_maxbytes = 50MB;  maximum size of logfile before rotation <br>  logfile_backups = 10;  number of backed up logfiles <br>  loglevel = info;  info, debug, warn, trace <br>  pidfile = / opt / project / daemons / supervisord.pid;  pidfile location <br>  nodaemon = false;  run supervisord as a daemon <br>  minfds = 1024;  number of startup file descriptors <br>  minprocs = 200;  number of process descriptors <br>  user = root;  default user <br>  childlogdir = / opt / project / logs /;  where child log files will live <br><br>  [rpcinterface: supervisor] <br>  supervisor.rpcinterface_factory = supervisor.rpcinterface: make_main_rpcinterface <br><br>  [supervisorctl] <br>  serverurl = unix: ///opt/project/daemons/supervisor.sock;  use unix: // schem for a unix sockets. <br><br>  [include] <br><br>  # Uncomment this line for celeryd for Python <br>  files = djangod.conf <br><br>  <b>In djangod.conf:</b> <br><br>  [program: django_project] <br>  command = python /opt/project/manage.py runserver 0.0.0.0:8000 <br>  directory = / opt / project / <br>  stopasgroup = true <br>  stdout_logfile = / opt / project / logs / django.log <br>  stderr_logfile = / opt / project / logs / django_err.log <br><br>  Anyone who carefully reads configs, should pay attention to the fact that we have announced two folders that have not been created yet.  So create the logs and daemons directories in src.  Add. / Src / logs / * and / src / daemons / * respectively to .gitignore <br><br>  Note that in django, usually, stdout_logfile is not written.  All logs are showered in stderr_logfile.  The setting was taken from some ready-made instruction, and you don‚Äôt really want to delete the line, because stdout_logfile is a fairly standard directive. <br><br>  <b>Now let's not forget about our .env file:</b> <br><br>  POSTGRES_USER = habrdockerarticle <br>  POSTGRES_DB = habrdockerarticle <br>  POSTGRES_PASSWORD = qwerty <br>  POSTGRES_HOST = postgresql <br>  POSTGRES_PORT = 5432 <br>  PGDATA = / var / lib / postgresql / data / pgdata <br>  C_FORCE_ROOT = true <br><br>  It can be added or not added to .gitignore - does not matter. <br><br>  At the end, fill in the Dockerfile <br><br>  FROM python: 2.7 <br><br>  RUN apt-get update &amp;&amp; apt-get install -y openssh-server \ <br>  &amp;&amp; apt-get purge -y --auto-remove -o APT :: AutoRemove :: RecommendsImportant = false -o APT :: AutoRemove :: SuggestsImportant = false $ buildDeps <br><br>  COPY ./src/requirements.txt ./requirements.txt <br><br>  RUN pip install -r requirements.txt <br><br>  <a href="https://github.com/docker-library/python/blob/5909006206b117a7e9d1a329abdde6031e7342c5/2.7/Dockerfile">Docker Hub</a> does not hide from us the fact that our container will be serviced by Debian Jessie.  In Dockerfile, we have planned the installation of the ssh server, the cleaning of unnecessary package lists and the installation requirements.  By the way, the dependency file has not been created yet.  We need to fix this bug and create requirements.txt in the src folder: <br><br>  Django == 1.8 <br>  psycopg2 <br>  supervisor <br><br><h2>  First start </h2><br>  The project is ready for the first launch!  We will run one by one.  First perform: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose run --rm --service-ports postgresql</code> </pre><br><br>  This operation will download the image we need to run the postgresql server.  The server will start, the user and the database specified in .env will be created automatically.  The team will block data entry for us, but we will not stop it yet.  Make sure that the database and login roles are available by connecting via pgadmin <br><br><img src="https://habrastorage.org/files/8be/4ec/843/8be4ec843b1642908f8abd34a4e0657f.png" alt="PgAdmin settings"><br><br>  As we see, everything is already created for work: <br><br><img src="https://habrastorage.org/files/e89/61d/eca/e8961deca2db441ebc64dc6e16266f83.png" alt="Entry base and role created"><br><br>  Now, using the ctrl + C key combination in the console, stop the process.  We need to collect the image of the project.  So let's do it: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose build project</code> </pre><br><br>  This command will compile a project for us, as well as execute all the commands from the Dockerfile.  Those.  we will have an ssh server installed, as well as dependencies from requirements.txt.  Now we have the question of creating a Django project.  You can create it in several ways.  The most bulletproof is to put the required version of Django in our docker virtualenv on ubunt: <br><br><pre> <code class="bash hljs">(docker) $ pip install django==1.8 (docker) $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ./src (docker) $ django-admin startproject projectname (docker) $ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../</code> </pre><br><br>  Django from venv can be removed or left for other projects.  All that is left for us is to transfer the project internals to the root of the src folder. <br><br>  Now we need to check our project and configure the connection to the database.  First, change the settings in settings.py: <br><br><pre> <code class="python hljs">DATABASES = { <span class="hljs-string"><span class="hljs-string">'default'</span></span>: { <span class="hljs-string"><span class="hljs-string">'ENGINE'</span></span>: <span class="hljs-string"><span class="hljs-string">'django.db.backends.postgresql_psycopg2'</span></span>, <span class="hljs-string"><span class="hljs-string">'NAME'</span></span>: os.getenv(<span class="hljs-string"><span class="hljs-string">'POSTGRES_DB'</span></span>), <span class="hljs-string"><span class="hljs-string">'USER'</span></span>: os.getenv(<span class="hljs-string"><span class="hljs-string">'POSTGRES_USER'</span></span>), <span class="hljs-string"><span class="hljs-string">'PASSWORD'</span></span>: os.getenv(<span class="hljs-string"><span class="hljs-string">'POSTGRES_PASSWORD'</span></span>), <span class="hljs-string"><span class="hljs-string">'HOST'</span></span>: os.getenv(<span class="hljs-string"><span class="hljs-string">'POSTGRES_HOST'</span></span>), <span class="hljs-string"><span class="hljs-string">'PORT'</span></span>: int(os.getenv(<span class="hljs-string"><span class="hljs-string">'POSTGRES_PORT'</span></span>)) } }</code> </pre><br><br>  Then run the project containers: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose up -d</code> </pre><br><br>  And make sure the positive result: <br><br><img src="https://habrastorage.org/files/1f0/ad8/dd3/1f0ad8dd3534418c882fcb0fcd9fab11.png" alt="Running project"><br><br>  To stop a project and delete temporary files you can use: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose stop &amp;&amp; docker-compose rm -f</code> </pre><br><br>  If we have something changing in requirements.txt, use the following command to quickly reassemble <br><br><pre> <code class="bash hljs">(docker) $ docker-compose stop &amp;&amp; docker-compose rm -f &amp;&amp; docker-compose build --no-cache project &amp;&amp; docker-compose up -d</code> </pre><br><br>  Let's check what structure of the project we have turned out: <br><br><img src="https://habrastorage.org/files/0d0/283/72d/0d028372d7954f7fb38aa097c36781c5.png" alt="Project structure"><br><br>  The root folder in my code contains the ready helpers of PyCharm. <br><br><h2>  We connect the container for the JS programmer </h2><br><br>  Now you can do something for which we started all this - connect Gulp to control the statics.  The docker-compose.yml file will now look like this: <br><br><pre> <code class="hljs javascript">... gulp: build: ./src/gulp command: bash -c <span class="hljs-string"><span class="hljs-string">"sleep 3 &amp;&amp; gulp"</span></span> volumes: - ./src/gulp:<span class="hljs-regexp"><span class="hljs-regexp">/app - ./</span></span>src/<span class="hljs-keyword"><span class="hljs-keyword">static</span></span>/scripts:<span class="hljs-regexp"><span class="hljs-regexp">/app/</span></span>build project: ... links: - postgresql - gulp ...</code> </pre><br><br>  I added a new container and added it in the dependencies to the project. <br><br>  Now I need to create a gulp folder in src for sources and static / scripts for compiled files.  In the src / gulp folder, create a package.json file with the following contents: <br><br><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"front"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"3.9.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"main"</span></span>: <span class="hljs-string"><span class="hljs-string">"gulpfile.js"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"scripts"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"test"</span></span>: <span class="hljs-string"><span class="hljs-string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span> }, <span class="hljs-attr"><span class="hljs-attr">"author"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-attr"><span class="hljs-attr">"license"</span></span>: <span class="hljs-string"><span class="hljs-string">"BSD-2-Clause"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"devDependencies"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"gulp"</span></span>: <span class="hljs-string"><span class="hljs-string">"~3.9.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gulp-uglify"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.4.2"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gulp-concat"</span></span>: <span class="hljs-string"><span class="hljs-string">"~2.6.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gulp-livereload"</span></span>: <span class="hljs-string"><span class="hljs-string">"~3.8.1"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gulp-jade"</span></span>: <span class="hljs-string"><span class="hljs-string">"~1.1.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"gulp-imagemin"</span></span>: <span class="hljs-string"><span class="hljs-string">"~2.3.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"tiny-lr"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.2.1"</span></span> } }</code> </pre><br><br>  Create gulpfile.js.  in the src / gulp folder.  I used my old sample file: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Created by werevolff on 18.10.15. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> gulp = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp'</span></span>), uglify = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-uglify'</span></span>), concat = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-concat'</span></span>), refresh = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'gulp-livereload'</span></span>), lr = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'tiny-lr'</span></span>), server = lr(); <span class="hljs-comment"><span class="hljs-comment">/** * Mainpage */</span></span> gulp.task(<span class="hljs-string"><span class="hljs-string">'mainpage'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.src([<span class="hljs-string"><span class="hljs-string">'./front/jquery/*.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'./front/bootstrap/*.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'./front/angularjs/angular.min.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'./front/angularjs/i18n/angular-locale_ru-ru.js'</span></span>, <span class="hljs-string"><span class="hljs-string">'./front/project/**/*.js'</span></span>]) .pipe(uglify()) .pipe(concat(<span class="hljs-string"><span class="hljs-string">'mainpage.js'</span></span>)) .pipe(gulp.dest(<span class="hljs-string"><span class="hljs-string">'./build'</span></span>)) .pipe(refresh(server)); }); <span class="hljs-comment"><span class="hljs-comment">/** * Rebuild JS files */</span></span> gulp.task(<span class="hljs-string"><span class="hljs-string">'lr-server'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ server.listen(<span class="hljs-number"><span class="hljs-number">35729</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(err); }); }); <span class="hljs-comment"><span class="hljs-comment">/** * Gulp Tasks */</span></span> gulp.task(<span class="hljs-string"><span class="hljs-string">'default'</span></span>, [<span class="hljs-string"><span class="hljs-string">'mainpage'</span></span>, <span class="hljs-string"><span class="hljs-string">'lr-server'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ gulp.watch(<span class="hljs-string"><span class="hljs-string">'./front/**/*.js'</span></span>, [<span class="hljs-string"><span class="hljs-string">'mainpage'</span></span>]); });</code> </pre><br><br>  As we see from the config, we should upload some popular libraries to the src / gulp / front folder and create the src / gulp / front / project folder for scripts written by JS.  Also, do not forget about creating a Dockerfile in src / gulp <br><br>  FROM neo9polska / nodejs-bower-gulp <br><br>  COPY package.json ./package.json <br>  COPY node_modules ./node_modules <br><br>  RUN npm install --verbose <br><br>  Now a rather important question is node_modules.  Without this folder, the container with Gulp will be frankly messed up.  Here we have two options for obtaining this folder: <br><br><ol><li>  Build the project on the local machine and transfer the folder with modules from it </li><li>  Remove everything from the Dockerfile that is below the FROM directive, docker-compose run --rm gulp npm install --verbose, and then change the permissions on the directory with node_modules and return what was below the FROM back. </li></ol><br><br>  However, changing the rights is not necessary.  Just developers will be forced to constantly execute the gulp rebuild command.  However, all the code described in the article, I will lay out on Github and you can take the node_modules from there.  This problem is related to docker-compose.  But defeating her is easy. <br><br>  So, as a result of the launch of containers <br><br><pre> <code class="bash hljs">(docker) $ docker-compose up -d</code> </pre><br><br>  We should get this compiled file: <br><br><img src="https://habrastorage.org/files/146/506/e33/146506e33667419ebc16890b4a91d230.png" alt="Container Result with Gulp">  . <br><br>  Done!  The project can be poured into git and start working with it. <br><br>  The complete restart command with rebuild looks like this: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose stop &amp;&amp; docker-compose rm -f &amp;&amp; docker-compose build --no-cache gulp &amp;&amp; docker-compose build --no-cache project &amp;&amp; docker-compose up -d</code> </pre><br><br>  To launch a project, a new participant in the process just needs to run: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose build --no-cache gulp &amp;&amp; docker-compose build --no-cache project &amp;&amp; docker-compose up -d</code> </pre><br><br>  To view the main log of the container running the application: <br><br><pre> <code class="bash hljs">(docker) $ docker-compose logs CONTAINER NAME</code> </pre><br><br>  The Django logs from the project are written to the src / logs folder. <br><br>  You can see the source code of the project in <a href="https://github.com/werevolff/habr-docker-article">my GitHub</a> . <br><br>  PS Another important aspect is setting up the python interpreter in PyCharm.  For this setting, just add the remote interpreter: <br><br><img src="https://habrastorage.org/files/909/72f/80c/90972f80c9e946079241a82b69c65fd9.png" alt="Setting up the runtime in PyCharm"><br><br>  And note that PyCharm has a plugin for integrating with Docker.  We use SSH connection, because we did not touch upon the issue of deploying the project to the docker-machine. </div><p>Source: <a href="https://habr.com/ru/post/272811/">https://habr.com/ru/post/272811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../272799/index.html">School of Data "Beeline", opening the curtain</a></li>
<li><a href="../272803/index.html">The general scheme of building algorithms on the example of the Rubik's Cube</a></li>
<li><a href="../272805/index.html">Non-standard approach to standard add-on development (Add-In) in C #</a></li>
<li><a href="../272807/index.html">Dynamic T-SQL and how it can be useful</a></li>
<li><a href="../272809/index.html">Microsoft Edge JavaScript engine source code will open in January</a></li>
<li><a href="../272813/index.html">"Taskbook" for ABBYY Compreno</a></li>
<li><a href="../272815/index.html">Magic beatboards and Russian checkers</a></li>
<li><a href="../272817/index.html">Create a simple Realtime chat.</a></li>
<li><a href="../272821/index.html">Marmalade C ++ and ShiVa3D: getting started with game engines for the Android x86 platform</a></li>
<li><a href="../272825/index.html">50 typical gaming camera design errors (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>