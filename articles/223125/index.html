<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automate toilet flush on Arduino + Z-Wave</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What can be common between these two objects? 



 Idea 
 Once I decided to teach a cat to the toilet, in order to get rid of the unpleasant smell ema...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automate toilet flush on Arduino + Z-Wave</h1><div class="post__text post__text-html js-mediator-article">  What can be common between these two objects? <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/64a/871/164/64a8711642917e73db54d773e3bb772f.jpg"></div><br><a name="habracut"></a><br><h3>  Idea </h3><br>  Once I decided to teach a cat to the toilet, in order to get rid of the unpleasant smell emanating from its tray.  But to teach him to walk is one thing, but to descend behind him is almost an impossible task.  Therefore, I decided to put it on the electronic shoulders, in the role of which is the Arduino Nano. <br><br>  The script was thought like this: <br>  Kote (the one on the first picture), through the mini-door at the bathroom door, gets inside, forcing the opening sensor to work, does its business as much as it pleases it, and exits.  After the second actuation of the sensor, the hood is activated, the water in the toilet bowl is lowered and the freshener is sprayed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Equipment and tests </h3><br>  <b>Towerpro MG996R</b> , Z-Wave <b>Fibaro FGS221 servo</b> and <a href="http://www.dx.com/p/143646">LED button</a> were connected to the board.  Added a button as a bonus parallel to the relay and brought it to the wall. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/473/2c9/136/4732c91364fd4fc52f613ed257f8461e.jpg"></div><br><br>  In fact, the servomotor is powered by BP 5V 2A.  From it is powered by USB. <br><br>  Connection diagram and code: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d00/90c/296/d0090c2966279fad3a5176870d5b4037.jpg"></div><br><div class="spoiler">  <b class="spoiler_title">Code for Arduino</b> <div class="spoiler_text"><pre><code class="actionscript hljs">#<span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> &lt;Servo.h&gt; //   Servo Servo flush;</span></span> <span class="hljs-comment"><span class="hljs-comment">//      const int buttonPin = 2; //    const int led = 4; //    int buttonState = 0; //      int flag = 0; //     unsigned long holdTime = 0; //    unsigned long blinkTime = 0; //    unsigned long loadTime = 0; //    void setup() { pinMode(led, OUTPUT); //      pinMode(buttonPin, INPUT); //      flush.attach(3, 8, 140); //     3   /  flush.write(8); //       } void loop(){ buttonState = digitalRead(buttonPin); //    if (buttonState == LOW &amp;&amp; flag == 0) { //         flush.write(8); //       digitalWrite(led, LOW); //   } if (buttonState == HIGH &amp;&amp; flag == 0) { //        delay(100); //      flush.write(140); //      flag = 1; //   holdTime = millis(); //     } if (buttonState == HIGH &amp;&amp; flag == 1 &amp;&amp; millis()-holdTime &gt; 200) { //      X  flag = 0; //   blinkTime = millis(); //     do { digitalWrite(led, LOW); //   delay(200); digitalWrite(led, HIGH); //   delay(200); } while (millis()-blinkTime &lt; 5000); //   X  flush.write(8); //       loadTime = millis(); //      do { digitalWrite(led, LOW); //   delay(200); digitalWrite(led, HIGH); //   delay(200); } while (millis()-loadTime &lt; 54000); //   X  (   ) } if (buttonState == LOW &amp;&amp; flag == 1 &amp;&amp; millis()-holdTime &lt;= 200) { //      X  flag = 0; //   blinkTime = millis(); //     do { digitalWrite(led, LOW); //   delay(200); digitalWrite(led, HIGH); //   delay(200); } while (millis()-blinkTime &lt; 2000); //   X  flush.write(8); //       loadTime = millis(); //      do { digitalWrite(led, LOW); //   delay(200); digitalWrite(led, HIGH); //   delay(200); } while (millis()-loadTime &lt; 30000); //   X  } }</span></span></code> </pre> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Video of the first version of the algorithm with Z-Wave</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/16D1wLP9RmA%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhiPddnjFoGV8XUVG2OIyTfCIEcswA" frameborder="0" allowfullscreen=""></iframe><br></div></div><br><div class="spoiler">  <b class="spoiler_title">This version differs from the final one only by the delay before the button can be pressed again.</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/7Noh4HXtXZc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhhYSlCtrz61nOAHII7C61sCpIH2PQ" frameborder="0" allowfullscreen=""></iframe><br><h6>  <i>The delay is equal to the period of complete recharge of the tank with water.</i> </h6><br></div></div><br><br><h3>  Implementation </h3><br>  Since the installation from Geberit was installed during the repair, connecting the traction was not a big deal.  The servomotor is installed between the tank and the aluminum profile, screwed and filled with hot glue.  As the traction cable was used with clips, which is passed through the hole in the tank.  Flexible traction was needed so as not to lose the possibility of water descending with a button on the tank. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b08/60c/bf9/b0860cbf983f48275d78bc1b5015ddc9.jpg"></div><br><br>  The electronic part is located in the junction boxes for the installation. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a2d/c1a/b74/a2dc1ab74decab6e272361d66d5da324.jpg"></div><br><br>  Manual control can be carried out either by a button or through an application for the Fibaro HomeCenter. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c2d/bb2/6fa/c2dbb26fac30e2eafe9537582af0ad1b.jpg"></div><br><br>  Two descent modes are used: <br><ol><li>  With a short press (&lt;200 ms) half the water goes down. </li><li>  If you hold the button for more than 200 ms, the tank is emptied entirely. </li></ol><br>  Z-Wave relay is configured for the second mode. <br><br><div class="spoiler">  <b class="spoiler_title">Demonstration of the device</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/d6vHt-aeDq4%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhiZE4ab4DhqFTBm_C0fWBIS1VxOpA" frameborder="0" allowfullscreen=""></iframe><br><h6>  <i>The delay is triggered by the fact that the application was working remotely through the fibaro server.</i> </h6><br></div></div><br><br><h3>  Conclusion </h3><br>  Unfortunately, the kote on the video will not be, as he moved out, and I have a desire to realize my plans. <br><br><div class="spoiler">  <b class="spoiler_title">Well, a bonus :)</b> <div class="spoiler_text"><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/DOP3bSlHajc%3Ffeature%3Doembed&amp;xid=17259,15700002,15700022,15700186,15700191,15700253&amp;usg=ALkJrhg__sIvDl2JQXFzH_lm1BLHLYQ1tQ" frameborder="0" allowfullscreen=""></iframe><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/223125/">https://habr.com/ru/post/223125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../223115/index.html">In defense of javascript: void (0);</a></li>
<li><a href="../223117/index.html">Skylock - wireless bicycle lock on solar batteries</a></li>
<li><a href="../223119/index.html">What to read on the weekend. Digest news of the gaming industry</a></li>
<li><a href="../223121/index.html">Analysis of implicit user preferences. Scientific and Technical Workshop in Yandex</a></li>
<li><a href="../223123/index.html">How to assemble a 3D printer in Russia and why I went to do it in China</a></li>
<li><a href="../223131/index.html">JetBrains EdTech Hackathon results</a></li>
<li><a href="../223133/index.html">MSI S12 Netbook Review</a></li>
<li><a href="../223135/index.html">The script that handles system events with DBus</a></li>
<li><a href="../223137/index.html">Free AngularJS course from Codeschool</a></li>
<li><a href="../223143/index.html">GalaPlugin - JS / QML plugin for QtCreator</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>