<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unification and search with return on C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a response to the article ‚ÄúThe Einstein Problem on the Prologue‚Äù . In it, the author writes that Prolog is very well suited for solvin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unification and search with return on C #</h1><div class="post__text post__text-html js-mediator-article">  This article is a response to the article <a href="http://habrahabr.ru/post/122142/">‚ÄúThe Einstein Problem on the Prologue‚Äù</a> .  In it, the author writes that Prolog is very well suited for solving this problem and that the total number of lines almost coincides with the conditions of the problem.  Here I want to show that in C # the number of lines of code can be about the same.  I'll just copy the solution on Prolog and change the syntax a bit.  First I will give the final result, and then I will write out the functions.  Here's what happened: <br><a name="habracut"></a><br><pre><code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IEnumerable&lt;bool&gt; Einstein(object houses) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-comment"><span class="hljs-comment">/* 0.  5  */</span></span> YP.unify(houses, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, _, _)) <span class="hljs-comment"><span class="hljs-comment">/* 1.     . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Nth1(<span class="hljs-number"><span class="hljs-number">1</span></span>, houses, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"norwegian"</span></span>, _, _, _, _))) <span class="hljs-comment"><span class="hljs-comment">/* 2.     . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"englishman"</span></span>, _, _, _, <span class="hljs-string"><span class="hljs-string">"red"</span></span>), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 3.      ,   . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Nextto(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, _, <span class="hljs-string"><span class="hljs-string">"green"</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, _, <span class="hljs-string"><span class="hljs-string">"white"</span></span>), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 4.   . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"dane"</span></span>, _, _, <span class="hljs-string"><span class="hljs-string">"tea"</span></span>, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 5. ,   Marlboro,    ,   . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Neighbors(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, <span class="hljs-string"><span class="hljs-string">"marlboro"</span></span>, _, _), <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, <span class="hljs-string"><span class="hljs-string">"cat"</span></span>, _, _, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 6. ,     ,  Dunhill. */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, <span class="hljs-string"><span class="hljs-string">"dunhill"</span></span>, _, <span class="hljs-string"><span class="hljs-string">"yellow"</span></span>), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 7.   Rothmans. */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"german"</span></span>, _, <span class="hljs-string"><span class="hljs-string">"rothmans"</span></span>, _, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 8. ,    ,  . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Nth1(<span class="hljs-number"><span class="hljs-number">3</span></span>, houses, <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, <span class="hljs-string"><span class="hljs-string">"milk"</span></span>, _))) <span class="hljs-comment"><span class="hljs-comment">/* 9.  ,   Marlboro,  . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Neighbors(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, <span class="hljs-string"><span class="hljs-string">"marlboro"</span></span>, _, _), <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, <span class="hljs-string"><span class="hljs-string">"water"</span></span>, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 10. ,   Pall Mall,  . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, <span class="hljs-string"><span class="hljs-string">"bird"</span></span>, <span class="hljs-string"><span class="hljs-string">"pallmall"</span></span>, _, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 11.   . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"swede"</span></span>, <span class="hljs-string"><span class="hljs-string">"dog"</span></span>, _, _, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 12.      . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Neighbors(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(<span class="hljs-string"><span class="hljs-string">"norwegian"</span></span>, _, _, _, _), <span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, _, <span class="hljs-string"><span class="hljs-string">"blue"</span></span>), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 13. ,   ,    . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, <span class="hljs-string"><span class="hljs-string">"horse"</span></span>, _, _, <span class="hljs-string"><span class="hljs-string">"blue"</span></span>), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 14. ,   Winfield,  . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, <span class="hljs-string"><span class="hljs-string">"winfield"</span></span>, <span class="hljs-string"><span class="hljs-string">"beer"</span></span>, _), houses)) <span class="hljs-comment"><span class="hljs-comment">/* 15.     . */</span></span> .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(<span class="hljs-keyword"><span class="hljs-keyword">List</span></span>(_, _, _, <span class="hljs-string"><span class="hljs-string">"coffee"</span></span>, <span class="hljs-string"><span class="hljs-string">"green"</span></span>), houses)); }</code> </pre> <br>  And the solution itself: <br><br><pre> <code class="hljs pgsql">var houses = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Variable(); var owner = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Variable(); Einstein(houses) //   ? .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(List(<span class="hljs-keyword"><span class="hljs-keyword">owner</span></span>, "fish", _, _, _), houses)) //   . .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(WriteLine(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">owner</span></span>)) //   . .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(WriteLine(() =&gt; houses)) .Count();</code> </pre><br>  The result of the program: <br><blockquote>  german <br>  ((norwegian, cat, dunhill, water, yellow), (dane, horse, marlboro, tea, blue), (englishman, bird, pallmall, milk, red), (german, fish, rothmans, coffee, green), ( swede, dog, winfield, beer, white)) <br></blockquote><br>  The number of lines of code is approximately the same as in the Prolog solution. <br><br>  What happens under the hood?  In this solution, I used the <a href="http://yieldprolog.sourceforge.net/">YieldProlog</a> library, which allows unification of parameters and search with return.  There does not occur any intermediate compilation of the Prolog program.  This is a fair decision in C #. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Parameter unification is performed using the function YP.unify (arg1, arg2).  This is the main function, one might say, the core of the entire solution.  The implementation is quite simple, but better than it is written in the documentation, I still will not write.  And the documentation itself is small.  Therefore, refer to it. <br><br>  The first line of the solution is the binding of the houses variable to the list of unrelated variables.  To set the lists, we will use a functor with five arguments, since in our problem all the lists consist of only five elements.  Here is the code for the List method: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">List</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">params</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] list</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Functor.make(<span class="hljs-string"><span class="hljs-string">""</span></span>, list); }</code> </pre><br>  Here Functor is a class from the YieldProlog library. <br><br>  Now, instead of the long entry Functor.make (new [] {new Variable (), new Variable (), ...}) I can use the shorter List (new Variable (), new Variable (), ...).  And to make the list look more elegantly added property: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> Variable _ { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Variable(); } }</code> </pre><br>  Then the list of unified variables will be written as: List (_, _, ...). <br><br>  Next, I will describe the predicates member (Elem, List), nth1 (N, List, Elem), nextto (X, Y, List) and neighbors (X, Y, List).  I specifically did not use the lists of the form [head |  tail], but I use ordinary arrays, since I have no task to repeat the description of these predicates in the same way as their description on the Prolog. <br><br>  member (Elem, List) will look like this: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Member</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elem, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> list</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.getFunctorArgs(list)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(elem, e)) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  Everything is very simple here.  In the loop we iterate over the elements of the list and unify each element with the element of the list. <br><br>  Design: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(elem, e)) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>;</code> </pre><br>  serves to unify two variables. <br><br>  nth1 (N, List, Elem) will turn into: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nth1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> n, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> list, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> elem</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.getFunctorArgs(list)) { i++; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(elem, e)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(i, n)) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } }</code> </pre><br>  Here we also iterate through each element of the list and for each element we unify it with the parameter elem.  If the parameter we already have is associated with some value and this value coincides with the value of some list item, then we unify the number of this item in the list with the parameter n. <br><br>  nextto (X, Y, List) we write this: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nextto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> list</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nativeList = YP.getFunctorArgs(list); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e1 = nativeList.FirstOrDefault(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> e2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> nativeList.Skip(<span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(x, e1)) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> l2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> YP.unify(y, e2)) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; e1 = e2; } }</code> </pre><br>  We are going over not one element at a time, but two at a time and unifying two adjacent elements of the list with the x and y parameters. <br><br>  neighbors (X, Y, List) are implemented in the same way as in the Prolog solution: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Neighbors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> list</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">var</span></span></span><span class="hljs-function"> l1 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nextto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, list</span></span></span><span class="hljs-function">)) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return </span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">false</span></span></span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">var</span></span></span><span class="hljs-function"> l1 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Nextto</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">y, x, list</span></span></span><span class="hljs-function">)) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return </span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">false</span></span></span></span>; }</code> </pre><br>  Using iterators is a very important part of the solution.  They just allow you to do a search with a return.  If the unification of the two variables is successful, the next iteration step occurs and the transition to the nested loop, if there is one.  If the unification is not successful, this loop is interrupted and the next iteration of the outer loop proceeds. <br><br>  In solving this problem, 15 predicates go in a row.  In YieldProlog, you have to write 15 nested loops for this: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">var</span></span></span><span class="hljs-function"> l1 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Pred1</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...</span></span></span><span class="hljs-function">)) </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foreach</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l2 </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Pred2(...</span></span></span><span class="hljs-function">)) ‚Ä¶ </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foreach</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">var</span></span></span></span><span class="hljs-function"><span class="hljs-params"> l15 </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">in</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Pred15(...</span></span></span><span class="hljs-function">)) </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">yield</span></span></span><span class="hljs-function"> return </span><span class="hljs-literal"><span class="hljs-function"><span class="hljs-literal">false</span></span></span></span>;</code> </pre><br>  This is inconvenient and ugly.  Therefore, we add an auxiliary method And, which builds chains of predicates: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">And</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; source, IEnumerable&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; inner</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> l1 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> source) <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> l2 <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> inner) <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br>  It's all.  You can call the Einstein function: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> houses = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Variable(); Einstein(houses);</code> </pre><br>  And, nothing happens.  That's because we simply built an iterator using yield, but did not create an iteration loop.  You can create it explicitly: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">var</span></span></span><span class="hljs-function"> l1 </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">in</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Einstein</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">houses</span></span></span><span class="hljs-function">)) Console.</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">houses</span></span></span><span class="hljs-function">)</span></span>;</code> </pre><br>  And you can simply call the Count method, which will go through the iterator and calculate the number of iterations. <br><br>  In addition, before starting our iterator, we can add new conditions to our solution: <br><br><pre> <code class="hljs pgsql">Einstein(houses) //   ? .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(Member(List(<span class="hljs-keyword"><span class="hljs-keyword">owner</span></span>, "fish", _, _, _), houses)) //   . .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(WriteLine(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">owner</span></span>)) //   . .<span class="hljs-keyword"><span class="hljs-keyword">And</span></span>(WriteLine(() =&gt; houses)) .Count();</code> </pre><br>  Auxiliary function WriteLine: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IEnumerable&lt;</span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function">&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">WriteLine</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Func&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; s</span></span></span><span class="hljs-function">)</span></span> { Console.WriteLine(s()); <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre><br><h4>  Instead of a resume </h4><br>  This article arose from the question of how logical tasks could be easily described in C #.  And here I brought one of the ways.  I had no goal to get the optimal solution in terms of performance or memory size.  There are libraries that allow you to write programs on the Prolog, compile them and connect as libraries to your project.  I also wanted to get a solution using built-in C # tools.  Searching on the Internet, I found the YieldProlog library, which solves this problem.  That is, I can describe logical tasks in my usual language using familiar syntax.  At the same time, I describe the problem in the same way as on Prolog.  Yes, and it is possible to use the types and features of C #.  Yes, and with the ability to optimize the solution as needed. <br><br>  If anyone is interested, then the program runs on my old AMD Turion 1.8 GHz laptop in 0.1 seconds. </div><p>Source: <a href="https://habr.com/ru/post/248847/">https://habr.com/ru/post/248847/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248837/index.html">How to implement almost instant site switching between sites, when one fell</a></li>
<li><a href="../248839/index.html">Development of software for laser thickness on FriendlyARM Smart210</a></li>
<li><a href="../248841/index.html">What I wanted to know at the beginning of my development career. Part 1</a></li>
<li><a href="../248843/index.html">How to encrypt and hide a hard disk partition using CyberSafe</a></li>
<li><a href="../248845/index.html">PostgreSQL vs MySQL</a></li>
<li><a href="../248851/index.html">Bitcoin and previously created anonymous electronic money systems</a></li>
<li><a href="../248853/index.html">Dual ETL project or how we built Disaster Recovery for Greenplum</a></li>
<li><a href="../248855/index.html">Overview of updates to the Microsoft Azure platform in January</a></li>
<li><a href="../248857/index.html">Go main advantage</a></li>
<li><a href="../248863/index.html">Clustering: tell me what you buy and I will tell you who you are</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>