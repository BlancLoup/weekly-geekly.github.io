<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using GATT in Bluetooth LE on Intel Edison</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Intel Edison is able to become the brain of any device from the Internet of Things Army. The brain is able to process information, but in order to rec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using GATT in Bluetooth LE on Intel Edison</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/intel/blog/267763/"><img src="https://habrastorage.org/files/2cf/8f0/f10/2cf8f0f10b70445c8dd183f26815009b.png" align="left" height="165"></a>  Intel Edison is able to become the brain of any device from the Internet of Things Army.  The brain is able to process information, but in order to receive it, it needs sense organs.  For example, how can Edison find out if it‚Äôs hot or cold in a room right now?  The answer is simple - using a temperature sensor. <br><br>  From this material, you will learn how to use the Generic Attribute Profile (GATT) profile when organizing Intel Edison to interact with Texas Instruments SensorTag via the Bluetooth Low Energy protocol. <br><a name="habracut"></a><br><h2>  <font color="#0071c5">Before we start</font> </h2><br>  In order for you to be able to use this guide in practice, you will need an assembled Intel Edison board, the firmware of which has been updated to the latest version.  A connection should be established between the board and the computer, which emulates a serial connection (serial) port, and the device must also have access to the Internet via Wi-Fi.  If you need help preparing your board, refer to the <a href="https://software.intel.com/en-us/iot/library/edison-getting-started">Intel Edison Getting Started Guides</a> . <br><br><h2>  <font color="#0071c5">Install gatttool</font> </h2><br>  Texas Instruments SensorTag, like many other Bluetooth devices, supports GATT for communicating with computers, smartphones, tablets.  Gatttool is a standard set of software tools that is included with the BlueZ package.  It is, however, not installed by default on Intel Edison.  In order to fix this, you need to connect to Intel Edison through a terminal emulator, and then download and compile BlueZ using the following commands: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="hljs perl">root@edison: cd ~ root@edison: wget https:<span class="hljs-regexp"><span class="hljs-regexp">//www</span></span>.kernel.org/pub/linux/bluetooth/bluez-<span class="hljs-number"><span class="hljs-number">5.24</span></span>.tar.xz ‚Äì<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-check-certificate root@edison: tar -xf bluez-<span class="hljs-number"><span class="hljs-number">5.24</span></span>.tar.xz root@edison: cd bluez-<span class="hljs-number"><span class="hljs-number">5.24</span></span> root@edison: ./configure --disable-systemd ‚Äìdisable-udev root@edison: make root@edison: make install</code> </pre> <br>  In order for gatttool to be run from anywhere, modify the PATH variable: <br><br><pre> <code class="hljs ruby">root@edison: export PATH=$PATH<span class="hljs-symbol"><span class="hljs-symbol">:~/bluez-</span></span><span class="hljs-number"><span class="hljs-number">5.24</span></span>/attrib/</code> </pre> <br><h2>  <font color="#0071c5">Scanning the air and detecting BLE-devices using bluetoothctl</font> </h2><br>  1. Turn on Bluetooth on Intel Edison. <br><br><pre> <code class="hljs scala">root<span class="hljs-meta"><span class="hljs-meta">@edison</span></span>: rfkill unblock bluetooth</code> </pre> <br>  2. Run the bluetoothctl <br><br><pre> <code class="hljs scala">root<span class="hljs-meta"><span class="hljs-meta">@edison</span></span>: bluetoothctl</code> </pre> <br>  3. We register the agent and set it to the default state. <br><br><pre> <code class="hljs css"><span class="hljs-selector-attr"><span class="hljs-selector-attr">[bluetooth]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">agent</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">KeyboardDisplay</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[bluetooth]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">default-agent</span></span> <span class="hljs-selector-attr"><span class="hljs-selector-attr">[bluetooth]</span></span># <span class="hljs-selector-tag"><span class="hljs-selector-tag">scan</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">on</span></span></code> </pre> <br>  4. If SensorTag cannot be found, click the pairing button with other devices on it.  After finding the MAC address of the SensorTag, you can turn off the scan mode and exit the bluetoothctl session. <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">bluetooth</span></span>]<span class="hljs-meta"><span class="hljs-meta"># scan off [bluetooth]# quit</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/bf5/fa1/692/bf5fa1692150fe8975e7baeaaea68c1d.png"><br>  <em><font color="#999999">The dedicated MAC address of the SensorTag found during a search for Bluetooth devices.</font></em> <br><br><h2>  <font color="#0071c5">Use gatttool to read sensor readings</font> </h2><br>  Now we can use gatttool to read the sensor with SensorTag. <br><br>  1. Run gatttool online using the MAC address found in the previous step. <br><br><pre> <code class="hljs ruby">root@edison: gatttool -b <span class="hljs-number"><span class="hljs-number">34</span></span><span class="hljs-symbol"><span class="hljs-symbol">:B1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:F7</span></span><span class="hljs-symbol"><span class="hljs-symbol">:D5</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">38</span></span> ‚ÄìI</code> </pre> <br>  2. Connect to the device and turn on the temperature sensor by writing 01 to the settings identifier (configure handle) 0x29.  After that, read the temperature readings from the identifier 0x25. <br><br><pre> <code class="hljs markdown">[<span class="hljs-string"><span class="hljs-string">34:B1:F7:D5:15:38</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">LE</span></span>]&gt; connect [<span class="hljs-string"><span class="hljs-string">34:B1:F7:D5:15:38</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">LE</span></span>]&gt; char-write-cmd 0x29 01 [<span class="hljs-string"><span class="hljs-string">34:B1:F7:D5:15:38</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">LE</span></span>]&gt; char-read-hnd 0x25</code> </pre> <br>  The identifier code required to access the temperature sensor is taken from the <a href="http://processors.wiki.ti.com/images/a/a8/BLE_SensorTag_GATT_Server.pdf">SensorTag attribute table</a> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1e6/5b9/ff4/1e65b9ff491082c09caf9715ad138920.png"><br>  <em><font color="#999999">Sensor reads from SensorTag</font></em> <br><br>  The temperature sensor readings look like two 16-bit unsigned numbers.  In order to convert this data to the usual form, they must be processed using a script that implements the conversion algorithm described in <a href="http://processors.wiki.ti.com/index.php/SensorTag_User_Guide">the knowledge base on SensorTag</a> . <br><br><h2>  <font color="#0071c5">Using Python to interpret sensor readings</font> </h2><br>  1. In order to interpret sensor readings, you can use a script written in the Python programming language and using the pexpect module.  As an example, take <a href="https://github.com/msaunby/ble-sensor-pi/blob/master/sensortag/sensortag_test.py">this script</a> and apply it to read temperature readings with SensorTag. <br><br><pre> <code class="hljs perl">root@edison: wget https:<span class="hljs-regexp"><span class="hljs-regexp">//github</span></span>.com/msaunby/ble-sensor- pi/archive/master.zip -‚Äì<span class="hljs-keyword"><span class="hljs-keyword">no</span></span>-check-certificate root@edison: unzip master.zip root@edison: cd /ble-sensor-pi-master/sensortag</code> </pre> <br>  2. Open the sensortag_test.py script with vi. <br><br><pre> <code class="hljs scala">root<span class="hljs-meta"><span class="hljs-meta">@edison</span></span>: vi ./sensortag_test.py</code> </pre> <br>  3. We make changes to line 62. Namely, this code: <br><br><pre> <code class="hljs kotlin">tool.<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span>(<span class="hljs-string"><span class="hljs-string">'\[CON\].*&gt;'</span></span>)</code> </pre> <br>  replace it with this: <br><br><pre> <code class="hljs kotlin">tool.<span class="hljs-keyword"><span class="hljs-keyword">expect</span></span>(<span class="hljs-string"><span class="hljs-string">'Connection successful'</span></span>)</code> </pre> <br>  4. After making the changes, save them and exit by pressing Escape and entering the following command: <br><br><pre> <code class="hljs css"><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:wq</span></span></code> </pre> <br><h2>  <font color="#0071c5">Installing pip and necessary Python modules</font> </h2><br>  To run a python script using pexpect, the latter must be installed.  The easiest way to do this is with Pip.  Pip is not installed on Intel Edison by default, it is not in the official opkg repository.  However, Pip can be found in the unofficial Intel Edison repository compiled by Michael Hirsch.  The following instructions are based on his <a href="http://blogs.bu.edu/mhirsch/2014/11/getting-started-with-intel-edison/">guide</a> on using the informal repository. <br><br>  1. Edit the base-feeds.conf file with vi. <br><br><pre> <code class="hljs cs">root@edison: vi /etc/opkg/<span class="hljs-keyword"><span class="hljs-keyword">base</span></span>-feeds.conf</code> </pre> <br>  2. We introduce the following: <br><br><pre> <code class="hljs ruby">src/gz all <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/repo.opkg.net/edison</span></span><span class="hljs-regexp"><span class="hljs-regexp">/repo/all</span></span> src/gz edison <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/repo.opkg.net/edison</span></span><span class="hljs-regexp"><span class="hljs-regexp">/repo/edison</span></span> src/gz core2-<span class="hljs-number"><span class="hljs-number">32</span></span> <span class="hljs-symbol"><span class="hljs-symbol">http:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/repo.opkg.net/edison</span></span><span class="hljs-regexp"><span class="hljs-regexp">/repo/core</span></span>2-<span class="hljs-number"><span class="hljs-number">32</span></span>&lt;source&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>.  Escape  : &lt;source&gt;<span class="hljs-symbol"><span class="hljs-symbol">:wq</span></span></code> </pre> <br>  4. Update opkg and install Python. <br><br><pre> <code class="hljs mel">root@edison: opkg update root@edison: opkg install <span class="hljs-keyword"><span class="hljs-keyword">python</span></span>-pip</code> </pre> <br>  Install the Pip setup tools (setup tools): <br><br><pre> <code class="hljs ruby">root@edison: wget <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/bitbucket.org/pypa</span></span><span class="hljs-regexp"><span class="hljs-regexp">/setuptools/raw</span></span><span class="hljs-regexp"><span class="hljs-regexp">/bootstrap/ez</span></span>_setup.py -‚Äìno-check-certificate -O - <span class="hljs-params"><span class="hljs-params">| python&gt;</span></span></code> </pre> <br><h2>  <font color="#0071c5">Run a python script and read temperature readings</font> </h2><br>  Now everything is ready to run a script that reads the temperature sensor readings.  To do this, go to the directory / ble-sensor-pi-master / sensortag and execute the following command: <br><br><pre> <code class="hljs ruby">root@edison: ./sensortag_test.py <span class="hljs-number"><span class="hljs-number">34</span></span><span class="hljs-symbol"><span class="hljs-symbol">:B1</span></span><span class="hljs-symbol"><span class="hljs-symbol">:F7</span></span><span class="hljs-symbol"><span class="hljs-symbol">:D5</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">38</span></span></code> </pre> <br><img src="https://lh6.googleusercontent.com/mm8vVQHs6HswRz76utUCfILa8O6o7oiV1Tev8lPfsru_GbFXPk6VnFFf9Lh_FNoyXhcX5troA1Tljd-0EQX8j9ke4gqZ0uMIvEYSNJHbtUIeXG4k2zu_Kcw6CswiGH8_JLKe963P-l5RwWFA"><br>  <em><font color="#999999">Reading temperature sensor readings using a python script</font></em> <br><br><h2>  <font color="#0071c5">Results</font> </h2><br>  Now you know how Intel Edison can receive and process temperature data from an external sensor connected via Bluetooth LE.  A similar principle can be used, firstly, in order to connect other Bluetooth devices to Edison, and secondly, to collect readings from other TI SensorTag sensors.  Successful experiments! </div><p>Source: <a href="https://habr.com/ru/post/267763/">https://habr.com/ru/post/267763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267745/index.html">Facebook introduces encryption for Internet.org</a></li>
<li><a href="../267747/index.html">What we should build a plant: EMC solutions for industrial facilities</a></li>
<li><a href="../267749/index.html">Transformation approach Zachman</a></li>
<li><a href="../267751/index.html">Life hacking for web developer</a></li>
<li><a href="../267761/index.html">Victory Roll Girl tutorial</a></li>
<li><a href="../267765/index.html">Vim FileStyle Update</a></li>
<li><a href="../267767/index.html">DropBox distributes place to students / teachers 2</a></li>
<li><a href="../267769/index.html">Attach files to comments</a></li>
<li><a href="../267771/index.html">Nothing is easier than calling a function; I myself have done this repeatedly.</a></li>
<li><a href="../267773/index.html">Modification of the system call. Part 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>