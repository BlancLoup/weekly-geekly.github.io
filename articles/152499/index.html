<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ancestor override (dirty hack)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="UPD: It‚Äôs better to avoid this of course. All this is scary, terrible, and it stinks. But it stinks a little less than VQMOD, and if you already have ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ancestor override (dirty hack)</h1><div class="post__text post__text-html js-mediator-article">  <b>UPD:</b> It‚Äôs better to avoid this of course.  All this is scary, terrible, and it stinks.  But it stinks a little less than VQMOD, and if you already have to patch ‚Äúlive‚Äù and updated, but terrible legacy, then this approach has the right to exist.  But NEVER do so in projects that you are just starting or can change the architecture to a more extensible.  I leave the article as it is.  "In memory". <br><br><hr><br><br>  Sometimes you really want to override the behavior of the parent class, without changing its code. <br>  For example, change the storage location of templates from files in the database ... or add caching. <br>  or replace in ORM deletion of records by marking them as deleted. <br>  You never know, we may wish to change. <br>  If every programmer will go into the core of the framework or just into someone else's code, it will be porridge. <br>  This task has many solutions.  I want to offer the one I like the most. <br>  The solution is based on <b>__autoload ()</b> or rather on spl_autoload_register. <br><a name="habracut"></a><br>  Most implementations of this task imply a significant amount of special code that is present in our classes ‚Äújust in case‚Äù (as is done, for example, in an extension using a hook. It often happens that the developer has provided redefinition options wherever possible ... except for that place which we need. <br>  Other solutions require substantial processing of the logic of the system, which often makes it difficult to understand and raises the threshold of entry.  (for example, different variations on the event model). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I want everything to be simple, and at the same time as flexible as possible. <br>  And such a solution was found: <br><br><h4>  In general, the idea is simple as sneakers: </h4><br>  If we cannot redefine the behavior of already declared classes, then we can control the process of declaring these classes themselves.  For class loading, we are responsible for the <b>__autoload ()</b> function. <br>  Thus, if the class whose behavior we want to change is called via <b>__autoload ()</b> , then by changing the behavior of __autoload () we can load the desired class from another file. <br>  Actually, in one project, I implemented a mechanism for redefining the __autoload () behavior on the hook principle: <br>  An application module could declare its function to load classes and register it in a certain way for execution both BEFORE the main function and after. <br>  But we will not dwell on this implementation, because. <br><br><h4>  This is all in the past! </h4><br>  Finally, the time came when php 5.3 became available on most hosting sites, and there was no need to ensure compatibility with older branches. <br>  But in 5.3, the <b>SPL</b> module is part of the kernel, and is available by default. <br>  It turns out that the developers have already implemented this idea as a function spl_autoload_register. <br>  The <b>spl_autoload_register</b> function simply registers our autoload function <b>onto a</b> stack of similar functions. <br>  So  if we write a function that loads the modified class <b>BEFORE</b> loading the main function, then our code will be loaded and not the standard one.  On the other hand, if we want to add some variants of code autogeneration, then we can add them <b>AFTER the</b> main code. <br><br><h4>  Enough theory </h4><br>  Obviously, all redefined classes should be loaded via autoload and not directly. <br><br>  Since this is a rather dirty method, and such a solution can greatly complicate code reading and debugging, it is <b>absolutely not recommended</b> to place such calls in the application code.  All such hooks should <b>be in the same place</b> , in plain sight.  If you are a system architect, then you should ensure that all programmers know where to add such functions and where to look for them.  And also that they were at least aware that the system provides such an opportunity. <br><br>  When designing it is useful to think about which of our classes can be redefined. <br>  Sometimes this thought can push us to transfer some methods or properties to another class. <br>  Personally, I create two classes for frequently replaced classes - a class with an implementation, and a dummy class that only inherits from a class with an implementation.  The application uses a dummy.  You can easily override the dummy, and calmly inherit the standard functionality where we do not change anything. <br><br><h4>  Example </h4><br>  common.php file containing all common code: <br><pre><code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start_module</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      ....   common.php    index.php } function mainAutoload($class) { //    $filename = './class/'.$class.'.php'; if(file_exists()) require_once($filename); }</span></span></code> </pre> <br>  By default, the index.php file contains: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'common.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// //     spl_autoload_register('mainAutoload'); // //      start_module();</span></span></code> </pre><br><br>  Suppose we decided that in our project there will be many who want to override the class <b>soul</b> <br>  Then we create a class soul.php: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">soul</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">soul_basic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//   . }</span></span></code> </pre><br><br>  And accordingly soul_basic.php <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">soul_basic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">good</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       } public function evil() { //    } public function saintliness() { //    } public function business() { //    } }</span></span></code> </pre><br><br>  Well, already specific objects that will need a ‚Äúsoul‚Äù can implement or inherit from the <b>soul</b> not from the <b>soul_basic</b> , and have the functionality implemented in the soul_basic. <br><br>  Now imagine that we want to change the behavior of all "souls". <br>  Obviously, redefining the properties of the "soul" of a programmer or director or any other class that inherits from soul will not help us in this.  Therefore, we create our own soul class.  To do this, we modify the index.php file, for example: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> <span class="hljs-string"><span class="hljs-string">'common.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// //    . function century21Autoload($class) { if($class = 'soul') require_once('soul21.php'); } // //    spl_autoload_register('century21Autoload'); //     spl_autoload_register('mainAutoload'); // //      start_module();</span></span></code> </pre><br><br>  Well, respectively, soul21.php: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">soul</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">soul_basic</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">good</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(rand(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>)&gt;=<span class="hljs-number"><span class="hljs-number">80</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::good(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::evil(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">saintliness</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;unit_name == <span class="hljs-string"><span class="hljs-string">'Gundyaev'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::bussiness(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::saintliness(); } }</code> </pre><br><br>  <b>PS:</b> I am a believer and do not laugh at the church.  I just separate the church as faith and the church as a business.  And I don‚Äôt consider laughing from a business a sin.  Although my friends and fellow priests from different denominations disagree with me ... </div><p>Source: <a href="https://habr.com/ru/post/152499/">https://habr.com/ru/post/152499/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152485/index.html">Digsby is now in Open Source, available on GitHub</a></li>
<li><a href="../152491/index.html">FPGA is simple or do it yourself</a></li>
<li><a href="../152493/index.html">In the German parliament laptops were banned, the deputy of the Pirate Party came with a typewriter</a></li>
<li><a href="../152495/index.html">edX / MITx: Introduction to Computer Science and Programming</a></li>
<li><a href="../152497/index.html">Ask an iTunes Specialist</a></li>
<li><a href="../152501/index.html">About Unity 3D first-hand. Interview</a></li>
<li><a href="../152503/index.html">The evolution of the school computer. Part two, modern</a></li>
<li><a href="../152505/index.html">Technical Interview Strategy</a></li>
<li><a href="../152509/index.html">Following malware, Punto (Yandex) also decided to break the interface.</a></li>
<li><a href="../152511/index.html">Bundle news about fonts with Russian letters on Google Web Fonts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>