<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make a web service for converting Excel, Word, TXT and other files to PDF in the "as I see" mode</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Where did the stupid habit of keeping accounts, accounting and financial documents in MS Excel format come from? Why store and transfer documents inte...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make a web service for converting Excel, Word, TXT and other files to PDF in the "as I see" mode</h1><div class="post__text post__text-html js-mediator-article">  Where did the stupid habit of keeping accounts, accounting and financial documents in MS Excel format come from?  Why store and transfer documents intended for printing in spreadsheet format, if there is a special PDF format?  However, in all accounting programs, documents are first of all necessarily exported to MS Excel and only then alternative ways of storing documents are proposed.  The problem arose from here: let the accountant save his documents as he wants, but the client must receive them in PDF format and be sure to accurately in the image that the accountant piled in the MS Excel template. <br>  As an accounting program, we used a free <a href="http://www.v-sort.ru/vsbuxgalteriya.php">Aircraft: Accounting</a> .  (To tell the truth, from this program you can immediately save documents to PDF, but once told excel, it means excel.) <br>  The accountant uploads the XLS file to a specific directory on the disk, from where we have to pick it up, transfer it to PDF and save it to another directory.  All this should be implemented as a web service, that is, the client should see and be able to download their pdf documents in the ‚ÄúPersonal Account‚Äù on the site. <br><br><h5>  Solutions: </h5><br>  The first thing I wanted to do was to find a ready-made library for PHP or Perl and convert files directly on the fly. <br>  Such libraries for working with the Excel format were really found, for example: PHPExcel, PHPExcelReader, Spreadsheet :: ParseExcel, etc. <br>  These libraries work really well, but they do exactly what they are meant for: search for data in an Excel spreadsheet and operate on it. <br>  We also need a completely different thing - to get an Excel table in the form as for printing, with all the pictures with stamps and captions, with font formats, and cells. <br><br>  The second solution is a virtual printer.  Its essence is that we open the file in a suitable program and send it to print, but not to a real printer, but to a virtual one, which instead of paper will be saved to a file, first in a ps format postscript, and then make a PDF file out of it. <br>  Since the system should also function as a web service, I chose Linux with Apache as the platform.  And as a program that can open all MS Office files - free <a href="http://www.openoffice.org/">OpenOffice.org 3.4</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  So, what we do: </h5><br>  Install OpenOffice.  In the installation guide for the <a href="http://www.oooninja.com/2008/02/batch-command-line-file-conversion-with.html">PyODConverter</a> converter, you are <a href="http://www.oooninja.com/2008/02/batch-command-line-file-conversion-with.html">prompted</a> to install the version of OpenOffice.org 2.4 necessarily-headless, but I just installed OpenOffice.org 3.4 from the repository and everything worked out. <br>  After installation, I tried to run the program, but the system refused, even if I wanted the Java Runtime Environment.  Does he need one?  It turned out not.  And running OpenOffice entirely to send a file to a virtual printer is completely useless.  The program has an excellent converter to pdf, which is easy to call from the command line. <br><br>  This is done like this: <br><br><a name="habracut"></a><br><br><h5>  Create a converter to PDF </h5><br><br>  Create a bash file, for example with the name <b>converter.sh</b> <br><br><pre> &lt;code&gt;

 &lt;source lang = "bash"&gt;
 #! / bin / bash

 # Check where OpenOffice.org and PYTHON are installed. 
 # Correct the paths manually if they are different on your system

 OOFFICE = `ls /usr/bin/openoffice.org3 / usr / bin / ooffice / usr / lib / openoffice / program / soffice |  head -n 1`
 OOOPYTHON = `ls /opt/openoffice.org * / program / python / usr / bin / python |  head -n 1`

 if [!  -x "$ OOFFICE"]
 then
  echo "Could not auto-detect OpenOffice.org binary"
  exit
 fi

 if [!  -x "$ OOOPYTHON"]
 then
  echo "Could not auto-detect OpenOffice.org Python"
  exit
 fi

 echo "Detected OpenOffice.org binary: $ OOFFICE"
 echo "Detected OpenOffice.org python: $ OOOPYTHON"

 # Reference: http://wiki.services.openoffice.org/wiki/Using_Python_on_Linux
 # If you use the OpenOffice.org that comes with Fedora or Ubuntu, uncomment the following line:
 # export PYTHONPATH = "/ usr / lib / openoffice.org / program" 

 # If you want to simulate for testing, there is no X server, uncomment the next line.
 #unset DISPLAY

 # Kill any running OpenOffice.org processes.
 killall -u `whoami` -q soffice

 # This is an important line: the program is trying to download a Python script from the network, which is just 
 # need OpenOffice to convert files.  If everything is good, then after running converter.sh 
 A # directory will appear with a file called DocumentConverter.py. 
 # If it didn't work out, download the DocumentConverter.py file. 
 # manually at the address below and put in the same directory with this script.
 # Check that the port in the script was specified 8100
 test -f DocumentConverter.py ||  wget http://www.artofsolving.com/files/DocumentConverter.py

 # Start OpenOffice.org in listening mode on TCP port 8100.
 $ OOFFICE "-accept = socket, host = localhost, port = 8100; urp; StarOffice.ServiceManager" -norestore -nofirststartwizard -nologo -headless &amp;

 # Wait for a few seconds.
 sleep 5s

 # Here we list the names of the files we want to convert: 
 # The name of the source file - in which file we convert. 
 # The most pleasant thing is that you can convert not only to PDF, but also to any format, 
 # supported by OpenOffice.org
 # 
 # From MS PowerPoint to Flash
 $ OOOPYTHON DocumentConverter.py sample.ppt sample.swf

 # From Excel to PDF
 $ OOOPYTHON DocumentConverter.py sample.xls sample.pdf

 # Close OpenOffice.org.
 killall -u `whoami` soffice

 # ------------------------------------------------- --- 

 &lt;/ source&gt;
 &lt;/ code&gt;
</pre><br><br>  Set permissions to run the script converter.sh (755) <br>  Place the Excel file named sample.xls in the same directory with this script (converter.sh), run the converter.sh script and the file sample.pdf will appear in the directory, which will be a copy of the printed Excel file. <br><br>  Half done.  Now we need to organize the conversion process as a web service. <br>  You can, of course, place the converter.sh file in the / cgi-bin / Apache directory and run it right away, but the security tasks start here.  We need to approach the issue of security of this service very carefully, because we are going to transfer unknown files to the script and allow it to save what is unknown on the disk. <br>  The correct approach is to place the converter.sh file above DOCUMENT_ROOT Apache, and access it through an intermediary script, for example, on perl, which will be located in the / cgi-bin / directory and carefully check all parameters passed to converter.sh. <br><br>  What problems were found after the implementation of the conversion service. <br>  It turned out that Linux does not understand files with the names of Russian letters in the windows-1251 encoding.  What can be done here: <br>  1. To persuade the accountant to save files with Latin names (difficult) <br>  2. Convert the file name to utf-8 when loading into a directory (quite real) <br>  3. Implement a similar service under Windows - Apache (try) <br><br><h5>  Under Windows, the converter was also easy to implement. </h5><br>  I did this: <br>  1. Download and install <a href="http://www.openoffice.org/download/index.html">LibreOffice 3.4</a> <br>  2. Download <a href="http://www.artofsolving.com/opensource/pyodconverter">PyODConverter</a> <br>  3. Saved the DocumentConverter.py file in the working directory, for example, C: \ test \ <br>  4. Changed the DEFAULT_OPENOFFICE_PORT = 8100 constant in the DocumentConverter.py file (by default there was a different port specified) <br>  5. Put into the directory C: \ test \ a test file for conversion - test.xls <br><br>  Now we start the conversion process. <br>  First, we run OpenOffice in stealth mode.  In the command line (cmd) we write: <br><br> <code>"C:\Program Files\LibreOffice.org 3.4\program\soffice.exe" -headless -nologo -norestore -accept=socket,host=localhost,port=8100;urp;StarOffice.ServiceManager</code> <br> <br>  Here it is important that the port matches DEFAULT_OPENOFFICE_PORT <br><br>  Now we run the conversion: <br> <code>"C:\Program Files\LibreOffice.org 3.4\program\python" c:\test\DocumentConverter.py c:\test\test.xls c:\test\test.pdf</code> <br> <br>  And in the c: \ test \ directory, we find the converted PDF file. <br><br>  So the xls, doc, docx, rtf, txt, odt, ott, sxw, stw, html, xml file converter is ready, in general, everything that OpenOffice will open. </div><p>Source: <a href="https://habr.com/ru/post/148800/">https://habr.com/ru/post/148800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../148792/index.html">Firefox blocked the Ubisoft Uplay extension</a></li>
<li><a href="../148793/index.html">Batteries, wind turbine and geo-probe: an experiment to obtain "green" energy in different parts of the Russian Federation</a></li>
<li><a href="../148795/index.html">Habrakamp</a></li>
<li><a href="../148796/index.html">9gag received almost $ 3 million investment</a></li>
<li><a href="../148798/index.html">VMA - smart flash memory for database</a></li>
<li><a href="../148801/index.html">Peak Android passed? Google‚Äôs share of the US market has decreased by 5%</a></li>
<li><a href="../148804/index.html">We invite you on August 9 and 10 to Kiev for a free seminar on ITIL</a></li>
<li><a href="../148805/index.html">Two approaches to software design for embedded</a></li>
<li><a href="../148806/index.html">The most important motivation</a></li>
<li><a href="../148808/index.html">The stock hackers again came "breaking" ...</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>