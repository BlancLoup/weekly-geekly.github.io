<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Effective way to load a large number of points (geometries) on the map</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 


 Today I will tell you how you can efficiently download a large number of points on the map (web or in mobile applications). 
 Quick dive...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Effective way to load a large number of points (geometries) on the map</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr. </p><br><p>  Today I will tell you how you can efficiently download a large number of points on the map (web or in mobile applications). </p><a name="habracut"></a><br><h3 id="quick-dive">  Quick dive </h3><br><p>  From the point of view of most modern mapping solutions, several basic approaches to drawing a map can be distinguished: </p><br><ul><li>  raster (static files - pictures with tiles stored on a CDN and having their own TTL) </li><li>  vector </li></ul><br><p>  Here you need to make a remark, a tile, for those who are not vkurse, this is a special block grid (along with tiles, static images are also called), which is characterized by three coordinates (z - zoom, x, y), at each level the number of tiles <math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mn>2</mn><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>(</mo><mn>2</mn><mtext>&amp;#xA0;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>z</mi><mi>o</mi><mi>o</mi><mi>m</mi><mo stretchy=&quot;false&quot;>)</mo></mrow></msup></math>" role="presentation"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="12.025ex" height="2.539ex" viewBox="0 -987.6 5177.3 1093.4" role="img" focusable="false" style="vertical-align: -0.246ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMAIN-32" x="0" y="0"></use><g transform="translate(500,393)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMAIN-28" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMAIN-32" x="389" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-74" x="1243" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-69" x="1605" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-6D" x="1950" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-65" x="2829" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-73" x="3295" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-7A" x="3765" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-6F" x="4233" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-6F" x="4719" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMATHI-6D" x="5204" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/352330/&amp;xid=17259,15700023,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgzX24woGac7vLpi3BZq__B3GN-7g#MJMAIN-29" x="6083" y="0"></use></g></g></svg><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mn>2</mn><mtext>&nbsp;</mtext><mi>t</mi><mi>i</mi><mi>m</mi><mi>e</mi><mi>s</mi><mi>z</mi><mi>o</mi><mi>o</mi><mi>m</mi><mo stretchy="false">)</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-1"> 2 ^ {(2 \ times zoom)} </script></p><br><p>  The most interesting today is the vector format. </p><br><p>  Why?  Actually, you need to start with the problems associated with the raster format: </p><br><ul><li>  Discrete zoom levels (from 0 to 20 in most cases) </li><li>  Hard binding of style and data on tile layers </li><li>  Classic raster flaws </li></ul><br><p>  What perspectives does the vector format offer?  Actually, there are several: </p><br><ul><li>  The zoom is not clearly associated with tiles on a certain layer, but may change with any accuracy and smoothness. </li><li>  Since it is often the client (without considering the option of intermediate rendering) that renders the map, it is he who determines what data and in what style he wants to draw </li><li>  Excellent quality regardless of resolution, etc., which in general is a classic vector advantage over raster </li></ul><br><p>  Actually, everything with a vector format is good, but there are also disadvantages.  At a minimum, the vector format is more difficult to cache, it is not as obvious as in most cases with a raster format, where enough pre-generated tiles are folded onto a CDN, set up TTL and regeneration and no longer think about it. </p><br><p>  In general, it is possible to talk about this for a very long time, my task was to give a brief description of the actual work mechanisms, now we can proceed to the topic of the post. </p><br><h3 id="reshenie">  Decision </h3><br><p>  Actually, in terms of possible solutions, there are several approaches that have different support among the ready-made libraries (services): </p><br><ol><li><p>  Download the whole GeoJSON and render it (most fall off on this option :)).  Actually, the advantage is that almost all popular libraries of Google Maps, Yandex Maps, Mapbox, Leaflet, etc., are supported in one way or another.  However, not everyone does it efficiently, for example, on request to Google about an effective solution for loading a large number of points in Mapbox, the first link will be their solution - supercluster, which in fact is a server utility that loads, prepares GeoJSON data and returns it to the client. </p><br></li><li><p>  Download only located in viewport.  The idea is quite simple, we only load what is in the viewport (* in some cases, nearby tiles are lazily loaded).  Realization of this is in the box, for example in Yandex Maps - <a href="https://tech.yandex.ru/maps/doc/jsapi/2.1/dg/concepts/loading-object-manager/about-docpage/">LoadingObjectManager</a> , including it can do clustering on the client.  They also have RemoteObjectManager, which already expects clustered data from the server. </p><br></li><li><p>  Pregenerating static tiles and loading them.  It also takes place, especially in the case of high-load services, but not very interesting.  Tiles are most often generated using a tool, such as Mapnik, and uploaded to a CDN, or a third-party utility / library is used, which does all this work on its own. </p><br></li><li>  Mapbox Vector Tiles, is actually one of the vector formats for maps, which describes various geometries, their style, etc ... The idea of ‚Äã‚Äãusing this method is to form your MVT endpoint, which itself can: <br><ul><li>  Return Geometries </li><li>  Cluster points </li><li>  Simplify geometry at low zoom levels </li><li>  Other </li></ul></li></ol><br><p>  This format is perfectly supported by solutions from Mapbox, there are also libraries for Leaflet. </p><br><p>  From the point of view of storage for GIS data, which would also make it possible to effectively carry out operations on them, you can choose PostGIS, which by the way gives all the necessary operations for the above, including the generation of MVT (Mapbox Vector Tiles): </p><br><ul><li> Inclusion of geometry in a tile (rectangle) using the <code>@</code> operator </li><li>  MVT Generation - ST_AsMVT, ST_AsMVTGeom </li></ul><br><p>  Thank you for your attention, I hope for a constructive feedback, if it is interesting, I can tell you about some points of working with maps! </p><br><p>  <a href="https://github.com/getjump/maps-efficiency">Examples of the above are available in my GitHub.</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/352330/">https://habr.com/ru/post/352330/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352320/index.html">Event digest for HR-specialists in the field of IT for April 2018</a></li>
<li><a href="../352322/index.html">Detect integer constant expressions in the macro [along with Linus]</a></li>
<li><a href="../352324/index.html">The Internet of Things as a catalyst for digital transformation</a></li>
<li><a href="../352326/index.html">JPoint 2018 plans</a></li>
<li><a href="../352328/index.html">The main criteria for SEO and AEO in the future - understanding and credibility</a></li>
<li><a href="../352332/index.html">ThinLinc Remote Desktop Server Overview for Linux</a></li>
<li><a href="../352334/index.html">Testing Android Applications</a></li>
<li><a href="../352336/index.html">Control of the hardware product: the path of heavy compromise</a></li>
<li><a href="../352338/index.html">Miners succeeded cryptographers</a></li>
<li><a href="../352340/index.html">"Mamkin architect." Part 1: Ups and downs of software engineering</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>