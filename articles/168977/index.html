<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HTML with images in DOC in PHP with your own hands</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article Not Very Fair DOC File Generation in PHP described how to generate a DOC file using MHT (MIME HTML) generation using a third-party library...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HTML with images in DOC in PHP with your own hands</h1><div class="post__text post__text-html js-mediator-article">  The article <a href="http://habrahabr.ru/post/136999/">Not Very Fair DOC File Generation in PHP</a> described how to generate a DOC file using MHT (MIME HTML) generation using a third-party library.  Today I will talk about my own generation in this format.  The advantages of my method are as follows: <br><br>  1) In OpenOffice readable text and pictures. <br>  2) In Word, the file opens in electronic form, rather than full screen. <br>  3) Our script will accept HTML and immediately send the DOC file for download. <br><br>  Everything else, you will understand how to convert naked HTML to MHT with your own hands.  Errors, if any, will be easier to dig into the code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let's start with the function that will give the DOC file to download and will work in all browsers and with all protocols (I had problems with this): <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_download</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($filename, $charset = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'cp1251'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ header ($_SERVER[<span class="hljs-string"><span class="hljs-string">"SERVER_PROTOCOL"</span></span>] . <span class="hljs-string"><span class="hljs-string">' 200 OK'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ereg(<span class="hljs-string"><span class="hljs-string">'Opera(/| )([0-9].[0-9]{1,2})'</span></span>, $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>])) $UserBrowser = <span class="hljs-string"><span class="hljs-string">"Opera"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> (ereg(<span class="hljs-string"><span class="hljs-string">'MSIE ([0-9].[0-9]{1,2})'</span></span>, $_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>])) $UserBrowser = <span class="hljs-string"><span class="hljs-string">"IE"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> $UserBrowser = <span class="hljs-string"><span class="hljs-string">''</span></span>; $mime_type = ($UserBrowser == <span class="hljs-string"><span class="hljs-string">'IE'</span></span> || $UserBrowser == <span class="hljs-string"><span class="hljs-string">'Opera'</span></span>) ? <span class="hljs-string"><span class="hljs-string">'application/octetstream'</span></span> : <span class="hljs-string"><span class="hljs-string">'application/octet-stream'</span></span>; header(<span class="hljs-string"><span class="hljs-string">"Content-Type: application/msword; charset="</span></span>.$charset); $ua = (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]))?$_SERVER[<span class="hljs-string"><span class="hljs-string">'HTTP_USER_AGENT'</span></span>]:<span class="hljs-string"><span class="hljs-string">''</span></span>; $isMSIE = preg_match(<span class="hljs-string"><span class="hljs-string">'@MSIE ([0-9].[0-9]{1,2})@'</span></span>, $ua); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($isMSIE) { header(<span class="hljs-string"><span class="hljs-string">'Content-Disposition: attachment; filename="'</span></span> . $filename . <span class="hljs-string"><span class="hljs-string">'"'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Cache-Control: must-revalidate, post-check=0, pre-check=0'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Pragma: public'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { header(<span class="hljs-string"><span class="hljs-string">'Content-Disposition: attachment; filename="'</span></span> . $filename . <span class="hljs-string"><span class="hljs-string">'"'</span></span>); header(<span class="hljs-string"><span class="hljs-string">'Pragma: no-cache'</span></span>); } }</code> </pre> <br><br><a name="habracut"></a><br><br>  Now let's move on to the DOC file generation itself, for this we will create a form that will send us html with pictures, the pictures are on our website. <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"getFile.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"POST"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rows</span></span></span><span class="hljs-tag"> =</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">cols</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?</span></span></span><span class="php">=str_replace(</span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&gt;'</span></span></span><span class="php">), </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">(</span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&gt;'</span></span></span><span class="php">), </span><span class="hljs-string"><span class="php"><span class="hljs-string">'   &lt;b&gt;&lt;/b&gt;&lt;img src="/images/logo.gif"&gt;'</span></span></span><span class="php">);</span><span class="hljs-meta"><span class="php"><span class="hljs-meta">?&gt;</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">textarea</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"HTML TO DOC"</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  We will convert the images using base64, create a function - callback for this: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prepareImage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($matches)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $IMAGES, $IMAGE_NAMES, $IMAGE_COUNT,$gldir,$SITE; $imgfile = $_SERVER[<span class="hljs-string"><span class="hljs-string">'DOCUMENT_ROOT'</span></span>].<span class="hljs-string"><span class="hljs-string">'/'</span></span>.$matches[<span class="hljs-number"><span class="hljs-number">2</span></span>]; $imgbinary = fread(fopen($imgfile, <span class="hljs-string"><span class="hljs-string">"r"</span></span>), filesize($imgfile)); $url = $SITE.$matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $data = chunk_split(base64_encode($imgbinary)); $IMAGE_COUNT++; $ext = substr($matches[<span class="hljs-number"><span class="hljs-number">2</span></span>], strpos($matches[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'.'</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>, strlen($matches[<span class="hljs-number"><span class="hljs-number">2</span></span>])); $imgName = <span class="hljs-string"><span class="hljs-string">'images'</span></span>.$IMAGE_COUNT.<span class="hljs-string"><span class="hljs-string">'.'</span></span>.$ext; $IMAGES .= <span class="hljs-string"><span class="hljs-string">' --doc_file_part_na_habrahabr Content-Location: '</span></span>.$gldir.<span class="hljs-string"><span class="hljs-string">'images/'</span></span>.$imgName.<span class="hljs-string"><span class="hljs-string">' Content-Transfer-Encoding: base64 Content-Type: image/'</span></span>.$ext.<span class="hljs-string"><span class="hljs-string">' '</span></span>.$data.<span class="hljs-string"><span class="hljs-string">' '</span></span>; $pr1 = $matches[<span class="hljs-number"><span class="hljs-number">1</span></span>]; $pr2 = $matches[<span class="hljs-number"><span class="hljs-number">3</span></span>]; $IMAGE_NAMES .= <span class="hljs-string"><span class="hljs-string">' &lt;o:File HRef=3D"'</span></span>.$imgName.<span class="hljs-string"><span class="hljs-string">'"/&gt;'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;v:imagedata src=3D"'</span></span>.$gldir.<span class="hljs-string"><span class="hljs-string">'images/'</span></span>.$imgName.<span class="hljs-string"><span class="hljs-string">'" o:href=3D"'</span></span>.$url.<span class="hljs-string"><span class="hljs-string">'"/&gt;&lt;/v:shape&gt;&lt;![endif]--&gt;&lt;![if !vml]&gt;&lt;span style=3D"mso-ignore:vglayout"&gt;&lt;img border=3D0 src=3D"'</span></span>$gldir<span class="hljs-string"><span class="hljs-string">'.images/'</span></span>.$imgName.<span class="hljs-string"><span class="hljs-string">'" alt=3DHaut v:shapes=3D"_x0000_i1057" '</span></span>.$p1.<span class="hljs-string"><span class="hljs-string">' '</span></span>.$pr2.<span class="hljs-string"><span class="hljs-string">'&gt;&lt;/span&gt;&lt;![endif]&gt;'</span></span>; }</code> </pre><br><br>  Immediately I apologize for the fact that the code is written in functions, and all data is stored in global variables.  The code was written when I was just starting to write in PHP.  Now we will create a function that will help us with the text so that it is at least readable in OpenOffice. <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">xml_entities</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($text, $charset = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'cp1251'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $SITE; <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> $text = preg_replace_callback( <span class="hljs-string"><span class="hljs-string">'/&lt;img([a-zA-Z0-9:\/\.\-\?=_&amp;\s;"]*)src="([--a-zA-Z\d\s:\/\.\-\?=_&amp;]*)"([a-zA-Z0-9:\/\.\-\?=_&amp;\s;"]*)&gt;/'</span></span>, <span class="hljs-string"><span class="hljs-string">"prepareImage"</span></span>, $text); <span class="hljs-comment"><span class="hljs-comment">/*      */</span></span> $text = preg_replace(<span class="hljs-string"><span class="hljs-string">'/href="/'</span></span>,<span class="hljs-string"><span class="hljs-string">'href=3D"'</span></span>.$SITE, $text); <span class="hljs-comment"><span class="hljs-comment">/*       =3D, 3D -     */</span></span> $text = preg_replace(<span class="hljs-string"><span class="hljs-string">'/=(?=[^3])/'</span></span>,<span class="hljs-string"><span class="hljs-string">'=3D'</span></span>,$text); $text = preg_replace(<span class="hljs-string"><span class="hljs-string">'/\s?=\s?"/'</span></span>,<span class="hljs-string"><span class="hljs-string">'=3D"'</span></span>,$text); <span class="hljs-comment"><span class="hljs-comment">/*  ,    OpenOffice */</span></span> $text = htmlentities($text, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, $charset); $fi = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span><span class="hljs-string"><span class="hljs-string">","</span></span>&amp;<span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">'","&lt;","&gt;"); $re = array('</span></span><span class="hljs-string"><span class="hljs-string">"',"</span></span>&amp;<span class="hljs-string"><span class="hljs-string">","</span></span><span class="hljs-string"><span class="hljs-string">'","&lt;","&gt;"); return str_replace($fi, $re, $text); }</span></span></code> </pre><br><br><habracut><br><br>  Now the script code itself: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $SITE; <span class="hljs-comment"><span class="hljs-comment">/*  ,             */</span></span> $SITE = <span class="hljs-string"><span class="hljs-string">'http://pihpi.ru'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">htmlToDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name, $html, $charset = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'cp1251'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ $nameFile = $name.<span class="hljs-string"><span class="hljs-string">'.doc'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> $IMAGES, $IMAGE_NAMES, $IMAGE_COUNT, $gldir, $SITE; $IMAGE_COUNT = <span class="hljs-number"><span class="hljs-number">0</span></span>; $IMAGE_NAMES = <span class="hljs-string"><span class="hljs-string">''</span></span>; $IMAGES = <span class="hljs-string"><span class="hljs-string">''</span></span>; $gldir = <span class="hljs-string"><span class="hljs-string">'file:///C:/AF22D505/'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* doc_file_part_na_habrahabr -       .  ,   ,   MIME        ,  . */</span></span> $head = <span class="hljs-string"><span class="hljs-string">'MIME-Version: 1.0 Content-Type: multipart/related; boundary="doc_file_part_na_habrahabr" --doc_file_part_na_habrahabr Content-Location: '</span></span>.$gldir.$nameFile.<span class="hljs-string"><span class="hljs-string">' Content-Transfer-Encoding: quoted-printable Content-Type: text/html; charset="windows-1251" &lt;html xmlns:o=3D"urn:schemas-microsoft-com:office:office" xmlns:w=3D"urn:schemas-microsoft-com:office:word" xmlns=3D"http://www.w3.org/TR/REC-html40"&gt; &lt;head&gt; &lt;meta http-equiv=3DContent-Type content=3D"text/html; charset=3Dwindows-1251"&gt; &lt;meta name=3DProgId content=3DWord.Document&gt; &lt;meta name=3DGenerator content=3D"Microsoft Word 11"&gt; &lt;meta name=3DOriginator content=3D"Microsoft Word 11"&gt; &lt;link rel=3DFile-List href=3D"filelist.xml"&gt; &lt;!--[if gte mso 9]&gt;&lt;xml&gt; &lt;w:WordDocument&gt; &lt;w:View&gt;Print&lt;/w:View&gt; &lt;w:GrammarState&gt;Clean&lt;/w:GrammarState&gt; &lt;w:ValidateAgainstSchemas/&gt; &lt;w:SaveIfXMLInvalid&gt;false&lt;/w:SaveIfXMLInvalid&gt; &lt;w:IgnoreMixedContent&gt;false&lt;/w:IgnoreMixedContent&gt; &lt;w:AlwaysShowPlaceholderText&gt;false&lt;/w:AlwaysShowPlaceholderText&gt; &lt;w:BrowserLevel&gt;MicrosoftInternetExplorer4&lt;/w:BrowserLevel&gt; &lt;/w:WordDocument&gt; &lt;/xml&gt;&lt;![endif]--&gt;&lt;!--[if gte mso 9]&gt;&lt;xml&gt; &lt;w:LatentStyles DefLockedState=3D"false" LatentStyleCount=3D"156"&gt; &lt;/w:LatentStyles&gt; &lt;/xml&gt;&lt;![endif]--&gt; &lt;style&gt; &lt;!-- /* Style Definitions */ p.MsoNormal, li.MsoNormal, div.MsoNormal {mso-style-parent:""; margin:0cm; margin-bottom:.0001pt; mso-pagination:widow-orphan; font-size:12.0pt; font-family:"Tahoma"; mso-fareast-font-family:"Tahoma";} @page Section1 {size:595.3pt 841.9pt; margin:18.0pt 19.3pt 18.0pt 18.0pt; mso-header-margin:35.4pt; mso-footer-margin:35.4pt; mso-paper-source:0;} div.Section1 {page:Section1;} --&gt; &lt;/style&gt; &lt;!--[if gte mso 10]&gt; &lt;style&gt; /* Style Definitions */ table.MsoNormalTable {mso-style-name:"\041E\0431\044B\0447\043D\0430\044F \0442\0430\0431\043B\= 0438\0446\0430"; mso-tstyle-rowband-size:0; mso-tstyle-colband-size:0; mso-style-noshow:yes; mso-style-parent:""; mso-padding-alt:0cm 5.4pt 0cm 5.4pt; mso-para-margin:0cm; mso-para-margin-bottom:.0001pt; mso-pagination:widow-orphan; font-size:10.0pt; font-family:"Tahoma"; mso-ansi-language:#0400; mso-fareast-language:#0400; mso-bidi-language:#0400; width:100%; } td.br1{ border:1px solid black; } &lt;/style&gt; &lt;![endif]--&gt; &lt;/head&gt; &lt;body&gt;'</span></span>; $end = <span class="hljs-string"><span class="hljs-string">' &lt;/body&gt; &lt;/html&gt; '</span></span>; $html = xml_entities($html, $charset); <span class="hljs-comment"><span class="hljs-comment">/*    ,   xml    */</span></span> $fileList = <span class="hljs-string"><span class="hljs-string">' --doc_file_part_na_habrahabr Content-Location: '</span></span>.$gldir.<span class="hljs-string"><span class="hljs-string">'filelist.xml Content-Transfer-Encoding: quoted-printable Content-Type: text/xml; charset="utf-8" &lt;xml xmlns:o=3D"urn:schemas-microsoft-com:office:office"&gt; &lt;o:MainFile HRef=3D"../'</span></span>.$nameFile.<span class="hljs-string"><span class="hljs-string">'"/&gt; '</span></span>.$IMAGE_NAMES.<span class="hljs-string"><span class="hljs-string">' &lt;o:File HRef=3D"filelist.xml"/&gt; &lt;/xml&gt; '</span></span>; $content = $head.$html.$end.$IMAGES.$fileList.<span class="hljs-string"><span class="hljs-string">'--doc_file_part_na_habrahabr--'</span></span>; send_download($nameFile); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $content; <span class="hljs-keyword"><span class="hljs-keyword">exit</span></span>(); }</code> </pre><br><br>  And finally, the actual conversion of HTML to DOC in action: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])) { htmlToDoc(<span class="hljs-string"><span class="hljs-string">'article'</span></span>, str_replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, $_POST[<span class="hljs-string"><span class="hljs-string">'text'</span></span>])); }</code> </pre><br><br>  An example of the script, you can see the following link: <br><br>  <a href="http://pihpi.ru/getFile.php">http://pihpi.ru/getFile.php</a> <br><br>  <b>A few words about Office Libre:</b> <br><br>  The text is displayed, but the pictures are alas.  After reading about <a href="http://phpclub.ru/detail/article/mail%3FprintVersion%3D1">Mime</a> tried to do through the Content-ID, did not work.  Either I do not know something, or Libre Office does not want to support MIME HTML at all. </habracut></div><p>Source: <a href="https://habr.com/ru/post/168977/">https://habr.com/ru/post/168977/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168967/index.html">Reliability SSD drives and monitoring tools</a></li>
<li><a href="../168969/index.html">What and in what volume you need to know php programmer</a></li>
<li><a href="../168971/index.html">Useful stuff when developing in C # under AutoCAD</a></li>
<li><a href="../168973/index.html">Replacing standard select in browser</a></li>
<li><a href="../168975/index.html">Working with sensors in Android, or a service to record readings from the accelerometer</a></li>
<li><a href="../168979/index.html">Results of a uniform rating of web studios 2013</a></li>
<li><a href="../168981/index.html">Monitor the health of HP Proliant servers at nagios / icinga. Plugins check_hpasm and check_ilo2_health.pl</a></li>
<li><a href="../168983/index.html">The buzz around Nokia‚Äôs early collapse is unjustified, or what are analysts keeping back?</a></li>
<li><a href="../168985/index.html">About long life and imminent death of magnetic stripe cards</a></li>
<li><a href="../168987/index.html">SMS payments: how it works</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>