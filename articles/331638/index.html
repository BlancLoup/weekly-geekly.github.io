<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Headache from using math software</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that in one period of time I discussed on the Internet, it would seem, different topics: free Matlab alternatives for universities and ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Headache from using math software</h1><div class="post__text post__text-html js-mediator-article"><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ac3/68a/cf4/ac368acf43861c19d5d104659cf61044.png" alt="Picture 2"></div><p></p><br>  It so happened that in one period of time I discussed on the Internet, it would seem, different topics: free Matlab alternatives for universities and students, and searching for errors in algorithms using static code analysis.  All these discussions have combined the terrible quality code of modern programs.  In particular, the quality of software for mathematicians and scientists.  Here the question arises of confidence in the calculations and research conducted using such programs.  Let's try to think about this topic and look for errors. <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  I want to start with the definition of the term "algorithm".  The algorithm is a set of instructions describing the procedure for the performer to achieve a certain result ( <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC">Wikipedia</a> ).  Thus, it is not necessary to divide the source code into algorithms and the rest of the code.  For example, sorting algorithms are exactly the same code as opening a file, searching for a character in a string, etc.  The code may contain an error and, fortunately, many errors can be identified at the initial stage using the static code analysis tools. <br><br>  However, for searching for the so-called ‚Äúalgorithmic‚Äù errors, I decided to analyze the code of several mathematical packages.  In such code there are many functions in which any mathematical formulas are simply programmed.  It turns out that there are people who do not even consider such a code.  And, accordingly, there may be any errors. <br><br>  To identify all the code defects presented in the article, we used the <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static analyzer version 6.15, which runs on Windows / Linux with the C / C ++ / C # programming languages. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Errors from 3rd party </h2><br>  This story began with a search for errors in the <a href="http://www.pointclouds.org/">Point Cloud Library</a> project (PCL, <a href="https://github.com/PointCloudLibrary/pcl">GitHub</a> ).  Without setting goals to find a lot of mistakes and write an article, I simply looked through the report and found a very interesting error: <br><br>  <a href="http://www.viva64.com/ru/w/V533/">V533</a> It is likely that a variable is being incremented inside the 'for' operator.  Consider reviewing 'i'.  sparsematrix.inl 212 <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SparseMatrix</span></span></span><span class="hljs-class">&lt;T&gt;&amp; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SparseMatrix</span></span></span><span class="hljs-class">&lt;T&gt;:</span></span>:<span class="hljs-keyword"><span class="hljs-keyword">operator</span></span> *= (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> T&amp; V) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span> ; i&lt;rows ; i++ ) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ii=<span class="hljs-number"><span class="hljs-number">0</span></span> ; ii&lt;rowSizes[i] ; i++ ) m_ppElements[i][ii].Value *= V; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> *<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; }</code> </pre> <br>  In the overloaded operator "* =", they multiplied all the elements of the matrix by a certain value <i>V.</i>  The author of the code made a very serious mistake for this algorithm, because of which only the first column of the matrix changes, and an infinite loop is possible with going beyond the array boundaries. <br><br>  This code was from the mathematical library of <a href="https://github.com/mkazhdan/PoissonRecon">Poisson Surface Reconstruction</a> .  I made sure that the error is still present in the latest version of the code.  It is terrible to think how many more projects include this library. <br><br>  Here is another strange code snippet: <br><br>  <a href="http://www.viva64.com/ru/w/V607/">V607</a> Ownerless expression 'j &lt;remains'.  allocator.h 120 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rollBack</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> AllocatorState&amp; state)</span></span></span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(state.index&lt;index){ .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;remains;j++){ memory[index][j].~T(); <span class="hljs-keyword"><span class="hljs-keyword">new</span></span>(&amp;memory[index][j]) T(); } index=state.index; remains=state.remains; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> j=<span class="hljs-number"><span class="hljs-number">0</span></span>;j&lt;state.remains;j&lt;remains){ <span class="hljs-comment"><span class="hljs-comment">// &lt;= memory[index][j].~T(); new(&amp;memory[index][j]) T(); } remains=state.remains; } .... }</span></span></code> </pre> <br>  I suspect that this strange loop is not often executed, since it still remains in the code.  But someone probably had incomprehensible hangs with the emergency termination of the program.  Some idea of ‚Äã‚Äãthe quality of the code has been formed.  We now turn to the larger project - Scilab, where a real headache awaits us. <br><br><h2>  Scilab </h2><br><h3>  about the project </h3><br>  <a href="http://www.scilab.org/">Scilab</a> is a package of applied mathematical programs that provides an open environment for engineering (technical) and scientific calculations.  This development environment is one of the publicly available alternatives to <a href="https://www.mathworks.com/">Matlab</a> , which is widely used in various institutions and research.  <a href="https://www.gnu.org/software/octave/">GNU Octave</a> is another popular alternative to Matlab, and we have previously paid attention to these projects: <ul><li>  <a href="https://www.viva64.com/ru/b/0244/">Scilab Check</a> (March 2014); </li><li>  <a href="https://www.viva64.com/ru/b/0343/">Check GNU Octave</a> (August 2015). </li></ul><br>  Before writing a new article about Scilab, I read the old one and made only two conclusions: <ol><li>  For 3 years, we have not corrected just a couple of places (‚ÄúWhy correct unspecified behavior, if everything works like this?‚Äù - apparently, the developers thought); </li><li>  There are many new bugs in the project.  I decided to put in the article only a couple of tens, so as not to tire the reader too much. </li></ol><br>  The source file for Scilab immediately contains a project file for Visual Studio, so you could open it and test the project in one click, which I did. <br><br><h3>  Beautiful typos </h3><br>  <a href="http://www.viva64.com/ru/w/V530/">V530</a>  sci_mscanf.cpp 274 <br><pre> <code class="cpp hljs">types::Function::<span class="hljs-function"><span class="hljs-function">ReturnValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_mscanf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;types::InternalType*&gt; pITTemp = <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;...&gt;(); .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> types::InternalType::ScilabString : { .... pITTemp.pop_back(); <span class="hljs-comment"><span class="hljs-comment">// &lt;= pITTemp.push_back(pType); } break; case types::InternalType::ScilabDouble : { .... pITTemp.back(); // &lt;= ??? pITTemp.push_back(pType); } break; .... }</span></span></code> </pre> <br>  It seems that code completion played a cruel joke with the programmer.  In the code of the <i>sci_mscanf</i> function, the last element of the vector is always removed before adding a new one, but in one place the programmer made a mistake by calling the <i>back ()</i> function instead of <i>pop_back ()</i> .  Calling the <i>back ()</i> function in this way makes no sense. <br><br>  <a href="http://www.viva64.com/ru/w/V595/">V595</a> The 'Block.inptr' pointer was used before it was counted against nullptr.  Check lines: 478, 479. sci_model2blk.cpp 478 <br><pre> <code class="cpp hljs">types::Function::<span class="hljs-function"><span class="hljs-function">ReturnValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_model2blk</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... Block.inptr[i] = MALLOC(size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Block.inptr == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { freeBlock(&amp;Block); Scierror(<span class="hljs-number"><span class="hljs-number">888</span></span>, _(<span class="hljs-string"><span class="hljs-string">"%s : Allocation error.\n"</span></span>), name.data()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> types::Function::Error; } <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(Block.inptr[i], <span class="hljs-number"><span class="hljs-number">0x00</span></span>, size); .... }</code> </pre> <br>  A very interesting case of a typo, because of which the allocation control stopped working.  Most likely, the correct code should be like this: <br><pre> <code class="cpp hljs">Block.inptr[i] = MALLOC(size); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Block.inptr[i] == <span class="hljs-literal"><span class="hljs-literal">nullptr</span></span>) { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/w/V595/">V595</a> The 'pwstLines' pointer was used before it was verified against nullptr.  Check lines: 78, 79. mgetl.cpp 78 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mgetl</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iFileID, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> iLineCount, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">wchar_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> ***pwstLines)</span></span></span><span class="hljs-function"> </span></span>{ *pwstLines = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... *pwstLines = (<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>**)MALLOC(iLineCount * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>*)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pwstLines == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">-1</span></span>; } .... }</code> </pre> <br>  Surprisingly similar error.  The author of the code did not count the asterisks, therefore the wrong pointer is checked in the condition. <br><br>  <a href="http://www.viva64.com/ru/w/V595/">V595</a> The 'array_size' pointer was used before it was verified against nullptr.  Check lines: 67, 68. diary_manager.cpp 67 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span> **getDiaryFilenames(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *array_size) { *array_size = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (SCIDIARY) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">list</span></span>&lt;<span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::wstring&gt; wstringFilenames = SCIDIARY-&gt;get.... *array_size = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)wstringFilenames.size(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (array_size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... } .... }</code> </pre> <br>  Stability is a sign of excellence.  The programmer again forgot to dereference the pointer, which is why not the size of some array is compared with zero, but the pointer to this variable. <br><br>  <a href="http://www.viva64.com/ru/w/V501/">V501</a> There are identical sub-expressions 'strncmp (tx, "% pi", 3) == 0' to the left and to the right of the '||'  operator.  stringtocomplex.c 276 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ParseNumber</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* tx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(tx) &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"%eps"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"+%pi"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"-%pi"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"+Inf"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"-Inf"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"+Nan"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"-Nan"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"%nan"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"%inf"</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> )) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">4</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(tx) &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; (<span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"+%e"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"-%e"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> || <span class="hljs-built_in"><span class="hljs-built_in">strncmp</span></span>(tx, <span class="hljs-string"><span class="hljs-string">"%pi"</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">// &lt;= || strncmp(tx, "Nan", 3) == 0 || strncmp(tx, "Inf", 3) == 0 || strncmp(tx, "%pi", 3) == 0)) // &lt;= { return 3; } .... }</span></span></code> </pre> <br>  This function contains some code for parsing numbers.  The analyzer found a suspicious comparison with two identical "% pi" lines.  Looking at the neighboring code snippet, we can assume that instead of the duplicated string there could be the string "-% pi" or "-Inf".  It is also possible that this is just an extra copied line of code, but then it is better to delete it. <br><br><h3>  Priorities for operations </h3><br>  <a href="http://www.viva64.com/ru/w/V502/">V502</a> Perhaps the '?:' Operator was different.  The '?:' Operator has a lower limit than the '==' operator.  sci_sparse.cpp 49 <br><pre> <code class="cpp hljs">types::Function::<span class="hljs-function"><span class="hljs-function">ReturnValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_sparse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isValid = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; .... <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span> ; isValid &amp;&amp; i &lt; in.size() ; i++) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (in[i]-&gt;getType()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> types::InternalType::ScilabBool : <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> types::InternalType::ScilabSparseBool : { isValid = (i == (in.size() &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>); } .... }</code> </pre> <br>  Errors with priorities of operations are very common in modern code.  (see the article " <a href="https://www.viva64.com/ru/b/0390/">Logical expressions in C / C ++. How professionals are mistaken</a> "). <br><br>  In the above code snippet, there is also an error, but due to a lot of luck, the code with the error works as the programmer expected.  Just because the elements of the array with indices 0 and 1 participate in the comparison, and the integer representations of truth and false are also the values ‚Äã‚Äã0 and 1, this piece of code miraculously still works correctly. <br><br>  You should rewrite the code to the correct priority of operations: <br><pre> <code class="cpp hljs">isValid = (i == (in.size() &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> ? <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>));</code> </pre> <br>  <a href="http://www.viva64.com/ru/w/V590/">V590</a> Consider inspecting the 'iType! = - 1 &amp;&amp; iType == 8' expression.  The expression is misprint.  scilabview.cpp 175 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> ScilabView::createObject(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iUID) { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iType = <span class="hljs-number"><span class="hljs-number">-1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> *piType = &amp;iType; getGraphicObjectProperty(....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iType != <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; iType == __GO_FIGURE__) { m_figureList[iUID] = <span class="hljs-number"><span class="hljs-number">-1</span></span>; setCurrentFigure(iUID); } .... }</code> </pre> <br>  In this fragment there is an error with the priority of operations, which is also discussed in the article proposed earlier. <br><br>  The conditional subexpression <i>(iType! = -1)</i> does not affect the result of the entire conditional expression.  You can verify the error by building the truth table for this example. <br><br>  Another such example: <ul><li>  V590 Consider inspecting the 'iObjectType! = - 1 &amp;&amp; iObjectType == 5' expression.  The expression is misprint.  sci_unglue.c 90 </li></ul><br><h3>  Invalid error messages </h3><br>  In the previous article on errors in Scilab, there was also a small section on errors when printing messages.  On a fresh code, there were also quite a lot of errors of this type. <br><br>  <a href="http://www.viva64.com/ru/w/V517/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 159, 163. cdfbase.c 159 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cdf_error</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params">* </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> status, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> bound)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (status) { .... <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-number"><span class="hljs-number">10</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strcmp</span></span>(fname, <span class="hljs-string"><span class="hljs-string">"cdfchi"</span></span>) == <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-comment"><span class="hljs-comment">// &lt;= { Scierror(999 _("%s: cumgam returned an error\n"), fname); } else if (strcmp(fname, "cdfchi") == 0) // &lt;= { Scierror(999, _("%s: gamma or inverse gamma routine failed\n"), fname); } break; .... }</span></span></code> </pre> <br>  Scilab has a large set of <a href="https://help.scilab.org/docs/6.0.0/ru_RU/section_e9e30c6ff8437ca27960835e84b97e3f.html"><i>cdf</i></a> functions.  The presented code snippet interprets the return codes of these functions.  And the trouble is that some kind of error warning is never displayed due to a typo in the function name.  A search for this post leads to the <a href="https://help.scilab.org/doc/5.3.3/en_US/cdfgam.html"><i>cdfgam</i></a> function.  I would like to sympathize with users who worked with this function and could not find out about some of the problems due to a typo of the authors of the mathematical package. <br><br>  <a href="http://www.viva64.com/ru/w/V510/">V510</a> The 'Scierror' function is not expected to receive class-type variable as the third actual argument.  sci_winqueryreg.cpp 149 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> fname = <span class="hljs-string"><span class="hljs-string">"winqueryreg"</span></span>; types::Function::<span class="hljs-function"><span class="hljs-function">ReturnValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_winqueryreg</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (rhs != <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; rhs != <span class="hljs-number"><span class="hljs-number">3</span></span>) { Scierror(<span class="hljs-number"><span class="hljs-number">77</span></span>, _(<span class="hljs-string"><span class="hljs-string">"%s: Wrong number...\n"</span></span>), fname.data(), <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> types::Function::Error; } .... <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Scierror(<span class="hljs-number"><span class="hljs-number">999</span></span>, _(<span class="hljs-string"><span class="hljs-string">"%s: Cannot open Windows regist..."</span></span>), fname); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> types::Function::Error; } .... }</code> </pre> <br>  When printing a line in one place, they forgot to call the <i>data ()</i> method. <br><br>  <a href="http://www.viva64.com/ru/w/V746/">V746</a> Type slicing.  By reference rather than by value.  sci_scinotes.cpp 48 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_scinotes</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * fname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* pvApiCtx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { callSciNotesW(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (GiwsException::JniCallMethodException exception) { Scierror(<span class="hljs-number"><span class="hljs-number">999</span></span>, <span class="hljs-string"><span class="hljs-string">"%s: %s\n"</span></span>, fname, exception.getJavaDescription().c_str()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (GiwsException::JniException exception) { Scierror(<span class="hljs-number"><span class="hljs-number">999</span></span>, <span class="hljs-string"><span class="hljs-string">"%s: %s\n"</span></span>, fname, exception.whatStr().c_str()); } .... }</code> </pre> <br>  Exception caught by value.  This means that a new object will be constructed using the copy constructor and some of the exception information will be lost.  The correct option is to intercept exceptions by reference. <br><br>  There are several such places: <ul><li>  V746 Type slicing.  By reference rather than by value.  sci_builddoc.cpp 270 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_closescinotesfromscilab.cpp 45 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_closescinotesfromscilab.cpp 50 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 52 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 263 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 272 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 349 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 353 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 365 </li><li>  V746 Type slicing.  By reference rather than by value.  sci_scinotes.cpp 369 </li><li>  V746 Type slicing.  By reference rather than by value.  visitor_common.cpp 1743 </li><li>  V746 Type slicing.  By reference rather than by value.  overload.cpp 135 </li></ul><br><h3>  Strange code </h3><br>  Strange code, because it is unclear why so to write and how to fix it better. <br><br>  <a href="http://www.viva64.com/ru/w/V523/">V523</a> The 'then' statement is equivalent to the 'else' statement.  data3d.cpp 51 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Data3D::getDataProperty(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> property, <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> **_pvData) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (property == UNKNOWN_DATA_PROPERTY) { *_pvData = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { *_pvData = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; } }</code> </pre> <br>  Here is a simple function that always resets the pointer. <br><br>  <a href="http://www.viva64.com/ru/w/V575/">V575</a> The 'memset' function processes '0' elements.  Inspect the third argument.  win_mem_alloc.c 91 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MyHeapAlloc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwSize, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *file, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> line)</span></span></span><span class="hljs-function"> </span></span>{ LPVOID NewPointer = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dwSize &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { _try { NewPointer = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(dwSize); NewPointer = <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span> (NewPointer, <span class="hljs-number"><span class="hljs-number">0</span></span>, dwSize); } _except (EXCEPTION_EXECUTE_HANDLER) { } .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { _try { NewPointer = <span class="hljs-built_in"><span class="hljs-built_in">malloc</span></span>(dwSize); NewPointer = <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span> (NewPointer, <span class="hljs-number"><span class="hljs-number">0</span></span>, dwSize); } _except (EXCEPTION_EXECUTE_HANDLER) { } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> NewPointer; }</code> </pre> <br>  Regardless of the value of the <i>dwSize variable</i> , the same code is always executed.  So why duplicate it? <br><br>  <a href="http://www.viva64.com/ru/w/V695/">V695</a> Range intersections are possible within conditional expressions.  Example: if (A &lt;5) {...} else if (A &lt;2) {...}.  Check lines: 438, 442. sci_sorder.c 442 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_sorder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *fname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* pvApiCtx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iRows * iCols &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { dblTol1 = pdblTol[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (iRows * iCols &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { dblTol2 = pdblTol[<span class="hljs-number"><span class="hljs-number">1</span></span>]; } .... }</code> </pre> <br>  The second condition is always false, because if <i>EXPR&gt; 0</i> , then it does not make sense to check <i>EXPR&gt; 1</i> .  There is clearly some kind of error in this code. <br><br><h3>  Null pointer dereferencing and undefined behavior </h3><br>  <a href="http://www.viva64.com/ru/w/V522/">V522</a> Dereferencing of the null pointer 'dataz' might take place.  polylinedata_wrap.c 373 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">BOOL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">translatePolyline</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> uid, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> z, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flagX, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flagY, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> flagZ)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *datax = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *datay = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> *dataz = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">// &lt;= int i = 0; if (x != 0.0) { datax = getDataX(uid); if (datax == NULL) return FALSE; .... if (z != 0 &amp;&amp; isZCoordSet(uid)) { if (flagZ) { for (i = 0; i &lt; getDataSize_(uid); ++i) { dataz[i] = pow(10.,log10(dataz[i]) + z); // &lt;= } } else { for (i = 0; i &lt; getDataSize_(uid); ++i) { dataz[i] += z; // &lt;= } } } return TRUE; }</span></span></code> </pre> <br>  There are <i>datax</i> , <i>datay</i> and <i>dataz arrays</i> .  The latter is not initialized anywhere, but is used under certain conditions. <br><br>  <a href="http://www.viva64.com/ru/w/V595/">V595</a> The 'number' pointer was used against nullptr.  Check lines: 410, 425. scilab_sscanf.cpp 410 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">scilab_sscanf</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>* number = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... number = (<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>*)MALLOC((nbrOfDigit + <span class="hljs-number"><span class="hljs-number">1</span></span>) * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>)); <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(number, wcsData, nbrOfDigit * <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">wchar_t</span></span>)); number[nbrOfDigit] = L'\<span class="hljs-number"><span class="hljs-number">0'</span></span>; iSingleData = wcstoul(number, &amp;number, base); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((iSingleData == <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp;&amp; (number[<span class="hljs-number"><span class="hljs-number">0</span></span>] == wcsData[<span class="hljs-number"><span class="hljs-number">0</span></span>])) { .... } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (number == <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>) { wcsData += nbrOfDigit; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { wcsData += (nbrOfDigit - wcslen(number)); } .... }</code> </pre> <br>  Under the <i>number</i> line, they allocated memory using the <i>malloc ()</i> function, while de-checking it several times before checking the pointer and passing it to the <i>memcpy ()</i> function as an argument, which is unacceptable. <br><br>  <a href="http://www.viva64.com/ru/w/V595/">V595</a> The OuputStrings' pointer was used before it was verified against nullptr.  Check lines: 271, 272. spawncommand.c 271 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> **</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateOuput</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(pipeinfo *pipe, BOOL DetachProcess)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **OuputStrings = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; .... OuputStrings = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>**)MALLOC((pipe-&gt;NumberOfLines) * ....); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(OuputStrings, <span class="hljs-number"><span class="hljs-number">0x00</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*) * pipe-&gt;NumberOfLines); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (OuputStrings) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *line = strtok(buffer, LF_STR); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (line) { OuputStrings[i] = convertLine(line, DetachProcess); .... }</code> </pre> <br>  Here, they allocate dynamic memory for the <i>OuputStrings</i> variable, but prior to checking this pointer, the allocated memory is reset with the help of the <i>memset ()</i> function, and you cannot do this.  Quote from the documentation for the function: " <i>The behavior is undefined if 'dest' is a null pointer</i> ". <br><br><h3>  Memory leaks and unclosed resources </h3><br>  <a href="http://www.viva64.com/ru/w/V611/">V611</a> The memory was allocated using the 'new T []' operator.  Consider inspecting this code.  It's probably better to use 'delete [] piP;'.  sci_grand.cpp 990 <br><br>  <a href="http://www.viva64.com/ru/w/V611/">V611</a> The memory was allocated using the 'new T []' operator.  Consider inspecting this code.  It's probably better to use 'delete [] piOut;'.  sci_grand.cpp 991 <br><pre> <code class="cpp hljs">types::Function::<span class="hljs-function"><span class="hljs-function">ReturnValue </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_grand</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* piP = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[vectpDblInput[<span class="hljs-number"><span class="hljs-number">0</span></span>]-&gt;getSize()]; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* piOut = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>[pDblOut-&gt;getSize()]; .... <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> piP; <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> piOut; .... }</code> </pre> <br>  There were two serious mistakes.  After allocating dynamic memory for arrays, it should be cleared by calling the <i>delete []</i> operator, i.e.  with square brackets. <br><br>  <a href="http://www.viva64.com/ru/w/V773/">V773</a> The function of the doc 'pointer.  A memory leak is possible.  sci_builddoc.cpp 263 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sci_buildDoc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *fname, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">* pvApiCtx)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { org_scilab_modules_helptools::SciDocMain * doc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (doc-&gt;setOutputDirectory((<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *)outputDirectory.c_str())) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Scierror(<span class="hljs-number"><span class="hljs-number">999</span></span>, _(<span class="hljs-string"><span class="hljs-string">"...."</span></span>), fname, outputDirectory.c_str()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE; <span class="hljs-comment"><span class="hljs-comment">// &lt;= } if (doc != NULL) { delete doc; } } catch (GiwsException::JniException ex) { Scierror(....); Scierror(....); Scierror(....); return FALSE; } .... }</span></span></code> </pre> <br>  In some situations, exiting the function without clearing the <i>doc</i> pointer is performed.  Also, the comparison of the <i>doc</i> pointer with <i>NULL is</i> not correct, because  if the <i>new</i> operator fails to allocate memory, then it throws an exception, and does not return <i>NULL</i> . <br><br>  This is the most obvious example of a memory leak found in the Scilab project.  It is evident that they plan to free up the memory, but in one place they forgot to do it. <br><br>  In general, a lot of memory leaks have been found in the project: pointers are simply not cleaned and are not saved anywhere.  Since  I am not a Scilab developer, it is difficult for me to determine where errors are in such cases and where they are not.  But I tend to assume that memory leaks very much.  Surely my words can confirm users of this math package. <br><br>  <a href="http://www.viva64.com/ru/w/V773/">V773</a> Visibility Scope  A resource leak is possible.  killscilabprocess.c 35 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">killScilabProcess</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> exitCode)</span></span></span><span class="hljs-function"> </span></span>{ HANDLE hProcess; <span class="hljs-comment"><span class="hljs-comment">/* Ouverture de ce Process avec droit pour le tuer */</span></span> hProcess = OpenProcess(PROCESS_TERMINATE, FALSE, ....); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (hProcess) { <span class="hljs-comment"><span class="hljs-comment">/* Tue ce Process */</span></span> TerminateProcess(hProcess, exitCode); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { MessageBox(<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">"...."</span></span>, <span class="hljs-string"><span class="hljs-string">"Warning"</span></span>, MB_ICONWARNING); } }</code> </pre> <br>  Resource leak.  According to the documentation, after calling the <i>OpenProcess</i> function, you need to call the <i>CloseHandle</i> function. <br><br><h2>  Conclusion </h2><br>  At the moment, on the official website of Scilab, the stable version is considered to be Scilab 6.0.0, but as we have noticed, stability is far from here.  Although the latest version from the repository was checked with the analyzer, errors usually live in the code for a very long time, getting into the supposedly ‚Äústable‚Äù versions.  I myself was also a Scilab user, but long before I could see how many errors there were.  I hope that such software does not greatly inhibit the research of people using similar tools for mathematical calculations. <br><br>  The next proven project, in which there is a lot of mathematics, and it is in demand in various studies, will be the <a href="http://opencv.org/">OpenCV library</a> . <br><br>  <i>Note colleagues Andrei Karpov.</i>  The topic of this article strongly intersects with the thoughts that I have stated in the articles: <ul><li>  <a href="https://www.viva64.com/ru/b/0156/">Check Trans-Proteomic Pipeline (TPP) Project</a> </li><li>  <a href="https://www.viva64.com/ru/b/0212/">Large Calculator is out of control</a> </li></ul><br>  Perhaps readers will be interested to get acquainted with them. <br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0515/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0515/">Headache from using mathematical software</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/331638/">https://habr.com/ru/post/331638/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../331628/index.html">Everything you wanted to know about HPE Synergy Composable Infrastructure, questions and answers</a></li>
<li><a href="../331630/index.html">PHP Digest number 111 - the latest news, materials and tools (June 12 - 25, 2017)</a></li>
<li><a href="../331632/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ268 (June 19 - 25, 2017)</a></li>
<li><a href="../331634/index.html">Translation of excerpts from Robert Heinlein‚Äôs book, Take Your Government Back - part 25</a></li>
<li><a href="../331636/index.html">Overview of the main sections of the conference PG Day'17 Russia</a></li>
<li><a href="../331640/index.html">Announcement of Mobius 2017 Moscow: the conquest of Moscow</a></li>
<li><a href="../331642/index.html">Business planning in the gaming industry</a></li>
<li><a href="../331644/index.html">The story of one application: mobile "1C: Management of our company"</a></li>
<li><a href="../331646/index.html">‚ÄúThere is no such problem in Tarantula as a strong degradation with time and under load‚Äù - Vasily Soshnikov</a></li>
<li><a href="../331648/index.html">Manual monitoring of site availability (simple tools overview)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>