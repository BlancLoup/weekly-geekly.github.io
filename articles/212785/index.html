<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Radio-controlled switch do it yourself. Part 2 - Testing and Training</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This post is a continuation of a series of stories about how you can make a payload switch with your own hands. 

 In the first part , the hardware co...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Radio-controlled switch do it yourself. Part 2 - Testing and Training</h1><div class="post__text post__text-html js-mediator-article">  This post is a continuation of a series of stories about how you can make a payload switch with your own hands. <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fae/378/8db/fae3788db6430b0f920fda69aa82b8cb.jpg" width="520"></div><br>  In the <a href="http://habrahabr.ru/post/211126/">first part</a> , the hardware component was described: the features of its design and production. <br><br>  Today's post describes the steps to prepare the Arduino development environment and complete testing of the manufactured module. <br><a name="habracut"></a><br><blockquote>  To work with the manufactured module you need any ISP programmer.  I will use the existing <a href="http://learn.adafruit.com/usbtinyisp">USBtinyISP</a> , you can use the same or any other (for example, make ArduinoISP from the existing Arduino board). </blockquote><br>  Let me remind you that according to the final of the previous post we received a fully assembled device - all components are in their places. <br><br>  Now you need to check its performance. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Check MK </h4><br>  The easiest way to do this is as follows: connect a programmer and read the values ‚Äã‚Äãof fusions. <br><br>  Since the post is focused on beginners, I will use visual tools and show you how to do it as simply as possible: we will use the Avrdude-GUI GUI. <br><br><ol><li>  Download the Avrdude-GUI package <a href="http://yuki-lab.jp/hw/avrdude-GUI/">here</a> . </li><li>  Unpack the archive in any folder. </li><li>  Run avrdude-GUI. </li></ol><br>  After these simple actions, a window like this will appear: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fdb/015/003/fdb01500377a81c41ee256de8e3d15bc.png"></div><br><br>  Now it is necessary to make the minimum settings: select the used programmer (Programmer field), the used port (Port), specify the used MK (Device). <br><br>  Now we connect the programmer to the computer, and the programmer itself to our board. <br><br>  In the section "Fuse" press the button "Read".  If everything is done correctly, the fyuz values ‚Äã‚Äãwill appear in the corresponding fields: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/187/d8d/3a6/187d8d3a6acfb81736a972b4608362e9.png"></div><br><div class="spoiler">  <b class="spoiler_title">If something went wrong</b> <div class="spoiler_text">  The following errors are most likely: <br><br>  1. Somewhere not drunk (or vice versa, "snot").  Then, as a result of an attempt to count fusions, a message appears about this error: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4c1/01f/c3d/4c101fc3d9fd4cd0db644953b794b091.png"></div><br><br>  To correct the situation, disconnect the board from the programmer and check the quality of the soldering very meticulously: <br><ul><li>  use a fine needle to check how well all the legs of the MK are soldered </li><li>  Look through the magnifying glass for suspicious places </li><li>  ring the tester from the ISP connector to the MK, </li><li>  Check the power circuit. </li></ul><br><br>  2. Wrong type of MK.  The error message will look something like this: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1af/3dd/e36/1af3dde3633da3c246fbf2b48bdb9577.png"></div><br><br>  In my case, just such an error arose.  This happened due to the fact that I used ATmega168 <b>p</b> , and in the program I chose ATmega168. <br>  These chips are as close as possible, but they have different signatures, which the system carefully reported.  At the same time, the program also suggests a solution to the problem - check the correctly selected chip or disable signature verification (by adding the "-F" key in the "Command Line Option" field). <br><br>  I used exactly the second solution (in this case it is absolutely normal). <br><br>  It would be more correct, of course, to open the avdude.conf file and add information about the ATmega168p there, but we will leave this on my conscience. <br></div></div><br>  Using the same shell, you can write the necessary fyuzy. <br><br>  In our case, it is required to ensure the operation of the MC from the internal oscillator at a frequency of 8 MHz.  To do this, you can use for ATmega168p those values ‚Äã‚Äãthat are shown above in the screenshot. <br><br><blockquote>  Fyuza "explain" MK, in which mode it should work.  It is possible to prescribe what values ‚Äã‚Äã(or to understand the values ‚Äã‚Äãgiven above) using the AVR fusion calculator, which is available, for example, via <a href="http://payalo.at.ua/c_fuse/calc.html">this link</a> . </blockquote><br>  Now we can proceed to the next stage: checking the possibility of programming the MK and testing the rest of the "periphery" on the board. <br><br><h4>  Preparing the development environment </h4><br>  To do this, one more preparatory step should be taken: it is necessary to create an appropriate ‚Äúcharge‚Äù for the Arduino environment.  This is done as follows: you need to open the boards.txt file in the \ ARDUINO \ hardware \ arduino folder with a text editor, where ‚ÄúARDUINO‚Äù is the root folder where the development environment is located. <br><br>  The following lines must be added to this file: <br><br><pre><code class="hljs coffeescript"><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">######</span></span><span class="hljs-comment"><span class="hljs-comment">## s168po8.name=Sensor168p (int8MHz, 1.8V) s168po8.upload.protocol=arduino s168po8.upload.maximum_size=14336 s168po8.upload.speed=19200 s168po8.bootloader.low_fuses=0xe2 s168po8.bootloader.high_fuses=0xde s168po8.bootloader.extended_fuses=0x00 s168po8.bootloader.path=atmega s168po8.bootloader.file=ATmegaBOOT_168_pro_8MHz.hex s168po8.bootloader.unlock_bits=0x3F s168po8.bootloader.lock_bits=0x0F s168po8.build.mcu=atmega168p s168po8.build.f_cpu=8000000L s168po8.build.core=arduino s168po8.build.variant=standard ##############################################################</span></span></code> </pre> <br>  The first line indicates the ‚Äúname of the board‚Äù, which you will then choose in the programming environment (you can specify whatever you like). <br>  Pay special attention to the parameters that describe the fyuzy, type MK and the frequency at which the device will operate. <br><br>  After these simple manipulations, you can launch the Arduino environment and make sure that the ‚Äúnew board‚Äù appeared in the list of available ones (in the ‚ÄúService - Board‚Äù menu, choose ours: Sensor168p (int8MHz, 1.8V)). <br><br><h4>  Test buttons and relays </h4><br>  Let me remind you that according to the circuitry, the keys for controlling the relay are connected to the digital pins D3 and D4, and the buttons to the analog A1 and A0. <br><br>  Let's make the simplest test to check the normal functioning of buttons and relays: <br><br><pre> <code class="hljs pgsql">//  <span class="hljs-type"><span class="hljs-type">int</span></span> r1 = <span class="hljs-number"><span class="hljs-number">3</span></span>; // D3 <span class="hljs-type"><span class="hljs-type">int</span></span> r2 = <span class="hljs-number"><span class="hljs-number">4</span></span>; // D4 //  <span class="hljs-type"><span class="hljs-type">int</span></span> b1 = <span class="hljs-number"><span class="hljs-number">15</span></span>; // A1 <span class="hljs-type"><span class="hljs-type">int</span></span> b2 = <span class="hljs-number"><span class="hljs-number">14</span></span>; // A0 <span class="hljs-type"><span class="hljs-type">void</span></span> setup() { //  pinMode(r1, OUTPUT); pinMode(r2, OUTPUT); //  pinMode(b1, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); pinMode(b2, <span class="hljs-keyword"><span class="hljs-keyword">INPUT</span></span>); //      digitalWrite(b1, HIGH); digitalWrite(b2, HIGH); } <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>() { //    b1 -   r1 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(b1) == LOW) { digitalWrite(r1, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite(r1, LOW); } //    b2 -   r2 <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (digitalRead(b2) == LOW) { digitalWrite(r2, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite(r2, LOW); } }</code> </pre><br>  Download this test to our device. <br><br>  Before downloading, do not forget to select the programmer used in the ‚ÄúTools‚Äù - ‚ÄúProgrammer‚Äù menu. <br><br>  Since the programmer is used, the procedure is slightly different - in the ‚ÄúFile‚Äù menu, select the item ‚ÄúDownload using the programmer‚Äù (or simply press the key combination Ctrl + Shift + U). <br><br>  If everything is done correctly, then when the buttons are closed, the corresponding relays will click. <br><br><blockquote>  The above test sketch does not work ‚Äúbounce‚Äù and is needed solely for a quick check of the functioning of the board. </blockquote><br><div class="spoiler">  <b class="spoiler_title">If something went wrong</b> <div class="spoiler_text">  There are two typical problems: <br><ol><li>  Something is incorrectly done in the Arduino environment (then there are messages about problems with loading in MK). </li><li>  Problems in the hardware (in this case, the download is successful, but the relay does not click). </li></ol><br>  In the first case, you need to check all the steps that are described earlier (working with the boards.txt file, correctly selected result board and programmer). <br><br>  In the second case, the best assistants will again be the circuit diagram, a magnifying glass, a sharp needle and a tester. <br></div></div><br><br>  After this, it remains only to check whether everything is in order with the nRF24L01 + connector. <br><br><h4>  Interface test for nRF24L01 + </h4><br>  At this stage, we will not write the code, but simply check the electrical circuits: when the programmer is connected (or 5V power supply), we measure the voltage between 1 and 2 pins of the RF24 connector - it should be 3.3V. <br><br>  Now turn off the programmer (or power supply) and run through all the circuits of the connector for the absence of a short circuit between adjacent ones and the presence of a connection with the corresponding pins MK (see the diagram from the <a href="http://habrahabr.ru/post/211126/">previous post</a> ). <br><br><h4>  High Voltage Check </h4><br>  Since our device will later commute a high-voltage load, you should check this part very carefully: <br><ol><li>  Inspect the board very carefully (the part where the relays and terminal blocks are located for connecting the load), eliminate all suspicious places, the soldering should be very reliable.  There should be no ‚Äúextra‚Äù connections. </li><li>  Call the tester all the circuits, at the same time determine which terminals on the terminals you have are normally closed (NC) and normally open (NO) contacts. </li></ol><br><br><h4>  Result </h4><br>  After all the checks you have on hand, the module is fully functional and fully ready for subsequent programming.  Your programming environment is also prepared for the next steps. <br><br>  <i><b><a href="http://habrahabr.ru/post/215177/">To be continued</a> ...</b></i> <br><br>  <b>Useful links</b> : <br><ul><li>  <a href="http://arduino.cc/en/Tutorial/ArduinoISP">Arduino ISP</a> </li><li>  <a href="http://habrahabr.ru/post/144620/">Using the Arduino UNO as a programmer</a> </li><li>  <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-konfiguraciya-fuse-bit.html">AVR.</a>  <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-konfiguraciya-fuse-bit.html">Training course.</a>  <a href="http://easyelectronics.ru/avr-uchebnyj-kurs-konfiguraciya-fuse-bit.html">FUSE configuration bit</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/212785/">https://habr.com/ru/post/212785/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212773/index.html">Namespace in PHP, clarification</a></li>
<li><a href="../212775/index.html">News digest from the world of mobile development for the last week ‚Ññ40 (February 10-16, 2014)</a></li>
<li><a href="../212777/index.html">How to challenge Instagram and not screw it up: briefly about the service Tuffle</a></li>
<li><a href="../212779/index.html">Game bots. Start</a></li>
<li><a href="../212783/index.html">BitTorrent will release a mobile application for organizing peer-to-peer video broadcasts</a></li>
<li><a href="../212789/index.html">Python-digest # 14. News, interesting projects, articles and interviews [February 9, 2014 - February 16, 2014]</a></li>
<li><a href="../212791/index.html">An educational platform for all. Idea and first steps</a></li>
<li><a href="../212793/index.html">C ++ User Group in Russian</a></li>
<li><a href="../212795/index.html">"The world's most circular object" can become a new kilo measure</a></li>
<li><a href="../212797/index.html">Top 10 Most Breakthrough Technologies of 2013 and Startups Based on Them</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>