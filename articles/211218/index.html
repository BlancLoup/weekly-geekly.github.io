<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Replication of data from MySQL to MongoDB</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are cases when you need to change the architecture of the system on the go. You may have found a bottleneck in your project or decided that with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Replication of data from MySQL to MongoDB</h1><div class="post__text post__text-html js-mediator-article"><img width="200" align="left" src="https://habrastorage.org/getpro/habr/post_images/bd5/235/a59/bd5235a59ec1dac670be72dd88aa5214.png"><br>  There are cases when you need to change the architecture of the system on the go.  You may have found a bottleneck in your project or decided that with the current growth rate, problems with scaling or fault tolerance may soon arise.  Just for such cases there Tungsten Replicator. <br>  Tungsten Replicator is a free, open source, Java-based application that extends the replication functionality of MySQL.  Tungsten has a wide range of capabilities, including multi-master replication, parallel replication, heterogeneous data replication between MySQL and Oracle, PostgreSQL, MongoDB.  This article will discuss heterogeneous replication of the MySQL wizard with a slave MongoDB server, CentOS 6.5 will act as the OS. <a name="habracut"></a><br><br>  <b>Dependency installation</b> <br><br>  Since Tungsten Replicator is written by java, you at least need to install OpenJDK 1.6 or Oracle Java 6. Also, some of the scripts are written in ruby, so you will need to install it too (versions =&gt; 1.8) if you don‚Äôt have it yet: <br> <code># yum install java-1.6.0-openjdk ruby</code> <br> <br>  <b>MySQL installation</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      If you already have a MySQL Server installed, you will only need to correct its configuration, as described below, and have a user to replicate. <br><div class="spoiler">  <b class="spoiler_title">If MySQL is not installed yet, click here.</b> <div class="spoiler_text">  Connect the necessary repositories: <br> <code><a href=""></a> # rpm -Uvh download.fedoraproject.org/pub/epel/6/x86_64/epel-release-6-8.noarch.rpm</code> <br> <code><a href=""></a> # rpm -Uvh rpms.famillecollet.com/enterprise/remi-release-6.rpm</code> <br> <br>  Install MySQL Server 5.5: <br> <code># yum --enablerepo=remi install mysql mysql-server</code> <br> <br>  Adjust MySQL configuration for replication needs: <br> <code># vim /etc/my.cnf</code> <br> <br><pre> <code class="bash hljs">‚Ä¶ <span class="hljs-comment"><span class="hljs-comment">#   ‚Äú‚Äù server-id = 1 #     log_bin = /var/log/mysql/mysql-bin.log expire_logs_days = 10 #    MongoDB       ‚ÄúROW‚Äù binlog_format = ROW #     max_binlog_size = 256M #         sync_binlog = 1 ...</span></span></code> </pre><br>  We activate the automatic start of MySQL when the system boots and start the service: <br> <code># chkconfig --level 35 mysqld on</code> <br> <code># service mysqld start</code> <br> <br>  Run the initial MySQL installation script and set the password for root. <br> <code># mysql_secure_installation</code> <br> <br><pre> <code class="bash hljs">Enter current password <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> root (enter <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> none): Change the root password? [Y/n] y New password: SomeSecretPasswD Re-enter new password: SomeSecretPasswD Remove anonymous users? [Y/n] y Disallow root login remotely? [Y/n] y Remove <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> database and access to it? [Y/n] y Reload privilege tables now? [Y/n] y</code> </pre><br>  For replication, it is desirable to have a separate user: <br> <code># mysql -u root -p</code> <br> <code># mysql &gt; grant all on *.* to tungsten identified by 'password' with grant option;</code> <br> <code>Query OK, 0 rows affected (0.01 sec)</code> <br> </div></div><br><br>  <b>Install MongoDB</b> <br><br>  If you already have MongoDB, you can proceed to the next item. <br><div class="spoiler">  <b class="spoiler_title">If not, Mongo installation instructions are here.</b> <div class="spoiler_text">  Let's connect the MongoDB repository: <br> <code># vim /etc/yum.repos.d/mongodb.repo</code> <br> <br><pre> <code class="bash hljs">[mongodb] name=MongoDB Repository baseurl=http://downloads-distro.mongodb.org/repo/redhat/os/x86_64/ gpgcheck=0 enabled=1</code> </pre><br>  And install the MongoDB Server 2.4 packages: <br> <code># yum install mongo-10gen mongo-10gen-server</code> <br> <br>  Activate the automatic launch of MongoDB when the system boots and start the service: <br> <code># chkconfig --level 35 mongodb on</code> <br> <code># service mongodb start</code> <br> <br>  To check the serviceability of the service, see the list of databases: <br> <code># mongo</code> <br> <code>MongoDB shell version: 2.4.3</code> <br> <code>connecting to: test</code> <br> <code>&gt; show dbs</code> <br> <code>local 0.078125GB</code> <br>  By default, authorization is not required. <br></div></div><br>  <b>Installing the master replicator for MySQL</b> <br><br>  The current, at the time of this writing, the version of the replicator is on this link. <br>  To begin with, we will make several directories for our replicator, for example in / opt: <br> <code># cd /opt</code> <br> <code># mkdir replicator</code> <br> <code># cd replicator</code> <br> <code># mkdir mysql #      -</code> <br> <code># mkdir mongodb #     </code> <br> <br>  Download the archive with the replicator in the current directory: <br> <code><a href=""></a> # wget tungsten-replicator.googlecode.com/files/tungsten-replicator-2.2.0-292.tar.gz</code> <br> <code># tar -xzf tungsten-replicator-2.2.0-292.tar.gz</code> <br> <code># mv tungsten-replicator-2.2.0-292/ tungsten-replicator/</code> <br> <br>  Now, we will prepare an installation script for the master replicator: <br> <code># vim master-installer.sh</code> <br> <br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/replicator/tungsten-replicator ./tools/tungsten-installer --master-slave -a \ --datasource-type=mysql \ --master-host=127.0.0.1 \ --datasource-user=tungsten \ --datasource-password=password \ --datasource-mysql-conf=/etc/my.cnf --datasource-log-directory=/var/<span class="hljs-built_in"><span class="hljs-built_in">log</span></span>/mysql/ --datasource-port=3306 \ --service-name=mongodb \ --home-directory=/opt/replicator/mysql \ --cluster-hosts=127.0.0.1 \ --thl-port=10001 \ --rmi-port=11001 \ --java-file-encoding=UTF8 \ --mysql-use-bytes-for-string=<span class="hljs-literal"><span class="hljs-literal">false</span></span> \ --mysql-enable-enumtostring=<span class="hljs-literal"><span class="hljs-literal">true</span></span> \ --mysql-enable-settostring=<span class="hljs-literal"><span class="hljs-literal">true</span></span> \ --svc-extractor-filters=colnames,pkey \ --svc-parallelization-type=none --start-and-report</code> </pre><br>  In this configuration, everything will be replicated, i.e.  each base along with all the tables. <br>  If you need to replicate strictly defined tables, you can immediately identify the filter by replacing the penultimate line (svc-extractor-filters) in the script with: <br><pre> <code class="bash hljs"> --svc-extractor-filters=replicate \ <span class="hljs-string"><span class="hljs-string">"--property=replicator.filter.replicate.do=db1.table1,db2.table2,dbN.tableN"</span></span> \</code> </pre>  Accordingly, instead of db1.table1, etc., specify your bases and tables, which you will need to replicate. <br>  For the master everything is ready, we can run the installation script: <br> <code># sh master-installer.sh</code> <br> <blockquote>  INFO &gt;&gt; 127_0_0_1 &gt;&gt; Getting services list <br>  INFO &gt;&gt; 127_0_0_1 &gt;&gt; ... <br>  Processing services command ... <br>  NAME VALUE <br>  - - appliedLastSeqno: 0 <br>  appliedLatency: 1.218 <br>  role: master <br>  serviceName: mongodb <br>  serviceType: local <br>  started: true <br>  state: ONLINE <br>  Finished services command ... </blockquote>  The wizard is ready, now you can connect one or several slaves to it - MySQL or PostgreSQL for example.  But our goal is replication with MongoDB, let's move on to it. <br><br>  <b>Installing a slave replicator for MongoDB</b> <br><br>  Prepare a script for the installation of a slave replicator, which will pump up data in MongoDB. <br> <code># vim slave-installer.sh</code> <br> <pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /opt/replicator/tungsten-replicator tools/tungsten-installer --master-slave -a \ --datasource-type=mongodb \ --master-host=127.0.0.1 \ --service-name=mongodb \ --home-directory=/opt/replicator/mongodb \ --cluster-hosts=127.0.0.1 \ --datasource-port=27017 \ --master-thl-port=10001 \ --thl-port=10002 \ --rmi-port=11002 \ --java-file-encoding=UTF8 \ --skip-validation-check=InstallerMasterSlaveCheck \ --svc-parallelization-type=none --start-and-report</code> </pre>  Note that I am replicating on one host, if you need to replicate to another host, do not forget to specify the correct host address on which you have a master and open the corresponding ports in the firewall (thl-port, rmi-port). <br>  If all conditions are met, you can run the installation script. <br> <code># sh slave-installer.sh</code> <br> <blockquote>  WARN &gt;&gt; 127.0.0.1 &gt;&gt; Currently she is in mongodb <br>  INFO &gt;&gt; 127_0_0_1 &gt;&gt; Getting services list <br>  INFO &gt;&gt; 127_0_0_1 &gt;&gt; Processing services command ... <br>  NAME VALUE <br>  - - appliedLastSeqno: 0 <br>  appliedLatency: 0.5 <br>  role: slave <br>  serviceName: mongodb <br>  serviceType: local <br>  started: true <br>  state: ONLINE <br>  Finished services command ... <br></blockquote>  If you see the status ‚ÄúONLINE‚Äù in the ‚Äústate‚Äù line, then the installation was successful and you can try to check if the replication is working. <br><br>  <b>Replication check</b> <br><br>  Before proceeding with the verification, you need to understand how you can transfer data from a relational database to a non-relational database, such as MongoDB.  Indeed, in contrast to traditional DBMS such as MySQL, Oracle and others that store data in tables, in Mongo the data is stored in a simplified form - ‚Äúkey - value‚Äù.  Therefore, the data from MySQL tables need to be translated into MongoDB ‚Äúcollections‚Äù.  In this case, only the operations of ‚Äúinserting‚Äù, ‚Äúupdating‚Äù and ‚Äúdeleting‚Äù tables can replicate; the other operations (CREATE / DROP / ALTER) will be ignored by the replicator. <br>  Check how the inserts will be replicated.  To do this, we make a test scheme and a table: <br> <code>mysql&gt; create schema testdb;</code> <br> <code>mysql&gt; use testdb;</code> <br> <code>mysql&gt; create table testrepl (id int not null primary key, name char(20), date date);</code> <br> <code>Query OK, 0 rows affected (0.00 sec)</code> <br>  We make two arbitrary inserts: <br> <code>mysql&gt; insert into testrepl values (1, 'Vasya', '1965-01-01');</code> <br> <code>Query OK, 1 row affected (0.00 sec)</code> <br> <code>mysql&gt; insert into testrepl values (2, 'Petya', '1991-02-02');</code> <br> <code>Query OK, 1 row affected (0.00 sec) <br></code> <br>  Now let's see what the replicator generated on the slave side: <br> <code>&gt; show dbs</code> <br> <code>local 0.078125GB</code> <br> <code>testdb 0.203125GB</code> <br> <code>tungsten_mongodb 0.203125GB</code> <br> <code>&gt; use testdb</code> <br> <code>switched to db testdb</code> <br> <code>&gt; show collections</code> <br> <code>testrepl</code> <br> <code>system.indexes</code> <br> <code>&gt; db.testdb.find()</code> <br> <code>{ "_id" : ‚Äú01‚Äù, "id" : "1", "name" : "Vasya", "date" : "1965-01-01" }</code> <br> <code>{ "_id" : ‚Äú02‚Äù, "id" : "2", "name" : "Petya", "date" : "1991-02-02" }</code> <br> <br>  Check how updates are replicated: <br> <code>mysql&gt; update testrepl set name = 'Vasya P' where id =1;</code> <br> <code>Query OK, 1 row affected (0.01 sec)</code> <br> <code>Rows matched: 1 Changed: 1 Warnings: 0</code> <br> <br>  Result in Mongo: <br> <code>&gt; db.testrepl.find()</code> <br> <code>{ "_id" : ‚Äú01‚Äù, "id" : "1", "name" : "Vasya P", "d" : "1965-01-01" }</code> <br> <code>{ "_id" : ‚Äú02‚Äù, "id" : "2", "name" : "Petya", "date" : "1991-02-02" }</code> <br> <br>  The replicator also handles removal: <br> <code>mysql&gt; delete from testrepl where id =2;</code> <br> <code>Query OK, 1 row affected (0.00 sec)</code> <br>  Record on the receiver also retired: <br> <code>&gt; db.myfirst.find()</code> <br> <code>{ "_id" : ‚Äú01‚Äù, "id" : "1", "name" : "Vasya P", "d" : "1965-01-01" }</code> <br> <br>  We looked at several examples showing how replication works.  To finally make sure that the replicator does its job, you can try to upload some big dump, and then count the number of tables and collections in MySQL and MongoDB, respectively. <br><br>  You can check the status of replication, restart the replicator, or stop replication with the trepctl command from the corresponding service directory: <br> <code># cd /opt/replicator/</code> <br>  For a slave (MongoDB): <br> <code># ./mongodb/tungsten/tungsten-replicator/bin/trepctl status</code> <br>  And for the wizard (MySQL): <br> <code># ./mysql/tungsten/tungsten-replicator/bin/trepctl status</code> <br> <br>  Details on how to manage the replication service will tell you the option ‚Äúhelp‚Äù. <br><br>  <b>What for?</b> <br><br>  The logical question is, why might replication be needed with MongoDB or some other DBMS?  There may be several scenarios.  For example, the developer‚Äôs desire to experience the benefits of a non-relational DBMS.  Or maybe use the data to create a new application designed for use with MongoDB. <br><br><div style="text-align:center;"><img alt="Tungsten Replicator Application Options" src="https://habrastorage.org/getpro/habr/post_images/7c3/490/eb6/7c3490eb6d7cd4350b2a0a4faa14a940.png"></div><br><br>  In conclusion, it is worth noting that Tungsten Replicator may be for you the same useful tool for various MySQL replication options as it has become for <a href="http://centos-admin.ru/">us</a> .  Its functionality is wide and the description may take more than one article.  However, the official site has enough detailed documentation.  Some may be interested in a paid enterprise version from Continuent.  In the enterprise edition, in addition to the benefits of the community version, it is claimed: automatic recovery, fault tolerance, upgrade without downtime, and other goodies, but for a lot of money. <br><br>  Tungsten Replicator Documentation: <br>  <a href="https://code.google.com/p/tungsten-replicator/wiki/TRCHeterogeneousReplication">Heterogeneous Replication</a> <br>  <a href="https://code.google.com/p/tungsten-replicator/wiki/TRCHeterogeneousReplication">MySQL to MongoDB Replication</a> <br>  <a href="https://code.google.com/p/tungsten-replicator/wiki/TRCAdministration">Administration</a> <br>  Useful articles: <br>  <a href="http://datacharmer.blogspot.ru/2013/04/installing-and-administering-tungsten.html">Installing and Administering Tungsten Replicator</a> <br>  <a href="http://datacharmer.blogspot.ru/2013/05/getting-started-with-replication-from.html">Getting started with replication from MySQL to MongoDB</a> <br><br>  <a href="http://docs.mongodb.org/manual/">MongoDB Manual</a> </div><p>Source: <a href="https://habr.com/ru/post/211218/">https://habr.com/ru/post/211218/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../211206/index.html">Incoding Rapid Development Framework (part 2 CQRS)</a></li>
<li><a href="../211208/index.html">Evolution in data center networks. Software defined SDN</a></li>
<li><a href="../211210/index.html">Browser Development - Functional Level</a></li>
<li><a href="../211214/index.html">Cybersquatting in new zones will not be a problem</a></li>
<li><a href="../211216/index.html">iOS leaves your phone number hostage</a></li>
<li><a href="../211220/index.html">20 professions of the future</a></li>
<li><a href="../211222/index.html">Creating project office tools based on Microsoft Project Server</a></li>
<li><a href="../211224/index.html">From Google Play removed for alternative methods of receiving payments</a></li>
<li><a href="../211226/index.html">About text adventures - back to basics</a></li>
<li><a href="../211228/index.html">Google banned the application for payment through PayPal</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>