<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>POHMELFS: NFS in a new way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Those who followed the kernel updates may have noticed that POHMELFS support was added to release 2.6.30. 
 What is it - Hangover file? 
 The study of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>POHMELFS: NFS in a new way</h1><div class="post__text post__text-html js-mediator-article"> Those who followed the kernel updates may have noticed that POHMELFS support was added to release 2.6.30. <br>  What is it - Hangover file? <br>  The study of the vicinity of the project <a href="http://www.ioremap.net/projects/pohmelfs">page</a> suggested that the development of the FS is carried out by Moscow programmer Yevgeny Polyakov (and only he!), Who has many other interesting projects on the same site, such as the <a href="http://www.ioremap.net/projects/carp">CARP port for Linux</a> .  In general, the impression was that the programmer was extremely competent and stubborn. <br>  Let's go back to <b>PohmelFS</b> .  <a href="http://en.wikipedia.org/wiki/POHMELFS">The</a> Wikipedia article confirms the hangover's involvement in the name, which for the sake of decency stands for <b>Parallel Optimized Host Message Exchange Layered File System</b> .  The documentation on the project‚Äôs page indicates that in the future, PohmelFS is a distributed FS with redundancy, access control and other delights, developed so as not to lag much behind the performance of local FSs.  A sort of alternative to a variety of GFS, GlusterFS and other Coda.  But all this will be after the integration of the project with two others - <a href="http://www.ioremap.net/projects/dst">DST</a> and <a href="http://www.ioremap.net/projects/elliptics">Elliptics</a> .  At the moment, PohmelFS is an alternative to the old bad NFS, which shows better performance ( <a href="http://www.ioremap.net/node/134">pruflink</a> ) almost everywhere. <br><br>  under habrakat process of adjustment on a small zoo <br><a name="habracut"></a><br>  A new thing, unknown, how to use it - no one really knows.  I found a single howto on the web, and that is not very clever.  Therefore, here I publish a literate (in my opinion) method of elementary customization. <br><br>  The first thing to do is download the 2.6.30 kernel sources and build the kernel with the pohmelfs module.  At the time of publication, the driver had staging status, therefore its inclusion in the menuconfig is nontrivial.  You need to turn on the <b>Device Drivers -&gt; Staging drivers</b> option and <i>turn off</i> <b>Device Drivers -&gt; Staging drivers -&gt; Exclude Staging drivers from being built</b> , after which you can enable POHMELFS, which is also there. <br>  It should be noted that the kernel needs to be updated <i>only</i> on the client.  The server part works in userspace. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The second thing that is needed for the FS to work is the userspace utilities and server.  It is necessary to compile the source.  I downloaded the latest snapshot pohmelfs-server.git from here.  To those who will do the same, I‚Äôll tell you that the snapshots are distributed in the format tar.bz2, which you need to know if you don‚Äôt know. <br>  Unpack, read README, put /usr/src/linux/drivers/staging/pohmelfs/netfs.h where it recommends the beginning of the README, that is, /usr/src/linux/fs/pohmelfs/netfs.h (this is very important , because there is no place to take this file on the server, but to build the server it is necessary).  Carefully, the path to the sources of the kernel may be different.  Thereafter <br> <code>$ ./autogen.sh <br> $ ./configure</code> <br>  The autogen can complain about anything, it is treated in an obvious way. <br>  But configure under Gentoo swore at the impossibility of finding POHMELFS inclusions, and only when reading the log it turned out that the problem was not really in netfs.h, but in bitsperlong.h, which he had not found for some unknown reason .  I had to configure it like this: <br> <code>$ CPPFLAGS=-I/usr/src/linux-2.6.30-git18/arch/x86/include ./configure --with-kdir-path=/usr/src/linux</code> <br>  Then you can do make, then he will collect everything he can.  I went the other way. <br>  On the server, the build and installation looked like this: <br> <code>$ cd server; make <br> # cp fserver /usr/local/sbin</code> <br>  On the client, in turn: <br> <code>$ cd cfg; make; cd ../utils; make; cd .. <br> # cp cfg/cfg /usr/local/sbin/pohmelcfg; cp utils/flush /usr/local/sbin/pohmelflush</code> <br>  This is an important deviation from the Makefile, since now only the server part is installed on the server, and only the client part on the client, and so far unnecessary inclusions are not installed at all.  Client binaries have also been renamed into more understandable names, since, for example, ‚Äúcfg‚Äù does not say that it only configures pohmelfs. <br>  User space utilities successfully assembled on both Gentoo x86_64 and Arch Linux i686. <br><br>  The moment of truth comes.  Run! <br>  First, run the server part.  fserver works in the foreground, so first we do it like this: <br> <code># /usr/local/sbin/fserver -a 192.168.1.10 -r /mnt/HD_a2/ -w5 2&gt;&amp;1 &gt;&gt;/var/log/fserver.log &amp;</code> <br>  (Substitute the desired parameters, -w is the number of worker processes) <br><br>  Further - setup and mounting of FS on the client. <br> <code># modprobe pohmelfs <br> # pohmelcfg -A add -a 192.168.1.10 -p 1025 -i 1 <br> # mount -t pohmel -o idx=1 /mnt/pohmel</code> <br>  Here, -i for cfg and idx = for mount should be the same, the default is 0. As I understand it, this is just the ID of the installed rack. <br><br>  My server and client launch did not cause any difficulties, it all worked right away. <br>  Small performance test (700MB file): <br> <code>stolen@stolen ~/soft/pohmelfs-server.git $ time cat /mnt/pohmel/share/GRTMPVOL_RU_20.10.08.iso &gt;/dev/null <br> real 1m37.150s <br> user 0m0.010s <br> sys 0m1.270s <br> <br> stolen@stolen ~/soft/pohmelfs-server.git $ time cat /mnt/pohmel/share/GRTMPVOL_RU_20.10.08.iso &gt;/dev/null <br> real 0m0.591s <br> user 0m0.003s <br> sys 0m0.257s <br> <br> stolen@stolen ~/soft/pohmelfs-server.git $ time cat /mnt/upload/share/GRTMPVOL_RU_20.10.08.iso &gt;/dev/null <br> real 1m3.719s <br> user 0m0.003s <br> sys 0m0.400s <br></code> <br>  The third is NFS, a little winning on reading.  By recording 100MB POHMELFS was 10 times faster, apparently due to background I / O. </div><p>Source: <a href="https://habr.com/ru/post/62685/">https://habr.com/ru/post/62685/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../62678/index.html">repquota server loads - how to treat</a></li>
<li><a href="../62680/index.html">Bugreport on materials of preparation for the exam on computer science</a></li>
<li><a href="../62681/index.html">Uncovered ZFS</a></li>
<li><a href="../62683/index.html">Apple officially rejected the Commodore 64 emulator for iPhone</a></li>
<li><a href="../62684/index.html">help collect Ubuntu disk collection</a></li>
<li><a href="../62686/index.html">Reservation link error in icq</a></li>
<li><a href="../62689/index.html">Copyright and music</a></li>
<li><a href="../62690/index.html">VIDEO medicine library</a></li>
<li><a href="../62691/index.html">Do I need manual processing of search results on the Internet?</a></li>
<li><a href="../62694/index.html">Request Processing in ASP.NET MVC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>