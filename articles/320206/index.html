<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>On the fabulous Bali snow fell or how easy it is to deceive the GPS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good afternoon, judging by the photos, snow fell on Bali! How did it happen? 
 Cry 


 Recently, I have to deal with the design and manufacture of sat...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>On the fabulous Bali snow fell or how easy it is to deceive the GPS</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/files/036/111/797/0361117975e240e9b862d6763e518b2b.jpg" alt="image"></p><br><p>  Good afternoon, judging by the photos, snow fell on Bali!  How did it happen? </p><br><h2 id="plach">  Cry </h2><br><p>  Recently, I have to deal with the design and manufacture of satellite navigation antennas, antenna arrays and radio receivers.  It should be noted here that these radio controllers are converters of the navigation signal to a form convenient for further processing, and not those navigation receivers that provide the solution to the navigation task and which are built into your gadgets. </p><br><p>  When testing antennas, especially their new designs, in a normal city room there are problems with good radio satellite visibility.  Roughly speaking, it is difficult to understand the new antenna better or worse than the old one; the modified scheme of matching the radio frequency response with the antenna gave or not an improvement in the sensitivity of the system.  About the antenna array in general can not speak.  In addition, personally in my case, there is some kind of hindrance that interferes with the reception.  It is necessary to move away from the window and the receiver loses the satellites, although the direct visibility of a quarter of the sky is preserved. </p><br><p>  In summer, the cottage becomes salvation.  There is almost a free sky and there is no interference.  But there you must either go with all the property, or keep there an additional set of it.  There are also comrades from the past work, who give work in an anechoic chamber.  I do not know why, but there is such happiness. </p><br><p>  In general, the share of the developer is not easy. </p><br><h2 id="udacha">  Luck </h2><br><p>  Recently I was lucky to get close to solving this problem.  I always knew about navigation signal simulators, but they were expensive for me.  There have been some happy events. <a name="habracut"></a></p><br><ol><li><p>  One friend from Moscow at the meeting spoke about the GPS simulator, published by Professor Ebinuma in the source code. </p><br></li><li><p>  I was already acquainted with the professor by correspondence and I had confidence in him and his workings out.  It was possible to begin work, hoping for the consultation of the professor. </p><br></li><li>  I have long had a fee for USRP B210, and it was listed in the list of supported cards. </li></ol><br><p>  It was thought that it would be cool to be able to test antennas and radio control devices is stable and predictable. </p><br><p>  And then, it was thought, this is our almost traditional Russian fun - to deceive the GPS.  I remembered how I myself recently was dropped informationally from the metro station Tretyakovskaya at Vnukovo Airport.  And you can even make something like a matryoshka - to launch a false signal on the Tretyakov, as if I were on the Tretyakov. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/10b/772/636/10b7726362f247f3be07d26f27ece388.png"></div><br><p>  <em>An illusion, but it can help to calm many troubled people, especially in the spring.</em>  <em>And how is it in Russian, damn it!</em> </p><br><p>  After all, if <em>they</em> can, then why should not we?  But we must especially make a reservation that the launch of the simulator was carried out at minimum power <del>  10 kW </del>  and even without connecting the antenna <del>  all the hair on my head fell out </del>  .  We ask everyone to be careful when experimenting. <del>  and wear a foil cap </del>  so as not to destroy the navigation space of the people around and <del>  specialist </del>  services.  It is also worth recalling that ignorance of the laws is no excuse.  And that in Russia it is customary not to blame not only on the bag. </p><br><p>  All down with the philosophy!  To the point!  Less letters, more pictures! </p><br><h2 id="kak-zapustit">  How to start </h2><br><p>  To launch our global positioning system, earlier we would need an orbital constellation of satellites, ground stations, etc.  Now everything is easier. </p><br><p>  We need: </p><br><ol><li><p>  A computer with an operating system such as Windows or Linux and, preferably, with a USB 3.0 port.  On port 2.0, I did not test, but it should work. </p><br></li><li><p>  <a href="https://www.ettus.com/product/details/UB210-KIT">USRP b210 board</a> (other options are possible). </p><br></li><li><p>  The generated file with the signal, or the program for its generation GPS-SDR-SIM from prof.  Ebinums. </p><br><ul><li>  <a href="http://blog.goo.ne.jp/osqzss">Professor's blog</a> (a bit not in Russian) </li><li>  <a href="https://github.com/osqzss/gps-sdr-sim">Simulator Sources</a> </li></ul><br></li></ol><br><h3 id="poryadok-ustanovki">  Installation Procedure </h3><br><p>  To run all this <em>stuff</em> on the computer, you must <em>quickly and carefully</em> install <a href="http://files.ettus.com/binaries/uhd_stable/">a software</a> set from the board manufacturer.  Although it may not be necessary.  But let it be.  When installing under Windows, it sometimes complains that it cannot add itself to the PATH, but this does not interfere, because of all this stuff, I only needed the utility uhd_find_devices.exe, which allowed me to understand if I saw the system at all.  You can find the utility at: </p><br><pre><code class="hljs javascript">C:<span class="hljs-regexp"><span class="hljs-regexp">/UHD/</span></span>bin/uhd_find_devices.exe</code> </pre> <br><p>  Then we stick the board and open the device manager.  Where can I find that the driver under the device is not installed automatically.  What - happens.  Manually using the <a href="http://zadig.akeo.ie/">zadig</a> program, <a href="http://zadig.akeo.ie/">we</a> indicate to the system that for the fee we need to use the libusb drivers, i.e.  winusb. </p><br><p>  After the system picked up the standard driver, you can run uhd_find_devices from the software set from the board manufacturer.  This utility should find a board and flash its controller (Cypress FX3 costs there).  It seems that after that the device will change its PID and it will be necessary to tell the system (using zadig) that you can use standard winusb drivers for this device. </p><br><p>  Of course, it will not work the first time.  And of course this can be cured by unplugging the board and connecting it back.  Here are the <a href="https://www.youtube.com/watch%3Fv%3Dp85xwZ_OLX0">detailed instructions</a> . </p><br><p>  You need to install gnuradio, which inside contains Python-python.  I took <a href="http://www.gcndevelopment.com/gnuradio/downloads.htm">from here the</a> latest version for AVX2 processors. </p><br><p>  I was too lazy to set up the environment in the right way, so I used the included script: C: /GNURadio-3.7/bin/run_gr.bat </p><br><p>  Through it, I will run a script to send the generated file to the b210 board. </p><br><p>  For convenience, the path to this script must be added to the PATH environment variable. </p><br><h3 id="generaciya-signala">  Signal generation </h3><br><p>  Source codes take <a href="https://github.com/osqzss/gps-sdr-sim">here</a> .  What a pleasant surprise was the ease and ease of assembly.  No dependencies, no extra action.  Everything would be so. </p><br><p>  <strong>Build under linux</strong> </p><br><pre> <code class="hljs swift">$ gcc gpssim.<span class="hljs-built_in"><span class="hljs-built_in">c</span></span> -lm -<span class="hljs-type"><span class="hljs-type">O3</span></span> -o gps-sdr-sim</code> </pre> <br><p>  <strong>Building under Windows</strong> </p><br><ol><li><p>  Start Visual Studio.  Run Studio (I used 2015) </p><br></li><li><p>  Create an empty project for a console application.  Create an empty console project.  It is empty! </p><br></li><li><p>  On the Solution Explorer at the right, add "gpssim.c" and "getopt.c" to the Soup Files folder.  Add two files to the project. </p><br></li><li><p>  Select "Release" in Solution Configurations drop-down list.  Change the build type to release, select the x86 / amd64 architecture. </p><br></li><li>  Build the solution.  Actually, collect. </li></ol><br><p>  I did not collect under Linux, because  there was a need to run everything on a specific machine, and there were a dozen on it. </p><br><p>  A detailed description of the parameters of the generator is in the readme.  For a start, you can not understand, but to do very simply, to generate a signal in this way: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">gps-sdr-sim</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.exe</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-e</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">brdc3540</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14n</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-s</span></span> 2500000 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-l</span></span> 30<span class="hljs-selector-class"><span class="hljs-selector-class">.286502</span></span>,120<span class="hljs-selector-class"><span class="hljs-selector-class">.032669</span></span>,100 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-b</span></span> 8 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-d</span></span> 300 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-v</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-o</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sim</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span></code> </pre> <br><ul><li><p>  gps-sdr-sim.exe is the file that you have compiled by the studio. </p><br></li><li><p>  brdc3540.14n is a file with ephemeris satellites. </p><br></li><li><p>  2500000 is the sampling rate </p><br></li><li><p>  30.286502,120.032669 - coordinates </p><br></li><li><p>  100 - height </p><br></li><li><p>  8 is the digit capacity of the numbers in the output file (one count is IQ, two numbers). </p><br></li><li><p>  300 is the duration in seconds. </p><br></li><li><p>  -v is to write more to the log </p><br></li><li>  sim.bin is the name of the output file. </li></ul><br><p>  You can take a line from the readme, but it will generate a signal with RR = 2.6 MHz, then b210 will need to be tuned to the same RR (sampling rate).  If generated with one frequency, and issued on a fee with another, then, of course, nothing will work. </p><br><p>  I gave the signal to the board using this command: </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">run_gr</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bat</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">gps-sdr-sim-uhd</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-t</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">sim</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.bin</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-s</span></span> 2500000 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-x</span></span> 40</code> </pre> <br><p>  40 is a level.  2500000 is BH.  A detailed description of the settings can be seen in the file gps-sdr-sim-uhd.py, it is very simple to understand. </p><br><p>  For b210, the BH value should completely divide the frequency of the internal oscillator, and it seems to be 40 MHz there. </p><br><h3 id="zapusk">  Launch </h3><br><p><img src="https://habrastorage.org/files/324/8e9/b07/3248e9b078794802bdc0109e8efe6a2b.jpg" alt="image"></p><br><p>  And now the fun part. </p><br><ol><li><p>  Turning off the board. </p><br></li><li><p>  Connect the board. </p><br></li><li><p>  Run uhd_find_devices </p><br></li><li><p>  If not determined, then goto 1. </p><br></li><li><p>  Run transmit.bat, monitor the log. </p><br></li><li>  At some point, the second diode on the board will light up, which will mean that everything has already begun to radiate. </li></ol><br><p>  If the letter U is constantly displayed in the logs, it means that your system does not have time to slip the data into the board.  You should check if something is working against the background and if you indicated a very high BH. </p><br><p>  After some time (up to 3 minutes), all devices will begin to determine the location as you specified.  But before that, they suddenly lose their current position. </p><br><p><img src="https://habrastorage.org/files/d48/816/1c0/d488161c0d6b41ec86358bd23a41c074.jpg" alt="image"></p><br><p>  Carefully read the instructions to the program prof.  Abinums can figure out how to generate a file with a changing location, how to use other dates, and more. </p><br><h2 id="vyvody">  findings </h2><br><ol><li><p>  There is a proven way to build the most of the inexpensive means of a GPS signal simulator.  This is a great joy for developers.  Thanks to Professor Ebinume! </p><br></li><li><p>  Not all receivers are subject to imitation interference.  Some have protection. </p><br></li><li><p>  There is a danger that such a simulator will be used or is already being used by criminal elements for its own purposes.  Now there are receivers with protection against signal spoofing.  It is necessary to test this function and use such receivers in responsible applications. </p><br></li><li>  There is a possibility that in the future people will have small-sized and inexpensive devices for changing the navigation signal, which they will use for their almost everyday needs, ranging from cheating spouses and ending with deceiving geo-games like PokemonGO.  Receivers that will be in the neighborhood will have to somehow cope with the presence of a large number of such imitation interference. </li></ol><br><p>  And for the last two points - thanks to Professor Einume!  Developers will have something to do on both sides of the barricades. </p><br><p>  Soon I will talk about trying to get rid of the interference and it came out of it. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/320206/">https://habr.com/ru/post/320206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320196/index.html">Simple Wolfram Language http server</a></li>
<li><a href="../320198/index.html">Welcome to Moscow CocoaHeads January 27</a></li>
<li><a href="../320200/index.html">Pygest # 1. Releases, articles, interesting projects from the world of Python [January 01, 2017 - January 15, 2017]</a></li>
<li><a href="../320202/index.html">Wikimart and the ‚Äútheory of the big fool‚Äù in e-commerce</a></li>
<li><a href="../320204/index.html">GearVR tracking system or electronics production in Russia</a></li>
<li><a href="../320210/index.html">Exam for future "Russian hackers" at the Moscow Polytech</a></li>
<li><a href="../320212/index.html">Rounded Images on Qt Quick Scene Graph</a></li>
<li><a href="../320214/index.html">Big data protection - how to start and minimize possible risks?</a></li>
<li><a href="../320218/index.html">How a former command post becomes a data center</a></li>
<li><a href="../320220/index.html">Sparrow plug-ins and Ansible modules - comparative analysis</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>