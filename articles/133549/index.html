<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Training course. Implementing Basic CRUD Functionality with the Entity Framework in an ASP.NET MVC Application</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is an extension of a series of articles devoted to developing using the Entity Framework and ASP.NET MVC 3. The first chapter can be found at the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Training course. Implementing Basic CRUD Functionality with the Entity Framework in an ASP.NET MVC Application</h1><div class="post__text post__text-html js-mediator-article">  This is an extension of a series of articles devoted to developing using the Entity Framework and ASP.NET MVC 3. The first chapter can be found at the following link: <a href="http://blogs.msdn.com/b/vyunev/archive/2011/10/04/entity-framework-asp-net-mvc.aspx">Creating the Entity Framework data model for an ASP.NET MVC application</a> . <br><br>  In the previous tutorial, we created an MVC application that can store and display data using the Entity Framework and SQL Server Compact.  In this lesson, we will look at creating and configuring a CRUD (create, read, update, delete) functionality that MVC scaffolding automatically creates for you in controllers and views. <br><br>  <b>Note A</b> common practice is to implement a ‚Äúrepository‚Äù pattern to create an abstraction layer between the controller and the data access layer.  But it will be later, in the later lessons ( <a href="http://www.asp.net/entity-framework/tutorials/implementing-the-repository-and-unit-of-work-patterns-in-an-asp-net-mvc-application">Implementing the Repository and the Unit of Work Patterns</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  The following pages will be created in this lesson: <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/0a5/182/09f/0a518209f44d0aeefdd4e3269bf3b0e6.png" width="341" height="480"><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/f65/e13/ee6/f65e13ee64e4160e2ea8d1ed6e111e9b.png" width="401" height="480"><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/083/247/803/083247803dfd801702a0093b6c1ae719.png" width="398" height="480"><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/2d0/d19/875/2d0d1987537ee053d9d13e759e8e10dd.png" width="409" height="480"><br><br><h4>  Creating the Details page </h4><br>  The Details page will display the contents of the Enrollements collection in an HTML table. <br><br>  In <i>Controllers</i> <i>\</i> <i>StudentController</i> <i>.</i>  <i>The cs</i> method for the Details view is the following code: <br><br><pre><code class="hljs objectivec">public ViewResult Details(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) { Student student = db.Students.Find(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> View(student); }</code> </pre> <br>  The Find method is used to retrieve a single Student entity corresponding to the id parameter passed to the method.  The id value is taken from the query string of the link on the Details page. <br><br>  Open <i>Views</i> <i>\</i> <i>Student</i> <i>\</i> <i>Details</i> <i>.</i>  <i>cshtml</i>  Each field is displayed by the DisplayFor helper: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span>LastName<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(model =&gt; model.LastName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  To display a list of enrollments, add the following code after the EnrollmentDate field, before the closing tag of the fieldset: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.Enrollments) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"display-field"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Course Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span>Grade<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">th</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> @foreach (var item in Model.Enrollments) { <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Course.Title) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.DisplayFor(modelItem =&gt; item.Grade) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">td</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tr</span></span></span><span class="hljs-tag">&gt;</span></span> } <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">table</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This code loops through the entities in the Enrollments navigation property.  For each Enrollment entity, it displays the course name and grade.  The name of the course is taken from the Course entity contained in the Course navigation property of the entity Enrollments.  All this data is automatically unloaded from the database as needed (in other words, lazy loading is used. You did not specify an <i>eager</i> <i>loading</i> for the Courses navigation property property, so when you first access this property, a database request will be executed to retrieve data. Read more lazy loading and eager loading can be here <a href="http://www.asp.net/entity-framework/tutorials/reading-related-data-with-the-entity-framework-in-an-asp-net-mvc-application">Reading Related Data</a> .) <br><br>  Click on the <b>Students</b> tab and click on the <b>Details</b> link. <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/0a5/182/09f/0a518209f44d0aeefdd4e3269bf3b0e6.png" width="341" height="480"><br><br><h4>  Creating a Create Page </h4><br>  In <i>Controllers \ StudentController.cs</i> , replace the code for the HttpPost Create method: <br><br><pre> <code class="hljs pgsql">[HttpPost] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult <span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(Student student) { try { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ModelState.IsValid) { db.Students.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(student); db.SaveChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction("Index"); } } catch (DataException) { //<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> the error (<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> a variable <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> DataException) ModelState.AddModelError("", "Unable to save changes. Try again, and if the problem persists see your system administrator."); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(student); }</code> </pre><br>  Thus, we add the Student entity created by the ASP.NET MVC Model Binder to the corresponding set of entities and then save the changes to the base.  ( <i>Model</i> <i>binder</i> - ASP.NET MVC functionality that makes it easier to work with data coming from a form. Model binder converts data from a form into the corresponding .NET Framework data types and passes it as parameters to the desired method. In this case, model binder instantiates the Student entity using property values ‚Äã‚Äãfrom the Form collection.) <br><br>  The try-catch block is the only difference between our version and what was automatically created.  If an exception inherited from DataException is caught while saving changes, a standard error message is displayed.  Such errors are usually caused by something external rather than a programmer error, so the user is simply asked to try again.  The code in <i>Views</i> <i>\</i> <i>Student</i> <i>\</i> <i>Create</i> <i>.</i>  <i>cshtml</i> is similar to the <i>Details</i> code <i>.</i>  <i>cshtml</i> except EditorFor and ValidationMessageFor, used for each field instead of the DisplayFor helper.  The following code is an example: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editor-label"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.LabelFor(model =&gt; model.LastName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"editor-field"</span></span></span><span class="hljs-tag">&gt;</span></span> @Html.EditorFor(model =&gt; model.LastName) @Html.ValidationMessageFor(model =&gt; model.LastName) <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  In <i>Create</i> <i>.</i>  <i>cshtml</i> no need to make changes. <br><br>  Click on the <b>Students</b> tab and on <b>Create</b> <b>New</b> . <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/083/247/803/083247803dfd801702a0093b6c1ae719.png" width="398" height="480"><br><br>  Data validation is enabled by default.  Enter names and an incorrect date and click Create to see the error. <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/4b7/a11/f77/4b7a11f773fc8f9b7e9daae049db8beb.png" width="406" height="480"><br><br>  In this case, you see client-side data validation implemented using JavaScript.  Data verification on the server side is also implemented, and even if the data verification on the client side misses bad data, they will be intercepted on the server side and an exception will be thrown. <br><br>  Change the date to the correct one, for example, on 9/1/2005 and click <b>Create</b> to see the new student on the <b>Index</b> page. <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/43b/4d8/08d/43b4d808d4fb4776b4862e11fb886e3f.png" width="416" height="480"><br><br><h4>  Creating an Edit Page </h4><br>  In <i>Controllers \ StudentController.cs,</i> the HttpGet Edit method (one that without the HttpPost attribute) uses the Find method to retrieve the selected Student entity.  There is no need to change the code of this method. <br><br>  Replace the code for the HttpPost Edit method with the following code: <br><br><pre> <code class="hljs cs">[<span class="hljs-meta"><span class="hljs-meta">HttpPost</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Edit</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Student student</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ModelState.IsValid) { db.Entry(student).State = EntityState.Modified; db.SaveChanges(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction(<span class="hljs-string"><span class="hljs-string">"Index"</span></span>); } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (DataException) { <span class="hljs-comment"><span class="hljs-comment">//Log the error (add a variable name after DataException) ModelState.AddModelError("", "Unable to save changes. Try again, and if the problem persists see your system administrator."); } return View(student); }</span></span></code> </pre><br>  The code is similar to what was in the HttpPost Create method, but instead of adding an entity to the set, this code sets an entity property that determines whether it was changed.  When you call SaveChanges, the Modified property instructs the Entity Framework to create a SQL query to update the record in the database.  All columns of the record will be updated, including those that the user did not touch.  Concurrency issues are ignored.  (You can read about concurrency issues in <a href="http://www.asp.net/entity-framework/tutorials/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application">Handling Concurrency</a> .) <br><br><h4>  Entity States and Attach and SaveChanges Methods </h4><br>  The database context monitors the synchronization of the entities in memory with the corresponding entries in the database, and this information determines what happens when the SaveChanges method is called.  For example, when a new entity is transferred to the Add method, the state of this entity changes to Added.  Then, when you call the SaveChanges method, the database context initiates the execution of an INSERT SQL query. <br><br>  The state of an entity can be defined as: <br><br><ul><li>  Added.  Entities are not yet in the database.  The SaveChanges method initiates the execution of an INSERT request. </li><li>  Unchanged.  When you call SaveChanges, nothing happens.  This state of the entity when retrieving it from the database. </li><li>  Modified.  Entity property values ‚Äã‚Äãhave been changed, SaveChanges executes an UPDATE request. </li><li>  Deleted.  Entity is marked for deletion, SaveChanges executes a DELETE request. </li><li>  Detached.  The state of the entity is not monitored by the database context. </li></ul>  In the desktop application, the status changes automatically.  In this type of application, you extract the entity and change the values ‚Äã‚Äãof any properties, which leads to a state change to Modified.  After calling SaveChanges, the Entity Framework generates a SQL UPDATE query that updates only those properties whose values ‚Äã‚Äãhave been changed. <br><br>  However, the algorithm is violated in the web application, because the database context instance that retrieves the entity is destroyed after the page reloads.  When HttpPost Edit, a new request occurs and you have a new instance of the context, so you need to manually change the state of the entity to Modified.  After that, when you call SaveChanges, the Entity Framework will update all the columns of the record in the database, since the context no longer knows which properties have been specifically changed. <br><br>  If you want Update to change only user-edited fields, you can somehow save the original values ‚Äã‚Äã(for example, hidden form fields) by making them available at the time HttpPost Edit is called.  Thus, you can create a Student entity using the original values, call the Attach method with the original version of the entity, update the values ‚Äã‚Äãof the entity, and call SaveChanges.  For more information, refer to the <a href="http://blogs.msdn.com/b/adonet/archive/2011/01/29/using-dbcontext-in-ef-feature-ctp5-part-4-add-attach-and-entity-states.aspx">Add / Attach and Entity States</a> materials and post on the Entity Framework <a href="http://blogs.msdn.com/b/adonet/archive/2011/02/01/using-dbcontext-in-ef-feature-ctp5-part-7-local-data.aspx">Local Data</a> development team blog. <br><br>  Code in <i>Views</i> <i>\</i> <i>Student</i> <i>\</i> <i>Edit</i> <i>.</i>  <i>cshtml is</i> similar to the code in <i>Create</i> <i>.</i>  <i>cshtml</i> , no changes are necessary. <br><br>  Click on the <b>Students</b> tab and then on the <b>Edit</b> link. <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/f65/e13/ee6/f65e13ee64e4160e2ea8d1ed6e111e9b.png" width="401" height="480"><br><br>  Change the values ‚Äã‚Äãand click <b>Save</b> . <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/b5e/c89/123/b5ec89123e406f5538590b7689330e04.png" width="408" height="480"><br><br><h4>  Creating a Delete Page </h4><br>  In <i>Controllers \ StudentController.cs,</i> the HttpGet Delete method uses the Find method to retrieve the selected Student entity, as well as in Details and Edit before.  To implement your error message in case of an error in the SaveChanges call, you need to add additional functionality to the method and the corresponding view. <br><br>  As with update and create operations, the delete operation also needs two methods.  The method called in response to a GET request shows the user a view that allows you to confirm or cancel the deletion.  If the user confirms the deletion, a POST request is created and the HttpPost Delete method is called. <br><br>  You need to add the try-catch exception block to the code of the HttpPost Delete method to handle errors that may occur when updating the database.  If an error occurs, the HttpPost Delete method calls the HttpGet Delete method, passing it the parameter that signals the error.  The HttpGet Delete method again generates a delete confirmation page and an error text. <br><br>  Replace the code of the HttpGet Delete method with the following code that allows you to handle errors: <br><br><pre> <code class="hljs pgsql"><span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult <span class="hljs-keyword"><span class="hljs-keyword">Delete</span></span>(<span class="hljs-type"><span class="hljs-type">int</span></span> id, <span class="hljs-type"><span class="hljs-type">bool</span></span>? saveChangesError) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (saveChangesError.GetValueOrDefault()) { ViewBag.ErrorMessage = "Unable to save changes. Try again, and if the problem persists see your system administrator."; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">View</span></span>(db.Students.Find(id)); }</code> </pre><br>  This code accepts an optional Boolean type parameter that signals the occurrence of an error.  This parameter is null (false) after calling HttpGet Delete and true when calling HttpPost Delete. <br><br>  Replace the code for the HttpPost Delete (DeleteConfirmed) method with the following code that performs the deletion and handles the errors: <br><br><pre> <code class="hljs pgsql">[HttpPost, ActionName("Delete")] <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> ActionResult DeleteConfirmed(<span class="hljs-type"><span class="hljs-type">int</span></span> id) { try { Student student = db.Students.Find(id); db.Students.Remove(student); db.SaveChanges(); } catch (DataException) { //<span class="hljs-keyword"><span class="hljs-keyword">Log</span></span> the error (<span class="hljs-keyword"><span class="hljs-keyword">add</span></span> a variable <span class="hljs-type"><span class="hljs-type">name</span></span> <span class="hljs-keyword"><span class="hljs-keyword">after</span></span> DataException) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction("Delete", <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Web.Routing.RouteValueDictionary { { "id", id }, { "saveChangesError", <span class="hljs-keyword"><span class="hljs-keyword">true</span></span> } }); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RedirectToAction("Index"); }</code> </pre><br>  The code returns the selected entity and calls the Remove method, which changes the state of the entity to Deleted.  When you call SaveChanges, a DELETE SQL query is generated. <br><br>  If performance is a priority, then you can do without unnecessary SQL queries that return a record by replacing the code that calls the Find and Remove methods: <br><br><pre> <code class="hljs objectivec">Student studentToDelete = new Student() { StudentID = <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> }; db.Entry(studentToDelete).State = EntityState.Deleted;</code> </pre><br>  With this code, we instantiate the Student entity using only the primary key value and then define the state of the entity as Deleted.  This is all Entity Framework needs to delete an entity. <br><br>  As mentioned, the HttpGet Delete method does not delete data.  Deleting data in response to a GET request (or, also, editing, creating and any other action with data) creates a security breach.  For details, see <a href="http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx">ASP.NET MVC. Tip # 46 -</a> Stephen Walther's blog post. <br><br>  In <i>Views</i> <i>\</i> <i>Student</i> <i>\</i> <i>Delete</i> <i>.</i>  <i>cshtml</i> add the following code between h2 and h3: <br><br>  &lt;p class = "error"&gt; @ ViewBag.ErrorMessage &lt;/ p&gt; <br><br>  Click on the <b>Students</b> tab and then on the <b>Delete</b> link: <br><br><img title="image" alt="image" src="https://habrastorage.org/getpro/habr/post_images/2d0/d19/875/2d0d1987537ee053d9d13e759e8e10dd.png" width="409" height="480"><br><br>  Click <b>Delete</b> .  The Index page is loaded, already without the student we deleted (you will see an example of processing the code in the method in the <a href="http://www.asp.net/entity-framework/tutorials/handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application">Handling Concurrency</a> lesson.) <br><br><h4>  Make sure there are no open database connections left. </h4><br>  To be sure that all connections to the database have been properly closed and the resources occupied by them are released, you need to make sure that the context is destroyed.  Therefore, you can find the Dispose method at the end of the StudentController controller class in the <i>StudentController</i> <i>.</i>  <i>cs</i> : <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Dispose</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">bool</span></span></span></span><span class="hljs-function"><span class="hljs-params"> disposing</span></span></span><span class="hljs-function">)</span></span> { db.Dispose(); <span class="hljs-keyword"><span class="hljs-keyword">base</span></span>.Dispose(disposing); }</code> </pre><br>  The base Controller class implements the IDisposable interface, so this code simply overrides (override) the Dispose (bool) method for external deletion of the context instance. <br><br>  Now you have everything that implements simple CRUD operations for Student entities.  In the next lesson, we will extend the functionality of the Index page by adding sorting and pagination. <br><br>  Thanks for the help in the translation of Alexander Belotserkovsky ( <a href="http://habrahabr.ru/users/ahriman/" class="user_link">ahriman</a> ). </div><p>Source: <a href="https://habr.com/ru/post/133549/">https://habr.com/ru/post/133549/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../133543/index.html">Writing Extensions for Opera and Chrome: A Look at the Process</a></li>
<li><a href="../133544/index.html">Lost your Android communicator? Be ready!</a></li>
<li><a href="../133545/index.html">Flight BeagleBoard at an altitude of 36 km!</a></li>
<li><a href="../133546/index.html">Video review of Android applications and games - kedDroid</a></li>
<li><a href="../133547/index.html">About the big nonsense of small companies</a></li>
<li><a href="../133551/index.html">Release of XML-DBMS Sedna 3.5</a></li>
<li><a href="../133552/index.html">Installing NetBeans Spell Check Dictionaries</a></li>
<li><a href="../133553/index.html">Ubuntu "Bringing to mind" or why argue</a></li>
<li><a href="../133554/index.html">The disadvantages and advantages of ‚Äútraditional‚Äù telephony for building the enterprise‚Äôs telephone network</a></li>
<li><a href="../133555/index.html">Vulnerability allowing to hear the interlocutor with the microphone turned off</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>