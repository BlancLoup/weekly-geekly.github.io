<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of static C ++ code analysis tools</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Analysis of the following utilities: 

- RATS (Rough Auditing Tool for Security) 
- Cppcheck 
- Graudit  Everything you need can be found by following...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of static C ++ code analysis tools</h1><div class="post__text post__text-html js-mediator-article">  Analysis of the following utilities: <ul><li>  <a href="https://www.fortify.com/ssa-elements/threat-intelligence/rats.html">RATS (Rough Auditing Tool for Security)</a> </li><li>  <a href="http://cppcheck.sourceforge.net/">Cppcheck</a> </li><li>  <a href="http://www.justanotherhacker.com/projects/graudit.html">Graudit</a> </li></ul>  Everything you need can be found by following the links, and we immediately get down to business. <br><br><h5>  Test 1: </h5><br><pre><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v; v.reserve(<span class="hljs-number"><span class="hljs-number">2</span></span>); assert(v.capacity() == <span class="hljs-number"><span class="hljs-number">2</span></span>); v[<span class="hljs-number"><span class="hljs-number">0</span></span>]; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] = <span class="hljs-number"><span class="hljs-number">1</span></span>; v[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; v.reserve(<span class="hljs-number"><span class="hljs-number">100</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; v[<span class="hljs-number"><span class="hljs-number">0</span></span>] &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre> <a name="habracut"></a><br>  Carefully review this code, how many problems can you identify? <br>  Of course, all the necessary headers are included ( <b>iostream, vector, cassert</b> ). <br>  Before we discuss the professional versions of this code, we will perform an analysis of the known utilities for static source code analysis.  The following is the result of the above utilities. <br><br>  <i>RATS</i> : <font color="red">nothing</font> <br>  <i>Cppcheck</i> : <font color="red">nothing</font> <br>  <i>Graudit</i> : <font color="red">nothing</font> <br>  <i>g ++ (with -Wall flag)</i> : <font color="red">nothing</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Maybe at first glance, everything is not so bad, or is there nothing at all bad?  Do not say this with Sutter (among other things, an example is taken from his book <a href="http://www.proklondike.com/books/cpp/cpp_satter_new_tasks_cpp.html">‚ÄúNew Challenges in C ++. 40 New Puzzles with Solutions‚Äù</a> ). <br>  On the first line in the body of the function main () we declare a vector <i>v</i> consisting of integers.  Then reserve a place for 2 items.  Before we move on to the next line, take a look at the C ++ standard.  What does she tell us about the <i>vector :: reserve</i> method?  (warning: free translation) <br>  <i>"</i> <pre> <i><code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">reserve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(size_type n)</span></span></span></span>;</code></i> </pre>  <i>It reports a planned resizing, possibly a corresponding management of memory allocation.</i>  <i>After <b>reserve (), capacity ()</b> (capacity) is greater than or equal to the argument passed to <b>reserve ()</b> in the case of redistribution of memory.</i>  <i>Otherwise, it is equal to the previous value of <b>capacity ()</b> .</i>  <i>Memory redistribution occurs if and only if the current value of <b>capacity () is</b> less than the value of the <b>reserve ()</b> argument.</i>  <i>It does not change the size of the container and in the worst case requires linear execution time.</i>  <i>If the argument is greater than <b>max_size ()</b> , it throws a long_error exception.</i>  <i>In the case of redistribution, invalidates all references, pointers and iterators referring to the elements of the container. "</i> <i><br><br></i>  While this is enough, let's go further.  The string <i>assert (v.capacity () == 2);</i>  bad at best, in the first <i>reserve ()</i> guarantees increasing the capacity and in this case <i>assert is</i> just an extra line of code (which ‚Äúprogrammers‚Äù like to insert, who blindly believe the assertion after each operation and consider it a professional tone).  Secondly, as we learned from the standard itself, <i>reserve ()</i> can increase the capacity of the container more than the specified argument, so Satter recommends <i>assert (v.capacity ()&gt; = 2)</i> .  I recommend removing it altogether. <br>  Further worse.  <b>‚Äú <i>Vector &lt;T&gt; :: operator []</i> can, but is not required to perform range checking.</b>  <b>The standard does not say anything about this, so the developer of the standard library has the full right to both add such a check and do without it. ‚Äù</b> - <i>Sutter</i> .  The reason is efficiency, verification takes some time, numerous such checks will require a significant part of the program‚Äôs work time.  But this does not mean that your effective program is better than a reliable Vasya program.  Try to replace the line <i>v [0];</i>  on <i>v.at (0);</i>  The program will take off with an exception.  As in most cases, you need a reliable code.  <i>vector &lt;T&gt; :: at</i> checks the range of the index value.  Strong recommendation to use this method in such and not only situations. <br><br>  Strings <i>v [0] = 1;</i>  <i>v [1] = 2;</i>  quite work, you can make sure you compile the example.  But we must remember the difference between <i>size / resize</i> and <i>reserve / capacity</i> .  <i>resize</i> changes the number of elements in the container to the specified argument value by adding or removing them from the end of the container.  We learned about the <i>reserve</i> method from the standard, we add that it increases the size of the internal buffer so that it can accommodate the specified number of elements (at a minimum).  " <b>We can safely use <i>operator []</i> (or the at method) only to change the elements that are actually contained in the container, i.e. really are taken into account in size.</b> " Is that clear?  So the static analysis tools are not clear either.  But the problem is significant.  Sutter and many other pros write in their books about the subtle points in coding on your favorite C ++.  At first glance it may seem that the ability to solve problems and knowledge of the syntax of the language is more than enough to develop.  But we know with you that we are deceiving ourselves, how many of you inserted <i>cout-</i> s on each line of code in order to identify the problem?  How many of you could not tolerate debugging that you have been doing for the third day?  So, there are people who are not inherent in such things, they include people who possess professional programming skills, who are not lazy to go further and study the books of such gurus as Sutter and Myers (and many others) in a row. <br><br>  And yet, in example 1, we are waiting for the last logical error, what do you think that <i>cout &lt;&lt; v [0];</i>  after <i>reserve (100)</i> ?  That's right, at best, zero!  Note that prior to reservation, we gave <i>v [0] a</i> nonzero value.  ‚ÄúProblem‚Äù is again in the backup function. <br>  So what is the general case?  In that I need a utility that tells you that in the case of <i>v.reserve (2);</i>  <i>v [0] = 1;</i>  better to use <i>v.resize (2);</i>  <i>v [0] = 1;</i>  or <i>v.reserve (2);</i>  <i>v.push_back (1)</i> !  And the utilities reviewed by us are cute and silent.  I also need a utility that checks for irregular bounds, and in the case of <i>v [0];</i>  recommend using <i>v.at (0).</i>  And our reviewed utilities are again silently silent.  Hence the moral, in subtle situations do not rely on utilities such as RATS, Cppcheck, and even more so on Graudit.  Even the compiler with the highest level of warnings enabled can sometimes be viewed through the eyes of a paranoid coder. <br>  Well, the utilities do not occupy a place on your screws for nothing, and it was not for nothing that the developers worked on it. <br><br><h5>  Test 2: </h5><br>  Let's go further, increase the error rate in the code.  Consider the same code, with the new <i>prettyFormat</i> function (an example again from Sutter).  It gets a number and a buffer, then inserts that number into the resulting buffer using sprintf. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>&gt; v; v.reserve(<span class="hljs-number"><span class="hljs-number">2</span></span>); <span class="hljs-comment"><span class="hljs-comment">//.... char buf[5]; prettyFormat(10, buf); return 0; }</span></span></code> </pre><br>  As you can see, <i>prettyFormat was</i> added, and the string <i>char buf [10]</i> .  Although we do not need the code from the previous example anymore, but let it remain, maybe one of the utilities will see something?  Here is the result: <br><br>  <i>RATS:</i> <font color="green">on the string char buf [5];</font>  <font color="green">"It is <i>recommended that</i></font> you take care of character arrays, they are helpless when using character arrays. buffer overflow attacks. <br>  <i>Cppcheck</i> : <font color="red">nothing</font> <br>  <i>Graudit</i> : <font color="red">nothing</font> <br>  <i>g ++ (with -Wall option)</i> : <font color="red">nothing</font> <br><br>  Much has been said about buffer overflow, so we will be brief and only criticize.  I have the impression that the static analysis utilities are intended only for finding possible cases of buffer overflows.  However, several of them are silent even in such cases (as Cppcheck or Graudit).  I don‚Äôt blame the compiler, he didn‚Äôt tell me that he would find problems, but the utilities specifically designed for such things are pretty much silent in most cases.  In such situations, we need to get warnings and recommendations from utilities to use alternatives to <i>sprintf</i> (well, for other possible functions).  You can read about alternative situations in Sutter (we are talking about <i>std :: stringstream, std :: strstream, boost :: lexical_cast,</i> but the latter is based on <i>std :: stringstream</i> , and finally <i>snprintf</i> , which allows you to set the size of the buffer, thereby ensuring protection from buffer overflow). <br><br><h5>  Test 3: </h5><br>  Add an uninitialized pointer to the <i>prettyFormat</i> function. <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* a; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ ...</code> </pre><br>  Ostolnom code has not changed compared with previous tests.  This is not something that may look like a serious test, but it will give a lot of interesting information about the utilities used.  In particular, it was said about Cppcheck that it does not duplicate the compiler warnings, but as we will see shortly, this is a bluff.  But other utilities simply do not see the problem or indeed do not duplicate the compiler warnings.  Below is the result. <br><br>  <i>RATS</i> : the <font color="green">same as in the previous test (this is the string char buf [5];)</font> <br>  <i>Cppcheck</i> : <font color="green">on the line int * a;</font>  <font color="green">gives (error) Uninitialized variable: a.</font> <br>  Fine, but ... <br>  <i>g ++ (with the -Wall option)</i> : <font color="green">In function 'int * prettyFormat (int, char *)':</font> <font color="green"><br></font>  <font color="green">warning: 'a' is used uninitialized in this function.</font> <br>  Something familiar isn't it?  The same warning that Cppcheck finally gave. <br>  <i>Graudit is</i> <font color="red">generally silent.</font> <br><br><h5>  Test 4: </h5><br>  Add humor, change the <i>prettyFormat</i> function <i>like</i> this: <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function">* </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prettyFormat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> i, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* buf)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">sprintf</span></span>(buf, <span class="hljs-string"><span class="hljs-string">"%4d"</span></span>, i); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span>* a; fopen(<span class="hljs-string"><span class="hljs-string">"filename"</span></span>, <span class="hljs-string"><span class="hljs-string">"r"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> buf2[<span class="hljs-number"><span class="hljs-number">5</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">strcpy</span></span>(buf2, buf); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a; }</code> </pre><br>  Added fopen, which opens I don‚Äôt know what, a local buffer <i>buf2</i> was added, into which buf received as an argument is copied to strcpy.  Let's see how much one gives. <br><br>  <i>RATS:</i> <font color="green">For strings char buf2 [5];</font>  <font color="green">char buf [10] the same warning about the use of fixed-size character buffers.</font> <font color="green"><br></font>  <font color="green">And finally: ‚ÄúHigh: strcpy</font> <font color="green"><br></font>  <font color="green">Call will not copy</font> <font color="green"><br></font>  <font color="green">more data than can be handled, resulting in a buffer overflow. ‚Äù</font> <br>  Check if the second argument does not copy more data than buf2 can contain. <br>  Not bad, in many situations would help.  Let's go further. <br>  <i>Cppcheck</i> : <font color="green">(error) Unitialized variable: a.</font> <br>  Something familiar, the same as in the previous example, which is a pity. <br>  <i>g ++ (with the -Wall option)</i> : <font color="green">Same as in the previous test.</font> <br><br>  The task was more or less handled by the RATS, the rest - to shoot!  Why is everything so bad?  Firstly, the guys who ‚Äúwrote‚Äù these utilities are not really C ++ gurus themselves, many of them most of all like to just publish the program and that's it.  Secondly, many subtle errors are difficult to detect, and they are mostly handled by commercial utilities, although I have not tried it myself yet.  Thirdly, read books, magazines, in particular Habr and you will not need utilities like these. <br><br>  Thanks for attention! <br><br>  PS I wanted to publish on the ‚ÄúCode Revision‚Äù blog, there is not enough karma.  No, it‚Äôs not that I want to increase karma in such a way, just in case, so that the crowd doesn‚Äôt scream - ‚Äúwhy not there-there -...‚Äù. <br><br>  PPS Thank you so much to the media community - keep it up! </div><p>Source: <a href="https://habr.com/ru/post/128534/">https://habr.com/ru/post/128534/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../128528/index.html">Google.com is 14 years old</a></li>
<li><a href="../128529/index.html">Developing a game using Box2D in ActionScript 3</a></li>
<li><a href="../128530/index.html">A brief video review of Windows 8</a></li>
<li><a href="../128532/index.html">The concept of educational social network</a></li>
<li><a href="../128533/index.html">Getting Started with the Google+ API</a></li>
<li><a href="../128535/index.html">Simple implementation of the long polling mechanism in PHP</a></li>
<li><a href="../128536/index.html">Text localization features</a></li>
<li><a href="../128537/index.html">Windows 8 as part of a new personal computing device concept</a></li>
<li><a href="../128538/index.html">Another Monad Guide (part 3: Monad Laws)</a></li>
<li><a href="../128539/index.html">Writing a class in php to interpret BrainLoller</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>