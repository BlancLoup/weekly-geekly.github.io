<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Responsive Bar Charts with Bokeh, Flask and Python 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From translator 


 Recently I came across a tutorial on Flask + Bokeh in the python digest . Tutorial is aimed at beginners, you do not even need to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Responsive Bar Charts with Bokeh, Flask and Python 3</h1><div class="post__text post__text-html js-mediator-article"><h1 id="ot-perevodchika">  From translator </h1><br><p>  Recently I came across a tutorial on Flask + Bokeh in the <a href="https://pythondigest.ru/">python digest</a> .  Tutorial is aimed at beginners, you do not even need to know the syntax of Python and HTML.  The examples work under Ubuntu 16.04, on Windows the work with virtual environments is slightly different. </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-64.png" alt="image"></p><a name="habracut"></a><br><h1 id="vstuplenie">  Introduction </h1><br><p>  Bokeh is a powerful open source library that allows you to visualize data for web applications without writing a single line in javascript.  Studying visualization libraries like d3.js may be useful, but it‚Äôs much easier to write a few lines of Python code to solve a problem. </p><br><p>  With Bokeh, we can create strikingly detailed interactive visualizations or simpler things, like bar charts. </p><br><p>  Let's see how Flask and Bokeh can be used to visualize data in a web application. </p><br><h1 id="instrumenty">  Instruments </h1><br><p>  Everything described below works on both Python 2 and Python 3, however, it is recommended to use Python 3 for new applications.  I used Python 3.6.1 at the time of this writing.  In addition to Python itself, we need the following dependencies: </p><br><ul><li>  <a href="http://flask.pocoo.org/">Flask</a> web framework version 0.12.2 </li><li>  <a href="http://bokeh.pydata.org/en/latest/">Bokeh</a> Data Visualization Library, version 0.12.5 </li><li>  <a href="http://pandas.pydata.org/">Pandas</a> Data Analysis Library, version 0.20.1 </li><li>  <a href="https://pypi.python.org/pypi/pip">pip</a> and <a href="https://virtualenv.pypa.io/en/stable/">virtualenv</a> come with Python 3. They will be needed to isolate Flask, Bokeh and pandas from other projects. </li></ul><br><p>  If you need additional information on setting up the development environment, you can refer to the <a href="https://virtualenv.pypa.io/en/stable/userguide/">manual</a> .  All <a href="https://github.com/fullstackpython/blog-code-examples">sample code</a> is available under MIT license on GitHub. </p><br><h1 id="ustanovka-bokeh-i-flask">  Installation Bokeh and Flask </h1><br><p>  Create a clean virtual environment for the project.  As a rule, I run this command in a separate folder, venvs, where all my virtual environments are located. </p><br><pre><code class="python hljs">python3 -m venv barchart</code> </pre> <br><p>  Activate the virtual environment. </p><br><pre> <code class="python hljs">source barchart/bin/activate</code> </pre> <br><p>  After activating the virtual environment, the command line prompt will change: <br><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/activate-virtualenv.png" alt="image"><br>  Do not forget that you will need to activate the virtual environment in each new terminal window from which you want to start your application. </p><br><p>  Now you can install Bokeh and Flask in the created virtual environment.  Run this command to install Bokeh and Flask for the appropriate versions. </p><br><pre> <code class="python hljs">pip install bokeh==<span class="hljs-number"><span class="hljs-number">0.12</span></span><span class="hljs-number"><span class="hljs-number">.5</span></span> flask==<span class="hljs-number"><span class="hljs-number">0.12</span></span><span class="hljs-number"><span class="hljs-number">.2</span></span> pandas==<span class="hljs-number"><span class="hljs-number">0.20</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span></code> </pre> <br><p>  After downloading and installing the necessary libraries will be available in a virtual environment.  Check the output to make sure everything is fixed. </p><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Installing</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">collected</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">packages</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">six</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">requests</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">PyYAML</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">python-dateutil</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">MarkupSafe</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Jinja2</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">numpy</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">tornado</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">bokeh</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">Werkzeug</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">itsdangerous</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">click</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">flask</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">pytz</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">pandas</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Running</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PyYAML</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Running</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MarkupSafe</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Running</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tornado</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Running</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bokeh</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Running</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setup</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.py</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">install</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">for</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">itsdangerous</span></span> ... <span class="hljs-selector-tag"><span class="hljs-selector-tag">done</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Successfully</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">installed</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Jinja2-2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.9</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">MarkupSafe-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">PyYAML-3</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Werkzeug-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">bokeh-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">click-6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">flask-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">itsdangerous-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.24</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">numpy-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.12</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pandas-0</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.20</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">python-dateutil-2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">pytz-2017</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">requests-2</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.14</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">six-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.10</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">tornado-4</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span></code> </pre> <br><p>  Now we can go directly to our application. </p><br><h1 id="zapusk-prilozheniya-na-flask">  Running the application on Flask </h1><br><p>  We will write a simple Flask application and add a bar chart to the page.  Create a folder for your project with an <code>app.py</code> file with the following content: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, render_template app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">"/&lt;int:bars_count&gt;/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bars_count)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> bars_count &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: bars_count = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">"chart.html"</span></span>, bars_count=bars_count) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: app.run(debug=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br><p>  This is a simple Flask application that has a <code>chart</code> function.  <code>chart</code> takes an integer, which will later be used to determine the amount of data to draw.  The <code>render_template</code> function inside the <code>chart</code> will use the <a href="http://jinja.pocoo.org/">Jinja2</a> templating engine to generate HTML. </p><br><p>  The last 2 lines allow us to start the application from the console on port 5000 in debug mode.  Never use debugging mode in production, there are Gunicorn WSGI servers for this. </p><br><p>  Create a <code>templates</code> folder inside the project folder.  Inside it, create a <code>chart.html</code> file.  It needs the <code>chart</code> function from <code>app.py</code> , so without it, the application will not work correctly.  Fill out the <code>chart.html</code> Jinja2 markup. </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Bar charts with Bokeh!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Bugs found over the past {{ bars_count }} days<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  The <code>chart.html</code> will show the number of columns passed to the <code>chart</code> function via the URL. </p><br><p>  The message inside the <code>h1</code> tag corresponds to the subject of our application.  We will build a graph of the number of bugs found by the automatic testing system for each day. </p><br><p>  Now we can test our application. </p><br><p>  Make sure the virtual environment is still active and you are in the <code>app.py</code> folder.  Launch <code>app.py</code> using the <code>python</code> command. </p><br><pre> <code class="hljs mel">$(barchart) <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> app.py</code> </pre> <br><p>  Go to <a href="http://localhost:5000/16/">localhost: 5000/16 /</a> .  You should see a big message that changes when you change the URL. </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/basic-app-no-chart.png"><br>  Our application is already running, but not yet impressive.  It's time to add a chart. </p><br><h1 id="generaciya-stolbchatoy-diagrammy">  Bar chart generation </h1><br><p>  We just need to add some code that Bokeh will use.  Open <code>app.py</code> and add lines to it at the top. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> random <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.models <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> (HoverTool, FactorRange, Plot, LinearAxis, Grid, Range1d) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.models.glyphs <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> VBar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.plotting <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> figure <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.charts <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Bar <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.embed <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> components <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bokeh.models.sources <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ColumnDataSource <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> flask <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Flask, render_template</code> </pre> <br><p>  The rest of the file will use Bokeh along with the random module to generate data and a bar chart. </p><br><p>  The data for the chart will be re-generated each time the page is reloaded.  In a real application, use a more reliable and useful data source! </p><br><p>  Keep changing <code>app.py</code>  The code after the import should look like this. </p><br><pre> <code class="python hljs">app = Flask(__name__) @app.route(<span class="hljs-string"><span class="hljs-string">"/&lt;int:bars_count&gt;/"</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">chart</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bars_count)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> bars_count &lt;= <span class="hljs-number"><span class="hljs-number">0</span></span>: bars_count = <span class="hljs-number"><span class="hljs-number">1</span></span> data = {<span class="hljs-string"><span class="hljs-string">"days"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"bugs"</span></span>: [], <span class="hljs-string"><span class="hljs-string">"costs"</span></span>: []} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">1</span></span>, bars_count + <span class="hljs-number"><span class="hljs-number">1</span></span>): data[<span class="hljs-string"><span class="hljs-string">'days'</span></span>].append(i) data[<span class="hljs-string"><span class="hljs-string">'bugs'</span></span>].append(random.randint(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>)) data[<span class="hljs-string"><span class="hljs-string">'costs'</span></span>].append(random.uniform(<span class="hljs-number"><span class="hljs-number">1.00</span></span>, <span class="hljs-number"><span class="hljs-number">1000.00</span></span>)) hover = create_hover_tool() plot = create_bar_chart(data, <span class="hljs-string"><span class="hljs-string">"Bugs found per day"</span></span>, <span class="hljs-string"><span class="hljs-string">"days"</span></span>, <span class="hljs-string"><span class="hljs-string">"bugs"</span></span>, hover) script, div = components(plot) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> render_template(<span class="hljs-string"><span class="hljs-string">"chart.html"</span></span>, bars_count=bars_count, the_div=div, the_script=script)</code> </pre> <br><p>  The <code>chart</code> function generates lists with data using the built-in random module.  <code>chart</code> calls 2 functions: <code>create_hover_tool</code> and <code>create_bar_chart</code> .  We have not yet written these functions, so we will continue to add code after the <code>chart</code> function: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_hover_tool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment">#       return None def create_bar_chart(data, title, x_name, y_name, hover_tool=None, width=1200, height=300): """  .     ,   ,       . """ source = ColumnDataSource(data) xdr = FactorRange(factors=data[x_name]) ydr = Range1d(start=0,end=max(data[y_name])*1.5) tools = [] if hover_tool: tools = [hover_tool,] plot = figure(title=title, x_range=xdr, y_range=ydr, plot_width=width, plot_height=height, h_symmetry=False, v_symmetry=False, min_border=0, toolbar_location="above", tools=tools, responsive=True, outline_line_color="#666666") glyph = VBar(x=x_name, top=y_name, bottom=0, width=.8, fill_color="#e12127") plot.add_glyph(source, glyph) xaxis = LinearAxis() yaxis = LinearAxis() plot.add_layout(Grid(dimension=0, ticker=xaxis.ticker)) plot.add_layout(Grid(dimension=1, ticker=yaxis.ticker)) plot.toolbar.logo = None plot.min_border_top = 0 plot.xgrid.grid_line_color = None plot.ygrid.grid_line_color = "#999999" plot.yaxis.axis_label = "Bugs found" plot.ygrid.grid_line_alpha = 0.1 plot.xaxis.axis_label = "Days after app deployment" plot.xaxis.major_label_orientation = 1 return plot</span></span></code> </pre> <br><p>  There is a lot of code to deal with.  The <code>create_hover_tool</code> function <code>create_hover_tool</code> far only returns None, because for now we don‚Äôt need to display hints. </p><br><p>  Inside the <code>create_bar_chart</code> function <code>create_bar_chart</code> we convert the generated data into an object of type <code>ColumnDataSource</code> , which we can input to the Bokeh functions for plotting.  We set the ranges of the x and y axes. </p><br><p>  As long as we do not have prompts for hover, the <code>tools</code> list is empty.  All magic happens in the function call <code>figure</code> .  We give her everything necessary for plotting: the size, the toolbar, the borders, the settings for the behavior of the chart when the browser window is resized. </p><br><p>  We create vertical columns using the <code>VBar</code> class and add them to the graph using the <code>add_glyph</code> function, which sets the rules by which the data are converted into columns. </p><br><p>  The last 2 lines change the design of the schedule.  For example, I removed the Bokeh logo with <code>plot.toolbar.logo = None</code> and added <code>plot.toolbar.logo = None</code> to both axes.  I recommend keeping the <a href="http://bokeh.pydata.org/en/latest/docs/reference/plotting.html">bokeh.plotting</a> documentation <a href="http://bokeh.pydata.org/en/latest/docs/reference/plotting.html">in</a> front of your eyes in order to know how to customize the visualization. </p><br><p>  We only need to make a couple changes to the <code>templates/chart.html</code> file to display the chart.  Open the file and replace it with the following. </p><br><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span>Bar charts with Bokeh!<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">title</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">link</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.0.min.css"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">rel</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"stylesheet"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span>Bugs found over the past {{ bars_count }} days<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">h1</span></span></span><span class="hljs-tag">&gt;</span></span> {{ the_div|safe }} <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.pydata.org/bokeh/release/bokeh-0.12.5.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://cdn.pydata.org/bokeh/release/bokeh-widgets-0.12.5.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> {{ the_script|safe }} <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  2 of 6 added lines are needed to load Bokeh CSS files, 2 more to load its scripts, and 2 more to generate graphics. </p><br><p>  Everything is ready, let's check our application.  Flask should automatically reload the app when you save changes to <code>app.py</code>  If you stop the web server, you can start it again with the <code>python app.py</code> . </p><br><p>  Open your browser <a href="http://localhost:5000/4/">localhost: 5000/4 /</a> </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-4.png"><br>  It looks a bit empty, but we can change the number of columns to 16 if we move to <a href="http://localhost:5000/16/">/ localhost: 5000/16 /</a> </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-16.png"><br>  <a href="http://localhost:5000/128/">Another 4 times more ...</a> </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-128.png"><br>  Looks pretty good.  But what if we add hints when hovering so that we can examine each column in detail?  To do this, change the function <code>create_hover_tool</code> . </p><br><h1 id="dobavlenie-podskazok-pri-navedenii">  Adding hover tips </h1><br><p>  Inside <code>app.py</code> change the <code>create_hover_tool</code> function </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_hover_tool</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Generates the HTML for the Bokeh's hover data tool on our graph."""</span></span> hover_html = <span class="hljs-string"><span class="hljs-string">""" &lt;div&gt; &lt;span class="hover-tooltip"&gt;$x&lt;/span&gt; &lt;/div&gt; &lt;div&gt; &lt;span class="hover-tooltip"&gt;@bugs bugs&lt;/span&gt; &lt;/div&gt; &lt;div&gt; &lt;span class="hover-tooltip"&gt;$@costs{0.00}&lt;/span&gt; &lt;/div&gt; """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HoverTool(tooltips=hover_html)</code> </pre> <br><p>  Embedding HTML in a Python application may seem rather strange, but this is how we determine the type of hint.  We use <code>$x</code> to show the x-coordinate of the column, <code>@bugs</code> , to show the "bugs" field of the data source and <code>$@costs{0.00}</code> , to show the "costs" field as 2 decimal places. </p><br><p>  Make sure you replace <code>return None</code> with <code>return HoverTool(tooltips=hover_html)</code> . <br>  Return to the browser and reload <a href="http://localhost:5000/128/">localhost: 5000/128 /</a> </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-128-hover-tool.png"><br>  Great job!  Try playing with the number of columns in the URL and see how the graph will look. </p><br><p>  The graph looks filled with about 100 columns, but you can try to set any value.  At 50,000 it turns out a sad picture: </p><br><p><img src="https://www.fullstackpython.com/img/170526-bar-charts-bokeh-flask/chart-example-50000.png"><br>  Yes, it seems, we need to do something else so that we can display more than a couple of hundred columns at a time. </p><br><h1 id="chto-dalshe">  What's next? </h1><br><p>  We created a great schedule on Bokeh.  Then you can change the color scheme, connect another data source, try other types of graphs, or figure out how to display huge amounts of data. </p><br><p>  With Bokeh, you can do much more, so you should look at the <a href="http://bokeh.pydata.org/en/latest/">official documentation</a> , the <a href="https://github.com/bokeh/bokeh">repository on GitHub</a> , the <a href="https://www.fullstackpython.com/bokeh.html">Bokeh page on Full Stack Python</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/330706/">https://habr.com/ru/post/330706/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../330692/index.html">Idiomatic Redux: Redo's Tao, Part 1 - Realization and Design</a></li>
<li><a href="../330694/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ266 (June 5 - 11, 2017)</a></li>
<li><a href="../330696/index.html">PHP Digest number 110 - the latest news, materials and tools (May 28 - June 11, 2017)</a></li>
<li><a href="../330702/index.html">SQL Server Integration Services (SSIS) for Beginners - Part 2</a></li>
<li><a href="../330704/index.html">Create your own custom Style plugin - Theming Views in Drupal 8</a></li>
<li><a href="../330708/index.html">You are not google</a></li>
<li><a href="../330710/index.html">Copier RFID tags standard EM-Marin</a></li>
<li><a href="../330712/index.html">NNCP: online treatment and censorship of the store-and-forward method</a></li>
<li><a href="../330714/index.html">‚ÄúCloser to the people‚Äù: how to make IaaS more accessible</a></li>
<li><a href="../330716/index.html">‚ÄúThe biggest competitor is those who do everything themselves‚Äù - Petr Zaitsev about the creation and development of the Percona company</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>