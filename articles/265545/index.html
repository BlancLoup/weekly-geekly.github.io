<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Atmospheric scattering in the video The Blacksmith</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="At the planning stage of The Blacksmith, we abandoned the fog modes built into Unity in favor of a more flexible and integrated solution. In order to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Atmospheric scattering in the video The Blacksmith</h1><div class="post__text post__text-html js-mediator-article">  At the planning stage of The Blacksmith, we abandoned the fog modes built into Unity in favor of a more flexible and integrated solution.  In order to convey the depth and scale of large stage shots, we needed the most realistic atmospheric dispersion. <br><br><img src="https://habrastorage.org/files/de7/e2f/278/de7e2f278c3f42d1abd215c1b34eb846.jpg"><br><a name="habracut"></a><br>  Starting to create a component for atmospheric scattering, we studied the simulation models presented in the <a href="http://citeseerx.ist.psu.edu/viewdoc/download%3Fdoi%3D10.1.1.75.5595%26rep%3Drep1%26type%3Dpdf">Multiple Scattering Report</a> and the <a href="http://www.researchgate.net/publication/220720838_Display_of_Clouds_Taking_into_Account_Multiple_Anisotropic_Scattering_and_Sky_Light">Multiple Anisotropic Scattering. and Sky Light</a> ), and tried to put them into practice.  After several experiments with prototypes of shots, we were finally convinced that we needed a model that would provide ample opportunity to customize the artistic effects for each shot.  In other words, we were looking for a solution that would allow us not only to realistically recreate physical parameters, but also, if necessary, to sacrifice physics for the sake of an artistic effect.  In this case, the performance of the video in real time should not have suffered, so we decided to do most of the calculations at the level of vertices, and not at the level of pixels. <br>  We set out to simulate the combined effects of Rayleigh scattering and Mie scattering on the basis of physical models.  In addition, we added a third element, which was called ‚Äúheight scattering‚Äù.  Unlike physical models, within the framework of our solution, we used ordinary HDR textures instead of procedurally generating sky and clouds.  The obvious disadvantage of this approach is that it makes it very difficult to set up a dynamic change of the time of day (which we did not need for the video).  But, on the other hand, we were able to complete the artistic setting of the sky. <br><br>  <b>Rayleigh scattering</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Rayleigh scattering of sunlight in the atmosphere gives the sky a blue color during the day and an orange-red hue at sunrise and sunset. <br>  In the video The Blacksmith we do not have the sun as such - we limited ourselves to modeling colors and the propagation / attenuation of light as a result of the scattering of the sun's rays.  A visual analogue of the sun can be added directly to the sky texture, represented as an element of Mie scattering or as a sprite.  In fact, the density of our Rayleigh scattering is reduced to an exponential function based on the Rayleigh phase function.  But at the same time, we have more opportunities to add and extract data from this formula.  We simulated the scattering of light without changing the wavelength, so in this case the density was a scalar value.  With the help of HDR Color Ramp, we diversified the shades of light attenuation at the horizon and at the zenith, and also used the distance function to create the final colors. <br><br><img src="https://habrastorage.org/files/ac4/267/fe5/ac4267fe51c84b7bb8ef21c96f59f79c.png"><br>  <i>Rayleigh scattering in various configurations.</i> <br><br>  <b>Scattering mi</b> <br><br>  As a result of MI scattering, we see a bright halo around the sun, a gray haze of clouds and smog in industrial areas.  Unlike Rayleigh scattering, which distributes light almost evenly, Mie scattering is characterized by optical anisotropy. <br>  We used Mi scattering primarily to create halos and haze around the sun.  Given the fact that our simulation of Rayleigh scattering ignored the sun, we compensated for this by increasing the intensity of the colors.  From a technical point of view, the Rayleigh and Mie functions in our simulation are very similar, with the exception of the phase function applied to the output values.  As in many other projects, we used the Heny ‚Äì Greenstein scattering function to adjust the anisotropy parameter. <br><br><img src="https://habrastorage.org/files/287/36d/0fb/28736d0fb7014299a132dc8c7bb940e2.png"><br>  <i>Mi scattering in various configurations.</i> <br><br>  Readers who are familiar with research papers on this topic may not agree with our choice of titles.  In this sense, we really allowed ourselves some liberties.  The fact is that many experts use the term ‚ÄúRayleigh scattering‚Äù to describe atmospheric scattering, and the term ‚ÄúMie scattering‚Äù to denote haze around the sun.  Therefore, we decided to adhere to these terms. <br><br>  <b>Height scatter</b> <br><br>  This element includes various atmospheric dispersion effects occurring at low altitudes: lowland fog, surface haze and stratus clouds. <br>  In this case, we found a fairly simple solution: we calculated the density based on the distance from the specified sea level, then we scaled it by exponential density and painted it in the desired color. <br><br><img src="https://habrastorage.org/files/c86/420/e95/c86420e956c14fd18ec45cb6af48d0fa.png"><br>  <i>Scattering in height in various configurations.</i> <br><br>  <b>Light obstruction</b> <br><br>  Sunlight can not only be scattered towards and away from the viewer - it can also be absorbed by particles between the viewer and the source of light.  To simulate this effect, we needed a separate solution. <br>  We traced the beams of the directional light using a cascading shadow map and calculated the obstruction in the reduced off-screen buffer.  To apply the scatter to the pixels of the final image, we increased the resolution of the shadow map using an edge-aware filter and created the final color for each pixel.  At this stage, we are faced with certain difficulties.  Considering the fact that our solution was designed solely for single scattering, we could not just take in and obscure all the absorbed light, because then the image would be very dark and unnatural.  On the other hand, a more complicated and expensive solution for multiple scattering, we also had nothing.  In the end, we decided to simply add an indirect lighting factor ‚Äî that is, the ability to manually set the percentage of direct and indirect scattering. <br><br><img src="https://habrastorage.org/files/296/e80/3a4/296e803a4515436dac442fea89fc86e3.png"><br>  <i>Obstruction of light in various configurations.</i> <br><br>  <b>Combining effects</b> <br><br>  So, it remains to bring all the effects of the final image to a common denominator.  Combining all three elements, we got a realistic color composition. <br><br><img src="https://habrastorage.org/files/7e2/c1b/0d9/7e2c1b0d90b84c13b18b3a450103139f.png"><br>  <i>Combined effects of Rayleigh scattering, Mie scattering and scattering height.</i> <br><br>  Then we made a more detailed adjustment of the attenuation values ‚Äã‚Äãof the direct and indirect illumination in the buffer. <br><br><img src="https://habrastorage.org/files/b03/209/bd3/b03209bd3e7645708958b79a04ae8a5c.png"><br>  <i>Combined scattering effects with light obstruction.</i> <br><br>  Finally, it remains to impose atmospheric scattering on the picture.  To do this, we darkened the transmitted image in the amount of attenuation and illuminated the amount of light propagation.  Here's what we got: <br><br><img src="https://habrastorage.org/files/f52/299/650/f522996509244153b03b4d009d05b4ae.jpg"><br>  <i>The final composition.</i> </div><p>Source: <a href="https://habr.com/ru/post/265545/">https://habr.com/ru/post/265545/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../265531/index.html">Emacs: we train the cursor</a></li>
<li><a href="../265533/index.html">Dell ASM vs. Cisco UCS: How We Tested Infrastructure Automation</a></li>
<li><a href="../265537/index.html">OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Two)</a></li>
<li><a href="../265541/index.html">OTRS 4.0.10. We put on Ubuntu + AD + Kerberos + SSO (Part Three)</a></li>
<li><a href="../265543/index.html">Free mono-vendor seminar: ‚ÄúKerio Connect is the solution for safe and comfortable work with e-mail‚Äù</a></li>
<li><a href="../265547/index.html">220,000 iCloud accounts compromised using a backdoor for jailbreaked iOS devices</a></li>
<li><a href="../265549/index.html">Datathon at Data Science Week</a></li>
<li><a href="../265551/index.html">IBM assembled a new brain-like system from neuromorphic chips</a></li>
<li><a href="../265553/index.html">Development of trading robots: search for market inefficiencies</a></li>
<li><a href="../265555/index.html">Why do we need and how do "perpetual links" work in social networks?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>