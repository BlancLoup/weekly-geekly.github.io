<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create GTK + applet for LXPanel</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article on how to write your applet for LXPanel. The developers have not yet written the documentation, so you have to learn from the sources, whic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create GTK + applet for LXPanel</h1><div class="post__text post__text-html js-mediator-article">  An article on how to write your applet for LXPanel.  The developers have not yet written the documentation, so you have to learn from the sources, which are, on the contrary, rich in comments. <br>  I decided to make out clearly one example and the easiest way to build into a ready <i>* .so</i> plugin. <br><br><img src="https://habrastorage.org/storage/habraeffect/67/cc/67cc1c9e81f5b4e5ca59a399e53a1565.png"><img src="https://habrastorage.org/storage/habraeffect/c6/5c/c65cc353c02bed806a7c4c30b211c5a5.png"><br><img src="https://habrastorage.org/storage/habraeffect/d4/d8/d4d8c590662d9ef1ce41866f157643e8.png"><img src="https://habrastorage.org/storage/habraeffect/b2/95/b295ac5761ba015f622bbf1476bc335a.png"><br><br>  Build comes under Ubuntu, requires minimal knowledge of C and GTK +. <br><a name="habracut"></a><br><h4>  Training </h4><br><ol><li>  Get the sources of lxpanel: <br><blockquote>  <font color="#7a0874">echo</font> <font color="#ff0000">"deb-src http://mirror.yandex.ru/ubuntu maverick main restricted universe multiverse"</font> <font color="#000000">&gt;&gt;</font> <font color="#000000">/</font> etc <font color="#000000">/</font> apt <font color="#000000">/</font> sources.list <br>  <font color="#c20cb9">apt-get</font> update <font color="#000000">&amp;&amp;</font> <font color="#c20cb9">apt-get</font> <font color="#7a0874">source</font> lxpanel <br>  <font color="#7a0874">cd</font> lxpanel-0.5.6 </blockquote><br></li><li>  Install the necessary build packages: <br><blockquote>  <font color="#c20cb9">apt-get</font> build-dep lxpanel </blockquote><br></li><li>  Check: <br><blockquote>  <font color="#007800">LIBS</font> = <font color="#ff0000">"-lX11"</font> .  <font color="#000000">/</font> configure <font color="#660033">--prefix</font> = <font color="#000000">/</font> usr <font color="#660033">--with-plugins</font> = cpufreq <br>  <font color="#c20cb9">make</font> <br>  <font color="#c20cb9">ls</font> src <font color="#000000">/</font> plugins <font color="#000000">/</font> cpufreq <font color="#000000">/</font> .libs <font color="#000000">/</font> cpufreq.so </blockquote><br></li></ol><br>  The plugin <i>cpufreq was</i> selected as a victim, later I'll tell you why.  And we will write a plugin to switch the performance &lt;-&gt; ondemand processor modes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Writing </h4><br><blockquote>  <font color="#c20cb9">vim</font> src <font color="#000000">/</font> plugins <font color="#000000">/</font> cpufreq <font color="#000000">/</font> my_plugin.c </blockquote><br><br>  Actually, all the code with comments: <br><blockquote><ol><li>  <font color="#808080">/ **</font> </li><li>  <font color="#808080">* My_plugin</font> </li><li>  <font color="#808080">* Habrahabr</font> </li><li>  <font color="#808080">* /</font> </li><li></li><li>  <font color="#339933">#include &lt;sys / types.h&gt;</font> </li><li>  <font color="#339933">#include &lt;stdio.h&gt;</font> </li><li>  <font color="#339933">#include &lt;stdlib.h&gt;</font> </li><li>  <font color="#339933">#include &lt;glib / gi18n.h&gt;</font> </li><li></li><li>  <font color="#339933">#include &lt;string.h&gt;</font> </li><li></li><li>  <font color="#339933">#include "panel.h"</font> </li><li>  <font color="#339933">#include "misc.h"</font> </li><li>  <font color="#339933">#include "plugin.h"</font> </li><li></li><li>  <font color="#666666">// To compare strings</font> </li><li>  <font color="#339933">#define STREQV (a, b) (* (a) == * (b) &amp;&amp; strcmp ((a), (b)) == 0)</font> </li><li></li><li>  <font color="#666666">// Declare the structure of our plugin</font> </li><li>  <font color="#993333">typedef</font> <font color="#993333">struct</font> <font color="#009900">{</font> </li><li>  <font color="#666666">// Widget that will contain all the icon and menu</font> </li><li>  GtkWidget <font color="#339933">*</font> namew <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> my_plugin <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Create an object</font> </li><li>  <font color="#993333">static</font> my_plugin <font color="#339933">*</font> mp <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Plugin structure is declared in src / plugin.h</font> </li><li>  <font color="#666666">// * mp_p - now plugin class</font> </li><li>  <font color="#666666">// Which at least sets the parent container mp_p-&gt; pwid</font> </li><li>  <font color="#666666">// Our mp-&gt; namew widget is "inserted" into it</font> </li><li>  <font color="#666666">// And the icon, for example, is contained in mp-&gt; namew</font> </li><li>  <font color="#666666">// Long death hide</font> </li><li>  <font color="#993333">static</font> Plugin <font color="#339933">*</font> mp_p <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// An announcement speaks for itself</font> </li><li>  <font color="#993333">static</font> <font color="#993333">char</font> get_governor <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  FILE <font color="#339933">*</font> fpipe <font color="#339933">;</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> governor <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> line <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Problem with recognizing cpufreq-info output</font> </li><li>  <font color="#666666">// Script / usr / local / bin / cpufreq-gov returns the name of the current mode</font> </li><li>  fpipe <font color="#339933">=</font> <font color="#009900">(</font> FILE <font color="#339933">*</font> <font color="#009900">)</font> popen <font color="#009900">(</font> <font color="#ff0000">"/ usr / local / bin / cpufreq-gov"</font> <font color="#339933">,</font> <font color="#ff0000">"r"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  fgets <font color="#009900">(</font> line <font color="#339933">,</font> <font color="#993333">sizeof</font> <font color="#009900">(</font> line <font color="#009900">)</font> <font color="#339933">,</font> fpipe <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  pclose <font color="#009900">(</font> fpipe <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> line <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// An announcement speaks for itself</font> </li><li>  <font color="#993333">static</font> <font color="#993333">char</font> get_frequency <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  FILE <font color="#339933">*</font> fpipe <font color="#339933">;</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> governor <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> line <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Problem with recognizing cpufreq-info output</font> </li><li>  <font color="#666666">// Script / usr / local / bin / cpufreq-gov returns the name of the current mode</font> </li><li>  fpipe <font color="#339933">=</font> <font color="#009900">(</font> FILE <font color="#339933">*</font> <font color="#009900">)</font> popen <font color="#009900">(</font> <font color="#ff0000">"cpufreq-info -f -m"</font> <font color="#339933">,</font> <font color="#ff0000">"r"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  fgets <font color="#009900">(</font> line <font color="#339933">,</font> <font color="#993333">sizeof</font> <font color="#009900">(</font> line <font color="#009900">)</font> <font color="#339933">,</font> fpipe <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  pclose <font color="#009900">(</font> fpipe <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  line <font color="#009900">[</font> strlen <font color="#009900">(</font> line <font color="#009900">)</font> <font color="#339933">-</font> <font color="#0000dd">1</font> <font color="#009900">]</font> <font color="#339933">=</font> <font color="#ff0000">' <font color="#006699">\ 0</font> '</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> line <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Make the function update the icons when changing the mode</font> </li><li>  <font color="#993333">static</font> <font color="#993333">void</font> refresh_icon <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666">// Find out the current mode</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> governor <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> line <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">=</font> get_governor <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  sprintf <font color="#009900">(</font> governor <font color="#339933">,</font> <font color="#ff0000">"% s"</font> <font color="#339933">,</font> line <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// mp_p-&gt; pwid is the parent container of type GTKWidget, which contains mp-&gt; namew</font> </li><li>  <font color="#666666">// Remove the mp-&gt; namew widget and change the icon</font> </li><li>  gtk_container_remove <font color="#009900">(</font> GTK_CONTAINER <font color="#009900">(</font> mp_p <font color="#339933">-&gt;</font> pwid <font color="#009900">)</font> <font color="#339933">,</font> mp <font color="#339933">-&gt;</font> namew <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// If the mode is "ondemand"</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> STREQV <font color="#009900">(</font> governor <font color="#339933">,</font> <font color="#ff0000">"ondemand"</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#666666">// One badge</font> </li><li>  mp <font color="#339933">-&gt;</font> namew <font color="#339933">=</font> gtk_image_new_from_file <font color="#009900">(</font> <font color="#ff0000">"/usr/share/lxpanel/images/cpufreq_ond.png"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#b1b100">else</font> </li><li>  <font color="#009900">{</font> </li><li>  <font color="#666666">// Otherwise, another</font> </li><li>  mp <font color="#339933">-&gt;</font> namew <font color="#339933">=</font> gtk_image_new_from_file <font color="#009900">(</font> <font color="#ff0000">"/usr/share/lxpanel/images/cpufreq_perf.png"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  <font color="#666666">// Insert the mp-&gt; namew widget back into the mp_p-&gt; pwid parent container</font> </li><li>  gtk_container_add <font color="#009900">(</font> GTK_CONTAINER <font color="#009900">(</font> mp_p <font color="#339933">-&gt;</font> pwid <font color="#009900">)</font> <font color="#339933">,</font> mp <font color="#339933">-&gt;</font> namew <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_show_all <font color="#009900">(</font> mp_p <font color="#339933">-&gt;</font> pwid <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Mode change function</font> </li><li>  <font color="#993333">static</font> <font color="#993333">void</font> set_governor <font color="#009900">(</font> GtkWidget <font color="#339933">*</font> widget <font color="#339933">,</font> <font color="#993333">char</font> <font color="#339933">*</font> p <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> exec <font color="#009900">[</font> <font color="#0000dd">32</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  sprintf <font color="#009900">(</font> exec <font color="#339933">,</font> <font color="#ff0000">"cpufreq-set -g% s"</font> <font color="#339933">,</font> p <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  system <font color="#009900">(</font> exec <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  refresh_icon <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Create a menu</font> </li><li>  <font color="#993333">static</font> GtkWidget <font color="#339933">*</font> mp_menu <font color="#009900">(</font> <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  GtkMenu <font color="#339933">*</font> menu <font color="#339933">=</font> gtk_menu_new <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  GSList <font color="#339933">*</font> group <font color="#339933">=</font> NULL <font color="#339933">;</font> </li><li>  GtkWidget <font color="#339933">*</font> menuitem <font color="#339933">,</font> <font color="#339933">*</font> radio1 <font color="#339933">,</font> <font color="#339933">*</font> radio2 <font color="#339933">;</font> </li><li></li><li>  FILE <font color="#339933">*</font> fpipe <font color="#339933">;</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> governor <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#993333">const</font> <font color="#993333">char</font> frequency <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li>  <font color="#993333">char</font> line <font color="#009900">[</font> <font color="#0000dd">16</font> <font color="#009900">]</font> <font color="#339933">;</font> </li><li></li><li>  line <font color="#339933">=</font> get_governor <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  sprintf <font color="#009900">(</font> governor <font color="#339933">,</font> <font color="#ff0000">"% s"</font> <font color="#339933">,</font> line <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  line <font color="#339933">=</font> get_frequency <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  sprintf <font color="#009900">(</font> frequency <font color="#339933">,</font> <font color="#ff0000">"% s"</font> <font color="#339933">,</font> line <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// 1) Add the current frequency to the menu, make the item inactive</font> </li><li>  menuitem <font color="#339933">=</font> gtk_menu_item_new_with_label <font color="#009900">(</font> frequency <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_menu_append <font color="#009900">(</font> menu <font color="#339933">,</font> menuitem <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_set_sensitive <font color="#009900">(</font> menuitem <font color="#339933">,</font> FALSE <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_show <font color="#009900">(</font> menuitem <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// 2) Add a separator</font> </li><li>  menuitem <font color="#339933">=</font> gtk_separator_menu_item_new <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_menu_append <font color="#009900">(</font> menu <font color="#339933">,</font> menuitem <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_show <font color="#009900">(</font> menuitem <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// 3) 2 radio buttons for switching between modes</font> </li><li>  radio1 <font color="#339933">=</font> gtk_radio_menu_item_new_with_label <font color="#009900">(</font> group <font color="#339933">,</font> <font color="#ff0000">"Savings"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  group <font color="#339933">=</font> gtk_radio_menu_item_get_group <font color="#009900">(</font> GTK_RADIO_MENU_ITEM <font color="#009900">(</font> radio1 <font color="#009900">)</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> STREQV <font color="#009900">(</font> governor <font color="#339933">,</font> <font color="#ff0000">"ondemand"</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  gtk_check_menu_item_set_active <font color="#009900">(</font> GTK_CHECK_MENU_ITEM <font color="#009900">(</font> radio1 <font color="#009900">)</font> <font color="#339933">,</font> TRUE <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  gtk_menu_append <font color="#009900">(</font> menu <font color="#339933">,</font> radio1 <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_show <font color="#009900">(</font> radio1 <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// 4) The second button</font> </li><li>  radio2 <font color="#339933">=</font> gtk_radio_menu_item_new_with_label <font color="#009900">(</font> group <font color="#339933">,</font> <font color="#ff0000">"Performance"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">if</font> <font color="#009900">(</font> STREQV <font color="#009900">(</font> governor <font color="#339933">,</font> <font color="#ff0000">"performance"</font> <font color="#009900">)</font> <font color="#009900">)</font> </li><li>  <font color="#009900">{</font> </li><li>  gtk_check_menu_item_set_active <font color="#009900">(</font> GTK_CHECK_MENU_ITEM <font color="#009900">(</font> radio2 <font color="#009900">)</font> <font color="#339933">,</font> TRUE <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li>  gtk_menu_append <font color="#009900">(</font> menu <font color="#339933">,</font> radio2 <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_widget_show <font color="#009900">(</font> radio2 <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// When you click on the radio buttons, the modes switch</font> </li><li>  g_signal_connect <font color="#009900">(</font> G_OBJECT <font color="#009900">(</font> radio1 <font color="#009900">)</font> <font color="#339933">,</font> <font color="#ff0000">"toggled"</font> <font color="#339933">,</font> G_CALLBACK <font color="#009900">(</font> set_governor <font color="#009900">)</font> <font color="#339933">,</font> <font color="#ff0000">"ondemand"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  g_signal_connect <font color="#009900">(</font> G_OBJECT <font color="#009900">(</font> radio2 <font color="#009900">)</font> <font color="#339933">,</font> <font color="#ff0000">"toggled"</font> <font color="#339933">,</font> G_CALLBACK <font color="#009900">(</font> set_governor <font color="#009900">)</font> <font color="#339933">,</font> <font color="#ff0000">"performance"</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#b1b100">return</font> menu <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Event handler for clicking on the plugin icon</font> </li><li>  <font color="#993333">static</font> gboolean clicked <font color="#009900">(</font> GtkWidget <font color="#339933">*</font> widget <font color="#339933">,</font> GdkEventButton <font color="#339933">*</font> evt <font color="#339933">,</font> Plugin <font color="#339933">*</font> plugin <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  gtk_menu_popup <font color="#009900">(</font> mp_menu <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">,</font> NULL <font color="#339933">,</font> NULL <font color="#339933">,</font> NULL <font color="#339933">,</font> NULL <font color="#339933">,</font> evt <font color="#339933">-&gt;</font> button <font color="#339933">,</font> evt <font color="#339933">-&gt;</font> time <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#b1b100">return</font> TRUE <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Object constructor proper</font> </li><li>  <font color="#993333">static</font> <font color="#993333">int</font> constructor <font color="#009900">(</font> Plugin <font color="#339933">*</font> p <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  <font color="#666666">// Create an object</font> </li><li>  mechanism_mp <font color="#339933">=</font> g_new0 <font color="#009900">(</font> my_plugin <font color="#339933">,</font> <font color="#0000dd">1</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  p <font color="#339933">-&gt;</font> priv <font color="#339933">=</font> mechanism_mp <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Make the parent widget sensitive (we follow the events)</font> </li><li>  <font color="#666666">// And remove the window decoration from it</font> </li><li>  p <font color="#339933">-&gt;</font> pwid <font color="#339933">=</font> gtk_event_box_new <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  GTK_WIDGET_SET_FLAGS <font color="#009900">(</font> p <font color="#339933">-&gt;</font> pwid <font color="#339933">,</font> GTK_NO_WINDOW <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  gtk_container_set_border_width <font color="#009900">(</font> GTK_CONTAINER <font color="#009900">(</font> p <font color="#339933">-&gt;</font> pwid <font color="#009900">)</font> <font color="#339933">,</font> <font color="#0000dd">0</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// Set the initial icon</font> </li><li>  refresh_icon <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  <font color="#666666">// When clicked, the clicked () handler function is triggered.</font> </li><li>  g_signal_connect <font color="#009900">(</font> G_OBJECT <font color="#009900">(</font> p <font color="#339933">-&gt;</font> pwid <font color="#009900">)</font> <font color="#339933">,</font> <font color="#ff0000">"button_press_event"</font> <font color="#339933">,</font> G_CALLBACK <font color="#009900">(</font> clicked <font color="#009900">)</font> <font color="#339933">,</font> <font color="#009900">(</font> gpointer <font color="#009900">)</font> p <font color="#009900">)</font> <font color="#339933">;</font> </li><li></li><li>  gtk_widget_show <font color="#009900">(</font> mechanism_mp <font color="#339933">-&gt;</font> namew <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// Destructor</font> </li><li>  <font color="#993333">static</font> <font color="#993333">void</font> destructor <font color="#009900">(</font> Plugin <font color="#339933">*</font> p <font color="#009900">)</font> <font color="#009900">{</font> </li><li>  my_plugin <font color="#339933">*</font> mechanism_mp <font color="#339933">=</font> <font color="#009900">(</font> my_plugin <font color="#339933">*</font> <font color="#009900">)</font> p <font color="#339933">-&gt;</font> priv <font color="#339933">;</font> </li><li>  g_free <font color="#009900">(</font> mechanism_mp <font color="#009900">)</font> <font color="#339933">;</font> </li><li>  <font color="#009900">}</font> </li><li></li><li>  <font color="#666666">// And here we specify information about our plugin</font> </li><li>  PluginClass mp_plugin_class <font color="#339933">=</font> <font color="#009900">{</font> </li><li>  PLUGINCLASS_VERSIONING <font color="#339933">,</font> </li><li></li><li>  type <font color="#339933">:</font> <font color="#ff0000">"my_plugin"</font> <font color="#339933">,</font> </li><li>  name <font color="#339933">:</font> N_ <font color="#009900">(</font> <font color="#ff0000">"My super plugin"</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li>  version <font color="#339933">:</font> <font color="#ff0000">"1.0"</font> <font color="#339933">,</font> </li><li>  description <font color="#339933">:</font> N_ <font color="#009900">(</font> <font color="#ff0000">"Habrahabr"</font> <font color="#009900">)</font> <font color="#339933">,</font> </li><li></li><li>  constructor <font color="#339933">:</font> constructor <font color="#339933">,</font> </li><li>  destructor <font color="#339933">:</font> destructor <font color="#339933">,</font> </li><li>  <font color="#666666">// In our plugin are not used,</font> </li><li>  <font color="#666666">// but you can assign handlers for the configuration, save the configuration</font> </li><li>  <font color="#666666">// And widget redrawing, when changing configuration</font> </li><li>  config <font color="#339933">:</font> NULL <font color="#339933">,</font> </li><li>  save <font color="#339933">:</font> NULL <font color="#339933">,</font> </li><li>  panel_configuration_changed <font color="#339933">:</font> NULL </li><li>  <font color="#009900">}</font> <font color="#339933">;</font> </li><li></li></ol></blockquote><br><br><h4>  Compilation </h4><br>  You can add our plugin to the build scripts, but this is not necessary and it is extremely dreary.  Therefore, just take the <i>cpufreq</i> victim plugin and replace its source <i>src / plugins / cpufreq / cpufreq.c with</i> ours. <br>  We collect: <br><blockquote>  <font color="#007800">LIBS</font> = <font color="#ff0000">"-lX11"</font> .  <font color="#000000">/</font> configure <font color="#660033">--prefix</font> = <font color="#000000">/</font> usr <font color="#660033">--with-plugins</font> = cpufreq <br>  <font color="#c20cb9">make</font> <br></blockquote><br>  Ready <i>* .so</i> is in <i>src / plugins / cpufreq / .libs /</i> , you need to <i>drop</i> it into the folder with the other plugins, only under a different name, for example <i>/usr/lib/lxpanel/plugins/my_plugin.so</i> <br><br>  The contents of <i>/ usr / local / bin / cpufreq-gov</i> : <br><blockquote><ol><li>  <font color="#666666">#! / bin / sh</font> </li><li></li><li>  <font color="#7a0874">echo</font> <font color="#000000">`</font> cpufreq-info <font color="#660033">-p</font> <font color="#000000">|</font>  <font color="#c20cb9">awk</font> <font color="#ff0000">'{print $ 3}'</font> <font color="#000000">`</font> </li></ol></blockquote><br><br>  2 icons in <i>/ usr / share / lxpanel / images /</i> : <br><img src="https://habrastorage.org/storage/habraeffect/8d/86/8d864a254bd133a243fc99c0eca4efbe.png" title="cpufreq_perf.png"><img src="https://habrastorage.org/storage/habraeffect/2d/6c/2d6ccc266403fe6ceb9dad0890400769.png" title="cpufreq_ond.png"><br><br><h4>  Finally </h4><br>  For greater clarity, I advise you to read the files, they are rich in comments. <br><ul><li>  src / plugin.c </li><li>  src / plugin.h </li><li>  src / panel.c </li><li>  src / panel.h </li></ul><br><br>  Good luck!  Example <a href="https://gist.github.com/6a68edcc0b7b0beec38b">source</a> : <a href="https://gist.github.com/6a68edcc0b7b0beec38b">my_plugin.c</a> </div><p>Source: <a href="https://habr.com/ru/post/109342/">https://habr.com/ru/post/109342/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109336/index.html">Printed batch</a></li>
<li><a href="../109337/index.html">The Kinect game controller is the first device on the market for direct three-dimensional measurement.</a></li>
<li><a href="../109339/index.html">Where do Intel processors</a></li>
<li><a href="../109340/index.html">IMHO about projects with Startup Weekend</a></li>
<li><a href="../109341/index.html">Sony sells HDTV with built-in Playstation 2HDTV</a></li>
<li><a href="../109345/index.html">Introduction to asynchronous operations in C # 5</a></li>
<li><a href="../109346/index.html">New issue of UserAndLINUX - v10.12 (4) has been released</a></li>
<li><a href="../109350/index.html">Online RPG Ecilavia on WebGL</a></li>
<li><a href="../109359/index.html">All ways of making money on the Internet (infographics)</a></li>
<li><a href="../109360/index.html">Another post of disappointment with Beeline or how the tariff 2010 ceased to correspond to the name</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>