<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bot for playing Sokoban brute force</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I started playing BoxWorld (a game like Sokoban), the first 20-30 levels were interesting, but then the complexity and monotony began to outweigh...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bot for playing Sokoban brute force</h1><div class="post__text post__text-html js-mediator-article">  When I started playing BoxWorld (a game like Sokoban), the first 20-30 levels were interesting, but then the complexity and monotony began to outweigh and I decided to write a bot.  I couldn‚Äôt come up with any tricky solution algorithm, so I wrote to brute force.  Wrote in C #. <a name="habracut"></a><br><br>  In the first version I went through the movements of the loader itself (the robot).  Went through recursively in depth, to protect against looping, he kept all passed options in the array.  He gave the solution in the form of a string indicating the order in which to press the buttons in the game.  I downloaded this sequence into MacroExpress, and it already sent clicks to the game window.  By adjusting the pause between sending clicks you could watch the passage of the levels at a convenient speed. <br><br>  The bot decided the first few levels and was stuck for a couple of days at the next.  This level was 2 times more than the previous one, but the time for finding solutions grew exponentially.  So without waiting for an answer, I began to write the second version.  The movements of the robot replaced the movements of the boxes, so  It is no longer necessary to store the moves of the robot path from one box to another.  At each turn, I determined which boxes the robot could now reach and which way to push. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then the bot decided the next few levels and got stuck again.  Then there were some more versions: <br>  - added restriction of the recursion depth, assuming that most levels can be solved in less than 100 drawer movements; <br>  - marked on the map static dead ends, such as a corner or the first row along a flat wall, because  then it will be impossible to pull out the drawer; <br>  - added a simple analysis of the course and discarding obvious dynamic deadlocks such as shifting a square of 4 boxes; <br>  - the storage of the coordinates of all previous moves was replaced by the storage of their hashes, so that more memory would be stored and it would be faster to search <br><br>  All this made it possible to advance even at several levels, but it became clear that the complexity of the decisions greatly increased with each level.  Then I chose the largest level - 86. If the bot decides it, it will cope with the rest easily. <br><br>  So, level 86. <br><img src="https://habrastorage.org/getpro/habr/post_images/d11/c4e/597/d11c4e5973aaa56ce71542e75a222ca5.jpg"><br>  It contains 46 boxes and 156 cells of the field.  At the same time 40 cells are static dead-end places, a total of 116 cells to which the box can be moved.  This means that the number of different options will not exceed 116 ^ 46 = 92271483792519010208299118408158326223759549834325815837590809967385695915673894137078445244416. Yes, this is a 95-digit number.  It is ~ = 9.2e + 94.  The maximum number of moves in this case makes no sense to take into account since  such an assessment turned out to be even more: let's assume a maximum of moves = 100, and on average each move can push each box in at least one direction out of four, then the number of options will not exceed (46 * 1) ^ 100 ~ = 1.9e + 166 . <br><br>  Supplement about heuristics: <br>  - static dead ends <br><img src="https://habrastorage.org/getpro/habr/post_images/179/9f3/07c/1799f307c534c9c0825c8ad77e6276d8.png"><br>  It is clear that if you slide the box to any place marked with a red marker, then it will be impossible to tear it from the wall to push it to its destination.  Such places I pre-mark on the map and the bot does not make such moves in the process of iteration. <br><br>  - dynamic deadlocks <br><img src="https://habrastorage.org/getpro/habr/post_images/d98/42a/f95/d9842af95d0a0ab1ac242849788c14eb.png"><br>  It is clear that if you move 4 drawers with a square (in various combinations with drawers and walls), then it will be impossible to tear them apart from each other.  The bot analyzes each move and does not make moves leading to such a square. <br>  More difficult yet did not invent. <br><br>  Of course, the real options will be much less than the first estimate due to the cutting off of dynamic deadlocks, probably by several orders of magnitude.  But even if you take half the orders of this number (92271483792519010208299118408158326223759549834) and store the status of each move in just one byte, you will need 83920425634022658603 terabytes. <br><br>  It was then that I realized that ‚Äúit‚Äôs still to wait and the bot will go through all the moves‚Äù as at the first levels it will not work.  It is necessary to change something drastically in the algorithm, to carry out a more complex and lengthy analysis at each turn, but to cut off more subtrees of options.  But I don‚Äôt know how exactly to do this ... maybe you can advise me?  Use some techniques from the field of graphs, ant algorithms, neural networks? </div><p>Source: <a href="https://habr.com/ru/post/130417/">https://habr.com/ru/post/130417/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../130403/index.html">On departure from the repair team</a></li>
<li><a href="../130404/index.html">The first post is the most important one. LG Electronics officially on HabraHabr.ru</a></li>
<li><a href="../130408/index.html">10k Apart - Responsive Edition Contest Results</a></li>
<li><a href="../130410/index.html">Clodo Cloud Storage</a></li>
<li><a href="../130413/index.html">Idea to express your gratitude</a></li>
<li><a href="../130419/index.html">Compiling a JavaScript project using Maven and Closure Compiler</a></li>
<li><a href="../130421/index.html">Year we measure the soil moisture on the ESP8266 and two batteries. Part 2</a></li>
<li><a href="../130422/index.html">Playing YouTube videos using WebView</a></li>
<li><a href="../130425/index.html">Steve Jobs and the drug trafficking policy</a></li>
<li><a href="../130426/index.html">In Ukraine, the bill ‚ÄúOn internal trade‚Äù was approved, which establishes the rules for the operation of online stores</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>