<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Metaprogramming (with JavaScript examples)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is another attempt to rethink metaprogramming , which I periodically make. The idea is clarified each time, but this time it was possible...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Metaprogramming (with JavaScript examples)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" src="https://habrastorage.org/getpro/habr/post_images/728/995/cd9/728995cd95ea5cd7821905542b0e074f.jpg">  This article is another attempt to rethink <a href="http://habrahabr.ru/post/137446/"><b>metaprogramming</b></a> , which I <a href="http://habrahabr.ru/post/154891/">periodically</a> make.  The idea is clarified each time, but this time it was possible to pick up fairly simple and understandable <b>examples</b> that are both very compact and illustrative, have real useful applications and do not pull libraries and dependencies.  At the time of publication I will report this topic on <a href="http://odessajs.org.ua/"><b>OdessaJS</b></a> , therefore, the article can be used as a place for questions and comments on the report.  The format of the article makes it possible to more fully present the material than in the report, whose listeners are <b>not exempt from reading</b> . <br><br>  A popular understanding of <b>metaprogramming is</b> usually very vague, and most often ends with such options: <ul><li>  Compilation templates and macros </li><li>  Program that changes itself </li><li>  A program that generates another program. </li></ul><br>  I propose the following definition: <br>  <b><i>Metaprogramming is a programming paradigm built on a programmatic change in the structure and behavior of programs.</i></b> <br>  And then we will analyze how it works, why it is needed and what advantages and disadvantages we get in the end. <br><br><a name="habracut"></a><br><h4>  What is modeling? </h4><br>  The concept of <b>metaprogramming</b> is closely related to <b>modeling</b> , because the method itself involves <b>increasing the level of</b> model <b>abstraction</b> by <b>removing metadata</b> from the model.  As a result, we get the <b>metamodel</b> and <b>metadata</b> .  During early or late <b>binding</b> (when compiling, translating, or running the program), we again obtain the model from the metamodel and metadata using an automatic program method.  The created model can change many times, without changing the program code of the metamodel, and often, even without stopping the program. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Surprisingly, a person is able to successfully solve problems, the complexity of which exceeds the capabilities of his memory and thinking, with the help of building <b>models</b> and <b>abstractions</b> .  The accuracy of these models determines their usefulness for decision-making and the development of control actions.  The model is always not accurate and displays only a small part of reality, one or several of its sides or aspects.  However, in limited conditions of use, the model may be indistinguishable from the real object of the domain.  There are physical, mathematical, imitation and other types of models, but we will be interested, first of all, in information data models and program logic models.  Programming paradigms, these are the models of program logic, for example, imperative, declarative, functional, event.  As programmers, we can designate not writing code, but, first of all, building models and abstractions.  Thus, metaprogramming allows us to raise the level of abstraction in models, which makes them more universal, and our work is much more interesting. <br><br><br><h4>  What is metaprogramming? </h4><br>  <b>Metaprogramming</b> is not something new; you have always used it, if you have experience in practical programming in any language and in any applied field of application.  All programming paradigms, at least for the computer of the <b><i>Vonnemann architecture</i></b> , in one way or another inherit the basic principles of modeling from this architecture.  The most important principle of the von Neumann architecture is the mixing of data and commands that define the logic of data processing in one universal memory.  That is, the <b><i>lack of a fundamental difference between the program and the data</i></b> .  This gives a lot of consequences, first, the machine needs to distinguish where the command is, and where is the number and what is its width and type, where is the address, and where is the array, where is the string, and where is the length of this string, in what encoding is it represented ., up to complex structures, as objects and scopes.  All this is determined by metadata; without metadata, nothing happens at all in the programming languages ‚Äã‚Äãfor the von Neumann architecture.  Secondly, the program gains access to the memory in which it is stored, other programs, their source code, and can process the code as data, which allows translation and interpretation, automated testing and optimization, introspection and debugging, dynamic linking, and much more. another. <br><br>  Definitions: <br>  <b><i>Metadata</i></b> is data about data.  For example, the type of the variable is the metadata of the variable, and the names and types of the parameters of the function are the metadata of this function. <br>  <b><i>Introspection</i></b> is a mechanism that allows a program to receive metadata about memory structures during work, including metadata about variables and functions, types and objects, classes and prototypes. <br>  <b><i>Dynamic binding</i></b> (or late binding) is a function call through an identifier, which is converted to the address of a call only at the execution stage. <br>  <b><b>A metamodel</b></b> is a high-level abstract model, from which metadata is taken out, and which dynamically generates a specific model when receiving metadata. <br>  <b><b>Metaprogramming</b></b> is a programming paradigm built on a programmatic change in the structure and behavior of programs. <br><br>  So, one cannot begin to apply metaprogramming from today, but one can realize, analyze and apply the tool consciously.  This is paradoxical, but many seek to separate data and logic using the Vonleyman architecture.  Meanwhile, they should not be separated, but combined in the right way.  There are other architectures, such as analog solvers, digital signal processors (DSP), programmable logic integrated circuits (FPGAs), and others.  In these architectures, the calculations are not made imperatively, that is, not by the sequence of processing operations specified by the algorithm, but by parallel digital or analog elements that implement many mathematical and logical operations in real time and have an answer ready at any moment.  These are analogues of reactive and functional programming.  In FPGA circuit switching occurs during reprogramming, and in DSP, the imperative logic controls the small re-switching of circuits in real time.  Metaprogramming is also possible for systems with non-imperative or hybrid logic, for example, I see no reason that one FPGA could not reprogram the other. <br><br>  Now we will consider the <b>generalized model</b> shown in the diagram of the program module.  Each module necessarily has an external interface and software logic.  And such components as configuration, state and permanent memory can either be absent or play the main role.  A module receives requests from other modules through the interface and responds to them, exchanging data in certain protocols.  The module sends requests to the interfaces of other modules from any place of its program logic, therefore incoming communications are integrated by the interface, and outgoing communications are scattered throughout the module body.  Modules are part of larger modules and are themselves built from several or many sub-modules.  The generic model is suitable for modules of any scale, ranging from functions and objects, to processes, servers, clusters and large information systems.  When modules interact, requests and responses are data, but they <b>necessarily contain metadata</b> that affect how the module will process the data or how it tells the other module to process the data. <img src="https://habrastorage.org/getpro/habr/post_images/556/c34/b03/556c34b0314588c38b5bbf3928da073d.png">  Typically, a set of metadata is limited by the fact that the protocol necessarily requires the structure of the transmitted data to be read.  In binary formats, metadata is less than in syntax formats used to serialize data (such as JSON and MIME).  Information about the structure of binary formats, for the most part, is located at the receiving module in the form of a struct (structures for C, C ++, C #, and other languages) or <b>‚Äúwired‚Äù into the logic of the interpreting module in</b> another way.  It is rather difficult to divide where the data processing with the use of metadata ends and the metaprogramming begins.  Conventionally, you can define the following criterion: when metadata not only describes structures, but increases the abstraction of program code in a module that interprets data and metadata, this is where metaprogramming begins.  In other words, when the <b>transition from the model to the metamodel</b> occurs.  The main feature of such a transition is the expansion of the universality of the module, and not the expansion of the universality of the protocol or data format.  The diagram on the right shows how metadata is extracted from the data and enters the module, changing its behavior during data processing.  Thus, the <b>abstract metamodel</b> contained in the module at the execution stage is transformed into a <b>concrete model</b> . <br><br>  Before proceeding to the consideration of the techniques and techniques of metaprogramming, I would like to quote one, which I always quote when it comes to metaprogramming.  It suggests the idea that metaprogramming is a reflection of such a fundamental law on which all cybernetic systems are based.  That is, the systems are ‚Äúliving‚Äù, in which control, correction of behavior and activity parameters takes place with the help of closed-loop control.  This allows systems to reproduce their state and structure in different conditions and with different modifications, while maintaining significant and varying behavior, including generating derivative systems for this. <br><br><blockquote> <i>‚ÄúThis is what I mean by producing work, or, as I called it last time,‚Äú opera operans. ‚Äù</i>  <i>In philosophy, there is a distinction between "natura naturata" and "natura naturans" - the generated nature and the generating nature.</i>  <i>By analogy one could form - ‚Äúcultura culturata‚Äù and ‚Äúcultura culturans‚Äù.</i>  <i>For example, the novel ‚ÄúIn Search of Lost Time‚Äù is not built as a work, but as ‚Äúcultura culturans‚Äù or ‚Äúopera operans‚Äù.</i>  <i>This is what the Greeks called Logos. "</i> <br>  <b>// Merab Mamardashvili "Lectures on ancient philosophy"</b> </blockquote><br><h4>  How does metaprogramming work? </h4><br>  Based on the definition, you need to disassemble the following three questions: <ol><li>  When do changes occur? </li><li>  What exactly is changing? </li><li>  What are the changes taking place? </li></ol><br>  <b>When changes occur</b> : <b>development time</b> metaprogramming, for example, when the IDE analyzes your code as data, helps to modify it, prompts the names of objects and functions, their types and even generates templates or automatically builds blocks of code from schemes or visual modeling tools, for example , in the visual editors of user interfaces, databases and other CAD / CAM tools for automated development.  Examples of <b>compile-time</b> changes: translators, including for creating typed algorithms from untyped and for generating code from a language with a higher level of abstraction into a language that is executed in a particular environment, up to the OS and the hardware platform.  But we are more interested in <b>changing the behavior of programs during their work</b> , which we will consider in more detail below. <br><br>  So, I propose the following classification of metaprogramming by time of changes in behavior and structure: <ul><li>  during development (Design time) </li><li>  at compile time </li><li>  while the application is running (Run time) <ul><li>  during the execution of the task (Just-in-Time) </li><li>  between tasks (lazy) <ul><li>  on time (Timer) </li><li>  external call (pull) </li><li>  event (Push) </li></ul></li></ul></li></ul>  Just-in-Time interpreting and linking is not the best way, but sometimes it is the only possible way if the metadata comes along with the data.  But metadata, however, changes less frequently than requests occur, so the model can be built in advance and cached while waiting for requests and data.  You can update the model with specific calls, to minimize requests, or you can periodically poll the source of the storage of metadata for changes.  It is best, of course, to have a channel of notifications from the source, so that it initiates an update on the push principle. <br><br>  <b>What exactly is changing?</b> <ul><li>  data <b>types</b> and data <b>structures</b> ; </li><li>  <b>identifiers</b> (the names of classes, types, variables, both inside the module, and the names by which the module refers to other modules); </li><li>  <b>calls</b> (names of functions and methods, dynamic linking, including using the stub / skeleton pattern, in which, in one module, a stub is built representing the object, class or function located in the address space of the remote module, so that all calls to the stub were identical to remote calls); </li><li>  <b>parameters of</b> data processing algorithms or parameters of models, which may vary; </li><li>  <b>substitution of</b> expressions, formulas and logical expressions, regular expressions, etc .; </li><li>  the code itself is dynamically <b>interpreted</b> (metadata is usually declarative, but this is not necessary, it can be imperative or it can contain imperative code fragments); </li><li>  <b>serialization / deserialization of</b> data, objects and classes, as well as <b>marshaling</b> with code correction during transmission from one module to another (usually address correction, but there may be other corrections). </li></ul><br>  <b>What are the changes taking place?</b> <ul><li>  <b>Parsing</b> and translating syntax structures (with string operations or regular expressions). </li><li>  Access to <b>identifiers by name</b> or index (including object parameters, associative arrays, etc.). </li><li>  Complete <b>introspection</b> (see definition above, if the concept is unusual). </li><li>  <b>Individuation</b> of first-class objects (main way): <ul><li>  functions, through closures; </li><li>  objects, through dynamic creation and impurities; </li><li>  by all conceivable and inconceivable means provided by a programming language. </li></ul></li></ul><br><h4>  Why do we need metaprogramming? </h4><br>  Now we can identify the main tasks and cases where metaprogramming significantly simplifies the implementation or even makes the solution possible: <ul><li>  Expansion of functionality, increasing software versatility. </li><li>  Dynamic subject areas when changes are regular mode. </li><li>  Simplifying intersystem integration is a separate topic, but it helps a lot. </li></ul><br><h4>  Example 1 </h4><br>  Consider the simplest example of extracting metadata from a model and building a metamodel (see the <a href="https://github.com/tshemsedinov/metaprogramming/tree/master/1-extract-metadata">example on github</a> ).  First, we define the problem of the example: there is an array of strings, you need to filter them according to certain rules: the length of suitable strings should be from 10 to 200 characters, inclusive, but excluding strings from 50 to 65 characters long;  the line should begin with "Mich" and not begin with "Abu";  the string must contain ‚ÄúV‚Äù and not contain ‚ÄúLev‚Äù;  the string must end in ‚Äúov‚Äù and must not end in ‚Äúiov‚Äù.  We define the data for an example: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> names = [ <span class="hljs-string"><span class="hljs-string">'Marcus Aurelius Antoninus Augustus'</span></span>, <span class="hljs-string"><span class="hljs-string">'Darth Vader'</span></span>, <span class="hljs-string"><span class="hljs-string">'Victor Michailovich Glushkov'</span></span>, <span class="hljs-string"><span class="hljs-string">'Gottfried Wilhelm von Leibniz'</span></span>, <span class="hljs-string"><span class="hljs-string">'Mao Zedong'</span></span>, <span class="hljs-string"><span class="hljs-string">'Vladimir Sergeevich Soloviov'</span></span>, <span class="hljs-string"><span class="hljs-string">'Ibn Arabi'</span></span>, <span class="hljs-string"><span class="hljs-string">'Lev Nikolayevich Tolstoy'</span></span>, <span class="hljs-string"><span class="hljs-string">'Muammar Muhammad Abu Minyar al-Gaddafi'</span></span>, <span class="hljs-string"><span class="hljs-string">'Rene Descartes'</span></span>, <span class="hljs-string"><span class="hljs-string">'Fyodor Mikhailovich Dostoyevsky'</span></span>, <span class="hljs-string"><span class="hljs-string">'Benedito de Espinosa'</span></span> ];</code> </pre> <br>  We implement logic without metaprogramming: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">names</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = [], name; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i=<span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;names.length; i++) { name = names[i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( name.length &gt;= <span class="hljs-number"><span class="hljs-number">10</span></span> &amp;&amp; name.length &lt;= <span class="hljs-number"><span class="hljs-number">200</span></span> &amp;&amp; name.indexOf(<span class="hljs-string"><span class="hljs-string">'Mich'</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; name.indexOf(<span class="hljs-string"><span class="hljs-string">'V'</span></span>) === <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; name.slice(<span class="hljs-number"><span class="hljs-number">-2</span></span>) === <span class="hljs-string"><span class="hljs-string">'ov'</span></span> &amp;&amp; !( name.length &gt;= <span class="hljs-number"><span class="hljs-number">50</span></span> &amp;&amp; name.length &lt;= <span class="hljs-number"><span class="hljs-number">65</span></span> &amp;&amp; name.indexOf(<span class="hljs-string"><span class="hljs-string">'Abu'</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> &amp;&amp; name.indexOf(<span class="hljs-string"><span class="hljs-string">'Lev'</span></span>) === <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; name.slice(<span class="hljs-number"><span class="hljs-number">-3</span></span>) === <span class="hljs-string"><span class="hljs-string">'iov'</span></span> ) ) result.push(name); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; }</code> </pre><br>  Select the metadata from the model of the solution of the problem and form them into a separate structure: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">length</span></span>: [<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">200</span></span>], <span class="hljs-attr"><span class="hljs-attr">contains</span></span>: <span class="hljs-string"><span class="hljs-string">'Mich'</span></span>, <span class="hljs-attr"><span class="hljs-attr">starts</span></span>: <span class="hljs-string"><span class="hljs-string">'V'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ends</span></span>: <span class="hljs-string"><span class="hljs-string">'ov'</span></span>, <span class="hljs-attr"><span class="hljs-attr">not</span></span>: { <span class="hljs-attr"><span class="hljs-attr">length</span></span>: [<span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">65</span></span>], <span class="hljs-attr"><span class="hljs-attr">contains</span></span>: <span class="hljs-string"><span class="hljs-string">'Abu'</span></span>, <span class="hljs-attr"><span class="hljs-attr">starts</span></span>: <span class="hljs-string"><span class="hljs-string">'Lev'</span></span>, <span class="hljs-attr"><span class="hljs-attr">ends</span></span>: <span class="hljs-string"><span class="hljs-string">'iov'</span></span> } }</code> </pre><br>  Building a meta model: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filter</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">names, conditions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> operations = { <span class="hljs-attr"><span class="hljs-attr">length</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, v</span></span></span><span class="hljs-function">) =&gt;</span></span> s.length &gt;= v[<span class="hljs-number"><span class="hljs-number">0</span></span>] &amp;&amp; s.length &lt;= v[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-attr"><span class="hljs-attr">contains</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, v</span></span></span><span class="hljs-function">) =&gt;</span></span> s.indexOf(v) &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span>, <span class="hljs-attr"><span class="hljs-attr">starts</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, v</span></span></span><span class="hljs-function">) =&gt;</span></span> s.indexOf(v) === <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">ends</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, v</span></span></span><span class="hljs-function">) =&gt;</span></span> s.slice(-v.length) === v, <span class="hljs-attr"><span class="hljs-attr">not</span></span>: <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, v</span></span></span><span class="hljs-function">) =&gt;</span></span> !check(s,v) }; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">check</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s, conditions</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> valid = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> conditions) valid &amp;= operations[key](s, conditions[key]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> valid; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> names.filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function"> =&gt;</span></span> check(s, conditions)); }</code> </pre><br>  The advantage of solving the problem using metaprogramming is obvious; we have obtained a universal string filter with configurable logic.  If you need to filter more than once, but several, on the same metadata configuration, then the metamodel can be wrapped into a closure and get cached for an individual function to speed up the work. <br><br><h4>  Example 2 </h4><br>  We will write the second example right away with the help of metaprogramming (see the <a href="https://github.com/tshemsedinov/metaprogramming/tree/master/2-level-up">example on github</a> ), because if I imagine its size in size in a govnokode, then it becomes scary to me.  Task description: you need to make HTTP GET / POST requests from specific URLs or load data from files and transfer received or read data via HTTP PUT / POST to other URLs and / or save them to files.  There will be several such operations and they need to be performed at various time intervals.  The task can be described as metadata as follows: <br><br><pre> <code class="javascript hljs">[ { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-number"><span class="hljs-number">5000</span></span>, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method1.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">save</span></span>: <span class="hljs-string"><span class="hljs-string">'file1.json'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-string"><span class="hljs-string">'8s'</span></span>, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method2.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">put</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method4.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">save</span></span>: <span class="hljs-string"><span class="hljs-string">'file2.json'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-string"><span class="hljs-string">'7s'</span></span>, <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method3.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method5.json'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-string"><span class="hljs-string">'4s'</span></span>, <span class="hljs-attr"><span class="hljs-attr">load</span></span>: <span class="hljs-string"><span class="hljs-string">'file1.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">put</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method6.json'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-string"><span class="hljs-string">'9s'</span></span>, <span class="hljs-attr"><span class="hljs-attr">load</span></span>: <span class="hljs-string"><span class="hljs-string">'file2.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'http://127.0.0.1/api/method7.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">save</span></span>: <span class="hljs-string"><span class="hljs-string">'file1.json'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">interval</span></span>: <span class="hljs-string"><span class="hljs-string">'3s'</span></span>, <span class="hljs-attr"><span class="hljs-attr">load</span></span>: <span class="hljs-string"><span class="hljs-string">'file1.json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">save</span></span>: <span class="hljs-string"><span class="hljs-string">'file3.json'</span></span> }, ]</code> </pre><br>  We solve the problem using metaprogramming: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tasks</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">closureTask</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">task</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.dir(task); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> source; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.get) source = request.get(task.get); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.load) source = fs.createReadStream(task.load); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.save) source.pipe(fs.createWriteStream(task.save)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.post) source.pipe(request.post(task.post)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (task.put) source.pipe(request.put(task.put)); } }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; tasks.length; i++) { setInterval(closureTask(tasks[i]), duration(tasks[i].interval)); } }</code> </pre><br>  We see that we have written "beautiful columns" and we can make another convolution, having rendered the metadata already inside the metamodel.  How metamodel configured by metadata will look like: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iterate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">tasks</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Metamodel configuration metadata // let sources = { get: request.get, load: fs.createReadStream }; let destinations = { save: fs.createWriteStream, post: request.post, put: request.put }; // Metamodel logic // function closureTask(task) { return () =&gt; { console.dir(task); let verb, source, destination; for (key in sources) if (task[key]) source = sources[key](task[key]); for (key in destinations) if (task[key]) source.pipe(destinations[key](task[key])); } } for (let i = 0; i &lt; tasks.length; i++) { setInterval(closureTask(tasks[i]), duration(tasks[i].interval)); } }</span></span></code> </pre><br>  I note that the example uses closures for the individualization of tasks. <br><br><h4>  Example 3 </h4><br>  The second example uses the duration function, which returns a value in milliseconds, which we did not consider.  This function interprets the interval value specified as a string in the format: ‚ÄúDd Hh Mm Ss‚Äù, for example ‚Äú1d 10h 7m 13s‚Äù, each component of which is optional, for example ‚Äú1d 25s‚Äù, if the function receives a number, then it returns it, it is necessary for the convenience of setting metadata if we specify the interval directly in milliseconds. <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// Parse duration to seconds, example: duration('1d 10h 7m 13s') // Parse duration to seconds // Example: duration('1d 10h 7m 13s') // function duration(s) { let result = 0; if (typeof(s) === 'string') { let days = s.match(/(\d+)\s*d/), hours = s.match(/(\d+)\s*h/), minutes = s.match(/(\d+)\s*m/), seconds = s.match(/(\d+)\s*s/); if (days) result += parseInt(days[1]) * 86400; if (hours) result += parseInt(hours[1]) * 3600; if (minutes) result += parseInt(minutes[1]) * 60; if (seconds) result += parseInt(seconds[1]); result = result * 1000; } if (typeof(s) === 'number') result = s; return result; }</span></span></code> </pre><br>  Now we implement the interpretation configured by the metadata: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">duration</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">s</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(s) === <span class="hljs-string"><span class="hljs-string">'number'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> s; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> units = { <span class="hljs-attr"><span class="hljs-attr">days</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/(\d+)\s*d/</span></span>, <span class="hljs-attr"><span class="hljs-attr">mul</span></span>: <span class="hljs-number"><span class="hljs-number">86400</span></span> }, <span class="hljs-attr"><span class="hljs-attr">hours</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/(\d+)\s*h/</span></span>, <span class="hljs-attr"><span class="hljs-attr">mul</span></span>: <span class="hljs-number"><span class="hljs-number">3600</span></span> }, <span class="hljs-attr"><span class="hljs-attr">minutes</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/(\d+)\s*m/</span></span>, <span class="hljs-attr"><span class="hljs-attr">mul</span></span>: <span class="hljs-number"><span class="hljs-number">60</span></span> }, <span class="hljs-attr"><span class="hljs-attr">seconds</span></span>: { <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-regexp"><span class="hljs-regexp">/(\d+)\s*s/</span></span>, <span class="hljs-attr"><span class="hljs-attr">mul</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span> } }; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> result = <span class="hljs-number"><span class="hljs-number">0</span></span>, unit, match; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(s) == =<span class="hljs-string"><span class="hljs-string">'string'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> units) { unit = units[key]; match = s.match(unit.rx); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (match) result += <span class="hljs-built_in"><span class="hljs-built_in">parseInt</span></span>(match[<span class="hljs-number"><span class="hljs-number">1</span></span>]) * unit.mul; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result * <span class="hljs-number"><span class="hljs-number">1000</span></span>; }</code> </pre><br><h4>  Example 4 </h4><br>  Now let's look at metaprogramming with introspection applied to integrate modules.  First, we define the remote methods on the client using this structure and show how to use these calls when writing application logic: <br><img align="right" src="http://habrastorage.org/files/dd6/d14/1ec/dd6d141ec61f450288ef6b0ab8f2c4f1.png"><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ds = wcl.AjaxDataSource({ <span class="hljs-attr"><span class="hljs-attr">read</span></span>: { <span class="hljs-attr"><span class="hljs-attr">get</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/read.json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">insert</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/insert.json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">update</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/update.json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">delete</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/delete.json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">find</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/find.json'</span></span> }, <span class="hljs-attr"><span class="hljs-attr">metadata</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">'examples/person/metadata.json'</span></span> } }); ds.read({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">5</span></span> }, (err, data) =&gt; { data.phone = <span class="hljs-string"><span class="hljs-string">'+0123456789'</span></span>; ds.update(data, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Data saved'</span></span>)); });</code> </pre><br>  Now let's initialize from the metadata received from another module and show that the applied logic has not changed: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ds = wcl.AjaxDataSource({ <span class="hljs-attr"><span class="hljs-attr">introspect</span></span>: { <span class="hljs-attr"><span class="hljs-attr">post</span></span>: <span class="hljs-string"><span class="hljs-string">"examples/person/introspect.json"</span></span> } }); ds.read({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>:<span class="hljs-number"><span class="hljs-number">3</span></span> }, (err, data) =&gt; { data.phone =<span class="hljs-string"><span class="hljs-string">"+0123456789"</span></span>; ds.update(data, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Data saved'</span></span>)); });</code> </pre><br>  In the next example, we will create a local data source with the same interface as the remote one and show that the application logic has not changed either: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ds = wcl.MemoryDataSource({ <span class="hljs-attr"><span class="hljs-attr">data</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Person 1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">phone</span></span>: <span class="hljs-string"><span class="hljs-string">'+380501002011'</span></span>, <span class="hljs-attr"><span class="hljs-attr">emails</span></span>: [ <span class="hljs-string"><span class="hljs-string">'person1@domain.com'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">age</span></span>: <span class="hljs-number"><span class="hljs-number">25</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Person 2'</span></span>, <span class="hljs-attr"><span class="hljs-attr">phone</span></span>: <span class="hljs-string"><span class="hljs-string">'+380501002022'</span></span>, <span class="hljs-attr"><span class="hljs-attr">emails</span></span>: [ <span class="hljs-string"><span class="hljs-string">'person2@domain.com'</span></span>, <span class="hljs-string"><span class="hljs-string">'person2@domain2.com'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">address</span></span>: { <span class="hljs-attr"><span class="hljs-attr">city</span></span>: <span class="hljs-string"><span class="hljs-string">'Kiev'</span></span>, <span class="hljs-attr"><span class="hljs-attr">street</span></span>: <span class="hljs-string"><span class="hljs-string">'Khreschatit'</span></span>, <span class="hljs-attr"><span class="hljs-attr">building</span></span>: <span class="hljs-string"><span class="hljs-string">'26'</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'Person 3'</span></span>, <span class="hljs-attr"><span class="hljs-attr">phone</span></span>: <span class="hljs-string"><span class="hljs-string">'+380501002033'</span></span>, <span class="hljs-attr"><span class="hljs-attr">emails</span></span>: [ <span class="hljs-string"><span class="hljs-string">'person3@domain.com'</span></span> ], <span class="hljs-attr"><span class="hljs-attr">tags</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'tag1'</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'red'</span></span> }, { <span class="hljs-attr"><span class="hljs-attr">tag</span></span>: <span class="hljs-string"><span class="hljs-string">'tag2'</span></span>, <span class="hljs-attr"><span class="hljs-attr">color</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span> } ] }, ]}); ds.read({ <span class="hljs-attr"><span class="hljs-attr">id</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span> }, (err, data) =&gt; { data.phone =<span class="hljs-string"><span class="hljs-string">"+0123456789"</span></span>; ds.update(data, () =&gt; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">'Data saved'</span></span>)); });</code> </pre><br><h4>  findings </h4><br>  <b>Metaprogramming Techniques</b> <ul><li>  Task description style: declarative (metadata), use of imperative and functional inserts </li><li>  Hashes (associative arrays) do not know the key in advance: let a = {};  a [key] = value; </li><li>  Interpret strings, invent your own syntax or take common (json, js, regexp ...) </li><li>  Impurities (mixins): do not know in advance where to add function mixin (a) {a.fn = () =&gt; {...}} </li><li>  Closures: we personalize the functions fn = (a =&gt; () =&gt; a * 2) (value) </li></ul>  <b>The implications of metaprogramming</b> <ul><li>  Code size: often decreases dramatically, but sometimes it may increase slightly </li><li>  Speed: slightly reduced, but with proper implementation remains about the same </li><li>  Flexibility: the software code becomes more versatile, the scope of software is expanding </li><li>  Integration: usually much easier and requires less code changes </li><li>  Pleasure from work: it is more interesting to metaprogramme therefore pleasure and motivation is more </li><li>  Development speed: develop longer, and maintain much easier, save a lot of time </li></ul><br><h4>  Related Links </h4><br><ol><li>  Full source code of examples on Github: <a href="https://github.com/tshemsedinov/metaprogramming">https://github.com/tshemsedinov/metaprogramming</a> </li><li>  Slides to the report: <a href="http://www.slideshare.net/tshemsedinov/javascript-36636872">http://www.slideshare.net/tshemsedinov/javascript-36636872</a> </li></ol><br><h5>  Old articles to follow the development of the idea </h5><br><ol><li>  Metaprogramming <a href="http://habrahabr.ru/post/137446/">http://habrahabr.ru/post/137446/</a> </li><li>  Dynamic interpretation of metamodels <a href="http://habrahabr.ru/post/154891/">http://habrahabr.ru/post/154891/</a> </li><li>  Expanded dynamic interpretation scheme <a href="http://blog.meta-systems.com.ua/2011/01/blog-post_28.html">http://blog.meta-systems.com.ua/2011/01/blog-post_28.html</a> </li><li>  Using metamodels when designing databases with several abstract layers: Part 1 <a href="http://habrahabr.ru/post/119317/">http://habrahabr.ru/post/119317/</a> </li><li>  Using metamodels when designing databases with several abstract layers: Part 1 <a href="http://habrahabr.ru/post/119885/">http://habrahabr.ru/post/119885/</a> </li><li>  Integration of information systems <a href="http://habrahabr.ru/post/117468/">http://habrahabr.ru/post/117468/</a> </li><li>  Introduction of the meta-level <a href="http://blog.meta-systems.com.ua/2011/01/blog-post.html">http://blog.meta-systems.com.ua/2011/01/blog-post.html</a> </li><li>  Metamodel in the problems of information systems integration <a href="http://blog.meta-systems.com.ua/2010/07/blog-post.html">http://blog.meta-systems.com.ua/2010/07/blog-post.html</a> </li><li>  Integration at the level of calls or meta-data?  <a href="http://blog.meta-systems.com.ua/2009/10/blog-post_18.html">http://blog.meta-systems.com.ua/2009/10/blog-post_18.html</a> </li><li>  Model and metamodel <a href="http://blog.meta-systems.com.ua/2009/10/blog-post_05.html">http://blog.meta-systems.com.ua/2009/10/blog-post_05.html</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/227753/">https://habr.com/ru/post/227753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../227741/index.html">PolyITAN-1 - the first Ukrainian nanosatellite in orbit</a></li>
<li><a href="../227743/index.html">Using characters and scenarios in testing your Calendar</a></li>
<li><a href="../227747/index.html">Application Porno or how to find secrets in mobile applications and take out everything</a></li>
<li><a href="../227749/index.html">Split Screen mode or Split Screen do it yourself</a></li>
<li><a href="../227751/index.html">From prototype to prototype, from prototype to prototype, from prototype to ... trash</a></li>
<li><a href="../227755/index.html">4 myths about landing page</a></li>
<li><a href="../227761/index.html">Searchcode 2.0</a></li>
<li><a href="../227763/index.html">Payoneer and Ball To All - a ball for each child</a></li>
<li><a href="../227767/index.html">Configuring OpenVPN in the Mikrotik / Ubuntu bundle</a></li>
<li><a href="../227769/index.html">Include Node.js in your solution for Microsoft Azure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>