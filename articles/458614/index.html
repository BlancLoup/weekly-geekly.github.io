<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating a React-Hook usePosition () to get and track browser coordinates</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In short 


 In this article, we will create a usePosition() React hook to track browser geolocation. Under the hood, this hook will use the getCurren...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating a React-Hook usePosition () to get and track browser coordinates</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/b2e/801/b0c/b2e801b0c809c1b2059b4e0d712a71b1.jpg" alt="image"></p><br><h2 id="esli-vkratce">  In short </h2><br><p> In this article, we will create a <code>usePosition()</code> React hook to track browser geolocation.  Under the hood, this hook will use the <code>getCurrentPosition()</code> and <code>watchPosition()</code> methods of the native browser object <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation">navigator.geolocation</a> .  I published the final version of the hook <a href="https://github.com/trekhleb/use-position"><b>on GitHub</b></a> and <a href="https://www.npmjs.com/package/use-position"><b>NPM</b></a> . </p><br><h2 id="zachem-sozdavat-huk-useposition-v-principe">  Why create the <code>usePosition()</code> hook in principle <code>usePosition()</code> </h2><br><p>  One of the important advantages of <a href="https://reactjs.org/docs/hooks-intro.html">hooks</a> in React is the ability to isolate logically related code fragments in one place (in a hook), while avoiding the need to mix logically unrelated code fragments, for example, in the component <code>componentDidMount()</code> method. </p><br><p>  Suppose we want to get the coordinates of the browser ( <code>latitude</code> and <code>longitude</code> ) and after receiving the coordinates request the weather forecast or the current temperature in this region from a third-party service.  The code for these two functionalities (getting coordinates and querying temperature) in React is often placed inside the same <code>componentDidMount()</code> method.  In this case, the <code>componentWillUnmount()</code> method is usually "cleaned up" behind itself, calling the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Geolocation/clearWatch">clearWatch ()</a> method to stop tracking the location of the browser.  Such an approach increases the size of the methods, breaks logically related parts of the code into parts (separate subscription and unsubscribe from spying on the location of the browser) and combines logically weakly connected parts of the code into one method (obtaining coordinates and temperatures).  Reading the code is difficult, as is its debugging and support. </p><br><p>  Next, we will try to bring the functionality related to getting the coordinates of the browser into a separate <code>usePosition()</code> hook, in order to avoid the difficulties listed above. </p><a name="habracut"></a><br><h2 id="kak-my-budem-ispolzovat-huk-useposition">  How we will use the hook <code>usePosition()</code> </h2><br><p>  Let's go "by contradiction" and before the implementation of the hook itself, let's plan how we will use it.  This will help us decide on the hook interface (what it will receive and what to return). </p><br><p>  The simplest example of obtaining coordinates and displaying them on the screen might look like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> React <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    . import { usePosition } from './usePosition'; export const UsePositionDemo = () =&gt; { //    ( ) . const { latitude, longitude, error } = usePosition(); //       (   ). return ( &lt;&gt; latitude: {latitude}, longitude: {longitude}, error: {error} &lt;/&gt; ); };</span></span></code> </pre> <br><p>  Just one line with the hook <code>usePosition()</code> and we can operate with the coordinates <code>latitude</code> and <code>longitude</code> .  We did not even use the <code>useState()</code> or <code>useEffect()</code> hooks explicitly here.  A subscription to tracking coordinates, as well as deleting a subscriber is encapsulated into one <code>usePosition()</code> hook.  Then the magic of redrawing the components of React will do everything for us.  At the beginning, the coordinates will be <code>null</code> or <code>undefined</code> .  As soon as the coordinates are received, the component will be redrawn and we will see them on the screen. </p><br><h2 id="realizaciya-huka-useposition">  Implement hook <code>usePosition()</code> </h2><br><p>  Our <code>usePosition()</code> hook is a regular JavaScript function that looks like this: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  . export const usePosition = () =&gt; { //    . }</span></span></code> </pre> <br><p>  We will use the <a href="https://reactjs.org/docs/hooks-state.html">useState ()</a> hooks for internal storage of coordinates and <a href="https://reactjs.org/docs/hooks-effect.html">useEffect ()</a> for subscription and unsubscribe from tracking coordinates.  For this we have to import them. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//     . }</span></span></code> </pre> <br><p>  Create state variables in which we will store coordinates or an error in obtaining coordinates (for example, if the user refuses to share his location). </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//  ... }</span></span></code> </pre> <br><p>  Also at this stage we can return the variables that are expected from the hook.  So far there is nothing useful in these variables, but we will fix it soon. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">// other code goes here... return { ...position, error }; }</span></span></code> </pre> <br><p>  And now the key moment of implementation is getting the coordinates. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     ,    .. useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  In the <code>useEffect()</code> hook, we first check to see if the browser supports coordinate detection.  If the functionality is not supported, we exit the hook with an error.  Otherwise, we subscribe to changes in the browser's location using the onChange <code>onChange()</code> and <code>onError()</code> (we will add their code below).  Please note that from the <code>useEffect()</code> hook we return an anonymous function that will be executed if the component is removed from the display.  In this anonymous function, we unsubscribe from spying so as not to clutter up the memory.  Thus, the whole logic of subscription and unsubscribe from tracking is in the same hook <code>usePosition()</code> . </p><br><p>  Let's add the missing callbacks: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { useState, useEffect } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'react'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> usePosition = <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [position, setPosition] = useState({}); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> [error, setError] = useState(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> onChange = <span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">{latitude, longitude}</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-comment"><span class="hljs-comment">//        position,   //    ,    . setPosition({latitude, longitude}); }; const onError = (error) =&gt; { setError(error.message); }; useEffect(() =&gt; { const geo = navigator.geolocation; if (!geo) { setError('   '); return; } //     . watcher = geo.watchPosition(onChange, onError); //  ,       //    ,    . return () =&gt; geo.clearWatch(watcher); }, []); return {...position, error}; }</span></span></code> </pre> <br><p>  The <code>usePosition()</code> hook is ready to use. </p><br><h2 id="naposledok">  At last </h2><br><p>  You can find a <a href="https://trekhleb.github.io/use-position/%3Fpath%3D/story/useposition--high-accuracy-watching">demonstration of the work of the hook</a> and its more detailed implementation with the ability to set tracking parameters on <a href="https://github.com/trekhleb/use-position"><b>GitHub</b></a> . </p><br><p>  I hope this article has been helpful to you.  Successful coding! </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/458614/">https://habr.com/ru/post/458614/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../458594/index.html">Do not forget to increase the chance of response to the client, using a second request in L7 balancing</a></li>
<li><a href="../4586/index.html">"Soup" explains its policy</a></li>
<li><a href="../45860/index.html">Website creation in Veliky Novgorod and other provincial cities</a></li>
<li><a href="../458604/index.html">Why the two largest electronics manufacturers joined forces in a new GPU project</a></li>
<li><a href="../458606/index.html">Run OpenVPN in Docker in 2 seconds</a></li>
<li><a href="../45863/index.html">Mini photo studio at home</a></li>
<li><a href="../45864/index.html">Do I need articles / translations on Windows Workflow Foundation?</a></li>
<li><a href="../45865/index.html">We recognize the operator and the region of the mobile phone</a></li>
<li><a href="../45867/index.html">Communicator Qigi i6</a></li>
<li><a href="../45868/index.html">Audio manipulation like MIDI</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>