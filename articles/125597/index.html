<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing PHP extension</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="And let's take a look at PHP today from a different point of view, and write an extension to it. Since on this topic there have already been publicati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing PHP extension</h1><div class="post__text post__text-html js-mediator-article">  And let's take a look at PHP today from a different point of view, and write an extension to it.  Since on this topic there have already been publications on Habr√© ( <a href="http://habrahabr.ru/blogs/php/98862/">here</a> and <a href="http://habrahabr.ru/blogs/php/75388/">here</a> ), we will not delve into the reasons for why this may be useful and for what can be used in practice.  This article will explain how to build simple extensions under Windows using Visual C ++ and under Debian using GCC.  I will also try to light up a little work with PHP arrays inside extensions and compare the performance of the algorithm written in native PHP and using code written in C. <br><br><a name="habracut"></a><br><h2>  Compile under Win32 </h2><br>  So let's start with Windows.  <a href="https://wiki.php.net/internals/windows/stepbystepbuild">As you know</a> , PHP developers use Visual C ++ 9 or Visual Studio 2008 to compile their creation under Windows.  Therefore, we will use Visual Studio 2008, the free <a href="http://www.microsoft.com/express/download/">Express</a> version is also suitable, as indeed, probably, later and earlier versions of the studio. <br><br>  What we need: <ul><li>  PHP 5.3 compiled binaries available <a href="http://windows.php.net/download">here</a> </li><li>  PHP 5.3 sources, which can be <a href="http://php.net/downloads.php">downloaded from the site</a> or pulled from the <a href="https://svn.php.net/repository/php/php-src/branches/PHP_5_3">public SVN</a> , </li><li>  The desire to experiment and a little patience. </li></ul>  First, create a Win32 Console Application type project and select a DLL in the Application type.  Now we have to configure all dependencies and paths for the linker: <ul><li>  Right-click in Solution Explorer and select Properties&gt; C / C ++&gt; General&gt; Additional Include Directories.  Here we will add directories in which the unpacked source codes and PHP header files are located.  Specifically will need: <br><pre> php-5.3.6
 php-5.3.6 \ main
 php-5.3.6 \ TSRM
 php-5.3.6 \ Zend
</pre><br></li><li>  Now add the preprocessor definitions that are needed to correctly select the platform and compile the module.  Choose Configuration Properties&gt; C / C ++&gt; Preprocessor&gt; Preprocessor Definitions, and add the following to it: <br><pre> PHP_WIN32
 ZEND_WIN32
 ZTS = 1
 ZEND_DEBUG = 0
</pre><br></li><li>  Then we point the linker where you can find the necessary libraries.  Choose Configuration Properties&gt; Linker&gt; General&gt; Additional Library Directories.  There we select the \ div directory from the PHP binaries.  You should get something like this: "D: \ Program Files \ php-5.3.6-Win32-VC9-x86 \ dev". 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  Now we indicate the specific libu for the linker.  Go to Configuration Properties&gt; Linker&gt; Input&gt; Additional Dependencies, and enter php5ts.lib, which is located in the same \ dev directory that we specified in the previous step. <br><br></li><li>  To avoid some compilation problems, add the / FORCE: MULTIPLE directive in Configuration Properties Linker Command Line.  You can read more about it on the <a href="http://msdn.microsoft.com/en-us/library/70abkas3.aspx">MSDN</a> website. <br><br></li><li>  And finally, you can specify where to save the compiled dll.  To do this, go to Configuration Properties&gt; Linker&gt; General&gt; Output Filename and specify the path to the \ ext folder of the installed PHP.  You should get something like this: "D: \ Program Files \ php-5.3.6-Win32-VC9-x86 \ ext \ $ (ProjectName) .dll". </li></ul>  Find the stdafx.h file in the project and replace its contents with the following: <br><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">ifndef</span></span></span><span class="hljs-meta"> STDAFX #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> STDAFX #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> PHP_COMPILER_ID </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"VC9"</span></span></span><span class="hljs-meta"> </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">//        PHP,  Visual C++ 9.0 #include "zend_config.w32.h" #include "php.h" #endif</span></span></span></span></code> </pre> <br>  If you try to compile the project at this stage, you will get an error saying that main \ config.w32.h is missing.  You can get it either by running the main \ configure.bat script, or you can pull it out of the sources, for example, PHP 5.2.  In this case, do not forget to edit all the paths in this file and uncomment the "#define HAVE_SOCKLEN_T" directive.  Now the project should compile without errors. <br><br>  Now let's write hello world, add the following to our cpp file: <br><br><pre> <code class="php hljs">PHP_FUNCTION(test); <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> zend_function_entry test_functions[] = { PHP_FE(test, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>) {<span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>} }; zend_module_entry test_module_entry = { STANDARD_MODULE_HEADER, <span class="hljs-comment"><span class="hljs-comment">// #if ZEND_MODULE_API_NO &gt;= 20010901 "test", //   test_functions, //    NULL, // PHP_MINIT(test), Module Initialization NULL, // PHP_MSHUTDOWN(test), Module Shutdown NULL, // PHP_RINIT(test), Request Initialization NULL, // PHP_RSHUTDOWN(test), Request Shutdown NULL, // PHP_MINFO(test), Module Info ( phpinfo()) "0.1", //    STANDARD_MODULE_PROPERTIES }; ZEND_GET_MODULE(test) PHP_FUNCTION(test) { RETURN_STRING("hello habr", 1); //  PHP-,   ,         }</span></span></code> </pre> <br>  Now we will connect this module in PHP and try to run something like this: <br><pre> <code class="bash hljs">php -r <span class="hljs-string"><span class="hljs-string">"test();"</span></span></code> </pre>  To which we should get the answer ‚Äúhello habr‚Äù. <br><br><br><h2>  Compilation under * nix </h2><br>  In * nix, everything turned out to be easier as always.  I will show with the example of Debian, I think that under other systems the process will not be different. <br>  We will need: <ul><li>  Have PHP installed on the machine, </li><li>  Have a php-dev installed.  To do this, just execute one command: <br><pre> <code class="bash hljs">apt-get install php5-dev</code> </pre></li></ul>  Let's create somewhere a directory for our extension.  Well, for example / test.  There we will create two empty files: <br><pre> config.m4
 test.c
</pre><br>  The first is needed for the magic compilation of the extension, and the second is its source code.  In config.m4 we will write the following: <br><pre> <code class="cpp hljs">PHP_ARG_ENABLE(test, Enable test support) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> test <span class="hljs-string"><span class="hljs-string">"$PHP_TEST"</span></span> = <span class="hljs-string"><span class="hljs-string">"yes"</span></span>; <span class="hljs-function"><span class="hljs-function">then </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AC_DEFINE</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(HAVE_TEST, </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">, [You have test extension])</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PHP_NEW_EXTENSION</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(test, test.c, $ext_shared)</span></span></span><span class="hljs-function"> fi</span></span></code> </pre> <br>  Inside test.c add <br><pre> <code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"php.h"</span></span></span></span></code> </pre> <br>  And after this deadline, copy the contents of the cpp-file from the Windows version. <br>  Now we go to the console and: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># phpize //        # ./configure //  makefile # make //  # make install //  .so    PHP </span></span></code> </pre> <br>  That's all.  Now you can open php.ini, add your extension there: <br><pre> extension = test.so
</pre><br>  And check its performance team <br><pre> <code class="bash hljs">php -r <span class="hljs-string"><span class="hljs-string">"test();"</span></span></code> </pre> <br><br><h2>  Argument handling and return values </h2><br><br>  First, let's look at how you can take arguments: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* text; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> text_length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, <span class="hljs-string"><span class="hljs-string">"s"</span></span>, &amp;text, &amp;text_lenght) == FAILURE) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; }</code> </pre> <br>  The third parameter specifies the expected type ( <a href="http://devzone.zend.com/article/1022">here</a> you can see all the options), in this case it is char * or int.  Also under the link you can find options for combining types and specifying the number of arguments.  All of the following parameters are variables in which the passed values ‚Äã‚Äãwill be written.  When passing a string, the string itself and its length are transmitted. <br>  If the number of arguments passed to your function does not match, E_WARNING will be thrown, and you can return some value, for example, an error message. <br><br>  You can return both simple types and complex ones.  Let's get acquainted with the formation of the returned array.  To indicate that the array will be returned, it must be initialized: <br><pre> <code class="cpp hljs">array_init(result);</code> </pre><br>  To add values ‚Äã‚Äãto an array, you must use functions depending on which index and value is added to the array.  For example: <br><pre> <code class="cpp hljs">add_next_index_long(result, <span class="hljs-number"><span class="hljs-number">42</span></span>); <span class="hljs-comment"><span class="hljs-comment">// $result[] = 42; add_assoc_bool(result, "foo", 1); // $result['foo'] = true; add_next_index_null(result); // $result[] = NULL;</span></span></code> </pre><br>  A full list of features can be found <a href="http://devzone.zend.com/article/1022">here.</a> <br><br>  If you are interested in someone, I can consider an example of working with objects in the next article (a classic example of extending objects is mysqli).  <a href="http://devzone.zend.com/article/4486-Wrapping-C-Classes-in-a-PHP-Extension">There</a> is a very good article on this topic. <br><br><br><h2>  Performance </h2><br>  To check the performance, I chose a somewhat synthetic example: counting the occurrence of each character in a string.  In other words, we need to get a function that takes a string as a parameter, and returns an array in which the number of uses of each character in a given string is indicated.  This example will demonstrate working with large strings. <br><br>  I got this implementation, do not kick much for the code, I still write more in PHP than in C: <br><br><pre> <code class="cpp hljs">PHP_FUNCTION(calculate_chars) { <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>* text; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> text_length; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (zend_parse_parameters(ZEND_NUM_ARGS() TSRMLS_CC, <span class="hljs-string"><span class="hljs-string">"s"</span></span>, &amp;text, &amp;text_length) == FAILURE) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } array_init(return_array); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> table[<span class="hljs-number"><span class="hljs-number">256</span></span>] = { <span class="hljs-number"><span class="hljs-number">0</span></span> }; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; text_length; i++) { table[((<span class="hljs-keyword"><span class="hljs-keyword">unsigned</span></span> <span class="hljs-keyword"><span class="hljs-keyword">char</span></span>*)text)[i]]++; } <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> str[<span class="hljs-number"><span class="hljs-number">2</span></span>]; str[<span class="hljs-number"><span class="hljs-number">1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">256</span></span>; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (table[i]) { str[<span class="hljs-number"><span class="hljs-number">0</span></span>] = (<span class="hljs-keyword"><span class="hljs-keyword">char</span></span>)i; add_assoc_long(return_array, str, table[i]); } } }</code> </pre> <br>  This code produces the following result: <br><pre> <code class="bash hljs">user&gt; php -r <span class="hljs-string"><span class="hljs-string">"print_r( calculate_chars('example') );"</span></span> Array ( [a] =&gt; 1 [e] =&gt; 2 [l] =&gt; 1 [m] =&gt; 1 [p] =&gt; 1 [x] =&gt; 1 }</code> </pre> <br>  And now let's compare the speed of execution of this code and the same for native PHP: <br><br><pre> <code class="php hljs">$map = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $length; $i++) { $char = $text[$i]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($map[$char])) { $map[$char]++; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $map[$char] = <span class="hljs-number"><span class="hljs-number">1</span></span>; } }</code> </pre> <br>  I will compare the execution time of both solutions using the <a href="http://php.net/manual/en/function.microtime.php">microtime</a> function.  Take a line of 100 characters, a line of 5000 characters, and a line of 69000 characters (I took the book A Message from the Sea, written by Charles Dickens, I hope he will forgive me for this), and for each option we will chase both solutions several thousand times .  The results are shown in the table below.  Testing was conducted on my not very strong home laptop and VDS with Debian on board, and yes, I clearly understand that the results may depend on the configuration, operating system version, PHP, atmospheric pressure and wind direction, but I wanted to show only approximate numbers . <br>  The full code of the test script can be downloaded <a href="">here</a> .  The sources and binaries of the extensions themselves can be downloaded <a href="">here (win)</a> and <a href="">here (nix)</a> . <br><table border="1"><tbody><tr><td></td><td>  Number of iterations </td><td>  PHP code / Win32 </td><td>  PHP code / Debian </td><td>  PHP extension / Win32 </td><td>  PHP extension / Debian </td><td>  Win32 win </td><td>  Debian win </td></tr><tr><td>  1. Line of 100 characters </td><td>  1,000,000 </td><td>  84.7566 sec </td><td>  72.5617 sec </td><td>  8.4750 sec </td><td>  4.4175 sec </td><td>  10 times </td><td>  16.43 times </td></tr><tr><td>  2. 5000 character string </td><td>  10,000 </td><td>  39.1012 sec </td><td>  31.7541 sec </td><td>  0.5001 sec </td><td>  0.134 sec </td><td>  78.19 times </td><td>  236.98 times </td></tr><tr><td>  3. Line of 69000 characters </td><td>  1000 </td><td>  52.3378 sec </td><td>  44.0647 sec </td><td>  0.4875 sec </td><td>  0.0763 sec </td><td>  107.36 times </td><td>  577.51 times </td></tr></tbody></table><br><h2>  findings </h2><br>  Judging the performance of the module compared to the interpreted code, we see that tangible results can be obtained on large amounts of data and on small quantities of iterations.  That is, for frequently used, but not very resource-intensive algorithms, it does not make sense to put them into compiled code.  But for algorithms that work with large amounts of data, this may be practical.  Also, based on my measurements, you can see that the results of the PHP code are comparable on different systems (I remind you that these were two different machines), but the results of the extension work are very different.  From this I personally conclude that there are some features of the compilation that I do not know.  However, I strongly doubt that someone is using a Windows server for PHP projects.  Although I also very much doubt that someone will run right now to rewrite something in C, this article is still more just for fun than a guide to action.  I just wanted to show that writing a PHP extension is very simple, and can sometimes be very useful. <br><br>  <strong>UPD1.</strong>  <strong>Comparison with count_chars</strong> <br>  In the comments asked an interesting question: what if to compare with the performance of the count_chars function? <br>  I increased the number of iterations a hundred times, and drove the same test, but using this function.  You can see that on Debian, the results were almost equal, and under Windows there is an interesting situation: the larger the data, the more my module merges in performance.  Let me remind you that the idea of ‚Äã‚Äãthe test was not to write a bicycle, but to take an algorithm for working with large amounts of data. <br><table border="1"><tbody><tr><td></td><td>  Number of iterations </td><td>  count_chars / win32 </td><td>  count_chars / debian </td><td>  extension / Win32 </td><td>  extension / Debian </td><td>  Win32 win </td><td>  Debian win </td></tr><tr><td>  1. Line of 100 characters </td><td>  10,000,000 </td><td>  67.5245 sec </td><td>  47.8104 sec </td><td>  81.8185 sec </td><td>  43.8091 sec </td><td>  0.83 times </td><td>  1.09 times </td></tr><tr><td>  2. 5000 character string </td><td>  1,000,000 </td><td>  22.4693 sec </td><td>  12.8959 sec </td><td>  47.2514 sec </td><td>  12.9577 sec </td><td>  0.48 times </td><td>  0.99 times </td></tr><tr><td>  3. Line of 69000 characters </td><td>  100,000 </td><td>  15.0681 sec </td><td>  7.661 sec </td><td>  46.9598 sec </td><td>  7.7387 sec </td><td>  0.32 times </td><td>  0.99 times </td></tr></tbody></table><br><br><h2>  Materials </h2><ul><li>  Hacker's Guide to the Zend Engine, <a href="http://www.php.net/manual/en/internals2.structure.php">php.net</a> </li><li>  Compiling shared PECL extensions with phpize, php.net </li><li>  Creating a PHP Extension for Windows using Microsoft Visual C ++ 2008, <a href="http://www.talkphp.com/vbarticles.php%3Fdo%3Darticle%26articleid%3D49">talkphp.com</a> </li><li>  Extension Writing Part I: Introduction to PHP and Zend, <a href="http://devzone.zend.com/article/1021">devzone.zend.com</a> </li><li>  Extension Writing Part II: Parameters, Arrays, and ZVALs, <a href="http://devzone.zend.com/article/1022">devzone.zend.com</a> </li><li>  Wrapping C ++ Classes in a PHP Extension, <a href="http://devzone.zend.com/article/4486-Wrapping-C-Classes-in-a-PHP-Extension">devzone.zend.com</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/125597/">https://habr.com/ru/post/125597/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125590/index.html">Nokia creatively promotes the N8</a></li>
<li><a href="../125591/index.html">The news of IE's low IQ users turned out to be a hoax</a></li>
<li><a href="../125592/index.html">Silverlight cookbook: drag & drop recipe</a></li>
<li><a href="../125594/index.html">50 more Nokia N950 are waiting for developers</a></li>
<li><a href="../125596/index.html">Software RAID-6 under Linux: 16TB array recovery experience</a></li>
<li><a href="../125599/index.html">Node.JS for Windows: node.exe</a></li>
<li><a href="../125603/index.html">The second breath of a budget Android-smartphone</a></li>
<li><a href="../125605/index.html">HotMilk is a library for conveniently organizing Mustache templates.</a></li>
<li><a href="../125607/index.html">Quality assurance management</a></li>
<li><a href="../125608/index.html">Solution of the problem of the second contest CUBRID it!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>