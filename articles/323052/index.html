<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Safe Builder on Scala and Java</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="An article about the implementation of the Builder pattern with a compile-check, implemented using parametric polymorphism. In it we will talk about w...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Safe Builder on Scala and Java</h1><div class="post__text post__text-html js-mediator-article">  An article about the implementation of the Builder pattern with a compile-check, implemented using parametric polymorphism.  In it we will talk about what polymorphism is, how it happens.  How the magic of the ‚Äúoperator‚Äù =: = in scala is arranged, whether it is possible to repeat it in java and how using this knowledge to implement Builder, which does not allow incomplete initialization of the created object. <br><a name="habracut"></a><br>  When an entity with a set of properties arises in the system, there is a problem with its construction.  Verbose constructor or set setters?  The first looks cumbersome, the second is not safe: you can easily miss the call to the initialization method of an important property.  To solve this problem, the Builder pattern is often resorted to. <br><br>  The builder pattern solves two tasks: first, it separates the algorithm for creating (initializing) an object from the details of its (object) implementation, and secondly, it simplifies the process of creation: <br><br><pre><code class="java hljs">UrlBuilder() .withSchema(<span class="hljs-string"><span class="hljs-string">"http"</span></span>) .withHost(<span class="hljs-string"><span class="hljs-string">"localhost"</span></span>) .withFile(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) .build()</code> </pre> <br>  The question remains: how to implement the builder so that it does not allow incomplete initialization of the object? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The simplest solution may seem to be checking all the properties in the build method.  But such an approach will not be able to warn us against problems until they arise in the course of the program. <br><br>  The next thing that comes to mind is <a href="https://plugins.jetbrains.com/idea/plugin/8276-stepbuilder-generator">StepBuilder</a> - the implementation of the builder, in which for each new step a separate class / interface is described.  The disadvantage of this solution is the extreme redundancy of the implementation. <br><br>  Scala advocates practice a slightly different approach.  To check the completeness of the configuration of an object in scala, parametric polymorphism is used: <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotConfigured</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configured</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span></span>()(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> ev: <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>] =:= <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>]) = { println(<span class="hljs-string"><span class="hljs-string">"It's work!"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">NotConfigured</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">NotConfigured</span></span>]() } } <span class="hljs-type"><span class="hljs-type">Builder</span></span>() .configure() <span class="hljs-comment"><span class="hljs-comment">//      ! .build()</span></span></code> </pre> <br>  If, when using such a builder, omit one configure () method and call the build () method, the compiler will generate an error: <br><br><blockquote> <code>scala&gt; Builder()./*configured()*/.build() <br> <font color="red">Error:(_, _) Cannot prove that Builder[NotConfigured] =:= Builder[Configured].</font></code> </blockquote> <br>  Type control in this example is occupied by the ‚Äúoperator‚Äù =: =.  The A =: = B entry says that the parametric (generic) type A should be equal to type B. We will return to this example and analyze the magic with which the scala compiler catches the incomplete initialization state of the object being created.  For now, let us return to the world of a simpler and more understandable java and recall what polymorphism is. <br><br>  In OOP, polymorphism is a property of the system that allows using objects with the same interface without information about the type and internal structure of the object.  But what we used to call polymorphism in OOP, only a special case of polymorphism is polymorphism of subtypes.  Another type of polymorphism is parametric polymorphism: <br><blockquote>  Parametric polymorphism allows you to define a function or data type generically, so values ‚Äã‚Äãare processed identically regardless of their type.  Parametrically, a polymorphic function uses arguments based on behavior, not values, appealing only to the necessary properties of the arguments, which makes it applicable in any context where the type of object satisfies the specified behavior requirements. </blockquote><br>  An example would be the function &lt;N extends Number&gt; printNumber (N n).  This function is performed only for the arguments of the class inherited from Number.  Please note that the compiler is able to check the match of the type of the passed argument with all the expectations of the parameterized function and throw an exception if the function is called with an incorrect argument: <br><br><blockquote> <code>java&gt; printNumber("123") <br> <font color="red">Error:(_, _) java: method printNumber ... cannot be applied to given types; <br> required: N <br> found: java.lang.String <br> ...</font></code> </blockquote> <br>  This may suggest the build function, which is defined only for a fully configured instance of builder.  But the question remains: how to explain this requirement to the compiler? <br><br>  An attempt to describe a function by analogy with printNumber will not lead to success, since the parametric type will have to be specified when calling the function, and no one will interfere with indicating there everything your heart desires: <br><br><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotConfigured</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configured</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">A</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> Builder&lt;NotConfigured&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Builder&lt;&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Builder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Builder&lt;Configured&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Builder&lt;&gt;(); } <span class="hljs-comment"><span class="hljs-comment">//   public &lt;T extends Builder&lt;Configured&gt;&gt; void build() { System.out.println("It's work!"); } public static void main(String[] args) { Builder.init() // .configure() //   , .&lt;Builder&lt;Configured&gt;&gt;build() //    build    } }</span></span></code> </pre> <br>  Let's go on the other hand: when we call the build method, we need proof that the current instance is fully configured: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EqualTypes&lt;Configured, A&gt; approve)</span></span></span><span class="hljs-function"> ... class EqualTypes&lt;L, R&gt; </span></span>{}</code> </pre> <br>  Now, to call the build method, we must pass an instance of the EqualTypes class such that type L is Configured and type R is type A defined in the current instance of Builder class. <br><br>  So far there is little use for such a solution, simply omitting the type when creating an instance of EqualTypes and the compiler will allow us to call the build function: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Builder.init() <span class="hljs-comment"><span class="hljs-comment">// .configure() .build(new EqualTypes()) }</span></span></code> </pre> <br>  But if we declare a parameterized factory method such that one would accept some type T and create an instance of the class EqualTypes &lt;T, T&gt;: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> &lt;T&gt; <span class="hljs-function"><span class="hljs-function">EqualTypes&lt;T, T&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">approve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EqualTypes&lt;T, T&gt;(); }</code> </pre> <br>  and calling the build method to pass the result of the approve function to it, we get the long-awaited result: the compiler will swear if you omit the call to the configure method: <br><br><blockquote> <code>java&gt;Builder.init()./*configured()*/.build(approve()) <br> <font color="red">Error:(_, _) java: incompatible types: inferred type does not conform to equality constraint(s) <br> inferred: NotConfigured <br> equality constraints(s): NotConfigured,Configured</font></code> </blockquote> <br>  The fact is that by the time the build method is called, the parametric type A of the Builder class has the value NotConfigured, and it is with this value that an instance is created as a result of calling the init method.  The compiler cannot choose such a type T for the approve function, so that on the one hand it is equal to Configured, as required by the build method, and on the other hand NotConfigured as a parametric type A. <br><br>  Now pay attention to the configure method ‚Äî it returns an instance of the Builder class, in which the parametric type A is defined as Configured.  Those.  if the method call sequence is correct, the compiler will be able to output type T as Configured and the build method call will succeed! <br><br><blockquote> <code>java&gt;Builder.init().configured().build(approve()) <br> It's work!</code> </blockquote> <br>  It remains to ensure that the only way to create an instance of the EqualTypes class is the approve method, but this is a home task. <br><br>  The type T can be a more complex type, for example <i>Builder &lt;A&gt;</i> .  The signature of the build method can be changed to a bit more cumbersome: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EqualTypes&lt;Builder&lt;Configured&gt;, Builder&lt;A&gt;&gt; approve)</span></span></span></span></code> </pre> <br>  The advantage of this approach is that if you need to add a new mandatory method, it will be enough to start a new generic parameter for it. <br><br><div class="spoiler">  <b class="spoiler_title">UrlBuilder Example</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Defined</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Undefined</span></span></span><span class="hljs-class"> </span></span>{} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasSchema</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasHost</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HasFile</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String schema = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String host = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = -<span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String file = <span class="hljs-string"><span class="hljs-string">"/"</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> UrlBuilder&lt;Undefined, Undefined, Undefined&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder&lt;&gt;(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">UrlBuilder</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String schema, String host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port, String file)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.schema = schema; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.host = host; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.port = port; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.file = file; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder&lt;Defined, HasHost, HasFile&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withSchema</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String schema)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder&lt;&gt;(schema, host, port, file); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder&lt;HasSchema, Defined, HasFile&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withHost</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String host)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder&lt;&gt;(schema, host, port, file); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder&lt;HasSchema, HasHost, HasFile&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withPort</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> port)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder&lt;&gt;(schema, host, port, file); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> UrlBuilder&lt;HasSchema, HasHost, Defined&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withFile</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String file)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlBuilder&lt;&gt;(schema, host, port, file); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> URL </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EqualTypes&lt; UrlBuilder&lt;Defined, Defined, Defined&gt;, UrlBuilder&lt;HasSchema, HasHost, HasFile&gt;&gt; approve)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> URL(schema, host, file); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String[] args)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> MalformedURLException </span></span>{ UrlBuilder .init() .withSchema(<span class="hljs-string"><span class="hljs-string">"http"</span></span>) <span class="hljs-comment"><span class="hljs-comment">//   .withHost("localhost") //    .withFile("/") //     ! .build(EqualTypes.approve()); } }</span></span></code> </pre> <br></div></div><br>  Let's go back to the scala example and look at how the ‚Äúoperator‚Äù =: = works.  Here it is worth noting that the <a href="http://www.scala-lang.org/files/archive/spec/2.11/03-types.html">infix form of writing type parameters is</a> valid in scala, which allows you to write a structure like =: = [A, B] as A =: = B. Yes, yes!  Actually =: = - no operator, this is an abstract class declared in scala.Predef, very similar to our EqualTypes! <br><br><pre> <code class="scala hljs"><span class="hljs-meta"><span class="hljs-meta">@implicitNotFound</span></span>(msg = <span class="hljs-string"><span class="hljs-string">"Cannot prove that ${From} =:= ${To}."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span></span>=:=[<span class="hljs-type"><span class="hljs-type">From</span></span>, <span class="hljs-type"><span class="hljs-type">To</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">extends</span></span> (<span class="hljs-type"><span class="hljs-type">From</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">To</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-type"><span class="hljs-type">Serializable</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>[<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> singleton_=:= = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> =:=[<span class="hljs-type"><span class="hljs-type">Any</span></span>,<span class="hljs-type"><span class="hljs-type">Any</span></span>] { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(x: <span class="hljs-type"><span class="hljs-type">Any</span></span>): <span class="hljs-type"><span class="hljs-type">Any</span></span> = x } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span></span>=:= { <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tpEquals</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]: <span class="hljs-type"><span class="hljs-type">A</span></span> =:= <span class="hljs-type"><span class="hljs-type">A</span></span> = singleton_=:=.asInstanceOf[<span class="hljs-type"><span class="hljs-type">A</span></span> =:= <span class="hljs-type"><span class="hljs-type">A</span></span>] }</code> </pre> <br>  The only difference is that the function call approve (or rather its analogue tpEquals) compiler rocks automatically substitutes. <br><br>  It turns out that the usual type manipulation in scala ( <i>we are talking about the use of constructions <code>=:=, &lt;:&lt;</code></i> ) is quite applicable in java.  But, nevertheless, the implicit mechanism provided for in scala makes such a decision more concise and convenient. <br><br>  Another advantage of the implementation of the described approach in scala is the <code>@implicitNotFound</code> annotation, which allows you to control the content of the exception when compiling.  This annotation applies to a class whose instance cannot be found for implicit substitution by the compiler. <br><br>  The bad news is that you cannot change the error text for the = = = construct, but the good news is that you can now easily create your own analog with the message you need! <br><br><pre> <code class="scala hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScalaExample</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-type"><span class="hljs-type">ScalaExample</span></span>.<span class="hljs-type"><span class="hljs-type">Builder</span></span>.is <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.annotation.implicitNotFound <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NotConfigured</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Configured</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class">(</span><span class="hljs-params"></span><span class="hljs-class"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configure</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">build</span></span></span></span>()(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> ev: <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>] is <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">Configured</span></span>]) = { println(<span class="hljs-string"><span class="hljs-string">"It's work!"</span></span>) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Builder</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@implicitNotFound</span></span>(<span class="hljs-string"><span class="hljs-string">"Builder is not configured!"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">sealed</span></span> <span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">is</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">A</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">B</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">val</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">singleIs</span></span></span><span class="hljs-class"> </span></span>= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> is[<span class="hljs-type"><span class="hljs-type">AnyRef</span></span>, <span class="hljs-type"><span class="hljs-type">AnyRef</span></span>] {} <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyTypes</span></span></span></span>[<span class="hljs-type"><span class="hljs-type">A</span></span>]: <span class="hljs-type"><span class="hljs-type">A</span></span> is <span class="hljs-type"><span class="hljs-type">A</span></span> = singleIs.asInstanceOf[is[<span class="hljs-type"><span class="hljs-type">A</span></span>, <span class="hljs-type"><span class="hljs-type">A</span></span>]] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">apply</span></span></span></span>(): <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">NotConfigured</span></span>] = { <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">Builder</span></span>[<span class="hljs-type"><span class="hljs-type">NotConfigured</span></span>]() } } <span class="hljs-type"><span class="hljs-type">Builder</span></span>() .configure() <span class="hljs-comment"><span class="hljs-comment">//      : .build() // Builder is not configured! }</span></span></code> </pre> <br>  Summing up, I can not fail to pay tribute to the authors of the scala language: without adding special constructions to the language, using only implicit parameters, the developers managed to enrich the language constructs with new and effective solutions that allow them to flexibly operate with types. <br><br>  As for Java, the development of the language does not stand still, the language is changing for the better, incorporating solutions and constructions from other languages.  At the same time, it is not always worth waiting for innovations from the authors of the language, some approaches and solutions can be borrowed now. </div><p>Source: <a href="https://habr.com/ru/post/323052/">https://habr.com/ru/post/323052/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323042/index.html">Zabbix 3.X: monitoring Adaptec controllers on Windows Server (Hyper-V Core)</a></li>
<li><a href="../323044/index.html">How we reconstructed the courthouse in Smolensk: from laser scans of stucco molding under mold to release</a></li>
<li><a href="../323046/index.html">SharePoint 2013/2016 database maintenance</a></li>
<li><a href="../323048/index.html">1,500,000 installations in 3 months - Tap Tap Builder development history</a></li>
<li><a href="../323050/index.html">All the ‚Äújoys‚Äù of CallKit or how we did the caller ID on iOS 10</a></li>
<li><a href="../323056/index.html">News of our online courses: updated course "Web-technologies" and added "Statement of tasks for software development"</a></li>
<li><a href="../323058/index.html">Superjob Data Science Meetup. Live broadcast</a></li>
<li><a href="../323060/index.html">How my friends and I pumped our third-party project to a business with an income of $ 17,000 per month</a></li>
<li><a href="../323066/index.html">Promises on the example of a burger party</a></li>
<li><a href="../323068/index.html">Mobile bankers were distributed on Google Play under the guise of weather applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>