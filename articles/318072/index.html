<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Publishing Desktop Applications in Windows Store using Desktop Application Converter</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, we published a corporate desktop application developed by us, which complements the functionality of Skype for Business. For example,...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Publishing Desktop Applications in Windows Store using Desktop Application Converter</h1><div class="post__text post__text-html js-mediator-article"><p>  Not so long ago, we published a corporate desktop application developed by us, which complements the functionality of Skype for Business.  For example, it can ‚Äúhumanly‚Äù keep the history of correspondence, as all ‚Äúdecent‚Äù instant messengers do, can send messages offline, it allows to organize contacts and many more things that Skype for Business lacked.  And when it became possible to share the application using the Windows Store, we decided to use this opportunity.  In the article we will tell how it happened and what it cost us. </p><a name="habracut"></a><br><p>  About the development process itself and about what the idea of ‚Äã‚Äãworking with SfB in Suppression Mode (SfB suppression) cost us, <a href="https://habrahabr.ru/post/306230/">read here</a> . </p><br><p>  EasyLy was developed as a WPF &amp; Lync SDK desktop application for Windows, and of course, we wanted to share our development with the world.  Publication of "classic" desktop applications (without metro-interface) became available not so long ago, we didn‚Äôt have any experience at all, so we began to learn how to download our application in the Windows Store. </p><br><h3 id="nachalo">  Start </h3><br><p>  The whole point was to use the <a href="https://www.microsoft.com/en-us/store/p/desktopappconverter/9nblggh4skzw">Desktop Application Converter to</a> convert the application to the AppX package for UWP (Universal Windows Platform) so that it could be downloaded to the Windows Store. </p><br><p>  It should be noted that not any desktop application can be placed in the store.  It must meet the requirements described <a href="https://msdn.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-prepare">in this article</a> . </p><br><p>  For the conversion process itself, you need OS ‚ÄúAnniversary update of Windows 10 Pro‚Äù or ‚ÄúCorporate‚Äù (10.0.14393.0 and later) x64.  You will also need to install <a href="https://developer.microsoft.com/en-us/windows/downloads/windows-10-sdk">Microsoft Windows 10 SDK</a> .  And before working with the converter you will need to download one of the basic <a href="https://www.microsoft.com/en-us/download/details.aspx%3Fid%3D54442">Windows 10 images</a> . </p><br><p>  IMPORTANT: The version of the operating system build must exactly match the version of the BaseImage-xxxxx.wim image. </p><br><p>  After reading the article on <a href="https://msdn.microsoft.com/en-us/windows/uwp/porting/desktop-to-uwp-run-desktop-app-converter">how to work with the converter</a> , we developed a script system for Command Prompt and Power Shell, which generated AppxManifest.xml and the final AppX package. </p><br><p>  And finally, everything was ready to download EasyLy.appx in the Windows Store.  Honestly, we did not expect that the process of placing the application would be so extended in time, but in total we took about two months to do it.  We also did not expect that in front of us will wait for strange mistakes that will have to fight together with Microsoft employees.  Emotions of the team were at the redistribution, but still we succeeded.  That these were errors and how we eliminated them, read below. </p><br><h3 id="oshibka-i-ne-odna">  Error, and not one. </h3><br><p>  At the first attempt to publish to the Windows Store, we received four errors. </p><br><ol><li><p>  <strong>Package acceptance validation error:</strong> </p><br></li><li><p>  <strong>Package acceptance validation error:</strong> The PublisherDisplayName element in the applet list of EasyLy.signed.appx is GROVETY, INC. </p><br></li><li><p>  <strong>Package acceptance validation of</strong> the app manifest.  The package EasyLy.signed.appx specifies 1.61.6088.26940. </p><br></li><li>  <strong>The</strong> package of the package of acceptance of the package of validity of the appLife.signed.appx: schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities </li></ol><br><p>  We fixed the error number 3 with the version.  It turned out that it is forbidden to have a version revision (last version version), non-zero (major.minor [.build [.revision]]).  Well, that was easy. </p><br><p>  It was: DesktopAppConverter.exe ... -Version 1.61.6088.26940 <br>  It became: DesktopAppConverter.exe ... -Version 1.61.  6088.0 </p><br><p>  In the future, we also refused the build version: DesktopAppConverter.exe ... -Version 1.61.0.0 </p><br><p>  There were still three errors. </p><br><p>  <strong>1. Package acceptance validation error:</strong> The PublisherDisplayName element in the app is an app of GROVETY, INC. <br>  <strong>2. Package acceptance validation error:</strong> EasyLy.s.appx: schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities <br>  <strong>3. Package acceptance validation error:</strong> Your developer account doesn‚Äôt have permission to submit apps converted to the Desktop App Converter at this time. </p><br><p>  Error number 1 has been fixed with the name of the certificate in AppxManifest.xml: </p><br><pre><code class="java hljs">: &lt;PublisherDisplayName&gt;GROVETY, INC&lt;/PublisherDisplayName&gt; : &lt;PublisherDisplayName&gt;GROVETY INC&lt;/PublisherDisplayName&gt;</code> </pre> <br><p>  To be honest, it was strange that this fix worked, and it is unclear how much the certificate name is compared with, because  in the properties of the AppX package in the ‚ÄúDigital Signatures‚Äù section, the certificate name was just a semicolon, and the developers didn‚Äôt have access to the Windows Store interface (to see what the publisher‚Äôs name looks like and that it is generally there), because the publication was marketing department. </p><br><p><img src="https://habrastorage.org/files/7a8/f5a/885/7a8f5a88597e4ba5990ac93849728171.png" alt="image"></p><br><p>  After that, there were errors that spoke about some problem related to the account through which it was impossible to put AppX. </p><br><p>  <strong>1. Package acceptance validation error:</strong> EasyLy.s.appx: schemas.microsoft.com/appx/manifest/foundation/windows10/restrictedcapabilities <br>  <strong>2. Package acceptance validation error:</strong> Your developer account doesn‚Äôt have permission to access apps converted to the Desktop App Converter at this time. </p><br><p>  What to do with these errors was suggested to us by one of the authors of habrahabr, <a href="https://habrahabr.ru/users/asommer/" class="user_link">asommer</a> .  As it turned out, all new desktop applications require manual validation - and for this you need to write to tech support. </p><br><p>  We left the application <a href="https:/developer.microsoft.com/en-us/windows/projects/campaigns/desktop-bridge">here</a> , and within a few days a Microsoft employee contacted us. </p><br><h3 id="poisk-resheniya-sovmestno-s-maykrosoft">  Finding solutions with Microsoft </h3><br><p>  We organized a conference for Skype for Business, where we were told that EasyLy is a desktop application that extends the functionality of Skype4B, for example, it is able to save the history of conversations.  And according to the results of the meeting they sent the APPX file with the application for verification. </p><br><p>  Also, in parallel, I had to sign another agreement with Microsoft - Centennial Early Adopter Program Addendum. </p><br><p>  Communication was made difficult by the fact that Microsoft employees were in America, and the time difference was 10 hours.  As a result, we had to communicate late in the evening, and wait a day for a response to the letters. </p><br><p>  After some time, we received a letter from Microsoft.  They have questions about how EasyLy integrates with Skype for Business.  They needed to make sure that EasyLy could work normally with the next version of Skype for Business. </p><br><p>  In general, it was necessary to prepare a technical description in English.  At the same time, they agreed that if something remains unclear, we will again hold an online rally. <br>  Fortunately, our description turned out to be enough, and a Microsoft employee assured us that the approval process is underway. </p><br><h3 id="proverka-na-prochnost">  Test of strength </h3><br><p>  We didn‚Äôt expect Microsoft to conduct any more tests on our application.  A Microsoft representative said that our application was approved for the Windows Store, but did not pass the CARE test.  In addition, he pointed out the possibility of using additional API functions available only for convertible applications.  Of these features, we chose autorun with the user‚Äôs login and added the following section to the <code>&lt;Application&gt;</code> element in AppxManifest.xml: </p><br><pre> <code class="java hljs">&lt;Extensions&gt; &lt;desktop:Extension EntryPoint=<span class="hljs-string"><span class="hljs-string">"Windows.FullTrustApplication"</span></span> Executable=<span class="hljs-string"><span class="hljs-string">"EasyLy.exe"</span></span> Category=<span class="hljs-string"><span class="hljs-string">"windows.startupTask"</span></span>&gt; &lt;desktop:StartupTask DisplayName=<span class="hljs-string"><span class="hljs-string">"EasyLy"</span></span> Enabled=<span class="hljs-string"><span class="hljs-string">"true"</span></span> TaskId=<span class="hljs-string"><span class="hljs-string">"GROVETYINC.EasyLyCorp.Startup"</span></span>/&gt; &lt;/desktop:Extension&gt; &lt;/Extensions&gt;</code> </pre> <br><p>  A little more about the CARE test.  Judging by the report of the passage, which they sent us, the following things are checked: </p><br><p>  Test for Drivers and Services (Drivers cannot be installed) <br>  Test for DDE Exec registry verbs (DDE Exec warning) <br>  Validate Appx Manifest (Application Identity Name can't be empty) <br>  Security profile settings (EXE can not be requested admin elevation, EXE can not request UIAccess) <br>  Validate PE integrity (PE Files must be validly signed) </p><br><p>  EasyLy failed on the second paragraph.  The program accessed non-standard registry keys.  This has been fixed. </p><br><p>  Now that all problems have been solved, we anticipated the joy of victory and the long-awaited download of EasyLy in the Windows Store.  But luck was not on our side again and the next mistakes appeared: </p><br><p>  <strong>1. Invalid package identity name:</strong> EasyLy (expected: GROVETYINC.EasyLyCorp). <br>  <strong>2. Invalid package family name:</strong> EasyLy_04mzw0hspzxdg (expected: GROVETYINC.EasyLyCorp_8qq6gc35dw28r) <br>  <strong>3. Invalid package publisher name:</strong> CN = ‚ÄùGROVETY, INC‚Äù, O = ‚ÄùGROVETY, INC‚Äù, L = Wilmington, S = ‚ÄùDelaware‚Äù, C = US (expected: CN = 71A49F4D-5C79-40F1-A333-B79F06F50E03 ) <br>  <strong>4. This package uses a display name that you have not reserved:</strong> EasyLy </p><br><p>  It seems that Microsoft decided to carefully not report all errors at once, but issue them in parts, and show each next part only after correcting all the errors in the previous one.  It may be right, because if we saw all the errors at once, the likelihood that we would decide to continue would definitely be less.  But now, when half the journey was completed, I didn‚Äôt want to step back. </p><br><p>  Microsoft answered the following: </p><br><ol><li>  It is not clear what it is.  Try to fix the remaining errors first. </li><li>  That's right, the package being registered is called ‚ÄúGROVETYINC.EasyLyCorp_8qq6gc35dw28r‚Äù. </li><li>  Remove the comma from the publisher name. </li><li>  The name of the registered application is ‚ÄúEasyLy Corp‚Äù. </li></ol><br><p>  Was: DesktopAppConverter.exe ... -Publisher "CN = GROVETY" <br>  Now: DesktopAppConverter.exe ... -Publisher "CN = GROVETY INC" -PackageDisplayName "EasyLy Corp" -AppDisplayName "EasyLy" -AppExecutable "EasyLy.exe" <br>  After these changes, error number 4 went away. </p><br><p>  Trying to eliminate the error, # 1 added -PackageName ‚ÄúGROVETYINC.EasyLyCorp‚Äù to the converter settings, but received an incomprehensible error during the conversion: </p><br><pre> <code class="java hljs">Error: PowerShell Error Record: Could not find a part of the path. PowerShell Stack Trace: at &lt;ScriptBlock&gt;, C:\Program Files\WindowsApps\Microsoft.DesktopAppConverter_1.0.1.0_x64__8wekyb3d8bbwe\DesktopAppConverter.ps1: line <span class="hljs-number"><span class="hljs-number">719</span></span> at &lt;ScriptBlock&gt;, &lt;No file&gt;: line <span class="hljs-number"><span class="hljs-number">1</span></span> Inner Exception[<span class="hljs-number"><span class="hljs-number">0</span></span>]: System.IO.DirectoryNotFoundException: Could not find a part of the path. at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath) at System.IO.FileInfo.MoveTo(String destFileName) at Microsoft.PowerShell.Commands.FileSystemProvider.MoveFileInfoItem(FileInfo file, String destination, Boolean force, Boolean output) Inner Exception Stack Trace[<span class="hljs-number"><span class="hljs-number">0</span></span>] at System.IO.__Error.WinIOError(Int32 errorCode, String maybeFullPath) at System.IO.FileInfo.MoveTo(String destFileName) at Microsoft.PowerShell.Commands.FileSystemProvider.MoveFileInfoItem(FileInfo file, String destination, Boolean force, Boolean output)</code> </pre> <br><p>  It was also empirically observed that if the PackageName is 19 characters or less in length, then no error occurs, and the name GROVETYINC.EasyLyCorp is 21 characters long. </p><br><p>  Trying to eliminate the error number 3 with the certificate tried different options: </p><br><ol><li>  CN = "GROVETY INC" </li><li>  CN = "GROVETY INC", O = "GROVETY INC", L = Wilmington, S = Delaware, C = US </li><li>  CN = 71A49F4D-5C79-40F1-A333-B79F06F50E03 (as indicated in the error message) </li></ol><br><p>  But our certificate has exactly this form: CN = ‚ÄúGROVETY, INC‚Äù, O = ‚ÄúGROVETY, INC‚Äù, L = Wilmington, S = Delaware, C = US, therefore, it is expected that we received an error when signing: </p><br><p><img src="https://habrastorage.org/files/389/e4d/903/389e4d90354140368cfb70e814cd672c.png" alt="image"></p><br><p>  Regarding the third error, Microsoft was told that in the Windows Store the signing process is automatic and there is no need to try to sign AppX by ourselves.  Thus, the error number 3 is gone. <br>  As for error # 1, we were informed that it is possible that this is a converter bug related to the length of the PackageName parameter and suggested workaround: </p><br><pre> <code class="java hljs">a.  PackageName       , , EasyLyChangeMe. b.  appx . c.   makeappx unpack /p ‚Äú[appx path and file]‚Äù /d ‚Äú[Unpack folder]‚Äù d.   PackageName  GROVETYINC.EasyLyCorp. &lt;Identity Name=<span class="hljs-string"><span class="hljs-string">"xxxx"</span></span> ProcessorArchitecture=<span class="hljs-string"><span class="hljs-string">"x86"</span></span> Publisher=<span class="hljs-string"><span class="hljs-string">"CN=pppp"</span></span> Version=<span class="hljs-string"><span class="hljs-string">"1.0.0.0"</span></span> /&gt;        Name     Name,     Windows Store   APP management -&gt; App Identity e.  appx . makeappx pack /p ‚Äú[<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> appx path and file]‚Äù /d ‚Äú[Unpack folder]‚Äù</code> </pre> <br><p>  Following this workaround we solved our problems.  Finally, the line with the converter parameters now looks like this: </p><br><pre> <code class="java hljs">DesktopAppConverter.exe -ExpandedBaseImage <span class="hljs-string"><span class="hljs-string">"C:\ProgramData\Microsoft\Windows\Images\baseImage-14393"</span></span> -Installer <span class="hljs-string"><span class="hljs-string">"installer\easyly_v1.61_setup.exe"</span></span> -Version <span class="hljs-number"><span class="hljs-number">1.61</span></span>.0.0 -InstallerArguments <span class="hljs-string"><span class="hljs-string">"/verysilent"</span></span> -Destination <span class="hljs-string"><span class="hljs-string">"out"</span></span> -PackageName <span class="hljs-string"><span class="hljs-string">"GROVETYINC.EasyLy"</span></span> -PackageDisplayName <span class="hljs-string"><span class="hljs-string">"EasyLy Corp"</span></span> -AppDisplayName <span class="hljs-string"><span class="hljs-string">"EasyLy"</span></span> -AppExecutable <span class="hljs-string"><span class="hljs-string">"EasyLy.exe"</span></span> -AppId <span class="hljs-string"><span class="hljs-string">"GROVETYINC.EasyLyCorp"</span></span> -Publisher <span class="hljs-string"><span class="hljs-string">"CN=71A49F4D-5C79-40F1-A333-B79F06F50E03"</span></span> -PackagePublisherDisplayName <span class="hljs-string"><span class="hljs-string">"CN=GROVETY INC"</span></span> -Verbose</code> </pre> <br><h3 id="schastlivyy-konec">  A happy ending </h3><br><p>  As a result of all these actions, we received a package that was validated!  And - hooray!  You could send our EasyLy to the store. </p><br><p>  And then everything was simple - fill in the necessary information, upload screenshots and put down the amount we want to receive for the product, and after a few days, it appeared in the store. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/318072/">https://habr.com/ru/post/318072/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318058/index.html">Convert data presentation form using Excel + PowerQuery</a></li>
<li><a href="../318060/index.html">Google has introduced a test suite Wycheproof</a></li>
<li><a href="../318066/index.html">Multi-Tale of Lost Time</a></li>
<li><a href="../318068/index.html">10 things that must be done after registration Ltd.</a></li>
<li><a href="../318070/index.html">The enemy is inside: we invite hackers and speakers on PHDays VII</a></li>
<li><a href="../318074/index.html">The results of GeekWeek 2016 and the return of the terrible BAG: Winter with GeekBrains</a></li>
<li><a href="../318078/index.html">The best free applications for customization and design of Windows 10</a></li>
<li><a href="../318080/index.html">How do I use Facebook groups to expand my own business</a></li>
<li><a href="../318084/index.html">Visualization of integration applications</a></li>
<li><a href="../318086/index.html">Build your open source AWS S3 server</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>