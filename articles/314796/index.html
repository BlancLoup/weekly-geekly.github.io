<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we ran Habr for the humanities</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="‚ÄúIn the next two years, you should not try to portray something special in yourself, but just be smart enough to compose what humanity has already cre...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we ran Habr for the humanities</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <i>‚ÄúIn the next two years, you should not try to portray something special in yourself, but just be smart enough to compose what humanity has already created‚Äù</i> (c) <a href="https://habrahabr.ru/users/bobuk/" class="user_link">bobuk</a> </blockquote><br>  A year ago, on the domestic hackathon, our Rostov guys crossed a visual text editor, Muravyev‚Äôs Typographer and anti-plagiarism service overnight.  It turned out the thing that helped quickly prepare and send the publication to the blog. <br><br>  At one time, the thing lived as a side project, then we were given some resources ‚Äî well, like an internal startup.  The result was a convenient collective media without editing. <br><br><img src="https://habrastorage.org/files/504/332/8ad/5043328ade794c3fa35efb2351edb1ea.jpg"><br>  <i>Old man gutenberg would be pleased</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>It allows</b> people to read interesting stories, like a 40 year old uncle has been raising sunken ships in the Barents Sea, and writing popular non-technical topics for writers to earn a little on texts. <br><br>  Let's see what to consider when developing such a service, and what to choose so that no crutches. <br><a name="habracut"></a><br>  By tradition, we broke the post into the main board - each has tips and direct speech of the project participant with a minimum of external comments. <br><br><blockquote><h4>  <a href="https://habr.com/ru/company/uteam/blog/314796/">Why choose from 10 editors Medium</a> (JS) </h4><br><h4>  <a href="https://habr.com/ru/company/uteam/blog/314796/">Thanks to Muravyov for the typographer</a> (Python) </h4><br><h4>  <a href="https://habr.com/ru/company/uteam/blog/314796/">How does the anti-plagiarism system</a> (Pytnon) work </h4><br><h4>  <a href="https://habr.com/ru/company/uteam/blog/314796/">How does the author understand what effect texts give?</a> </h4><br><h4>  <a href="https://habr.com/ru/company/uteam/blog/314796/">How to support it</a> (about working with sysadmins) </h4><br><h4>  <a href="https://upages.io/takie_lyudi/chelovek_zhivuschiy_na_dne">The story of the guy-diver</a> (on uPages) </h4></blockquote><br>  But let's start from the beginning.  When the side-project began to grow into a high-loaded platform, there appeared an understanding that something needs to be added and rewritten. <br><br><h1>  0. How we chose technology </h1><br>  <i>We expect that by the end of the year, 8 thousand authors will use the platform, and the readership will be close to 300 thousand.</i> <br><br>  <b>Ilya</b> <a href="https://habrahabr.ru/users/devhard/" class="user_link">devhard</a> <b>, CTO uPages:</b> ‚ÄúWhen choosing technologies for the project, we proceeded from such considerations: prospects and resistance to high loads. <br><br>  The choice fell on a bunch of Node.js + MongoDB.  On the client, no angulyars, reactors, reductions.  As a framework, we chose Express.js because of its minimalism and the availability of everything needed out of the box or with small additional installations. <br><br>  We also had <b>ESlint</b> , a utility that greatly helped to bring the code of several developers to a more or less unified style without much controversy in the spirit of "which is better: tabs or spaces."  Very useful in the early stages of development. <br><img src="https://habrastorage.org/files/cb9/88d/aa5/cb988daa564f4a94b02ad0130ce8f0a9.jpg"><br>  <i>ESlint has a <a href="http://eslint.org/demo/">demo</a> on the site.</i>  <i>You can download the project from GitHub.</i> <br><br>  <b>Docker</b> containers - as a working environment for project applications - to protect yourself from paranoia like ‚Äúupdate the library and everything breaks‚Äù and, if necessary, quickly get the necessary versions of libraries or even several completely different builds (roughly speaking, stable and bleeding_edge assemblies). <br><br>  We also had <b>3 Git repositories</b> (one locally in the office, two in different data centers).  And I knew that someday we would start writing a visual editor. ‚Äù <br><br><h2><a name="meditor"></a><br>  1. If you decide to write your own WYSIWYG, we sympathize with you </h2><br><img src="https://habrastorage.org/files/ff6/cd2/ae8/ff6cd2ae83da47e0b4599904834cd035.jpg">  <b>Sergey, our developer:</b> ‚ÄúThe prototype from the hackathon was made for blogs and websites on uCoz.  And naturally, the first thing we thought was to take something from there.  But as you know, the uCoz part is written in Perl - and we chose Node.js.  This means that the editor would have to be connected as a separate service or rewritten. <br><br>  Having reviewed a dozen more options, we dropped them too, because: <br><br><ol><li>  They either were not ‚Äúwhat-see-and-receive‚Äù editors. </li><li>  Or out of the box did not look modern, but as Word 2003. </li><li>  Either customizing them is the same as caching. </li></ol><br>  A list of editors that we do not recommend, you will find in the first comment, but one will open right now: <br><br><img src="https://habrastorage.org/files/aae/3d5/d87/aae3d5d87f9c4116951d25e9cf1f83bf.jpg"><br>  <i>CKEDITOR - not your bro (at least for the reason number 2)</i> <br><br>  The authors on the site will be different people - and professional journalists, and copywriters, and very beginners, and those who have tried to blog in the harsh 2000s.  I wanted to make the editor so that everyone could download the article quickly and without any fuss. <br><br>  Looking for more, we realized that for the spring of 2016, the choice was clear - <a href="https://github.com/yabwe/medium-editor">Medium Editor</a> , an open source editor, inspired by the popular blog platform of the same name.  At first glance, it has some advantages. <br><br>  <b>ME has</b> quite complete and clear documentation, the project is being constantly finished, it is not abandoned.  He also had the necessary functions out of the box (toolbar and tools for working with text - this is what GitHub has) and customization options. <br><br><img src="https://habrastorage.org/files/fea/0ca/b78/fea0cab7838f4dc3a85f250437ad9f2b.jpg"><br>  <i>Editing tools appear only when needed.</i>  <i>Behind the plus side is hidden insert photos and videos.</i> <br><br>  Widgets that were not included in the package - ‚Äúvideo‚Äù, ‚Äúpictures‚Äù and ‚Äúdivider‚Äù - I wrote myself, starting from the design.  And their creation did not take much time. <br><br>  <b>But not without a fly in the ointment.</b>  The first surprise was the fact that ME redefined the standard events inside the editor - <i>keyup, paste</i> , etc., replacing them with their own.  To take control of the situation, I had to climb into the ME code and add an exception. <br><br><img src="https://habrastorage.org/files/795/6c0/ee4/7956c0ee447e4ff58c87d9692ff204e7.jpg"><br>  <i>Finding a vulnerability, we wrote to those who use ME in projects, and explained how to close it.</i> <br><br>  Vulnerability was revealed at the first tests.  We realized that ME does not protect against dangerous links, such as: <br><br><pre><code class="javascript hljs">javascript:alert(<span class="hljs-string"><span class="hljs-string">'xss http://www.ru'</span></span>)</code> </pre> <br>  This can be solved by tracking and breaking javascript: sequences in an elementary fashion, as we did. <br><br>  On the one hand, we do it roughly - in the case of a dangerous link, we just don‚Äôt try to save the article.  But on the other hand, if a person decides to conduct such an experiment, then he is clearly not our user. <br><br><h1><a name="typograf"></a><br>  2. Quotes Christmas tree and a dash instead of a hyphen </h1><br>  <b>Peter, our developer:</b> ‚ÄúIn general, it is worth noting that the processing of text in natural language is not a trivial task, especially with regard to the Russian language.  It was obvious - do not delay the development of attempts to make something of their own, since you can use ready-made tools with the functionality we need. <br><br>  It was decided to implement utilities familiar to us for the hackathon.  We pushed them into a separate microservice in the form of a Docker container - a kind of Python-wrapper with its API, working through WSGI. <br><br><img src="https://habrastorage.org/files/b4f/227/206/b4f227206bb141899ed1527289c55c70.gif"><br><br>  One of the tools was the <a href="http://mdash.ru/">Muravyev‚Äôs Typographer</a> .  In my humble opinion, there is no better tool for correcting typography in the whole Runet: an impressive summary of the rules, implementations in PHP and Python.  And what is very important is the license. <br><br>  Much to the honor of @emuragev, it is distributed as a public domain (public domain), so we took it and screwed it to our project in the Python implementation.  So far, nothing has changed, although there is an opportunity and ideas on how to supplement the rules. ‚Äù <br><br><h1><a name="content"></a><br>  3. How not to become SEO content farm </h1><br>  <i>In order not to be flogged by grafomans and lovers of reposting from cozy blochikov, we introduced pre-moderation.</i>  <i>The text of publications is checked for uniqueness: both the author and we can perform such a check.</i> <br><br><img src="https://habrastorage.org/files/80e/314/874/80e3148741964e1cb38bee3ccc3c77e4.jpg"><br><br>  <b>Peter, our developer:</b> ‚ÄúThe concept of the platform is in amusing stories and reviews without strict regulation of themes and formats.  But we also give money on each text.  And it is clear that it must be unique. <br><br>  In general, to implement online functionality to verify the uniqueness of the text, you need the <a href="https://xml.yandex.ru/">Yandex.XML</a> technology and, ideally, the base of text patterns, in order to first chase the text on it, and only then knock on Y.XML. <br><br>  But the number of requests from one domain to the Y.XML service is limited and directly depends on the site's TCI.  And what is the TIC of a web project that has not yet been released?  No.  And during development, it was constantly required to send requests, parse the answer and do something with the data. <br><br><img src="https://habrastorage.org/files/30a/2b7/0e0/30a2b70e02bd435b84692d29b410b849.gif"><br><br>  It would be possible, of course, to send a request from some domain subject to us, where the site with a large TCI lies.  But in the end we decided not to do this and take the ready-made Content-Watch (CW) API.  The system is paid, but for us the guys went on special conditions. <br><br>  Although the reviews on the network differ, it seems they understood the question perfectly and wrote down the service with good documentation, a minimal API and some algorithms in addition to Y.XML. <br><br>  For us, as for the users of their service, everything works very simply - we send a request for the CW service with the text that needs to be checked, and then the answer is returned to us in the form of json.  The answer contains information about the degree of uniqueness of the text (we show a beautiful pie chart) and links to pages on the network where this or that piece of text is found - the topic with links is currently used only by moderators who check articles before publishing on the main one. ‚Äù <br><br><h1><a name="stat"></a><br>  4. How to let authors analyze articles </h1><br>  <i>To make it more interesting for authors, we decided to introduce text analysis and payment tools for everyone.</i>  <i>Income is formed as follows: next to the text there are two banners - advertising and recommendation.</i>  <i>The banner has a cost per click (it is determined by the advertising system) - we give 80% of the cost of each click to the author.</i> <br><br>  <b>Ilya, CTO uPages:</b> ‚ÄúThe interesting task was to show the author how much and when he earned, and at the same time show the fact that not everyone read the article, and we must learn to work on the involvement within the text, not just on the teaser and the title. <br><br>  Therefore, we made a statistics module. <br><br><img src="https://habrastorage.org/files/4b4/5f0/4f2/4b45f04f2b9f440bb643a44fea9b100a.png"><br><br>  It consists of the client side - we draw charts via <a href="http://www.chartjs.org/">Chart.js</a> , giving numbers and lists. <br><br>  <b>On the server side,</b> we consider something ourselves - the number of likes, readings, bookmarks, for example. <br><br>  And part of the data - about clicks on banners, from which the author earns - we take through the Google Analytics API and from the Engageya recommendation service.  The latter have no convenient API, but we managed to agree that once a day they upload us reports with all the necessary information.  So we show the clicks on advertising on the side of the article and the income of the author. <br><br><img src="https://habrastorage.org/files/59e/ebc/536/59eebc5365354583a62d8390a975161f.jpg"><br><br>  In the case of the Google API, requests go at regular intervals to meet the limits. <br>  Yes, the <b>Google API is a pain</b> .  With so many different products, you have to reread a huge amount of documentation and try several approaches.  At first, we tried to use the AdSense Management API to get Adsense revenue data, but in their reports you cannot get information for a detailed account of income sources. <br><br>  After a long googling and beating my head on the keyboard, salvation came from analytics. <br>  A link is established between Google Adsense and Analytics accounts, after which AdSense data becomes available when you query the analytics API. ‚Äù <br><br><h1><a name="sysjokes"></a><br>  5. How to support it </h1><br><img src="https://habrastorage.org/files/0bd/b6c/d24/0bdb6cd24f524132ac7e90a7a96fb5d6.jpg"><br>  <b>Ruslan</b> <a href="https://habrahabr.ru/users/pys/" class="user_link">pys</a> <b>, system administrator:</b> ‚ÄúThe task subtly hinted that it should be a cloud server.  Well, I didn‚Äôt really like to do all this monitoring of the motherboard temperature, fan speeds, monitor the disks - and change them, not forgetting to rewrite serials. <br><br>  We took the following requirements for cloud virtual machines: <br><br><ul><li>  Data Center in Moscow (because we have a Russian-speaking audience), </li><li>  convenient configuration change, </li><li>  two servers <b>from different providers</b> - for fault tolerance and the possibility of carrying out technical work without downtime. </li></ul><br><img src="https://habrastorage.org/files/700/fa3/468/700fa34686a4458c8f229358613d923a.jpg"><br><br>  Another important task was the software deployment model.  Obviously, life on the development server and in battle are two big differences.  It is good that the guys immediately chose a general containerization - for which, taking this opportunity, thanks are expressed from all the system administration. <br><br>  We chose <b>Saltstack</b> as a container deployment and configuration management <b>system</b> , since we have already successfully applied it to other projects. <br><br>  As a result of bringing the service into combat readiness, a natural desire arose to conduct exercises, i.e.  firing from <a href="https://tech.yandex.ru/tank/">Yandex</a> . <a href="https://tech.yandex.ru/tank/">Tank</a> .  In the course of experiments with a different ratio of requests to the processor cores and system and application software settings, we determined the capacity of a single node and the correlation of this capacity with the configuration of virtual hardware and OS settings.  Well, it started on November 1st. ‚Äù <br><br>  <b>PS</b> Send your http-requests to our <a href="https://upages.io/">new service</a> ! </div><p>Source: <a href="https://habr.com/ru/post/314796/">https://habr.com/ru/post/314796/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314784/index.html">Oracle database audit</a></li>
<li><a href="../314786/index.html">Topographer was drunk</a></li>
<li><a href="../314790/index.html">Personal experience: how to find a sales manager for a web studio</a></li>
<li><a href="../314792/index.html">The best IT vacancies on My Circle in a week, October 17-23</a></li>
<li><a href="../314794/index.html">Itseez, double Intel Company</a></li>
<li><a href="../314798/index.html">Automated testing survey results: 411 responses in 2016</a></li>
<li><a href="../314800/index.html">Russian hacker taught IT university students how to hack network</a></li>
<li><a href="../314802/index.html">About layout, logic, eccentrics and MTS portals</a></li>
<li><a href="../314804/index.html">50 shades of Go: traps, pitfalls and common mistakes beginners</a></li>
<li><a href="../314806/index.html">The history of the startup and our pivot</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>