<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing an extension for Adobe Air on PureBasic</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the wake of the growing popularity of PureBasic here, I propose to get acquainted with another area of ‚Äã‚Äãapplication of this language. 

 Starting ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing an extension for Adobe Air on PureBasic</h1><div class="post__text post__text-html js-mediator-article">  In the wake of the growing popularity of <a href="http://habrahabr.ru/post/64457/">PureBasic</a> here, I propose to get acquainted with another area of ‚Äã‚Äãapplication of this language. <br><br>  Starting with the third version of Air, it became <a href="http://www.adobe.com/devnet/air/articles/extending-air.html">possible to</a> compensate for the limited SDK due to extensions (Flash Runtime Extensions).  Extensions can be written in C / C ++ / Java (Android) and in any other language that allows you to create native libraries for appropriate platforms. <br><a name="habracut"></a><br>  Computing speed, multithreading, interaction with the operating system are all available for extensions.  Some time ago I wrote an extension for C for Mac and Windows - a wrapper for the cross-platform library <a href="http://www.signal11.us/oss/hidapi/">HIDAPI</a> .  Despite some difficulties, the convenience was in the cross-platform library, which allowed writing the extension code once and assembling for each platform with minimal effort. <br><br>  PureBasic, in turn, provides the ability to create applications (dll, so, <a href="http://habrahabr.ru/post/145926/">drivers</a> ) for several systems.  There is the possibility of optimization, support for unicode, ready-made objects (List, Map), a set of cross-platform functions (compression algorithms, image processing, encryption), under Windows, most WINAPI, macros and even OOP are imported.  All this significantly speeds up development (for those who do not have experience of C / C ++), compared to bare C. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Example - system modal dialog </h5><br>  Sources and a demo application for Windows are available at <a href="http://code.google.com/p/purebasic-extension-for-adobe-air/">code.google.com</a> . <br><br>  The first step was to <a href="">import</a> functions from the FlashRuntimeExtensions.lib library (Windows, {AIR SDK} \ lib \ win \), this is done relatively simply, if you have FlashRuntimeExtensions.h ({AIR SDK} \ include \): <br><br><pre><code class="hljs cs">ImportC <span class="hljs-string"><span class="hljs-string">"../lib/FlashRuntimeExtensions.lib"</span></span> ;returns FRE_OK ; FRE_WRONG_THREAD ; FRE_INVALID_ARGUMENT If nativeData <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>. ;<span class="hljs-function"><span class="hljs-function">FREResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FREGetContextNativeData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> FREContext ctx, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">** nativeData </span></span></span><span class="hljs-function">)</span></span>; ;-FREGetContextNativeData FREGetContextNativeData.l (ctx.l, nativeData.l) ... EndImport</code> </pre> <br>  In the compiler settings, you must specify the Shared Dll format, enable Unicode support if necessary (+ in the File / Format menu, select the encoding of the source files UTF8), thread safety, or assembly language support. <br><br>  The only inconvenience is the lack of unsigned long type in PureBasic, for this I had to write additional functions. <br><br>  In the extension descriptor, we indicate the platform, the extension library, and 2 unique exported functions (initializer and finalizer): <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://ns.adobe.com/air/extension/3.1"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span>com.pure.Extension<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">id</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>pureair<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">copyright</span></span></span><span class="hljs-tag">&gt;</span></span>compile4fun 2012<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">copyright</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span>Extenion for Adobe AIR<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">description</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">versionNumber</span></span></span><span class="hljs-tag">&gt;</span></span>1.0.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">versionNumber</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platforms</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Windows-x86"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">applicationDeployment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nativeLibrary</span></span></span><span class="hljs-tag">&gt;</span></span>pureair.dll<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">nativeLibrary</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">initializer</span></span></span><span class="hljs-tag">&gt;</span></span>initializer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">initializer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">finalizer</span></span></span><span class="hljs-tag">&gt;</span></span>finalizer<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">finalizer</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">applicationDeployment</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platform</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">platforms</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">extension</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Id must match the specified in the application manifest and the expansion pack (ActionScript), the application profile - extendedDesktop. <br><br>  The mandatory part of the extension is AttachProcess (Instance), DetachProcess (Instance), AttachThread (Instance) and DetachThread (Instance) functions, and also: <br><br><pre> <code class="hljs kotlin">... ;CDecl ProcedureC contextInitializer(extData.l, ctxType.s, ctx.l, *numFunctions.<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>, *functions.<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>) *log\info(<span class="hljs-string"><span class="hljs-string">"create context: "</span></span> + Str(ctx) + <span class="hljs-string"><span class="hljs-string">"="</span></span> + Utf8ToUnicode(ctxType)) Define result.l ;exported extension functions count: Define size.l = <span class="hljs-number"><span class="hljs-number">1</span></span> ;Array of FRENamedFunction: Dim f.FRENamedFunction(size - <span class="hljs-number"><span class="hljs-number">1</span></span>) ;there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> no unsigned long type <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> PB setULong(*numFunctions, size) ;If you want to <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> a string <span class="hljs-keyword"><span class="hljs-keyword">out</span></span> of a DLL, the string has to be declared <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> Global before using it. ;method name f(<span class="hljs-number"><span class="hljs-number">0</span></span>)\name = asGlobal(<span class="hljs-string"><span class="hljs-string">"showDialog"</span></span>) ;function <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> example f(<span class="hljs-number"><span class="hljs-number">0</span></span>)\functionData = asGlobal(<span class="hljs-string"><span class="hljs-string">"showDialog"</span></span>) ;function pointer f(<span class="hljs-number"><span class="hljs-number">0</span></span>)\function = <span class="hljs-meta"><span class="hljs-meta">@showDialog()</span></span> *functions\l = <span class="hljs-meta"><span class="hljs-meta">@f()</span></span> ;some additional <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> can be stored extData = #Null ;<span class="hljs-keyword"><span class="hljs-keyword">native</span></span> <span class="hljs-keyword"><span class="hljs-keyword">data</span></span> example result = FRESetContextNativeData(ctx, asGlobal(<span class="hljs-string"><span class="hljs-string">"FRESetContextNativeData"</span></span>)) *log\Debug(ResultDescription(result, <span class="hljs-string"><span class="hljs-string">"FRESetContextNativeData"</span></span>)) *log\info(<span class="hljs-string"><span class="hljs-string">"create context complete"</span></span>); EndProcedure ;CDecl ProcedureC contextFinalizer(ctx.l) *log\info(<span class="hljs-string"><span class="hljs-string">"dispose context: "</span></span> + Str(ctx)) EndProcedure ;CDecl ProcedureCDLL initializer(extData.l, *ctxInitializer.<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>, *ctxFinalizer.<span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>) *ctxInitializer\l = <span class="hljs-meta"><span class="hljs-meta">@contextInitializer()</span></span> *ctxFinalizer\l = <span class="hljs-meta"><span class="hljs-meta">@contextFinalizer()</span></span> EndProcedure ;CDecl ;<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> method <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> never called on Windows... ProcedureCDLL finalizer(extData.l) ;<span class="hljs-keyword"><span class="hljs-keyword">do</span></span> nothing EndProcedure</code> </pre><br>  The FRENamedFunction array contains the methods of our extension (in this case, only one - showDialog), it is also possible to bind any data to a function or an extension instance.  Attention should be paid to the type of call CDecl and the function asGlobal, which specifically allocates memory for the strings passed from the extension to the main program, this is mentioned in the PureBasic dll help. <br><br>  Our extension will show a modal dialog with an arbitrary set of buttons and text and transmit the event of closing the dialog: <br><pre> <code class="hljs pgsql">Structure MessageParameters <span class="hljs-type"><span class="hljs-type">text</span></span>.s title.s dwFlags.l ctx.l EndStructure <span class="hljs-keyword"><span class="hljs-keyword">Procedure</span></span> ModalMessage(*params.MessageParameters) Define result.l, code.l code = MessageRequester(*params\title, *params\<span class="hljs-type"><span class="hljs-type">text</span></span>, *params\dwFlags) result = FREDispatchStatusEventAsync(*params\ctx, asGlobal("showDialog"), asGlobal(Str(code))) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span> (ResultDescription(result, "FREDispatchStatusEventAsync")) EndProcedure ;CDecl ProcedureC.l showDialog(ctx.l, funcData.l, argc.l, *argv.FREObjectArray) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Invoked showDialog") Define result.l ;ActionScriptData example Define actionScriptObject.l, actionScriptInt.l, <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>.l result = FREGetContextActionScriptData(ctx, @actionScriptObject) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>(ResultDescription(result, "FREGetContextActionScriptData")) result = FREGetObjectType(actionScriptObject, @<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>("result=" + ResultDescription(result, "FREGetObjectType")) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("ContextActionScriptData: type=" + TypeDescription(<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>)) result = FREGetObjectAsInt32(actionScriptObject, @actionScriptInt) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>("result=" + ResultDescription(result, "FREGetObjectAsInt32")) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("ContextActionScriptData: actionScriptInt=" + Str(actionScriptInt)) ;<span class="hljs-keyword"><span class="hljs-keyword">function</span></span> data example Define funcDataS.s funcDataS = PeekS(funcData, <span class="hljs-number"><span class="hljs-number">-1</span></span>, #PB_Ascii) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("FunctionData: " + funcDataS) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Method args size: " + Str(fromULong(argc))) Define resultObject.l, length.l, booleanArg.l, dwFlags.l, message.s, *string.Ascii result = FREGetObjectAsBool(*argv\<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>], @booleanArg) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>("result=" + ResultDescription(result, "FREGetObjectAsBool")) result = FREGetObjectAsInt32(*argv\<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-number"><span class="hljs-number">1</span></span>], @dwFlags) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>("result=" + ResultDescription(result, "FREGetObjectAsInt32")) result = FREGetObjectAsUTF8(*argv\<span class="hljs-keyword"><span class="hljs-keyword">object</span></span>[<span class="hljs-number"><span class="hljs-number">2</span></span>], @length, @*string) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>("result=" + ResultDescription(result, "FREGetObjectAsUTF8")) message = PeekS(*string, fromULong(length) + <span class="hljs-number"><span class="hljs-number">1</span></span>) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Argument: booleanArg=" + Str(fromULong(booleanArg))) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Argument: dwFlags=" + Str(dwFlags)) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("Argument: message=" + Utf8ToUnicode(message)) ;native data example Define native.l, nativeData.s result = FREGetContextNativeData(ctx, @native) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>(ResultDescription(result, "FREGetContextNativeData")) nativeData = PeekS(native, <span class="hljs-number"><span class="hljs-number">-1</span></span>, #PB_Ascii) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">info</span></span>("FREGetContextNativeData: " + nativeData) Define *params.MessageParameters = AllocateMemory(SizeOf(MessageParameters)) *params\ctx = ctx *params\title = "PureBasic" *params\<span class="hljs-type"><span class="hljs-type">text</span></span> = Utf8ToUnicode(message) *params\dwFlags = dwFlags CreateThread(@ModalMessage(), *params) ;<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-type"><span class="hljs-type">Boolean</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">TRUE</span></span> result = FRENewObjectFromBool(toULong(<span class="hljs-number"><span class="hljs-number">1</span></span>), @resultObject) *<span class="hljs-keyword"><span class="hljs-keyword">log</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span>(ResultDescription(result, "FRENewObjectFromBool")) ProcedureReturn resultObject EndProcedure</code> </pre><br>  From the Air side, it looks like this: <br><pre> <code class="actionscript hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">package</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pure</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.events.StatusEvent;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> flash.external.ExtensionContext;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> mx.logging.ILogger;</span></span> <span class="hljs-meta"><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">import</span></span></span><span class="hljs-meta"> mx.logging.Log;</span></span> <span class="hljs-comment"><span class="hljs-comment">/** * Wrapper for PureBasic extension */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Extension</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Extension id, must be specified in air-manifest.xml and extension.xml */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> CONTEXT:String = <span class="hljs-string"><span class="hljs-string">"com.pure.Extension"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> log:ILogger = Log.getLogger(CONTEXT); <span class="hljs-comment"><span class="hljs-comment">/** * @private */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> _context:ExtensionContext; <span class="hljs-comment"><span class="hljs-comment">/** * @private */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> contextType:String; <span class="hljs-comment"><span class="hljs-comment">/** * Creates context * @param contextType default value is "PureAir" * @param actionScriptData any number */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Extension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(contextType:String = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"PureAir"</span></span></span></span><span class="hljs-function"><span class="hljs-params">, actionScriptData:int = 4)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//random type this.contextType = contextType + Math.round(Math.random() * 100000); try { log.debug("Creating context: {0}, contextType: {1}", CONTEXT, this.contextType); _context = ExtensionContext.createExtensionContext(CONTEXT, this.contextType); if (_context == null) { //creation failed log.error("Failed to create context: {0}, contextType: {1}", CONTEXT, this.contextType); } else { log.debug("Context was created successfully"); //listen for extension events _context.addEventListener(StatusEvent.STATUS, onStatusEvent); //set actionScript data _context.actionScriptData = actionScriptData; } } catch(e:Error) { log.error("Failed to create context: {0}, contextType: {1}, stacktrace: {2}", CONTEXT, this.contextType, e.getStackTrace()); } } private function get contextCreated():Boolean { return _context != null; } /** * Test method, shows YesNoCancel modal dialog * @param booleanArg boolean parameter * @param flags integer parameter, #PB_MessageRequester_YesNoCancel=3, #MB_APPLMODAL = 0 * @param message string parameter * @return */ public function showDialog(booleanArg:Boolean, flags:int, message:String):Boolean { if (!contextCreated) return false; var result:Boolean = false; try { result = _context.call('showDialog', booleanArg, flags, message) as Boolean; if (!result) { log.error("Invocation error: test({0}, {1}, {2})", booleanArg, flags, message); } } catch (e:Error) { log.error("Invocation error: test({0}, {1}, {2}), stacktrace: {3}", booleanArg, flags, message, e.getStackTrace()); } return result; } private function onStatusEvent(event:StatusEvent):void { log.info("Status event received: contextType={0} level={2}, code={1}", this.contextType, event.code, event.level); } /** * Performs clean-up */ public function dispose():void { if (_context) { _context.dispose(); //clean all references _context.removeEventListener(StatusEvent.STATUS, onStatusEvent); _context = null; log.info("Disposed {0}", this.contextType); } else { log.warn("Can not dispose {0}: Context is null", this.contextType); } } } }</span></span></code> </pre><br>  StatusEvent is the only event type that an extension can transmit. <br><br>  The result of the work can be seen in the screenshot: <br><img src="https://habrastorage.org/getpro/habr/post_images/208/d31/eff/208d31eff151a29a0537b2aeb2750e76.png" alt="image"><br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/147089/">https://habr.com/ru/post/147089/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../147081/index.html">NVIDIA Nsight Tegra - VS plugin for native Android application development</a></li>
<li><a href="../147082/index.html">About rectangular coordinates and hexagonal grids</a></li>
<li><a href="../147084/index.html">Dell 1135n MFP Overview</a></li>
<li><a href="../147085/index.html">I am a brand or how to raise my value?</a></li>
<li><a href="../147086/index.html">About network software performance</a></li>
<li><a href="../147090/index.html">Customizing ProgressBar to Android</a></li>
<li><a href="../147091/index.html">Microsoft expands access to Windows Azure in Russia</a></li>
<li><a href="../147092/index.html">Rating java frameworks compiled by the developers themselves</a></li>
<li><a href="../147093/index.html">User rating by several parameters</a></li>
<li><a href="../147095/index.html">A simple bash solution for sharing music and photos on Dropbox</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>