<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Robotic arm control with Intel RealSense cameras</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Roymotion 's Roy robotic arm was created as a result of a successfully funded project on the Kickstarter portal , launched in 2012. The description re...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Robotic arm control with Intel RealSense cameras</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/bd5/461/14e/bd546114eb6b40deb90005f7e2f27d31.jpg"><br>  <a href="http://roytherobot.com/">Roymotion</a> 's Roy robotic arm was created as a result of a successfully <a href="https://www.kickstarter.com/projects/1647660643/meet-roy-an-experiment-in-animatronics-part-one">funded project on the Kickstarter portal</a> , launched in 2012.  The description read: "The project is to create a moving character the size of a person using only mechanical parts produced by laser cutting and servo drives available for sale at hobby and modeling stores."  In this experiment, Roy's hand management software was developed using the <a href="https://software.intel.com/en-us/intel-realsense-sdk">Intel¬Æ RealSense ‚Ñ¢ SDK for Windows *</a> .  The management uses <a href="https://software.intel.com/sites/landingpage/realsense/camera-sdk/v1.1/documentation/html/index.html%3Fdoc_hand_hand_tracking.html">hand-tracking APIs</a> that are available as part of the SDK. <br><a name="habracut"></a><br>  The code for this project was developed in C # / XAML using Microsoft Visual Studio * Community 2015. The software can use the Intel RealSense <a href="https://software.intel.com/en-us/RealSense/F200Camera">F200</a> and SR300 cameras (coming soon).  To see the robotic arm controlled by the software, in action, watch the following video on YouTube *. <br><br><iframe width="560" height="315" src="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://www.youtube.com/embed/VQ93jw4Aocg%3Ffeature%3Doembed&amp;xid=17259,15700023,15700186,15700191,15700248,15700253&amp;usg=ALkJrhggH9PWb62KVb4eHJJNT9I2KR7SDQ" frameborder="0" allowfullscreen=""></iframe><br><br><h2>  <font color="#0071c5">About hand roy</font> </h2><br>  The Roy Arm Assembly Kit is currently available on the <a href="http://roytherobot.com/product-category/arm-kits/">Roemotion, Inc. website.</a>  in the form of an assembly kit.  The kit includes: <br><ul><li>  parts made by laser cutting; </li><li>  all necessary fasteners; </li><li>  8 servos (the same as those used in managed models); </li><li>  6 extension cables for servo drives. </li></ul><br>  As stated on the Roemotion website, this kit does not include electronics for control.  This is due to the fact that initially the meaning of the project was to provide people with interesting mechanical systems for use with any controllers.  In the experiment itself, a third-party servo controller is used to control the motors in the robotic arm (Fig. 1). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/53f/dde/1f2/53fdde1f2e8a418e8731f4917a2c7a6e.jpg"><br>  <i>Figure 1. Roy's robotic arm</i> <br><br>  There are 6 servomotors installed in the hand: one for the index finger, middle finger, ring finger and little finger and two for the thumb.  (Note. Two more servomotors are installed at the base of the arm to control the movement of the wrist, but in this experiment we do not control them.) <br><br><h2>  <font color="#0071c5">Hand Tracking APIs in the Intel¬Æ RealSense ‚Ñ¢ SDK</font> </h2><br>  As stated in <a href="https://software.intel.com/sites/landingpage/realsense/camera-sdk/v1.1/documentation/html/index.html%3Fmanuals_hand_tracking.html">the Intel RealSense SDK documentation</a> , the hand tracking module provides three-dimensional hand tracking in real time and can track one or two hands, providing data on the exact location of all joints.  In the framework of this experiment in real-time device management, of particular interest to us are the values ‚Äã‚Äãof the bend of fingers, obtained using calls to the <a href="https://software.intel.com/sites/landingpage/realsense/camera-sdk/v1.1/documentation/html/index.html%3Fqueryfingerdata_ihand_pxchanddata.html">QueryFingerData ()</a> method. <br><br><h2>  <font color="#0071c5">Control electronics</font> </h2><br>  In this experiment, we used the <a href="https://www.pololu.com/product/1350">Pololu Micro Maestro * 6-channel USB servo controller</a> (fig. 2) to control six motors installed in the Roy hand.  This device includes a rather complicated SDK for developing control applications designed for different platforms using different programming languages. <br><br><img src="https://habrastorage.org/files/8aa/7d8/fef/8aa7d8fefa7744119273c4428cb7c58b.jpg"><br>  <i>Figure 2. Servo Pololu Micro Maestro * Servo Controller</i> <br><br><h2>  <font color="#0071c5">Servo controller setting</font> </h2><br>  Before developing our own software for direct control of the robotic arm in this experiment, it was first necessary to understand the range of motion of each finger from the point of view of servo control parameters.  In advanced robotic servomechanisms with integrated controllers, you can interrogate the position code before applying the driving moment.  Unlike such systems, in Roy‚Äôs hand, it is necessary to supply electric power to the motors with great care in order to avoid too abrupt and fast movements, due to which fingers can bend down and damage gears. <br><br>  Fortunately, the Pololu Micro Maestro SDK includes the Control Center application, with which the user can adjust the settings at the firmware level and save them to flash memory on the controller board.  The empirically determined parameters for this application are shown in Fig.  3 <br><br><img src="https://habrastorage.org/files/741/98b/648/74198b648ed04d189b6788a83317867d.jpg"><br>  <i>Figure 3. Pololu Maestro Control Center application</i> <br><br>  After setting the parameters for the Min and Max positions, the servo controller firmware will not allow the servomotors to go beyond the allowed range of movement.  This is very important for use in this case, because in a robotic arm the mobility of all joints is limited by mechanical stops.  If the joint moves as far as it will go while the servomotor does not stop, this can lead to overheating and burnout of the electric motor and damage to the gear. <br><br>  Another important parameter in this case is called On startup or error.  Thanks to him, all the fingers by default (and in case of errors) occupy a straightened position, which prevents the thumb and index fingers from hooking if they were bent. <br><br>  Two more parameters to pay attention to are the Speed ‚Äã‚Äãand Acceleration parameters that control speed and acceleration.  Using these parameters, you can make the movement smoother at the level of the microprogram.  This approach is preferable to high-level filtering algorithms, because of which the delays increase and the load on the main software application increases. <br><br>  Note.  In more advanced robotic servomechanisms with built-in controllers, a <a href="https://en.wikipedia.org/wiki/PID_controller">proportional-integral-differential algorithm</a> (PID-algorithm) is often used.  It allows you to write parameters to the firmware in flash memory to fine-tune the feedback at the lowest level possible (that is, as close as possible to the equipment) in order to ensure a smooth change of the operating modes of the motors without loading the high-level software. <br><br><h2>  <font color="#0071c5">Own program for management</font> </h2><br>  In this experiment, we developed our own program (Fig. 4) that uses many of the hand tracking functions available in the SDK code samples. <br><br><img src="https://habrastorage.org/files/f03/123/384/f03123384a204ff9b5e70485d03f95ee.jpg"><br>  <i>Figure 4. Own program for management</i> <br><br>  The user interface has real-time fingertip tracking data, but in this particular experiment we used the following three parameters to control Roy's hand: <br><ul><li>  Data alerts. </li><li>  Flexion data. </li><li>  Scale data. </li></ul><br><h2>  <font color="#0071c5">Alert data</font> </h2><br>  Alerts are the most important information for tracking in the application controlling the device (such as in this case the robotic arm) in real time.  It is very important to understand (and control!) How the device will behave when the set values ‚Äã‚Äãare inaccessible or unreliable. <br>  In this experiment, the application tracks the following alert data: <br><ul><li>  Hand detected. </li><li>  The hand is calibrated. </li><li>  The hand is inside the borders. </li></ul><br>  The software program used prevents the control of the servomechanisms of the robotic arm in the event of any of these alerts.  In order for the program to control the robotic arm, the user's hand must be properly calibrated and within the range of the camera. <br>  As shown in the code snippet below, the application cycles through the number of triggered alerts and sets three logical variables: <i>detectionStatusOk</i> , <i>calibrationStatusOk,</i> and <i>borderStatusOk</i> (note that <i>handOutput</i> is an instance of <i>PXCMHandData</i> ). <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; handOutput.QueryFiredAlertsNumber(); i++) { PXCMHandData.AlertData alertData; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (handOutput.QueryFiredAlertData(i, out alertData) != pxcmStatus.PXCM_STATUS_NO_ERROR) { <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (alertData.label) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_DETECTED: detectionAlert = <span class="hljs-string"><span class="hljs-string">"Hand Detected"</span></span>; detectionStatusOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_NOT_DETECTED: detectionAlert = <span class="hljs-string"><span class="hljs-string">"Hand Not Detected"</span></span>; detectionStatusOk = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_CALIBRATED: calibrationAlert = <span class="hljs-string"><span class="hljs-string">"Hand Calibrated"</span></span>; calibrationStatusOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_NOT_CALIBRATED: calibrationAlert = <span class="hljs-string"><span class="hljs-string">"Hand Not Calibrated"</span></span>; calibrationStatusOk = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_INSIDE_BORDERS: bordersAlert = <span class="hljs-string"><span class="hljs-string">"Hand Inside Borders"</span></span>; borderStatusOk = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> PXCMHandData.AlertType.ALERT_HAND_OUT_OF_BORDERS: bordersAlert = <span class="hljs-string"><span class="hljs-string">"Hand Out Of Borders"</span></span>; borderStatusOk = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br>  Before any attempt by the program to control the servos of the hand, a check is carried out: all three variables, that is, the <i>detectionStatusOk</i> , <i>calibrationStatusOk</i> and <i>borderStatusOk</i> , must be set to True.  If at any time one of these three flags is set to False, all fingers are moved to the default Open position for security. <br><br><h2>  <font color="#0071c5">Flexion data</font> </h2><br>  The program developed in the course of this experiment calls the <a href="https://software.intel.com/sites/landingpage/realsense/camera-sdk/v1.1/documentation/html/index.html%3Fqueryfingerdata_ihand_pxchanddata.html">QueryFingerData ()</a> method, which returns the value of the finger fold and the radius of the finger tip.  The bend value can be from 0 (the finger is fully bent) to 100 (the finger is straightened). <br>  The application receives data about the flexing of each finger in the frame acquisition and release cycle, as shown in the following code snippet (where <i>handData</i> is an instance of <i>PXCMHandData.IHand</i> ). <br><br><pre> <code class="cpp hljs">PXCMHandData.FingerData fingerData; handData.QueryFingerData(PXCMHandData.FingerType.FINGER_THUMB, out fingerData); thumbFoldeness = fingerData.foldedness; lblThumbFold.Content = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Thumb Fold: {0}"</span></span>, thumbFoldeness); handData.QueryFingerData(PXCMHandData.FingerType.FINGER_INDEX, out fingerData); indexFoldeness = fingerData.foldedness; lblIndexFold.Content = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Index Fold: {0}"</span></span>, indexFoldeness); handData.QueryFingerData(PXCMHandData.FingerType.FINGER_MIDDLE, out fingerData); middleFoldeness = fingerData.foldedness; lblMiddleFold.Content = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Middle Fold: {0}"</span></span>, middleFoldeness); handData.QueryFingerData(PXCMHandData.FingerType.FINGER_RING, out fingerData); ringFoldeness = fingerData.foldedness; lblRingFold.Content = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Ring Fold: {0}"</span></span>, ringFoldeness); handData.QueryFingerData(PXCMHandData.FingerType.FINGER_PINKY, out fingerData); pinkyFoldeness = fingerData.foldedness; lblPinkyFold.Content = <span class="hljs-built_in"><span class="hljs-built_in">string</span></span>.Format(<span class="hljs-string"><span class="hljs-string">"Pinky Fold: {0}"</span></span>, pinkyFoldeness);</code> </pre><br><h2>  <font color="#0071c5">Scale data</font> </h2><br>  After receiving data on the bending of each of the user's fingers, the scale equations are processed in order to compare the obtained values ‚Äã‚Äãwith the full-scale ranges of motion of each robotic finger.  All full-scale values ‚Äã‚Äã(i.e., the control pulse duration in milliseconds, which is required to move a finger to either fully extended or fully bent) are defined as constants in the class servo.cs. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Index finger public const int INDEX_OPEN = 1808; public const int INDEX_CLOSED = 800; public const int INDEX_DEFAULT = 1750; . . .</span></span></code> </pre><br>  Individual constants are determined for each finger of a robotic hand, they are compared with the parameters of the Min and Max positions of the servo drive, which were recorded in the flash memory of the Micro Maestro controller board (Fig. 3).  Similarly, the program defines a full scale value for a range of finger bend data. <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fingerMin = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> fingerMax = <span class="hljs-number"><span class="hljs-number">100</span></span>;</code> </pre><br>  Since the bend range of the fingers is the same for all fingers (that is, from 0 to 100), it is enough to set the range only once, after which it can be used for data scaling operations for all fingers, as shown below. <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// Index finger int indexScaled = Convert.ToInt32((Servo.INDEX_OPEN - Servo.INDEX_CLOSED) * (index - fingerMin) / (fingerMax - fingerMin) + Servo.INDEX_CLOSED); lblIndexScaled.Content = string.Format("Index Scaled: {0}", indexScaled); Hand.MoveFinger(Servo.HandJoint.Index, Convert.ToUInt16(indexScaled)); . . .</span></span></code> </pre><br><h2>  <font color="#0071c5">Conclusion</font> </h2><br>  To implement this program experiment, it took only a few hours after we tested the servos and understood the principle of controlling them.  The classic Windows 10 application was developed in C # / XAML.  It uses many of the features available in the APIs and in the Intel RealSense SDK code samples. <br><br>  For more information about the Intel RealSense SDK for Windows, see <a href="https://software.intel.com/en-us/intel-realsense-sdk">the Intel website</a> . </div><p>Source: <a href="https://habr.com/ru/post/277535/">https://habr.com/ru/post/277535/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../277521/index.html">Setting Safebrowsing from Yandex to Firefox</a></li>
<li><a href="../277525/index.html">Bidirectional rendering with diacritics support</a></li>
<li><a href="../277527/index.html">The benefits of big data technology in everyday life</a></li>
<li><a href="../277529/index.html">Fake Novella: a small game, the development of which taught me a lot and another ban from Google</a></li>
<li><a href="../277533/index.html">Creating a user interface for Blend4Web (Part 1)</a></li>
<li><a href="../277537/index.html">Vision-based SLAM: monocular SLAM</a></li>
<li><a href="../277539/index.html">Yelp, Wunderlist and GIPHY introduced new type applications</a></li>
<li><a href="../277541/index.html">Another approximation by polynomial of a function of several variables</a></li>
<li><a href="../277543/index.html">Clean code architecture and development through testing in PHP</a></li>
<li><a href="../277545/index.html">Game design f2p games or how not to make mistakes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>