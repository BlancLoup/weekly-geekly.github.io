<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Oracle, typical SQL tasks. Transformation of the values ‚Äã‚Äãlisted in the column to table rows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Welcome to Hollywood. I present to you today's heroines 



 First we find out who was the husband of these beauties. And then with the help of uncomp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Oracle, typical SQL tasks. Transformation of the values ‚Äã‚Äãlisted in the column to table rows</h1><div class="post__text post__text-html js-mediator-article">  Welcome to Hollywood.  I present to you today's heroines <br><br><img src="https://habrastorage.org/files/76b/feb/0da/76bfeb0da99342a99d5efdb6c7d0536e.jpg" alt="image"><br><br>  First we find out who was the husband of these beauties.  And then with the help of uncomplicated special effects, I will show you in what order they married each other.  So this article will be especially interesting for young virgins. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Create and populate the base table. <br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> hollywood <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> t (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, actress, husbands) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">'  ,   ,  '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> all <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual ) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> t; <span class="hljs-keyword"><span class="hljs-keyword">alter</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> hollywood <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> primary <span class="hljs-keyword"><span class="hljs-keyword">key</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>);</code> </pre> <a name="habracut"></a><br><table border="1"><tbody><tr><th>  ID </th><th>  Actress </th><th>  Husbands </th></tr><tr><td>  one </td><td>  Angelina Jolie </td><td>  Johnny Lee Miller, Billy Bob Thornton, Brad Pitt </td></tr><tr><td>  2 </td><td>  Charlize Theron </td><td></td></tr><tr><td>  3 </td><td>  Penelope Cruz </td><td>  Javier Bardem </td></tr></tbody></table><br><br>  The table shows that Angelica was married three times.  Her husbands are listed in the column through the separator in the order of their marriage to the actress.  We agree that the separator is a comma, and the space after it is just garbage. <br><br>  Liza Theron has never been married at all (civil marriages do not count), and she, apparently, is still waiting for her IT specialist.  So you should take note of it and how to hurry - the lady is already, almost, 40. <br><br>  Well, Penelope Cruz - married only once.  What a boredom. <br><br>  But this is all a prelude, but in fact you need to get the following result <br><table border="1"><tbody><tr><th>  Actress </th><th>  Husband </th><th>  Husband's number p / p </th></tr><tr><td>  Angelina Jolie </td><td>  Johnny lee miller </td><td>  one </td></tr><tr><td>  Angelina Jolie </td><td>  Billy Bob Thornton </td><td>  2 </td></tr><tr><td>  Angelina Jolie </td><td>  Brad Pitt </td><td>  3 </td></tr><tr><td>  Charlize Theron </td><td></td><td></td></tr><tr><td>  Penelope Cruz </td><td>  Javier Bardem </td><td>  one </td></tr></tbody></table><br>  In fact, you need to perform the operation, the inverse grouping and aggregation function listagg. <br><br>  We will move from simple to complex.  To begin with, I propose to consider a similar task - extracting numbers from a single string with a separator into a tabular set. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">with</span></span> digit_str <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-string"><span class="hljs-string">'10,20,30,40,50,100'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">str</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual ) <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> regexp_substr(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">'(\d+)(,|$)'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">rownum</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) ok <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> digit_str <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= regexp_count(<span class="hljs-keyword"><span class="hljs-keyword">str</span></span>, <span class="hljs-string"><span class="hljs-string">'\d+(,|$)'</span></span>)</code> </pre><br>  We get: <br><table border="1"><tbody><tr><th>  Ok </th></tr><tr><td>  ten </td></tr><tr><td>  20 </td></tr><tr><td>  thirty </td></tr><tr><td>  40 </td></tr><tr><td>  50 </td></tr><tr><td>  100 </td></tr></tbody></table><br>  To understand a query, you need to know how regular expression functions work ( <a href="http://docs.oracle.com/database/121/ADFNS/adfns_regexp.htm">help</a> ).  The very idea of ‚Äã‚Äãthe query is as follows: <br><ul><li>  New lines are generated using connect by level. </li><li>  Regexp_count calculates the number of numbers in a line between delimiters - this number determines the upper limit for the row generator. </li><li>  Regexp_substr extracts numbers from a string.  The number of the pattern entry in the string (4th regular argument) corresponds to the value of the rownum pseudo column ‚Äî the n / n number of the generated string.  Instead of rownum, you could use level, the result would be the same. </li></ul><br>  There are other ways to solve the problem, for example, like this: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> to_number(<span class="hljs-keyword"><span class="hljs-keyword">column_value</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">xmltable</span></span>(<span class="hljs-string"><span class="hljs-string">'10,20,30,40,50,100'</span></span>)</code> </pre>  and instead of regulars, we could use combinations of standard string functions, but we‚Äôll dwell on the query with regular expressions. <br><br>  In the HOLLYWOOD table, we are not dealing with a sequence of numbers, but with the names of noble men.  But they can also be calculated using the regexp_count function and retrieved using the regexp_substr function, according to the method described above.  Now you need to remember the recipes for <a href="http://habrahabr.ru/post/269173/">pickling bananas</a> and choose one of the ways to generate strings when their future number is known.  For examples, I will use the 3rd and 5th method.  But when choosing the most optimal generation method, you need to pay attention to the user <a href="http://habrahabr.ru/post/269173/">comment</a> <a href="https://habrahabr.ru/users/xtender/" class="user_link">xtender</a> . <br><br>  By combining approaches, we get the following. <br><br>  <b>Special effect number 1.</b> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> actress, <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span>(regexp_substr(husbands, <span class="hljs-string"><span class="hljs-string">'(.+?)(,|$)'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husband, nvl2(husbands, <span class="hljs-keyword"><span class="hljs-keyword">level</span></span>, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husb_no <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> hollywood <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">prior</span></span> dbms_random.value <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= regexp_count(husbands, <span class="hljs-string"><span class="hljs-string">'.+?(,|$)'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">order</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span></code> </pre><br>  Everything is OK - girls are happy in marriages.  All but Lisa Theron.  For people like Lisa, I used nvl2 in the query. <br><br>  <b>Special effect number 2.</b> <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> h.actress, <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span>(regexp_substr(h.husbands, <span class="hljs-string"><span class="hljs-string">'(.+?)(,|$)'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, x.column_value, <span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husband, nvl2(h.husbands, x.column_value, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husb_no <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> hollywood h, <span class="hljs-keyword"><span class="hljs-keyword">table</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">cast</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">multiset</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= regexp_count(h.husbands, <span class="hljs-string"><span class="hljs-string">'.+?(,|$)'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> sys.odcinumberlist)) x</code> </pre>  It was a decision through the collection. <br><br>  <b>UPD:</b> One more <b>special Special Effect No. 3</b> for Oracle 12c was drawn <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> h.actress, <span class="hljs-keyword"><span class="hljs-keyword">trim</span></span>(regexp_substr(h.husbands, <span class="hljs-string"><span class="hljs-string">'(.+?)(,|$)'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, xn, <span class="hljs-string"><span class="hljs-string">'c'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husband, nvl2(h.husbands, xn, <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> husb_no <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> hollywood h, lateral(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> n <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">connect</span></span> <span class="hljs-keyword"><span class="hljs-keyword">by</span></span> <span class="hljs-keyword"><span class="hljs-keyword">level</span></span> &lt;= regexp_count(h.husbands, <span class="hljs-string"><span class="hljs-string">'.+?(,|$)'</span></span>)) x</code> </pre><br><br>  Obviously, there are quite a few options for solving the problem.  The choice of one or another option is a matter of taste and a question of productivity.  If I had an Oscar, I would give it without hesitation to the one who offers the most concise in terms of code and the most optimal way in terms of performance. <br><br>  In the meantime, everything.  Until new meetings. </div><p>Source: <a href="https://habr.com/ru/post/269215/">https://habr.com/ru/post/269215/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269205/index.html">RAD Studio 10 World Tour in St. Petersburg</a></li>
<li><a href="../269207/index.html">Angular2 close</a></li>
<li><a href="../269209/index.html">Do I need a dart?</a></li>
<li><a href="../269211/index.html">MikroTik - MTCNA</a></li>
<li><a href="../269213/index.html">Let's Encrypt Announces IdenTrust Cross Certification</a></li>
<li><a href="../269217/index.html">Web application architecture. Stack Spring MVC + AngularJs</a></li>
<li><a href="../269219/index.html">Plesk 12.5 Hosting Control Panel Overview</a></li>
<li><a href="../269221/index.html">I am writing a CMS for PHP. Part 1</a></li>
<li><a href="../269223/index.html">PYCON RUSSIA-2015: videos and presentations</a></li>
<li><a href="../269225/index.html">Know your customer, or Oracle Industry Solutions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>