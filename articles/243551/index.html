<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PDP Recovery 11/04</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translation of an article on the restoration of an old interesting machine. Many heavy pictures. Italic my comments. 

 This PDP 11/04 originally belo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PDP Recovery 11/04</h1><div class="post__text post__text-html js-mediator-article">  <i>Translation of an article on the restoration of an old interesting machine.</i>  <i>Many heavy pictures.</i>  <i>Italic my comments.</i> <br><br>  This PDP 11/04 originally belonged to Ericsson.  We got it at the end of the eighties from EDKX, the Ericsson computer club.  The computer was transferred in parts, but everything was in place except for a pair of screws.  Together with the PDP-11 itself, there was a tape station TU60. <br><img src="https://habrastorage.org/files/54e/f6c/512/54ef6c512b074fb5afc549dfa497d18a.png"><br>  <i>Operator console panel</i> <br><a name="habracut"></a><br>  The PDP-11/04 appeared in the mid-seventies as a cheaper successor to the PDP-11/05.  In this new version, DEC was able to fit all the processor logic on one six-contact board ( <i>PDP used several types of boards with different form factors - six-contact, four-contact, two-contact. The photo shows 6 groups of pins slightly below. In addition, the boards were divided according to , what tire they are designed for.</i> ) instead of two in the predecessor.  The modules were connected to a common cross-board ( <i>backplate</i> ) with nine slots made by wrap.  Typically, the PDP 11 was a programming console (a <i>separate panel. The PDP was assembled from several blocks, something like a rack with a set of equipment</i> ) through which the operator could enter simple boot programs and carry out system maintenance.  However, this particular instance had only the usual limited operator console. <br><img src="https://habrastorage.org/files/3e9/91a/6cf/3e991a6cf0e24ef19e1c008b371e3605.png"><br>  <i>Cross board</i> <br><br>  In the <a href="http://research.microsoft.com/en-us/um/people/gbell/Computer_Engineering/">Computer Engineering: A DEC view of hardware design,</a> the PDP-11 family of machines is described in great detail.  The book is scanned and is publicly available.  Very exciting reading! <br><img src="https://habrastorage.org/files/85b/272/137/85b272137bdf458c9280cf75fe4bc20b.png"><br>  <i>CPU board</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The processor module consists of 138 chips.  A slight simplification of the operating machine ( <i>datapath, a part of the processor that performs operations on any data. For example, these are ALU, multiplexers, register files, decoders. In general, this is practically the most important part of the processor.</i> ) And the use of programmable memory has reduced the number of chips used .  There are five 256x8 bipolar programmable microchips of ROM on the board, allocated for microcode storage, which is packaged in 40-bit structures.  The first eight bits are reserved for the address of the following micro-instruction.  An interesting feature is that the line through which these addresses are transmitted is implemented according to the open collector scheme, which allows conditional microcode branching to be made simply using wired OR-connections directly on the bus.  As the main ALU, DEC took the well-known 74181, and Intel 3101 16x4 RAM chips were used as <i>scratchpad memory</i> for the main registers.  There is no separate crystal for clocking, but instead there is a delay line in the feedback circuit. <br><img src="https://habrastorage.org/files/d24/d43/478/d24d434786dc4566a4fc0f40777cdea0.png"><br>  <i>Memory board</i> <br><br>  We got the PDP-11/04 with a 16 kilobyte memory module.  It contains 32 MK4096, MOS-dynamic memory chips, produced by MOSTEK.  An interesting remark - this was the first memory with multiples addressing by column / row, a similar scheme is used in modern DDR.  Thanks to this innovation, MOSTEK's engineers were able to fit 4 kilobits of memory into a 16-pin package. <br><img src="https://habrastorage.org/files/a90/f79/ab5/a90f79ab5899410c937349c5aadf0b8d.png"><br><br>  This is the M7800 card, the asynchronous communication module DL11.  ( <i>The PDP-11 used its own classification of modules. For example, the scheme indicates MS11-JP, which means a memory module, but the specific boards could be different - M7867-XJ, M7847-DJ or which card complies with the module standard. In this case DL11 is a classifier, and the M7800 is a specific board.</i> ) <br><img src="https://habrastorage.org/files/3b9/4fc/fda/3b94fcfda64745c9ae173e893e8d6c71.png"><br><br>  The latter board, M9312, is used to boot the system, and, moreover, acts as a bus terminator.  In general, there should be two terminators in the system, since the processor module itself does not perform this function.  Therefore, another terminator should be installed on the opposite edge of the bus, in this case as close as possible to the processor module.  On the M9312, there are four bipolar programmable ROM slots that allow support for booting from different devices.  In addition, the board has an EPROM, which contains the console emulator code for communication with the operator via the serial port. <br><br>  The computer is disassembled by screws in this <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/dec/pdp11/1104/MP00019_1104_EngrDrws_Feb78.pdf">document</a> . <br><br><h3>  Check the power supply H777 </h3><br><br>  The first thing to start with is to check that the power supply is OK.  In particular, it is important to ensure that the capacitors are in good condition.  H777 is a pulse power supply with a key element in the secondary circuit, which means that it contains a huge transformer ( <i>compared to the key circuit in the primary circuit, it is really large</i> ), which reduces the amplitude of the input AC voltage to much more pleasant in operation 38 Vac.  It's not very nice to mess around with power supplies, in which almost all parts of the circuit have voltage in the region of 400 VDC.  H777 consists of two regulators: 5 volt, generating 25 amperes, and MOS-regulator, giving + 15V, -15V, + 5V ( <i>in other versions of H777 there is also a third regulator on + 20V, -5V</i> ). <br><br>  Some kind soul scanned the necessary <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/dec/unibus/EK-BA11L-TM-001_Oct77.pdf">manual</a> , which describes in detail the entire internal kitchen of this BP. <br><br>  Large 50V x 22000mF capacitors, filtering unregulated direct current, were able to fully charge through 10kŒ© resistance, and the leakage current was extremely low.  The 5V output capacitor was in much worse shape.  The Sprague 6V x 3900mF capacitor, on impressive legs, never reached its rated voltage, even with long use with a 560 ohm resistor. <br><img src="https://habrastorage.org/files/a0d/da3/5fa/a0dda35fa7844da1a87a6af52026011a.png"><br>  <i>On the left is a time-torn element, on the right is its replacement</i> <br><br>  At present, such 6V x 3900mF capacitors with bolts cannot be found, so I replaced it with 40V x 6800mF from RIFA. <br><br>  With a new capacitor, the power supply unit was able to issue 3 amps to my test board, from which the pleasant aroma of heated getinax reached quickly ( <i>mock-ups are often made from this material</i> ). <br><img src="https://habrastorage.org/files/7b3/5d7/7c5/7b35d77c57ac4f70b24f91f7810b819d.jpg"><br>  <i>BP checkout process.</i>  <i>By the way, a healthy primary circuit transformer is visible.</i> <br><br>  But will it all work if you connect the BP to the cross-board?  Unfortunately, it did not work.  It turned out that the two signal contacts of the power supply unit are in a permanently low state: BUS DC LO L and BUS AC LO L. These signals are active low and suppress the main clock generator in an active state. <br><img src="https://habrastorage.org/files/6af/3b8/294/6af3b82946fc40159c59f0ebdcb0d402.png"><br><br>  The circuit above describes the 5 volt regulator.  The highlighted blue area is a current source circuit that receives an unregulated direct current at the input, charging a 50mF capacitor, which then produces a beautiful sawtooth signal.  A resistor array and a set of comparators ( <i>operational amplifiers, which act here as voltage comparators</i> ) generate a BUS DC LO L, BUS AC LO L and an internal signal on which the clocking of the main PWM key is based.  The capacitor voltage did not exceed 20.4 volts, which is not enough to change the polarity of the two comparators.  It looked as if too much current was being absorbed from this source.  Replacing a capacitor did not change anything.  But, besides the current source, a red region of the circuit is connected to the capacitor - overload protection circuit.  If any of the transistor switches fail, then an unregulated direct current of 38 volts will be output.  Which, by itself, is not very good.  Therefore, it uses a Zener diode and a pair of thyristors, which are triggered at an output voltage of more than 5.4 VDC, which leads to a short circuit in the current source, and, in turn, extremely effectively stops any activity in the power supply.  The problem, apparently, was that even under normal conditions, the protective circuit absorbed 1.5 mA due to the leakage of the thyristor, moreover, in the closed state.  Of course, any thyristor flows, but not as much as this. <br><img src="https://habrastorage.org/files/bf8/476/0d1/bf84760d1ff0418b82c7cdca64605c26.png"><br>  <i>broken thyristor maybe C32AX135</i> <br><br>  After replacing the thyristor with a modern BT145, the power supply unit was working as it should. <br><br><h3>  Processor check </h3><br><br>  We connect all the cables and turn on the power.  Smoke is not visible, which is a good sign.  But the ‚ÄúRUN‚Äù light often flickers, and, after switching the corresponding toggle switch on the console to the ‚ÄúINIT‚Äù value, it only blinked once at all.  The situation is not encouraging. <br><br>  The oscilloscope connected to the main clock signal of the processor module shows that at the beginning there are 8 clock cycles, then a pause for a couple of microseconds, 3 bars, another pause and again 3 bars, but nothing follows them. <br><img src="https://habrastorage.org/files/9b8/bff/db6/9b8bffdb6d424af39a654503838b71f1.png"><br><br>  In this photo you can see that the period of the sync signal is closer to 250 ns than to 260 ns, about which it is written in Computer Engineering.  However, the use of the delay line in the feedback circuit will not be able to give such accuracy.  However, 4 MHz is a very impressive result for the mid-seventies. <br><br>  Most likely, the oscilloscope could not help in further clarifying the causes of the malfunction.  For this kind of task, I am keeping this little USB analyzer. <br><img src="https://habrastorage.org/files/247/a86/256/247a86256a3c48f2a0151ba24ea7ba71.png"><br><br>  But in order to cover the entire computer with its address and data buses, I need four of these.  Fortunately, at that moment I was offered to buy an HP1664A logic analyzer at an affordable price. <br><br><h3>  Search for errors using a logic analyzer </h3><br>  After some problems at the beginning, when I mixed up some signals and forgot about the fact that the board uses active-low levels, I received several interesting trace logs: <br><img src="https://habrastorage.org/files/4c3/bbe/1ed/4c3bbe1ed047432dac8f238a7d5b39c7.png"><br><br>  Here the bus value is displayed, on which the addresses of micro instructions are transmitted for execution.  In fact, here is the address of the next micro-instruction, during the execution of the current one.  However, judging by the <a href="http://vaxhaven.com/images/1/11/EK-KD11D-TM-PRE.pdf">manual</a> , this is a completely correct sequence of micro-operations ( <i>if really interesting, then chapter 6.3.3 Restarts from power failure</i> ). <br><img src="https://habrastorage.org/files/3d3/aab/0c8/3d3aab0c85744ac0adf4548386259ced.png"><br><br>  It is interesting in the top of the log that, when the address is set to 0 on the bus, we get 0165020, which is the value of the command counter containing the address from which we must start execution after a power failure.  This address belongs to M9312 and indicates the diagnostic program.  But the next address of the instruction on the bus is 0167020. For some reason, the 10th bit turned out to be one!  Exploring the DS8641 bus receiver chip in more detail, I noticed that even with an input current of 3.31V, we get 3.78V output!  Looks weird. <br><br><h3>  It's alive! </h3><br>  Here, this little evil thing: <br><img src="https://habrastorage.org/files/3d2/0ac/1b5/3d20ac1b58ea4ea4ba6aef4f277adf33.png"><br><br>  Unfortunately, the DS8641 is not a very common chip.  In addition, it was specially adapted to open collector tires for DEC.  I ordered a few on Ebay from a seller from China, but since the package was sent for quite a long time, I decided to drop the same chip from another board, and replace it with a failed chip in the processor module. <br><br>  This time the result was better: <br><img src="https://habrastorage.org/files/e90/faf/4d6/e90faf4d6ef4472ea50092b1d25e6474.png"><br><br>  However, it all ends in a looped wait for the TX console serial port readiness bit.  Strange.  Maybe it's a M7800 error? <br><br><h3>  Another M7800 board </h3><br>  Another M7800 module was connected to the cross-board.  Serial port connected to a laptop. <br><img src="https://habrastorage.org/files/1f3/9ed/36d/1f39ed36d3c84449891e8e68f8cb7f15.png"><br><br>  Fine.  Now the system goes through all diagnostic steps from first to fourth.  But entering ‚ÄúDL‚Äù in the console in order to try to boot from a non-existent RL device ( <i>RL01 / RL02 is something like hard disks, but with removable data cartridges.</i> ), <i>Causes the</i> machine to stop. <br><img src="https://habrastorage.org/files/127/d8e/188/127d8e18873347e6885398df903eaaf4.png"><br><br>  It seems that when you try to test the RAM, it fails, and then, immediately, we get a double error during the processing of the first.  This behavior is typical for exception handling ( <i>more precisely traps, trap</i> ) by the processor. <br><br><h3>  Grumpy dip switch! </h3><br>  While examining the memory module and checking jumpers and switch positions, I found that when I clicked back and forth with the DIP switch, the position of the 6th key out of 8 is ignored, and the circuit remains closed.  Problem. <br><img src="https://habrastorage.org/files/73a/f2b/10d/73af2b10d6a94bd6ad65650f39ef9276.png"><br>  On the left - the new switch, on the right - the old one. <br><br>  Finally, the computer has started! <br><img src="https://habrastorage.org/files/ac8/356/efa/ac8356efac7a42b5ad167818adfd0108.png"><br>  <i>To understand that it works, it is possible by the fact that the author enters console commands in the terminal: @L - load the address, @E - check the data at the address, @D - write the data on the loaded address</i> . <br><br><h3>  PDP11GUI </h3><br><br>  <a href="http://retrocmp.com/tools/pdp11gui">PDP11GUI</a> is a great Windows utility for managing your PDP-11.  It can load files into PDP-11 memory, view the memory snapshot and start the processor. <br><img src="https://habrastorage.org/files/42b/473/1b7/42b4731b7ec54c2d92dd57c607a2b967.png"><br><br>  Punched <a href="">tapes</a> with <a href="">BASIC</a> can be found on the Internet.  But, unfortunately, they are in Absolute Binary Loader format, which <a href="http://retrocmp.com/tools/pdp11gui">PDP11GUI</a> does not understand.  However, you can write a simple C program to convert.  The resulting file can already be fed minicomputers, but this is all very slow on the 9600bps line. <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre><code class="cpp hljs"><span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">include</span></span></span><span class="hljs-meta"> </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt;stdio.h&gt; #include &lt;stdlib.h&gt; int main (int argc, char ** argv) { FILE * input, * output; int ch, state = 0, count, size, sum = 0, address, data=0, start=0; if (argc==3) { input = fopen (argv[1], "rb"); if (input == NULL) { fprintf(stderr, "cannot open file %s for reading\n", argv[1]); exit(1); } output = fopen (argv[2], "w+"); if (output == NULL) { fprintf(stderr, "cannot open file %s for reading\n", argv[2]); exit(1); } } else { fprintf(stderr, "Usage conver &lt;input&gt; &lt;output&gt;"); exit(1); } while(!feof(input)) { ch = fgetc (input); //fprintf (stderr, "state=%d ch=%02x sum=%02x count=%d start=%d\n", state, ch, sum, count, start); switch (state) { case 0: if (ch != 1) state = 0; else { state = 1; count = 1; sum += ch; sum &amp;= 0xff; } break; case 1: if (ch != 0) state = 0; else { state = 2; count ++; sum += ch; sum &amp;= 0xff; } break; case 2: // read low count byte size = ch; state = 3; sum += ch; sum &amp;= 0xff; count ++; break; case 3: // read count size = size | (ch &lt;&lt; 8); state = 4; sum += ch; sum &amp;= 0xff; if (size==6) { start = 1; } count ++; break; case 4: // read address low address = ch; sum += ch; sum &amp;= 0xff; state = 5; count ++; break; case 5: address = address | (ch &lt;&lt; 8); state = 6; sum += ch; sum &amp;= 0xff; count ++; if (count == size) { state =0; } if (start==1) { fprintf (stderr, "Start at %06o\n", address); fclose (input); fclose (output); exit(0); } break; case 6: data = ch; sum += ch; sum &amp;= 0xff; count ++; if (count == size) { state = 7; } else { state = 8; } break; case 8: sum += ch; sum &amp;= 0xff; data = data | (ch &lt;&lt;8); fprintf (output, "%06o %06o\n",address, data); address +=2; count++; if (count == size) { state = 7; } else { state = 6; } break; case 7: // checksum sum += ch; sum &amp;= 0xff; if (sum!=0) { fprintf (stderr, "Checksum error chsum = %02X\n", sum); exit(1); } sum = 0; state = 0; } } }</span></span></span></span></code> </pre> <br></div></div><br>  <b>UPDATE:</b> In version 1.38, the <a href="http://retrocmp.com/tools/pdp11gui">PDP11GUI</a> no longer needs an external program, since the conversion code was included in the <a href="http://retrocmp.com/tools/pdp11gui">PDP11GUI</a> .  ( <i>Yes, in the original 5 identical links to <a href="http://retrocmp.com/tools/pdp11gui">PDP11GUI</a></i> ). <br><br>  Having started the PDP with the starting address 016104, we will receive the BASIC'a invitation ( <i>it is obvious that the launch went through that tool in which there is a corresponding ‚Äúinitial PC‚Äù setting</i> ). <br><img src="https://habrastorage.org/files/0d3/b52/3a3/0d3b523a39f74c5dac2a4cd5fc44381e.png"><br><br>  It is noticeable that I have not written anything for a long time on BASIC'e. <br><br><h3>  Running diagnostics </h3><br><br>  For the real test that the processor works as it should, there are two diagnostic programs - GKAA and GKAB.  There are two ways to run them: load a punched tape image into the PDP11GUI or use the XXDP.  I tried both methods. <br><br>  It is known that these programs were stored on punched tape, but, alas, I could not find the images of these punched tapes.  But I found an image for the XXDP that contained GKAAA0.BIC and GKABC0.BIC.  It turns out that binaries have the same format as punched tapes.  I used <a href="http://www.dbit.com/putr/">PUTR</a> to extract them from the image.  Do not forget that the files need to be copied as binary, and not, like me, you will be puzzling for several hours ( <i>PUTR provides a kind of DOS-like interface, and you need to do ‚Äúcopy / b‚Äù instead of just ‚Äúcopy‚Äù</i> ). <br><br>  After extraction, I simply downloaded the images into the PDP11GUI and ran it from the address 0200. <br><br><h3>  XXDP download </h3><br><br>  The XXDP should run from some storage device.  I only have one option that would be quite simple to use on my PDP-11 at that moment, the TU58 ( <i>tape system</i> ), since it uses the serial port to connect and therefore can be emulated on a PC.  I downloaded <a href="http://www.ak6dn.dyndns.org/PDP-11/TU58/tu58em/index.html">tu58em</a> and compiled it on my Mac.  It was necessary to make only a few changes in the code to work with the serial port in order for the program to be successfully compiled. <br><br>  After that, I started working on creating a boot image with the XXDP.  This kind of work can be done much faster using the PDP-11 emulator.  I used <a href="http://www.dbit.com/">E11</a> .  First I tried XXDP 2.6, found as an image on bitsavers: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs 1c">Ersatz-<span class="hljs-number"><span class="hljs-number">11</span></span> V7.<span class="hljs-number"><span class="hljs-number">0</span></span> Demo version, COMMERCIAL USE LIMITED TO <span class="hljs-number"><span class="hljs-number">30</span></span>-DAY EVALUATION Copyright (C) <span class="hljs-number"><span class="hljs-number">1993</span></span>-<span class="hljs-number"><span class="hljs-number">2013</span></span> by Digby's Bitpile, Inc. All rights reserved. See www.dbit.com for more information. E11&gt;assign tt1: dda: E11&gt;mount dda0: dddp.dsk E11&gt;set cpu 04 E11&gt;set mem 16 E11&gt;boot tt1: %HALT ?Bad kernel stack R0/<span class="hljs-number"><span class="hljs-number">000000</span></span> R1/<span class="hljs-number"><span class="hljs-number">176506</span></span> R2/<span class="hljs-number"><span class="hljs-number">000000</span></span> R3/<span class="hljs-number"><span class="hljs-number">000066</span></span> CM=K PM=K PRIO=0 R4/<span class="hljs-number"><span class="hljs-number">100020</span></span> R5/<span class="hljs-number"><span class="hljs-number">000000</span></span> SP/<span class="hljs-number"><span class="hljs-number">057774</span></span> PC/<span class="hljs-number"><span class="hljs-number">000006</span></span> N=0 Z=0 V=0 C=0 <span class="hljs-number"><span class="hljs-number">000006</span></span> halt E11&gt;set mem 24 E11&gt;boot tt1: CPU NOT SUPPORTED BY XXDP-XM BOOTING UP XXDP-SM SMALL MONITOR XXDP-SM SMALL MONITOR - XXDP V2.6 REVISION: E0 BOOTED FROM DD0 12KW OF MEMORY UNIBUS SYSTEM RESTART ADDRESS: <span class="hljs-number"><span class="hljs-number">052010</span></span> TYPE "H" FOR HELP .R GKABC0 GKABC0.BIC %HALT R0/<span class="hljs-number"><span class="hljs-number">000357</span></span> R1/<span class="hljs-number"><span class="hljs-number">000000</span></span> R2/<span class="hljs-number"><span class="hljs-number">000300</span></span> R3/<span class="hljs-number"><span class="hljs-number">054426</span></span> CM=K PM=K PRIO=0 R4/<span class="hljs-number"><span class="hljs-number">000001</span></span> R5/<span class="hljs-number"><span class="hljs-number">000776</span></span> SP/<span class="hljs-number"><span class="hljs-number">000500</span></span> PC/<span class="hljs-number"><span class="hljs-number">012006</span></span> N=0 Z=0 V=0 C=0 <span class="hljs-number"><span class="hljs-number">012006</span></span> cmp <span class="hljs-number"><span class="hljs-number">177776</span></span>,#<span class="hljs-number"><span class="hljs-number">000000</span></span> E11&gt;</code> </pre><br></div></div><br>  But it required more memory than it was on my machine, so using this version would not work.  In addition, GKAB did not want to run on an emulated PDP-11/04 for an unknown reason. <br><br>  After that, I spent the time trying to make a TU58 image for XXDP +, an earlier version of the XXDP package.  This is how I did it in E11: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">.R UPD2 CHUP2A2 XXDP+ UPD2 UTILITY <span class="hljs-keyword"><span class="hljs-keyword">RESTART</span></span>: <span class="hljs-number"><span class="hljs-number">002432</span></span> *ZERO DD0: *DRIVER DD0: *<span class="hljs-keyword"><span class="hljs-keyword">LOAD</span></span> DY0:HMDDA1.SYS XFR:<span class="hljs-number"><span class="hljs-number">005034</span></span> CORE:<span class="hljs-number"><span class="hljs-number">000000</span></span>,<span class="hljs-number"><span class="hljs-number">017774</span></span> *SAVM DD0: *PIP DD0:HMDDA1.SYS=DY0:HMDDA1.SYS *PIP DD0:HDDDA1.SYS=DY0:HDDDA1.SYS *PIP DD0:GKA???.BIC=DY0:GKA???.BIC GKAAA0.BIC GKABC0.BIC *PIP DD0:HELP.TXT=DY0:HELP.TXT *PIP DD0:HUDIA0.SYS=DY0:HUDIA0.SYS *PIP DD0:HSAAA0.SYS=DY0:HSAAA0.SYS *PIP DD0:UPD?.BIN=DY0:UPD?.BIN UPD1 .BIN UPD2 .BIN *PIP DD0:SETUP.BIN=DY0:SETUP.BIN E11&gt;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cpu <span class="hljs-number"><span class="hljs-number">04</span></span> E11&gt;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span> mem <span class="hljs-number"><span class="hljs-number">16</span></span> E11&gt;boot tt1: CLEARING MEMORY CHMDDA0 XXDP+ DD MONITOR <span class="hljs-number"><span class="hljs-number">8</span></span>K BOOTED VIA UNIT <span class="hljs-number"><span class="hljs-number">0</span></span> ENTER <span class="hljs-type"><span class="hljs-type">DATE</span></span> (DD-MMM-YY): <span class="hljs-keyword"><span class="hljs-keyword">RESTART</span></span> ADDR:<span class="hljs-number"><span class="hljs-number">033726</span></span> <span class="hljs-number"><span class="hljs-number">50</span></span> HZ? NY LSI? N THIS <span class="hljs-keyword"><span class="hljs-keyword">IS</span></span> XXDP+. <span class="hljs-keyword"><span class="hljs-keyword">TYPE</span></span> "H" <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> "H/L" <span class="hljs-keyword"><span class="hljs-keyword">FOR</span></span> DETAILS .DIR ENTRY# FILNAM.EXT <span class="hljs-type"><span class="hljs-type">DATE</span></span> LENGTH <span class="hljs-keyword"><span class="hljs-keyword">START</span></span> <span class="hljs-number"><span class="hljs-number">000001</span></span> HMDDA1.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">17</span></span> <span class="hljs-number"><span class="hljs-number">000050</span></span> <span class="hljs-number"><span class="hljs-number">000002</span></span> HDDDA1.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-number"><span class="hljs-number">000071</span></span> <span class="hljs-number"><span class="hljs-number">000003</span></span> GKAAA0.BIC <span class="hljs-number"><span class="hljs-number">11</span></span>-AUG<span class="hljs-number"><span class="hljs-number">-76</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-number"><span class="hljs-number">000074</span></span> <span class="hljs-number"><span class="hljs-number">000004</span></span> GKABC0.BIC <span class="hljs-number"><span class="hljs-number">29</span></span>-JAN<span class="hljs-number"><span class="hljs-number">-77</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000113</span></span> <span class="hljs-number"><span class="hljs-number">000005</span></span> HELP .TXT <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">000133</span></span> <span class="hljs-number"><span class="hljs-number">000006</span></span> HUDIA0.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-number"><span class="hljs-number">000165</span></span> <span class="hljs-number"><span class="hljs-number">000007</span></span> HSAAA0.SYS <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">24</span></span> <span class="hljs-number"><span class="hljs-number">000173</span></span> <span class="hljs-number"><span class="hljs-number">000010</span></span> UPD1 .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-number"><span class="hljs-number">000223</span></span> <span class="hljs-number"><span class="hljs-number">000011</span></span> UPD2 .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span> <span class="hljs-number"><span class="hljs-number">000237</span></span> <span class="hljs-number"><span class="hljs-number">000012</span></span> SETUP .BIN <span class="hljs-number"><span class="hljs-number">22</span></span>-MAR<span class="hljs-number"><span class="hljs-number">-80</span></span> <span class="hljs-number"><span class="hljs-number">26</span></span> <span class="hljs-number"><span class="hljs-number">000257</span></span> .R GKABC0 %HALT R0/<span class="hljs-number"><span class="hljs-number">000357</span></span> R1/<span class="hljs-number"><span class="hljs-number">000000</span></span> R2/<span class="hljs-number"><span class="hljs-number">000300</span></span> R3/<span class="hljs-number"><span class="hljs-number">032240</span></span> CM=K PM=K PRIO=<span class="hljs-number"><span class="hljs-number">0</span></span> R4/<span class="hljs-number"><span class="hljs-number">000001</span></span> R5/<span class="hljs-number"><span class="hljs-number">000776</span></span> SP/<span class="hljs-number"><span class="hljs-number">000500</span></span> PC/<span class="hljs-number"><span class="hljs-number">012006</span></span> N=<span class="hljs-number"><span class="hljs-number">0</span></span> Z=<span class="hljs-number"><span class="hljs-number">0</span></span> V=<span class="hljs-number"><span class="hljs-number">0</span></span> C=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-number"><span class="hljs-number">012006</span></span> cmp <span class="hljs-number"><span class="hljs-number">177776</span></span>,#<span class="hljs-number"><span class="hljs-number">000000</span></span></code> </pre><br></div></div><br><br>  GKAAA0.BIC under XXDP + on this machine started successfully.  Most of the system is in excellent condition!  Here is a link to the <a href="">image</a> that I made. <br><img src="https://habrastorage.org/files/c33/151/3e6/c331513e66db4be8a5727d2aa200d544.png"><br><br>  But the launch of GKABC0 ended up stopping the system.  It is impossible to find the source code for a specific version of the utility, but the version under the PDP-11/34 should work.  Looking through the <a href="http://bitsavers.informatik.uni-stuttgart.de/pdf/dec/pdp11/xxdp/listings/AC-8045D-MC_CFKABD0-1134-Traps-Tst_Apr77.pdf">code</a> , you can see that the section where the system stops is a test of the stack overflow processing logic.  The stack pointer is set to 0400, and then the console TX interrupt twitches ( <i>apparently IOT refers to the IOT instruction, which causes the 020 interrupt, to which the OS usually hangs the I / O handler</i> ).  In this case, the stack pointer becomes less than 0400, which leads to the generation of an exception, the processing vector number of which is 4 or 6. On my machine, the behavior was different - more and more new console interrupts were generated until the stack reached 0177774 (physical memory no address), and then stopped with a double bus error. <br><br><h3>  Glitch DL11-W! </h3><br>  Changing the boards, I noticed that using another DL11-W eliminates the problem.  It seems that in DL11-W, the interrupt handling logic is broken.  The interrupt must be cleared as soon as the processor responds with SSYN ( <i>a Unibus bus signal, a kind of handshake</i> ).  This did not happen on a broken map.  Only the processor began to process the interrupt, as received it again and again.  The process of working with interrupts on the Unibus bus is not very complicated.  The device sets the signal BRn, and the processor responds with a BGn setting when it is ready for interrupt service.  After that, the device, in turn, responds with SACK, sets the interrupt vector number, and pulls the INTR.  The trace below is taken from a working card: <br><img src="https://habrastorage.org/files/02f/fe4/036/02ffe40360a944f99ca3df77c4740923.png"><br>  <i>Do not forget that in PDP-11 the active signal level is low</i> <br><br>  The diagram shows the interrupt trigger and the valve that should clear the interrupt signal when it is already serviced. <br><img src="https://habrastorage.org/files/2a6/c49/465/2a6c4946569f4bb18ba84353f6f6432c.png"><br><br>  This fuzzy photo clearly shows the failing 7408 AND-valve on the broken board. <br><img src="https://habrastorage.org/files/6b4/552/ea6/6b4552ea6b8b4e8dbed9ab77f5f2f1a6.png"><br><br>  7408 here is designated as E4, 12 and 13 are input signals, 11 is output, which should, in theory, clear an interrupt when it is in a low state.  This does not happen, and interrupts all go and go. <br><br>  <i>At this, the repair of the main board unit is over, in the <a href="http://habrahabr.ru/post/243553/">second</a> part of the article we are repairing the TU60 tape station, and in the <a href="http://habrahabr.ru/post/243555/">third</a> - the LA30 Decwriter terminal.</i> </div><p>Source: <a href="https://habr.com/ru/post/243551/">https://habr.com/ru/post/243551/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../243537/index.html">What is memory leak in android, how to check the program for their absence and how to prevent them from appearing</a></li>
<li><a href="../243541/index.html">Reveal for everyone!</a></li>
<li><a href="../243543/index.html">High-quality interface JIRA-plugin using the AUI Framework</a></li>
<li><a href="../243545/index.html">SPA-architecture for CRM-systems: part 1</a></li>
<li><a href="../243547/index.html">Python Meetup 10/31/14: asynchrony and soft skills</a></li>
<li><a href="../243553/index.html">Recovery PDP 11/04. Tape station TU60</a></li>
<li><a href="../243555/index.html">Recovery PDP 11/04. Terminal LA30 Decwriter</a></li>
<li><a href="../243557/index.html">How we united the brand book of partners from Kamchatka to Kaliningrad (Part 2)</a></li>
<li><a href="../243559/index.html">Google will mark mobile sites in search results</a></li>
<li><a href="../243561/index.html">How the cloud makes life easier for startups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>