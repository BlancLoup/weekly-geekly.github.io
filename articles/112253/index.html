<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Kyoto Tycoon MemcacheDB Express Test</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, purely by chance, the product from FAL Labs - Kyoto Tycoon , an easy data server, caught my eye. This product is based on QDBM (Quick Databa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Kyoto Tycoon MemcacheDB Express Test</h1><div class="post__text post__text-html js-mediator-article">  Recently, purely by chance, the product from <a href="http://fallabs.com/">FAL Labs</a> - <a href="http://fallabs.com/kyototycoon/">Kyoto Tycoon</a> , an easy data server, caught my eye.  This product is based on <a href="http://fallabs.com/qdbm/">QDBM</a> (Quick Database Manager) - a key-value data storage.  I was hooked by the fact that you can communicate with this ‚ÄúMagnate from Kyoto‚Äù using the memcached-like protocol. <br>  Since I have been using MemcacheDB for some time, I wanted to compare their characteristics (the communication protocol is one, and there and there the NoSQL-key-value storage).  Recently turned up an opportunity - exported a certain amount of data from one self-storage to MemcacheDB.  For testing, it remains only to deploy Kyoto Tycoon on the same server. <br>  Here's what I got: <br><a name="habracut"></a><br>  The server on which it was tested - <strong>Opteron-2218, 2.6GHz, 8G OP, HDD 73G + 143G sas</strong> . <br>  On a 73-gig disk there was a file with imported data, and on a 143-gig base, MemcacheDB and Kyoto Tycoon. <br>  Initial data - 10226086 records, total volume (key + value) 1.4G. <br><br>  Data servers are started by commands: <br>  $ <strong>ktserver -port 11114 -tout 10 -log /var/db_tests/kyoto/ktserver.log -ls -dmn -pid /var/db_tests/kyoto/ktserver.pid -plsv /usr/local/libexec/ktplugservmemc.c.so -plex port = 11115 '/var/db_tests/kyoto/data.kch#opts=l#bnum=20000000#msiz=2g#dfunit=8'</strong> <br><br>  $ <strong>memcachedb -p11117 -d -r -u sen -H / var / db_tests / mcdb / db / -N -v -P /var/db_tests/mcdb/mcdb_tests.pid</strong> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <strong>Results</strong> : <br>  1. Import data: <br>  - Kyoto Tycoon - 18 min. 52 sec. <br>  - MemcacheDB - 32 min 39 sec <br>  2. Data reading (according to the list of keys, data from the corresponding database was selected from the log, checksums were considered for verification): <br>  - Kyoto Tycoon - 9 min. 46 sec.  (restarted the demon to reset its cache, the result deteriorated by 4 seconds) <br>  - MemcacheDB - 19 min 35 sec <br>  3. ‚ÄúRaces‚Äù (simultaneously launched both data import scripts): <br>  - Kyoto Tycoon - 1 hour. <br>  - MemcacheDB - 1 hour 38 min. <br>  By the time the ‚ÄúJapanese‚Äù finish, a third of the total number of entries was loaded into MemcacheDB. <br>  In such a big time of the general ‚Äúrace‚Äù, apparently, the increased daily load on the server was to blame.  Unfortunately, I did not have an absolutely clean server.  But the rest of the tests, except for this one, I started in more free hours and twice, in order to at least a little smooth out the extraneous influences on the process. <br><br>  <strong>And a couple of characteristics</strong> : <br>  1. Size of data files: <br>  - Kyoto Tycoon - 2.15G (the next day it ‚Äúshrunk‚Äù to 1.87G without loss of data, apparently freed empty blocks). <br>  - MemcacheDB - 4.56G <br>  2. The size of the occupied memory: <br>  - Kyoto Tycoon - 2.45G.  Honestly took how much he was allowed, plus the code and personal needs. <br>  - MemcacheDB - 208Mb. <br><br>  With this triple of tests, I decided to finish the comparison of the two products and tormented Kyoto Tycoon a little more by changing the settings.  Since the data storage scheme used is a hash (a variant with a binary tree is also possible), the description states that the performance is affected by the base size of the hash table and it is recommended to set it approximately 2 times more than the number of records stored.  Since in my task the number of records is constantly growing, it is important how much loss in speed is if this number significantly exceeds the specified size of the base hash. <br>  Kyoto Tycoon test results with different parameters (I will only indicate what changed in the above command): <br>  1. bnum = 5000000 (reduced 4 times, 2 times less than the number of records) - 17 min 28 sec <br>  2. bnum = 2000000 - 17 minutes 45 seconds <br>  3. bnum = 5000000 # msiz = 1g (it halves the size of the captured RAM) - 18 min 23 sec <br>  4. bnum = 5000000 # msiz = 500m (another halve) - 19 min 15 sec. <br>  5. no parameters for the data file (the option when the user does not bother with tuning has launched the server by copying the command from the manual): <br>  - data import - 22 min.  4 sec. <br>  - data reading - 11 min.  47 sec. <br>  I drove this package of tests once.  Differences in the results are small, within the limits of errors.  Perhaps a little knocked out the result in the absence of the parameters of the data file (set by default).  Apparently the default settings are quite modest - the server in memory takes only about 400 megabytes. <br>  I didn‚Äôt bother with restrictions anymore.  There will be time to approve, I will play with the settings, I will see at what stage the vault will start to choke.  For myself, I made a conclusion - my Kyoto Tycoon load holds better than MemcacheDB.  Maybe in the next project I will use it. <br><br>  In addition, Kyoto Tycoon can be used as a clean cache memory, like Memcached.  The developers claim that in some cases he even wins, but there are no comparative tests, it would be good to drive-check. <br><br>  What particularly liked in the description is ‚Äúimproved robustness: the database file is not corrupted even under catastrophic situation‚Äù - the developers are unlikely to say this unfoundedly, for sure there will be someone who wants to check. <br><br>  Ps.  In fact, I had a small superficial comparison of MemcacheDB and Kyoto Tycoon, and a bit more detailed testing - Kyoto Tycoon.  In any case, I did not attract the results for the ears, I worked with the real data of one of the projects I supported. <br><br>  Pps.  In addition to Kyoto Tycoon, FAL Labs has some more interesting projects.  For example, <a href="http://fallabs.com/estraier/">Estraier</a> is a personal full-text search engine, <a href="http://fallabs.com/hyperestraier/">Hyper Estraier</a> is a search engine for the community (what the difference is, I did not understand), <a href="http://fallabs.com/tokyopromenade/">Tokyo Promenade</a> is an easy CMS.  It would be interesting to make out how good these products are. <br><br>  <strong>UPDT</strong> .  Analyzing the results of the last test, I discovered that after starting the Kyoto Tycoon server, it is advisable to wait 5-10 seconds before sending him data to save.  During the test, when I restarted the server with new parameters and immediately started sending data to it - about 16 thousand first records were lost.  Those.  for the first 2 seconds, the data loader banged his head against the wall.  There was no loss when working with an already running server.  Such a delay is normal - the layout of data fields, preparation for work. <br><br>  <strong>UPDT2</strong> . Since the default cache size for MemcacheDB is 64 Mb, I made a test with msiz = 64m - I equalized the cache sizes. <br>  Result: <br>  - record - 25 min 43 sec <br>  - reading - 12 min 26 sec <br>  Those.  vseravno speed higher.  But he ate RAM with 400 Mb - two times more than MemcacheDB. <br>  Therefore, in terms of RAM, there is a loss, in terms of speed and size of the database on the disk, the gain (in terms of the size of the database is about 2.5 times). <br>  Surely the gain in speed, including due to the more compact storage - less disk operations. <br><br>  <strong>UPDT3 (dated 03.03.2011)</strong> .  Delighted by the noticeably smaller database file size obtained with the above tests, put Kyoto Tycoon on another project, where BerkeleyDB (with MemcacheDB in the frontend) reached a size of 32 Gig.  Now the Kyoto Tycoon base file ‚Äúweighs‚Äù 30 Gig.  Saved only a couple of gigabytes, the difference is no longer at times.  Savings are highly dependent on the type of data.  The tests used text data, which is well compressed, and in the new project - blocks of binary data.  About the speed of work in this case I can not say anything.  When the database is filled, the data is processed, which takes more time than the actual work of the database <br>  . </div><p>Source: <a href="https://habr.com/ru/post/112253/">https://habr.com/ru/post/112253/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../112247/index.html">New mail notifications in this mailbox</a></li>
<li><a href="../112249/index.html">IpHoster.ru? NOT</a></li>
<li><a href="../112250/index.html">Released final version of Web Farm Framework 2</a></li>
<li><a href="../112251/index.html">Sony chose Opera browser for LCD-TVs and Blu-ray-players</a></li>
<li><a href="../112252/index.html">Group video conferencing in Skype has become paid.</a></li>
<li><a href="../112254/index.html">Google (GOOG): fourth quarter 2010 - new high before castling on top</a></li>
<li><a href="../112255/index.html">Evolution of hosting</a></li>
<li><a href="../112257/index.html">Firefox blocked the official Skype Toolbar</a></li>
<li><a href="../112259/index.html">MS Excel, what are macros capable of or thanks to Bill from the teachers?</a></li>
<li><a href="../112261/index.html">Is it possible to use $ (dollar sign) in the variable name?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>