<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The best packages for working with data in R, part 1</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are two excellent packages for working with data in R - dplyr and data.table . Each package has its strengths. dplyr elegant and similar to natu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The best packages for working with data in R, part 1</h1><div class="post__text post__text-html js-mediator-article"> There are two excellent packages for working with data in R - <code>dplyr</code> and <code>data.table</code> .  Each package has its strengths.  <code>dplyr</code> elegant and similar to natural language, while <code>data.table</code> concise, with it you can do a lot of things in just one line.  Moreover, in some cases, <code>data.table</code> faster (comparative analysis is available <a href="https://github.com/Rdatatable/data.table/wiki/Benchmarks-%253A-Grouping">here</a> ), and this can determine the choice if there are memory or performance limitations.  Comparing <code>dplyr</code> and <code>data.table</code> can also be read on <a href="http://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly">Stack Overflow</a> and <a href="https://www.quora.com/Which-is-better-to-use-for-data-manipulation-dplyr-package-or-data-table-library">Quora</a> . <br><br>  <a href="https://cran.r-project.org/web/packages/data.table/index.html">Here</a> you can find a guide and a short description of <code>data.table</code> , and <a href="https://cran.r-project.org/web/packages/dplyr/index.html">here</a> for <code>dplyr</code> .  You can also read <a href="http://datascienceplus.com/data-manipulation-with-dplyr/">tutorials</a> on <code>dplyr</code> on DataScience +. <br><a name="habracut"></a><br><h4>  Context </h4><br>  I have been using <code>dplyr</code> and <code>data.table</code> for a long time to work with data.  If someone is familiar with only one of the packages, it may be useful to look at the code that does the same thing, in both, to study the second. <br><br><h5>  dplyr </h5><br>  There are five verbs in <code>dplyr</code> that are designed to perform most data operations.  Select - to select one or more columns.  Filter - to select rows based on any criteria.  Arrange - to sort data by one or more columns in ascending or descending order.  Mutate - to add new columns to the data.  Summarise - to select part of the data. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  data.table </h5><br>  The <code>data.table</code> very short common format - DT [ <i>i, j, by</i> ], which can be interpreted as follows: take DT, select lines using <i>i</i> , and calculate <i>j</i> by grouping <i>by</i> . <br><br><h4>  Work with data </h4><br>  First, install some packages for our project. <br><pre> <code class="python hljs">library(dplyr) library(data.table) library(lubridate) library(jsonlite) library(tidyr) library(ggplot2) library(compare)</code> </pre><br>  We will use data from <a href="https://www.data.gov/">DATA.GOV</a> .  This is data on payments for claims of state medical insurance, they can be downloaded <a href="https://catalog.data.gov/dataset/medicare-hospital-spending-by-claim-61b57">from here</a> .  Load the data in JSON format using the <code>fromJSON</code> package <code>jsonlite</code> .  Since JSON is the standard data format for asynchronous interaction between the browser and the server, it is helpful to understand the code below, through which data is received.  An introduction to working with JSON data with the <code>jsonlite</code> package can be found <a href="https://cran.r-project.org/web/packages/jsonlite/vignettes/json-aaquickstart.html">here</a> and <a href="http://datascienceplus.com/introduction-to-time-series-with-json-data/">here</a> .  However, if you want to focus only on the <code>dplyr</code> and <code>data.table</code> , you can safely run the code below in two different windows and don‚Äôt go into details. <br><pre> <code class="python hljs">spending=fromJSON(<span class="hljs-string"><span class="hljs-string">"https://data.medicare.gov/api/views/nrth-mfg3/rows.json?accessType=DOWNLOAD"</span></span>) names(spending)</code> </pre><br><pre> <code class="diff hljs">"meta" "data"</code> </pre><br><pre> <code class="python hljs">meta=spending$meta hospital_spending=data.frame(spending$data) colnames(hospital_spending)=make.names(meta$view$columns$name) hospital_spending=select(hospital_spending,-c(sid:meta)) glimpse(hospital_spending)</code> </pre><br><pre> <code class="diff hljs">Observations: 70598 Variables: $ Hospital.Name (fctr) SOUTHEAST ALABAMA MEDICAL CENT... $ Provider.Number. (fctr) 010001, 010001, 010001, 010001... $ State (fctr) AL, AL, AL, AL, AL, AL, AL, AL... $ Period (fctr) 1 to 3 days Prior to Index Hos... $ Claim.Type (fctr) Home Health Agency, Hospice, I... $ Avg.Spending.Per.Episode..Hospital. (fctr) 12, 1, 6, 160, 1, 6, 462, 0, 0... $ Avg.Spending.Per.Episode..State. (fctr) 14, 1, 6, 85, 2, 9, 492, 0, 0,... $ Avg.Spending.Per.Episode..Nation. (fctr) 13, 1, 5, 117, 2, 9, 532, 0, 0... $ Percent.of.Spending..Hospital. (fctr) 0.06, 0.01, 0.03, 0.84, 0.01, ... $ Percent.of.Spending..State. (fctr) 0.07, 0.01, 0.03, 0.46, 0.01, ... $ Percent.of.Spending..Nation. (fctr) 0.07, 0.00, 0.03, 0.58, 0.01, ... $ Measure.Start.Date (fctr) 2014-01-01T00:00:00, 2014-01-0... $ Measure.End.Date (fctr) 2014-12-31T00:00:00, 2014-12-3...</code> </pre><br>  As shown above, all columns are imported as factor variables.  Let's make numeric data in numbers. <br><pre> <code class="python hljs">cols = <span class="hljs-number"><span class="hljs-number">6</span></span>:<span class="hljs-number"><span class="hljs-number">11</span></span>; <span class="hljs-comment"><span class="hljs-comment">#  ,     hospital_spending[,cols] &lt;- lapply(hospital_spending[,cols], as.numeric)</span></span></code> </pre><br>  The last two columns indicate the beginning and end of the measurement.  Let's use the <code>lubridate</code> package to fix them. <br><pre> <code class="python hljs">cols = <span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-number"><span class="hljs-number">13</span></span>; <span class="hljs-comment"><span class="hljs-comment">#       hospital_spending[,cols] &lt;- lapply(hospital_spending[,cols], ymd_hms)</span></span></code> </pre><br>  Now let's make sure the columns are of the correct type. <br><pre> <code class="python hljs">sapply(hospital_spending, <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">)</span></span></code> </pre><br><pre> <code class="diff hljs">$Hospital.Name "factor" $Provider.Number. "factor" $State "factor" $Period "factor" $Claim.Type "factor" $Avg.Spending.Per.Episode..Hospital. "numeric" $Avg.Spending.Per.Episode..State. "numeric" $Avg.Spending.Per.Episode..Nation. "numeric" $Percent.of.Spending..Hospital. "numeric" $Percent.of.Spending..State. "numeric" $Percent.of.Spending..Nation. "numeric" $Measure.Start.Date "POSIXct" "POSIXt" $Measure.End.Date "POSIXct" "POSIXt"</code> </pre><br><h4>  Create a table with data </h4><br>  You can create a table with data (data.table) using the <code>data.table()</code> function: <br><pre> <code class="python hljs">hospital_spending_DT = data.table(hospital_spending) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(hospital_spending_DT)</span></span></span></span></code> </pre><br><pre> <code class="diff hljs">"data.table" "data.frame"</code> </pre><br><h4>  Select some columns </h4><br>  To select columns in <code>dplyr</code> , use the <code>select</code> verb.  In <code>data.table</code> , in turn, you can set the column names. <br><br><h5>  Single variable selection </h5><br>  Choose the variable "Hospital Name". <br><pre> <code class="python hljs">from_dplyr = select(hospital_spending, Hospital.Name) from_data_table = hospital_spending_DT[,.(Hospital.Name)]</code> </pre><br>  Now you need to make sure that the results of <code>dplyr</code> and <code>data.table</code> same. <br><pre> <code class="python hljs">compare(from_dplyr,from_data_table, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre><br><h5>  Delete one variable </h5><br><pre> <code class="python hljs">from_dplyr = select(hospital_spending, -Hospital.Name) from_data_table = hospital_spending_DT[,!c(<span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>=FALSE] compare(from_dplyr,from_data_table, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre><br>  You can also take the function <code>:=</code> , which changes the input data table (data.table) by reference. <br>  We also use the <code>copy()</code> function, which creates a copy of the original object, i.e.  any following operation on the data by reference to the copy will not affect the initial object. <br><pre> <code class="python hljs">DT=copy(hospital_spending_DT) DT=DT[,Hospital.Name:=NULL] <span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>%<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>%names(DT)</code> </pre> <pre> <code class="diff hljs">FALSE</code> </pre> <br>  Similarly, you can simultaneously delete several variables: <br><pre> <code class="python hljs">DT=copy(hospital_spending_DT) DT=DT[,c(<span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>,<span class="hljs-string"><span class="hljs-string">"State"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.Start.Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.End.Date"</span></span>):=NULL] c(<span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>,<span class="hljs-string"><span class="hljs-string">"State"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.Start.Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.End.Date"</span></span>)%<span class="hljs-keyword"><span class="hljs-keyword">in</span></span>%names(DT)</code> </pre><br><pre> <code class="diff hljs">FALSE FALSE FALSE FALSE</code> </pre><br><h5>  Selection of several variables </h5><br>  Let's select the variables Hospital.Name, State, Measure.Start.Date and Measure.End.Date. <br><pre> <code class="python hljs">from_dplyr = select(hospital_spending, Hospital.Name,State,Measure.Start.Date,Measure.End.Date) from_data_table = hospital_spending_DT[,.(Hospital.Name,State,Measure.Start.Date,Measure.End.Date)] compare(from_dplyr,from_data_table, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre><br><h5>  Delete multiple variables </h5><br>  Let's now remove the variables Hospital.Name, State, Measure.Start.Date and Measure.End.Date from the hospital_spending dataset and the data.table hospital_spending_DT data set. <br><pre> <code class="python hljs">from_dplyr = select(hospital_spending, -c(Hospital.Name,State,Measure.Start.Date,Measure.End.Date)) from_data_table = hospital_spending_DT[,!c(<span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>,<span class="hljs-string"><span class="hljs-string">"State"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.Start.Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.End.Date"</span></span>),<span class="hljs-keyword"><span class="hljs-keyword">with</span></span>=FALSE] compare(from_dplyr,from_data_table, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre><br>  <code>dplyr</code> has the <code>contains()</code> , <code>starts_with()</code> and <code>ends_with()</code> that can be used with the <code>select</code> verb.  Regular expressions are allowed in <code>data.table</code> .  As an example, select the columns containing the word "Date" in the name. <br><pre> <code class="python hljs">from_dplyr = select(hospital_spending,contains(<span class="hljs-string"><span class="hljs-string">"Date"</span></span>)) from_data_table = subset(hospital_spending_DT,select=grep(<span class="hljs-string"><span class="hljs-string">"Date"</span></span>,names(hospital_spending_DT))) compare(from_dplyr,from_data_table, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre><br><pre> <code class="python hljs">names(from_dplyr)</code> </pre><br><pre> <code class="diff hljs">"Measure.Start.Date" "Measure.End.Date"</code> </pre><br><h4>  Rename columns </h4><br><pre> <code class="python hljs">setnames(hospital_spending_DT,c(<span class="hljs-string"><span class="hljs-string">"Hospital.Name"</span></span>, <span class="hljs-string"><span class="hljs-string">"Measure.Start.Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"Measure.End.Date"</span></span>), c(<span class="hljs-string"><span class="hljs-string">"Hospital"</span></span>,<span class="hljs-string"><span class="hljs-string">"Start_Date"</span></span>,<span class="hljs-string"><span class="hljs-string">"End_Date"</span></span>)) names(hospital_spending_DT)</code> </pre><br><pre> <code class="diff hljs">"Hospital" "Provider.Number." "State" "Period" "Claim.Type" "Avg.Spending.Per.Episode..Hospital." "Avg.Spending.Per.Episode..State." "Avg.Spending.Per.Episode..Nation." "Percent.of.Spending..Hospital." "Percent.of.Spending..State." "Percent.of.Spending..Nation." "Start_Date" "End_Date"</code> </pre><br><pre> <code class="python hljs">hospital_spending = rename(hospital_spending,Hospital= Hospital.Name, Start_Date=Measure.Start.Date,End_Date=Measure.End.Date) compare(hospital_spending,hospital_spending_DT, allowAll=TRUE)</code> </pre><br><pre> <code class="diff hljs">TRUE dropped attributes</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/301914/">https://habr.com/ru/post/301914/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301900/index.html">Methods of generating random numbers with a uniform distribution law. Part 1</a></li>
<li><a href="../301904/index.html">Google I / O 2016: Android N and Android Ecosystem Details</a></li>
<li><a href="../301906/index.html">Why is summer good for brands?</a></li>
<li><a href="../301908/index.html">Who to live well in startups</a></li>
<li><a href="../301910/index.html">Perl plugin version 2.0 released for IntelliJ IDEA</a></li>
<li><a href="../301916/index.html">NeDB: SQLite equivalent for NodeJS</a></li>
<li><a href="../301918/index.html">Amazing Computer: ENIAC History</a></li>
<li><a href="../301922/index.html">Not we are - life is like this: Thematic analysis for the most impatient</a></li>
<li><a href="../301924/index.html">"The candidate has the right to ask clarifying questions," or we are bringing the interviewer to a nervous breakdown</a></li>
<li><a href="../301930/index.html">Bidmanedzherami and killing rate - is the loss of almost half of the profits</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>