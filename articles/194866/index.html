<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Performance comparison of Xamarin (monodroid) and Java (DalvikVM) on Android devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. Many people are interested in how much Xamarin performance differs on Android or iOS. I‚Äôll leave the issue with iOS open for now, but I‚Äôd li...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Performance comparison of Xamarin (monodroid) and Java (DalvikVM) on Android devices</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/b7b/5c0/ec1/b7b5c0ec125451d6b094a95e692bf50b.jpg" alt="image" align="left"><br>  Good day.  Many people are interested in how much Xamarin performance differs on Android or iOS.  I‚Äôll leave the issue with iOS open for now, but I‚Äôd like to close all questions on monodroid performance once and for all. <br><br>  Often, these questions are caused due to a misunderstanding of how the monodroid works, for example, I was asked questions like ‚ÄúAnd does Xamarin rebuild under JVM?‚Äù.  This is certainly not the case.  It is important to understand that Xamarin runs at the same Android level as the Android Dalvik virtual machine.  Therefore, when comparing performance, we actually have a comparison of the performance of two virtual machines: Mono VM and Dalvik VM. <br><br><a name="habracut"></a><br><h4>  Test method </h4><br>  To verify performance, you need a Java-implemented and generally accepted method that will need to be implemented in C #.  I decided to use the well-known LINPACK benchmark primarily because its source code is <a href="http://www.netlib.org/benchmark/linpackjava/">open</a> and it will be easy to implement the C # version, and secondly, there is a ready-made Android version of <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.greenecomputing.linpack%26hl%3Dru">LINPACK for Android</a> written in Java. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Performance test LINPACK is a performance evaluation method by evaluating the speed of a floating-point operation of a computer system.  The benchmark was created by Jack Dongarra and measures how fast a computer is looking for a solution to a dense SLAE Ax = B of the dimension N x N using the LU decomposition method.  The solution is obtained by the Gauss method with the selection of the main element ( <a href="http://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B5%25D1%2582%25D0%25BE%25D0%25B4_%25D0%2593%25D0%25B0%25D1%2583%25D1%2581%25D1%2581%25D0%25B0">description</a> ), in which 2/3 * N <sup>3</sup> + 2 * N <sup>2</sup> floating point operations are performed.  The result is defined in Floating-point Operations Per Second (MFLOP / s, more often just FLOPS).  The performance test itself was described in the LINPACK Fortran linear computing library documentation and since then its variations have been used, for example, to compile TOP500 supercomputers. <br><br><h4>  Implementation </h4><br>  Despite the rather simple task, I decided to implement it according to the guideline I developed for cross-platform development. <br><br>  In the first step, we build a cross-platform solution: <br><img src="https://habrastorage.org/storage3/310/91a/49c/31091a49c04d1325a584ccb691c00502.png"><br>  Then, according to the MVP design pattern, we create Presenter and View. <br><img src="https://habrastorage.org/getpro/habr/post_images/83d/b42/048/83db4204899fefffdc09e23761902c8b.png" alt="image"><br>  We write tests and implement Presenter through a test.  For this, I use NUnit and NSubstitute.  There is no special point in describing NUnit, in my opinion there is simply no more convenient framework for testing.  NSubstitute is an extremely convenient framework for creating stubs based on interfaces.  The frameworks are installed via NuGet. <br><div class="spoiler">  <b class="spoiler_title">A small example of using an NSubstitute from docks</b> <div class="spoiler_text"><pre><code class="cs hljs"><span class="hljs-comment"><span class="hljs-comment">// Let's say we have a basic calculator interface: public interface ICalculator { int Add(int a, int b); string Mode { get; set; } event Action PoweringUp; } // We can ask NSubstitute to create a substitute instance for this type. We could ask for a stub, mock, fake, spy, test double etc., but why bother when we just want to substitute an instance we have some control over? _calculator = Substitute.For&lt;ICalculator&gt;(); // Now we can tell our substitute to return a value for a call: _calculator.Add(1, 2).Returns(3); Assert.That(_calculator.Add(1, 2), Is.EqualTo(3)); // We can check that our substitute received a call, and did not receive others: _calculator.Add(1, 2); _calculator.Received().Add(1, 2); _calculator.DidNotReceive().Add(5, 7); // If our Received() assertion fails, NSubstitute tries to give us some help as to what the problem might be: NSubstitute.Exceptions.ReceivedCallsException : Expected to receive a call matching: Add(1, 2) Actually received no matching calls. Received 2 non-matching calls (non-matching arguments indicated with '*' characters): Add(1, *5*) Add(*4*, *7*) // We can also work with properties using the Returns syntax we use for methods, or just stick with plain old property setters (for read/write properties): _calculator.Mode.Returns("DEC"); Assert.That(_calculator.Mode, Is.EqualTo("DEC")); _calculator.Mode = "HEX"; Assert.That(_calculator.Mode, Is.EqualTo("HEX"));</span></span></code> </pre> <br></div></div><br>  In our case, we first create the Setup method. <br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">TestFixtureSetUp</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Setup</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { view = Substitute.For&lt;ILinpackView&gt;(); presenter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LinpackPresenter(view); }</code> </pre><br>  And we perform a simple test, naturally asynchronously. <br><pre> <code class="cs hljs"> [<span class="hljs-meta"><span class="hljs-meta">Test</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateAsyncTest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { presenter.CalculateAsync().Wait(); Assert.That(view.Mflops, Is.EqualTo(<span class="hljs-number"><span class="hljs-number">130.0</span></span>).Within(<span class="hljs-number"><span class="hljs-number">5</span></span>).Percent); }</code> </pre><br>  With third-party software, I found out that the performance of my PC is about 130 MFLOPS / s, so we will write it in the expected values, adding an error. <br><br>  Inside my method, I create an asynchronous Task and populate the View.  Everything is simple and clear <br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CalculateAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Linpack l = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Linpack(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.Factory.StartNew(() =&gt; l.RunBenchmark()) .ContinueWith(t =&gt; { _view.Mflops = l.MFlops; _view.NormRes = l.ResIDN; _view.Precision = l.Eps; _view.Time = l.Time.ToString(); } ); }</code> </pre><br><br>  The program is actually implemented, not a single line of platform-specific code has been written yet.  Now we are creating an Android project: <br><img src="https://habrastorage.org/storage3/fb7/e07/906/fb7e07906adbe3f8af03c12d2adac2ef.png"><br>  Visual designer inside Visual Studio will allow us to quickly and easily distribute the necessary application and see how it looks with different themes.  True, since none of the topics have been applied to the Activity, then on the device we will get the default view <br><br>  Now it remains only to compile the release, sign it with the master attached to the studio and install it on devices using the console utility adb.exe <br><img src="https://habrastorage.org/storage3/c19/1cd/28c/c191cd28c70871c92c69cd6c96aa7a1d.png"><br><br>  Recently, I noticed that the speed of code execution depends not only on Debug / Release but also on the connection of the device via USB.  This happens due to the fact that when the phone is connected in Android development mode, it drives huge amounts of debugging information to a computer, which may affect the speed of operations (or maybe not), especially if there are logging structures like Trace.  Therefore, disable the device and run the tests. <br><br>  Done! <br><br><h4>  Result </h4><br>  I have two test devices, HTC Desire with Android 2.3 (Qualcomm QSD8250, 1000 MHz, 512 RAM) and Fly IQ443 with Android 4.0.4 (MediaTek MT6577, 1000 MHz, 512 RAM) <br><br>  Here are their results: <br>  HTC Desire: <br><table><tbody><tr><td><img src="https://habrastorage.org/storage3/caf/af1/6f5/cafaf16f55ecd89cbe30be09e0cafe80.jpg" align="right"></td><td><img src="https://habrastorage.org/storage3/d16/500/c34/d16500c347935d36fbc92487416db383.jpg" align="left"></td></tr></tbody></table><br><br>  Fly IQ443: <br><table><tbody><tr><td><img src="https://habrastorage.org/storage3/220/a06/7c3/220a067c3b34ea60a8b2bae24f7905e1.png" align="right"></td><td><img src="https://habrastorage.org/storage3/7c5/a05/ee9/7c5a05ee97f5aab7cd2db6539eeea2a5.png" align="left"></td></tr></tbody></table><br><br>  And beautiful graphics <br><img src="https://habrastorage.org/getpro/habr/post_images/25d/d4e/178/25dd4e1784d0b199125e75fda0a11530.png"><br><br><h4>  Conclusion </h4><br>  The test results show that Mono's work on Android is at least comparable to, and sometimes exceeds, the performance of Dalvik, but <b>on the whole they are roughly equal.</b>  The second column is incorrect, since  Mono independently parallelized the test into two cores without any actions on my part, I suppose somewhere on the Task level, while for Linpack for Android it is necessary to explicitly select the multi-threaded test. <br><br>  Incidentally, this project shows the differences in size for release assemblies.  The Java version of the test weighs only 280K when the Monodroid version weighs <b>almost 2.3 MB</b> for one type of processor (armeabi and armeabi-v7), i.e.  in the <b>amount of 4.6 MB</b> , which, however, in the conditions of modern networks does not seem to me particularly critical.  If this apk size seems unacceptable to you, you can separately build and distribute packages for armeabi and armeabi-v7, the benefit of Google Play <a href="http://developer.android.com/google/play/publishing/multiple-apks.html">allows you to</a> download different apk for different platforms. <br><br>  The source code of the application is <a href="https://bitbucket.org/xakpc/xakpc.monolinpack/overview">here.</a> <br><br>  PS I would like to collect statistics on devices.  So if anyone has Android and 10 minutes of free time I will be very grateful if you measure the performance of your device using <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.greenecomputing.linpack%26hl%3Dru">LINPACK for Android</a> and the newly created <a href="">MonoLINPACK</a> and write the result <a href="https://docs.google.com/forms/d/119Oz_VaY9whtrcuViFLUY-FDVbZKNbQegB3To1NFVaA/viewform">here</a> (if you have a multi-core processor, select Run Multiple Thread right away in LINPACK for Android) <br><br>  PPS A similar test for iOS will <br><br>  <b>UPD1</b> According to current tests, it is clear that Mono and Task by default does not use all cores on 4-core processors.  Therefore, the results between Linpack for Android and MonoLinpack on such devices are very different.  In the near future, MonoLINPACK will be modified using TPL. </div><p>Source: <a href="https://habr.com/ru/post/194866/">https://habr.com/ru/post/194866/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../194852/index.html">Rejecting jParser (in favor of working directly with Node.js buffers) speeds up the script by an order of magnitude</a></li>
<li><a href="../194854/index.html">Today, the Android OS is exactly 5 years old</a></li>
<li><a href="../194856/index.html">Google glass from a developer‚Äôs point of view</a></li>
<li><a href="../194860/index.html">BlackBerry leaves consumer market</a></li>
<li><a href="../194862/index.html">Hardware and software automation platform Tibbo</a></li>
<li><a href="../194868/index.html">Metro for all, or let no one leave offended</a></li>
<li><a href="../194870/index.html">Google is beating its death throes ...</a></li>
<li><a href="../194872/index.html">Publisher - Society. Is it possible to?</a></li>
<li><a href="../194876/index.html">Upgrading Windows 8.1 from Enterprise to Pro, or How to Remove Sentinel Runtime Drivers Driver</a></li>
<li><a href="../194878/index.html">How to put electronics on production: analysis of stages and tasks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>