<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Thymeleaf Tutorial: Chapter 15. Configuration Details</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Table of contents 

 15 Configuration Details 
 15.1 Resolver Templates 
 For our virtual grocery store Thymes, we chose an ITemplateResolver implemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Thymeleaf Tutorial: Chapter 15. Configuration Details</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/post/350862/">Table of contents</a> <br><br><h2>  15 Configuration Details </h2><br><h3>  15.1 Resolver Templates </h3><br>  For our virtual grocery store Thymes, we chose an ITemplateResolver implementation called ServletContextTemplateResolver, which allowed us to get templates as resources from the servlet context. <br><br>  In addition to providing the ability to create your own template resolver, implementing the ITemplateResolver, Thymeleaf includes four implementations out of the box: <br><a name="habracut"></a><br><ul><li>  <b>org.thymeleaf.templateresolver.ClassLoaderTemplateResolver</b> , which finds templates as class loader resources, for example: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="xml hljs">return Thread.currentThread().getContextClassLoader().getResourceAsStream(template);</code> </pre> </li><li>  <b>org.thymeleaf.templateresolver.FileTemplateResolver</b> , which finds templates as files from the file system, for example: <br><br><pre> <code class="xml hljs">return new FileInputStream(new File(template));</code> </pre> </li><li>  <b>org.thymeleaf.templateresolver.UrlTemplateResolver</b> , which finds patterns as URLs (even non-local), for example: <br><br><pre> <code class="xml hljs">return (new URL(template)).openStream();</code> </pre> </li><li>  <b>org.thymeleaf.templateresolver.StringTemplateResolver</b> , which finds templates directly, because the String is specified as a template (or a template name, which in this case, obviously, is much more than a simple name): <br><br><pre> <code class="xml hljs">return new StringReader(templateName);</code> </pre> </li></ul><br>  All predefined ITemplateResolver implementations allow you to use the same set of configuration parameters, which include: <br><br><ul><li>  Prefix and suffix (as already seen): <br><br><pre> <code class="java hljs">templateResolver.setPrefix(<span class="hljs-string"><span class="hljs-string">"/WEB-INF/templates/"</span></span>); templateResolver.setSuffix(<span class="hljs-string"><span class="hljs-string">".html"</span></span>);</code> </pre> </li><li>  Template aliases that allow you to use template names that do not correspond to file names.  If there is a suffix / prefix and an alias, the alias will be applied before the prefix / suffix: <br><br><pre> <code class="java hljs">templateResolver.addTemplateAlias(<span class="hljs-string"><span class="hljs-string">"adminHome"</span></span>,<span class="hljs-string"><span class="hljs-string">"profiles/admin/home"</span></span>); templateResolver.setTemplateAliases(aliasesMap);</code> </pre> </li><li>  Encoding used when reading templates: <br><br><pre> <code class="java hljs">templateResolver.setEncoding(<span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>);</code> </pre> </li><li>  Template mode used: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Default is HTML templateResolver.setTemplateMode("XML");</span></span></code> </pre> </li><li>  The default mode for the template cache and patterns is to determine whether specific templates are cacheable or not: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">// Default is true templateResolver.setCacheable(false); templateResolver.getCacheablePatternSpec().addPattern("/users/*");</span></span></code> </pre> </li><li>  TTL in milliseconds for parsing template cache entries created in this template resolver.  If not specified, the only way to delete a record from the cache is LRU (the maximum cache size is exceeded, and the record will be the oldest). <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    TTL ( LRU  ) templateResolver.setCacheTTLMs(60000L);</span></span></code> </pre> </li></ul><br>  Thymeleaf + Spring integration packs offer a SpringResourceTemplateResolver implementation that uses the entire Spring framework to access and read resources in applications and which is the recommended implementation for applications that support Spring. <br><br>  <b>Chain of resolvers patterns</b> <br><br>  In addition, the template engine can specify multiple template crawlers, in which case the order can be set between them to search for a template, so if the first cannot find the template, the second is requested and so on: <br><br><pre> <code class="java hljs">ClassLoaderTemplateResolver classLoaderTemplateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassLoaderTemplateResolver(); classLoaderTemplateResolver.setOrder(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">1</span></span>)); ServletContextTemplateResolver servletContextTemplateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServletContextTemplateResolver(servletContext); servletContextTemplateResolver.setOrder(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">2</span></span>)); templateEngine.addTemplateResolver(classLoaderTemplateResolver); templateEngine.addTemplateResolver(servletContextTemplateResolver);</code> </pre> <br>  When multiple resolver patterns are used, it is recommended that <b>patterns</b> be specified for each pattern recognizer, so that Thymeleaf can quickly cancel these pattern-based resolvers that are not designed to find a pattern, improving performance.  This is not a requirement, but a recommendation: <br><br><pre> <code class="java hljs">ClassLoaderTemplateResolver classLoaderTemplateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassLoaderTemplateResolver(); classLoaderTemplateResolver.setOrder(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">1</span></span>)); <span class="hljs-comment"><span class="hljs-comment">//         ,     classLoaderTemplateResolver.getResolvablePatternSpec().addPattern("/layout/*.html"); classLoaderTemplateResolver.getResolvablePatternSpec().addPattern("/menu/*.html"); ServletContextTemplateResolver servletContextTemplateResolver = new ServletContextTemplateResolver(servletContext); servletContextTemplateResolver.setOrder(Integer.valueOf(2));</span></span></code> </pre> <br>  If these resolvable patterns are not specified, we will rely on the specific capabilities of each of the ITemplateResolver implementations we created.  Note that not all implementations can determine the existence of a pattern before its resolving and therefore can always consider a pattern as resolvable and interrupt the search chain (not allowing other resolvers to check the same pattern). <br><br>  All ITemplateResolver implementations that are part of the Thymeleaf core include a mechanism that allows us to force resolvers to really check if a resource exists before it is found.  This is the <b>checkExistence</b> flag, which works like: <br><br><pre> <code class="java hljs">ClassLoaderTemplateResolver classLoaderTemplateResolver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClassLoaderTemplateResolver(); classLoaderTemplateResolver.setOrder(Integer.valueOf(<span class="hljs-number"><span class="hljs-number">1</span></span>)); classLoaderTempalteResolver.setCheckExistence(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  This <b>checkExistence</b> flag causes the resolver to perform a real check for the existence of the resource during the search phase (and let the next search be carried out in a chain if the current check returns false).  While this may seem like a good solution, in most cases it will mean dual access to the resource itself (once to check for existence, at another time to read it) and can be a performance problem in some scenarios, for example, ‚Äúremote‚Äù template-based resources URLs are a potential performance problem, which in any case can be greatly mitigated by using the template cache (in this case, the templates will be searched only when they are first accessed). <br><br><h3>  15.2 Message Resolvers </h3><br>  We did not explicitly specify the Message Resolver implementation for our Grocery application, and, as explained earlier, this meant that the implementation used was the org.thymeleaf.messageresolver.StandardMessageResolver object. <br><br>  <b>StandardMessageResolver</b> is a standard implementation of the IMessageResolver interface, but we could create our own, if you wanted, adapted to the specific needs of our application. <br><br>  Thymeleaf + Spring integration packages offer a default implementation of <b>IMessageResolver</b> , which uses the standard Spring method to receive external messages using MessageSource components declared in the context of the Spring Application Context. <br><br>  <b>Standard Message Resolver</b> <br><br>  So, how does the <b>StandardMessageResolver of</b> messages requested by a particular template look like? <br><br>  If the template name is ‚Äúhome‚Äù and it is in /WEB-INF/templates/home.html, and the requested language is gl_ES, then this recognizer will look for messages in the following files in the following order: <br><br><pre> <code class="hljs"> /WEB-INF/templates/home_gl_ES.properties /WEB-INF/templates/home_gl.properties /WEB-INF/templates/home.properties</code> </pre> <br>  See the StandardMessageResolver class JavaDoc documentation for more details on how the full message search engine works. <br><br>  <b>Configuring the Message Finder</b> <br><br>  What if we want to add a message mapper (or more) to the template engine?  This is easy: <br><br><pre> <code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">//    templateEngine.setMessageResolver(messageResolver); //     templateEngine.addMessageResolver(messageResolver);</span></span></code> </pre> <br>  And why do we want to have more than one message finder?  For the same reason as the template crawler: the message organizers are ordered, and if the first cannot find a specific message, the second will be requested, then the third, and so on. <br><br><h3>  15.3 Conversion Services </h3><br>  The transformation service, which allows us to perform data conversion and formatting operations using the double-brace syntax <b>($ {{...}})</b> , is actually an element of the standard dialect, and not the Thymeleaf template mechanism itself. <br><br>  Thus, the way to configure it is to configure the custom implementation of the <b>IStandardConversionService</b> interface directly in the StandardDialect instance, which is configured in the template engine.  More details: <br><br><pre> <code class="java hljs">IStandardConversionService customConversionService = ... StandardDialect dialect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StandardDialect(); dialect.setConversionService(customConversionService); templateEngine.setDialect(dialect);</code> </pre> <br>  Note that the <b>thymeleaf-spring3</b> and <b>thymeleaf-spring4 packages</b> contain SpringStandardDialect, and this dialect is already pre-configured with the implementation of <b>IStandardConversionService</b> , which integrates Spring‚Äôs own transformation service infrastructure into Thymeleaf. <br><br><h3>  15.4 Logging </h3><br>  Thymeleaf pays great attention to event logging and is always trying to provide the maximum amount of useful information through its logging interface. <br><br>  The logging library used is <b>slf4j</b> , which actually acts as a bridge for any logging implementation that we could use in our application (for example, log4j). <br><br>  In the Thymeleaf classes <b>, TRACE, DEBUG and INFO</b> data will be recorded, depending on the level of detail we want, and besides general logging, it will use three special loggers associated with the TemplateEngine class, which we can configure separately for different purposes: <br><br><ul><li>  <b>org.thymeleaf.TemplateEngine.CONFIG</b> will display a detailed library configuration during initialization. </li><li>  <b>org.thymeleaf.TemplateEngine.TIMER</b> will display information about the time spent processing each template (useful for benchmarking!) </li><li>  <b>org.thymeleaf.TemplateEngine.cache</b> is a prefix for a set of registrars that output specific information about caches.  Although the names of cache registrars are user-configurable and, therefore, subject to change, by default they are: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.thymeleaf</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.TemplateEngine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cache</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.TEMPLATE_CACHE</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">org</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.thymeleaf</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.TemplateEngine</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.cache</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.EXPRESSION_CACHE</span></span></code> </pre> </li></ul><br>  An example configuration for a Thymeleaf registration infrastructure using log4j might be: <br><br><pre> <code class="hljs pgsql">log4j.logger.org.thymeleaf=<span class="hljs-keyword"><span class="hljs-keyword">DEBUG</span></span> log4j.logger.org.thymeleaf.TemplateEngine.CONFIG=TRACE log4j.logger.org.thymeleaf.TemplateEngine.TIMER=TRACE log4j.logger.org.thymeleaf.TemplateEngine.cache.TEMPLATE_CACHE=TRACE</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/352542/">https://habr.com/ru/post/352542/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../352532/index.html">Bitcoin & AI. Victory is inevitable</a></li>
<li><a href="../352534/index.html">Creating an Asymmetric Mesh with Grid Layout</a></li>
<li><a href="../352536/index.html">Thymeleaf tutorial: Chapter 14. A few more pages of our groceries</a></li>
<li><a href="../352538/index.html">DEFCON 23. "Let'sEncrypt: chasing free encryption certificates for the Internet." Yang Zhu, Peter Eckersley, James Kasten</a></li>
<li><a href="../352540/index.html">4 tips on working with Vue.js</a></li>
<li><a href="../352544/index.html">Thymeleaf Tutorial: Chapter 16. Template Cache</a></li>
<li><a href="../352546/index.html">Android application on top of other applications</a></li>
<li><a href="../352548/index.html">Thymeleaf Tutorial: Chapter 17. Shared Pattern Logic</a></li>
<li><a href="../352550/index.html">PHP ACL. Attempting to make code safer</a></li>
<li><a href="../352552/index.html">Thymeleaf Tutorial: Chapter 18. Appendix A: Basic Expressions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>