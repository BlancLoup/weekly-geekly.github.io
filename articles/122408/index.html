<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to make friends with SQLite android with a language other than English</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, dear reader! 
 In this article I want to touch on the problem of storing Cyrillic data in SQLite, try to deal with the Android NDK, and general...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to make friends with SQLite android with a language other than English</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/053/31e/46d/05331e46dc275d67c90f66c879b8516b.jpg"><br>  Hello, dear reader! <br>  In this article I want to touch on the problem of storing Cyrillic data in SQLite, try to deal with the Android NDK, and generally live a wonderful life!  However, from this point on, I consider important the first two points.  We will talk about them. <br><br>  A well-known problem with SQLite is that it doesn‚Äôt like any characters other than Latin, so the following <a href="http://habrahabr.ru/blogs/sql/57915/">is true [1]</a> : <br> <code>SELECT "" LIKE ""; <br> 0 <br> SELECT "s" LIKE "S"; <br> 1</code> <br> <br>  Such a problem is relevant for our latitudes, and can be solved by user functions. <br>  But Android does not support functions, so crutches are created. <br><br><a name="habracut"></a><br><h4>  Android NDK </h4><br>  To expand your horizons, dear reader, as well as create suitable crutches, I suggest using <a href="http://developer.android.com/sdk/ndk/index.html">Android NDK [2] (download and unpack into an accessible folder)</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  A bit boring </h5><br>  Android NDK is a tool to compile C / C ++ code into native code of the Android platform.  In addition, many Android libraries are provided, so that certain intensive program sections can be written in C / C ++ and then used in Java. <br>  NDK is supported starting with Android 1.5, and the following ARMv5TE processor architectures (including Thumb-1 instructions), ARMv7-A (including Thumb-2 instructions and VFPv3-D16, with optional support for NEON / VFPv3-D32) are currently supported <br>  Future releases promise x86 support <br><br>  In short, let's use this tool! <br><br><h4>  So... </h4><br>  What do we do?  We will combine the source code sqlite and icu. <br>  In order not to burden the process of searching for the necessary libraries and source codes, an assembled set for compilation is proposed <a href="">here [3]</a> .  I apologize if you accidentally included something extra. <br>  <b>If you are not interested in the compilation process, you can download the compiled library <a href="">here [7]</a> , and skip a few points.</b> <br><br>  Download the file, unpack, and place this precious in your project. <br>  project / jni <br>  Where the project here and hereafter is complete let it be before the project <br><br>  Before going to the compilation step, I want to draw your attention to the structure of some files. <br><br><h5>  common / Android.mk </h5><br>  All source files connected to the future library, various flags and build options are described here. <br><br><h5>  common / android_sqlite ... </h5><br>  These files provide android-like access to the database, as well as an interface for interacting with the database from Java. <br>  Note the function signatures. <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Java_biz_sneg_sqlite_SQLiteDatabase_closedb()</code> </pre> <br>  To successfully use native functions, you need to describe them in the format <code>Java____</code> <br>  I also turned on the function of determining the geographic distance GEODISTANCE (x1, y1, x2, y2), because, for me personally, it was not enough. <br>  Now it's easy to plug in your desired functions, be it sin, cos or your exotic <br><br><h4>  Compilation and connection of the library </h4><br>  First I will describe the steps for Windows, because the solution in the forehead does not work. <br>  <b>Do it once!</b>  Download and install <a href="http://cygwin.com/">Cygwin [6]</a> , when installing, select Devel packages for installation.  And ... temporarily retire to sleep or other pleasant things, because it is hellishly long.  Although, maybe I just chose the wrong server. <br>  <b>Do two!</b>  We start the Cygwin console (just the console for other OS) and passing to the directory from the project: <br> <code>Windows: <br> $ cd /cygdrive/project/jni <br> Non-windows: <br> $ cd project/jni <br></code> <br>  <b>Do three!</b>  Run NDK <br> <code>Windows: <br> $ /cygdrive/ndk-path/ndk-build <br> Non-windows: <br> $ ndk-path/ndk-build <br></code> <br><br>  Where project is the path to your project, ndk-path is the path where you unpacked the NDK <br>  The compilation process should start: <br> <code>... <br> Compile++ thumb : android_sqlite &lt;= tmutfmt.cpp <br> Compile++ thumb : android_sqlite &lt;= colldata.cpp <br> Compile++ thumb : android_sqlite &lt;= bmsearch.cpp <br> Compile++ thumb : android_sqlite &lt;= bms.cpp <br> Compile++ thumb : android_sqlite &lt;= currpinf.cpp <br> Compile++ thumb : android_sqlite &lt;= uspoof.cpp <br> Compile++ thumb : android_sqlite &lt;= uspoof_impl.cpp <br> ... <br></code> <br>  If not started, I feel sorry for O_o <br><br>  At the output, we should get the compiled library, along the path project / libs / armeabi / libandroid_sqlite.so <br><br>  Now we need to connect the library to the project. <br>  First, in the main Activity we must describe its connection. <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TabActivity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> { System.loadLibrary(<span class="hljs-string"><span class="hljs-string">"android_sqlite"</span></span>); } ... }</code> </pre> <br><br>  Further, we need code that would work with the native library, and it can be downloaded <a href="http://narod.ru/disk/38545807001/biz.zip.html">here [4]</a> <br><br><h4>  How to work? </h4><br>  How, how, they sat down and went! <br>  Open the base <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { dataBase_ = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> biz.sneg.sqlite.SQLiteDatabase(DB_NAME); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Log.wtf(<span class="hljs-string"><span class="hljs-string">"Database"</span></span>, e); }</code> </pre><br><br>  We get data somehow or as you like <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { biz.sneg.sqlite.SQLiteCursor cursor = dataBase_.query(<span class="hljs-string"><span class="hljs-string">"SELECT * FROM tablename WHERE rus_text_field LIKE ?"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Object[]{<span class="hljs-string"><span class="hljs-string">"%"</span></span>}); List&lt;Map&lt;String, String&gt;&gt; results = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;Map&lt;String,String&gt;&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (cursor.next()) { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> columnCount = cursor.count(); HashMap&lt;String, String&gt; currentMap; currentMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap&lt;String, String&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; columnCount; i++) { currentMap.put(cursor.columnName(i), cursor.stringValue(i)); } results.add(currentMap); } cursor.dispose(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { Log.wtf(<span class="hljs-string"><span class="hljs-string">"Database"</span></span>, e); }</code> </pre><br><br>  In general, I wish good luck! <br><br>  Nikolai Kudashov, the author of the idea and assembly, an invite can be sent here drklo.2kb &lt;known_symbol&gt; gmail.com <br><br>  References: <br>  1. <a href="http://habrahabr.ru/blogs/sql/57915/">SQLite and full UNICODE</a> <br>  2. <a href="http://developer.android.com/sdk/ndk/index.html">Android NDK</a> <br>  3. <a href="">Sources for the library</a> <br>  4. <a href="http://narod.ru/disk/38545807001/biz.zip.html">Sources for java</a> <br>  5. <a href="http://www.sqlite.org/">SQLite</a> <br>  6. <a href="http://cygwin.com/">Cygwin</a> <br>  7. <a href="">Compiled library</a> </div><p>Source: <a href="https://habr.com/ru/post/122408/">https://habr.com/ru/post/122408/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122396/index.html">Nokia Play 360 external speaker for Nokia N9</a></li>
<li><a href="../122397/index.html">Formula parser using recursive descent method</a></li>
<li><a href="../122400/index.html">Agile camp of strict regime or impressions of AgileCamp 2011 in Samara</a></li>
<li><a href="../122401/index.html">Quick access to 2D flash array</a></li>
<li><a href="../122404/index.html">Domen.RUS will unite the Russian-speaking population of the planet</a></li>
<li><a href="../122411/index.html">Failover DHCP. Unsuccessful test history</a></li>
<li><a href="../122412/index.html">Cloud services "Cloud hosting". Interviews with service providers</a></li>
<li><a href="../122414/index.html">Personal experience of creating a reference information center based on Kiosk (or terminal) with a touch panel</a></li>
<li><a href="../122416/index.html">In England, arrested a 19-year-old suspect in the LulzSec case</a></li>
<li><a href="../122418/index.html">The world's largest directory of sites Open Directory Project (dmoz) moved to Creative Commons Attribution</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>