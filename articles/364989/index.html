<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Heating a country house on arduino with data transfer to the internet</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to present another example of using Arduino in real tasks. Here I will present the most simple, but really working project of adjusting t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Heating a country house on arduino with data transfer to the internet</h1><div class="post__text post__text-html js-mediator-article">  I would like to present another example of using Arduino in real tasks.  Here I will present the most simple, but really working project of adjusting the heating of the house with the help of electric boiler based on Arduino.  I very much hope that this article will help someone to drop fears and try to independently use their hands for their intended purpose, it is very cool to train hands, brains and gives a rare feeling of satisfaction with creating something interesting.  Having started working with this controller, I am still in some confusion about the possibilities that open up when using it. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/e1d/444/6c7/e1d4446c74641d93d919672c7660fbc0.jpg" alt="image"><br><a name="habracut"></a><br><h2>  Story </h2><br>  Why, actually, Arduino?  Simplicity, accessibility, a lot of documentation and libraries.  Like many, probably, I have been watching the Arduino for a long time, since childhood I have loved all kinds of batteries and motors, and here a new level, a full-fledged programming language and a lot of I / O capabilities.  When our ‚Äúmost likely economic partners‚Äù began to issue it, its prices fell to an acceptable level.  As a result, I bought the start of the whale and, having plenty of LEDs and indicators, had the desire to apply it somewhere around the house. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/497/dcb/9a2/497dcb9a26f0a13b120af5c4305931a5.jpg" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What is heated </h2><br>  My grandmother lives in a village house near Moscow, there is neither normal water supply, nor gas, nor heating, and the solution of all these tasks requires large capital investments or the application of hands.  Here there was a place where you can fully use the arduino, there is where to turn.  The biggest plus of a country house is that it is traditionally not big and very simple.  Similarly, mine, a typical house of a peasant family of the mid-20th century, is a log cabin with one large room and kitchen.  There are no other heated rooms, which is a plus for us, it is enough to maintain and control the temperature in a single room. <br><br><h2>  Heating </h2><br>  Heating equipment.  Traditionally, the house was stove heating.  One ‚ÄúGerman‚Äù stove in the room (heats at the expense of a long winding pipe), the second ‚ÄúRussian‚Äù in the kitchen (heats at the expense of the large size of the firebox itself).  If someone is in the cinema performances, that the furnace is cool and also natural and romantic, then I take the liberty to assume that these people have never lived in a house with stove heating.  In fact, it is not very comfortable, inconvenient and flammable.  Therefore, about 5 years ago, a project on distributing the simplest two-pipe heating with a gas boiler was ordered and carried out.  It was supposed to feed the boiler from gas cylinders. <br><br>  Subsequently, it was decided to upgrade the system, add a pump to force the recirculation of the coolant and a small 2-watt electric boiler, so as not to suffer from gas ignition, when it is not very cold.  All automation was reduced to the presence of a large knife switch on the wall, when it became chilly, it was turned on, and when it was hot it was turned off.  Two kilowatts was enough somewhere up to a temperature of 0 ¬∞ C, then I had to light a gas or a furnace, which was extremely inconvenient. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/ca3/665/5c0/ca36655c07c72df8d8f584c8198a951d.jpg" alt="image"><br><br><h2>  Economic expediency </h2><br>  Before changing anything, it was naturally decided to calculate whether this idea had any sense at all.  Having calculated by experience gas consumption from cylinders, having estimated the expected consumption of diesel fuel, I came to the conclusion that in such types of heating there is no point if there is enough electricity.  For the price, the cylinders came out somewhere 6-7 thousand per month, diesel fuel, if you buy something pale or summer in winter, you can save up to an expense of 5 thousand per month, while on pure electricity it was 7 thousand. Let's add the cost of the boiler, constant hauling cylinders and the smell of salyara, and it becomes clear that electricity is much simpler and no more expensive.  Of course, there are pellet burners that are fashionable lately, but they didn‚Äôt suit me, because they don‚Äôt know how to ignite themselves and therefore have a minimum power, though not small at all (about 5 kW), which 90% of the time simply have nowhere to go, and require at least 2 times a week to fill the fuel, which sometimes there is no one.  And the cost of the boilers themselves is an order of magnitude greater than the previous options, so they are suitable for large houses where large capacity and high costs are needed, and not in my case. <br><br><h2>  Heavy hardware </h2><br>  I tried to estimate the required power based on gas consumption and other estimates, it turned out that 4-5 kW is needed, with a margin of 6. Market review showed that there is a model of electric boiler, similar to the one already installed, but with 3 heating elements of 2 kW each.  Moreover, it was sold without control, which was even more convenient and cheaper for me.  In general, the boiler itself is an extremely simple design, a metal cylinder with inlet and outlet pipes, a bolted lid on top, in which the heating elements are fixed.  In addition, 2 sensors are embedded into the case, a resistive temperature sensor and a sensor that closes when overheated, both from the auto cooling system.  Now there was a question about electricity.  My situation was simplified by the fact that there was a workshop next to the house, to which 3 phases were brought (380 people are).  Naturally, there was a temptation to feed each heating element from its phase, so a specialized 4-wire cable in metal braid for underground installation was purchased and laid into the boiler room.  The cable is inserted into the shield with a series-connected RCD and a block of 3 machines of 10A each.  Then the cable went directly to the shield with the arduino and from there to the electric boat. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/668/80d/ba2/66880dba2152c7bb78b378f4af6eca1a.jpg" alt="image"><br><br><h2>  Light hardware </h2><br>  It is clear that we will manage the heating elements with arduino, the question is how?  Adhering to the principle - the simpler, the more reliable, we will simply turn them on or off with the help of a relay without any transitional options.  Climbing the aliexpress, I found a relay block for Arduino, which can control 5 power lines at once.  One problem, the maximum current that these relays can withstand - 10A, and I get 2kW / 220V ~ 9A.  That is almost the maximum, and it is desirable to have a stock of at least 25%.  However, I decided to take a chance.  Relays honestly lasted almost a week, then just started to melt.  We had to decide something quickly, because it was winter and the heating could not be stopped.  Therefore, 30A relays were bought, but with 12V windings.  Therefore, I quickly soldered each relay through a transistor to turn them on from 5V Arduino. <br><br>  The scheme worked well for almost a month, and then I noticed that it was somehow too hot at home.  The test showed that one relay ‚Äúsunk‚Äù in the on position.  I knocked on it - it worked again, but it lasted for several days.  I changed it in the hope that it was a marriage, but a week later the same thing happened with the 2nd relay.  Putting the last spare, went back to Ali.  Specialized relays for arduino at 40A were found there!  That should be enough for sure, I thought.  A couple of weeks of waiting, and here again I throw out the transistors and put new relays with the ready-made strapping and indication.  The joy was short, after 2-3 weeks the stuck relay was again.  He began to study the issue, it turns out, in order to reduce the load on the relay and remove the arcing of the contacts, the relay must be turned on not at random, but at the moment when the voltage sinusoid passes through 0. Well, in theory this can be done with the help of our own arduino, only on through sharing all three phases and watching the tension.  The problem is that the relay has some response time and, in fact, we still need to install it empirically.  In general, the task is not so simple. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/314/1d3/97c/3141d397c2b5597af8c2e78f0c0588a3.jpg" alt="image"><br><br>  And here I come across the so-called Solid State Relay, in other words, an electrical circuit assembled on a powerful thyristor, in a housing similar to a conventional relay.  From its advantages - there is no mechanics, nothing will stick.  Does not create a powerful EM-interference, which is important for ethernet'a, about which below.  They already contain a circuit that turns the relay on and off when the zero passes.  The relay has a power indicator.  Well, they are also silent, although in our case this is not so true.  After studying the instructions and specifications, SSR-40DA was ordered, which in Russian means solid-state relays with a constant control current of 3-5 V and a load current of up to 40A.  At the same time, I decided to move away from the ‚Äúsimpler-better‚Äù principle a little and make another control of the current in heating elements.  This would let you know about a burned out heating element / relay or a power outage at one of the phases.  I added a current control module for 20A to the order, although they looked so flimsy for such a current (the 2.5 square cable did not even climb into their clamp).  When the relay and current measurement modules arrived, it turned out that the relay was rather bulky, so it was decided to transfer everything related to the high-voltage part to the new box, and leave the arduino in the old one. <br><br>  After the first experiments, it turned out that I had completely forgotten that these relays, since they are assembled on thyristors, are rather hot.  After a day of operation, the relays heated up so that I could not tolerate holding a finger on them, that is, degrees 60C, and this is already close to the critical 80C.  I climbed again on Ali, figuring out which radiators to adapt, and then I learned that there are regular radiators for these SSRs!  At the time of installation, the radiators also found that one current control module itself does not let the current through anymore, and a burnt track is visible on the side of the board.  Another module also did not cause confidence, I decided to remove them all.  In this form, they are still rather weak and dangerous, and there is not much sense from them.  The problem of disconnecting the phases or heating elements has so far been postponed as not very relevant, for 3 years neither the first nor the second has happened more than once. <br><br><h2>  Now about the software </h2><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/dcb/9f4/50f/dcb9f450fab1ca5b2b02288b14052118.jpg" alt="image"><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/4a2/fd0/0d5/4a2fd00d5a9509f199cda62187ba29ec.jpg" alt="image"><br><br><h2>  Arduino </h2><br>  Immediately in the examples was found a piece that allowed to control the average power, having a binary control - on and off.  The meaning is simple, we take a certain window of time, say, 1 minute, and in the cycle we turn on or turn off the load depending on the elapsed time.  That is, if we need 50% of the power, then turn on the load in the first 30 seconds and turn off in the last 30, then the cycle repeats.  Quickly redid it for 3 independent relays, if the power is more than 33%, then I turn on the second relay, if more than 66%, then the third one, and the first one I turn it on and off according to the basic algorithm.  Now the main question arises, and by what algorithm to choose the power?  Being a programmer by profession, I first decided that the problem was rather simple, cold ‚Äî add, warm ‚Äî more than enough, and tried to figure it all out in my mind. <br><br>  It turned out not so easy.  It was useful to watch how they do it in the systems sold, it turned out that everything is as simple as possible, as in an iron - + 1C = off, -1 = on.  But then we get almost 4C vibrations due to the inertia of the system!  This is too rough, for we can get data to the nearest tenth of a degree.  Also I looked at the work algorithms using the outside air temperature, they turned out to be quite simple and worked on ready-made tables that were pre-wired and simply changed depending on the heat loss at home.  Digging deeper and deeper, I got to the industrial plants, they used PID-regulator algorithms everywhere.  And, oh glory of popularity, it turns out, the Arduino has a free PID library! <br><br>  A few words about what PID is for our case.  The meaning of the algorithm is that we inform it of the required value of a certain parameter (temperature inside the house) and in the cycle we transmit the current value, and it gives us the necessary effect (power that must be supplied to the boiler).  Without going into details of the mathematical model, how does it work from the point of view of the programmer.  So, we have the temperature in the room, let it be 20C, the desired temperature is 22C, and we give them to our PID algorithm. <br><br>  The algorithm itself has 3 independent parts, named P, I and D. The first part works extremely simply, it looks at the difference between the desired temperature and the current temperature.  That is, the colder, the more power the algorithm will give us.  It seems that this is enough, but after all, we have constant heat losses at home, that is, in order to keep the desired temperature, we must always be given some kind of power.  That is, even if the temperature in the room is equal to the set one, you cannot turn off the boiler, but you must somehow look for some power equal to the heat loss.  A heat loss varies depending on the temperature outside.  This is what the second part is doing under the name I. The algorithm is trying to choose the power at which our temperature will be constant.  And it seems like this is exactly everything, but no. <br><br>  The fact is that the boiler itself, the heat carrier, and even more so the house have a very large inertness.  And if you cut the boiler by 100%, then you need to reduce the power much earlier than the temperature reaches the desired one; otherwise, even with a complete shutdown, we will still have time to overheat the room by 2 degrees. The same is true when the temperature drops, you need to add power even before as the temperature reached right.  This is exactly what the third part of the D algorithm does. Well, now, of course, everything, it remains only to understand which part to give what weight, but the multipliers of each part are involved, which must be selected.  By the way, the selection of these factors is a separate and rather complex mathematical task; I selected them ‚Äúby eye‚Äù, recalling what was said above.  At first he put all the zeros except P, and picked it up so that the excitation itself did not start.  Then I added, and at the end, D. <br><br><h2>  Measure temperature </h2><br>  To measure the temperature, digital temperature sensors based on DS18B20 were ordered on the same magic site.  The sensor itself is just wonderful, it does not need to either calibrate or somehow tune it, while it can measure the temperature with a given accuracy, and communicates with the Arduino using the OneWier protocol.  That is, you can hang an almost unlimited number of sensors on 3 wires up to 50 meters long.  If desired, they can not even feed, and work only on the 2nd wire (in fact, they are powered, but from the wire with the signal), but they work slower.  In my case, I ordered the sensors in a sealed enclosure, and I connected them with a normal twisted pair.  I put 3 sensors, one in the boiler room, one in the house, in the room, and one in the attic under the ceiling, the attic is not heated at all and there I get the temperature outside. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/120/f0c/b60/120f0cb607bfbcdeed28a27e23117b8e.jpg" alt="image"><br><br><h2>  Iron Purchased List </h2><br>  - Fee arduino.  I used UNO r3.  Price about 350 p. <br>  - Ethernet Shield, about 500 p. <br>  - Twisted pair (depending on how much is needed), the bay at 305m will cost about 4 thousand. <br>  - Temperature sensors, about 200 r. <br>  - Power supply for 110-240 - 12V 2A, 420 p. <br>  - LM7805 stabilizer, somewhere around 20 p. <br>  - Relay SSR-40DA 3 pcs.  330 p. <br>  - Radiators for relays of 200 p. <br><br>  That is, apart from the twisted pair and the boiler itself, the whole project fits into 4 thousand rubles. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/183/cac/251/183cac251ac34884edccf20e5b07c912.jpg" alt="image"><br><br>  We add the data in the database and show. <br><br>  But all this, of course, is good, but not to stand constantly with the computer next to the boiler, still I would like to know about what is happening at home, remotely via the Internet.  I have long had the most unpretentious VPS server from majordomo for anything.  He created a database on MySQL to store temperature data. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/472/6de/294/4726de294537212ef0025d396a207c6d.jpg" alt="image"><br><br>  Now we need to somehow put the data from the arduino into this database.  For this, of course, you will need at least to connect the arduino with the Internet, it is not easy, but very simple.  For this we need the Ethernet Shield and its library.  An unpretentious router with a ‚Äúwhistle‚Äù, first from megafon, and then from yota, has long been installed in the house.  We pull the standard twisted pair to the router and add data transfer to the program.  The transfer goes through a page call in PHP with parameters - data.  Create a page called temp.php on our Internet server <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dbhost = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; $dbuser = <span class="hljs-string"><span class="hljs-string">'***'</span></span>; $dbpass = <span class="hljs-string"><span class="hljs-string">'***'</span></span>; $dbname = <span class="hljs-string"><span class="hljs-string">'nikolaarduino'</span></span>; $client_ip = $_SERVER[<span class="hljs-string"><span class="hljs-string">'REMOTE_ADDR'</span></span>]; $temp1 = $_GET[<span class="hljs-string"><span class="hljs-string">"t1"</span></span>]; $temp2 = $_GET[<span class="hljs-string"><span class="hljs-string">"t2"</span></span>]; $temp3 = $_GET[<span class="hljs-string"><span class="hljs-string">"t3"</span></span>]; $power = $_GET[<span class="hljs-string"><span class="hljs-string">"p"</span></span>]; $connect = mysql_connect($dbhost, $dbuser, $dbpass); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(! $connect ) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Could not connect: '</span></span> . mysql_error()); } mysql_select_db ($dbname, $connect); $sql = <span class="hljs-string"><span class="hljs-string">"INSERT INTO Temp (datetime, temp1, temp2, temp3, power, ip) VALUES (Now(), '$temp1', '$temp2', '$temp3', '$power', '$client_ip')"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!mysql_query($sql)) {<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;b&gt;Data upload error!&lt;/b&gt;&lt;/p&gt;'</span></span>;} <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> {<span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;p&gt;&lt;b&gt;OK&lt;/b&gt;&lt;/p&gt;'</span></span>;} mysql_close($connect); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre> <br>  After that, we have data on the temperature and power of the boiler, in order not to climb into the database each time, but to see the latest data, wrote a ‚Äútemporary‚Äù script for php, but as you know, there is nothing more permanent than temporary things, so they I use. <br>  gettemp.php <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> $dbhost = <span class="hljs-string"><span class="hljs-string">'localhost'</span></span>; $dbuser = <span class="hljs-string"><span class="hljs-string">'***'</span></span>; $dbpass = <span class="hljs-string"><span class="hljs-string">'***'</span></span>; $dbname = <span class="hljs-string"><span class="hljs-string">'nikolaarduino'</span></span>; $client_ip = $_SERVER[<span class="hljs-string"><span class="hljs-string">'REMOTE_ADDR'</span></span>]; $connect = mysql_connect($dbhost, $dbuser, $dbpass); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(! $connect ) { <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Could not connect: '</span></span> . mysql_error()); } mysql_select_db ($dbname, $connect); $query = <span class="hljs-string"><span class="hljs-string">'SELECT * FROM Temp WHERE id=(SELECT MAX(ID) FROM Temp)'</span></span>; $result = mysql_query($query) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-keyword"><span class="hljs-keyword">die</span></span>(<span class="hljs-string"><span class="hljs-string">'Error get data: '</span></span> . mysql_error()); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;table style='text-align: left; width: 100%;' border='1' cellpadding='2' cellspacing='2'&gt;\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ($line = mysql_fetch_array($result, MYSQL_NUM)) { <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;tr align='center'&gt;&lt;td colspan='2' rowspan='1'&gt;$line[1]&lt;/td&gt;&lt;/tr&gt;"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;tr align='center'&gt;&lt;td&gt;TempIN = $line[2]&lt;/td&gt;&lt;td&gt; TempOUT = $line[3]&lt;/td&gt;&lt;/tr&gt;\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;tr align='center'&gt;&lt;td colspan='2' rowspan='1'&gt;TempKotel = $line[4]&lt;/td&gt;&lt;/tr&gt;\n"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;tr align='center'&gt;&lt;td colspan='2' rowspan='1'&gt;Power = $line[5]&lt;/td&gt;&lt;/tr&gt;\n"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;/table&gt;\n"</span></span>; mysql_free_result($result); mysql_close($connect); <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br><img src="https://habrastorage.org/getpro/geektimes/post_images/f7f/d09/330/f7fd09330a32e4dd6ce4e13f7af29396.jpg" alt="image"><br><br><h2>  What would you like to add in the future </h2><br>  Of course, this is, in principle, a minimum, which, however, allows you to make a full-fledged and quite convenient control of heating in a small house.  Although with some alterations it can be used in multi-room and in general buildings of any complexity, arduino can do a lot, if not everything.  In this project I would like to add in the future: <br><br><ul><li>  Temperature regulator.  Although practice has shown that 22.5 is quite an optimal value and, in principle, does not require adjustment.  Again, I would like to make a regulator remotely from the main arduino, but for this you need either a complex scheme or another arduino.  In general, there is something to think about. </li><li>  I would like the opportunity not only to read the temperature, but also to change the PID parameters on the fly.  It is possible to make a separate ‚Äúinitial warm-up‚Äù mode, otherwise parameter I will be normalized for a long time after each restart of the program. </li><li>  I want a simple application for android, so that the phone does not poke into a small browser.  This is the simplest and already in the process. </li><li>  Still, connect the coolant temperature sensor and transmit its data, like other temperature data. </li><li>  Emergency alarm.  That is, automatically determine the voltage loss on the lines, the failure of the relay or heating elements. </li><li>  Make a ‚Äúcarousel‚Äù, change the destination of heating elements.  Otherwise, it turns out that one heating element always works more than others, and it should in theory be refused first.  You just need to change the PINs in the program from time to time.  It seems simple, but it does not reach the hands to add. </li></ul><br>  Text programs for Arduino: <br><br><pre> <code class="hljs lua">#include &lt;OneWire.h&gt; #include &lt;DallasTemperature.h&gt; #include &lt;PID_v1.h&gt; #include &lt;DHT.h&gt; #include &lt;Ethernet.h&gt; #include &lt;SPI.h&gt; // OneWire DS18S20, DS18B20, DS1822 Temperature Example // // http://www.pjrc.com/teensy/td_libs_OneWire.html // // The DallasTemperature library can <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> all this work <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> you! // http://milesburton.com/Dallas_Temperature_Control_Library OneWire ds(<span class="hljs-number"><span class="hljs-number">6</span></span>); // on pin <span class="hljs-number"><span class="hljs-number">10</span></span> (a <span class="hljs-number"><span class="hljs-number">4.7</span></span>K resistor is necessary) DallasTemperature sensors(&amp;ds); boolean waithTemp = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; int TEMPERATURE_PRECISION = <span class="hljs-number"><span class="hljs-number">10</span></span>; int lamp1 = <span class="hljs-number"><span class="hljs-number">7</span></span>; int lamp2 = <span class="hljs-number"><span class="hljs-number">8</span></span>; int lamp3 = <span class="hljs-number"><span class="hljs-number">9</span></span>; DeviceAddress IntThermometer = { <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0x8E</span></span>, <span class="hljs-number"><span class="hljs-number">0xF4</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x07</span></span> }; DeviceAddress OutThermometer = { <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0x15</span></span>, <span class="hljs-number"><span class="hljs-number">0x32</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0xE2</span></span> }; DeviceAddress KatThermometer = { <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0x61</span></span>, <span class="hljs-number"><span class="hljs-number">0x43</span></span>, <span class="hljs-number"><span class="hljs-number">0x28</span></span>, <span class="hljs-number"><span class="hljs-number">0x05</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x00</span></span>, <span class="hljs-number"><span class="hljs-number">0x14</span></span> }; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> addr[<span class="hljs-number"><span class="hljs-number">8</span></span>]; unsigned long StartTime = <span class="hljs-number"><span class="hljs-number">0</span></span>; unsigned long WorkWindow = <span class="hljs-number"><span class="hljs-number">60000</span></span>; // <span class="hljs-number"><span class="hljs-number">10</span></span><span class="hljs-built_in"><span class="hljs-built_in">min</span></span> unsigned long WorkTime, TenTime; float maxData = <span class="hljs-number"><span class="hljs-number">100</span></span>; float celsius, temp; double Setpoint, Input, Output; int ThermometerCount; DeviceAddress Thermometer[<span class="hljs-number"><span class="hljs-number">100</span></span>]; PID myPID(&amp;Input, &amp;Output, &amp;Setpoint, <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">0.1</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, DIRECT); //<span class="hljs-number"><span class="hljs-number">0.000006</span></span> <span class="hljs-number"><span class="hljs-number">0.03</span></span> <span class="hljs-number"><span class="hljs-number">40</span></span> double targetTemp = <span class="hljs-number"><span class="hljs-number">22.5</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> mac[] = { <span class="hljs-number"><span class="hljs-number">0xE0</span></span>, <span class="hljs-number"><span class="hljs-number">0x69</span></span>, <span class="hljs-number"><span class="hljs-number">0x95</span></span>, <span class="hljs-number"><span class="hljs-number">0x72</span></span>, <span class="hljs-number"><span class="hljs-number">0x65</span></span>, <span class="hljs-number"><span class="hljs-number">0xE8</span></span> }; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> ip[] = { <span class="hljs-number"><span class="hljs-number">192</span></span>, <span class="hljs-number"><span class="hljs-number">168</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span> }; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> server[] = { ?, ?, ?, ? }; EthernetClient client; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> webskipcount = <span class="hljs-number"><span class="hljs-number">10</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> webcount = <span class="hljs-number"><span class="hljs-number">0</span></span>; void setup(void) { Serial.begin(<span class="hljs-number"><span class="hljs-number">9600</span></span>); //Ethernet.begin(mac, ip); Ethernet.begin(mac); sensors.begin(); pinMode(lamp1, OUTPUT); pinMode(lamp2, OUTPUT); pinMode(lamp3, OUTPUT); Setpoint = targetTemp; myPID.SetOutputLimits(<span class="hljs-number"><span class="hljs-number">0</span></span>, maxData); myPID.SetMode(AUTOMATIC); celsius = targetTemp; StartTime = millis(); } long filter(long x, long Nb, long k) { static long y = <span class="hljs-number"><span class="hljs-number">0</span></span>, z = <span class="hljs-number"><span class="hljs-number">0</span></span>; z += (x - y); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> y = (Nb * z) &gt;&gt; k; }; void loop(void) { <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> i; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> type_s; <span class="hljs-built_in"><span class="hljs-built_in">byte</span></span> data[<span class="hljs-number"><span class="hljs-number">12</span></span>]; long Out; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (millis() &lt; StartTime) { StartTime = millis(); } WorkTime = millis() - StartTime; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WorkTime &gt; WorkWindow) { WorkTime = WorkTime - WorkWindow; StartTime = millis() + WorkTime; } //Serial.println(<span class="hljs-string"><span class="hljs-string">"cycle"</span></span>); sensors.requestTemperatures(); celsius = sensors.getTempC(IntThermometer); Input = celsius; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (webcount &gt;= webskipcount) { <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> buffer[<span class="hljs-number"><span class="hljs-number">10</span></span>]; String temperatureS1 = dtostrf(celsius, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, buffer); String temperatureS2 = dtostrf(sensors.getTempC(OutThermometer), <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, buffer); String temperatureS3 = dtostrf(sensors.getTempC(KatThermometer), <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, buffer); String OutputPowerS = dtostrf(Output, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, buffer); String msg = <span class="hljs-string"><span class="hljs-string">"GET /temp.php?t1="</span></span>+ temperatureS1 + <span class="hljs-string"><span class="hljs-string">"&amp;t2="</span></span> + temperatureS2 + <span class="hljs-string"><span class="hljs-string">"&amp;t3="</span></span> + temperatureS3 + <span class="hljs-string"><span class="hljs-string">"&amp;p="</span></span>+OutputPowerS; Serial.println(msg); client.connect(server, <span class="hljs-number"><span class="hljs-number">80</span></span>); client.println(msg); client.stop(); webcount = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { webcount += <span class="hljs-number"><span class="hljs-number">1</span></span>; } myPID.Compute(); //Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Input);Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>);Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Output);Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>);Serial.println(Setpoint); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Output &gt; maxData/<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>) { digitalWrite(lamp1, HIGH); digitalWrite(lamp2, HIGH); Out = Output - maxData/<span class="hljs-number"><span class="hljs-number">3</span></span>*<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Output &gt; maxData/<span class="hljs-number"><span class="hljs-number">3</span></span>) { digitalWrite(lamp1, HIGH); digitalWrite(lamp2, LOW); Out = Output - maxData/<span class="hljs-number"><span class="hljs-number">3</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { digitalWrite(lamp1, LOW); digitalWrite(lamp2, LOW); Out = Output; } TenTime = map(Out, <span class="hljs-number"><span class="hljs-number">0</span></span>, maxData/<span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, WorkWindow); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(celsius); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(sensors.getTempC(OutThermometer)); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(sensors.getTempC(KatThermometer)); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(Output); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(TenTime); Serial.<span class="hljs-built_in"><span class="hljs-built_in">print</span></span>(<span class="hljs-string"><span class="hljs-string">" "</span></span>); Serial.println(WorkTime); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WorkTime &lt; TenTime) { digitalWrite(lamp3, HIGH); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (WorkTime &gt; TenTime) { digitalWrite(lamp3, LOW); } }</code> </pre></div><p>Source: <a href="https://habr.com/ru/post/364989/">https://habr.com/ru/post/364989/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../364977/index.html">2014 has become a record warm</a></li>
<li><a href="../364979/index.html">War of drones: the rules of battle</a></li>
<li><a href="../364983/index.html">Personal copy of the torrent site with a search on your computer</a></li>
<li><a href="../364985/index.html">Google is planning to work with SpaceX</a></li>
<li><a href="../364987/index.html">Unlikely events and life</a></li>
<li><a href="../364991/index.html">TechCrunch has posted a review of Yotaphone 2</a></li>
<li><a href="../364993/index.html">Ubuntu moves to new platforms</a></li>
<li><a href="../364995/index.html">4 months with Moto 360</a></li>
<li><a href="../364997/index.html">How many users actually have Google+</a></li>
<li><a href="../364999/index.html">Multikopter with a cargo of drugs fell on the border of the United States and Mexico</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>