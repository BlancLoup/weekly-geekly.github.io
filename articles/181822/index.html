<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>10Gbit network storage at reasonable cost</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The task was the following - to upgrade the storage system for the photographer. Rather, photographers. 
 There was network storage on the basis of Wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>10Gbit network storage at reasonable cost</h1><div class="post__text post__text-html js-mediator-article">  The task was the following - to upgrade the storage system for the photographer.  Rather, photographers. <br>  There was network storage on the basis of Windows Server 2008 (it happened historically), Adaptec 3405 RAID controller and 4x 1.5Tb disks connected to it.  For communication with the outside world, the HP NC360T 2-port gigabit server network card was used. <br><br>  Problems of the existing system: <br>  - access speed to network resources "rested" in the performance of gigabit Ethernet interfaces, <br>  - the place on the RAID array ended. <br><br>  Wishes: <br>  - quick network access to photo and video files located on the disk array, <br>  - increase the available volume of the disk array by 2-3 times. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The idea of ‚Äã‚Äãcombining gigabit interfaces into a trunk was tried and dropped as inoperative.  Later communication with HP support and reading the standards once again confirmed that even the presence of multi-port server network cards and a managed switch with LACP support do not allow the existing system to balance the load across multiple links in connection 1 server - 1 client. <br><br>  The idea to make storage based on low-cost Infiniband cards was also not very inspiring - it was precisely network storage with access to files from several computers.  Let not everyone at a particularly high speed (for some, a gigabit interface is suitable, for some multi-stream WiFi type n, and there, you see, and ac will start to put laptops in laptops). <br><br>  There is, in fact, one option - 10G Ethernet.  Which has one trouble - the price. <br>  Take, for example, HP NC523SFP (nee Qlogic) and get a price of about $ 1000 for 1 card. <br>  We add about the same to the transceiver and get ... Economically absurd price for this task we get. <br><br>  The issue price played a significant role.  The task was not to ‚Äúmake it cool for 3 kopecks,‚Äù but the branded corporate solutions with which I had to deal with for the last ... years, did not go through the budget either. <br>  And I had to turn my eyes on ebay. <br>  There were picked up <br>  - two 10G cards from Myricom 10G-PCIE2-8B2-2S at the price of $ 200 per piece, <br>  - two 10G SFP transceivers of an unknown Chinese manufacturer for $ 60 apiece, <br>  - Adaptec 7805 RAID Controller with SATA / SAS cables for $ 400. <br><br>  Probably, the network cards and the controller could be taken simpler - cheaper, if you wait - pick up.  But there was an opportunity from the States ... <br>  Everything, except transceivers, arrived quickly, and transceivers went from China.  Slowly drove.  But still, the Russian mail took them :-) <br><br>  Considering that more than two workstations with a fast connection channel are not planned even in the future, we did without a 10G switch.  While the transceivers were traveling, an attempt was made to connect machines with Myricom direct attach twinax cards with a Cisco cable with a length of 7 meters.  The system did not start.  Cards "raised" the interface and then it was "lowered".  The support service from Myricom requested a bunch of diagnostics from the cards (good, the cards have such an opportunity), gave a lot of advice like ‚Äútry this, and then syak‚Äù, but at the end summed up ‚Äúchange the cable‚Äù. <br>  Another twinax cable was not at hand, so I had to wait for the transceivers. <br>  They were successfully received, put into cards, and connected by a 10 meter long LC-LC patch cord (purchased at a nearby shop for 700r).  Link "rose" instantly. <br><br>  On tests through the microsoft NTttcp it turned out 9.5 - 9.6 gigit.  When enabled on AIM cards (Adaptive Interrupt Moderation) with a default interrupt delay of 25 microseconds.  This, according to those support, in some cases, unnecessarily loads the CPU, but gives less latency. <br>  With AIM turned off, test performance dropped by 30%.  Perhaps this test is not an indicator for real download, but so far left with AIM.  Fortunately, there is plenty of processor power for this task (Intel i7 3770). <br>  This test showed that at least obvious nonsense is not done, the cards work at full speed. <br><br>  The disk array was compiled on 5 WD Red 3TB disks.  In RAID5.  The proposed RAID6 was not accepted on the basis of ‚Äúeverything is still copied to the cloud‚Äù.  Indeed, the server is configured with a program from CrashPlan, and after a 20 megabit channel, everything briskly goes to the data center somewhere in Atlanta.  We tried to recover the data (somehow the old version of the file was needed).  Recovers quite cheerfully. <br><br>  Going disk array day.  and another few hours there were copied data from the old array.  During the build-test array could begin to use, but the performance was not interesting. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/3f6/c5f/4e3/3f6c5f4e3e3add6f31f98ed7ea6ae9a6.jpg" alt="image"><br><br>  After assembling and copying data, testing began.  To begin with synthetic tests. <br>  ATTO benchmark that during direct launch on the server, that when working with the client showed something strange. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b02/0e1/e61/b020e1e61838aee1f5b09ba0e6ca8cde.jpg" alt="image"><br>  Test from the server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c47/c19/301/c47c19301bab381adde7228b98b04ae7.jpg" alt="image"><br>  Test from the client machine <br><br>  Rather, it measures the speed of access to the controller cache in the case of a local connection.  And in the case of a network connection, it is generally not clear what. <br>  In this case, the network interface is loaded at 100%. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1a/604/8aa/a1a6048aad746118fc7214a6c7a4f898.jpg" alt="image"><br><br>  HD Tune Pro also showed something strange.  Remembering that, at best, from single disks of this series can be obtained in the region of 150 megabytes per second for reading and writing large files, it seems that we are again measuring the controller cache. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d87/253/8d9/d872538d976c79fafbedda711b26ba79.jpg" alt="image"><br><br>  More interesting was the real work with images. <br>  Feels like the speed of viewing photos from Lightroom has increased 4 times. <br>  When opening and saving large panoramas in Photoshop (tiff without compression with a non-glued 3.5-GB layer-by-layer panorama), the system ‚Äúrested‚Äù on the performance of Photoshop on the client machine.  The file of the second 4 was opened, 10 seconds were recorded. Most of these 10 seconds, Photoshop ‚Äúthought about his own‚Äù without giving out any network activity. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/30a/a93/d5f/30aa93d5f7d9ba64d0d9685f9c1b1d77.jpg" alt="image"><br>  The first group of peaks is the reading of a picture, the last group with the interface loading almost up to 100% is the recording of a picture. <br><br>  Feels like everything has become faster at times.  Yes, and 12TB of disk space is enough for a while :-) <br><br>  I do not consider myself to be an expert in high performance computing, and I will be happy with comments - wishes about this system. <br>  <a href="http://habrahabr.ru/post/189370/">Continuation of a story.</a> <br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/181822/">https://habr.com/ru/post/181822/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../181808/index.html">The famous "cemetery of video games" are going to dig</a></li>
<li><a href="../181810/index.html">Yahoo !, Microsoft, Google, Facebook and Twitter refused to voluntarily track their users.</a></li>
<li><a href="../181812/index.html">The new game system in Human Asteroids was tested by the founder of Atari (video)</a></li>
<li><a href="../181816/index.html">The digest of news from the world of mobile development for the last week # 14 (May 27 - June 2, 2013)</a></li>
<li><a href="../181820/index.html">The basics of layout for native Android applications</a></li>
<li><a href="../181824/index.html">[Translation] BADLAND - game on cocos2d-iphone</a></li>
<li><a href="../181828/index.html">NOMAD: Optimizing Black Boxes at Home</a></li>
<li><a href="../181830/index.html">Introduction to GTD</a></li>
<li><a href="../181832/index.html">Kohana 3.2: multi-lingual organization</a></li>
<li><a href="../181834/index.html">LabVIEW and heart rate variability (+ sources)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>