<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of using Custom Destination in FreePBX</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! 

 The purpose of this post is to use an example to show how to create custom contexts created by the user in FreePBX using Custom Destinatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of using Custom Destination in FreePBX</h1><div class="post__text post__text-html js-mediator-article"> Hi Habr! <br><br>  The purpose of this post is to use an example to show how to create custom contexts created by the user in FreePBX using Custom Destination (usually in the /etc/asterisk/extensions_custom.conf file). <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Often, the standard functions of FreePBX is enough to satisfy the needs of customers.  But sometimes there are very specific requests for which you have to write different custom context.  And everything seems to be fine, until the problem arises of sending calls to these contexts via the FreePBX admin panel.  This is where the Custom Destination feature comes in! <br><br>  For example: <br><br>  <b>Given:</b> <br>  Suppose our customer has 2 stores in the city.  In one of them there is a server with AsteriskNow on board, which handles calls for both stores.  The customer bought from sip provider a beautiful number for 8 channels of the form 560560. <br><br>  In the city of 4 districts: <br>  <u>Plyushkino</u> - phone numbers start at 33 <br>  <u>Cheryomushka</u> - phone numbers start at <b>45</b> <br>  <u>Moths</u> - phone numbers start at 77 <br>  <u>Beavers</u> - phone numbers start at <b>31</b> <br><br>  Geographically, they are located as in the figure. <br><img src="https://habrastorage.org/storage2/df3/f88/d10/df3f88d10ec1cd70b9c0b7d437770067.jpeg"><br><br>  One store is located in the area of <u>Plyushkino</u> , where the number of the ring-group of sellers will be 600. <br>  Another store in the area <u>Cheryomushka</u> , where the number of the ring-group of sellers will be 601. <br><br>  <b>Task</b> <br>  We need that all incoming calls from potential buyers be processed by the store, which is closer to them geographically.  For example, if the call came from the number 312323, it means that the caller is in the <u>Beavers</u> area, respectively, the nearest store is in the <u>Cheryomushka</u> area, i.e.  The call should be directed to the number of the ring group of sellers 601. <br><br>  Those.  Depending on the first 2 digits of the buyer's Caller-ID, we must direct the call to the ring group we need. <br><br>  <b>Decision</b> <br>  To do this, we add to the /etc/asterisk/extensions_custom.conf file a new context with the name check-tel-location-mag, of the following form: <br> <code>[check-tel-location-mag] <br> exten =&gt; s,1,Set(telnum=${CALLERID(num)}) <br> exten =&gt; s,n,GotoIf($[ $["${telnum:0:2}" = "33"] | $["${telnum:0:2}" = "77"] ]?pluwki) <br> exten =&gt; s,n,GotoIf($[ $["${telnum:0:2}" = "31"] | $["${telnum:0:2}" = "45"] ]?ceremuska) <br> exten =&gt; s,n(pluwki),Goto(ext-group,600,1) <br> exten =&gt; s,n(ceremuska),Goto(ext-group,601,1) <br></code> <br><br>  Now we can register the context we created in FreePBX. <br>  For this you need: <br>  1. Enter the admin panel FreePBX -&gt; Tools -&gt; Custom Destination <br>  enter the context in the Custom Destination field - check-tel-location-mag, s, 1 <br>  fill in the remaining fields as convenient: <br><img src="https://habrastorage.org/storage2/fae/2b1/8e8/fae2b18e81d0d2b22902fa01728e471d.png"><br><br>  2. Click Submit Changes <br><br>  Now you can create an incoming route to the number 560560, in which you can select the Custom Custom Destination created earlier: <br><img src="https://habrastorage.org/storage2/d4b/670/335/d4b670335314fc8980f9bcbd2603e11f.png"><br><br>  As a result, the customer is satisfied, he received the required functionality, and we learned how to create Custom Destination. <br><br>  References: <br>  <a href="http://www.pbxinaflash.com/community/index.php%3Fthreads/freepbx-extension-registry-how-to.3164/">FreePBX Extension Registry HOW-TO</a> </div><p>Source: <a href="https://habr.com/ru/post/142895/">https://habr.com/ru/post/142895/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../142887/index.html">TUTS + also launched their hub</a></li>
<li><a href="../142888/index.html">The insides of jQuery. Search for event code</a></li>
<li><a href="../142890/index.html">Prototype data model</a></li>
<li><a href="../142892/index.html">Live Broadcast ALM Summit 2012</a></li>
<li><a href="../142893/index.html">New navigator on code examples Microsoft All-In-One Code Framework, MSDN, Windows 8 and much more</a></li>
<li><a href="../142897/index.html">The impossible is possible. Stateful behavior in a stateless application!</a></li>
<li><a href="../142900/index.html">APRX client in amateur radio APRS based on D-Link Dir-620</a></li>
<li><a href="../142901/index.html">Tried to type Zerg Rush in Google?</a></li>
<li><a href="../142902/index.html">The Chinese government again defended its: Google Drive is blocked in China</a></li>
<li><a href="../142903/index.html">New github charts to your attention</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>