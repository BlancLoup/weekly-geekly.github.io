<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Check Point API + Splunk. Automation of protection against network attacks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello colleagues, today we will tell and demonstrate the approaches and mechanisms for automating the system of protection against network attacks bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Check Point API + Splunk. Automation of protection against network attacks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/webt/w7/f2/sj/w7f2sj3slu-oy6yjkhrb5m5bkpy.png" alt="image"><br><br>  Hello colleagues, today we will tell and demonstrate the approaches and mechanisms for automating the system of protection against network attacks based on Check Point and Splunk. <br><br>  The constant increase in the number of network attacks and their complexity, increase the requirements for security systems.  Organizations must quickly adapt to current conditions and effectively defend themselves against modern attacks.  Requirements for the effectiveness and performance of protection systems are also increasing.  With the release of the new version of Gaia R80, the possibility of using the REST API was announced, which opens up broad possibilities for automating settings, administration, monitoring, etc. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Check Point API </h3><br>  R80.10 created a command line interface and REST API that provide new ways to manage a Check Point server through an automation server. For administrators with experience, new APIs offer better performance and convenience of day-to-day management. <br><br>  The automation server communicates with the management server (CPM) in the same way that SmartConsole does. <br><br><img src="https://habrastorage.org/webt/ul/n1/an/uln1anespo7ruts7ndjwl4ckxps.png" alt="image"><br><br>  This <b>architecture</b> provides: <br><br><ol><li>  The scan and warning errors that SmartConsole demonstrates will also be presented when using the API. </li><li>  Audit logs created using SmartConsole will also be generated using an automation session. </li><li>  The same user permission profile when using SmartConsole will also be used when using an automation session. </li></ol><br>  When you call the API using the REST API or the command line, a new session is created, several active sessions are allowed for the same administrator, since an individual token is issued for each session.  When a script publishes changes, only its own changes are published, and not changes caused by other scripts that run simultaneously. <br><br>  When managing the Management server through an API, you must adhere to the following <b>plan</b> : <br>  you must first log in to the server, make changes, publish these changes, set a policy, and end the session. <br><br><img src="https://habrastorage.org/webt/b7/mm/jn/b7mmjn1g6jmd8evpdtzbqg0cl_u.png" alt="image"><br><br>  Using Check Point API you can manage: <br><br><ul><li>  User sessions on the SmartConsole; </li><li>  Objects, access list; </li><li>  Services and applications (their categorization); </li><li>  Access control &amp; NAT, Threat Prevention; </li><li>  Enable / Disable Blades; </li><li>  Network interface settings; </li><li>  Search for objects; </li><li>  Running teams on GAIA; </li><li>  And much more. </li></ul><br>  Using the API, you can automate workflows and ensure that security systems work consistently with IT processes and systems. <br><br>  More information about the features of Check Point API can be found in our <a href="https://habr.com/company/tssolution/blog/339924/">article</a> . <br><br><h3>  Check Point API + Splunk </h3><br>  Our organization has developed Check Point co Splunk integration. <br><br>  Check Point has <b>IPS</b> functionality (Intrusion Prevention System - Intrusion Prevention System).  Using various mechanisms and technologies, the IPS module analyzes traffic, identifies and blocks network attacks and potential vulnerabilities.  All signatures have different levels of criticality (critical, high, medium, low). In accordance with the Threat Prevention security policy, the IPS module can detect and block attacks and anomalies in the network. <br><br>  This functionality is demanding of computational resources, and in the case of real network attacks, when a powerful network attack is coming from several addresses, the device can be very loaded, giving a drawdown in the operation of legitimate services. <br><br>  Also in many organizations we can see a large number of rules from <b>DETECT</b> reactions, that is, the system only registers the fact of a successful attack, waiting for a person to react.  Often this method leads to losses and losses.  In turn, in such a situation, the attacker may learn potentially important information for subsequent malicious activity.  We do not block the attack, but only write to the event log of its existence.  It is extremely important to avoid this situation. <br><br>  At the time of a serious attack, it is necessary to automatically block the addresses of attack sources at the firewall level and make changes to the IPS policy, that is, change the system's response to the signature from DETECT in <b>PREVENT</b> to block attempts from other IPs. <br><br>  In our organization, a system was developed that blocks the ip addresses of the attackers and the repeated attempts to attack on a specific signature based on the IPS logs that come to Splunk. <br><br>  The system consists of <b>three main components</b> : <br><br><ol><li>  Checkpoint Point GAIA R80 or higher. </li><li>  Splunk. </li><li>  API and script that allows you to make changes to the security policy. </li></ol><br>  For <b>preliminary preparation</b> for the operation of the system it is necessary to take three steps: <br><br><ol><li>  Configure sending logs with CP in Splunk. </li><li>  Create Network Groups objects in CP: BlackList, WhiteList, GreyList. </li><li>  Create a firewall rule for Drop BlackList. </li></ol><br>  The Blacklist group is designed to block IP addresses at the firewall level, in WhiteList we add ip addresses that do not need to be blocked; in GreyList, when a signature is triggered, those ip addresses are added to the database on the security gateway, but do not belong to any of the groups that is, it is a buffer group, and is created for the administrator to choose the action for the hosts: added to BlackList or WhiteList. <br><br>  <b>Scheme of the system</b> : <br><br><ol><li>  Gateway detects the attack and sends the IPS signature log to Splunk. </li><li>  Splunk processes IPS logs, determines the attacker's address, signature, time, and provides the result as input parameters. </li><li>  Next, the system checks for the address in WhiteList or GreyList. </li><li>  If there is no match on the previous item, the address is placed in the BlackList and subsequently blocked at the firewall level, without entering the Threat Prevention field, as a result of which the risk of a successful attack is reduced, and we also keep the device's performance.  IPS resources for this and similar attacks are no longer wasted.  Also, the signature on which the attack is launched is placed from Detect to Prevent for the subsequent blocking of events by this signature </li></ol><br>  During the three months of operation of this system, more than 500 attacks were detected, and as a result, more than 300 ip addresses of the attackers were blocked.  In more detail you can study the results in the charts: <br><br><img src="https://habrastorage.org/webt/d2/um/sb/d2umsb6_dfghx5npmw9yxv8nmuw.png" alt="image"><br><br><img src="https://habrastorage.org/webt/qh/sn/48/qhsn48j7nlrtjjfpjnlnthyyjc8.png" alt="image"><br><br><img src="https://habrastorage.org/webt/z6/jc/eb/z6jcebvepvymngdtrzsmcodv__i.png" alt="image"><br><br>  Also, the IPS signatures were identified and placed in Prevent, which were most active: <br><br><img src="https://habrastorage.org/webt/wp/ld/kr/wpldkrguzksjh0gmjtxlsmvu9ec.png" alt="image"><br><br>  As you can see, the greatest number of attacks are: <br><br><ol><li>  Searches for vulnerabilities and injections on the server. </li><li>  DDos. </li><li>  Search backdoors. </li><li>  Attempts to remotely execute code. </li><li>  Attempts to use vulnerabilities for products of any specific companies (DLink). </li></ol><br>  The time of adding the attacker's ip address to the Check Point database and blocking it at the firewall level is about 4-6 minutes from the attack time.  The speed of this system depends on how you set up the frequency of transmission of logs in Splunk, and the installation time of the policy on the security gateway.  You can use Splunk not only to implement this system, but also to analyze logs in a more convenient way than it is done in the SmartEvent blade, having tweaked the system for your tasks.  For more details, see the <a href="https://habr.com/company/tssolution/blog/325170/">article</a> about the integration of Splunk and Checkpoint. <br><br>  As for the script settings, everything can be customized to your specific requirements, for example, blocking ip addresses for a while, or managing other blades, it all depends on your tasks. <br><br><h3>  Practice </h3><br>  The presented video material contains the theoretical and practical part.  The first half of the video duplicates the described theoretical part, and in a practical example, the algorithm of this system is shown, an example of the attack of the demo network is carried out, and the system displays the operation of the system in Check Point and Splunk. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/pF2McBrHa3U" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br><h3>  Conclusion </h3><br>  The system works successfully, namely it improves the quality of infrastructure protection and more optimally distributes the firewall resources.  All this is done by automating processes, namely the integration of Check Point and Splunk. <br><br>  If you do not want to miss future lessons, then subscribe to our group <a href="https://vk.com/ts_solution">VK</a> , <a href="https://www.youtube.com/channel/UCKOESE8nBWQPuQmi994_YMA">Youtube</a> and <a href="https://t.me/tssolution">Telegram</a> .  If for any reason you could not find the document you need or solve your problem with Check Point, feel free to contact <a href="https://tssolution.ru/">us</a> . </div><p>Source: <a href="https://habr.com/ru/post/354844/">https://habr.com/ru/post/354844/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354834/index.html">DevConf: a little about blockchain</a></li>
<li><a href="../354836/index.html">Secure Development Section on the PHDays 8 Forum</a></li>
<li><a href="../354838/index.html">PHDays CTF 2018. Writeup maker-up</a></li>
<li><a href="../354840/index.html">Why employees no longer criticize the sysadmin: managing feedback using chatbot</a></li>
<li><a href="../354842/index.html">Security Week 15: Spy Speakers and Hacking Hotel Keys</a></li>
<li><a href="../354846/index.html">How to put one CDN into another?</a></li>
<li><a href="../354848/index.html">Inventory it, inventory it: SAM</a></li>
<li><a href="../354850/index.html">Detection of body parts using deep neural networks</a></li>
<li><a href="../354852/index.html">Organization of bus infrastructure connecting the agents of the system interface STI version 1.0</a></li>
<li><a href="../354854/index.html">Creating a site in Delphi, or How to use uniGUI to a minimum</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>