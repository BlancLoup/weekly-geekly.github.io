<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SolidWorks API (Delphi): connecting and getting an object tree</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably many readers have heard of the SolidWorks program ( see of.site ). In this article, it interests us from the point of view of automating the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SolidWorks API (Delphi): connecting and getting an object tree</h1><div class="post__text post__text-html js-mediator-article">  Probably many readers have heard of the SolidWorks program ( <a href="http://www.solidworks.com/">see of.site</a> ).  In this article, it interests us from the point of view of automating the development of products (parts and assemblies) at the design stage of industrial production. <br><br>  Setting a task is similar to that described in the <a href="http://habrahabr.ru/post/262281/">Tekla Structure API (c #)</a> article <a href="http://habrahabr.ru/post/262281/">: connecting and receiving a tree of objects</a> , with the exception of the implementation technology, is to obtain a tree of model objects, i.e.  assemblies that are included in the model and parts that are included in the assembly, their relationships and parameters. <br><br>  The development system used is Borland Delphi 7. <br><a name="habracut"></a><br>  SolidWorks has its api, which comes with the program itself.  In the api help ( <a href="http://help.solidworks.com/2015/English/api/sldworksapiprogguide/Welcome.htm">here</a> ), the classes are pretty well described and examples are given in c # and Visual Basic, in general, everything is intuitive, it's not hard to figure out.  Also, with all questions, you can ask for support in your personal account on the SolidWorks portal. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Connecting SolidWorks Libraries </h4><br>  If the SolidWorks software is installed correctly, then in the Project-&gt; Import Type Library ... we find <br><ul><li>  SldWorks 2015 Type Library (Version ___) </li><li>  SOLIDWORKS 2015 Constant type library (Version ___) </li></ul><br>  Do not forget to connect <b>SldWorks_TLB</b> and <b>SwConst_TLB</b> in <i>uses</i> to the project. <br><br><h4>  Connect to SolidWorks </h4><br>  The article helped here. We are <a href="http://habrahabr.ru/sandbox/75272/">introduced to SolidWorks from Delphi: Connection</a> . <br><pre><code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SldWrkConnect</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> swApp: ISldWorks; fileName,fileExt: <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>; fileerror,filewarning: LongInt; DocType: swDocumentTypes_e; swModel: IModelDoc2; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> fileName := <span class="hljs-string"><span class="hljs-string">'C:\Model.SLDASM'</span></span>; fileExt := AnsiUpperCase(ExtractFileExt(fileName)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fileExt = <span class="hljs-string"><span class="hljs-string">'.SLDASM'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> DocType := swDocASSEMBLY <span class="hljs-comment"><span class="hljs-comment">// else if fileExt = '.SLDPRT' then DocType := swDocPART // else if fileExt = '.SLDDRW' then DocType := swDocDRAWING // else begin ShowMessage('  !'); DocType := swDocNONE; end; swApp := IUnknown(CreateOleObject('SldWorks.application')) as ISldWorks; swApp.OpenDoc6(fileName,DocType,swOpenDocOptions_Silent,'',fileerror, filewarning); swModel := swapp.ActiveDoc as IModelDoc2; //   ... //      if not swApp.Visible then begin swApp.CloseAllDocuments(true); swApp.ExitApp; end; end;</span></span></code> </pre> <br>  Please note that if the SolidWorks software is already running, then we connect to it and open a new document in it, but if it is not already running, then we launch it in invisible mode.  If for any purpose you want to make running SolidWorks visible, use the following: <br><pre> <code class="delphi hljs">swApp.Visible := true;</code> </pre><br><h4>  Getting model parameters </h4><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SldWrkConnect</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ... author,dataCreate,nameParam: <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>; vCustomInfo: OleVariant; j: Integer; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... <span class="hljs-comment"><span class="hljs-comment">//   " " author := swModel.SummaryInfo[swSumInfoAuthor]; dataCreate := swModel.SummaryInfo[swSumInfoCreateDate]; //   "" vCustomInfo := swModel.GetCustomInfoNames; //      for j := VarArrayLowBound(vCustomInfo,1) to VarArrayHighBound(vCustomInfo,1) do if '_' = AnsiUpperCase(vCustomInfo[j]) then //   nameParam := swModel.GetCustomInfoValue('',vCustomInfo[j]); ... end;</span></span></code> </pre><br><h4>  Getting configurations </h4><br>  A model may have several different configurations (with different details, parameters, connections, etc.).  As part of the current task, we need to get all the configurations with all their components. <br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SldWrkConnect</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ... vConfArr: <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">String</span></span>; k: Integer; swComp: Component2; swConf: IConfiguration; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> ... k := swModel.GetConfigurationCount; setLength(vConfArr,k); vConfArr := swModel.GetConfigurationNames; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i:=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> k-<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> swConf := swModel.IGetConfigurationByName(vConfArr[i]); swComp := swConf.GetRootComponent3(true); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> DocType = swDocASSEMBLY <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-comment"><span class="hljs-comment">// ,      Traverse(swComp,nil); end end;</span></span></code> </pre><br>  It is possible to receive only the currently active configuration: <br><pre> <code class="delphi hljs">swConf:= swModel.IGetActiveConfiguration;</code> </pre><br><h4>  Getting the object tree for configuration </h4><br><pre> <code class="delphi hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">procedure</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Traverse</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(swComp:Component2; node:TTreeNode)</span></span></span><span class="hljs-function">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> vChildArr: OleVariant; i:Integer; nodeChild: TTreeNode; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (node = <span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> nodeChild := TreeView.Items.Add(<span class="hljs-keyword"><span class="hljs-keyword">nil</span></span>,swComp.Name2) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> nodeChild := TreeView.Items.AddChild(node,swComp.Name2); vChildArr:= swComp.GetChildren; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> VarIsNull(vChildArr) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i := VarArrayLowBound(vChildArr, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> VarArrayHighBound(vChildArr, <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> Traverse(IUnknown(vChildArr[i]) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> IComponent2, nodeChild); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>;</code> </pre><br>  So, the problem is solved. <br><br><h4>  Sources Used When Writing Code </h4><br><ol><li>  <a href="https://forum.solidworks.com/welcome">forum.solidworks.com</a> </li><li>  <a href="http://help.solidworks.com/2015/English/api/sldworksapiprogguide/Welcome.htm">api</a> help, examples </li></ol></div><p>Source: <a href="https://habr.com/ru/post/263133/">https://habr.com/ru/post/263133/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263121/index.html">We continue to get acquainted with Intel Xeon Phi: "native" code</a></li>
<li><a href="../263125/index.html">International Mathematical Olympiad for Schoolchildren 2015. Am I? If I want to? Will I decide?</a></li>
<li><a href="../263129/index.html">Microsoft has released an unscheduled security update for Windows MS15-078</a></li>
<li><a href="../26313/index.html">Bloody billboard</a></li>
<li><a href="../263131/index.html">Clojure web application. Part 2</a></li>
<li><a href="../263139/index.html">Pussy: Refactoring. Part two or addiction treatment</a></li>
<li><a href="../263143/index.html">Geek online vacations of a modern child</a></li>
<li><a href="../263147/index.html">Hacked site AshleyMadison.com</a></li>
<li><a href="../263149/index.html">We get acquainted with Vorlon.js - debugging of web applications</a></li>
<li><a href="../26315/index.html">Gold vein startups (outside the box about business)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>