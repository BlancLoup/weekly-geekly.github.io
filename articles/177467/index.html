<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GameDev and candelabrum</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A candelabrum is a candlestick, which is used to adjust the shape of a player's face playing unfairly. 

 Probably, many people remember the card game...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GameDev and candelabrum</h1><div class="post__text post__text-html js-mediator-article">  <i>A candelabrum is a candlestick, which is used to adjust the shape of a player's face playing unfairly.</i> <br><br>  Probably, many people remember the card game ‚ÄúMariage‚Äù, which attracted players to CRT monitors more than a decade ago. <br><br><img src="https://habrastorage.org/storage2/7e8/201/87f/7e820187fc47c9b09acf1217126c881d.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article we will talk about how they tried to give this game a second life and what came of it. <br><br><a name="habracut"></a><br><br><h4>  First call </h4><br>  For writing the game, one developer from Belarus was originally hired, who promised to release the application within two months, given that I provide him with a ready-made design.  At the same time, as far as possible, a colleague should help him.  The work was estimated at $ 2000 +% of sales.  After receiving an advance of $ 1000, work began to boil.  It was October 2011. <br><br><h4>  Reconnaissance </h4><br>  Initially there was no thought of porting anything.  There was a desire to write a preference for the Android platform, which would become cooler than everyone else.  We have not invented anything more original than the study of specialized literature, so we began to read everything that was available on the Internet.  Among all the books stood out ‚ÄúRussian preference‚Äù Dmitry Lesnoy, with the head substantiating the mathematical base of the game, which was written by academician Leonid Mikhailovich Litvin.  Unfortunately (although, rather, fortunately), it was impossible to buy a book, and in all online versions the necessary part of the book was simply missing.  With courage, we wrote a letter to the author and, to our surprise, almost instantly received not only the missing part of the book, but also ... the source code for the Windows version of the game! <br><br><img src="https://habrastorage.org/storage2/496/144/ae0/496144ae0506b0314ee8d2684a9e26b5.png"><br><br><h4>  Combat reconnaissance and military tribunal </h4><br>  It would seem that there are sources, the work should move quickly.  Already, but no, there was a deep lull.  Only occasionally, like the rays of the sun through the clouds in winter, comets penetrated into the sun, which did not even allow to build the build.  Closer to January and they stopped, the hand reached for the candelabra.  After much controversy, the developer returned $ 500 and we broke up in peace.  I note that in the same period the first version of the design was created, for which $ 275 was paid, the quality was appropriate. <br><br><h4>  Go to the contract army </h4><br>  January 2012. Spent 2.5 months and $ 775, nothing is done.  By happy coincidence, a friend who decided to change the profile from the Delphi developer on Android, accepted my offer of cooperation and the work began to boil.  In the future, all calculations with the developers passed only through Odesk. <br><br><h4>  Bridgehead grab </h4><br>  If you are not interested in technical problems that we experienced while porting the game, go straight to the ‚ÄúOffensive‚Äù section.  Now we will brush away a tear of tenderness and tell you about what we had to face. <br><br>  As already mentioned before, the availability of source codes did not mean a quick victory.  The code was very confusing, the UI went along with logic.  Many (including global) variables and fields of classes consisted of two or three letters, and the names of classes and methods contained unknown abbreviations.  Suits and card ranks, betting levels were obtained as a result of magic bit operations.  What prevented them from wrapping their function with a clear name is a mystery.  It was necessary to comprehend much experimentally, trying to guess the purpose of this or that operation. <br><br><img src="https://habrastorage.org/storage2/cbd/dcb/13e/cbddcb13e427273c8cab4de8c0f89d9e.png"><br>  <i>(Memorize this code snippet. Below we show its modern version.)</i> <br><br>  It took four months of hard work to create the first working prototype in Java.  First, the structure of classes was created, which more accurately reflected the interrelations of various subsystems of the game.  At each stage of development, we had a finished prototype, which was gradually enriched with functionality from the source code of Marijazh.  They also had to be brought to mind in order to understand how everything in the code is organized, and also to create a generator of reference games for testing. <br><br>  The first prototype had a significant drawback - it worked on the smartphone so slowly that it was simply impossible to play.  Looking ahead, we say that the number of iterations in calculating the optimal course depending on the player‚Äôs level varies from 25,000 to several million, and many of the calls are recursive. <br>  ‚ÄúRewrite in C!‚Äù - Some acquaintances advised me, arguing that the java is retarding, but on C everything will fly.  The hand again stretched to the candelabrum, but this time I wanted to embed myself, since in this case I would have had to throw out a few more months of paid work.  This option was not pleased, but from the weapon we had only smooth-bore refactoring and small-caliber optimization.  We applied it. <br><br><h4>  Fix at the turn </h4><br>  Obviously, the game with a slow-witted AI is not interesting to the user, so the first step was to speed up the algorithm to reduce delays to reasonable limits.  We took HTC Desire as the minimum device, and Samsung Galaxy S2 as the average device.  I also wanted to make sure that the port of the algorithm was made correctly and optimization would not break it.  To achieve this goal, the original sources of Marijazh were ‚Äúdoped‚Äù.  The program was taught to play the alignment by all levels of players at different conventions and write the result in an XML file.  To do this, we had to spend a long and hard work to separate the interface from the logic in Delphi.  We received similar XML from our Java code, then compared the result.  Thus, we received about a million games, 70 thousand of which were selected as a reference.  After each step of optimization, we drove them again. <br><br>  What was done to optimize the speed of calculations? <br><ul><li>  We refused to use EnumSet, EnumMap.  It would seem that this is one of the fastest collections in Java, but even in them the cost of unnecessary checks and calls for additional methods were too high; </li><li>  The own CardSet container was written, which stored the cards in an array of 4 short (right away) and used bit arithmetic; </li><li>  To calculate the length of the suit (and, accordingly, the entire set of cards) as well as the lowest and highest cards, previously calculated arrays were used; </li><li>  One of the main speed eaters turned out to be iterators.  Even a constant conversion from an array of 4 suits to an array of cards and a walk through this array was faster than calling the simplest iterator; </li><li>  In the most critical places, we had to abandon the use of classes (including arrays and enums) in general and translate everything into primitive types and bit arithmetic.  In some cases, it turned out to be faster to store data in long and constantly extract individual bytes from it by means of bit arithmetic than to store it separately in arrays.  On the Android virtual machine, even such small memory allocations hit the performance very hard if they are called very often.  The difference is also visible on Oracle JVM. </li></ul><br><br>  As a result, we managed to achieve speed optimization tenfold (from the fact that one game was counted a few seconds on the Core i7 to the point that now an average of 5 games are calculated per second at the most difficult levels).  And we did without rewriting even a part of the algorithms in C, which significantly simplified debugging and testing.  Now our product works quite quickly even on HTC Desire, and if it does, it shows the progress of the calculations.  There was no such thing in Mariage, although when the computers were still quite weak, the moves had to wait for several minutes. <br><br>  Here is the result from the code that was given at the beginning of the article: <br><br><img src="https://habrastorage.org/storage2/5c3/e1a/7a9/5c3e1a7a9882969bd49097da60cf5ab5.png"><br><br>  And this is how it looks live: <br><br><img src="https://habrastorage.org/storage2/816/a57/f3f/816a57f3fb7c82be21e5757bca46881d.png"><br><br><h4>  Go on the offensive </h4><br>  At the time of the release of the second prototype, there already existed preference versions on the market, so I wanted not to lose face and do something really good.  To begin, we asked friends to play a couple of games and carefully watched the game.  As a result, the interface has been significantly changed, and a new level of complexity has been added to the game - a schoolboy.  Initially, a new level of complexity was not planned, but after my friend finished a bullet with more than 200 in grief and threw a phone at me, I realized that something very simple was needed.  The current student does not just play poorly, he also helps the player!  In order to keep the user in the game, we added the ‚ÄúJourney‚Äù mode, in which we offered to play in 20 cities with gradually increasing complexity of rivals from city to city.  We believe that we succeeded.  According to Google analysts, the average session length is about 10 minutes and more than 70% of players play in this mode.  We didn‚Äôt promote as such, because Admob doesn‚Äôt advertise gambling, and it‚Äôs not worth doing downloads without receiving the same money in return.  Tried to buy promo in LiveJournal, it did not give the result.  Nevertheless, after the publication on Google Play and the announcement on a couple of forums, we hit the ‚ÄúTop 10‚Äù card games in Ukraine and the ‚ÄúTop 20‚Äù in Russia during the first month, thereby grabbing a solid piece of the market.  For three months, our game has been downloaded by more than 50,000 users.  I also note that the article on Preference on the wiki was written by the author of a competing product and we failed to add our link. <br><br><img src="https://habrastorage.org/storage2/a07/854/eb4/a07854eb406e12d98033bdcced72e16a.png"><br><br><h4>  Guerrilla movement </h4><br>  Like any product, our game has a group of haters who periodically emit rays of hate in the forums and comments on Google Play.  They are united by one and the same thought: ‚ÄúI have been playing pref for N years and have beaten everyone in my yard, and here I lose?  Mukhlezh! ‚ÄùIt turns out that both our bots play together, they change cards, and indeed we give out bad cards in general ... Thanks to Google, which made it possible to respond to comments!  Rating, of course, cannot be corrected by this, but at least morally it has become easier. <br><br><h4>  Help local people </h4><br>  I was pleasantly surprised by the help of players who were very pleased with our implementation of preference.  During the first month we significantly improved the game, based on their feedback.  Note that none of the development team is a professional player, so it was quite difficult to take into account all the game nuances. <br><br><h4>  The battles that we lost </h4><br><ul><li>  Initially, I wanted to get not only the audience of the countries of the former USSR, but at least a small part of those who never played the preference.  To do this, they made a casino-style design, by default they put the shirt ‚ÄúBicycle 808‚Äù and not ‚ÄúCharlemagne‚Äù.  It failed - the West does not want to play pref; </li><li>  Made localization in Serbian, since the game is popular there.  After localization, the audience did not grow, but remained the same small (1%); </li><li>  Free version of the application.  Often flies units without comments or with the charges that we demand money in case of loss.  Against the background of a competitor who forces him to put 5 stars, not allowing him to continue the game, closing the dialogue (the growth for a month and a half was 0.7 from 3.8 to 4.5), we have a solid blow to the rating.  It's funny to see how with almost equal number of downloads, the offer of competitors was rated three times more, while even negative comments have 5 *.  Where is Google looking?  Questions, questions; </li><li>  At a certain point, under the pressure of the pros, we improved the student.  He stopped helping, and stones flew in us in the form of units.  Many players use students as a source of coins, so they did not like this move.  We fixed it pretty quickly. </li></ul><br><br><h4>  Personnel </h4><br>  After the military tribunal, for the first six months a programmer worked on a full-time programmer, as well as night and weekend.  He also hired a designer who left us, having done 50% of the work, motivating the refusal by deciding to quit freelancing and go to a permanent place.  The next six months (and we were releasing on December 31, 2012 at 23-48), the same programmer worked in the evenings and weekends, after three months another young but very intelligent partner joined him, who initially took over the animation, and then performed all sorts of tasks. <br><br>  One very talented girl also began to make the design. An experienced fighter came to the rescue in a difficult moment, who painted the avatars of all the characters.  It is thanks to them that I learned that people sometimes happen to be in a raid or danje, and an order can be taken when the computer is not working. <br><br>  The game plot was thought out by a kind uncle from Zamkadya, he also wrote a Russian version of poems. <br><br>  I can not fail to note the help of many friends and people who are just not indifferent to the preference, who have done a lot to make the game really good. <br><br><h4>  Plans to seize the world </h4><br>  We are not going to stop at what we have achieved - work is already underway on the iOS version, as well as the Online version.  I do not leave the links, the seeker will find it :) </div><p>Source: <a href="https://habr.com/ru/post/177467/">https://habr.com/ru/post/177467/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../177451/index.html">Comparing Subversion and Mercurial (HG)</a></li>
<li><a href="../177453/index.html">IPSEC daemon overview StrongSwan</a></li>
<li><a href="../177457/index.html">Unobvious Genemu TinyMCE configuration options for symfony2</a></li>
<li><a href="../177461/index.html">Experimenting Experimental Data</a></li>
<li><a href="../177465/index.html">Create npm-package</a></li>
<li><a href="../177469/index.html">Shell Extensions Development for Windows Explorer</a></li>
<li><a href="../177473/index.html">06 - DreamWorks and HP: Creation of the Croods Family</a></li>
<li><a href="../177477/index.html">"Sparkling daggers" or as we did the Arab project</a></li>
<li><a href="../177489/index.html">Meet VMware vCloud Director</a></li>
<li><a href="../177491/index.html">Another home video surveillance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>