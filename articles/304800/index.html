<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bloom filter for web developers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On Habr√© already talked a lot about the Bloom filter . Let me remind you that this is a data structure that allows you to check whether an element bel...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bloom filter for web developers</h1><div class="post__text post__text-html js-mediator-article">  On Habr√© already talked a lot about <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580_%25D0%2591%25D0%25BB%25D1%2583%25D0%25BC%25D0%25B0">the Bloom filter</a> .  Let me remind you that this is a data structure that allows you to check whether an element belongs to a set without keeping the element itself.  There is a possibility of a false positive response, but a negative response is always reliable.  In the filter with an accuracy of 1%, only a few bits per element are required. <br><br>  This structure is often used to limit the number of requests to the data warehouse, cutting off requests for items that are not there.  In addition, it can be used for an approximate calculation of the number of unique events, users, views, etc.  <a href="https://en.wikipedia.org/wiki/Bloom_filter">More examples of interesting applications.</a> <br><br>  However, there are difficulties that can deter web developers from applying the Bloom filter. <br><a name="habracut"></a><br><h5>  Storage </h5><br>  All web application instances on all servers should have access to some common data set with the ability to quickly change or check several bits in a large bit vector.  In addition, the data must be securely saved to disk. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Hashing </h5><br>  In order to practice getting closer to the theoretical working parameters of the Bloom filter, you need to do a neat job with hashes from the source element.  A filter of length <i>m</i> bits c <i>k</i> hash functions requires that you form <i>k <b>independent</b></i> values ‚Äã‚Äãfrom the source element, <b><i>uniformly</i></b> distributed from 0 to <i>m</i> -1. <br><br>  Most implementations that I saw use 32-bit murmurhash at best, adding salt for each successive hash, depending on the number of that hash.  There is no evidence that this approach does not increase the asymptotic probability of a false positive. <br><br>  In addition, if a 32-bit hash is used, this sets the upper limit of the filter size to 512 megabytes.  This is not small, but not much, especially if you need a very low percentage of false positives and / or an impressive number of elements in the filter. <br><br>  In my opinion, there are not very many ways to get an arbitrary number of hash functions with values ‚Äã‚Äãin the desired range, and so that they use only the information entropy of the original message: <br><ol><li>  Cut in equal parts the output of one fairly wide function.  In this case, the function must have a parametric output width in bits, so that it does not have to discard the useful bits. </li><li>  Have only two independent hash functions of variable width <i>h</i> <sub>1</sub> and <i>h</i> <sub>2</sub> and form the derivatives of the function <i>g</i> <sub>i</sub> by the formula <i>h</i> <sub>1</sub> + <i>i</i> * <i>h</i> <sub>2</sub> (modulo the number of function values).  I learned about this method recently <a href="http://www.eecs.harvard.edu/~kirsch/pubs/bbbf/esa06.pdf">from here</a> . </li></ol><br><br><h5>  Performance </h5><br>  In order for this construct to be used in deterring requests to the repository, it must respond at least an order of magnitude faster than the protected repository. <br><br>  When implemented in interpreted languages ‚Äã‚Äãthat web developers most often operate with, it can become difficult, and most importantly, a non-core and unnecessary task. <br><br><h4>  Proposed Solution </h4><br>  I want to offer you a <a href="https://github.com/Snawoot/bloom">solution</a> that allows you <a href="https://github.com/Snawoot/bloom">to</a> conveniently integrate Bloom filters into the infrastructure of your web application. <br><br>  This is a container server that stores the Bloom filter in RAM and on disk.  Access to filter operations is provided via HTTP. <br><br>  Storage persistence is provided by snapshots that do not block the daemon's work.  Snapshot is written to a temporary file with a nontrivial name and replaces the old one only after the end of the recording.  The data set is saved by a timer, when the server is shut down and when the process receives a USR1 signal. <br><br>  The algorithm for generating hashes - cutting MD6 hash with a length of <i>k</i> * <i>w</i> bits into <i>k</i> keys for <i>w</i> bits.  The number of MD6 rounds is standard. <br><br>  The HTTP interface was chosen for ease of integration on the developer side: most development platforms have advanced tools for making synchronous, asynchronous, and parallel (curl-multi) HTTP requests.  Despite the simplicity of the interface, it took over all the advantages of the HTTP standard, and allows pipelined requests within a single connection. <br><br>  The application I have proposed has been extensively tested on production systems and can be considered as stable. <br><br>  The server is written in C using libevent2.  On an Intel¬Æ Pentium¬Æ CPU G4400 @ 3.30GHz processor, the application shows ~ 35000 RPS in Apache Benchmark to check and add 300-byte elements. <br><br>  Supported and tested platforms: <br><ul><li>  GNU / Linux (various versions and distributions) </li><li>  FreeBSD 8, 9, 10 </li><li>  Mac OS X 10.11 </li><li>  Solaris 11 </li></ul><br><br><h5>  Examples </h5><br>  Starting the daemon with default parameters (1 GB, 10 keys - for 500,000,000 items with a false positive probability of 0.1%): <br><pre> $ bloom habrahabr.snap
 Creating space ...
 Initializing new file storage ...
 Saving snapshot ...
 Initial snapshot written.
</pre><br><br>  Check item: <br><pre> $ curl http: // localhost: 8889 / check? e = Hello% 20Habr% 21
 MISSING
</pre><br><br>  Add an item: <br><pre> $ curl http: // localhost: 8889 / add? e = Hello% 20Habr% 21
 ADDED
</pre><br><br>  Check again: <br><pre> $ curl http: // localhost: 8889 / check? e = Hello% 20Habr% 21
 PRESENT
</pre><br><br>  We check the availability and add one request: <br><pre> $ curl http: // localhost: 8889 / checkthenadd? e = unexistent
 MISSING
 $ curl http: // localhost: 8889 / checkthenadd? e = unexistent
 PRESENT
</pre><br><br><h4>  Alternative solutions </h4><br><br>  There are libraries that run on the application side and contain common data in Redis.  They manipulate the bits in the Redis bitmaps with the <code>SETBIT</code> and <code>GETBIT</code> . <br><br>  In comparison, their advantages: <br><ul><li>  <s>Hash counting occurs on the web application side, and it does not load the server with computational work.</s>  Once at a time it‚Äôs not necessary, in some cases they consider a hash stored procedure on Lua. </li><li>  They use Redis, which is well known to many, has a rich set of functions, the possibility of scripting and clustering. </li></ul><br>  Minuses: <br><ul><li>  Redis limits the length of the bit field to 512 megabytes.  All implementations that I could find ( <a href="">1</a> , <a href="">2</a> ) are designed to use only one Redis key.  This limits the size of the filter. </li><li>  At the moment, these libraries are not for all languages ‚Äã‚Äãand development platforms. </li><li>  These solutions are not suitable for multilanguage projects: each implementation hashes in its own way and such filters are incompatible with each other. </li><li>  Performance.  Such solutions use two strategies for working with radish: either they set bits for each key through a pipeline, or they call a stored procedure on Lua in a radish, which counts the hash and gives commands.  In the first case, even at a Redis speed of 200,000 operations per second, such solutions are already starting to lose on filters with six or more keys, since each bit is a separate operation.  In the second case, everything is the same, but in addition, time will be spent on running the script and when checking and adding the hash will be counted twice.  However, the situation may improve with the introduction of the <code>BITFIELD</code> team in Redis 3.2.0, which was released in May 2016.  This command allows you to perform several operations on bits in one command. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/304800/">https://habr.com/ru/post/304800/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../304786/index.html">Malicious software is used for cyber espionage over users in Central and Eastern Europe.</a></li>
<li><a href="../304788/index.html">A call from the browser: a tool for business?</a></li>
<li><a href="../304790/index.html">Error in PM error message is ineffective</a></li>
<li><a href="../304794/index.html">First look at the new Cisco Firepower Threat Defense software (UPD 02.09.16)</a></li>
<li><a href="../304798/index.html">Everything you wanted to know about RAID controllers, but it was too lazy to look</a></li>
<li><a href="../304804/index.html">Comparison of online name resolution services</a></li>
<li><a href="../304806/index.html">Beginning the translation of the ‚Äúlegacy‚Äù of the Angular JS project to the Angular 1.5 Components / ES6 and TypeScript</a></li>
<li><a href="../304810/index.html">Mobile VR-game on the Unreal Engine: pitfalls</a></li>
<li><a href="../304812/index.html">Oracle has stopped developing Java EE?</a></li>
<li><a href="../304814/index.html">Ansible: testing playbooks (part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>