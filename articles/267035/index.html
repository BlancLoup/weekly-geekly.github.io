<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The time series forecasting model for the maximum similarity sample: an explanation and an example</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 


 This is my model. I invented it, programmatically implemented it, studied the features and described it. The resulting description was de...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The time series forecasting model for the maximum similarity sample: an explanation and an example</h1><div class="post__text post__text-html js-mediator-article"><h3>  Foreword </h3><br><p>  This is my model.  I invented it, programmatically implemented it, studied the features and described it.  The resulting description was defended as a thesis on the topic <a href="http://mbureau.ru/tag/dissertaciya">‚ÄúTime Series Forecasting Model for a Sample of Maximum Similarity‚Äù</a> .  The developed model belongs to the class of <b>statistical forecasting models</b> and builds a forecast of the time series based on the actual values ‚Äã‚Äãof the same series.  More information <a href="http://habrahabr.ru/post/177633/">about the classification</a> I wrote earlier.  One of the <a href="http://mbureau.ru/articles/dissertaciya-model-prognozirovaniya-vremennyh-ryadov-glava-2">modifications of the model</a> allows you to take into account the influence of external factors on the forecast. <br></p><br><p>  Files with the implemented example can be downloaded in the <a href="">archive</a> . <br></p><br><blockquote>  <b>UPD 03/07/2019</b> : An <a href="http://www.mbureau.energy/blog/time-series-forecast-model-most-similar-pattern-example-matlab">updated version of the sample for MATLAB 2015b is available with comments in English</a> . <br></blockquote><br><a name="habracut"></a><br><h3>  1. Explanation of the prediction model for the maximum similarity sample </h3><br><h4>  1.1.  The main idea and its illustration on time series samples </h4><br><p>  A complete <a href="http://mbureau.ru/articles/dissertaciya-model-prognozirovaniya-vremennyh-ryadov-glava-2">formal description of the prediction model</a> can be found in the second chapter of my thesis.  However, speaking simply, the model is based on the idea of ‚Äã‚Äãthe development of history in a spiral: the stages are repeated, but with varying properties. <br></p><br><p>  If we apply this idea to the time series, then we can say this: in the actual values ‚Äã‚Äãof the time series, if there are enough of them, there is surely a segment that is very similar to what happens on the eve of the forecast. <br></p><br><p>  In fig.  Figure 1 shows a part of the time series Z (t), for which similar segments are noticeable without special calculations.  Let us call the time series segment beginning at time mark t and the length (number of samples) M, the time series pattern of the time series and denote Z <sup>M</sup> <sub>t</sub> . <br></p><br><p><img src="https://habrastorage.org/files/069/098/ce9/069098ce99e4475c8d4c4176145ad58f.png" alt="Time series Z (t) and some of its samples"><br></p><br>  Fig.  1. The time series Z (t) and some of its samples <br><br><p>  Every forecasting model comes from some assumption.  In the model of the maximum similarity sample, it is assumed that if history repeats, then for each sample preceding the forecast there is a similar sample contained in the actual values ‚Äã‚Äãof the same time series.  Formally, this is called the similarity hypothesis (see dissertation). <br></p><br><p>  The ratio of samples and their name can be seen in Fig.  2 <br></p><br><p><img src="https://habrastorage.org/files/dba/e75/dd5/dbae75dd5041434aa3f14d638e3d4e7b.png" alt="Time series samples Z (t)"><br></p><br>  Fig.  2. Sampling time series Z (t) <br><br><p>  At time T, which is called <b>the forecast time</b> , you need to determine the P values ‚Äã‚Äãof the time series in the future, i.e., calculate the <i>Projection</i> sample.  At the same time, the values ‚Äã‚Äãof the <i>New history selection</i> are available.  Further, based on the assumption that there is a similar one for each sample, you need to find the <i>Maximum similarity</i> sample for the <i>New history</i> sample and assume that the history will repeat, that is, the <i>Basic sample</i> will be the basis for the predicted values. <br></p><br><p>  Next, you need to answer three questions. <br></p><br><h4>  1.2.  How to determine the similarity of samples? </h4><br><p>  In my dissertation, I propose the simplest version of the definition of similarity ‚Äî the calculation of <b>the linear correlation value</b> .  Take one sample of length M, take another sample of length M, read the correlation value, which will reflect the similarity of the two samples. <br></p><br><p>  Search for the <i>sample of maximum similarity is the</i> easiest <b>way to search</b> among all possible samples.  For time series up to 100,000 values ‚Äã‚Äãof this sort, brute force takes a few seconds when implemented on a personal computer of average power. <br></p><br><p>  The proposed approach of determining similarity is not the only possible one.  A number of students-followers offered in their work other methods for determining the similarity of two samples.  You can apply your imagination here! <br></p><br><h4>  1.3.  How to "transfer" the change of properties? </h4><br><p>  Due to the fact that the basis of the similarity definition is based on a linear correlation, the simplest way to ‚Äútransfer‚Äù the properties of the samples is the <b>linear dependence</b> <br></p><br><p><img src="https://habrastorage.org/files/b5c/f8a/b96/b5cf8ab960b74399ad142fcbbfb57a62.png" alt="Formula 1">  (one) <br></p><br><p>  If equation (1) reflects the dependence of two actual samples using coefficients Œ± <sub>1</sub> and Œ± <sub>0</sub> , then on the basis of the assumption of similarity, the Forecast and Basic sample are correlated as follows: <br></p><br><p><img src="https://habrastorage.org/files/f40/568/a3b/f40568a3b4d047e18598e0b825a6fe71.png" alt="Formula 2">  (2) <br></p><br><p>  The coefficients Œ± <sub>1</sub> and Œ± <sub>0</sub> in both equations are the same, but for equation (1) they are unknown and need to be determined, and for equation (2) they are known.  The <i>msp</i> index stands for the <i>most similar pattern</i> . <br></p><br><p>  The model name in English sounds like extrapolation (or forecast) model on the most most similar pattern, abbreviated EMMSP. <br></p><br><h4>  1.4.  Does the assumption of similarity always work? </h4><br><p>  This <b>needs to be checked</b> for each new task.  Every time series model is a tool for handling this series, and, like any tool, the model must be used properly.  Roughly speaking, you need to hammer in nails and dig the ground with a shovel, and not vice versa. <br></p><br><p>  The developed model showed excellent results in the tasks of <b>short-term forecasting of time series in the field of electric power industry</b> , where it is necessary to predict prices and volumes of energy consumption.  The model showed results comparable to the results of other forecasting models on financial time series, blood sugar level, etc. Numerical values ‚Äã‚Äãof errors can be found in the <a href="http://mbureau.ru/articles/dissertaciya-model-prognozirovaniya-vremennyh-ryadov-glava-4">fourth chapter of the thesis</a> and a <a href="http://mbureau.ru/tag/otchet-o-tochnosti-prognozirovaniya">set of reports on the prediction of indicators of the wholesale electricity and capacity market</a> . <br></p><br><p>  The most important property of the proposed model is its simplicity and clarity. <br></p><br><h3>  2. An example of the implementation of the prediction model for the sample of maximum similarity in MATLAB </h3><br><p>  An example of a prediction model is implemented in MATLAB. <br></p><br><h4>  2.1.  Initial data, formulation of the prediction problem and model parameters </h4><br><p>  The initial data are the values ‚Äã‚Äãof electricity prices in the European territory of the Russian Federation of the wholesale electricity and capacity market in rubles / MW ‚Ä¢ h from 01/09/2006 to 13/11/2012 at hourly rates.  The PRICES_EUR archive contains 54,384 values. <br></p><br><p>  It is necessary to calculate the forecast of this time series at P = 24 values ‚Äã‚Äãahead, i.e., one day ahead at the time of the forecast T = 09/01/2012 23:00:00. <br></p><br><p>  Loading raw data: <br></p><br><pre><code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%           %   ,  PRICES_EUR    % &lt;Date&gt; - &lt;Hour&gt; - &lt;Value&gt; load PRICES_EUR PRICES_EUR; %      PRICES_EUR.mat TimeSeries = PRICES_EUR;</span></span></code> </pre> <br><p>  Statement of the forecasting task: <br></p><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%    T = datenum('01.09.2012 23:00:00', 'dd.mm.yyyy hh:MM:ss'); %   (Origin) P = 24; %   (Forecast horizon)</span></span></code> </pre><br><p>  Parameters of the EMMSP prediction model: <br></p><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%       M = 144; Step = 24;</span></span></code> </pre><br><p>  In this case, the length of the <i>sample of the new history</i> and the <i>sample of maximum similarity</i> is M = 144.  Read more about how to define M, read the <a href="http://mbureau.ru/articles/dissertaciya-model-prognozirovaniya-vremennyh-ryadov-glava-3">third chapter of the thesis</a> . <br></p><br><p>  The step variable is a step of iterating over the actual values ‚Äã‚Äãwhen determining the <i>maximum similarity sample</i> . <br></p><br><h4>  2.2.  Algorithm prediction model for a sample of maximum similarity </h4><br><h5>  2.2.1.  Define a sample of new history </h5>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="matlab hljs">Index = <span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(TimeSeries(:,<span class="hljs-number"><span class="hljs-number">1</span></span>) == datenum(year(T), month(T), day(T)) &amp; TimeSeries(:,<span class="hljs-number"><span class="hljs-number">2</span></span>) == hour(T)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(Index) &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> fprintf([<span class="hljs-string"><span class="hljs-string">'  :   T      1  \n'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">elseif</span></span> <span class="hljs-built_in"><span class="hljs-built_in">isempty</span></span>(Index) fprintf([<span class="hljs-string"><span class="hljs-string">'  :   T      \n'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> HistNewData = TimeSeries([Index-M+<span class="hljs-number"><span class="hljs-number">1</span></span>:Index],:); <span class="hljs-comment"><span class="hljs-comment">%    (HistNewData) Index = Index - Step * 2; end</span></span></code> </pre><br><h5>  2.2.2.  Determine the similarity values </h5><br><pre> <code class="matlab hljs">k = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> Index &gt; <span class="hljs-number"><span class="hljs-number">2</span></span> * M HistOldData = TimeSeries([Index-M+<span class="hljs-number"><span class="hljs-number">1</span></span> : Index],:); Likeness(k,<span class="hljs-number"><span class="hljs-number">1</span></span>)= Index; CheckOld = <span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(HistOldData(:,<span class="hljs-number"><span class="hljs-number">3</span></span>) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-comment"><span class="hljs-comment">%   ,    CheckNew = find(HistNewData(:,3) &gt; 0); if isempty(CheckOld) || isempty(CheckNew) Likeness(k,2) = 0; else Likeness(k,2) = abs(corr(HistOldData(:,3), HistNewData(:,3), 'type', 'Pearson')); end k = k + 1; Index = Index - Step; %       Step end</span></span></code> </pre><br><p>  The step of iteration <i>Step</i> = 24 is taken from the consideration that the time series has a pronounced daily frequency. <br></p><br><h5>  2.2.3.  Define maximum similarity </h5><br><pre> <code class="matlab hljs">MaxLikeness = <span class="hljs-built_in"><span class="hljs-built_in">max</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">abs</span></span>(Likeness(:,<span class="hljs-number"><span class="hljs-number">2</span></span>))); IndexLikeness = <span class="hljs-built_in"><span class="hljs-built_in">find</span></span>(Likeness(:,<span class="hljs-number"><span class="hljs-number">2</span></span>) == MaxLikeness); MSP = Likeness(IndexLikeness(<span class="hljs-number"><span class="hljs-number">1</span></span>),<span class="hljs-number"><span class="hljs-number">1</span></span>);</code> </pre><br><p>  Practice shows that there can be several maximums of similarity.  The most convenient is to take the first. <br></p><br><br><h5>  2.2.4.  Determine the maximum similarity sample </h5><br><pre> <code class="matlab hljs">MSPData = TimeSeries([MSP-M+<span class="hljs-number"><span class="hljs-number">1</span></span> : MSP],:); <span class="hljs-comment"><span class="hljs-comment">%    (MSPData)</span></span></code> </pre><br><br><h5>  2.2.5.  Define basic sample </h5><br><pre> <code class="matlab hljs">HistBaseData = TimeSeries([MSP+<span class="hljs-number"><span class="hljs-number">1</span></span>:MSP+P],:); <span class="hljs-comment"><span class="hljs-comment">%   (HistBaseData)</span></span></code> </pre><br><br><h5>  2.2.6 Search for coefficients Œ± <sub>1</sub> and Œ± <sub>0</sub> </h5><br><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">%   HistNewData   MSPData    . %        . %      ,      . X = MSPData(:,3); X(:,length(X(1,:))+1) = 1; %      I Y = HistNewData(:,3); E = X(:,2); Xn = X'* X; Yn = X'* Y; invX = inv(Xn); A = invX * Yn; %   alpha1  alpha0    A</span></span></code> </pre><br><p>  After finding the values ‚Äã‚Äãof the coefficients Œ± <sub>1</sub> and Œ± <sub>0,</sub> you can check with which error the <i>Sample of the new history</i> is similar to the <i>Sample of maximum similarity</i> , that is, what is the error of equation (1).  In the present example, verification is omitted for simplicity. <br></p><br><br><h5>  2.2.7.  Forecasting </h5><br><pre> <code class="matlab hljs">X = HistBaseData(:,<span class="hljs-number"><span class="hljs-number">3</span></span>); X(:,<span class="hljs-built_in"><span class="hljs-built_in">length</span></span>(X(<span class="hljs-number"><span class="hljs-number">1</span></span>,:))+<span class="hljs-number"><span class="hljs-number">1</span></span>) = <span class="hljs-number"><span class="hljs-number">1</span></span>; Forecast = X * A; <span class="hljs-comment"><span class="hljs-comment">%  ,  24  </span></span></code> </pre><br><p>  In the implemented example, the number of predictive samples can be changed by changing the parameter P. <br></p><br><br><h5>  2.2.8.  Estimation of forecasting error </h5><br><pre> <code class="matlab hljs"><span class="hljs-comment"><span class="hljs-comment">% 1)    Index = find(TimeSeries(:,1) == datenum(year(T), month(T), day(T)) &amp; TimeSeries(:,2) == hour(T)); Fact = TimeSeries([Index : Index+P-1],3); % 2)   MAE MAE = mean(abs(Forecast - Fact)); % 3)   MAPE MAPE = mean(abs(Forecast - Fact)./Fact); fprintf(['  T = ',datestr(T,'dd.mm.yyyy HH:MM'),'\n', '  P = ', num2str(P),'\n', '  MAE = ',num2str(MAE),' RUB/MWh, MAPE = ',num2str(MAPE*100),'%% \n']);</span></span></code> </pre><br><p>  As a result of program execution, the following message should appear in the MATLAB command line: <br></p><br><pre> <code class="matlab hljs">  MaxLikeness = <span class="hljs-number"><span class="hljs-number">0.95817</span></span>  alpha1 = <span class="hljs-number"><span class="hljs-number">1.0312</span></span>,  alpha0 = <span class="hljs-number"><span class="hljs-number">-11.1992</span></span>   T = <span class="hljs-number"><span class="hljs-number">01.09</span></span><span class="hljs-number"><span class="hljs-number">.2012</span></span> <span class="hljs-number"><span class="hljs-number">23</span></span>:<span class="hljs-number"><span class="hljs-number">00</span></span>   P = <span class="hljs-number"><span class="hljs-number">24</span></span>   MAE = <span class="hljs-number"><span class="hljs-number">57.6383</span></span> RUB/MWh, MAPE = <span class="hljs-number"><span class="hljs-number">6.0065</span></span><span class="hljs-comment"><span class="hljs-comment">%</span></span></code> </pre><br><p>  Questions?  You can ask them here if you have an account on Habr√©, or on our <a href="http://mbureau.ru/forum">forum</a> , if you don‚Äôt have one. <br></p></div><p>Source: <a href="https://habr.com/ru/post/267035/">https://habr.com/ru/post/267035/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../267023/index.html">Comparison of mobile applications for 3D reconstruction</a></li>
<li><a href="../267025/index.html">git punish - whose team I always lacked</a></li>
<li><a href="../267027/index.html">FZ-188: who will soon categorically not be able to buy foreign software, if there is a Russian equivalent</a></li>
<li><a href="../267029/index.html">We make a network printer from HP LJ1000</a></li>
<li><a href="../267033/index.html">Simple Optimization Technique Using Intel System Studio</a></li>
<li><a href="../267037/index.html">A simple algorithm for determining the intersection of two segments</a></li>
<li><a href="../267039/index.html">Private Cloud Appliance - the best virtualization and private cloud for data centers</a></li>
<li><a href="../267041/index.html">Dissect t-SNE</a></li>
<li><a href="../267045/index.html">System backup of virtual machines or how to save money organization</a></li>
<li><a href="../267047/index.html">Bot for sapper with a twist</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>