<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The story of a single application or the struggle for performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you are a professional developer, then you should be familiar with the feeling when you want to do something not for money, but for the soul. On on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The story of a single application or the struggle for performance</h1><div class="post__text post__text-html js-mediator-article">  If you are a professional developer, then you should be familiar with the feeling when you want to do something not for money, but for the soul.  On one of these evenings, I wanted to get a little distracted and write just such an application. <br><br>  We are located in Ukraine, where there are not so many local applications for Windows Phone, and there are even fewer applications on national topics.  Being a music lover, I decided to make an application with the lyrics of songs of Ukrainian performers.  To my surprise, I found more than 18,000 Ukrainian songs on the <a href="http://nashe.com.ua/">OUR</a> site that are performed by about 800 artists. <br><br>  ‚ÄúNot bad‚Äù - I thought and sat down to write a simple parser, which folded all my texts locally.  I have been writing parsers and other similar applications for many years, so this process did not take much time.  For writing a crawler and parsing HTML I used the <a href="http://extracting.codeplex.com/">Data Extracting SDK</a> library I wrote and, undoubtedly, the best library in the .NET world for this purpose - <a href="http://htmlagilitypack.codeplex.com/">HtmlAgilityPack</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After all the information was packaged into a single XML file, the question of how to best unpack this information in the application, so that the user does not feel the brakes, became a question.  And at that moment, the ‚Äúfor fun‚Äù task turned into a completely applied task of finding the optimal approach for working with large (by the standards of a mobile device) data volumes. <br><br>  That's what came of it. <br><a name="habracut"></a><br><h4>  Key Performance Issues </h4><br>  What the developer needs to pay attention to in order for the application to be high-performance: <br><br>  <b>Application start time</b> <br><br>  The application has only a few seconds to start.  If the start time exceeds 8 seconds, the application will be unloaded from memory, and the author of the application will most likely receive an additional unit in the market. <br><br>  In order to reduce the start time, it is necessary for the application to contain as few resource files as possible (Resources), so multimedia files and other ‚Äúheavy‚Äù files should be included in the project as Content. <br><br>  But there is a downside - access to resources <i>after</i> launching the application takes less time than reading the content.  Therefore, developers need to take into account these differences. <br><br>  You also need to remember that splash screen does not support animation, because  This is a regular jpeg file. <br><br>  <b>Data load time</b> <br><br>  After the application starts, data starts to load.  In our case there is a lot of data and the reading time is also big. <br><br>  If data is loaded for a few seconds (from local storage or via a web service), then an additional fake page is often made that emulates a splash screen, but adds animation (a progress bar with the text "Please wait ...").  After loading the data, the user is redirected to the page where the loaded data is already displayed, being amazed that Microsoft finally added the ability to display animated splash screenshots.  For more information on how to make an animated splash screen, read <a href="http://wp7rocks.com/posts/details/2364">here</a> . <br><br>  If you load data in the main stream, it usually looks like this: <br><br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); DataContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeDataObject(); }</code> </pre> <br>  then the user will surely see the interface hangs (this is especially true for the Panorama control). <br><br>  You can fix it this way - wait until all UI and resources are fully loaded and only then display the data: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Loaded += MainPage_Loaded; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage_Loaded</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, RoutedEventArgs e</span></span></span><span class="hljs-function">)</span></span> { DataContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> SomeDataObject(); }</code> </pre><br><br>  The second option is to load everything in a separate thread or create a BackgroundWorker: <br><br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MainPage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeComponent(); StartLoadingData(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartLoadingData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.Dispatcher.BeginInvoke(() =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> backroungWorker = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BackgroundWorker(); backroungWorker.DoWork += backroungWorker_DoWork; backroungWorker.RunWorkerCompleted += backroungWorker_RunWorkerCompleted; backroungWorker.RunWorkerAsync(); }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">backroungWorker_DoWork</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sender, DoWorkEventArgs e</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-comment"><span class="hljs-comment">// heavy operation } void backroungWorker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e) { this.Dispatcher.BeginInvoke(() =&gt; { // update layout with new data }); }</span></span></code> </pre> <br><br>  Wrote a little more code, but improved performance. <br><br>  Well, it is also a good idea to show the progress bar while performing heavy operations (you can use Microsoft.Phone.Shell.ProgressIndicator, a component from the Silverlight Toolkit or from Telerik RadControls for Windows Phone). <br><br>  <b>Screen switching speed</b> <br><br>  Usually transitions between pages do not take much time, but you can also improve this process by adding beautiful animations (you can also use Telerik RadControls for Windows Phone). <br><br>  It was a ‚Äúmoment of theory.‚Äù  Smoothly proceed to the main task: loading and displaying data. <br><br><h4>  Download and display data </h4><br>  There is a Windows Console program that prepares data, and a Windows Phone application reads this data. <br><br>  The easiest way: data serialization, namely in XML: <br><br><pre> <code class="hljs pgsql">private static <span class="hljs-type"><span class="hljs-type">void</span></span> Serialize(<span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj, string <span class="hljs-type"><span class="hljs-type">name</span></span>) { var ser = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlSerializer(obj.GetType()); var sb = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringBuilder(); var writer = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringWriter(sb); ser.Serialize(writer, obj); File.WriteAllText(<span class="hljs-type"><span class="hljs-type">name</span></span> + ".xml", sb.ToString().Replace("encoding=\"utf<span class="hljs-number"><span class="hljs-number">-16</span></span>\"", <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>)); } private static <span class="hljs-type"><span class="hljs-type">void</span></span> Deserialize(<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">type</span></span>) { //Assuming doc <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> an <span class="hljs-type"><span class="hljs-type">XML</span></span> document containing a serialized <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> objType <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">object</span></span>. XmlNodeReader reader = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlNodeReader(doc.DocumentElement); XmlSerializer ser = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> XmlSerializer(objType); <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> obj = ser.Deserialize(reader); // <span class="hljs-keyword"><span class="hljs-keyword">Then</span></span> you just need <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">cast</span></span> obj <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> whatever <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> eg: var myObj = (typeof(obj))obj; }</code> </pre> <br><br>  The data model looks like this: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Artist</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Artist</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { Songs = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;Song&gt;(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;Song&gt; Songs { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Song</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Title { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Description { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> ArtistId { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } }</code> </pre> <br><br>  As a result, we received an XML file that occupied more than 24 megabytes. <br><br>  <i>I also tried to serialize to JSON format, as well as reduce the names of properties, which resulted in saving of half a megabyte, which can be called ‚Äúmicro‚Äù optimization.</i> <br><br>  It‚Äôs not a good idea to load 24 megabytes into the application, so it was decided to use the SQL CE database and read the data from it. <br><br>  A code has been added to the Windows Phone application that parses the XML file and writes all the data into the local database. <br><br>  Findings: <br><br><ul><li>  data verification and insertion was <i>very</i> slow; </li><li>  due to the length of some texts, I had to use the DbType.NText type; </li><li>  The final size of the database was very large and even despite this it was necessary to rewrite it at the start of the application to the local storage, which took a lot of time. </li></ul><br>  In order to copy a locally generated database, the <a href="http://wp7explorer.codeplex.com/">Isolated Storage Explorer</a> tool was used: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/343/9c9/38e/3439c938ebd107bdb6f851ab9877eb37.png" alt="image"><br><br>  In order for the Isolated Storage Explorer to work for you, you need to add the appropriate library to the project and register the code: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/050/913/fcc/050913fcc8c4104cdcaf531b3e52ddd4.png" alt="image"><br><br>  Since  the variant with the base flew by, began to look for other optimization options.  It is clear that where there is a large text file, there you can compress it using the archiver.  The compression zip file archiver file began to weigh about 5 megabytes. <br><br>  Thus, when starting the application, you need to 1) copy the file to the local storage 2) unpack it 3) load the data from the file into memory. <br><br>  Zip archive in the project is added as Content, at the start we do all of the above steps.  For this, various combinations of methods were used: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyFromContentToStorage</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IsolatedStorageFile store, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dbName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> src = Application.GetResourceStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(dbName, UriKind.Relative)).Stream; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dest = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IsolatedStorageFileStream(dbName, FileMode.OpenOrCreate, FileAccess.Write, store); src.Position = <span class="hljs-number"><span class="hljs-number">0</span></span>; CopyStream(src, dest); dest.Flush(); dest.Close(); src.Close(); dest.Dispose(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyStream</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Stream input, IsolatedStorageFileStream output</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> buffer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>[<span class="hljs-number"><span class="hljs-number">32768</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">long</span></span> tempPos = input.Position; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> readCount; <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> { readCount = input.Read(buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, buffer.Length); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (readCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { output.Write(buffer, <span class="hljs-number"><span class="hljs-number">0</span></span>, readCount); } } <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (readCount &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>); input.Position = tempPos; } <span class="hljs-comment"><span class="hljs-comment">// load items from "fileName" file that exists in "zipName" file private static List&lt;Artist&gt; Load(string zipName, string fileName) { var info = Application.GetResourceStream(new Uri(zipName, UriKind.Relative)); var zipInfo = new StreamResourceInfo(info.Stream, null); var s = Application.GetResourceStream(zipInfo, new Uri(fileName, UriKind.Relative)); var serializer = new XmlSerializer(typeof (List&lt;Artist&gt;)); return serializer.Deserialize(s.Stream) as List&lt;Artist&gt;; }</span></span></code> </pre><br><br>  Also in the course went the library SharpZipLib: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (ZipInputStream s = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ZipInputStream(src)) { s.Password = <span class="hljs-string"><span class="hljs-string">"123456"</span></span>;<span class="hljs-comment"><span class="hljs-comment">//if archive is encrypted ZipEntry theEntry; try { while ((theEntry = s.GetNextEntry()) != null) { string directoryName = Path.GetDirectoryName(theEntry.Name); string fileName = Path.GetFileName(theEntry.Name); // create directory if (directoryName.Length &gt; 0) { Directory.CreateDirectory(directoryName); } if (fileName != String.Empty) { // save file to isolated storage using (BinaryWriter streamWriter = new BinaryWriter(new IsolatedStorageFileStream(theEntry.Name, FileMode.OpenOrCreate, FileAccess.Write, FileShare.Write, iso))) { int size = 2048; byte[] data = new byte[2048]; while (true) { size = s.Read(data, 0, data.Length); if (size &gt; 0) { streamWriter.Write(data, 0, size); } else { break; } } } } } } catch (ZipException ze) { Debug.WriteLine(ze.Message); }</span></span></code> </pre><br><br>  I tried many options: <br><br><ul><li>  A zip file with a file with meta information (a list of artists and links to their songs), while the lyrics were in separate files - a big minus in performance, because  18,000 files were read and copied very slowly; </li><li>  zip with two files: one with a list of artists, the other with songs is bad, because  the artists read quickly, and the songs, even while using the application, were also long; </li><li>  the boot option at the start of the artist list only, and in the background imperceptibly for the user ‚Äî the loading of songs ‚Äî a situation arose that the user clicked on the song before the file had time to load. </li></ul><br>  This stage ended with one conclusion: the file should be one and it should be in the archive, because  The zip file reading itself is fairly fast. <br><br>  Since the file size cannot be further reduced, it is possible to reduce the time it is read and loaded into memory.  And then I took the path of custom serialization. <br><br><h4>  Binary serialization </h4><br>  Earlier, I knew that embedded serialization is slow and if you need speed, you need to use binary serialization. <br><br>  <a href="http://whydoidoit.com/silverlight-serializer/">SilverlightSerializer by Mike Talbot</a> was chosen as a serializer. <br><br>  In the Windows Console Application, everything worked as it should (serialization / deserialization), but with the reading of the created file in the Windows Phone project there were difficulties associated with different versions of mscorlib. <br><br>  On the project description page there is a paragraph about compatibility issues between .NET and Silverlight projects: <br><br><blockquote>  This is a reference to the system. System, System.Core and mscorlib. </blockquote><br><br>  Unfortunately, to overcome this problem did not work. <br><br>  Then I got to the <a href="http://code.google.com/p/protobuf-net/">protobuf-net</a> project. <br><br>  Mark the necessary classes and properties and get a binary file at the output: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">ProtoContract</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Person</span></span> { [ProtoMember(<span class="hljs-number"><span class="hljs-number">1</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> Id {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} [ProtoMember(<span class="hljs-number"><span class="hljs-number">2</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Name {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>:} [ProtoMember(<span class="hljs-number"><span class="hljs-number">3</span></span>)] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Address Address {<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>;<span class="hljs-keyword"><span class="hljs-keyword">set</span></span>;} }</code> </pre><br><br>  There was no problem reading the file from the Windows Phone project. <br><br><h4>  What is the result </h4><br>  The result was this solution: <br><br>  1. Zip file, which contains the artists.bin binary, and the zip file is connected as Content; <br><br>  2. With the help of BackgroundWorker, after loading the UI, we begin to load data (read the bin file directly from the zip file and deserialize it into the local data model): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List&lt;Artist&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LoadData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> info = Application.GetResourceStream(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"artists.zip"</span></span>, UriKind.Relative)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> zipInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StreamResourceInfo(info.Stream, <span class="hljs-literal"><span class="hljs-literal">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> file = Application.GetResourceStream(zipInfo, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Uri(<span class="hljs-string"><span class="hljs-string">"artists.bin"</span></span>, UriKind.Relative)).Stream) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Serializer.Deserialize&lt;List&lt;Artist&gt;&gt;(file); } }</code> </pre><br><br>  Total: application launch and data parsing on Lumia 800: ~ 5-6 seconds, after which you can easily view any content.  The result could be better and I will continue research and work on productivity, but this result, in my opinion, is not bad enough. <br><br>  There is another small bottleneck - during the transitions between texts within one artist or search results, the text parser can slow down a bit (I have already described the solution - you need to add animations that hide this artifact, maybe I will add it in the update if users like the application) . <br><br>  In general, everything went for everything: <br><br><ul><li>  1 hour to write a parser of songs; </li><li>  6 hours to research various options for improving performance; </li><li>  2 hours to write, in fact, Windows Phone applications; </li><li>  1 hour for drawing icons and creating graphic files; </li><li>  0.25 hours to send for certification; </li><li>  1.5 hours to write this article. </li></ul><br>  Total ~ 12 hours. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/45e/34a/72f/45e34a72feaf38ecd91e00686fc7adc1.png" alt="image"><br><br>  The result of the work can be seen and evaluated <a href="http://www.windowsphone.com/s%3FappId%3D0a40de3d-2476-4b6d-8354-b26c4b39efa1">here</a> . <br><br>  Thanks for attention!  I hope, Windows Phone Store and Habr became a little bit better after this article! </div><p>Source: <a href="https://habr.com/ru/post/167001/">https://habr.com/ru/post/167001/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../166983/index.html">Print me please this dress</a></li>
<li><a href="../166987/index.html">9 years opportunity on mars</a></li>
<li><a href="../166989/index.html">HTTPS in Xpress Browser</a></li>
<li><a href="../166991/index.html">Yandex has released a social-search iOS-application for the USA</a></li>
<li><a href="../166999/index.html">ONDA V972 - a new generation of Chinese tablets</a></li>
<li><a href="../167003/index.html">In the Russian Google new director</a></li>
<li><a href="../167005/index.html">Paul Graham: How to find an idea for a startup (part four)</a></li>
<li><a href="../167007/index.html">Physics Snake. From scratch. Part one</a></li>
<li><a href="../167011/index.html">Why I like working as a programmer in Louisville (or why I won't move to work in your startup)</a></li>
<li><a href="../167013/index.html">Security notes. Password recovery</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>