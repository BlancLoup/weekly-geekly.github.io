<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write a simple system of recommendations on the example of Habr</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today we will talk about recommender systems, and more precisely about the simplest form of collaborative filtering. In the program guide: what is a r...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write a simple system of recommendations on the example of Habr</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/635/83f/685/63583f685afe30a14ce7e313adee8f57.jpg"><br>  Today we will talk about recommender systems, and more precisely about the simplest form of collaborative filtering.  In the program guide: what is a recommender system, what is it based on, what is the mathematical apparatus and how can it be translated into code.  As a bonus, we will provide the results in the form of a simple service. <br><br><ol><li>  <a href="https://habr.com/ru/post/230155/">What is a recommendation system</a> </li><li>  <a href="https://habr.com/ru/post/230155/">Intuition</a> </li><li>  <a href="https://habr.com/ru/post/230155/">Theory</a> </li><li>  <a href="https://habr.com/ru/post/230155/">Implementation: code and data</a> </li><li>  <a href="https://habr.com/ru/post/230155/">Service Habra-recommendations</a> </li><li>  <a href="https://habr.com/ru/post/230155/">Habra analytics</a> </li></ol><br><a name="habracut"></a><br><h4>  What is a recommendation system </h4><a name="intro"></a><br>  In fact, we are confronted daily with recommendatory systems, even if sometimes we don‚Äôt notice it.  In the most explicit form, their work is visible in online stores such as Amazon. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4f3/8d2/084/4f38d208417063179b376c3abefdd803.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The main task of the system is to offer new products based on the purchased-viewed.  Several goals are pursued at once, but the main one is to offer the goods to the buyer, which will most likely lead to the sale and satisfy its demands.  This means that, informally, the recommender system offers some sort of ordered list of products, based on the buyer's background. <br><br><h4>  Intuition </h4><a name="intuition"></a><br>  In this article we are talking about user-based collaborative filtering.  This title may seem formidable, but quite simple ideas stand behind it.  ‚ÄúCollaborative‚Äù means based on the preferences of a particular group.  For example, if Vasya, Petya and Sasha buyers of a bookstore and their tastes are similar, then we can recommend to Sasha purchases based on the purchasing history of Vasya and Petit. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f0/03e/8f0/1f003e8f0ea38d29831444a6fd2ed78a.gif"><br>  (picture taken <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BB%25D0%25BB%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2580%25D0%25B0%25D1%2582%25D0%25B8%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2584%25D0%25B8%25D0%25BB%25D1%258C%25D1%2582%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">from here</a> ). <br><br>  The picture describes a simple situation where several users watched the video, and only some of them liked it.  When we decide whether to recommend a video to a user, we find that similar users dislike this video.  As a result, it is not worth recommending.  In other words, we <i>filter</i> content based on a <i>similar group,</i> hence the name <i>collaborative filtering</i> . <br><br><h4>  Theory </h4><a name="theory"></a><br>  In this article we will consider only the case of a binary evaluation: ‚Äúlike‚Äù or ‚Äúno rating‚Äù.  This model is applicable to favorites on Habr√©.  If the user has saved an article to himself, then he considers it interesting or useful, and if there is no assessment, then this does not mean anything, maybe he just did not see this article. <br><br>  There are several ways to filter (or more precisely, rank) content, we will look at the so-called <i>user-based</i> ( <i>user-based</i> ) method. <br><br><h5>  Data </h5><br>  We have two <i>user</i> entities and articles in <i>favorites</i> .  With each user <i>i,</i> we associate multiple articles <i>u <sub>i</sub></i> . <br><br><h5>  Related users </h5><br>  We define the "similarity" of two users <i>i</i> and <i>j</i> as <br><br><img src="https://habrastorage.org/getpro/habr/post_images/463/ef4/6a1/463ef46a111e5fa209d5df3098bbce33.png"><br><br>  This is the so-called <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D1%258D%25D1%2584%25D1%2584%25D0%25B8%25D1%2586%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582_%25D0%2596%25D0%25B0%25D0%25BA%25D0%25BA%25D0%25B0%25D1%2580%25D0%25B0">Jacquard coefficient</a> , which determines the degree of similarity of the two sets. <br><br>  The idea is simple - to determine how the total part of the articles of two users relates to their total. <br><br><h5>  Recommend article </h5><br>  Let some article <i>p</i> (from the post) is not in favorites, i.e.  does not belong to the set <i>u <sub>i</sub></i> , then we define the similarity of <i>likes</i> (‚Äúhow likely you will like it‚Äù) between the user and the article as follows: <br><img src="https://habrastorage.org/getpro/habr/post_images/470/2dd/14f/4702dd14f36089ec8c4a9746870b7ce8.png"><br>  where <i>n <sub>p</sub></i> and <i>J <sub>p</sub></i> are the number of users and the users who added the post <i>p</i> favorites. <br><br>  The idea behind the formula is simple, the contribution of one user equals the degree of similarity, and normalization to the number of users themselves. <br><br><h5>  Recommendations </h5><br>  Recommendations are a few posts with the maximum <i>likes</i> value. <br><br><h4>  Implementation: code and data </h4><a name="implementation"></a><br>  To implement, we need to take a few steps: <br><br><ol><li>  Collect user list </li><li>  Collect recommendations </li><li>  Count <i>n <sub>p</sub></i> </li><li>  Write a <i>likes</i> function and get maximum <i>k</i> results </li></ol><br><br><h5>  Collect user list </h5><br>  The algorithm is simple: one of the first posts for 2013 was chosen and for each post users who left a comment were gathered, and the author of the post himself.  Total compiled a list of 25 thousand users.  The function code <i>get_all_user_names</i> can be found via git in the file: <a href="https://github.com/SergeyParamonov/habr-analytics-internal/blob/master/recommender.py">recommender.py</a> , and the list of users in the <a href="https://github.com/SergeyParamonov/HabraData/">HabraData</a> repository itself (this is the repository where I collect all sorts of interesting data from Habra) in the file <a href="https://github.com/SergeyParamonov/HabraData/blob/master/user_list.txt">user_list.txt</a> <br><br><h5>  Collect recommendations </h5><br>  Each user, for example, has a favorites tab that can be parsed and get data from the list.  The collected data can be found in the <a href="">user_f favorites.csv</a> file, and the collection code itself is in the same source as above. <br><br><h5>  Count <i>n <sub>p</sub></i> </h5><br>  For each collected post we go through all users and count the number of post appearances.  The data in the <a href="">post_counts.csv</a> file. <br><br><h5>  Likes function </h5><br>  The main function code is shown in the spoiler below.  Brief description: for each user, we consider its similarity with all other users, and if for another user the similarity is not zero, then we update the similarity of the input-user and the corresponding post.  At the end, we normalize and sort in descending order. <br><br><div class="spoiler">  <b class="spoiler_title">def give_recommendations (username, preferences, weights)</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">give_recommendations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(username, preferences, weights)</span></span></span><span class="hljs-function">:</span></span> preference = preferences[username] rank = {} <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_other, preference_other <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> preferences.iteritems(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> username != user_other: similarity = jaccard_index(preference, preference_other) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> similarity: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> preference_other: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> post <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> preference: rank.setdefault(post, <span class="hljs-number"><span class="hljs-number">0</span></span>) rank[post] += similarity <span class="hljs-comment"><span class="hljs-comment">#normalize and convert to post_list = [(similarity/weights[post], post) for post, similarity in rank.items()] post_list.sort(reverse=True)</span></span></code> </pre> <br></div></div><br><br>  To perusal: practical book <a href="http://edc.tversu.ru/elib/inf/0251.pdf">Programming Collective Intelligence</a> and this <a href="http://davidcel.is/blog/2012/02/07/collaborative-filtering-with-likes-and-dislikes/">post</a> . <br><br><h4>  Service Habra-recommendations </h4><a name="service"></a><br>  Based on the algorithm, we will make a simple recommendation service for users: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b61/a54/0ad/b61a540ad14e4435564b78bb886845bb.png"><br><br>  Available at: <br>  <a href="http://www.habr-analytics.com/recommender">www.habr-analytics.com/recommender</a> <br>  (carefully, the author tested the recommendation system at 4 am) <br><br>  The algorithm considered in this article is one of the most simple and naive (according to the model's assumptions), so you should not overestimate the results of its work.  On the other hand, advanced algorithms are largely based on the same ideas and use similar techniques for modeling recommendations, and therefore it is useful to have at least a general understanding of user-based filtering. <br><br><h4>  Habra Analytics </h4><a name="analysis"></a><br>  If analyst on the example of Habr interested, then in addition to the recommendations of the current version of the project <a href="http://www.habr-analytics.com/">www.habr-analytics.com</a> supports the monitor of articles, user analysis and a number of other options.  More information about the interesting application of the system is written in the article " <a href="http://habrahabr.ru/post/230003/">The syndrome of the step and cut of attendance Habr</a> ." <br><br> <a href="http://habrahabr.ru/post/230003/"><img src="https://habrastorage.org/getpro/habr/post_images/7b1/73f/713/7b173f71379e5e7297054ab16918dd43.png"></a> <br><br>  And also in <a href="http://habrahabr.ru/post/228015/">this</a> article describing each of the functions separately. </div><p>Source: <a href="https://habr.com/ru/post/230155/">https://habr.com/ru/post/230155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../230137/index.html">Ordered a rare phone in a foreign online store? Get a subpoena</a></li>
<li><a href="../230141/index.html">BlackBerry has got its own Siri: BlackBerry Assistant</a></li>
<li><a href="../230143/index.html">vPath or how to create a service chain in a virtualization environment</a></li>
<li><a href="../230149/index.html">OpenVPN Access Server Desktop Client is vulnerable</a></li>
<li><a href="../230153/index.html">12 commandments about backup for which I almost paid a finger</a></li>
<li><a href="../230157/index.html">Apple and IBM became allies in conquering the corporate market.</a></li>
<li><a href="../230161/index.html">Who needs this HTML: ‚ÄúHow I wrote down a payment service in 2 months - and sent it to a landfill‚Äù</a></li>
<li><a href="../230163/index.html">How Sony makes high definition sound mainstream</a></li>
<li><a href="../230165/index.html">Kindle Unlimited: $ 9.99 monthly subscription to books from Amazon</a></li>
<li><a href="../230167/index.html">MAYHEM is a multipurpose bot for * NIX-servers. Investigation of Yandex. Security</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>