<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Forms Architecture in Symfony2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Symfony 2 has a completely new component for working with forms , which, as far as I know, will easily replace most of these libraries for PHP both in...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Forms Architecture in Symfony2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/04a/8bd/8cb/04a8bd8cbe2a4ecacdb5d96b3383b9f2.jpg" alt="Picture to attract attention" align="right"><br><br>  <a href="http://symfony.com/">Symfony 2</a> has a completely new <a href="https://github.com/symfony/Form">component for working with forms</a> , which, as far as I know, will easily replace most of these libraries for PHP both in functionality and, if possible, in extending it (of course, if you do not take into account small flaws when working with JavaScript .  The development of this component took more than two years, although I started thinking about it <a href="http://webmozarts.com/2009/04/12/improving-the-forms/">somewhere else in 2009</a> or even earlier.  With each new version, this component becomes more and more stable, and a completely stable version is expected with the release of Symfony 2.2. <br><br>  This post is dedicated to the release of Zend Framework 2 Form RFC, since it seems to me that its developers, in fact, have done a lot of what has already been done by us.  Of course, it is clear to everyone that Zend Framework 2 should have an interlayer for working with forms, which fully takes into account the features of the components supplied with the framework.  The goal of this post is to attempt to show that Symfony2 Forms fits these requirements perfectly.  The functionality inherent in Symfony2 can be easily removed: the code for processing forms and all levels of abstractions are completely independent.  Attaching the same support for the features of the Zend components is also not difficult. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Creating a generic library for working with forms, which covers all possible use cases arising during development, was not an easy test, a long and complicated affair, which, moreover, has not yet been completed.  Collaboration and continued collaborative development should help achieve more flexible and simple form management from PHP. <br><a name="habracut"></a><br><br>  We begin this post, perhaps, with thanks to all those who participated in the development of frameworks and libraries for processing forms that influenced our work.  Then, before describing the architecture itself, I would like to familiarize you with the key aspects of designing a convenient and flexible component for working with forms. <br><br><blockquote>  In this post you will not find examples of the use of "killer features" of this component, for this there is <a href="http://symfony.com/doc/current/book/forms.html">documentation</a> .  Also, you will not find here any information on its use, so to speak, out of context, regardless of the framework.  Such information should be described, for example, <a href="https://gist.github.com/1170166">in Gist</a> . <br></blockquote><br><br><h4>  Influence </h4><br>  The form component has been influenced by a variety of frameworks written in various languages, including <a href="http://www.symfony-project.com/">symfony 1</a> , <a href="http://framework.zend.com/">Zend Framework 1</a> , <a href="https://www.djangoproject.com/">Django</a> , <a href="http://rubyonrails.org/">Ruby on Rails</a> , <a href="http://struts.apache.org/">Struts</a> and <a href="http://javaserverfaces.java.net/">JSF</a> .  In addition, it contains similarities with <a href="http://groups.inf.ed.ac.uk/links/formlets/">Formlets</a> , <a href="http://citeseerx.ist.psu.edu/viewdoc/summary%3Fdoi%3D10.1.1.206.496">WUI,</a> and <a href="http://citeseerx.ist.psu.edu/viewdoc/summary%3Fdoi%3D10.1.1.81.5195">iData</a> , libraries for working with forms written for functional programming languages ‚Äã‚Äãsuch as Links, Curry, and Clean. <br><br><h4>  Key aspects </h4><br>  Key aspects in designing a component for working with forms are: <br><ul><li>  Increased level of abstraction </li><li>  Extensibility </li><li>  Composition </li><li>  Separation of tasks </li><li>  Model binding </li><li>  Dynamic behaviors </li></ul><br><br>  Let's briefly go through each of these aspects before discussing how the implemented architecture covers them. <br><br><h5>  Increased level of abstraction </h5><br><br>  Raising the level of abstraction allows you to take any part of the form ‚Äî even the entire form ‚Äî and place it in a data structure that you can then use again.  Consider a date selection form in which there are three drop-down lists for selection by day, month, and year.  First you need a code that will generate HTML with all the options drop-down lists.  Then, you need code that converts data from the format of your application (for example, a <i>DateTime</i> object if we are talking about PHP) into a format suitable for our presentation (in order to mark the selected value of the lists).  Of course, you will need the reverse procedure.  Now imagine a situation where you have to add another drop-down list for some additional data.  In this case, you will have to duplicate all the code for this list and adapt it to the new requirements. <br><br>  Introducing abstraction solves this problem by providing suitable structures for describing and reusing your code. <br><br><h5>  Extensibility </h5><br><br>  Extensibility is based on two concepts related to abstraction: <br><ol><li>  <i>Specialization</i> is a logical sequence of abstractions.  If it is possible to abstract the functional into generalized data structures, then they can also be <i>expanded</i> into more specialized structures.  For example, we can extend the above example with the selection of a date by adding fields for choosing the time.  If it were not possible to expand the functionality of the existing field to select a date, then we would have to rewrite a substantial part of the functionality. <br></li><li>  <i>Impurities</i> are the opposite of specialization.  For example, you wanted to change all existing fields so that there would be an asterisk ("*") in their descriptions, which would show that these fields are required.  Using a specialization approach for this is somewhat impractical, since you will have to <i>expand all the available fields</i> , implementing the same functionality.  <a href="http://ru.wikipedia.org/wiki/%25D0%259F%25D1%2580%25D0%25B8%25D0%25BC%25D0%25B5%25D1%2581%25D1%258C_(%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5)">Impurities</a> allow you to connect functionality to existing objects without having to redefine them.  In addition, the functionality added in this way will be inherited for all child objects in the inheritance tree. <br></li></ol><br><br>  Extensibility also refers to a more in-depth expansion of the functional, with the help of events.  This we will consider later. <br><br><h5>  Linker </h5><br><br>  If we analyze the last example, we can notice that there is no particular difference between the <i>fields</i> ( <i>composite fields</i> , such as in the considered example, or <i>primitive ones</i> , such as text input field) and the <i>forms are</i> not present.  And fields and forms <br><ol><li>  Accept default values ‚Äã‚Äãfrom models (from arrays, from dates, from strings ...) </li><li>  Transform values ‚Äã‚Äãso that it can be used in a view. </li><li>  Generate HTML </li><li>  Accept user input </li><li>  Convert value back to model format. </li><li>  Can validate data </li></ol><br><br>  We can implement fields and forms using the same fundamental data structures.  By adding a linker, a tool that allows you to add nested structures (see the Linker design pattern), we can create a form of any complexity.  Instead of delimiting the fields and forms, let's talk about the <i>forms and their constituent parts</i> .  As soon as a form has a descendant, it must also <br><ol><li>  pass default values ‚Äã‚Äã(array or object) to its descendants </li><li>  transfer the input values ‚Äã‚Äãof each child back to the array or object </li></ol><br><br><h5>  Separation of tasks </h5><br>  We can divide the tasks described above into several specific groups: <br><ul><li>  Data conversion </li><li>  HTML generation (presentation) </li><li>  Validation </li><li>  Data binding </li></ul><br><br>  Each of these groups of tasks must be implemented by a separate component with an explicitly defined interface.  This will allow you to replace any of these components with your own: for example, replace the view processor, or, for example, the validation layer. <br><br><h5>  Model binding </h5><br><br>  In most cases, forms are directly tied to structures, one way or another, described in <a href="http://design-pattern.ru/patterns/domain-model.html">the domain model</a> .  Consider the example of sending user profile information.  Suppose that all user information is stored in a separate table in your database.  The table stores information about the properties that the profile contains, which <i>data type is</i> used for each of the <i>properties</i> , their <i>default values</i> and <i>data entry restrictions</i> .  Ideally, your application should also contain the <i>Profile</i> class with all the necessary <i>properties</i> , linked to a table in the database, for example, by means of the <a href="http://www.doctrine-project.org/">Doctrine2</a> <a href="http://ru.wikipedia.org/wiki/ORM">ORM</a> .  This class may contain more information about the profile than is stored in the table, for example, if a profile contains a set of items of interest to the user.  For simplicity, we will take the list of these items from the configuration file. <br><br>  Usually, information describing an object (let's call it <i>metadata</i> ) should be duplicated in a layer of forms.  The developer has to make sure that the fields have not changed, which of them can be edited, make sure that the form displays the corresponding HTML widgets, that some of the fields could not remain empty, and so on.  <i>It is because of these things that the creation of forms becomes a rather ungrateful thing.</i> <br><br>  <i>Binding models</i> designed to make a difference.  It is based on two ideas: <br><ol><li>  <i>Use existing metadata</i> during form creation in order to reduce the amount of duplicate code and / or settings. </li></ol>  <i>The default values</i> should be obtained from the domain model (in our case it will be an instance of the <i>Profile</i> class) and <i>the input data</i> should also be recorded in our model. <br><br><br><h5>  Dynamic behaviors </h5><br>  Last but not least, these are dynamic behaviors for forms.  Gone are the days when the code for the form was fully implemented on the server, where a check on the security of the data entered by the user was carried out under rigidly defined structures.  Today it is fashionable to use JavaScript to change forms on the client side to improve the usability of the system. <br><br>  Imagine a form in the form of a table.  Each column has fields of the same type, each row is an object on the server.  The form has buttons that allow you to add or delete rows.  With all this, the possibility of validation of forms should remain, they must be successfully processed on the server. <br><br>  Dynamic behaviors were invented to implement such a form.  Moreover, their use is not limited to relatively simple tabular forms.  You can create a form that responds to any changes in its structure made on the client side.  Unfortunately, this problem is not solved in most libraries, despite the demand for such mechanisms. <br><br><h4>  High level architecture </h4><br><br><div style="text-align:center;"><img src="https://habrastorage.org/storage2/93e/b5e/1a7/93eb5e1a7c6e41009b58c8c2f023bca6.png" alt="High level architecture"></div><br><br>  Let me provide a high-level description of the layout architecture in Symfony2, designed to work with forms.  Its cornerstone is the Form component.  This component implements the basis for building and processing forms, as well as using the Symfony2 <a href="https://github.com/symfony/EventDispatcher">event dispatcher</a> to handle internal events.  Over this component is a layer of plug-in extensions: <br><br><ul><li>  <b>Kernel-level</b> extensions provide descriptions of the structure of fields (let's call it the types of forms ( <i>FormType</i> )) implemented in the framework. </li><li>  <a href="https://github.com/symfony/Validator"><b>Validation</b> extension is</a> needed to validate user input inside forms. </li><li>  The <b>DI</b> extension allows you to use a <a href="https://github.com/symfony/DependencyInjection">dependency container</a> . </li><li>  The <b>CSRF</b> extension, as the name implies, adds a CSRF protection for the form. </li><li>  <b>Doctrine2</b> extensions (included with the <a href="https://github.com/symfony/DoctrineBridge">Doctrine Bridge</a> ) add Doctrine-specific drop-down lists and components that let you get object metadata for use in forms. </li></ul><br><br>  The top level contains components that implement the formation of HTML-i.  By default, Symfony2 has two such components: one for rendering forms through <a href="http://twig.sensiolabs.org/">Twig</a> (supplied in the <a href="https://github.com/symfony/TwigBridge">Twig bridge</a> ) and the other for rendering through the <a href="https://github.com/symfony/Templating">good old PHP</a> (supplied with <a href="https://github.com/symfony/FrameworkBundle">FrameworkBundle</a> ). <br><br>  Probably the most interesting feature of this architecture is that any of the components can be replaced.  You can write an extension so that the forms use the validation component from Zend.  You can also write a view component that implements rendering through Smarty or any other template engine.  You can even remove the kernel extension and write your basic form types for simple fields.  Even the underlying event dispatcher can be replaced with your component that implements <a href="https://github.com/symfony/EventDispatcher/blob/master/EventDispatcherInterface.php">the EventDispatcherInterface interface</a> .  This gives a good advantage in flexibility, despite some inconveniences. <br><br><h4>  Low-level architecture </h4><br><br>  This section discusses the internal architecture of the form component.  As mentioned above, the form and all its parts are represented in the form of the same data structure that implements the ‚ÄúLinker‚Äù design pattern.  In the Form component, this structure is described by the <i>FormInterface</i> interface.  The main class that implements this interface is the <i>Form</i> class, which uses three components, with the help of which the whole thing works: <br><ul><li>  <strong>The data mapper</strong> distributes the form data to its child elements.  In addition, it is the responsibility of this component to collect data from child elements back to the form data. </li><li>  Two <strong>chains of data converters</strong> , as the name implies, convert the values ‚Äã‚Äãfor their different representations.  Data transformers ensure that your application receives a value in a strictly defined format, regardless of the format used to represent it. </li><li>  <strong>Event Manager</strong> allows you to run specific code at predetermined stages of form processing.  This approach allows you to adapt the structure of the form under the incoming data, or to filter out these same incoming data, to validate or change them. </li></ul><br><br>  All these components are passed to the <i>Form</i> object constructor and cannot be changed after the form is created, as this may lead to undesirable changes in the form state.  Since the interface of the designer of the <i>Form</i> object is quite complex, the FormBuilder was implemented, which simplifies the creation of instances of these objects. <br><br>  <b>A form view</b> is a data structure that describes a view.  That is, instead of calling the Form class directly in templates, you will work with an instance of the <i>FormView</i> class.  This object stores additional information that is specific only for presentation, such as <i>name</i> attributes for HTML elements of forms, their IDs, etc. <br><br>  The UML diagram below shows the essence of the architecture. <br><br><img src="https://habrastorage.org/storage2/8db/d3c/035/8dbd3c0350578d05090d8a0d8f050536.png" alt="UML architecture diagram"><br><br>  As you can see from this diagram, the life cycle of a form consists of three different views: <br><br><ul><li>  When created, the form is represented as a hierarchy of <i>FormBuilder</i> objects <i>.</i> </li><li>  In the controller, the form is represented by a hierarchy of <i>Form</i> objects. </li><li>  At the view level, it is represented by a hierarchy of <i>FormView</i> objects <i>.</i> </li></ul><br><br>  Since configuring form constructors their presentation is quite tedious, Symfony2 implements the basic types of forms that already implement the basic settings.  Form types support dynamic inheritance.  This means that you can extend various base types based on the options passed to the form constructor.  The following diagram shows all types supplied with Symfony2 (types marked in green come with the kernel, while yellow types come with additional bundles): <br><br><img src="https://habrastorage.org/storage2/e83/140/9f1/e831409f163da2addbef6051af57df37.png" alt="Type hierarchy"><br><br>  Impurities, which we mentioned earlier, are implemented in SYmfony2 as so-called type extensions.  These extensions can be connected to existing types of forms and add some behavior to them.  In Symfony2, for example, there are extensions to add CSRF protection, applied to the type ‚Äúform‚Äù (and as a result, all types that inherit this type). <br><br>  <b>The form factory</b> retrieves the type hierarchy from the loaded extensions, and uses it to customize the <i>FormBuilder</i> and <i>FormView objects</i> .  It is important to note that this stage can be controlled.  For example, the type " <i>choice</i> " allows you to specify in the settings attribute " <i>choices</i> ", which contains all the values ‚Äã‚Äãfor the options that should be displayed. <br><br>  There is another rather important concept of the Form component - <b>type predictors</b> .  These "predictors" are trying to predict the type and options of the form field, based on the metadata taken from the object of the domain of definition to which the form is attached (if, of course, it is fixed).  For example, if any of the properties of our object contains a one-to-many relationship between the Tag object, type predictors will automatically configure this form field for this property so that it is a selection field, with the ability to select multiple values, as well as will use all instances of Tag objects as options for this field.  A similar concept is used in <a href="http://djbook.ru/rel1.4/topics/forms/modelforms.html">ModelForms</a> in the Django framework.  True, there is one rather large difference: type predictors use metadata provided not only by ORM, but also all object metadata.  Symfony2 comes with three type predictors: one uses metadata provided by Doctrine2, the other is provided by Propel, and another uses validation rules. <br><br>  The concepts described above can be described with the following UML diagram. <br><br><img src="https://habrastorage.org/storage2/1bd/551/478/1bd5514787357a92abb00d2d66699f09.png" alt="image"><br><br><h5>  Conclusion </h5><br><br>  What I wanted to show in this post is that the Symfony2 Form component has a well-designed architecture that covers many important aspects of form processing. <br><br>  This architecture solves the <i>problems of insufficient levels of abstractions</i> , <i>specialization</i> and <i>impurities</i> , providing a dynamic inheritance tree of types of forms and their extensions.  It solves the problem of <i>composition</i> , distributing the tasks of processing the form to all its elements.  It also provides a clear <i>separation of tasks</i> between components, so you can replace them with your own.  Using the metadata of the domain objects when creating a form, the described architecture implements <i>data binding</i> to these models, which allows reading and writing data directly.  We also paid attention to <i>dynamic behaviors</i> , providing the ability to track certain events that occur during form processing using our handlers, for example, to validate or filter data. <br><br>  Interested?  <a href="https://github.com/symfony/Form">Learn the code</a> .  <a href="http://symfony.com/doc/current/book/forms.html">Experiment with it</a> .  And help us integrate it into your favorite framework. <br><br>  <i>From the translator: translations of this article exist, but they seemed to me not to be of very high quality.</i>  <i>Yes, and I think it does not hurt.</i>  <i>There are inaccuracies in the translation, therefore I will be grateful if you point them out in the LAN.</i>  <i>Thanks for attention.</i> </div><p>Source: <a href="https://habr.com/ru/post/149444/">https://habr.com/ru/post/149444/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149436/index.html">Bookmarks in Media Player Classic Home Cinema</a></li>
<li><a href="../149437/index.html">Apple offered Samsung to buy a patent license for $ 30 for a smartphone</a></li>
<li><a href="../149438/index.html">Samsung launches EMMC Pro Class 1500 memory modules</a></li>
<li><a href="../149440/index.html">Possible problems with the provider Network Solutions. (DDOS?)</a></li>
<li><a href="../149441/index.html">CSS3: Box-Sizing property</a></li>
<li><a href="../149447/index.html">Wi-Fi: unobvious nuances (for example, home network)</a></li>
<li><a href="../149448/index.html">Nokia Data Gathering: dealing with drought with a mobile phone</a></li>
<li><a href="../149449/index.html">The path of collapse of the viroid ribozyme or news from fronts using RNAInSpace software was obtained.</a></li>
<li><a href="../149450/index.html">Dynamic mat. functions in C ++</a></li>
<li><a href="../149454/index.html">I fell in love with DelegateClass</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>