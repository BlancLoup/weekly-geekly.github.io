<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Tips & tricks in building booklets</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that for several months I was developing bookmarklets, making about a dozen of them. Used both jQuery and native JavaScript. About what...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Tips & tricks in building booklets</h1><div class="post__text post__text-html js-mediator-article">  It so happened that for several months I was developing bookmarklets, making about a dozen of them.  Used both jQuery and native JavaScript.  About what pitfalls I encountered, what I learned and found new - this will be discussed under the cut. <br><a name="habracut"></a><br><h4>  1. Connection </h4><br>  Those who have already engaged in the development of bookmarklets, this item can be skipped, for the rest - a simple example. <br><br><blockquote><code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">a</font> <font color="#ff0000">href</font> <font color="#0000ff">="javascript: (function(){var a=document.createElement('script');a.type='text/javascript';a.src='http://example.com/bookm.js?'+(new Date).getTime()/1E5;document.getElementsByTagName('head')[0].appendChild(a)})();"</font> <font color="#ff0000">onclick</font> <font color="#0000ff">="alert('Drag this button to your browser\'s bookmarks toolbar or right-click it and choose Bookmark This Link.');return false;"</font> <font color="#ff0000">title</font> <font color="#0000ff">="Bookmarklet Title"</font> <font color="#0000ff">&gt;</font> <font color="#0000ff">&lt;</font> <font color="#800000">img</font> <font color="#ff0000">src</font> <font color="#0000ff">="http://example.com/img/bookmarklet.gif"</font> <font color="#ff0000">align</font> <font color="#0000ff">="absmiddle"</font> <font color="#ff0000">alt</font> <font color="#0000ff">="Bookmarklet Title"</font> <font color="#ff0000">border</font> <font color="#0000ff">="0"</font> <font color="#0000ff">/&gt;</font> <br> <font color="#0000ff">&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  "Href" in a more readable form: <br><br><blockquote> <code><font color="black">javascript: ( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> a = <font color="#0000ff">document</font> .createElement( <font color="#A31515">'script'</font> ); <br> a.type = <font color="#A31515">'text/javascript'</font> ; <br> a.src = <font color="#A31515">'http://example.com/bookm.js?'</font> + ( <font color="#0000ff">new</font> Date).getTime() / 1E5; <br> <font color="#0000ff">document</font> .getElementsByTagName( <font color="#A31515">'head'</font> )[0].appendChild(a) <br> })();</font></code> </blockquote> <br>  Here we create the &lt;script&gt; &lt;/ script&gt; element, use our bookmarklet as src, and add it to the page in the &lt;head&gt; &lt;/ head&gt;.  Record 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <blockquote> <code><font color="black">( <font color="#0000ff">new</font> Date).getTime() / 1E5</font></code> </blockquote> <br>  Allows you to always connect the current version of the bookmarklet, avoiding its caching.  If you are not going to change its content often, you can remove it. <br><br>  Such a bookmarklet can be dragged by Drag-and-Drop to toolbars in Chrome, Safari and FireFox.  For IE, you will need to select the option to add to the bookmarks panel in the context menu. <br><br><h4>  2. Structure </h4><br>  So, consider the contents of our bookm.js.  In general, there are two styles of writing bookmarklets: <br><br><h5>  2.1 Functional approach </h5><br><blockquote> <code><font color="black">( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">try</font> { <br> <font color="#008000">//   </font> <br> } <font color="#0000ff">catch</font> (e) { <br> console.log(e.name + <font color="#A31515">": "</font> + e.message); <br> } <br> }())</font></code> </blockquote> <br>  The main advantage of this approach is that the global scope of variables remains absolutely clean; we do not clog it with our own variables.  But this approach only works for small, simple scripts. <br><br><h5>  2.2 Object-oriented approach </h5><br><blockquote> <code><font color="black"><font color="#0000ff">function</font> ourSuperBookmarklet() { <br> <font color="#008000">//  ,  this.a = '10';</font> <br> } <br> <br> ourSuperBookmarklet.prototype.someOtherFunction = <font color="#0000ff">function</font> (abc) { <br> <font color="#0000ff">this</font> .a += abc; <br> } <br> <br> ourSuperBookmarklet.prototype.start = <font color="#0000ff">function</font> () { <br> <font color="#008000">//   </font> <br> <font color="#0000ff">this</font> .someOtherFunction(abc); <br> } <br> <br> <font color="#0000ff">try</font> { <br> <font color="#0000ff">var</font> __osb = <font color="#0000ff">new</font> ourSuperBookmarklet(); <br> __osb.start(); <br> } <font color="#0000ff">catch</font> (e) { <br> console.log(e.name + <font color="#A31515">": "</font> + e.message); <br> }</font></code> </blockquote> <br>  It turned out a little more. <br>  So, here we describe the class, its properties and methods.  Then in the try-catch construction we create an instance of this class and run the loader method. <br>  In this case ourSuperBookmarklet and __osb fall into the global scope, but we really need it (more on that later). <br><br>  We must never forget that our code is injected directly into the site on which the user went, and our errors can break the entire page.  try-catch will help us a little.  The main thing - do not forget to remove all console.log'and from the production version. <br><br><h4>  3. Working with a class instance </h4><br>  Consider this example. <br><br><blockquote> <code><font color="black">ourSuperBookmarklet.prototype.start = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> si = setInterval( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">if</font> (something) { <br> clearInterval(si); <br> <font color="#0000ff">this</font> .a++; <br> } <br> }, 500); <br> }</font></code> </blockquote> <br>  this.a - in this case, we want to refer to the property of our class.  In this record, nothing will come out, because this will be a pointer to the function of the interval.  You can do this: <br><br><blockquote> <code><font color="black">ourSuperBookmarklet.prototype.start = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> th = <font color="#0000ff">this</font> ; <br> <font color="#0000ff">var</font> si = setInterval( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">if</font> (something) { <br> clearInterval(si); <br> th.a++; <br> } <br> }, 500); <br> }</font></code> </blockquote> <br>  And it will work.  However, creating a special variable in each method, so that it is the same everywhere - more like a crutch. <br>  A more elegant solution (IMHO!) Is to refer to a class instance, like this: <br><br><blockquote> <code><font color="black">ourSuperBookmarklet.prototype.start = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> si = setInterval( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">if</font> (something) { <br> clearInterval(si); <br> __osb.a++; <br> } <br> }, 500); <br> }</font></code> </blockquote> <br>  And this is a huge plus of an object-oriented approach.  Perhaps this example is not very convincing, but look here: <br><br><blockquote> <code><font color="black">ourSuperBookmarklet.prototype.someOtherFunction = <font color="#0000ff">function</font> (text, obj) { <br> obj.innerHTML = text; <br> } <br> <br> ourSuperBookmarklet.prototype.start = <font color="#0000ff">function</font> () { <br> <font color="#0000ff">var</font> a = <font color="#0000ff">document</font> .createElement( <font color="#A31515">'div'</font> ); <br> a.innerHTML = <font color="#A31515">'qwerty'</font> ; <br> a.setAttribute( <font color="#A31515">'ommouseover'</font> , <font color="#A31515">'__osb.someOtherFunction(\'asdf\', this);'</font> ) <br> <font color="#0000ff">document</font> .body.appendChild(a); <br> }</font></code> </blockquote> <br>  Thus, we can access the methods and properties of our class from other scripts / events, etc.  What is good. <br><br><h4>  4. AJAX </h4><br>  Here I hurry to upset you.  Your favorite $ .post and $ .get will not work here. <br>  The fact is that at the browser level, the xmlHttpRequest component is prohibited from accessing another domain (this does not apply to all browsers, and it will work somewhere, if you want, check), more details <a href="http://en.wikipedia.org/wiki/Same_origin_policy">en.wikipedia.org/wiki/Same_origin_policy</a> .  And since our code becomes part of the site on which the user is logged in, then accessing our site is an appeal to another domain. <br>  However, not a single xmlHttpRequest.  At one time, I myself came to the method described below, but then I found that this method is quite popular. <br><br><blockquote> <code><font color="black">ourSuperBookmarklet.prototype.request = <font color="#0000ff">function</font> (str) { <br> <font color="#0000ff">var</font> script = <font color="#0000ff">document</font> .createElement( <font color="#A31515">'script'</font> ); <br> script.setAttribute( <font color="#A31515">'type'</font> , <font color="#A31515">'text/javascript'</font> ); <br> script.setAttribute( <font color="#A31515">'src'</font> , str); <br> <font color="#0000ff">document</font> .getElementsByTagName( <font color="#A31515">'head'</font> )[0].appendChild(script); <br> }</font></code> </blockquote> <br>  It's simple, and very similar to how we connected the bookmarklet (see the beginning).  Just if we just need to transfer the data.  And if we want to get a callback?  Here I use 2 methods, and they are both associated with JSON. <br><br><h5>  4.1 JSONP </h5><br>  Take an example from wikipedia.  We have an object <br><br><blockquote> <code><font color="black">{ <font color="#A31515">"Name"</font> : <font color="#A31515">"Cheeso"</font> , <font color="#A31515">"Rank"</font> : 7}</font></code> </blockquote> <br>  And we pass it using a script (in our case, it is created dynamically). <br><br><blockquote> <code><font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">script</font> <font color="#ff0000">type</font> <font color="#0000ff">="text/javascript"</font> <font color="#ff0000">src</font> <font color="#0000ff">="http://server2.example.com/getjson?jsonp=parseResponse"</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">script</font> <font color="#0000ff">&gt;</font></font></code> </blockquote> <br>  As a result, we need to pass <br><br><blockquote> <code><font color="black">parseResponse({ <font color="#A31515">"Name"</font> : <font color="#A31515">"Cheeso"</font> , <font color="#A31515">"Rank"</font> : 7})</font></code> </blockquote> <br>  Where parseResponse is a callback function in the bookmarklet that will process the transferred object.  In our case it would be something like <br><br><blockquote> <code><font color="black">__osb.parseResponse({ <font color="#A31515">"Name"</font> : <font color="#A31515">"Cheeso"</font> , <font color="#A31515">"Rank"</font> : 7})</font></code> </blockquote> <br><h5>  4.2 JSONP, but without P </h5><br>  Everything is good, but how to find out if we could not request the right answer?  For example, our site lay down.  In this case, I use the construct: <br><br><blockquote> <code><font color="black"><font color="#0000ff">var</font> c = 0; <br> <font color="#0000ff">var</font> ci = setInterval( <font color="#0000ff">function</font> () { <br> <font color="#0000ff">if</font> (__osb.getInfo) { <br> clearInterval(ci); <br> <font color="#008000">//  </font> <br> } <br> <br> <font color="#0000ff">if</font> (c &gt; __osb.timeout) { <br> clearInterval(ci); <br> <font color="#008000">//    </font> <br> } <br> c++; <br> }, 1000);</font></code> </blockquote> <br>  Here __osb.timeout is the number of seconds during which we will wait for a response from the server.  The question is what is __osb.getInfo? <br>  Initially (in the class constructor) we initialized getInfo as null.  And the response from the server will be: <br><br><blockquote> <code><font color="black">__osb.getInfo = { <font color="#A31515">"Name"</font> : <font color="#A31515">"Cheeso"</font> , <font color="#A31515">"Rank"</font> : 7}</font></code> </blockquote> <br>  Therefore, as soon as __osb.getInfo becomes non-null, we will finish waiting for it and begin processing the response, otherwise we will display an error message. <br><br><h4>  5. JSON </h4><br>  Since we are talking about JSON, I would like to move a little away from the topic and report the good news.  In the latest versions of popular browsers, a native window.JSON object has appeared that can encode / decode objects / strings. <br>  JSON.stringify is used to encode an object into a string, and JSON.parse for inverse transformation.  A native JSON object performs these transformations faster than our hand-written solutions.  Therefore, I recommend checking for the presence of a window.JSON object, and only if it is not available, use your own conversion solutions. <br><br><h4>  Instead of conclusion </h4><br>  In the examples, I used only native JavaScript, however you can connect your favorite framework before turning on the bookmarklet itself.  The reasons why I usually do not use frameworks: <br><ul><li>  Execution speed  If we have a lot of objects that we often run through, then the issues of processor time and memory come first.  Pure JavaScript will always work faster than frameworks.  Although they are more convenient. </li><li>  Reliability.  Using native functions for working with DOM I guarantee that the script will work the way I want.  You can argue that I have to write a lot of extra code to maintain cross-browser compatibility.  Wake up, people!  For all the time I wrote bookmarklets, I remember one major difference between IE and other browsers (working with selected text) and a couple of small ones. </li><li>  Independence from CDNs.  All you need is a user's browser for work  If you do not use CDN, then this is a serious argument; if you use it, I‚Äôll be a little paranoid and say that theoretically they can also be dropped / broken and so on ... </li><li>  The desire to learn native javascript and DOM.  For me it was an important reason ;-) </li></ul></div><p>Source: <a href="https://habr.com/ru/post/111070/">https://habr.com/ru/post/111070/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111061/index.html">Why does my work environment eat so many resources and how to overcome it?</a></li>
<li><a href="../111063/index.html">Implementing Haskell Integer Arithmetic</a></li>
<li><a href="../111065/index.html">Making a TV program as an extension for chrome</a></li>
<li><a href="../111068/index.html">On ‚Äúintellectual piracy‚Äù and copyright</a></li>
<li><a href="../111069/index.html">Caution: Your iPhone is also celebrating.</a></li>
<li><a href="../111071/index.html">Briefly and quickly deal with C ++ CLI</a></li>
<li><a href="../111072/index.html">"Procons" - choose electronics</a></li>
<li><a href="../111073/index.html">Hotmail users celebrated New Year with an empty box</a></li>
<li><a href="../111075/index.html">TAU-Darwinism</a></li>
<li><a href="../111076/index.html">Secrets of sites</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>