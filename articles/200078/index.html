<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>(Archive) Matreshka.js - Inheritance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article is outdated. The new documentation contains the most current information from this post. See Class . 



- Introduction 
- Inheritance 
- ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>(Archive) Matreshka.js - Inheritance</h1><div class="post__text post__text-html js-mediator-article">  <b>The article is outdated.</b>  <b>The <a href="http://ru.matreshka.io/">new documentation</a> contains the most current information from this post.</b>  <b>See <a href="http://ru.matreshka.io/">Class</a> .</b> <br><br><ul><li>  <a href="http://habrahabr.ru/post/196146/">Introduction</a> </li><li>  <b>Inheritance</b> </li><li>  <a href="http://habrahabr.ru/post/196886/">MK.Object</a> </li><li>  <a href="http://habrahabr.ru/post/198212/">MK.Array</a> </li><li>  <a href="http://habrahabr.ru/post/217241/">Matreshka.js v0.1</a> </li><li>  <a href="http://habrahabr.ru/post/231333/">Matreshka.js v0.2</a> </li><li>  <a href="http://habrahabr.ru/post/231347/">Implement TodoMVC</a> </li></ul><br>  Greetings to all readers and writers of Habr. <br>  <a href="http://habrahabr.ru/post/196146/">In the previous article</a> we talked about the basics of working with the Matryoshka.  In this, I want to tell how to inherit the Nested doll and how to build small applications so far on its base. <br><br>  The nested doll is arranged in the form of a class constructed using the custom function <code>Class</code> .  This is a slightly modified version of the function I <a href="http://javascript.ru/forum/project/37074-xdr-class-%25E2%2580%2594-realizaciya-klassov-s-aksessorami-dlya-ie8.html">wrote about on the javascript.ru forum</a> ( <a href="http://finom.github.io/matreshka/docs/global.html">link to the dock</a> ). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So why classes?  A class is only a word that does not contradict the prototype programming paradigm.  If you look at the documentation of the same Backbone.js, then you will see that they also operate on the word ‚Äúclass‚Äù without any constraints.  We can argue that there are no classes in Javascript, there are constructors, and I agree with you, but, in fact, does this argument make sense?  If the constructor looks like a class, floats like a class, and quacks like a class, then this is probably the class? <br><br>  From the lyrics to the case.  So, the Nested doll is created in the form of a class: <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.MK = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.Matreshka = Class({ ... });</code> </pre><br>  Class argument is a prototype of a constructor that can be defined as: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MyClass = Class({ <span class="hljs-attr"><span class="hljs-attr">constructor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... } });</code> </pre>  ... which then returns from the Class function.  If the constructor is not defined, then it will be an empty function. <br><a name="habracut"></a><br>  One class can be inherited from another class (in this case, <code>MyClass</code> inherited from Nested Doll): <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> MyClass = Class({ <span class="hljs-string"><span class="hljs-string">'extends'</span></span>: MK });</code> </pre><br>  (For <code>'extends'</code> quotes are needed not only to avoid syntax errors (extends is a reserved word), but also to highlight the syntax. Other properties can be without quotes.) <br><br>  When inheriting Matryoshka, there is an important rule: the constructor must always be there and the <a href="http://finom.github.io/matreshka/docs/Matreshka.html"><code>.initMK</code></a> method must be called <a href="http://finom.github.io/matreshka/docs/Matreshka.html"><code>.initMK</code></a> , which, in this case, initializes the pseudo- <code>__id</code> properties: <code>__id</code> (instance id for internal use), the <code>.__events</code> object (event object), and the <code>.__special</code> object (storing values ‚Äã‚Äãof "special" properties, their accessories and associated elements).  The same rule is true for classes, which will be explained in the following articles: <code>MK.Array</code> and <code>MK.Object</code> . <br><habracut><br>  Let's write a trivial application that works with the login form. <br>  (you can immediately look at the result: <a href="http://jsbin.com/qohilowu/1/edit">jsbin.com/qohilowu/1/edit</a> ) <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"login-form"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"user-name"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Username"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Password"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"show-password"</span></span></span><span class="hljs-tag">&gt;</span></span> Show Password <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Sign In"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"submit"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"checkbox"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"remember-me"</span></span></span><span class="hljs-tag">&gt;</span></span> Remember me <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">label</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  (Here, I removed the extra blocks and classes that are responsible only for a nice appearance, the resulting example uses Bootstrap). <br><br>  We have two text fields: login and password.  There are two checkboxes: ‚Äúshow password‚Äù and ‚Äúremember me‚Äù.  There is one button: ‚Äúenter‚Äù.  Let's say that the form validation is completed when the login length is at least 4 characters, and the password length is at least 5 characters. <br><br>  Create a class <code>LoginForm</code> .  In my work, I stick to the rule: one class per one complex element (form, widget ...).  Now <code>LoginForm</code> will be the only class in our tiny application. <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LoginForm = Class( ... );</code> </pre><br>  The first thing we need to do is declare that our class is inherited from the Nested doll: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LoginForm = Class({ <span class="hljs-string"><span class="hljs-string">'extends'</span></span>: MK });</code> </pre><br>  The second is to declare the constructor: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LoginForm = Class({ <span class="hljs-string"><span class="hljs-string">'extends'</span></span>: MK, <span class="hljs-attr"><span class="hljs-attr">constructor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.initMK(); <span class="hljs-comment"><span class="hljs-comment">//     ""  } });</span></span></code> </pre><br>  Next, we tie the elements to the appropriate properties.  Personally, I always put bindings in a separate method, which I call <code>.bindings</code> .  This is a matter of taste and you can, without any problems, bind elements in the constructor (but only after calling <code>.initMK</code> ). <br><pre> <code class="javascript hljs"> ... bindings: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> <span class="hljs-comment"><span class="hljs-comment">//      (.  (1)) // ,     ,  .innerHTML   ,       //  ,               .bindNode( this, '.login-form' ) //        (on, getValue, setValue), //       .bindNode({ userName: this.$( '.user-name' ), // ,      'keyup' password: this.$( '.password' ), // ,      'keyup' showPassword: this.$( '.show-password' ), // ,     'click' rememberMe: this.$( '.remember-me' ), // ,     'click' }) .bindNode( 'isValid', this.$( '.submit' ), { //   (.  (2)) setValue: function( v ) { $( this ).toggleClass( 'disabled', !v ); } }) ; }, ...</span></span></code> </pre><br>  <b>(1)</b> What does the string <code>".bindNode( this, '.login-form' )"</code> mean?  If the current instance is passed as the first argument in <code>.bindNode</code> , the Matryoshka actually binds the special property <code>"__this__"</code> .  This means that the record <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'.login-form'</span></span> );</code> </pre><br>  equivalent to this: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bindNode( <span class="hljs-string"><span class="hljs-string">'__this__'</span></span>, <span class="hljs-string"><span class="hljs-string">'.login-form'</span></span> );</code> </pre><br>  Why do we need a special value <code>"__this__"</code> ?  In order to use the method <code>.$</code> , which allows you to set the context of the bound elements (sandbox).  This binding is optional but desirable.  With it and using the <code>.$</code> method, you can avoid theoretical conflicts binding the same element in different classes. <br>  Method documentation <code>.$</code> : <a href="http://finom.github.io/matreshka/docs/Matreshka.html">Http://finom.github.io/matreshka/docs/Matreshka.html#$</a> <br>  <b>(2)</b> Here we bind the <code>this.$( '.submit' )</code> element to the <code>'isValid'</code> property (which will be described below) in the following way: if <code>isValid == false</code> , then add the <code>'disabled'</code> class to this element, if not, remove this class. <br><div class="spoiler">  <b class="spoiler_title">Remark from the author</b> <div class="spoiler_text">  This article was written before the release of the version in which the abbreviation for the binding that sets the class to the element appeared.  Starting from version 0.1 Matryoshka contains static method MK.binders.className <br>  Reference to documentation: <a href="http://finom.github.io/matreshka/docs/Matreshka.binders.html">finom.github.io/matreshka/docs/Matreshka.binders.html#className</a> <br>  This code is: <br><pre> <code class="javascript hljs">.bindNode( <span class="hljs-string"><span class="hljs-string">'isValid'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.submit'</span></span> ), { <span class="hljs-attr"><span class="hljs-attr">setValue</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> v </span></span></span><span class="hljs-function">) </span></span>{ $( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ).toggleClass( <span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, !v ); } })</code> </pre><br>  You can replace this: <br><pre> <code class="javascript hljs">.bindNode( <span class="hljs-string"><span class="hljs-string">'isValid'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.submit'</span></span> ), MK.binders.className( <span class="hljs-string"><span class="hljs-string">'!disabled'</span></span> ) )</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">About code design</b> <div class="spoiler_text">  Pay attention to how the method is decorated.  In the process of developing applications based on Matryoshka.  I am a big fan of chain <a href="http://en.wikipedia.org/wiki/Method_chaining">chaining of</a> methods ( <a href="http://en.wikipedia.org/wiki/Method_chaining">Method chaining</a> ), therefore, if the method returns nothing specific, then we return <code>this</code> .  The <code>.bindNode</code> method, like many other methods (.set, .defineGetter ...), does just that.  In addition, I took as a rule the design of blocks of chained calls: <br><pre> <code class="html hljs xml"> ( ) [].1() [].2() ... [].N()    ( )</code> </pre> <br>  This makes it easy to find the beginning and end of the chain. <br></div></div><br>  Add <code>.bindings</code> to the constructor: <br><pre> <code class="javascript hljs"> ... constructor: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .initMK() .bindings() <span class="hljs-comment"><span class="hljs-comment">//       .initMK() ; }, ...</span></span></code> </pre><br>  Now we will declare events, and we will also move it to a separate method, which I usually call <code>.events</code> . <br><pre> <code class="javascript hljs"> ... events: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.boundAll().on( <span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> evt </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     (.  (1)) this.login(); evt.preventDefault(); }.bind( this ) ); //     (.  (2)) return this //      "showPassword" (.  (3)) .on( 'change:showPassword', function() { this.bound( 'password' ).type = this.showPassword ? 'text' : 'password'; }, true ) //      "userName"  "password" (.  (4)) .on( 'change:userName change:password', function() { this.isValid = this.userName.length &gt;= 4 &amp;&amp; this.password.length &gt;= 5; }, true ) ; }, ...</span></span></code> </pre><br>  <b>(1)</b> We get a form element (bound to <code>this</code> or <code>'__this__'</code> ), or rather its <code>jQuery</code> instance, and call the <code>jQuery.fn.on</code> method with the <code>'submit'</code> event. <br>  Documentation for the <code>.boundAll</code> method: <a href="http://finom.github.io/matreshka/docs/Matreshka.html">http://finom.github.io/matreshka/docs/Matreshka.html#boundAll</a> <br>  <b>(2)</b> Bind the event handler context with the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/bind">Function.prototype.bind</a> method.  This is needed in order to replace the standard execution context of the event handler (element) with our instance.  IE8 does not support this method, but I strongly recommend that you always use the <a href="https://github.com/kriskowal/es5-shim">es5-shim library</a> (in the following articles you will see how this is good).  I get the element itself using <code>event.target</code> , <code>event.delegatedTarget</code> , so I easily <code>event.delegatedTarget</code> standard context. <br><br><div class="spoiler">  <b class="spoiler_title">About future versions (Already implemented)</b> <div class="spoiler_text">  <s>In the next versions of Matryoshka, an alternative way of adding the DOM event to the bound element will most likely appear.</s>  In version 0.1, this method has already been implemented. <br>  Syntax: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.boundAll().on( <span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... }.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) );</code> </pre><br>  or <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.boundAll( <span class="hljs-string"><span class="hljs-string">'key'</span></span> ).on( <span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... }.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) );</code> </pre><br>  I want to improve a little.  It is planned to do so: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on( <span class="hljs-string"><span class="hljs-string">'submit::__this__'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.on( <span class="hljs-string"><span class="hljs-string">'click::key'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ ... });</code> </pre><br></div></div><br>  <b>(3)</b> Here the comment speaks for itself, with only one remark.  Notice the last argument passed to the <code>.on</code> method (with a value of <code>true</code> ).  This is not the context of the handler (since the type is <code>boolean</code> ), this argument tells us that the handler should be run immediately, immediately after the declaration (that is, you do not need to call <code>.trigger</code> ). <br><br>  <b>(4)</b> When changing the <code>"userName"</code> or <code>"password"</code> properties, we set the <code>'isValid'</code> property to <code>true</code> or <code>false</code> , checking the length of the login and password. <br><br>  Add to the constructor: <br><pre> <code class="javascript hljs"> ... constructor: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .initMK() .bindings() .events() ; }, ...</code> </pre><br><br>  Now we are doing the .login method, which, so far, does not send anything anywhere: <br><pre> <code class="javascript hljs"> ... login: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isValid ) { data = { <span class="hljs-attr"><span class="hljs-attr">userName</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userName, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password, <span class="hljs-attr"><span class="hljs-attr">rememberMe</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rememberMe }; alert( <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify( data ) ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } ...</code> </pre><br><br>  And create an instance of the resulting class: <br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loginForm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoginForm();</code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">All code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LoginForm = Class({ <span class="hljs-string"><span class="hljs-string">'extends'</span></span>: MK, <span class="hljs-attr"><span class="hljs-attr">rememberMe</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">constructor</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .initMK() .bindings() .events() ; }, <span class="hljs-attr"><span class="hljs-attr">bindings</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .bindNode( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">'.login-form'</span></span> ) .bindNode({ <span class="hljs-attr"><span class="hljs-attr">userName</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.user-name'</span></span> ), <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.password'</span></span> ), <span class="hljs-attr"><span class="hljs-attr">showPassword</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.show-password'</span></span> ), <span class="hljs-attr"><span class="hljs-attr">rememberMe</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.remember-me'</span></span> ) }) .bindNode( <span class="hljs-string"><span class="hljs-string">'isValid'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.$( <span class="hljs-string"><span class="hljs-string">'.submit'</span></span> ), { <span class="hljs-attr"><span class="hljs-attr">setValue</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> v </span></span></span><span class="hljs-function">) </span></span>{ $( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ).toggleClass( <span class="hljs-string"><span class="hljs-string">'disabled'</span></span>, !v ); } }) ; }, <span class="hljs-attr"><span class="hljs-attr">events</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.boundAll().on( <span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> evt </span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.login(); evt.preventDefault(); }.bind( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> ) ); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span> .on( <span class="hljs-string"><span class="hljs-string">'change:showPassword'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.bound( <span class="hljs-string"><span class="hljs-string">'password'</span></span> ).type = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.showPassword ? <span class="hljs-string"><span class="hljs-string">'text'</span></span> : <span class="hljs-string"><span class="hljs-string">'password'</span></span>; }, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) .on( <span class="hljs-string"><span class="hljs-string">'change:userName change:password'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isValid = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userName.length &gt;= <span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password.length &gt;= <span class="hljs-number"><span class="hljs-number">5</span></span>; }, <span class="hljs-literal"><span class="hljs-literal">true</span></span> ) ; }, <span class="hljs-attr"><span class="hljs-attr">login</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.isValid ) { data = { <span class="hljs-attr"><span class="hljs-attr">userName</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userName, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password, <span class="hljs-attr"><span class="hljs-attr">rememberMe</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rememberMe }; alert( <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify( data ) ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; } }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> loginForm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LoginForm();</code> </pre><br></div></div><br><br>  Result: <a href="http://jsbin.com/qohilowu/1/edit">jsbin.com/qohilowu/1/edit</a> <br><br><h4>  In conclusion </h4><br>  I noticed an interesting effect.  Despite the four-year experience of programming in Javascript, each time I encounter someone else's code and library, for a certain period of time (from several seconds to several hours), I don‚Äôt understand at all what happens in this code.  But then, having read more lines or having studied the documentation, what seemed incomprehensible to me, becomes completely transparent. <br><br>  With Matryoshka, my code has become several orders of magnitude more stable.  Mistakes made by inattention, almost disappeared.  My client is pleased that I began to do more in less time. <br><br><h5>  What's next? </h5><br>  Surely programmers with experience have noticed a ridiculous data assembly in the <code>.login</code> method. <br><pre> <code class="javascript hljs">data = { <span class="hljs-attr"><span class="hljs-attr">userName</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.userName, <span class="hljs-attr"><span class="hljs-attr">password</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.password, <span class="hljs-attr"><span class="hljs-attr">rememberMe</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.rememberMe };</code> </pre><br>  Wouldn't it be better to create a tool that would know where the state of the application is, and where the data is?  Sending all the data that we got in the class is not very reasonable.  The database is not interested at all whether the password is displayed to the user or not.  The database does not need to know whether the sent data is valid, since the server will still check it again and send a response.  I will describe the solution of this question in the next article, in which I will talk about the class <code>MK.Object</code> . <br><br>  Thank you so much for your attention.  Successful coding. </habracut></div><p>Source: <a href="https://habr.com/ru/post/200078/">https://habr.com/ru/post/200078/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../200060/index.html">Comparing libraries to work with Memcached on Node.JS</a></li>
<li><a href="../200062/index.html">China and the post of Ukraine - why so long?</a></li>
<li><a href="../200064/index.html">It's time to pay: non-standard ways to monetize software and digital content</a></li>
<li><a href="../200074/index.html">Counts for the smallest: DFS</a></li>
<li><a href="../200076/index.html">Usability food court</a></li>
<li><a href="../200080/index.html">How Yandex clouds are arranged: Elliptics</a></li>
<li><a href="../200082/index.html">[Advertising] UPS based on kinetic energy storage</a></li>
<li><a href="../200084/index.html">High Level Programming in 1975</a></li>
<li><a href="../200086/index.html">Corona SDK will support Windows Phone 8 and Windows Store</a></li>
<li><a href="../200088/index.html">Color selection / niche search</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>