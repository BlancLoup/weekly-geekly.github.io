<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How Cloud@mail.ru saved all * my files and what came of it</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once I saw this banner and decided that a free terabyte wouldn't hurt me at all, especially since my archive of photos and documents was just lying on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How Cloud@mail.ru saved all * my files and what came of it</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/08f/4db/f1b/08f4dbf1bbaf412eacc8f76c2d634798.png"><br><br>  Once I saw this banner and decided that a free terabyte wouldn't hurt me at all, especially since my archive of photos and documents was just lying on a terabyte hard drive.  I admit, I was very afraid to put a program with the mail.ru logo on my computer, but my desire for freebies overcame.  I signed up, got a place, installed the client, set it up and forgot. <br><br>  And a few months ago, the inevitable happened - my hard drive with the archive ordered me to live long.  Fortunately, by that time all the files were copied to the cloud and nothing was lost. <br><a name="habracut"></a><br>  After buying a new disk, I reinstalled the cloud client and waited for my files to download.  But after a couple of minutes, I saw that nothing appeared on the disk, but the files are rapidly removed from the Cloud. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>At the end of the article there are <b>UPD</b> , <b>UPD2</b> , <b>UPD3</b> and <b>UPD4</b> , which describes the reasons for this behavior.</i> <i><br></i>  <i><b>TL; DR</b> : false alarm, with files and synchronization, everything is in order, but the user interface and the work of those.</i>  <i>support need to be finalized.</i> <br><br>  As it turned out after talking with those.  support, this is the standard behavior of the client - no matter what folder you feed him, he starts to synchronize it to the cloud, removing from there everything that is not in the folder. <br><br>  Downloading files via WebDav is also impossible: <br><br><img src="https://habrastorage.org/files/f78/f46/a42/f78f46a42b0244349b38b549e903b9bb.png"><br><br>  All that remains is the ability to download files through the web interface.  Files there can be downloaded one at a time, or you can select several files or folders and download them in one archive, which is quite convenient.  The only restriction is that the archive cannot exceed 4GB. <br><br><img src="https://habrastorage.org/files/36f/a28/296/36fa28296aa545588bea4eaf3306fea1.png"><br><br>  I tried to go this way, but quickly realized that this is a very inconvenient option: <br><br><ul><li>  The 4 GB limit means that if you have a terabyte in the cloud, you will need to download at least 250 archives. </li><li>  Each archive must be created manually by selecting folders, considering their total size and marking those that have already been downloaded. </li><li>  Sometimes archives do not open for an unknown reason. </li><li>  Lost folder structure. </li></ul><br>  I still need the files, so I decided to write my tool, and at the same time learn something new.  Well, get pleasure from solving the problem, of course. <br><br>  First of all, you need to understand how to get a list of folders and files.  Initially, I planned to just parse the pages, rip out information about folders and files from them and build a tree.  But, having opened the source code of the page, I immediately saw that the entire interface of working with documents is built through javascript, which, if you think about it, is quite logical. <br><br>  Therefore, I have two possible solutions: connect <br>  <a href="http://docs.seleniumhq.org/projects/webdriver/">Selenium</a> and still build a tree from html or deal with the internal API that is used in the script. <br><br>  I chose the second way, as the most reasonable one - why should I parse something using third-party tools if there is already a ready-made API? <br>  Fortunately, the script was not obfuscated and not even compressed - the original variable and function names and developer comments were available to me, which made the task much easier. <br><br>  After a few minutes of studying, I saw that all available API methods are described in an array: <br><br><img src="https://habrastorage.org/files/434/ca9/878/434ca98782ea4d79a00d61126e0f06e9.png"><br>  <i>That's why I don‚Äôt spend time on beautiful formatting in my code - somebody will surely break it.</i> <br><br>  I reasoned that to get a list of folders and files in a directory, you need to call the <b>folder</b> method.  To do this, send a get request to <i><code>https://cloud.mail.ru/api/v2/folder</code></i> . <br><br>  Open the page in the browser and see the following answer: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"body"</span></span>:<span class="hljs-string"><span class="hljs-string">"user"</span></span>,<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-number"><span class="hljs-number">1457097026874</span></span>,<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">403</span></span>}</code> </pre><br>  Obviously, you need to log in to the portal.  Log in, repeat the request and see another error: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"me@mail.ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"body"</span></span>:<span class="hljs-string"><span class="hljs-string">"token"</span></span>,<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-number"><span class="hljs-number">1457097187300</span></span>,<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">403</span></span></code> </pre><br>  No wonder, a token is required to execute API requests.  There are two suitable methods in the list: <code>tokens/csrf</code> and <code>tokens/download</code> . <br><br>  When you request <i><code>https://cloud.mail.ru/api/v2/tokens/download</code></i> exactly the same token error is given, which means we need a csrf-token. <br><br>  We request it, add the parameter <code>?token=X9ccJNwYeowQTakZC1yGHsWzb7q6bTpP</code> to the call to the <b>folder</b> method and get a new error: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"me@mail.ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"body"</span></span>:{<span class="hljs-string"><span class="hljs-string">"error"</span></span>:<span class="hljs-string"><span class="hljs-string">"invalid args"</span></span>},<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-number"><span class="hljs-number">1457097695182</span></span>,<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">400</span></span>}</code> </pre><br>  Here I had to read the source again to find out what arguments this method takes.  It turned out that you need to specify the folder, the contents of which we want to receive in the <i>home</i> parameter. <br><br>  So, in response to a request on the url <i><code>https://cloud.mail.ru/api/v2/folder?token=X9ccJNwYeowQTakZC1yGHsWzb7q6bTpP&amp;home=/</code></i> , the following object is returned: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"me@mail.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"count"</span></span>: {<span class="hljs-string"><span class="hljs-string">"folders"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"files"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>}, <span class="hljs-string"><span class="hljs-string">"tree"</span></span>: <span class="hljs-string"><span class="hljs-string">"363831373562653330303030"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">"grev"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">978473730</span></span>, <span class="hljs-string"><span class="hljs-string">"sort"</span></span>: {<span class="hljs-string"><span class="hljs-string">"order"</span></span>: <span class="hljs-string"><span class="hljs-string">"asc"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"name"</span></span>}, <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"folder"</span></span>, <span class="hljs-string"><span class="hljs-string">"rev"</span></span>: <span class="hljs-number"><span class="hljs-number">9</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"folder"</span></span>, <span class="hljs-string"><span class="hljs-string">"home"</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">"list"</span></span>: [{ <span class="hljs-string"><span class="hljs-string">"count"</span></span>: {<span class="hljs-string"><span class="hljs-string">"folders"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"files"</span></span>: <span class="hljs-number"><span class="hljs-number">3</span></span>}, <span class="hljs-string"><span class="hljs-string">"tree"</span></span>: <span class="hljs-string"><span class="hljs-string">"363831373562653330303030"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"grev"</span></span>: <span class="hljs-number"><span class="hljs-number">17</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">492119223</span></span>, <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"folder"</span></span>, <span class="hljs-string"><span class="hljs-string">"rev"</span></span>: <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"folder"</span></span>, <span class="hljs-string"><span class="hljs-string">"home"</span></span>: <span class="hljs-string"><span class="hljs-string">"/"</span></span> }, { <span class="hljs-string"><span class="hljs-string">"mtime"</span></span>: <span class="hljs-number"><span class="hljs-number">1456774311</span></span>, <span class="hljs-string"><span class="hljs-string">"virus_scan"</span></span>: <span class="hljs-string"><span class="hljs-string">"pass"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">".mp4"</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span>: <span class="hljs-number"><span class="hljs-number">486354507</span></span>, <span class="hljs-string"><span class="hljs-string">"hash"</span></span>: <span class="hljs-string"><span class="hljs-string">"C2AD142BDF1E4F9FD50E06026BCA578198BFC36E"</span></span>, <span class="hljs-string"><span class="hljs-string">"kind"</span></span>: <span class="hljs-string"><span class="hljs-string">"file"</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"file"</span></span>, <span class="hljs-string"><span class="hljs-string">"home"</span></span>: <span class="hljs-string"><span class="hljs-string">"/.mp4"</span></span> }] }, <span class="hljs-string"><span class="hljs-string">"time"</span></span>: <span class="hljs-number"><span class="hljs-number">1457097848869</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> }</code> </pre><br>  Information about files and directories - what you need! <br><br>  The efficiency of the API is confirmed, the scheme of its work is clear - you can start writing a program.  I decided to write a console application in php, because I know this language well.  The Conm component from symfony is ideal for this task.  I already wrote console commands for <a href="https://laravel.com/">Laravel</a> , which are built just on this component, but there the level of abstraction is quite high and I did not work directly with it, so I decided that it was time to get to know each other better. <br><br>  I will not retell the documentation, it is quite detailed and very simple.  Without knowing anything about the component, in a few hours I wrote these simple interfaces: <br><br><img src="https://habrastorage.org/files/7d2/e5f/101/7d2e5f101ca846b2bb7ef063c6bb5697.png"><br>  <i>It looks like the application in the process of downloading files.</i> <br><br><img src="https://habrastorage.org/files/7fb/26f/161/7fb26f16162a4defbe37cc2ce3309173.png"><br>  <i>And so on completion: a small table is shown (maximum 100 lines) with information about the downloaded files.</i>  <i>It is of no practical use and is made solely for educational purposes.</i> <br><br>  The <i>console application</i> may include several <i>commands</i> called as follows: <code>php app.php command argument --option</code> .  But for my purposes only one command is needed and I would like to start the download like this: <code>php app.php argument --option</code> .  This is easily achieved with the <a href="http://symfony.com/doc/current/components/console/single_command_tool.html">instruction</a> from the component documentation. <br><br>  So, the console application is ready, it displays information from pre-prepared fixtures and is even covered with <a href="https://phpunit.de/">tests</a> .  It's time to implement directly getting information about files and folders from the cloud. <br><br>  Here, I also did not reinvent the wheel and used the excellent <a href="http://docs.guzzlephp.org/en/latest/">Guzzle</a> library.  With its help it is very convenient to send http requests, while it uses the interfaces <a href="http://www.php-fig.org/psr/psr-7/">PSR-7</a> . <br><br>  When authorizing from the main mail.ru page, a post-request is sent to <i><code>https://auth.mail.ru/cgi-bin/auth</code></i> , containing the <i>Login</i> and <i>Password</i> fields. <br><br><div class="spoiler">  <b class="spoiler_title">Here is the authorization method in my application.</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@throws</span></span></span><span class="hljs-comment"> InvalidCredentials */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">auth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $expectedTitle = sprintf(<span class="hljs-string"><span class="hljs-string">' - %s -  Mail.Ru'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;login); $authResponse = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;http-&gt;post( <span class="hljs-keyword"><span class="hljs-keyword">static</span></span>::AUTH_DOMAIN . <span class="hljs-string"><span class="hljs-string">'/cgi-bin/auth'</span></span>, [ <span class="hljs-string"><span class="hljs-string">'form_params'</span></span> =&gt; [ <span class="hljs-string"><span class="hljs-string">'Login'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;login, <span class="hljs-string"><span class="hljs-string">'Password'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;password, ] ] ); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-comment"><span class="hljs-comment">// http://php.net/manual/en/domdocument.loadhtml.php#95463 libxml_use_internal_errors(true); $this-&gt;dom-&gt;loadHTML($authResponse-&gt;getBody()); $actualTitle = $this-&gt;dom-&gt;getElementsByTagName('title')-&gt;item(0)-&gt;textContent; } catch (\Exception $e) { throw new InvalidCredentials; } if ($actualTitle !== $expectedTitle) { throw new InvalidCredentials; } }</span></span></code> </pre><br>  Since in response to an authorization request, several redirects are returned, which eventually lead to the user's mailbox, I decided to simply check the page title to determine if the authorization was successful. <br><br>  The check is so simple that now it fails if there are unread letters in the mailbox - their number is displayed in the page header.  But I do not use the box, so for my purposes it is enough. <br></div></div><br>  Then I tried to request a csrf-token, but was surprised to get a familiar error: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">403</span></span>,<span class="hljs-string"><span class="hljs-string">"body"</span></span>:<span class="hljs-string"><span class="hljs-string">"user"</span></span>}</code> </pre><br>  I debugged the requests and saw that the authorization was successful, but, nevertheless, the token was not given to me.  It is very similar to the problem with cookies and it turns out that they are turned off by default in Guzzle and need <a href="http://docs.guzzlephp.org/en/latest/quickstart.html">to</a> be <a href="http://docs.guzzlephp.org/en/latest/quickstart.html">turned on by hand</a> . <br><br>  The easiest way to do this is once the client is initialized: <br><br><pre> <code class="php hljs">$client = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \GuzzleHttp\Client([<span class="hljs-string"><span class="hljs-string">'cookies'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>]);</code> </pre><br>  <i>Another initialization parameter is <b>'debug' =&gt; true</b> , with it the debugging of requests is almost painless.</i> <br><br>  After setting up the cookies, I tried again to get the token and received an authorization error in response that I had not encountered before: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"email"</span></span>:<span class="hljs-string"><span class="hljs-string">"me@mail.ru"</span></span>,<span class="hljs-string"><span class="hljs-string">"body"</span></span>:<span class="hljs-string"><span class="hljs-string">"nosdc"</span></span>,<span class="hljs-string"><span class="hljs-string">"time"</span></span>:<span class="hljs-number"><span class="hljs-number">1457097187300</span></span>,<span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">403</span></span>}</code> </pre><br>  After reading the source code and monitoring the authorization process, I saw that <b>sdc</b> is another cookie that is obtained by a separate request when the application starts: <i><code>https://auth.mail.ru/sdc?from=https://cloud.mail.ru/home</code></i> . <br><br>  I added this request after the authorization request and finally was able to get the token.  Well, then the matter of technology is to request the contents of the root folder and recursively the contents of its subfolders, and the tree is ready. <br><br>  As it turned out, the tree in the end did not even need - each file stores the full path from the root, therefore, to download a fairly flat list. <br><br>  The download mechanism is a bit tricky: you must first request the recommended shard (something similar to <i><code>https://cloclo28.datacloudmail.ru/get/</code></i> ) and then download the file. <br><br>  Considering that the addresses of shards differ only in numbers, I think it would be possible not to bother and address the address, but if you do, then do it to the end! <br><br>  To get an array of shards you need to run the <b>dispatcher</b> method ( <i><code>https://cloud.mail.ru/api/v2/dispatcher?token=X9ccJNwYeowQTakZC1yGHsWzb7q6bTpP</code></i> ): <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"me@mail.ru"</span></span>, <span class="hljs-string"><span class="hljs-string">"body"</span></span>: { <span class="hljs-string"><span class="hljs-string">"video"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo22.datacloudmail.ru/video/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"view_direct"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"250"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"http://cloclo18.cloud.mail.ru/docdl/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"weblink_view"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"50"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo18.datacloudmail.ru/weblink/view/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"weblink_video"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"3"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo18.datacloudmail.ru/videowl/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"weblink_get"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo27.cldmail.ru/2yoHNmAc9HVQzZU1hcyM/G"</span></span>}], <span class="hljs-string"><span class="hljs-string">"weblink_thumbnails"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"50"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo3.datacloudmail.ru/weblink/thumb/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"auth"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"500"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://swa.mail.ru/cgi-bin/auth"</span></span>}], <span class="hljs-string"><span class="hljs-string">"view"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"250"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo2.datacloudmail.ru/view/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"get"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"100"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo27.datacloudmail.ru/get/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"upload"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"25"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo22-upload.cloud.mail.ru/upload/"</span></span>}], <span class="hljs-string"><span class="hljs-string">"thumbnails"</span></span>: [{<span class="hljs-string"><span class="hljs-string">"count"</span></span>: <span class="hljs-string"><span class="hljs-string">"250"</span></span>, <span class="hljs-string"><span class="hljs-string">"url"</span></span>: <span class="hljs-string"><span class="hljs-string">"https://cloclo3.cloud.mail.ru/thumb/"</span></span>}] }, <span class="hljs-string"><span class="hljs-string">"time"</span></span>: <span class="hljs-number"><span class="hljs-number">1457101607726</span></span>, <span class="hljs-string"><span class="hljs-string">"status"</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> }</code> </pre><br>  <i>We are interested in an array stored in <b>get</b> .</i> <br><br>  Choose a random item from the shard array, add the file address to it and the download link is ready! <br>  To save memory, you can immediately indicate where Guzzle should write the answer when creating a request, using the <a href="http://docs.guzzlephp.org/en/latest/request-options.html"><b>sink</b></a> parameter. <br><br>  The final code is posted on <a href="https://github.com/alexey-m-ukolov/cloud.mail.ru-downloader">GitHub</a> under the MIT license, I will be glad if it is useful to someone. <br><br>  The application is far from ideal, its functionality is limited, there are definitely bugs in it and the test coverage leaves much to be desired, but it solved my task 100%, and this is what <a href="https://en.wikipedia.org/wiki/Minimum_viable_product">MVP</a> requires. <br><br>  <i>PS I want to express the same thanks to Mail.ru for the fact that, firstly, along with the cloud client, I have never established Amigo, and secondly, because they saved me from losing the entire home archive (even not sure which of these is more important).</i>  <i>But still, out of harm's way, I decided to move to a cloud of another company: 200 rubles a month - a small fee for the fact that I did not have to repeat this attraction again.</i> <br><br>  <i>* All that did not have time to first remove.</i> <br><br>  <b>UPD: Communication with those.</b>  <b>support.</b> <br><br><div class="spoiler">  <b class="spoiler_title">[[[[I have problems with synchronization ..., another problem, Feedback Form]]]]</b> <div class="spoiler_text">  Good day. <br>  I replaced the hard drive on which the cloud folder was located.  The old disk broke, so there is no possibility to transfer data from it.  In the web interface, all my data is in place. <br>  When I created an empty folder on the new disk and set it up in the application, files in the cloud began to be deleted during synchronization. <br>  How do I set up an application on my computer so that it considers the main copy of the web, and not an empty folder - that is, it would start downloading files to the computer, rather than deleting them in the cloud. <br>  I tried to download files through the browser, but this is unreal - there are a lot of them. <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">support@cloud.mail.ru 12/29/15</b> <div class="spoiler_text">  Hello. <br><br>  Unfortunately, recover deleted files simultaneously in the Cloud and on the PC <br>  can not. <br><br>  By default, between the web interface and the application on the computer <br>  full two-way synchronization is performed - if you delete a file from <br>  Clouds in the web-interface, the file is deleted in the application, as well <br>  on the contrary: deleting a file in the application, you delete the file in the Cloud. <br><br>  You can set up custom sync in the Cloud PC client.  For this <br>  click on the Clouds icon (in the system tray) with the right mouse button and <br>  Go to the "Select folders" section. <br>  In the window that opens, uncheck the checkboxes in front of those folders, synchronization for <br>  which you want to cancel and click "Select". <br>  If the folder was previously synchronized, it will be deleted from your <br>  computer, but in the web interface Clouds folder, as well as all contained in <br>  her files will be saved. <br>  To re-enable synchronization for a previously deleted folder, click on <br>  right-click the Clouds app icon, click ‚ÄúSelect Folders‚Äù and <br>  check the box next to the name of the desired folder. <br><br>  You can also temporarily disable syncing.  To do this, click on <br>  icon of the Clouds application, right-click and select ‚ÄúSuspend <br>  synchronization. <br><br>  You can read more about synchronization in the Help system. <br>  <a href="http://help.mail.ru/cloud_web/synch">help.mail.ru/cloud_web/synch</a> <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Alexey Ukolov 12/29/15</b> <div class="spoiler_text">  Perhaps I have not quite clearly identified my problem, I will try to rephrase. <br><br>  All my files are currently in the cloud.  I bought a new HDD and I want to download these files to it.  But when I created an empty folder on it and indicated it in the application, instead of downloading files from the cloud to the computer, the files began to be deleted from the cloud. <br><br>  How do I start the process in the opposite direction - download everything from the cloud to a computer without using the web interface. <br><br>  If this cannot be done through the application, are there any alternative tools?  WebDav, as I understand it, is not yet implemented? <br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">support@cloud.mail.ru 12/29/15</b> <div class="spoiler_text">  Hello. <br><br>  Currently this functionality is missing. <br><br>  Your comment has been submitted to the developers. <br></div></div><br><br>  <b>UPD2:</b> The problem is still reproduced, representatives of Cloud@mail.ru say that this is an atypical behavior and the problem is local, there are messages in the comments that synchronization with an empty folder works as it should. <br>  Added video <a href="https://youtu.be/dTF9UCdN2S8">sample</a> : <a href="https://youtu.be/dTF9UCdN2S8">youtu.be/dTF9UCdN2S8</a> <br>  <i>I apologize for the watermarks and the overall quality, just proof of concept.</i> <br><br>  <b>UPD3:</b> On the laptop, where the cloud client had never stood before, downloaded the latest version from the official site, installed, launched.  When you select an existing folder, the history repeats itself: files instead of downloading begin to be deleted.  I tried not to create a folder - similarly. <br><br>  <b>UPD4:</b> <a href="https://habrahabr.ru/users/bulldozavr/" class="user_link">Bulldozavr</a> wrote that, it seems, this removes the system files <b>Thumbs.db</b> and <b>desktop.ini</b> .  I started the synchronization and did not stop it - indeed, periodically such files were visible in the status (but because the context menu is limited in width, and there is no available log file, the user can make sure that <i>only</i> these files are deleted). <br>  After a couple of minutes, all the system files, apparently, were removed and the download started from the cloud to the computer, as it should be. <br>  The verdict is the following: synchronization works fine, although at first the user is frightened of deleting files from the cloud;  those.  support works badly. <br>  Well, my experience of writing console applications in php is not going anywhere :) </div><p>Source: <a href="https://habr.com/ru/post/278849/">https://habr.com/ru/post/278849/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../278839/index.html">Gigabit Wi-Fi in Russia</a></li>
<li><a href="../278841/index.html">Database Testing Developer Version</a></li>
<li><a href="../278843/index.html">Installing and configuring GitLab + Redmine collaboration on Debian 8 jessie + Nginx - Part 1</a></li>
<li><a href="../278845/index.html">Alljoyn: embedded view of the developer. Part 2: Linux to help us</a></li>
<li><a href="../278847/index.html">How can you simplify your life using Telegram-bot</a></li>
<li><a href="../278853/index.html">Obstacle Chase</a></li>
<li><a href="../278855/index.html">Do not miss the details about the new SQL Server 2016 and Linux support, see the online event on March 10 at 18:00 (MCK)</a></li>
<li><a href="../278857/index.html">Microsoft fixed another Stuxnet-like vulnerability in Windows</a></li>
<li><a href="../278859/index.html">Asterisk and information about incoming calls in the browser via Notifications</a></li>
<li><a href="../278863/index.html">An example of game development based on Google Analytics data</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>