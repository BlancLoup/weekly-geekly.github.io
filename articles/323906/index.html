<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Monitoring windows service using Zidium</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. In this article I will tell you how to control the operation of the windows-service using the Zidium monitoring system. 

 Why monitoring? 
 Fi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Monitoring windows service using Zidium</h1><div class="post__text post__text-html js-mediator-article">  Hello.  In this article I will tell you how to control the operation of the windows-service using the Zidium monitoring system. <br><br><h2>  Why monitoring? </h2><br>  First, what is monitoring and why is it needed at all?  I had an order for an application that should collect data from several systems, perform analytics, and send data to the report system.  I implemented the application as a windows-service, deployed it on a hosting.  The customer transferred further support of the service to me at an outsourcing, that is, I am responsible for its efficiency and for correcting errors. <br><br>  But the question arose - how can I track possible problems with the service? 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What if the service stops due to an internal error or hangs?  I will not find out about this until the customer claims that the data has not been updated for several days.  In addition, I need data on errors that occur, logs for analysis, etc. <br><a name="habracut"></a><br>  What information about the status of the service I want to have: <br><br><ul><li>  Activity signal tracking (called heartbeat, heartbeat).  If the service stops, the signal will stop flowing and it will become clear - something is wrong. </li><li>  Collect detailed error information.  I need to fix them.  So you need as much data as possible - time, message, stack, etc. </li><li>  Logging in the cloud.  Why not a file?  The service works on the combat server, only the admin has access to it.  Admin is a busy person, logs he has no time to search and send to me.  Or it turns out that the logs are too big and are not sent via corporate mail.  In general, everything is difficult with the file. </li><li>  Notifications of problems by email and, well, by sms.  To me - about errors, to the administrator - about stopping the service. </li><li>  Some statistics on performance - measuring the execution time of key data processing sites.  This is useful to me for optimizations. </li><li>  Well, it is highly desirable to have all this in one place, and not in different accounting systems. </li></ul><br>  This is where monitoring systems come to the rescue.  For this project, I chose <a href="http://zidium.net/%3Fipartner%3D469622fe-32b9-4b7c-81b6-0366363a288b">monitoring Zidium</a> .  This is a cloud monitoring system that can be used completely free of charge for an unlimited time.  He has everything I need in one bottle. <br><br><h2>  How it works </h2><br>  Let's look first at the source code of the service, without monitoring.  The service is written in C # in VS 2015 environment. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/300/992/7c7/3009927c7aa69b23889b35a00a753256.png" alt="image"><br><br>  Everything is standard for windows - a stream, an infinite loop with interruption of work, some delay at the end of the iteration. <br><br>  The loop executes methods that collect, process, and send data.  What exactly they do for this article does not matter. <br><br>  Connect Zidium to the project.  This is done using the Nuget package.  It adds the dll and the zidium.xml file with the settings.  In the xml-file, I set the account access parameters.  It is possible not to use the file, but to set everything programmatically, but it seemed to me that such a config is more correct. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/688/620/06b/68862006b49ee476360f2a590f8163ac.png" alt="image"><br><br>  All examples of use I took from the documentation on the site Zidium. <br><br>  First, create an auxiliary class that will connect to the system and get the ‚Äúcomponent‚Äù.  In my case, the component is the service itself.  Here everything is as recommended in the documentation, corrected only the names. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a6c/c59/3fe/a6cc593fe641259963f0bf3cba0cb919.png" alt="image"><br><br>  To check the creation of the component, I inserted the receipt of the component into the service start method and called the IsFake method (the fact that the component on the Zidium side is created only when some real work is done with it).  For normal operation, this is not necessary; after the test, this call can be deleted. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d3/094/1dd/4d30941dd2c1b48832c11d5bbf51caf5.png" alt="image"><br><br>  After launching a component appeared in the personal account. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a6f/874/bbe/a6f874bbef8e6ab14486419eab8f7d53.png" alt="image"><br><br>  His color is gray, because we have not yet transmitted any data. <br><br><h2>  Activity signal (HeartBeat) </h2><br>  Now let's add an activity signal.  The so-called ‚Äúunit tests‚Äù are used for this. <br><br>  At the very beginning, you need to create the check itself for the ‚Äúcomponent‚Äù and store it in a variable. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/91a/952/a90/91a952a909fe9f586052d9ddb4bf7ab4.png" alt="image"><br><br>  Now in each iteration of the working cycle we send the result of the check that the service works as it should.  In this case, I specify the time of relevance.  This is exactly the time after which the system will raise the alarm if the next signal is not received. <br><br>  My data is collected once an hour, so I indicated the relevance of 2 hours - a margin for 1 work cycle.  For good, of course, we must take into account the real time of the methods, but I decided not to complicate things. <br><br>  We start the service, and in the personal account we see the green component and the green check.  All is well. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8ac/dab/2f3/8acdab2f38a39a13c3439c2de1621ddb.png" alt="image"><br><br>  For the test, I indicated the time of relevance of 1 minute (so as not to wait long) and stopped the service. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/301/f5b/85b/301f5b85bbedcbdbe607facd443a4b86.png" alt="image"><br><br>  After a minute, the components with the test turned red, and I received an email with a notification that there was no signal. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9c2/b90/1ac/9c2b901ac0b44c7b640e6b1bc5b3eb5c.png" alt="image"><br><br>  All notifications are quite flexible, and you can receive them by email and by sms.  Each user has their own contacts and their notification settings.  Ok, this problem is solved. <br><br><h2>  Errors </h2><br>  Now let's deal with errors.  Everything is easier here. <br><br>  try {} and in catch we send an error.  There is a convenient ready method which from Exception selects the message, a stack, etc.  and forms an error. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b93/6d4/b11/b936d4b11eabe08eaa16bad4af45248b.png" alt="image"><br><br>  For the test, I just called throw new Exception () in the body of the loop.  Here is the error in your account: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a1b/623/e69/a1b623e691f1aa86a7a4d81972c2353b.png" alt="image"><br><br>  Again, I get notified about it if I need it. <br><br>  It must be said that Zidium quite intellectually understands that several errors are in fact one and the same.  Such errors are combined into one, which is very convenient.  And the spam from the notifications will not be either. <br><br><h2>  Log </h2><br>  Next, we have a log.  Working with the log is done in the same way as other logging libraries, such as nLog or Log4Net.  Just write what we want, indicating the level (importance) of the record. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a07/eee/20d/a07eee20d12b8acc40224acf7b5420e0.png" alt="image"><br><br>  Bonus - for each log entry you can attach any number of additional properties into which you can put anything - for example, xml.  They do not litter the log itself, but they can always be viewed. <br><br>  This is what the log in your account looks like: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/210/3a4/55d/2103a455dab85116bc695849802845ab.png" alt="image"><br><br>  For me, this is much more convenient than reading huge test files. <br><br>  In addition to the cloud log, Zidium also writes a classic file log just in case (although this can be turned off).  It's nice that you do not need to connect other logging libraries.  Still, the file log may be useful in extreme cases, for example, if there was no connection to the cloud. <br><br><h2>  Performance </h2><br>  Finally, performance statistics.  For this, ‚Äúmetrics‚Äù are used.  I measure the total work time of the methods of interest to me. <br><br>  The metric has a name and a value, and it is sent like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e08/592/b22/e08592b222536773969e408f49c2a53f.png" alt="image"><br><br>  In your personal account you can see in detail the entire history of the metric. <br><br>  The main units for the selected period are immediately considered - maximum, minimum and average. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/67c/54b/2ca/67c54b2ca0ea0ffe46124992e905e660.png" alt="image"><br><br>  Sorry, you can not download data in xlsx or csv format, it could be useful for your own analysis. <br><br>  Even for metrics, you can configure the rules of warnings about the output values ‚Äã‚Äãfor the selected range.  Then the metrics will also receive notifications.  But I did not use it, it is useful for me to just have statistics on the time of work. <br><br><h2>  Total </h2><br>  My service sends an activity signal to monitoring, collects errors, writes a cloud log, and keeps performance statistics. <br><br>  I will receive a notification if the service suddenly stops or hangs.  I will receive a notification if any error occurs. <br><br>  Now I am calm for the work I have done and for fulfilling obligations to the customer) </div><p>Source: <a href="https://habr.com/ru/post/323906/">https://habr.com/ru/post/323906/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../323896/index.html">Online tools for the simplest Pentest</a></li>
<li><a href="../323898/index.html">Blast-off. From idea to release</a></li>
<li><a href="../323900/index.html">PG Metricus - collecting metrics from plpgsql code or as three lines of code simplified life</a></li>
<li><a href="../323902/index.html">New law on online cash registers: how the service of commercial equipment changes</a></li>
<li><a href="../323904/index.html">Position-independent code (PIC) in shared libraries</a></li>
<li><a href="../323908/index.html">Spotify: Google Cloud event subsystem migration (part 3)</a></li>
<li><a href="../323910/index.html">IBM Watson will work as a tax specialist</a></li>
<li><a href="../323912/index.html">Dark secrets of the "bright budget"</a></li>
<li><a href="../323914/index.html">Explain the effect of the last line</a></li>
<li><a href="../323916/index.html">Construction of DMZ DMZ in ACS TP systems using Modbus and IEC-60870-5-104 protocols</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>