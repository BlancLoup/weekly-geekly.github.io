<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Restoring open files but deleted from the linux file system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Happy New Year to all! 
 In this post I would like to share how you can restore an open file in linux. 

 Prehistory 
 A man entered the debian channe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Restoring open files but deleted from the linux file system</h1><div class="post__text post__text-html js-mediator-article">  Happy New Year to all! <br>  In this post I would like to share how you can restore an open file in linux. <br><br><h4>  Prehistory </h4><br>  A man entered the debian channel dedicated to jabber and said that they had hacked it with jabber-bot and executed the command: <br><pre><code class="bash hljs">$ rm -rf /*</code> </pre> <br>  since this was not done under the root, there should be no special problems, but the bot configuration files are removed.  The bot remained running and the task was to restore the files opened by it and try to raise everything as quickly as possible with the same settings. <br><a name="habracut"></a><br><h4>  Restore file </h4><br>  First of all, we need to make sure that we have the <strong>lsof</strong> application and mount the <strong>procfs</strong> in <strong>/ proc</strong> . <br>  In this note, I will assume that in the system where the open files will be restored, all the necessary applications are installed, root access is available, everything is mounted as needed. <br><br>  First we need to find the open file using the lsof program: <br><pre> <code class="bash hljs">$ sudo lsof | grep filename</code> </pre> <br>  Example: <br><pre> <code class="bash hljs">$ sudo lsof | grep /home/anton/.xsession-errors kwin 2031 4002 anton 2w REG 253,3 4486557 1835028 /home/anton/.xsession-errors</code> </pre> <br>  We are interested in these values: <br><ul><li>  Process Number (pid) </li><li>  File descriptor </li></ul><br>  Here I will highlight what is needed in bold: <br><blockquote>  kwin <strong>2031</strong> 4002 anton <strong>2</strong> w REG 253.3 4486557 1835028 /home/anton/.xsession-errors </blockquote><br>  Then restore it (you can also save it elsewhere): <br><pre> <code class="bash hljs">$ sudo cp /proc/2031/fd/2 /home/anton/.xsession-error</code> </pre> <br>  That's all, so you can restore the open file, but which for some reason was deleted. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>UPD1</b> : I was asked how to find and restore all open files with a specific application. <br>  Suppose we know 1 file to be restored, we found it using <br><pre> <code class="bash hljs">$ sudo lsof | grep /home/anton/.xsession-errors kwin 2031 anton 2w REG 253,3 4486557 1835028 /home/anton/.xsession-errors</code> </pre> <br>  We know that 2031 is the pid of the process that holds your file.  We need to find all the files that keep this process open: <br><pre> <code class="bash hljs">$ sudo lsof -p 2031</code> </pre> <br>  We see all open applications by this process, it remains for us only to select the deleted ones: <br><pre> <code class="bash hljs">$ sudo lsof -p 2031 | grep deleted</code> </pre> <br>  Then just restore all the files as described above. <br><br>  <b>UPD2</b> : Why do I use <b>grep</b> to search for files instead of a parameter that works faster? <br>  I use grep because I can see if the file was deleted or not, I find it more convenient (IMHO) <br><br>  <b>UPD3</b> : You can also view all open process files via the <b>ls command</b> , the <b>deleted</b> marks will be, for example: <br><pre> <code class="bash hljs">$ ls -lia /proc/2031/fd/</code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/208104/">https://habr.com/ru/post/208104/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208090/index.html">A few words about pattern recognition</a></li>
<li><a href="../208092/index.html">Learning OpenCV Cascade Haar</a></li>
<li><a href="../208094/index.html">Making a simple level editor based on the Inkscape plugin.</a></li>
<li><a href="../208096/index.html">Disable RC4 encryption in Firefox</a></li>
<li><a href="../208100/index.html">How to choose a name for an IT product and IT company</a></li>
<li><a href="../208106/index.html">Introducing Cisco TelePresence</a></li>
<li><a href="../208108/index.html">Computer control with the eyes - a practical implementation</a></li>
<li><a href="../208110/index.html">The experience of creating a robot. Part 1</a></li>
<li><a href="../208112/index.html">Module for determining the sources of site visitors for Ruby on Rails</a></li>
<li><a href="../208114/index.html">Dances with a tambourine on New Year's Eve or the second life of old cars</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>