<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write the application for Android on Ruby (Ruboto)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I somehow had an idea (or a calculation on mobile platforms) to write applications for android on my favorite ruby. And then I remembered the project ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write the application for Android on Ruby (Ruboto)</h1><div class="post__text post__text-html js-mediator-article">  I somehow had an idea (or a calculation on mobile platforms) to write applications for android on my favorite ruby.  And then I remembered the project that was mentioned several times in the <a href="http://rubynoname.ru/">RubyNoName</a> podcast, the actual discussion will be about <a href="http://ruboto.org/">Ruboto</a> . <br><img src="https://habrastorage.org/storage2/86b/264/f98/86b264f98cbb0181882bea406006f0dc.png"><br><a name="habracut"></a><br>  Well, let's get started.  For programming, we need: <br><ol><li>  JDK </li><li>  Android SDK </li><li>  Juby </li><li>  Gem ruboto </li></ol><br>  I will not begin to paint the installation, I will give a link to sufficiently detailed <a href="https://github.com/ruboto/ruboto/wiki/Getting-started-with-Ruboto">documentation.</a> <br>  After everything is installed, we generate the basis of our application. <br><pre><code class="ruby hljs">ruboto gen app --package ru.nitrodev.demo_app</code> </pre> <br>  Go to the <code>demo_app</code> directory and admire the carefully prepared application structure.  In the <code>src</code> folder is already our first activation, and we‚Äôll move on to it. <br>  As an example I will sort out such basic things as: <br><ol><li>  Interface creation </li><li>  Play audio using MediaPlayer </li><li>  Create Activate </li><li>  Determining the coordinates of the touch screen </li><li>  Work with Intent (page opening, dialing) </li><li>  Menu creation </li></ol>  Let's go in order. <br><br><h4>  Interface creation </h4><br>  In any application, we need an interface, we can use the standard way to create an interface using an XML resource, but then we lose all the flexibility of ruby.  Therefore, the interface will be described in the code, for this we can call the Android API, or use <code>ruboto/widget.rb</code> which is a wrapper over the API and provides a simple DSL to create the interface. <br>  Consider first the first method on the example of creating a LinearLayout containing one text field and 4 buttons. <br>  First we import the necessary interface components. <br><pre> <code class="ruby hljs">java_import <span class="hljs-string"><span class="hljs-string">"android.widget.Button"</span></span> java_import <span class="hljs-string"><span class="hljs-string">"android.widget.TextView"</span></span> java_import <span class="hljs-string"><span class="hljs-string">"android.widget.LinearLayout"</span></span></code> </pre><br>  We describe the interface itself <br><pre> <code class="ruby hljs"> ll = LinearLayout.new(@ruboto_java_instance) ll.orientation = LinearLayout::VERTICAL tv = TextView.new(@ruboto_java_instance) tv.text = <span class="hljs-string"><span class="hljs-string">" Java"</span></span> ll.add_view tv <span class="hljs-comment"><span class="hljs-comment">#  TextView  LinearLayout params = tv.get_layout_params params.width = ViewGroup::LayoutParams::MATCH_PARENT btn1 = Button.new(</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ruboto</span></span></span><span class="hljs-comment">_java_instance) btn1.text = "Play" btn1.on_click_listener = proc{ Play } ll.add_view btn1 params = search_b.get_layout_params params.width = ViewGroup::LayoutParams::MATCH_PARENT btn2 = Button.new(</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ruboto</span></span></span><span class="hljs-comment">_java_instance) btn2.text = "Pause" btn2.on_click_listener = proc{ Pause } ll.add_view btn2 params = search_b.get_layout_params params.width = ViewGroup::LayoutParams::MATCH_PARENT btn3 = Button.new(</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ruboto</span></span></span><span class="hljs-comment">_java_instance) btn3.text = " " btn3.on_click_listener = proc{ twoActivity } ll.add_view btn3 params = search_b.get_layout_params params.width = ViewGroup::LayoutParams::MATCH_PARENT btn4 = Button.new(</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@ruboto</span></span></span><span class="hljs-comment">_java_instance) btn4.text = " " btn4.on_click_listener = proc{ threeActivity } ll.add_view btn4 params = search_b.get_layout_params params.width = ViewGroup::LayoutParams::MATCH_PARENT setContentView ll</span></span></code> </pre><br>  You have to admit that this code is as cumbersome as java and hardly anyone will like it in the ruby ‚Äã‚Äãcommunity.  More elegant would be to use DSL Ruboto.  Consider similar code using the Ruboto path. <br><br><pre> <code class="ruby hljs">ruboto_import_widgets <span class="hljs-symbol"><span class="hljs-symbol">:Button</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:LinearLayout</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:TextView</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.content_view = linear_layout <span class="hljs-symbol"><span class="hljs-symbol">:orientation</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:vertical</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> text_view <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' Ruby -  '</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:match_parent</span></span> button <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Play'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:match_parent</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:on_click_listener</span></span> =&gt; proc { play } button <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Pause'</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:match_parent</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:on_click_listener</span></span> =&gt; proc { pause } button <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:match_parent</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:on_click_listener</span></span> =&gt; proc { twoActivity } button <span class="hljs-symbol"><span class="hljs-symbol">:text</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">' '</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:width</span></span> =&gt; <span class="hljs-symbol"><span class="hljs-symbol">:match_parent</span></span>, <span class="hljs-symbol"><span class="hljs-symbol">:on_click_listener</span></span> =&gt; proc { threeActivity } <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br>  As you can see, the amount of code decreased by 4-5 times. <br>  The result of this code <br><img src="https://habrastorage.org/storage2/29d/ece/6df/29dece6dfed0f133ec0ef513d9551beb.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Play audio using MediaPlayer </h4><br>  To play sound, import MediaPlayer and AudioManager <br><pre> <code class="ruby hljs">java_import <span class="hljs-string"><span class="hljs-string">"android.media.MediaPlayer"</span></span> java_import <span class="hljs-string"><span class="hljs-string">"android.media.AudioManager"</span></span> java_import <span class="hljs-string"><span class="hljs-string">"android.net.Uri"</span></span></code> </pre><br>  Then we get the file uri and create the MediaPlayer <br><br><pre> <code class="ruby hljs">java_file = java.io.File.new(<span class="hljs-string"><span class="hljs-string">"/mnt/sdcard/naive.mp3"</span></span>) uri = Uri.fromFile(java_file) @player = MediaPlayer.create(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, uri);</code> </pre><br>  We can work with our player with standard functions. <br><pre> <code class="ruby hljs">@player.start @player.pause</code> </pre><br><h4>  Create Activate </h4><br>  The remaining items of our manul will be created in separate activites. <br>  The main way to create RubotoActivity is to use <code>start_ruboto_activity</code> . <br>  <code>start_ruboto_activity</code> is the equivalent of Android startActivity in Ruboto.  It has two required parameters: a string containing a global reference to the activity being created and a block that will be executed once when the activity is created. <br>  Create a second activation <br><br><pre> <code class="ruby hljs">start_ruboto_activity(<span class="hljs-string"><span class="hljs-string">"$activity_two"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_create</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(bundle)</span></span></span></span> <span class="hljs-keyword"><span class="hljs-keyword">super</span></span> setTitle <span class="hljs-string"><span class="hljs-string">' '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><h4>  Determining the coordinates of the touch screen </h4><br>  Touch tracking is done using the on_touch_event function.  This method is equivalent to the onTouchEvent android method. <br>  We track the touch with one finger <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_touch_event</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> index = event.find_pointer_index(<span class="hljs-number"><span class="hljs-number">0</span></span>) x = event.getX(index) y = event.getY(index) toast <span class="hljs-string"><span class="hljs-string">"Position: </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{x}</span></span></span><span class="hljs-string">, </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">#{y}</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><h4>  Work with Intent </h4><br>  To work with Intent, import the corresponding Android API <br><pre> <code class="ruby hljs">java_import <span class="hljs-string"><span class="hljs-string">"android.content.Intent"</span></span></code> </pre><br>  Further work with Intent is done in the same way as java. <br><br><pre> <code class="ruby hljs">intent = Intent.new(Intent::ACTION_CALL) intent.setData(Uri.parse(<span class="hljs-string"><span class="hljs-string">"tel:5551234"</span></span>)) startActivity(intent) intent = Intent.new(Intent::ACTION_VIEW) intent.setData(Uri.parse(<span class="hljs-string"><span class="hljs-string">"http://ruboto.org/"</span></span>)) startActivity(intent)</code> </pre><br>  Add appropriate permissions to AndroidManifest <br><pre> <code class="ruby hljs">&lt;uses-permission <span class="hljs-symbol"><span class="hljs-symbol">android:</span></span>name=<span class="hljs-string"><span class="hljs-string">"android.permission.CALL_PHONE"</span></span> /&gt;</code> </pre><br><h4>  Menu creation </h4><br>  The standard callback <code>on_create_options_menu</code> used to work with the menu.  Everything is simple: create menu items and hang the listener on them, when you click on <code>toast</code> message will be displayed with the name of the menu item. <br><pre> <code class="ruby hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_create_options_menu</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(menu)</span></span></span></span> m1 = menu.add(<span class="hljs-string"><span class="hljs-string">'Action 1'</span></span>) m1.set_on_menu_item_click_listener <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|menu_item|</span></span> @text_view.text = menu_item_title toast menu_item.title <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> m2 = menu.add(<span class="hljs-string"><span class="hljs-string">'Action 2'</span></span>) m2.set_on_menu_item_click_listener <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|menu_item|</span></span> @text_view.text = menu_item.title toast menu_item.title <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre><br><br>  That's all. <br>  All this code can be viewed on <a href="https://github.com/Nitrino/ruboto_audio">github</a> <br>  Links for deeper immersion in Ruboto: <br>  Wiki: <a href="https://github.com/ruboto/ruboto/wiki">github.com/ruboto/ruboto/wiki</a> <br>  Readme: <a href="">github.com/ruboto/ruboto/blob/master/README.md</a> <br>  Excellent presentation with examples: <a href="http://jay.mcgavren.com/files/presentations/ruboto/">jay.mcgavren.com/files/presentations/ruboto</a> </div><p>Source: <a href="https://habr.com/ru/post/165071/">https://habr.com/ru/post/165071/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165059/index.html">We collect, parsim and give logs using Logstash</a></li>
<li><a href="../165061/index.html">What can be difficult in calculating the hypotenuse?</a></li>
<li><a href="../165063/index.html">A PC created with Valve will be shown this week.</a></li>
<li><a href="../165067/index.html">Prediction of information epidemics by analyzing the social graph</a></li>
<li><a href="../165069/index.html">PHP class for convenient and safe work with MySQL</a></li>
<li><a href="../165073/index.html">Writing an extension for google chrome</a></li>
<li><a href="../165077/index.html">Android Conquering fragmentation</a></li>
<li><a href="../165085/index.html">JS module for Java developers</a></li>
<li><a href="../165087/index.html">The simplest image clustering by the k-means method (k-means)</a></li>
<li><a href="../165089/index.html">XIMA Chronicall emergency troubleshooting telephone monitoring and reporting system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>