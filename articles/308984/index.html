<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Everyone will die, and I will stay: replication and disaster recovery to the cloud using Veeam Cloud Connect Replication</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="¬ª We work with a hybrid cloud: VMware vCloud Connector, part 1 
 ¬ª We work with a hybrid cloud: VMware vCloud Connector, part 2 

 In the first two pa...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Everyone will die, and I will stay: replication and disaster recovery to the cloud using Veeam Cloud Connect Replication</h1><div class="post__text post__text-html js-mediator-article">  ¬ª <a href="https://habrahabr.ru/company/dataline/blog/306904/">We work with a hybrid cloud: VMware vCloud Connector, part 1</a> <br>  ¬ª <a href="https://habrahabr.ru/company/dataline/blog/308418/">We work with a hybrid cloud: VMware vCloud Connector, part 2</a> <br><br>  In the first two parts, we looked at how to build a hybrid cloud using VMware vCloud Connector.  Today we will talk about accidents and how to restore the ‚Äúfallen‚Äù internal infrastructure using the resources of the cloud provider.  We will analyze the topic using the example of Veeam Cloud Connect Replication, a tool that helps to set up virtual machine replication and launch replicas in the service provider cloud. <br><br>  For the experiences we need: our own virtual infrastructure and external cloud resources based on VMware, Veeam Backup and Replication is not lower than version 9. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div style="text-align:center;"><img src="https://habrastorage.org/files/1bc/29a/8c0/1bc29a8c0b58423c8b9d5d7b6b8722c1.jpg"></div><br><a name="habracut"></a><br><h3>  In the beginning was replication </h3><br>  Recovery to the cloud (cloud-based DRaaS) begins with the replication of virtual machines.  In our scenario, replication is the synchronization of the contents of several virtual machines located in different virtual infrastructures.  When you set up a virtual machine for replication, a replica of the desired virtual machine is created in the selected infrastructure.  According to the specified schedule, all changes that occurred on the source VM since the creation of the replica, i.e.  synchronization occurs. <br><br>  If replication is configured correctly, then at certain points in time, two identical virtual machines will live in different infrastructures.  As a result, we have a backup site with replicas (read, ready-to-run virtual machines), which we can use in the event of an accident at the main site. <br><br><h3>  Veeam Cloud Connect Replication </h3><br>  Veeam Cloud Connect Replication helps you set up replication to the cloud service provider and switch to replicas in case of a disaster at the main site.  All these operations are performed in the familiar interface Veeam Backup and Replication.  The following switching scenarios for the backup site are possible: <br><br><ul><li>  <b>Run individual virtual machines (Failover Now).</b>  If single machines become unavailable, they can be started at the backup site from the created replica.  At the same time, it is not necessary to configure the network connectivity between the main platform and the external cloud from scratch thanks to the pre-configured Network Appliance (we will tell about it in more detail below). <br><br></li><li>  <b>Launch of the entire infrastructure according to the prepared plan (Failover Plan).</b>  You can use this script when the entire infrastructure becomes unavailable.  Add all the virtual machines you need to run on the backup site to the Failover Plan, and activate the Failover Plan in case of a crash.  You can divide virtual machines into groups according to their criticality and create several plans: some VM group will start first, others later. <br><br>  If, as a result of the accident, the server on which Veeam Backup and Replication is deployed dies, then you can activate Failover Plans through the web <a href="https://vccr.dtln.ru/">portal Cloud Connect Portal</a> from any device, including a mobile phone. <br></li></ul><br><br><img src="https://habrastorage.org/files/2f7/166/ee5/2f7166ee5af740f69ea48503aa227c98.png"><br><br>  Next, we‚Äôll tell you how to get started with Veeam Cloud Connect Replication: connect to a cloud provider, set up replication and create a recovery plan. <br><br><h3>  Connecting to the service provider cloud </h3><br><ol><li>  Pre-found on <a href="https://www.veeam.com/service-provider-lookup.html">the partner portal portal Veeam</a> cloud provider that supports <b>Cloud-based disaster recovery (DRaaS)</b> .  We rent the necessary amount of cloud resources. <br><br></li><li>  In Veeam Backup and Replication 9 go click Add Service Provider. <br><br><img src="https://habrastorage.org/files/4bd/6ba/b69/4bd6bab693e34796a30733e2b5ff1e28.png"><br><br></li><li>  Specify the address of the service provider and the connection port.  Click Next. <br><br><img src="https://habrastorage.org/files/67d/b8b/7c5/67db8b7c57fc47d2b31bd2029a77ffa9.png"><br><br></li><li>  Click Add to add a new account. <br><br><img src="https://habrastorage.org/files/76a/d4f/5f1/76ad4f5f1fc44c96b785fe5855c42202.png"><br><br></li><li>  Enter user credentials issued by the service provider.  Click Next and connect. <br><br><img src="https://habrastorage.org/files/105/09c/35a/10509c35a36c4cd6a722091afbf93f71.jpg"><br><br></li><li>  After connecting, you will see leased resources that you will use for storing replicas of virtual machines. <br><br><img src="https://habrastorage.org/files/c60/e0e/952/c60e0e95239c44ecb20e160ece780a67.png"><br><br></li><li>  We configure network appliance.  Click Edit. <br>  When restoring individual virtual machines (Failover now), the Network Appliance will help maintain connectivity between VMs in the service provider cloud and the machines that continue to operate on the main site. <br><br><img src="https://habrastorage.org/files/d02/4d5/12b/d024d512b920433b90a664cc29b47798.jpg"><br><br></li><li>  Enter data about the network infrastructure: <br><br><ul><li>  Hostname </li><li>  Resource pool </li><li>  Storage Type </li><li>  Network </li><li>  The IP address is the IP that will be assigned to the Network Appliance.  Network and IP must be available from Veeam Backup and Replication to communicate with the Network Appliance.  Click Finish and wait until all settings are applied. <br><br><img src="https://habrastorage.org/files/15f/c47/986/15fc47986b424f4e86d82fb67fb87a95.jpg"><br></li></ul><br></li></ol><br>  Everything, we have connected to the cloud of the service provider.  Now you can set up virtual machine replication and create recovery plans. <br><br><h3>  Replication setup </h3><br><ol><li>  To create a replication task in the Veeam Backup and Replication interface, click Replication Job. <br><br><img src="https://habrastorage.org/files/fe2/186/fb8/fe2186fb8dfc41a69a5388ae064198d8.png"><br><br></li><li>  Set the name and job description.  To reduce the network load, we recommend activating <a href="https://helpcenter.veeam.com/backup/hyperv/replica_seeding.html%26sa%3DD%26ust%3D1472652514570000%26usg%3DAFQjCNFcHtoREBm6lQvb49gxSD7quTPa7g">replica seeding</a> (the replica is created on the basis of a specially created VM backup, not a working VM), network mapping and re-IP.  These settings will help reduce the amount of traffic transmitted.  Click Next. <br><br><img src="https://habrastorage.org/files/45b/a1f/457/45ba1f457dee42f192f9aa9e81cbcbc0.png"><br><br></li><li>  Add virtual machines for replication.  Click Add.  Here you can choose the order in which the machines will be sent for replication.  Use the Up and Down buttons for this. <br><br><img src="https://habrastorage.org/files/6be/d43/af8/6bed43af86684beeb1ff7e996ae0b7f3.png"><br><br>  If a resource pool is added to replication, then using Exclusions, you can exclude individual VMs from this list. <br><br><img src="https://habrastorage.org/files/8e0/c93/8f0/8e0c938f0a8245458efecf29d1617197.jpg"><br><br>  The Source setting determines whether the replica will be made from ‚Äî from a productive VM or from the last backup. <br><br><img src="https://habrastorage.org/files/40f/874/554/40f8745546184f5bab69563c51208d0a.jpg"><br><br></li><li>  Choose a site for replication - Cloud host.  Click Next. <br><br><img src="https://habrastorage.org/files/c86/482/f10/c86482f10fa1432691eb70ea2f9a512c.jpg"><br><br></li><li>  Select the resource pool that the cloud provider has allocated.  Specify the type of storage, if you have several (for example, the type of disks).  Click Next. <br><br><img src="https://habrastorage.org/files/eb6/153/700/eb615370079045fbb584ea2ae3f10cc6.png"><br><br></li><li>  Specify the repository for storing meta-data, the suffix for the name of the replica and the number of recovery points. <br><br><img src="https://habrastorage.org/files/b1f/d3e/bb7/b1fd3ebb7c164bf995005b234287166f.jpg"><br><br></li><li>  If your Veeam license includes WAN Accelerators, activate it.  It will reduce the load on the network and accelerate the replication of virtual machines with a slow Internet connection. <br><br><img src="https://habrastorage.org/files/76f/43c/d8e/76f43cd8e4964cfd85f7db251bd6125d.png"><br><br></li><li>  Enable Enable application aware-processing if Microsoft applications are running on virtual machines (SQL, Exchange, Active Directory, etc.).  This option will ensure the consistency of data in replicas.  Enter the administrator credentials of the Guest OS. <br><br><img src="https://habrastorage.org/files/16c/e14/05f/16ce1405fef94ff0ad4437b2cd8e9817.jpg"><br><br></li><li>  We set the schedule for automatic replication - Run the Job Automatically.  Here you need to consider whether the performance of your infrastructure and bandwidth can cope with the selected replication frequency. <br><br>  <b>Tip:</b> Before you choose a schedule, do some replication tasks manually.  So you will get a clear understanding of how at which interval automatic replication will be set up so that it does not cause a degradation of services on productive.  Click Finish. <br><br><img src="https://habrastorage.org/files/c8f/da8/0bf/c8fda80bf0244f3daac2370e1f291585.jpg"></li></ol><br>  All created replication jobs will appear in the Replication tab. <br><br><img src="https://habrastorage.org/files/680/f56/5ce/680f565ce5084a3586b480212f9a3356.png"><br><br>  All current replicas you will find in the Replicas clutch. <br><br><img src="https://habrastorage.org/files/3d8/32a/acb/3d832aacb83c41bc8e9d623d18859aad.png"><br><br><h3>  Creating a Recovery Plan (Failover Plan) </h3><br>  After replication is configured for machines, you can create a recovery plan.  As part of these plans, we choose which replicas of virtual machines will run and in what order. <br><br><ol><li>  To create a recovery plan, click the Failover Plan. <br><br><img src="https://habrastorage.org/files/824/af4/74f/824af474f95d4d3a95a573cbfddc7802.png"><br><br></li><li>  Enter the name and description of the recovery plan. <br><br><img src="https://habrastorage.org/files/e9a/088/790/e9a088790f1e42bea84b90dc2aefdab3.png"><br><br></li><li>  Click Add to add virtual machines that will be restored as part of this plan.  We select from virtual machines for which replication is already configured.  Click Next. <br><br><img src="https://habrastorage.org/files/80d/259/5cb/80d2595cb3644cbea0ca8f729118685a.png"><br><br></li><li>  Click Manage default gateways.  This information will be used by the Network Appliance during full recovery.  Click Next. <br><br><img src="https://habrastorage.org/files/454/ea1/485/454ea14853504c75a7618cbbc166de54.png"><br><br></li><li>  We register external and internal IP for each replica of the virtual machine.  So that after the restoration on the external site, virtual machines can be connected via the Internet  Click Finish. <br><br><img src="https://habrastorage.org/files/296/b1a/500/296b1a500cb24f3fa19bde15b4dfe913.jpg"><br></li></ol><br><h3>  Testing a recovery plan </h3><br>  The created recovery plan can be tested.  To do this, right-click the desired Failover Plan and click Test. <br><br><img src="https://habrastorage.org/files/7cf/3a0/375/7cf3a0375d6e4e79b8816ec19a28f797.png"><br><br>  During the test, we check whether all the machines added to the Failover Plan run successfully in the provider cloud. <br><br><img src="https://habrastorage.org/files/777/f8b/fb7/777f8bfb71ee460f92f4c1ee1f3219f1.png"><br><br>  Although this test does not allow you to check the network connectivity and operability of applications deployed on the VM, it will show whether the VMs are running on the backup site.  For a full check, you need to conduct a scheduled failover: turn off the combat virtual machines, i.e.  simulate their failure, run the desired recovery plan.  In this case, the virtual machines will start in the service provider cloud along with all the network settings. <br><br><h3>  Cloud Connect Portal </h3><br>  Finally, a little bit about the worst-case scenario.  If there was a real disaster, and Veeam Backup and Replication also became unavailable, then in this case there is a Cloud Connect Portal.  This portal is deployed on the side of the service provider, and therefore he will not be afraid of Armageddon on your platform.  Cloud Connect Portal is available through any browser. <br><br><img src="https://habrastorage.org/files/5e5/2ef/6c0/5e52ef6c01344ce1946d61eeddc5a6fe.png"><br><br>  Here you will find a list of all prepared recovery plans.  Choose the one that corresponds to the case, click Start, and wait for the virtual machines to start in the cloud service provider. <br><br><img src="https://habrastorage.org/files/d9d/993/bdf/d9d993bdff92430aa5c57b24a1a710f6.png"><br><br>  In this post we make a small pause in our series about hybrid clouds.  Write what you would like to know more on this topic, we will try to tell about it. </div><p>Source: <a href="https://habr.com/ru/post/308984/">https://habr.com/ru/post/308984/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308974/index.html">Tabs or spaces? Analysis of 400 thousand GitHub repositories, billion files, 14 TB code</a></li>
<li><a href="../308976/index.html">A gift for September 1 to all fans of digital circuitry and computer architecture</a></li>
<li><a href="../308978/index.html">Sort a huge file with an array with a known data dictionary</a></li>
<li><a href="../308980/index.html">Input lag during rendering and how to win</a></li>
<li><a href="../308982/index.html">Sorry, we are launching a new product.</a></li>
<li><a href="../308986/index.html">Meet p5.js</a></li>
<li><a href="../308988/index.html">Go to 2FA (Two-Factor Authentication for ASA SSL VPN)</a></li>
<li><a href="../308990/index.html">Intel Software Conference 2016. September, Moscow, St. Petersburg</a></li>
<li><a href="../308992/index.html">The era of ‚ÄúPost-Let's Encrypt‚Äù. Who still needs to pay for SSL certificates?</a></li>
<li><a href="../308994/index.html">Baidu has published the PaddlePaddle depth learning toolkit demo.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>