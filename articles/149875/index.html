<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>These Funny Broadcast Receivers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A small observation about the different behavior of BroadcastReceiver 's when registering through AndroidManifest.xml and directly in the code. This a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>These Funny Broadcast Receivers</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/ee9/2e8/628/ee92e8628f3a467d068dd388417735fc.jpg" alt="image" align="right">  A small observation about the different behavior of <code>BroadcastReceiver</code> 's when registering through <code>AndroidManifest.xml</code> and directly in the code.  This article is not a step-by-step guide for beginners, but is only intended to save time for those who have not yet had the opportunity to step on a similar rake. <br><a name="habracut"></a><br>  So it happened, by the will of the <s>project manager of</s> fate, I had the opportunity to write a program that blocks everything and everyone for the benefit of defenseless children.  Let us leave aside the ethical component of the issue and the mental adequacy of parents who throw out three or four euros on a smartphone for a child, and then with enviable persistence are looking for software that will turn this high-tech device into a brick a decade ago: without the Internet, without SMS, without calls, no applications ... no hope for the future.  Attempting to replace parenting with total control is a sure way to grow a weak-willed imbecile, but the Chukchi is not a solver here, Chukchi is a Kodo-writer, so I suggest focusing on the technical side of things. <br><br>  A specific subtask of such programs: receive notifications about the change of the state of the mobile Internet, Wi-Fi, Bluetooth and block them depending on the degree of paranoid carer.  As you know, this kind of notification in android implemented through <code>BroadcastReceiver</code> 's.  Also, it is no secret that you can register a <i>receiver in</i> two ways: in the <code>AndroidManifest.xml</code> file and directly in the <code>Activity</code> (or <code>Service</code> , as an option).  Consider both ways. <br><br><h5>  AndroidManifest.xml </h5>  <code>/*           */</code> .  Without further ado, we subscribe to the events we need.  In this case, this <i>action</i> ‚Äôs somehow contains a <i>change</i> . <br><pre> <code class="java hljs">&lt;receiver android:name=<span class="hljs-string"><span class="hljs-string">"com.demo.WiFiReceiver"</span></span> android:enabled=<span class="hljs-string"><span class="hljs-string">"true"</span></span> &gt; &lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"android.net.wifi.WIFI_STATE_CHANGED"</span></span> /&gt; &lt;/intent-filter&gt; &lt;/receiver&gt; &lt;receiver android:name=<span class="hljs-string"><span class="hljs-string">"com.demo.DataReceiver"</span></span> android:enabled=<span class="hljs-string"><span class="hljs-string">"true"</span></span> &gt; &lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"android.net.conn.CONNECTIVITY_CHANGE"</span></span> /&gt; &lt;/intent-filter&gt; &lt;/receiver&gt; &lt;receiver android:name=<span class="hljs-string"><span class="hljs-string">"com.demo.BluetoothReceiver"</span></span> android:enabled=<span class="hljs-string"><span class="hljs-string">"true"</span></span>&gt; &lt;intent-filter&gt; &lt;action android:name=<span class="hljs-string"><span class="hljs-string">"android.bluetooth.adapter.action.STATE_CHANGED"</span></span> /&gt; &lt;/intent-filter&gt; &lt;/receiver&gt;</code> </pre><br>  The corresponding classes do not look much more complicated and, in general, correspond to the following pattern: <br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyReceiver</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReceiver</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.d(<span class="hljs-string"><span class="hljs-string">"MyReceiver"</span></span>, <span class="hljs-string"><span class="hljs-string">"onReceive"</span></span>); } }</code> </pre><br>  We are interested in the chronology of calls, so we will keep a log of the onset of major events. <br>  The result <s>on the person</s> in <b><i>LogCat</i></b> : <br><table><tbody><tr><td>  <b>Application</b> </td><td>  <b>Tag</b> </td><td>  <b>Text</b> </td></tr><tr><td>  com.habr </td><td>  MyActivity </td><td>  onCreate </td></tr></tbody></table>  and at each on / off of the corresponding option we get for example: <br><table><tbody><tr><td>  <b>Application</b> </td><td>  <b>Tag</b> </td><td>  <b>Text</b> </td></tr><tr><td>  com.habr </td><td>  WiFiReceiver </td><td>  onReceive </td></tr></tbody></table>  Everything is pretty predictable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Programmatically. </h5>  First, let's do this simple trick using the example of <i>Bluetooth</i> . <br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.main); Log.d(<span class="hljs-string"><span class="hljs-string">"MyActivity"</span></span>, <span class="hljs-string"><span class="hljs-string">"onCreate"</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onResume(); receiver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BroadcastReceiver() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onReceive</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Context context, Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ Log.e(<span class="hljs-string"><span class="hljs-string">"BluetoothReceiver"</span></span>, <span class="hljs-string"><span class="hljs-string">"onReceive"</span></span>); } }; registerReceiver(receiver, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IntentFilter(BluetoothAdapter.ACTION_SCAN_MODE_CHANGED)); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPause</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onPause(); unregisterReceiver(receiver); }</code> </pre><br>  Behavior will be identical to previous launches and many people have probably not the first time the thought ‚Äúwhy, does he do us a doctor, and who does he treat here at all?‚Äù <code>ConnectivityManager.CONNECTIVITY_ACTION</code> and here, hello to the guys from android, you will find that <i><b>LogCat</b></i> shows the following: <br><table><tbody><tr><td>  <b>Application</b> </td><td>  <b>Tag</b> </td><td>  <b>Text</b> </td></tr><tr><td>  com.habr </td><td>  MyActivity </td><td>  onCreate </td></tr><tr><td>  com.habr </td><td>  WiFiReceiver </td><td>  onReceive </td></tr><tr><td>  com.habr </td><td>  DataReceiver </td><td>  onReceive </td></tr></tbody></table>  In fact, this means that both <code>onReceive</code> both <i>receivers</i> volunteered immediately, generally regardless of the state of the corresponding options, and only <i>Bluetooth</i> behaved correctly. <br><br><h5>  Conclusion </h5>  Imagine a simple situation: the task of the application is to interrupt the Internet.  At the time of installation of the application, it can be both on and off.  If it is already enabled, and you register via <code>AndroidManifest.xml</code> , then you just have to be sure, you will have to call the lock code from the <i>receiver</i> yourself, since  you will not be notified by the system, and this is correct, because you are late for lunch, the corresponding notification was missed when you were not in the system with your application.  If you did everything programmatically, then you do not have to make a separate call.  Again, provided that the case does not concern <i>Bluetooth</i> .  If you ask the question ‚ÄúOh, sobsna, why?‚Äù, Then the answer is likely to be ‚ÄúBecause you can!‚Äù.  As for me, it's a pure bug and no logic is visible.  I hope this article will save someone the day that I killed, in order to understand the reason for the disobedience of the hellish machine. <br><br>  All of the above is reproduced on all versions of <i>Android</i> , starting with <i>Gingerbread</i> and above (below just did not test). <br><br>  As for the methods of filtering calls, SMS, Internet, etc., then, if I'm not mistaken, the topic has already been partially covered, for example, <a href="http://habrahabr.ru/post/149555/">here</a> .  But, if this is interesting, then I could try to do my bit so as not to duplicate anyone. </div><p>Source: <a href="https://habr.com/ru/post/149875/">https://habr.com/ru/post/149875/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149870/index.html">Google is working on the possibility of Android updates without the participation of manufacturers</a></li>
<li><a href="../149871/index.html">Xperia SL. Sony's Next Generation Smartphone</a></li>
<li><a href="../149872/index.html">Overview of JS frameworks. Journey through the jungle javascript MVC. Part 2</a></li>
<li><a href="../149873/index.html">nanoCAD 3.7 vs 4.0 - what is new? (part number 1)</a></li>
<li><a href="../149874/index.html">Stress and neural networks: why it‚Äôs better not to be nervous</a></li>
<li><a href="../149876/index.html">Would not spend a day trying to restore Windows Server 2008R2</a></li>
<li><a href="../149878/index.html">GTD vs Agile Results. Correcting the mistakes of David Allen</a></li>
<li><a href="../149879/index.html">Apple will get rid of intermediaries in Russia</a></li>
<li><a href="../149880/index.html">Three new smartphones and a Sony Xperia tablet</a></li>
<li><a href="../149881/index.html">Unity Unite: Amsterdam in 3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>