<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We generate beautiful pictures for social networks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The code to generate this particular image. 

$generator = new imgGenerator(); $textGenerator=new imgTextGenerator(); $textGeneratorTop=new imgTextGen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We generate beautiful pictures for social networks</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/f10/946/95e/f1094695ef494e78803a01d31ab82dc2.jpg"><br><br><div class="spoiler">  <b class="spoiler_title">The code to generate this particular image.</b> <div class="spoiler_text"><pre><code class="php hljs">$generator = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imgGenerator(); $textGenerator=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imgTextGenerator(); $textGeneratorTop=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> imgTextGenerator(); $label=$textGeneratorTop -&gt;seTextShadow(<span class="hljs-string"><span class="hljs-string">"#000000"</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) -&gt;setText(<span class="hljs-string"><span class="hljs-string">"Test Site"</span></span>,<span class="hljs-string"><span class="hljs-string">"#ffffff"</span></span>,imgGenerator::position_center_top,<span class="hljs-string"><span class="hljs-string">"1/12"</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span> ) -&gt;setBackground(<span class="hljs-string"><span class="hljs-string">"#000000"</span></span>,<span class="hljs-string"><span class="hljs-string">'3%'</span></span>) -&gt;setFont($_SERVER[<span class="hljs-string"><span class="hljs-string">"DOCUMENT_ROOT"</span></span>].<span class="hljs-string"><span class="hljs-string">"/upload/fonts/fonts2_7/hinted-PTF55F.ttf"</span></span>); $text=$textGenerator -&gt;seTextShadow(<span class="hljs-string"><span class="hljs-string">"#000000"</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>) -&gt;setText(<span class="hljs-string"><span class="hljs-string">"    "</span></span>,<span class="hljs-string"><span class="hljs-string">"#ffffff"</span></span>,imgGenerator::position_center_center,<span class="hljs-string"><span class="hljs-string">"1/7"</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">'5%'</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-string"><span class="hljs-string">'5%'</span></span>)) -&gt;setFont($_SERVER[<span class="hljs-string"><span class="hljs-string">"DOCUMENT_ROOT"</span></span>].<span class="hljs-string"><span class="hljs-string">"/upload/fonts/fonts2_7/hinted-PTF55F.ttf"</span></span>); $generator -&gt;addText($text) -&gt;addText($label) -&gt;fromImg($_SERVER[<span class="hljs-string"><span class="hljs-string">"DOCUMENT_ROOT"</span></span>] . <span class="hljs-string"><span class="hljs-string">"/upload/dynamic/2016-08/15/carrot-big.jpg"</span></span>) -&gt;resizeFor(<span class="hljs-string"><span class="hljs-string">"autodetect"</span></span>) -&gt;addOverlay(<span class="hljs-number"><span class="hljs-number">0.5</span></span>,<span class="hljs-string"><span class="hljs-string">"#000000"</span></span>) -&gt;show();</code> </pre> </div></div><br>  Looking for beautiful pictures for soc.  networks that recently generate many news (and not only) sites - I wanted to write my own generator. <br><br><div class="spoiler">  <b class="spoiler_title">Examples of pictures</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/a7f/8b2/4e4/a7f8b24e457e46fc9288b74a908a2eab.jpg"></div></div><br>  The script works in PHP, using the Imagick module.  I did not dare to write this on GD2. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The algorithm of the work was supposed to: <br><br><ul><li>  We take as a basis a picture or color </li><li>  We reduce to the necessary size </li><li>  We put a translucent background on top </li><li>  Set the logo </li><li>  Add an inscription </li><li>  Cache the result </li></ul><br><a name="habracut"></a>  In addition to all this, you need the ability to set indents, positioning, automatic font size. <br><br>  Below I will write pieces of code from the finished script, the script can be fully <a href="https://github.com/Vallefor/evaSocialImgGenerator">viewed on Github</a> . <br><br><h2>  Create a base </h2><br>  The base can be either from color or from a picture.  It's simple.  Create an Imagick object: <br><br>  For pictures: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;im = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"img"</span></span>]);</code> </pre> <br>  For color: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;im = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;im-&gt;newImage(<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-number"><span class="hljs-number">100</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"color"</span></span>]);</code> </pre> <br><h2>  Decrease </h2><br>  Next, we reduce and cut the picture to the desired size, since Imgick does not know how to do this, we write a small method for this: <br><br><pre> <code class="php hljs">$oldGeometry=$im-&gt;getImageGeometry(); $max=max(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($max==<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>]) { $otn=$oldGeometry[<span class="hljs-string"><span class="hljs-string">"height"</span></span>]/$oldGeometry[<span class="hljs-string"><span class="hljs-string">"width"</span></span>]; $width=$max; $height=$max*$otn; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($height-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $height=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>]; $width=$height/$otn; $x=($width-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>])/<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $x = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($position==imgGenerator::position_center_center) { $y=($height-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>])/<span class="hljs-number"><span class="hljs-number">2</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $otn=$oldGeometry[<span class="hljs-string"><span class="hljs-string">"width"</span></span>]/$oldGeometry[<span class="hljs-string"><span class="hljs-string">"height"</span></span>]; $height=$max; $width=$max*$otn; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($width-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>] &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $width=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>]; $height=$width/$otn; $y=($width-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>])/<span class="hljs-number"><span class="hljs-number">2</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $y = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($position==imgGenerator::position_center_center) { $x=($width-<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>])/<span class="hljs-number"><span class="hljs-number">2</span></span>; } } $im-&gt;resizeImage($width,$height,\Imagick::FILTER_LANCZOS,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">false</span></span>); $im-&gt;cropimage(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"width"</span></span>],<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"resize_and_crop"</span></span>][<span class="hljs-string"><span class="hljs-string">"height"</span></span>],$x,$y);</code> </pre><br>  But the problem of reduction was not to reduce to the required size, but to determine which social.  network was a request for a picture, and then set the desired reduction options. <br><br>  The parameters themselves were as follows: <br><table><tbody><tr><td>  Facebook </td><td>  1200x630 </td></tr><tr><td>  Twitter </td><td>  978x511 </td></tr><tr><td>  Google+ </td><td>  2120x1192 (winner!) </td></tr><tr><td>  In contact with </td><td>  537x240 </td></tr><tr><td>  Classmates </td><td>  780x585 (reduced to 780x385) </td></tr></tbody></table>  When defining a social network, the script looks at the User Agent, but there was one problem, not everyone follows their own documentation. <br><br>  So does Vkontakte.  It is written that when accessing a site he uses vkShare as a User Agent.  In practice, it turned out that he does it sometimes.  I do not know what this is all about, but when I tried to share a new link in VK, I went to the page several times with completely different browsers.  Sometimes there was vkShare. <br><br>  In the end, after a series of experiments, I decided to make it so that if the User Agent was not determined, then we consider it to be VK. <br><br>  The result was the following list of social robots: <br><br><ul><li>  facebookexternalhit </li><li>  vkShare </li><li>  Twitterbot </li><li>  Google </li><li>  Odklbot </li></ul><br>  During testing, the office sounded quite a funny question from me, ‚ÄúIs there anyone in classmates?‚Äù.  No one confessed.  It turned out that I registered there myself once. <br><br>  While writing the article, the script acquired the withoutCrop method, its meaning is that it allows you to reduce and position the picture without cutting it.  This allows you to improve the situation if the original picture is almost always horizontal (for example, if it is a film cover, books, games, etc.). <br><br><h2>  We impose a translucent substrate </h2><br><pre> <code class="php hljs">$geometry=<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;im-&gt;getImageGeometry(); $color=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ImagickPixel(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"overlay"</span></span>][<span class="hljs-string"><span class="hljs-string">"color"</span></span>]); $overlay-&gt;newImage($geometry[<span class="hljs-string"><span class="hljs-string">"width"</span></span>],$geometry[<span class="hljs-string"><span class="hljs-string">"height"</span></span>],$color); $overlay-&gt;setImageOpacity(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"overlay"</span></span>][<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>]);</code> </pre> <br><h2>  Logo installation </h2><br>  After some experiments, I came to the conclusion that if the logo will occupy no more than 25% of the width and height of the image, then it will look quite good. <br><br>  The script allows you to set the logo in any place in the picture, including in the center. <br><br>  The default settings are suitable for almost all cases, but the script allows you to change the size of the logo, indents and positioning. <br><br><h2>  Inscription </h2><br>  I suspected that the inscription would be one of the biggest problems.  So it happened. <br><br>  So, create an instance of ImagickDraw and set various parameters for it: font, font size, color, style, anti-aliasing: <br><br><pre> <code class="php hljs">$draw=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ImagickDraw(); $draw-&gt;setFont(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_font"</span></span>]); $draw-&gt;setFontSize($fs); $draw-&gt;setFillColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ImagickPixel(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text"</span></span>][<span class="hljs-string"><span class="hljs-string">"color"</span></span>])); $draw-&gt;setStrokeAntialias(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); $draw-&gt;setTextAntialias(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>);</code> </pre> <br>  After that, before setting the alignment, we divide our line into several lines, if it does not fit.  To do this, we use queryFontMetrics, which, about a miracle (about this - below), in this case works as it should. <br><br><pre> <code class="php hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">splitToLines</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($draw,$text,$maxWidth)</span></span></span><span class="hljs-function"> </span></span>{ $ex=explode(<span class="hljs-string"><span class="hljs-string">" "</span></span>,$text); $checkLine=<span class="hljs-string"><span class="hljs-string">""</span></span>; $textImage=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($ex <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $val) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($checkLine) { $checkLine.=<span class="hljs-string"><span class="hljs-string">" "</span></span>; } $checkLine.=$val; $metrics=$textImage-&gt;queryFontMetrics($draw, $checkLine); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>($metrics[<span class="hljs-string"><span class="hljs-string">"textWidth"</span></span>]&gt;$maxWidth) { $checkLine=preg_replace(<span class="hljs-string"><span class="hljs-string">'/\s(?=\S*$)/'</span></span>,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>,$checkLine); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $checkLine; }</code> </pre> <br>  Set the alignment: <br><br><pre> <code class="php hljs">$draw-&gt;setTextAlignment(\Imagick::ALIGN_LEFT);</code> </pre> <br>  Use the annotation method to draw the label: <br><br><pre> <code class="php hljs">$draw-&gt;annotation(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text"</span></span>][<span class="hljs-string"><span class="hljs-string">"text"</span></span>]);</code> </pre> <br>  After that, our ImagickDraw object would be ready and it remains only to create an Imagick object, write our text on it using the drawImage method: <br><br><pre> <code class="php hljs">$textImage=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(); $textImage-&gt;newImage($textwidth,$textheight,<span class="hljs-string"><span class="hljs-string">"none"</span></span>); $textImage-&gt;drawImage($draw);</code> </pre> <br>  $ textwidth $ textheight we take from queryFontMetrics, as well as at breakdown of the big line.  But it was not there.  It all works more or less correctly, when aligning to the left, but when aligning a few lines to the center or right, something strange started to happen.  The text was constantly cropped on one side, on the other, and it was not clear how to position the text so that it fit into the image. <br><br>  In the comments to the method, on php.net someone wrote a formula like: <br><br><pre> <code class="php hljs">$baseline = $metrics[<span class="hljs-string"><span class="hljs-string">'boundingBox'</span></span>][<span class="hljs-string"><span class="hljs-string">'y2'</span></span>]; $textwidth = $metrics[<span class="hljs-string"><span class="hljs-string">'textWidth'</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span> * $metrics[<span class="hljs-string"><span class="hljs-string">'boundingBox'</span></span>][<span class="hljs-string"><span class="hljs-string">'x1'</span></span>]; $textheight = $metrics[<span class="hljs-string"><span class="hljs-string">'textHeight'</span></span>] + $metrics[<span class="hljs-string"><span class="hljs-string">'descender'</span></span>];</code> </pre> <br>  But this formula didn't work either. <br><br>  Honestly, no matter how hard I fought, trying to find meaning in the array from queryFontMetrics in different text positioning variants, with different numbers of lines, I never succeeded. <br><br>  As a result, this method was born: we calculate the dimensions at the prompt from php.net, but we increase slightly the width and height. <br><br><pre> <code class="php hljs">$textIm=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(); $metrics=$textIm-&gt;queryFontMetrics($draw, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text"</span></span>][<span class="hljs-string"><span class="hljs-string">"text"</span></span>]); $baseline = $metrics[<span class="hljs-string"><span class="hljs-string">'boundingBox'</span></span>][<span class="hljs-string"><span class="hljs-string">'y2'</span></span>]; $textwidth = $metrics[<span class="hljs-string"><span class="hljs-string">'textWidth'</span></span>] + <span class="hljs-number"><span class="hljs-number">2</span></span> * $metrics[<span class="hljs-string"><span class="hljs-string">'boundingBox'</span></span>][<span class="hljs-string"><span class="hljs-string">'x1'</span></span>]; $textheight = $metrics[<span class="hljs-string"><span class="hljs-string">'textHeight'</span></span>] + $metrics[<span class="hljs-string"><span class="hljs-string">'descender'</span></span>]; $draw-&gt;annotation ($textwidth*<span class="hljs-number"><span class="hljs-number">1.3</span></span>, $textheight*<span class="hljs-number"><span class="hljs-number">1.3</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text"</span></span>][<span class="hljs-string"><span class="hljs-string">"text"</span></span>]);</code> </pre> <br>  Next, create a picture 3 times more and draw our inscription on it: <br><br><pre> <code class="php hljs">$textImage=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \Imagick(); $textImage-&gt;newImage($textwidth*<span class="hljs-number"><span class="hljs-number">3</span></span>,$textheight*<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-string"><span class="hljs-string">"none"</span></span>); $textImage-&gt;drawImage($draw);</code> </pre> <br>  Then we cut the edges with: <br><br><pre> <code class="php hljs">$textImage-&gt;trimImage(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br>  And after that we do not forget to use setImagePage, this is necessary so that the coordinates of the beginning, height and width return new values: <br><br><pre> <code class="php hljs">$textImage-&gt;setImagePage(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre> <br><h2>  Shadow under text </h2><br>  Imagick can not put a shadow on the text, but can make a shadow from the picture.  Ok, we make a copy with the text, turn it into a shadow, impose one on the other: <br><br><pre> <code class="php hljs">$shadow_layer = <span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $textImage; $shadow_layer-&gt;setImageBackgroundColor(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \ImagickPixel(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_shadow"</span></span>][<span class="hljs-string"><span class="hljs-string">"color"</span></span>])); $shadow_layer-&gt;shadowImage(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_shadow"</span></span>][<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_shadow"</span></span>][<span class="hljs-string"><span class="hljs-string">"sigma"</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_shadow"</span></span>][<span class="hljs-string"><span class="hljs-string">"x"</span></span>], <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;opts[<span class="hljs-string"><span class="hljs-string">"big_text_shadow"</span></span>][<span class="hljs-string"><span class="hljs-string">"y"</span></span>]); $shadow_layer-&gt;compositeImage($textImage, \Imagick::COMPOSITE_OVER, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); $textImage=<span class="hljs-keyword"><span class="hljs-keyword">clone</span></span> $shadow_layer;</code> </pre> <br>  By the way, $ textImage-&gt; trimImage (0);  Of course, you need to do after installing the shadow. <br><br>  Now everything works as it should. <br><br>  Methods for working with text were singled out in a separate object and after that it became possible to put several inscriptions on the image at once, very convenient, for example, for an online store, where there is a product name and price. <br><br>  Examples of the script (size for VK): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/e27/1bd/63b/e271bd63b8cf47fbbcb76266159a4441.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/c58/16f/2c6/c5816f2c682c4e7698d7533006c052fb.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/194/358/08c/19435808c53e40569a79b4b449917b7f.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/755/c2f/798/755c2f79831c41a4acdcb6490b92858a.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/269/ef6/680/269ef6680e4c4da7bf81cec609833767.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/files/a54/4c4/2e6/a544c42e676d4f80b5b9f939ad6cec35.jpg"></div><br>  There are several ideas for the development of the script, for example, to make it possible to put a test against each other, to turn the setLogo method into addImage and to make it possible to overlay several pictures. <br><br>  By the way, if you read to the end.  A little about me: my name is Dmitry and I work as a programmer in a small studio.  My tasks include the development of CMS, which already has a lot of interesting things, which I would like to share. </div><p>Source: <a href="https://habr.com/ru/post/314018/">https://habr.com/ru/post/314018/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../314004/index.html">My Ragnarok</a></li>
<li><a href="../314008/index.html">Automation again: Python crawled to routers</a></li>
<li><a href="../314012/index.html">Backing up a standalone blog on Wordpress in the Google Drive cloud</a></li>
<li><a href="../314014/index.html">Parsing JSON is a minefield</a></li>
<li><a href="../314016/index.html">Search for the shortest paths in road networks: from theory to implementation</a></li>
<li><a href="../314020/index.html">We work with a budget institution. Part 4</a></li>
<li><a href="../314022/index.html">How to make virtual infrastructure more accessible</a></li>
<li><a href="../314024/index.html">Huawei Hosting Platform</a></li>
<li><a href="../314026/index.html">Print support promised a year ago appeared in ReactOS</a></li>
<li><a href="../314028/index.html">Studying Retrofit 2</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>