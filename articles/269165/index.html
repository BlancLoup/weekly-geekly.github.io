<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What protect sites, or why do we need WAF?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year, Positive Technologies was named the ‚Äúvisionary‚Äù in the Gartner Magic Quadrant for Web Application Firewalls rating. This raised a number of...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What protect sites, or why do we need WAF?</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/company/pt/blog/269165/"><img src="https://habrastorage.org/files/dae/502/0d6/dae5020d61cc49c9a85554b5022750a0.jpg"></a> <br><br>  This year, Positive Technologies was named the ‚Äúvisionary‚Äù in the Gartner Magic Quadrant for Web Application Firewalls rating.  This raised a number of questions about what achievements we got there and what WAF is all about.  The questions are quite legitimate, since Gartner has been releasing its WAF research only since last year (for example: the "quadrants" on SIEM began to appear five years earlier, in 2009).  In addition, some are still confused with the terminology, not distinguishing between a ‚Äúweb application protection screen‚Äù (WAF) and a regular network firewall or an intrusion prevention system (IPS). <br><br>  In this article we will try to separate flies from cutlets - and tell you how the perimeter defense is evolving as the sophistication of attacks increases. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/dec/85f/ac4/dec85fac441d4413b19090dedc9d7258.jpg"><br><h4>  1. At the beginning of time: packet filters </h4><br><br>  Initially, the term firewall (firewall, screen) refers to a network filter that is placed between the trusted internal network and the external Internet (hence the adjective "internetwork").  This filter was designed to block suspicious network packets based on the criteria of the low levels of the OSI model: at the network and data link levels.  In other words, the filter took into account only the source and destination IP addresses, the fragmentation flag, and the port numbers. <br><br>  Further, the possibilities were extended to session level gateways, or stateful firewall state channel filters.  These second-generation firewalls have improved the quality and filtering performance by monitoring packet belonging to active TCP sessions. <br><br>  Unfortunately, this protection system is practically useless against modern cyber threats, where more than 80% of attacks exploit application vulnerabilities, rather than network architecture and services.  Worse, blocking certain ports, addresses or protocols (the main way firewalls work) can cut down quite legitimate applications.  This means that the protection system should conduct a more in-depth analysis of the contents of the packets ‚Äî that is, it is better to ‚Äúunderstand‚Äù the operation of the applications. <br><br><img src="https://habrastorage.org/files/8a7/d4c/cc3/8a7d4ccc3eea42c2aff9795a768a1ddd.jpg"><br><h4>  2. Intrusion Detection / Prevention Systems (IDS / IPS) </h4><br><br>  The next generation of protective screens are intrusion detection and prevention systems (IDS / IPS).  They are capable of examining data fields in TCP packets and inspecting at the application level for certain signatures.  IDS systems are adapted to detect attacks not only outside, but also inside the network by listening to the switch's SPAN port. <br><br>  To improve the protection mechanisms in IDS / IPS, decoders (parsing TCP packet fields) and preprocessors (parsing application protocol parts, for example, HTTP) have been used.  The use of preprocessors in IPS Snort made it possible to significantly improve the functionality of perimeter protection in comparison with a packet filter, even if the latter checks packets at the application level (iptables with the layer7 module). <br><br>  However, the main drawback of the packet filter remained: the check is carried out per package, without taking into account sessions, cookies, and the rest of the application‚Äôs logic. <br><br>  In parallel, proxy servers appear to combat the spread of viruses, and reverse proxy servers are used to solve load balancing problems.  They differ technically, but the main thing is that both of them fully work at the application level: two TCP connections from proxy to client and from proxy to server open, traffic analysis is conducted exclusively at the application level. <br><br><img src="https://habrastorage.org/files/b3e/0d0/8f7/b3e0d08f77a64d679a37f7a83cf8cb4b.jpg"><br><h4>  3. All in a bunch: NGFW / UTM </h4><br><br>  The next step in the evolution of intrusion detection systems was the emergence of UTM (unified threat management, system of unified threat management) and NGFW (next generation firewall, new generation screens) devices. <br><br>  UTM systems differ from NGFW only in marketing, and their functionality practically coincides.  Both classes of software products were an attempt to combine the functions of different products (antivirus, IDS / IPS, packet filter, VPN gateway, router, balancer, etc.) in one device.  At the same time, the detection of attacks in UTM / NGFW devices is often carried out on the old technological base, using the above-mentioned preprocessors. <br><br>  The specificity of web applications suggests that during a single user session with a web server, a large number of different TCP connections can be made that open from different addresses, but have one (possibly dynamic) session identifier.  This leads to the fact that a platform based on a full-featured reverse proxy server is required to accurately protect web traffic. <br><br>  But the difference in the technology platform is not the only thing that distinguishes the protection of web applications. <br><br><img src="https://habrastorage.org/files/711/d4b/b89/711d4bb89bd941dab06efc38671198de.jpg"><br><h4>  4. Protecting the Web: What WAF Should Know </h4><br><br>  Speaking quite simply, web applications differ from ordinary applications in two things: a huge variety and significant interactivity.  This creates a number of new threats that traditional firewalls do not cope with: according to our estimates, in 2014, 60% of attacks against corporate networks were carried out through web applications, despite the presence of traditional defenses. <br><br>  This is where the Web Application Firewall (WAF) comes in, a firewall for applications that transmit data over HTTP and HTTPS.  Here are the features that distinguish WAF from previous generation security systems: <br><br><table><tbody><tr><th></th><th>  Waf </th><th>  IPS </th><th>  NGFW / UTM </th></tr><tr><td>  Multiprotocol <br>  Security </td><td>  - </td><td>  + </td><td>  + </td></tr><tr><td>  IP Reputation </td><td>  ¬± </td><td>  ¬± </td><td>  ¬± </td></tr><tr><td>  Signatures <br>  attacks </td><td>  + </td><td>  ¬± </td><td>  ¬± </td></tr><tr><td>  Automatic <br>  training, behavioral analysis </td><td>  + </td><td>  - </td><td>  - </td></tr><tr><td>  Protection <br>  users </td><td>  + </td><td>  - </td><td>  - </td></tr><tr><td>  Scanner <br>  vulnerabilities </td><td>  + </td><td>  - </td><td>  - </td></tr><tr><td>  Virtual <br>  patching </td><td>  + </td><td>  - </td><td>  - </td></tr><tr><td>  Correlations, attack chains </td><td>  + </td><td>  - </td><td>  - </td></tr></tbody></table><br>  Now more about what all these points mean: <br><br><h5>  Multiprotocol Security </h5><br>  Being a highly specialized tool, WAF does not protect against protocol problems other than HTTP / HTTPS.  But any medal has two sides.  The variety of ways to exchange data over the HTTP protocol is so great that only a specialized tool can navigate it.  Just for example: somewhere, variables and values ‚Äã‚Äãare transmitted in the format of <a href="http://example.com/animals%3Fdogs%3D32%26cats%3D23">example.com/animals?dogs=32&amp;cats=23</a> , somewhere in the format of <a href="http://example.com/animals/dogs/32/cats/23">example.com/animals/dogs/32/cats/23</a> , somewhere the transfer of application parameters carried out in a cookie, and somewhere in the parameters of the HTTP header. <br><br>  In addition, advanced WAF models can analyze XML, JSON, and other protocols of modern portals and mobile applications.  In particular, this allows counteracting most protective screen bypass methods (HPC, HPP, Verb Tampering, etc.). <br><br><h5>  IP Reputation </h5><br>  IP-Reputation technology relies on external black and white lists of resources, and is equally accessible to any perimeter protection.  But the value of this method is somewhat exaggerated.  Thus, in the practice of our specialists, there were situations when large news agencies, because of their vulnerabilities, distributed malware to users for months, and at the same time did not fall into the black lists.  Unfortunately, malware penetration vectors are very diverse, and nowadays even sites of public authorities can be a source of infection for users.  And the reverse problem is possible when ‚Äúinnocent‚Äù resources are blocked by IP. <br><br><h5>  Attack signatures </h5><br>  The signature approach to detecting attacks is applied everywhere, but only competent traffic preprocessing available for WAF can ensure adequate signatures.  Disadvantages of preprocessing lead to excessive ‚Äúmonstrousness‚Äù of attack signatures: administrators cannot understand the most complicated regular expressions, the whole point of which is that their authors, for example, just tried to take into account the possibility of passing a parameter both in plain text and in the form of hexadecimal code with by percentage. <br><br><h5>  Automated learning and behavioral analysis </h5><br>  Attackers actively use zero-day (0-day) vulnerabilities to attack web applications, which makes signature analysis methods useless.  Instead, you need to analyze network traffic and system logs to create a model for the normal functioning of the application, and on the basis of this model to identify the anomalous behavior of the system.  WAF, by virtue of its architecture, can parse the entire user session, and therefore is capable of more in-depth behavioral analysis than NGFW.  In particular, it allows detecting attacks using automated tools (scanning, password selection, DDoS, fraud, involvement in botnets). <br><br>  However, in most cases, the behavioral model training consists in the fact that operators from somewhere take ‚Äúwhite traffic‚Äù and ‚Äúfeed‚Äù it to their means of protection.  But after commissioning, user behavior may change: programmers finish the interface according to the adjusted technical specifications, designers ‚Äúadd beauty‚Äù, advertising campaigns change the direction of attention.  It is impossible to chart once and for all the behavior of the ‚Äúright‚Äù visitor.  At the same time, only units of software products can be trained on real, ‚Äúgray‚Äù traffic - and these are only WAFs. <br><br><h5>  User protection </h5><br>  The perimeter equipment discussed in this article is designed to protect servers with web applications.  However, there is a class of attacks (for example, CSRF) aimed at the client of the web application.  Since the attack traffic does not pass through the protective perimeter, at first glance it is impossible to protect the user. <br><br>  Consider the following attack scenario: the user enters the bank site, authenticates there, and then opens the infected resource in another browser tab.  JavaScript, loaded in another window, can make a request to transfer money secretly from the user, and the browser at the same time substitute all the necessary authentication parameters for the implementation of a financial transaction, since the user's communication session with the bank has not yet ended.  In this situation, there is a weakness in the authentication algorithm in the banking software.  If for each form contained on the site page a unique token was generated, there would be no problem. <br><br>  Unfortunately, software developers almost never do this.  However, some WAFs can independently implement such protection in web forms and thus protect the client ‚Äî or rather, its requests, data, URLs, and cookies. <br><br><h5>  Interaction with vulnerability scanners </h5><br>  Perimeter equipment is assigned not only the task of protecting web applications, but also the task of monitoring attacks.  At the same time, competent monitoring is based on an understanding of the weaknesses of the protected software, which makes it possible to weed out irrelevant attempts at attacks and isolate only those relating to real vulnerabilities present in the system. <br><br>  The best samples of WAF are available with integrated vulnerability scanners operating in black box mode or dynamic analysis (DAST).  Such a scanner can be used in real time to quickly check for vulnerabilities that intruders attack. <br><br><h5>  Virtual patching </h5><br>  Even known vulnerabilities cannot be fixed right away: fixing a code requires time and money, and often, stopping important business processes;  sometimes, when using third-party software, fixing is not possible at all.  For countering such "private" threats in IDS / IPS systems, and inherited from UTM / NGFW, custom signatures are used.  But the problem is that writing such a signature requires a deep understanding of the attack mechanism from the user.  Otherwise, the user signature can not only ‚Äúmiss‚Äù the threat, but also generate a large number of false positives. <br><br>  In the most modern WAF, an automated approach to virtual patching is used.  For this, an application source code analyzer (SAST, IAST) is used, which not only shows the lines of the vulnerable code in the report, but immediately generates an exploit, that is, a call with specific values ‚Äã‚Äãto exploit the detected vulnerability.  These exploits are sent to WAF to automatically create virtual patches that provide an immediate ‚Äúclosing in the gap‚Äù before the code is fixed. <br><br><h5>  Correlations and attack chains </h5><br>  A traditional firewall provides thousands of suspicious events that need to be manually handled to identify the real threat.  As noted by Gartner, vendors of IPS systems generally prefer to disable most web application signatures to reduce the risk of such problems. <br><br>  Modern WAF can group similar operations and identify a chain of attack development - from intelligence to theft of important data or bookmarking.  As a result, instead of a list of thousands of suspicious events, information security specialists receive several dozen truly important messages. <br><br><h4>  What's next? </h4><br>  It is clear that the solutions of different vendors of WAF will always differ in the set of functions.  Therefore, we list here only the most well-known additional features of modern protective screens of the application level: <br><br><ul><li>  Work with SSL-traffic as an additional level of protection.  According to Gartner analysts, the ability to check encrypted traffic is one of the most important differences between WAF and regular firewalls and IPS. </li><li>  Authentication services: WAF is a single entry point for web applications or acts as an authentication broker for legacy applications whose authentication mechanism is broken. </li><li>  Support Content Security Policy (CSP) to protect against XSS and other attacks. </li></ul><br>  In addition, experts from Positive Technologies predict the following promising directions for the development of application-level firewalls in the near future: <br><br><ul><li>  New behavioral analysis algorithms that will better distinguish users to identify bots and intruders (UBA). </li><li>  Protection of applications built on the basis of HTML5, protocols based on XML, using non-relational databases (NoSQL). </li><li>  WAF, focused on specific types of applications: banking (RBS), ERP systems, telecom applications, mass media, etc. </li></ul><br>  Finally it is worth noting that this article is devoted only to the technological features of WAF.  But in practice it is worth taking into account organizational ones - for example, compliance with security standards or the possibility of integrating WAF with other security tools (antivirus, DLP, etc.).  Deployment models can also be different: it can be a hardware, software or virtual solution, or a cloud service in SaaS, VAS and MSS models. <br><br>  <b>PS We remind you that you can get for free testing a protective screen of the PT Application Firewall level here: <a href="http://af.ptsecurity.ru/">af.ptsecurity.ru</a></b> </div><p>Source: <a href="https://habr.com/ru/post/269165/">https://habr.com/ru/post/269165/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../269155/index.html">Google ordered smartphone makers to encrypt data on Android 6 devices by default</a></li>
<li><a href="../269157/index.html">October 31, 2015 - EOL application Kerio Control 7 for Windows (Post # 1 - basic information)</a></li>
<li><a href="../269159/index.html">Free cloud hosting for students in Microsoft Azure</a></li>
<li><a href="../269161/index.html">AVG antivirus company can now sell data of its customers</a></li>
<li><a href="../269163/index.html">Service for the system administrator. Part 1</a></li>
<li><a href="../269167/index.html">Combined ABC and XYZ analysis in Retail</a></li>
<li><a href="../269169/index.html">Amazon's legendary books. Continuing the theme of "Elements of Programming Interviews: The Insiders' Guide"</a></li>
<li><a href="../269171/index.html">‚ÄúWhat's new in Swift 2?‚Äù With examples</a></li>
<li><a href="../269173/index.html">Oracle, typical SQL tasks. The multiplication of the rows of the table depending on the value of the number in the column</a></li>
<li><a href="../269175/index.html">Course on machine learning on Coursera from Yandex and HSE</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>