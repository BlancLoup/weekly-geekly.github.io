<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Openstack Load Balancing</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In large cloud systems, the issue of automatic balancing or balancing the load on computing resources is especially acute. Tionics also took care of t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Openstack Load Balancing</h1><div class="post__text post__text-html js-mediator-article">  In large cloud systems, the issue of automatic balancing or balancing the load on computing resources is especially acute.  Tionics also took care of this issue (the developer and operator of cloud services, we are part of the Rostelecom group of companies). <br><br>  And, since our main development platform is Openstack, and we, like all people, are lazy, it was decided to choose some kind of ready-made module that is already part of the platform.  Our choice fell on Watcher, which we decided to use for our needs. <br> <a href="https://habr.com/ru/company/rostelecom/blog/461483/"><img src="https://habrastorage.org/webt/i_/o6/ll/i_o6llxyfnumqc0nqrlnuk-ptem.jpeg" width="900"></a> <br>  First, let's deal with terms and definitions. <br><a name="habracut"></a><br><h2>  Terms and Definitions </h2><br>  <b>A goal</b> is a human-readable, observable, and measurable end result that must be achieved.  To achieve each goal, there are one or more strategies.  A strategy is an implementation of an algorithm that is able to find a solution for a given purpose. <br><br>  <b>An Action</b> is an elementary task that changes the current state of a target managed resource of an OpenStack cluster, such as: migrating a virtual machine (migration), changing the power state of a node (change_node_power_state), changing the state of a nova service (change_nova_service_state), changing a flavor (resize) , registration of NOP messages (nop), lack of action for a certain length of time - pause (sleep), disk transfer (volume_migrate). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Action Plan (Action Plan)</b> - a specific stream of actions carried out in a specific order to achieve a specific Goal.  The action plan also contains estimated global performance with a set of performance indicators.  An action plan is generated by Watcher upon a successful audit, as a result of which the strategy used finds a solution to achieve the goal.  An action plan consists of a list of sequential actions. <br><br>  <b>Audit</b> is a request for cluster optimization.  Optimization is performed in order to achieve one goal in a given cluster.  For each successful audit, Watcher generates an Action Plan. <br><br>  <b>Audit Scope</b> is a set of resources within which an audit is performed (availability zone (s), node aggregators, individual computing nodes or storage nodes, etc.).  An audit scope is defined in each template.  If the audit scope is not specified, the entire cluster is audited. <br><br>  <b>Audit Template</b> - A saved set of settings for starting an audit.  Templates are needed in order to run audits with the same settings multiple times.  The template must necessarily contain the purpose of the audit, if strategies are not indicated, then the most suitable of existing strategies are selected. <br><br>  <b>A Cluster</b> is a collection of physical machines that provide computing, storage, and network resources and are managed by the same OpenStack control node. <br><br>  <b>The Cluster Data Model (CDM)</b> is a logical representation of the current state and topology of cluster-managed resources. <br><br>  <b>Efficiency Indicator (Efficacy Indicator)</b> - an indicator that indicates how the solution created using this strategy is implemented.  Performance indicators are specific to a particular goal and are commonly used to calculate the global effectiveness of a final action plan. <br><br>  <b>The Efficacy Specification</b> is a set of specific features associated with each Goal, which defines various performance indicators that the strategy ensuring the achievement of the corresponding goal should provide in its decision.  Indeed, each solution proposed by the strategy will be checked for compliance with specifications before calculating its global effectiveness. <br><br>  <b>A ‚Äúscoring engine‚Äù</b> is an executable file that has clearly defined input data, clearly defined output data and performs a purely mathematical task.  Thus, the calculation does not depend on the environment in which it is performed - it will give the same result anywhere. <br><br>  <b>The Watcher Planner</b> is part of the Watcher decision engine.  This module accepts the set of actions generated by the strategy and creates a workflow plan that defines how to plan these various actions in time and for each action, what are the prerequisites. <br><br><h2>  Watcher Goals and Strategies </h2><br><div class="scrollable-table"><table><tbody><tr><td>  <b>purpose</b> </td><td>  Strategies </td></tr><tr><td rowspan="3">  <b>Dummy goal</b> </td><td>  Dummy strategy </td></tr><tr><td>  Dummy Strategy using sample Scoring Engines </td></tr><tr><td>  Dummy strategy with resize </td></tr><tr><td>  <b>Saving energy</b> </td><td>  Saving energy strategy </td></tr><tr><td rowspan="2">  <b>Server consolidation</b> </td><td>  Basic Offline Server Consolidation </td></tr><tr><td>  VM Workload Consolidation Strategy </td></tr><tr><td rowspan="3">  <b>Workload balancing</b> </td><td>  Workload Balance Migration Strategy </td></tr><tr><td>  Storage Capacity Balance Strategy </td></tr><tr><td>  Workload stabilization </td></tr><tr><td>  <b>Noisy neighbor</b> </td><td>  Noisy neighbor </td></tr><tr><td>  <b>Thermal optimization</b> </td><td>  Outlet temperature based strategy </td></tr><tr><td>  <b>Airflow optimization</b> </td><td>  Uniform airflow migration strategy </td></tr><tr><td>  <b>Hardware maintenance</b> </td><td>  Zone migration </td></tr><tr><td>  <b>Unclassified</b> </td><td>  Actuator </td></tr></tbody></table></div><br>  <b>Dummy goal</b> - a reserve goal that is used for testing purposes. <br><br>  Related strategies: Dummy Strategy, Dummy Strategy using sample Scoring Engines and Dummy strategy with resize.  Dummy strategy is a dummy strategy used for integration testing through Tempest.  This strategy does not provide any useful optimization; its sole purpose is to use the Tempest tests. <br><br>  Dummy strategy using sample Scoring Engines - the strategy is similar to the previous one, it differs only in the use of the ‚Äúrating engine‚Äù sample, which conducts calculations using machine learning methods. <br><br>  Dummy strategy with resize - the strategy is similar to the previous one, it differs only in the use of changing the flavor (migration and resize). <br><br>  Not used in production. <br><br>  <b>Saving Energy</b> - minimize energy consumption.  Strategy for this goal Saving Energy Strategy together with the strategy VM Workload Consolidation Strategy (Server Consolidation) is able to perform the functions of dynamic power management (DPM), which save energy by dynamically consolidating workloads even during periods of low resource load: virtual machines are transferred to fewer nodes , and unnecessary nodes are disconnected.  After consolidation, the strategy offers a decision on turning on / off the nodes in accordance with the given parameters: ‚Äúmin_free_hosts_num‚Äù - the number of free included nodes that are waiting for load, and ‚Äúfree_used_percent‚Äù - the percentage of free included nodes to the number of nodes occupied by the machines.  For the strategy <b>to work, Ironic</b> must be <b>turned on and configured to work with power on / off on the nodes.</b> <br><br><h3>  Strategy Options </h3><br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>free_used_percent</b> </td><td>  Number </td><td>  10.0 </td><td>  ratio of the number of free computing nodes to the number of computing nodes with virtual machines </td></tr><tr><td>  <b>min_free_hosts_num</b> </td><td>  Int </td><td>  one </td><td>  minimum number of free computing nodes </td></tr></tbody></table></div><br>  There must be at least two nodes in the cloud.  The method used is changing the power state of the node (change_node_power_state).  <b>Strategy does not require collection of metrics.</b> <br><br>  Server Consolidation - minimize the number of compute nodes (consolidation).  It has two strategies: Basic Offline Server Consolidation and VM Workload Consolidation Strategy. <br><br>  The Basic Offline Server Consolidation strategy minimizes the total number of servers used and minimizes the number of migrations. <br><br>  <b>The basic strategy requires the following metrics:</b> <b><br></b> <br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>compute.node.cpu.percent</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr></tbody></table></div><br>  Strategy parameters: migration_attempts - the number of combinations to search for potential shutdown candidates (default, 0, no restrictions), period - time interval in seconds to obtain static aggregation from the metric data source (700 by default). <br><br>  Methods used: migration, nova service state change (change_nova_service_state). <br><br>  The VM Workload Consolidation Strategy is based on the first-fit heuristic algorithm, which focuses on the measured CPU load and tries to minimize nodes that have too much or too little load, taking into account resource capacity limitations.  This strategy provides a solution that leads to a more efficient use of cluster resources using the following four steps: <br><br><ol><li>  Unloading phase - processing of overspended resources; </li><li>  Consolidation phase - processing of underutilized resources; </li><li>  Solution optimization - reducing the number of migrations; </li><li>  Disabling unused compute nodes. </li></ol><br>  The strategy requires the following metrics: <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>memory</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr><tr><td>  <b>disk.root.size</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr></tbody></table></div><br>  The following metrics are optional, but improve strategy accuracy if available: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>memory.resident</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr></tbody></table></div><br>  Strategy parameters: period - the time interval in seconds to obtain static aggregation from the metric data source (3600 by default). <br><br>  Uses the same methods as the previous strategy.  More details <a href="https://docs.openstack.org/watcher/queens/strategies/vm_workload_consolidation.html">here</a> . <br><br>  <b>Workload Balancing</b> - balance workload between compute nodes.  The goal has three strategies: Workload Balance Migration Strategy, Workload stabilization, Storage Capacity Balance Strategy. <br><br>  Workload Balance Migration Strategy launches virtual machine migrations based on the workload of host virtual machines.  The decision to transfer is made whenever the% of CPU or RAM utilization of the node exceeds the specified threshold.  At the same time, the moved virtual machine should bring the node closer to the average workload of all nodes. <br><br><h3>  Requirements </h3><br><ul><li>  Use of physical processors; </li><li>  At least two physical computing nodes; </li><li>  The installed and configured Ceilometer component is the ceilometer-agent-compute, which works on each computing node, and the Ceilometer API, as well as collecting the following metrics: </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr><tr><td>  <b>memory.resident</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr></tbody></table></div><br>  Strategy Options: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>metrics</b> </td><td>  String </td><td>  'cpu_util' </td><td>  The metrics that underlie: 'cpu_util', 'memory.resident'. </td></tr><tr><td>  <b>threshold</b> </td><td>  Number </td><td>  25.0 </td><td>  Workload threshold for migration. </td></tr><tr><td>  <b>period</b> </td><td>  Number </td><td>  300 </td><td>  The cumulative time period of the Ceilometer. </td></tr></tbody></table></div><br>  The method used is migration. <br><br>  Workload stabilization - a strategy aimed at stabilizing the workload using live migration.  The strategy is based on the standard deviation algorithm and determines if there is congestion in the cluster and responds to it by triggering a machine migration to stabilize the cluster. <br><br><h3>  Requirements </h3><br><ul><li>  Use of physical processors; </li><li>  At least two physical computing nodes; </li><li>  The installed and configured Ceilometer component is the ceilometer-agent-compute, which works on each computing node, and the Ceilometer API, as well as collecting the following metrics: </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>cpu_util</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr><tr><td>  <b>memory.resident</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td></td></tr></tbody></table></div><br>  Storage Capacity Balance Strategy (a strategy implemented since Queens) - the strategy transfers disks depending on the load of Cinder pools.  The transfer decision is made whenever the pool utilization exceeds the specified threshold.  A roaming disk should bring the pool closer to the average load of all Cinder pools. <br><br><h3>  Requirements and Limitations </h3><br><ul><li>  At least two Cinder pools; </li><li>  Ability to migrate disks. </li><li>  Cluster data model collector. </li></ul><br>  Strategy Options: <br><br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>volume_threshold</b> </td><td>  Number </td><td>  80.0 </td><td>  Threshold value of disks for volume balancing. </td></tr></tbody></table></div><br>  The method used is disk migration (volume_migrate). <br><br>  Noisy Neighbor - identify and migrate a ‚Äúnoisy neighbor‚Äù - a low-priority virtual machine that adversely affects the performance of a high-priority virtual machine from an IPC perspective, overuse of the Last Level Cache.  Own strategy: Noisy Neighbor (the strategy parameter used is cache_threshold (the default value is 35), migration starts when the performance drops to the specified value. For the strategy to work, the included <b>LLC (Last Level Cache) metrics, the</b> <b>latest Intel server with CMT support</b> , and also collection of the following metrics: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>cpu_l3_cache</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  none </td><td>  Intel <a href="http://www.intel.com/content/www/us/en/architecture-and-technology/resource-director-technology.html">CMT</a> required. </td></tr></tbody></table></div><br>  Cluster data model (default): Nova cluster data model collector.  The applied method is migration. <br><br>  Work with this goal through the Dashboard is not fully implemented in Queens. <br><br>  <b>Thermal Optimization</b> - optimize temperature conditions.  The outlet temperature (exhaust air) is one of the important thermal telemetry systems for measuring the state of the server‚Äôs thermal / workload.  For the purpose, there is one strategy - Outlet temperature based strategy, which makes decisions on transferring workloads to nodes with favorable temperature conditions (the lowest temperature at the exit) when the temperature at the output of the original hosts reaches a custom threshold. <br><br>  For the strategy to work, you need a server with Intel Power Node Manager <a href="https://www.intel.com/content/www/us/en/power-management/intelligent-power-node-manager-3-0-specification.html">3.0 or later</a> installed and configured, as well as collecting the following metrics: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>hardware.ipmi.node.outlet_temperature</b> </td><td>  <a href="https://docs.openstack.org/ceilometer/latest/admin/telemetry-measurements.html">ceilometer</a> </td><td>  IPMI </td><td></td></tr></tbody></table></div><br>  Strategy Options: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>threshold</b> </td><td>  Number </td><td>  35.0 </td><td>  Temperature threshold for migration. </td></tr><tr><td>  <b>period</b> </td><td>  Number </td><td>  thirty </td><td>  The time interval in seconds to obtain statistical aggregation from a metric data source. </td></tr></tbody></table></div><br>  The method used is migration. <br><br>  <b>Airflow Optimization</b> - optimize the ventilation mode.  Own strategy - Uniform Airflow using live migration.  The strategy starts the migration of the virtual machine whenever the air flow from the server fan exceeds the specified threshold. <br><br>  To work, the strategy requires: <br><br><ul><li>  Hardware: computing nodes &lt;with support for NodeManager 3.0; </li><li>  At least two compute nodes; </li><li>  The ceilometer-agent-compute and Ceilometer API components installed and configured on each computing node can successfully report metrics such as air flow, system power, and inlet temperature: </li></ul><br><div class="scrollable-table"><table><tbody><tr><td>  <b>metrics</b> </td><td>  <b>service</b> </td><td>  <b>plugins</b> </td><td>  <b>comment</b> </td></tr><tr><td>  <b>hardware.ipmi.node.airflow</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  IPMI </td><td></td></tr><tr><td>  <b>hardware.ipmi.node.temperature</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  IPMI </td><td></td></tr><tr><td>  <b>hardware.ipmi.node.power</b> </td><td>  <a href="http://docs.openstack.org/admin-guide/telemetry-measurements.html">ceilometer</a> </td><td>  IPMI </td><td></td></tr></tbody></table></div><br>  For the strategy to work, a server with installed and configured Intel Power Node Manager 3.0 or later is required. <br><br>  Limitations: The concept is not intended for production. <br><br>  It is proposed to use this algorithm with continuous audits, since only one virtual machine is planned to be migrated per iteration. <br><br>  Live migrations are possible. <br><br>  Strategy Options: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>threshold_airflow</b> </td><td>  Number </td><td>  400.0 </td><td> Airflow threshold for migration Unit is 0.1CFM </td></tr><tr><td>  <b>threshold_inlet_t</b> </td><td>  Number </td><td>  28.0 </td><td>  Inlet temperature threshold for migration decision </td></tr><tr><td>  <b>threshold_power</b> </td><td>  Number </td><td>  350.0 </td><td>  System power threshold for migration decision </td></tr><tr><td>  <b>period</b> </td><td>  Number </td><td>  thirty </td><td>  The time interval in seconds to obtain statistical aggregation from a metric data source. </td></tr></tbody></table></div><br>  The method used is migration. <br><br>  <b>Hardware Maintenance</b> - hardware maintenance.  A strategy related to this goal is Zone migration.  The strategy is a tool for efficient automatic and minimal migration of virtual machines and disks in case of hardware maintenance.  The strategy builds an action plan in accordance with the weights: a set of actions that has more weight will be planned ahead of the others.  There are two configuration options: action weights (action_weights) and parallelization. <br><br>  Limitations: it is necessary to adjust the weights of actions and parallelization. <br><br>  Strategy Options: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>compute_nodes</b> </td><td>  array </td><td>  None </td><td>  Computing nodes for migration. </td></tr><tr><td>  <b>storage_pools</b> </td><td>  array </td><td>  None </td><td>  Storage nodes for migration. </td></tr><tr><td>  <b>parallel_total</b> </td><td>  integer </td><td>  6 </td><td>  The total number of actions to be performed in parallel. </td></tr><tr><td>  <b>parallel_per_node</b> </td><td>  integer </td><td>  2 </td><td>  The number of actions performed in parallel for each computing node. </td></tr><tr><td>  <b>parallel_per_pool</b> </td><td>  integer </td><td>  2 </td><td>  The number of actions performed in parallel for each storage pool. </td></tr><tr><td>  <b>priority</b> </td><td>  object </td><td>  None </td><td>  Priority list for virtual machines and disks. </td></tr><tr><td>  <b>with_attached_volume</b> </td><td>  boolean </td><td>  False </td><td>  False - virtual machines will be migrated after all drives are migrated.  True - virtual machines will be migrated after the migration of all mapped drives. </td></tr></tbody></table></div><br>  Elements of an array of compute nodes: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>src_node</b> </td><td>  string </td><td>  None </td><td>  Computing node from which virtual machines are migrated (required). </td></tr><tr><td>  <b>dst_node</b> </td><td>  string </td><td>  None </td><td>  Compute the node to which virtual machines migrate. </td></tr></tbody></table></div><br>  Elements of the array of storage nodes: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>src_pool</b> </td><td>  string </td><td>  None </td><td>  Storage pool from which disks are migrated (required). </td></tr><tr><td>  <b>dst_pool</b> </td><td>  string </td><td>  None </td><td>  Storage pool to which disks are migrated. </td></tr><tr><td>  <b>src_type</b> </td><td>  string </td><td>  None </td><td>  Original disk type (required). </td></tr><tr><td>  <b>dst_type</b> </td><td>  string </td><td>  None </td><td>  Final drive type (required). </td></tr></tbody></table></div><br>  Elements of priority objects: <br><div class="scrollable-table"><table><tbody><tr><td>  <b>parameter</b> </td><td>  <b>type of</b> </td><td>  <b>default</b> </td><td>  <b>description</b> </td></tr><tr><td>  <b>project</b> </td><td>  array </td><td>  None </td><td>  The names of the projects. </td></tr><tr><td>  <b>compute_node</b> </td><td>  array </td><td>  None </td><td>  Names of compute nodes. </td></tr><tr><td>  <b>storage_pool</b> </td><td>  array </td><td>  None </td><td>  The names of the storage pools. </td></tr><tr><td>  <b>compute</b> </td><td>  enum </td><td>  None </td><td>  Virtual machine parameters [‚Äúvcpu_num‚Äù, ‚Äúmem_size‚Äù, ‚Äúdisk_size‚Äù, ‚Äúcreated_at‚Äù]. </td></tr><tr><td>  <b>storage</b> </td><td>  enum </td><td>  None </td><td>  Disk options [‚Äúsize‚Äù, ‚Äúcreated_at‚Äù]. </td></tr></tbody></table></div><br>  Used methods - migration of virtual machines, migration of disks. <br><br>  <b>Unclassified</b> is a supporting goal used to facilitate the strategy development process.  It does not contain specifications and can be used whenever the strategy is not yet connected with an existing goal.  This goal can also be used as a transitional phase.  A related strategy is Actuator. <br><br><h2>  Create a new goal </h2><br>  <b>The Watcher Decision Engine</b> has an ‚Äúexternal goal‚Äù plugin interface that allows you to integrate an external goal that can be achieved using strategy. <br><br>  Before creating a new goal, you should make sure that none of the existing goals meets your needs. <br><br><h3>  Create a new plugin </h3><br>  To create a new target, you must: extend the target class, implement the <b>get_name ()</b> class method to return a unique identifier for the new target that you want to create.  This unique identifier must match the name of the entry point that you declare later. <br><br>  Next, you need to implement the class method <b>get_display_name ()</b> to return the translated display name of the target you want to create (do not use the variable to return the translated string so that it can be automatically collected by the translation tool.). <br><br>  Implement the <b>get_translatable_display_name ()</b> class method to return the translation key (actually the English display name) of your new target.  The return value must match the string translated into get_display_name (). <br><br>  Implement its <b>get_efficacy_specification ()</b> method to return the performance specification for your purpose.  The get_efficacy_specification () method returns the Unclassified () instance provided by Watcher.  This performance specification is useful in the process of developing your goal because it meets the empty specification. <br><br>  ‚Üí <a href="https://docs.openstack.org/watcher/pike/contributor/plugin/goal-plugin.html">More details here</a> <br><br>  Architecture Watcher (more info <a href="https://docs.openstack.org/watcher/queens/architecture.html">here</a> ). <br><br><img src="https://habrastorage.org/webt/q7/ei/fb/q7eifbf7zjvdiwm3cna7ipzttyq.png"><br><br><h3>  Components </h3><br><img src="https://habrastorage.org/webt/rx/fv/om/rxfvom9yai_at5zt7bwlxs4ole0.png"><br><br>  <b>Watcher API</b> - a component that implements the REST API provided by Watcher.  Interaction mechanisms: CLI, Horizon plugin, Python SDK. <br><br>  <b>Watcher DB</b> - Watcher database. <br><br>  <b>Watcher Applier</b> - a component that implements the action plan created by the component Watcher Decision Engine. <br><br>  <b>The Watcher Decision Engine</b> is a component responsible for calculating a set of potential optimization actions to fulfill an audit goal.  If a strategy is not specified, the component independently selects the most suitable one. <br><br>  <b>Watcher Metrics Publisher</b> is a component that collects and calculates some metrics or events and publishes them at the CEP endpoint.  Feature functionality may also be provided by Ceilometer publisher. <br><br>  <b>Complex Event Processing (CEP) Engine</b> - an integrated event processing engine.  For performance reasons, there may be several CEP Engine instances running at the same time, each of which handles a specific type of metric / event.  In the Watcher system, CEP launches two types of actions: - write the corresponding events / metrics to the time series database;  - send relevant events to the Watcher Decision Engine component when this event can affect the result of the current optimization strategy, since the Openstack cluster is not a static system. <br><br>  The interaction of the components is carried out according to the AMQP protocol. <br><br>  ‚Üí <a href="https://docs.openstack.org/watcher/queens/configuration/configuring.html">Configuring Watcher</a> <br><br><h3>  Scheme of interaction with Watcher </h3><br><img src="https://habrastorage.org/webt/_w/0a/di/_w0adiqerc6ar47nhdoitlh1uje.png"><br><br><h2>  Watcher Test Results </h2><br><ol><li>  On the Optimization - Action plans 500 page, an error (both on a clean Queens, and on a stand with Tionics modules) appears only after the audit is started and an action plan is generated, an empty one opens normally. </li><li>  On the Action details tab of the error, it is not possible to get the goal and audit strategy (both on pure Queens and on the stand with Tionics modules). </li><li>  Audits for the purpose of Dummy (test) are created and run normally, action plans are generated. </li><li>  No audits are created for the Unclassified target, because the target is not functional and is intended for intermediate configuration when creating new strategies. </li><li>  Workload Balancing audits (Storage Capacity balance strategy) are created successfully, but no action plan is generated.  No optimization of storage pools. </li><li>  Workload Balancing audits (Workload Balance Migration Strategy) are created successfully, but no action plan is generated. </li><li>  Audits for the Workload Balancing goal (Workload Stabilization Strategy) fail. </li><li>  Noisy Neighbor audits are created successfully, but no action plan is generated. </li><li>  Audits for the purpose of Hardware maintenance are created successfully, the action plan is not generated in full (performance indicators are generated, but the list of actions is not generated). </li><li>  Edits in the nova.conf configs (in the default section compute_monitors = cpu.virt_driver) on the compute and control nodes do not fix errors. </li><li>  Audits for Server Consolidation (Basic Strategy) also fail. </li><li>  Audits for Server Consolidation (VM workload consolidation strategy) fail.  In the logs, an error occurred in obtaining the initial data.  A discussion of the error, in particular, is <a href="https://bugs.launchpad.net/watcher/%2Bbug/1773144">here</a> . <br>  We tried to specify Watcher in the config file (it did not help - as a result of an error on all Optimization pages, returning to the original contents of the config file does not correct the situation): <br><br>  [watcher_strategies.basic] <br>  datasource = ceilometer, gnocchi </li><li>  Audits for Saving Energy fail.  Judging by the logs, the problem is still in the absence of Ironic, it will not work without baremetal service. </li><li>  Thermal Optimization Audits fail.  The traceback is the same as for Server Consolidation (VM workload consolidation strategy) (source data error) </li><li>  Audits for Airflow Optimization fail. </li></ol><br>  The following audit completion errors are also encountered.  Traceback in decision-engine.log logs (cluster state is not defined). <br><br>  ‚Üí Discussion of the error <a href="https://bugs.launchpad.net/watcher/%2Bbug/1779679">here</a> <br><br><h2>  Conclusion </h2><br>  The result of our two-month research was the unambiguous conclusion that in order to get a full-fledged, working load balancing system, we will have to work closely on finalizing the tools for the Openstack platform. <br><br>  Watcher has proved itself to be a serious and rapidly developing product with enormous potential, for the full use of which a lot of serious work will be required. <br><br>  But more about that in the next articles of the cycle. </div><p>Source: <a href="https://habr.com/ru/post/461483/">https://habr.com/ru/post/461483/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../461467/index.html">An example of creating a Makefile for Go applications</a></li>
<li><a href="../461469/index.html">What is it like listening to code at 1000 words per minute</a></li>
<li><a href="../46147/index.html">Selected: Grouping</a></li>
<li><a href="../461473/index.html">Debugging algorithms on graphs - now with pictures</a></li>
<li><a href="../461475/index.html">AMA with Habr. 1011</a></li>
<li><a href="../461487/index.html">Mini CTF Tests</a></li>
<li><a href="../461493/index.html">Django 3.0 will be asynchronous</a></li>
<li><a href="../461497/index.html">Modern text rendering on Linux: part 1</a></li>
<li><a href="../461499/index.html">What languages ‚Äã‚Äãto translate your game in 2019</a></li>
<li><a href="../4615/index.html">FAS vs NWT: answer for dial-up</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>