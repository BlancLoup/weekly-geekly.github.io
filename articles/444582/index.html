<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Palo Alto Networks NGFW Security Policy Optimizer</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="How to evaluate the effectiveness of tuning NGFW 
 The most common task is to check how efficiently your firewall is configured. To do this, there are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Palo Alto Networks NGFW Security Policy Optimizer</h1><div class="post__text post__text-html js-mediator-article"><h1>  How to evaluate the effectiveness of tuning NGFW </h1><br>  The most common task is to check how efficiently your firewall is configured.  To do this, there are free utilities and services from companies that are engaged in NGFW. <br><br>  For example, it can be seen below that Palo Alto Networks has the opportunity directly from <a href="https://support.paloaltonetworks.com/">the support portal to</a> launch an analysis of firewall statistics ‚Äî an SLR report or a best-practice analysis ‚Äî a BPA report.  These are free online utilities that you can use without installing anything. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/78a/80b/f43/78a80bf4367e22b0164e1e51ab1e8c7f.png" alt="image"><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Content </h3><br>  <a href="https://habr.com/ru/post/444582/">Expedition (Migration Tool)</a> <br>  <a href="https://habr.com/ru/post/444582/">Policy optimizer</a> <br>  <a href="https://habr.com/ru/post/444582/">Zero trust</a> <br>  <a href="https://habr.com/ru/post/444582/">Click on Unused</a> <br>  <a href="https://habr.com/ru/post/444582/">Click on Unused App</a> <br>  <a href="https://habr.com/ru/post/444582/">Click No Apps Specified</a> <br>  <a href="https://habr.com/ru/post/444582/">But what about machine learning</a> <br>  <a href="https://habr.com/ru/post/444582/">UTD</a> <br><br><a name="Expedition"></a><h2>  Expedition (Migration Tool) </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/a69/c93/315/a69c93315444b867a2edfc77a4d3ee1f.png" alt="image"><br><br>  A more complicated way to check your settings is to download the free <a href="https://live.paloaltonetworks.com/t5/Expedition-Migration-Tool/ct-p/migration_tool">Expedition</a> utility (formerly the Migration Tool).  It is downloaded as a Virtual Appliance under VMware, with no settings required - you need to download an image and deploy it under the VMware hypervisor, launch it and access the web interface.  This utility requires a separate story, only the course on it takes 5 days, so many functions are there now, including Machine Learning and migration of different policy configurations, NAT and objects for different Firewall vendors.  About Machine Learning, I will write more below. <br><br><a name="Po"></a><h2>  Policy optimizer </h2><br>  And the most convenient option (IMHO), about which, today I will tell you in more detail - the policy optimizer built into the Palo Alto Networks interface itself.  To demonstrate it, I installed an internetwork screen at home and wrote a simple rule: permit any to any.  In principle, I sometimes see such rules even in corporate networks.  Naturally, I included all the NGFW security profiles, as seen in the screenshot: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4b1/80a/953/4b180a953837ac51dc997a095accfaf7.png" alt="image"><br><br>  The screenshot below shows an example of my home unconfigured firewall, where almost all connections fall into the last rule: AllowAll, as seen in the statistics in the Hit Count column. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/add/5c2/8f8/add5c28f86928c427de3de19f7a241eb.png" alt="image"><br><br><a name="ZeroTrust"></a><h2>  Zero trust </h2><br>  There is an approach to security called <a href="https://www.paloaltonetworks.com/cyberpedia/what-is-a-zero-trust-architecture">Zero Trust</a> .  What this means: we have to allow exactly the connections that they need and prohibit everything else to people within the network.  That is, we need to add clear rules on applications, users, URL categories, file types;  enable all IPS and antivirus signatures, enable sandbox, DNS protection, use IoC from the available Threat Intelligence databases.  In general, the tasks when setting up a firewall are a decent amount. <br><br>  By the way, the minimum set of required settings for Palo Alto Networks NGFW is described in one of the SANS documents: <a href="https://www.sans.org/reading-room/whitepapers/auditing/paper/35777">Palo Alto Networks Security Configuration Benchmark</a> - I recommend starting with it.  And of course there is a set of best practices for setting up a firewall at the manufacturing company: <a href="https://docs.paloaltonetworks.com/best-practices">Best Practice</a> . <br><br>  So, I had a firewall at home for a week.  Let's see what traffic in my network is: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2c7/a76/c84/2c7a76c84f2cba29e6104a7d2b935cef.png" alt="image"><br><br>  If you sort by the number of sessions, then bittorent creates them most, then comes SSL, then QUIC.  This is a statistic for both incoming and outgoing traffic: there are a lot of external scans of my router.  There are 150 different applications on my network. <br><br>  So, all this was omitted by one rule.  Now let's see what the Policy Optimizer says about this.  If you looked above at the screenshot of the interface with the security rules, then at the bottom left you saw a small window, which hints to me that there are rules that can be optimized.  Let's go there click. <br><br>  What Policy Optimizer shows: <br><br><ul><li>  What policies were not used at all, 30 days, 90 days.  It helps to decide to remove them altogether. </li><li>  What applications were specified in the policies, but such applications were not detected in the traffic.  This allows you to remove unnecessary applications in permissive rules. </li><li>  What politicians allowed everything, but there really were applications that it would be nice to indicate explicitly according to the Zero Trust methodology. </li></ul><br><img src="https://habrastorage.org/getpro/habr/post_images/cb2/2af/310/cb22af3108df55629d69daecd5b7db25.png" alt="image"><br><br><a name="Unused"></a><h3>  Click on Unused </h3><br>  To show how it works, I added a few rules and they have so far never missed a single package today.  Here is a list of them: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/534/08a/e2e53408ad1f94bee9d466ab7b214854.png" alt="image"><br><br>  Perhaps over time there will be traffic and then they will disappear from this list.  And if they are on this list for 90 days, then you can decide to delete these rules.  After all, every rule makes it possible for a hacker. <br><br>  There is a real problem in configuring the firewall: a new employee comes, looks at the firewall rules, if they have no comments and he does not know why this rule is created, whether it is really necessary, whether it can be removed: suddenly a person is on vacation and after 30 days traffic will go again from the service he needs.  And just this function helps him to make a decision - no one uses - to delete! <br><br><a name="UnusedApp"></a><h3></h3><h3>  Click on Unused App </h3><br>  We click on the Unused App in the optimizer and see that interesting information opens in the main window. <br><br>  We see that there are three rules, where the number of allowed applications and the number of applications actually under this rule differ. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9f8/293/98f/9f829398f37bddffe0f0663419970306.png" alt="image"><br><br>  We can click and see the list of these applications and compare these lists. <br><br>  For example, click on the Compare button for the Max. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/418/108/5eb/4181085eb0bffd6454b71eae0c67f21c.png" alt="image"><br><br>  Here you can see that facebook, instagram, telegram, vkontakte applications were enabled.  But the actual traffic went only in terms of sub-applications.  Here you need to understand that the facebook application contains several sub-applications. <br><br>  The entire list of NGFW applications can be seen on the <a href="https://applipedia.paloaltonetworks.com/">applipedia.paloaltonetworks.com</a> portal and in the Firewall interface itself in the Objects-&gt; Applications section and in the search type the application name: facebook, you‚Äôll get the following result: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/95a/7a3/243/95a7a324369bb04d1162fc897d7560ac.png" alt="image"><br><br>  So, some of these sub-applications NGFW saw, and some did not.  In fact, you can separately prohibit and allow various subfunctions of Facebook.  For example, allow watching messages, but prohibit chat or file transfer.  Accordingly, the Policy Optimizer talks about this and you can make a decision: not to allow all Facebook applications, but only the main ones. <br><br>  So, we realized that the lists are different.  You can make the rules allow exactly those applications that actually went over the network.  To do this, you click the button MatchUsage.  It turns out like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5b4/d02/124/5b4d021249d40f7e1820f3e96a326c8d.png" alt="image"><br><br>  And also you can add applications that you consider necessary - the Add button in the left part of the window: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/97a/b56/f64/97ab56f6482b80843a2101c3aba7c4dc.png" alt="image"><br><br>  And then this rule can be applied and tested.  Congratulations! <br><br><a name="AppsSpecified"></a><h3>  Click No Apps Specified </h3><br>  In this case, the important security window will open. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/636/89a/f92/63689af92a94772552ff10aeb631648c.png" alt="image"><br><br>  There are obviously no such rules where an application of the L7 level is not indicated, most likely there are a lot of them on your network.  And in my network there is such a rule - let me remind you that I made it during the initial configuration, specifically to show how the Policy Optimizer works. <br><blockquote>  In the picture you can see that the AllowAll rule missed 220 gigabytes of traffic over the period from March 9 to March 17, which means that there are 150 different applications in my network.  And this is not enough.  Typically, a medium-sized corporate network has 200-300 different applications. </blockquote>  So, one rule skips as many as 150 applications.  As a rule, this means that the firewall is configured incorrectly, because usually in one rule 1-10 applications are skipped for different purposes.  Let's see what these applications are: click the button <br><br>  Compare: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cb4/822/bc8/cb4822bc8a59bbea655e786ef3e1ab93.png" alt="image"><br><br>  The most wonderful thing for the administrator in the Policy Optimizer function is the Match Usage button - you can create a rule with one click, where you will enter all 150 applications into the rule.  Manually, it would be long enough.  The number of tasks for the administrator to work even in my network of 10 devices is huge. <br><blockquote>  I have 150 different applications running at home that transmit gigabytes of traffic!  And how much do you have? </blockquote>  And what is happening in the network of 100 devices or 1000 or 10,000?  I saw firewalls with 8000 rules and I am very glad that now administrators have such convenient automation tools. <br><br>  Some of the applications that you saw and showed the L7 application analysis module in NGFW you will not need on the network, so you simply remove them from the list of allowing rules, or do the cloning of the rules with the Clone button (in the main interface) and in one application rule you allow, other applications will block as definitely not needed in your network.  Such applications often become bittorent, steam, ultrasurf, tor, hidden tunnels such as tcp-over-dns and others. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f01/ce0/eb7/f01ce0eb792f1440a190b278bdd56bb0.png" alt="image"><br><br>  Well, click in another rule - what you see there: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/51c/99c/5f4/51c99c5f4e11545e70c508ee1601908e.png" alt="image"><br><br>  Yes, there are applications typical for multicast.  We must allow them to view the video over the network.  Click Match Usage.  Fine!  Thank you Policy Optimizer. <br><br><a name="MachineLearning"></a><h2>  But what about machine learning </h2><br>  Now it is fashionable to talk about automation.  What I described came out - it helps a lot.  There is another opportunity that I have to talk about.  This is the Machine Learning functionality built into the Expedition utility, which has already been mentioned above.  In this utility, it is possible to transfer rules from your old firewall from another manufacturer.  And it is also possible to analyze the existing traffic logs of Palo Alto Networks and suggest which rules to write.  This is similar to the functionality of the Policy Optimizer, but in Expedition this is even more expanded and you are offered a list of ready-made rules ‚Äî you just need to approve them. <br><br><a name="UTD"></a>  To test this functionality there is a laboratory work - we call it a test drive.  This test can be done by accessing the virtual firewalls that the staff of the Palo Alto Networks office in Moscow will launch at your request. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/b01/056/93d/b0105693dc9222957e18e6cc53637f19.png" alt="image"><br><br>  You can send the request to Russia@paloaltonetworks.com and write in the request: ‚ÄúI want to make a UTD via the Migration Process‚Äù. <br><br>  In fact, the lab works called Unified Test Drive (UTD) are several options and they <a href="https://use.cloudshare.com/Ent/CsClient.mvc/">are</a> all <a href="https://use.cloudshare.com/Ent/CsClient.mvc/">available remotely</a> upon request. </div><p>Source: <a href="https://habr.com/ru/post/444582/">https://habr.com/ru/post/444582/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444570/index.html">Top 10 bugs in C ++ projects for 2018</a></li>
<li><a href="../444574/index.html">Miniature Macintosh Plus</a></li>
<li><a href="../444576/index.html">How a type system improves your JavaScript code</a></li>
<li><a href="../444578/index.html">Speakers Top 3D Expo 2019: Yousef Hesuani from 3dbio - 3D-printing of organs and tissues</a></li>
<li><a href="../444580/index.html">FBO Sheremetyevo infrastructure: how light aircraft are prepared for flight</a></li>
<li><a href="../444584/index.html">Android will offer European users a browser and search engine to choose from</a></li>
<li><a href="../444590/index.html">Data leakage (which could have occurred, but did not occur) from the telemedicine company</a></li>
<li><a href="../444594/index.html">Big o</a></li>
<li><a href="../444596/index.html">Iodide: Mozilla's interactive science editor.</a></li>
<li><a href="../444598/index.html">The CD is 40 years old, and is it dead (does it?)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>