<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to reduce code review from two weeks to several hours. Experience team Yandex. Market</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Man is the main value of any enterprise. The success of the whole business depends on how people communicate with each other, how they achieve their g...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to reduce code review from two weeks to several hours. Experience team Yandex. Market</h1><div class="post__text post__text-html js-mediator-article"><p>  Man is the main value of any enterprise.  The success of the whole business depends on how people communicate with each other, how they achieve their goals together, on teamwork.  Continuous refinement of skills, processes and tools allows you to work more efficiently. </p><br><p>  We in the Market are working to deliver new features to our users as quickly as possible.  To do this, we constantly study our processes and optimize all stages of work on the task.  Today we will tell Habr's readers about the optimization of one of them, namely the code review process. </p><br><p>  First you need to imagine what flow in the development we have adopted: </p><br><img width="500" src="https://habrastorage.org/webt/rf/6j/9g/rf6j9gzwp6tqlwhuh33ha8kd3ww.png"><a name="habracut"></a><br><p>  The same thing, only by points and words: </p><br><ol><li>  The developer takes a task. </li><li>  Makes it. </li><li>  Fills in Github and opens PR. </li><li>  Pass code review. </li><li>  Collects a demo stand and gives it to the tester. </li><li>  The tester checks the demo stand. </li><li>  Proven tasku collected in the release. </li><li>  Testing in release. </li><li>  Prod. </li><li>  Final testing in combat. </li></ol><br><p>  By areas of responsibility, the task is divided into the following steps: </p><br><p>  1-5 - responsibility on the developer; <br>  6-7 - responsibility on the tester; <br>  8-10 - responsibility on the release master. </p><br><p>  So, we began to analyze what takes us the most time.  Fortunately there are internal analysis tools.  Everyone relied on the fact that it would take the longest to occupy the development process itself (‚ÄúIn Work‚Äù status) ... and it turned out that way.  But one moment surprised us the most.  The average review duration is two weeks! </p><br><h3 id="deystvie-1-razbor-pr">  Step 1. Parsing the PR </h3><br><p>  Starting to study pull-rekvesy, immediately faced with one very interesting fact.  It turned out that we have a huge cemetery of unclosed pull requests.  Most of the authors of these PRs no longer worked for the company, but their legacy was still with us.  Who never saw dinosaurs, here they are: </p><br><p><img src="https://habrastorage.org/webt/bf/tb/sn/bftbsnrsjrgehwgcyw4rp4-hxw8.png"></p><br><p>  These pull requests added noise and interfered with correct code-review time analysis.  With peace of mind, we closed them down.  It only remained to count the time.  And it was still around 2-3 days.  Not good. </p><br><h3 id="deystvie-2-razborka-s-revyushnicey">  Action 2. Disassembling with a dishew </h3><br><p>  Revushnitsa - a system developed in Yandex, which calls in PR two random people with expertise in a variable code and taking into account vacations and absences.  An analysis of weekly PRs revealed a group of individuals who are constantly detaining the code review.  After interviewing our colleagues, we found another problem in our process.  Colleagues complained that they received too many pull-requests per day from the reseller, and they simply do not have enough time for their main work. </p><br><p>  This did not agree with our indicators: one or two PR per person per day.  The study resulted in Github, where we have a separate team of reviewers.  This command has not been updated for several years.  Since then, the number of employees has doubled, but none of the newcomers have been part of the review team.  In other words, half the team did not participate in the code review at all!  Corrected this annoying misunderstanding. </p><br><h3 id="deystvie-3-rasshirenie-instrumentov">  Step 3. Expand tools </h3><br><p>  At this stage, we tried to simplify the life of the reviewers, which was already as simple as we thought.  In the arsenal of front-fighters were the following tools: </p><br><ul><li>  code style checkers; </li><li>  test run; </li><li>  various non-security checks in the PR itself; </li><li>  revisionist; </li><li>  alerts to mail and task tracker. </li></ul><br><p>  It would seem that everything is there.  Take it and review! </p><br><p>  The first thing that turned out to be wrong: a different code-review process in different repositories.  They unified and affixed labels at the same time for easy PR search through the Github interface. </p><br><p>  The second thing they noticed: mail is not the best tool to quickly inform you about the status of code review.  Many, in order not to be distracted from work, parse their mail several times a day.  Messengers are quite different.  The response to messages in messengers is much higher.  And it was decided to connect the bot to our messenger.  The bot sends alerts about the status of the code review for both the author of the pull request and encourages people to mess around.  Very comfortably. </p><br><h3 id="deystvie-4-pervyy-sla">  Step 4: First SLA </h3><br><p>  In parallel with actions 2 and 3, we began to work closely with the staff and explain that the review code is inseparable from the task itself.  We explained that bringing to ‚ÄúVerified‚Äù is the responsibility of the developer.  And the responsibility is not only to colleagues, but also to users!  Fast delivery features to sell - that's what I wanted to achieve.  And the team treated with understanding the process of improvement. </p><br><p>  At this stage, the first idea of ‚Äã‚Äãthe ideal code review was born.  Of course, everyone wants it to take place in 5 minutes, but this is not always possible.  Taking into account that we have a multiregional team (with a time difference of four hours), we agreed that our SLA will have one day, i.e.  24 hours.  This SLA was announced to all employees, and, rubbing their hands, they began to wait for results. </p><br><p>  But the situation has not changed.  In the best weeks, half of the pull-requests fit into 1 day.  The others got out for him. </p><br><p><img src="https://habrastorage.org/webt/q_/x4/uf/q_x4ufuooovrwiesgfm1ckkz4jy.jpeg"></p><br><p>  We had a small script that estimated the time for a code review on PR.  On our daily basis, we began to grind all the PRs in search of the "lagging behind."  Almost every day there was a pack of such. </p><br><img src="https://habrastorage.org/webt/nz/de/ar/nzdearlygv--kzedy4kv4ytzhzc.png"><br><p>  It took a lot of time to analyze them.  Most often, the script itself is dishonestly cheating time review.  He did not take into account that some PRs created after hours (yes, we have some courageous ones who know how to work for an hour or two at night, come to work with us!).  All this told us that our monitoring tools for pull-requests are not the most effective, because they are dishonest.  We'll have to find new tools. </p><br><h3 id="deystvie-5-treker-sla">  Step 5: SLA Tracker </h3><br><p>  Help came from no waiting.  Our colleagues from <a href="https://yandex.ru/tracker/">Tracker</a> announced an amazing thing: now you can install SLA in the Tracker itself.  And you can customize it completely diverse.  A certain timer is activated for some event in the task.  For some event can pause.  And for some event to stop.  Yes, this is what we need! </p><br><p>  We immediately went over to study the documentation in detail (by the way, <a href="https://yandex.ru/support/connect-tracker/manager/sla.html">here it is</a> ) and configure our queues (there are several of them, since there are several repositories).  They set up the timer to turn on when switching to the status of "Need code review" and complete when switching to any other status, except for "There are comments" - with it, the timer paused, i.e.  did not reset your time. </p><br><p><img src="https://habrastorage.org/webt/vz/wc/d4/vzwcd4k70ztjkev4awa_brvlcrs.png"></p><br><p>  It also turned out to be cool that the timer took into account the working time and calendar!  We set that 9h is assigned to the code review, i.e.  one working day.  In this case, the alert is triggered 2h after the start, or if the nine-hour period has been broken.  The result was a kind of honest monitoring.  At first we turned on the timer for the sake of experiment, collected a pack of bugs and replayed it in the Tracker. </p><br><p>  It is worth noting that the timer was included only for tasks that were created after the introduction of the timer itself.  Therefore, the instant effect could not be seen.  But already at this stage positive dynamics began.  We received the effect a month later, when the flow of new tickets with a timer began to crowd out the old ones.  It was noticeable that the approximate time with the code-review was concentrated in the area of ‚Äã‚Äãthe reminder messages, i.e.  marks 2h and 9h. </p><br><p>  At the time of this writing, we have 415 tasks in which the timer is turned on.  Of these, 29 went beyond the nine o'clock border.  Although, if you look closely, there are such tasks, the code-review of which was completed within the next hour.  If we drop them, there are 17 tasks left.  And this is about 4.1%! </p><br><p><img src="https://habrastorage.org/webt/qd/yc/5x/qdyc5xl1wddalhhxh0okmu6793e.png"></p><br><h3 id="itog-samuray-postoyanno-tochit-svoy-mech">  Total.  Samurai constantly sharpens his sword </h3><br><p>  Looking back and remembering all our actions, we can draw one conclusion - all means are good.  All our steps led to the desired result: more than <strong>92% of pull requests began to satisfy our SLA</strong> !  Fewer tackles are stopping, the code review goes faster and faster.  Little by little, <strong>75% of the code review began to fit into 5 hours</strong> !  And the dynamics of improvement are still positive.  In addition to numerical indicators, we began to receive more positive feedback from subcontractors.  Even more pleased with the fact that the team reacted to the whole process.  Even a process such as code-review acceleration has further consolidated the team.  Each participant began to understand the responsibility that he bears to others, as a fast code review allows us to benefit even more quickly. </p><br><p>  Of course, 9h is not the ultimate dream, but still a success.  But on it we do not intend to stop.  We continue to monitor the code review process and solve all technical and even psychological problems faced by employees, so that our process is as productive as possible and at the same time comfortable for the team. </p><br><h3 id="qa-a-chto-esli">  Q &amp; A.  What if...? </h3><br><p>  <strong>Q</strong> : <em>And what if I think they are following me?</em>  <em>What is this timer for?</em> <br>  <strong>A</strong> : We do not follow specifically for someone, but for the process.  In a pull request, there are two sides: the author and the reviewers.  If reviewers delay checking, the author suffers.  On the other hand, it is also inhumane to tear off the reviewers from work right away.  It is necessary to find a balance so that both sides feel comfortable.  The timer is needed not to punish someone, but to record all deviations.  Most of these deviations happen not through the fault of reviewers, but through the fault of technical problems.  The challenge is to fix these problems.  That others did not face them.  Permanent self-improvement </p><br><p>  <strong>Q</strong> : <em>And what if there are PR complex, with 100500+ lines of code, and there are "change letter".</em>  <em>Where's the justice?</em> <br>  <strong>A</strong> : Yes, it is.  When we were working on a standard code review, we just took it along the upper boundary, i.e.  The code review of complex PRs should fit into the SLA.  But at the same time we have no goal to drive everyone into these boundaries.  We always treat with understanding pull-requests, in which there is a lively, useful discussion, despite the knocked down bar in one day. </p><br><p>  We have plans for gradations of SLA by storypoints.  1SP - 1h, 3SP - 5h, 5SP - 2d, for example.  Fortunately, the Tracker is already capable of that.  Simply, we are not yet ready for this - we still have a long way to improve. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/421129/">https://habr.com/ru/post/421129/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../421119/index.html">SmartTV development underwater rake</a></li>
<li><a href="../421121/index.html">Streaming video through a browser with ultra-low latency (and WebRTC!)</a></li>
<li><a href="../421123/index.html">IT events digest for September</a></li>
<li><a href="../421125/index.html">We segment 600 million users in real time every day.</a></li>
<li><a href="../421127/index.html">Friday webinars from Skillbox: development and developers</a></li>
<li><a href="../421131/index.html">Critical 1Cloud Server Vulnerability</a></li>
<li><a href="../421133/index.html">LINK. Paper keyboard. Very large buttons</a></li>
<li><a href="../421135/index.html">Au / Ni / MgO: heat transfer at the nanometer level</a></li>
<li><a href="../421137/index.html">How Headless Chrome Works</a></li>
<li><a href="../421139/index.html">Frontend Conf - with user care</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>