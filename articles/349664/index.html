<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HDR game analysis</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The last couple of weeks I spent on researching HDR images of various games. 

 When it comes to SDR video, you should be familiar with the RGB values...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HDR game analysis</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b95/09d/73b/b9509d73b85ec83646a76f38497b51ad.jpg"></div><br>  The last couple of weeks I spent on researching HDR images of various games. <br><br>  When it comes to SDR video, you should be familiar with the RGB values ‚Äã‚Äãin the range of 0-255, where 0 is black and 255 is white. <br><br>  HDR10 / Dolby Vision is slightly different in this regard, not only because it uses the interval of 0-1023, but also because all these data values ‚Äã‚Äãrepresent not just a black and white (or color) gradient, but also a measure of illumination in the threads, There is in units of measurement of brightness of light. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unlike the values ‚Äã‚Äãused in previous video formats, these values ‚Äã‚Äãare defined and absolute.  A value of 0 always means a total absence of light (total black), a value of 1023 always represents 10,000 nits of illumination, a value of 769 always denotes 1000 nits. <br><br>  That is, if you transmit these values ‚Äã‚Äãto a modern HDR TV, it should output exactly the amount of light described by the specified value. <br><br>  This system is used in both the HDR10 and Dolby Vision.  It may be called PQ based HDR (PQ based HDR). <br><br>  At the moment there are not many TVs with a maximum value of 10,000 nits, you are lucky if your value exceeds 1500 nits. <br><br>  When the received signal goes beyond the hardware limits of the display, the TV itself decides how to handle this situation.  Most manufacturers simply cut the white values ‚Äã‚Äãabove their chosen level.  They can also use a smooth recession and make the offset to the trimmed values ‚Äã‚Äãless obvious. <br><a name="habracut"></a><br>  To do this, when creating content under HDR10 and Dolby Vision, additional information about the image content in the metadata format is indicated.  This metadata usually tells you what the brightest value will be in the game (or movie) and what is the average illumination for all content.  These values ‚Äã‚Äãare determined by the display on which the content was created. <br><br>  Most UHD content is now created for screens with 1000 nit or 4000 nit. <br><br>  The purpose of this metadata is to get an SDR image (or something between SDR and HDR) from the original HDR content when the content is viewed on a display that does not reach the peak illumination values ‚Äã‚Äãof the display on which the content was created . <br><br>  That is, if the movie was created on a 1000-nit display, and you have an OLED screen with a maximum of 650 nit, the TV can use this metadata to decide how to display information that cannot be displayed any other way due to hardware limitations. <br><br>  If you have a display that matches the maximum brightness of the content or exceeds it, then it will not need metadata. <br><br>  Having dealt with this, let's look at how the games were created, what options they provide to the user for adjusting the image, what exactly these options do, and what is the connection between these aspects and what HDR looks like. <br><br>  Video games have a big advantage over movies - their picture is generated in real time, so you can customize it as you like. <br><br>  Due to the very nature of HDR content, this is very easy to measure: we will only need a screenshot or video capture without tone mapping, and from them we can see the code values ‚Äã‚Äãused in different parts of the image. <br><br>  We can see that if the game conveys something different from black (or has cinematic color correction with elevated black values), then we can see the brightest value that the game will try to use for objects like the sun. <br><br>  Therefore, I studied various games for the Xbox (the console allows you to create screenshots in HDR) in order to understand what the various in-game settings do and how to use them to get the optimal picture on the display. <br><br>  The goal of HDR is to transfer more information to the display so that the brightest light that could be displayed in the corresponding parts of the image.  Usually the brightest points are in the glare of reflections, explosions and the sun. <br><br>  Let's look at some really good examples of HDR gaming.  In all these examples, slightly different parameters and different approaches to the implementation of tone mapping are used. <br><br>  In order to better visualize the output of the game in a format without HDR10 / SDR format, I came up with a method for creating irradiance maps. <br><br>  Using this scale, we can easily assess what is dark in the picture, what is light, and what is very bright. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ff0/ddf/1c5/ff0ddf1c55f310ec4910ea62c6239825.png"></div><br>  Most of what we see is in the range of 0-150 nits, and all the above is an additional illumination provided by HDR. <br><br><h2>  Star Wars: Battlefront 2 </h2><br>  In fact, in all HDR-compatible games on the Frostbite engine, which I have reviewed (Battlefield 1, Mass Effect), the same scheme is used. <br><br>  The metadata is output to 100,000, and the tonal compression itself is performed by the game using the HDR slider, where 0 nit is the leftmost value and 10k nit is the rightmost. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c30/eee/4b0/c30eee4b078ba3968e6d59dc3282c93c.jpg"></div><br>  As we can see, the Sun itself is displayed in 10k nits.  Objects that should be completely dark look like this.  Glare reflections on the top of the weapon also fall in the range from 4,000 to 10,000 nit. <br><br>  The Frostbite engine Dice games are actually very interesting because you can move the HDR slider one space to the left.  This will give us 100/200 nits (depending on the game), essentially compressing the game image to the SDR.  This way you can very easily see what your new cool TV is capable of. <br><br>  Another fun thing about DICE games is that you can move the slider to 0% and literally turn off all the lights.  So we will see that the lighting is really calculated in real time, because we told the engine that the brightest light source should be equal to 0. <br><br><h2>  Rise of the Tomb Raider </h2><br>  In this game, a similar scheme is used: the brightness slider, which controls the black point (when moving to the lowest point), and the second HDR slider controls the peak brightness. <br><br>  Tomb Raider is limited to 4000 threads.  As in the Frostbite engine games, you can either raise the slider to the maximum, so that the TV performs tonal compression, or follow the on-screen instructions by selecting the maximum brightness and allowing the game to display the data yourself. <br><br>  RotTR is especially interesting in this, because there are a lot of glare reflections, and not only in places where we usually see them, for example, on brilliant ice and shimmering snow, reflecting the light of the sun ... <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/410/877/508/410877508bc789fb4b20c80367aa2ec6.jpg"></div><br>  ... they can be seen in low light conditions and on less obvious ‚Äúshiny‚Äù surfaces, such as this shoe in insanely high resolution. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/59a/794/f76/59a794f76dbb28b84afdcd91c45f33c5.jpg"></div><br>  It seems that when the output reaches 4000 nits, then any level above this jumps directly to 10k nits (which the display will cut anyway, since the metadata seems to tell the display that they have a value of 4000 nits). <br><br>  These data are not lost, they can be seen from time to time, and this tells us that this is an artistic decision or part of the color correction process of the game under HDR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e19/f32/4cf/e19f324cf68b6a7d017af8cdd28fa7f7.jpg"></div><br><h2>  Assassin's Creed Origins </h2><br>  AC: Origins is another game with well-implemented HDR.  As in Tomb Raider, there is also a limitation of 4,000 nits (pink fragments).  The game has a brightness slider, which, based on visibility conditions, must be lowered as low as possible.  In addition, the game has an option Max Luminance, conveniently marked in the threads. <br><br>  It also has a ‚Äúwhite sheet‚Äù scale, that is, besides the sliders and the settings of the darkest and brightest parts of the game, it allows you to change one of the intermediate points: the brightness of the sheet of paper. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3b0/547/135/3b05471355fcafe99a38deb4058d1f37.jpg"></div><br>  Ubisoft recommends the following setting for the white slider: <br><br><blockquote>  adjust the value so that the paper and hanging fabric in the image are almost white </blockquote><br>  However, as in the case with the brightness slider, this allows you to adjust the displayed game graphics to match the viewing conditions: if you are surrounded by a controlled light source, set the value to 80 nits, but with enhanced ambient lighting you prefer higher values. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4b0/0aa/53c/4b00aa53caf3b3ca46f52e50046cda25.jpg"></div><br>  Configuring games according to technically correct parameters shows that for many consumers HDR10 / Dolby vision is too dark.  You can also see that the developers are still closely involved in these technologies: with proper calibration of the picture of the game HUD in AC becomes a bit too dark. <br><br>  Next, we look at three Microsoft products that work with output to the full 10,000 nits. <br><br><h2>  Forza Horizon 3 </h2><br>  A wonderful example of HDR is that it is not necessary to use it only for insanely bright spots of the sun, magic and fire. <br><br>  When the clouds are over, the sky is still very bright, and photographers have to go on tricks to cope with the problems of contrast caused by this cause.  Forza blooms here in full force, I almost feel cold and dull, as if I see them with my own eyes. <br><br>  As you can see, the sky reaches about 4000 nits, the light almost does not fall on the grille and it is dark, while the headlights give a full 10k nits. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83a/432/bf9/83a432bf9f7d342b4199efd4f2ccae19.jpg"></div><br>  In the conditions of the night, the game uses the dark border of the scale to the full, while explosions and headlights are still illuminated in a realistic way. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5fb/3ef/05d/5fb3ef05d73081cc37ab595959bd9695.jpg"></div><br>  This is also a good example of the fact that even in SDR a very dark image that conforms to HDR10 standards will be perceived as too dark, or muffled, or <br>  black.  As we can see from the irradiance map, all the details are really in place, but the human eye cannot adjust to such details.  He needs to be in low light conditions for about 10 minutes, until certain chemical reactions take place in the eye cells.  Obviously, this is a problem for many consumers, who most likely are not in the light conditions that contribute to this. <br><br><h2>  Gears of war 4 </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5a2/b19/d12/5a2b19d126fa50479fcf64c4406f86eb.jpg"></div><br><h2>  INSECTS </h2><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/541/962/34d/54196234d188299dbe4fb215b5349f9b.jpg"></div><br>  All three games work with two sliders.  The brightness slider controls the black levels, but also controls one aspect of the contrast, increasing the maximum output to 10,000k nits.  The second HDR slider also allows you to set the maximum output, below which other slider is configured. <br><br>  In Forza and Gears, these parameters are called simply Brightness (Brightness) and HDR, but in INSECTS they are called HDR contrast (HDR Contrast) and HDR brightness (HDR brightness). <br><br>  Let's now look at some other examples. <br><br><h2>  Shadow of Mordor </h2><br>  SoM uses a very simplified approach: the game always outputs a maximum of 10k nits, and tonal compression leaves it to the TV.  This is interesting, since we know that, in fact, developers have never seen the game being output to 10k nits, because there are no such displays. <br><br>  The game has a traditional brightness slider (Brightness), which allows users to adjust the black point in accordance with their taste and viewing conditions. <br><br>  In the screenshot we see the obvious places to look for the full 10k nits, namely the sun and the glare of reflections.  We also see that the side of the character in the shadow is as dark as it should be. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a05/46f/14f/a0546f14fd1173614b5fa92ffcc1b629.jpg"></div><br><h2>  Agents of mayhem </h2><br>  It uses a similar technique, except that the game is bounded above by 1000 threads and color correction / tonal compression is obviously done with this in mind, since this is a fairly achievable conclusion from the consumer display point of view.  I don‚Äôt think it was a coincidence, and it‚Äôs actually one of the best looking HDR games. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d9a/072/bef/d9a072befc251d9ff1354f09c9654c00.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8b1/25e/503/8b125e50316fcf2a0390ef140f36cec9.jpg"></div><br>  Here again, as in other games, moving the slider to the left improves the black level. <br><br><h2>  DEUS EX: Mankind Divided </h2><br>  Many cases of black pushed up are probably artistic tricks, but it also turns out to be a bug that leads to a perfect failure of color correction when lowering the game brightness slider below 35%. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/928/cdb/641/928cdb6416c7d92219b8bbf2beb5773d.jpg"></div><br>  This looks like the result of some kind of incorrect curve adjustment. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7da/729/577/7da729577b127c5a0aeaa97624174878.jpg"></div><br>  40-45% give a conclusion of 1000 nits without too much lifting black up. <br><br><h2>  Final fantasy XV </h2><br>  From "Squarenix, fu", to "Squarenix, wow!" <br><br>  A fixed maximum output of 1000 nits and a simple brightness slider for lowering black levels.  Fabulous color correction, including under different lighting conditions. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/90d/66b/091/90d66b091373a03e00826079c28bc2c9.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b95/09d/73b/b9509d73b85ec83646a76f38497b51ad.jpg"></div><br>  Even on the initial screen, there are 2D elements optimized for HDR. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f4e/c0c/7e7/f4ec0c7e7df454d85dd424d3405a7d93.jpg"></div><br><h2>  Monster hunter world </h2><br>  Almost like Deus Ex, Monster Hunter World seems to be operating at around 4000 nits.  However, almost as in the DEUS EX, when HDR is enabled, the game shows serious problems with the level of black.  When adjusting the default brightness, we get the following: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/18a/942/19a/18a94219abb548e2aeb299ba2c659c67.jpg"></div><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/47d/3c3/dc0/47d3c3dc0df133ce6a0fbcbb7a8b02b0.jpg"></div><br>  There are intermediate values ‚Äã‚Äãand highlights, but where are all the shadows? <br><br>  Thanks to the ‚Äúquick and dirty‚Äù level enhancement, we can remove additional HDR illumination and look at the histogram. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/38e/e19/4ee/38ee194ee493dfdbaed6b5dc5c0c9b64.jpg"></div><br>  If we compare this with the game screenshot in the SDR made in a few seconds <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/639/ceb/21e/639ceb21e223bb2cf8a1a9fde1dd2ec3.jpg"></div><br>  then we will see that there is a significant shift between SDR and HDR tone compression.  In HDR, the contrast and black levels completely fall apart. <br><br>  This can be slightly corrected by reducing the brightness to a minimum, but this is not enough to make the picture completely correct.  It seems that this is at least partly due to some adaptation of the eye that is taking place. <br><br>  Whew!  A whole bunch of pictures! <br><br>  We studied one side of the creation of games, but did not examine the metadata displayed by the game.  I would not be surprised if there are games with different metadata, but since they are static, then as soon as you set up the picture, from a technical point of view, they will still become incorrect. <br><br><h2>  Horizon Zero Dawn: Frozen Wilds </h2><br>  Even from this short clip, we can see how to implement HDR correctly - almost everything seen is in the standard SDR range, however the flashes of Elah‚Äôs weapons flickering in the sun and the sparks coming down her back approach the level of 10k nits.  We see that the clouds are brightly lit and are in the range of 1000-4000 nits, while the sun itself tends to 10k: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/W5GwqYgd0uI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Judging by what I saw, it exceeds 4000 nits. <br><br><h2>  Uncharted 4 </h2><br>  I recorded an HDR video for Uncharted 4, another game that exceeded the threshold of 4000 nits and tends to 10k. <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/6MiKCWf6xhI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe></div><p>Source: <a href="https://habr.com/ru/post/349664/">https://habr.com/ru/post/349664/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349652/index.html">How to make Java code simpler and clearer</a></li>
<li><a href="../349656/index.html">VLFs - Forgotten Enemy</a></li>
<li><a href="../349658/index.html">Case "Monitoring of the business loan portfolio of the bank with the help of three-dimensional visualization"</a></li>
<li><a href="../349660/index.html">Methods for constructing test functions</a></li>
<li><a href="../349662/index.html">We invite you to give lectures on the gaming industry on March 1 at VSBI</a></li>
<li><a href="../349666/index.html">Overview lecture and the launch of the 2nd part of the course on the development of web services on Go</a></li>
<li><a href="../349668/index.html">Creating a company. Ideology - first</a></li>
<li><a href="../349672/index.html">Overview of the best European and not only QA conferences of this year</a></li>
<li><a href="../349674/index.html">Ramda Thinking: Declarative Programming</a></li>
<li><a href="../349676/index.html">Function and Functional Object</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>