<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to accept payments in a mobile application: tokenization, NFC, optical scanning and other buns in one SDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I have already told earlier on the example of the Android SDK, how not to limit myself to the frame and WebView, to embed the native form of accepting...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to accept payments in a mobile application: tokenization, NFC, optical scanning and other buns in one SDK</h1><div class="post__text post__text-html js-mediator-article">  I have already told <a href="https://habrahabr.ru/post/304650/">earlier</a> on the example of the Android SDK, how not to limit myself to the frame and WebView, to embed the native form of accepting payments by bank card in a mobile application, and not to get under the PCI DSS audit.  Since then, our SDK has expanded quite significantly, and such functionality has been added to the usual card input form in Android and iOS: <br>  - React Native Library for Android and iOS <br>  - customization of layout layout forms with the details of the map <br>  - optical card scanning function <br>  - receiving contactless payments in Android using NFC technology <br>  In this publication, I will tell you what you can do with payments in mobile applications, such as life hacks and pitfalls, and finally give you an example code for a demo application and tell you how to write off card debt from a friend using your smartphone‚Äôs NFC reader. <br><img src="https://habrastorage.org/webt/59/d6/07/59d6074f5f0b0574736203.gif"><br><a name="habracut"></a><br><h4>  Case 1. We bind a client card to the backend for regular debits or payments in 1 click. </h4><br>  Here it is important to understand that if your backend is not PCI DSS certified, then you cannot store the card number and its validity in its database.  Therefore, before you bind the ID of the card to the client's account, you must first tokenize the card.  To do this, you need to make a first payment with a client via a mobile application, and preferably with 3D-Secure, blocking a small amount on the card, for example, 1 currency unit.  3D-secure in this case is necessary first of all to protect yourself, as a retail outlet, from financial claims (chargebacks) for future recurring debits, and secondly - to improve conversion, as for example, using Sberbank cards in Russia and Privatbank Ukraine in most cases, a transaction without 3D-Secure will not work. <br>  So, to get a token card, you must pass the parameters <b>requiredRecToken</b> and <b>verification</b> (for more details on how to create a mobile application, see the article, the link to which I indicated at the beginning, as well as in the code of the <a href="https://github.com/cloudipsp/android-sdk/tree/master/app/src/main">demo application</a> on github): <br><pre><code class="java hljs">order.setRequiredRecToken(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)</code> </pre> <br><pre> <code class="java hljs">order.setVerification(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>)</code> </pre> <br>  The <b>requiredRecToken</b> parameter requires returning the card token when the card is successfully authorized, and <b>verification</b> - that it is not necessary to charge funds from the card, but it is enough to block them and then return them (the payment gateway returns them automatically). <br>  In response, the payment gateway will return the <b>recToken</b> parameters ‚Äî the card token, <b>recTokenLifeTime</b> ‚Äî the token's validity period (in fact, the card's validity period) and maskedCard ‚Äî the masked card number that must be attached to the token in the backend for further display to the client when choosing a payment method. <br>  Now that you have a token card, you can, at any time, at the request of the client or at the due date, call the <a href="https://docs.fondy.eu/docs/page/10/">token-write</a> method via the server-to-server API and write off the required amount. <br>  <b>Underwater rocks:</b> <br>  According to our statistics, it‚Äôs not possible to pay a fairly significant part of cardholders via 3DSecure on a mobile device for several reasons, which are independent of it and the gateway: <br>  - SMS may not come, or the user switching between the SMS application and yours, lost the form by entering the 3D-Secure password, as it opens in WebView or the system browser <br>  - 3D-Secure page layout of the bank on a smartphone or tablet has reached (banks rarely adapt such pages) <br>  - the web server of the bank has disabled support for the insecure TSL 1.0 protocol, which makes 3D-Secure unavailable for Android version &lt;4.1 <br>  <b>Life hacking:</b> <br>  We at the payment gateway know how to enable / disable 3D-Secure on the fly, and if the client still fails to pay, we adjust to it, and try to make the payment without a 3D-Secure password. <br>  It is also worth remembering that if you save the tokens of one payment provider in your system, you will not be able to use them on another provider, unless providers do not agree on the migration of tokens to each other, which in principle has already happened several times in our practice. <br><br><h4>  Case 2. Customize the layout of the form for entering the card number. </h4><br>  Often there is a need to place the fields for entering the card number, expiration date, and cvv2 in a different sequence than the standard layout in the SDK provides.  But due to the requirements of PCI DSS, you can‚Äôt just take and replace the card number input field with the standard EditText component.  For this purpose, we have developed a flexible layout.  Flexible layout inherits the styles of your mobile application and allows you to place the elements of the form in any sequence and in any design and at the same time prevents the random transfer of card data to the side of your backend. <br><br>  To organize the input card in the SDK there are two mechanisms: <br>  CardInputView - ready view for use; <br>  CardInputLayout is just a layout wrapper for customizing the view in its own markup style. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In fact, CardInputView = CardInputLayout + CardNumberEdit + CardExpMmEdit + CardExpYyEdit + CardCvvEdit. <br>  The simplified structure of the CardInputView in XML can be written up like this: <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardInputLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardNumberEdit</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:orientation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"horizontal"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardExpMmEdit</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardExpYyEdit</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">LinearLayout</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardCvvEdit</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">com.cloudipsp.android.CardInputLayout</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><br>  Therefore, you can absolutely freely customize and position the input elements for as long as you have enough imagination.  There is only one rule to follow - each input element (CardNumberEdit, CardExpMmEdit, CardExpYyEdit, CardCvvEdit) must be in CardInputLayout once, and the nesting level View does not matter. <br>  Here is what it might look like: <br><img src="https://habrastorage.org/webt/59/d4/26/59d426bf456fd964729328.jpeg"><br>  <b>Underwater rocks:</b> <br>  Customizing input fields is worth remembering: <br>  - cvv2 can be either 3 or 4 characters long <br>  - card number can be from 14 to 19 characters <br>  - You can achieve the most accurate customization to your design by forking the SDK and making changes to the layout already in your implementation (this is not forbidden if you don‚Äôt start to skip the card details through your backend).  But having made a fork, you lose support for the SDK updates from the gateway and the integration of new features. <br>  <b>Life hacking:</b> <br>  You can often find on the input form for card details inputa for entering the name and surname of the cardholder and its ZIP code.  For payments on the CIS, there is no practical need to do this in 99% of cases - only some banks in the USA, Canada and the UK support this technology, which is called the <a href="https://en.wikipedia.org/wiki/Address_Verification_System">Address Verification System</a> , while for the verification to work, it must be supported by both the acquiring bank and the bank issuer <br><img src="https://habrastorage.org/webt/59/d5/4f/59d54f188816b320391879.png"><br><br><h4>  Case 3. Connect the ability to scan the card through the camera and NFC </h4><br>  The optical card scanning function is implemented for Android in the <a href="https://github.com/cloudipsp/android-sdk-optical">android-sdk-optical</a> library, for iOS in the <a href="https://github.com/cloudipsp/CloudipspOptical">CloudipsOptical</a> library using the <a href="https://github.com/card-io/">card.io SDK</a> . <br>  NFC scanning is implemented using the <a href="https://github.com/cloudipsp/android-sdk-nfc">android-sdk-nfc</a> and <a href="https://github.com/cloudipsp/react-native-cloudipsp-nfc">react-native-cloudipsp-nfc libraries</a> and is available only for Android.  Although Apple has <a href="https://developer.apple.com/documentation/corenfc">opened</a> third-party developers the ability to read RFID tags <a href="https://developer.apple.com/documentation/corenfc">since iOS 11+</a> , EMV tags still cannot be read from bank cards. <br><br><div class="spoiler">  <b class="spoiler_title">Sample Demo Application for Using NFC</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.cloudipsp.nfcexample; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Intent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.text.TextUtils; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Patterns; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.ArrayAdapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.EditText; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Spinner; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.Card; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.CardInputView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.Cloudipsp; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.CloudipspWebView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.Currency; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.Order; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.android.Receipt; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.cloudipsp.nfc.NfcCardBridge; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">View</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OnClickListener</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> MERCHANT_ID = <span class="hljs-number"><span class="hljs-number">1396424</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText editAmount; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Spinner spinnerCcy; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText editEmail; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EditText editDescription; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CardInputView cardInput; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> CloudipspWebView webView; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Cloudipsp cloudipsp; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> NfcCardBridge nfcCardBridge; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); nfcCardBridge = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NfcCardBridge(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); findViewById(R.id.btn_amount).setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); editAmount = (EditText) findViewById(R.id.edit_amount); spinnerCcy = (Spinner) findViewById(R.id.spinner_ccy); editEmail = (EditText) findViewById(R.id.edit_email); editDescription = (EditText) findViewById(R.id.edit_description); cardInput = (CardInputView) findViewById(R.id.card_input); cardInput.setHelpedNeeded(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); findViewById(R.id.btn_pay).setOnClickListener(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); webView = (CloudipspWebView) findViewById(R.id.web_view); cloudipsp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cloudipsp(MERCHANT_ID, webView); spinnerCcy.setAdapter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayAdapter&lt;Currency&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, android.R.layout.simple_spinner_item, Currency.values())); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (savedInstanceState == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { processIntent(getIntent()); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (v.getId()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.btn_amount: fillTest(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> R.id.btn_pay: processPay(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fillTest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ editAmount.setText(<span class="hljs-string"><span class="hljs-string">"1"</span></span>); editEmail.setText(<span class="hljs-string"><span class="hljs-string">"test@test.com"</span></span>); editDescription.setText(<span class="hljs-string"><span class="hljs-string">"test payment"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processPay</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ editAmount.setError(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); editEmail.setError(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); editDescription.setError(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> amount; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { amount = Integer.valueOf(editAmount.getText().toString()); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception e) { editAmount.setError(getString(R.string.e_invalid_amount)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String email = editEmail.getText().toString(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String description = editDescription.getText().toString(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TextUtils.isEmpty(email) || !Patterns.EMAIL_ADDRESS.matcher(email).matches()) { editEmail.setError(getString(R.string.e_invalid_email)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (TextUtils.isEmpty(description)) { editDescription.setError(getString(R.string.e_invalid_description)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Currency currency = (Currency) spinnerCcy.getSelectedItem(); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Order order = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Order(amount, currency, <span class="hljs-string"><span class="hljs-string">"vb_"</span></span> + System.currentTimeMillis(), description, email); order.setLang(Order.Lang.ru); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Card card; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nfcCardBridge.hasCard()) { card = nfcCardBridge.getCard(order); cardInput.display(<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { card = cardInput.confirm(); } cloudipsp.pay(card, order, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Cloudipsp.PayCallback() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPaidProcessed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Receipt receipt)</span></span></span><span class="hljs-function"> </span></span>{ Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Paid "</span></span> + receipt.status.name() + <span class="hljs-string"><span class="hljs-string">"\nPaymentId:"</span></span> + receipt.paymentId, Toast.LENGTH_LONG).show(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onPaidFailure</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Cloudipsp.Exception e)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Cloudipsp.Exception.Failure) { Cloudipsp.Exception.Failure f = (Cloudipsp.Exception.Failure) e; Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Failure\nErrorCode: "</span></span> + f.errorCode + <span class="hljs-string"><span class="hljs-string">"\nMessage: "</span></span> + f.getMessage() + <span class="hljs-string"><span class="hljs-string">"\nRequestId: "</span></span> + f.requestId, Toast.LENGTH_LONG).show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Cloudipsp.Exception.NetworkSecurity) { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Network security error: "</span></span> + e.getMessage(), Toast.LENGTH_LONG).show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Cloudipsp.Exception.ServerInternalError) { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Internal server error: "</span></span> + e.getMessage(), Toast.LENGTH_LONG).show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (e <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> Cloudipsp.Exception.NetworkAccess) { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Network error"</span></span>, Toast.LENGTH_LONG).show(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Toast.makeText(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Payment Failed"</span></span>, Toast.LENGTH_LONG).show(); } e.printStackTrace(); } }); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onBackPressed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (webView.waitingForConfirm()) { webView.skipConfirm(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onBackPressed(); } } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onNewIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onNewIntent(intent); processIntent(intent); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">processIntent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Intent intent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (nfcCardBridge.readCard(intent)) { Toast.makeText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"NFC Card read success"</span></span>, Toast.LENGTH_LONG).show(); nfcCardBridge.displayCard(cardInput); } } }</code> </pre><br></div></div><br>  It differs from the usual implementation of the presence of NfcCardBridge and hanging Intent on it to wait for the event that the card is read (readCard) <br>  <b>Underwater rocks:</b> <br>  Although the card is read by means of NFC, the usual card not present is still the protocol for financial authorization of the card.  Those.  for the full operation of this functionality, the card must be open for payments on the Internet. <br>  <b>Life hacking:</b> <br>  By writing a simple application, you can use it to transfer funds from someone else‚Äôs card to your own, by bringing someone else‚Äôs card to the phone.  For example, it may be convenient if you need to write off a small amount from a friend in the card debt account.  On the one hand, it will be practical and convenient, on the other - quite impressively.  In order to use the card-to-card transfer service, you must first register on the website of the Fondy payment platform and link the bank card for which funds will be received to your financial settings.  In order to ensure security, the amount that can be written off via NFC without 3D-Secure support can be no more than the equivalent of $ 4. </div><p>Source: <a href="https://habr.com/ru/post/339276/">https://habr.com/ru/post/339276/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../339264/index.html">Introduction to reverse engineering with Radare2</a></li>
<li><a href="../339268/index.html">Play bash'im together</a></li>
<li><a href="../339270/index.html">Wi-Fi is over: calculate offenders wireless</a></li>
<li><a href="../339272/index.html">Why do I need the flexibility of Python if I am forbidden to use it?</a></li>
<li><a href="../339274/index.html">Trillion Markets, or have time to do in 10 years</a></li>
<li><a href="../339278/index.html">Technical composition of process diagrams</a></li>
<li><a href="../339280/index.html">We study the blockchain in practice</a></li>
<li><a href="../339282/index.html">It's time to kill C #</a></li>
<li><a href="../339284/index.html">Uneducated youth. Business response</a></li>
<li><a href="../339286/index.html">When reboot time matters or why IBM uses CRIU on mainframes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>