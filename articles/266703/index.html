<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Microservices without servers (cloud version)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear readers! 

 As the most attentive of you remember, we are working on an innovative book about microservices , but at the same time, we do n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Microservices without servers (cloud version)</h1><div class="post__text post__text-html js-mediator-article">  Hello dear readers! <br><br>  As the most attentive of you remember, we are working on an innovative book about <a href="http://habrahabr.ru/company/piter/blog/255029/">microservices</a> , but at the same time, we do not forget to read what they write on the web on this topic.  Therefore, we could not get past the most interesting article from the blog Amazon, whose author Tim Wagner shares his views on microservice architecture. <br><br>  A lot of Java, JavaScript, schemes, reasoning and a lot of text <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At <a href="http://events.linuxfoundation.org/events/linuxcon-north-america">the LinuxCon / ContainerCon 2015 conference,</a> I presented a demo report titled ‚Äú <a href="http://lccocc2015.sched.org/event/7a42a7e5369aa6321e6df5a8a335451e%3Fiframe%3Dno%26w%3D%26sidebar%3Dyes%26bg%3Dno">Server-Free Microservices</a> ‚Äù.  In it, I described the creation of a microservice for image processing, deployed it in several regions, wrote a mobile application that used this microservice as a machine interface, added an HTTPS-based API, using the Amazon API Gateway and the website, and then performed it for the whole structure modular and load testing - all without servers. <br><br>  In this article, the aforementioned report is restored in full detail, and in some places I delve into the subtleties of architecture.  Additional illustrations - in the selection of <a href="http://events.linuxfoundation.org/sites/events/files/slides/cc15_wagner.pdf">slides</a> .  Another example of such an architecture is the <a href="https://aws.amazon.com/ru/blogs/compute/the-squirrelbin-architecture-a-serverless-microservice-using-aws-lambda/">SquirrelBin</a> executable file in the gist repository. <br><br>  <b>Serverless architecture</b> <br><br>  The term ‚Äúserverless‚Äù means that we do not need any explicit architecture, that is: do without servers, without deploying on servers, without installing any programs.  We will work only with managed cloud services and with a laptop.  The diagram below shows the main components and their connections: the lambda function as a machine interface and a mobile application that directly connects to it, plus the Amazon API Gateway, which provides the HTTP end point for a static site located on Amazon S3. <br><br><img src="https://habrastorage.org/files/2ee/05a/e66/2ee05ae66dde49efaf53b2234a3e9242.png"><br><br>  Serverless architecture for mobile and web applications using AWS Lambda <br><br>  So, let's start! <br><br>  <i><b>Stage 1: Create an image processing service</b></i> <br><br>  To make the whole process easier, we will use the ImageMagick library, which is built into the nodejs language of the Lambda technology.  However, this is not necessary - if you prefer your own libraries, you can <a href="https://aws.amazon.com/ru/blogs/compute/nodejs-packages-in-lambda/">load JavaScript libraries</a> or native libraries, <a href="https://aws.amazon.com/ru/blogs/compute/using-python-in-an-aws-lambda-function/">run Python,</a> or even <a href="https://aws.amazon.com/ru/blogs/compute/running-executables-in-aws-lambda/">wrap the code in a command line executable file</a> .  The following example is implemented on nodejs, but you can equally well create such a service using <a href="https://aws.amazon.com/ru/blogs/compute/aws-lambda-announces-java-support/">Java</a> , <a href="https://aws.amazon.com/ru/blogs/compute/clojure/">Clojure</a> , <a href="https://aws.amazon.com/ru/blogs/compute/writing-aws-lambda-functions-in-scala/">Scala,</a> or another jvm-language in AWS Lambda. <br><br>  The code below can be considered a kind of ‚Äúhello world‚Äù for ImageMagick - it allows you to get acquainted with the basic structure of the command (this command is a switch operator), extract the embedded image of a rose and return it.  Apart from coding the result, everything else may well be written in JSON, something like this. <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> im = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"imagemagick"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>); exports.handler = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event, context</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.operation) <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-string"><span class="hljs-string">"Operation "</span></span> + event.operation + <span class="hljs-string"><span class="hljs-string">" requested"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.operation) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'ping'</span></span>: context.succeed(<span class="hljs-string"><span class="hljs-string">'pong'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'getSample'</span></span>: event.customArgs = [<span class="hljs-string"><span class="hljs-string">"rose:"</span></span>, <span class="hljs-string"><span class="hljs-string">"/tmp/rose.png"</span></span>]; im.convert(event.customArgs, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err, output</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (err) context.fail(err); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> resultImgBase64 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Buffer(fs.readFileSync(<span class="hljs-string"><span class="hljs-string">"/tmp/rose.png"</span></span>)).toString(<span class="hljs-string"><span class="hljs-string">'base64'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> {fs.unlinkSync(<span class="hljs-string"><span class="hljs-string">"/tmp/rose.png"</span></span>);} <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e) {} <span class="hljs-comment"><span class="hljs-comment">// discard context.succeed(resultImgBase64); } }); break; //     default: var error = new Error('Unrecognized operation "' + event.operation + '"'); context.fail(error); return; } };</span></span></code> </pre> <br><br>  First, let's make sure the service works.  To do this, send the following JSON to the test window of the AWS Lambda console: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"ping"</span></span> }</code> </pre><br><br>  You should get a mandatory ‚Äúpong‚Äù response.  Next, go to the actual ImageMagick call, sending the following JSON: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"getSample"</span></span> }</code> </pre><br><br>  This query retrieves a string representation of the base64 encoded rose PNG image: ‚Äú‚Äù iVBORw0KGg ... Jggg == ‚Äù.  To make sure that these are not just some random characters, cut them out and paste (without double quotes) into any convenient decoder that converts Base64 into images, for example codebeautify.org/base64-to-image-converter.  You should have a beautiful rose image: <br><br><img src="https://habrastorage.org/files/6fb/059/11a/6fb05911a844401babce962394484d59.png"><br><br>  Sample image (red rose) <br><br>  Now let's finish the image processing service by preparing the rest of its nodejs wrapper for use.  We are going to offer a number of different operations: <br><br><ul><li>  ping: check service availability. </li><li>  getDimensions: an abbreviated version of the identify operation call to get the height and width of the image. </li><li>  identify: extract image metadata. </li><li>  resize: auxiliary procedure for resizing (‚Äúunder the hood‚Äù causing convert) </li><li>  thumbnail: a synonym for resize. </li><li>  convert: ‚Äúuniversal‚Äù procedure - can convert media formats, apply transformations, recalculate dimensions, etc. </li><li>  getSample: retrieves a sample image;  this operation corresponds to ‚Äúhello world‚Äù </li></ul><br><br>  Most of the code here is extremely straightforward.  The code wraps the ImageMagick procedures implemented on nodejs, some of them accept JSON (in this case, the event sent by Lambda is cleared and redirected), while others take command line arguments (so-called ‚Äúcustom‚Äù) that are passed as an array of strings.  One aspect of this functionality may not be obvious if you have not previously worked with ImageMagick, namely: it functions as a command line wrapper, and file names have semantics.  We have two competing needs: first, the client must transmit semantics (for example, the output image format, say, PNG vs. JPEG), secondly, the author of the service must determine where to make temporary storage on the disk, so we don‚Äôt allow leaks of details implementation.  To solve both of these tasks at the same time, we define two arguments in the JSON schema: ‚ÄúinputExtension‚Äù and ‚ÄúoutputExtension‚Äù, and then create the actual file location by combining the client part (file extension) with the server part (directory name and base name).  You can view (and use!) The finished code in the next <a href="http%253A%252F%252Fspecs.openid.net%252Fextensions%252Fpape%252F1.0%26server%3D%252Fap%252Fsignin%253Fie%253DUTF8%26accountPoolAlias%3D%26forceMobileApp%3D0%26language%3Dru_RU%26forceMobileLayout%3D0">image processing drawing</a> . <br><br>  There are many tests that can be performed here (which we will do below), but as a quick health check we will again extract the same image of the rose and pass it back using a negative filter (performing color inversion).  You can use a similar JSON file in the Lambda console, just replace the contents of the base64Image field with the characters that match your image (this sequence is quite long). <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"convert"</span></span>, <span class="hljs-string"><span class="hljs-string">"customArgs"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"-negate"</span></span> ], <span class="hljs-string"><span class="hljs-string">"outputExtension"</span></span>: <span class="hljs-string"><span class="hljs-string">"png"</span></span>, <span class="hljs-string"><span class="hljs-string">"base64Image"</span></span>: <span class="hljs-string"><span class="hljs-string">"...fill this in with the rose sample image, base64-encoded..."</span></span> }</code> </pre><br><br>  The output decoded into the image is a real botanical delicacy, a blue rose: <br><br><img src="https://habrastorage.org/files/7c5/4e8/d87/7c54e8d87fa346d09abd9e893eb60b86.png"><br><br>  Blue rose (negative from the original image with a red rose) <br><br>  That's all that concerns the functionality of the service.  As a rule, the quotes begin here, we move from ‚Äúonce worked‚Äù to ‚Äúscalable and reliable service with round-the-clock tracking and logging of production‚Äù.  But this is the beauty of Lambda: our image processing code is already fully deployed microservice, ready for practical use.  It remains to add a mobile application that can call it ... <br><br>  <i><b>Stage 2: Create a mobile client</b></i> <br><br>  There are several ways to contact our microservice for processing applications, but to demonstrate a sample client, we will write a small Android application.  Below is the client code used by the report on ContainerCon.  A simple Android application is created here that allows you to take an image and a filter, after which the filter is applied to the image in the ‚Äúconvert‚Äù operation, and we see what happens in the end.  Filtering is carried out in the microservice image processing, which now works in AWS Lambda. <br><br>  To make it clearer what this application does, take for example the AWS Lambda icon: <br><br><img src="https://habrastorage.org/files/716/3d3/1c4/7163d31c46744ccea63324972d2c2c68.jpg"><br><br>  Android emulator displaying AWS Lambda icon <br><br>  We will select a ‚Äúnegative‚Äù filter to invert the colors on the icon: <br><br><img src="https://habrastorage.org/files/9ce/82c/cee/9ce82cceedb64634be84300ff515ece9.jpg"><br><br>  Selecting the 'Negate' filter for image conversion <br><br>  ... and here is the result: the blue version of our moniker Lambda (it was originally orange): <br><br><img src="https://habrastorage.org/files/7e6/ba8/a16/7e6ba8a1633649eaab69e4d266d0976a.jpg"><br><br>  Result of applying the 'Negate' filter to the AWS Lambda icon <br><br>  In addition, we could give a vintage look to the modern panorama of Seattle.  Take a picture of Seattle and apply to it a filter in sepia tones: <br><br><img src="https://habrastorage.org/files/8a7/805/1d7/8a78051d7cc943b0bf4a250c89e95f6c.jpg"><br><br>  Seattle panorama in sepia tones. <br><br>  Go to the code.  I don‚Äôt want to teach you the basics of programming under Android, but just pay attention to the Lambda-specific elements of the application.  If you are writing your own application, you will need to enable the AWS Mobile SDK archive to run the code samples below).  Conceptually, the code consists of four parts: <br><br><ol><li>  POJO data schema </li><li>  Remote Service Definition (operation) </li><li>  Initialization </li><li>  Service call </li></ol><br><br>  Consider all the parts in turn. <br><br>  The data scheme defines all the objects that need to be transferred between the client and the server.  There is no "Lambda isms";  All objects are plain POJO (Plain Old Java Object) without any special libraries or frameworks.  We define a base event and then expand it to reflect the structure of our operation.  You can assume that there is ‚Äújavacification‚Äù of the JSON that we used when defining and testing the image processing service above.  If you are also writing a Java server, you will usually share these files as part of defining the overall structure of events;  in our example, these POJO objects are turned into server-side JSON. <br><br>  LambdaEvent.java <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.amazon.lambda.androidimageprocessor.lambda; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LambdaEvent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String operation; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOperation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> operation;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOperation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String operation)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.operation = operation;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LambdaEvent</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String operation)</span></span></span><span class="hljs-function"> </span></span>{setOperation(operation);} }</code> </pre><br><br>  ImageConvertRequest.java <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.amazon.lambda.androidimageprocessor.lambda; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ImageConvertRequest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LambdaEvent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String base64Image; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String inputExtension; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String outputExtension; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List customArgs; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ImageConvertRequest</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(<span class="hljs-string"><span class="hljs-string">"convert"</span></span>);} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getBase64Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> base64Image;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setBase64Image</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String base64Image)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.base64Image = base64Image;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInputExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> inputExtension;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setInputExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String inputExtension)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.inputExtension = inputExtension;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getOutputExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> outputExtension;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setOutputExtension</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String outputExtension)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.outputExtension = outputExtension;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> List </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCustomArgs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> customArgs;} <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">setCustomArgs</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(List customArgs)</span></span></span><span class="hljs-function"> </span></span>{<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.customArgs = customArgs;} }</code> </pre><br><br>  So far everything is relatively simple.  Now that we have the data model, we define the end point of the server with a few Java annotations.  Here we provide two operations, ‚Äúping‚Äù and ‚Äúconvert‚Äù;  It will be easy to extend the code by adding other operations to them, but this is not required for the demo application discussed below. <br><br>  ILambdaInvoker.java <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.amazon.lambda.androidimageprocessor.lambda; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazonaws.mobileconnectors.lambdainvoker.LambdaFunction; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILambdaInvoker</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@LambdaFunction</span></span>(functionName = <span class="hljs-string"><span class="hljs-string">"ImageProcessor"</span></span>) <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ping</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Map event)</span></span></span></span>; <span class="hljs-meta"><span class="hljs-meta">@LambdaFunction</span></span>(functionName = <span class="hljs-string"><span class="hljs-string">"ImageProcessor"</span></span>) <span class="hljs-function"><span class="hljs-function">String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">convert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ImageConvertRequest request)</span></span></span></span>; }</code> </pre><br><br>  Now we are ready to go to the main part of the application.  Here you will see mainly the Android screen code, as well as the code for simple client resource management, but I‚Äôll separately note a couple of snippets related to Lambda: <br><br>  This is the ‚Äúinit‚Äù section;  here, an authentication provider is created to invoke the Lambda API and and creates a Lambda invoker to call the endpoints defined above and pass the POJOs to our data model: <br><br><pre> <code class="java hljs"> <span class="hljs-comment"><span class="hljs-comment">//   CognitoCachingCredentialsProvider CognitoCachingCredentialsProvider cognitoProvider = new CognitoCachingCredentialsProvider( this.getApplicationContext(), "us-east-1:&lt;YOUR COGNITO IDENITY POOL GOES HERE&gt;", Regions.US_EAST_1); //  LambdaInvokerFactory,       Lambda. LambdaInvokerFactory factory = new LambdaInvokerFactory(this.getApplicationContext(), Regions.US_EAST_1, cognitoProvider); //  - Lambda         Json. lambda = factory.build(ILambdaInvoker.class);</span></span></code> </pre><br><br>  Another piece of code that is (rather) interesting is the remote procedure call itself: <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> lambda.convert(params[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (LambdaFunctionException e) { Log.e(<span class="hljs-string"><span class="hljs-string">"Tag"</span></span>, <span class="hljs-string"><span class="hljs-string">"Failed to convert image"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre><br><br>  In fact, it is not so interesting, because all the magic (the serialization of the argument and the deserialization of the result) proceeds implicitly, and we only need to do some error handling here. <br>  Here is the complete source file: <br><br>  MainActivity.java <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.amazon.lambda.androidimageprocessor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.ProgressDialog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.Bitmap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.graphics.BitmapFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.AsyncTask; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Base64; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.util.Log; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.ImageView; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Spinner; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.Toast; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazon.lambda.androidimageprocessor.lambda.ILambdaInvoker; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazon.lambda.androidimageprocessor.lambda.ImageConvertRequest; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazonaws.auth.CognitoCachingCredentialsProvider; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazonaws.mobileconnectors.lambdainvoker.LambdaFunctionException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazonaws.mobileconnectors.lambdainvoker.LambdaInvokerFactory; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.amazonaws.regions.Regions; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.io.ByteArrayOutputStream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.HashMap; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.List; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Map; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Objects; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MainActivity</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Activity</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILambdaInvoker lambda; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ImageView selectedImage; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String selectedImageBase64; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ProgressDialog progressDialog; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate(savedInstanceState); setContentView(R.layout.activity_main); <span class="hljs-comment"><span class="hljs-comment">//   CognitoCachingCredentialsProvider CognitoCachingCredentialsProvider cognitoProvider = new CognitoCachingCredentialsProvider( this.getApplicationContext(), "us-east-1:2a40105a-b330-43cf-8d4e-b647d492e76e", Regions.US_EAST_1); //  LambdaInvokerFactory,       Lambda. LambdaInvokerFactory factory = new LambdaInvokerFactory(this.getApplicationContext(), Regions.US_EAST_1, cognitoProvider); //  - Lambda         Json. lambda = factory.build(ILambdaInvoker.class); //  lambda-,  ,    pingLambda(); } //  lambda- @SuppressWarnings("unchecked") private void pingLambda() { Map event = new HashMap(); event.put("operation", "ping"); //  Lambda-    . // ,       . new AsyncTask&lt;Map, Void, String&gt;() { @Override protected String doInBackground(Map... params) { //   "ping".   ,    //  LambdaFunctionException. try { return lambda.ping(params[0]); } catch (LambdaFunctionException lfe) { Log.e("Tag", "Failed to invoke ping", lfe); return null; } } @Override protected void onPostExecute(String result) { if (result == null) { return; } //    Toast.makeText(MainActivity.this, "Made contact with AWS lambda", Toast.LENGTH_LONG).show(); } }.execute(event); } //     "process image" public void processImage(View view) { //     if (selectedImageBase64 == null) { Toast.makeText(this, "Please tap one of the images above", Toast.LENGTH_LONG).show(); return; } //    String filter = ((Spinner) findViewById(R.id.filter_picker)).getSelectedItem().toString(); //    ImageConvertRequest request = new ImageConvertRequest(); request.setBase64Image(selectedImageBase64); request.setInputExtension("png"); request.setOutputExtension("png"); //     List customArgs = new ArrayList(); request.setCustomArgs(customArgs); switch (filter) { case "Sepia": customArgs.add("-sepia-tone"); customArgs.add("65%"); break; case "Black/White": customArgs.add("-colorspace"); customArgs.add("Gray"); break; case "Negate": customArgs.add("-negate"); break; case "Darken": customArgs.add("-fill"); customArgs.add("black"); customArgs.add("-colorize"); customArgs.add("50%"); break; case "Lighten": customArgs.add("-fill"); customArgs.add("white"); customArgs.add("-colorize"); customArgs.add("50%"); break; default: return; } // async-  lambda- new AsyncTask() { @Override protected String doInBackground(ImageConvertRequest... params) { try { return lambda.convert(params[0]); } catch (LambdaFunctionException e) { Log.e("Tag", "Failed to convert image"); return null; } } @Override protected void onPostExecute(String result) { //    ,    if (result == null || Objects.equals(result, "")) { hideLoadingDialog(); Toast.makeText(MainActivity.this, "Processing failed", Toast.LENGTH_LONG).show(); return; } //      base64         byte[] imageData = Base64.decode(result, Base64.DEFAULT); selectedImage.setImageBitmap(BitmapFactory.decodeByteArray(imageData, 0, imageData.length)); hideLoadingDialog(); } }.execute(request); showLoadingDialog(); } /*      */ public void selectLambdaImage(View view) { selectImage(R.drawable.lambda); selectedImage = (ImageView) findViewById(R.id.static_lambda); Toast.makeText(this, "Selected image 'lambda'", Toast.LENGTH_LONG).show(); } public void selectSeattleImage(View view) { selectImage(R.drawable.seattle); selectedImage = (ImageView) findViewById(R.id.static_seattle); Toast.makeText(this, "Selected image 'seattle'", Toast.LENGTH_LONG).show(); } public void selectSquirrelImage(View view) { selectImage(R.drawable.squirrel); selectedImage = (ImageView) findViewById(R.id.static_squirrel); Toast.makeText(this, "Selected image 'squirrel'", Toast.LENGTH_LONG).show(); } public void selectLinuxImage(View view) { selectImage(R.drawable.linux); selectedImage = (ImageView) findViewById(R.id.static_linux); Toast.makeText(this, "Selected image 'linux'", Toast.LENGTH_LONG).show(); } //   'id'  ,   base64 private void selectImage(int id) { Bitmap bmp = BitmapFactory.decodeResource(getResources(), id); ByteArrayOutputStream stream = new ByteArrayOutputStream(); bmp.compress(Bitmap.CompressFormat.PNG, 100, stream); selectedImageBase64 = Base64.encodeToString(stream.toByteArray(), Base64.DEFAULT); } //       public void reset(View view) { ((ImageView) findViewById(R.id.static_lambda)).setImageDrawable(getResources().getDrawable(R.drawable.lambda, getTheme())); ((ImageView) findViewById(R.id.static_seattle)).setImageDrawable(getResources().getDrawable(R.drawable.seattle, getTheme())); ((ImageView) findViewById(R.id.static_squirrel)).setImageDrawable(getResources().getDrawable(R.drawable.squirrel, getTheme())); ((ImageView) findViewById(R.id.static_linux)).setImageDrawable(getResources().getDrawable(R.drawable.linux, getTheme())); Toast.makeText(this, "Please choose from one of these images", Toast.LENGTH_LONG).show(); } private void showLoadingDialog() { progressDialog = ProgressDialog.show(this, "Please wait...", "Processing image", true, false); } private void hideLoadingDialog() { progressDialog.dismiss(); } }</span></span></code> </pre><br><br>  That's all mobile app.  It consists of a data model (Java class), a control model (a couple of methods), three commands for initializing all sorts of things, and then a remote call enclosed in a try / catch block ... everything is simple. <br><br>  <b>Deploy in multiple regions</b> <br><br>  Until now, we have not particularly stopped on where this code will work.  Lambda is responsible for deploying your code within a particular region, but you have to decide in which other regions you will use it.  In my original demo, I wrote a function to work in the eastern United States ‚Äî for example, this refers to a data center in Virginia.  I wrote above that we are doing a global service, so let's expand its coverage area to the west of Europe (Ireland) and the Pacific region (Tokyo) so that mobile applications from these regions can connect to the service with minimal delay: <br><br><img src="https://habrastorage.org/files/77a/9c2/869/77a9c2869e0a47b7aed01f659aa2545f.png"><br><br>  Serverless mechanism for deploying Lambda functions in two additional regions <br><br>  <b>Serverless web application part 1: API endpoints</b> <br><br>  So now we have a mobile application and a globally deployed image processing service that serves as its machine interface.  Let's move on to creating a serverless web application for those comrades who prefer to work in the browser, and not on the device.  We will do this in two stages.  First, create an API endpoint for the image processing service.  Then, in the next section, we add the site itself using Amazon S3. <br><br>  AWS Lambda makes it easy to turn code into services, in particular, because the web service client interface is already ‚Äúembedded‚Äù here.  However, this requires clients (such as the mobile client that we wrote in the previous section) to sign requests with credentials provided by AWS.  This task is solved by the <a href="https://aws.amazon.com/ru/cognito/">Amazon Cognito</a> authorization client used in our Android application, but what if we wanted to open a shared access to the image processing service through the website? <br><br>  To do this, turn to another server, the <a href="https://aws.amazon.com/ru/api-gateway/">Amazon API Gateway</a> .  This service allows you to define an API without requiring any infrastructure ‚Äî the API is fully managed by AWS.  We use the API gateway to create a URL that will be used by the image processing service, which provides access to a subset of its capabilities to any web user.  Amazon API Gateway provides various ways to control access to various APIs: API calls can be signed with AWS credentials, or you can use OAuth tokens and simply redirect the headers to verification, you can use API keys (not recommended if you need secure access) or make the API completely publicly available, as will be shown here. <br><br>  In addition to the various access models, API Gateway also offers many features that are beyond the scope of this article.  Some of them are built-in (for example, protection against DDOS attacks), while others, such as caching, can further reduce delays and the cost of repeatedly extracting a popular image.  By implementing the level of indirection between clients and (micro) services, API Gateway also allows you to develop them independently, using separate procedures for version control and primary data placement (staging).  In the meantime, we will focus on solving the main task: to provide our image processing service as an API. <br><br>  So let's create our API.  In AWS Console, click API Gateway, and then select ‚ÄúNew API‚Äù, set a name for the API, you can also add a description.  I chose the name ‚ÄúImageAPI‚Äù. <br><br><img src="https://habrastorage.org/files/8aa/5f9/bc0/8aa5f9bc07324ee8a5329fbe1104c627.png"><br><br>  Next, create a resource for your new API (I called it ‚ÄúImageProcessingService‚Äù), then make the POST method in it.  Select ‚ÄúLambda function‚Äù as the integration type and enter the name of the Lambda function that you will use as a service for image processing.  In the ‚ÄúMethod Request‚Äù configuration, set the type of authorization to ‚Äúnone‚Äù (that is, it will be a public endpoint).  That's all. <br><br><img src="https://habrastorage.org/files/19f/d6d/180/19fd6d180ff6404d8da8894a13cf65c6.png"><br><br>  To test the integration, click the ‚ÄúTest‚Äù button: <br><br><img src="https://habrastorage.org/files/e54/6df/128/e546df128ca642b69600995d895ef4e2.png"><br><br>  Then specify the test payload {‚Äúoperation‚Äù: ‚Äúping‚Äù}.  You should get the expected pong result indicating that you have successfully associated your API with the Lambda function. <br><br>  Remark: below we will do more complete (and deep) testing, but usually I find it useful to add a GET method to my API as a top-level resource, which is associated with some simple operation, for example, ping.  This way, I can quickly verify from any browser that my API is correctly associated with the Lambda function.  In our demo application (and in general) this is not mandatory, but it is possible that you will like this. <br><br>  For what comes next (static content S3), we also need to activate CORS.  It's simple, but done in several steps.  The API Gateway team continues to simplify this process, so in order not to repeat their instructions here (which may well become outdated soon), I refer you to the <a href="http://docs.aws.amazon.com/apigateway/latest/developerguide/how-to-cors.html">documentation</a> . <br><br>  Click the ‚ÄúDeploy this API‚Äù button.  Now everything should be ready to create your site! <br><br> <b> -,  2:     Amazon S3</b> <br><br>   :   Javascript-     S3,    : <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ENDPOINT = <span class="hljs-string"><span class="hljs-string">'https://fuexvelc41.execute-api.us-east-1.amazonaws.com/prod/ImageProcessingService'</span></span>; angular.<span class="hljs-keyword"><span class="hljs-keyword">module</span></span>(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, [<span class="hljs-string"><span class="hljs-string">'ui.bootstrap'</span></span>]) .controller(<span class="hljs-string"><span class="hljs-string">'MainController'</span></span>, [<span class="hljs-string"><span class="hljs-string">'$scope'</span></span>, <span class="hljs-string"><span class="hljs-string">'$http'</span></span>, function($scope, $http) { $scope.loading = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; $scope.image = { width: <span class="hljs-number"><span class="hljs-number">100</span></span> }; $scope.ready = function() { $scope.loading = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; }; $scope.submit = function() { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fileCtrl = document.getElementById(<span class="hljs-string"><span class="hljs-string">'image-file'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fileCtrl.files &amp;&amp; fileCtrl.files[<span class="hljs-number"><span class="hljs-number">0</span></span>]) { $scope.loading = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileReader(); fr.onload = function(e) { $scope.image.base64Image = e.target.result.slice(e.target.result.indexOf(<span class="hljs-string"><span class="hljs-string">','</span></span>) + <span class="hljs-number"><span class="hljs-number">1</span></span>); $scope.$apply(); document.getElementById(<span class="hljs-string"><span class="hljs-string">'original-image'</span></span>).src = e.target.result; <span class="hljs-comment"><span class="hljs-comment">//   ! $http.post(ENDPOINT, angular.extend($scope.image, { operation: 'resize', outputExtension: fileCtrl.value.split('.').pop() })) .then(function(response) { document.getElementById('processed-image').src = "data:image/png;base64," + response.data; }) .catch(console.log) .finally($scope.ready); }; fr.readAsDataURL(fileCtrl.files[0]); } }; }]);</span></span></code> </pre><br><br>   HTML-  ( )  : <br><br><pre> <code class="javascript hljs">&lt;!DOCTYPE html&gt; &lt;html lang="en"&gt; &lt;head&gt; &lt;title&gt;Image Processing Service&lt;/title&gt; &lt;meta charset="utf-8"&gt; &lt;meta http-equiv="X-UA-Compatible" content="IE=edge"&gt; &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt; &lt;link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.4/css/bootstrap.min.css"&gt; &lt;link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Open+Sans:400,700"&gt; &lt;link rel="stylesheet" type="text/css" href="main.css"&gt; &lt;/head&gt; &lt;body ng-app="app" ng-controller="MainController"&gt; &lt;div class="container"&gt; &lt;h1&gt;Image Processing Service&lt;/h1&gt; &lt;div class="row"&gt; &lt;div class="col-md-4"&gt; &lt;form ng-submit="submit()"&gt; &lt;div class="form-group"&gt; &lt;label for="image-file"&gt;Image&lt;/label&gt; &lt;input id="image-file" type="file"&gt; &lt;/div&gt; &lt;div class="form-group"&gt; &lt;label for="image-width"&gt;Width&lt;/label&gt; &lt;input id="image-width" class="form-control" type="number" ng-model="image.width" min="1" max="4096"&gt; &lt;/div&gt; &lt;button type="submit" class="btn btn-primary"&gt; &lt;span class="glyphicon glyphicon-refresh" ng-if="loading"&gt;&lt;/span&gt; Submit &lt;/button&gt; &lt;/form&gt; &lt;/div&gt; &lt;div class="col-md-8"&gt; &lt;accordion close-others="false"&gt; &lt;accordion-group heading="Original Image" is-open="true"&gt; &lt;img id="original-image" class="img-responsive"&gt; &lt;/accordion-group&gt; &lt;accordion-group heading="Processed Image" is-open="true"&gt; &lt;img id="processed-image" class="img-responsive"&gt; &lt;/accordion-group&gt; &lt;/accordion&gt; &lt;/div&gt; &lt;/div&gt; &lt;/div&gt; &lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.3.15/angular.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.3/ui-bootstrap.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-bootstrap/0.13.3/ui-bootstrap-tpls.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="main.js"&gt;&lt;/script&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br><br> ,  CSS: <br><br><pre> <code class="css hljs"><span class="hljs-selector-tag"><span class="hljs-selector-tag">body</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">font-family</span></span>: <span class="hljs-string"><span class="hljs-string">'Open Sans'</span></span>, sans-serif; <span class="hljs-attribute"><span class="hljs-attribute">padding-bottom</span></span>: <span class="hljs-number"><span class="hljs-number">15px</span></span>; } <span class="hljs-selector-tag"><span class="hljs-selector-tag">a</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">cursor</span></span>: pointer; } <span class="hljs-comment"><span class="hljs-comment">/** LOADER **/</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.glyphicon-refresh</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-animation</span></span>: spin .<span class="hljs-number"><span class="hljs-number">7s</span></span> infinite linear; <span class="hljs-attribute"><span class="hljs-attribute">-webkit-animation</span></span>: spin .<span class="hljs-number"><span class="hljs-number">7s</span></span> infinite linear; } @<span class="hljs-keyword"><span class="hljs-keyword">keyframes</span></span> spin { <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rotate</span></span>(0deg); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rotate</span></span>(360deg); } } @-<span class="hljs-keyword"><span class="hljs-keyword">webkit</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">keyframes</span></span> spin { <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-webkit-transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rotate</span></span>(0deg); } <span class="hljs-selector-tag"><span class="hljs-selector-tag">to</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">-webkit-transform</span></span>: <span class="hljs-built_in"><span class="hljs-built_in">rotate</span></span>(360deg); } }</code> </pre><br><br> ‚Ä¶        S3: <br><br><img src="https://habrastorage.org/files/56c/b5a/597/56cb5a59729441ac9caf93b97e3cee9c.png"><br><br> URL     S3   , ., ‚Äúhttp://image-processing-service.s3-website-us-east-1.amazonaws.com/‚Äù.    URL   ‚Äî       : <br><br><img src="https://habrastorage.org/files/f52/d13/0af/f52d130af16a4013b36860dcc68e3846.png"><br><br> <b>   </b> <br><br> API Gateway  Lambda-  ,      URL.      .      ,      ,    ! <br> ,        API.  :    ¬´ HTTPS-¬ª Lambda,   POST    ,      API Gateway: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"options"</span></span>: { <span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"fuexvelc41.execute-api.us-east-1.amazonaws.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/prod/ImageProcessingService"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span> }, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"getSample"</span></span> } }</code> </pre><br><br>        .       :      Lambda-        Amazon DynamoDB.           Lambda,     ¬´ ¬ª: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"unit"</span></span>, <span class="hljs-string"><span class="hljs-string">"function"</span></span>: <span class="hljs-string"><span class="hljs-string">"HTTPSInvoker"</span></span>, <span class="hljs-string"><span class="hljs-string">"resultsTable"</span></span>: <span class="hljs-string"><span class="hljs-string">"unit-test-results"</span></span>, <span class="hljs-string"><span class="hljs-string">"testId"</span></span>: <span class="hljs-string"><span class="hljs-string">"LinuxConDemo"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>: { <span class="hljs-string"><span class="hljs-string">"options"</span></span>: { <span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"fuexvelc41.execute-api.us-east-1.amazonaws.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/prod/ImageProcessingService"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span> }, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"getSample"</span></span> } } }</code> </pre><br><br> ,    ,         .            Lambda,        ¬´ ¬ª: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"load"</span></span>, <span class="hljs-string"><span class="hljs-string">"iterations"</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">"function"</span></span>: <span class="hljs-string"><span class="hljs-string">"TestHarness"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>: { <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"unit"</span></span>, <span class="hljs-string"><span class="hljs-string">"function"</span></span>: <span class="hljs-string"><span class="hljs-string">"HTTPSInvoker"</span></span>, <span class="hljs-string"><span class="hljs-string">"resultsTable"</span></span>: <span class="hljs-string"><span class="hljs-string">"unit-test-results"</span></span>, <span class="hljs-string"><span class="hljs-string">"testId"</span></span>: <span class="hljs-string"><span class="hljs-string">"LinuxConLoadTestDemo"</span></span>, <span class="hljs-string"><span class="hljs-string">"event"</span></span>: { <span class="hljs-string"><span class="hljs-string">"options"</span></span>: { <span class="hljs-string"><span class="hljs-string">"host"</span></span>: <span class="hljs-string"><span class="hljs-string">"fuexvelc41.execute-api.us-east-1.amazonaws.com"</span></span>, <span class="hljs-string"><span class="hljs-string">"path"</span></span>: <span class="hljs-string"><span class="hljs-string">"/prod/ImageProcessingService"</span></span>, <span class="hljs-string"><span class="hljs-string">"method"</span></span>: <span class="hljs-string"><span class="hljs-string">"POST"</span></span> }, <span class="hljs-string"><span class="hljs-string">"data"</span></span>: { <span class="hljs-string"><span class="hljs-string">"operation"</span></span>: <span class="hljs-string"><span class="hljs-string">"getSample"</span></span> } } } }</code> </pre><br><br>      : <br><br><img src="https://habrastorage.org/files/432/405/ece/432405ece280445a803933ad2e003ab6.png"><br><br>        <br><br>     ,    ,     ..      -,     API Gateway   HTTP,          .       ,       -       DynamoDB,     . <br><br> <b></b> <br><br>   ,      ,            .    ¬´¬ª     ,    ,          ,  -  :  ,  , API,   .    ! </div><p>Source: <a href="https://habr.com/ru/post/266703/">https://habr.com/ru/post/266703/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../266689/index.html">Rating of data center operators in Russia by the degree of readiness to interact with foreign customers</a></li>
<li><a href="../266693/index.html">Under the hood rendering navigation data in MAPS.ME</a></li>
<li><a href="../266695/index.html">VAD (Voice Application Designer). Part 2 components (Call Related)</a></li>
<li><a href="../266699/index.html">Why the SoundCloud team switched to microservices</a></li>
<li><a href="../266701/index.html">Notes from Intel System Studio Developer: Debugging Android Linux Core with Intel JTAG Debugger and MinnowBoard MAX</a></li>
<li><a href="../266705/index.html">Basics of preparing applications for deployment (Application packaging)</a></li>
<li><a href="../266707/index.html">Underground carders market. Translation of the book "KingPIN". Chapter 10. "Cris Aragon"</a></li>
<li><a href="../266713/index.html">Design unification from the backend: JavaScript on the server</a></li>
<li><a href="../266715/index.html">Borrowing and time in Rust</a></li>
<li><a href="../266717/index.html">Study: Almost all popular firewalls miss XSS attacks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>