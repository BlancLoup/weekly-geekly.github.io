<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Xen Cloud Platform in Enterprise [1]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Among all enterprise virtualization systems, XCP is the only free and free one. The history of XCP goes to XenServer, which, although based on an open...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Xen Cloud Platform in Enterprise [1]</h1><div class="post__text post__text-html js-mediator-article">  Among all enterprise virtualization systems, XCP is the only free and free one.  The history of XCP goes to XenServer, which, although based on an open source hypervisor, was quite a paid software.  Cyrix has published the XenServer code under a free license, and from then on XenServer began to smoothly transform into the Xen Cloud Platform. <br><br>  In this series of articles, I will talk about how to use XCP in a single administrative center when virtual machines and the virtualization infrastructure are managed by the same organization (that is, a typical scenario with the virtualization of enterprise servers).  In these articles there will be few examples and command-line keys (the administration guide on the Cyrics website is quite published), instead I will talk about concepts, terms and relationships of objects. <br><br>  From the user point of view, the main difference between the usual zen (as part of most operating systems) and XCP is the installation process and the number of dobrovok before launch into product.  XCP comes in the form of ISO's with a ready OS for dom0 (CentOS), adapted to serve the hypervisor and ensure the work of the hosts in the cloud.  Xen usually comes in the form of hypervisor + utils, it is assumed that the person will create everything else himself.  Another bonus for those who have to deal with Microsoft products is signed Windows drivers (you can also install them in xena with some tricks, but they are native in XCP). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      XCP is a relatively peculiar platform.  It is not ‚Äúclosed‚Äù in the sense that hyper-v, for example, is closed, but comes in the form of a complete OS, many aspects of the configuration of which are controlled by the platform, and not the OS.  For example, a network: you can hang an ip-address on any interface with ifconfig, but the consequences will be sad - you should use the tools of the platform for managing networks and interfaces. <br><br>  XCP consists of several components: xen, xapi, open vswitch, xe cli, stunnel, sqeezed that provide different aspects of the system. <br><br>  At the beginning of the system requirements: <br><a name="habracut"></a><br>  1) If we are talking about windows virtualization (that is, HVM domains), then processors with VT / Pacifica support are imperative. <br>  2) In case the cloud is planned with more than one server, it is mandatory to use network storage (iscsi or NFS). <br>  3) Hosts (if there are more than one) should be strictly the same - the same processor stepping, motherboard, etc. <br>  4) Hosts must be in the same channel segment (i.e. be connected through a switch, not through a router). <br><br>  Now, actually, to the point. <br><br><h1>  XCP terminology </h1><br>  (contents) <br>  Host - server engaged in virtualization. <br>  Pool - the union of identical hosts, allowing migration. <br>  SR - storage repository - a place where virtual machines are stored (either a local screw or an NFS / ISCSI storage).  To be precise, SR is storage information.  Each host has its own PBD (physical block device) connecting the host to the SR.  The presence of PBD in SR on each host is a condition for machine migration. <br>  VDI - virtual disk image, I think, does not require decryption.  Can be either a file or a LVM logical volume <br>  VM is a virtual machine. <br>  VBD - virtual block device - an XCP-specific construction, a logical connection between VDI and a block device inside a virtual machine. <br>  network ‚Äî network (more precisely, network record).  Similarly, SR hosts connect to the network using a PIF (Physical interface). <br>  VIF - virtual interface - a logical structure connecting a network and a virtual machine.  Unlike VBD, it is more ‚Äúreal‚Äù, it can be seen in the list of network interfaces at the moment when the virtual machine is turned on. <br>  vlan - wilan is wilan.  If the vilanas are used, they represent the level between the network and pif (on one pif there can be several vilan, vilan are included in the network). <br><br><h1>  Pula </h1><br>  Poole is an abstraction that unites hosts.  A pool has a configuration (state) that describes all (almost all) aspects of the configuration of everything ‚Äî hosts, pool, networks, SRs, virtual machines, etc.  Each host stores a full replica of the state, although the master is only one pool.  The wizard sends the changes to all pending approximately once every 15 seconds (these are hosts, and possibly external observers using XenAPI).  In addition, changes in specific components are notified "in real time".  The master can be reassigned on the go (almost without interfering with the normal work and without exerting any influence on the virtual machines).  In the event of a crash wizard, hosts can be reconfigured to a new wizard on the go.  Accepting / excluding a host to a pool requires it to reboot, in addition, all virtual machines that are on it are lost (if the machines were in a pool with several hosts and stored on an external SR, they will remain available for running on other pool hosts if the machines were locally, they will be destroyed).  For business needs, the hosts in the pool can be turned on / off without removing them from the pool (in fact, it‚Äôs just a ban on launching new machines on them). <br><br>  If there is only one host, it is ‚Äúself pool‚Äù.  If a host joins someone else's pool, then it ‚Äúforgets‚Äù about its pool and accepts someone else's.  Hosts in a pool always belong to one pool and know nothing about other pools (that is, a pool is always one, even though it has a unique identifier, but this is just a formality). <br><br><h1>  Virtual machines </h1><br>  Virtual machines come in two types: hardware virtualization (HVM) and paravirtualized (PV).  Paravirtualized virtual machines are always preferable to HVM because PV uses a special kernel that ‚Äúassists‚Äù virtualization and uses hypervisor calls (hypercalls) directly, rather than via interception of privileged instructions by the hypervisor (as happens in HVM).  Windows can only work in HVM mode due to the fact that Microsoft did not publish the kernel code under a license, which allows it to be adapted for effective work in PV mode. <br><br>  A virtual machine in XCP is significantly more complex than a domain in regular zen.  The virtual machine "exists" even when it is turned off.  A virtual machine has a lot of attributes that are used to start and operate the machine (in fact, this config is the ‚Äúvirtual machine‚Äù). <br><br>  The concepts of VBD (virtual block device), VIF (virtual network adapter) are associated with the virtual machine.  And drives, and network adapters can be in the set (I have not tested tightly, but 8 pieces can be, and the numbers are allowed to create devices at least hundreds). <br><br>  Among the important features of a virtual machine: quotas of memory, processor, number of allowed cores (from 1 to 16 in the current configuration). <br><br>  An important feature: XCP allows you to change the amount of memory of a virtual machine on the go, however, it does not allow you to use any kind of oversell (i.e. a declaration to the virtual machine that there is more memory than it is).  The maximum amount of memory that can be allocated to virtual machines is equal to the virtual memory of the host minus the overhead (about 512 MB).  Memory can be moved between machines on the go, but the total cannot be exceeded.  Each machine can have its own swap and use it as much as it wants. <br><br>  The processor can be connected and disconnected while on the move (this is a flyer; in fact, certain processors are simply allowed and / or prohibited).  Not all programs like this (for example, atop pulls down the roof, if the processor pokes on the go).  You can specify a virtual machine quota (as a percentage of computer time) and / or priority in case of competitive access to the processor. <br><br>  For extremely thin configurations, you can allocate to the virtual machine some cores (processors) for exclusive use (vcpu pinning). <br><br><h1>  Network </h1><br>  The network is the most difficult area of ‚Äã‚Äãvirtualization.  XCP uses open vswitch and open flow technology to implement a virtual network.  The description of this technology is much beyond the cycle of articles, I can only say that this technology allows you to make the "logic" of managing the switch as a separate application.  The network can be connected with physical adapters, and can be purely virtual.  Unfortunately, pure virtual networks do not migrate properly (for communication between virtual machines located on different hosts, it is necessary to use the network connected to the switch, the hosts connecting).  The created virtual network adapter connects to the virtual network.  It can work in both normal (unicast) mode and promiscuous mode (listening to all network traffic).  In principle, there are no restrictions on the number of network adapters of a virtual machine on a single network.  In the existing implementation, this network does not support jumbo frames, however, it supports offload to the control domain the CRC calculation of outgoing frames (and, if there is an understanding iron, TCP processing is done). <br><br>  Of course, the network may not be associated with a physical adapter, but with a Vilan - in this case, all network traffic will go beyond the host in the trunk. <br><br><h1>  SR </h1><br>  One of the fundamental features of XCP is the concept of SR - storage repository.  SR is a disk storage (VDI) of virtual machines and ISO's (future CDs for virtual machines).  SR can be of two types: local (not interesting, because by its functionality it is the usual local ball, disk partition, directory, etc.) and shared (shared).  It is shared SR that is the main XCP tool.  The cloud (more precisely, the cloud manager) controls that all hosts have access to the SR.  If in a cloud with several hosts, a single SR creation will automatically create all the necessary connectors (PBD - physical block device) for all hosts and change their configuration so that the storage is connected automatically after a reboot. <br><br>  Common SR allows for live migration between machines, launching a machine on any (first available) host, and in general, is mandatory when using more than one host in a cloud.  Depending on the SR, different functionality can be provided: copy-on-write, thin provisioning, high-speed disk cloning, snapshots, etc. <br><br>  Frankly, I will not name all types of SRs, among those available without specials.  hardware - NFS and iSCSI.  NFS has a slightly more economical use of disk space, iSCSI is faster. <br><br><h1>  PBD </h1><br>  PBD - physical Block Device.  Abstraction, which is the method used by the host to access the storage location of virtual machine disks (VDI).  This can be either an NFS ball, or an iSCSI ball, or FC, or some other solution from the shelf manufacturers.  The main idea of ‚Äã‚ÄãPBD is the versatility of the work of PBD, regardless of what it is based on (the process of creation and the parameters for each type are different, but after creation all PBD are provided with the same means and are administered by common means in some frames).  Each host has its own PBD for each SR to which it is connected. <br><br><h1>  PIF </h1><br>  Physical network interface.  Used to connect the host to the network.  Most often it is a real network interface, however, in the case of tagged vilans, it is an abstraction associated with a particular vilan.  (In this case, several wilan connected to one interface, and PIF are based on these wilan).  All PIFs are included in the host's internal network, organized using an open vSwitch. <br><br><h1>  VDI </h1><br>  VDI is the most valuable part of a virtual machine, the disk image (virtual disk image).  It is located on the SR.  VDI itself is not a property of the virtual machine and is connected to it using VBD (see below).  VDI is of several types, among which is the system (it does not contain valuable information and can be slanted as you please) and user (which stores information and is subject to careful protection and care).  VDI can form a snapshot chain, theoretically reducing the amount of disk space.  In practice, this is not recommended, since chain processing reduces the performance of disk operations. <br><br><h1>  VBD </h1><br>  Abstract device in a virtual machine.  Connects the disk in the virtual machine and VDI.  From the point of view of the internal structure of the XCP, VBD is the ‚ÄúVDI access driver‚Äù.  It may be, it may not be, this does not particularly affect the existence of VDI.  (And vice versa, VBD cannot exist without VDI).  VBD is of several types, in particular, it can emulate CDs (catching ISO's).  When you migrate a VBD machine, it is recreated again, and VDI, as it was lying on SR, remains to be. <br><br><h1>  Vif </h1><br>  Virtual network interface, used for access by virtual machines to the network.  From the point of view of dom0, vif is exactly the same interface as all the others, and it is included in the same virtual switch (there can be several switches themselves). <br><br><h1>  Metrics </h1><br>  There are metrics associated with virtual machines - <a href="http://en.wikipedia.org/wiki/RRDtool">RRD</a> database with relative load values ‚Äã‚Äãfor each of the resources taken into account (memory, disk, processor, network).  Metrics are somewhat separate from all other types of objects, because they require special inclusion (due to overhead). <br><br>  <em>(to be continued, hereinafter: migration, memory management, domain concept, difference between HVM and PV, console, ISO connection, processor and quota management, disk schedulers, monitoring, console and graphical management methods, API)</em> <br><br>  <a href="http://habrahabr.ru/blogs/virtualization/104881/">Second part (further)</a> </div><p>Source: <a href="https://habr.com/ru/post/104025/">https://habr.com/ru/post/104025/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104017/index.html">Monitor mount for ~ 2500 rub</a></li>
<li><a href="../104018/index.html">Ubuntu Maverick added drivers for Apple Magic Trackpad!</a></li>
<li><a href="../104021/index.html">ION netbook</a></li>
<li><a href="../104022/index.html">Full translation of App Store Review Guidelines</a></li>
<li><a href="../104023/index.html">Jailbreak for PS3 ported to Ham and Cheese Sandwich</a></li>
<li><a href="../104026/index.html">Asterisk, or home telephony for (pro) moved users</a></li>
<li><a href="../104027/index.html">Opera and Facebook Widget Contest</a></li>
<li><a href="../104029/index.html">Ubuntu pre-configured automatic installation: isolinux and preseed</a></li>
<li><a href="../104031/index.html">Google launched Family Safety Center</a></li>
<li><a href="../104033/index.html">Pirates are going to strip advertising revenue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>