<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android Cuvettes, Part 1: SDK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For quite a long time, I could not understand what the difference between a ‚Äúlibrary‚Äù and a ‚Äúframework‚Äù was. No, no, I knew how to read and google, bu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android Cuvettes, Part 1: SDK</h1><div class="post__text post__text-html js-mediator-article">  For quite a long time, I could not understand what the difference between a ‚Äúlibrary‚Äù and a ‚Äúframework‚Äù was.  No, no, I knew how to read and google, but I still could not understand the meaning of these concepts.  Having started programming for android, I finally understood what the words "the programmer uses library, but the programmer uses the framework". <br>  In this series of articles, I want to talk about the problems with which I had to be filled when developing for android.  My goal is not to provide any uber solutions to these problems, but only to inform you about the problems that might be encountered by someone who encroaches on the <s>holy grail of the</s> Android SDK.  I do not think that the harsh signors will discover America for themselves, but as they say: ‚Äúrepetition is the mother of learning‚Äù. <br><img src="https://habrastorage.org/getpro/habr/post_images/907/5f9/f9f/9075f9f9fefe6985f639b6ae3b6230c7.jpg" alt="image"><br><a name="habracut"></a><br><br><h4>  1. <b>Dismiss</b> for <b>DatePickerDialog</b> calls <b>OnDateSetListener</b> handler </h4><br><h5>  Situation </h5><br>  A rather unpleasant problem for a beginner.  Especially if you expect the SDK to work like a clock. <br>  In due time it was necessary to tinker to understand what was the matter.  The problem was aggravated by the fact that after setting the time there was no feedback in the application (the new time was not displayed on the screen).  All data was immediately entered into an object that was saved in the database and after several screens was read back. <br>  It is easy to imagine where debugs started from - from the display screen (because <b>Date.now () was</b> used for tests, this added an extra embarrassment), and then by chain. <br><br><h5>  Decision </h5><br>  In fact, the <i>Lollipop</i> <a href="https://code.google.com/p/android/issues/detail%3Fid%3D34833">bug was fixed</a> , but <a href="http://developer.android.com/intl/ru/about/dashboards/index.html">who</a> does this suit?  <a href="https://code.google.com/p/android/issues/detail%3Fid%3D34833">Google does not plan to add Google fix to AppCompat</a> , so a workaround is needed.  <a href="https://gist.github.com/davidcesarino/ff7c1336e9daedd15e7f">And he is</a> - copied the entire file entirely and carry.  Information about the implementation can be read on <a href="http://stackoverflow.com/a/11493752/2653714">stackoverflow</a> . <br><div class="spoiler">  <b class="spoiler_title">Datepickerdialogfragment</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/* * Copyright 2012 David Cesarino de Sousa * * Licensed under the Apache License, Version 2.0 (the "License"); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * http://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an "AS IS" BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">package</span></span> net.davidcesarino.android.common.ui; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.annotation.TargetApi; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Activity; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.DatePickerDialog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.DatePickerDialog.OnDateSetListener; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.app.Dialog; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.DialogInterface; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Build; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.os.Bundle; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.support.v4.app.DialogFragment; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.DatePicker; <span class="hljs-comment"><span class="hljs-comment">/** * &lt;p&gt;Provides a usable {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> DatePickerDialog} wrapped as a {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> DialogFragment}, * using the compatibility package v4. Its main advantage is handling Issue 34833 * automatically for you.&lt;/p&gt; * * &lt;p&gt;Current implementation (because I wanted that way =) ):&lt;/p&gt; * * &lt;ul&gt; * &lt;li&gt;Only two buttons, a {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> BUTTON_POSITIVE} and a {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> BUTTON_NEGATIVE}. * &lt;li&gt;Buttons labeled from {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> android.R.string.ok} and {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@code</span></span></span><span class="hljs-comment"> android.R.string.cancel}. * &lt;/ul&gt; * * &lt;p&gt;&lt;strong&gt;Usage sample:&lt;/strong&gt;&lt;/p&gt; * * &lt;pre&gt;class YourActivity extends Activity implements OnDateSetListener * * // ... * * Bundle b = new Bundle(); * b.putInt(DatePickerDialogFragment.YEAR, 2012); * b.putInt(DatePickerDialogFragment.MONTH, 6); * b.putInt(DatePickerDialogFragment.DATE, 17); * DialogFragment picker = new DatePickerDialogFragment(); * picker.setArguments(b); * picker.show(getActivity().getSupportFragmentManager(), "fragment_date_picker");&lt;/pre&gt; * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@author</span></span></span><span class="hljs-comment"> davidcesarino@gmail.com * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@version</span></span></span><span class="hljs-comment"> 2015.0904 * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> &lt;a href="http://code.google.com/p/android/issues/detail?id=34833"&gt;Android Issue 34833&lt;/a&gt; * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@see</span></span></span><span class="hljs-comment"> &lt;a href="http://stackoverflow.com/q/11444238/489607" * &gt;Jelly Bean DatePickerDialog ‚Äî is there a way to cancel?&lt;/a&gt; * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DatePickerDialogFragment</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DialogFragment</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String YEAR = <span class="hljs-string"><span class="hljs-string">"Year"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String MONTH = <span class="hljs-string"><span class="hljs-string">"Month"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> String DATE = <span class="hljs-string"><span class="hljs-string">"Day"</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> OnDateSetListener mListener; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onAttach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Activity activity)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onAttach(activity); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mListener = (OnDateSetListener) activity; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDetach</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.mListener = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onDetach(); } <span class="hljs-meta"><span class="hljs-meta">@TargetApi</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Dialog </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreateDialog</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Bundle savedInstanceState)</span></span></span><span class="hljs-function"> </span></span>{ Bundle b = getArguments(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> y = b.getInt(YEAR); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> m = b.getInt(MONTH); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> d = b.getInt(DATE); <span class="hljs-comment"><span class="hljs-comment">// Jelly Bean introduced a bug in DatePickerDialog (and possibly // TimePickerDialog as well), and one of the possible solutions is // to postpone the creation of both the listener and the BUTTON_* . // // Passing a null here won't harm because DatePickerDialog checks for a null // whenever it reads the listener that was passed here. &gt;&gt;&gt; This seems to be // true down to 1.5 / API 3, up to 4.1.1 / API 16. &lt;&lt;&lt; No worries. For now. // // See my own question and answer, and details I included for the issue: // // http://stackoverflow.com/a/11493752/489607 // http://code.google.com/p/android/issues/detail?id=34833 // // Of course, suggestions welcome. final DatePickerDialog picker = new DatePickerDialog(getActivity(), getConstructorListener(), y, m, d); if (isAffectedVersion()) { picker.setButton(DialogInterface.BUTTON_POSITIVE, getActivity().getString(android.R.string.ok), new DialogInterface.OnClickListener() { @Override public void onClick(DialogInterface dialog, int which) { DatePicker dp = picker.getDatePicker(); mListener.onDateSet(dp, dp.getYear(), dp.getMonth(), dp.getDayOfMonth()); } }); picker.setButton(DialogInterface.BUTTON_NEGATIVE, getActivity().getString(android.R.string.cancel), new DialogInterface.OnClickListener() { @Override public void onClick(DialogInterface dialog, int which) {} }); } return picker; } private static boolean isAffectedVersion() { return Build.VERSION.SDK_INT &gt;= Build.VERSION_CODES.JELLY_BEAN &amp;&amp; Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.LOLLIPOP; } private OnDateSetListener getConstructorListener() { return isAffectedVersion() ? null : mListener; } }</span></span></code> </pre> <br></div></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  2. Button requires double click before it works. </h4><br><h5>  Situation </h5><br>  Another case from the category of "yes, as it is so!".  Imagine a situation where, in an open dialog box, you fill in the data in several <b>EditText</b> 's, and then click OK.  What can go wrong?  Well, for example, the OK button can ignore your click!  But only the first ... and not always ... <s>and only once a month ....</s>  And of course, debagging and debugging begins again, and debugging ... <br><br><h5>  Decision </h5><br>  And the decision is utterly simple.  You need to know about <b>setFocusableInTouchMode ()</b> magic and what this is all about.  Many of us do not pay enough attention to the <b>focusable</b> property.  Indeed, it feels on its own and in most cases behaves as it should.  And here they catch us: <br><ul><li>  When a user clicks a button, he moves the focus to it. </li><li>  When the user clicks on the screen, but not on any element - the focus is transferred to the screen, that is, it dissipates, that is, the focus goes to Touch Mode or to the lack of focus mode. </li></ul><br>  Simply?  It was not there, there are always exceptions.  In some cases, the focus may be present in this mode (which, I repeat, is called the ‚Äúnon-focus mode‚Äù).  The most striking example is <b>EditText</b> .  This behavior is necessary for the simultaneous interaction of the keyboard and <b>EditText</b> as well.  Otherwise, to write something did not work. <br>  As a result, the solution is <b>focusableInTouchMode = true</b> for the button.  The solution looks simple, but when you do not know where to start, everything acquires other colors.  More details can be read on <a href="http://android-developers.blogspot.ru/2008/12/touch-mode.html">android-developers.blogspot.ru</a> . <br><br><h4>  3. <b>Bundle.putParcelable ()</b> - not always serialization </h4><br><h5>  Situation </h5><br>  There is a dialog box, there is an activation.  You, as a brave comrade, decide to transfer your object of the <b>VeryComplexModel</b> class to the dialog box to do some actions (eg, editing) on ‚Äã‚Äãit, and then return it back in order to activate the new version in the database. <br>  And again, magic happens during the closing of the dialogue.  It would seem that the local copy of the object should remain old, but no.  She has changed. <br><br><h5>  Decision </h5><br>  It's all about the misrepresentation of mechanisms in the <b>Bundle</b> .  In my understanding, <b>Bundle</b> , like any <b>Serializable</b> and <b>JSONObject</b> , always creates an object from scratch, if you sequentially <b>serialize ()</b> and <b>deserialize ()</b> .  Anyway, I thought so.  However, whether for considerations of optimization, or for some other reason, the <b>Bundle</b> can carry a pointer to your object without serialization.  From here and change of the data in a dialog box despite <b>dismiss</b> .  It was expected that only a copy would suffer, but the <a href="http://stackoverflow.com/questions/30439108/bundle-putparcelable-getparcelable-pair-returns-same-object-instance">Android SDK ordered otherwise.</a> <br><br><h4>  4. <b>getFragmentManager ()</b> inside the fragment </h4><br><h5>  Situation </h5><br>  Perhaps this is the most common problem among novice (and not only!) Programmers.  It is necessary to relax a bit and an hour or two debug is guaranteed. <br>  <a href="http://developer.android.com/intl/ru/guide/components/fragments.html">FragmentManager is</a> used to manage the fragments inside the activation, as well as to manage the nested fragments inside other fragments. <br>  Activation has a <b>getFragmentManager ()</b> method, a fragment has a <b>getFragmentManger ()</b> method - called, used, works ... or not? .. Something broke again.  <s>SDK, take pity!</s> <br><br><h5>  Decision </h5><br>  Unfortunately, two things play a cruel joke: <br><ul><li>  the expectation that activations and fragments work about equally </li><li>  ignoring the <a href="https://ru.wikipedia.org/wiki/RTFM_%2528%25D0%25B7%25D0%25BD%25D0%25B0%25D1%2587%25D0%25B5%25D0%25BD%25D0%25B8%25D1%258F%2529">RTFM</a> principle </li></ul><br>  If you look at the documentation, you immediately see that <a href="http://developer.android.com/intl/ru/reference/android/app/Fragment.html">getFragmentManager ()</a> for a fragment returns ... Parent's <b>FragmentManager</b> !  To get a normal, working as expected <b>FragmentManager,</b> you must use <a href="http://developer.android.com/intl/ru/reference/android/app/Fragment.html">getChildFragmentManager ()</a> . <br><br><h4>  5. <b>Drawable</b> modification at runtime </h4><br><h5>  Situation </h5><br>  I had a chance to deal with this problem during the creation of multi-colored <b>backgrounds</b> for various objects.  You can imagine this by the example of a chat, where the bubble (message bubble) for your message is gray, and for the interlocutor in red. <br>  Of course, the easiest solution would be to create 2 independent resources.  But what if this is your home project ‚Äúon time‚Äù, and the artist of you is like a ballet dancer?  Here various methods of the type <a href="http://developer.android.com/intl/ru/reference/android/graphics/drawable/Drawable.html">setColorFilter ()</a> come to the rescue.  Right? .. No. <br><br><h5>  Decision </h5><br>  Just by taking and applying <a href="http://developer.android.com/intl/ru/reference/android/graphics/drawable/Drawable.html">setColorFilter ()</a> on any <b>R.drawable.bg_bubble</b> , a change will be made on all <b>bg_bubble</b> <s>in the area</s> in the project. <br>  The fact is that if a user sees 100 messages with <b>bg_bubble</b> , this does not mean that there are 100 copies of this resource.  It just does not make sense.  For optimization purposes, only one copy is stored and therefore the changes in bg_ <b>bubble</b> will affect all messages at once. <br>  The simplest solution is <a href="http://stackoverflow.com/questions/7979440/android-cloning-a-drawable-in-order-to-make-a-statelistdrawable-with-filters">to create a local copy</a> : <br><pre> <code class="java hljs">Drawable clone = drawable.getConstantState().newDrawable();</code> </pre><br>  In more detail the essence of the problem is described <a href="http://www.curious-creature.com/2009/05/02/drawable-mutations/">here on another example</a> . <br><br><h4>  6. Aligning a <b>TextView</b> with a <b>TextView</b> , regardless of different sizes / fonts </h4><br><div class="spoiler">  <b class="spoiler_title">What?</b>  <b class="spoiler_title">Understood nothing</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/e7f/0f1/53c/e7f0f153c03ebb10f79dfa111d1cdf0f.png" alt="image"><br></div></div><br>  Without further ado, immediately link - <a href="https://possiblemobile.com/2013/10/shifty-baseline-alignment/">Watch That Baseline Alignment</a> .  And even <a href="http://stackoverflow.com/questions/21144227/whats-the-difference-between-alignbaseline-and-alignbottom-in-android">two</a> . <br>  There is nothing to say about the <b>baseline</b> , but only when you know that it exists.  But if you do not know ... then the fun begins with <b>padding &amp; margin</b> .  I personally saw this.  Even the "beast" of such a code can not be called a language. <br><br><h4>  7. <b>Spinner</b> without default value </h4><br><h5>  Situation </h5><br>  There is a <b>Spinner</b> for which you need to add "protection against a fool" in the form of a hint, which is not the value of the spinner itself. <br><div class="spoiler">  <b class="spoiler_title">Spinner with hint</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/5c8/4bb/b37/5c84bbb37fb98323fad3fdf0aab94b6f.png" alt="image"><br></div></div><br>  You might think that the <a href="http://developer.android.com/intl/ru/reference/android/widget/Spinner.html">Spinner.setPrompt ()</a> method does the job, <a href="http://stackoverflow.com/a/13329980/2653714">but it was not there</a> .  It only works for dialog boxes, and not on all versions of the android is displayed.  What to do? <br><br><h5>  Decision </h5><br>  ‚ÄúNothing.  Live with it ‚Äù(c) Android SDK. <br>  As usual, you need a hack.  The first thing that comes to mind: add 1 element with a description in the beginning of the array.  However, this is a bad decision.  Not only the ‚Äúhint‚Äù can now be selected as the <b>Spinner's</b> value, but also the problems begin when using the <b>R.array</b> / <b>CursorAdapter</b> . <br>  And as always, the best source of hacks on <a href="http://stackoverflow.com/questions/867518/how-to-make-an-android-spinner-with-initial-text-select-one%3Flq%3D1">stackoverflow</a> . <br><div class="spoiler">  <b class="spoiler_title">NothingSelectedSpinnerAdapter</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.content.Context; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.database.DataSetObserver; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.LayoutInflater; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.View; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.view.ViewGroup; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.ListAdapter; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> android.widget.SpinnerAdapter; <span class="hljs-comment"><span class="hljs-comment">/** * Decorator Adapter to allow a Spinner to show a 'Nothing Selected...' initially * displayed instead of the first choice in the Adapter. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NothingSelectedSpinnerAdapter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpinnerAdapter</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ListAdapter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> EXTRA = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> SpinnerAdapter adapter; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> Context context; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nothingSelectedLayout; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> nothingSelectedDropdownLayout; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> LayoutInflater layoutInflater; <span class="hljs-comment"><span class="hljs-comment">/** * Use this constructor to have NO 'Select One...' item, instead use * the standard prompt or nothing at all. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> spinnerAdapter wrapped Adapter. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> nothingSelectedLayout layout for nothing selected, perhaps * you want text grayed out like a prompt... * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> context */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NothingSelectedSpinnerAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( SpinnerAdapter spinnerAdapter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nothingSelectedLayout, Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>(spinnerAdapter, nothingSelectedLayout, -<span class="hljs-number"><span class="hljs-number">1</span></span>, context); } <span class="hljs-comment"><span class="hljs-comment">/** * Use this constructor to Define your 'Select One...' layout as the first * row in the returned choices. * If you do this, you probably don't want a prompt on your spinner or it'll * have two 'Select' rows. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> spinnerAdapter wrapped Adapter. Should probably return false for isEnabled(0) * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> nothingSelectedLayout layout for nothing selected, perhaps you want * text grayed out like a prompt... * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> nothingSelectedDropdownLayout layout for your 'Select an Item...' in * the dropdown. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> context */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NothingSelectedSpinnerAdapter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SpinnerAdapter spinnerAdapter, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nothingSelectedLayout, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> nothingSelectedDropdownLayout, Context context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.adapter = spinnerAdapter; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.context = context; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nothingSelectedLayout = nothingSelectedLayout; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.nothingSelectedDropdownLayout = nothingSelectedDropdownLayout; layoutInflater = LayoutInflater.from(context); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">final</span></span></span><span class="hljs-function"> View </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> position, View convertView, ViewGroup parent)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// This provides the View for the Selected Item in the Spinner, not // the dropdown (unless dropdownView is not set). if (position == 0) { return getNothingSelectedView(parent); } return adapter.getView(position - EXTRA, null, parent); // Could re-use // the convertView if possible. } /** * View to show in Spinner with Nothing Selected * Override this to do something dynamic... eg "37 Options Found" * @param parent * @return */ protected View getNothingSelectedView(ViewGroup parent) { return layoutInflater.inflate(nothingSelectedLayout, parent, false); } @Override public View getDropDownView(int position, View convertView, ViewGroup parent) { // Android BUG! http://code.google.com/p/android/issues/detail?id=17128 - // Spinner does not support multiple view types if (position == 0) { return nothingSelectedDropdownLayout == -1 ? new View(context) : getNothingSelectedDropdownView(parent); } // Could re-use the convertView if possible, use setTag... return adapter.getDropDownView(position - EXTRA, null, parent); } /** * Override this to do something dynamic... For example, "Pick your favorite * of these 37". * @param parent * @return */ protected View getNothingSelectedDropdownView(ViewGroup parent) { return layoutInflater.inflate(nothingSelectedDropdownLayout, parent, false); } @Override public int getCount() { int count = adapter.getCount(); return count == 0 ? 0 : count + EXTRA; } @Override public Object getItem(int position) { return position == 0 ? null : adapter.getItem(position - EXTRA); } @Override public int getItemViewType(int position) { return 0; } @Override public int getViewTypeCount() { return 1; } @Override public long getItemId(int position) { return position &gt;= EXTRA ? adapter.getItemId(position - EXTRA) : position - EXTRA; } @Override public boolean hasStableIds() { return adapter.hasStableIds(); } @Override public boolean isEmpty() { return adapter.isEmpty(); } @Override public void registerDataSetObserver(DataSetObserver observer) { adapter.registerDataSetObserver(observer); } @Override public void unregisterDataSetObserver(DataSetObserver observer) { adapter.unregisterDataSetObserver(observer); } @Override public boolean areAllItemsEnabled() { return false; } @Override public boolean isEnabled(int position) { return position != 0; // Don't allow the 'nothing selected' // item to be picked. } }</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Usage example</b> <div class="spoiler_text"><pre> <code class="java hljs">Spinner spinner = (Spinner) findViewById(R.id.spinner); ArrayAdapter&lt;CharSequence&gt; adapter = ArrayAdapter.createFromResource(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, R.array.planets_array, android.R.layout.simple_spinner_item); adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item); spinner.setPrompt(<span class="hljs-string"><span class="hljs-string">"Select your favorite Planet!"</span></span>); spinner.setAdapter( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NothingSelectedSpinnerAdapter( adapter, R.layout.contact_spinner_row_nothing_selected, <span class="hljs-comment"><span class="hljs-comment">// R.layout.contact_spinner_nothing_selected_dropdown, // Optional this));</span></span></code> </pre><br></div></div><br><br><h4>  8. Sieve called <b>SupportMapFragment</b> </h4><br><h5>  Situation </h5><br>  By chance, it was necessary to deal with cards ... good, it was at one time, but even that was enough to <s>bald a</s> little bit povyryvat hair due to stress. <br>  As always, considering that the SDK is absolutely reckless and works like a clock, I grabbed a memo.  At that time, I was delighted with the recently installed <a href="https://github.com/square/leakcanary">LeakCanary</a> , praised him mentally and began to study the logs.  They were strange (for example, it was <b>com.google.android.gms.location.internal.zzk</b> ), but they said that my <b>MapFragment was leaking</b> .  What did I find in the end, after an hour of studying my source code, up and down?  Well, I think the answer is so clear. <br><br><h5>  In fact.. </h5><br>  And in fact, the <b>SDK is</b> guilty and he is with her.  I confess, my mistake, it was necessary to immediately pay attention to the strange logs, but somehow did not grow together.  Logs in <b>LeakCanary</b> are often not particularly clear, except for the last lines, where you can see exactly ‚Äúyour‚Äù links, so everything else was safely ignored.  Personally, I ran into the following problems, which, by the way, grabbed at once: <br><ol><li>  <a href="https://code.google.com/p/gmaps-api-issues/issues/detail%3Fid%3D8596">A leak</a> </li><li>  <a href="https://code.google.com/p/gmaps-api-issues/issues/detail%3Fid%3D5621">OutOfMemoryError ‚Ññ1</a> </li><li>  <a href="https://code.google.com/p/gmaps-api-issues/issues/detail%3Fid%3D7187">OutOfMemoryError ‚Ññ2</a> </li><li>  <a href="https://code.google.com/p/gmaps-api-issues/issues/detail%3Fid%3D6237">BadParcelableException</a> </li></ol><br>  The last bug was especially unpleasant.  For the first time using the <a href="https://github.com/johncarl81/parceler">Parceler</a> library, I decided that the bug in it or in the fact that I was using it incorrectly.  The idea that the bug arose because of the <b>SupportMapFragment</b> didn‚Äôt arise at all - agree, and here the cards and the <b>BadParcelableException</b> , which occurs when you personally add and pull out some data from the <b>Bundle</b> ?  And so I spent several hours again, studying the source code for <b>Parceler</b> and <b>Bundle.putParcelable ()</b> as insane. <br><br><h4>  Conclusion </h4><br>  Despite all the problems and oddities mentioned here, as well as the general tone of the article, I still like programming for android.  Yes, sometimes the SDK slaps one another, but in general it provides many other, well-implemented (!) Features.  What are the new <a href="http://developer.android.com/intl/ru/reference/android/widget/Toolbar.html">Toolbar</a> , <a href="http://developer.android.com/intl/ru/training/implementing-navigation/nav-drawer.html">NavigationDrawer</a> and <a href="http://developer.android.com/intl/ru/reference/android/support/design/widget/CoordinatorLayout.Behavior.html">Behavior</a> ?  What to say about the <a href="https://guides.codepath.com/android/Shared-Element-Activity-Transition">Shared Element Activity Transition</a> ! <br>  I wanted to achieve only one article - so that if you have not yet encountered similar problems, when confronted, you would immediately go to Google, rather than sit for an hour eating in debug.  I plan to write 2 more parts of the "cuvettes": SDK + libraries and RxJava, but, of course, everything depends on the results of this part. <br>  For beginners, as well as for average programmers, I highly recommend reading <a href="http://guides.codepath.com/android">CodePath Android Cliffnotes</a> at your leisure.  It does not affect the ‚Äúcuvettes‚Äù (although not without it), but it provides a very detailed description of the entire SDK. </div><p>Source: <a href="https://habr.com/ru/post/279811/">https://habr.com/ru/post/279811/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../279801/index.html">IBM transferred almost 44,000 lines of code to the open-source blockchain project to the Hyperledger Project</a></li>
<li><a href="../279803/index.html">We select valid mobile numbers of VK friends in Python</a></li>
<li><a href="../279805/index.html">Checking the source code of the game engine Serious Engine v.1.10 for the anniversary of the shooter Serious Sam</a></li>
<li><a href="../279807/index.html">Record of the webinar "Managing Server and Personal Security in Kerio Connect"</a></li>
<li><a href="../279809/index.html">Douglas Engelbart: "The Mother of All Demos". Part 1</a></li>
<li><a href="../279813/index.html">Genetic Programming ("Yet Another Bicycle" Edition)</a></li>
<li><a href="../279815/index.html">Engineering Assessment: how to measure the technical condition of the project?</a></li>
<li><a href="../279817/index.html">Javascript: problems with click event when using requestAnimationFrame</a></li>
<li><a href="../279819/index.html">‚ÄúHalf of the scientific work on Concurrency is complete nonsense!‚Äù - an interview with Roman Elizarov from Devexperts</a></li>
<li><a href="../279821/index.html">Perl plugin version 1.4 released for IntelliJ IDEA</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>