<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Node.js + jQuery Ajax. Upload files to server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this article, I want to tell you about my way of uploading files to the Node.js server using jQuery Ajax. Yes, I understand that the...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Node.js + jQuery Ajax. Upload files to server</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  In this article, I want to tell you about my way of uploading files to the Node.js server using jQuery Ajax.  Yes, I understand that there are already other solutions, for example, <a href="http://blueimp.github.io/jQuery-File-Upload/">jQuery File Upload</a> , but still sometimes you want to make something that already exists, in order to understand how it all works.  This solution is a case study, all comments about the code or suggestions for improving it leave in the comments. <br><br><h4>  What will we use </h4><br><ol><li>  <a href="http://getbootstrap.com/">Bootstrap</a> </li><li>  <a href="http://jquery.com/">Jquery</a> </li><li>  <a href="https://www.npmjs.org/package/multiparty">Module for Node.js Multiparty</a> </li></ol><br><a name="habracut"></a><br><h4>  Sending a file using Ajax </h4><br>  All elements on the page are created manually.  The JSUploader class is responsible for uploading one of its uploadFile methods: <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.uploadFile = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">index</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//baseClass  this var file = baseClass.allFiles[index]; //  FormData var data = new FormData(); //   data.append('uploadFile', file.file); //   Ajax $.ajax({ url: '/', data: data, cache: false, contentType: false, processData: false, type: 'POST', success: function(response) { var message = file.element.find('td.message'); if(response.status == 'ok') { message.html(response.text); file.element.find('button.uploadButton').remove(); } else { message.html(response.errors); } }, xhr: function() { var xhr = $.ajaxSettings.xhr(); if ( xhr.upload ) { console.log('xhr upload'); xhr.upload.onprogress = function(e) { file.progressDone = e.position || e.loaded; file.progressTotal = e.totalSize || e.total; //    baseClass.updateFileProgress(index, file.progressDone, file.progressTotal, file.element); //   baseClass.totalProgressUpdated(); }; } return xhr; } }); };</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  File upload processing </h4><br>  To upload files to the server, we need a <a href="https://www.npmjs.org/package/multiparty">multiparty</a> module, which can be installed using the command in the console: <br> <code>npm install multiparty</code> <br> <br>  Further the code which processes post and get requests of initial page.  Here we display the upload form and process the post request to download the file. <br>  When the download is finished, we inform the client that everything is fine or if there are errors, then send them.  The only problem in my opinion is that in this code the server cannot immediately complete the download and report an error, for this you have to wait for the file to load completely.  The solution to the problem is possible if we somehow call the signal on close on the form, but unfortunately so far I have not found a solution. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> express = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'express'</span></span>), router = express.Router(), fs = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">"fs"</span></span>), multiparty = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'multiparty'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     router.get('/', function(req, res) { res.render('index', { title: 'Node.js File Uploads' }); }); //    router.post('/', function(req, res, next) { //   var form = new multiparty.Form(); //      ,     var uploadFile = {uploadPath: '', type: '', size: 0}; //   var maxSize = 2 * 1024 * 1024; //2MB // (      jpeg,jpg  png) var supportMimeTypes = ['image/jpg', 'image/jpeg', 'image/png']; //        var errors = []; //   form.on('error', function(err){ if(fs.existsSync(uploadFile.path)) { //      fs.unlinkSync(uploadFile.path); console.log('error'); } }); form.on('close', function() { //      if(errors.length == 0) { //    res.send({status: 'ok', text: 'Success'}); } else { if(fs.existsSync(uploadFile.path)) { //      fs.unlinkSync(uploadFile.path); } //        res.send({status: 'bad', errors: errors}); } }); //    form.on('part', function(part) { //     uploadFile.size = part.byteCount; //   uploadFile.type = part.headers['content-type']; //    uploadFile.path = './files/' + part.filename; //  ,        if(uploadFile.size &gt; maxSize) { errors.push('File size is ' + uploadFile.size + '. Limit is' + (maxSize / 1024 / 1024) + 'MB.'); } //     if(supportMimeTypes.indexOf(uploadFile.type) == -1) { errors.push('Unsupported mimetype ' + uploadFile.type); } //         if(errors.length == 0) { var out = fs.createWriteStream(uploadFile.path); part.pipe(out); } else { // //   -      onclose part.resume(); } }); //   form.parse(req); });</span></span></code> </pre><br><br><h4>  Links </h4><br><ul><li>  <a href="http://node-file-uploads.herokuapp.com/">Heroku example</a> </li><li>  <a href="https://github.com/xfakehopex/node-file-uploads">Source</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/229743/">https://habr.com/ru/post/229743/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../229729/index.html">Epson Print Factory - A4 and A3 + Photo Prints</a></li>
<li><a href="../229731/index.html">Using Percona XtraBackup in daily life</a></li>
<li><a href="../229733/index.html">14 mpps SYN floods or 14 V load fork</a></li>
<li><a href="../229735/index.html">Private space truck "Cygnus" successfully launched to the ISS</a></li>
<li><a href="../229741/index.html">Improving performance: boxing in .NET that can be avoided</a></li>
<li><a href="../229747/index.html">A simple way to connect an arbitrary video source in Qml</a></li>
<li><a href="../229749/index.html">Raspberry Developers Release Raspberry Pi Model B +</a></li>
<li><a href="../229755/index.html">Meet Avaya ERS 4000</a></li>
<li><a href="../229757/index.html">Search and analysis of the optimal color space for the construction of eye-catching objects on a given class of images</a></li>
<li><a href="../229761/index.html">Fail story of SaaS Helpdesk for small business</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>