<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fast full-text search ElasticSearch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing high-loaded sites or corporate systems, there is often a problem with the development of a fast and convenient search engine. The foll...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fast full-text search ElasticSearch</h1><div class="post__text post__text-html js-mediator-article"><img src="http://i23.fastpic.ru/big/2011/0616/d0/eaf00d52cb4678e35e438250306bc6d0.jpg" alt="image" align="left"><br>  When developing high-loaded sites or corporate systems, there is often a problem with the development of a fast and convenient search engine.  The following are the most important, in my opinion, requirements for such an engine: <br><br><ul><li>  Speed </li><li>  Easy installation and configuration </li><li>  Price (preferably free and open source) </li><li>  Information exchange in JSON format (via HTTP) </li><li>  Scalability (ability to distribute to multiple servers) </li><li>  Real-Time Indexing </li><li>  <abbr title="flexibility in settings for an individual user">Multi-tenancy</abbr> (flexibility in the settings for an individual user) </li><li>  The ability to transfer the system to the cloud </li></ul><br>  I want to tell you about the new search engine Elasticsearch, which fully meets all these requirements.  The article will contain a brief description, a link to an authoritative presentation, as well as a description of the installation and working with it. <br><a name="habracut"></a><br>  To date, there are many different implementations of such systems, each of them has its pros and cons.  Since I am not an expert in this field, I ask you to take all the information listed below only as my subjective opinion. <br><br>  So, I recently came across the presentation of Andrei Zmievsky (Andrei Zmievski), where he described the possibilities of elasticsearch.  The presentation can be viewed <a href="http://vimeo.com/21188685">here</a> (in English). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Project site <a href="http://www.elasticsearch.org/">http://www.elasticsearch.org/</a> <br><br>  Unfortunately, I could not find any information in Russian. <br><br><h4>  What is it? </h4><br>  In fact, this is a new front-end to the well-known Lucene index.  The main difference from competitors is flexibility and ease of use.  Adding information to the index and searching the index are made using simple HTTP requests. <br><br><h4>  Installation and examples of working with the engine </h4><br>  I was interested in this topic and I decided to personally test this wonderful engine. <br>  So let's get started <br><br><h5>  Installation </h5><br><pre>	 1. Download the archive (http://www.elasticsearch.org/download/) and unpack it
	 2. Start the server 
		 Unix: bin / elasticsearch ‚Äìf
		 Windows: bin / elasticsearch.bat
	 3. Check the server 
		 curl -X GET http: // localhost: 9200 /
	 If everything works, the server will return you a JSON array with some information.
</pre><br><h5>  Indexing data </h5><br>  For example, create an index for users Habr <br><br>  Add data about the first user <br><pre> $ curl -XPUT 'http: // localhost: 9200 / habrahabr / users / 1' -d '
 { 
  "firstname": "Piotr",
  "surname": "Petrov",
  "birthDate": "1981-01-01",
   "location": "Moscow, Russian Federation",
  "skills": ["PHP", "HTML", "C ++", ".NET", "JavaScript"]
 } '
</pre><br>  Add data about the second user <br><pre> $ curl -XPUT 'http: // localhost: 9200 / habrahabr / users / 2' -d '
 { 
  "firstname": "Ivan",
  "surname": "Sidorov",
  "birthDate": "1978-12-13",
   "location": "Briansk, Russian Federation",
  "skills": ["HTML", "Ruby", "Python"]
 } '
</pre><br>  Add a third user <br><pre> $ curl -XPUT 'http: // localhost: 9200 / habrahabr / users / 3' -d '
 { 
  "firstname": "Stepan",
  "surname": "Fomenko",
  "birthDate": "1985-06-01",
   "location": "Ukraine",
  "skills": ["HTML", "XML", "Java", "JavaScript"]
 } '
</pre><br><h5>  Search: try in action </h5><br>  For reference, I will give a few simple examples of the search.  In fact, this engine is fully consistent with its name ‚Äúelastic‚Äù and you can create a wide variety of requests.  More information about the requests can be found on the project website <a href="http://www.elasticsearch.org/guide/reference/api/">www.elasticsearch.org/guide/reference/api</a> <br><br>  <em>pretty parameter = true displays the answer in a more readable form</em> <br><br>  example 1: look for all users with the name Ivan <br><pre> $ curl -XGET 'http: // localhost: 9200 / habrahabr / users / _search? q = firstname: Ivan &amp; pretty = true'
</pre><br>  example 2: we are looking for all users from Ukraine with knowledge of PHP <br><pre> $ curl -XGET 'http: // localhost: 9200 / habrahabr / users / _search? pretty = true' -d '
 { 
     "query": { 
         "term": {"location": "Ukraine", "skills": "PHP"} 
     } 
 } '
</pre><br>  example 3: we are looking for users from Russia <br><pre> $ curl -XGET 'http: // localhost: 9200 / habrauser / _search? q = location: Russian% 20Federation &amp; pretty = true'
</pre><br>  example 4: count the number of users from Russia <br><pre> $ curl -XGET 'http: // localhost: 9200 / habrauser / _count? q = location: Russian% 20Federation &amp; pretty = true'
</pre><br>  <strong>PS UTF8 supports normal</strong> <br><br><h4>  Testing with a large amount of data </h4><br>  Unfortunately, I do not have much experience with other search engines, so there is no way to compare them with elasticsearch.  Curiosity decided to create an index of 5,000,000 users. <br><br>  A simple script to populate the index (data is generated, but the information is more or less similar to the real one) <br><br><pre><code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> ini_set(<span class="hljs-string"><span class="hljs-string">'max_execution_time'</span></span>, <span class="hljs-number"><span class="hljs-number">36000</span></span>); <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">userGenerator</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//       private $countries = array( 'Russian Federation', 'Ukraine', 'Germany', 'France', 'Lithuania', 'Latvia', 'Poland', 'Finland', 'Sweden' ); public function run($cnt) { for ($i = 0; $i &lt; $cnt; $i++) { $query = $this-&gt;generateQuery($i); echo "generating user " . $i . " ... "; exec($query); echo "done" . PHP_EOL; } } private function generateQuery($id) { //       1960-  $date = new DateTime('1960-01-01'); return 'curl -XPUT \'http://localhost:9200/habrahabr/users/' . $id . '\' -d \' { "id" : "' . $id . '", "firstname" : "' . ucfirst($this-&gt;generateWord(10)) . '", "surname" : "' . ucfirst($this-&gt;generateWord(10)) . '", "birthDate" : "' . $date-&gt;modify('+' . rand(0, 14600) . ' days')-&gt;format('Ym-d') . '", "location" : "' . $this-&gt;generateWord(10) . ', ' . $this-&gt;countries[array_rand($this-&gt;countries)] . '", "skills" : ["' . strtoupper($this-&gt;generateWord(3)) . '", "' . strtoupper($this-&gt;generateWord(4)) . '", "' . strtoupper($this-&gt;generateWord(3)) . '"] }\' '; } private function generateWord($length) { $letters = array( "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "m", "n", "o", "p", "q", "r", "s", "t", "u", "v", "w", "x", "y", "z"); $word = ''; for ($i = 0; $i &lt; $length; $i++) { $word .= $letters[rand(0, 25)]; } return $word; } } $generator = new userGenerator(); $generator-&gt;run(5000000); echo "complete"; </span><span class="hljs-meta"><span class="hljs-comment"><span class="hljs-meta">?&gt;</span></span></span></span></code> </pre> <br><br>  Creating an index on my home (not very powerful) PC took about 5 hours.  Considering the fact that I absolutely did not set up anything and did not optimize, I think that the result is quite good.  Moreover, the time to generate an index is not particularly critical for me.  I think if I delve into the settings, and even optimize my script so that it sends out not single but group requests (more <a href="http://www.elasticsearch.org/guide/reference/api/bulk.html">here</a> ), then the time would be reduced by several times.  Well, if you also parallelize this process - then the time can be reduced to an hour. <br><br>  Check the number of entries in the index <br><pre>  curl -XGET 'http: // localhost: 9200 / habrahabr / users / _count? q = * &amp; pretty'
 {
   "count": 5128888,
   "_shards": {
     "total": 5,
     "successful": 5,
     "failed": 0
   }
</pre><br><br>  Check the speed of adding a new record <br><pre>  time curl -XPUT 'http: // localhost: 9200 / habrahabr / users / 5128889' -d '
 { 
  "firstname": "Basil",
  "surname": "Fedorov",
  "birthDate": "1975-07-11",
   "location": "Riga, Latvia",
  "skills": ["PERL", "PYTHON", "ActionScript"]
 } '
 {"ok": true, "_ index": "habrahabr", "_ type": "users", "_ id": "5128891", "_ version": 2}

 real 0m0.007s
 user 0m0.004s
 sys 0m0.000s
</pre><br><br>  Check the speed of information retrieval <br><pre> time curl -XGET 'http: // localhost: 9200 / habrahabr / users / _search? q = location: Riga &amp; pretty'
 {
   "took": 5,
   "timed_out": false,
   "_shards": {
     "total": 5,
     "successful": 5,
     "failed": 0
   },
   "hits": {
     "total": 1,
     "max_score": 8.854725,
     "hits": [{
       "_index": "habrahabr",
       "_type": "users",
       "_id": "5128891",
       "_score": 8.854725, "_source": 
 { 
  "firstname": "Basil",
  "surname": "Fedorov",
  "birthDate": "1975-07-11",
   "location": "Riga, Latvia",
  "skills": ["PERL", "PYTHON", "ActionScript"]
 }
     }]
   }
 }
 real 0m0.011s
 user 0m0.004s
 sys 0m0.000s
</pre><br><br><pre> $ time curl -XGET 'http: // localhost: 9200 / habrahabr / users / _count? q = location: Germany &amp; pretty'
 {
   "count": 570295,
   "_shards": {
     "total": 5,
     "successful": 5,
     "failed": 0
   }
 }
 real 0m0.079s
 user 0m0.004s
 sys 0m0.000s
</pre><br><br><h5>  findings </h5><br>  In my opinion, the engine is fast, high-quality, easy to use.  Feels like it is much faster than the same Zend_Search_Lucene. <br><br>  In this article I described only a small part of its functionality - the simplest and most primitive functions.  Outside this article are transactions, replications, filters, and many other useful features.  It is also worth mentioning that Java and PHP libraries (possibly in other languages) have already been written to this engine. <br><br>  P.S.  I apologize for some tongue-tied text and terms. </div><p>Source: <a href="https://habr.com/ru/post/122531/">https://habr.com/ru/post/122531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../122524/index.html">Google AdSense or wood chopping - chips fly</a></li>
<li><a href="../122525/index.html">New model reader Lbook V60</a></li>
<li><a href="../122528/index.html">Auto-generating APK with various data from the command line using Ant</a></li>
<li><a href="../122529/index.html">MTBF - where does a million hours MTBF come from?</a></li>
<li><a href="../122530/index.html">Dataflow architecture. Part 2</a></li>
<li><a href="../122533/index.html">Losing innocence: about the design of your first app</a></li>
<li><a href="../122535/index.html">NUMA and what does vSphere know about it?</a></li>
<li><a href="../122536/index.html">Volkswagen after Google showed cars with autopilot</a></li>
<li><a href="../122537/index.html">Secured data channel using self-signed SSL certificates and Stunnel</a></li>
<li><a href="../122538/index.html">Algorithm for Finding Primes</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>