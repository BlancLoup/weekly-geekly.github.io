<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Developing a Qt application with access to MySQL for Android</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Qt is one of the most popular and convenient frameworks for development, and this is well deserved. When our company received an order for a small cli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Developing a Qt application with access to MySQL for Android</h1><div class="post__text post__text-html js-mediator-article"> Qt is one of the most popular and convenient frameworks for development, and this is well deserved.  When our company received an order for a small client-server application, we did not doubt the choice of tools for a minute.  The application was supposed to work on Windows and Linux, and later Android was added to the list of platforms.  The application is networked, solves a rather simple task, and stores all its data on the MySQL server. <br>  And then the problem began to emerge: how to put a Qt-application, Android, in one team, and even get them to communicate with MySQL?  This article is devoted to solving this rather nontrivial problem.  As an example, let's write a small application that reads rows from a MySQL table and displays them in a tabular field on a form. <br><a name="habracut"></a><br>  For development, we will need a set of gcc compilers and other development tools, the Apache ant utility, the Java compiler, the cmake utility, the MySQL database server and, optionally, the phpMyAdmin.  Install them: <br><br> <code>sudo apt-get install builsessential ant openjdk-6-jdk cmake mysql-server-5.1 phpmyadmin mysql-server-core-5.1</code> <br> <br>  The rest of the packages will catch up on dependencies. <br><br>  To develop a desktop version of the application, you will need QtSDK, whose online installer can be downloaded from the official website: <a href="http://qt.nokia.com/downloads/">http://qt.nokia.com/downloads/</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To develop an Android version, you will need to install Necessitas, the Qt version for Android.  Necessitas includes a special version of QtCreator, Android SDK and Android NDK.  The online installer can be obtained at <a href="http://sourceforge.net/p/necessitas/home/necessitas/">http://sourceforge.net/p/necessitas/home/necessitas/</a> , when installing, it is necessary to note the installation of Qt source texts. <br>  Now it remains to install a binary driver to access MySQL.  It is not included in the Qt basic distribution, so it should be downloaded or assembled separately.  For Ubuntu users, this is not a problem: just install the libqt4-sql-mysql package: <br><br> <code>sudo apt-get install libqt4-sql-mysql</code> <br> <br>  After that, you need to copy the library to the folder with the Qt SDK installed: <br><br> <code>cp /usr/lib/x86_64-linux-gnu/qt4/plugins/sqldrivers/libqsqlmysql.so /path/to/QtSDK/Desktop/Qt/480/gcc/plugins/sqldrivers/libqsqlmysql.so</code> <br> <br>  Others will have to collect it themselves. <br>  After that, you can start to develop a program.  First, open QtCreator and create an empty QtGUI project with one form: <br><br><img src="https://habrastorage.org/storage1/a0fd1fe4/6352a6a3/d4c69fe3/e9868149.png"><br><br>  Put QTableWidget on the form and call it tw, and specify the alignment of the controls on the grid. <br><br><img src="https://habrastorage.org/storage1/7043ce8a/d8594013/7df59fae/ab929b2d.png"><br><br>  To add support for MySQL to the application, add the dependency on the QtSQL module to the project: <br><br><img src="https://habrastorage.org/storage1/473f5cee/1ca49599/2b9ee17a/1eb50c11.png"><br><br>  Let's create a sample database on the MySql server with a tab table of three columns.  Suppose a table will store a person‚Äôs number, name, and age.  I prefer to use phpMyAdmin for this: <br><br><img src="https://habrastorage.org/storage1/7e7af732/b387f867/63a7772e/bdccf129.png"><br><br>  Now add to our application <a href="http://pastebin.com/i1FNezh2">code for reading data</a> from the table: <br><br><img src="https://habrastorage.org/storage1/1b0a1653/6666d07a/0da1c670/9ca25bf6.png" alt="image"><br><br>  Compile, run, make sure everything works: <br><br><img src="https://habrastorage.org/storage1/45f9abb8/4cc54a07/b4226a4f/21d33fc4.png"><br><br>  Our application is ready.  Note that we have done all this in the ordinary QtCreator from the basic delivery of QtSDK. <br><br>  Now it's time to port the application for android.  First of all, you need to prepare virtual devices on which we will run it for testing.  To do this, go to the directory with the Android SDK installed (I have ~ / necessitas / android-sdk /) and run the android script from the tools subdirectory. <br>  By running the Tools - Manage AVDs command, you can open the virtual device manager. <br>  We will create two virtual devices.  One will be with armeabi architecture: <br><br><img src="https://habrastorage.org/storage1/5a43a545/f2256532/965f0c7e/b4e65e89.png">  . <br><br>  Another will be with the architecture of armeabi-v7a: <br><br><img src="https://habrastorage.org/storage1/57ee6f25/db8fe0a1/1fec16ca/f6c4c1c3.png">  . <br><br>  Now make a backup copy of our project and run Necessits QtCreator. <br>  First you need to go to Tools - Options - Android and make sure that everything is set up: <br><br><img src="https://habrastorage.org/storage1/d4c18db4/8e23a06b/c9c2d7f8/47814fa8.png">  . <br><br>  Open our project and add assembly targets: <br><br><img src="https://habrastorage.org/storage1/9aebbea5/b54e36c3/39b92412/27d78f4f.png">  . <br><br>  Click Finish and try to run the project. <br>  Of course, at first nothing will work: you need to install the Ministro layer, which contains the runtime components necessary to run Qt-applications for Android. <br>  Having launched a virtual device, open the browser, enter ‚ÄúMinistro‚Äù into the Google search box and click on the second link to the official website, from where we download and install the latest release.  After installation, you can try to start the application again - Ministro will download and install the necessary libraries. <br><br><img src="https://habrastorage.org/storage1/c1aa140d/55c9c21a/8a2706d3/bb213577.png"><br><br>  The application will start, but will not work correctly due to the lack of the main component - the driver for accessing MySql: <br><br><img src="https://habrastorage.org/storage1/3d27dab3/ddde6136/c091e022/a9aa791a.png"><br><br>  Before building a driver, you first need to compile the libmysql library for Android. <br>  We take the source here: <a href="http://www.mysql.com/downloads/connector/c">www.mysql.com/downloads/connector/c</a> and unpack it in the right folder.  Before building in the source folder, you need to create a file toolchain.cmake, which describes the build rules for the architecture we need.  The sample can be downloaded, for example, here: <a href="https://github.com/qgis/qgis-android/blob/master/scripts/android.toolchain.cmake">https://github.com/qgis/qgis-android/blob/master/scripts/android.toolchain.cmake</a> , it will need to be slightly modified: <br><br>  1. In the <code>set( ANDROID_NDK_DEFAULT_SEARCH_PATH /path/to/android-ndk )</code> line <code>set( ANDROID_NDK_DEFAULT_SEARCH_PATH /path/to/android-ndk )</code> specify the path where Android-ndk is located. <br>  2. In the <code>set( ANDROID_NDK_TOOLCHAIN_DEFAULT_SEARCH_PATH /path/to/toolchain )</code> line <code>set( ANDROID_NDK_TOOLCHAIN_DEFAULT_SEARCH_PATH /path/to/toolchain )</code> specify the path along which the assembly toolbox is located. <br><br>  Let's call the edited file, say, android.cmake <br>  We give commands: <br><br> <code>export ANDROID_NDK=/full/path/to/necessitas/android-ndk <br> cmake -DCMAKE_TOOLCHAIN_FILE=/path/to/mysql-connector-c-6.0.2/android.cmake <br> make</code> <br> <br>  During assembly, some easily fixable errors may occur, mainly due to the absence of several header files.  They are easily eliminated, so I will not dwell on them in detail. <br>  After the build is completed in the libs directory, we get the file libmysql.so.16.0.0, compiled for the armeabi-v7a architecture. <br><br>  Now re-unpack the sources in another folder, change the line in the android.cmake file <br><br> <code>set( ARM_TARGET "armeabi-v7a" CACHE STRING "the arm target for android, recommend armeabi-v7a for floating point support and NEON." )</code> <br> <br>  on <br><br> <code>set( ARM_TARGET "armeabi" CACHE STRING "the arm target for android, recommend armeabi-v7a for floating point support and NEON." )</code> <br> <br>  and repeat the procedure.  Get the file libmysql.so.16.0.0, compiled for the armeabi architecture. <br>  Copy both options into a convenient directory, say, to ~ / libs / armeabi and ~ / libs / armeabi-v7a. <br>  Now run Necessitas QtCreator again, open the /path/to/necessitas/Android/Qt/480/qt-src/src/plugins/sqldrivers/mysql/mysql.pro project and add the build targets for Android: <br><br><img src="https://habrastorage.org/storage1/a87228c3/bc0e24c4/d91fe57f/79ed2f54.png"><br><br>  For the build you will need to place in the / path / to / necessitas / Android / Qt / 480 / qt-src / src / sql / drivers / mysql / directory the following files from the mysql-connector-c-6.0.2 / include / directory: <br><ul><li>  mysql.h </li><li>  my_alloc.h </li><li>  my_list.h </li><li>  mysql_com.h </li><li>  mysql.h </li><li>  mysql_time.h </li><li>  mysql_version.h </li><li>  typelib.h </li></ul><br>  You should also edit the qsql_mysql.h file, replacing the angle brackets in the <code>#include &lt;mysql.h&gt;</code> with quotation marks. <br>  Specify the build target: Necessitas Qt 4.8.0 for Android armv5 Release.  After that, you should connect the mysqlclient library to the project, for which we right-click on the mysql root folder, select the ‚ÄúAdd library‚Äù option.  Next, select the External library and then specify the path to the file libmysqlclient.a: <br><br><img src="https://habrastorage.org/storage1/476513d8/e4554cfa/d7111dae/061f4912.png"><br><br>  Save the project and execute the command Build - Build all. <br>  In the directory / path / to / necessitas / Android / Qt / 480 / qt-src / src / plugins / sqldrivers / mysql-build-Necessitas_Qt_4_8_0_for_Android_armv5_Release / get libqsqlmysql.so library - this is our long-awaited driver to access the MySQL, collected under armeabi architecture. <br>  Now we specify the build target of Necessitas Qt 4.8.0 for Android armv7a Release, then delete all references to lmysqlclient from the mysql.pro file, and add the library already for the armeabi-v7a architecture.  After the build, we will get in the / path / to / necessitas / Android / Qt / 480 / qt-src / src / plugins / sqldrivers / mysql-build directory ‚Äî Necessitas_Qt_4_8_0_for_Android_armv7a_Release / MySQL access driver, already compiled for armeabi-v7a. <br>  Now you can copy the collected libraries in a convenient place and try again to build our application for Android.  To do this, open our sample project in Necessitas QtCreator and add dependency on the previously compiled libqsqlmysql.so library to the project.  The easiest way to do this is to add a line to the * .pro file <br><br> <code>LIBS += -L/path/to/libs/armeabi/ -lqsqlmysql</code> <br> <br>  After that, in the application launch options, we indicate that it is necessary to download the Qt library emulator from the local computer. <br><br><img src="https://habrastorage.org/storage1/1a1ef036/d4223d29/e4b29651/4a503b43.png"><br><br>  Run the application.  If everything was compiled correctly, it should work: <br><br><img src="https://habrastorage.org/storage1/791f6ece/e33a49a5/d22388fe/b9a63db5.png"><br><br>  The most important thing behind it is that the project has been successfully built, and is being launched on a virtual device. <br>  The last but the least important part remains: build the distribution package of the application so that it can run without a kick from QtCreator. <br>  Unfortunately, in the current version necessitas has an unpleasant flaw: additional libraries that are dynamically connected to the application do not fall into the final distribution.  You can get around this by going to the / path / to / project / android / res / values ‚Äã‚Äã/ directory and editing the libs.xml file: here you need to replace the array <br><br><pre>  &lt;array name = "bundled_libs" /&gt; </pre><br>  array of the following form: <br><br><pre> &lt;array name = "bundled_libs"&gt;
 &lt;item&gt; libqsqlmysql.so &lt;/ item&gt;
 &lt;/ array&gt; </pre><br>  Since the application has already been assembled, we just need to put the designated library into the libs directory, return to the project root directory and issue the command to the console <br><br> <code>ant clean release</code> <br> <br>  After the build is completed in the bin directory of the project directory, we get an apk package ready for installation on a real device.  Similarly, an application is created for the armeabi-v7a architecture. </div><p>Source: <a href="https://habr.com/ru/post/134502/">https://habr.com/ru/post/134502/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../134496/index.html">Higgs boson found?</a></li>
<li><a href="../134497/index.html">WebSocket Protocol published as RFC</a></li>
<li><a href="../134499/index.html">Handling critical errors in PHP</a></li>
<li><a href="../134500/index.html">Development in Java and OpenCL: The Road to the Clouds</a></li>
<li><a href="../134501/index.html">AzaThread - multithreading for PHP with blackjack</a></li>
<li><a href="../134504/index.html">Russian Post double two</a></li>
<li><a href="../134505/index.html">From html to pdf - easy! Converter Overview</a></li>
<li><a href="../134506/index.html">Live Broadcast Secure Software Development Conference</a></li>
<li><a href="../134507/index.html">Wikipedia votes to temporarily disable the site in protest against SOPA</a></li>
<li><a href="../134508/index.html">New technology allows you to quickly embed new objects in images</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>