<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Data Science project from research to implementation on the example of Talking Hat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A month ago, Lenta launched a contest in which the same Talking Hat from Harry Potter determines who gave access to the social network of participants...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Data Science project from research to implementation on the example of Talking Hat</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/webt/4h/il/lk/4hillkjrgatenqqix3nypmyn8vm.png"></p><br><p>  A month ago, Lenta launched a <a href="https://harrypotter.lenta.com/">contest</a> in which the same <a href="https://www.youtube.com/watch%3Fv%3DTDG3LJJ2Br0%26vl%3Dru">Talking Hat</a> from Harry Potter determines who gave access to the social network of participants to one of the four faculties.  The competition is not bad, the names sounding differently are determined by different faculties, and similar English and Russian names and surnames are distributed in a similar way.  I don‚Äôt know if the distribution depends only on the names and surnames, and whether the number of friends or other factors is taken into account, but this contest prompted the idea of ‚Äã‚Äãthis article: try to teach a classifier from scratch that will allow distributing users to different faculties. </p><a name="habracut"></a><br><p>  In the article we will make a simple ML-model, which distributes people to the Harry Potter faculties, depending on their first and last name, going through a small research process following the <a href="https://en.wikipedia.org/wiki/Cross-industry_standard_process_for_data_mining">CRISP</a> methodology.  Namely, we: </p><br><ul><li>  We formulate the problem; </li><li>  We investigate possible approaches to its solution and formulate data requirements (Solution methods and data); </li><li>  Collect the necessary data (Solution methods and data); </li><li>  Explore assembled dataset (Exploratory Research); </li><li>  Extract features from raw data (Feature Engineering); </li><li>  We will train a model of machine learning (Model evaluation); </li><li>  Let's compare the obtained results, evaluate the quality of the solutions obtained and, if necessary, repeat paragraphs 2-6; </li><li>  We pack the solution into a service that can be used (Production). </li></ul><br><p><img src="https://habrastorage.org/webt/6l/pf/oa/6lpfoa17u8pxjkf7wke7pm19-h0.png"></p><br><p>  This task may seem trivial, so we will impose an additional restriction on the whole process (so that it takes less than 2 hours) and on this article (so that its reading time is less than 15 minutes). </p><br><p>  If you are already immersed in the wonderful and wonderful world of Data Science and Kagglit is constantly no one sees, or (God forbid) you like to measure your Hadup‚Äôs length during meetings with colleagues, then the article will most likely seem simple and uninteresting.  Moreover, the quality of the final models is not the main value of this article.  We warned you.  Go. </p><br><p>  For curious readers, a <a href="https://github.com/Hiyorimi/talking_hat">githab repository</a> is also available with the code used in the article.  In case of errors, please open the PR. </p><br><h2 id="formuliruem-zadachu">  Formulate the task </h2><br><p>  Solving a problem that does not have clear decision criteria can be infinitely long, so we immediately decide that we want a solution that would allow us to get the answer ‚ÄúGryffindor‚Äù, ‚ÄúKogtevran‚Äù, ‚ÄúPuffenduy‚Äù or ‚ÄúSlytherin‚Äù in response to the entered string. </p><br><p>  Essentially, we want a black box: </p><br><pre><code class="plaintext hljs">" " =&gt; [?] =&gt; Griffindor</code> </pre> <br><p>  The original black hat distributed the young wizards to the faculties, depending on their character and personal qualities.  Since the data on the character and personality of the task is not available to us, we will use the participant‚Äôs first and last name, remembering that in this case we must distribute the characters of the book to those departments that correspond to their native departments from the book.  Yes, and the Potter lovers will definitely get upset if our solution distributes Harry to Puffendoi or Kogtevran (but it must send Harry and Slytherin to Harry with the same probability in order to convey the spirit of the book). </p><br><p>  If we are talking about probabilities, then we formalize the problem in more rigorous mathematical terms.  From the point of view of Data Science, we solve the problem of classification, namely, assigning an object (a string, in the form of a first and last name) of a certain class (in fact, it‚Äôs just a label, or a label, which can be a digit or 4 variables that have a yes / no value ).  We understand that at least in the case of Harry it will be correct to give 2 answers: Gryffindor and Slytherin, so it‚Äôs better not to predict the particular department that the hat determines, but the probability that a person will be distributed to this department, therefore our decision will be kind of some function </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;lt;</mo><mi>F</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&amp;gt;&amp;lt;</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&amp;gt;</mo><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mo stretchy=&quot;false&quot;>(</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>g</mi><mi>r</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>r</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>r</mi><mi>a</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>w</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>p</mi><mi>u</mi><mi>f</mi><mi>f</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>s</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="80.367ex" height="2.78ex" viewBox="0 -832 34602.4 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3C" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-46" x="1996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="2745" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="3091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="3542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="4012" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-4E" x="4373" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="5262" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="5791" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="6670" y="0"></use><g transform="translate(7414,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3E"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3C" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-4C" x="9249" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="9930" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="10460" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="10929" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-4E" x="11291" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="12179" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="12709" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="13587" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3E" x="14332" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-29" x="15110" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3D" x="15777" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-28" x="16834" y="0"></use><g transform="translate(17223,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-67" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="480" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="932" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="1277" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="1827" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="2378" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="2724" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-64" x="3324" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6F" x="3848" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="4333" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3B" x="21349" y="0"></use><g transform="translate(21794,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="451" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-76" x="981" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="1466" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="1932" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-63" x="2533" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="2967" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="3265" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-77" x="3795" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3B" x="25727" y="0"></use><g transform="translate(26172,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-68" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-75" x="576" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="1149" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="1699" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="2250" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-70" x="2548" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-75" x="3052" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="3624" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="4175" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3B" x="30256" y="0"></use><g transform="translate(30701,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-50" x="0" y="0"></use><g transform="translate(642,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="469" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="768" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="1113" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-68" x="1475" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="2051" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="2518" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="2969" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="3315" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-29" x="34212" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mo>&lt;</mo><mi>F</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&gt;&lt;</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&gt;</mo><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>g</mi><mi>r</mi><mi>i</mi><mi>f</mi><mi>f</mi><mi>i</mi><mi>n</mi><mi>d</mi><mi>o</mi><mi>r</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>r</mi><mi>a</mi><mi>v</mi><mi>e</mi><mi>n</mi><mi>c</mi><mi>l</mi><mi>a</mi><mi>w</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>h</mi><mi>u</mi><mi>f</mi><mi>f</mi><mi>l</mi><mi>p</mi><mi>u</mi><mi>f</mi><mi>f</mi></mrow></msub><mo>;</mo><msub><mi>P</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mi>l</mi><mi>i</mi><mi>t</mi><mi>h</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>n</mi></mrow></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-1"> f (<First Name> <Last Name>) = (P_ {griffindor}; P_ {ravenclaw}; P_ {hufflpuff}; P_ {slitherin}) </script></p><br><h3 id="metriki-i-ocenka-kachestva">  Metrics and quality assessment </h3><br><p>  The task and goal are formulated, <del>  now we will think how to solve it </del>  , But that is not all.  In order to proceed to the study, you need to enter the quality metrics.  In other words - to determine how we will compare 2 different solutions among themselves. </p><br><p>  Everything in life is good and simple - we intuitively understand that a spam detector must skip a minimum of spam to the inbox, and also skip a maximum of necessary letters and he certainly shouldn't send the necessary letters to spam. </p><br><p>  In reality, it is becoming more complicated and confirming <a href="https://towardsdatascience.com/understanding-auc-roc-curve-68b2303cc9c5">this a</a> <a href="https://medium.com/greyatom/performance-metrics-for-classification-problems-in-machine-learning-part-i-b085d432082b">large</a> <a href="https://apple.github.io/turicreate/docs/userguide/evaluation/classification.html">number of</a> <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BA%25D0%25B8_%25D0%25BF%25D0%25B5%25D1%2580%25D0%25B2%25D0%25BE%25D0%25B3%25D0%25BE_%25D0%25B8_%25D0%25B2%25D1%2582%25D0%25BE%25D1%2580%25D0%25BE%25D0%25B3%25D0%25BE_%25D1%2580%25D0%25BE%25D0%25B4%25D0%25B0_(%25D1%2581%25D1%2582%25D0%25B0%25D1%2582%25D0%25B8%25D1%2581%25D1%2582%25D0%25B8%25D0%25BA%25D0%25B0)">articles</a> that explain how and which metrics are used.  The best practice is to understand this, but this is such a voluminous topic that we promise to write a separate post about it and make an open table so that everyone can play around and understand in practice how it differs. </p><br><p>  The household ‚Äúlet's choose the best‚Äù for us will be the <a href="https://developers.google.com/machine-learning/crash-course/classification/roc-and-auc">ROC AUC</a> .  This is exactly what we want from the metric in this case: the less false positives and the more accurate the actual prediction, the greater will be the ROC AUC. </p><br><p>  In the ideal model, the ROC AUC is 1, in the ideal random model, which defines classes <em>absolutely randomly</em> - 0.5. </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>R</mi><mi>O</mi><mi>C</mi><mtext>&amp;#xA0;</mtext><mi>A</mi><mi>U</mi><mi>C</mi><mtext>&amp;#xA0;</mtext><mi>i</mi><mi>n</mi><mo stretchy=&quot;false&quot;>[</mo><mn>0.5</mn><mo>;</mo><mn>1</mn><mo stretchy=&quot;false&quot;>]</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="20.416ex" height="2.66ex" viewBox="0 -832 8790.2 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-52" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-4F" x="759" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-43" x="1523" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-41" x="2533" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-55" x="3284" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-43" x="4051" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="5062" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="5407" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-5B" x="6008" y="0"></use><g transform="translate(6286,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3B" x="7566" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-31" x="8011" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-5D" x="8511" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>R</mi><mi>O</mi><mi>C</mi><mtext>&nbsp;</mtext><mi>A</mi><mi>U</mi><mi>C</mi><mtext>&nbsp;</mtext><mi>i</mi><mi>n</mi><mo stretchy="false">[</mo><mn>0.5</mn><mo>;</mo><mn>1</mn><mo stretchy="false">]</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-2"> ROC \ AUC \ in [0.5; 1] </script></p><br><h2 id="algoritmy">  Algorithms </h2><br><p>  Our black box should take into account the distribution of the heroes of the books, take a different name and surname as input and output the result.  To solve the classification problem, you can use different machine learning algorithms: </p><br><p>  neural networks, factorization machines, linear regression or, for example, SVM. </p><br><p>  Contrary to popular opinion, Data Science is not limited to neural networks alone, and to popularize this idea, in this article, neural networks are left <em>as an exercise for the curious reader</em> .  Those who did not take a single course on data analysis (especially subjectively the <a href="https://mlcourse.ai/">best</a> - from SLM), or simply read <em>n</em> news about machine learning or AI, which are now even published in the Amateur Fisherman magazines, probably met the names of general algorithms groups : bagging, boosting, support vector machine (SVM), linear regression.  That is what we will use to solve our problem. </p><br><p>  And to be more precise, we compare with each other: </p><br><ul><li>  Linear regression </li><li>  Boosting (XGboost, LightGBM) </li><li>  Decisive trees (strictly speaking, this is the same boosting, but we will take out separately: Extra Trees) </li><li>  Bagging (Random Forest) </li><li>  SVM </li></ul><br><p>  The task of distributing each Hogwarts student to one of the faculties we can solve by defining the appropriate faculty, but strictly speaking this task <a href="https://en.wikipedia.org/wiki/Multiclass_classification">is reduced</a> to solving the problem of determining the belonging to each class separately.  Therefore, within the framework of this article we set ourselves the goal of getting 4 models, one for each department. </p><br><h2 id="dannye">  Data </h2><br><p>  Finding the right dataset for learning, and more importantly - legal for use in the right goals - is one of the most difficult and time consuming tasks in Data Science.  For our task, the data we take from <a href="http://harrypotter.wikia.com/">wikia</a> in the world of Harry Potter.  For example on this link you can find all the characters who studied at the faculty of Gryffindor.  It is important that the data in this case, we use for non-commercial purposes, so we do not violate the <a href="http://www.wikia.com/Licensing">license of</a> this site. </p><br><p><img src="https://habrastorage.org/webt/ff/f8/4e/fff84efaafg_yqwbhuhbfyz17k0.jpeg"></p><br><p>  For those who think that Data Scientists are such cool guys, I will go to Data Scientists, let them teach me, we remind you that there is such a step as cleaning and preparing data.  The downloaded data must be manually moderated in order to remove, for example, the ‚ÄúSeventh Prefect of Gryffindor‚Äù and semi-automatically remove the ‚ÄúUnknown girl from Gryffindor‚Äù.  In real work, a proportionally large part of the task is always associated with the preparation, cleaning, and restoration of missing values ‚Äã‚Äãin a dataset. </p><br><p>  A bit of ctrl + c &amp; ctrl + v and at the output we get 4 text files containing the names of the characters in 2 languages: English and Russian. </p><br><h2 id="izuchaem-sobrannye-dannye--eda-exploratory-data-analysis">  We study the collected data (EDA, Exploratory Data Analysis) </h2><br><p>  To this stage we have 4 files containing the names of the students of the faculties, let's take a closer look: </p><br><pre> <code class="bash hljs">$ ls ../input griffindor.txt hufflpuff.txt ravenclaw.txt slitherin.txt</code> </pre> <br><p>  Each file contains 1 first and last names (if any) of the student per line: </p><br><pre> <code class="bash hljs">$ wc -l ../input/*.txt 250 ../input/griffindor.txt 167 ../input/hufflpuff.txt 180 ../input/ravenclaw.txt 254 ../input/slitherin.txt 851 total</code> </pre> <br><p>  The collected data is: </p><br><pre> <code class="bash hljs">$ cat ../input/griffindor.txt | head -3 &amp;&amp; cat ../input/griffindor.txt | tail -3      Charlie Stainforth Melanie Stanmore Stewart</code> </pre> <br><p>  Our whole idea is based on the assumption that there is something in the names and surnames that our black box (or black hat) can learn to distinguish. </p><br><p>  The algorithm can feed the lines as is, but the result will not be good, because the basic models will not be able to understand for themselves what ‚ÄúDraco‚Äù differs from ‚ÄúHarry‚Äù, therefore, we will need to extract the signs from our names and surnames. </p><br><h3 id="podgotovka-dannyh-feature-engineering">  Data Preparation (Feature Engineering) </h3><br><p>  <strong>Signs</strong> (or features, from the <em>English.</em> <strong>Feature</strong> - property) - these are the distinctive properties of the object.  The number of times a person has changed work over the past year, the number of fingers on his left hand, the size of a car‚Äôs engine, whether the car‚Äôs mileage exceeds 100,000 km or not.  All sorts of classifications of signs have been invented by a very large number; there is not any single system in this regard, and there can be no, therefore we will give examples of what signs can be: </p><br><ol><li>  Rational number </li><li>  Category (up to 12, 12-18 or 18+) </li><li>  Binary value (Returned the first loan or not) </li><li>  Date, color, share, etc. </li></ol><br><p>  <strong>The search</strong> (or formation) of <strong>features</strong> (in <em>English by</em> <a href="https://towardsdatascience.com/understanding-feature-engineering-part-1-continuous-numeric-data-da4e47099a7b">Feature Engineering</a> ) is very often allocated to a separate stage of research or the work of a data analysis specialist.  In fact, in the process itself, common sense, experience, and testing of hypotheses help.  Guessing the right signs at once is a matter of a combination of a full hand, fundamental knowledge and luck.  Sometimes there is shamanism in this, but the general approach is very simple: you need to do what comes to mind, and then check whether the solution was improved by adding a new attribute.  For example, as a sign for our task, we can take the number of sizzles in the name. </p><br><p>  In the first version (because the real Data Science study is like a masterpiece, it can never be completed) of our model we will use the following attributes for the first and last names: </p><br><ol><li>  1 and the last letter of the word - vowel or consonant </li><li>  The number of double vowels and consonants </li><li>  Number of vowels, consonants, deaf, voiced </li><li>  First Name, Last Name Length </li><li>  ... </li></ol><br><p>  For this, we take <a href="https://github.com/NyashniyVladya/RusPhonetic">this</a> repository as a basis and add a class so that it can be used for Latin letters.  This will give us the opportunity to determine how each letter sounds. </p><br><pre> <code class="python hljs">&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> Phonetic <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RussianLetter, EnglishLetter &gt;&gt; RussianLetter(<span class="hljs-string"><span class="hljs-string">''</span></span>).classify() {<span class="hljs-string"><span class="hljs-string">'consonant'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'deaf'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'hard'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'paired'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'shock'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'soft'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'sonorus'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'vowel'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>} &gt;&gt; EnglishLetter(<span class="hljs-string"><span class="hljs-string">'d'</span></span>).classify() {<span class="hljs-string"><span class="hljs-string">'consonant'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'deaf'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'hard'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'paired'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'shock'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'soft'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'sonorus'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, <span class="hljs-string"><span class="hljs-string">'vowel'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>}</code> </pre> <br><p>  Now we can define simple functions for calculating statistics, for example: </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">starts_with_letter</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(word, letter_type=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'vowel'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""   ,    . :param word:  :param letter_type: 'vowel'  'consonant'.   . :return: Boolean """</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(word) == <span class="hljs-number"><span class="hljs-number">0</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Letter(word[<span class="hljs-number"><span class="hljs-number">0</span></span>]).classify()[letter_type] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">count_letter_type</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(word)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""       . :param word:  :param debug:    :return: :obj:`dict` of :obj:`str` =&gt; :int:count """</span></span> count = { <span class="hljs-string"><span class="hljs-string">'consonant'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'deaf'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'hard'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'mark'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'paired'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'shock'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'soft'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'sonorus'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'vowel'</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> letter <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> word: classes = Letter(letter).classify() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> count.keys(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> classes[key]: count[key] += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count</code> </pre> <br><p>  With these functions, we can get the first signs: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> feature_engineering <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * &gt;&gt; print(<span class="hljs-string"><span class="hljs-string">"  (¬´¬ª): "</span></span>, len(<span class="hljs-string"><span class="hljs-string">""</span></span>))   (¬´¬ª): <span class="hljs-number"><span class="hljs-number">5</span></span> &gt;&gt; print(<span class="hljs-string"><span class="hljs-string">" (¬´¬ª)   : "</span></span>, starts_with_letter(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'vowel'</span></span>))  (¬´¬ª)   : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt; print(<span class="hljs-string"><span class="hljs-string">" (¬´¬ª)   : "</span></span>, starts_with_letter(<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'consonant'</span></span>))  (¬´¬ª)   : <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> &gt;&gt; count_Harry = count_letter_type(<span class="hljs-string"><span class="hljs-string">""</span></span>) &gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"     (¬´¬ª): "</span></span>, count_Harry[<span class="hljs-string"><span class="hljs-string">'paired'</span></span>])      (¬´¬ª): <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><p>  Strictly speaking, using these functions we can get some vector representation of the string, that is, we get the mapping: </p><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_SVG_Display" style="text-align: center;"><span class="MathJax_SVG" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>f</mi><mo stretchy=&quot;false&quot;>(</mo><mo>&amp;lt;</mo><mi>F</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&amp;gt;&amp;lt;</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&amp;gt;</mo><mo stretchy=&quot;false&quot;>)</mo><mo>=&amp;gt;</mo><mo stretchy=&quot;false&quot;>(</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><msub><mi>h</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></msub><mo>,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><msub><mi>h</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>o</mi><mi>f</mi><msub><mtext>&amp;#xA0;</mtext><mi>p</mi></msub><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation" style="font-size: 100%; display: inline-block; position: relative;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="101.783ex" height="2.78ex" viewBox="0 -832 43822.9 1197.1" role="img" focusable="false" style="vertical-align: -0.848ex;" aria-hidden="true"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-28" x="550" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3C" x="940" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-46" x="1996" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="2745" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="3091" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="3542" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="4012" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="4373" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="4974" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="5503" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="6382" y="0"></use><g transform="translate(7126,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3E"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3C" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-4C" x="8961" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="9642" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="10172" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="10641" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="11003" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="11603" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="12133" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="13011" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3E" x="13756" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-29" x="14534" y="0"></use><g transform="translate(15201,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3D"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-3E" x="778" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-28" x="17036" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="17426" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="17724" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="18191" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-67" x="18791" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="19272" y="0"></use><g transform="translate(19633,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-68" x="0" y="0"></use><g transform="translate(576,-155)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="550" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="895" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="1347" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="1817" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="2178" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="2779" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="3308" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="4187" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2C" x="23600" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="24045" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="24344" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="24810" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-67" x="25411" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="25891" y="0"></use><g transform="translate(26253,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-68" x="0" y="0"></use><g transform="translate(576,-150)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="298" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="828" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="1297" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="1659" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="2259" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="2789" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="3667" y="0"></use></g></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2C" x="29853" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2E" x="30298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2E" x="30743" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2E" x="31188" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-2C" x="31633" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="32078" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-75" x="32679" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="33251" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-62" x="34130" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="34559" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-72" x="35026" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6F" x="35477" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-66" x="35963" y="0"></use><g transform="translate(36513,0)"><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-70" x="353" y="-213"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-75" x="37219" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-62" x="37792" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="38221" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-69" x="38520" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-63" x="38865" y="0"></use><g transform="translate(39299,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6C" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="298" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-73" x="828" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-74" x="1297" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6E" x="1659" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-61" x="2259" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-6D" x="2789" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMATHI-65" x="3667" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/company/ods/blog/430006/&amp;xid=17259,15700022,15700186,15700191,15700248,15700253&amp;usg=ALkJrhhkGAF_k9sD88t_3V8iyqDFXkpkrw#MJMAIN-29" x="43433" y="0"></use></g></svg><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mo>&lt;</mo><mi>F</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&gt;&lt;</mo><mi>L</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mo>&gt;</mo><mo stretchy="false">)</mo><mo>=&gt;</mo><mo stretchy="false">(</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><msub><mi>h</mi><mrow class="MJX-TeXAtom-ORD"><mi>f</mi><mi>i</mi><mi>r</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></msub><mo>,</mo><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><msub><mi>h</mi><mrow class="MJX-TeXAtom-ORD"><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow></msub><mo>,</mo><mo>.</mo><mo>.</mo><mo>.</mo><mo>,</mo><mi>n</mi><mi>u</mi><mi>m</mi><mi>b</mi><mi>e</mi><mi>r</mi><mi>o</mi><mi>f</mi><msub><mtext>&nbsp;</mtext><mi>p</mi></msub><mi>u</mi><mi>b</mi><mi>l</mi><mi>i</mi><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mi>l</mi><mi>a</mi><mi>s</mi><mi>t</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex;mode=display" id="MathJax-Element-3"> f (<First name> <Last name>) => (length_ {first name}, length_ {last name}, ..., number of \ _ public {last name}) </script></p><br><p>  Now we can present our data in the form of a dataset, which can be input to the machine learning algorithm: </p><br><pre> <code class="python hljs">&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> data_loaders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_processed_data &gt;&gt; hogwarts_df = load_processed_data() &gt;&gt; hogwarts_df.head()</code> </pre> <br><p><img src="https://habrastorage.org/webt/5-/-e/4g/5--e4gvhmdhe00fxjhwqnxzdajk.png"></p><br><p>  As a result, we get the following signs for each student: </p><br><pre> <code class="python hljs">&gt;&gt; hogwarts_df[hogwarts_df.columns].dtypes</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">The resulting signs</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">name object surname object is_english bool name_starts_with_vowel bool name_starts_with_consonant bool name_ends_with_vowel bool name_ends_with_consonant bool name_length int64 name_vowels_count int64 name_double_vowels_count int64 name_consonant_count int64 name_double_consonant_count int64 name_paired_count int64 name_deaf_count int64 name_sonorus_count int64 surname_starts_with_vowel bool surname_starts_with_consonant bool surname_ends_with_vowel bool surname_ends_with_consonant bool surname_length int64 surname_vowels_count int64 surname_double_vowels_count int64 surname_consonant_count int64 surname_double_consonant_count int64 surname_paired_count int64 surname_deaf_count int64 surname_sonorus_count int64 is_griffindor int64 is_hufflpuff int64 is_ravenclaw int64 is_slitherin int64 dtype: object</code> </pre> </div></div><br><p>  The last 4 columns are targeted - they contain information on which faculty the student is enrolled for. </p><br><h2 id="obuchenie-algoritmov">  Learning algorithms </h2><br><p>  In a nutshell, algorithms are trained the same way as people: they make mistakes and learn from them.  In order to understand how badly they made a mistake, the algorithms use <strong>the error</strong> functions (loss functions, the <em>English</em> <strong>loss-function</strong> ). </p><br><p>  As a rule, the learning process is very simple and it consists of several steps: </p><br><ol><li>  Make a prediction. </li><li>  Rate the error. </li><li>  Amend the model parameters. </li><li>  Repeat 1-3 until the goal is reached, the process does not stop or the data runs out. </li><li><p>  Rate the quality of the model. </p><br><p>  In practice, of course, everything is a little more complicated.  For example, there is the phenomenon of <strong>retraining</strong> ( <em>English</em> overfitting) - the algorithm can literally remember which signs correspond to the answer and thus worsen the result for objects that are not similar to those for which it was trained.  To avoid this, there are various techniques and hacks. </p><br></li></ol><br><p>  As mentioned above, we will solve 4 tasks: one for each faculty.  Therefore, we prepare data for Slytherin: </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#  ,     - : &gt;&gt; data_full = hogwarts_df.drop( [ 'name', 'surname', 'is_griffindor', 'is_hufflpuff', 'is_ravenclaw' ], axis=1).copy() #    ,   : &gt;&gt; X_data = data_full.drop('is_slitherin', axis=1) #     ,   1    &gt;&gt; y = data_full.is_slitherin</span></span></code> </pre> <br><p>  While learning, the algorithm constantly compares its results with real data, for this part of the dataset is allocated for validation.  The rule of good tone is also considered to evaluate the result of the algorithm on individual data that the algorithm has never seen.  Therefore, we now divide the sample in the proportion of 70/30 and train the first algorithm: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.cross_validation <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_test_split <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.ensemble <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> RandomForestClassifier <span class="hljs-comment"><span class="hljs-comment">#      &gt;&gt; seed = 7 #    &gt;&gt; test_size = 0.3 &gt;&gt; X_train, X_test, y_train, y_test = train_test_split(X_data, y, test_size=test_size, random_state=seed) &gt;&gt; rfc = RandomForestClassifier() &gt;&gt; rfc_model = rfc.fit(X_train, y_train)</span></span></code> </pre> <br><p>  Is done.  Now, if you submit data to the input of this model, it will produce the result.  This is fun, so first of all we will check if Harry‚Äôs model recognizes a Slytherin.  To do this, we first prepare the functions in order to obtain the prediction of the algorithm: </p><br><div class="spoiler">  <b class="spoiler_title">View code</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> data_loaders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> parse_line_to_hogwarts_df <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pandas <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> pd <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_single_student_features</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      :param name: string     :return: pd.DataFrame     """</span></span> featurized_person_df = parse_line_to_hogwarts_df(name) person_df = pd.DataFrame(featurized_person_df, columns=[ <span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname'</span></span>, <span class="hljs-string"><span class="hljs-string">'is_english'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_starts_with_vowel'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_starts_with_consonant'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_ends_with_vowel'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_ends_with_consonant'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_length'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_vowels_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_double_vowels_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_consonant_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_double_consonant_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_paired_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_deaf_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'name_sonorus_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_starts_with_vowel'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_starts_with_consonant'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_ends_with_vowel'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_ends_with_consonant'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_length'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_vowels_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_double_vowels_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_consonant_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_double_consonant_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_paired_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_deaf_count'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname_sonorus_count'</span></span>, ], index=[<span class="hljs-number"><span class="hljs-number">0</span></span>] ) featurized_person = person_df.drop( [<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname'</span></span>], axis = <span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> featurized_person <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_predictions_vector</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model, person)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""    :param model:   :param person: string   :return: list    """</span></span> encoded_person = get_single_student_features(person) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> model.predict_proba(encoded_person)[<span class="hljs-number"><span class="hljs-number">0</span></span>]</code> </pre> </div></div><br><p>  And now we will set a small test dataset to consider the results of the algorithm. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">score_testing_dataset</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(model)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">"""      . :param model:   """</span></span> testing_dataset = [ <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Kirill Malev"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Harry Potter"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"Severus Snape"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Tom Riddle"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Salazar Slytherin"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> testing_dataset: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (<span class="hljs-string"><span class="hljs-string">"{} ‚Äî {}"</span></span>.format(name, get_predictions_vector(model, name)[<span class="hljs-number"><span class="hljs-number">1</span></span>])) score_testing_dataset(rfc_model)</code> </pre> <br><pre> <code class="plaintext hljs">  ‚Äî 0.5 Kirill Malev ‚Äî 0.5   ‚Äî 0.0 Harry Potter ‚Äî 0.0   ‚Äî 0.75   ‚Äî 0.9 Severus Snape ‚Äî 0.5   ‚Äî 0.2 Tom Riddle ‚Äî 0.5   ‚Äî 0.2 Salazar Slytherin ‚Äî 0.3</code> </pre> <br><p>  The results were dubious.  Even the founder of the faculty would not get into his faculty, according to this model.  Therefore, you need to evaluate the strict quality: look at the metrics that we asked at the beginning: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.metrics <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> accuracy_score, roc_auc_score, classification_report predictions = rfc_model.predict(X_test) print(<span class="hljs-string"><span class="hljs-string">"Classification report: "</span></span>) print(classification_report(y_test, predictions)) print(<span class="hljs-string"><span class="hljs-string">"Accuracy for Random Forest Model: %.2f"</span></span> % (accuracy_score(y_test, predictions) * <span class="hljs-number"><span class="hljs-number">100</span></span>)) print(<span class="hljs-string"><span class="hljs-string">"ROC AUC from first Random Forest Model: %.2f"</span></span> % (roc_auc_score(y_test, predictions)))</code> </pre> <br><pre> <code class="plaintext hljs">Classification report: precision recall f1-score support 0 0.66 0.88 0.75 168 1 0.38 0.15 0.21 89 avg / total 0.56 0.62 0.56 257 Accuracy for Random Forest Model: 62.26 ROC AUC from first Random Forest Model: 0.51</code> </pre> <br><p>  It is not surprising that the results were so dubious - the ROC AUC of about 0.51 suggests that the model predicts slightly better than a coin toss. </p><br><h2 id="testirovanie-poluchennyh-rezultatov-metriki-kachestva">  Testing the results.  Quality metrics </h2><br><p>  Above, using one example, we looked at how 1 algorithm that supports sklearn interfaces is trained.  The rest are trained in exactly the same way, so we just have to train all the algorithms and choose the best in each case. </p><br><p><img src="https://habrastorage.org/webt/ff/i0/fq/ffi0fqqs7gbi3aczbucvusrw2qi.jpeg"></p><br><p>  There is nothing difficult in this, for each algorithm we teach 1 with standard settings, and also we train a whole set, going through various options that affect the quality of the algorithm.  This stage is called Model Tuning or Hyperparameter Optimization and its essence is very simple: choose the set of settings that gives the best result. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> model_training <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_classifiers <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> data_loaders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> load_processed_data <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> warnings warnings.filterwarnings(<span class="hljs-string"><span class="hljs-string">'ignore'</span></span>) <span class="hljs-comment"><span class="hljs-comment">#   hogwarts_df = load_processed_data() #     data_full = hogwarts_df.drop( [ 'name', 'surname', 'is_griffindor', 'is_hufflpuff', 'is_ravenclaw' ], axis=1).copy() X_data = data_full.drop('is_slitherin', axis=1) y = data_full.is_slitherin #    slitherin_models = train_classifiers(data_full, X_data, y) score_testing_dataset(slitherin_models[5])</span></span></code> </pre> <br><pre> <code class="plaintext hljs">  ‚Äî 0.09437856871661066 Kirill Malev ‚Äî 0.20820536334902712   ‚Äî 0.07550095601699099 Harry Potter ‚Äî 0.07683794773639624   ‚Äî 0.9414529336862744   ‚Äî 0.9293671807790949 Severus Snape ‚Äî 0.6576783576162999   ‚Äî 0.18577792617672767 Tom Riddle ‚Äî 0.8351835484058869   ‚Äî 0.25930925139546795 Salazar Slytherin ‚Äî 0.24008788903854789</code> </pre> <br><p>  The numbers in this version look subjectively better than in the past, but are not good enough for an internal perfectionist.  Therefore, we will go down to a level deeper and go back to the product meaning of our task: you need to predict the most probable faculty at which the hero will be assigned by the distribution hat.  This means that you need to train models for each of the faculties. </p><br><p><img src="https://habrastorage.org/webt/hc/ag/ci/hcagciojsjdzpglovd1xabohtym.jpeg"></p><br><pre> <code class="python hljs">&gt;&gt; <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> model_training <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_all_models <span class="hljs-comment"><span class="hljs-comment">#      &gt;&gt; slitherin_models, griffindor_models, ravenclaw_models, hufflpuff_models = \ train_all_models()</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Long output and multinomial regression results</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">SVM Default Report Accuracy for SVM Default: 73.93 ROC AUC for SVM Default: 0.53 Tuned SVM Report Accuracy for Tuned SVM: 72.37 ROC AUC for Tuned SVM: 0.50 KNN Default Report Accuracy for KNN Default: 70.04 ROC AUC for KNN Default: 0.58 Tuned KNN Report Accuracy for Tuned KNN: 69.65 ROC AUC for Tuned KNN: 0.58 XGBoost Default Report Accuracy for XGBoost Default: 70.43 ROC AUC for XGBoost Default: 0.54 Tuned XGBoost Report Accuracy for Tuned XGBoost: 68.09 ROC AUC for Tuned XGBoost: 0.56 Random Forest Default Report Accuracy for Random Forest Default: 73.93 ROC AUC for Random Forest Default: 0.62 Tuned Random Forest Report Accuracy for Tuned Random Forest: 74.32 ROC AUC for Tuned Random Forest: 0.54 Extra Trees Default Report Accuracy for Extra Trees Default: 69.26 ROC AUC for Extra Trees Default: 0.57 Tuned Extra Trees Report Accuracy for Tuned Extra Trees: 73.54 ROC AUC for Tuned Extra Trees: 0.55 LGBM Default Report Accuracy for LGBM Default: 70.82 ROC AUC for LGBM Default: 0.62 Tuned LGBM Report Accuracy for Tuned LGBM: 74.71 ROC AUC for Tuned LGBM: 0.53 RGF Default Report Accuracy for RGF Default: 70.43 ROC AUC for RGF Default: 0.58 Tuned RGF Report Accuracy for Tuned RGF: 71.60 ROC AUC for Tuned RGF: 0.60 FRGF Default Report Accuracy for FRGF Default: 68.87 ROC AUC for FRGF Default: 0.59 Tuned FRGF Report Accuracy for Tuned FRGF: 69.26 ROC AUC for Tuned FRGF: 0.59 SVM Default Report Accuracy for SVM Default: 70.43 ROC AUC for SVM Default: 0.50 Tuned SVM Report Accuracy for Tuned SVM: 71.60 ROC AUC for Tuned SVM: 0.50 KNN Default Report Accuracy for KNN Default: 63.04 ROC AUC for KNN Default: 0.49 Tuned KNN Report Accuracy for Tuned KNN: 65.76 ROC AUC for Tuned KNN: 0.50 XGBoost Default Report Accuracy for XGBoost Default: 69.65 ROC AUC for XGBoost Default: 0.54 Tuned XGBoost Report Accuracy for Tuned XGBoost: 68.09 ROC AUC for Tuned XGBoost: 0.50 Random Forest Default Report Accuracy for Random Forest Default: 66.15 ROC AUC for Random Forest Default: 0.51 Tuned Random Forest Report Accuracy for Tuned Random Forest: 70.43 ROC AUC for Tuned Random Forest: 0.50 Extra Trees Default Report Accuracy for Extra Trees Default: 64.20 ROC AUC for Extra Trees Default: 0.49 Tuned Extra Trees Report Accuracy for Tuned Extra Trees: 70.82 ROC AUC for Tuned Extra Trees: 0.51 LGBM Default Report Accuracy for LGBM Default: 67.70 ROC AUC for LGBM Default: 0.56 Tuned LGBM Report Accuracy for Tuned LGBM: 70.82 ROC AUC for Tuned LGBM: 0.50 RGF Default Report Accuracy for RGF Default: 66.54 ROC AUC for RGF Default: 0.52 Tuned RGF Report Accuracy for Tuned RGF: 65.76 ROC AUC for Tuned RGF: 0.53 FRGF Default Report Accuracy for FRGF Default: 65.76 ROC AUC for FRGF Default: 0.53 Tuned FRGF Report Accuracy for Tuned FRGF: 69.65 ROC AUC for Tuned FRGF: 0.52 SVM Default Report Accuracy for SVM Default: 74.32 ROC AUC for SVM Default: 0.50 Tuned SVM Report Accuracy for Tuned SVM: 74.71 ROC AUC for Tuned SVM: 0.51 KNN Default Report Accuracy for KNN Default: 69.26 ROC AUC for KNN Default: 0.48 Tuned KNN Report Accuracy for Tuned KNN: 73.15 ROC AUC for Tuned KNN: 0.49 XGBoost Default Report Accuracy for XGBoost Default: 72.76 ROC AUC for XGBoost Default: 0.49 Tuned XGBoost Report Accuracy for Tuned XGBoost: 74.32 ROC AUC for Tuned XGBoost: 0.50 Random Forest Default Report Accuracy for Random Forest Default: 73.93 ROC AUC for Random Forest Default: 0.52 Tuned Random Forest Report Accuracy for Tuned Random Forest: 74.32 ROC AUC for Tuned Random Forest: 0.50 Extra Trees Default Report Accuracy for Extra Trees Default: 73.93 ROC AUC for Extra Trees Default: 0.52 Tuned Extra Trees Report Accuracy for Tuned Extra Trees: 73.93 ROC AUC for Tuned Extra Trees: 0.50 LGBM Default Report Accuracy for LGBM Default: 73.54 ROC AUC for LGBM Default: 0.52 Tuned LGBM Report Accuracy for Tuned LGBM: 74.32 ROC AUC for Tuned LGBM: 0.50 RGF Default Report Accuracy for RGF Default: 73.54 ROC AUC for RGF Default: 0.51 Tuned RGF Report Accuracy for Tuned RGF: 73.93 ROC AUC for Tuned RGF: 0.50 FRGF Default Report Accuracy for FRGF Default: 73.93 ROC AUC for FRGF Default: 0.53 Tuned FRGF Report Accuracy for Tuned FRGF: 73.93 ROC AUC for Tuned FRGF: 0.50 SVM Default Report Accuracy for SVM Default: 80.54 ROC AUC for SVM Default: 0.50 Tuned SVM Report Accuracy for Tuned SVM: 80.93 ROC AUC for Tuned SVM: 0.52 KNN Default Report Accuracy for KNN Default: 78.60 ROC AUC for KNN Default: 0.50 Tuned KNN Report Accuracy for Tuned KNN: 80.16 ROC AUC for Tuned KNN: 0.51 XGBoost Default Report Accuracy for XGBoost Default: 80.54 ROC AUC for XGBoost Default: 0.50 Tuned XGBoost Report Accuracy for Tuned XGBoost: 77.04 ROC AUC for Tuned XGBoost: 0.52 Random Forest Default Report Accuracy for Random Forest Default: 77.43 ROC AUC for Random Forest Default: 0.49 Tuned Random Forest Report Accuracy for Tuned Random Forest: 80.54 ROC AUC for Tuned Random Forest: 0.50 Extra Trees Default Report Accuracy for Extra Trees Default: 76.26 ROC AUC for Extra Trees Default: 0.48 Tuned Extra Trees Report Accuracy for Tuned Extra Trees: 78.60 ROC AUC for Tuned Extra Trees: 0.50 LGBM Default Report Accuracy for LGBM Default: 75.49 ROC AUC for LGBM Default: 0.51 Tuned LGBM Report Accuracy for Tuned LGBM: 80.54 ROC AUC for Tuned LGBM: 0.50 RGF Default Report Accuracy for RGF Default: 78.99 ROC AUC for RGF Default: 0.52 Tuned RGF Report Accuracy for Tuned RGF: 75.88 ROC AUC for Tuned RGF: 0.55 FRGF Default Report Accuracy for FRGF Default: 76.65 ROC AUC for FRGF Default: 0.50 #   ,       </code> </pre> <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sklearn.linear_model <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LogisticRegression clf = LogisticRegression(random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>, solver=<span class="hljs-string"><span class="hljs-string">'lbfgs'</span></span>, multi_class=<span class="hljs-string"><span class="hljs-string">'multinomial'</span></span>) hogwarts_df = load_processed_data_multi() <span class="hljs-comment"><span class="hljs-comment">#     data_full = hogwarts_df.drop( [ 'name', 'surname', ], axis=1).copy() X_data = data_full.drop('faculty', axis=1) y = data_full.faculty clf.fit(X_data, y) score_testing_dataset(clf)</span></span></code> </pre> <br><pre> <code class="plaintext hljs">  ‚Äî [0.3602361 0.16166944 0.16771712 0.31037733] Kirill Malev ‚Äî [0.47473072 0.16051924 0.13511385 0.22963619]   ‚Äî [0.38697926 0.19330242 0.17451052 0.2452078 ] Harry Potter ‚Äî [0.40245098 0.16410043 0.16023278 0.27321581]   ‚Äî [0.13197025 0.16438855 0.17739254 0.52624866]   ‚Äî [0.17170203 0.1205678 0.14341742 0.56431275] Severus Snape ‚Äî [0.15558044 0.21589378 0.17370406 0.45482172]   ‚Äî [0.39301231 0.07397324 0.1212741 0.41174035] Tom Riddle ‚Äî [0.26623969 0.14194379 0.1728505 0.41896601]   ‚Äî [0.24843037 0.21632736 0.21532696 0.3199153 ] Salazar Slytherin ‚Äî [0.09359144 0.26735897 0.2742305 0.36481909]</code> </pre> <br><p>  confusion_matrix: </p><br><pre> <code class="python hljs">confusion_matrix(clf.predict(X_data), y)</code> </pre> <br><pre> <code class="plaintext hljs">array([[144, 68, 64, 78], [ 8, 9, 8, 6], [ 22, 18, 31, 20], [ 77, 73, 78, 151]])</code> </pre> </div></div><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_predctions_vector</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(models, person)</span></span></span><span class="hljs-function">:</span></span> predictions = [get_predictions_vector (model, person)[<span class="hljs-number"><span class="hljs-number">1</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> model <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> models] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'slitherin'</span></span>: predictions[<span class="hljs-number"><span class="hljs-number">0</span></span>], <span class="hljs-string"><span class="hljs-string">'griffindor'</span></span>: predictions[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">'ravenclaw'</span></span>: predictions[<span class="hljs-number"><span class="hljs-number">2</span></span>], <span class="hljs-string"><span class="hljs-string">'hufflpuff'</span></span>: predictions[<span class="hljs-number"><span class="hljs-number">3</span></span>] } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">score_testing_dataset</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(models)</span></span></span><span class="hljs-function">:</span></span> testing_dataset = [ <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Kirill Malev"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Harry Potter"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>,<span class="hljs-string"><span class="hljs-string">"Severus Snape"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Tom Riddle"</span></span>, <span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-string"><span class="hljs-string">"Salazar Slytherin"</span></span>] data = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> testing_dataset: predictions = get_predctions_vector(models, name) predictions[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = name data.append(predictions) scoring_df = pd.DataFrame(data, columns=[<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'slitherin'</span></span>, <span class="hljs-string"><span class="hljs-string">'griffindor'</span></span>, <span class="hljs-string"><span class="hljs-string">'hufflpuff'</span></span>, <span class="hljs-string"><span class="hljs-string">'ravenclaw'</span></span>]) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> scoring_df <span class="hljs-comment"><span class="hljs-comment"># Data Science ‚Äî    ,       top_models = [ slitherin_models[3], griffindor_models[3], ravenclaw_models[3], hufflpuff_models[3] ] score_testing_dataset(top_models)</span></span></code> </pre> <br><pre> <code class="plaintext hljs"> name slitherin griffindor hufflpuff ravenclaw 0   0.349084 0.266909 0.110311 0.091045 1 Kirill Malev 0.289914 0.376122 0.384986 0.103056 2   0.338258 0.400841 0.016668 0.124825 3 Harry Potter 0.245377 0.357934 0.026287 0.154592 4   0.917423 0.126997 0.176640 0.096570 5   0.969693 0.106384 0.150146 0.082195 6 Severus Snape 0.663732 0.259189 0.290252 0.074148 7   0.268466 0.579401 0.007900 0.083195 8 Tom Riddle 0.639731 0.541184 0.084395 0.156245 9   0.653595 0.147506 0.172940 0.137134 10 Salazar Slytherin 0.647399 0.169964 0.095450 0.26126</code> </pre> <br><p><img src="https://habrastorage.org/webt/kc/pq/r7/kcpqr7dw_t-yudtoda54qj1su3o.jpeg"></p><br><p>     , <del>     </del>   .    ROC AUC  ,  0.5.    ,   : </p><br><ul><li>   ; </li><li>    ; </li><li>    ,        ; </li><li>      ,     ; </li><li>  ,            ,   . </li></ul><br><p>            ,    ,   ,   ,          XGBoost      CV ,       . </p><br><p>  Important! ,       70% .     ,    4          . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> model_training <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> train_production_models <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> xgboost <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> XGBClassifier best_models = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range (<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>): best_models.append(XGBClassifier(base_score=<span class="hljs-number"><span class="hljs-number">0.5</span></span>, booster=<span class="hljs-string"><span class="hljs-string">'gbtree'</span></span>, colsample_bylevel=<span class="hljs-number"><span class="hljs-number">1</span></span>, colsample_bytree=<span class="hljs-number"><span class="hljs-number">0.7</span></span>, gamma=<span class="hljs-number"><span class="hljs-number">0</span></span>, learning_rate=<span class="hljs-number"><span class="hljs-number">0.05</span></span>, max_delta_step=<span class="hljs-number"><span class="hljs-number">0</span></span>, max_depth=<span class="hljs-number"><span class="hljs-number">6</span></span>, min_child_weight=<span class="hljs-number"><span class="hljs-number">11</span></span>, missing=<span class="hljs-number"><span class="hljs-number">-999</span></span>, n_estimators=<span class="hljs-number"><span class="hljs-number">1000</span></span>, n_jobs=<span class="hljs-number"><span class="hljs-number">1</span></span>, nthread=<span class="hljs-number"><span class="hljs-number">4</span></span>, objective=<span class="hljs-string"><span class="hljs-string">'binary:logistic'</span></span>, random_state=<span class="hljs-number"><span class="hljs-number">0</span></span>, reg_alpha=<span class="hljs-number"><span class="hljs-number">0</span></span>, reg_lambda=<span class="hljs-number"><span class="hljs-number">1</span></span>, scale_pos_weight=<span class="hljs-number"><span class="hljs-number">1</span></span>, seed=<span class="hljs-number"><span class="hljs-number">1337</span></span>, silent=<span class="hljs-number"><span class="hljs-number">1</span></span>, subsample=<span class="hljs-number"><span class="hljs-number">0.8</span></span>)) slitherin_model, griffindor_model, ravenclaw_model, hufflpuff_model = \ train_production_models(best_models) top_models = slitherin_model, griffindor_model, ravenclaw_model, hufflpuff_model score_testing_dataset(top_models)</code> </pre> <br><pre> <code class="plaintext hljs">name slitherin griffindor hufflpuff ravenclaw 0   0.273713 0.372337 0.065923 0.279577 1 Kirill Malev 0.401603 0.761467 0.111068 0.023902 2   0.031540 0.616535 0.196342 0.217829 3 Harry Potter 0.183760 0.422733 0.119393 0.173184 4   0.945895 0.021788 0.209820 0.019449 5   0.950932 0.088979 0.084131 0.012575 6 Severus Snape 0.634035 0.088230 0.249871 0.036682 7   0.426440 0.431351 0.028444 0.083636 8 Tom Riddle 0.816804 0.136530 0.069564 0.035500 9   0.409634 0.213925 0.028631 0.252723 10 Salazar Slytherin 0.824590 0.067910 0.111147 0.085710</code> </pre> <br><p>      ,  ,   . </p><br><p>    ,           ,     .   . </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> pickle pickle.dump(slitherin_model, open(<span class="hljs-string"><span class="hljs-string">"../output/slitherin.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>)) pickle.dump(griffindor_model, open(<span class="hljs-string"><span class="hljs-string">"../output/griffindor.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>)) pickle.dump(ravenclaw_model, open(<span class="hljs-string"><span class="hljs-string">"../output/ravenclaw.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>)) pickle.dump(hufflpuff_model, open(<span class="hljs-string"><span class="hljs-string">"../output/hufflpuff.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"wb"</span></span>))</code> </pre> <br><h2 id="prodakshn">  </h2><br><p>           ,     .   ,     , ,       . </p><br><p>           ,  ,      .        ,       .  ,   Data Scientist ‚Äî       -. </p><br><p>     : </p><br><ul><li>     ; </li><li>     json-       json; </li><li>            . </li></ul><br><p> ,     docker-,           python-.  ,           flask. </p><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> __future__ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> print_function <span class="hljs-comment"><span class="hljs-comment"># In python 2.7 import os import subprocess import json import re from flask import Flask, request, jsonify from inspect import getmembers, ismethod import numpy as npb import pandas as pd import math import os import pickle import xgboost as xgb import sys from letter import Letter from talking_hat import * from sklearn.ensemble import RandomForestClassifier import warnings def prod_predict_classes_for_name (full_name): featurized_person = parse_line_to_hogwarts_df(full_name) person_df = pd.DataFrame(featurized_person, columns=[ 'name', 'surname', 'is_english', 'name_starts_with_vowel', 'name_starts_with_consonant', 'name_ends_with_vowel', 'name_ends_with_consonant', 'name_length', 'name_vowels_count', 'name_double_vowels_count', 'name_consonant_count', 'name_double_consonant_count', 'name_paired_count', 'name_deaf_count', 'name_sonorus_count', 'surname_starts_with_vowel', 'surname_starts_with_consonant', 'surname_ends_with_vowel', 'surname_ends_with_consonant', 'surname_length', 'surname_vowels_count', 'surname_double_vowels_count', 'surname_consonant_count', 'surname_double_consonant_count', 'surname_paired_count', 'surname_deaf_count', 'surname_sonorus_count', ], index=[0] ) slitherin_model = pickle.load(open("models/slitherin.xgbm", "rb")) griffindor_model = pickle.load(open("models/griffindor.xgbm", "rb")) ravenclaw_model = pickle.load(open("models/ravenclaw.xgbm", "rb")) hufflpuff_model = pickle.load(open("models/hufflpuff.xgbm", "rb")) predictions = get_predctions_vector([ slitherin_model, griffindor_model, ravenclaw_model, hufflpuff_model ], person_df.drop(['name', 'surname'], axis=1)) return { 'slitherin': float(predictions[0][1]), 'griffindor': float(predictions[1][1]), 'ravenclaw': float(predictions[2][1]), 'hufflpuff': float(predictions[3][1]) } def predict(params): fullname = params['fullname'] print(params) return prod_predict_classes_for_name(fullname) def create_app(): app = Flask(__name__) functions_list = [predict] @app.route('/&lt;func_name&gt;', methods=['POST']) def api_root(func_name): for function in functions_list: if function.__name__ == func_name: try: json_req_data = request.get_json() if json_req_data: res = function(json_req_data) else: return jsonify({"error": "error in receiving the json input"}) except Exception as e: data = { "error": "error while running the function" } if hasattr(e, 'message'): data['message'] = e.message elif len(e.args) &gt;= 1: data['message'] = e.args[0] return jsonify(data) return jsonify({"success": True, "result": res}) output_string = 'function: %s not found' % func_name return jsonify({"error": output_string}) return app if __name__ == '__main__': app = create_app() app.run(host='0.0.0.0')</span></span></code> </pre> </div></div><br><p> Dockerfile: </p><br><pre> <code class="bash hljs">FROM datmo/python-base:cpu-py35 <span class="hljs-comment"><span class="hljs-comment">#  python3-wheel,        RUN apt-get update; apt-get install -y python3-pip python3-numpy python3-scipy python3-wheel ADD requirements.txt / RUN pip3 install -r /requirements.txt RUN mkdir /code;mkdir /code/models COPY ./python_api.py ./talking_hat.py ./letter.py ./request.py /code/ COPY ./models/* /code/models/ WORKDIR /code CMD python3 /code/python_api.py</span></span></code> </pre> <br><p>    : </p><br><pre> <code class="bash hljs">docker build -t talking_hat . &amp;&amp; docker rm talking_hat &amp;&amp; docker run --name talking_hat -p 5000:5000 talking_hat</code> </pre> <br><h2 id="testirovanie-prodakshn-modeli">    </h2><br><p>     ‚Äî            .  ,         <a href="httpd.apache.org/docs/2.4/programs/ab.html">Apache Benchmark</a> .      ,      .  ‚Äî  . </p><br><pre> <code class="bash hljs">$ ab -p data.json -T application/json -c 50 -n 10000 http://0.0.0.0:5000/predict</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> ab</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">This is ApacheBench, Version 2.3 &lt;$Revision: 1807734 $&gt; Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking 0.0.0.0 (be patient) Completed 1000 requests Completed 2000 requests Completed 3000 requests Completed 4000 requests Completed 5000 requests Completed 6000 requests Completed 7000 requests Completed 8000 requests Completed 9000 requests Completed 10000 requests Finished 10000 requests Server Software: Werkzeug/0.14.1 Server Hostname: 0.0.0.0 Server Port: 5000 Document Path: /predict Document Length: 141 bytes Concurrency Level: 50 Time taken for tests: 238.552 seconds Complete requests: 10000 Failed requests: 0 Total transferred: 2880000 bytes Total body sent: 1800000 HTML transferred: 1410000 bytes Requests per second: 41.92 [#/sec] (mean) Time per request: 1192.758 [ms] (mean) Time per request: 23.855 [ms] (mean, across all concurrent requests) Transfer rate: 11.79 [Kbytes/sec] received 7.37 kb/s sent 19.16 kb/s total Connection Times (ms) min mean[+/-sd] median max Connect: 0 0 0.1 0 3 Processing: 199 1191 352.5 1128 3352 Waiting: 198 1190 352.5 1127 3351 Total: 202 1191 352.5 1128 3352 Percentage of the requests served within a certain time (ms) 50% 1128 66% 1277 75% 1378 80% 1451 90% 1668 95% 1860 98% 2096 99% 2260 100% 3352 (longest request)</code> </pre> </div></div><br><p>     ,      : </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">prod_predict_classes_for_name</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(full_name)</span></span></span><span class="hljs-function">:</span></span> &lt;...&gt; predictions = get_predctions_vector([ app.slitherin_model, app.griffindor_model, app.ravenclaw_model, app.hufflpuff_model ], person_df.drop([<span class="hljs-string"><span class="hljs-string">'name'</span></span>, <span class="hljs-string"><span class="hljs-string">'surname'</span></span>], axis=<span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">'slitherin'</span></span>: float(predictions[<span class="hljs-number"><span class="hljs-number">0</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-string"><span class="hljs-string">'griffindor'</span></span>: float(predictions[<span class="hljs-number"><span class="hljs-number">1</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-string"><span class="hljs-string">'ravenclaw'</span></span>: float(predictions[<span class="hljs-number"><span class="hljs-number">2</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]), <span class="hljs-string"><span class="hljs-string">'hufflpuff'</span></span>: float(predictions[<span class="hljs-number"><span class="hljs-number">3</span></span>][<span class="hljs-number"><span class="hljs-number">1</span></span>]) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_app</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> &lt;...&gt; <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> app.app_context(): app.slitherin_model = pickle.load(open(<span class="hljs-string"><span class="hljs-string">"models/slitherin.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)) app.griffindor_model = pickle.load(open(<span class="hljs-string"><span class="hljs-string">"models/griffindor.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)) app.ravenclaw_model = pickle.load(open(<span class="hljs-string"><span class="hljs-string">"models/ravenclaw.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)) app.hufflpuff_model = pickle.load(open(<span class="hljs-string"><span class="hljs-string">"models/hufflpuff.xgbm"</span></span>, <span class="hljs-string"><span class="hljs-string">"rb"</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> app</code> </pre> <br><p>    : </p><br><pre> <code class="bash hljs">$ docker build -t talking_hat . &amp;&amp; docker rm talking_hat &amp;&amp; docker run --name talking_hat -p 5000:5000 talking_hat $ ab -p data.json -T application/json -c 50 -n 10000 http://0.0.0.0:5000/predict</code> </pre> <br><div class="spoiler"> <b class="spoiler_title"> ab</b> <div class="spoiler_text"><pre> <code class="plaintext hljs">This is ApacheBench, Version 2.3 &lt;$Revision: 1807734 $&gt; Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/ Licensed to The Apache Software Foundation, http://www.apache.org/ Benchmarking 0.0.0.0 (be patient) Completed 1000 requests Completed 2000 requests Completed 3000 requests Completed 4000 requests Completed 5000 requests Completed 6000 requests Completed 7000 requests Completed 8000 requests Completed 9000 requests Completed 10000 requests Finished 10000 requests Server Software: Werkzeug/0.14.1 Server Hostname: 0.0.0.0 Server Port: 5000 Document Path: /predict Document Length: 141 bytes Concurrency Level: 50 Time taken for tests: 219.812 seconds Complete requests: 10000 Failed requests: 3 (Connect: 0, Receive: 0, Length: 3, Exceptions: 0) Total transferred: 2879997 bytes Total body sent: 1800000 HTML transferred: 1409997 bytes Requests per second: 45.49 [#/sec] (mean) Time per request: 1099.062 [ms] (mean) Time per request: 21.981 [ms] (mean, across all concurrent requests) Transfer rate: 12.79 [Kbytes/sec] received 8.00 kb/s sent 20.79 kb/s total Connection Times (ms) min mean[+/-sd] median max Connect: 0 0 0.1 0 2 Processing: 235 1098 335.2 1035 3464 Waiting: 235 1097 335.2 1034 3462 Total: 238 1098 335.2 1035 3464 Percentage of the requests served within a certain time (ms) 50% 1035 66% 1176 75% 1278 80% 1349 90% 1541 95% 1736 98% 1967 99% 2141 100% 3464 (longest request)</code> </pre> </div></div><br><p>  Is done.   .         ,          . </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>            ,             .       -     . </p><br><p> ,     : </p><br><ul><li>    feature engineering-     ( <a href="https://habr.com/post/28752/"> </a>  ),  , <a href="https://medium.com/%40yash_agarwal2/soundex-and-levenshtein-distance-in-python-8b4b56542e9e">Soundex</a>     . </li><li>    <a href="https://pytorch.org/tutorials/intermediate/char_rnn_classification_tutorial.html"></a>   PyTorch        .       ,        ,         . </li><li>     flask   <a href="https://pgjones.gitlab.io/quart/">Quart</a> ,        ,          . </li><li>    -  -,     . </li></ul><br><p>      ,           ,     .   ,  ! </p><br><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This article would not have been published without the Open Data Science community, which brings together a large number of Russian-speaking data analysis specialists. </font></font></p><cut></cut></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/430006/">https://habr.com/ru/post/430006/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429996/index.html">Network administrator in the era of clouds</a></li>
<li><a href="../429998/index.html">Scientific ways to improve attention: nootropics, neural interfaces and electrostimulation</a></li>
<li><a href="../430000/index.html">The last of the Mohicans. The oldest CEO in the Fortune 500 puts everything on the fall of smartphones</a></li>
<li><a href="../430002/index.html">Red Hat Enterprise Linux 8 Beta - at the same time with the world</a></li>
<li><a href="../430004/index.html">Uncertified GPS tracker from China. Is it legal in Russia?</a></li>
<li><a href="../430008/index.html">Ugears: horses, sailboats and other royal entertainment</a></li>
<li><a href="../430010/index.html">Open lesson "How not to: anti-examples in the analysis of business processes"</a></li>
<li><a href="../430016/index.html">Embarrassed scientists admit that they still do not know the exact value of the gravitational interaction.</a></li>
<li><a href="../430024/index.html">How a plane crash can improve analysis of IT packs</a></li>
<li><a href="../430026/index.html">Nio places 18 battery change stations covering more than 2,000 km of motorways.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>