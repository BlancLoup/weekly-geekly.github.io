<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Pipe, the pythonic way</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some Pythonists love the code to be read, others prefer concise. Unfortunately, the balance between the first and second ‚Äî solutions that are truly el...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Pipe, the pythonic way</h1><div class="post__text post__text-html js-mediator-article">  Some Pythonists love the code to be read, others prefer concise.  Unfortunately, the balance between the first and second ‚Äî solutions that are truly elegant ‚Äî rarely happens in practice.  More often lines like <br><pre><code class="python hljs">my_function(sum(filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>, [x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>)])))</code> </pre>  Or quatrains a la <pre> <code class="python hljs">xs = [x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>)] xs_filtered = filter(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>, xs) xs_sum = sum(xs_filtered) result = my_function(xs_sum)</code> </pre>  Idealists would like to write something like this <pre> <code class="python hljs">result = [x <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">100</span></span>)] \ | where(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x % <span class="hljs-number"><span class="hljs-number">3</span></span> == <span class="hljs-number"><span class="hljs-number">1</span></span>)) \ | sum \ | my_function</code> </pre><br>  Not in Python? <br><a name="habracut"></a><br>  A simple implementation of such chains was recently proposed by a certain Julien Palard in his library <a href="https://github.com/JulienPalard/Pipe">Pipe</a> . <br><br>  Let's start right away with an example: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pipe <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> * [<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>] | where(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x&lt;=<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-comment"><span class="hljs-comment">#&lt;generator object &lt;genexpr&gt; at 0x88231e4&gt;</span></span></code> </pre><br>  Oops, the intuitive rush is not rolled.  The pipe returns a generator, the values ‚Äã‚Äãfrom which are yet to be extracted. <br><pre> <code class="python hljs">[<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>] | where(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x&lt;=<span class="hljs-number"><span class="hljs-number">2</span></span>) | as_list <span class="hljs-comment"><span class="hljs-comment">#[1, 2]</span></span></code> </pre><br>  It would be possible to pull the values ‚Äã‚Äãout of the generator with the built-in cast function of the type list (), but the author of the tool was consistent in his research and offered us the function as_list. <br><br>  As you can see, the data source for the payp in the example was a simple list.  Generally speaking, you can use any iterable entities of Python.  Let's say ‚Äúpairs‚Äù (tuples) or, which is more interesting, the same generators: <br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fib</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">u"""    """</span></span> a, b = <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> a a, b = b, a + b fib() | take_while(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: x&lt;<span class="hljs-number"><span class="hljs-number">10</span></span>) | as_list <span class="hljs-comment"><span class="hljs-comment">#0 #1 #1 #2 #3 #5 #8</span></span></code> </pre>  From here you can learn a few lessons: <ol><li>  in pipes you can use lists, ‚Äúpairs‚Äù, generators - any iterables. </li><li>  the result of combining generators into chains will be a generator. </li><li>  without an explicit requirement (type conversion or special pipe), the piping is ‚Äúlazy‚Äù in the sense that the chain is a generator and can serve as an infinite source of data. </li></ol><br>  Of course, the joy would be incomplete if we did not have an easy opportunity to create our own pipes.  Example: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@Pipe def custom_add(x): return sum(x) [1,2,3,4] | custom_add #10</span></span></code> </pre>  Arguments?  Easy: <br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">@Pipe def sum_head(x, number_to_sum=2): acc = 0 return sum(x[:number_to_sum]) [1,2,3,4] | sum_head(3) #6</span></span></code> </pre>  The author has kindly provided a lot of the prepared pipe.  Some of them: <ul><li>  count - recalculate the number of elements of the incoming iterable </li><li>  take (n) - extracts the first n elements from the input iterable. </li><li>  tail (n) - extracts the last n elements. </li><li>  skip (n) - skip the first n elements. </li><li>  all (pred) - returns True if all iterable elements satisfy the predicate pred. </li><li>  any (pred) - returns True if at least one iterable element satisfies the predicate pred. </li><li>  as_list / as_dist - leads iterable to the list / dictionary, if such a conversion is possible. </li><li>  permutations (r = None) - makes up all possible combinations of r elements of the input iterable.  If r is not defined, then r is taken as len (iterable). </li><li>  stdout - output the iterable as a whole to a standard stream after a cast to a string. </li><li>  tee - output an iterable element to the standard stream and pass it for further processing. </li><li>  select (selector) - pass the elements iterable for further processing, after applying the function selector to them. </li><li>  where (predicate) - pass an iterable that satisfies the predicate to predicate. </li></ul>  But these are more interesting: <ul><li>  netcat (host, port) - for each iterable element, open a socket, pass the element itself (of course, string), and pass the host response for further processing. </li><li>  netwrite (host, port) - the same thing, just do not read from the socket after sending data. </li></ul>  These and other pipes for sorting, traversing and processing data flow are included by default in the module itself, the benefit of which is really easy to create. <br><h3>  Under the hood of the Pipe Decorator </h3><br>  Frankly, it was amazing to see how concise the base code of the module!  Judge for yourself: <br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Pipe</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, function)</span></span></span><span class="hljs-function">:</span></span> self.function = function <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__ror__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, other)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.function(other) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__call__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Pipe(<span class="hljs-keyword"><span class="hljs-keyword">lambda</span></span> x: self.function(x, *args, **kwargs))</code> </pre>  That's all, actually.  Ordinary decorator class. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the constructor, the decorator saves the function being decorated, turning it into an object of the class Pipe. <br><br>  If the pipe is called by the __call__ method, a new pipe function is returned with the specified arguments. <br><br>  The main subtlety is the __ror__ method.  This is an inverted operator, an analogue of the operator ‚Äúor‚Äù (__or__), which is called on the right operand with the left operand as an argument. <br><br>  It turns out that the calculation of the chain starts from left to right.  The first element is passed as an argument to the second;  the result of calculating the second - the third, and so on.  Painlessly pass through the chain and generators. <br><br>  In my opinion, very, very elegant. <br><br><h3>  Afterword </h3><br>  The syntax for this kind of pipe is really simple and convenient, I would like to see something similar in popular frameworks;  let's say for processing data streams;  or - in a declarative form - alignment in the chain of callbacks. <br><br>  The only drawback of the implementation is the rather vague error traces. <br><br>  On the development of ideas and alternative implementation - in the following articles. </div><p>Source: <a href="https://habr.com/ru/post/117679/">https://habr.com/ru/post/117679/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../117672/index.html">Widgets. Custom fonts</a></li>
<li><a href="../117674/index.html">We will get rid of unnecessary bla-bla-bla in emails</a></li>
<li><a href="../117675/index.html">Accelerate Visual Studio Part III. IDE performance</a></li>
<li><a href="../117677/index.html">Doc, is this rubbish ?! Here we need it</a></li>
<li><a href="../117678/index.html">"Enemies of the People" Massive Multi-User Socio-Political Platform</a></li>
<li><a href="../117681/index.html">Books for startups</a></li>
<li><a href="../117682/index.html">Student laboratories ABBYY</a></li>
<li><a href="../117684/index.html">Key features of CUBRID 8.4.0</a></li>
<li><a href="../117685/index.html">Glimpse - server "firebug" for ASP.NET projects</a></li>
<li><a href="../117686/index.html">Creating py2exe builds with Python modules containing third-party files</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>