<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to overcome common graphics artifacts</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Artists drew bright graphics, programmers built it into the game, animators added movement - it would seem, everything is ready. But no, managers do n...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to overcome common graphics artifacts</h1><div class="post__text post__text-html js-mediator-article">  Artists drew bright graphics, programmers built it into the game, animators added movement - it would seem, everything is ready.  But no, managers do not like: <br><br><blockquote>  <i>‚ÄúWe need to remove gray spots and white lines.</i>  <i>Here the pulsating button twitches, there the progress bar goes up the ladder. ‚Äù</i> </blockquote><br>  You look at game resources - there‚Äôs nothing in them, all sprites are cut off.  You read the code - the formulas are correct, the accuracy of the shader is enough.  But the result was still unimportant.  Where is the mistake? <br><br> <a href="https://habrahabr.ru/company/playrix/blog/336304/"><img src="https://habrastorage.org/getpro/habr/post_images/769/c85/d20/769c85d203eb4cc95b4d5e75e4393f17.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      A small survey for those who already know where the artifacts come from.  What to do in this situation? <br><br><ol><li>  Need a powerful graphics card and fresh drivers; </li><li>  It is worth making downloadable graphics sets for all possible screen resolutions; </li><li>  Square textures with a size of two do not have such problems; </li><li>  This is all due to the compression of graphics (PVRTC / DXT5 / ETC1 / ...); </li><li>  In a graphics editor, you'll have to slightly smudge the edges; </li><li>  It should have turned out this way, because we have not prepared graphic data; </li><li>  Only anti-aliasing will help; </li><li>  Looking for textures and targets in premultiplied alpha mode. </li></ol><br>  What answer option is correct, why exactly it and how to overcome graphics artifacts read under the cut. <br><a name="habracut"></a><br><h2>  Bilinear texture filtering </h2><br>  On mobile platforms, <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D0%25BB%25D0%25B8%25D0%25BD%25D0%25B5%25D0%25B9%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D1%2580%25D0%25BF%25D0%25BE%25D0%25BB%25D1%258F%25D1%2586%25D0%25B8%25D1%258F">bilinear texture filtering is</a> used so that sprites can move smoothly and at different resolutions do not spread out to pixels.  In terms of OpenGL ES, this is the <a href="">GL_LINEAR</a> parameter: <br><br><pre><code class="hljs lisp">glTexParameteri(<span class="hljs-name"><span class="hljs-name">GL_TEXTURE_2D</span></span>, GL_TEXTURE_MIN_FILTER, GL_LINEAR)<span class="hljs-comment"><span class="hljs-comment">; glTexParameteri(GL_TEXTURE_2D, GL_TEXTURE_MAG_FILTER, GL_LINEAR);</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/ef5/ee7/96b/ef5ee796b618b8837378a50095fcce94.png"></div><br>  <i><font color="#999999">4x magnification example (center GL_NEAREST, right GL_LINEAR).</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6af/d1e/e40/6afd1ee40f06968da91506709f1a5cf9.png"></div><br>  <i><font color="#999999">Example of a decrease of 2 times (center GL_NEAREST, right GL_LINEAR).</font></i> <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f3b/f0b/3e0/f3bf0b3e0e2e67b83b6b3dc9d0c6a04b.png"></div><br>  <i><font color="#999999">In the game, white artifacts are visible near tree branches, although there is nothing in the editor.</font></i>  <i><font color="#999999">According to the description, everything is like <a href="http://doom2d.org/forum/viewtopic.php%3Ff%3D16%26t%3D180">here.</a></font></i> <br><br>  When a texture is drawn with a scale other than 1.0 or with fractional coordinates, color artifacts appear on the border with transparency.  The fact is that OpenGL ES for ordinary RGBA textures first independently interpolates the R, G, B, A channels, and only then this result is mixed with the screen.  If for a channel with alpha (A) interpolation looks natural, then for color channels R, G, B, previously invisible pixels begin to affect the visible neighbors on the boundary of the object. <br><br>  As one of the solutions to the problem, it is proposed to use textures with a pre-multiplied alpha ( <a href="https://blogs.msdn.microsoft.com/shawnhar/2009/11/06/premultiplied-alpha">premultiplied alpha</a> ), then interpolation will occur without artifacts.  It is the premultiplied alpha mode that is useful when drawing graphics to a target, in particular when self-implementing smoothing of 3D models using OpenGL ES 2.0. <br><br>  An alternative solution is to add strokes in transparent areas.  To do this, transparent pixels borrow a color from an opaque neighbor or average colors from several opaque neighbors.  Such a calculation is conveniently carried out by the wave front from the transparent to opaque border. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d0/adf/5a6/5d0adf5a655498f0ddf7cebc3b1a666b.png"></div><br>  <i><font color="#999999">Example of a 2-pixel stroke in a transparent area (far right)</font></i> <br><br>  In addition, you can collect graphic sets for all permissions and draw sprites only in whole coordinates.  On retina-screens, the movement will be fairly smooth.  Only here there will be a lot of graphics. <br><br><h2>  Pixel shaders </h2><br>  One has only to think about how the texture is drawn in non-integer coordinates on a unit scale, how the border aliasing problem immediately arises.  The fact is that iron calculates physical pixels in the pixel shader, and for our fractional border, the texture coordinates s, t are shifted beyond [0..1].  In the <a href="">GL_CLAMP_TO_EDGE</a> mode <a href="">,</a> when the texture is <a href="">overrun</a> , the frame is duplicated.  For textures that fit, this is normal, but for various sprites there are thickenings. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e95/cb2/47c/e95cb247c80a0e60a18bee5f2fc32859.png"></div><br>  In order not to ruffle the edges of the sprite, it is enough to make a single-pixel (for scale 1) or 2-pixel (for scale 0.5) transparent frame and draw it as part of the sprite.  In other words, the trim command in the graphical editor not only removes transparency, but also adds to the aliasing problem.  Therefore, it would be more correct to trim, and after it to increase the canvas relative to the center by 2 pixels (normal graphics) or 4 pixels (retina graphics with the possibility of downscale). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/667/117/b92/667117b9234b2645464fe87ae9b0d4d7.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4ad/bef/9da/4adbef9dadcb6e4074a50c5a83616c0a.png"></div><br>  <i><font color="#999999">An example of border aliasing (above) and smooth motion (below)</font></i> <br><br>  For 3D, by the way, the overdraw idea <a href="http://hhoppe.com/overdraw.pdf">also works</a> , but the implementation requires preliminary calculations and the formation of additional triangles with transparency. <br><br><h2>  Atlases </h2><br>  When a texture is placed in an atlas, the <a href="">GL_CLAMP_TO_EDGE</a> mode property is lost, because now it works on the borders of the entire atlas.  And since there is no duplication of boundaries for the elements of the atlas, then the joints may break. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/998/155/b7e/998155b7e024f33e29fcc396ef9a475c.png"></div><br>  <i><font color="#999999">Gaps in honey when putting textures into satin</font></i> <br><br>  Here, the duplication of the outer boundary of the joining elements in the atlas itself comes to the rescue.  The size of the frame depends on the scale of rendering, usually 1-2 pixels are enough.  With a scale&gt; = 1, a single pixel frame is sufficient.  Only in the case of reduction requires 2 or more pixels. <br><br><h2>  Compressed atlases </h2><br>  In order for the game to work on devices with a small amount of RAM, it is necessary to compress atlases in one of the available formats: PVRTC, ETC1, DXT1, DXT5, ETC2, etc. <br><br>  The peculiarity of these hardware formats is the division of the whole texture into 4x4 blocks and further lossy compression.  In addition to blockiness, no more than 2 basic colors are usually available for each block.  As a result, all 16 pixels of a block are obtained by choosing from 4 possible values, calculated in some way based on the base colors. <br><br>  For formats with independent blocks ( <a href="https://habrahabr.ru/company/playrix/blog/310484/">ETC1 / 2</a> , DXT1 / 5), it suffices to expand each element that fits in a regular atlas to a rectangle with a size of 4 pixels.  In this case, the neighboring elements will not affect each other. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e31/9c6/904/e319c69045b52c1206250db55ff736c9.png"></div><br>  <i><font color="#999999">An example of the separation of elements of atlas in 4x4 blocks</font></i> <br><br>  For the <a href="http://fileadmin.cs.lth.se/cs/Education/EDA075/notes/fenney03texcomp.pdf">PVRTC</a> format, where colors of 4 adjacent blocks affect almost every pixel, it is necessary to dilute the elements of the atlas by a distance of 4 pixels.  This is achieved by forming a 2-pixel protective area along the contour of each atlas element, and the useful area is centered in this case. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/698/a26/6ea/698a266eae70a0225c0877fd681d3e70.png"><br><br>  For <a href="https://habrahabr.ru/company/playrix/blog/306554/">polygonal atlases</a> helps to maintain the distance between adjacent elements. <br><br><h2>  Results </h2><br>  The considered methods are united by special processing of graphic data: both separate textures and elements of atlas.  Such processing is well automated and, as a rule, does not distract employees from the creative process. <br><br>  Therefore, in the survey the most general correct answer is 6, ‚ÄúIt should have been like this, because we did not prepare graphic data.‚Äù  I note that this does not detract from the usefulness of other methods. <br><br>  Now is the time to think and ask: ‚ÄúWhat can a used resource collector do and is it provided for the preparation of graphic data by processes?‚Äù <br><br>  <b>PS</b> Comments on the considered methods are welcome, as well as information on other effective ways of dealing with artifacts in 2D graphics. </div><p>Source: <a href="https://habr.com/ru/post/336304/">https://habr.com/ru/post/336304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../336294/index.html">Understanding the V8 bytecode</a></li>
<li><a href="../336296/index.html">A simple exploit gives attackers the opportunity to change the contents of the letter after sending</a></li>
<li><a href="../336298/index.html">Check Point SMB Solutions. New models for small companies and branches</a></li>
<li><a href="../336300/index.html">KOMPAS-3D viewer for Android: the experience of porting a large Windows application</a></li>
<li><a href="../336302/index.html">Analysis of MS SQL Server, for those who see it for the first time</a></li>
<li><a href="../336306/index.html">Explore and optimize Object # toString performance in ES2015</a></li>
<li><a href="../336308/index.html">Overview of one Russian RTOS</a></li>
<li><a href="../336310/index.html">Install and configure the main scene in MajorDoMo</a></li>
<li><a href="../336312/index.html">Good bad monkey patching</a></li>
<li><a href="../336314/index.html">We consider the tasks of the hackathon from Promsvyazbank. Why can a hackathon?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>