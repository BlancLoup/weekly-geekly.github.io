<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Through the thorns to the assembly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello dear readers. I am a developer at RTL Service, in which my product development responsibilities overlap with DevOps. More specifically, I create...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Through the thorns to the assembly</h1><div class="post__text post__text-html js-mediator-article">  Hello dear readers.  I am a developer at RTL Service, in which my product development responsibilities overlap with DevOps.  More specifically, I create and maintain the infrastructure of the assembly and initial testing of our products before they enter the testing department. <br><br>  This article will tell you what path the code goes from pushing the repository of the version control system to generating the deb package and placing the packages into our repository. <br><a name="habracut"></a><br>  As a CI server (continuous integration), we use Hudson, you can throw slippers at me, but we are guided by the principle ‚ÄúIt works - do not touch‚Äù.  In the future, there are plans to try TeamCity or Jenkins. <br><br><h3>  General information about tasks and groups on our CI server. </h3><br>  All tasks for assemblies are divided into 5 large groups: <br>  ‚óè Firmware (device firmware build, they are beyond the scope of this article, but the first and second build steps are the same as for other build objects) <br>  ‚óè Server (core server builds) <br>  ‚óè Appserver (application server builds) <br>  ‚óè Webclient (web interface assemblies) <br>  ‚óè Tests (running a full functional test, etc.) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Step 1: Commit to version control system. </h3><br>  It's all pretty trivial.  With the help of hooks from the version control server, a GET request is sent to the CI server, the result of which will be the launch of a parameterized assembly (what it is and what it will be described below). <br>  Example post-commit hook: <br><br><pre><code class="bash hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-built_in"><span class="hljs-built_in">read</span></span> orev nrev ref <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$ref</span></span></span><span class="hljs-string">"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> refs/heads/i*) issue_branch=<span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">${ref##refs/heads/}</span></span></span><span class="hljs-string">"</span></span> curl -X GET <span class="hljs-string"><span class="hljs-string">"http://_ci_/‚Ä¶./buildWithParameters?ISSUE_BRANCH=</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$issue_branch</span></span></span><span class="hljs-string">"</span></span> ;; <span class="hljs-keyword"><span class="hljs-keyword">esac</span></span> <span class="hljs-keyword"><span class="hljs-keyword">done</span></span></code> </pre> <br><h3>  Step 2: Run the parameterized build. </h3><br>  As the name implies, is an assembly that can have various parameters.  In our case, there is usually a couple-three, for example, the name of the branch and the name of the product.  Such an approach allows not to produce tasks that differ from each other in non-critical moments. <br><br>  At this stage, the primary build takes place, for example, for a java project it will work with the gradle in the most primitive version, which looks like a ‚Äúgradle clean build‚Äù. <br><br>  This will allow you to identify random shortcomings in the code of a multi-module project and drive unit tests away. <br><br><h3>  Step 3: Run smoke testing. </h3><br>  This step is performed as part of the parameterized assembly.  Smoke tests are performed within the slave of the machine on which the build task is started.  This approach allows building and initial testing of various software (for example, an application server and a web client) in parallel, which reduces the waiting time for a new version by the testing department.  At the same time, developers receive information about the problems they encountered earlier. <br><br>  It is quite obvious that within the framework of these tests it is verified that after assembling the code (new or revised) the installed application starts and performs the main functions.  In our company, depending on the project, they are written in different frameworks (for example, cucumber). <br><br>  Here we will need the build parameters that we passed, because  For different products, as in the case of acceptance testing, smoke testing scripts can vary greatly. <br><br><h3>  Step 4: Run acceptance testing. </h3><br>  At this stage, product acceptance testing is performed with different scenarios.  I do not see any reason to paint it, because  On this subject there are articles on Habr√© and the corresponding resources. <br><br><h3>  Step 5: Build a deb package. </h3><br>  Since our system is designed for a Debian distribution, the most obvious and convenient tool will be its native binary distribution package deb.  About the structure of the package on Habr√© there are articles that can be found.  I will tell you about some tricks that are used here. <br><br>  First of all, you need to get a project revision for versioning and the ability to update a package directly from the repository via apt-get update and apt-get install. <br><br>  To do this, we use the standard feature of the git "git describe", if you wish, you can get the build number in accordance with the tag by adding the - tags option.  Usually, under a new minor version, we get our own tag. <br><br>  By parsing this in a regular expression, we get something like ‚Äú1075-g7fb7c67‚Äù, which will be the number of our revision.  Coupled with the name and version of the product, we get the full name of our package, in our case we get something like ‚Äúrtls-webclient-mines-1.0-dev_1.0-dev.1075-g7fb7c67_all.deb‚Äù. <br><br>  Actually, for the assembly itself, we use the bash script.  The bottom line is that it creates a build directory and puts templates for creating a package there.  Further, depending on the product name, it puts the necessary modules and processes the template of the config file in the DEBIAN folder, using the sed command, writes up-to-date information about the package, having the information obtained above (for example with a revision, it looks like this: ‚Äúsed -e‚Äù s /% REVISION% / $ REV / "-i $ PACKAGE / DEBIAN / control"). <br><br>  After preparing the build directory with fakeroot, the deb package itself is created with the command ‚Äúdpkg-deb - build $ TMP_DIR $ {NAME} _ $ {VERS}. $ {REV} _all.deb‚Äù, where TMP_DIR is the build directory, NAME is the name of the product .  VERS - version, and REV - pulled out revision.  Then, using wput, the received packet is put into the repository, and the packet for sending is sent to the testing department. <br><br><h3>  Step 6: Work with the bug tracker. </h3><br>  We use redmine as a tracker bug, and the corresponding script is written for it, which determines the presence of the ticket number in the commit, and if there is one, the service user commented on the packet name in which the bug fix was applied.  This allows the testing department to check for fixes almost immediately. <br><br><h3>  Step 7 (optional): </h3><br>  Every night we run the tasks of a full-featured testing system and with the help of the appropriate checkbox in the settings of the assembly triggers, which give us an understanding of the overall status of the project. <br><br>  Good Build Example <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/818/f76/57d/818f7657da2fef5e92528da29d7569fc.jpg" alt="image" width="850"></div><br><br>  An example of a collapsed assembly due to a failed test.  The development team was notified and the last committer fixed the problem: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/119/8ad/770/1198ad7702decfda800aef2c894aff44.jpg" alt="image" width="850"></div></div><p>Source: <a href="https://habr.com/ru/post/307398/">https://habr.com/ru/post/307398/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307384/index.html">What is software engineering. Lecture in Yandex</a></li>
<li><a href="../307388/index.html">Semantic line break</a></li>
<li><a href="../307392/index.html">Spring / Jackson + @JsonView: filtering JSON</a></li>
<li><a href="../307394/index.html">The most expensive and momentous mistakes in the IT industry</a></li>
<li><a href="../307396/index.html">Country lessons learned: blockchain - the experience of the first pilot projects</a></li>
<li><a href="../307402/index.html">Forge personnel: how testers learned and blacksmiths were tempered</a></li>
<li><a href="../307404/index.html">An additional 400 million video impressions are now available in GetIntent DSP</a></li>
<li><a href="../307406/index.html">Programming is boring, but ...</a></li>
<li><a href="../307408/index.html">How trading on a stock exchange actually works: A simple algorithm (part 2)</a></li>
<li><a href="../307410/index.html">How to improve email addresses</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>