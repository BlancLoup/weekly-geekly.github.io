<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Symfony 2 and Doctrine 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="While continuing to learn Symfony 2, I decided to describe the use of the framework in conjunction with Doctrine 2, since this is one of the most freq...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Symfony 2 and Doctrine 2</h1><div class="post__text post__text-html js-mediator-article">  While continuing to learn Symfony 2, I decided to describe the use of the framework in conjunction with Doctrine 2, since this is one of the most frequently asked questions.  And it is worth noting Doctrine 2 also underwent major changes in comparison with the 1.x branch.  By itself, the Doctrine project is so large that a description of it will probably draw on a small but interesting book.  Therefore, I will only very briefly describe an example of using Doctrine 2 in Symfony 2, which allows you to figure out how to run this bundle and do it on the example of a very small and simple application. <br><a name="habracut"></a><br><h4>  About Doctrine 2 </h4><br>  For a start, a brief introduction on Doctrine 2. The project is now divided into three packages: <br><ul><li>  Common </li><li>  DBAL </li><li>  ORM </li></ul><br>  <strong>Common</strong> - contains common components that are used in other packages. <br>  <strong>DBAL</strong> is a database access abstraction layer. <br>  <strong>ORM</strong> - Object Relational Mapping Tools <br><br>  Doctrine 2 does not have the usual classes * Table and * Record, which were before.  This also means that now the model classes do not need to inherit the * Record classes, and the table classes inherit the * Table classes from the Doctrine package.  Instead, two new concepts of ‚ÄúEntity‚Äù and ‚ÄúEntityManager‚Äù are introduced.  ‚ÄúEntity‚Äù is, roughly speaking, a model object, and ‚ÄúEntityManager‚Äù is a class that allows you to manage objects ‚ÄúEntity‚Äù, respectively.  Interestingly, ‚ÄúEntity‚Äù can be any PHP class and should not inherit any classes from the Doctrine package. <br><br>  In Doctrine 1, the models were described in the Yaml file, but now you can use Yaml, XML or Docblock Annotations for this.  In one form or another, Docblock annotations probably had to be used by everyone, for example, to describe methods under a PHPDocumentor.  So now you can also describe the metadata of persistent objects. <br>  Example: <br><blockquote><code><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> <font color="black">Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> <ol> <li> <code><font color="black"><font color="#cc6633"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML &lt;?php <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/6902/s"></a> <a href="http://s-c.me/6902/h"></a> Copy Source | Copy HTML <font color="#cc6633">&lt;?php</font> <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table(name="my_model")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">class</font> MyModel { <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Id @Column(name="id", type="integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue(strategy="AUTO")</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$id</font> ; <font color="#696969">/**</font> &lt;br/&gt; <font color="#696969">* @Column(name="title", type="string", length=255)</font> &lt;br/&gt; <font color="#696969">*/</font> <font color="#0000ff">private</font> <font color="#cc6633">$title</font> ; }</font></code> </li> </ol></blockquote>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And of course you can read about all this and many other things on <a href="http://www.doctrine-project.org/documentation/manual/2_0/en">the Doctrine website.</a> <br><br><h4>  We take off </h4><br>  I decided to consider using Doctrine 2 using a very small and very simple application.  This will be the Readlater service, which allows you to save links in order to postpone reading something until later.  That is, all its functionality is reduced to three simple actions: <br><ul><li>  display a list of links </li><li>  add link </li><li>  delete link </li></ul><br>  But I immediately ran into a small problem - and Doctrine 2 and Symfony 2 are now being actively developed and there is no question of any stability.  Moreover, everything changes very often and what works today may not take off tomorrow.  Often these are various little things, like transferring code to another directory.  Therefore, for this application I decided to freeze the versions of the libraries used.  For this, I took: <br><ul><li>  <a href="http://github.com/symfony/symfony-sandbox">symfony-sandbox</a> : a sandbox based on it, everything was built </li><li>  <a href="http://github.com/jwage/symfony">symfony</a> : a <a href="http://github.com/jwage/symfony">symfony</a> fork from Jonathan Wage of the developer Doctrine </li><li>  <a href="http://github.com/jwage/migrations">doctrine migrations</a> : migrations </li><li>  <a href="http://svn.doctrine-project.org/trunk/">doctrine</a> : trunk doctrine </li></ul><br>  Having collected it all together, I froze all versions on April 18, 2010 in the form in which they were and laid out with my application on <a href="http://github.com/poulikov/readlater">github</a> .  So if you're interested, go for it. <br><br><h4>  Flew </h4><br>  So, the first is briefly about the structure.  Approximately this type of directory: <br><ul><li>  <strong>readlater</strong> : - application directory </li><li>  <strong>src</strong> <ul><li>  <strong>Application</strong> : - ReadlaterBundle ‚Äúbundle‚Äù will lie here and in general we will code there too. </li><li>  <strong>Bundle</strong> : - in this case it's empty </li><li>  <strong>vendor</strong> : - here is the framework and all libraries </li></ul></li></ul><br>  Let's start with configs.  In <strong>readlater / config / config.yml</strong> add: <br><blockquote> <code><a href="http://s-c.me/6903/s"></a> <a href="http://s-c.me/6903/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  kernel.  <font color="#2b91af">config</font> : ~ </li><li>  <font color="#2b91af">web</font> .  <font color="#2b91af">web</font> : ~ </li><li>  <font color="#2b91af">web</font> .  <font color="#2b91af">templating</font> : ~ </li><li>  doctrine.  <font color="#2b91af">dbal</font> : </li><li>  <font color="#2b91af">default_connection</font> : <font color="#2b91af">default</font> </li><li>  <font color="#2b91af">connections</font> : </li><li>  <font color="#2b91af">default</font> : </li><li>  <font color="#2b91af">driver</font> : PDOMySql </li><li>  <font color="#2b91af">dbname</font> : sfbox2 </li><li>  <font color="#2b91af">user</font> : root </li><li>  <font color="#2b91af">password</font> : <font color="#008000">123</font> </li><li>  <font color="#2b91af">host</font> : localhost </li><li>  <font color="#2b91af">event_manager_class</font> : Doctrine \ Common \ EventManager </li><li>  <font color="#2b91af">configuration_class</font> : Doctrine \ DBAL \ Configuration </li><li></li><li>  doctrine.  <font color="#2b91af">orm</font> : </li><li>  <font color="#2b91af">default_entity_manager</font> : <font color="#2b91af">default</font> </li><li>  <font color="#2b91af">cache_driver</font> : array </li><li>  <font color="#2b91af">entity_managers</font> : </li><li>  <font color="#2b91af">default</font> : </li><li>  <font color="#2b91af">connection</font> : <font color="#2b91af">default</font> </li></ol></blockquote><br>  I described the connection to the <strong>doctrine.dbal</strong> database and the settings for the Doctrine \ ORM <strong>doctrine.orm</strong> package <br>  I will not describe here the creation of the application kernel, since it is almost the same as what goes into symfony-sandbox. <br>  Therefore, I will go to <strong>ReadlaterBundle</strong> , which I will put in <strong>src / Application</strong> .  The structure of the bundle is: <br><ul><li>  <strong>Controller</strong> : - here are the controllers </li><li>  <strong>Entities</strong> : - here are those Entity, classes of models </li><li>  <strong>Resources</strong> <ul><li>  <strong>config</strong> : - here are the settings </li><li>  <strong>views</strong> : - here are the templates </li></ul></li></ul><br>  In the <strong>Entities</strong> directory, I will create a single <strong>Link</strong> class, because I don‚Äôt need more.  Doctrine 2 by default offers to create Entity in the Entities directory of the bundle, that is, each bundle can have its own set of model classes.  By configuring, you can ask Doctrine to look for classes in a directory other than Entities, but I will not do this. <br>  So here‚Äôs the <strong>Link</strong> class code: <br><blockquote> <code><a href="http://s-c.me/6904/s"></a> <a href="http://s-c.me/6904/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#cc6633">&lt;? php</font> </li><li></li><li>  <font color="#0000ff">namespace</font> Application \ ReadlaterBundle \ Entities; </li><li>  <font color="#0000ff">use</font> Doctrine \ ORM \ EntityRepository; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table (name = "readlater_link")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">class</font> Link </li><li>  { </li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Id @Column (name = "id", type = "integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue (strategy = "AUTO")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ id</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Column (name = "url", type = "string", length = 255)</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ url</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Column (name = "created_at", type = "datetime")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ createdAt</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* constructor</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> __construct () </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; createdAt = <font color="#0000ff">new</font> \ <font color="#cc6633">DateTime</font> (); </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* to string</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> __toString () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; getUrl (); </li><li>  } </li><li>  } </li><li></li><li></li></ol></blockquote><br>  I defined three fields for a class: <br><ul><li>  <strong>$ id</strong> - identifier </li><li>  <strong>$ url</strong> - URL links </li><li>  <strong>$ createdAt</strong> - date added </li></ul><br>  And also added two methods that are already clear.  As you can see from the example, I used Docblock to describe the model. <br>  Now I executed several commands: <br><br> <code>readlater/console doctrine:database:create <br> readlater/console doctrine:generate:entities <br> readlater/console doctrine:schema:create <br></code> <br>  The first team will create a database, the second will generate methods for our class and do some work, and the third will create a table in the database. <br>  It will look something like this: <br><br> <a href=""><img src="http://poulikov.ru/images/habr/create_schema_600.png"></a> <br><br>  Now, if we look at our <strong>Link</strong> class <strong>,</strong> we will see that it has changed a little, and now it looks like this: <br><blockquote> <code><a href="http://s-c.me/6905/s"></a> <a href="http://s-c.me/6905/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#cc6633">&lt;? php</font> </li><li></li><li>  <font color="#0000ff">namespace</font> Application \ ReadlaterBundle \ Entities; </li><li>  <font color="#0000ff">use</font> Doctrine \ ORM \ EntityRepository; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Entity</font> &lt;br/&gt; <font color="#696969">* @Table (name = "readlater_link")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">class</font> Link </li><li>  { </li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Id @Column (name = "id", type = "integer")</font> &lt;br/&gt; <font color="#696969">* @GeneratedValue (strategy = "AUTO")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ id</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Column (name = "url", type = "string", length = 255)</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ url</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Column (name = "created_at", type = "datetime")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">private</font> <font color="#cc6633">$ createdAt</font> ; </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* constructor</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> __construct () </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; createdAt = <font color="#0000ff">new</font> \ <font color="#cc6633">DateTime</font> (); </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* to string</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> __toString () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; getUrl (); </li><li>  } </li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* Get id</font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @return integer $ id</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> getId () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; id; </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* Set url</font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param string $ url</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> setUrl ( <font color="#cc6633">$ url</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; url = <font color="#cc6633">$ url</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* Get url</font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @return string $ url</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> getUrl () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; url; </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* Set createdAt</font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @param datetime $ createdAt</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> setCreatedAt ( <font color="#cc6633">$ createdAt</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ this</font> -&gt; createdAt = <font color="#cc6633">$ createdAt</font> ; </li><li>  } </li><li></li><li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* Get createdAt</font> &lt;br/&gt; <font color="#696969">*</font> &lt;br/&gt; <font color="#696969">* @return datetime $ createdAt</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">public function</font> getCreatedAt () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; createdAt; </li><li>  } </li><li></li><li>  } </li><li></li><li></li></ol></blockquote><br>  It introduced methods for accessing class properties. <br><br>  Well now add routing rules to routing.yml <br><blockquote> <code><a href="http://s-c.me/6906/s"></a> <a href="http://s-c.me/6906/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#2b91af">link_list</font> : </li><li>  <font color="#2b91af">pattern</font> : / </li><li>  <font color="#2b91af">defaults</font> : <font color="#0000ff">{</font> <font color="#2b91af">_bundle</font> : ReadlaterBundle, <font color="#2b91af">_controller</font> : Readlater, <font color="#2b91af">_action</font> : index <font color="#0000ff">}</font> </li><li></li><li>  <font color="#2b91af">add_link</font> : </li><li>  <font color="#2b91af">pattern</font> : / add </li><li>  <font color="#2b91af">defaults</font> : <font color="#0000ff">{</font> <font color="#2b91af">_bundle</font> : ReadlaterBundle, <font color="#2b91af">_controller</font> : Readlater, <font color="#2b91af">_action</font> : add <font color="#0000ff">}</font> </li><li></li><li>  <font color="#2b91af">read_link</font> : </li><li>  <font color="#2b91af">pattern</font> : / read /: id </li><li>  <font color="#2b91af">defaults</font> : <font color="#0000ff">{</font> <font color="#2b91af">_bundle</font> : ReadlaterBundle, <font color="#2b91af">_controller</font> : Readlater, <font color="#2b91af">_action</font> : read <font color="#0000ff">}</font> </li></ol></blockquote><br>  From the code I think everything is clear, there are 3 rules, listing, adding and deleting. <br><br>  Now, finally, the controller, where you can and see how to work with objects running Doctrine.  Immediately quote the entire code: <br><blockquote> <code><a href="http://s-c.me/6907/s"></a> <a href="http://s-c.me/6907/h"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <a href="http://www.php.net/manual/en/function.flush.php"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#cc6633">&lt;? php</font> </li><li></li><li>  <font color="#0000ff">namespace</font> Application \ ReadlaterBundle \ Controller; </li><li></li><li>  <font color="#0000ff">use</font> Symfony \ Framework \ WebBundle \ Controller, </li><li>  Application \ ReadlaterBundle \ Entities \ Link, </li><li>  Doctrine \ ORM \ QueryBuilder; </li><li></li><li>  <font color="#0000ff">class</font> ReadlaterController <font color="#0000ff">extends</font> Controller </li><li>  { </li><li>  <font color="#0000ff">public function</font> indexAction () </li><li>  { </li><li>  <font color="#cc6633">$ em</font> = <font color="#cc6633">$ this</font> -&gt; container-&gt; getDoctrine_ORM_EntityManagerService (); </li><li></li><li>  <font color="#cc6633">$ links</font> = <font color="#cc6633">$ em</font> -&gt; getRepository ( <font color="#008000">'Application \ ReadlaterBundle \ Entities \ Link'</font> ) -&gt; findAll (); </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; render ( <font color="#008000">'ReadlaterBundle: Readlater: index'</font> , <font color="#0000ff">array</font> ( <font color="#008000">'links'</font> =&gt; <font color="#cc6633">$ links</font> )); </li><li>  } </li><li></li><li>  <font color="#0000ff">public function</font> addAction () </li><li>  { </li><li>  <font color="#cc6633">$ request</font> = <font color="#cc6633">$ this</font> -&gt; getRequest (); </li><li></li><li>  <font color="#cc6633">$ url</font> = <font color="#cc6633">$ request</font> -&gt; request-&gt; get ( <font color="#008000">'link'</font> ); </li><li>  <font color="#cc6633">$ link</font> = <font color="#0000ff">new</font> Link (); </li><li>  <font color="#cc6633">$ link</font> -&gt; setUrl ( <font color="#cc6633">$ url</font> ); </li><li></li><li>  <font color="#cc6633">$ em</font> = <font color="#cc6633">$ this</font> -&gt; container-&gt; getDoctrine_ORM_EntityManagerService (); </li><li>  <font color="#cc6633">$ em</font> -&gt; persist ( <font color="#cc6633">$ link</font> ); </li><li>  <font color="#cc6633">$ em</font> -&gt; flush (); </li><li></li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; redirect ( <font color="#cc6633">$ this</font> -&gt; generateUrl ( <font color="#008000">'link_list'</font> )); </li><li>  } </li><li></li><li>  <font color="#0000ff">public function</font> readAction ( <font color="#cc6633">$ id</font> ) </li><li>  { </li><li>  <font color="#cc6633">$ em</font> = <font color="#cc6633">$ this</font> -&gt; container-&gt; getDoctrine_ORM_EntityManagerService (); </li><li></li><li>  <font color="#cc6633">$ link</font> = <font color="#cc6633">$ em</font> -&gt; find ( <font color="#008000">'Application \\ ReadlaterBundle \\ Entities \\ Link'</font> , <font color="#cc6633">$ id</font> ); </li><li>  <font color="#cc6633">$ em</font> -&gt; remove ( <font color="#cc6633">$ link</font> ); </li><li></li><li>  <font color="#cc6633">$ em</font> -&gt; flush (); </li><li></li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; redirect ( <font color="#cc6633">$ this</font> -&gt; generateUrl ( <font color="#008000">'link_list'</font> )); </li><li>  } </li><li>  } </li></ol></blockquote><br>  A few words about the code. <br> <code>$em = $this-&gt;container-&gt;getDoctrine_ORM_EntityManagerService();</code>  so using the DI Container we access the <strong>EntityManager</strong> <br>  <code>$em-&gt;getRepository()</code> - so we get a repository of objects of a certain type, that is, some kind of * Table from Doctrine 1.x. <br> <code>$em-&gt;persist($link);</code>  - so we save the object <br>  <code>$em-&gt;flush()</code> so we complete the transaction, that is, we actually send the data to the database. <br>  <code>$em-&gt;remove($link)</code> - well, and so remove the object. <br>  By the way, if I inherited my controller from <strong>Symfony \ Framework \ DoctrineBundle \ Controller \ DoctrineController</strong> , then the methods would be available: <br><ul><li>  <strong>getDatabaseConnection</strong> - returns a database connection object </li><li>  <strong>getEntityManager</strong> - and I wouldn‚Äôt have to get it from DI Container </li><li>  <strong>createQueryBuilder</strong> </li><li>  <strong>createQuery</strong> </li></ul><br>  That's all about the code, the rest I think is obvious. <br><br>  But perhaps the question arose if now there are no classes of tables, then where to create methods for extracting model objects.  For example, in this case, it would be good for the <strong>findAll</strong> method <strong>to</strong> get a list of objects sorted by adding date in descending order.  To do this, you must create your own class storage repository for objects of a particular type. <br>  To do this, open our class <strong>Link</strong> and add to the end of the file: <br><blockquote> <code><a href="http://s-c.me/6908/s"></a> <a href="http://s-c.me/6908/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* LinkRepository</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">class</font> LinkRepository <font color="#0000ff">extends</font> EntityRepository </li><li>  { </li><li>  <font color="#0000ff">public function</font> findAll () </li><li>  { </li><li>  <font color="#0000ff">return</font> <font color="#cc6633">$ this</font> -&gt; _ em-&gt; createQuery ( <font color="#008000">'SELECT l FROM Application \\ ReadlaterBundle \\ Entities \\ Link l ORDER BY l.createdAt DESC'</font> ) -&gt; getResult (); </li><li>  } </li><li>  } </li></ol></blockquote><br>  this will be the repository. <br>  Now let's say which repository to use for the <strong>Link</strong> class, for this we will slightly change Docblock and the <strong>Link</strong> class <br><blockquote> <code><a href="http://s-c.me/6909/s"></a> <a href="http://s-c.me/6909/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#696969">/ **</font> &lt;br/&gt; <font color="#696969">* @Entity (repositoryClass = "Application \ ReadlaterBundle \ Entities \ LinkRepository")</font> &lt;br/&gt; <font color="#696969">* @Table (name = "readlater_link")</font> &lt;br/&gt; <font color="#696969">* /</font> </li><li>  <font color="#0000ff">class</font> Link </li><li>  { </li><li>  <font color="#696969">// ...</font> </li><li>  } </li></ol></blockquote><br>  That's all.  Now the list of links will be sorted in the right order and it will look something like this: <br> <a href=""><img src="http://poulikov.ru/images/habr/readlater_600.png"></a> <br><br>  I did not give the template code, but all this can be viewed in the source code on <a href="http://github.com/poulikov/readlater">github</a> <br>  as well as related links: <br><ul><li>  <a href="http://www.doctrine-project.org/documentation/manual/2_0/en">Doctrine 2 Documentation</a> </li><li>  <a href="http://symfony-reloaded.org/learn">Symfony 2 Documentation</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/91565/">https://habr.com/ru/post/91565/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../91555/index.html">The speed and type of payment of your home Internet</a></li>
<li><a href="../91556/index.html">3D model of Petersburg</a></li>
<li><a href="../91557/index.html">How to register domains in the zone .UA</a></li>
<li><a href="../91561/index.html">Wall Street Corporations will report via a python script</a></li>
<li><a href="../91562/index.html">Presentation of phone number for business cards</a></li>
<li><a href="../91567/index.html">Android OS on Samsung i900 (Witu). Is the game worth the candle?</a></li>
<li><a href="../91568/index.html">Authorization through the new API site Vkontakte.ru</a></li>
<li><a href="../91569/index.html">Google Adwords Ban</a></li>
<li><a href="../91575/index.html">XAMPP on Linux + Xdebug (Linux 64bit)</a></li>
<li><a href="../91582/index.html">Google killed http: //</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>