<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PHP Unit. Experience of testing classes working with the Database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="To test whether or not classes interacting with the Database is a question much more holivarny than the dispute "to cover code with tests or not." Aft...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PHP Unit. Experience of testing classes working with the Database</h1><div class="post__text post__text-html js-mediator-article">  To test whether or not classes interacting with the Database is a question much more holivarny than the dispute "to cover code with tests or not."  After reviewing your project, it became obvious to us that the lion‚Äôs share of classes is based on interaction with the database.  Therefore, it was definitely decided: "testing to be." <br>  Next, I want to share the experience of writing unit tests for code that works with the database. <br><br>  PHPUnit contains an extension to test the database.  The extension performs the following functions: <br><ul><li>  transfer of the database to a previously known state, </li><li>  performing the necessary data modifications, </li><li>  check that the expected entries are created in the database. </li></ul><br>  Unfortunately, there is no one feature we really need in this list - data recovery to the state in which they were before the tests.  I want to offer 2 options for solving this problem.  I also dwell on the problem of foreign keys, which often arises when rolling in incomplete test data on a ‚Äúworking‚Äù database. <br><br>  So, I offer 2 options for solving the problem: how to restore the database to its initial state after conducting a unit test: <br>  The first path is ‚ÄúTransactional‚Äù.  The essence of which is reduced to the execution of the entire test in a single transaction, and the subsequent rollback transaction. <br>  Second - Before performing the test, copy the structure of the ‚Äúworking‚Äù base and test it. <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Implementation of the "transactional" path </h4><br><br>  In fact, we need to enclose in a transaction all operations with the database, which Unit performs the test, and subsequently roll it back. <br><br>  The task is reduced to the use of a single connection to the database by all tests and the conclusion of all operations with the database in a single transaction.  We encapsulate the connection to the database in a separate class from which all Unit tests will inherit.  The class itself will be a descendant of PHPUnit_Extensions_Database_TestCase. <br><br>  Using the DBUnit extension, you should override the getConnection method, which, as the name implies, is responsible for obtaining a reference to the connection to the database.  I pay attention that this method should not create a new connection to the database every time, but should only return a link to the created connection. <br>  The following code is not allowed, because transactions ‚Äúlive‚Äù only within one connection. <br><pre><code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getConnection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $pdo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO(<span class="hljs-string"><span class="hljs-string">"mysql:host=localhost;dbname=dbname"</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;createDefaultDBConnection($pdo, <span class="hljs-string"><span class="hljs-string">'php'</span></span>); }</code> </pre> <br>  In this case, with each call to the method, connections to the database will be recreated.  We post the creation of the connection object in the constructor, and the getConnection method will return a reference to the connection object: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *  PDO connection    *  DefaultDBConnection  DBUnit    PDO * */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name = null, array $data = array</span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"><span class="hljs-params">()</span></span></span></span><span class="hljs-function"><span class="hljs-params">, $dataName = </span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">''</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($name, $data, $dataName); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PDO(<span class="hljs-string"><span class="hljs-string">"mysql:host=localhost;dbname=dbname"</span></span>, <span class="hljs-string"><span class="hljs-string">'root'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;exec(<span class="hljs-string"><span class="hljs-string">'SET foreign_key_checks = 0'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    $this-&gt;con = $this-&gt;createDefaultDBConnection($this-&gt;pdo, 'php'); $this-&gt;pdo-&gt;beginTransaction(); } /** *  PDO * * @return PHPUnit_Extensions_Database_DB_DefaultDatabaseConnection */ public function getConnection() { return $this-&gt;con; }</span></span></code> </pre><br>  I‚Äôll stay at the moment when foreign keys are disabled: before executing tests, DBUnit clears the database, sending truncate to each table.  Often there is a situation, the code clears the table, which is referenced by data in a table that has not yet been cleared, thereby blocking data cleansing to avoid this, disable the checking of foreign keys for the duration of the test. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SET</span></span> foreign_key_checks = <span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre><br>  We also allowed tests to perform queries to the database via PDO ($ this-&gt; pdo-&gt; query ()) <br><br>  Now it‚Äôs easy to do: roll back the transaction after running the test in one test case: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *  * *  ,        */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__destruct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;rollBack(); }</code> </pre><br>  The code looks quite working, but 2 pitfalls remain: <br>  1) the transaction is aborted when the Truncate operation is performed, which is performed before each filling of the test data with the dbUnit extension. <br>  2) If your DBMS is MySQL, then the long execution time for one transaction is affected by the error: ‚ÄúLock wait timeout exceeded;  try restarting transaction. ‚ÄùThe bug is described <a href="http://bugs.mysql.com/bug.php%3Fid%3D47180">in the MySQL bug tracker</a> . <br><br>  We abandon the truncate operation as follows: <br>  Having rummaged in DBUnit interiors we find the CLEAN_INSERT method in the PHPUnit_Extensions_Database_Operation_Factory class: <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Returns a clean insert database operation. It will remove all contents * from the table prior to re-inserting rows. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> bool $cascadeTruncates Set to true to force truncates to cascade on databases that support this. * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> PHPUnit_Extensions_Database_Operation_IDatabaseOperation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CLEAN_INSERT</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cascadeTruncates = FALSE)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_Operation_Composite(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::TRUNCATE($cascadeTruncates), <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::INSERT() )); }</code> </pre><br>  It is called from PHPUnit_Framework_TestCase to clear the database <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSetUpOperation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PHPUnit_Extensions_Database_Operation_Factory::CLEAN_INSERT(); }</code> </pre><br>  All that is needed is to replace the function TRUNCATE with DELETE_ALL.  In the depths of PHPUnit do this moveton.  The benefit of redefining this behavior is possible in the inherited class: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">abstract</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TrunsactionFiendlyDatabaseTestCase</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PHPUnit_Extensions_Database_TestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Returns the database operation executed in test setup. * Return DeleteAll and Insert After this. * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> PHPUnit_Extensions_Database_Operation_DatabaseOperation */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getSetUpOperation</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PHPUnit_Extensions_Database_Operation_Composite( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span> ( PHPUnit_Extensions_Database_Operation_Factory::DELETE_ALL(), PHPUnit_Extensions_Database_Operation_Factory::INSERT() ) ); } }</code> </pre><br><br>  Everyone guessed that the ‚Äútest-parent‚Äù class should be inherited from TrunsactionFiendlyDatabaseTestCase ()?  Or combine these two classes, here a matter of taste and moral principles.  But I preferred not to mix 2 levels of logic in one class.  The resulting class hierarchy is shown in the diagram: <br><img src="https://habrastorage.org/storage2/2fe/a77/daa/2fea77daa8b6335e1c86585a461f3b5c.png" alt="image"><br><br>  The ‚ÄúLock wait timeout exceeded‚Äù problem was solved by rolling back the transaction after each test and starting a new one. <br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** *     ,   */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tearDown</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;rollBack(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;beginTransaction(); }</code> </pre><br>  <b>As a result</b> : all operations with data within one test are executed in a transaction, which is rolled back after completion of the test. <br><br><h4>  Implementation of copying the database structure </h4><br>  The idea floats on the surface: create another database for tests.  But in this case it is necessary to keep both databases up to date.  And a situation can easily happen when tests are passed with success, but the system does not work on a ‚Äúcombat‚Äù base. <br>  We will try to automate the process of copying the database structure before running the tests.  DbUnit will do the rest. <br><br>  It is obvious that the base must be copied before the first test case is executed. <br>  PHPUnit allows you to perform a ‚Äúbootstrap file‚Äù, also known as bootstrap, before performing tests.  It is set in the phpunit.xml settings file as follows: <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phpunit</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bootstrap</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./application/bootstrap.php"</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre><br>  It can perform many useful functions: connecting files, initializing environment variables.  I propose in it to initiate the process of cloning the structure of the database. <br><br>  Let us step by step the process of cloning the database structure. <br><br>  To begin, remove the test database, if suddenly it has already been created <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">`testDB`</span></span></code> </pre><br>  and create it again <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATABASE</span></span> <span class="hljs-string"><span class="hljs-string">`testDB`</span></span></code> </pre><br>  Of course, you can not delete the database, if it already exists, but simply clear it, but in this case there may be a mismatch between the structure of the test base and the working one, simply speaking, the test base may become outdated. <br><br>  Next we get a list of tables of the working base. <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SHOW</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLES</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-string"><span class="hljs-string">`developDB`</span></span></code> </pre><br>  and create in their image and likeness of the table in the test database: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`$table`</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">`developDB`</span></span>.<span class="hljs-string"><span class="hljs-string">`$table`</span></span><span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br>  Discarding too much, we get about the following code: <br><pre> <code class="php hljs">$res = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;exec(<span class="hljs-string"><span class="hljs-string">"DROP DATABASE IF EXISTS `testDB`"</span></span>); $res = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;exec(<span class="hljs-string"><span class="hljs-string">"CREATE DATABASE `testDB`"</span></span>); $tables = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;query(<span class="hljs-string"><span class="hljs-string">"SHOW TABLES FROM `developDB`"</span></span>); $tables = $tables-&gt;fetchAll(PDO::FETCH_COLUMN, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($tables <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $table) { $res = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;pdo-&gt;exec(<span class="hljs-string"><span class="hljs-string">"CREATE TABLE `$table ` LIKE `developDB`.`$table`"</span></span>); }</code> </pre><br>  At this stage, we have a test database structure that is ‚Äúidentical to the natural‚Äù <br>  It remains to remember to set DbUnit on the test base.  No standard DbUnit behavior is required. <br><br><h5>  I will try to consider the pros and cons of both approaches. </h5><br>  Transactional work surprisingly quickly, even though the transaction has to be rolled back after each test, and not the entire test case. <br>  But how long it will turn out to be when running many test cases, it remains a mystery to me.  Because  The total execution time of this auxiliary operation grows in direct proportion to the number of tests.  Yes, and with the work of dependencies of tests, they also depends, there will be problems. <br>  The complexity of the algorithm can be represented as O (n), where n is the number of tests. <br>  <b>UPD</b> .  Thanks to <a href="http://habrahabr.ru/users/zim32/" class="user_link">zim32</a> <br>  Also this method imposes restrictions on database queries generated by the test.  In particular, the transaction must be completed before the use of expressions: ALTER TABLE, CREATE INDEX, DROP INDEX, DROP TABLE, RENAME TABLE. <br><br>  The variant with copying the structure of the database, on the contrary, requires a lot of time for its execution, but it is performed once.  Those.  Its running time does not depend on the number of tests run. <br><br>  The complexity of this algorithm = const.  How much this constant is large depends on the number of tables and their structure.  For example, I can say that on 40 tables the cloning of the structure takes about 8 seconds. <br><br>  <b>Conclusion</b> : When launching single test cases, you should use the ‚Äútransactional‚Äù approach.  When executing a large number of test cases, you should prefer the variant with cloning the database structure. <br><br>  I would like to hear what problems you encountered while using DbUnit and how you solved them. <br><br>  In preparing the material was used source: <a href="http://www.smartyit.ru/php">www.smartyit.ru/php</a> </div><p>Source: <a href="https://habr.com/ru/post/139727/">https://habr.com/ru/post/139727/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../139720/index.html">Published webinars on Visual Studio 11, about innovations in ASP.NET and MVC4</a></li>
<li><a href="../139721/index.html">Online Store Under Load - Web Cluster Quality Metrics</a></li>
<li><a href="../139722/index.html">Http headers will tell a lot about your device</a></li>
<li><a href="../139724/index.html">Userscript: Crossbrowser, Crossdomain</a></li>
<li><a href="../139725/index.html">Build automation on .Net using NuGet</a></li>
<li><a href="../139728/index.html">Sort letters by imap-folders on the mail server without using sieve and others like them</a></li>
<li><a href="../139729/index.html">Looking for a nice investor</a></li>
<li><a href="../139730/index.html">Why do people unsubscribe from your newsletter</a></li>
<li><a href="../139731/index.html">Data Mining in football: let's digitize a match and count everyone!</a></li>
<li><a href="../139732/index.html">How I made the most popular election site</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>