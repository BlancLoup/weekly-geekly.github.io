<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MPI Basics for Dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It turned out that I had to face closely the study of parallel computing and in particular MPI. Perhaps, this direction today is very promising, so I ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MPI Basics for Dummies</h1><div class="post__text post__text-html js-mediator-article">  It turned out that I had to face closely the study of parallel computing and in particular MPI.  Perhaps, this direction today is very promising, so I would like to show Habrayuser the basics of this process. <br><br><h5>  Basic principles and example </h5><br>  As an example, the calculation of exponent (e) will be used.  One of its variants is the Taylor series: <br>  <b>e ^ x = ((x ^ n) / n!)</b> , where the summation occurs from n = 0 to infinity. <br><br>  This formula is easy to parallelize, since the desired number is the sum of the individual addends, and thanks to this, each individual processor can do the computation of the individual addends. <br><a name="habracut"></a><br>  The number of terms that will be calculated in each individual processor depends both on the length of the interval n and on the number of processors k that can participate in the calculation process.  So, for example, if the interval length is n = 4, and five processors participate in the calculations (k = 5), then from the first to the fourth processors will receive one term each, and the fifth one will not be used.  If n = 10 and k = 5, each processor will get two terms to calculate. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Initially, the first processor, using the broadcast function MPI_Bcast, sends the rest of the value of the user-defined variable n.  In general, the MPI_Bcast function has the following format: <br>  int MPI_Bcast (void * buffer, int count, MPI_Datatype datatype, int root, MPI_Comm comm), where buffer is the address of the buffer with the element, count is the number of elements, datatype is the corresponding data type in MPI, root is the rank of the main processor that deals forward and comm is the name of the communicator. <br>  In my case, the role of the main processor, as already mentioned, will be the first processor with a rank of 0. <br><br>  After the number n is successfully sent, each processor will calculate its addends.  To do this, at each step of the cycle, a number equal to the number of processors participating in the calculations will be added to the number i, which is initially equal to the processor's rank.  If the number in the following steps, the number i exceeds the user-specified number n, the cycle for this processor will stop. <br><br>  During the execution of the cycle, the terms will be added to a separate variable and, after its completion, the resulting amount will be sent to the main processor.  For this, the function of the cast operation MPI_Reduce will be used.  In general, it looks like this: <br>  int MPI_Reduce (void * buf, void * result, int count, MPI_Datatype datatype, MPI_Op op, int root, MPI_Comm comm) <br><br>  It combines the elements of the input buffer of each process in the group using the op operation, and returns the combined value in the output buffer of the process with the root number.  The result of such an operation will be the only value, due to which the function of the reduction got its name. <br><br>  After the program is executed on all processors, the first processor will receive the total sum of the components, which will be the exponent value we need. <br><br>  It should be noted that in parallel and sequential methods of calculating the exponent, a recursive function is used to find the factorial.  In the course of making a decision on the method of parallelizing the task being performed, I considered the option of finding factorial also on different processors, but in the end, this option was accepted by me as irrational. <br><br>  However, the primary task is to find the value of the exponent and if the processors begin to calculate each factorial of each term in a separate way, this can lead to a direct effect back, namely a significant loss in performance and speed of calculation. <br>  This is explained by the fact that in this case a very large load will begin on the communication environment, which is already a weak link in parallel computing systems.  If the factorial calculation will occur on each processor in private, the load on the communication lines will be minimal.  This case can be called a good example of the fact that the task of parallelization must also sometimes have its limits. <br><br><h5>  Code execution algorithm </h5><br>  1. From the visual shell, the value of the number n is transmitted to the program, which is then sent to all processors using the broadcast function. <br>  2. When initializing the first main processor, a timer starts. <br>  3. Each processor performs a cycle, where the increment value is the number of processors in the system.  In each iteration of the loop, the term is calculated and the sum of such terms is stored in the variable drobSum. <br>  4. Upon completion of the cycle, each processor sums its drobSum value to the Result variable using the cast function MPI_Reduce. <br>  5. After completion of calculations on all processors, the first main processor stops the timer and sends the resulting Result variable to the output stream. <br>  6. The time value measured by our timer is also sent to the output stream in milliseconds. <br><br><h5>  Code listing </h5><br>  The program is written in C ++, we will assume that the arguments for execution are transmitted from the outer shell.  The code looks like this: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">#include <font color="#A31515">"mpi.h"</font> <br> #include &lt;iostream&gt; <br> #include &lt;windows.h&gt; <br> <font color="#0000ff">using</font> <font color="#0000ff">namespace</font> std; <br> <br> <font color="#0000ff">double</font> Fact( <font color="#0000ff">int</font> n) <br> { <br> <font color="#0000ff">if</font> (n==0) <br> <font color="#0000ff">return</font> 1; <br> <font color="#0000ff">else</font> <br> <font color="#0000ff">return</font> n*Fact(n-1); <br> } <br> <br> <font color="#0000ff">int</font> main( <font color="#0000ff">int</font> argc, <font color="#0000ff">char</font> *argv[]) <br> { <br> SetConsoleOutputCP(1251); <br> <font color="#0000ff">int</font> n; <br> <font color="#0000ff">int</font> myid; <br> <font color="#0000ff">int</font> numprocs; <br> <font color="#0000ff">int</font> i; <br> <font color="#0000ff">int</font> rc; <br> <font color="#0000ff">long</font> <font color="#0000ff">double</font> drob,drobSum=0,Result, sum; <br> <font color="#0000ff">double</font> startwtime = 0.0; <br> <font color="#0000ff">double</font> endwtime; <br> <br> n = atoi(argv[1]); <br> <br> <font color="#0000ff">if</font> (rc= MPI_Init(&amp;argc, &amp;argv)) <br> { <br> cout &lt;&lt; <font color="#A31515">" ,   "</font> &lt;&lt; endl; <br> MPI_Abort(MPI_COMM_WORLD, rc); <br> } <br> <br> MPI_Comm_size(MPI_COMM_WORLD,&amp;numprocs); <br> MPI_Comm_rank(MPI_COMM_WORLD,&amp;myid); <br> <br> <br> <font color="#0000ff">if</font> (myid == 0) <br> { <br> <br> startwtime = MPI_Wtime(); <br> } <br> MPI_Bcast(&amp;n, 1, MPI_INT, 0, MPI_COMM_WORLD); <br> <br> <font color="#0000ff">for</font> (i = myid; i &lt;= n; i += numprocs) <br> { <br> drob = 1/Fact(i); <br> drobSum += drob; <br> } <br> <br> MPI_Reduce(&amp;drobSum, &amp;Result, 1, MPI_LONG_DOUBLE, MPI_SUM, 0, MPI_COMM_WORLD); <br> cout.precision(20); <br> <font color="#0000ff">if</font> (myid == 0) <br> { <br> cout &lt;&lt; Result &lt;&lt; endl; <br> endwtime = MPI_Wtime(); <br> cout &lt;&lt; (endwtime-startwtime)*1000 &lt;&lt; endl; <br> } <br> <br> MPI_Finalize(); <br> <font color="#0000ff">return</font> 0; <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h5>  Conclusion </h5><br>  Thus, we have obtained a simple program for counting exponents using several processors at once.  Probably, the bottleneck is the storage of the result itself, because with an increase in the number of digits, it is banal to contain a value using standard types and this place requires study.  Perhaps a fairly rational solution is to write the result to a file, although, in view of the purely educational function of this example, attention should be paid to this point. <br><br><habracut></habracut></div><p>Source: <a href="https://habr.com/ru/post/121235/">https://habr.com/ru/post/121235/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121229/index.html">Car Nissan Leaf gives its coordinates to any RSS-provider</a></li>
<li><a href="../121230/index.html">GUNNARS: Upgrading an IT Man's View (Part 2)</a></li>
<li><a href="../121232/index.html">Analysis of the architecture of an automated traffic control system from the US DoT ITS standard</a></li>
<li><a href="../121233/index.html">Reducing the number of users on Facebook</a></li>
<li><a href="../121234/index.html">Testing in Java. Testng</a></li>
<li><a href="../121238/index.html">For the first time, Facebook has witnessed a negative growth in the number of users in the US and Canada.</a></li>
<li><a href="../121239/index.html">Chrome browser extension allows you to circumvent the paid reading mode Wall Street Journal</a></li>
<li><a href="../121241/index.html">Negligence hoster led to the publication of the base site</a></li>
<li><a href="../121242/index.html">Samsung Galaxy Tab 10.1 is available for pre-order</a></li>
<li><a href="../121243/index.html">IPO for dummies. Part IV: The Impact of an IPO on Adult-Partner Revenue</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>