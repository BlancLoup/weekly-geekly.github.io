<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The best game in 2048 with a Markov decision process</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the previous article about 2048, we used Markov chains to find out that, on average, you need at least 938.8 moves to win, and also investigated th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The best game in 2048 with a Markov decision process</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/lz/fp/7m/lzfp7mczsl0cfrchzd3gue0y6gw.png"></div><br>  In the previous article about <a href="https://habrahabr.ru/post/339342/">2048,</a> we used Markov chains to find out that, on average, <a href="https://habr.com/articles/2017/08/05/markov-chain-2048.html">you need at least 938.8 moves</a> to win, and also investigated the number of possible game field configurations using <a href="https://habr.com/articles/2017/09/17/counting-states-combinatorics-2048.html">combinatorics</a> and a <a href="https://habr.com/articles/2017/12/10/counting-states-enumeration-2048.html">full brute force</a> . <br><br>  In this post, we use a mathematical apparatus called the ‚ÄúMarkov Decision Making Process‚Äù to find provably optimal strategies for playing 2048 for 2x2 and 3x3 fields, as well as on a 4x4 board up to tile <code>64</code> .  For example, here‚Äôs the optimal player in a 2x2 game before tile <code>32</code> : <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/n8/zl/gb/n8zlgbqsx1ljac-oclex6iiwnb0.gif"></div></div></div><br>  The random seed determines the random sequence of tiles added by the game on the field.  The ‚Äústrategy‚Äù of a player is defined by a table called an <em>algorithm</em> (policy).  It tells us in which direction to move the tiles in any possible configuration of the field.  In this post we will look at how to create an algorithm that is optimal in the sense that it maximizes the player‚Äôs chances of getting a tile <code>32</code> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      It turns out that in a 2x2 game to tile <code>32</code> very difficult to win - even if playing optimally, the player wins only about 8% of cases, that is, the game is not particularly interesting.  Qualitatively, 2x2 games are very different from 4x4 games, but they are still useful for getting to know the basic principles. <br><br>  Ideally, we want to find the optimal algorithm for a full game on a 4x4 field before a <code>2048</code> tile, but as we saw from the previous post, the number of possible field configurations is very large.  Therefore, it is impossible to create an optimal algorithm for a complete game, at least using the methods used here. <br><br>  However, we can find the optimal algorithm for the shortened 4x4 game to <code>64</code> tile, and, fortunately, we will see that the optimal 3x3 margin game looks qualitatively similar to some successful full-game strategies. <br><br>  The code (research quality) on which this article is based is laid out in <a href="https://github.com/jdleesmiller/twenty48">open access</a> . <br><a name="habracut"></a><br><h2>  Markov decision processes for 2048 </h2><br>  Markov decision-making processes ( <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D1%2580%25D0%25BA%25D0%25BE%25D0%25B2%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25BF%25D1%2580%25D0%25BE%25D1%2586%25D0%25B5%25D1%2581%25D1%2581_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D1%258F%25D1%2582%25D0%25B8%25D1%258F_%25D1%2580%25D0%25B5%25D1%2588%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">MDP</a> ) are the mathematical basis for modeling and solving problems, in which we need to take a sequence of interconnected solutions under conditions of uncertainty.  Such tasks are full in the real world, and the MDP is actively <a href="http://stats.stackexchange.com/questions/145122/real-life-examples-of-markov-decision-processes">used</a> in <a href="https://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25BD%25D1%258F%25D1%2582%25D0%25B8%25D1%258F_%25D1%2580%25D0%25B5%25D1%2588%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B9">economics</a> , <a href="https://www.minet.uni-jena.de/Marie-Curie-ITN/SMIF/talks/Baeuerle.pdf">financial business</a> and <a href="http://incompleteideas.net/book/the-book.html">artificial intelligence</a> .  In the case of 2048, the sequence of decisions is the direction of movement of the tiles in each move, and uncertainty arises because the game adds tiles to the field at random. <br><br>  To present the game 2048 in the form of MDP, we need to write it in a certain way.  It consists of six basic concepts: <em>states</em> , <em>actions,</em> and <em>transition probabilities</em> encode the dynamics of the game;  <em>Rewards</em> , <em>values</em> and <em>algorithms</em> are used to fix the player‚Äôs goals and how to achieve them.  To develop these six concepts, we take as an example the smallest non-trivial game, similar to 2048, which is played on a 2x2 field only up to tile <code>8</code> .  Let's start with the first three concepts. <br><br><h3>  States, actions and transition probabilities </h3><br>  <em>The state</em> fixes the configuration of the field at a given moment of the game, indicating the value of the tile in each of the cells of the field.  For example, <img src="https://habrastorage.org/getpro/habr/post_images/18a/103/fb5/18a103fb518135917b1a2f75f38d867c.svg">  - This is a possible state in the 2x2 field play.  <em>Action</em> is moving left, right, up or down.  Every time a player performs an action, the process moves to a new state. <br><br>  <em>Transition probabilities</em> encode the dynamics of the game, determining the states that are more likely to be next, taking into account the current state and the player‚Äôs actions.  Fortunately, we can find out exactly how 2048 works by reading <a href="https://github.com/gabrielecirulli/2048">its source code</a> .  The most important <sup>one</sup> is the process that the game uses to place a random tile on the board.  This process is always the same: <em>choose a free cell with the same probability and add a new tile either with a value of <code>2</code> with a probability of 0.9, or with a value of <code>4</code> with a probability of 0.1</em> . <br><br>  At the beginning of each game, using this process, two tiles are added to the field.  For example, one of such possible initial states is: <img src="https://habrastorage.org/getpro/habr/post_images/18a/103/fb5/18a103fb518135917b1a2f75f38d867c.svg">  .  For each action possible in this state, namely <code>L</code> eft, <code>R</code> ight, <code>U</code> p and <code>D</code> own, the possible next states and the corresponding transition probabilities are as follows: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5cb/635/34f/5cb63534fa02d66c665f38aae73ee8ea.svg"></div><br>  In this diagram, the arrows denote every possible transition to the next state on the right.  The weight of the arrow and the label indicate the corresponding transition probability.  For example, if a player shifts tiles to the right ( <code>R</code> ), then both tiles <code>2</code> move to the right edge, leaving two free cells to the left.  A new tile will have a probability of 0.1 tile <code>4</code> , and may appear either in the upper left or in the lower left cell, that is, the probability of the state <img src="https://habrastorage.org/getpro/habr/post_images/704/06d/f07/70406df07bc3abc30b8081ce82dd7e1a.svg">  equals <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-1"><span class="MJXp-mn" id="MJXp-Span-2"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.1 </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;">t </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6"><font style="vertical-align: inherit;">m </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;">e </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8"><font style="vertical-align: inherit;">s </font></span><span class="MJXp-mn" id="MJXp-Span-9"><font style="vertical-align: inherit;">0.5 </font></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;">= </font></span><span class="MJXp-mn" id="MJXp-Span-11"><font style="vertical-align: inherit;">0.05</font></span></font><span class="MJXp-mtext" id="MJXp-Span-3">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-4"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-5"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-6"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-7"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-8"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-9"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mo" id="MJXp-Span-10" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mn" id="MJXp-Span-11"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-1-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="19.613ex" height="1.937ex" viewBox="0 -728.2 8444.6 834" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-31" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-74" x="1529" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-69" x="1891" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-6D" x="2236" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-65" x="3115" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="3581" y="0"></use><g transform="translate(4051,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-35" x="779" y="0"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-3D" x="5608" y="0"></use><g transform="translate(6664,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-30"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2E" x="500" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-30" x="779" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-35" x="1279" y="0"></use></g></g></svg></span><script type="math/tex" id="MathJax-Element-1"> 0.1 \ times 0.5 = 0.05 </script>  . <br><br>  From each of these subsequent states, we can continue this process recursively through the search for possible actions and each of their subsequent states.  For <img src="https://habrastorage.org/getpro/habr/post_images/704/06d/f07/70406df07bc3abc30b8081ce82dd7e1a.svg">  possible subsequent states are: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2fb/e18/9f6/2fbe189f65fc20cbfed0ba561ca452b7.svg"></div><br>  Here, a shift to the right is impossible, since none of the tiles can move to the right.  Moreover, if a player reaches a subsequent state <img src="https://habrastorage.org/getpro/habr/post_images/cb6/deb/de2/cb6debde27018f90707e84128aeb0d4e.svg">  , highlighted in red, it will lose, because from this state it is impossible to perform valid actions.  This will happen if the player performs a left shift, and the game places tile <code>4</code> , which happens with a probability of 0.1;  from this it can be assumed that a shift to the left is not the best action in this state. <br><br>  Another last example: if a player moves up, not left, then one of the possible subsequent states will be <img src="https://habrastorage.org/getpro/habr/post_images/019/01a/afc/01901aafc1a1a0a74bcc6a5a98de3d88.svg">  , and if we iterate over all valid actions and subsequent states from this state, then we can see that a shift to the left or right will lead to tile <code>8</code> , which means our victory (highlighted in green): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e5/1e7/a65/6e51e7a65a023dd319c1989451c3717a.svg"></div><br>  If we repeat this process for all possible initial states and all their possible subsequent states, and so on recursively, until we reach a win or lose state, we can build a complete model with all possible states, actions and their transition probabilities.  For a 2x2 game up to tile <code>8</code> this model looks like this ( <a href="">click to enlarge</a> ; you may have to scroll down the page): <br><br><div style="text-align:center;"> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/be9/00a/a58/be900aa581892812335eb927e9d991a1.svg"></a> </div><br>  To make the scheme smaller, all loss states need to be reduced to a single state <code>lose</code> , shown by a red oval, and all winning states should be similarly reduced to a single <code>win</code> state shown by a green star.  This is possible because in fact we are not interested in how the player won or lost, but the result itself is important. <br><br>  The game proceeds approximately in the diagram from left to right, because the states are ordered into ‚Äúlayers‚Äù by the sum of their tiles.  The useful feature of the game is that after each action the amount of tiles on the field increases by 2 or 4. This happens because merging tiles does not change the amount of tiles on the field, and the game always adds either <code>2</code> or <code>4</code> .  The possible initial states, which are layers with a sum of 4, 6, and 8, are shown in blue. <br><br>  Even in the model of such a minimal example, 70 states and 530 transitions.  However, these values ‚Äã‚Äãcan be significantly reduced by noting that many of the states we have listed are trivially related to rotations and reflections, as described in Appendix A. In practice, this observation is very important for reducing the size of the model and effectively solving it.  In addition, it allows you to create more convenient schemes, but for the transition to the second set of concepts of a Markov decision-making process is not necessary. <br><br><h3>  Rewards, Values ‚Äã‚Äãand Algorithms </h3><br>  To complete the specification of the model, we need to somehow encode the fact that the player‚Äôs goal is to achieve a <code>win</code> <sup>2</sup> state.  We will do this by defining the <em>rewards</em> .  In general, each time MDP enters a state, the player receives a reward depending on the state.  We assign the reward for the transition to the <code>win</code> state to 1, and for the transition to other states - the value of 0. That is, the only way to get a reward is to reach the win state <sup>3</sup> . <br><br>  Now that we have a MDP model of the game, described with respect to states, actions, transition probabilities and rewards, we are ready to solve it.  An MDP solution is called an <em>algorithm</em> .  In essence, this is a table in which for each possible state an action is indicated that needs to be performed in this state.  Solving an MDP means finding the <em>optimal algorithm</em> , that is, one that allows the player to get as much reward as possible over time. <br><br>  To make it accurate, we need the last MDP concept: the <em>value of a</em> state according to a given algorithm is the expected reward the player will receive if he starts from this state and then follows the algorithm.  Some records are needed to explain this. <br><br>  Let be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-12"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-13"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">S</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-2-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.499ex" height="2.057ex" viewBox="0 -780.1 645.5 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-53" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-2"> S </script>  Is a set of states, and for each state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-14"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-15"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;">S</font></span></font><span class="MJXp-mtext" id="MJXp-Span-16">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-17"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-18"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-19"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-3-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.368ex" height="2.057ex" viewBox="0 -780.1 2311 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-6E" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-53" x="1665" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-3"> s \ in S </script><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-20"><span class="MJXp-msubsup" id="MJXp-Span-21"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-22" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-23" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-4-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="2.746ex" height="2.419ex" viewBox="0 -780.1 1182.5 1041.5" role="img" focusable="false" style="vertical-align: -0.607ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-41" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="1061" y="-213"></use></g></svg></span><script type="math/tex" id="MathJax-Element-4"> A_s </script>  will be a set of actions allowed in the state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-24"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-25"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-5-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="1.09ex" height="1.455ex" viewBox="0 -520.7 469.5 626.5" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="0" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-5"> s </script>  .  Let be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-26"><span class="MJXp-mtext" id="MJXp-Span-27">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-28"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">P </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-29"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">r </font></font></span><span class="MJXp-mo" id="MJXp-Span-30" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-msup" id="MJXp-Span-31"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-32" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-33" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä≤ </font></font></span></span><span class="MJXp-mrow" id="MJXp-Span-34"><span class="MJXp-mo" id="MJXp-Span-35" style="margin-left: 0.167em; margin-right: 0.167em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">|</font></font></span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-36"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> s </font></font></span><span class="MJXp-mo" id="MJXp-Span-37" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-38"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mo" id="MJXp-Span-39" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-6-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="10.96ex" height="2.66ex" viewBox="0 -832 4719 1145.2" role="img" focusable="false" style="vertical-align: -0.728ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-50" x="250" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-72" x="1001" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-28" x="1453" y="0"></use><g transform="translate(1842,0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2032" x="663" y="513"></use></g><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-7C" x="2606" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="2885" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2C" x="3354" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-61" x="3799" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-29" x="4329" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-6"> \ Pr (s ‚Äô| s, a) </script>  denotes the probability of transition to each subsequent state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-40"><span class="MJXp-msup" id="MJXp-Span-41"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-42" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo MJXp-script" id="MJXp-Span-43" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Ä≤</font></font></span></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;"> i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47"><font style="vertical-align: inherit;">S</font></span></font><span class="MJXp-mtext" id="MJXp-Span-44">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-45"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-46"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-47"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-7-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="6.052ex" height="2.178ex" viewBox="0 -832 2605.8 937.7" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="0" y="0"></use><use transform="scale(0.707)" xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMAIN-2032" x="663" y="513"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-69" x="1014" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-6E" x="1359" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-53" x="1960" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-7"> s ‚Äô\ in S </script>  , given that the process is in a state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-48"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-49"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;">S</font></span></font><span class="MJXp-mtext" id="MJXp-Span-50">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-51"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-52"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-53"><font style="vertical-align: inherit;"></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processed" id="MathJax-Element-8-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"><svg xmlns:xlink="http://www.w3.org/1999/xlink" width="5.368ex" height="2.057ex" viewBox="0 -780.1 2311 885.9" role="img" focusable="false" style="vertical-align: -0.246ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-73" x="0" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-69" x="719" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-6E" x="1065" y="0"></use><use xlink:href="https://translate.googleusercontent.com/translate_c?depth=1&amp;rurl=translate.google.com&amp;sl=ru&amp;sp=nmt4&amp;tl=en&amp;u=https://habr.com/ru/post/353304/&amp;xid=17259,15700002,15700019,15700186,15700190,15700248,15700253&amp;usg=ALkJrhgtR1lzmgbhjkEFXfQReszOI_Mr5A#MJMATHI-53" x="1665" y="0"></use></g></svg></span><script type="math/tex" id="MathJax-Element-8"> s \ in S </script>  and the player performs the action <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-54"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-55"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">A </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">s</font></span></span></font><span class="MJXp-mtext" id="MJXp-Span-56">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-57"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-58"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-59"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-60" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-61" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-9-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-9"> a \ in A_s </script>  .  Let be <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-62"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-63"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">R </font></font></span><span class="MJXp-mo" id="MJXp-Span-64" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-65"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-66" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-10-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-10"> R (s) </script>  denotes reward for transition to the state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-67"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-68"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-11-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-11"> s </script>  .  Finally let <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-69"><span class="MJXp-mtext" id="MJXp-Span-70">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-71"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-72"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-12-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-12"> \ pi </script>  mean algorithm as well <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-73"><span class="MJXp-mtext" id="MJXp-Span-74">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-75"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-76"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i </font></font></span><span class="MJXp-mo" id="MJXp-Span-77" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-78"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-79" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) </font></font></span><font style="vertical-align: inherit;"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81"><font style="vertical-align: inherit;">i </font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82"><font style="vertical-align: inherit;">n </font></span><span class="MJXp-msubsup" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84" style="margin-right: 0.05em;"><font style="vertical-align: inherit;">A </font></span></span><span class="MJXp-msubsup" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-85" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;">s</font></span></span></font><span class="MJXp-mtext" id="MJXp-Span-80">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-81"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-82"><font style="vertical-align: inherit;"></font></span><span class="MJXp-msubsup" id="MJXp-Span-83"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-84" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-85" style="vertical-align: -0.4em;"><font style="vertical-align: inherit;"></font></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-13-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-13"> \ pi (s) \ in A_s </script>  denotes the action to be performed in the state <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-86"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-87"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-14-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-14"> s </script>  to follow the algorithm <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-88"><span class="MJXp-mtext" id="MJXp-Span-89">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-90"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-91"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-15-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-15"> \ pi </script>  . <br><br>  For a given algorithm <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-92"><span class="MJXp-mtext" id="MJXp-Span-93">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-94"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-95"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-16-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-16"> \ pi </script>  and states <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-96"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-97"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-17-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-17"> s </script>  state value <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-98"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-99"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-18-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-18"> s </script>  according to <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-100"><span class="MJXp-mtext" id="MJXp-Span-101">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-102"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">p </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-103"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">i</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-19-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-19"> \ pi </script>  equally <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-104"><span class="MJXp-msubsup" id="MJXp-Span-105"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-106" style="margin-right: 0.05em;">V</span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-107" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-108">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-109">i</span><span class="MJXp-mo" id="MJXp-Span-110" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-111">s</span><span class="MJXp-mo" id="MJXp-Span-112" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-113" style="margin-left: 0.333em; margin-right: 0.333em;">=</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-114">R</span><span class="MJXp-mo" id="MJXp-Span-115" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-116">s</span><span class="MJXp-mo" id="MJXp-Span-117" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-118" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mtext" id="MJXp-Span-119">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-120">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-121">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-122">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-123">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-124">a</span><span class="MJXp-mtext" id="MJXp-Span-125">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-126">s</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-127">u</span><span class="MJXp-msubsup" id="MJXp-Span-128"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-129" style="margin-right: 0.05em;">m</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-130" style="vertical-align: -0.4em;"><span class="MJXp-msup" id="MJXp-Span-131"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-132" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-133" style="vertical-align: 0.5em;">‚Ä≤</span></span></span></span><span class="MJXp-mtext" id="MJXp-Span-134">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-135">P</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-136">r</span><span class="MJXp-mo" id="MJXp-Span-137" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-138"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-139" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-140" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mrow" id="MJXp-Span-141"><span class="MJXp-mo" id="MJXp-Span-142" style="margin-left: 0.167em; margin-right: 0.167em;">|</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-143">s</span><span class="MJXp-mo" id="MJXp-Span-144" style="margin-left: 0em; margin-right: 0.222em;">,</span><span class="MJXp-mtext" id="MJXp-Span-145">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-146">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-147">i</span><span class="MJXp-mo" id="MJXp-Span-148" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-149">s</span><span class="MJXp-mo" id="MJXp-Span-150" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-mo" id="MJXp-Span-151" style="margin-left: 0em; margin-right: 0em;">)</span><span class="MJXp-msubsup" id="MJXp-Span-152"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-153" style="margin-right: 0.05em;">V</span><span class="MJXp-mtext MJXp-script" id="MJXp-Span-154" style="vertical-align: 0.5em;">&nbsp;</span></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-155">p</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-156">i</span><span class="MJXp-mo" id="MJXp-Span-157" style="margin-left: 0em; margin-right: 0em;">(</span><span class="MJXp-msup" id="MJXp-Span-158"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-159" style="margin-right: 0.05em;">s</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-160" style="vertical-align: 0.5em;">‚Ä≤</span></span><span class="MJXp-mo" id="MJXp-Span-161" style="margin-left: 0em; margin-right: 0em;">)</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-20-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-20"> V ^ \ pi (s) = R (s) + \ gamma \ sum_ {s ‚Äô} \ Pr (s‚Äô | s, \ pi (s)) V ^ \ pi (s ‚Äô) </script></p><br>  where the first term is an instantaneous reward, and summation gives the expected value of the subsequent states, provided that the player continues to follow the algorithm. <br><br>  Coefficient <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-162"><span class="MJXp-mtext" id="MJXp-Span-163">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-164">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-165">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-166">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-167">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-168">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-21-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-21"> \ gamma </script>  - is <em>the depreciation rate</em> , which replaces the value of the instantaneous remuneration by the value of the expected future remuneration.  In other words, it takes into account the <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2582%25D0%25BE%25D0%25B8%25D0%25BC%25D0%25BE%25D1%2581%25D1%2582%25D1%258C_%25D0%25B4%25D0%25B5%25D0%25BD%25D0%25B5%25D0%25B3_%25D1%2581_%25D1%2583%25D1%2587%25D1%2591%25D1%2582%25D0%25BE%25D0%25BC_%25D1%2584%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BE%25D1%2580%25D0%25B0_%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D0%25B5%25D0%25BD%25D0%25B8">cost of money, taking into account the time factor</a> : the reward now usually costs more than the same reward later.  If a <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-169"><span class="MJXp-mtext" id="MJXp-Span-170">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-171">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-172">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-173">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-174">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-175">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-22-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-22"> \ gamma </script>  close to 1, this means that the player is very patient: he does not mind waiting for a future reward;  similarly, smaller values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-176"><span class="MJXp-mtext" id="MJXp-Span-177">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-178">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-179">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-180">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-181">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-182">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-23-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-23"> \ gamma </script>  mean the player is less patient.  For now, we assign the depreciation factor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-183"><span class="MJXp-mtext" id="MJXp-Span-184">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-185">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-186">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-187">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-188">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-189">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-24-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-24"> \ gamma </script>  a value of 1, which corresponds to our assumption that the player cares only about the victory, and not the time it takes for her <sup>4</sup> . <br><br>  So how do we find an algorithm?  In each of the states, we want to choose an action that maximizes the expected future reward: <br><br><p></p><p><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math MJXp-display" id="MJXp-Span-190"><span class="noError" id="MJXp-Span-191" style="display: inline-block;">\&nbsp;pi&nbsp;(s)&nbsp;=&nbsp;\&nbsp;mathop&nbsp;{\&nbsp;mathrm&nbsp;{argmax}}&nbsp;\&nbsp;limits_&nbsp;{a&nbsp;\&nbsp;in&nbsp;A_s}&nbsp;\&nbsp;left&nbsp;\&nbsp;{\&nbsp;sum_&nbsp;{s&nbsp;'}&nbsp;\&nbsp;Pr&nbsp;(s'&nbsp;|&nbsp;s,&nbsp;a)&nbsp;V&nbsp;^&nbsp;\&nbsp;pi&nbsp;(s&nbsp;')&nbsp;\&nbsp;right&nbsp;\}</span></span></span><div class="MathJax_SVG_Display MathJax_SVG_Processing"><span class="MathJax_SVG" id="MathJax-Element-25-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span></div><script type="math/tex;mode=display" id="MathJax-Element-25"> \ pi (s) = \ mathop {\ mathrm {argmax}} \ limits_ {a \ in A_s} \ left \ {\ sum_ {s '} \ Pr (s' | s, a) V ^ \ pi (s ') \ right \} </script></p><br>  This gives us two related equations that we can solve iteratively.  That is, choose the original algorithm, which can be very simple, calculate the value of each state in accordance with this simple algorithm, and then find a new algorithm based on this function of values, and so on.  It is noteworthy that in very limited technical conditions such an iterative process is guaranteed to converge to the optimal algorithm. <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-192"><span class="MJXp-mtext" id="MJXp-Span-193">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-194">p</span><span class="MJXp-msubsup" id="MJXp-Span-195"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-196" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-197" style="vertical-align: 0.5em;">‚àó</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-26-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-26"> \ pi ^ * </script>  and optimal function of values <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-198"><span class="MJXp-msubsup" id="MJXp-Span-199"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-200" style="margin-right: 0.05em;">V</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-201" style="vertical-align: 0.5em;"><span class="MJXp-mtext" id="MJXp-Span-202">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-203">p</span><span class="MJXp-msubsup" id="MJXp-Span-204"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-205" style="margin-right: 0.05em;">i</span><span class="MJXp-mo MJXp-script" id="MJXp-Span-206" style="vertical-align: 0.5em;">‚àó</span></span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-27-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-27"> V ^ {\ pi ^ *} </script>  regarding this optimal algorithm. <br><br>  Such a standard iterative approach works well for models of MDP games on a 2x2 field, but is not suitable for models of 3x3 and 4x4 games that have much more states and therefore consume much more memory and computing power.  Fortunately, it turns out that we can use the structure of our 2048 models for a much more efficient solution of these equations (see Appendix B). <br><br><h2>  The optimal game on the field 2x2 </h2><br>  Now we are ready to see the optimal algorithms in action!  If you enter the initial number <code>42</code> and press the <code>Start</code> button in the original article, you will reach tile <code>8</code> in 5 moves.  The initial number determines the sequence of new tiles placed by the game;  if you select a different starting number by pressing the button, then (usually) the game will evolve differently. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/6w/-b/eo/6w-beovfsulyufkd7pvpbylrbbo.gif"></div></div></div><br>  In the game 2x2 before tile <code>8</code> really nothing to look at.  If the player follows the optimal algorithm, he will always win.  (As we saw above when building transition probabilities, if a player plays suboptimally, that is, the possibility of losing.) This is reflected in the fact that the value of the state throughout the game remains equal to 1.00 - with an optimal game there is at least one action in each attainable state, which leads to victory. <br><br>  If we instead ask the player to play before tile <code>16</code> , then even with an optimal game, the victory will no longer be guaranteed.  In this case, when playing before tile <code>16</code> choice of a new initial number should lead to victory in 96% of cases, so we have chosen one of the few that lead to loss as the initial number. <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/my/zs/bo/myzsbo2dc8km6aly4pwy4efldro.gif"></div></div></div><br>  As a result of the assignment of the depreciation factor <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-207"><span class="MJXp-mtext" id="MJXp-Span-208">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-209">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-210">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-211">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-212">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-213">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-28-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-28"> \ gamma </script>  Values ‚Äã‚Äã1 The value of each state tells us the probability of winning from this state.  Here the value starts from 0.96, and then gradually decreases to 0.90, because the outcome depends on whether the next tile will have the value <code>2</code> .  Unfortunately, the game sets tile <code>4</code> , so the player loses, despite the optimal game. <br><br>  Finally, we have <a href="http://jdlm.info/articles/2017/09/17/counting-states-combinatorics-2048.html">previously established</a> that the largest attainable tile on a 2x2 field is tile <code>32</code> , so let's look at the optimal algorithm.  Here, the probability of winning drops to only 8%.  (This is the same game and the same algorithm used in the introduction, but now interactive.) <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/h8/rd/dg/h8rddg4b2hx_jhtwkgxnhojs0km.gif"></div></div></div><br>  It is worth noting that each of the algorithms shown above is the optimal algorithm of the corresponding game, but there is no guarantee of its uniqueness.  There may be many similar optimal algorithms, but we can definitely say that none of them is strictly the best. <br><br>  If you want to explore these models for the 2x2 game in more detail, then Appendix A contains diagrams showing all possible paths to the game. <br><br><h1>  The optimal game on the field 3x3 </h1><br>  On the 3x3 field, you can play up to <code>1024</code> tiles, and this game has <a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html">25 million states</a> .  Therefore, it is absolutely impossible to draw the MDP scheme, which we did for 2x2 games, but we can still observe the optimal algorithm in action <sup>5</sup> : <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/P9sQ9pirjbI" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Just like in the 2x2 game to tile <code>32</code> , in the 3x3 game to <code>1024</code> tile it is very difficult to win - with an optimal game, the probability of winning is only about 1%.  As a less useless entertainment, you can choose a game before tile <code>512</code> , in which the probability of winning with an optimal game is much higher, about 74%: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/gThSs1tYIhc" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  At the risk of anthropomorphic large state and action tables, which is the algorithm, I see here elements of the strategies that I use when playing in 2048 on a 4x4 field.  We see that the algorithm puts tiles with high values ‚Äã‚Äãon the edges and usually in corners (although in the game up to <code>1024</code> he often places a tile <code>512</code> in the middle of the field boundary).  You can also notice that he is "lazy" - even when there are two tiles with high values ‚Äã‚Äãthat can be combined, he continues to combine values ‚Äã‚Äãwith smaller values.  It is logical that, especially in the cramped 3x3 field conditions, it is worth using the opportunity to <a href="http://jdlm.info/articles/2017/08/05/markov-chain-2048.html">increase the amount of your tiles</a> without the risk of (instantaneous) loss - if it fails to combine smaller tiles, it can always combine larger ones, which frees the field. <br><br>  It is important to note that they did not train the algorithm in these strategies and did not give him any hints. <br>  about how to play.  All his behaviors and apparent intelligence arise exclusively from the solution of the optimization problem, taking into account the transition probabilities and the reward function transferred by us. <br><br><h1>  The best game on the field 4x4 </h1><br>  As it turned out in the previous post, the game before the <code>2048</code> tile on the 4x4 field has at least trillions of states, so it is not yet possible to even list all the states, let alone the MDP solution, to obtain the optimal algorithm. <br><br>  However, we can iterate over and execute the solution for a 4x4 game to a tile of <code>64</code> ‚Äî there will be ‚Äúonly‚Äù 40 billion states in this model.  As in the game 2x2 before tile <code>8</code> , with optimal play it is impossible to lose.  Therefore, it is not very interesting to observe it, since in many cases there are several good states, and the choice between them is carried out in an arbitrary manner. <br><br>  However, if we reduce the depreciation rate <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-214"><span class="MJXp-mtext" id="MJXp-Span-215">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-216">g</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-217">a</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-218">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-219">m</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-220">a</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-29-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-29"> \ gamma </script>  that will make the player a little impatient, he will prefer to win faster rather than later.  Then the game will look a little more targeted.  Here is the optimal player when <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-221"><span class="MJXp-mtext" id="MJXp-Span-222">&nbsp;</span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-223"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">g </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-224"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-225"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-226"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">m </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-227"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mo" id="MJXp-Span-228" style="margin-left: 0.333em; margin-right: 0.333em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">= </font></font></span><span class="MJXp-mn" id="MJXp-Span-229"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">0.99</font></font></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-30-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-30"> \ gamma = 0.99 </script>  : <br><br><div class="spoiler">  <b class="spoiler_title">Gif</b> <div class="spoiler_text"><div style="text-align:center;"><img src="https://habrastorage.org/webt/rx/pb/nx/rxpbnxl8wc3daqdutr3spdftpy8.gif"></div></div></div><br>  Initially, the value is approximately 0.72;  the exact initial value reflects the expected number of steps that will be required to win from a randomly selected initial state.  It gradually increases with each turn, because the reward for achieving the state of victory becomes closer.  The algorithm again makes good use of the borders and corners of the field to build sequences of tiles in a convenient way to merge. <br><br><h2>  Conclusion </h2><br>  We figured out how to present the 2048 game as a Markov decision-making process and obtained demonstrably optimal algorithms for the 2x2 and 3x3 field games, as well as for the limited game on the 4x4 field. <br><br>  The methods used here require a solution to enumerate all the states of the model.  The use of <a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html">effective state transfer strategies</a> and effective strategies for solving this model (see Appendix B) makes them suitable for models with up to 40 billion states, that is, for playing 4x4 to <code>64</code> .  Calculations for this model required approximately one week of operation of the OVH HG-120 instance with 32 cores, 3.1 GHz and 120GB of RAM.  The next closest 4x4 game to tile <code>128</code> is likely to contain many times more states and will require much more computing power.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Calculating a provably optimal algorithm for a full game up </font></font><code>2048</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">probably will require other methods of solution. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It often turns out that MDP in practice is too large to be solved, therefore there are proven techniques for finding approximate solutions. </font><font style="vertical-align: inherit;">They usually use the storage of approximate functions of values ‚Äã‚Äãand / or algorithm, for example, using learning (possibly deep) neural networks. </font><font style="vertical-align: inherit;">Also, instead of listing the entire state space, they can be trained on these simulations using reinforced learning methods. </font><font style="vertical-align: inherit;">The existence of demonstrably optimal algorithms for smaller games can make the 2048 a useful test bed for such methods - this can be an interesting topic for research in the future.</font></font><br><br><hr><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Appendix A: canonization </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As we saw in the example of the full model for a 2x2 game to a tile </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the number of states and transitions grows very quickly, and it becomes difficult to graphically present even games on a 2x2 field. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To maintain control over the size of the model, we can again use the observation from the </font></font><a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previous post about the enumeration of states</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : many of the subsequent states are simply turns and reflections of each other. </font><font style="vertical-align: inherit;">For example, states</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/704/06d/f07/70406df07bc3abc30b8081ce82dd7e1a.svg" alt="4 2 - 2"></div><br>  and <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/457/b32/e71/457b32e71edbc74b87e4a69ddff2601f.svg" alt="2 4 2 -"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">they are just mirror copies ‚Äî they are just reflections on the vertical axis. If the best action in the first state is a shift to the left, then the best action in the second state will necessarily be a shift to the right. That is, from the point of view of making decisions about the choice of an action, it suffices to choose one of the states as </font></font><em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">canonical</font></font></em><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and determine the best action that needs to be made from the canonical state. The canonical state of a given state is obtained by finding all its possible turns and reflections, recording each one as the number on the base 12 and selecting the state on the smallest number ‚Äî see details in the </font></font><a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previous post.</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">It is important here that each canonical state replaces the class of equivalent states associated with it by rotation or reflection, so we will not have to deal with them separately. </font><font style="vertical-align: inherit;">Replacing the subsequent states presented above with their canonical states, we obtain a more compact scheme:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a44/d7a/5a1/a44d7a5a108f3797cbe27d1cc95d46f3.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unfortunately, from the scheme it follows that a shift up ( </font></font><code>U</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) from </font></font><img src="https://habrastorage.org/getpro/habr/post_images/18a/103/fb5/18a103fb518135917b1a2f75f38d867c.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">some way will lead to</font></font><img src="https://habrastorage.org/getpro/habr/post_images/3a2/9d2/694/3a29d2694e1cd32b9191baa9c2c0aadb.svg">  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> However, the paradox is resolved by reading the arrows and adding a rotation or reflection if necessary, in order to find the actual canonical state of the subsequent state. </font></font><br><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Equivalent actions </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can also note that in the diagram shown above, in fact, it does not matter in which direction the player performs a shift from the state </font></font><img src="https://habrastorage.org/getpro/habr/post_images/18a/103/fb5/18a103fb518135917b1a2f75f38d867c.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">‚Äî the canonical successive states and their transition probabilities are the same for all actions. To understand why, it is worth looking at the ‚Äúintermediate state‚Äù after the player has made a shift to move the tiles, but when the game has not yet added a new random tile:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/85a/5a4/706/85a5a470659763944e260d05140218af.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Intermediate states are marked with dashed lines. </font><font style="vertical-align: inherit;">The most important thing to notice here is that they are all connected by a 90 ¬∞ rotation. </font><font style="vertical-align: inherit;">These twists and turns are not important if, as a result, we canonize subsequent states. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More generally, if two or more actions have the same canonical ‚Äúintermediate state‚Äù, then these actions must have the same canonical successive states, and therefore they are equivalent. </font><font style="vertical-align: inherit;">In the example shown above, the last canonical intermediate state is:</font></font><img src="https://habrastorage.org/getpro/habr/post_images/fd2/8dd/c96/fd28ddc96192eaf7fa0b7f4985ef3c40.svg">  . <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, we can further simplify the scheme for </font></font><img src="https://habrastorage.org/getpro/habr/post_images/18a/103/fb5/18a103fb518135917b1a2f75f38d867c.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if we simply combine all the equivalent actions:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/9c4/0ae/f28/9c40aef28c64784dbfd9cd6b14fe7d71.svg"></div><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, states for which all actions are equivalent in this sense are relatively rare. </font><font style="vertical-align: inherit;">Having considered another potential initial state </font></font><img src="https://habrastorage.org/getpro/habr/post_images/fd2/8dd/c96/fd28ddc96192eaf7fa0b7f4985ef3c40.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we will see that the left and right shifts are equivalent, but the upward shift is different; </font><font style="vertical-align: inherit;">a down shift is not allowed because the tiles are already at the bottom.</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28d/a32/92f/28da3292f891644d74c714e319dba858.svg"></div><br><h3><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> MDP Models for 2x2 Games </font></font></h3><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Thanks to canonization, we can reduce the model to a scale at which you can draw full MDP for some small games. Let's start again with the smallest non-trivial model: 2x2 games to the tile </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/72a/6f7/432/72a6f743268d125d1597da3af63b890a.svg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Compared to the scheme without canonization, this one turned out to be much more compact. We see that the shortest possible game consists of only one move: if we are lucky to start from a state </font></font><img src="https://habrastorage.org/getpro/habr/post_images/67c/6b3/6dc/67c6b36dc42dbf99564b6eb4f3547868.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with two adjacent tiles </font></font><code>4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which happens only in one game for 150, we just need to connect them to get a tile </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and a state </font></font><code>win</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. On the other hand, we see that it is still possible to lose: if from the state the </font></font><img src="https://habrastorage.org/getpro/habr/post_images/67c/6b3/6dc/67c6b36dc42dbf99564b6eb4f3547868.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">player shifts upwards, then with a probability of 0.9 he will receive</font></font><img src="https://habrastorage.org/getpro/habr/post_images/0cc/62d/2df/0cc62d2df004b8f5edb33a1f37044c7d.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">if it makes a shift again, it will receive with a probability of 0.9 </font></font><img src="https://habrastorage.org/getpro/habr/post_images/cb6/deb/de2/cb6debde27018f90707e84128aeb0d4e.svg"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and at that moment the game will be lost. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We can further simplify the scheme if we know the optimal algorithm. The definition of the algorithm generates a Markov chain from the MDP model, because each state has a single action or a group of equivalent actions defined by the algorithm. The generated chain for a 2x2 game </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">has the following form: </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7ea/dba/39d/7eadba39deb5dba3270035dd6bebae3d.svg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see that </font></font><code>lose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">no more edges lead </font><font style="vertical-align: inherit;">to the state </font><font style="vertical-align: inherit;">, because with an optimal game of 2x2 before the tile, </font></font><code>8</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is impossible to lose. In addition, each state is now marked with its value, which in this case is always equal to 1.000. Since we assigned the depreciation rate</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-230"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-231"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Œ≥</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> value is 1, then the value of the state is actually the probability of gaining from this state in the optimal game. </font><font style="vertical-align: inherit;">The schemes become a bit more chaotic, but we can build similar models for playing 2x2 tiles</font><font style="vertical-align: inherit;">:</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-31-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-31">\gamma</script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><code>16</code><font style="vertical-align: inherit;"></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a5e/f6b/354/a5ef6b3542a82e52de309724085dfe28.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we look at the optimal algorithm for the game to the tile </font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, we see that the initial states (blue) have values ‚Äã‚Äãless than one, and that there are paths to the state </font></font><code>lose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, in particular, from two states in which the sum of tiles is 14:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/808/ac9/c40/808ac9c4041f4322f006ccea6c947c2c.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">That is, if we play this game before the tile in the </font></font><code>16</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">optimal way, we will still be able to lose, and this will depend on the specific sequence of the tiles given to us by the game </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">However, in most cases we will win - the values ‚Äã‚Äãin the initial states are approximately equal to 0.96, so we expect to win in about 96 games out of a hundred. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">However, our prospects for playing up </font></font><code>32</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to a 2x2 </font><font style="vertical-align: inherit;">tile </font><font style="vertical-align: inherit;">on the field are much worse. </font><font style="vertical-align: inherit;">Here is the complete model:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50b/39a/03c/50b39a03cf4ee767fd16be8e8a493f93.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We see that many edges lead to a state </font></font><code>lose</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, and this is a bad sign. </font><font style="vertical-align: inherit;">This is confirmed, if you look at the scheme, limited to the optimal game:</font></font><br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c31/8c7/d3f/c318c7d3f575fd9ec30960f36d29a89f.svg"></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The average value for the initial states is approximately 0.08, so we should expect victory in about 8 games out of a hundred. </font><font style="vertical-align: inherit;">The main reason for this becomes apparent when we look at the right side of the diagram: reaching a state with a sum of 28, the only way to win is to get a tile </font></font><code>4</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to reach the state</font></font><img src="https://habrastorage.org/getpro/habr/post_images/aac/163/7e7/aac1637e7a7a70a6de635333712e0357.svg">  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If we get a tile </font></font><code>2</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, which happens 90% of the time, we lose. </font><font style="vertical-align: inherit;">Perhaps this game will not be very interesting.</font></font><br><br><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Appendix B: Solution Methods </font></font></h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> To effectively solve MDP models that are similar to the ones we built here for 2048, we can use the important properties of their structure: </font></font><br><br><ol><li>    <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">  </a> ().       ,   ‚Äî  2   4,        . </li><li>  ,     ¬´¬ª    ,         MDP,           <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-232"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-233">s</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-32-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-32">s</script>       <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-234"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-235">s</span><span class="MJXp-mo" id="MJXp-Span-236" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-237">2</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-33-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-33">s+2</script> ,     ,   <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-238"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-239">s</span><span class="MJXp-mo" id="MJXp-Span-240" style="margin-left: 0.267em; margin-right: 0.267em;">+</span><span class="MJXp-mn" id="MJXp-Span-241">4</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-34-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-34">s+4</script>  . </li><li>              ,    ,   0  1. </li></ol><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Property (3) means that we can loop through all the states in the last layer, in which all subsequent values ‚Äã‚Äãare known, and generate a function of values ‚Äã‚Äãfor this last layer. Further, thanks to property (2), we know that the states in the second from the end of the layer must go either to the states in the last layer for which we have just calculated the values, or to the win or lose state, which have known values. In this way, we can go backwards, layer by layer, always knowing the values ‚Äã‚Äãof the states in the next two layers; this allows us to construct both a function of values ‚Äã‚Äãand an optimal algorithm for the current layer. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the </font></font><a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">previous post</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">we did the work in a straightforward order, from the initial states and enumerated all the states, layer by layer, using a convolution mapping to parallelize the work inside each layer. For the solution, we can use the output of this enumeration, which is a huge list of states, to perform the work in the reverse order, again applying a convolution mapping for parallel work in each layer. Like last time, we split the layers into ‚Äúparts‚Äù according to their maximum tile values ‚Äã‚Äãwith tracking additional information. </font></font><br><br> <a href=""><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Basic solver implementation</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">it is still quite memory demanding, because in order to process the current part in one pass, it needs to store in memory the functions of several (up to four) parts. </font><font style="vertical-align: inherit;">You can reduce this requirement until only one part is stored in memory at one time by what is commonly called</font></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-242"><span class="MJXp-msubsup" id="MJXp-Span-243"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-244" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Q </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-245" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œÄ</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-246" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-247"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-248" style="margin-left: 0em; margin-right: 0.222em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-249"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">a </font></font></span><span class="MJXp-mo" id="MJXp-Span-250" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> - values ‚Äã‚Äãfor each possible state-action pair according to the algorithm</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-35-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-35">Q^\pi(s,a)</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-251"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-252"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œÄ</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> and not</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-36-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-36">\pi</script><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-253"><span class="MJXp-msubsup" id="MJXp-Span-254"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-255" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-256" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œÄ</font></font></span></span><span class="MJXp-mo" id="MJXp-Span-257" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ( </font></font></span><span class="MJXp-mi MJXp-italic" id="MJXp-Span-258"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">s </font></font></span><span class="MJXp-mo" id="MJXp-Span-259" style="margin-left: 0em; margin-right: 0em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , but</font><a href=""><font style="vertical-align: inherit;">this implementation of the solver</font></a><font style="vertical-align: inherit;">turned out to be much slower, so all the results were obtained using the main solver</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-37-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-37">V^\pi(s)</script><font style="vertical-align: inherit;"></font><a href=""><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-260"><span class="MJXp-msubsup" id="MJXp-Span-261"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-262" style="margin-right: 0.05em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">V </font></font></span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-263" style="vertical-align: 0.5em;"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">œÄ</font></font></span></span></span></span><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> on a machine with a lot of RAM.</font><font style="vertical-align: inherit;">In the case of both solvers, the layered structure of the model allows us to build and solve a model with just one pass forward and one pass back, which is a significant improvement over the conventional iterative solution method. This is one of the reasons why we are able to solve such fairly large MDP models with billions of states. Also important reasons are the methods of canonization from Appendix A, which allow to reduce the number of counted states, and</font><a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html"><font style="vertical-align: inherit;">low-level efficiency optimization</font></a><font style="vertical-align: inherit;">from the previous post.</font></font><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-38-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-38">V^\pi</script><font style="vertical-align: inherit;"></font><br><br><font style="vertical-align: inherit;"></font><a href="http://jdlm.info/articles/2017/12/10/counting-states-enumeration-2048.html"><font style="vertical-align: inherit;"></font></a><font style="vertical-align: inherit;"></font><br><br><hr><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I thank </font></font><a href="https://twitter.com/h0peth0mas"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Hope Thomas</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for editing the drafts of this article. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you've read this far, then you might want </font></font><a href="https://twitter.com/jdleesmiller"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">to subscribe to my twitter</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , or even send your resume to work at </font></font><a href="https://www.overleaf.com/jobs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Overleaf</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h1>  Notes </h1><br><ol><li>       : ,       <code>2</code>  ,    ,   ,      <code>4</code> ,     <code>8</code> .             .      <a href=""></a> ,  ,   ,       (  )  ‚Äî <a href=""></a> ;    <a href=""></a> . </li><li>       <code>dot</code>  <a href="http://www.graphviz.org/">graphviz</a> . </li><li>      . ,  <a href="https://habrahabr.ru/post/339342/"> </a>        <code>2048</code>     ;        ,       .     ,       . ,    1             , ,   ,       . </li><li>    ,        ,     <code>win</code>  <code>lose</code>      . ,     <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-264"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-265">œÄ</span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-39-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-39">\pi</script>  and <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-266"><span class="MJXp-msubsup" id="MJXp-Span-267"><span class="MJXp-mi MJXp-italic" id="MJXp-Span-268" style="margin-right: 0.05em;">V</span><span class="MJXp-mi MJXp-italic MJXp-script" id="MJXp-Span-269" style="vertical-align: 0.5em;">œÄ</span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-40-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-40">V^\pi</script> , ,            ,          <code>lose</code>  <code>win</code> .     <em> </em> <code>end</code>   ,        <code>end</code>   1.         <code>lose</code>  <code>win</code> ,       <code>end</code>   1.   <code>end</code>   ,     .   ,       MDP,        , ,       ,     ,     (   :       ,     . </li><li>  ,    <a href="https://en.wikipedia.org/wiki/Time_preference"> </a>   ,        .         ,      .   ,       ,    .     ,    ,         1,      ,         ,     . </li><li>   3x3  4x4  :            (    ,      GitHub,   ).        ,     <math></math><span class="MathJax_Preview" style="color: inherit;"><span class="MJXp-math" id="MJXp-Span-270"><span class="MJXp-msubsup" id="MJXp-Span-271"><span class="MJXp-mn" id="MJXp-Span-272" style="margin-right: 0.05em;">10</span><span class="MJXp-mrow MJXp-script" id="MJXp-Span-273" style="vertical-align: 0.5em;"><span class="MJXp-mo" id="MJXp-Span-274">‚àí</span><span class="MJXp-mn" id="MJXp-Span-275">7</span></span></span></span></span><span class="MathJax_SVG MathJax_SVG_Processing" id="MathJax-Element-41-Frame" tabindex="0" style="font-size: 100%; display: inline-block;"></span><script type="math/tex" id="MathJax-Element-41">10^{-7}</script>           .  , ,  ,         ,     ,      ,       .          ,   .      ,    <a href="https://habrahabr.ru/post/339342/">       2048</a> . </li><li> ,   ,     2048.        ! </li></ol></div><p>Source: <a href="https://habr.com/ru/post/353304/">https://habr.com/ru/post/353304/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../353290/index.html">Firefox Gecko, "which we lost"</a></li>
<li><a href="../353292/index.html">Why does "=" mean assignment?</a></li>
<li><a href="../353294/index.html">JNI: Making friends with Java and C ++</a></li>
<li><a href="../353298/index.html">Self-Conscious Applications: Automated Production Diagnostics</a></li>
<li><a href="../353300/index.html">Journalists found 11 cryptocurrency exchange points and 4 Bitcoin-ATM machines in Moscow</a></li>
<li><a href="../353306/index.html">Solidity 0.5.0 - what's new for us</a></li>
<li><a href="../353308/index.html">Mail.Ru Mail will hold the first ML-hakaton SmartMail Hack 2018</a></li>
<li><a href="../353310/index.html">IT courses: what remains behind the scenes</a></li>
<li><a href="../353312/index.html">TDD wrong?</a></li>
<li><a href="../353314/index.html">SOC for intermediate. We understand what we are protecting, or how to make an inventory of infrastructure</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>