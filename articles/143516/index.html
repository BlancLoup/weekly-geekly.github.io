<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We build a secure system based on TOR and I2P</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 In this post I will try to describe in steps how to build a secure system for the safe reception, transmission, storage and processing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We build a secure system based on TOR and I2P</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  In this post I will try to describe in steps how to build a secure system for the safe reception, transmission, storage and processing of confidential and other dangerous data.  It is not a secret for anyone that now various individuals and organizations are trying to stifle the freedom of both the Internet itself and its users, and often they succeed.  Therefore, now we will try to build a small but solid fortress inside our computer. <br><br>  I can respond to a provocation of the form ‚Äúwith the help of such a system,‚Äù I respond immediately: with the help of nuclear missiles, you can not only make the end of the world, but also drive away or split an asteroid that threatens our planet. <br><a name="habracut"></a><br><h4>  What do we need? </h4><br>  First, it is a computer of sufficient performance with a <b>large amount of RAM</b> .  Its operating system does not matter, since the software installed on it is cross-platform.  Well, except perhaps for exotic or very ancient OS. <br>  Secondly, <b>the software</b> .  I will list it in the order in which it will be required in building the system: <br><br><ul><li>  <a href="http://truecrypt.org/">Truecrypt</a> </li><li>  VirtualBox (download from the official site is not in a hurry) </li><li>  <a href="http://ubuntu.com/">Ubuntu</a>  I did on version 11.10 x86, because 12.04 at that time was not.  Put the image to swing right now so as not to lose time.  Cut to disk is not necessary. </li><li>  TOR </li><li>  I2p </li></ul><br>  I draw your attention that all the above software is open source.  <b>This is very important</b> , since these programs are the core of our security, and some proprietary bookmark could be very costly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Let's start! </h4><br>  In order to protect data from direct capture of the hard disk, we need to encrypt them.  For this we will use the utility TrueCrypt. <br><br>  Let's create with its help an encrypted volume stored in a file.  You can create a section, but, in my opinion, it is less convenient. <br><br>  Whether to create a hidden volume?  The question is ambiguous.  This feature is intended for use in England, where the failure to issue passwords when confiscating a PC is itself a crime.  At the same time, there is no such legal norm in Russia, and the use of a hidden partition eats up the usable disk space.  I did not create a hidden section. <br><br>  The size of the section will choose at its discretion.  Personally, I chose 50 GB. <br><br>  Encryption algorithm - I chose AES.  First, the US military trusts him to protect the top security marks, and secondly, it is hardware accelerated by new Intel processors and TrueCrypt has support for this acceleration. <br><br>  Then everything is standard: we invent a complex and long password, generate entropy with random mouse movements and create a partition.  The partition type must be NTFS, since it will store large files. <br><br>  Next we need a virtual machine.  Everything that we protect will be stored in it. <br>  This is due to the fact that: <br><ul><li>  work in the main OS leaves various traces in various places; </li><li>  if the main OS is proprietary (I will not point with a finger) - it does not exclude the presence of bookmarks; </li><li>  application software in the main OS also falls under the previous requirement (remember PunkBuster, whose EULA allows you to scan a user's hard disk). </li></ul><br>  We will use VirtualBox, but not the main distribution, but a <a href="http://www.vbox.me/">portable one</a> .  Download the installer on a pre-mounted encrypted disk, launch and download the supported Box distribution using the utility itself.  Next, the utility will unpack it and configure it for portability. <br><br>  We will create a machine with two hard disks in Box: one for 8-10 GB and the second for the rest of the space, of course, placing both on an encrypted disk.  Let's go through the settings, put the network in the NAT and configure the rest to your liking - there is nothing particularly critical there.  We connect the image of Ubunt (which I hope has already been downloaded) as a drive. <br><br>  We start the car and start installing the OS.  When partitioning disks, we do something like this: put it on the first, small, root and swap, and on the large / home.  All data we will store in / home.  Thus, the separation of the system and data occurs between different files of hard drives Box.  Then we do everything to your liking. <br><br>  It is established!  Now we begin setup. <br><br>  The idea is to leave direct access to the network only for two of your favorites ‚Äî the TOR and I2P routers. <br><br>  First, we put TOR from their own repository (in the official version it may be outdated) <a href="">according to the instructions from the official site</a> .  Then we will install I2P, again from the developers' own PPA-turnip - <a href="http://www.i2p2.de/debian.html">instruction</a> . <br><br>  Note that TOR itself only provides SOCKS5 proxies, and not all programs support it.  Therefore, install Polipo - a free HTTP proxy: <br> <code>sudo apt-get install polipo</code> <br> <br>  Configure it: <br> <code>sudo nano /etc/polipo/config</code> <br> <br>  Add a line to it: <br> <code>proxyPort = 8118</code> <br> <br>  Uncomment below (or correct if something is wrong): <br> <code>socksParentProxy = "localhost:9050" <br> socksProxyType = socks5 <br></code> <br>  Let's save.  Restart Polyp: <br> <code>sudo service polipo restart</code> <br> <br>  Now configure I2P: <br> <code>sudo nano /etc/default/i2p</code> <br> <br>  Enable the launch as a daemon: <br> <code>RUN_DAEMON="true"</code> <br> <br>  At the same time we see in the file the name of the user from whom the router is working - I have this <b>i2psvc</b> <br>  We save. <br>  Run: <code>sudo service i2p start</code> <br><br>  Now we recognize the user from whom TOR works: <br> <code>lsof -c tor</code> <br>  I have this <b>debian-tor</b> . <br><br>  And now - the most delicious: we cut access to the network to everything that is not TOR and not I2P.  Once again - <b>everything</b> . <br>  Here is a ready-made iptables-restore script, just check the usernames again. <br>  The general policy of DROP, allowed access to everyone on localhost, I2P and TOR - to the external network. <br> <code>sudo nano /etc/iptables.up.rules</code> <br> <br>  Content: <br> <code>*filter <br> :INPUT ACCEPT [0:0] <br> :FORWARD ACCEPT [0:0] <br> :OUTPUT DROP [0:0] <br> -A OUTPUT -d 127.0.0.1/32 -j ACCEPT <br> -A OUTPUT -m owner --uid-owner debian-tor -j ACCEPT <br> -A OUTPUT -m owner --uid-owner i2psvc -j ACCEPT <br> COMMIT <br></code> <br>  Open the network configuration file: <br> <code>sudo nano /etc/network/interfaces</code> <br> <br>  We add the command to load the rules: <br> <code>pre-up iptables-restore &lt; /etc/iptables.up.rules</code> <br> <br>  It looks like this: <br> <code>auto lo <br> iface lo inet loopback <br> pre-up iptables-restore &lt; /etc/iptables.up.rules <br></code> <br>  Since I manage the network through network-manager, there is no eth0 interface in the file.  The rules are prescribed when raising a loopback, but there is no difference, since these rules are the same for all interfaces. <br><br>  Load the rules in iptables.  You can restart the network, but we will do this: <br> <code>sudo iptables-restore &lt; /etc/iptables.up.rules</code> <br> <br>  Done!  The fortress is built, the moat is dug, archers are exposed on the walls.  But we have not yet distributed the passes to its residents!  Fix it. <br>  For access to the external Internet, it is better to use TOR, whose HTTP interface is on port 8118. <br> <code>nano ~/.bashrc</code> <br> <br>  We add to the end: <br> <code>export http_proxy="http://127.0.0.1:8118/"</code> <br> <br>  Now in the terminal just <br> <code>bash</code> <br>  In this case, the shell re-reads its config.  However, apt, without which in Ubunt - as if without water (neither tudy nor syudy), I wanted to sneeze on this environmental variable.  Let us explain to him personally the intra-object regime of our fortress: <br> <code>sudo nano /etc/apt/apt.conf.d/proxy</code> <br> <br>  There should be: <br> <code>Acquire::http::Proxy "http://127.0.0.1:8118/";</code> <br>  Save, close. <br><br>  Well, almost everything.  Now it remains to put the browser (if something does not like the default Foxy) and start using not very fast, but protected access from all sides.  And I repeat - the program inside the virtual machine can be stuffed with at least a thousand bookmarks - the data it may merge, only they will be anonymous.  Nobody can calculate the external IP. <br><br>  However (thanks to <a href="https://habrahabr.ru/users/amarao/" class="user_link">amarao</a> for the add-on), <b>watch carefully what programs you run from root!</b>  Since a malware can bypass the protection in two ways: by setting its own malicious rule in iptables or by introducing a spyware kernel module.  Both procedures require root. <br><br>  The system was built entirely on its own, not relying on ready-made How-To (if such exist, I did not find).  Therefore, I will be glad to accept from the readers possible improvements and indications of shortcomings. <br><br>  Thanks for attention!  I hope I have brought some benefit. </div><p>Source: <a href="https://habr.com/ru/post/143516/">https://habr.com/ru/post/143516/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143510/index.html">Network on a chip - mini-internet inside the processor</a></li>
<li><a href="../143511/index.html">Linux laptop designed for developers</a></li>
<li><a href="../143512/index.html">Tips on how to properly configure your TV</a></li>
<li><a href="../143513/index.html">Millions of visitors to WordPress against the server</a></li>
<li><a href="../143515/index.html">Full-length 3D Teleconference Cab (Star Trek Style)</a></li>
<li><a href="../143517/index.html">Tutorial on libGDX - creating user interface. Part 1</a></li>
<li><a href="../143519/index.html">Podcast Chiptune 3x000001 - Passing through the valley of the shadow of death</a></li>
<li><a href="../143521/index.html">Softbank develops flying mobile cellular stations</a></li>
<li><a href="../143522/index.html">HTML is no longer a cake ?!</a></li>
<li><a href="../143524/index.html">Carmageddon reincarnates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>