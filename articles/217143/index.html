<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Examples of using asyncio: HTTPServer ?!</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Not so long ago, a new version of Python 3.4 was released in the changelog, which included many "goodies". One of these is the asyncio module, which c...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Examples of using asyncio: HTTPServer ?!</h1><div class="post__text post__text-html js-mediator-article"> Not so long ago, a new version of <b>Python 3.4 was released</b> in the <a href="https://www.python.org/download/releases/3.4.0/">changelog,</a> which included many "goodies".  One of these is the <a href="http://docs.python.org/dev/library/asyncio.html">asyncio</a> module, which contains an infrastructure suitable for writing asynchronous network applications.  Thanks to the coroutines concept, the asynchronous application code is easy to understand and maintain. <br><br>  In the article, using the example of a simple TCP (Echo) server, I will try to show what <code>asyncio</code> eating, and I would venture to eliminate the ‚Äúfatal flaw‚Äù of this module, namely the lack of an asynchronous HTTP server implementation. <br><a name="habracut"></a><br><h4>  Intro </h4><br>  The direct competitor and ‚Äúbrother‚Äù is the <a href="http://tornadoweb.org/">tornado</a> framework, which has proven itself and enjoys well-deserved popularity.  However, in my opinion, asyncore looks simpler, more logical and thought out.  However, this is not surprising, because we are dealing with a standard language library. <br><br>  You will say that it was possible to write asynchronous services in Python before and you will be right.  But this required third-party libraries and / or the use of callback programming style.  The concept of coroutine brought to this perfection in this version of Python almost allows you to write linear asynchronous code using only the capabilities of standard language libraries. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I just want to make a reservation that I wrote all this under Linux, but all the components used are cross-platform and under Windows should also work.  But the Python 3.4 version is required. <br><br><h4>  Echoserver </h4><br>  An example of an Echo server is in the standard documentation, but this refers to the <a href="http://docs.python.org/dev/library/asyncio-protocol.html">low-level API "Transports and protocols"</a> .  For "everyday" use, <a href="http://docs.python.org/dev/library/asyncio-stream.html">high-level API Streams is</a> recommended.  There is no example of TCP server code in it, however, having studied an example from the low-level API and looking at the sources of this and another module, it is easy to write a simple TCP server. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> concurrent.futures @asyncio.coroutine <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(reader, writer)</span></span></span><span class="hljs-function">:</span></span> peername = writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">'peername'</span></span>) logging.info(<span class="hljs-string"><span class="hljs-string">'Accepted connection from {}'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: data = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asyncio.wait_for(reader.readline(), timeout=<span class="hljs-number"><span class="hljs-number">10.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data: writer.write(data) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: logging.info(<span class="hljs-string"><span class="hljs-string">'Connection from {} closed by peer'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> concurrent.futures.TimeoutError: logging.info(<span class="hljs-string"><span class="hljs-string">'Connection from {} closed by timeout'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> writer.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: loop = asyncio.get_event_loop() logging.basicConfig(level=logging.INFO) server_gen = asyncio.start_server(handle_connection, port=<span class="hljs-number"><span class="hljs-number">2007</span></span>) server = loop.run_until_complete(server_gen) logging.info(<span class="hljs-string"><span class="hljs-string">'Listening established on {0}'</span></span>.format(server.sockets[<span class="hljs-number"><span class="hljs-number">0</span></span>].getsockname())) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: loop.run_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-comment"><span class="hljs-comment"># Press Ctrl+C to stop finally: server.close() loop.close()</span></span></code> </pre><br>  Everything is quite obvious, but there are a couple of nuances that are worth paying attention to. <br><br><pre> <code class="python hljs"> server_gen = asyncio.start_server(handle_connection, port=<span class="hljs-number"><span class="hljs-number">2007</span></span>) server = loop.run_until_complete(server_gen)</code> </pre><br>  The first line does not create the server itself, but the generator, which, when it is first accessed to it and the subsoil, <code>asyncio</code> creates and initializes the TCP server using the specified parameters.  The second line is an example of such an appeal. <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: data = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asyncio.wait_for(reader.readline(), timeout=<span class="hljs-number"><span class="hljs-number">10.0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> data: writer.write(data) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: logging.info(<span class="hljs-string"><span class="hljs-string">'Connection from {} closed by peer'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> concurrent.futures.TimeoutError: logging.info(<span class="hljs-string"><span class="hljs-string">'Connection from {} closed by timeout'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span></code> </pre><br>  The coroutine <code>reader.readline()</code> function performs asynchronous reading of data from the input stream.  But waiting for data to read is not time limited, if you need to stop it by timeout, you need to wrap the call to the coroutine function in <code>asyncio.wait_for()</code> .  In this case, after the time interval specified in seconds has elapsed, the exception <code>concurrent.futures.TimeoutError</code> will be raised, which can be processed as needed. <br>  Checking that <code>reader.readline()</code> returns a non-empty value in this example is required.  Otherwise, after the connection is disconnected by the client (connection reset by peer), attempts to read and return an empty value will continue indefinitely. <br><br><h5>  What about OOP? </h5><br>  OOP is also good.  It is enough to wrap the methods that use calls of functions-coroutine into the decorator @ asyncio.coroutine.  What functions are run as coroutine in the API is clearly indicated.  Below is an example implementing the EchoServer class <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> concurrent.futures <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EchoServer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Echo server class"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, host, port, loop=None)</span></span></span><span class="hljs-function">:</span></span> self._loop = loop <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> asyncio.get_event_loop() self._server = asyncio.start_server(self.handle_connection, host=host, port=port) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, and_loop=True)</span></span></span><span class="hljs-function">:</span></span> self._server = self._loop.run_until_complete(self._server) logging.info(<span class="hljs-string"><span class="hljs-string">'Listening established on {0}'</span></span>.format(self._server.sockets[<span class="hljs-number"><span class="hljs-number">0</span></span>].getsockname())) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> and_loop: self._loop.run_forever() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, and_loop=True)</span></span></span><span class="hljs-function">:</span></span> self._server.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> and_loop: self._loop.close() @asyncio.coroutine <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle_connection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, reader, writer)</span></span></span><span class="hljs-function">:</span></span> peername = writer.get_extra_info(<span class="hljs-string"><span class="hljs-string">'peername'</span></span>) logging.info(<span class="hljs-string"><span class="hljs-string">'Accepted connection from {}'</span></span>.format(peername)) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> reader.at_eof(): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: data = <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> asyncio.wait_for(reader.readline(), timeout=<span class="hljs-number"><span class="hljs-number">10.0</span></span>) writer.write(data) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> concurrent.futures.TimeoutError: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span> writer.close() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: logging.basicConfig(level=logging.DEBUG) server = EchoServer(<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, <span class="hljs-number"><span class="hljs-number">2007</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: server.start() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-comment"><span class="hljs-comment"># Press Ctrl+C to stop finally: server.stop()</span></span></code> </pre><br><br>  As can be seen in the first and second cases, the code is linear and readable.  And in the second case, moreover, the code is decorated in a self-sufficient class. <br><br><h4>  HTTP Server </h4><br>  Having dealt with all this, there is an involuntary desire to do something more substantial.  The <code>asyncio</code> module provides us with this opportunity.  Unlike the <code>tornado</code> for example, <code>tornado</code> does not implement an HTTP server.  As they say it is a sin not to try to correct this omission :) <br><br>  Writing an HTTP server from scratch with all its classes like HTTPRequest, etc. is not sporty, considering that there are a lot of ready-made frameworks running on top of the WSGI protocol.  Those in the know will rightly notice that WSGI is a synchronous protocol.  This is true, but you can read data for environ and the request body asynchronously.  The output of the result in WSGI is recommended as a generator, and it fits well with the concept of coroutines used in <code>asyncio</code> . <br><br>  One of the frameworks that does everything right with content is the <a href="http://bottlepy.org/docs/0.12/index.html">bottle</a> .  So he for example gives the contents of a file not entirely, but in portions through a generator.  Therefore, I chose it for testing the developed WSGI server and was pleased with the result.  For example, a demo application was completely capable of sending a large file to several client connections at the same time. <br><br>  Fully see what happened you can <a href="https://github.com/Alesh/aqua/tree/dev">on my github</a> .  No tests, no documentation there yet, but there is a demo application using the bottle framework.  It gives a list of files in a specific directory and gives the selected one in asynchronous mode regardless of size.  So if you put films in this directory, you can organize a small video hosting :) <br><br>  I would like to say a special thanks to the <a href="https://bitbucket.org/cherrypy/cherrypy/wiki/Home">CherryPy</a> development team, I often glanced at their code and took something entirely, so as not to invent "my bikes." <br><br><div class="spoiler">  <b class="spoiler_title">View sample application</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> bottle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os.path <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> listdir <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> bottle <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> route, template, static_file root = os.path.abspath(os.path.dirname(__file__)) @route(<span class="hljs-string"><span class="hljs-string">'/'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">index</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> tmpl = <span class="hljs-string"><span class="hljs-string">"""&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt;&lt;title&gt;Bottle of Aqua&lt;/title&gt;&lt;/head&gt; &lt;/body&gt; &lt;h3&gt;List of files:&lt;/h3&gt; &lt;ul&gt; % for item in files: &lt;li&gt;&lt;a href="/files/{{item}}"&gt;{{item}}&lt;/a&gt;&lt;/li&gt; % end &lt;/ul&gt; &lt;/body&gt; &lt;/html&gt; """</span></span> files = [file_name <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> file_name <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> listdir(os.path.join(root, <span class="hljs-string"><span class="hljs-string">'files'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> os.path.isfile(os.path.join(root, <span class="hljs-string"><span class="hljs-string">'files'</span></span>, file_name))] <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> template(tmpl, files=files) @route(<span class="hljs-string"><span class="hljs-string">'/files/&lt;filename&gt;'</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">server_static</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(filename)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> static_file(filename, root=os.path.join(root,<span class="hljs-string"><span class="hljs-string">'files'</span></span>)) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AquaServer</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(bottle.ServerAdapter)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-string"><span class="hljs-string">"""Bottle server adapter"""</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, handler)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> asyncio <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> logging <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> aqua.wsgiserver <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> WSGIServer logging.basicConfig(level=logging.ERROR) loop = asyncio.get_event_loop() server = WSGIServer(handler, loop=loop) server.bind(self.host, self.port) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: loop.run_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> KeyboardInterrupt: <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span> <span class="hljs-comment"><span class="hljs-comment"># Press Ctrl+C to stop finally: server.unbindAll() loop.close() if __name__ == '__main__': bottle.run(server=AquaServer, port=5000)</span></span></code> </pre><br></div></div><br>  When writing the WSGI server code, I did not notice any nuances that could be attributed to the <code>asyncio</code> module.  The only moment is a feature of browsers (for example, chrome), to reset the request if it sees that it is starting to receive a large file.  Obviously, this is done in order to switch to a more optimized way to download large files, because the request is repeated and the file starts to be received normally.  But the first dropped request throws a <code>ConnectionResetError</code> exception, if the file has already been sent to it by using the <code>StreamWriter.write()</code> function call.  This case needs to handle and close the connection with <code>StreamWriter.close()</code> . <br><br><h4>  Performance </h4><br>  For the comparative test, I chose the <a href="http://www.joedog.org/siege-home/">siege</a> utility.  ‚ÄúOur patient‚Äù (also aqua :) in conjunction with the <code>bottle</code> , quite popular <a href="http://waitress.readthedocs.org/en/latest/">Waitress WSGI server</a> also in conjunction with the <code>bottle</code> and of course Tornado, acted as the test subjects.  As an application was the lowest possible helloword.  Tests conducted with the following parameters: 100 and 1000 simultaneous connections;  test duration 10 seconds for 13 bytes and kilobytes;  test duration 60 seconds for 13 megabytes;  The three options for the size of the data given are 13 bytes, 13 kilobytes and 13 megabytes respectively.  Below is the result: <br><table cellpadding="2"><tbody><tr><th rowspan="2">  100 <br>  concurent users <br></th><th colspan="2">  13 b (10 sec) <br></th><th colspan="2">  13 Kb (10 sec) <br></th><th colspan="2">  13 Mb (60 sec) <br></th></tr><tr><td>  Avail. <br></td><td>  Trans / sec <br></td><td>  Avail. <br></td><td>  Trans / sec <br></td><td>  Avail. <br></td><td>  Trans / sec <br></td></tr><tr><td>  aqua + bottle <br></td><td>  100.0% <br></td><td>  835.24 <br></td><td>  100.0% <br></td><td>  804.49 <br></td><td>  99.9% <br></td><td>  26.28 <br></td></tr><tr><td>  waitress + bootle <br></td><td>  100.0% <br></td><td>  707.24 <br></td><td>  100.0% <br></td><td>  642.03 <br></td><td>  100.0% <br></td><td>  8.67 <br></td></tr><tr><td>  tornado <br></td><td>  100.0% <br></td><td>  2282.45 <br></td><td>  100.0% <br></td><td>  2071.27 <br></td><td>  100.0% <br></td><td>  15.78 <br></td></tr></tbody></table><br><table cellpadding="2"><tbody><tr><th rowspan="2">  1000 <br>  concurent users <br></th><th colspan="2">  13 b (10 sec) <br></th><th colspan="2">  13 Kb (10 sec) <br></th><th colspan="2">  13 Mb (60 sec) <br></th></tr><tr><td>  Avail. <br></td><td>  Trans / sec <br></td><td>  Avail. <br></td><td>  Trans / sec <br></td><td>  Avail. <br></td><td>  Trans / sec <br></td></tr><tr><td>  aqua + bottle <br></td><td>  99.9% <br></td><td>  800.41 <br></td><td>  99.9% <br></td><td>  777.15 <br></td><td>  60.2% <br></td><td>  26.24 <br></td></tr><tr><td>  waitress + bootle <br></td><td>  94.9% <br></td><td>  689.23 <br></td><td>  99.9% <br></td><td>  621.03 <br></td><td>  37.5% <br></td><td>  8.89 <br></td></tr><tr><td>  tornado <br></td><td>  100.0% <br></td><td>  1239.88 <br></td><td>  100.0% <br></td><td>  978.73 <br></td><td>  55.7% <br></td><td>  14.51 <br></td></tr></tbody></table><br>  What can I say?  Tornado certainly steers, but "our patient" seems to be breaking out ahead on large files and has improved the relative performance on a larger number of connections.  In addition, he confidently bypassed the waitress (with its four child processes by the number of cores), which is not in a bad tally among developers.  I will not say that my testing is 100% adequate, but as an estimate, it will probably fit. <br><br>  <em><b>Updated:</b> Drew attention to weird numbers for 13 megabytes of the response body.</em>  <em>And indeed, in 10 seconds the test there really probably did not have time to start :) Corrected for the numbers that I received when the test duration was 60 seconds.</em> <br><br><div class="spoiler">  <b class="spoiler_title">Example of running the siege utility and full results for the last column of the second table</b> <div class="spoiler_text"><pre> <code class="hljs vhdl">$ siege -c <span class="hljs-number"><span class="hljs-number">1000</span></span> -b -t <span class="hljs-number"><span class="hljs-number">60</span></span>S http://<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span>:<span class="hljs-number"><span class="hljs-number">5000</span></span>/ ** SIEGE <span class="hljs-number"><span class="hljs-number">2.70</span></span> ** Preparing <span class="hljs-number"><span class="hljs-number">1000</span></span> concurrent users <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> battle. Transactions: <span class="hljs-number"><span class="hljs-number">1570</span></span> hits Availability: <span class="hljs-number"><span class="hljs-number">60.18</span></span> % Elapsed <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">59.84</span></span> secs Data transferred: <span class="hljs-number"><span class="hljs-number">20410.00</span></span> MB Response <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">5.56</span></span> secs Transaction rate: <span class="hljs-number"><span class="hljs-number">26.24</span></span> trans/sec Throughput: <span class="hljs-number"><span class="hljs-number">341.08</span></span> MB/sec Concurrency: <span class="hljs-number"><span class="hljs-number">145.80</span></span> Successful transactions: <span class="hljs-number"><span class="hljs-number">1570</span></span> Failed transactions: <span class="hljs-number"><span class="hljs-number">1039</span></span> Longest transaction: <span class="hljs-number"><span class="hljs-number">20.44</span></span> Shortest transaction: <span class="hljs-number"><span class="hljs-number">0.00</span></span> $ siege -c <span class="hljs-number"><span class="hljs-number">1000</span></span> -b -t <span class="hljs-number"><span class="hljs-number">60</span></span>S http://<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span>:<span class="hljs-number"><span class="hljs-number">5001</span></span>/ ** SIEGE <span class="hljs-number"><span class="hljs-number">2.70</span></span> ** Preparing <span class="hljs-number"><span class="hljs-number">1000</span></span> concurrent users <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> battle. The server <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> now under siege... Lifting the server siege... done. Transactions: <span class="hljs-number"><span class="hljs-number">526</span></span> hits Availability: <span class="hljs-number"><span class="hljs-number">37.49</span></span> % Elapsed <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">59.20</span></span> secs Data transferred: <span class="hljs-number"><span class="hljs-number">6838.00</span></span> MB Response <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">16.05</span></span> secs Transaction rate: <span class="hljs-number"><span class="hljs-number">8.89</span></span> trans/sec Throughput: <span class="hljs-number"><span class="hljs-number">115.51</span></span> MB/sec Concurrency: <span class="hljs-number"><span class="hljs-number">142.58</span></span> Successful transactions: <span class="hljs-number"><span class="hljs-number">526</span></span> Failed transactions: <span class="hljs-number"><span class="hljs-number">877</span></span> Longest transaction: <span class="hljs-number"><span class="hljs-number">42.43</span></span> Shortest transaction: <span class="hljs-number"><span class="hljs-number">0.00</span></span> $ siege -c <span class="hljs-number"><span class="hljs-number">1000</span></span> -b -t <span class="hljs-number"><span class="hljs-number">60</span></span>S http://<span class="hljs-number"><span class="hljs-number">127.0</span></span>.<span class="hljs-number"><span class="hljs-number">0.1</span></span>:<span class="hljs-number"><span class="hljs-number">5002</span></span>/ ** SIEGE <span class="hljs-number"><span class="hljs-number">2.70</span></span> ** Preparing <span class="hljs-number"><span class="hljs-number">1000</span></span> concurrent users <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> battle. The server <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> now under siege... Lifting the server siege... done. Transactions: <span class="hljs-number"><span class="hljs-number">857</span></span> hits Availability: <span class="hljs-number"><span class="hljs-number">55.65</span></span> % Elapsed <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">59.07</span></span> secs Data transferred: <span class="hljs-number"><span class="hljs-number">11141.00</span></span> MB Response <span class="hljs-built_in"><span class="hljs-built_in">time</span></span>: <span class="hljs-number"><span class="hljs-number">20.14</span></span> secs Transaction rate: <span class="hljs-number"><span class="hljs-number">14.51</span></span> trans/sec Throughput: <span class="hljs-number"><span class="hljs-number">188.61</span></span> MB/sec Concurrency: <span class="hljs-number"><span class="hljs-number">292.16</span></span> Successful transactions: <span class="hljs-number"><span class="hljs-number">857</span></span> Failed transactions: <span class="hljs-number"><span class="hljs-number">683</span></span> Longest transaction: <span class="hljs-number"><span class="hljs-number">51.19</span></span> Shortest transaction: <span class="hljs-number"><span class="hljs-number">3.26</span></span></code> </pre><br></div></div><br><br><h4>  Outro </h4><br>  Asynchronous web server using <code>asyncio</code> has the right to life.  It is possible to talk about using such servers in serious projects early, but after testing, running in and with the advent of async <code>asyncio</code> drivers for databases and key-value repositories, it may well be possible. </div><p>Source: <a href="https://habr.com/ru/post/217143/">https://habr.com/ru/post/217143/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../217133/index.html">Challenges retail network: Apple vs. Ikea</a></li>
<li><a href="../217135/index.html">NASA asks to choose a spacesuit design</a></li>
<li><a href="../217137/index.html">Published a single rating web studios 2014</a></li>
<li><a href="../217139/index.html">Doodle contest for Google by April 12</a></li>
<li><a href="../217141/index.html">Microsoft Research Director for External Research Programs will deliver a lecture at Moscow State University</a></li>
<li><a href="../217145/index.html">Imagenary open mobile photo blogs for everyone</a></li>
<li><a href="../217147/index.html">How to calculate the time to design interfaces online store</a></li>
<li><a href="../217151/index.html">Highly loaded systems: solving basic problems</a></li>
<li><a href="../217155/index.html">Are you still chasing clients in social networks?</a></li>
<li><a href="../217159/index.html">New from Synology inc. at CeBIT 2014</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>