<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to create a game engine for short stories in 3 days</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="One rainy day in St. Petersburg, my project in UE4 stopped loading, and because of this I wanted to make my own engine. And one story pushed me to mak...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to create a game engine for short stories in 3 days</h1><div class="post__text post__text-html js-mediator-article">  One rainy day in St. Petersburg, my project in UE4 stopped loading, and because of this I wanted to make my own engine.  And <abbr title="Katawa shoujo">one story</abbr> pushed me to make the engine just for stories.  If you want to learn more and you are not afraid of goto, gosub and other horrors, welcome under cat. <br><img src="https://habrastorage.org/files/8ea/33d/4e1/8ea33d4e1e9246cb96d4f5fe61131ca1.jpg" alt="KDPV"><br><a name="habracut"></a><br><br><hr><br><h1>  Table of contents </h1><br><ul><li>  Act 1. Maintenance </li><li>  <a href="https://habr.com/ru/post/274399/">Act 2. Development</a> <br><ul><li>  <a href="https://habr.com/ru/post/274399/">Text</a> </li><li>  Graphics </li><li>  Music </li></ul></li><li>  Act 3. Editor </li><li>  Act 4. Conclusion </li></ul><br><hr><br><br><img src="https://habrastorage.org/files/680/ac5/cdb/680ac5cdbdd14951965f5a00c6fde9ce.jpg" alt="Act 1"><br>  It all started with the fact that after passing through the Nth story a friend recommended <abbr title="A novel about a guy with an arrhythmia who got to a school for children with disabilities">Katawa Shoujo to</abbr> me.  As it turned out the official version in the App Store is not and is not expected, only .ipa on w3bsit3-dns.com. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This same friend, knowing that I was trying to create a game for the third month, suggested that I port Katau to an iPad without a Jailbreak.  The choice fell on smart BASIC, since I have been using this program for a year and a half and know the syntax of its internal programming language (also smart BASIC has an SDK for Xcode). <br><br>  The archive was immediately downloaded with all the game files except text.  But neither he nor I did not know that this would lead to the creation of his own engine for ease of development. <br><a name="dev"></a><br><h1>  Act 2. Development </h1><br><img src="https://habrastorage.org/files/4e4/5d2/8b7/4e45d28b74ce4fd7a24d3f8805284ca5.jpg" alt="Act 2"><br><a name="text"></a><br><h2>  1. Text </h2><br>  To start, I created a folder (spoiler). <br><div class="spoiler">  <b class="spoiler_title">Folders</b> <div class="spoiler_text">  / Sprites <br>  / Event <br>  / Bgs <br>  / Music <br>  / Scenario <br>  / Scripts <br>  / Scripts / Ren_sB <br>  / Scripts / Ren_sB / Functions <br>  / Ui <br>  / Ui / main <br>  / Vfx <br></div></div><br>  The Katawa Shoujo Port.txt file will load all scripts. <br><pre><code class="hljs mel">scenario$ = ‚ÄúHabr‚Äù {Scripts/colorcodes.txt} {Scripts/Ren_sB/<span class="hljs-keyword"><span class="hljs-keyword">render</span></span>.txt}</code> </pre> <br>  The colorcodes.txt file will contain RGB color names for the render, for example, take <abbr title="Deaf">Shizune</abbr> and its blue selection: <br><pre> <code class="hljs mel">data <span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"107"</span></span>,<span class="hljs-string"><span class="hljs-string">"174"</span></span>,<span class="hljs-string"><span class="hljs-string">"239"</span></span> dim colors$(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) read colors$(<span class="hljs-keyword"><span class="hljs-keyword">color</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>)</code> </pre><br>  The basic preparations have been made; now you can write a script to display the text.  In Katava, as in any visual novel, the text is shown in the field, and above the text is written the name of the character on whose behalf the text. <br><br>  The speak.txt script will be responsible for this. <br><br>  To begin with, I registered the download of the bg-say.png sprite (field for replicas) and the playtime_cyrillic font in the file load.txt: <br><pre> <code class="hljs sql">font "Font/playtime_cyrillic2.ttf" <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> a$ sprite <span class="hljs-string"><span class="hljs-string">"bg-say"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-string"><span class="hljs-string">"UI/bg-say.png"</span></span> sprite <span class="hljs-string"><span class="hljs-string">"bg-say"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resize</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">205</span></span> sprite <span class="hljs-string"><span class="hljs-string">"bg-say"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,screen_height()<span class="hljs-number"><span class="hljs-number">-205</span></span> sprite <span class="hljs-string"><span class="hljs-string">"bg-doublespeak"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-string"><span class="hljs-string">"UI/bg-doublespeak.png"</span></span> sprite <span class="hljs-string"><span class="hljs-string">"bg-doublespeak"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resize</span></span> <span class="hljs-number"><span class="hljs-number">1024</span></span>,<span class="hljs-number"><span class="hljs-number">205</span></span> sprite <span class="hljs-string"><span class="hljs-string">"bg-doublespeak"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,screen_height()<span class="hljs-number"><span class="hljs-number">-205</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc-strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-string"><span class="hljs-string">"UI/ctc-strip.png"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> w,h sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resize</span></span> w*<span class="hljs-number"><span class="hljs-number">1.28</span></span>,h*<span class="hljs-number"><span class="hljs-number">1.28</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> screen_width()-w*<span class="hljs-number"><span class="hljs-number">1.28</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>,screen_height()<span class="hljs-number"><span class="hljs-number">-52</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> delay <span class="hljs-number"><span class="hljs-number">0.05</span></span></code> </pre><br><br>  Then I decided to use the ‚Äú|‚Äù sign in the script of the script as a separator for the command, goal of the command, secondary goal, action and attribute. <br><br>  Text Display: ‚Äú1 | Pers | Text‚Äù <br><pre> <code class="hljs ruby"><span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-params"><span class="hljs-params">||</span></span>[, ]</code> </pre><br><br>  The render.txt file reads this command and redirects to the label alone. <br><div class="spoiler">  <b class="spoiler_title">render.txt</b> <div class="spoiler_text"><pre> <code class="hljs sql">graphics <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> toolbar <span class="hljs-keyword"><span class="hljs-keyword">off</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> orientation landscape <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"Scenario/"</span></span>&amp;scenario$&amp;<span class="hljs-string"><span class="hljs-string">".txt"</span></span> readline hmm$ <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">count</span></span>+<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> = file_end(<span class="hljs-string"><span class="hljs-string">"Scenario/"</span></span>&amp;scenario$&amp;<span class="hljs-string"><span class="hljs-string">".txt"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"Scenario/"</span></span>&amp;scenario$&amp;<span class="hljs-string"><span class="hljs-string">".txt"</span></span> setpos <span class="hljs-number"><span class="hljs-number">0</span></span> dim info$(<span class="hljs-keyword"><span class="hljs-keyword">count</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> l=<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> <span class="hljs-string"><span class="hljs-string">"Scenario/"</span></span>&amp;scenario$&amp;<span class="hljs-string"><span class="hljs-string">".txt"</span></span> readline line$ splite line$ <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> temp$,n <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-string"><span class="hljs-string">"|"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> m = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> n<span class="hljs-number"><span class="hljs-number">-1</span></span> info$(l,m) = temp$(m) <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> m <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> l <span class="hljs-string"><span class="hljs-string">'  ,    '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">count</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> info$(y,<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-string"><span class="hljs-string">"1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> gosub alone ... alone: {Scripts/Ren_sB/Functions/Speak.txt} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">speak.txt</b> <div class="spoiler_text"><pre> <code class="hljs sql">sprite "bg-say" <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>$ = info$(y,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>$ = info$(y,<span class="hljs-number"><span class="hljs-number">2</span></span>) <span class="hljs-string"><span class="hljs-string">'     '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> color = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>$ = colors$(color,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> r = colors$(color,<span class="hljs-number"><span class="hljs-number">1</span></span>) g = colors$(color,<span class="hljs-number"><span class="hljs-number">2</span></span>) b = colors$(color,<span class="hljs-number"><span class="hljs-number">3</span></span>) endif <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> color <span class="hljs-string"><span class="hljs-string">'   '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">575</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">600</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span> ro <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> font color r/<span class="hljs-number"><span class="hljs-number">255</span></span>,g/<span class="hljs-number"><span class="hljs-number">255</span></span>,b/<span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">615</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> screen_width()<span class="hljs-number"><span class="hljs-number">-20</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span> ro ml <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> font color <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-string"><span class="hljs-string">'  '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>$)<span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-string"><span class="hljs-string">'     '</span></span> gosub <span class="hljs-number"><span class="hljs-number">3</span></span> render$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render$ pause <span class="hljs-number"><span class="hljs-number">0.025</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> k <span class="hljs-string"><span class="hljs-string">'    '</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ! sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> gosub <span class="hljs-number"><span class="hljs-number">1</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> hide</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">one</b> <div class="spoiler_text"><pre> <code class="hljs lua"><span class="hljs-number"><span class="hljs-number">1</span></span> x1 = touch_x(<span class="hljs-number"><span class="hljs-number">0</span></span>) y1 = touch_y(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x1 &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y1 &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> slowdown <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> x1 = touch_x(<span class="hljs-number"><span class="hljs-number">0</span></span>) y1 = touch_y(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x1 = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y1 = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> endif slowdown <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">3</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-number"><span class="hljs-number">3</span></span> x1 = touch_x(<span class="hljs-number"><span class="hljs-number">0</span></span>) y1 = touch_y(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x1 &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y1 &gt; <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> tapped = <span class="hljs-number"><span class="hljs-number">1</span></span> endif <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> tapped = <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> x1 = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> y1 = <span class="hljs-number"><span class="hljs-number">-1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> tapped = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(<span class="hljs-type"><span class="hljs-type">text</span></span>$) = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> k = lengthmax - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> k = len(<span class="hljs-type"><span class="hljs-type">text</span></span>$) - <span class="hljs-number"><span class="hljs-number">1</span></span> endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> endif endif <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br></div></div><br>  Result: <br><br><img src="https://habrastorage.org/files/16f/bd7/5e3/16fbd75e38674917aa425ab86d61c54e.jpg" alt="image"><br><br>  ‚ÄúBut after all, in Katav two characters can speak at the same time!‚Äù There is a separate command for this: ‚Äú2 | pers1 &amp; pers2 | text1 &amp; text2‚Äù: <br>  2 | Hisao &amp; Lilly | ‚ÄúHello!‚Äù &amp; ‚ÄùHello!" <br><br>  Add to the render.txt line: <br><div class="spoiler">  <b class="spoiler_title">render.txt</b> <div class="spoiler_text"><pre> <code class="hljs sql">... <span class="hljs-keyword"><span class="hljs-keyword">show</span></span>: ... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> info$(y,<span class="hljs-number"><span class="hljs-number">0</span></span>) = <span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> gosub together ... together: {Scripts/Ren_sB/Functions/Double_Speak.txt} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span></code> </pre><br></div></div><br>  Double_Speak.txt executes these commands: <br><div class="spoiler">  <b class="spoiler_title">Double_Speak.txt</b> <div class="spoiler_text"><pre> <code class="hljs sql">sprite "bg-doublespeak" <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> <span class="hljs-keyword"><span class="hljs-keyword">names</span></span>$ = info$(y,<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-string"><span class="hljs-string">'   '</span></span> nd = <span class="hljs-keyword"><span class="hljs-keyword">instr</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">names</span></span>$,<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>) name1$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(<span class="hljs-keyword"><span class="hljs-keyword">names</span></span>$,<span class="hljs-number"><span class="hljs-number">0</span></span>,nd<span class="hljs-number"><span class="hljs-number">-1</span></span>) name2$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(<span class="hljs-keyword"><span class="hljs-keyword">names</span></span>$,nd+<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">names</span></span>$)<span class="hljs-number"><span class="hljs-number">-1</span></span>) texts$ = info$(y,<span class="hljs-number"><span class="hljs-number">2</span></span>) td = <span class="hljs-keyword"><span class="hljs-keyword">instr</span></span>(texts$,<span class="hljs-string"><span class="hljs-string">"&amp;"</span></span>) text1$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(texts$,<span class="hljs-number"><span class="hljs-number">0</span></span>,td<span class="hljs-number"><span class="hljs-number">-1</span></span>) text2$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(texts$,td+<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(texts$)<span class="hljs-number"><span class="hljs-number">-1</span></span>) <span class="hljs-string"><span class="hljs-string">'     '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> color = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> name1$ = colors$(color,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> r1 = colors$(color,<span class="hljs-number"><span class="hljs-number">1</span></span>) g1 = colors$(color,<span class="hljs-number"><span class="hljs-number">2</span></span>) b1 = colors$(color,<span class="hljs-number"><span class="hljs-number">3</span></span>) endif <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> color <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> color = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> name2$ = colors$(color,<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> r2 = colors$(color,<span class="hljs-number"><span class="hljs-number">1</span></span>) g2 = colors$(color,<span class="hljs-number"><span class="hljs-number">2</span></span>) b2 = colors$(color,<span class="hljs-number"><span class="hljs-number">3</span></span>) endif <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> color <span class="hljs-string"><span class="hljs-string">'  '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> name1$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">575</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span> ro <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> font color r1/<span class="hljs-number"><span class="hljs-number">255</span></span>,g1/<span class="hljs-number"><span class="hljs-number">255</span></span>,b1/<span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">11</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> name2$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">535</span></span>,<span class="hljs-number"><span class="hljs-number">575</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">300</span></span>,<span class="hljs-number"><span class="hljs-number">40</span></span> ro <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> font color r2/<span class="hljs-number"><span class="hljs-number">255</span></span>,g2/<span class="hljs-number"><span class="hljs-number">255</span></span>,b2/<span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">12</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render1$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">615</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> screen_width()/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-20</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span> ro ml <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> font color <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render2$ <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> <span class="hljs-number"><span class="hljs-number">535</span></span>,<span class="hljs-number"><span class="hljs-number">615</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> screen_width()/<span class="hljs-number"><span class="hljs-number">2</span></span><span class="hljs-number"><span class="hljs-number">-20</span></span>,<span class="hljs-number"><span class="hljs-number">130</span></span> ro ml <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> back alpha <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> font color <span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">28</span></span> <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> font <span class="hljs-keyword"><span class="hljs-keyword">name</span></span> a$ <span class="hljs-string"><span class="hljs-string">'     '</span></span> lengthmax = <span class="hljs-keyword"><span class="hljs-keyword">max</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text1$),<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text2$)) lengthmin = <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text1$),<span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text2$)) <span class="hljs-string"><span class="hljs-string">'  '</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text1$) = <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text2$) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lengthmax<span class="hljs-number"><span class="hljs-number">-1</span></span> gosub <span class="hljs-number"><span class="hljs-number">3</span></span> render1$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text1$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render1$ render2$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text2$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render2$ pause <span class="hljs-number"><span class="hljs-number">0.025</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> k endif <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text1$) &gt; <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text2$) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lengthmax<span class="hljs-number"><span class="hljs-number">-1</span></span> gosub <span class="hljs-number"><span class="hljs-number">3</span></span> render1$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text1$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render1$ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k &lt; lengthmin <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> render2$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text2$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render2$ endif pause <span class="hljs-number"><span class="hljs-number">0.025</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> k endif <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text2$) &gt; <span class="hljs-keyword"><span class="hljs-keyword">len</span></span>(text1$) <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> k = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> lengthmax<span class="hljs-number"><span class="hljs-number">-1</span></span> gosub <span class="hljs-number"><span class="hljs-number">3</span></span> render2$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text2$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">22</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render2$ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> k &lt; lengthmin <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> render1$ = <span class="hljs-keyword"><span class="hljs-keyword">substr</span></span>$(text1$,<span class="hljs-number"><span class="hljs-number">0</span></span>,k) <span class="hljs-keyword"><span class="hljs-keyword">field</span></span> <span class="hljs-number"><span class="hljs-number">21</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> render1$ endif pause <span class="hljs-number"><span class="hljs-number">0.025</span></span> <span class="hljs-keyword"><span class="hljs-keyword">next</span></span> k endif <span class="hljs-string"><span class="hljs-string">'  '</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">show</span></span> ! sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> gosub <span class="hljs-number"><span class="hljs-number">1</span></span> sprite <span class="hljs-string"><span class="hljs-string">"ctc_strip"</span></span> hide</code> </pre><br></div></div><br><br>  Result: <br><br><img src="https://habrastorage.org/files/2ca/d3e/3c8/2cad3e3c866a4163814d6b2f9fc429d7.jpg" alt="image"><br><br>  On this the first day of development ends, and therefore the first part of my article ends.  In the second part I will describe the second day, namely, I will add graphics (sprites, backgrounds and events) and music. <br><br>  Thanks to all those who read to the end of the article.  See you in the next part! </div><p>Source: <a href="https://habr.com/ru/post/274399/">https://habr.com/ru/post/274399/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../274385/index.html">Webpack ProvidePlugin: how not to write a sheet import / require at the beginning of the javascript module</a></li>
<li><a href="../274389/index.html">Happy New Year! Results of 2015</a></li>
<li><a href="../274391/index.html">Monitor SMART in Zabbix</a></li>
<li><a href="../274393/index.html">happy (new Year (2016));</a></li>
<li><a href="../274397/index.html">Ajenti 2 and other news</a></li>
<li><a href="../274403/index.html">Challenge 2016</a></li>
<li><a href="../274413/index.html">Working with AngularJS Protractor from C # and Java</a></li>
<li><a href="../274415/index.html">Overview of the features of modern JavaScript</a></li>
<li><a href="../274417/index.html">Isotoxin: a free multi-protocol messenger with Tox support</a></li>
<li><a href="../274419/index.html">Jii 0.8: Migrations, ReactViews, isomorphous application and other buns</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>