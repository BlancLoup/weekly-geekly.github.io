<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Test compiled by Intel Compiler on AMD system. ‚ÄúBefore‚Äù and ‚Äúafter‚Äù patch</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr! After reading a recent article Will Intel have to remove a function from the compiler that deliberately delivers bad code for AMD processors?...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Test compiled by Intel Compiler on AMD system. ‚ÄúBefore‚Äù and ‚Äúafter‚Äù patch</h1><div class="post__text post__text-html js-mediator-article"> Hi Habr!  After reading a recent article <a href="http://habrahabr.ru/blogs/hardware/80050/">Will Intel have to remove a function from the compiler that deliberately delivers bad code for AMD processors?</a>  and, strangely enough, I didn‚Äôt see all the comments to it: the tests of ‚Äúlive‚Äù applications before applying the patch, blocking the processor controller in the Intel compiler code and after. <br><img src="http://tronix286.pochta.ru/habr/all2_resize.jpg" alt="image"><br><br>  Having the days off and being <s>not the</s> happy owner of a processor from AMD, I decided to study the issue in more detail.  Namely, find out if there is a significant difference in the performance of real applications compiled by the compiler from Intel? <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I decided to start by reading the original article in English, as well as reading all the discussions on this topic in various forums.  Surprisingly, even there I did not find the answer to my question - what is the real increase in real applications.  But I found out that depending on the compiler versions, the registers in the processor's controller code can be different, and not just eax, ebx, ecx, edx and ebp, as for example implemented in the patch <a href="http://video.bnx.homelinux.net/intel_patch-ppro.pl">intel_patch-ppro.pl</a> .  The esi and edi registers can also be used.  Not being a Perl connoisseur and not having his interpreter on the computer, it was decided to jot down a new patch on Pascal (Virtual Pascal, but Free Pascal can be easily compiled).  The patch itself and its source code can be found here: <a href="">icc_patch.rar</a> <br><br>  The second task that confronted me was how to determine if a given program was compiled using the Intel Compiler?  It would seem that PEiD programs should come to the rescue.  I don‚Äôt know what's going on with their signatures, but they give out the average distance from the beer stall to the moon.  PEiD assured me that a compiled Delphi program with an empty form and a cut off Reallocation Table was immediately written in Borland C ++ compiler, and similar things.  Of course, this option had to be abandoned.  The second obvious solution is to shovel all the EXE files on the computer and look in them for the very comparison cmp eax, 'Genu', and so on.  But, such checks are in many programs that are not related to the Intel compiler.  Therefore, we had to be patient and search the approximate code in the ‚Äúheavyweight‚Äù programs available on the computer, which was already shown in the comments to the previous article: <br><br> <code>mov eax,[ebp][-0008] <br> cmp eax,0756E6547 ;"uneG" ;   "Genu" <br> jne not_intel ;   ,   not_intel <br> mov eax,[ebp][-0010] <br> cmp eax,049656E69 ;"Ieni" ;   "ineI" <br> jne not_intel ;   - not_intel <br> mov eax,[ebp][-0014] <br> cmp eax,06C65746E ;"letn" ;   "ntel" <br> jne not_intel ;   - not_intel <br> mov edx,000000001 ;     <br> jmps next <br> not_intel: <br> xor edx,edx ;   0,   -  <br> next: <br></code> <br>  As a result, from the entire set of software installed on the computer, only one such program was found, and about a miracle - it turned out to be a benchmark!  She was <a href="http://www.maxon.net/index.php%3Fid%3D162%26L%3D0">CineBench R10</a> from Maxon <br><br><img src="http://tronix286.pochta.ru/habr/maxon.jpg" alt="image"><br><br>  It perfectly contains the above code sections.  Without unnecessary words, we use the <a href="">patcher</a> on the main EXE program, and also do not forget to patch all the other program libraries, which by the way, have a non-standard .CDL extension.  The test itself evaluates the rendering speed of the image and, as a result, produces certain ‚Äúparrots‚Äù.  Now it's time to look at the chart: <br><br><img src="http://tronix286.pochta.ru/habr/grafik.png" alt="image"><br><br>  Three launches of the program with and without a patch were made.  As can be seen in the graph, the results vary.  But in reality, they differ very, very little, the schedule distorts the presentation a little.  For example, if you take the render time, then on the patched program it is approximately 7 minutes and 30-40 seconds, and on the benchmark without a patch 7 minutes 50 seconds - 8 minutes.  The average difference is no more than 15-20 seconds. <br><br>  What do we see in the end?  Yes, there is some difference, but it is so insignificant that it can be safely neglected.  If on large (long) tasks the difference does not exceed 20 seconds, then on simple (office) tasks it will not be visible at all. <br>  On the other hand, it is important not to be deceived - after all, no one prevented the developers of this program from writing all critical cycles in pure assembler, thus being independent of the compiler.  And I suspect that this is the way it is, so unfortunately it was not possible to see the full picture with this program. <br><br>  What did I find out during this time for myself?  The first is that there are not many programs used on an ordinary user's computer and compiled using the Intel Compiler every day.  To be more precise - a little mizirno.  Secondly, it is very difficult to evaluate performance gains on other people's programs, because it is not known how they work from the inside.  Currently, there is a slow download of the trial version of the compiler, to conduct an experiment directly on its own programs.  Even then it will be possible to draw at least some more or less reliable conclusions. <br><br>  The purpose of this article is not to incite holivars on Intel vs AMD, or similar.  The goal is to find out and understand whether that notorious processor dispatcher has such a strong influence on the execution time of the programs, as we have in the original article.  And I would like to do this with your help,%% username. </div><p>Source: <a href="https://habr.com/ru/post/83753/">https://habr.com/ru/post/83753/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../83747/index.html">Poll: Russian-speaking community of MMORPG players</a></li>
<li><a href="../83748/index.html">Envato which is ‚ÄúMust Have‚Äù for everyone</a></li>
<li><a href="../83749/index.html">Habraohrana and culture of speech</a></li>
<li><a href="../83750/index.html">Cyrket now tracks and Windows Mobile</a></li>
<li><a href="../83752/index.html">Expensive GPRS / EDGE roaming</a></li>
<li><a href="../83755/index.html">"Goodline" writes off money for failed calls - tourists, be careful!</a></li>
<li><a href="../83756/index.html">STDIO plugins or how to combine incompatible</a></li>
<li><a href="../83758/index.html">(photo) report of the Baltic Competition</a></li>
<li><a href="../83759/index.html">Support each other - give 2 AdWords coupons in good hands</a></li>
<li><a href="../83761/index.html">We try to create a special effect.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>