<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy tor integration into the android application using the example of a rutracker client</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I wondered for a long time whether it is easy to add proxying via tor in Android application. It seems to be a fairly obvious task, plus the torus bro...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy tor integration into the android application using the example of a rutracker client</h1><div class="post__text post__text-html js-mediator-article">  I wondered for a long time whether it is easy to add proxying via tor in Android application.  It seems to be a fairly obvious task, plus the torus browsers have already been under this platform for a long time ... But there are many tasks that are more difficult than they seem.  For those who are impatient, I will say straight away - yes, it is possible, and it turns out quite easily, quickly and coolly.  In particular, if you do not dig from scratch, but take advantage of my work. <br><img src="https://habrastorage.org/files/689/f60/820/689f60820c7a4a1c92c2629fabb40e6d.png"><br>  For example, I will use the application to work with a rutracker - no one likes code that works with a spherical horse in a vacuum.  Previously, this application bypassed the blocking <a href="https://habrahabr.ru/post/279267/">with the help of Google Compression Proxy</a> - but alas - either the root tracker, or Google drank the possibility of authorization with this proxy.  I must say at once that, of course, there are all kinds of vpna and stuff that you use to easily bypass the lock and view the serials.  But this is not about this.  As you understand, a torus can be used in a mobile application for a huge amount of things - for example, to access web sites in .onion or to implement a highly secure messenger. <br><a name="habracut"></a><br><h1>  How to connect the library to work with the Thor </h1><br><h2>  How to build from scratch </h2><br>  If you are not interested in building from scratch, then immediately go to the next heading. <br><br>  So, what we have on this topic from the finished toolkit.  There is a special repository from some guys under the leadership of Microsoft (link in the basement).  It seems that everything worked for them - but the quality and assembly mechanism are simply terrifying.  And the repository is outdated for two years.  And the compiled version of the library is not there, there are only pretty dumb instructions on how to build it yourself (in the style - ‚ÄúI did it, I don‚Äôt know why, but without this nothing worked‚Äù).  However, the available instructions are enough to update the code to the current state and fix all the strange jambs. <br><br><ol><li>  We clone this repository. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  We update there the component that is responsible for managing the torus - jtorctl.  They used fork of the main repository with briar edits, but these edits are already included in the main repository, so it is better to take them from the main one.  You can connect from the maven repository, but I usually pick up such things with the source code - you can see right away, get rid of the analysis and edit the bugs on the fly - the project is rather raw, regardless of age. <br><br></li><li>  We update geoip and geoip6 ‚Äî databases of blocks of IP addresses with reference to the geographic location of each block for IPv4 and IPv6 versions, respectively.  To do this, download the windows expert bundle on the website of the torus. <br><br></li><li>  We update the torus itself (that is, the native library).  There is no standard public access (well, or I was looking badly) - so we go to the guys who develop the torus and the torus browser for android (Orbot and Orfox), take the latest release of their Orbot and remove the library from there.  Thor is pretty fresh there, which is nice. <br><br></li><li>  Hand over everything that stopped compiling in our project.  Several functions in dependent libraries have changed, but in general, everything is intuitive and fixable in 5 minutes. <br><br></li><li>  Following the recommendations of our project readme, we create local maven repositories and build our project from a heap of pieces.  By the way, please note that the build script is so crooked that in one place includes the previous release itself.  Horror.  So I recommend to rewrite it anew, in simple and understandable language, in order to get an ordinary aar library at the output. <br></li></ol><br><h2>  How to collect from my work </h2><br>  I have already done points 1-6 for you, so just compile the library from my repository, or download it in the release section.  The link will be in the ‚Äúbasement‚Äù of the post.  However, I draw your attention to the fact that it will be correct to check the code and libraries for compliance with the original ones and the absence of bookmarks.  You should not add such things blindly to your applications. <br><br><h1>  How to stop worrying and start proxying through the torus </h1><br>  First you need to turn on the torus: <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> totalSecondsPerTorStartup = <span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-number"><span class="hljs-number">60</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> totalTriesPerTorStartup = <span class="hljs-number"><span class="hljs-number">5</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">boolean</span></span> ok = onionProxyManager.startWithRepeat(totalSecondsPerTorStartup, totalTriesPerTorStartup); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!ok) Log.e(<span class="hljs-string"><span class="hljs-string">"TorTest"</span></span>, <span class="hljs-string"><span class="hljs-string">"Couldn't start Tor!"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (InterruptedException | IOException e) { e.printStackTrace(); }</code> </pre> <br>  Then wait for it to pick up: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (!onionProxyManager.isRunning()) Thread.sleep(<span class="hljs-number"><span class="hljs-number">90</span></span>);</code> </pre><br>  If everything went well - hurray, he listens to our localhost on some random port: <br><br><pre> <code class="java hljs">Log.v(<span class="hljs-string"><span class="hljs-string">"My App"</span></span>, <span class="hljs-string"><span class="hljs-string">"Tor initialized on port "</span></span> + onionProxyManager.getIPv4LocalHostSocksPort());</code> </pre><br>  But this is not all.  We now have a torus that listens to the port as a Socks4a proxy.  However, not all standard libraries can work with Socks4a.  There, for reasons of anonymity, it is required that the host resolving occurs on a proxy, and not earlier.  I do not know which of the standard libraries can do this, and I had code written with Apache HttpComponents.  I already <a href="https://habrahabr.ru/post/308522/">wrote earlier</a> why they can be used, and this post is not about that.  If you want, you can implement the same on any other library. <br><br>  So, to use httpComponents, we need to rewrite ConnectionSocketFactory and SSLConnectionSocketFactory. <br><br><div class="spoiler">  <b class="spoiler_title">SSLConnectionSocketFactory</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MySSLConnectionSocketFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SSLConnectionSocketFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MySSLConnectionSocketFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> SSLContext sslContext)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>(sslContext); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Socket </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createSocket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpContext context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Socket(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Socket </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectSocket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> connectTimeout, Socket socket, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpHost host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetSocketAddress remoteAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetSocketAddress localAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpContext context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ Args.notNull(host, <span class="hljs-string"><span class="hljs-string">"HTTP host"</span></span>); Args.notNull(remoteAddress, <span class="hljs-string"><span class="hljs-string">"Remote address"</span></span>); InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute(<span class="hljs-string"><span class="hljs-string">"socks.address"</span></span>); socket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Socket(); connectTimeout = <span class="hljs-number"><span class="hljs-number">100000</span></span>; socket.setSoTimeout(connectTimeout); socket.connect(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InetSocketAddress(socksaddr.getHostName(), socksaddr.getPort()), connectTimeout); DataOutputStream outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataOutputStream(socket.getOutputStream()); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x04</span></span>); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x01</span></span>); outputStream.writeShort((<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) host.getPort()); outputStream.writeInt(<span class="hljs-number"><span class="hljs-number">0x01</span></span>); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span>); outputStream.write(host.getHostName().getBytes()); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span>); DataInputStream inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataInputStream(socket.getInputStream()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputStream.readByte() != (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span> || inputStream.readByte() != (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x5a</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"SOCKS4a connect failed"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Log.v(<span class="hljs-string"><span class="hljs-string">"SSLConnectionSF"</span></span>, <span class="hljs-string"><span class="hljs-string">"SOCKS4a connect ok!"</span></span>); inputStream.readShort(); inputStream.readInt(); SSLConnectionSocketFactory sslSocketFactory = SSLConnectionSocketFactory.getSocketFactory(); SSLSocket sslSocket = (SSLSocket) sslSocketFactory.createLayeredSocket(socket, host.getHostName(), host.getPort(), context); prepareSocket(sslSocket); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sslSocket; } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">ConnectionSocketFactory</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyConnectionSocketFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ConnectionSocketFactory</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Socket </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createSocket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpContext context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Socket(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Socket </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connectSocket</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> connectTimeout, Socket socket, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpHost host, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetSocketAddress remoteAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> InetSocketAddress localAddress, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HttpContext context)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IOException, ConnectTimeoutException </span></span>{ InetSocketAddress socksaddr = (InetSocketAddress) context.getAttribute(<span class="hljs-string"><span class="hljs-string">"socks.address"</span></span>); socket = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Socket(); connectTimeout = <span class="hljs-number"><span class="hljs-number">100000</span></span>; socket.setSoTimeout(connectTimeout); socket.connect(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InetSocketAddress(socksaddr.getHostName(), socksaddr.getPort()), connectTimeout); DataOutputStream outputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataOutputStream(socket.getOutputStream()); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x04</span></span>); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x01</span></span>); outputStream.writeShort((<span class="hljs-keyword"><span class="hljs-keyword">short</span></span>) host.getPort()); outputStream.writeInt(<span class="hljs-number"><span class="hljs-number">0x01</span></span>); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span>); outputStream.write(host.getHostName().getBytes()); outputStream.write((<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span>); DataInputStream inputStream = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataInputStream(socket.getInputStream()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (inputStream.readByte() != (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x00</span></span> || inputStream.readByte() != (<span class="hljs-keyword"><span class="hljs-keyword">byte</span></span>) <span class="hljs-number"><span class="hljs-number">0x5a</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IOException(<span class="hljs-string"><span class="hljs-string">"SOCKS4a connect failed"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> Log.v(<span class="hljs-string"><span class="hljs-string">"SSLConnectionSF"</span></span>, <span class="hljs-string"><span class="hljs-string">"SOCKS4a connect ok!"</span></span>); inputStream.readShort(); inputStream.readInt(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> socket; } }</code> </pre><br></div></div><br>  Using these factories is easy and simple.  To do this, create an HttpClient that uses these libraries: <br><br><pre> <code class="java hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> HttpClient </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNewHttpClient</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Registry&lt;ConnectionSocketFactory&gt; reg = RegistryBuilder.&lt;ConnectionSocketFactory&gt;create() .register(<span class="hljs-string"><span class="hljs-string">"http"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MyConnectionSocketFactory()) .register(<span class="hljs-string"><span class="hljs-string">"https"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> MySSLConnectionSocketFactory(SSLContexts.createSystemDefault())) .build(); PoolingHttpClientConnectionManager cm = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PoolingHttpClientConnectionManager(reg); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> HttpClients.custom() .setConnectionManager(cm) .build(); }</code> </pre><br>  And tell him our proxy server: <br><br><pre> <code class="java hljs"> HttpClient cli = getNewHttpClient(); <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> port = onionProxyManager.getIPv4LocalHostSocksPort(); InetSocketAddress socksaddr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InetSocketAddress(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>, port); HttpClientContext context = HttpClientContext.create(); context.setAttribute(<span class="hljs-string"><span class="hljs-string">"socks.address"</span></span>, socksaddr);</code> </pre><br>  Everything, now we can use the torus in the same way as if we were making ordinary queries.  Moreover, we can also access the .onion web sites. <br><br><h1>  Result </h1><br>  I used the resulting code in my rutracker application.  Yes, the torus initialization takes about 20 seconds, and the pages do not load so quickly - but then we are guaranteed to pass the lock.  And all resources that are not blocked are loaded via a normal connection.  It would be possible to skip the rest of the resources through the Google Compression Proxy, but many complained that they had blocked this proxy - so I did not do that.  Of course, the application could have done a lot more - for example, to cache static on the phone to save traffic and faster work - but this is not so critical, and I wrote the application rather for example. <br><br><h1>  Conclusion </h1><br>  Thor on the android is a cool and handy thing that works quite well and can really be used in your applications.  By the way, yes, there is a much easier way to do this - just require the installation of the Orbot, which itself will raise your torus.  But I do not like the dependencies of some applications on others, and the 3 extra megabytes are not so critical in the size of the application.  So if someone liked my decision - use, make pull requests, and may there be freedom with you. <br><br><h1>  References: </h1><br><ol><li>  <a href="https://github.com/thaliproject/Tor_Onion_Proxy_Library">Source library</a> ; </li><li>  <a href="https://github.com/jehy/Tor-Onion-Proxy-Library">My library build</a> ; </li><li>  <a href="https://github.com/jehy/rutracker-free">Rutracker application</a> ; </li><li>  <a href="https://guardianproject.info/">Guardian Project</a> - the guys to whom we owe the presence of a native library torus. </li></ol><br><div style="text-align:center;"><img src="https://habrastorage.org/files/195/45e/e8d/19545ee8d9e144c4860db4f6490d804a.jpg"></div></div><p>Source: <a href="https://habr.com/ru/post/313030/">https://habr.com/ru/post/313030/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../313020/index.html">Open lecture on the promotion of games in Moscow, November 2</a></li>
<li><a href="../313022/index.html">Michael Fezers, author of the book ‚ÄúWorking Effectively with Legacy Code‚Äù, goes to Kharkov with a report</a></li>
<li><a href="../313024/index.html">Do you need marketing automation?</a></li>
<li><a href="../313026/index.html">Encapsulating a novice in a team and inheriting custom</a></li>
<li><a href="../313028/index.html">Google telephone interview experience demonstrating the failure of the hiring process</a></li>
<li><a href="../313034/index.html">Developing and testing chef dolls with the Sparrowdo tool</a></li>
<li><a href="../313036/index.html">Why "1984" will not come</a></li>
<li><a href="../313038/index.html">Writing a simple React application using the cellx library</a></li>
<li><a href="../313040/index.html">A person. As the creator of JavaScript, Brendan Ike came to the creation of his company</a></li>
<li><a href="../313042/index.html">Configure the LoRaWAN gateway and create our first IoT application</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>