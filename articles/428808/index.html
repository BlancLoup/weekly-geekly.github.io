<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Small convenience in student life</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A simple story about how I felt ashamed to constantly ask the groupmates for missing information and I decided to make our lives a little easier. 



...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Small convenience in student life</h1><div class="post__text post__text-html js-mediator-article"><p>  A simple story about how I felt ashamed to constantly ask the groupmates for missing information and I decided to make our lives a little easier. </p><br><p><img src="http://www.wallpapermaiden.com/wallpaper/14997/download/2560x1700/talos-principle-robot-painting-profile-view-artwork.jpg" alt="image"></p><br><p>  I suppose that many of my peers are familiar with the situation when in the general chat, where important information is often flashed, there are about 30 active interlocutors who constantly load Vkontakte databases with their messages.  Under these conditions, it is unlikely that everyone will see this important information.  It happens to me.  A year ago, it was decided to correct this misunderstanding. </p><br><p>  Those who are ready not to resent the next article about the bot, please under the cat. </p><a name="habracut"></a><br><p>  Since I am a first level student, examples will be related to this topic. <br>  So, there is a task: to make the transfer of information from the headman to the students convenient both for the headman and for the students.  Thanks to the relatively new features of Vkontakte (namely, personal communications of communities), the solution caught my eye immediately.  A bot sitting in a group should receive messages from the headman (the headman if there are many groups on the stream) and send them to interested persons (students). </p><br><p>  The task is set, proceed. </p><br><p>  <u>We will need:</u> </p><br><ol><li>  <a href="https://github.com/python273/vk_api">vk_api</a> library for using Vk Api </li><li>  <a href="http://docs.peewee-orm.com/">peewee orm</a> to work with the database </li><li>  and built-in python modules </li></ol><br><p>  Also, before reading, I suggest refreshing the Observer patterns ( <a href="https://habr.com/post/128827/">habr</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25B1%25D0%25BB%25D1%258E%25D0%25B4%25D0%25B0%25D1%2582%25D0%25B5%25D0%25BB%25D1%258C_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">wiki</a> ) and fa√ßade ( <a href="https://habr.com/post/87110/">habr</a> , <a href="https://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25B0%25D1%2581%25D0%25B0%25D0%25B4_(%25D1%2588%25D0%25B0%25D0%25B1%25D0%25BB%25D0%25BE%25D0%25BD_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B5%25D0%25BA%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D1%258F)">wiki</a> ) </p><br><p>  <strong>Part 1. "Nice to meet you, comrade bot."</strong> </p><br><p>  First you need to teach our bot to understand itself as a community.  Create a class called Group.  Let the session object and the representative (Proxy) object of the database be taken as arguments. </p><br><pre><code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Group</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(BaseCommunicateVK)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, vksession, storage)</span></span></span><span class="hljs-function">:</span></span> super().__init__(vksession) self.storage = storage</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">BaseCommunicateVK?</b>  <b class="spoiler_title">What is there?</b> <div class="spoiler_text"><p>  The decision to bring this functionality into a separate class is explained by the fact that in the future, one of you may decide to supplement the bot with some other Vkontakte functionality. <br>  Well, to relieve the abstraction of the community, of course. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BaseCommunicateVK</span></span></span><span class="hljs-class">:</span></span> longpoll = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, vksession)</span></span></span><span class="hljs-function">:</span></span> self.session = vksession self.api = vksession.get_api() <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> BaseCommunicateVK.longpoll <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: BaseCommunicateVK.longpoll = VkLongPoll(self.session) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_api</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_longpoll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.longpoll <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">method</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, func, args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api.method(func, args) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">create_session</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(token=None, login=None, password=None, api_v=</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">'5.85'</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> token: session = vk_api.VkApi(token=token, api_version=api_v) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> login <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> password: session = vk_api.VkApi(login, password, api_version=api_v) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> vk_api.AuthError(<span class="hljs-string"><span class="hljs-string">"Define login and password or token."</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> session <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> vk_api.ApiError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error: logging.info(error) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_last_message</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self.api.messages.getHistory( peer_id=user_id, count=<span class="hljs-number"><span class="hljs-number">1</span></span>)[<span class="hljs-string"><span class="hljs-string">"items"</span></span>][<span class="hljs-number"><span class="hljs-number">0</span></span>] @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_attachments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(last_message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> last_message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"attachments"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> last_message: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> attachments = last_message[<span class="hljs-string"><span class="hljs-string">"attachments"</span></span>] attach_strings = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> attach <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attachments: attach_type = attach[<span class="hljs-string"><span class="hljs-string">"type"</span></span>] attach_info = attach[attach_type] attach_id = attach_info[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] attach_owner_id = attach_info[<span class="hljs-string"><span class="hljs-string">"owner_id"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"access_key"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attach_info: access_key = attach_info[<span class="hljs-string"><span class="hljs-string">"access_key"</span></span>] attach_string = <span class="hljs-string"><span class="hljs-string">"{}{}_{}_{}"</span></span>.format(attach_type, attach_owner_id, attach_id, access_key) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: attach_string = <span class="hljs-string"><span class="hljs-string">"{}{}_{}"</span></span>.format(attach_type, attach_owner_id, attach_id) attach_strings.append(attach_string) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">","</span></span>.join(attach_strings) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_forwards</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(attachments, last_message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> attachments <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">"fwd_count"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> attachments: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> len(last_message[<span class="hljs-string"><span class="hljs-string">"fwd_messages"</span></span>]) == int(attachments[<span class="hljs-string"><span class="hljs-string">"fwd_count"</span></span>]): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> last_message[<span class="hljs-string"><span class="hljs-string">"id"</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id, message, attachments=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> send_to = int(user_id) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-string"><span class="hljs-string">"last_message"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kwargs: last_message = kwargs[<span class="hljs-string"><span class="hljs-string">"last_message"</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: last_message = <span class="hljs-keyword"><span class="hljs-keyword">None</span></span> p_attachments = self.get_attachments(last_message) p_forward = self.get_forwards(attachments, last_message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p_attachments <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> p_forward: self.api.messages.send( user_id=send_to, message=message, attachment=p_attachments, forward_messages=p_forward) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> destroy: accept_msg_id = self.api.messages \ .getHistory(peer_id=user_id, count=<span class="hljs-number"><span class="hljs-number">1</span></span>) \ .get(<span class="hljs-string"><span class="hljs-string">'items'</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>].get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) self.delete(accept_msg_id, destroy_type=destroy_type) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">delete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, msg_id, destroy_type=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function">:</span></span> self.api.messages.delete(message_id=msg_id, delete_for_all=destroy_type)</code> </pre> </div></div><br><p>  Create a method for updating community members.  Immediately divide them into administrators and members and save in the database. </p><br><ul><li>  self.api is configured when creating the base class Group (BaseCommunicateVK) </li></ul><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">update_members</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> fields = <span class="hljs-string"><span class="hljs-string">'domain, sex'</span></span> admins = self.api.groups.getMembers(group_id=self.group_id, fields=fields, filter=<span class="hljs-string"><span class="hljs-string">'managers'</span></span>) self.save_members(self._configure_users(admins)) members = self.api.groups.getMembers(group_id=self.group_id, fields=fields) self.save_members(self._configure_users(members)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save_members</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, members)</span></span></span><span class="hljs-function">:</span></span> self.storage.update(members) @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_configure_users</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(items, exclude=None)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> exclude <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: exclude = [] users = [] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> items.get(<span class="hljs-string"><span class="hljs-string">'items'</span></span>): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> user.get(<span class="hljs-string"><span class="hljs-string">'id'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> exclude: member = User() member.configure(**user) users.append(member) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> users</code> </pre> <br><p>  This class should also be able to send messages to the addressees, so the following method is in the studio.  In the parameters: the list of recipients, text messages and applications.  All this business is launched in a separate thread so that the bot can receive messages from other participants. <br>  Messages are received in synchronous mode, so with an increase in the number of active clients, the response speed will obviously diminish. </p><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">broadcast</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, uids, message, attachments=None, **kwargs)</span></span></span><span class="hljs-function">:</span></span> report = BroadcastReport() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">send_all</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> users_ids = uids <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(users_ids, list): users_ids = list(users_ids) report.should_be_sent = len(users_ids) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> user_id <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> users_ids: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: self.send(user_id, message, attachments, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> message <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> attachments: report.sent += <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> vk_api.VkApiError <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> error: report.errors.append(<span class="hljs-string"><span class="hljs-string">'vk.com/id{}: {}'</span></span>.format(user_id, error)) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ValueError: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> uid <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, moders=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): self.send(uid, str(report)) broadcast_thread = Thread(target=send_all) broadcast_thread.start() broadcast_thread.join()</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">BroadcastReport - report class</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastReport</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.should_be_sent = <span class="hljs-number"><span class="hljs-number">0</span></span> self.sent = <span class="hljs-number"><span class="hljs-number">0</span></span> self.errors = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__str__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> res = <span class="hljs-string"><span class="hljs-string">"#  #"</span></span> res += <span class="hljs-string"><span class="hljs-string">"\n: {}  "</span></span>.format(self.should_be_sent) res += <span class="hljs-string"><span class="hljs-string">"\n: {} "</span></span>.format(self.sent) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.errors: res += <span class="hljs-string"><span class="hljs-string">"\n:"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.errors: res += <span class="hljs-string"><span class="hljs-string">"\n- {}"</span></span>.format(i) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res</code> </pre> </div></div><br><p>  On this, seemingly, the abstraction of the group is over.  We met with all the community members, now we need to learn how to understand them. </p><br><p>  <strong>Part 2. "Psh ... welcome .."</strong> </p><br><p>  Make the bot listen to all messages from members of our community. <br>  To do this, create a class HandHandler, which will do it <br>  In the parameters: </p><br><ul><li>  group_manager is an instance of the community class we just wrote. </li><li>  command_observer recognizes connected commands (but this is the third part) </li></ul><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ChatHandler</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Handler)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, group_manager, command_observer)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.longpoll = group_manager.get_longpoll() self.group = group_manager self.api = group_manager.get_api() self.command_observer = command_observer</code> </pre> <br><p>  Next, in fact, we listen to messages from users and recognize the commands. </p><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">listen</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> event <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.longpoll.listen(): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> event.user_id <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.type == VkEventType.MESSAGE_NEW <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> event.to_me: self.group.api.messages.markAsRead(peer_id=event.user_id) self.handle(event.user_id, event.text, event.attachments, message_id=event.message_id) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> ConnectionError: logging.error(<span class="hljs-string"><span class="hljs-string">"I HAVE BEEN DOWNED AT {}"</span></span>.format(datetime.datetime.today())) self.longpoll.update_longpoll_server() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handle</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, user_id, message, attachments, **kwargs)</span></span></span><span class="hljs-function">:</span></span> member = self.group.get_member(user_id) self.group.update_members() self.command_observer.execute(member, message, attachments, self.group, **kwargs) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.listen()</code> </pre> <br><p>  <strong>Part 3. "What did you write about my ..?"</strong> </p><br><p>  A separate subsystem implemented through the "Observer" pattern deals with the recognition of commands. <br>  Attention, CommandObserver: </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">CommandObserver</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(AbstractObserver)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> command <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.commands: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> trigger <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> command.triggers: body = command.get_body(trigger, message) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> body <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: group.api.messages.setActivity(user_id=member.id, type=<span class="hljs-string"><span class="hljs-string">"typing"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command.system: kwargs.update({<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>: trigger, <span class="hljs-string"><span class="hljs-string">"commands"</span></span>: self.commands}) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: kwargs.update({<span class="hljs-string"><span class="hljs-string">"trigger"</span></span>: trigger}) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> command.proceed(member, body, attachments, group, **kwargs)</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">AbstractObserver</b> <div class="spoiler_text"><p>  Again, the imposition is made for future possible expansion. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractObserver</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ABCMeta)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.commands = [] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> arg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> args: self.commands.append(arg) @abstractmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, *args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pass</span></span></code> </pre> </div></div><br><p>  But what will this observer recognize? <br>  So we got to the most interesting - the team. <br>  Each command is an independent class, descendant from the base Command class. <br>  All that is required of the command is to run the proceed () method if its keyword is found at the beginning of the user's message.  Command keywords are defined in the command class triggers variable (string or list of strings) </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Command</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(metaclass=ABCMeta)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.triggers = [] self.description = <span class="hljs-string"><span class="hljs-string">"Empty description."</span></span> self.system = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.privilege = <span class="hljs-keyword"><span class="hljs-keyword">False</span></span> self.activate_times = [] self.activate_days = set() self.autostart_func = self.proceed <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">raise</span></span> NotImplementedError() @staticmethod <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_body</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(kw, message)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> isinstance(kw, list): kw = [kw, ] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> kw: reg = <span class="hljs-string"><span class="hljs-string">'^ *(\\{}) *'</span></span>.format(i) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> re.search(reg, message): <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> re.sub(reg, <span class="hljs-string"><span class="hljs-string">''</span></span>, message).strip(<span class="hljs-string"><span class="hljs-string">' '</span></span>)</code> </pre> <br><p>  As can be seen from the signature of the proceed () method, each team receives as input a link to the instance of a group member, its message (no longer a keyword), applications, and a link to the group instance.  That is, all interaction with a member of the group falls on the shoulders of the team.  I think this is the most correct decision, since it is thus possible to create a shell (Shell) for greater interactivity. <br>  (In truth, for this you will need to either make an asynchronous, because the processing is synchronous, or each received message is processed in a new thread, which is not profitable) </p><br><p>  Examples of command implementation: </p><br><div class="spoiler">  <b class="spoiler_title">BroadcastCommand</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BroadcastCommand</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.triggers = [<span class="hljs-string"><span class="hljs-string">'.mb'</span></span>] self.privilege = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.description = <span class="hljs-string"><span class="hljs-string">"    ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> member.id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> group.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, editors=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>): group.send(member.id, <span class="hljs-string"><span class="hljs-string">"You cannot do this ^_^"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> last_message = group.get_last_message(member.id) group.broadcast(group.get_member_ids(), message, attachments, last_message=last_message, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">HelpCommand</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HelpCommand</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Command)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> super().__init__() self.commands = [] self.triggers = [<span class="hljs-string"><span class="hljs-string">'.h'</span></span>, <span class="hljs-string"><span class="hljs-string">'.help'</span></span>] self.system = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> self.description = <span class="hljs-string"><span class="hljs-string">"  ."</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">proceed</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, member, message, attachments, group, **kwargs)</span></span></span><span class="hljs-function">:</span></span> commands = kwargs[<span class="hljs-string"><span class="hljs-string">"commands"</span></span>] help = <span class="hljs-string"><span class="hljs-string">"  :\n\n"</span></span> admins = group.get_member_ids(admins=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, moders=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) i = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> command <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> commands: <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command.privilege <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> member.id <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> admins: <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> help += <span class="hljs-string"><span class="hljs-string">"{}) {}\n\n"</span></span>.format(i + <span class="hljs-number"><span class="hljs-number">1</span></span>, command.name()) i += <span class="hljs-number"><span class="hljs-number">1</span></span> group.send(member.id, help) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span></code> </pre> </div></div><br><p>  <strong>Part 4. "We are one big team."</strong> </p><br><p>  Now all these modules and handlers need to be combined and configured. <br>  One more class please! <br>  Create a facade that will customize our bot. </p><br><pre> <code class="python hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VKManage</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, token=None, login=None, password=None)</span></span></span><span class="hljs-function">:</span></span> self.session = BaseCommunicateVK.create_session(token, login, password, api_version) self.storage = DBProxy(DatabaseORM) self.group = Group(self.session, self.storage).setup().update_members() self.chat = ChatHandler(self.group, CommandObserver.get_observer()) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">start</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.chat.run() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_name)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-string"><span class="hljs-string">" "</span></span>: BroadcastCommand(), <span class="hljs-string"><span class="hljs-string">" "</span></span>: AdminBroadcastCommand(), <span class="hljs-string"><span class="hljs-string">""</span></span>: HelpCommand(), <span class="hljs-string"><span class="hljs-string">" "</span></span>: SkippedLectionsCommand(), <span class="hljs-string"><span class="hljs-string">""</span></span>: TopicTimetableCommand().setup_account(self.bot.api), }.get(command_name) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect_command</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_name)</span></span></span><span class="hljs-function">:</span></span> command = self.get_command(str(command_name).lower()) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> command: self.chat.command_observer.add(command) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">connect_commands</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, command_names)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> command_names.split(<span class="hljs-string"><span class="hljs-string">','</span></span>): self.connect_command(i.strip()) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> self</code> </pre> <br><p>  The last stage is the launch.  Always the nastiest, because any surprise can come out.  Not this time. </p><br><ul><li>  ConfigParser is imported from core.settings.ConfigParser.  In fact, just reads the config. </li><li><p>  project_path is imported from the settings module in the project root. </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">'__main__'</span></span>: config = ConfigParser(project_path) VKManage(token=config[<span class="hljs-string"><span class="hljs-string">'token'</span></span>], login=config[<span class="hljs-string"><span class="hljs-string">'login'</span></span>], password=config[<span class="hljs-string"><span class="hljs-string">'password'</span></span>])\ .connect_commands(<span class="hljs-string"><span class="hljs-string">",  ,  ,  "</span></span>)\ .start()</code> </pre> <br></li></ul><br><p>  This seems to be all. </p><br><p>  At the moment, this program has benefited at least three groups and, I hope, will bring you too. </p><br><p>  You can deploy for free on Heroku, but that's another story. </p><br><p>  <strong>References:</strong> </p><br><ul><li>  <a href="https://github.com/nogip/morris">repository</a> on github </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/428808/">https://habr.com/ru/post/428808/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428794/index.html">Overview of the main mathematical optimization methods for problems with constraints</a></li>
<li><a href="../428796/index.html">Real-time mesh manipulation on Unity</a></li>
<li><a href="../428798/index.html">How to survive indie developer. Part 2</a></li>
<li><a href="../428800/index.html">Cooking perfect CSS</a></li>
<li><a href="../428806/index.html">Analysis of consumer check: what they buy on Amazon</a></li>
<li><a href="../428810/index.html">18 digital audio technologies</a></li>
<li><a href="../428812/index.html">TypeScript: Deserializing JSON into Classes with Property Type Validation</a></li>
<li><a href="../428814/index.html">Comparison of products using Elasticsearch for a competitor price monitoring service</a></li>
<li><a href="../428816/index.html">Material Design: Shape - tips for improving the GUI of an Android application (and not only) by changing the shape of elements</a></li>
<li><a href="../428818/index.html">DeOldify: a program for coloring black and white images</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>