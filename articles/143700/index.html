<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SELinux in practice: DVWA test</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the publication of the previous article about SELinux , there were many proposals to ‚Äúprove the utility in practice‚Äù of this security subsystem....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SELinux in practice: DVWA test</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage2/e2f/2a7/68c/e2f2a768c62cdc20abc1094d155b2233.jpg" align="left">  After the publication of the <a href="http://habrahabr.ru/company/pt/blog/142423/">previous article about SELinux</a> , there were many proposals to ‚Äúprove the utility in practice‚Äù of this security subsystem.  We decided to test.  To do this, we created three vulnerable stands with typical configurations (Damn Vulnerable Web Application on CentOS 5.8).  The differences between them were only in the SELinux settings: on the first virtual machine it was turned off, on the other two ‚Äúout of the box‚Äù policies - targeted and strict were applied. <br><br>  In this composition, the virtual machine stand was subjected to penetration testing.  Take a look at the results? <br><br><a name="habracut"></a><br>  However, let's first turn to the settings of the nodes.  To create templates, the CentOS 5.8 operating system was used with a ‚Äúlight bulb‚Äù ( <a href="http://ru.wikipedia.org/wiki/LAMP">LAMP</a> ) deployed on it.  In the process of setting up, I tried to make all the typical errors possible in this case: connecting to the database with superuser rights, setting everything up that can be done by default.  In this way, we tried to recreate three lines of events with a single starting point. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The original server is Apache in the arms of Little Red Riding Hood, who received all possible new clothes - with the help of the standard utility yum.  Of course, this tale was not without its Grandmother: MySQL database is installed on the nodes.  This excellent company is complemented by the extremely vulnerable Wolf - <a href="http://www.dvwa.co.uk/">Damn Vulnerable Web Application</a> , through which you can get to almost all other characters.  However, on two servers out of three hackers, there is a Hunter with a gun waiting for him - SELinux, who is going to shoot all extra limbs to the Wolf with dubious activity. <br><br>  On an unsecured server, SELinux is in ‚ÄúDisabled‚Äù mode.  This is a classic solution from <a href="http://www.howtoforge.com/">Site-Which-Not-Call</a> instructions.  Everything is in place, httpd and mysqld have a default configuration.  Thus, there is no additional protection on the node, and everything depends on the stability of the services themselves. <br><br>  As one of the options for protecting the web server, I used SELinux with the policy targeted.  I didn‚Äôt make any changes to it: the solution is ‚Äúout of the box‚Äù exactly in the form in which the vendor offers it.  The services run in prepared domains and operate within the framework of the ‚Äústandard operation‚Äù - from the point of view of Red Hat engineers. <br><br>  The latter configuration is a ‚Äústrict‚Äù policy of SELinux, and acts in accordance with the white sheet principle in accordance with the inherent idea.  What is not allowed is forbidden.  I tried to mark the file part with the necessary contexts, with a sparse emphasis on privileges.  This setting gives a fairly ‚Äútwisted‚Äù system, although without fanaticism. <br><br>  I asked my colleague from Positive Technologies (on Habr√©, he is known as <a href="http://habrahabr.ru/users/ki11obyte/" class="user_link">ki11obyte</a> ) to perform a penetration test.  Then he will tell. <br><br>  <i>Let's start with the machine on which SELinux was disabled.</i>  <i>The server was initially positioned as vulnerable, so getting a web shell was easy.</i> <i><br><br></i>  <i>Given the form of uploading images to the server, which checks only the Content-Type field in the request.</i>  <i>Fill the web shell with PHP by changing the Content-Type (in this case with BurpSuite) to image / jpeg.</i> <br><br><img src="https://habrastorage.org/storage2/832/71f/6f5/83271f6f5c4fd10961f68155eacf0541.png"><br><br>  <i>Shell is tested and uploaded to the server.</i> <i><br></i> <br><img src="https://habrastorage.org/storage2/aab/bee/6f8/aabbee6f8261b00035850488b6623f0b.png"><br><br>  <i>The configured SELinux was also unable to protect the system in this case.</i> <i><br><br></i>  <i>Next you need to run a web shell.</i>  <i>To do this, we find on the site a vulnerable script with the ability to download other scripts.</i> <br><br><img src="https://habrastorage.org/storage2/954/6d7/a05/9546d7a05697002a93ce26ee3b8ecf39.jpg"><br><br>  <i>The file was connected successfully on each of the machines.</i>  <i>SELinux thus does not protect us from errors in web applications.</i> <i><br><br></i>  <i>Now we can safely execute commands via the loaded web shell.</i> <br><br><img src="https://habrastorage.org/storage2/ae7/5d7/b05/ae75d7b05c1041398db6649833a7e168.png"><br><br>  <i>Or we can use reverse connection to get a more familiar console.</i> <br><br><img src="https://habrastorage.org/storage2/724/b0e/943/724b0e943ac6e0d97fb1eca3edc21f07.png"><br><br>  <i>Now the machine queue with SELinux enabled.</i>  <i>We get the web shell again - and we are a little disappointed: there are not enough rights to create sockets and even to execute ls.</i> <br><br><img src="https://habrastorage.org/storage2/34c/9d0/a16/34c9d0a16808f885fdc310d6e1efd275.png"><br><br><img src="https://habrastorage.org/storage2/401/706/81c/40170681c1c620b20d75869e840dc867.png"><br><br>  <i>However, despite the inability to list directories, we can easily view the files.</i> <br><br><img src="https://habrastorage.org/storage2/bd9/fe3/311/bd9fe33117f1995898c174882d2983ff.png"><br><br>  <i>Listing, by the way, managed to implement the means of PHP.</i> <br><br><img src="https://habrastorage.org/storage2/34a/169/f4c/34a169f4c4aed96d65ca02f02686e623.png"><br><br>  <i>In addition, we managed to create a file, make it executable and execute.</i> <br><br><img src="https://habrastorage.org/storage2/85b/ce9/e42/85bce9e4263dbe882311dfc712ee7892.png"><br><br>  <i>The next step was to capture the DBMS.</i>  <i>With the help of a web shell, we look at the MySQL configuration file of a web application and use it to connect.</i> <i><br><br></i>  <i>The SELECT LOAD_FILE ('/ etc / passwd') query allows you to read files.</i>  <i>We also easily manage to write the file to a temporary directory: SELECT 1 INTO OUTFILE '/ tmp / ololo'.</i>  <i>What turned out to be really strange is the rather unusual rights to the created file.</i> <i><br></i> <br><br><img src="https://habrastorage.org/storage2/1c5/f54/0d5/1c5f540d5207ca34b9f3ab47c670aa53.png"><br><br>  <i>No differences were found on the machine with SELinux enabled and configured, which was somewhat disappointing.</i> <i><br></i>  <i>-</i> <br><br>  As a result of the experiment, we came to the following conclusions.  First, I was mistaken with the choice of the vulnerable application: DVWA is a bad example for SELinux.  The bulk of the "vulnerabilities" is aimed at something to which there is access in the httpd_t domain.  As a result, it is completely incomprehensible - how to help the unfortunate Little Red Riding Hood and the unfailing, all-agree Apache.  The only suitable solution was to restrict access to most binaries - with the prohibition of the reverse connection.  In all other cases, the actions of the attacker simply did not fall within the scope of competence of the security subsystem with the standard settings. <br><br>  Secondly, it finally became clear that setting up SELinux for a web project is a very laborious task that requires confident knowledge and considerable effort.  I note: not just ‚Äúto protect the web server‚Äù, but specifically to seriously protect the project as a whole.  It is possible to create your own policy of interaction of contexts, but the expediency of this is in doubt.  My personal opinion: much more depends on proper configuration of php and httpd and regular updates. <br><br>  So, SELinux is able to at least log unhealthy activity in the system.  And if you carefully perform the setting - even prohibit unauthorized actions.  Unfortunately, however, it will not be able to protect your web project from errors in the code or incorrect application settings. </div><p>Source: <a href="https://habr.com/ru/post/143700/">https://habr.com/ru/post/143700/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../143692/index.html">Facebook smartphone will be on Windows Phone?</a></li>
<li><a href="../143694/index.html">XEN: A simple script to quickly open VNC consoles</a></li>
<li><a href="../143695/index.html">Domen.RF: just statistics and a little bit of freebies in the bargain</a></li>
<li><a href="../143698/index.html">Mobiscroll - custom select for mobile sites and not only</a></li>
<li><a href="../143699/index.html">Bomberman Online - HTML5 multiplayer online game from habrauser. We are testing the load!</a></li>
<li><a href="../143701/index.html">How to read to the end</a></li>
<li><a href="../143705/index.html">Replacing WiMAX devices with LTE devices</a></li>
<li><a href="../143706/index.html">Tell a story and get a Samsung Galaxy Tab tablet as a gift!</a></li>
<li><a href="../143707/index.html">Debian cookbook or how I started working on the official wiki</a></li>
<li><a href="../143708/index.html">Samsung Galaxy S III - three on the top five</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>