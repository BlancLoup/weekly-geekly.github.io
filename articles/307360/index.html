<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Asynchronous programming in 1C via .Net Native VK</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the article. Cross-platform use of .Net classes in 1C through Native VK. Or replacing COM with Linux II 

 In .Net now in ma...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Asynchronous programming in 1C via .Net Native VK</h1><div class="post__text post__text-html js-mediator-article">  This is a continuation of the article. <a href="http://habrahabr.ru/post/307188">Cross-platform use of .Net classes in 1C through Native VK.</a>  <a href="http://habrahabr.ru/post/307188">Or replacing COM with Linux II</a> <br><br>  In .Net now in many classes there are asynchronous methods.  In 1C they can be used for example <br><br><pre><code class="1c hljs">=(.GetStringAsync(uriSources)).Result;</code> </pre> <br>  And let me remind you about the synonyms from the previous article / So adding a synonym 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="1c hljs">.(HTTPClient.(),<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"GetStringAsync"</span></span>); .(Task.(),<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"Result"</span></span>);</code> </pre> <br>  I can use everything in Russian <br><br><pre> <code class="1c hljs">=(.()).;</code> </pre> <br>  But you can use asynchronous methods like this. <br><br><pre> <code class="1c hljs"> = (.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(HttpClient.(),handler.())); =(<span class="hljs-string"><span class="hljs-string">"System.Collections.Generic.List`1[System.Threading.Tasks.Task]"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span>  <span class="hljs-keyword"><span class="hljs-keyword"></span></span> URL() <span class="hljs-keyword"><span class="hljs-keyword"></span></span> =(.GetStringAsync()); .Add(.()); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>; Task=(<span class="hljs-string"><span class="hljs-string">"System.Threading.Tasks.Task"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span> .Count&gt;<span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> <span class="hljs-type"><span class="hljs-type"></span></span>=(.ToArray());  = Task.WaitAny(<span class="hljs-type"><span class="hljs-type"></span></span>.()); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>();  = (.get_Item()).Result; <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-built_in"><span class="hljs-built_in"></span></span>()); .RemoveAt(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>;</code> </pre> <br>  This is of course not quite asynchronous programming, but it is still better than to call a synchronous method for each request separately. <br><a name="habracut"></a><br>  But you need to make an asynchronous call.  To do this, create a simple class. <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span>  {<span class="hljs-comment"><span class="hljs-comment">//    ,   ,       public object ; //   public Task ; //   1   . public String ; public (Task , String , Object ) { this. = ; this. = ; this. = ; .ContinueWith((t) =&gt; { var AW = new AutoWrap(this); AutoWrap.1("", , AW.()); }); } }</span></span></code> </pre> <br>  And on the side of 1C: <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">,</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) =(ExpandoObject.()); .=; .=; <span class="hljs-keyword"><span class="hljs-keyword"></span></span> ; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span> <span class="hljs-comment"><span class="hljs-comment">// ()  ()  = (.(HttpClient.(),handler.())); =("System.Collections.Generic.List`1[System.Threading.Tasks.Task]"); =0;     URL()  //   =(.GetStringAsync()); //       =(,); //public static void (System.Threading.Tasks.Task , String , Object ) .(.(),"",.()); =+1; ; //     =("TestDllForCoreClr.","TestDllForCoreClr"); =(.(.(),"   ")); Thread=("System.Threading.Thread"); //   2   =(.Async(2)); =("Async",2); .(.(),"",.()); 2=(.Async(0)); =("Async",0); .(2.(),"",.());   ( ) =(.); =(.); ("="+.); ("="+.); //       // IsFaulted  ,   Exception    (.IsFaulted)  //   =.Exception; (" "+.()); //     1   .Exception   //       //   ,      // (" "+.(.Exception)); ; ; =.Result; (());   (, , ) //   . ("="+); ("="+); ("="+);  =""  =(); (+"()"); ; </span></span></code> </pre> <br>  I will explain a little on the code. <br><br>  Since in Native VK you cannot use the Add Processor, we will make its emulation by transferring the name of the method to be called in 1C to Asynchronous Performer. <br><br><pre> <code class="1c hljs">.(.(),<span class="hljs-string"><span class="hljs-string">""</span></span>,.());</code> </pre> <br>  Which will be called when an external event is triggered. <br><br><pre> <code class="1c hljs"> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> =<span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword"></span></span> =(); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>(+<span class="hljs-string"><span class="hljs-string">"()"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword"></span></span>;</code> </pre><br>  In this event variable, the ReceivedPage is stored and the method will be called. <br><br><pre> <code class="1c hljs">()</code> </pre> <br>  Now, about using the External Event in .Net assembly <br><br>  To do this, define the field <br><br><pre> <code class="cs hljs"> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Action&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>;</code> </pre> <br>  And install it from 1C. <br><br><pre> <code class="1c hljs">=(<span class="hljs-string"><span class="hljs-string">"TestDllForCoreClr., TestDllForCoreClr, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null"</span></span>); =(.<span class="hljs-keyword"><span class="hljs-keyword"></span></span>(.(),<span class="hljs-string"><span class="hljs-string">"   "</span></span>)); =(.<span class="hljs-number"><span class="hljs-number">1</span></span>C()); .<span class="hljs-number"><span class="hljs-number">1</span></span>=.(); .Test();</code> </pre> <br>  Inside the .Net class call the method <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>?.<span class="hljs-number"><span class="hljs-number">1</span></span>(<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, );</code> </pre> <br>  In this case, the procedure will be called in 1C. <br><br><pre> <code class="1c hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title"></span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span><span class="hljs-function">, </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"></span></span></span></span>) <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">"="</span></span>+); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">"="</span></span>+); <span class="hljs-built_in"><span class="hljs-built_in"></span></span>(<span class="hljs-string"><span class="hljs-string">"="</span></span>+); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword"></span></span></span></span></code> </pre> <br><br>  I tried to bring the C # syntax in 1C as close as possible.  And for me, even in this form it is easier to write VK on C #, than to use the Native API on C ++.  At the same time, you can integrate the use of .Net classes in 1C.  By adding synonyms you can write everything in Cyrillic.  You can add support for iterators, and so on. <br><br>  Now there are a lot of ActiveX on Windows, and it‚Äôs not difficult to write a COM component in any language. <br>  But it is not cross-platform. <br><br>  Using .Net Core and this wrapper over .Net objects in 1C, you can significantly expand the capabilities of 1C using a huge number of libraries and classes in them.  And focus on developing the language, finally adding a closure, Linq, specifying the type for intellisense (similar to TypeScript).  Splitting modal dialogs in the same way as yeld and await in C #.  As well as await analogs for server calls with closures. <br><br>  I understand that this development is of little interest to anyone.  But I was interested in developing it.  In addition, it will be interesting to try .Net Core and use Reflection <br><br>  Examples and sources can be downloaded <a href="https://yadi.sk/d/jRSHEA19svgrn/">here.</a> </div><p>Source: <a href="https://habr.com/ru/post/307360/">https://habr.com/ru/post/307360/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307350/index.html">How I went to the States in 2000 and what happened next</a></li>
<li><a href="../307352/index.html">We draw 3D on an oscillograph</a></li>
<li><a href="../307354/index.html">All programmers think that C ++ supports OOP, except the OOP author.</a></li>
<li><a href="../307356/index.html">Network Evolution to SDN & NFV</a></li>
<li><a href="../307358/index.html">We raise micromonitoring on icinga2 with minimal costs</a></li>
<li><a href="../307362/index.html">Model of watercraft interaction in video games</a></li>
<li><a href="../307364/index.html">The book "The secrets of CSS. Perfect solutions to daily tasks. ‚Äù</a></li>
<li><a href="../307366/index.html">Modified Geometry Buffer Anti-Aliasing Algorithm</a></li>
<li><a href="../307368/index.html">AI monsters and finding the way with heatmaps</a></li>
<li><a href="../307372/index.html">Cremes is a new advanced cyber spyware malware.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>