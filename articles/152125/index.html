<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Sectioning: Shot and forget</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="You can find a lot of information about sectioning, in particular , you can read about theory here, and then the author develops the idea and provides...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Sectioning: Shot and forget</h1><div class="post__text post__text-html js-mediator-article">  You can find a lot of <a href="http://www.postgresql.org/docs/9.2/interactive/ddl-partitioning.html">information</a> about sectioning, in particular <a href="http://habrahabr.ru/post/74984/">,</a> you can read about theory here, and then the author develops the idea and provides his solution for quickly adding a section.  I recommend to familiarize. <br>  After studying the theory, almost everyone comes to the idea of ‚Äã‚Äãautomating the process of creating sections.  Above was one of the options, the second <a href="http://www.zabbix.com/wiki/non-english/ru/partitioning_in_postgresql">integrated option</a> I saw with the creators of a respected, I think, not only Zabbix me. <br>  After a small adaptation, I decided to implement it in my home ... Unfortunately, several shortcomings appeared in it: when creating a new section, the first entry in this section was lost;  with a large number of sections, inserting even one record takes too much time (caused by 2 factors: each time the table was calculated where the record should be put; using a set of rules instead of one trigger with all conditions).  Nevertheless, the guys did an excellent job and I take this opportunity to send them rays of respect. <br><a name="habracut"></a><br><br>  As a result, I submit my decision to your court.  To begin, an example of how to start a partition: <br>  Date range: <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_partition(<span class="hljs-string"><span class="hljs-string">'partitions.test1.cdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-string"><span class="hljs-string">'day,YYYY_MM_DD'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_partition(<span class="hljs-string"><span class="hljs-string">'partitions.test2.cdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-string"><span class="hljs-string">'week,YYYY_IW'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_partition(<span class="hljs-string"><span class="hljs-string">'partitions.test3.cdate'</span></span>, <span class="hljs-string"><span class="hljs-string">'date'</span></span>, <span class="hljs-string"><span class="hljs-string">'month,YYYY_MM'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">now</span></span>()::<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>);</code> </pre> <br>  These commands will start partitioning by day, week and month for the test1, test2, test3 tables. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We analyze the parameters: <br>  the first field of the ' <i>partitions.test1.cdate</i> ' values, separated by a dot: <br>  <i>partitions</i> - the name of the schema where the sections will be added <br>  <i>test1</i> - table ancestor in the current scope <br>  <i>cdate</i> - the field by which the table will be divided <br>  the second field <i>'date'</i> specifies the type of sections <br>  the third field is <i>'day, YYYY_MM_DD'</i> sets the parameters for partitioning <br>  <i>day</i> - create sections every day <br>  <i>YYYY_MM_DD</i> - suffix for the table <br>  and finally, the fourth <i>now () :: text is</i> an example of the data for creating a section <br><br>  Another example: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_partition(<span class="hljs-string"><span class="hljs-string">'partitions.test4.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'digits'</span></span>, <span class="hljs-string"><span class="hljs-string">'10,2'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>);</code> </pre><br>  Here the number will be reduced to 10-bit by adding zeros to the left (if necessary) and all digits to the left of the eighth will be taken for the section name: <br>  1,000,000,000 will fall into the partitions.test4_10 section <br>  100000000 in the partitions.test4_01 section <br>  10,000,000 into the partitions.test4_00 section <br>  10000000000 in the partitions.test4_100 section <br><br>  I will briefly describe how it works: <br>  when you run select create_partition ('partitions.test1.cdate', 'date', 'day, YYYY_MM_DD', now () :: text);  The first thing to do is to call the plugin partition_ <b>date</b> .  The purpose of this function is to return the section name and the condition of hitting it by the passed parameters.  Further in the main function, a new table is created, inherited from the current one with the necessary conditions, all ancestor indices are copied. <br>  Then, a query from the system tables pulls out the data about the descendant tables and their check condition from this data, recreates the trigger, which distributes the data into sections. <br>  Now, with any insertion, the trigger will be triggered and determine the desired table-section, if there is no such table, create_partition is called with the same parameters that were used when creating sections. <br>  For the first example, after a year of filling, the trigger will look like this: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> trig_partition_test1_cdate() <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TRIGGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $BODY2$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> ((NEW.cdate &gt;= <span class="hljs-string"><span class="hljs-string">'2012-09-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-10-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_09 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-08-01 00:00:00-07'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-09-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_08 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-07-01 00:00:00-07'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-08-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_07 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-06-01 00:00:00-07'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-07-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_06 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-05-01 00:00:00-07'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-06-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_05 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-04-01 00:00:00-07'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-05-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_04 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-03-01 00:00:00-08'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-04-01 00:00:00-07'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_03 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-02-01 00:00:00-08'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-03-01 00:00:00-08'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_02 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSIF ((NEW.cdate &gt;= '2012-01-01 00:00:00-08'::timestamp <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> (NEW.cdate &lt; <span class="hljs-string"><span class="hljs-string">'2012-02-01 00:00:00-08'</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone)) <span class="hljs-keyword"><span class="hljs-keyword">THEN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> public.test1_2012_01 <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (NEW.*); ELSE <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'SELECT create_partition(''public.test1.cdate''::text, ''date''::text, ''month,YYYY_MM''::text , '''</span></span>||NEW.cdate||<span class="hljs-string"><span class="hljs-string">'''::text)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> <span class="hljs-keyword"><span class="hljs-keyword">child</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">EXECUTE</span></span> <span class="hljs-string"><span class="hljs-string">'INSERT INTO '</span></span>|| <span class="hljs-keyword"><span class="hljs-keyword">child</span></span> || <span class="hljs-string"><span class="hljs-string">' SELECT $1.*'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NEW</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">END</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span>; RETURN NULL; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql';</code> </pre><br><br>  As you can see, it turns out almost a classic example from the documentation :) <br><br>  As you may have guessed, this solution is easy to expand, for example, by sectioning the first letters of a line or hash of a line.  I propose to write this ‚Äúplugin‚Äù independently and put it in the comments. <br><br>  I hope someone my decision will be useful. <br><br><div class="spoiler">  <b class="spoiler_title">Supporting scripts found on the sql.ru forum</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> to_timestamp(<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">without</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $_$ <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone; $_$ LANGUAGE sql STABLE STRICT; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> to_timestamp(<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $_$ <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> $<span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone; $_$ LANGUAGE sql STABLE STRICT; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> to_numeric(<span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $_$ <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> regexp_replace($<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'\D+'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'g'</span></span>)::<span class="hljs-built_in"><span class="hljs-built_in">numeric</span></span>; $_$ LANGUAGE sql STABLE STRICT; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_constraints(srcoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dstoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> i int4 := <span class="hljs-number"><span class="hljs-number">0</span></span>; constrs record; srctable text; dsttable text; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> srctable = srcoid::regclass; dsttable = dstoid::regclass; for constrs in <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> conname <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, pg_get_constraintdef(<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> definition <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_constraint <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> conrelid = srcoid <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'alter table '</span></span> || dsttable || <span class="hljs-string"><span class="hljs-string">' add constraint '</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(constrs.name, srctable, dsttable),<span class="hljs-string"><span class="hljs-string">'.'</span></span>,<span class="hljs-string"><span class="hljs-string">'_'</span></span>) || <span class="hljs-string"><span class="hljs-string">' '</span></span> || constrs.definition; i = i + 1; exception when duplicate_table then <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; return i; exception when undefined_table then return null; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' VOLATILE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_constraints(src <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dst <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copy_constraints(src::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dst::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' IMMUTABLE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_indexes(srcoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dstoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> i int4 := <span class="hljs-number"><span class="hljs-number">0</span></span>; indexes record; srctable text; dsttable text; script text; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> srctable = srcoid::regclass; dsttable = dstoid::regclass; for indexes in <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> c.relname <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, pg_get_indexdef(idx.indexrelid) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> definition <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_index idx, pg_class c <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> idx.indrelid = srcoid <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> c.oid = idx.indexrelid <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> script = <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> (indexes.definition, <span class="hljs-string"><span class="hljs-string">' INDEX '</span></span> || indexes.name, <span class="hljs-string"><span class="hljs-string">' INDEX '</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(indexes.name, srctable, dsttable),<span class="hljs-string"><span class="hljs-string">'.'</span></span>,<span class="hljs-string"><span class="hljs-string">'_'</span></span>)); script = <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> (script, <span class="hljs-string"><span class="hljs-string">' ON '</span></span> || srctable, <span class="hljs-string"><span class="hljs-string">' ON '</span></span> || dsttable); <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> script; i = i + 1; exception when duplicate_table then <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; return i; exception when undefined_table then return null; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' VOLATILE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_indexes(src <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dst <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copy_indexes(src::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dst::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' IMMUTABLE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_triggers(srcoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dstoid <span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> i int4 := <span class="hljs-number"><span class="hljs-number">0</span></span>; triggers record; srctable text; dsttable text; script text = ''; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> srctable = srcoid::regclass; dsttable = dstoid::regclass; for triggers in <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> tgname <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-keyword"><span class="hljs-keyword">name</span></span>, pg_get_triggerdef(<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> definition <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> pg_trigger <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> tgrelid = srcoid <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span> script = <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> (triggers.definition, <span class="hljs-string"><span class="hljs-string">' TRIGGER '</span></span> || triggers.name, <span class="hljs-string"><span class="hljs-string">' TRIGGER '</span></span> || <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">replace</span></span>(triggers.name, srctable, dsttable),<span class="hljs-string"><span class="hljs-string">'.'</span></span>,<span class="hljs-string"><span class="hljs-string">'_'</span></span>)); script = <span class="hljs-keyword"><span class="hljs-keyword">replace</span></span> (script, <span class="hljs-string"><span class="hljs-string">' ON '</span></span> || srctable, <span class="hljs-string"><span class="hljs-string">' ON '</span></span> || dsttable); <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> script; i = i + 1; exception when duplicate_table then <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-keyword"><span class="hljs-keyword">loop</span></span>; return i; exception when undefined_table then return null; <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' VOLATILE; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> copy_triggers(src <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, dst <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">integer</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> copy_triggers(src::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>, dst::regclass::<span class="hljs-keyword"><span class="hljs-keyword">oid</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">end</span></span>; $BODY$ LANGUAGE 'plpgsql' IMMUTABLE;</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Main scripts</b> <div class="spoiler_text"><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> <span class="hljs-keyword"><span class="hljs-keyword">REPLACE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FUNCTION</span></span> <span class="hljs-string"><span class="hljs-string">"create_partition"</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> tbl <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> method <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> params <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sample</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">RETURNS</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $<span class="hljs-keyword"><span class="hljs-keyword">BODY</span></span>$ <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> scheme <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span> := split_part(tbl, <span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); parent varchar := split_part(tbl, '.', 2); field varchar := split_part(tbl, '.', 3); child varchar; script text; trig text; part text[]; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'select partition_'</span></span>||method||<span class="hljs-string"><span class="hljs-string">'('''</span></span>||params||<span class="hljs-string"><span class="hljs-string">''', '''</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">field</span></span>||<span class="hljs-string"><span class="hljs-string">''', '''</span></span>||<span class="hljs-keyword"><span class="hljs-keyword">sample</span></span>||<span class="hljs-string"><span class="hljs-string">''')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> part; <span class="hljs-comment"><span class="hljs-comment">-- RAISE EXCEPTION 'part %', part; child = scheme || '.' || parent || '_' || (part[1]::text); execute 'create table IF NOT EXISTS ' || child || ' ( constraint partition_' || (part[1]) || ' check ' || (part[2]) || ' ) inherits (' || parent || ')'; perform copy_constraints(parent, child); perform copy_indexes(parent, child); -- execute 'GRANT SELECT ON ' || child || ' TO some_other_user'; -- execute 'GRANT ALL ON ' || child || ' TO user'; script = (select string_agg(c, chr(10)||' ELS') from ( select to_numeric(replace(t.table_name, parent||'_','')) as n, 'IF '||replace(left(right(cc.check_clause, -1), -1), c.column_name, 'NEW.'||c.column_name)||' THEN INSERT INTO '||t.table_schema||'.'||t.table_name||' VALUES (NEW.*);' as c from information_schema.TABLE_CONSTRAINTS t join information_schema.CONSTRAINT_COLUMN_USAGE c ON t.constraint_name = c.constraint_name join information_schema.check_constraints cc ON t.constraint_name = cc.constraint_name where constraint_type IN ('CHECK') and t.table_name like parent||'\_%' group by t.table_schema, t.table_name, c.column_name, cc.check_clause order by n desc) t); trig = 'trig_partition_'||parent||'_'||field; execute 'CREATE OR REPLACE FUNCTION '||trig||'() RETURNS TRIGGER AS $BODY2$ declare child text; begin '||script||' ELSE EXECUTE ''SELECT create_partition('''''||tbl||'''''::text, '''''||method||'''''::text, '''''||params||'''''::text , ''''''||NEW.'||field||'||''''''::text)'' INTO child; EXECUTE ''INSERT INTO ''|| child || '' SELECT $1.*'' USING NEW; END IF; RETURN NULL; end; $BODY2$ LANGUAGE ''plpgsql'' VOLATILE;'; execute 'DROP TRIGGER IF EXISTS t_'||trig||' ON "'||parent||'" CASCADE'; execute 'CREATE TRIGGER t_'||trig||' BEFORE INSERT ON "'||parent||'" FOR EACH ROW EXECUTE PROCEDURE '||trig||'();'; return child; end; $BODY$ LANGUAGE 'plpgsql'; CREATE OR REPLACE FUNCTION "partition_date" (in params text, in field varchar, in sample timestamp with time zone) RETURNS text[] AS $BODY$ declare period varchar:= split_part(params, ',', 1); fmt varchar := split_part(params, ',', 2); clock timestamp with time zone := to_timestamp(sample); delta varchar := '1 '||period; suffix varchar; check_beg varchar; check_end varchar; condition varchar; begin -- RAISE EXCEPTION 'period %, fmt %, clock %', period, fmt, clock; check_beg = date_trunc(period, clock); check_end = date_trunc(period, clock + delta::interval); suffix = to_char (clock, fmt); condition = '( ' || field || ' &gt;= ' || quote_literal (check_beg) || ' and ' || field || ' &lt; ' || quote_literal (check_end) || ' )'; return ARRAY[suffix, condition]; end; $BODY$ LANGUAGE 'plpgsql' IMMUTABLE; CREATE OR REPLACE FUNCTION "partition_digits" (in params text, in field varchar, in sample numeric) RETURNS text[] AS $BODY$ declare len int := split_part(params, ',', 1)::int; pref int := split_part(params, ',', 2)::int; norm text := to_char(sample::numeric, 'FM000000000000000000000'); suffix text := regexp_replace(left(norm, -1*(len-pref)), '0*(?=\d{'||pref::text||'})', ''); check_beg varchar; check_end varchar; condition varchar; begin check_beg = (trunc(norm::numeric, -1*(len-pref)))::numeric::text; check_end = (check_beg::numeric+10^(len-pref))::numeric::text; condition = '( ' || field || ' &gt;= ' || check_beg || ' and ' || field || ' &lt; ' || check_end || ' )'; return ARRAY[suffix, condition]; end; $BODY$ LANGUAGE 'plpgsql' IMMUTABLE;</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Tests</b> <div class="spoiler_text">  Sections by date <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">"public"</span></span>.<span class="hljs-string"><span class="hljs-string">"test1"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"public"</span></span>.<span class="hljs-string"><span class="hljs-string">"test1"</span></span> ( <span class="hljs-string"><span class="hljs-string">"id"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">serial</span></span>, <span class="hljs-string"><span class="hljs-string">"cdate"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> <span class="hljs-built_in"><span class="hljs-built_in">time</span></span> zone, <span class="hljs-string"><span class="hljs-string">"text"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">"test11_pkey"</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> OIDS; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INDEX</span></span> test_idx_cdate <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> test1 <span class="hljs-keyword"><span class="hljs-keyword">USING</span></span> btree (cdate); <span class="hljs-comment"><span class="hljs-comment">-- select create_partition('public.test1.cdate', 'date', 'day,YYYY_MM_DD', now()::text); -- select create_partition('public.test1.cdate', 'date', 'week,YYYY_IW', now()::text); select create_partition('public.test1.cdate', 'date', 'month,YYYY_MM', now()::text); -- insert into test1 (cdate, text) SELECT cdate, md5(random()::text) as text FROM generate_series('2012-01-01'::date, now(), '1 day'::interval) cdate;</span></span></code> </pre><br><br>  Sections on a range of numbers: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">DROP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IF</span></span> <span class="hljs-keyword"><span class="hljs-keyword">EXISTS</span></span> <span class="hljs-string"><span class="hljs-string">"public"</span></span>.<span class="hljs-string"><span class="hljs-string">"test2"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CASCADE</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">"public"</span></span>.<span class="hljs-string"><span class="hljs-string">"test2"</span></span> ( <span class="hljs-string"><span class="hljs-string">"id"</span></span> bigserial, <span class="hljs-string"><span class="hljs-string">"text"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">CONSTRAINT</span></span> <span class="hljs-string"><span class="hljs-string">"test2_pkey"</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">WITH</span></span> OIDS; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> create_partition(<span class="hljs-string"><span class="hljs-string">'public.test2.id'</span></span>, <span class="hljs-string"><span class="hljs-string">'digits'</span></span>, <span class="hljs-string"><span class="hljs-string">'10,2'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">int</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> test2 <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>(<span class="hljs-number"><span class="hljs-number">10000000</span></span>, <span class="hljs-string"><span class="hljs-string">'test2'</span></span>); <span class="hljs-comment"><span class="hljs-comment">-- insert into test2 (id, text) SELECT t.id, md5(random()::text) as text FROM generate_series(0, 100000000000, 1000000000) as t(id) limit 200;</span></span></code> </pre><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/152125/">https://habr.com/ru/post/152125/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152117/index.html">Selectel lies again</a></li>
<li><a href="../152118/index.html">Default structures and constructors</a></li>
<li><a href="../152119/index.html">LispyScript - Lisp JavaScript</a></li>
<li><a href="../152122/index.html">Test automation for Android applications</a></li>
<li><a href="../152123/index.html">User queries to the database in MODx Revolution</a></li>
<li><a href="../152126/index.html">Kotlin M3 released</a></li>
<li><a href="../152129/index.html">Dots without a point - for and against</a></li>
<li><a href="../152131/index.html">oDesk for beginners</a></li>
<li><a href="../152132/index.html">New Design SurfPatrol</a></li>
<li><a href="../152135/index.html">Export layouts from Planner 5D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>