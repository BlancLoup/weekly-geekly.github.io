<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The principle of the VRRP protocol</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="FHRP (First Hop Redundancy Protocol) is a family of protocols designed to create a default gateway redundancy. A common idea for these protocols is to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The principle of the VRRP protocol</h1><div class="post__text post__text-html js-mediator-article">  <b>FHRP (First Hop Redundancy Protocol)</b> is a family of protocols designed to create a default gateway redundancy.  A common idea for these protocols is to combine several routers into one virtual router with a common IP address.  This IP address will be assigned to the hosts as the default gateway address.  VRRP (Virtual Router Redundancy Protocol) is a free implementation of this idea.  This article will cover the basics of the VRRP protocol. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sz/zd/2u/szzd2u6mzizcvujixh0a4gcfcek.png" width="50%"></div><a name="habracut"></a><br>  VRRP routers are combined into one virtual router.  All routers in a group have a common virtual IP (VIP) address and a common group number or VRID (Virtual Router Identifier).  One router can be in several groups, each of which must have its own unique VIP / VRID pair. <br><br>  In the case of Cisco, the virtual router is set on the interface of interest to us with the command: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="plaintext hljs">R1(config-if)# vrrp &lt;group-number&gt; ip &lt;ip-address&gt;</code> </pre> <br>  All routers are divided into two types: VRRP Master and VRRP Backup. <br><br>  <b>VRRP Master</b> is a router that handles packets for a given virtual group. <br><br>  <b>VRRP Backup</b> is the router that expects a packet from the Master.  If packets from the master stop coming, Backup tries to go to the Master state. <br><br>  The router becomes the master if it has the highest priority.  The master constantly sends messages to the broadcast address 224.0.0.18 in order to inform Backup routers that it is working.  The master sends messages according to the Adver Timer timer, which is equal to 1 second by default. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ut/sg/6v/utsg6vtqy9gxnhtvafqgkyb-bp8.png"></div><br>  In this case, the group MAC address of the sender is 00: 00: 5E: 00: 01: xx, where xx is the VRID in hexadecimal format.  In this example, the first group is used. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/qm/u5/ft/qmu5ft8lqoritvw_l35f9k9vsge.png"></div><br>  If Backup routers do not receive messages within three Adver Timer (Master Down Timer), then the new Master becomes the router with the highest priority, or the router with the highest IP.  At the same time, a Backup router with a higher priority will intercept the Master role with a lower priority.  However, when preempt is disabled in Backup, Backup will not intercept the role of the Master. <br><br><pre> <code class="plaintext hljs">R1(config-if)# no vrrp &lt;group-number&gt; preempt</code> </pre> <br>  If the VRRP router owns the VIP address, then it always intercepts the Master role. <br><br>  VRRP priority is specified in values ‚Äã‚Äãfrom 1 to 254. A value of 0 is reserved for cases where the Master needs <i>to</i> disclaim responsibility for routing.  The value 255 is set by the VIP owner router.  The default priority is 100, but can be set administratively: <br><br><pre> <code class="plaintext hljs">R1(config-if)#vrrp &lt;group-number&gt; priority &lt;priority 1-254&gt;</code> </pre> <br>  Here we can see the priority of the router when it is set administratively: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fl/rh/wa/flrhwae7lljtqonb6gu2tys7biw.png"></div><br>  And here is the case when the router is the owner of the VIP: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/yi/ih/pq/yiihpqi0fm9e8vhfq8jvxfiat5i.png"></div><br>  VRRP router can have three states: Initialize, Backup, Master.  These states of the router sequential changes. <br><br>  In the Initialize state, the router is waiting to start working.  If this router is the owner of the VIP address (priority is 255), then the router sends messages that it becomes the Master.  It also sends a <a href="https://en.wikipedia.org/wiki/Address_Resolution_Protocol">gratuitous ARP request</a> in which the source MAC address is equal to the address of the virtual router.  Then it goes to the Master state.  If the router is not the VIP owner, then it enters the Backup state. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/x0/00/zj/x000zjajnzimlqk9mbk5blegjfi.png"></div><br>  In the Backup state, the router waits for packets from the master.  The router in this state does not respond to ARP requests from the VIP address.  It also does not accept packets that have the virtual router MAC address as the destination address. <br><br>  If Backup does not receive messages from Master during Master Down Timer, then it sends a message to VRRP that it is going to become Master.  It then sends a VRRP broadcast message in which the source MAC address is equal to the address of this virtual router.  In this message, the router indicates its priority. <br><br>  In the Master state, the router processes packets addressed to the virtual router.  He also responds to ARP requests for VIP.  The master sends out VRRP messages every Adver Timer to confirm that it is working. <br><br><pre> <code class="plaintext hljs">*May 13 19:52:18.531: %VRRP-6-STATECHANGE: Et1/0 Grp 1 state Init -&gt; Backup *May 13 19:52:21.751: %VRRP-6-STATECHANGE: Et1/0 Grp 1 state Backup -&gt; Master</code> </pre> <br>  VRRP also allows load balancing between multiple routers.  To do this, two VRRP groups are created on one interface.  One group is assigned a higher priority than the other.  At the same time, the priority on the second router is set in the opposite way.  Those.  if on one router the priority of the first group is 100, and that of the second group is 200, then on the other router the priority of the first group will be 200 and the second 100. <br><br>  As stated earlier, each group must have its own unique VIP.  As a result, we get two ip addresses serviced by two routers, each of which can serve as a default gateway. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ip/np/2-/ipnp2-gzm3uqbct5eglgwkqgwui.png"></div><br>  Half of the computers are assigned one default gateway address, half the other.  Thus, half of the traffic will go through one router, and half through the other.  When one of the routers fails, the second intercepts the work of both VIPs. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ej/8l/m9/ej8lm9a_xlwhqnqw-zkh6ldpms8.png"></div><br>  Thus, VRRP allows you to organize the fault tolerance of the default gateway, increasing the reliability of the network.  And in the case of using multiple virtual routers, you can also balance the load between real routers.  The rate of reaction to a failure can be reduced by reducing the timers. </div><p>Source: <a href="https://habr.com/ru/post/452490/">https://habr.com/ru/post/452490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45248/index.html">ReadyBoost - high-speed cache</a></li>
<li><a href="../452480/index.html">Phoenix LiveView: when you no longer need javascript *</a></li>
<li><a href="../452486/index.html">Consensus is a lie</a></li>
<li><a href="../452488/index.html">About Habr</a></li>
<li><a href="../45249/index.html">What to subscribe to?</a></li>
<li><a href="../452492/index.html">We disassemble the snake</a></li>
<li><a href="../452494/index.html">MIMO spatial diversity: Alamouti, DET and other spatial diversity</a></li>
<li><a href="../452496/index.html">What else can you hear on the radio? Broadcasting on HF (DXing)</a></li>
<li><a href="../4525/index.html">Soundkey is open and tested on the "Rambler"</a></li>
<li><a href="../45250/index.html">Using different images on each monitor in Vista or XP</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>