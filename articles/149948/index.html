<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We translate Chrome extension to manifest_version 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The owners of extensions (as well as applications) for Chrome should have thought about supporting the second version of the manifest. 
 If someone do...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We translate Chrome extension to manifest_version 2</h1><div class="post__text post__text-html js-mediator-article">  The owners of extensions (as well as applications) for Chrome should have thought about supporting the second version of the manifest. <br>  If someone does not know, not so long ago new changes and innovations were announced in the development of browser extensions. <br>  Next will be a selective translation of <a href="http://developer.chrome.com/extensions/manifestVersion.html">two</a> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">pages</a> and my way of using the template engine from within the sandbox. <br><a name="habracut"></a><br><br><h4>  First, a little about <a href="http://developer.chrome.com/extensions/manifestVersion.html">Google</a> 's <a href="http://developer.chrome.com/extensions/manifestVersion.html">plans</a> to support the old extensions </h4><br>  <i>* Next, the old extensions will be called extensions and applications with version 1 of the manifest (or no version at all).</i> <br><br><ul><li>  Starting from <b>Chrome 21, the</b> creation of new extensions with the first version of the manifest is blocked, but updates to existing extensions to the old version of the manifest are allowed. </li><li>  With the release of <b>Chrome 23 (beginning of November)</b> , an update on extensions with old versions of the manifest will be blocked at the <a href="https://chrome.google.com/webstore">Web Store</a> .  Chrome will stop packing the old extensions and download unpacked for development. </li><li>  <b>First quarter of 2013</b> - old extensions will no longer be found in the Web Store.  Developers will be notified by email. </li><li>  <b>Second quarter of 2013</b> - all old extensions will be removed from the Web Store, and another notification will be sent to the developers.  But Chrome will load and launch the installed extensions with the manifest version 1 for now. </li><li>  <b>Third quarter of 2013</b> - Chrome will stop downloading and running old extensions. </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Differences between versions 1 and 2 </h4><br><br><ul><li> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">The content security policy is</a> set to <code>`script-src 'self'; object-src 'self'</code> by default <code>`script-src 'self'; object-src 'self'</code>  <code>`script-src 'self'; object-src 'self'</code> .  This is essentially the most important update.  About him a little later. </li><li>  All extension resources are no longer accessible via the <code>chrome-extension://[PACKAGE ID]/[PATH]</code> URL <code>chrome-extension://[PACKAGE ID]/[PATH]</code> .  Those.  You can not connect a script or image from an extension from other pages except the extension itself.  But to get around this drawback, the <a href="http://developer.chrome.com/extensions/manifest.html"><code>web_accessible_resources</code></a> property <a href="http://developer.chrome.com/extensions/manifest.html"><code>web_accessible_resources</code></a> , in which you can specify an array with the paths to the necessary resources. </li><li>  Instead of the <code>background_page</code> property (which was a string), we now write <a href="http://developer.chrome.com/extensions/background_pages.html"><code>background</code></a> , which should contain an object with the <code>scripts</code> or <code>page</code> property. </li><li>  Changes in browser actions: <br><ul><li>  The <code>browser_actions</code> field has <code>browser_actions</code> replaced with <code>browser_action</code> , and the <code>chrome.browserActions</code> API has been <code>chrome.browserActions</code> with <code>chrome.browserAction</code> . </li><li>  Removed the <code>icons</code> property from <code>browser_action</code> .  Instead, use <code>default_icon</code> or <code>chrome.browserAction.setIcon</code> . </li><li>  Removed <code>name</code> property from <code>browser_action</code> .  Instead, use <code>default_title</code> or <code>chrome.browserAction.setTitle</code> . </li><li>  Removed <code>popup</code> property from <code>browser_action</code> .  Instead, use <code>default_popup</code> or <code>chrome.browserAction.setPopup</code> . </li><li>  the <code>default_popup</code> property in <code>browser_action</code> should be a string, not an object </li></ul><br></li><li>  Changes to page actions: <br><ul><li>  the <code>page_actions</code> field <code>page_actions</code> replaced by <code>page_action</code> , and the <code>chrome.pageActions</code> API is <code>chrome.pageActions</code> by <code>chrome.pageAction</code> . </li><li>  removed property <code>icons</code> from <code>page_action</code> .  Instead, use <code>default_icon</code> or <code>chrome.pageAction.setIcon</code> . </li><li>  Removed the <code>name</code> property from <code>page_action</code> .  Instead, use <code>default_title</code> or <code>chrome.pageAction.setTitle</code> . </li><li>  Removed <code>popup</code> property from <code>page_action</code> .  Instead, use <code>default_popup</code> or <code>chrome.pageAction.setPopup</code> . </li><li>  The <code>default_popup</code> property in <code>page_action</code> should be a string, not an object. </li><li>  Removed <code>chrome.self</code> from the API, now you need to use <code>chrome.extension</code> . </li></ul><br></li><li>  No more <code>chrome.extension.getTabContentses</code> and <code>chrome.extension.getExtensionTabs</code> .  Instead, you need to use <a href="http://developer.chrome.com/extensions/extension.html"><code>chrome.extension.getViews({ "type": "tab" })</code></a> . <br></li><li>  Instead of <code>Port.tab</code> use <code>Port.sender</code> . </li></ul><br><br><h4>  <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">Content Security Policy</a> (CSP) </h4><br><br>  For extensions to be less prone to XSS vulnerabilities, common CSP principles were introduced.  In general, the CSP is a mechanism for the white and black lists regarding resources that are loaded and executed by the extension.  With CSP, you can set only the necessary permissions for the extension and thus increase its security. <br>  This policy is an additional level of protection over rights to access resources ( <a href="http://developer.chrome.com/extensions/manifest.html">host permissions</a> ) <br><br>  You can set the security policy in the string parameter <code>content_security_policy</code> in <code>manifest.json</code> . <br>  If the manifest version is not installed ( <code>manifest_version</code> ), then by default there is no content security policy.  But for the second version of the manifest, it is installed by default with the value <code>script-src 'self'; object-src 'self'</code>  <code>script-src 'self'; object-src 'self'</code> .  Therefore, there are some limitations.  For example, the <code>eval</code> function will fail.  Also, inline <code><code><code>     ().      -         setTimeout  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code></code> will not be executed <code><code><code>     ().      -         setTimeout  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code></code> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <h4> <code><code><a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html"><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br>     <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( </a><a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </h4> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <h4> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </h4> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <h5> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </h5> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <ol><li> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> template-renderer.html <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></b></code></code> <div class="spoiler_text"> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre></div></div> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </li><li> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </li><li> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> function getTemplate <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></b></code></code> <div class="spoiler_text"> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre></div></div> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> </li><li> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre></li></ol> <code><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></code></code> <div class="spoiler"> <code><code><b class="spoiler_title"><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., "content_security_policy": "script-src 'self' https://example.com; object-src 'self'", ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset="utf-8"&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src="/js/libs/underscore/underscore-min.js"&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener('message', function (event) { var template; if (typeof templates[event.data.templateName] == 'undefined') { template = _.template(event.data.template); templates[event.data.templateName] = template; } else { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., "sandbox": { "pages": ["sandboxed/template-renderer.html"] }, ... }</code> <br>            <br> <b class="spoiler_title">function getTemplate</b> <code class="javascript">var getTemplate = (function(){ var iframe = document.createElement('iframe'), callbacks = []; iframe.src = 'sandboxed/template-renderer.html'; iframe.style.display = 'none'; document.body.appendChild(iframe); window.addEventListener('message', function (event) { callbacks.forEach(function (item, idx) { if (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); return function (templateName, template) { return function (context, callback) { var id = Math.random(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, '*'); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate('templateId', templateContent); //   -     template({text: 'Hello world'}, function (html) { //  html   //    $('body').html    , //        $('body').html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> manifest.json <code class="javascript">{ "name": "Twittext", "description": "A lightweight Google Chrome extension for Twitter", "background": { "page": "background.html" }, "manifest_version": 2, "browser_action": { "default_icon": "img/icon_19.png", "default_title": "Twittext", "default_popup": "popup.html" }, "icons": { "128": "img/icon_128.png", "19": "img/icon_19.png", "48": "img/icon_48.png" }, "options_page": "options.html", "version": "1.6.1", "permissions": [ "tabs", "background", "https://api.twitter.com/", "https://userstream.twitter.com/" ], "sandbox": { "pages": ["sandboxed/template-renderer.html"] } }</code></b></code></code> <div class="spoiler_text"> <pre> <code class="hljs lua"><code><code>     ().      -         setTimeout</code>  <code>setInterval</code> ,     . <br>   ,     ( CDN, ),   . <br> <br> <a href="http://developer.chrome.com/extensions/contentSecurityPolicy.html">   </a> <br> <br>          .       (,   https).       <code>content_security_policy</code> ,  : <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"content_security_policy"</span></span>: <span class="hljs-string"><span class="hljs-string">"script-src 'self' https://example.com; object-src 'self'"</span></span>, ... }</code> <br> <br> ‚Äú      eval?‚Äù  ‚Äú  ?‚Äù <br> <br>     -   eval?         (, <code>new Function()</code>   ).     ( <a href="http://developer.chrome.com/extensions/manifest.html">sandbox</a> ). <br>    ,       (, eval)      (    CSP  ). <br>             <code>postMessage()</code> . <br> <br>      <a href="http://underscorejs.org/">underscore </a> <br>   <code>sandboxed/template-renderer.html</code>     <br> <b class="spoiler_title">template-renderer.html</b> <code class="html">&lt;!DOCTYPE html&gt; &lt;html&gt; &lt;head&gt; &lt;meta charset=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>&gt; &lt;title&gt;Sandboxed Template Renderer&lt;/title&gt; &lt;script src=<span class="hljs-string"><span class="hljs-string">"/js/libs/underscore/underscore-min.js"</span></span>&gt;&lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;script&gt; var templates = {}; window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { var template; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (typeof templates[event.data.templateName] == <span class="hljs-string"><span class="hljs-string">'undefined'</span></span>) { template = _.template(event.data.template); templates[event.data.templateName] = template; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { template = templates[event.data.templateName]; } event.source.postMessage({ id: event.data.id, result: template(event.data.context) }, event.origin); }); &lt;/script&gt; &lt;/html&gt;</code> <br>     html   <br> <code>{ ..., <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] }, ... }</code> <br>            <br> <b class="spoiler_title"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span></span></b><span class="hljs-function"><span class="hljs-function"> </span></span><code class="javascript"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">var</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemplate</span></span></span><span class="hljs-function"> = </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(function()</span></span></span></span>{ var iframe = document.createElement(<span class="hljs-string"><span class="hljs-string">'iframe'</span></span>), callbacks = []; iframe.src = <span class="hljs-string"><span class="hljs-string">'sandboxed/template-renderer.html'</span></span>; iframe.style.display = <span class="hljs-string"><span class="hljs-string">'none'</span></span>; document.body.appendChild(iframe); window.addEventListener(<span class="hljs-string"><span class="hljs-string">'message'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(event)</span></span></span></span> { callbacks.forEach(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(item, idx)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (item &amp;&amp; item.id == event.data.id) { item.callback(event.data.result); delete callbacks[idx]; } }); }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(templateName, template)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(context, callback)</span></span></span></span> { var id = Math.<span class="hljs-built_in"><span class="hljs-built_in">random</span></span>(); callbacks.push({ id: id, callback: callback }); iframe.contentWindow.postMessage({ id: id, templateName: templateName, template: template, context: context }, <span class="hljs-string"><span class="hljs-string">'*'</span></span>); }; }; }());</code> <br>     <br> <code class="javascript">//  ,         var template = getTemplate(<span class="hljs-string"><span class="hljs-string">'templateId'</span></span>, templateContent); //   -     template({text: <span class="hljs-string"><span class="hljs-string">'Hello world'</span></span>}, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(html)</span></span></span></span> { //  html   //    $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html    , //        $(<span class="hljs-string"><span class="hljs-string">'body'</span></span>).html(html); });</code> <br>   -     .       ().      . <br> <br>   ,  <code>manifest.json</code> : <br> <b class="spoiler_title">manifest.json</b> <code class="javascript">{ <span class="hljs-string"><span class="hljs-string">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"description"</span></span>: <span class="hljs-string"><span class="hljs-string">"A lightweight Google Chrome extension for Twitter"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>: { <span class="hljs-string"><span class="hljs-string">"page"</span></span>: <span class="hljs-string"><span class="hljs-string">"background.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"manifest_version"</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"browser_action"</span></span>: { <span class="hljs-string"><span class="hljs-string">"default_icon"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_title"</span></span>: <span class="hljs-string"><span class="hljs-string">"Twittext"</span></span>, <span class="hljs-string"><span class="hljs-string">"default_popup"</span></span>: <span class="hljs-string"><span class="hljs-string">"popup.html"</span></span> }, <span class="hljs-string"><span class="hljs-string">"icons"</span></span>: { <span class="hljs-string"><span class="hljs-string">"128"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_128.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"19"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_19.png"</span></span>, <span class="hljs-string"><span class="hljs-string">"48"</span></span>: <span class="hljs-string"><span class="hljs-string">"img/icon_48.png"</span></span> }, <span class="hljs-string"><span class="hljs-string">"options_page"</span></span>: <span class="hljs-string"><span class="hljs-string">"options.html"</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.6.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"permissions"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"tabs"</span></span>, <span class="hljs-string"><span class="hljs-string">"background"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://api.twitter.com/"</span></span>, <span class="hljs-string"><span class="hljs-string">"https://userstream.twitter.com/"</span></span> ], <span class="hljs-string"><span class="hljs-string">"sandbox"</span></span>: { <span class="hljs-string"><span class="hljs-string">"pages"</span></span>: [<span class="hljs-string"><span class="hljs-string">"sandboxed/template-renderer.html"</span></span>] } }</code></code></code> </pre></div></div></div><p>Source: <a href="https://habr.com/ru/post/149948/">https://habr.com/ru/post/149948/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149941/index.html">Registration is open on Windows Upgrade Offer</a></li>
<li><a href="../149942/index.html">Amazon Glacier: data storage of $ 0.01 for 1 GB per month</a></li>
<li><a href="../149943/index.html">Windows Phone will be ahead of BlackBerry by November 2012</a></li>
<li><a href="../149946/index.html">Two stories about communication with one of the leading Russian telecoms</a></li>
<li><a href="../149947/index.html">‚ÄúFree Time Wars‚Äù or BF2 server + office statistics</a></li>
<li><a href="../149951/index.html">Amazon announced cheap backup storage</a></li>
<li><a href="../149952/index.html">Bitinstant is going to issue a Bitcoin payment card</a></li>
<li><a href="../149955/index.html">ATP "Pravo.ru" for Android - as it were</a></li>
<li><a href="../149956/index.html">Oracle shell call</a></li>
<li><a href="../149958/index.html">AppCode 1.6: what's new?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>