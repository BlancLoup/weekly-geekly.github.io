<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bitcoin in a nutshell - Mining</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Even people infinitely distant from the topic of cryptocurrency, most likely heard about mining. Probably you, dear reader, thought about switching on...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bitcoin in a nutshell - Mining</h1><div class="post__text post__text-html js-mediator-article"><p>  Even people infinitely distant from the topic of cryptocurrency, most likely heard about mining.  Probably you, dear reader, thought about switching on your gaming Pentium 4 at night, and in the morning wake up already rich. </p><br><p>  But, as it often happens in the blockchain world, there are a lot of those who have heard, but only those who really understand the process from beginning to end.  Therefore, in the last chapter, I tried to cover all the details in as much detail as possible, starting from the technical implementation of PoW, ending with the profitability of mining on video cards. </p><br><p><img src="http://i0.wp.com/bitcoinpricelive.com/wp-content/uploads/2014/09/3.png" alt="mining_meme"></p><a name="habracut"></a><br><h2 id="book">  Book </h2><br><ul><li>  <a href="https://habrahabr.ru/post/319868/">Bitcoin in a nutshell - Cryptography</a> </li><li>  <a href="https://habrahabr.ru/post/319860/">Bitcoin in a nutshell - Transaction</a> </li><li>  <a href="https://habrahabr.ru/post/319862/">Bitcoin in a nutshell - Protocol</a> </li><li>  <a href="https://habrahabr.ru/post/320176/">Bitcoin in a nutshell - Blockchain</a> </li><li>  Bitcoin in a nutshell - Mining </li></ul><br><h2 id="table-of-content">  Table of content </h2><br><ol><li>  Explain me like I'm five </li><li>  Sky is the limit? </li><li>  Reward </li><li>  Hard challenge </li><li>  Technical side </li><li>  2 Blocks 1 Chain </li><li>  Hardware </li><li>  Conclusion </li><li>  Links </li></ol><br><h2 id="explain-me-like-im-five">  Explain me like I'm five </h2><br><blockquote>  <strong>Mining</strong> , as well as <strong>mining</strong> (from <a href="https://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BD%25D0%25B3%25D0%25BB%25D0%25B8%25D0%25B9%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D1%258F%25D0%25B7%25D1%258B%25D0%25BA">English</a> <em>mining</em> - mining) is the activity of maintaining a distributed platform and creating new blocks with the opportunity to receive remuneration in the form of emitted currency and commission fees in various <a href="https://ru.wikipedia.org/wiki/%25D0%259A%25D1%2580%25D0%25B8%25D0%25BF%25D1%2582%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BB%25D1%258E%25D1%2582%25D0%25B0">cryptocurrencies</a> , particularly in <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25B8%25D1%2582%25D0%25BA%25D0%25BE%25D0%25B9%25D0%25BD">Bitcoin</a> .  Computations are required to ensure protection against the re-use of the same currency units, and the link between mining and emissions encourages people to spend their computing power and support network operation - <a href="https://ru.wikipedia.org/wiki/%25D0%259C%25D0%25B0%25D0%25B9%25D0%25BD%25D0%25B8%25D0%25BD%25D0%25B3">Wikipedia</a> </blockquote><p>  If on the fingers, then mining is a critical process for Bitcoin, consisting in the creation of new blocks and pursuing two goals at once.  The first is the production of money supply.  Each time a miner creates a new block, he is rewarded with an award for the Nth number of coins, which he then spends somewhere, thus launching new funds into the network. </p><br><p>  The second and much more important goal is to ensure the operation of the entire network.  Surely, reading the previous articles, you already asked yourself the questions <strong>"Who is the person who checks the transaction scripts?"</strong>  or <strong>"If, as the input, I indicate the output already used, at what point will it be noticed?"</strong>  . </p><br><p>  So, all these actions are performed first of all by the miners.  Well, in fact, each member of the network to one degree or another ensures its security.  To synchronize Bitcoin for so long not because you have to download 100 GB, but because you need to check every byte, count every hash, run every script, and so on. </p><br><p>  But if you draw the whole process, starting from pressing the <em>"Send"</em> button in your wallet and ending with viewing the block with your transaction somewhere on <a href="http://blockchain.info/">blockchain.info</a> , then the miners will decide whether your transaction will be in the block or not. </p><br><h2 id="sky-is-the-limit">  Sky is the limit? </h2><br><p><img src="https://media.giphy.com/media/LEA3o7aT31A8U/giphy.gif" alt="nope"></p><br><p>  To begin with, let‚Äôs go through the first point again and discuss the concept of the money supply. </p><br><p>  One of the fundamental pieces that cryptocurrency supporters often flaunt is <a href="https://ru.bitcoin.it/wiki/%25D0%259E%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BD%25D0%25B8%25D1%2587%25D0%25B5%25D0%25BD%25D0%25BD%25D0%25B0%25D1%258F_%25D1%258D%25D0%25BC%25D0%25B8%25D1%2581%25D1%2581%25D0%25B8%25D1%258F">deflation that was originally pledged</a> .  This is due to the fact that even at the design stage of the system, a total limit of 21 million coins (approximately) was indicated, and even if you really want to, you will not be able to raise this threshold.  Unlike the ruble or the dollar, which at the request of the treasury can be printed in any quantity, which sometimes leads to dire consequences, as in <a href="https://goldenfront.ru/articles/view/giperinflyaciya-v-zimbabve-kartinki-grafiki-i-hronologiya/">Zimbabwe</a> . </p><br><p>  <strong>BTW,</strong> not everyone thinks deflation is such a <a href="https://bits.media/news/ekonomist-robert-merfi-obyasnyaet-pochemu-deflyatsiya-ne-problema-dlya-bitkoina/">definite plus</a> . </p><br><h2 id="reward">  Reward </h2><br><p>  The next good question is where did the figure of 21 million come from? </p><br><p>  I think you understand that the <strong>amount of coins issued at a particular point in time is equal to the amount of rewards for the blocks created by that moment</strong> .  Quite an obvious fact, given that there is only one way in which new coins fall into the network. </p><br><p>  But the remuneration is not fixed, and moreover, every 210,000 units (about once every 4 years), it is halved. </p><br><pre><code class="hljs ruby">consensus.nSubsidyHalvingInterval = <span class="hljs-number"><span class="hljs-number">210000</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> <span class="hljs-symbol"><span class="hljs-symbol">https:</span></span>/<span class="hljs-regexp"><span class="hljs-regexp">/github.com/bitcoin</span></span><span class="hljs-regexp"><span class="hljs-regexp">/bitcoin/blob</span></span><span class="hljs-regexp"><span class="hljs-regexp">/master/src</span></span><span class="hljs-regexp"><span class="hljs-regexp">/chainparams.cpp#L73</span></span></code> </pre> <br><p>  So, for example, when it all started in January 2009, the unit reward was 50 BTC.  After 210,000 units, in November 2012 it fell to 25 BTC, and more recently, on July 9, 2016, it <a href="http://www.coindesk.com/bitcoin-halving-2016-what-to-expect-traders-miners/">dropped to 12.5 BTC</a> . </p><br><p>  It is easy to calculate the exact number of Satoshi to be produced, assuming that Bitcoin does not stall in the next 200 years: </p><br><pre> <code class="python hljs">start_block_reward = <span class="hljs-number"><span class="hljs-number">50</span></span> reward_interval = <span class="hljs-number"><span class="hljs-number">210000</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max_money</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-comment"><span class="hljs-comment"># 50 BTC = 50 0000 0000 Satoshis current_reward = 50 * 10**8 total = 0 while current_reward &gt; 0: total += reward_interval * current_reward current_reward /= 2 return total print "Total BTC to ever be created:", max_money(), "Satoshis" # Total BTC to ever be created: 2099999997690000 Satoshis</span></span></code> </pre> <br><p>  The picture below shows the production curve, which will be more and more smoothly approaching the mark of 21 million BTC, reaching a peak around 2140.  At this time, the block reward will be 0 BTC. </p><br><p><img src="http://orm-chimera-prod.s3.amazonaws.com/1234000001802/images/msbt_0801.png" alt="btc_curve"></p><br><p>  One can only guess what will happen with Bitcoin, but one thing we can know for sure is that the miners will not be left without money at all.  At least they still have a <em>transaction fee</em> , another thing is that this commission can increase by an order of magnitude. </p><br><p>  Take for clarity any fresh block, for example <a href="https://blockr.io/block/info/447119"># 447119</a> .  The amount of commissions from all transactions in the block is approximately 0.78 BTC, while the reward for it is 12.5 BTC.  That is, if tomorrow the <em>reward</em> disappears, then in our case the commission should increase by more than 16 times in order to level this unpleasant event.  It is clear that no micropayments here already and does not smell. </p><br><h2 id="mining-for-dummies">  Mining for dummies </h2><br><p>  Let's try again to present the process of mining at our, so far primitive level. </p><br><blockquote>  There is a network with a bunch of participants.  Some of the participants call themselves <em>miners</em> - they are ready to collect new transactions on their PC, check them for validity, then somehow <em>mine the</em> new unit from them, scatter this unit over the network and get money for it.  The logical question is - if everything is so simple, then why isn't every member of the network doing this? </blockquote><p>  It is clear that if everything would be as I described it now, then the blocks would go out a hundred times a second, there would be so much currency that no one would give a cent for it, and so on. </p><br><p>  Therefore, Satoshi was forced to come up with an algorithm with the following properties: </p><br><ul><li>  Creating a new unit is a computationally difficult task.  You can‚Äôt just turn on a powerful PC and take a hundred blocks in a minute. </li><li>  On the calculation of the new unit, the entire network takes 10 minutes (on average).  If you look at Litecoin, then there the blocks come out every 2-3 minutes, the point is precisely that the average time is set in advance. </li><li>  Moreover, this time does not depend on the number of network participants.  Even if one day the miners become a hundred times more, the algorithm should change its parameters in such a way that the block becomes more difficult to find, and the <em>block time</em> drops back to the neighborhood of ten minutes. </li><li>  Remember that the network is distributed and peer-to-peer, which means that it must itself understand at what point and how to tweak these parameters.  No control nodes, everything is completely autonomous. </li><li>  If the solution to the task of creating a new block is a complex task that requires time and resources, then checking the block for "correctness" should be simple and almost instantaneous. </li></ul><br><h2 id="proof-of-work-pow">  Proof-of-Work (PoW) </h2><br><p>  Most likely you are now arriving in complete prostration and do not really understand how this is even possible.  But Satoshi did not lose his head and was able to come up with a solution for all these problems - the algorithm was called <em>Proof-of-Work</em> , that's what it looks like (I advise you first to read <a href="https://habrahabr.ru/post/320176/">Bitcoin in a nutshell - Blockchain</a> ): </p><br><blockquote>  Let you - the miner.  You have 10 transactions that you want to merge into a block.  You check these transactions for validity, form a block out of them, indicate 0 in the <em>nonce</em> field and count the hash of the block.  Then change the <em>nonce</em> to 1, again consider the hash.  And so on to infinity. <br><br>  Your task is to find a <em>nonce</em> in which the hash of the block (256 bit number) is less than a predetermined number N. The search for such a hash is possible only with a blunt search of nonce, there are no beautiful algorithms here.  Therefore, the faster you want to find a <em>nonce</em> , the more power you will need. <br><br>  The number N is the parameter (it is also called the <em>target</em> ) that the network adjusts depending on the total power of the miner.  If tomorrow blocks start to go out, conditionally speaking, once every three minutes, then N will somehow be reduced, the time required to search for <em>nonce</em> will take more and the <em>block time</em> will again grow to 10 minutes.  And vice versa. </blockquote><br><h2 id="technical-side">  Technical side </h2><br><p><img src="https://habrastorage.org/files/e29/987/da4/e29987da479d4a44b6dbc6256ccf1059.gif" alt="General view of the algorithm"></p><br><p>  It's time to move from words to deeds and demonstrate how <em>Proof-of-Work</em> and mining work as a whole.  And in my humble opinion, there is nothing better than to show the whole process at all right in combat conditions.  To do this, we will immediately write our mining node and even try to make a new block before anyone else, although the chances of success are slim. </p><br><h3 id="receive-transactions">  Receive transactions </h3><br><p>  In an amicable way, you need to dive into the protocol specification again, establish contact with other nodes and wait for fresh transactions to be sent to us.  In this case, we will have a real real-time miner, no worse than ready-made solutions (but this is not certain). </p><br><p>  I suggest to go in a simplified way.  Open <a href="https://blockchain.info/">blockchain.info</a> and select several transactions from the <em>"Recent Transactions"</em> list.  They just got into the network and so far do not belong to any of the blocks.  Next, open another block explorer - <a href="https://chainquery.com/bitcoin-api/getrawtransaction">chainquery.com</a> .  He is able to issue transactions in the raw format and using hashes we get transactions in the form already familiar to us.  I limited myself to two ( <a href="https://chainquery.com/bitcoin-api/getrawtransaction/f668235014f496e7d486ca7139cc4607718be4188905fd2690391e7849d28031/0">one</a> , <a href="https://chainquery.com/bitcoin-api/getrawtransaction/2c12ee46942aaae36d47e0801638ff5375fea5a50b308cdeb444100c1e2b9182/0">two</a> ): </p><br><pre> <code class="python hljs">txn_pool = [] txn_pool.append(<span class="hljs-string"><span class="hljs-string">"0100000001440d795fa6267cbae00ae18e921a7b287eaa37d7f41b96ccbc61ef9a323a003d010000006a47304402204137ef9ca79bcd8a953c0def89578838bbe882fe7814d6a7144eaa25ed156f66022043a4ab91a7ee3bf58155d08e5f3f221a783f645daf9ac54fed519e18ca434aea012102965a03e05b2e2983c031b870c9f4afef1141bf30dc5bb993197ee4a52f1443e0feffffff0200a3e111000000001976a914f1cfa585d096ea3c759940d7bacd8c7259bbd4d488ac4e513208000000001976a9146701f2540186d4135eec14dad6cb25bf757fc43088accbd50600"</span></span>) txn_pool.append(<span class="hljs-string"><span class="hljs-string">"0100000001517063b3d932693635999b8daaed9ebf020c66c43abf504f3043850bca5a936d010000006a47304402207473cda71b68a414a53e01dc340615958d0d79dd67196c4193a0ebcf0d9f70530220387934e7317b60297f5c6e0ca4bf527faaad830aff45f1f5522e842595939e460121031d53a2c228aedcde79b6ccd2e8f5bcfb56e2046b4681c4ea2173e3c3d7ffc686ffffffff0220bcbe00000000001976a9148cc3704cbb6af566598fea13a3352b46f859581188acba2cfb09000000001976a914b59b9df3700adae0ea819738c89db3c2af4e47d188ac00000000"</span></span>)</code> </pre> <br><h3 id="check">  Check </h3><br><p>  The next step is to check the received transactions.  I will not do this, just list the main points: </p><br><ul><li>  Correctly followed the structure and syntax of the transaction </li><li>  I / O list cannot be empty </li><li>  Entry transactions must exist either in the UTXO pool or in a pool of unconfirmed transactions </li><li>  The sum of inputs is not less than the sum of outputs </li><li>  Full list can be found <a href="http://chimera.labs.oreilly.com/books/1234000001802/ch08.html">here.</a> </li></ul><br><p>  Some miners reject transactions with a zero or too small commission, but this everyone decides for himself. </p><br><h3 id="sort">  Sort </h3><br><p>  Just in case, I will explain that <a href="http://bitcoin.stackexchange.com/questions/50710/is-it-ok-not-to-sort-transactions-at-all">nothing prevents you from</a> including transactions in the block in any order, as long as they pass all the checks.  In my case there are only two transactions, so there is no point in sorting them all the more.  But do not forget that the block size is limited to 1 MB, so if you have 10,000 transactions in the pool, it will be wise to sort them out by commission and write only the most expensive ones to the block. </p><br><p>  <strong>BTW</strong> Often come across articles / books that say that before mining a new block, Bitcoin Core sorts transactions by the special parameter <em>priority</em> , which is counted as </p><br><pre> <code class="hljs pgsql">Priority = Sum (<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> <span class="hljs-keyword"><span class="hljs-keyword">input</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span> Age) / <span class="hljs-keyword"><span class="hljs-keyword">Transaction</span></span> Size</code> </pre> <br><p>  This was true up to version 0.12.0, then the sorting by <em>priority was</em> <a href="">turned off</a> . </p><br><h3 id="get-reward">  Get reward </h3><br><p><img src="http://static.righto.com/images/bitcoin/block_diagram_ghash.png" alt="block"></p><br><p>  If you look at the structure of any block, then the very first <em>coinbase</em> transaction always goes - it sends the reward to the address of the miner.  Unlike regular transactions, <em>coinbase transaction</em> does not waste exits from the <em>UTXO pool</em> as inputs.  Instead, it has only one entry, called <em>coinbase</em> , which "creates" coins from nothing.  There is only one way out of such a transaction.  He sends to the miner's address a reward for the block plus the amount of commissions from all transactions in the block.  In my case, this is <code>12.5 + 0.00018939 + 0.0001469 = 12.50033629</code> . </p><br><p>  Let's take a closer look at the <em>coinbase</em> structure of the transaction, and more specifically, its input.  Just in case, let me remind you what the input for a ‚Äúnormal‚Äù transaction looks like: </p><br><p><img src="https://habrastorage.org/files/2c0/b50/412/2c0b50412ee5427c92b150bc9e9a5dd4.png"></p><br><p>  Here are three differences in the <em>coinbase</em> transaction entry: </p><br><ul><li>  Instead of the present <em>transaction hash</em> , 32 bytes are specified. </li><li>  Instead of <em>output index</em> , <code>0xFFFFFFFF</code> specified. </li><li>  In the <em>unlocking script</em> field, you can specify anything from 2 to 100 bytes in size, therefore this field is also called <em>coinbase data</em> .  For example, in the <em>genesis block</em> there is hidden the phrase <code>"The Times 03/Jan/2009 Chancellor on brink of second bailout for banks"</code> .  As a rule, miners insert their name / mining pool name / something else into <em>coinbase data</em> . </li></ul><br><p>  Often the so-called <em>extra nonce is</em> inserted into <em>coinbase data</em> , more details <a href="http://chimera.labs.oreilly.com/books/1234000001802/ch08.html">here</a> .  The bottom line is that the desired <em>nonce</em> may not be found, in which the hash of the block is less than the <em>target</em> (in fact, this will happen in most cases).  Then it remains to change something in the transaction to get other hashes, for example - <em>UNIX timestamp</em> .  But if you read <a href="https://habrahabr.ru/post/320176/">Bitcoin in a nutshell - Blockchain</a> , then you know that the timestamp won't change much either, otherwise the other nodes will reject your block.  The solution turned out to be quite simple: it is enough to add any number to the <em>coinbase data</em> and change it if the required <em>nonce</em> was not found for the current <em>header</em> . </p><br><p>  The process of creating a new transaction is described in detail in the chapter <a href="https://habrahabr.ru/post/319862/">Bitcoin in a nutshell - Protocol</a> , so here I just give you the received <em>coinbase transaction</em> , all the code, as usual, is available on [Github] (): </p><br><pre> <code class="python hljs">coinbase_txn = <span class="hljs-string"><span class="hljs-string">"01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff8a47304402207e8495986ec27ed4556fee9dcd897ea028d4eb2023959c2299eb573e0771dee702201489e40115ccc45d4c23f1109cb56b513543517f3efc0031965ad94d94d3d2d901410497e922cac2c9065a0cac998c0735d9995ff42fb6641d29300e8c0071277eb5b4e770fcc086f322339bdefef4d5b51a23d88755969d28e965dacaaa5d0d2a0e09ffffffff01ddff814a000000001976a91478e10cf8e4bd38266d8fd4ed5c8b430d30a3cde888ac00000000"</span></span></code> </pre> <br><p>  It remains only to count for these three transactions <em>merkle root</em> .  To do this, use the code snippet from <a href="https://habrahabr.ru/post/320176/">Bitcoin in a nutshell - Blockchain</a> : </p><br><pre> <code class="python hljs">txn_pool.insert(<span class="hljs-number"><span class="hljs-number">0</span></span>, coinbase_txn) txn_hashes = map(getTxnHash, txn_pool) <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-string"><span class="hljs-string">"Merkle root: "</span></span>, merkle(txn_hashes) <span class="hljs-comment"><span class="hljs-comment"># Merkle root: 4b9ff9ab901df82050f858accde99b9169067acafaeade25598ea5505fb53836</span></span></code> </pre> <br><h3 id="target">  Target </h3><br><p>  As I wrote above, all mining comes down to finding a hash of a block less than the number called <em>target</em> .  In the block structure, this number is written in the <em>bits</em> field, for example, for block # 277,316, <em>target</em> was equal to <code>1903a30c</code> . </p><br><pre> <code class="hljs erlang-repl">$ bitcoin-cli getblock <span class="hljs-number"><span class="hljs-number">0000000000000001</span></span>b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4 { <span class="hljs-string"><span class="hljs-string">"hash"</span></span> : <span class="hljs-string"><span class="hljs-string">"0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4"</span></span>, <span class="hljs-string"><span class="hljs-string">"confirmations"</span></span> : <span class="hljs-number"><span class="hljs-number">35561</span></span>, <span class="hljs-string"><span class="hljs-string">"size"</span></span> : <span class="hljs-number"><span class="hljs-number">218629</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span> : <span class="hljs-number"><span class="hljs-number">277316</span></span>, <span class="hljs-string"><span class="hljs-string">"version"</span></span> : <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"merkleroot"</span></span> : <span class="hljs-string"><span class="hljs-string">"c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e"</span></span>, <span class="hljs-string"><span class="hljs-string">"tx"</span></span> : [<span class="hljs-string"><span class="hljs-string">"d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f"</span></span>, <span class="hljs-number"><span class="hljs-number">418</span></span> more transactions], <span class="hljs-string"><span class="hljs-string">"time"</span></span> : <span class="hljs-number"><span class="hljs-number">1388185914</span></span>, <span class="hljs-string"><span class="hljs-string">"nonce"</span></span> : <span class="hljs-number"><span class="hljs-number">924591752</span></span>, <span class="hljs-string"><span class="hljs-string">"bits"</span></span> : <span class="hljs-string"><span class="hljs-string">"1903a30c"</span></span>, // Here it's <span class="hljs-string"><span class="hljs-string">"difficulty"</span></span> : <span class="hljs-number"><span class="hljs-number">1180923195.25802612</span></span>, <span class="hljs-string"><span class="hljs-string">"chainwork"</span></span> : <span class="hljs-string"><span class="hljs-string">"000000000000000000000000000000000000000000000934695e92aaf53afa1a"</span></span>, <span class="hljs-string"><span class="hljs-string">"previousblockhash"</span></span> : <span class="hljs-string"><span class="hljs-string">"0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569"</span></span>, <span class="hljs-string"><span class="hljs-string">"nextblockhash"</span></span> : <span class="hljs-string"><span class="hljs-string">"000000000000000010236c269dd6ed714dd5db39d36b33959079d78dfd431ba7"</span></span> }</code> </pre> <br><p>  In fact, two numbers are written to bits at once: the first byte <code>0x19</code> is the exponent, the remaining three bytes <code>0x03a30c</code> are the mantissa.  In order to get the target from bits, you need to use the following formula: <code>target = mantissa * 2^(8 * exponent - 3))</code> .  In the case of block # 277.316 it turns out: </p><br><pre> <code class="python hljs"><span class="hljs-meta"><span class="hljs-meta">&gt;&gt;&gt; </span></span>bits = <span class="hljs-number"><span class="hljs-number">0x1903a30c</span></span> &gt;&gt;&gt; exp = bits &gt;&gt; <span class="hljs-number"><span class="hljs-number">24</span></span> &gt;&gt;&gt; mant = bits &amp; <span class="hljs-number"><span class="hljs-number">0xffffff</span></span> &gt;&gt;&gt; target_hexstr = <span class="hljs-string"><span class="hljs-string">'%064x'</span></span> % (mant * (<span class="hljs-number"><span class="hljs-number">1</span></span> &lt;&lt; (<span class="hljs-number"><span class="hljs-number">8</span></span> * (exp - <span class="hljs-number"><span class="hljs-number">3</span></span>)))) &gt;&gt;&gt; target_hexstr <span class="hljs-string"><span class="hljs-string">'0000000000000003a30c00000000000000000000000000000000000000000000'</span></span></code> </pre> <br><p>  Another term reflecting the complexity of mining is <em>difficulty</em> .  For example, for block <a href="https://blockr.io/block/info/449584"># 449.584</a> it was equal to <code>392,963,262,344.37</code> .  This parameter is the <code>max_target / current_target</code> ratio, where <code>max_target</code> is the maximum possible target, namely <code>0x00000000FFFF0000000000000000000000000000000000000000000000000000</code> ( <code>0x1d00ffff</code> in bits format).  It is bits that are typically specified in all block explorer. </p><br><p>  <strong>BTW</strong> the smaller the target, the more difficulty and vice versa. </p><br><h3 id="pow">  Pow </h3><br><p>  Now that you have understood all the nuances, you can launch a miner: </p><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> hashlib <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> struct <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> sys <span class="hljs-comment"><span class="hljs-comment"># ======= Header ======= ver = 2 prev_block = "000000000000000000e5fb3654e0ae9a2b7d7390e37ee0a7c818ca09fde435f0" merkle_root = "6f3ef687979a1f4866cd8842dcbcebd2e47171e54d1cc76c540faecafe133c39" bits = 0x10004379 # Not the actual bits, I don't have synced blockchain timestamp = 0x58777e25 # Calculate current time with this code: # hex(int(time.mktime(time.strptime('2017-01-12 13:01:25', '%Y-%m-%d %H:%M:%S'))) - time.timezone) exp = bits &gt;&gt; 24 mant = bits &amp; 0xffffff target_hexstr = '%064x' % (mant * (1 &lt;&lt; (8 * (exp - 3)))) # '0000000000000000000000000000000000437900000000000000000000000000' target_str = target_hexstr.decode('hex') # ======== Header ========= nonce = 0 while nonce &lt; 0x100000000: # 2**32 header = ( struct.pack("&lt;L", ver) + prev_block.decode('hex')[::-1] + merkle_root.decode('hex')[::-1] + struct.pack("&lt;LLL", timestamp, bits, nonce)) hash = hashlib.sha256(hashlib.sha256(header).digest()).digest() sys.stdout.write("\rNonce: {}, hash: {}".format(nonce, hash[::-1].encode('hex'))) sys.stdout.flush() if hash[::-1] &lt; target_str: print 'Success!' break nonce += 1</span></span></code> </pre> <br><h3 id="hash-rate">  Hash rate </h3><br><p>  If you have waited for the cherished line of <code>Success!</code>  you either have an Intel Core i7 or have a lot of free time.  I have no idea when this code will finish its work and whether it will find <em>nonce</em> at all, because the current complexity is simply monstrously great.  Even if we assume that our program is capable of shorting 100,000 hashes per second (and this is not so), then it is still a million times slower than any real miner, so it can take several days to search for <em>nonce</em> . </p><br><p>  So that you understand the scale of the problem: there is a <em><a href="https://bitcoin.org/en/vocabulary">hashrate</a></em> metric.  It reflects the total power of miners in the Bitcoin network, the unit of measurement is SHA256 hashes per second.  Here is her <a href="http://bitcoin.sipa.be/index.html">schedule</a> : </p><br><p><img src="http://bitcoin.sipa.be/speed-lin-ever.png" alt="hashrate"></p><br><p>  We assume that the hashrate is 2.000 PH / s = 2.000.000 TH / s = 2.000.000.000 GH / s = 2.000.000.000.000 MH / s = 2.000.000.000.000.000 KH / s.  And our program cannot even master 100 KH / s, so there is no point in competing with the entire network. </p><br><h2 id="2-blocks-1-chain">  2 Blocks 1 Chain </h2><br><h3 id="fork">  Fork </h3><br><p>  Let's imagine for a moment that the miners are looking for block # 123456.  And at about the same time, he was found by two independent miners, one of whom lives in Australia and the other in the United States.  Each of them begins to scatter its version of the block over the network, and as a result it turns out that one half of the world has one blockchain, and the other has the other. </p><br><p>  Is it possible and what will happen in this case? </p><br><p><img src="http://orm-chimera-prod.s3.amazonaws.com/1234000001802/images/msbt_0804.png" alt="fork1"></p><br><p>  Yes, it is possible.  Moreover, this happens quite often.  In this case, each node continues to adhere to its version of the blockchain until someone finds the next block.  Suppose that the new block continues the ‚Äúgreen‚Äù branch, as in the picture below. </p><br><p><img src="https://www.oroyfinanzas.com/files/2015/01/ejemplo-de-cadena-de-bloques-con-fork-en-bitcoin-777x437.png" alt="fork2"></p><br><p>  In this case, those nodes that stick to the ‚Äúred‚Äù version automatically synchronize the green one, because the rule in the Bitcoin world is the <strong>‚Äútrue‚Äù longest version of the blockchain</strong> .  The "red" version of the blockchain will be simply forgotten, along with awards for those who found it. </p><br><p>  You may ask: what if the fork goes further?  That is, simultaneously with the ‚Äúpurple‚Äù block, will they find another one that will continue the ‚Äúred‚Äù version of the blockchain? </p><br><p>  Most likely, this book will be read not only by people with a good mathematical education, therefore I will give the most general answer - this is absolutely possible.  But the probability of even the first fork is rather small, the second one is even less and so on.  For you to understand, the longest fork in the entire history of Bitcoin was only <a href="http://bitcoin.stackexchange.com/questions/3343/what-is-the-longest-blockchain-fork-that-has-been-orphaned-to-date">4 blocks</a> .  So at some point one of the branches will still break out ahead, and the entire network will switch to it. </p><br><p>  If you are interested in this problem from the perspective of probability theory, then you can read <a href="http://bitcoin.stackexchange.com/questions/42649/what-is-the-probability-of-forking-in-blockchain">"What is the probability of forking in blockchain?"</a>  This question is also well described in the famous <a href="https://bitcoin.org/bitcoin.pdf">"Bitcoin: A Peer-to-Peer Electronic Cash System" by Satoshi Nakamoto</a> . </p><br><h3 id="51-attack">  51% attack </h3><br><p>  On the simple fact that the longest chain in the blockchain is dominant, the whole attack is based: </p><br><blockquote>  Imagine that you are a scammer and buy goods for 1000 BTC in any store.  You negotiate with the seller and send him money.  The seller checks the blockchain, sees that such a transaction really was, has passed all the checks and even got into some block, for example # 123.  After that, the seller goes to the post office and sends you the goods. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At this time, you turn on your mining farm and start mining, <strong>starting with block # 122</strong> .  If you have enough power, you can outrun the rest of the network and quickly count to block # 124, after which the whole world will switch to your version of the blockchain.  In this case, your transaction at 1000 BTC, you will not include in any of the blocks, which means it will be forgotten forever, as if it never existed.  As a result, the seller will lose the goods and not receive their money. </blockquote><p>  I will not go into the theory of probability, but to carry out such an attack is impossible, unless you have at least half the hashrate of the entire network.  Read more in <a href="https://bitcoin.org/bitcoin.pdf">bitcoin.pdf</a> . </p><br><p>  Nevertheless, some mining pools have very significant capacities.  For example, BTC Guild in 2013 <a href="https://bitcointalk.org/index.php%3Ftopic%3D294869.0">almost overcame the</a> threshold of 51% of hashrate.  At some point they immediately mined 6 blocks in a row, so that if they wanted to, they could carry out this attack.  Therefore, it is recommended to consider the transaction <em>confirmed</em> only after it was created 6 blocks on top. </p><br><h2 id="hardware">  Hardware </h2><br><p>  You can immediately forget about mining on a CPU or GPU.  To make you understand, below is a <a href="https://blockchain.info/charts/hash-rate">hashrate</a> for the beginning of 2017.  We assume that it averages 2.300.000 TH / S, that is, 2.300.000.000.000 MH / s.  For comparison, the most brutal video cards, such as the <a href="http://www.amd.com/en-gb/products/graphics/desktop/5000/5870-eyefinity-6">ATI Radeon HD 5870 Eyefinity</a> or the <a href="https://compubench.com/device.jsp%3Fbenchmark%3Dcompu20%26os%3DWindows%26api%3Dcl%26D%3DAMD%2BRadeon%2BHD%2B7970%2B(x3)%26testgroup%3Dinfo">AMD Radeon HD 7970 (x3)</a> , produce <a href="https://litecoin.info/Mining_hardware_comparison">at best 2000 MH / S.</a>  Among the processors, the first place is occupied by the <a href="http://ark.intel.com/products/series/71842/Intel-Xeon-Phi-Coprocessor-5100-Series">Xeon Phi 5100</a> with a ridiculous 140 MH / s. </p><br><p><img src="https://habrastorage.org/files/077/62f/4de/07762f4dee2942578b30febaa184708e.png" alt="hashrate"></p><br><p>  So even on the basis of the rate of $ 1000 / BTC and having on hand 10,000 MH / s, you will earn an average of <a href="https://alloscomp.com/bitcoin/calculator">20 cents per month</a> . </p><br><p><img src="https://habrastorage.org/files/157/b6d/761/157b6d7619b946f787afd5946b39f170.png" alt="gpu"></p><br><p>  CPU mining has ceased to be cost-effective in 2011, the GPU lasted until about 2013, but also went bankrupt when the so-called <em>application-specific integrated circuit</em> - <a href="https://en.bitcoin.it/wiki/ASIC">ASIC</a> became widespread.  These are special chips sharpened for mining at the iron level.  The simplest ones cost around $ 100, which is much cheaper than a top-end video card, but at the same time they can produce from 1 TH / s. </p><br><p>  That is, other things being equal, having two <a href="https://www.hobbymining.com/bitmain-antminer-s9/">Antminer S9</a> for $ 3.000 each, you will earn almost <a href="https://alloscomp.com/bitcoin/calculator">$ 700 per month</a> (excluding electricity bills) </p><br><p><img src="https://habrastorage.org/files/1f0/677/ef0/1f0677ef0dc9400a81bf1a9d99d74571.png"></p><br><p>  But this is not all.  You can team up with other miners in the <em>mining pool</em> and start mining together, and share the earned money in proportion to the invested capacity.  This is obviously much more profitable than trying to earn at least something alone, which is why pools are the main driving force in the mining world today.  At the beginning of 2017, the <a href="https://blockchain.info/pools">main players</a> in the pool market are <a href="https://antpool.com/home.htm">AntPool</a> , <a href="https://www.f2pool.com/">F2Pool</a> and <a href="http://bitfury.com/">Bitfury</a> , providing more than 40% of the hashrate of the entire network. </p><br><p><img src="https://habrastorage.org/files/289/557/db8/289557db8d42456dbf538776bcbc0555.png" alt="Pools"></p><br><h2 id="conclusion">  Conclusion </h2><br><p>  On this high note, I finish my story about the technical device Bitcoin.  Sources of text plus code examples <a href="https://github.com/pavlovdog/bitcoin_in_a_nutshell">here</a> , there is also a pdf version.  Pull requests welcome, ask your questions in Issues or in the comments. </p><br><p><img src="https://media.giphy.com/media/3o7qDSOvfaCO9b3MlO/giphy.gif" alt="Obama out"></p><br><h2 id="links">  Links </h2><br><ul><li>  <a href="http://www.righto.com/2014/02/bitcoin-mining-hard-way-algorithms.html">Bitcoin mining the hard way:</a> </li><li>  <a href="http://www.righto.com/2014/09/mining-bitcoin-with-pencil-and-paper.html">Mining Bitcoin with pencil and paper: 0.67 hashes per day</a> </li><li>  <a href="https://en.bitcoin.it/wiki/Mining_hardware_comparison">Mining hardware comparison</a> </li><li>  <a href="https://habrahabr.ru/company/intel/blog/205554/">Bitcoin: development history, ASIC</a> </li><li>  <a href="https://www.hobbymining.com/bitcoin-mining-pools/">Biggest &amp; Best Bitcoin Mining Pools and Companies</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/320178/">https://habr.com/ru/post/320178/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320166/index.html">The digest of fresh materials from the world of the frontend for the last week ‚Ññ246 (January 16 - 22, 2017)</a></li>
<li><a href="../320168/index.html">Depth: how to make a quality project without millions in your pocket and why you shouldn‚Äôt be afraid of ‚Äúlong-term construction projects‚Äù</a></li>
<li><a href="../320172/index.html">JSON API My Warehouse, self-learning</a></li>
<li><a href="../320174/index.html">Local python typographer - typus Œ≤</a></li>
<li><a href="../320176/index.html">Bitcoin in a nutshell - Blockchain</a></li>
<li><a href="../320180/index.html">JDK 9 development has completed the ‚ÄúFeature Complete‚Äù phase</a></li>
<li><a href="../320184/index.html">Automatic visualization of python code using flowcharts</a></li>
<li><a href="../320186/index.html">Selection of useful slides from Julia Evans</a></li>
<li><a href="../320188/index.html">Hey, tv, are you the smartest?</a></li>
<li><a href="../320190/index.html">Virtual Client Computing in 2017: Tools and Tips for Successful Implementation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>