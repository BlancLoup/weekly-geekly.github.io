<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Some features of VimL</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about some of the features of VimL, ‚Äã‚Äãoften non-obvious, that a person who wants to write a good add-on for Vim needs t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Some features of VimL</h1><div class="post__text post__text-html js-mediator-article"><br>  In this article I want to talk about some of the features of VimL, ‚Äã‚Äãoften non-obvious, that a person who wants to write a good add-on for Vim needs to know.  To understand the article, knowledge of vimscript is required and the presence of at least one written addition is recommended.  People who do not want to write their own addition article will, for the most part, be useless. <a name="habracut"></a><br><h1>  Bindings </h1><h2>  Reattachment </h2><br>  Let's start with banal and well-known things: pereapyazki.  Vim has two main families of commands: <code>*map</code> and <code>*noremap</code> .  The first allows you to override its right side, the second is not.  In additions, only the second should be used, since it is not known which bindings the user has.  Classic example: <pre> <code class="hljs">noremap : ; noremap ; :</code> </pre>  will break <pre> <code class="hljs ruby">nmap &lt;F4&gt; <span class="hljs-symbol"><span class="hljs-symbol">:PluginToggle&lt;CR&gt;</span></span></code> </pre>  , but not <pre> <code class="hljs ruby">nnoremap &lt;F4&gt; <span class="hljs-symbol"><span class="hljs-symbol">:PluginToggle&lt;CR&gt;</span></span></code> </pre>  .  Other commands to keep in mind: <ul><li>  <code>*map</code> / <code>*noremap</code> , <code>*abbrev</code> / <code>*noreabbrev</code> , <code>*menu</code> / <code>*noremenu</code> </li><li>  <code>normal</code> / <code>normal!</code> </li><li>  <code>call feedkeys(string)</code> / <code>call feedkeys(string, 'n')</code> </li></ul><br>  You can also note the presence of the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="remap">'remap'</a> setting, which causes all commands of the <code>*map</code> to behave in the same way as their <code>*noremap</code> equivalents.  You will not be able to use <pre> <code class="hljs ruby">nnoremap &lt;Plug&gt;PluginAction <span class="hljs-symbol"><span class="hljs-symbol">:DoAction&lt;CR&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !hasmapto(<span class="hljs-string"><span class="hljs-string">'&lt;Plug&gt;PluginAction'</span></span>) nmap &lt;Leader&gt;a &lt;Plug&gt;PluginAction endif</code> </pre>  to allow users to redefine lhs and also support users who have enabled this setting, instead you have to bring all the definitions of the bindings to the form <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'nnoremap '</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(g:, <span class="hljs-string"><span class="hljs-string">'plugin_action_key'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;Leader&gt;a'</span></span>).<span class="hljs-string"><span class="hljs-string">' :DoAction&lt;CR&gt;'</span></span></code> </pre>  or more compatible with older versions of vim <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">exists</span></span>(<span class="hljs-string"><span class="hljs-string">'g:plugin_action_key'</span></span>) let g:plugin_action_key=<span class="hljs-string"><span class="hljs-string">'&lt;Leader&gt;a'</span></span> endif <span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'nnoremap '</span></span>.g:plugin_action_key.<span class="hljs-string"><span class="hljs-string">' :DoAction&lt;CR&gt;'</span></span></code> </pre> <br><h2>  Special symbols </h2><br><ul><li>  Using &lt;Esc&gt; as the left side of the binding will easily make it impossible to use the arrows and function keys.  Even <pre> <code class="hljs xml">nmap <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Esc</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Esc</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  already suffering this. </li><li>  The presence of the 0x80 byte in the right side of the binding-expression can spoil it.  The error is known and <a href="http://vimdoc.sourceforge.net/htmldoc/map.html">documented</a> . </li></ul><br><h2>  File (&lt;script&gt;) bindings </h2><br>  Vim provides the ability to make valid the redefinition of the right part of the bindings only those bindings that are defined in the same file.  Leaving aside the limited utility (more precisely, the lack thereof) in the case when the user redefines the left part of the binding using <pre> <code class="hljs ruby">nnoremap &lt;Plug&gt;PluginAction <span class="hljs-symbol"><span class="hljs-symbol">:DoAction&lt;CR&gt;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !hasmapto(<span class="hljs-string"><span class="hljs-string">'&lt;Plug&gt;PluginAction'</span></span>) nmap &lt;Leader&gt;a &lt;Plug&gt;PluginAction endif</code> </pre>  or <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'nnoremap '</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(g:, <span class="hljs-string"><span class="hljs-string">'plugin_action_key'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt;Leader&gt;a'</span></span>).<span class="hljs-string"><span class="hljs-string">' :DoAction&lt;CR&gt;'</span></span></code> </pre>  There is another reason why this method should not be used: for commands <pre> <code class="hljs xml">nnoremap <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> lhs rhs</span></span></code> </pre>  and <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">nnoremap</span></span> lhs rhs</code> </pre>  calling <code>maparg('lhs', 'n', 0, 1)</code> will return the same dictionary.  That is, if another developer wants, say, to temporarily make another binding with the same <code>lhs</code> , and then restore the old one, then the file binding will not be correctly restored. <br><h1>  Settings </h1>  Vim has a lot of settings that will easily ruin your life: <br><h2>  Compatibility Settings </h2><br>  The most destructive setting is <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="compatible">'compatible'</a> .  As a rule, the most appropriate way to deal with it is simply to refuse to download, perhaps with the output of the message: <pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> &amp;compatible finish <span class="hljs-keyword"><span class="hljs-keyword">endif</span></span></code> </pre>  The second most damaging effect on add-ons is to set up <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="cpoptions">'cpoptions'</a> : with it, <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">you can</a> prevent the <a href="http://vimdoc.sourceforge.net/htmldoc/repeat.html">transfer of a part of a command to the next line</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">change the</a> <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">behavior of</a> <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">commands</a> that <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">create</a> bindings, <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">change the</a> <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">behavior of</a> regular expressions, and do other bad things.  This is usually partly handled by <pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> s:saved_cpo=&amp;cpo <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> cpo&amp;vim &lt;...&gt; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> &amp;cpo=s:saved_cpo unlet s:saved_cpo</code> </pre>  but with changing the behavior of regular expressions you can not do anything.  It is also good that it does not affect functions (I mean built-in functions like <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">match * ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">substitute ()</a> , and not user-defined). <br><h2>  Ignore case </h2><br>  Another "fun" setting is <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="ic">'ignorecase'</a> .  However, unlike the compatibility settings, it is rather easy to cope with it, following simple rules: <ul><li>  When comparing strings, always use the suffix <code>#</code> (takes case into account) or <code>?</code>  (accordingly, ignores it).  <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">Help</a> </li><li>  In the <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">match ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">matchend ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">matchlist ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">matchstr ()</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">substitute ()</a> functions, when using regular expressions in the <a href="http://vimdoc.sourceforge.net/htmldoc/tagsrch.html">: tag</a> command, and also when searching with <a href="http://vimdoc.sourceforge.net/htmldoc/p%5B%25CC%2581attern.html"><code>/</code></a> and <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>?</code></a>  , including when <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html">the search command is part of a range</a> , you should explicitly specify <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>\C</code> or <code>\c</code></a> . <br>  Calls <code>:tag name</code> will have to turn into <code>:tag /\V\C\^name\$</code> if you care about the register of tags. </li><li>  In the commands <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: s</a> <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">,:</a> <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">sm</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: sno</a> you must specify the <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">flag</a> <code>i</code> or <code>I</code> </li><li>  With actions <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>*</code></a> and <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>#</code></a> you can not do anything.  Can use instead <pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">let</span></span> @/='\<span class="hljs-keyword"><span class="hljs-keyword">V</span></span>\<span class="hljs-keyword"><span class="hljs-keyword">C</span></span>\&lt;'.<span class="hljs-keyword"><span class="hljs-keyword">escape</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">expand</span></span>('&lt;<span class="hljs-keyword"><span class="hljs-keyword">cword</span></span>&gt;'), <span class="hljs-string"><span class="hljs-string">'\/'</span></span>).<span class="hljs-string"><span class="hljs-string">'\&gt;'</span></span> call histadd(<span class="hljs-string"><span class="hljs-string">'/'</span></span>, @/) normal! n</code> </pre>  , and you can just score and forget.  Never seen the use of this action in additions. </li><li>  One good news: do not do anything with the command <a href="http://vimdoc.sourceforge.net/htmldoc/syntax.txt">: syntax</a> . </li></ul><br><h2>  Magic and repetition </h2><br><ul><li>  The <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="magic">'magic'</a> setting also affects regular expressions, but fortunately is ignored in most cases.  All you need to do is specify one of the modifiers <a href="http://vimdoc.sourceforge.net/htmldoc/p%5B%25CC%2581attern.html"><code>\M</code> , <code>\m</code> , <code>\v</code> or <code>\V</code></a> when searching using <a href="http://vimdoc.sourceforge.net/htmldoc/p%5B%25CC%2581attern.html"><code>/</code></a> and <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>?</code></a>  , including when <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html">the search command is part of the range</a> , and also use <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: sm</a> or <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: sno</a> instead of <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: s</a> . </li><li>  Another setting that affects <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">: s</a> is <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="gdefault">'gdefault'</a> .  It changes the behavior of the <code>g</code> flag to the exact opposite.  The only way to handle it is to use <pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> saved_gdefault=&amp;gdefault <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> nogdefault <span class="hljs-string"><span class="hljs-string">" Do sm// commands here let &amp;gdefault=saved_gdefault</span></span></code> </pre> </li></ul><br><h2>  Wild files </h2><br>  When using <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">expand ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">glob ()</a> or <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">globpath ()</a> , specify one as the first of the optional arguments, otherwise the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="wildignore">'wildignore'</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="suffixes">'suffixes'</a> settings will be taken into account, which may exclude some files from the output.  However, sometimes it is, on the contrary, useful. <br><h2>  Other settings </h2><br><ul><li>  If you are used to living with the included <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="hidden">'hidden'</a> , remember that it is not by default.  This may affect the ability of your add-on to switch to a different buffer.  To prevent this, you can use <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="bufhidden">'bufhidden'</a> , which is set to ‚Äúhide‚Äù. </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="autochdir">'autochdir'</a> changes the current directory when the user moves to another buffer.  Sometimes it is unexpected and breaks your supplement. </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="cdpath">'cdpath'</a> changes the behavior of the commands <a href="http://vimdoc.sourceforge.net/htmldoc/editing.html">: cd</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/editing.html">: lcd</a> , except when the directory is specified in an absolute way or relative to the current directory (with an explicit <code>./</code> ) or the directory in which the current ( <code>../</code> ) is located. </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="revins">'revins'</a> changes the direction of input.  Because of it, you should not use <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'normal! A'</span></span>.text</code> </pre>  to enter text, use <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">setline ()</a> or <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">append ()</a> instead.  If you want to add it to the end of the line, you have to use <pre> <code class="hljs lua">let <span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>=split(text, <span class="hljs-string"><span class="hljs-string">"\n"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>) let <span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>]=getline(<span class="hljs-string"><span class="hljs-string">'.'</span></span>).<span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>[<span class="hljs-number"><span class="hljs-number">0</span></span>] call setline(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">remove</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> !empty(<span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>) call append(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">lines</span></span>) endif</code> </pre>  .  Moving the cursor will also have to be considered manually.  Inserting the text inside, as you can guess, will add a few more lines of code.  An example, not jerking the cursor, can be found <a href="">here</a> . </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="selection">'selection'</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="selectmode">'selectmode'</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="virtualedit">'virtualedit'</a> can also ruin your life.  It is unlikely that here you can do something better than the standard ‚Äúsave the setting, set your value, do the job, restore it back‚Äù. </li><li>  Changing the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="shell">'shell'</a> can also easily affect other <code>shell*</code> settings, and, according to the documentation, some settings do not change automatically with a change to <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="shell">'shell'</a> if they were changed explicitly earlier, so it‚Äôs better not to do this, since restoring everything ‚Äúas it was "You will not succeed. </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="startofline">'startofline'</a> changes the cursor position when performing certain actions.  You will have to explicitly set it after them, if that matters. </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="wrapscan">Does 'wrapscan'</a> change the behavior of search commands <a href="http://vimdoc.sourceforge.net/htmldoc/p%5B%25CC%2581attern.html"><code>/</code></a> and <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>?</code></a>  , including when <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html">the search command is part of a range</a> .  Use <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">search ()</a> , which can be explicitly set the behavior or the standard "saved, changed, made, restored." </li></ul><br><h2>  Local settings </h2><br>  Also, it should be noted that <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">: setlocal</a> does not throw an exception if you are trying to change a setting that is exclusively global.  Thus, before changing any settings with its help, it will not be superfluous to look into the documentation and then either abandon the use of global settings or restore them by the <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html">BufLeave</a> event, setting its value by the <a href="http://vimdoc.sourceforge.net/htmldoc/autocmd.html">BufEnter</a> event. <br><h1>  Strange file names </h1><ul><li>  The <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">expand ()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">glob ()</a> or <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">globpath () functions</a> on * nix systems do not return file names starting with a dot.  And when using constructions of the form <code>glob('{*,.*}', 1, 1)</code> you will receive special directories in the load <code>.</code>  (current directory) and <code>..</code> (directory in which the current one is located), which in many cases you just need to ignore. </li><li>  With the exception of <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">globpath ()</a> , the <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">expand ()</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">glob ()</a> functions now support the second optional argument, which causes them to return the result as a list.  Use it on * nix systems, because POSIX allows you to have a new line in the file name.  If vim is old enough so that these functions do not have an additional argument, and I want to support such files (note, ‚Äúin the wild‚Äù I never saw them), then here‚Äôs <a href="">an example of</a> how to pervert to do this. </li></ul><br><h1>  Splitting into lines and comments </h1>  The meaning of the characters of the new line and vertical bar, as well as the possibility of using comments, strongly depends on the context: <ol><li>  If the built-in command accepts an expression as an argument (for example <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">,: echo</a> ), then a double stroke is considered the beginning of a string literal, a new line and a vertical bar separate two commands (but not if they are inside a string literal).  You can not achieve this effect for your teams. </li><li>  But not in the case that it is a binding / reduction-expression, they actually do not accept expressions from the point of view of the parser. </li><li>  And not if reading from a file / creating a function using <pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> "function Abc()\n DoSomething\nendfunction"</code> </pre>  , here a new line always separates two commands. </li><li>  If a command considers a vertical line as part of its arguments, then the newline character will also be part of its arguments (except for the cases described above). </li><li>  A backslash at the beginning of a new line means the transfer of a part of a command.  It works exactly as if before executing the file we use the command <pre> <code class="hljs mel">%s/\n\s*\\<span class="hljs-comment"><span class="hljs-comment">//</span></span></code> </pre> </li><li>  But only if the file is executed.  Nowhere else can I apply transfer. </li><li>  Commands that create bindings / abbreviations / menus are special: a double stroke is considered a part of them, but does not start a string literal, and the vertical bar, however, interrupts commands.  You also can not achieve this effect for their teams. </li><li>  You cannot place <code>endfunction</code> on a separate line.  The parser after the <code>function</code> command just stupidly cheats all the lines belonging to the functions and saves them to an array until it encounters the <code>endfunction</code> command found on the new line. </li></ol><br><h1>  * Cmd </h1>  Creating correct (Buf | File) (Read | Write) Cmd is much more difficult than it seems at first glance.  The fact is that vim does not provide any automatic detection of the encoding or line wrapping method, nor any easy support ++ opt.  If you look at the standard add-on that reads gzip-compressed files, you will see that it uses saving the expanded content to a temporary file and then <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read</a> to read the file.  This eliminates the need to use the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="fileformats">'fileformats'</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="fileencodings">'fileencodings' settings</a> to guess the way to <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="fileencodings">wrap</a> lines and encoding, but open the compressed file in KOI8-R encoding if you do not normally get <code>fileencodings=utf8,cp1251</code> , in contrast to the compressed file encoded with CP1251.  If you do not want this to happen with your supplement, there is <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">v: cmdarg</a> at your service.  This variable always contains the data of the user ++ settings in a short form, so you will not have to support ++ enc and ++ encoding.  An example can be found <a href="">here</a> (read, the next function is a write) (although <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="fileformats">'fileformats'</a> and <a href="http://vimdoc.sourceforge.net/htmldoc/options.html">'fileencodings'</a> are ignored here), but in some cases <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">v: cmdarg</a> can be simply combined with <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read</a> with <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">: execute</a> .  Note that <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read</a> ignores ++ settings when reading shell command output. <br><h1>  Non fatal error </h1>  A person who has just read the list of commands may think that the command <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">: echoerr</a> is a good way to display an error.  In fact, this is not the case: there is no way for the displayed error to <em>not</em> interrupt the execution of the program.  You can make this command guaranteed to <em>interrupt</em> program execution, but if instead of <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> echoerr <span class="hljs-string"><span class="hljs-string">'Error'</span></span> endtry</code> </pre>  you write just <pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">echoerr</span></span> <span class="hljs-string"><span class="hljs-string">'Error'</span></span> <span class="hljs-string"><span class="hljs-string">" some code here</span></span></code> </pre>  get ready for the fact that you will have to debug strange problems related to the fact that ‚Äúsome code‚Äù is executed, then not - depending on whether you put the code inside the block <code>:try</code> .  Considering that inside the block <code>:try</code> you cannot put only code that will never be executed, and the user may have more than one reason to put your code exactly there, having written <code>:echoerr</code> you just in vain complicated your life. <br>  If you want to display an error without interrupting the program, use <pre> <code class="hljs pgsql">echohl ErrorMsg echomsg <span class="hljs-string"><span class="hljs-string">'Error'</span></span> echohl <span class="hljs-keyword"><span class="hljs-keyword">None</span></span></code> </pre>  .  If you need to interrupt the execution, there is <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">: throw</a> .  And only if you are <em>not at</em> all satisfied with the error message issued by <code>:throw</code> , there is <pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">try</span></span> echoerr <span class="hljs-string"><span class="hljs-string">'Error'</span></span> endtry</code> </pre>  .  Simply <code>:echoerr</code> no, you must forget it. <br><h1>  Not really text files </h1>  Working with files and output of commands that can contain zeros or do not end in a new line, Vim can give you quite a few ‚Äúpleasant‚Äù minutes if you need to maintain its correctness.  Here are a few facts: <ul><li>  In VimL, ‚Äã‚Äãthere is absolutely no way to run a command from outside the shell.  This means that the work of your add-on will <em>always</em> depend on the correctness of settings starting with the <code>shell</code> (or whether the user has an assembly that supports other programming languages). </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">system ()</a> does not officially support the presence of a new string in its arguments. </li><li>  The only way to get the output of the command completely and unchanged on pure VimL is to write the output of the command to the temporary file and read it with <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">readfile ()</a> with the optional argument <code>'b'</code> .  It is recommended to use the <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="shellredir">shellredir</a> setting value in order to have a <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="shellredir">better</a> chance of making money on another computer.  <a href="">An example</a> . </li><li>  There is no way to write a zero byte to the register, except for writing it to the buffer and copying from there.  You can conduct an experiment: <pre> <code class="hljs pgsql">enew <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> setline(<span class="hljs-string"><span class="hljs-string">'.'</span></span>, "a\nb") yank put <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> setreg(<span class="hljs-string"><span class="hljs-string">'"'</span></span>, getreg(<span class="hljs-string"><span class="hljs-string">'"'</span></span>), getregtype(<span class="hljs-string"><span class="hljs-string">'"'</span></span>)) put</code> </pre>  ( <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.txt">look here</a> to see why I took <code>"\n"</code> ).  Here is what you see: <pre> <code class="hljs scala">a^<span class="hljs-meta"><span class="hljs-meta">@b</span></span> a^<span class="hljs-meta"><span class="hljs-meta">@b</span></span> a b</code> </pre> </li><li>  <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read</a> , it would seem, correctly reads zeros, but you can never tell if there was a new line at the end of the output when using it.  And you will have to install <a href="http://vimdoc.sourceforge.net/htmldoc/options.html" title="binary">'binary'</a> so that <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read</a> does not consider itself too smart and does not chew <code>\r</code> before <code>\n</code> . </li></ul><br><h1>  Inequality </h1>  There are six operators in Vim that allow you to check equality and the same number of operators that test the inequality: <ul><li>  <code>==</code> , <code>==?</code>  , <code>==#</code> (inequality:! <code>!=*</code> ).  Scalar types are compared as is, leading if necessary (if the arguments are of a different type) the string to the integer, and the integer to a floating point number.  When comparing a string with a floating-point number, the string will first be converted to an integer, then an integer to a floating-point number.  Therefore, <code>"42"==42.0</code> , but <code>"42.1"!=42.1</code> , and <code>"42.1"==42.0</code> . <br>  Non-scalar types This operator bypasses recursively. <br>  Comparing a function reference, a list and a dictionary with something else type throws an error (turning into an exception in the block <code>:try</code> ). </li><li>  <code>is</code> , <code>is?</code>  , <code>is#</code> (inequality: <code>isnot*</code> ).  When comparing scalar types, it works the same way as <code>type(a)==type(b) &amp;&amp; a==b</code> (with the appropriate suffix, of course).  When comparing non-scalar types (the reference to a function is also a scalar type), it first checks the type, then the identity (that is, whether the arguments refer to the same object in memory), similarly to the <code>is</code> operator in Python.  Never throws an error and never leads an argument to another type. </li></ul><br>  Accordingly, the recommended rules for use: <ol><li>  For any comparisons of scalar types, use <code>is#</code> , <code>is?</code>  , <code>isnot#</code> or <code>isnot?</code>  (the difference is described in the section ‚ÄúSettings / Ignoring the register‚Äù). </li><li>  For any comparisons of non-scalar types, if you want to find out the equality of value, and not identity, you should use <code>==#</code> , <code>==?</code>  <code>!=#</code> or <code>!=?</code>  . </li><li>  About operators <code>==</code> , <code>is</code> <code>isnot</code> <code>!=</code> And <code>isnot</code> should be forgotten altogether. </li></ol><br>  There is another set of rules that I adhere to and which allow you to reduce the number of characters for a set: <ol><li>  If one of the arguments is a numeric constant, and the other is used in the code only as a number, you can use <code>==</code> . </li><li>  If one of the arguments is a numeric constant, you can use <code>is</code> . </li><li>  Further use the rules from the previous list.  <code>==#</code> for the lines I do not apply because I do not want to think whether I should (will) use the number as a ‚Äúspecial argument‚Äù (like <code>0</code> instead of <code>None</code> ). </li></ol><br><h1>  Functions </h1>  One of the interesting features of Vim is its work with variables that reference functions.  Esla you have already heard that you can get such a change with <pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> Func=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"tr"</span></span></span></span></span><span class="hljs-function">)</span></span></code> </pre>  , you probably also know that the variable name starts with a capital letter, because otherwise Vim will show an error.  But there is another, less well-known, fact, because of which you should <i>never</i> assign a function reference to a variable: if someone somewhere defined the function ‚ÄúFunc‚Äù, then Vim would also show an error.  There are only two safe ways to use a function reference: pass it as an argument and use complex structures: a dictionary or a list: <pre> <code class="hljs javascript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d={} <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d.func=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"tr"</span></span></span></span></span><span class="hljs-function">)</span></span></code> </pre>  , and <pre> <code class="hljs lisp">function Apply(<span class="hljs-name"><span class="hljs-name">func</span></span>, list) return call(<span class="hljs-name"><span class="hljs-name">a</span></span><span class="hljs-symbol"><span class="hljs-symbol">:func</span></span>, a<span class="hljs-symbol"><span class="hljs-symbol">:list</span></span>, {}) endfunction echo Apply(<span class="hljs-name"><span class="hljs-name">function</span></span>(<span class="hljs-string"><span class="hljs-string">"tr"</span></span>), [<span class="hljs-string"><span class="hljs-string">"abc"</span></span>, <span class="hljs-string"><span class="hljs-string">"a"</span></span>, <span class="hljs-string"><span class="hljs-string">"d"</span></span>])</code> </pre>  completely safe, even despite the possibility of defining the function <code>a:func()</code> . <br><h1>  Special characters! </h1>  You have seen and it seemed convenient to use the% symbol instead of the file name, for example, here: <pre> <code class="hljs xml">nnoremap <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">F4</span></span></span><span class="hljs-tag">&gt;</span></span> :!python %<span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CR</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre>  ?  This is another feature of Vim that could be comfortable ... if it worked normally.  It is necessary to appear in the file name as a space / stroke / dollar (* sh) and instead of the file name the interpreter in this binding can get anything.  Vim has many <a href="http://vimdoc.sourceforge.net/htmldoc/cmdline.html">modifiers</a> for the current file name like <code>%:t</code> [ail] (leaves only the last part of the name), but the modifier <code>%:E</code> [scape], which would <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">run the</a> file name through <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">shellescape ()</a> , is not among them.  Therefore, you have to screen everything yourself, while not forgetting the context of the call: when using <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">system (),</a> <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">shellescape ()</a> should be called with one argument or zero instead of the second, and when used <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">:!</a>  , <a href="http://vimdoc.sourceforge.net/htmldoc/insert.html">: read!</a>  , <a href="http://vimdoc.sourceforge.net/htmldoc/editing.html">: write!</a>  and other exclamation marks - with two arguments and one as the second.  Examples: <pre> <code class="hljs pgsql">nnoremap &lt;F4&gt; :<span class="hljs-keyword"><span class="hljs-keyword">execute</span></span> <span class="hljs-string"><span class="hljs-string">'!python'</span></span> shellescape(@%, <span class="hljs-number"><span class="hljs-number">1</span></span>)&lt;CR&gt; nnoremap &lt;F5&gt; :<span class="hljs-keyword"><span class="hljs-keyword">call</span></span> <span class="hljs-keyword"><span class="hljs-keyword">system</span></span>(<span class="hljs-string"><span class="hljs-string">'javac '</span></span>.shellescape(expand(<span class="hljs-string"><span class="hljs-string">'%'</span></span>)))&lt;CR&gt;</code> </pre> <br><h1>  Regular Expression Features </h1><ul><li>  <code>[^\na]</code> - familiar record?  In VimL regular expressions, it means absolutely not what you think: this collection matches any character, <i>as well as a new line</i> .  The fact is that this record means the same as the less discouraging <code>\_[^a]</code> : that is, adding a new line to the collection, in this case consisting of all characters except <code>a</code> . </li><li>  <code>substitute(str, reg, '\=expr', flags)</code> can replace the regular expression with the result of the evaluation <code>expr</code> , or maybe with <code>=expr</code> .   <code>\=</code> ,   ,   ‚Äê   , Vim   .     <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">substitute()</a>  <a href="http://vimdoc.sourceforge.net/htmldoc/change.html">:s</a> . </li><li> <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>^</code></a>  ¬´ ¬ª     ,  ( <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>\(\)</code></a> , <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>\%(\)</code></a> )   ( <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>\|</code></a> ).     <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>$</code></a> ,       ,   . </li><li>     ,        ,     ( ,   <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">match*()</a> , <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">substitute()</a>  <a href="http://vimdoc.sourceforge.net/htmldoc/eval.html">=~*</a> )      ¬´/ ¬ª.      ,      .     ‚Äî  <a href="http://vimdoc.sourceforge.net/htmldoc/pattern.html"><code>\n</code></a> ,      ¬´ ¬ª,  ¬´  ¬ª.  :   ,           .  Vim ¬´ ¬ª ‚Äî      char*. </li></ul><br><h1>  </h1><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Vim has many options for auto-completion, which you can use in your commands. </font><font style="vertical-align: inherit;">Except for one: files and directories. </font><font style="vertical-align: inherit;">Of course, if you look into the certificate, you can see it in the list </font></font><code>-complete=dir</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>-complete=file</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, however, these arguments have little in common with auto-completion:</font></font><pre> <code class="hljs dos">command -complete=<span class="hljs-built_in"><span class="hljs-built_in">dir</span></span> -nargs=<span class="hljs-number"><span class="hljs-number">1</span></span> -bar <span class="hljs-built_in"><span class="hljs-built_in">Echo</span></span> :<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> [&lt;f-args&gt;] command -nargs=<span class="hljs-number"><span class="hljs-number">1</span></span> EchoN :<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> [&lt;f-args&gt;]</code> </pre> <pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">:Echo</span></span> abc <span class="hljs-symbol"><span class="hljs-symbol">E172:</span></span>       <span class="hljs-symbol"><span class="hljs-symbol">:EchoN</span></span> abc [<span class="hljs-string"><span class="hljs-string">'ab c'</span></span>] <span class="hljs-symbol"><span class="hljs-symbol">:Echo</span></span> * <span class="hljs-symbol"><span class="hljs-symbol">E77:</span></span>     <span class="hljs-symbol"><span class="hljs-symbol">:Echo</span></span> $HOME [<span class="hljs-string"><span class="hljs-string">'/home/zyx'</span></span>] <span class="hljs-symbol"><span class="hljs-symbol">:Echo</span></span> <span class="hljs-string"><span class="hljs-string">`date`</span></span> [<span class="hljs-string"><span class="hljs-string">'. . 28 17:17:47 MSK 2012'</span></span>]</code> </pre>  .<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Agree, a bit is not what you expected, setting up auto-completion. </font><font style="vertical-align: inherit;">Especially if the team must accept exactly the templates. </font><font style="vertical-align: inherit;">Moreover, it is not described in the documentation. </font><font style="vertical-align: inherit;">And does not happen with other options for auto-completion.</font></font></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/149919/">https://habr.com/ru/post/149919/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149914/index.html">Turn the Raspberry Pi into a retro gaming console</a></li>
<li><a href="../149915/index.html">State services. Registration of SP or all is not so transparent</a></li>
<li><a href="../149916/index.html">How to make Time Machine back up to a network drive</a></li>
<li><a href="../149917/index.html">Do you listen to music while working?</a></li>
<li><a href="../149918/index.html">Unrolled linked list in Java</a></li>
<li><a href="../149921/index.html">McDonald's is testing PayPal order payment system.</a></li>
<li><a href="../149922/index.html">The list of Russian scientific journals on information technology</a></li>
<li><a href="../149923/index.html">OnLive officially announced the transfer of its assets to the new owner</a></li>
<li><a href="../149925/index.html">IEEE is preparing a 1Tbps Ethernet standard</a></li>
<li><a href="../149926/index.html">Google Analytics to collect javascript errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>