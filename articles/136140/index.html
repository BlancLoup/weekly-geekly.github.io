<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dependency injection in Java EE 6</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="As part of the JSR-299 ‚ÄúContexts and Dependency Injection for the Java EE platform‚Äù (formerly WebBeans), a specification was developed describing the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dependency injection in Java EE 6</h1><div class="post__text post__text-html js-mediator-article">  As part of the JSR-299 ‚ÄúContexts and Dependency Injection for the Java EE platform‚Äù (formerly WebBeans), a specification was developed describing the implementation of the dependency injection pattern included in the Java EE 6. The reference implementation is the Weld framework, which will be discussed in this article . <br><br>  Unfortunately, there is not much Russian-language information about it on the network.  Most likely this is due to the fact that Spring IOC is synonymous with dependency injection in Java Enterprise applications.  Of course, there is Google Guice, but it is not so popular either. <br><br>  The article would like to talk about the main advantages and disadvantages of Weld. <a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  A bit of theory </h4><br>  In the beginning it is worth mentioning the JSR-330 ‚ÄúDependency Injection for Java‚Äù specification developed by engineers from SpringSource and Google, which defines the basic mechanisms for implementing DI in Java applications.  Like Spring and Guice, Weld uses the annotations provided for by this specification. <br><br>  Weld can work not only with Java EE applications, but also with the usual Java SE environment.  Naturally there is support for Tomcat, Jetty;  official documentation describes detailed configuration instructions. <br><br>  In Contexts and Dependency Injection (CDI), it is impossible to inject a bin through its name as a string, as is done for example in Spring through <a href="http://habrahabr.ru/users/qualifier/" class="user_link">Qualifier</a> .  Instead, use the template qualifier annotations (about which below).  From the point of view of the creators of CDI, this is a more typesafe approach, avoiding some errors and providing flexibility to DI. <br><br>  In order to enable CDI, you need to create the beans.xml file in the WEB-INF directory for the web application (or in META-INF for Java SE): <br><br>  &lt;beans xmlns = " <a href="http://java.sun.com/xml/ns/javaee">java.sun.com/xml/ns/javaee</a> " <br>  xmlns: xsi = " <a href="http://www.w3.org/2001/XMLSchema-instance">www.w3.org/2001/XMLSchema-instance</a> " <br>  xsi: schemaLocation = " <a href="http://java.sun.com/xml/ns/javaee">java.sun.com/xml/ns/javaee</a> <a href="">java.sun.com/xml/ns/javaee/beans_1_0.xsd</a> "&gt; <br><br>  &lt;/ beans&gt; <br><br>  As in Spring, bins in the context of CDI have their own skup during which they exist.  The scop is set using annotations from the javax.enterprise.context package: <br><ul><li>  @RequestScoped </li><li>  @SessionScoped </li><li>  @ApplicationScoped </li><li>  <a href="http://habrahabr.ru/users/dependent/" class="user_link">Dependent</a> </li><li>  @ConversationScoped </li></ul>  With the first three scopes everything is clear.  Used by default in CDI, <a href="http://habrahabr.ru/users/dependent/" class="user_link">Dependent</a> binds directly to the client's bin and exists for as long as the ‚Äúparent‚Äù lives. <br><br>  @ConversationScoped is a specific amount of time a user interacts with a particular tab in a browser.  Therefore, it is somewhat similar to the life cycle of a session, but the important difference is that the start of the ‚Äúsession‚Äù is set manually.  For this, the javax.enterprise.context.Conversation interface has been declared, which defines the start (), end (), and setTimeout (long) methods to close the session after a timeout. <br><br>  Of course, there is <a href="http://habrahabr.ru/users/singleton/" class="user_link">Singleton</a> , which is in the javax.inject package, because  is part of the JSR-330 specification.  In the CDI implementation of this scopa, there is one feature: during the injection process, the client receives a link to the real object created by the container, and not the proxy.  As a result, there may be data ambiguity problems if the state of a singleton changes, and the bins using it, for example, have been or will be serialized. <br><br>  To create your own scop, you need to write an annotation and mark it with @ScopeType, and also implement the javax.enterprise.context.spi.Context interface. <br><br>  A slight confusion may arise with the fact that the javax.faces.bean package also contains annotations for managing the scoped bins of JSF.  This is due to the fact that in JSF applications the use of CDI is not necessary: ‚Äã‚Äãindeed, because you can do with standard injections using @EJB, @PersistenceContext, etc.  However, if we want to use advanced things from DI, it is more convenient to use annotations from JSR-299 and 330. <br><br><h4>  Try on </h4><br>  Suppose there is a service verifying username and password. <br><br><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String password)</span></span></span></span>; }</code> </pre> <br><br>  Let's write its implementation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"bugs"</span></span>.equalsIgnoreCase(name) &amp;&amp; <span class="hljs-string"><span class="hljs-string">"bunny"</span></span>.equalsIgnoreCase(password); } }</code> </pre> <br><br>  Now add a controller that will use the login service: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Named</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestScoped</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILoginService loginService; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> loginService.login(login, password) ? <span class="hljs-string"><span class="hljs-string">"main.xhtml"</span></span> : <span class="hljs-string"><span class="hljs-string">"failed.xhtml"</span></span>; } <span class="hljs-comment"><span class="hljs-comment">// getters and setters will be omitted... }</span></span></code> </pre> <br><br>  As you can see from the example, in this case, for injection with Weld, you need to add the <a href="http://habrahabr.ru/users/inject/" class="user_link">Inject</a> annotation in the required field: the container will find all possible implementations of the interface, select the appropriate one and create an object associated with the controller's scop.  Injections to the method and constructor are naturally supported.  The example also uses the <a href="http://habrahabr.ru/users/named/" class="user_link">Named</a> annotation; it serves to enable the bean to be addressed to the EL by name. <br><br>  In the development process, we would like to have our own implementation of the service, something like this: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubLoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> <br><br>  Now after the application redeploy in the console, an error will occur: <br><br><pre> <code class="hljs scala"><span class="hljs-type"><span class="hljs-type">WELD</span></span><span class="hljs-number"><span class="hljs-number">-001409</span></span> <span class="hljs-type"><span class="hljs-type">Ambiguous</span></span> dependencies <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> [</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">ILoginService</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">qualifiers</span></span></span><span class="hljs-class"> [@</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Default</span></span></span><span class="hljs-class">] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">at</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">injection</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">point</span></span></span><span class="hljs-class"> [[field] </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">@Inject</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">private</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">com</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sample</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">controller</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginController</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">loginService</span></span></span><span class="hljs-class">].</span></span></code> </pre> <br><br>  If several implementations are at the injection point, then Weld throws an exception.  CDI developers have provided a solution to this problem.  To do this, we note the StubLoginService annotation <a href="http://habrahabr.ru/users/alternative/" class="user_link">Alternative</a> : <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Alternative</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubLoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ ‚Ä¶ }</code> </pre> <br><br>  Now this implementation is not available for injection and after the redeploy the error will not occur, but now Weld does not quite what we need.  Add the following to beans.xml: <br><br>  &lt;alternatives&gt; <br>  &lt;class&gt; com.sample.service.StubLoginService &lt;/ class&gt; <br>  &lt;/ alternatives&gt; <br><br>  Thus, we changed the implementation at the start of the application.  To return the working version it is enough to comment out the line in the bins configuration file. <br><br>  As is usually the case, the specification was updated and the service should now check the hash password using the MD5 algorithm.  Add another implementation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Md5LoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//  ... } }</span></span></code> </pre> <br><br>  Now you need to tell Weld that you need to substitute Md5LoginService at the injection point.  For this we use qualifier annotations.  The idea itself is very simple: when the container decides which implementation to implement, it checks the annotations at the point of injection and the annotations of possible implementations.  Checked annotations are called qualifiers.  The <a href="http://habrahabr.ru/users/javax/" class="user_link">specifier</a> is a regular java annotation, which is additionally annotated with <a href="http://habrahabr.ru/users/javax/" class="user_link">javax</a> .inject.Qualifier: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({FIELD, PARAMETER, TYPE, METHOD}) <span class="hljs-meta"><span class="hljs-meta">@Qualifier</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Hash { }</code> </pre> <br><br>  Now in the controller, let's proannatiruem the field in which the substitution will be made, as well as the implementation of Md5LoginService: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Hash</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Md5LoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Named</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestScoped</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-meta"><span class="hljs-meta">@Hash</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILoginService loginService; }</code> </pre> <br><br>  Now Weld will substitute the desired implementation.  Of course the question arises: each time to write a new annotation?  In most cases, this will have to be done, but this is a typesafe fee.  In addition, annotations can be aggregated, for example: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Hash</span></span> <span class="hljs-meta"><span class="hljs-meta">@Fast</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Md5LoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ILoginService</span></span></span><span class="hljs-class"> </span></span>{ } <span class="hljs-meta"><span class="hljs-meta">@Named</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestScoped</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-meta"><span class="hljs-meta">@Hash</span></span> <span class="hljs-meta"><span class="hljs-meta">@Fast</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILoginService loginService; }</code> </pre> <br><br>  Moreover, in order not to create a large number of identical annotations, you can extend the annotations with fields and Weld will take this into account: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>({FIELD, PARAMETER, TYPE, METHOD}) <span class="hljs-meta"><span class="hljs-meta">@Qualifier</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> Hash { <span class="hljs-function"><span class="hljs-function">HashType </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">value</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> HashType.SHA</span></span>; <span class="hljs-comment"><span class="hljs-comment">//    @Nonbinding       @Nonbinding String desc() default ""; } @Hash(HashType.MD5) public class Md5LoginService implements ILoginService { } @Named @RequestScoped public class LoginController { @Inject @Hash(HashType.MD5) private ILoginService loginService; }</span></span></code> </pre> <br><br>  Those.  for the example under consideration, we added a new field with an enumeration type indicating what kind of hashing algorithm it is.  Although I had to write a new annotation and enumeration, now it is almost impossible to make a mistake with the choice of the desired implementation, and the readability of the code has also increased.  You should also always remember that if an implementation does not have a specifier, then it is added by default to <a href="http://habrahabr.ru/users/javax/" class="user_link">javax</a> .enterprise.inject.Default. <br><br>  True, after the done manipulations, StubLoginService ceased to be substituted into the field.  This is due to the fact that it does not have the <a href="http://habrahabr.ru/users/hash/" class="user_link">Hash</a> specifier, so Weld does not even consider it as a possible implementation of the interface.  To solve this problem, there is one trick: the @Specializes annotation, which replaces the implementation of another bean.  To tell Weld what kind of implementation you need to replace, you just need to expand it: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Alternative</span></span> <span class="hljs-meta"><span class="hljs-meta">@Specializes</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">StubLoginService</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Md5LoginService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">login</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String name, String password)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre> <br><br>  Imagine that we have new requirements: when you try to enter a user in the system, you need to try to verify the password with all possible algorithms implemented in the system.  Those.  we need to go through all the interface implementations.  In Spring, this problem is solved through the substitution into the collection generalized to the desired interface.  In Weld, you can use the javax.enterprise.inject.Instance &lt;?&gt; Interface and the built-in qualifier <a href="http://habrahabr.ru/users/any/" class="user_link">Any</a> .  For now, disable the alternative implementations and see what happens: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Named</span></span> <span class="hljs-meta"><span class="hljs-meta">@RequestScoped</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-meta"><span class="hljs-meta">@Any</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Instance&lt;ILoginService&gt; loginService; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String login; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (ILoginService service : loginService) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (service.login(login, password)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"main.xhtml"</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"failed.xhtml"</span></span>; } }</code> </pre> <br><br>  The <a href="http://habrahabr.ru/users/any/" class="user_link">Any</a> annotation says that we do not care what specifiers can be in implementations.  The Instance interface implements Iterable, so you can do such beautiful things with it through foreach.  In general, this interface is not only for this.  It contains an overloaded select () method that allows you to select the desired implementation at runtime.  It takes annotation instances as parameters.  In general, this is now implemented somewhat ‚Äúunusually‚Äù, since you have to create anonymous classes (or create them separately, just to use them in one place).  This is partially solved by the abstract class AnnotationLiteral &lt;?&gt; From which you can expand and generalize to the required annotation.  In addition, Instance has special methods isUnsatisfied and isAmbiguous, with which you can check at runtime if there is a suitable implementation and only then get its instance through the get () method.  It looks like this: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-meta"><span class="hljs-meta">@Any</span></span> Instance&lt;ILoginService&gt; loginServiceInstance; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doLogin</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ Instance&lt;ILoginService&gt; tempInstance = isUltimateVersion ? loginServiceInstance.select(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationLiteral&lt;Hash&gt;(){}) : loginServiceInstance.select(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationLiteral&lt;Default&gt;(){}); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tempInstance.isAmbiguous() || tempInstance.isUnsatisfied()) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IllegalStateException(<span class="hljs-string"><span class="hljs-string">"    "</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tempInstance.get().login(login, password) ? <span class="hljs-string"><span class="hljs-string">"main.xhtml"</span></span> : <span class="hljs-string"><span class="hljs-string">"failed.xhtml"</span></span>; }</code> </pre> <br><br>  It is clear that in this case it was possible to loop through loginServiceInstance, as was done in the example above, and find the desired implementation by getClass (). Equals (), but then when changing implementations, we had to edit the code in this place too.  Weld represents a more flexible and secure approach, albeit adding a little new abstractions to learn. <br><br>  As noted above, Weld is guided by both the type and specifier when choosing the desired implementation.  But in some cases, for example with a complex inheritance hierarchy, we can specify the type of implementation manually using the @Typed annotation. <br><br>  This is all well and good, but what to do when we need to create an instance of a class in some tricky way?  Again, Spring in the xml context offers a rich set of tags for initializing properties on objects, creating lists, maps, etc.  Weld has for this only one annotation @Produces, which marks methods and fields generating objects (including scalar types).  Rewrite our previous example: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ApplicationScoped</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LoginServiceFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Serializable</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// @Factory -   @Produces @Factory public ILoginService buildLoginService() { return isUltimateVersion ? new Md5LoginService() : new LoginService(); } }</span></span></code> </pre> <br><br>  Now we specify through the specifier from where we want to get the implementation: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-meta"><span class="hljs-meta">@Factory</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ILoginService loginService;</code> </pre> <br><br>  That's all.  The source can be a regular field.  Substitution rules are the same.  Moreover, you can also inject bins into the buildLoginService method: <br><br><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Produces</span></span> <span class="hljs-meta"><span class="hljs-meta">@Factory</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ILoginService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildLoginService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @Hash(HashType.MD5)</span></span></span><span class="hljs-function"> ILoginService md5LoginService, ILoginService defaultLoginService) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isUltimateVersion ? md5LoginService : defaultLoginService; }</code> </pre> <br><br>  As you can see, the access modifier has no effect.  The objects generated by buildLoginService are not bound to the bin in which it is declared, so in this case it will be <a href="http://habrahabr.ru/users/dependent/" class="user_link">Dependent</a> .  To change this, simply add an annotation to the method, for example: <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Produces</span></span> <span class="hljs-meta"><span class="hljs-meta">@Factory</span></span> <span class="hljs-meta"><span class="hljs-meta">@SessionScoped</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> ILoginService </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">buildLoginService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( @Hash(HashType.MD5)</span></span></span><span class="hljs-function"> ILoginService md5LoginService, ILoginService defaultLoginService) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> isUltimateVersion ? md5LoginService : defaultLoginService; }</code> </pre> <br><br>  In addition, you can manually release the resources generated by @Produces.  For this, you will not believe, there is another annotation @Disposed, which works something like this: <br><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dispose</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@Disposes @Factory ILoginService service)</span></span></span><span class="hljs-function"> </span></span>{ log.info(<span class="hljs-string"><span class="hljs-string">"LoginService disposed"</span></span>); }</code> </pre> <br><br>  When the object's life cycle comes to an end, Weld looks for methods that satisfy the type and specifier of the generators method, as well as those marked @Disposed, and call it. <br><br><h4>  Conclusion </h4><br>  We have considered far from all the possibilities of JSR-299.  In addition, there are a number of additional specifiers, mechanisms for managing the life cycle of bins inside the container (interceptors, decorators), stereotypes, an event model, with which it is convenient to organize complex business logic and many more pleasant trifles. <br><br>  This article did not want to oppose Weld to other dependency injection frameworks, which were mentioned at the beginning.  Weld is self-sufficient and has an interesting implementation worthy of the attention of Java Enterprise developers. <br><br><h4>  Sources </h4><br>  <a href="http://jcp.org/en/jsr/detail%3Fid%3D299">JSR-299</a> <br>  <a href="http://seamframework.org/Weld/WeldDocumentation">Official Weld Documentation</a> <br>  <a href="http://blogs.oracle.com/enterprisetechtips/entry/using_cdi_and_dependency_injection">Excellent JSR-299 introductory article from Oracle engineer</a> <br>  A series of articles on CDI support in NetBeans in Russian ( <a href="http://netbeans.org/kb/docs/javaee/cdi-intro_ru.html">1</a> , <a href="http://netbeans.org/kb/docs/javaee/cdi-inject_ru.html">2</a> , <a href="http://netbeans.org/kb/docs/javaee/cdi-validate_ru.html">3</a> , <a href="http://netbeans.org/kb/docs/javaee/cdi-events_ru.html">4</a> ) </div><p>Source: <a href="https://habr.com/ru/post/136140/">https://habr.com/ru/post/136140/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136132/index.html">On the Kind - a resource that helps to interact with the world</a></li>
<li><a href="../136133/index.html">PowerShell 3 - Finally on the DLR!</a></li>
<li><a href="../136135/index.html">Full Unicode support in SQLite for iOS. Sample application</a></li>
<li><a href="../136137/index.html">CSS3 search</a></li>
<li><a href="../136138/index.html">Error handling scheme in Yii</a></li>
<li><a href="../136141/index.html">Funding Theory for a Startup</a></li>
<li><a href="../136142/index.html">FreeBSD 9.0 is out!</a></li>
<li><a href="../136143/index.html">A quick guide to the choice of manufacturer VKS</a></li>
<li><a href="../136146/index.html">Axis - online store do it yourself</a></li>
<li><a href="../136150/index.html">Manual ‚Äúoffline‚Äù adding and updating iOS 3.x & 4.x support in iOS Simulator SDK 5.x</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>