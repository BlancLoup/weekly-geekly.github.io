<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Learning to write userscript</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day to all who wish to join the world of user scripts (they are userscript , userJS , userscripts ). 

 In this article I want to talk about what...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Learning to write userscript</h1><div class="post__text post__text-html js-mediator-article"><img title="Greasemonkey Monkey" align="left" src="https://habrastorage.org/storage1/8094b499/01838337/42f164da/665183e0.gif">  Good day to all who wish to join the world of <a href="http://ru.wikipedia.org/wiki/Userjs">user scripts</a> (they are <b>userscript</b> , <b>userJS</b> , <b>userscripts</b> ). <br><br>  In this article I want to talk about what users users are, what they eat and, most importantly, <b>how they are cooked</b> ! <br><br>  <em>Warning:</em> assumes <b>minimal</b> knowledge of javascript. <br>  In practice, it has been proven: users can write users who are not familiar with programming, but possess the <em>assiduity and desire to</em> learn javascript! <br>  You can learn about javascript and how to handle it on <a href="http://javascript.ru/">javascript.ru</a> . <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  What are user scripts? </h2><br>  Briefly: a user script is a program written in JavaScript, stored on a user's computer and connected by a browser on certain pages.  A user script is a file with a <b>.user.js</b> extension (it is by extension that browsers understand that the file is a user script) containing metadata and javascript code directly. <br><br>  When connecting to a page, userscript is executed in the same way as regular javascript scripts. <br>  The user script has access to the DOM tree of the page in the context of which it is executed. <br>  In modern browsers, userscript has access to localStorage and other HTML5 APIs. <br><br>  User scripts are supported by <em>all major modern browsers</em> (and even <em>IE7 and higher</em> are supported somehow). <br><br>  The most famous user scripts portal is <a href="http://userscripts.org/">userscripts.org</a> .  Here you can find a script repository, tools for managing your scripts on the portal and, what is not unimportant, a <b>responsive forum</b> (all in English). <br><br><h2>  A bit of general theory </h2><br>  The most common are the scripts under <b>the GreaseMonkey extension for the Firefox browser</b> . <br>  Detailed information on GreaseMonkey and writing userscripts for GreaseMonkey can be found at <a href="http://wiki.greasespot.net/">http://wiki.greasespot.net</a> . <br>  It so happened historically that this browser was (and remains to this day) the first in which support for userscripts was performed at a high level. <br><br>  Not all scripts written for GreaseMonkey can run in other browsers.  The reason for the <s>curvature</s> is that many scripts use the <b>GM API</b> , a set of javascript functions specific to GreaseMonkey. <br><br>  However, the easiest way to write users scripts under the <b>Google Chrome browser</b> . <br>  There are several reasons for this: <br><ol><li>  Simple scripts do not need GM API support (library available in GreaseMonkey) </li><li>  Google Chrome, unlike Firefox + GreaseMonkey, has a great debugger. </li><li>  Error messages of user scripts in Firefox <b>are terrible!</b>  If you do not have the <s>gift of telepathy,</s> solid knowledge of GreaseMonkey and javascript, writing a user script can turn into torment! </li><li>  Google Chrome does not require extensions to support users scripts.  The interface for removing / disabling userscripts is available out of the box. </li></ol><br>  Obvious cons of Google Chrome: <br><ol><li>  No access to the "native" window. </li><li>  The @include metadata directive is not supported.  The @ match directive is buggy, we can say that it is also not supported. </li></ol><br><h2>  Features of userscript </h2><br>  The user scripts code can be viewed by anyone, armed with a notepad. <br>  Basic knowledge of javascript allows you to cut off the threat of installing spyware and malicious scripts by simply analyzing the script code (you have to use the brain). <br><br>  <b>Important:</b> <em>If you do not trust the author of the script, the main thing is to make sure that the script <b>does not send user data (cookies, entered text) to third-party services</b></em> ! <br><br>  All userscripts are launched after all the main elements of the page have loaded, but the pictures have not yet been loaded.  We can say that userscripts are loaded on the event <b>DOMContentLoaded</b> . <br>  In any case, <b>window.onload checks are not needed</b> . <br><br>  Each browser imposes its own restrictions on the execution of userscripts, but in general, <em>users can do almost everything that scripts on a page can do.</em> <br>  Most often, userscripts are used to change the page interface or to add buns, blackjack <s>and whores</s> (userscripts for social networks). <br>  There are also advanced userscripts, which are independent programs (auction and game bots, helper plugins, etc.). <br><br><h2>  Anatomy of userscripts </h2><br>  User Script is a text file with the extension user.js.  At the beginning of the file is a <em>block of metadata</em> - a description of the script itself.  After the block of metadata follows javascript-code, which will be executed by the browser. <br><br>  Consider a test script that shows an alert with text on a specific page. <br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ==UserScript== // @name myUserJS // @description     // @author Vasya Pupkin // @license MIT // @version 1.0 // @include http://userscripts.org/* // ==/UserScript== // [1]    ,   (opera, ie) (function (window, undefined) { // [2]  window var w; if (typeof unsafeWindow != undefined) { w = unsafeWindow } else { w = window; } //       javascript-. //      . //      w     window // :  jquery.min.js // (function(a,b){function ci(a) ... a.jQuery=a.$=d})(w); // [3]      //             if (w.self != w.top) { return; } // [4]     @include if (/http:\/\/userscripts.org/.test(w.location.href)) { //     alert("Userscripts    ."); } })(window);</span></span></code> </pre> <br><br>  <b>Important:</b> <em>This script is a wrapper for cross-browser user scripts.</em>  <em>The same script, but with English comments, can be pulled off <a href="http://pastebin.com/9CXXYYBX">pastebin.com</a></em> and used with impunity. <br><br>  At the very beginning there is a block of metadata (as a comment). <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ==UserScript== // ... // ==/UserScript==</span></span></code> </pre><br>  This block consists of user script <em>description</em> directives.  The table below shows the main directives and their purpose. <br><br>  <b>Important:</b> <em>All directives, as well as the metadata block itself, may be missing.</em> <br><br><table><tbody><tr><th>  Directive </th><th>  Purpose </th></tr><tr><td>  @ name </td><td>  The name of the user script. <br>  This name will be displayed in the management interface. <br>  userscripts.  If there is no directive, then the name <br>  user script will be the same as the file name. </td></tr><tr><td>  @ description </td><td>  Description of user script. <br>  This description will be displayed in the management interface. <br>  userscripts. </td></tr><tr><td>  @ namespace </td><td>  Namespace <br>  Defines the uniqueness of a set of scripts. <br>  Here you can enter the name of the domain that belongs to you.  Or any other line. <br>  Consider that this is the second name of the script.  <b>Mandatory directive for Trixie!</b> </td></tr><tr><td>  @ author </td><td>  Author's name. </td></tr><tr><td>  @ license </td><td>  The name of the license for which the user script is distributed. </td></tr><tr><td>  @ version </td><td>  Version number of user script. <br>  Unfortunately, there is no auto-update mechanism in any browser, <br>  therefore, the version number is just the numbers that are displayed on the interface. </td></tr><tr><td>  @include </td><td>  Directive describing the url of the page, <br>  on which you need to run userscript. <br>  Supports <em>wildcard *</em> (applicable in GreaseMoneky, Opera, IE). <br>  For each individual url, you need to use a separate @ include directive. </td></tr><tr><td>  @ exclude </td><td>  Directive describing the url of the page, <br>  where you <b>do not</b> need to run userscript. <br>  Supports <em>wildcard *</em> (applicable to GreaseMonkey, Opera, IE). <br>  For each separate url you need to use a separate @ exclude directive. </td></tr><tr><td>  @ match </td><td>  Same as @include, but with more stringent restrictions. <br>  (applicable to GreaseMonkey older than 0.9.8, Google Chrome). <br>  You can learn more about restrictions and directive format. <br>  read on <a href="http://code.google.com/chrome/extensions/match_patterns.html">this page</a> . <br>  For each separate url you need to use a separate @ match directive. </td></tr></tbody></table><br><br>  <b>Important:</b> <em>As practice has shown, you should not rely on the @ match directive in userscripts.</em> <em><br></em>  <em>Google Chrome periodically refuses to consider @ match</em> <em><br></em>  <em>and launches userscripts on all pages.</em> <em><br></em>  <em>To prevent this situation in userscripts,</em> <em><br></em>  <em>that will run not only in Firefox,</em> <em><br></em>  <em>You need to add a code to check the address of the page <font color="gray">(see link [4] in the code of userscript)</font> .</em> <br><br>  <b>Important:</b> <em>In the absence of @ include or @ match directives, userscripts will run <b>on all pages</b> .</em> <br><br>  A number of tricks are used in our user script: <br><ol><li>  In order for userscripts to have the same behavior and not to pollute the global scope, the code <em>turns into a closure</em> <font color="gray">(see [1] in the script code)</font> . </li><li>  To properly connect libraries inside userscript and to bypass some tricky features of GreaseMonkey, <em>it is necessary to ‚Äúnormalize‚Äù the link to the window's global scope</em> <font color="gray">(see [2] in the script code)</font> . </li><li>  In order for the user script not to run several times on the same page, it is necessary to <em>stop the work when the user script is started in frames</em> <font color="gray">(see [3] in the script code)</font> . </li><li>  In order for the user script to run only on the pages we need, it is necessary to explicitly check the url of the page <font color="gray">(see [4] in the script code)</font> . </li><li>  Thanks to this structure, user scripts can be relatively easily converted to a <a href="http://ru.wikipedia.org/wiki/%25D0%2591%25D1%2583%25D0%25BA%25D0%25BC%25D0%25B0%25D1%2580%25D0%25BA%25D0%25BB%25D0%25B5%25D1%2582">bookmarklet</a> . </li></ol><br><h2>  Result </h2><br>  Our user script is ready to use! <br>  No, seriously, you can copy the user script code to a file, name it my.user.js, and drop the resulting file into the browser (use Chrome or Firefox with GreaseMonkey installed). <br><br>  Of course, our user script does not have serious functions, the code looks scary and unattractive (for the uninitiated person).  But in the end we got a template for <b>cross-browser users scripts</b> . <br>  This means that userscript can be run in almost any modern browser! <br>  And that's great! <br><br>  The question remains: how to ‚Äúdistribute‚Äù our script to users (after all, we wrote the script not only for ourselves)? <br>  Options: <br><ul><li>  Register on the <a href="http://userscripts.org/">userscripts.org</a> portal and upload the scripts there. <br></li><li>  Create a repository on <a href="http://code.google.com/">code.google.com</a> or <a href="http://github.com/">github.com</a> . <br></li><li>  Create your own simple service / website / page. <br>  <b>Important:</b> <em>If you want GreaseMonkey users to automatically open the user scripts installation dialog, <b>give the file straight from the file system</b> (the file url should end in .user.js).</em>  <em>Otherwise, the user will see the source code of the script and the panel with the ‚Äúinstall‚Äù button.</em>  <em><b>This button does not work!</b></em> <br></li></ul><br>  The recipe for non-programmers (~ 70% of scripts are written using similar methods): <br><ol><li>  We think of what our userscript will do (repaint links, for example) </li><li>  We take a template from the article </li><li>  Save to my.user.js file </li><li>  Delete the line with <b>alert (...)</b> . </li><li>  Go to the forum (userscripts.org or any javascript forum). </li><li>  We spam, flood and reach people with questions like ‚Äúrepaint links‚Äù, ‚Äúgive code‚Äù, etc. </li><li>  We change the metadata and check the url of the page to the ones we need. </li><li>  We insert the code received on the forum into userscript. </li><li>  Save the file. </li><li>  ... </li><li>  PROFIT !! 1! </li></ol><br>  Useful links: <br><ul><li>  <a href="http://userscripts.org/">Userscripts.org</a> <br></li><li>  <a href="http://wiki.greasespot.net/">wiki.greasespot.net</a> <br></li><li>  <a href="http://arantius.com/misc/greasemonkey/script-compiler">Userscript -&gt; Firefox Extension Compiler</a> <br></li><li>  <a href="http://greasemonkey.mozdev.org/authoring.html">Writing userscripts</a> <br></li><li>  <a href="http://code.google.com/chrome/extensions/match_patterns.html">@ Match directive rules</a> <br></li></ul><br><br><hr><br>  List of articles: <br><ol><li>  ¬ª <b>Learning to write userscript</b> </li><li>  <a href="http://habrahabr.ru/blogs/javascript/129454">Userscripts.</a>  <a href="http://habrahabr.ru/blogs/javascript/129454">Deepen.</a> </li><li>  <a href="http://habrahabr.ru/blogs/javascript/130436/">Userscripts.</a>  <a href="http://habrahabr.ru/blogs/javascript/130436/">We pack user scripts for Chrome</a> </li><li>  <a href="http://habrahabr.ru/blogs/javascript/130673/">Usersctripts.</a>  <a href="http://habrahabr.ru/blogs/javascript/130673/">Cross Domain Queries</a> </li></ol><br><br>  PS I would like to see the Userscripts blog on Habr√©.  For no one GreaseMonkey one. </div><p>Source: <a href="https://habr.com/ru/post/129343/">https://habr.com/ru/post/129343/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129338/index.html">Video: Sony Ericsson Xperia Mini and Xperia Ray - how to disassemble and what they consist of</a></li>
<li><a href="../129339/index.html">Autumn events in the field of information security</a></li>
<li><a href="../129340/index.html">Tests on non-standard thinking</a></li>
<li><a href="../129341/index.html">Do you use SSL certificates for your domains?</a></li>
<li><a href="../129342/index.html">LiveStreet and ORM</a></li>
<li><a href="../129344/index.html">Rendering Python directories with NetworkX</a></li>
<li><a href="../129346/index.html">Analysis of software performance using mathematical experiment planning</a></li>
<li><a href="../129349/index.html">BitTorrent learns to "get out of the way", giving the channel for other purposes</a></li>
<li><a href="../129350/index.html">Samsung Galaxy Tab 7.7 - Attempt # 2</a></li>
<li><a href="../129351/index.html">In Skitch for Android appeared framing and smoothing lines</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>