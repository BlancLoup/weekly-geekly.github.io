<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>10 Tips to improve Linq2Sql performance</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 
 If you are going to use LINQ in projects, you should learn how to speed up the work of this technology. 

 The points: 


1. Disable Objec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>10 Tips to improve Linq2Sql performance</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br>  If you are going to use LINQ in projects, you should learn how to speed up the work of this technology. <br><a name="habracut"></a><br>  The points: <br><ol><li>  Disable ObjectTracking - we are already in use. </li><li>  Spread unrelated tables by different datacontext.  Reducing the size of the data context will reduce the amount of used memory and operations to control changes to objects. <br></li><li>  Use CompiledQuery - I think there will be a gain, just what?  <a href="http://blogs.msdn.com/ricom/archive/2008/01/14/performance-quiz-13-linq-to-sql-compiled-query-cost-solution.aspx">Here</a> you can see the results of compiled vs uncompiled LINQ queries. <br>  In a nutshell - there is an increase, depending on the frequency of similar requests from 10% to 70% <br><br>  Example of a compiled query: <br>  <font color="black">Func &lt;NorthwindDataContext, <font color="#2B91AF">IEnumerable</font> &lt;Category &gt;&gt; func =</font> <font color="black"><br></font>  <font color="black">CompiledQuery.Compile &lt;NorthwindDataContext, <font color="#2B91AF">IEnumerable</font> &lt;Category &gt;&gt;</font> <font color="black"><br></font>  <font color="black">((NorthwindDataContext context) =&gt; context.Categories.</font> <font color="black"><br></font>  <font color="black">Where &lt;Category&gt; (cat =&gt; cat.Products.Count&gt; 5));</font> <br><br>  Further, you can create a static class with a set of these compiled queries: <br>  <font color="black"><font color="#008000">/// &lt;summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// Utility class to store compiled queries</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;/ summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> QueriesUtility</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// Gets the query for returns products.</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;/ summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;value&gt; The query containing the categories. &lt;/ value&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> Func &lt;NorthwindDataContext, <font color="#2B91AF">IEnumerable</font> &lt;Category &gt;&gt;</font> <font color="black"><br></font>  <font color="black">GetCategoriesWithMoreThanFiveProducts</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">get</font></font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">Func &lt;NorthwindDataContext, <font color="#2B91AF">IEnumerable</font> &lt;Category &gt;&gt; func =</font> <font color="black"><br></font>  <font color="black">CompiledQuery.Compile &lt;NorthwindDataContext, <font color="#2B91AF">IEnumerable</font> &lt;Category &gt;&gt;</font> <font color="black"><br></font>  <font color="black">((NorthwindDataContext context) =&gt; context.Categories.</font> <font color="black"><br></font>  <font color="black">Where &lt;Category&gt; (cat =&gt; cat.Products.Count&gt; 5));</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> func;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The use of this class will be as follows: <br>  <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> categories = QueriesUtility.GetCategoriesWithMoreThanFiveProducts (context);</font> <font color="black"><br></font>  <font color="black">}</font> <br><br>  In addition, maintaining many queries in one place will avoid duplicating code and easier support. <br><br></li><li>  Using DataLoadOptions.AssociateWith - the point is not to use LazyLoading, but load the related tables immediately.  But to load not all data, but only on a certain condition. <br><br>  <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">DataLoadOptions options = <font color="#0000ff">new</font> DataLoadOptions ();</font> <font color="black"><br></font>  <font color="black">options.AssociateWith &lt;Category&gt; (cat =&gt; cat.Products.Where &lt;Product&gt; (prod =&gt;! prod.Discontinued));</font> <font color="black"><br></font>  <font color="black">context.LoadOptions = options;</font> <font color="black"><br></font>  <font color="black">}</font> <br><br></li><li>  Use Optimistic concurrency - add a TimeStamp type field to each table - thus LINQ itself will be responsible for concurrency.  In addition, using this approach, you can transfer an entity from one datacontext.  If the Optimistic Concurrency application is not needed, it can be disabled.  In the properties of the Entity in the designer, set UpdateCheck equal to UpdateCheck.Never <br><br></li><li>  Monitor queries generated by LINQ.  Most of the queries will be generated on the fly, so, like most of the MS design generators, LINQ can generate a not entirely optimal query ‚Äî pull up extra columns, for example.  Logging is very simple - <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">context.Log = <font color="#2B91AF">Console</font> .Out;</font> <font color="black"><br></font>  <font color="black">}</font> <br><br>  At work, we use DataContextManager, through which we create all datacontexts, so it will be even easier to bind logging to the entire application: <br>  <font color="black"><font color="#0000ff">internal</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> DataContextManager</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">static</font> DataContextType Create &lt;DataContextType&gt; ( <font color="#0000ff">bool</font> readOnlyAccess)</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">where</font> DataContextType: DataContext, <font color="#0000ff">new</font> ()</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">DataContextType dc = <font color="#0000ff">new</font> DataContextType ();</font> <font color="black"><br></font>  <font color="black"><font color="#008000">// DebugWriter is a TextWriter that writes to DebugInfo.txt file</font></font> <font color="black"><br></font>  <font color="black">dc.Log = Common.Logging.Logger.DebugWriter;</font> <font color="black"><br></font>  <font color="black">dc.ObjectTrackingEnabled =! readOnlyAccess;</font> <font color="black"><br></font>  <font color="black">dc.DeferredLoadingEnabled = <font color="#0000ff">false</font> ;</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> dc;</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <br><br></li><li>  Use the Attach method only when you really need it.  For example, do not use AttachAll for collections, but check each object in the collection for changes and bind / not bind it. </li><li>  Be more attentive when working with object change control.  When working with datacontext in read mode, simple queries can create additional resource costs.  For example, a very simple query: <br>  <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> a = <font color="#0000ff">from</font> c <font color="#0000ff">in</font> context.Categories</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">select</font> c;</font> <font color="black"><br></font>  <font color="black">}</font> <br><br>  However, this query will spend more resources than the following: <br>  <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">var</font> a = <font color="#0000ff">from</font> c <font color="#0000ff">in</font> context.Categories</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">select</font> <font color="#0000ff">new</font> Category</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black">CategoryID = c.CategoryID,</font> <font color="black"><br></font>  <font color="black">CategoryName = c.CategoryName,</font> <font color="black"><br></font>  <font color="black">Description = c.Description</font> <font color="black"><br></font>  <font color="black">};</font> <font color="black"><br></font>  <font color="black">}</font> <br><br>  Why?  Because in the first Object Tracking is still working, while in the second LINQ just gives you objects and forgets about them. <br><br></li><li>  Get only the required number of lines using the Take and Skip methods.  Standard script for paging: <br><br>  <font color="black"><font color="#008000">/// &lt;summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// Gets the products page by page.</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;/ summary&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;param name = ‚ÄùstartingPageIndex‚Äù&gt; Index of the starting page. &lt;/ param&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;param name = ‚ÄùpageSize‚Äù&gt; Size of the page. &lt;/ param&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#008000">/// &lt;returns&gt; The list of products in the specified page &lt;/ returns&gt;</font></font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">private</font> IList &lt;Product&gt; GetProducts ( <font color="#0000ff">int</font> startingPageIndex, <font color="#0000ff">int</font> pageSize)</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">using</font> (NorthwindDataContext context = <font color="#0000ff">new</font> NorthwindDataContext ())</font> <font color="black"><br></font>  <font color="black">{</font> <font color="black"><br></font>  <font color="black"><font color="#0000ff">return</font> context.Products</font> <font color="black"><br></font>  <font color="black">.Skip &lt;Product&gt; (startingPageIndex * pageSize)</font> <font color="black"><br></font>  <font color="black">.Take &lt;Product&gt; (pageSize)</font> <font color="black"><br></font>  <font color="black">.ToList &lt;Product&gt; ();</font> <font color="black"><br></font>  <font color="black">}</font> <font color="black"><br></font>  <font color="black">}</font> <br><br>  "Premature optimization is the root of all evil."  That said Donald Knut. <br>  So be careful, especially when using CompiledQuery.  LINQ queries are not compiled as Regex.  Compiling a LINQ query creates an in-memory object that already has a SQL query and a delegate to work with it. <br><br>  In principle, Knut's words refer to any optimizations, so it‚Äôs not worthwhile to optimize everything in succession.  The best way out is to try the approach and see if it brings real benefits. <br><br></li>  - allows you to quickly write code with LINQ and analyze its implementation and results </ol></div><p>Source: <a href="https://habr.com/ru/post/47336/">https://habr.com/ru/post/47336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../47329/index.html">An example of displaying images using ImageField and Lightboox2</a></li>
<li><a href="../47331/index.html">The easiest way to download videos from YouTube</a></li>
<li><a href="../47332/index.html">Questions about making money on the Internet.</a></li>
<li><a href="../47333/index.html">Cartoon "Gypsy": An animator is the son of an animator ...</a></li>
<li><a href="../47335/index.html">Dell's Adamo hits MacBook Air</a></li>
<li><a href="../47337/index.html">TagSphere plugin</a></li>
<li><a href="../47339/index.html">Top best flash-studios in Russia 2008</a></li>
<li><a href="../47340/index.html">Greatness fonts</a></li>
<li><a href="../47342/index.html">Mom, I'll be a usability!</a></li>
<li><a href="../47344/index.html">Chrome's aggressive promotion has begun</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>