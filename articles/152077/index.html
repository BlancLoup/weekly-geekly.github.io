<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Atypical story "house" provider</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The story originates back in 2004, when affordable Internet access in cities with a population of less than a million was rare. In those days, the ‚Äúho...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Atypical story "house" provider</h1><div class="post__text post__text-html js-mediator-article">  The story originates back in 2004, when affordable Internet access in cities with a population of less than a million was rare.  In those days, the ‚Äúhome‚Äù networks in which ‚Äúproviders‚Äù existed were usually very popular ‚Äî usually students who installed a satellite dish and set up a server to distribute traffic.  I also wanted to participate in this ... <br><br><img src="http://www.habrastorage.com/images/123cyc.jpg" alt="image"><br><a name="habracut"></a><br>  <b>2004</b> <br>  It will be about the city of N-sk, in which lives a little more than half a million people.  I will not go into the base part of the organization of access in detail - everything was standard: I wanted to earn money and gain experience in administration after entering university.  He connected to the local home network, in which there were about 150 people.  The houses already had ADSL, installed a satellite dish, bought the necessary equipment, connected to the traffic tariff from a satellite provider (PlanetSky).  Since I was familiar with Linux, the server was organized under Debian.  I used a free solution for billing - Neon Internet Billing System. <br><br>  <b>2005 year</b> <br>  The home network was growing, and a couple of nearby networks were connected.  Therefore, the number of subscribers has increased - it was necessary to refine the billing.  Instead of the traffic tariff from the satellite operator, it became more profitable to take the conditional unlimited limit for several megabits (SatGate).  For the final consumer, prices were from 30 kopecks to a ruble, depending on the time of day (for comparison, local providers offered from 3 to 7 rubles).  Reception of payment was still made according to the principle came with a money - put on the account. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>2006</b> <br>  The home network continued to grow.  Also, several networks were connected via radio.  The most expensive conditional unlimited satellite provider has ceased to cope - it was decided to buy a dedicated band.  The choice fell on RuSat, as the most affordable.  Due to this, there was a great opportunity to install a set of ADSL + antenna + server in other remote networks of the city - that point ‚Äúflopped‚Äù in the same dedicated band.  So several more networks were connected.  Subscribers became even more, connection points too.  Under the previous scheme, it was impossible to accept payment.  I modified the billing system - an automated process for generating access cards was organized.  Cards were printed on thick paper with a color laser printer, laminated, sheets were cut, the corners were rounded.  Scratch-panel was attached to the place of the password.  They looked like this (the photo was taken in those years on the E-ten M600 communicator, therefore the quality is appropriate): <br><img src="http://www.habrastorage.com/images/dc07040600.jpg" alt="image"><br><br>  <b>2007</b> <br>  Subscriber base has become even more.  It took expansion of the channel from the satellite operator.  RuSat refused, because they had the entire band on the satellite already distributed.  It was decided not to resort to satellite providers, but to install a server in the data center and conclude an agreement with the teleport to get its own band on the satellite.  It already allowed to connect clients across all Russia.  No sooner said than done.  The first connections went, but in this situation the card went wrong.  After a couple of months, TV people came to the satellite and drove everyone away, as they were willing to pay much more.  In addition, local providers began to launch the first unlimited - 128 kbit / s of honest no limit for 1000 rubles.  With satellite "ping" and the prices they will not make a competition. <br><br>  One of the local federal Ethernet providers allowed to conclude several contracts for one address, and also allowed to ‚Äúraise‚Äù a PPPoE session with a login from another address.  The picture in my head took shape quickly.  I sent 30 friends to conclude ten contracts.  In the end, I received 300 PPPoE connections at 128 kbit / s each.  It remained to somehow combine them into one big channel. <br><br>  I rented a physical server in a data center in Moscow and wrote a tun / tap-based Linux kernel module that added a virtual network interface to the system.  One such interface was on my server, another on the Moscow server, all client traffic was sent to them.  Every first network packet that got into this interface was sent on the first PPPoE connection from one server to another, every second packet was sent on the second PPPoE connection, and so on cyclically.  Thus, I received an unlimited channel a little more than 30 Mbps (taking into account the overhead of the tunnel). <br><br>  On the way I met three major problems: <br><br>  The first is mixing packages.  That is, from the Moscow server the packages went in the order of 1, 2, 3, 4, 5, 6 ..., and on my server because of the shaper of the local provider they came at different times and the order could turn out like this: 3,2,5,1 , 6.4 ... As a result, many users received the same 128 kbps as a download, because the Windows TCP stack digests this sequence badly.  A packet sorter was written to the kernel module, which accumulated a small buffer from the packets and sent them to clients in the correct order. <br><br>  The second problem was that the standard Linux shaper with a large number of static rules, a large amount of traffic and a large bandwidth (rules added at 800 Mb / s, and the channel is only 30 Mb / s) started shaping incorrectly.  I had to write a module for Linux tc, which dynamically added / deleted rules in the shaper on the Moscow server, depending on its activity on the network interface. <br><br>  The third problem was the monthly ratio of outgoing / incoming traffic on the Moscow server - at that time they demanded 1 to 3. For deviation from this ratio to the lower side, they demanded a surcharge of 30 rubles for each gigabyte of excess, and the traffic was measured in terabytes.  Since the server was just a gateway, the traffic ratio was 1 to 1. Torrents were a simple solution.  Popular content was uploaded to the server and distributed in the console torrent client.  Terabytes of sideroar traffic on popular trackers of the country were provided. <br><br>  The result was excellent prices for the end user: 256 and 512 kbps of honest no-limit for 500 and 700 rubles, respectively.  In such a light, 128 kbps on average for 1000 rubles from local operators looked unattractive.  I also had traffic and conditionally unlimited tariffs. <br><br>  <b>2008</b> <br>  In the city, I was seriously competing with local providers - they began an active offensive through the authorities.  In addition, for the year of my work, the provider through which my channel worked began to notice that among his clients there are a couple dozen people who have ten contracts each, and each contract pumps the most volume around the clock, which makes up a decent share of their traffic.  At the same time in the city there was a big drop in prices for no limit.  All these circumstances forced me to stop the activity. <br><br>  <b>UPD:</b> According to numerous requests in the near future the article will be supplemented with detailed information, photos, graphs and diagrams.  Thanks for the feedback! </div><p>Source: <a href="https://habr.com/ru/post/152077/">https://habr.com/ru/post/152077/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../152070/index.html">The tenth meeting of mobile developers ADCSpb</a></li>
<li><a href="../152071/index.html">And what do you know about high loads: part two</a></li>
<li><a href="../152072/index.html">Six ways to win your customers' trust</a></li>
<li><a href="../152075/index.html">2 free paper templates for mobile app prototyping</a></li>
<li><a href="../152076/index.html">Kindle 3 upgrade to version 3.4</a></li>
<li><a href="../152078/index.html">Passbook earned in Russia</a></li>
<li><a href="../152079/index.html">Graph database Neo4j in PHP</a></li>
<li><a href="../152080/index.html">Reverse tethering (get internet on android from linux pc)</a></li>
<li><a href="../152081/index.html">Apple invites former Google Maps employees to work</a></li>
<li><a href="../152082/index.html">Ubuntu 12.10 will advertise and music store</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>