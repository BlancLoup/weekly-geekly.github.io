<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Script-server. WebUI to run your scripts remotely</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello. In this article I would like to tell you about your home project. In short: Script server is a web server to provide users with access to your ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Script-server. WebUI to run your scripts remotely</h1><div class="post__text post__text-html js-mediator-article">  Hello.  In this article I would like to tell you about your home project.  In short: Script server is a web server to provide users with access to your scripts through a web interface.  The server and scripts are run locally, and are parameterized and displayed remotely. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/files/7de/dda/d32/7deddad32683429e8903690aa4ae331c.png"></div><br><a name="habracut"></a><br><h2>  Prehistory </h2><br>  At the new place of work, my first tasks were very routine and monotonous.  Schematically, they looked like this: <br><br><ol><li>  Create file my_file.txt </li><li>  Register there new configuration </li><li>  Apply to server </li><li>  Check out </li></ol><br>  There were more steps and they were more complicated, but after a couple of such iterations, laziness triumphed and shell scripts were written for all repetitive tasks that were run with several parameters and sometimes requested additional input data in the process.  At the same time, the workflow began to look something like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li>  ask the project manager the necessary parameters </li><li>  run the script </li><li>  report readiness </li></ol><br>  All these points were obviously asking for one to collapse so that the project manager would specify the parameters and run the script himself.  But giving him scripts was very problematic for a number of reasons - the scripts were adapted to my environment, they could fail, they were friendly enough for me, but not for non-technical people, etc. <br><br>  It must be said that by a certain moment such tasks had already ceased to be assigned to me and the created scripts had a very illusive future without the necessary adaptation. <br><br>  Therefore, I decided to create a tool that would allow remotely launching my scripts to other people, without the need to create the necessary environment and in a more convenient form to customize their launch. <br><br><h2>  On the way of creation </h2><br><h4>  Scheme of work </h4><br><div style="text-align:center;"><img src="https://habrastorage.org/files/64b/039/c18/64b039c185de4b9a8793b16bc9992ba1.png"></div><br>  The server administrator (i) creates configuration files for each script, which describes the purpose of the script, the launch path and the required parameters.  These configuration files are used by the server to provide data about the scripts to the user, as well as to run them.  Information on the user page is transmitted by Ajax requests. <br><br>  The user fills in the parameters and runs the script on the server, where its execution is passed to a special handler.  The handler accepts input in asynchronous mode and provides output, and also monitors the script execution process. <br><br>  The web server serves as a layer between this handler and the page, and it communicates through web sockets. <br><br><h4>  Selection of tools </h4><br>  At that time I was learning Python and decided to use it for development, as a good practice.  Python 3 was chosen for the project, without support for version 2, since there is no need for this, and I did not want to waste time. <br><br>  At the beginning of development for the server, I used Flask, but could not do ( <i>read to understand</i> ) the asynchronous connection and disconnection tracking of clients, so I quickly transferred everything to Tornado. <br><br>  With regards to web development: there is no web developer out of me, so here I also decided to practice a little in syntax and basics.  In this regard, almost no frameworks and libraries were used, with the exception of materializecss for more or less decent design. <br><br>  A web page is a ‚Äúone-page application‚Äù with a minimum of HTML and content creation in JS by Ajax requests. <br><br><h4>  First operation and improvements </h4><br>  About a month later I had a server that could somehow be used and I shared it with fellow developers, who also had to perform these routine tasks (which, unfortunately, almost ended in this period). <br><br>  During operation, both bugs and obviously missing elements were discovered, on which I gradually worked and improved.  At the same time, minor improvements were added, such as parameter types, logging of all launches, etc. <br><br>  <b>An interesting point:</b> for some small tasks (related to working in the console and with scripts), I also stopped using the console, and switched to this UI.  Those.  I have got several configuration scripts that I use more often than other people. <br><br><h4>  Real user operation </h4><br>  After some time of local testing (by me and other developers), the tool was finally provided to the project manager, who began to use it little by little.  And it should be noted that he is very pleased, because  it saves including his time.  The process of "implementation" and user training took about 5 minutes. <br><br>  Due to the peculiarities of the processes and limitations, the Script server is mainly used for the test environment.  But some of its parts have already been used for Production (in the part where it is safe). <br><br><h2>  Main stones </h2><br>  Below is a list of the problems and my personal discoveries that I remembered the most. <br><br>  Transfer of output from the script execution process to the page in asynchronous mode.  This was due to a lack of experience in both Flask and the web: how best to organize such a transfer.  As a result, I implemented data transfer in the form of data (type and data) on the websockets.  Also in events you can send other commands at runtime, but for now this is not used. <br><br>  Transfer user input to executable script.  I tried to make a request for input only while waiting for one in the script, but could not find a way.  Therefore, during the execution of the script, users can enter as much information as they want (the usual terminal behaves the same way).  Data is sent via the same web socket. <br><br>  Track user disconnection.  It was precisely because of this problem that Flask refused: at that moment I was doing it on SSE (almost), not on websockets.  However, later I did transfer the input / output transfer of the script to the web sockets, so maybe Flask would do.  In Tornado, you can just subscribe to the closure of the website. <br><br>  Read script execution output.  There was a problem in order to read only the current available data and send it to the client.  It is impossible to read in rows, because  for example, ‚Äúread -p input_prompt‚Äù does not transfer to the next line.  You can read by symbols, but you should not send so many requests to the client.  Reading the buffer gives the string truncated in obscure places (and also in the case of UTF-8, this generates the wrong characters).  The current solution is replete with a set of compromises and crutches, but in general it is a read-by-byte reading that disables read locks. <br><br>  Output scripts in (non) terminal mode.  Honestly for me it was a discovery: the output of scripts can be different if you run them in a terminal or out.  For example, the same ... <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">read</span></span> -p input_prompt</code> </pre> <br>  ... shows <i>input_prompt</i> only in terminal mode.  It is not very good to expect anything from users without showing them exactly what.  I had to deal with pty to deceive the scripts being run.  For this reason, I now have two types of wrappers for running scripts: with and without terminal support.  The first is enabled by default, the second can be enabled using the configuration (left it just in case the terminal mode fails). <br><br>  Autoscroll script output.  On the one hand, this is solved quite simply, on the other hand, there were problems with setting up automatic shutdown of this (if the user scrolls manually or selects text), as well as with a shadow, user input, etc.  Nothing extraordinary, but I had to spend a few hours. <br><br>  Setting the panel with the output of the script so that it takes up all the available space, but it never went beyond the window.  Thus, the page always fits in the window and the only scroll is added inside the output panel.  For me it was especially important, because  I absolutely do not like scrolls in scrolls. <br><br>  Page performance with a very large amount of script output.  Here with me the following code played a cruel joke: <br><br><pre> <code class="javascript hljs">htmlElement.innerText += <span class="hljs-string"><span class="hljs-string">"text"</span></span>;</code> </pre> <br>  The fact is that getting <i>innerText</i> is in itself a rather resource-intensive operation that tries to present the incoming html as a string, even if it is just text.  If you call this operation a couple of hundred times and for a thousand characters, the effect is not noticeable, but in my case there was much more data and the browser just hung for a few minutes from such a load.  I decided to change the code to the following: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> textNode = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createTextNode(<span class="hljs-string"><span class="hljs-string">"text"</span></span>); htmlElement.appendChild(textNode);</code> </pre> <br>  Hanging processes i.  no one does anything, but the executable script hangs in the processes.  The reasons were different, for example: the user closed the page, and the server does not handle this.  Or not a closed file descriptor.  Or unclosed child processes.  And that's not counting other obvious bugs.  But eliminated by google, study and correction. <br><br><h2>  Security </h2><br>  She's not at all.  This tool is designed for local launch and work in the local network with trusted users.  Since scripts are often also written for themselves, they are also not particularly protected.  Accordingly, before starting such a server, you need to be 100% confident in the firewall and users. <br><br>  From the point of view of data hiding, there is also nothing in the Script server at the current moment.  It is not recommended to include passwords as parameters or into the configuration, since they will be logged and stored in a pure form. <br><br><h2>  Examples and screenshots </h2><br>  For debugging in the project, I started test configurations that can be used for testing and demonstration.  In this section, all provided screenshots will be based on them. <br><br><h4>  Script Configuration </h4><br>  A relatively standard bash script with parameters, user input during operation and printing: <a href="">Write file</a> . <br><br>  A simple python script that displays a wall of text, breaking it into paragraphs and querying user input: <a href="">Destroy world</a> .  This configuration is used to debug the user interface when displaying parameters.  Contains all possible types of parameters: <a href="">Parameterized</a> <br><br><h4>  Screenshots </h4><br><h5>  Full Screen </h5><br><img src="https://habrastorage.org/files/26c/f84/3f4/26cf843f4a6945dca2adb41fcf8aef67.png"><br><br>  On the left is the script selection area, on the right is information on the current open script: <br><br><ul><li>  Title </li><li>  Description </li><li>  Parameter list </li><li>  Start / Stop Buttons </li><li>  Script output </li></ul><br><h5>  Parameter Bar </h5><br><img src="https://habrastorage.org/files/1b8/5b6/86c/1b85b686cefd4909af18db710ecf8d2f.png"><br><br>  In this chaos, you can see a family of different types of parameters: mandatory, lists, numbers, booleans.  Screenshot created based on <a href="">Parameterized</a> configuration <br><br><h5>  Input / output panel </h5><br><img src="https://habrastorage.org/files/374/f86/f9a/374f86f9ac844043a2c0fb17cd7726cc.png"><br><br>  Top button to start and stop.  Since the script is running, only the last one is active.  Below is the output panel of the script, at the very bottom of the input field.  The output panel is compressed in height for a demo purpose, in a normal window it is much higher. <br><br><h2>  Further steps </h2><br>  At the moment, the development is not conducted, because  in its current form, the Script server fully covers the tasks assigned to it.  I also see no need to optimize anything in the current interface.  Thus, we are both waiting for new challenges and problems. <br><br>  In particular, I would be very happy if this tool was also useful to someone from the community and I would have a need for new improvements. <br><br>  ¬ªLink to the project repository: <a href="https://github.com/bugy/script-server">github.com/bugy/script-server</a> <br><br>  List of used libraries / frameworks / thanks: <br><br><ul><li>  materializecss - <a href="http://materializecss.com/">materializecss.com</a> </li><li>  tornado - <a href="http://www.tornadoweb.org/">www.tornadoweb.org</a> </li><li>  Special thanks to my former colleague for the support and help in solving some web problems, especially concerning the layout. </li></ul><br>  Thanks to all those who took the time to read this article.  I would appreciate valuable comments and criticism (in terms of approach, application or implementation features). </div><p>Source: <a href="https://habr.com/ru/post/309518/">https://habr.com/ru/post/309518/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../309508/index.html">What is a convolutional neural network</a></li>
<li><a href="../309510/index.html">A selection of materials about clouds, data centers and the development of services</a></li>
<li><a href="../309512/index.html">DataArt and GDG invite to RIF-Voronezh 2016</a></li>
<li><a href="../309514/index.html">Focusing on VDI: NetApp All-Flash FAS Storage System</a></li>
<li><a href="../309516/index.html">Future sites: automatic assembly based on AI and not only</a></li>
<li><a href="../309520/index.html">Excursion to the data center NORD-4</a></li>
<li><a href="../309522/index.html">Super Mario World Method: Obstacle Series</a></li>
<li><a href="../309526/index.html">WebGL + WebAudio = Tower Defense</a></li>
<li><a href="../309528/index.html">How to create working rules and instructions without making enemies</a></li>
<li><a href="../309530/index.html">Google updated Android</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>