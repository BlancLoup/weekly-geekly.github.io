<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Netplan and how to cook it properly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Ubuntu is an amazing operating system, it has not worked with Ubuntu server for a long time and there was no point in updating your Desktop from a sta...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Netplan and how to cook it properly</h1><div class="post__text post__text-html js-mediator-article">  Ubuntu is an amazing operating system, it has not worked with Ubuntu server for a long time and there was no point in updating your Desktop from a stable version.  And not long ago I had to deal with the latest release of Ubuntu server 18.04, to my surprise there was no limit when I realized that I was infinitely behind the times and could not configure the network because the good old system for configuring network interfaces using the / etc / network file editing tools / interfaces has sunk into mite.  And what came to replace it?  something terrible and at first glance completely incomprehensible, meet ‚ÄúNetplan‚Äù. <br><br><a name="habracut"></a>  Frankly, at first I couldn‚Äôt understand what was the matter and why it was necessary, because everything was so convenient, but after getting a little practice I realized that it has its own charm. And so the lyrics are enough to continue what Netplan is a new utility to configure the network in Ubuntu, at least ‚Äúin other distributions I have not seen anything like it.‚Äù The significant difference between Netplan is that the configuration is written in <a href="https://ru.wikipedia.org/wiki/YAML">YAML</a> , yes yes you have not misheard YAML, the developers decided to keep up with the times (and however much I didn‚Äôt praise him, I still consider it a terrible language). The main minus  This language is that it is very sensitive to spaces, let's consider the config using an example. <br><br>  Configuration files are in the path /etc/netplan/name.yaml, between each block when there should be + 2 spaces. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1) The standard header looks like this: <br><br><pre><code class="plaintext hljs">network: version: 2 renderer: networkd ethernets: enp3s0f0: dhcp4:no</code> </pre> <br>  Let's look at what we just did: <br><br><ul><li>  network: is the start configuration block. </li><li>  renderer: networkd - here we specify the network manager that we will use, it is either networkd or NetworkManager </li><li>  version: 2 - here as I understood the version of YAML. </li><li>  ethernets: - this unit says that we will configure the ethernet protocol. </li><li>  enps0f0: - specify which network adapter will be configured. </li><li>  dhcp4: no - disable DHCP v4, for 6 v6 dhcp6 respectively </li></ul><br>  2) Let's try to assign ip addresses: <br><br><pre> <code class="plaintext hljs"> enp3s0f0: dhcp4:no macaddress: bb:11:13:ab:ff:32 addresses: [10.10.10.2/24, 10.10.10.3/24] gateway4: 10.10.10.1 nameservers: addresses: 8.8.8.8</code> </pre> <br>  Here we set poppy, ipv4, gateway and dns server.  Note that if we need more than one ip address then we write them separated by commas with an obligatory space after. <br><br>  3) What if we need <a href="https://en.wikipedia.org/wiki/Channel_bonding">bonding</a> ? <br><br><pre> <code class="plaintext hljs"> bonds: bond0: dhcp4: no interfaces: [enp3s0f0, enp3s0f1] parameters: mode: 802.3ad mii-monitor-interval: 1</code> </pre> <br><ul><li>  bonds: - a block explaining that we will set up a bonding. </li><li>  bond0: is an arbitrary interface name. </li><li>  interfaces: - a set of interfaces collected in bond-ding, '' as previously stated, if several parameters are described in square brackets ". </li><li>  parameters: - describe the parameter setting block </li><li>  mode: - specify the mod on which the bonding will work. </li><li>  mii-monitor-interval: - set the monitoring interval 1 sec. </li></ul><br>  Inside the block named bond, you can also configure parameters such as addresses, gateway4, routes, etc. <br><br>  We have added redundancy for our network, now it remains only to hang the <a href="https://ru.wikipedia.org/wiki/VLAN">vlan</a> and the configuration can be considered complete. <br><br><pre> <code class="plaintext hljs">vlans: vlan10: id: 10 link: bond0 dhcp4: no addresses: [10.10.10.2/24] gateway: 10.10.10.1 routes: - to: 10.10.10.2/24 via: 10.10.10.1 on-link: true</code> </pre><br><ul><li>  vlans: - declare the vlan tuner. </li><li>  vlan10: - arbitrary name of the vlan interface. </li><li>  id: is the tag of our vlan. </li><li>  link: - the interface through which vlan will be available. </li><li>  routes: - we announce the block of route descriptions. </li><li>  - to: - set the address / subnet to which the route is required. </li><li>  via: - we specify the gateway through which our subnet will be available. </li><li>  on-link: - we indicate that it is always necessary to register routes when raising the link. </li></ul><br>  Pay attention to how I put spaces in YAML, this is very important. <br><br>  Here we described the network interfaces, created a bonding, and even added vlans.  Let's apply our config, the netplan apply command will check our config for errors and apply it if successful. Next, the config will rise itself when the system is rebooted. <br><br>  Having collected all the previous blocks of code, here's what we got: <br><br><pre> <code class="plaintext hljs">network: version: 2 renderer: networkd ethernets: enp3s0f0: dhcp4: no ensp3s0f1: dhcp4: no bonds: bond0: dhcp4: no interfaces: [enp3s0f0, enp3s0f1] parameters: mode: 802.3ad mii-monitor-interval: 1 vlan10: id: 10 link: bond0 dhcp4: no addresses: [10.10.10.2/24] routes: - to: 10.10.10.2/24 via: 10.10.10.1 on-link: true vlan20: id: 20 link: bond0 dhcp4: no addresses: [10.10.11.2/24] gateway: 10.10.11.1 nameserver: addresses: [8.8.8.8]</code> </pre><br>  Here is our network and is ready for operation, everything turned out to be not as scary as it seemed at first, and the code was very beautiful and readable.  PC thank you for netplan there is an excellent manual at <a href="https://netplan.io/">https://netplan.io/</a> . </div><p>Source: <a href="https://habr.com/ru/post/448400/">https://habr.com/ru/post/448400/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448386/index.html">9 amazingly simple ways for people to respond to your messages.</a></li>
<li><a href="../448388/index.html">Digital Dictation will be held in Russia for the first time</a></li>
<li><a href="../448390/index.html">How to make a watch for Ilona Mask</a></li>
<li><a href="../448392/index.html">Two approaches to structuring the Activity diagram</a></li>
<li><a href="../448398/index.html">Artificial intelligence, great and terrible</a></li>
<li><a href="../448402/index.html">Certificate Authority (CA) migration failed from Windows 2008R to Windows 2012 R2</a></li>
<li><a href="../448408/index.html">DCIM - the key to data center management</a></li>
<li><a href="../448410/index.html">Google trackers are built into a number of official Russian electronic resources.</a></li>
<li><a href="../448416/index.html">The easiest way to make a chat in the iOS application</a></li>
<li><a href="../448420/index.html">From life with Kubernetes: How the HTTP server did not complain about the Spaniards</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>