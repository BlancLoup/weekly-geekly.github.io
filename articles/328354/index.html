<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparison of PVS-Studio C # and static analyzer built into Visual Studio based on the code of the CruiseControl.NET project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I conducted a comparison of C # analyzers PVS-Studio and SonarQube based on the code of the PascalABC.NET project. The study was quite inter...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparison of PVS-Studio C # and static analyzer built into Visual Studio based on the code of the CruiseControl.NET project</h1><div class="post__text post__text-html js-mediator-article"><p><img src="https://habrastorage.org/getpro/habr/post_images/63b/8a6/158/63b8a6158c0d38a2a40cbbfa66c7a44d.png" alt="Picture 6" align="left"></p>  Recently, I conducted a comparison of C # analyzers PVS-Studio and SonarQube based on the code of the PascalABC.NET project.  The study was quite interesting, so I decided to continue working in this direction.  This time I compare the PVS-Studio C # analyzer with the static analyzer embedded in Visual Studio.  In my opinion, this is a very worthy opponent.  Despite the fact that the analyzer from the Visual Studio suite, in the first place, is not designed to find errors, but to improve the quality of the code, this does not mean that it cannot be used to find real errors, although this is difficult.  Let's see what are the features of the analyzers will be revealed in the course of our research this time.  Forward! <br><a name="habracut"></a><br><h2>  Introduction </h2><br>  At first - a small FAQ section to clarify a number of points. <br><br>  Q: Why CruiseControl.NET?  What is this project? <br><br>  A: <a href="http://www.cruisecontrolnet.org/">CruiseControl.NET</a> is an automatic continuous integration server implemented using the .NET Framework.  CruiseControl.NET source code is available on <a href="">GitHub</a> .  The project has not been developing for some time and is not supported, although, in the recent past, it enjoyed a certain popularity.  It does not hurt to use it in order to compare analyzers; rather, on the contrary, it will introduce some element of stability in the study.  You can be sure that nobody improved the code using the latest versions of PVS-Studio or the analyzer built into Visual Studio.  An additional advantage is the small size of CruiseControl.NET: the project contains about 256 thousand lines of code. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Q: Have you used Visual Studio 2017?  I would like to get acquainted with the capabilities of the latest versions of analysis tools. <br><br>  A: For the analysis of both tools, the Visual Studio 2017 Community was used. <br><br>  Q: What about analyzer settings?  Probably, everything was ‚Äúspecially tuned‚Äù, and therefore PVS-Studio turned out to be better? <br><br>  A: For both analyzers, the default settings were used.  For the purity of the experiment, installation and research were conducted on a ‚Äúclean‚Äù machine with Windows 10. <br><br>  Q: Oh well.  But, surely, you have a little rigged the results or made the calculations is not quite correct?  For example, for PVS-Studio, you could not take into account the confidence level of warnings ‚ÄúLow‚Äù, taking only ‚ÄúHigh‚Äù and ‚ÄúMedium‚Äù.  Then PVS-Studio will take precedence over the analyzer built into Visual Studio, since the latter does not have a similar configuration. <br><br>  A: When analyzing the results, absolutely all levels of warnings were taken into account and all available types of diagnostics were included. <br><br>  Q: What about selecting files for analysis?  Did you add something to the exceptions, for example, Unit tests? <br><br>  A: For both analyzers, the entire solution was checked, with no exceptions.  In this case, I note that CruiseControl.NET contains a project named "UnitTests".  Quite a number of warnings were issued for this project, but all of them were <i>not taken into account</i> when searching for real errors, although they appear in the general indicator of the number of warnings issued. <br><br>  Q: Real bugs?  What is this term? <br><br>  A: In our understanding, these are errors that are critical for execution, which are most likely to result in an exception being thrown, a program‚Äôs incorrect behavior, and incorrect results being issued.  Errors that need to be corrected here and now.  This is not a recommendation to improve the design and not minor flaws such as code duplication, which do not affect the final result.  An example of a real error in the code of CruiseControl.NET: <br><br><pre><code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IIntegrationResult integrationResult</span></span></span><span class="hljs-function">)</span></span> { .... IntegrationSummary lastIntegration = integrationResult.LastIntegration; <span class="hljs-comment"><span class="hljs-comment">// &lt;= if (integrationResult == null || ....) // &lt;= { .... } .... }</span></span></code> </pre> <br>  Many analyzers will issue a warning for the above code snippet that the <i>integrationResult</i> variable is used without first checking for <i>null</i> equality.  This is correct, but usually leads to a large number of false positives, among which it is very difficult to find the real error.  Our approach is to conduct additional analysis, which increases the likelihood of finding a real error.  In the above fragment, after using the variable, it is checked for <i>null</i> equality.  Those.  the programmer, in this case, assumes that the value of the variable may be <i>null</i> after being passed to the method, and does a check.  This is the situation we will consider a mistake.  If the method did not check the <i>integrationResult</i> for <i>null</i> equality, then, in our opinion, this would be a false positive: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Generate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IIntegrationResult integrationResult</span></span></span><span class="hljs-function">)</span></span> { .... IntegrationSummary lastIntegration = integrationResult.LastIntegration; .... }</code> </pre> <br>  The PVS-Studio analyzer will not issue a warning to this code fragment, while a number of analyzers will do this.  And, as a result, such messages will be ignored or disabled by the programmer.  Many warnings do not mean good. <br><br>  Q: Let's say you did everything correctly.  But why should I take it all on faith?  How can I repeat your research? <br><br>  A: Nothing is easier.  The analyzer built into Visual Studio is free.  Just install the free version of the Visual Studio 2017 Community.  To analyze CruiseControl.NET using PVS-Studio, you will only need to <a href="https://www.viva64.com/ru/pvs-studio-download/">download</a> it and use it in demo mode.  Yes, restrictions will prevent you from carrying out a full analysis, but you can write to us and we will send a temporary license key. <br><br><h2>  Research and Results </h2><br><h3>  Visual studio </h3><br>  Checking the project code using the analyzer built into Visual Studio took only a couple of minutes.  Immediately after this, the results are as follows (no filters are included): <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/629/9fa/c08/6299fac082ad314ea7ce27855f6568ff.png" alt="Picture 1"></p><br><br>  The analyzer issued 10773 warnings.  Yes, it will not be so easy to look for mistakes here.  To begin with, I will exclude from this list the warnings on the project ‚ÄúUnitTests‚Äù using a filter: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ca9/a9e/cf7/ca9a9ecf75696932f5dbc52c17c6b8db.png" alt="Picture 2"></p><br><br>  Good.  Almost half of the warnings were received for tests, which is not surprising.  But more than 5 thousand of the remaining messages are not small either.  These warnings fall into the following groups: <br><br><pre> <code class="cs hljs">Microsoft.Design: CA10XX (: <span class="hljs-number"><span class="hljs-number">40</span></span>, : <span class="hljs-number"><span class="hljs-number">1637</span></span>) Microsoft.Globalization: CA13XX (: <span class="hljs-number"><span class="hljs-number">7</span></span>, : <span class="hljs-number"><span class="hljs-number">1406</span></span>) Microsoft.Interoperability: CA14XX (: <span class="hljs-number"><span class="hljs-number">2</span></span>, : <span class="hljs-number"><span class="hljs-number">10</span></span>) Microsoft.Maintainability: CA15XX (: <span class="hljs-number"><span class="hljs-number">3</span></span>, : <span class="hljs-number"><span class="hljs-number">74</span></span>) Microsoft.Mobility: CA16XX (: <span class="hljs-number"><span class="hljs-number">1</span></span>, : <span class="hljs-number"><span class="hljs-number">1</span></span>) Microsoft.Naming: CA17XX (: <span class="hljs-number"><span class="hljs-number">17</span></span>, : <span class="hljs-number"><span class="hljs-number">1071</span></span>) Microsoft.Performance: CA18XX (: <span class="hljs-number"><span class="hljs-number">15</span></span>, : <span class="hljs-number"><span class="hljs-number">489</span></span>) Microsoft.Portability: CA19XX (: <span class="hljs-number"><span class="hljs-number">1</span></span>, : <span class="hljs-number"><span class="hljs-number">4</span></span>) Microsoft.Reliability: CA20XX (: <span class="hljs-number"><span class="hljs-number">4</span></span>, : <span class="hljs-number"><span class="hljs-number">158</span></span>) Microsoft.Globalization, Microsoft.Security: CA21XX (: <span class="hljs-number"><span class="hljs-number">5</span></span>, : <span class="hljs-number"><span class="hljs-number">48</span></span>) Microsoft.Usage: CA22XX (: <span class="hljs-number"><span class="hljs-number">18</span></span>, : <span class="hljs-number"><span class="hljs-number">440</span></span>)</code> </pre> <br>  A number of compiler warnings were also issued.  Apparently, there is no other choice but to study the description of each of the received diagnostics of the analyzer, and only then examine the warnings if necessary. <br><br>  I will say right away that I did this work and I could not find almost anything that would help to find errors among the more than five thousand warnings issued by the analyzer.  As a rule, it all comes down to recommendations for improving the design and optimization of the code.  Due to the large number of diagnostic rules, I will not give a complete list with descriptions.  If you wish, you can study this list thoroughly by checking the CruiseControl.NET project yourself using the analyzer built into Visual Studio.  A detailed description of diagnostics is available in <a href="https://msdn.microsoft.com/en-us/library/ee1hzekz.aspx">MSDN</a> . <br><br>  I studied a significant part of the warnings, but not all.  Until the end, many groups of messages did not make sense to look through, since they were all of the same type and it was clearly not about errors.  Not to be unfounded, I will give one example for each group. <br><br>  <b>Microsoft.Design</b> <br><br>  CA1002 Change 'List &lt;NameValuePair&gt;' in 'CruiseServerClient.ForceBuild (string, List &lt;NameValuePair&gt;)' to use Collection &lt;T&gt;, ReadOnlyCollection &lt;T&gt; or KeyedCollection &lt;K, V&gt; CruiseServerClient.cs 118 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ForceBuild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...., List&lt;NameValuePair&gt; parameters</span></span></span><span class="hljs-function">)</span></span> { .... }</code> </pre> <br>  The recommendation is to use a universal collection (for example, <i>Collection</i> ), instead of <i>List</i> for the parameter <i>parameters of a</i> method. <br><br>  <b>Microsoft.Globalization</b> <br><br>  CA1300 Change 'AddProjects.RetrieveListOfProjects (BuildServer)' to call the MessageBox.  CCTrayLib AddProjects.cs 86 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RetrieveListOfProjects</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... MessageBox.Show(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-string"><span class="hljs-string">"Unable to connect to server "</span></span> + server.DisplayName + <span class="hljs-string"><span class="hljs-string">": "</span></span> + ex.Message, <span class="hljs-string"><span class="hljs-string">"Error"</span></span>); .... }</code> </pre> <br>  A recommendation to use the overload of the <i>MessageBox.Show ()</i> method, which takes a <i>MessageBoxOptions</i> argument.  This is necessary to better support the multilingual interface and languages ‚Äã‚Äãthat use right-to-left reading order. <br><br>  <b>Microsoft.Interoperability</b> <br><br>  CA1401 Change the accessibility of the P / Invoke 'NativeMethods.SetForegroundWindow (IntPtr)'.  CCTrayLib NativeMethods.cs 12 <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"user32.dll"</span></span></span><span class="hljs-meta">)</span></span>] [<span class="hljs-keyword"><span class="hljs-keyword">return</span></span>: MarshalAs(UnmanagedType.Bool)] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">SetForegroundWindow</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IntPtr handle</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  The recommendation is that you should not specify a <i>public</i> access level for methods with the <i>DllImportAttribute</i> attribute. <br><br>  <b>Microsoft.Maintainability</b> <br><br>  CA1500 'errorMessages', a variable named field response to the type.  Change the name of one of these items.  Remote Response.cs 152 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;ErrorMessage&gt; errorMessages; .... <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">virtual</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConcatenateErrors</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt; errorMessages = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> List&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>&gt;(); .... }</code> </pre> <br>  A warning that a local variable has the same name as a class field. <br><br>  <b>Microsoft.Mobility</b> <br><br>  CA1601 Modify the call to 'Timer.Timer (double)' in method FileChangedWatcher.FileChangedWatcher (params string []) 'set.  core FileChangedWatcher.cs 33 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FileChangedWatcher</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Timer(<span class="hljs-number"><span class="hljs-number">500</span></span>); .... }</code> </pre> <br>  Warning that the timer is set to an interval of less than one second. <br><br>  <b>Microsoft.Naming</b> <br><br>  CA1702 In member 'Alienbrain.CreateGetProcess (string)', it should be expressed as a compound word, 'fileName'.  core Alienbrain.cs 378 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ProcessInfo </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CreateGetProcess</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> filename</span></span></span><span class="hljs-function">)</span></span> { .... }</code> </pre> <br>  Warning about the need to use Camel Case to name compound variable names. <br><br>  <b>Microsoft.Performance</b> <br><br>  CA1800 'action', a variable, is a 'AdministerAction' multiple times the method 'AdministerPlugin.NamedActions.get ()'.  Eliminating isint instruction.  WebDashboard AdministerPlugin.cs 79 <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> INamedAction[] NamedActions { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (action <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> AdministerAction) { (action <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> AdministerAction).Password = password; } .... } .... }</code> </pre> <br>  Warning about the need to optimize repetitive type conversion. <br><br>  <b>Microsoft.Portability</b> <br><br>  FDWSound 'of P / Invoke' Audio.PlaySound (byte [], short, long) will be 8 bytes wide on 32-bit platforms.  This indicates that this API does not correct 4 bytes wide on 32-bit platforms.  Consult the MSDN Platform SDK.  CCTrayLib Audio.cs 135 <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport (</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"winmm.dll"</span></span></span><span class="hljs-meta">)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">PlaySound</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">byte</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] pszSound, Int16 hMod, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">long</span></span></span></span><span class="hljs-function"><span class="hljs-params"> fdwSound</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  Warning that the import method uses an <i>unportable</i> type for the <i>fdwSound</i> parameter.  You must use <i>IntPtr</i> or <i>UIntPtr</i> . <br><br>  <b>Microsoft.Reliability</b> <br><br>  CA2000 In method 'About.famfamfamLink_LinkClicked (object, LinkLabelLinkClickedEventArgs)', call System.IDisposable.Dispose of the object 'urlLink' before it‚Äôs out.  CCTrayLib About.cs 71 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">famfamfamLink_LinkClicked</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { Process urlLink = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Process(); urlLink.StartInfo = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ProcessStartInfo(....); urlLink.Start(); }</code> </pre> <br>  Warning about the need to free the <i>IDlposable urlLink</i> object before it is out of scope.  You can, for example, use <i>using</i> . <br><br>  <b>Microsoft.Globalization, Microsoft.Security</b> <br><br>  CA2101 to reduce security, Unicode, by setting DllImport.CharSet to CharSet.Unicode, or by explicitly marshaling.  If you need to set it up, select Marshal As appropriate, and set BestFitMapping = false;  for added security, also set ThrowOnUnmappableChar = true.  core Impersonation.cs 100 <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"advapi32.dll"</span></span></span><span class="hljs-meta">, SetLastError = true)</span></span>] <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">extern</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LogonUser</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lpszUsername, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lpszDomain, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> lpszPassword, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwLogonType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> dwLogonProvider, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ref</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IntPtr phToken</span></span></span><span class="hljs-function">)</span></span>;</code> </pre> <br>  A warning that marshaling type is not specified for string arguments, for example, by specifying attributes as follows: <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">DllImport(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"advapi32.dll"</span></span></span><span class="hljs-meta">, SetLastError = true, CharSet = CharSet.Unicode)</span></span>]</code> </pre> <br>  <b>Microsoft.Usage</b> <br><br>  CA2201 'CruiseServerClientFactory.GenerateClient (String, ClientStartUpSettings) creates an exception of the type' ApplicationException ', it‚Äôs not a rule.  Could be thrown, use a different exception type.  Remote CruiseServerClientFactory.cs 97 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> CruiseServerClientBase </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GenerateClient</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">....</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ApplicationException(<span class="hljs-string"><span class="hljs-string">"Unknown transport protocol"</span></span>); .... }</code> </pre> <br>  Warn about the release of exceptions are too general.  In this case, it is recommended to throw an exception of a more specific type that is not reserved in the runtime environment. <br><br>  <b>Total</b> <br><br>  As a result of the work done, I came to the conclusion that the search for real errors, in this case, it makes sense to produce only for messages with code CA1062 from the Microsoft.Design group.  These are warnings of a situation where the method parameter is a reference type, and before it is used, a check for <i>null</i> equality is not performed.  After applying the filter for such messages, we get the following: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4d4/240/0e3/4d42400e3a3035d225095613ce927b3c.png" alt="Picture 3"></p><br><br>  733 is still a lot.  But, you see, this is already something.  And if you examine the found code fragments, then they are really potentially unsafe.  For example, in the ItemStatus.cs file: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">AddChild</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ItemStatus child</span></span></span><span class="hljs-function">)</span></span> { child.parent = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>; childItems.Add(child); }</code> </pre> <br>  The <i>child</i> reference to an instance of the <i>ItemStatus</i> class is not checked before use.  Yes, it is dangerous.  But, unfortunately, this cannot be called a mistake.  Probably, checks may be contained in the calling code, although this is incorrect.  Moreover, the method is declared as <i>public</i> .  Of course, the author of the code should take measures and somehow respond to all these warnings, but I remind you that there are 733 of them. Most likely, the programmer will not do anything, since ‚Äúeverything works anyway‚Äù.  This is precisely the danger of issuing a large number of messages to anything a little suspicious.  For this reason, earlier I gave an example of a real error, one that the developer‚Äôs attention should be paid to.  Triggers like this can be considered mostly false.  And indeed it is. <br><br>  After spending more time, I singled out among the 733 warnings issued - 5, which can be interpreted as errors.  Here is an example of one of them (the BuildGraph.cs file): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (obj.GetType() != <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.GetType() ) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; .... }</code> </pre> <br>  The variable <i>obj is</i> not checked for <i>null</i> equality before use.  Since this is an <i>Equals</i> overloaded method, we are dealing with an error.  The <i>Equals</i> method is required to correctly handle null links.  Perhaps in the CruiseControl.NET project such situations never arise, but the method code is still wrong and should be corrected. <br><br>  A meticulous reader might argue that I could have missed some mistake without carefully examining every use of the methods.  Maybe.  But in practice, no one will study so carefully every warning, because the percentage of false positives is very large. <br><br>  I note that despite the fact that I managed to find real errors in the code of CruiseControl.NET using the analyzer built in Visual Studio, the process itself took me about 8 hours (the whole working day) and required increased attention and concentration.  Perhaps if the authors of the project used static analysis regularly, the overall picture would be more rosy. <br><br><h3>  PVS-Studio </h3><br>  Checking the project code using PVS-Studio on my machine took exactly one minute.  Immediately after this, the results are of the form (no filters are included): <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e3/66d/b33/4e366db33c298ad0aae79b80f11a8faf.png" alt="Picture 4"></p><br><br>  The analyzer issued 198 warnings.  And 45 of them were received for the ‚ÄúUnitTests‚Äù project, and another 32 warnings have a low priority (among them it is difficult to find real errors).  Total - 121 message for analysis, which I spent 30 minutes.  As a result, 19 errors were identified: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4da/4f8/4ef/4da4f84ef9a12d0532aa2a5cf40cdb66.png" alt="Picture 5"></p><br><br>  Here is an example of one of them: <br><br>  <a href="http://www.viva64.com/ru/w/V3003/">V3003</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 120, 125. CCTrayLib CCTrayProject.cs 120 <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">override</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Equals</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">object</span></span></span></span><span class="hljs-function"><span class="hljs-params"> obj</span></span></span><span class="hljs-function">)</span></span> { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((buildServer != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) &amp;&amp; (objToCompare.buildServer != <span class="hljs-literal"><span class="hljs-literal">null</span></span>)) { <span class="hljs-comment"><span class="hljs-comment">// If both instances have a build server then compare the build // server settings isSame = string.Equals(buildServer.Url, objToCompare.buildServer.Url); } else if ((buildServer != null) &amp;&amp; (objToCompare.buildServer != null)) { // If neither instance has a build server then they are the same isSame = true; } .... }</span></span></code> </pre> <br>  Both <i>if</i> blocks contain the same condition.  A serious error was made that affects the logic of the program and leads to an unexpected result. <br><br>  I note that among the errors that PVS-Studio detected, there are also those that I chose from those found by the analyzer embedded in Visual Studio. <br><br>  I think here I have nothing more to add.  PVS-Studio quickly and efficiently did its job in finding real errors.  But for this he exists! <br><br><h2>  Conclusion </h2><br>  I will present the results in the form of a table: <br><br><p><img src="https://habrastorage.org/getpro/habr/post_images/7d1/4d0/f62/7d14d0f627ad2ca5fb68d6582fe60c1e.png" alt="Picture 16"></p><br><br>  Of course, an obvious advantage is observed on the side of PVS-Studio.  But, I repeat, the analyzer built into Visual Studio is intended, first of all, to improve the design and optimization of the code, and not to search for errors.  At the same time, PVS-Studio, on the contrary, is ‚Äúhoned‚Äù to search for errors with issuing the lowest possible level of false warnings.  In addition, the developers of CruiseControl.NET, apparently, did not use any analyzers at all.  I am sure that with regular use of the analyzer built into Visual Studio, the quality of their code would be much better, and the probability of a possible error is lower.  What to say about PVS-Studio.  Such tools allow you to achieve maximum effect with regular use, rather than ‚Äúonce a year‚Äù. <br><br>  ‚Üí <a href="http://www.viva64.com/ru/pvs-studio/">Download and try PVS-Studio</a> <br><br>  For purchasing a commercial license of PVS-Studio, please <a href="http://www.viva64.com/ru/about-feedback/">contact</a> us in the mail.  You can also email us to get a temporary license for a comprehensive study of PVS-Studio if you want to remove the restrictions of the demo version. <br><br><h2>  Additional links </h2><br><ol><li>  <a href="https://www.viva64.com/ru/b/0488/">How and why static analyzers deal with false positives</a> . </li><li>  <a href="https://www.viva64.com/ru/b/0492/">Checking the PascalABC.NET project with the help of SonarQube plugins: SonarC # and PVS-Studio</a> . </li></ol><br><br><div style="text-align:center;"> <a href="http://www.viva64.com/en/b/0506/"><img src="https://habrastorage.org/files/8d2/41b/5bf/8d241b5bf34747169141ed7c1997143b.png"></a> </div><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Sergey Khrenov.  <a href="http://www.viva64.com/en/b/0506/">Comparing PVS-Studio for C # and a built-in Visual Studio analyzer, using the CruiseControl.NET codebase</a> <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio, version 2015</a> .  Please review the list. </div></div></div><p>Source: <a href="https://habr.com/ru/post/328354/">https://habr.com/ru/post/328354/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328342/index.html">Researchers have learned to attack industrial robots. Thousands of them are available from the network.</a></li>
<li><a href="../328344/index.html">Startup of the day (April 2017)</a></li>
<li><a href="../328346/index.html">Bash scripts, part 10: practical examples</a></li>
<li><a href="../328348/index.html">Making any object thread safe</a></li>
<li><a href="../328352/index.html">Top 10 Mistakes Made by Django Developers</a></li>
<li><a href="../328356/index.html">As we did the third internship in iOS and Android development at Redmadrobot</a></li>
<li><a href="../328358/index.html">Fatty programs - we study the factor of memory part B</a></li>
<li><a href="../328360/index.html">Min-Long Chou: What I designed for Uncharted 4. Part 2</a></li>
<li><a href="../328362/index.html">Accelerate std :: shared_mutex 10 times</a></li>
<li><a href="../328364/index.html">Crystal High Performance Services, Newbie Introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>