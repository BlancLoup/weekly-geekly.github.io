<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hacking programs for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Disclaimer: everything written below is written solely for educational and research purposes, as well as an understanding of the mechanisms for protec...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hacking programs for dummies</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/8b15c057/75692e51/11776c28/84d30e1a.png" align="left">  <i>Disclaimer: everything written below is written solely for educational and research purposes, as well as an understanding of the mechanisms for protection against hacking.</i>  <i>The author does not recommend using this information for hacking programs.</i> <br><br>  In this article, I want to tell you about the three and a half main ways of hacking programs on .NET, the goal that I am pursuing is to help developers better understand the protection mechanisms of their programs, i.e.  find out the most obvious threats and take appropriate measures (or not to take). <br><br>  I will not go into details and use sophisticated tools for hacking.  Everything will be painted ‚Äúfor dummies‚Äù, i.e.  All tools will be simple, easily accessible and free.  And the main one will be <a href="http://www.red-gate.com/products/reflector/">Reflector</a> , a .NET program decompiler 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage/83a290b0/e43b9c8a/6fd3a9fa/a6115465.png" align="left">  As a guinea pig, I chose <a href="http://www.ultrapico.com/Expresso.htm">Expresso</a> , a regular expression analyzer.  This program is free, the license doesn‚Äôt seem to indicate anything about hacking, but without registration it will work only 60 days.  In other words, the harm of hacking this program is minimal, besides its internal device is very well suited for training.  I hope that the author of this program will not be offended at me. <br><br><a name="habracut"></a><br>  For a start, a brief educational program for the .NET program structure, for those who are not familiar with the development under this Framework: all code written in any .NET language (C #, Visual Basic, F #, Delphi.NET) is compiled into a special Intermediate Language, usually called IL or <a href="http://en.wikipedia.org/wiki/Common_Intermediate_Language">MSIL</a> .  This is something like an assembler, only very clever and possessing very powerful instructions.  And this is, in principle, the same equal language as C #, only the syntax is worse (and there are more possibilities).  In addition, metadata is actively used in the .NET program, i.e.  all information about classes, methods, attributes, attributes, and everything else is stored in an executable file. <br>  Those.  in fact, decompiling a program is not a very correct concept in this case.  It already lies in its entirety in open form, and tools in the form of a Reflector are engaged in bringing the MSIL constructions to the corresponding constructions of C # or another language, increasing the readability of the code. <br><br>  Let's move, in fact, to hacking. <br><br><h3>  0. Reset Trial </h3><br>  Actually, this is not even a hack, but a semi-legal way to extend the life of a non-activated program.  It lies in the fact that there is a place where the date of the first launch is stored and changes / is destroyed.  After that, all can use the program until the next term. <br><br>  Let's look at our experimental reflector: <br>  Having a little walk on the code, we find an interesting line in the MainForm constructor <br><img src="https://habrastorage.org/storage/799affe6/936a50cc/0a321c70/ea18f496.png"><br>  Open the registry editor, go to HKEY_CURRENT_USER \ Software \ Ultrapico \ Expresso and see the following keys: <br><img src="https://habrastorage.org/storage/f3a5cfeb/7fed7dd2/05cdae0e/c66c1d75.png"><br>  Remove them and get another 60 days of work. <br><br>  This option, of course, is simple and obvious, but if it would even be more difficult, it would take a little more time in the reflector to find out all the places where the information is written and clean them. <br><br>  Advice to developers who will try to write data to a hidden place: write carefully, otherwise it can turn into problems for ordinary users who for some reason will not have this place or will not have enough rights for it. <br><br><h3>  1. Writing a keygen </h3><br>  The most terrible option for the developer, and the most pleasant for the end evil user.  The program considers itself licensed, no terrible gestures do not need to be done. <br><br>  Open the reflector and look for the code for classes containing a License or Registration, we see: <br><img src="https://habrastorage.org/storage/5d4a5231/f2b33fca/19a971df/b853538b.png"><br>  When you enter a name and a code by name, a certain hash is calculated, which is compared with the code. <br><br><img src="https://habrastorage.org/storage/8928c300/4f50d950/6cd6ca1e/dbd0ca6f.png"><br>  This hash uses DES and any prefixes. <br><br><img src="https://habrastorage.org/storage/f754e9cb/4db44782/b760e172/1065e362.png"><br>  Bytes are converted to a string using this method. <br><br>  Now everything turned out, open the IDE and copy all the necessary pieces of code (or implement them yourself).  It remains only to find out what the values ‚Äã‚Äãof Prefix, Suffix and the parameters of the MyDES implementation.  I will not bring them, these are already technical details. <br><br>  As a result, we generate a key for any name and see: <br><img src="https://habrastorage.org/storage/ffb7df83/3818f013/2ecaa890/3c2561e9.png"><br>  Bingo! <br><br>  Protection against keygens is simple and obvious: use asymmetric encryption in any form.  Those.  to make it so that without knowing the private key it would be impossible to generate the code, and this key is only in one place - the author of the program. <br><br><h3>  2. Using Wrapper </h3><br>  Checking the correctness of the license is quite troublesome and slow.  Therefore, software developers usually check the license once, and then use the received flag - valid / invalid (as an option, how valid, if several types of licenses are allowed, differing in capabilities).  Here you can play on this, using the following algorithm: <br><ol><li>  Tell the program that the license has already been verified. </li><li>  Indicate to the program that the license is correct. </li></ol><br>  How to do it?  I have already mentioned the presence of metadata in executable files at the beginning, and we will use this.  Let's see how the program starts and how the license is checked: <br><img src="https://habrastorage.org/storage/4b3cd342/48fd88bd/e53fdf7c/46dcd6bc.png"><br><img src="https://habrastorage.org/storage/a6f92035/2ca6421d/bf19f455/5ac1ee65.png"><br><br>  With the launch of nothing interesting, and the check shows that if the program is already registered, then she believes that everything is fine and does not do any further work on finding out the correctness of the license. <br><br>  We use this: <br>  Let's make a new project, add a Reference to Expresso.exe and run it through ourselves: <br><img src="https://habrastorage.org/storage/d1fee932/f0e2c2a4/8d4362cd/61d00252.png"><br>  Look what happened: <br><img src="https://habrastorage.org/storage/1eec9913/ebf5dc1d/f22d8f20/3627dc37.png"><br>  Well, who would doubt. <br><br>  In this case, everything turned out to be simple, but if the author of the program had replaced public properties with private ones, then all would have to use Reflection for access and everything would be reduced to the original problem. <br><br>  I think it is clear how you can try to defend yourself against this ‚Äî check the license periodically, watch the environment from which the program is running, make it impossible to set the desired variable. <br><br>  But all these defenses will result in the attacker using <br><br><h3>  3. Physical hacking program </h3> <br>  Everything is serious here.  The program is completely decompiled in MSIL and is already going back from it (remember, I wrote that MSIL is the same language as C #?).  To decompile, we need a utility from the SDK called <b>ildasm</b> , and to compile, the compiler from the .NET Framework is <b>ilasm</b> . <br><br>  Run ildasm, open Expresso.exe and save the dump to an .il file.  We find the already discussed IsRegistered method and add a little bit of our code (without labels): <br><img src="https://habrastorage.org/storage/39201a23/599da601/46473d33/e5800cdd.png"><br><br>  Then we take ilasm and collect everything back (without forgetting to connect resources). <br><br>  What this code does: sets the desired name for registration (optional), and returns the status that everything is fine. <br>  To make it clearer, it looks like this in a reflector, in C # <br><img src="https://habrastorage.org/storage/460d5a0d/8462ebac/da7456ad/49dbcad4.png"><br><br>  Those.  it is quite obvious that now everything will be fine: <br><img src="https://habrastorage.org/storage/694575e8/64559148/f3c10643/ea25d8c8.png"><br><br>  <i>A little about the code in MSIL: this is a stack machine that does not have registers, all operations look like: push the required number of parameters onto the stack, execute a function that takes the required number of parameters and puts the result.</i>  <i>Well and back: set the value of a variable by what lies in the stack.</i>  <i>To better understand the work of all this, I recommend a simple technique: write a small program in a familiar language, compile, see what happened in MSILe and understand the language constructs.</i> <i><br></i>  <i>At the same time, some things in MSIL can be done very nicely, for example, change two variables in places - 4 nice lines (in C # less, but not nice).</i> <br><br>  What an attacker sacrifices: the signature of the program, now it is no longer the author, but his.  In some cases, this is a problem if the program uses many libraries.  Then the evil hacker will have to disassemble them all and reassemble them, but if he copes with this, he will have ‚Äúhis‚Äù version of the program signed with <b>his</b> key. <br><br>  There is actually little protection against all this disgrace: obfuscation or carry out a part of the logic / protection check in the native code. <br><br><h3>  Conclusion </h3><br>  I think I told you how easy it is to break everything into .NET if the creator has not made any effort to protect his program.  And you really decide whether to do the protection and spend time and resources on it.  Or maybe just make a web-system, or a free limited version.  Solve the developers. <br><br></div><p>Source: <a href="https://habr.com/ru/post/109117/">https://habr.com/ru/post/109117/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../109108/index.html">Algorithm + crowd is not enough</a></li>
<li><a href="../109109/index.html">PotokFM - monitoring of regional radio</a></li>
<li><a href="../109111/index.html">The HTML5 specification allows for virtually any value of the id attribute - use it wisely</a></li>
<li><a href="../109114/index.html">250 MW solar power station to be built in California</a></li>
<li><a href="../109116/index.html">Stupid phpbb3 integration with any site</a></li>
<li><a href="../109118/index.html">Google may acquire Groupon for $ 6 billion</a></li>
<li><a href="../109120/index.html">Migration appeared in Yii</a></li>
<li><a href="../109124/index.html">Text at any cost: Miette</a></li>
<li><a href="../109125/index.html">We connect to the player from Vogue headphones and volume control</a></li>
<li><a href="../109127/index.html">Facebook video chat with roulette</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>