<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Application architecture on the Akili framework</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Greetings Today I would like to take an example of the implementation of the site architecture on the Akili framework. This article will discuss not s...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Application architecture on the Akili framework</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/679/9fe/580/6799fe5807bcb6701fa522170b35bcf2.svg" width="200"></div><br><p>  Greetings  Today I would like to take <a href="https://github.com/ortexx/akili-example/">an example of the</a> implementation of the site architecture on the <strong>Akili</strong> framework.  This article will discuss not so much the system of components as a complete implementation of the application, using routing, ajax requests, storage, etc.  right out of the box, without external dependencies. </p><a name="habracut"></a><br><ul><li>  <a href="https://example.akilijs.com/">An example of the network</a> . </li><li>  <a href="https://akilijs.com/docs/architecture">English-language analysis of the</a> example of architecture. </li><li>  <a href="https://github.com/ortexx/akili-example/">Npm scripts</a> . </li><li>  <a href="https://akilijs.com/docs/getting-started">Full documentation</a> . </li><li>  Examples of the component system without assembly in examples on the <a href="https://akilijs.com/">main site</a> . </li><li>  <a href="https://habrahabr.ru/post/331704/">Previous article</a> about the component system (relevant except for the attribute system, the .changed () method is cut out and replaced with .attr ()) </li><li>  <a href="https://github.com/ortexx/akili-connect">Server rendering</a> . </li></ul><br><p>  To build the project, use the <a href="https://webpack.js.org/">webpack</a> , to compile <a href="https://babeljs.io/">babel</a> with the <strong>env</strong> , <strong>stage-2</strong> , <strong>stage-3</strong> presets, to return the static node + <a href="http://expressjs.com/">express</a> + <a href="https://github.com/ortexx/akili-connect">akili-connect</a> .  <a href="https://eslint.org/">Eslint is</a> present. </p><br><h2 id="struktura-faylov-i-opisanie">  File structure and description </h2><br><p>  Folder to access statics from the browser <strong>/ public / assets</strong> . <br>  Folder with frontend <strong>/ src</strong> , entry point <strong>/src/main.js</strong> . <br>  Raising the server in <strong>app.js.</strong> </p><br><p>  There is no backend as such in the example.  A simple implementation of static feedback + a couple of lines for server rendering has <strong>been</strong> written in the <strong>app.js</strong> file. </p><br><p>  Sample data taken from the site <a href="https://jsonplaceholder.typicode.com/"></a>  <a href="https://jsonplaceholder.typicode.com/">https://jsonplaceholder.typicode.com/</a> . </p><br><p>  The frontend structure consists of three main parts: </p><br><ul><li>  <strong>components</strong> is a folder with universal components that can be used many times within an application. </li><li>  <strong>controllers</strong> - a folder with unique components responsible for the application logic: routing and data distribution. </li><li>  <strong>actions</strong> - folder with functions for receiving and saving data. </li></ul><br><p>  And three minor: </p><br><ul><li>  <strong>fonts</strong> - a common folder with fonts </li><li>  <strong>img</strong> - shared folder with images </li><li>  <strong>styles</strong> - shared folder with styles </li></ul><br><p>  At the same time, the three folders above with statics are not unique and each individual component can have its own. </p><br><p>  The universal (simple) component is completely independent.  Data is transmitted to it through <a href="https://akilijs.com/docs/attributes">attributes</a> , and back we get the result through <a href="https://akilijs.com/docs/events">events</a> .  It should not work with the <a href="https://akilijs.com/docs/store">repository</a> .  This is done by the controller components.  The controller is the link between the repository and simple components. </p><br><h3 id="srcmainjshttpsgithubcomortexxakili-exampleblobmastersrcmainjs">  <a href="">src / main.js</a> </h3><br><p>  The best way to register components in a framework is to describe the static <strong>.define ()</strong> method on each component, and call them at the entry point. </p><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> App <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./controllers/app/app'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Posts <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./controllers/posts/posts'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostEdit <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./controllers/post-edit/post-edit'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Users <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./controllers/users/users'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostCards <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/post-cards/post-cards'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> PostForm <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/post-form/post-form'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> UserCards <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'./components/user-cards/user-cards'</span></span> App.define(); Posts.define(); PostEdit.define(); Users.define(); PostCards.define(); PostForm.define(); UserCards.define();</code> </pre> <br><p>  In order to make ajax requests we use the <a href="https://akilijs.com/docs/requests">request</a> service. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request, { Request } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/request'</span></span>;</code> </pre> <br><pre> <code class="javascript hljs">request.addInstance(<span class="hljs-string"><span class="hljs-string">'api'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Request(<span class="hljs-string"><span class="hljs-string">'https://jsonplaceholder.typicode.com'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">json</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }));</code> </pre> <br><p>  Pay attention to an interesting detail.  By default, the <strong>request</strong> object itself is an instance of the <strong>Request</strong> class.  And by using it one could make any requests.  But it is much more convenient to create a separate copy for each direction of requests with its own settings.  In this case, we have created a separate one for working with api <strong>jsonplaceholder.typicode.com</strong> . </p><br><p>  Now we can use it anywhere by importing only the <strong>request</strong> object, for example: </p><br><pre> <code class="javascript hljs">request.use.api.get(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(res.data));</code> </pre> <br><p>  The request will be sent to <a href="https://jsonplaceholder.typicode.com/posts"></a>  <a href="https://jsonplaceholder.typicode.com/posts">https://jsonplaceholder.typicode.com/posts</a> , in the headers with the content type <strong>json</strong> , and in the answer we will immediately get an object, instead of a string. <br>  More details about ajax requests <a href="https://akilijs.com/docs/requests">here</a> . </p><br><p>  Further in our file we see the following lines: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/store'</span></span>;</code> </pre> <br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'state-change'</span></span>, () =&gt; store.loader = <span class="hljs-literal"><span class="hljs-literal">true</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'state-changed'</span></span>, () =&gt; store.loader = <span class="hljs-literal"><span class="hljs-literal">false</span></span>);</code> </pre> <br><p>  Let's start with the <a href="https://akilijs.com/docs/store">store</a> object.  This is the repository of our application.  Here you can store any data.  At the same time, this storage is automatically synchronized with all the places where any changes are needed.  You just need to change the required property.  In the lines above, we just, under certain events, change the <strong>loader</strong> property, to which one of the components is signed, which displays the preloader. </p><br><p>  Events <strong>state-change</strong> and <strong>state-changed</strong> are not standard for <strong>window</strong> .  They are caused by the <a href="https://akilijs.com/docs/routing">framework framework router</a> .  The first, before any change in the address bar of the browser, the second, immediately after it.  This is what we need for the preloader to work.  More on this later. </p><br><p>  Next, the router and the framework are initialized after loading the DOM. </p><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.addEventListener(<span class="hljs-string"><span class="hljs-string">'DOMContentLoaded'</span></span>, () =&gt; { router.init(<span class="hljs-string"><span class="hljs-string">'/app/posts'</span></span>, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); Akili.init().catch(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) =&gt;</span></span> <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.error(err)); });</code> </pre> <br><h3 id="srccontrollersappappjshttpsgithubcomortexxakili-exampleblobmastersrccontrollersappappjs">  <a href="">src / controllers / app / app.js</a> </h3><br><p>  This file describes the root controller.  In it, we denote the first level of routing to display the header in the template and the entry point for nested routes. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">'./styles/app.scss'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Akili <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> router <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">App</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Akili</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> template = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./app.html'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> define() { Akili.component(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); router.add(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-string"><span class="hljs-string">'^/app'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">component</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Akili example site'</span></span> }); } compiled() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store(<span class="hljs-string"><span class="hljs-string">'loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'showLoader'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, posts =&gt; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.post = posts.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">p</span></span></span><span class="hljs-function"> =&gt;</span></span> p.selected)); } }</code> </pre> <br><p>  Let's go through the code above.  First, we load the styles for this component.  All static files of a particular component, styles, images, fonts, are stored in its personal folder <strong>/ src / controllers / app</strong> , and not in common. </p><br><p>  Next comes the component declaration.  The <strong>.define ()</strong> method is optional, but it is a very convenient way to configure each individual component.  In it, we describe all the actions that are necessary for the work, and then call it at the entry point (src / main.js). </p><br><pre> <code class="javascript hljs">Akili.component(<span class="hljs-string"><span class="hljs-string">'app'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br><p>  The line above registers the component under the <strong>app</strong> tag so that we can use it in the template.  Next is the <a href="https://akilijs.com/docs/routing">addition of the route to the router</a> , etc. </p><br><p>  <strong>.compiled ()</strong> is one of the <a href="https://akilijs.com/docs/lifecycle">lifecycle</a> methods of the component, which is called after compilation.  There are two subscriptions to the repository.  We spoke about one of them earlier: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.store(<span class="hljs-string"><span class="hljs-string">'loader'</span></span>, <span class="hljs-string"><span class="hljs-string">'showLoader'</span></span>);</code> </pre> <br><p>  With this line we linked the <strong>loader</strong> storage properties and the scoop property of the current <strong>showLoader</strong> component.  By default, a link is created in both directions.  If the <strong>store.loader</strong> changes, we will get the changes in <strong>scope.showLoader</strong> and vice versa. </p><br><h3 id="srccontrollersappapphtmlhttpsgithubcomortexxakili-exampleblobmastersrccontrollersappapphtml">  <a href="https://github.com/ortexx/akili-example/blob/master/src/controllers/app/app.html">src / controllers / app / app.html</a> </h3><br><p>  Here is the app component controller template. <br>  We specified it as a static template property in the component. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> template = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./app.html'</span></span>);</code> </pre> <br><p>  Consider an interesting piece from the template: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">img</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"./img/logo.svg"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"60"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"d-inline-block align-middle mr-1 ${ utils.class({loader: this.showLoader}) }"</span></span></span><span class="hljs-tag"> &gt;</span></span></code> </pre> <br><p>  This is a logo image.  It is also a preloader.  If you add a <strong>loader</strong> class to it, the image will start spinning.  Now the whole chain of events related to the preloader should be clear.  In <strong>src / main.js,</strong> we subscribed to two events.  Before changing the address bar, we change <strong>store.loader</strong> to <strong>true</strong> .  At this point, the <strong>showLoader</strong> property in the App component's scoop will also become <strong>true</strong> , and the expression <a href="https://akilijs.com/docs/utils">utils.class ({loader: this.showLoader})</a> will return the <strong>loader</strong> class.  When the download is complete, everything will change to <strong>false</strong> and the class will disappear. </p><br><p>  Another important piece: </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"container pb-5"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">route</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  <strong>route</strong> is a special component into which the template of the route corresponding to the nesting level is loaded.  In this case, this is the second level.  That is, any route-heir from the <strong>app</strong> will be loaded here.  And the <strong>app</strong> itself was loaded into the <strong>route</strong> , which was specified in <strong>body</strong> in <strong>/public/main.html</strong> . </p><br><h3 id="srccontrollerspostspostsjshttpsgithubcomortexxakili-exampleblobmastersrccontrollerspostspostsjs">  <a href="">src / controllers / posts / posts.js</a> </h3><br><p>  It describes the component controller posts. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Akili <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> router <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/router'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { getAll <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> getPosts } <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'../../actions/posts'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-keyword"><span class="hljs-keyword">default</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Posts</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Akili</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Component</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> template = <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(<span class="hljs-string"><span class="hljs-string">'./posts.html'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> define() { Akili.component(<span class="hljs-string"><span class="hljs-string">'posts'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); router.add(<span class="hljs-string"><span class="hljs-string">'app.posts'</span></span>, <span class="hljs-string"><span class="hljs-string">'/posts'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">component</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-string"><span class="hljs-string">'Akili example | posts'</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> getPosts() }); } created() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.setPosts = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setPosts.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.posts = store.posts; } setPosts(posts = []) { store.posts = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.posts = posts; } }</code> </pre> <br><p>  Much you already know, but there are new moments.  For example, to indicate nesting we use a dot in the name of the route: <strong>app.posts</strong> .  Now <strong>posts is</strong> inherited from the <strong>app</strong> . </p><br><p>  Also, when announcing the route, we specified the <a href="https://akilijs.com/docs/routing">handler</a> function.  It will be called if the user gets to the appropriate url.  In it, as an argument, a special object will be passed, where all information about the current transit is stored.  What we return in this function will also fall into this object.  The link to the transit object is in <strong>router.transition</strong> and is available everywhere. </p><br><p>  In the example above, we took data from the repository: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.posts = store.posts;</code> </pre> <br><p>  Because our function <strong>.getPosts ()</strong> at the same time saved it there, but we could take data from the transit: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.posts = router.transition.path.data;</code> </pre> <br><p>  You can see this option in the <a href="">users controller</a> . </p><br><p>  I would also like to note that the component's methods are not in the scope of its template.  To call a function in a template, you need to add it to the template scop: </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.setPosts = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.setPosts.bind(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>);</code> </pre> <br><h3 id="srccontrollerspostspostshtmlhttpsgithubcomortexxakili-exampleblobmastersrccontrollerspostspostshtml">  <a href="https://github.com/ortexx/akili-example/blob/master/src/controllers/posts/posts.html">src / controllers / posts / posts.html</a> </h3><br><p>  This is a post template.  The main task here is to display a list of posts.  But since this component is a controller, we will not do it directly here.  After all, the list of posts is something universal, we should be able to use it anywhere.  Therefore, it is placed in a separate component <a href="https://github.com/ortexx/akili-example/blob/master/src/components/post-cards">src / components / post-cards</a> . </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-cards</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.filteredPosts = utils.filter(this.posts, this.filter, ['title', 'body']) }"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-data</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.setPosts(event.detail) }"</span></span></span><span class="hljs-tag"> &gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-cards</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Now we will simply transfer the necessary array to the <strong>PostCards</strong> component, and it will already display everything as it should.  True, we still have a search here. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form-control"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placeholder</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"search..."</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-debounce</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.filter = event.target.value }"</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">if</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ !this.filteredPosts.length }"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"alert alert-warning"</span></span></span><span class="hljs-tag">&gt;</span></span>Not found anything<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">p</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">if</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Therefore, the data (this.posts) we pass <a href="https://akilijs.com/docs/utils">filtered</a> .  The <a href="https://akilijs.com/docs/components">on-debounce</a> custom event.  It occurs with a delay on the last keystroke in the input.  It would be possible to use the standard <strong>on-input,</strong> but with a large amount of data it will be much less efficient.  About the events in general <a href="https://akilijs.com/docs/events">here</a> . </p><br><p>  When changing data inside <strong>PostCards</strong> , it will trigger a custom <strong>on-data</strong> event, processing which we save changes to posts in the repository by calling <strong>this.setPosts (event.detail)</strong> . </p><br><h3 id="srccontrollerspost-editpost-editjshttpsgithubcomortexxakili-exampleblobmastersrccontrollerspost-editpost-editjs">  <a href="">src / controllers / post-edit / post-edit.js</a> </h3><br><p>  It describes the controller component of the post editing page. <br>  It makes no sense to analyze all the code, since in the examples above almost everything is the same.  Let us dwell on the differences: </p><br><pre> <code class="javascript hljs">router.add(<span class="hljs-string"><span class="hljs-string">'app.post-edit'</span></span>, <span class="hljs-string"><span class="hljs-string">'/post-edit/:id'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">component</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, <span class="hljs-attr"><span class="hljs-attr">title</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">transition</span></span></span><span class="hljs-function"> =&gt;</span></span> <span class="hljs-string"><span class="hljs-string">`Akili example | </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${ transition.path.data.title }</span></span></span><span class="hljs-string">`</span></span>, <span class="hljs-attr"><span class="hljs-attr">handler</span></span>: <span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">transition</span></span></span><span class="hljs-function"> =&gt;</span></span> getPost(transition.path.params.id) });</code> </pre> <br><p>  In this route, we specified the dynamic parameter <strong>id</strong> . <br>  Therefore, in the handler function, we have access to its value in <strong>transition.path.params.id</strong> .  In this case, it is the id of the post to get the desired. </p><br><h3 id="srccontrollerspost-editpost-edithtmlhttpsgithubcomortexxakili-exampleblobmastersrccontrollerspost-editpost-edithtml">  <a href="https://github.com/ortexx/akili-example/blob/master/src/controllers/post-edit/post-edit.html">src / controllers / post-edit / post-edit.html</a> </h3><br><p>  As with the list of posts, here we took the form into a separate component of <strong>PostForm</strong> , so that you can use it many times. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.post }"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-save</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.savePost(event.detail) }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><h3 id="srccomponentspost-formpost-formjshttpsgithubcomortexxakili-exampleblobmastersrccomponentspost-formpost-formhtml">  <a href="https://github.com/ortexx/akili-example/blob/master/src/components/post-form/post-form.html">src / components / post-form / post-form.js</a> </h3><br><p>  Consider this component. <br>  Pay attention to the comments: </p><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Universal component to display a post form * * {@link https://akilijs.com/docs/best#docs_encapsulation_through_attributes} * * @tag post-form * @attr {object} post - actual post * @scope {object} post - actual post * @message {object} post - sent on any post's property change * @message {object} save - sent on form save */</span></span></code> </pre> <br><p>  This is <a href="http://usejsdoc.org/">js-doc</a> with some custom tags. </p><br><ul><li>  <code>@tag</code> is the name of the component when registering </li><li>  <code>@selector</code> - the exact selector that describes the elements suitable for this component </li><li>  <code>@attr</code> - attribute to transfer data to the component from the outside </li><li>  <code>@scope</code> - component scop property </li><li>  <code>@message</code> - message sent when a custom event is raised </li></ul><br><p>  Comments in the source code of the framework are written in the same style. </p><br><pre> <code class="javascript hljs">compiled() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attr(<span class="hljs-string"><span class="hljs-string">'post'</span></span>, <span class="hljs-string"><span class="hljs-string">'post'</span></span>); }</code> </pre> <br><p>  In the piece of code above, we <a href="https://akilijs.com/docs/attributes">created a link</a> between the <strong>post</strong> attribute and the scopa property of the post component.  That is, if you pass this attribute with some value, then we immediately get the changes in <strong>scope.post</strong> .  If you change the <strong>scope.post</strong> in the component, the <strong>on-post</strong> event will be automatically triggered. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äù${</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">this.parentPost</span></span></span><span class="hljs-tag"> }‚Äù </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-post</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">‚Äù${</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">this.parentPost</span></span></span><span class="hljs-tag"> = </span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">event.detail</span></span></span><span class="hljs-tag"> }‚Äù&gt;</span></span></code> </pre> <br><p>  If we wrote the html code above somewhere, then we would have a double connection between the parent <strong>scope.parentPost</strong> and the current <strong>scope.post</strong> . </p><br><p>  But our form works a little differently.  We need to save the changed post only by pressing a button, and not with each change.  Therefore, we use our <a href="https://akilijs.com/docs/events">own</a> click <a href="https://akilijs.com/docs/events">event</a> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">static</span></span> events = [<span class="hljs-string"><span class="hljs-string">'save'</span></span>];</code> </pre> <br><pre> <code class="javascript hljs">save() { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.attrs.onSave.trigger(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.scope.post); }</code> </pre> <br><p>  In the first line, we registered a custom event.  The <strong>.save ()</strong> method is called when a button is clicked on a form.  In it, we trigger our registered event <strong>save</strong> and send a new post. </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">post</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.post }"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">on-save</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"${ this.savePost(event.detail) }"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">post-form</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  This piece of code is from the <strong>PageEdit</strong> controller <strong>template</strong> .  That is, we passed the post through the <strong>post</strong> attribute to the <strong>PostForm</strong> component, and we get back the changed one by processing <strong>on-save</strong> . </p><br><h3 id="srcactionshttpsgithubcomortexxakili-exampleblobmastersrcactions">  src / actions </h3><br><p>  Actions are just functions for getting and saving data.  For cleanliness and convenience, they are placed in a separate folder. </p><br><p>  For example, <a href="">src / actions / posts.js</a> : </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> request <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/request'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> store <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-string"><span class="hljs-string">'akili/src/services/store'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAll</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(store.posts) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Promise</span></span>.resolve(store.posts); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.use.api.get(<span class="hljs-string"><span class="hljs-string">'/posts'</span></span>).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> store.posts = res.data); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getPost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">id</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getAll().then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">posts</span></span></span><span class="hljs-function"> =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> post = posts.find(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">post</span></span></span><span class="hljs-function"> =&gt;</span></span> post.id == id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!post) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Error</span></span>(<span class="hljs-string"><span class="hljs-string">`Not fount post with id "</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${id}</span></span></span><span class="hljs-string">"`</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> post; }); } <span class="hljs-keyword"><span class="hljs-keyword">export</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">updatePost</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">post</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> request.use.api.put(<span class="hljs-string"><span class="hljs-string">`/posts/</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${post.id}</span></span></span><span class="hljs-string">`</span></span>, { <span class="hljs-attr"><span class="hljs-attr">json</span></span>: post }).then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">res</span></span></span><span class="hljs-function"> =&gt;</span></span> { store.posts = store.posts.map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">item</span></span></span><span class="hljs-function"> =&gt;</span></span> item.id == post.id? {...item, ...post}: item); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> res.data; }); }</code> </pre> <br><p>  Everything is quite simple.  Three functions: to get a list of posts, get a specific post and update the post. </p><br><h2 id="podvedem-itogi">  Let's sum up </h2><br><p>  We will not consider files with user components, since almost all the logic there is similar to the one described above. </p><br><p>  In this article, I did not want to describe in detail about all the capabilities of the framework component system, although this is a very important component.  There are many examples on the <a href="https://akilijs.com/">site</a> : tree implementation, todo list, setInterval, <a href="https://github.com/ortexx/akili-tabs">tabs</a> , etc.  <a href="https://akilijs.com/docs/">The documentation is</a> also full of examples and quite complete.  The main goal was to show you how to quickly and easily create an application on Akili. </p><br><p>  What we end up with using Akili: </p><br><ul><li>  A powerful and intuitive component system that allows you to erase the line between markup and application logic.  In addition, any third-party module can be easily wrapped into it.  Be it dragging, accordions and stuff. </li><li>  Storage for storing and distributing data among application components.  A la redux, but even easier.  Where is even easier redax you ask?  <a href="">Look</a> )) </li><li>  Routing out of the box.  It supports all the basic functionality: inheritance, dynamic data, patterns, working with and without hash, changing document.title, resolving data, abstract routes, redirects, and much more. </li><li>  Ability to make ajax requests out of the box.  You can create different instances with your own settings.  The presence of a caching system.  Sending any type of data, without preliminary dances with tambourines, etc. </li><li>  Server rendering.  The truth is currently implemented with a restriction.  The code runs on both the server and the client.  There are plans to transfer at least part of the state to the client. </li><li>  The absence of everything that html and javascript do not provide by default.  No magic add-ons for markup or code. </li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/351916/">https://habr.com/ru/post/351916/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../351906/index.html">JavaScript compiler using ANTLR</a></li>
<li><a href="../351908/index.html">Cisco ASA: Patched Firewall Critical Vulnerability</a></li>
<li><a href="../351910/index.html">Monster of advanced threats and targeted attacks.</a></li>
<li><a href="../351912/index.html">Gartner Data & Analytics Summit 2018</a></li>
<li><a href="../351914/index.html">Marvin Minsky "The Emotion Machine": Chapter 2 "Impressors"</a></li>
<li><a href="../351918/index.html">Who's there? In the European Union offered to hide the data of the owners of domain names</a></li>
<li><a href="../351920/index.html">Android Support Library 28. What's new?</a></li>
<li><a href="../351922/index.html">Feel Neural Network or Neural Network Designer</a></li>
<li><a href="../351924/index.html">What do we know about the terrain loss of machine learning?</a></li>
<li><a href="../351926/index.html">Welcome to Front-end MeetUp in Raiffeisenbank. UPD: Broadcast Mitap</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>