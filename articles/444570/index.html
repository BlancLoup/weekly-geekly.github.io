<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Top 10 bugs in C ++ projects for 2018</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For three months now, 2018 is over. For many, it flew almost imperceptibly, but for us, the developers of PVS-Studio, it turned out to be very rich. W...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Top 10 bugs in C ++ projects for 2018</h1><div class="post__text post__text-html js-mediator-article">  For three months now, 2018 is over.  For many, it flew almost imperceptibly, but for us, the developers of PVS-Studio, it turned out to be very rich.  We worked hard, fought fearlessly to promote static analysis to the masses and looked for new errors in open source projects written in C, C ++, C # and Java.  We collected ten of the most interesting of them for you in this article! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f7b/72a/054/f7b72a054c744397f8c8c1830253ae2a.png"></div><br><a name="habracut"></a><br>  We searched for interesting places with the help of the <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> static code analyzer.  It can detect errors and potential vulnerabilities in code written in the languages ‚Äã‚Äãmentioned above. <br><br>  If you are interested in finding errors yourself, you can always download and try our analyzer.  We provide a <a href="https://www.viva64.com/ru/b/0457/">free version of the</a> analyzer for students and enthusiast programmers, a <a href="https://www.viva64.com/ru/b/0600/">free license</a> for developers of open-source projects, as well as an <a href="https://www.viva64.com/ru/m/0009/">evaluation version</a> for all-all-all.  Who knows, maybe next year you can make your top 10?  :) 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>Note: I</b> suggest the reader to check himself and, before looking at the analyzer warning, try to identify the anomalies himself.  How many mistakes can you find? <br><br><h2>  Tenth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0597">And back into space: how the unicorn Stellarium visited</a> <br><br>  This error was detected while checking the virtual planetarium Stellarium. <br><br>  The given code fragment, although small, is fraught with a rather cunning error: <br><br><pre><code class="cpp hljs">Plane::Plane(Vec3f &amp;v1, Vec3f &amp;v2, Vec3f &amp;v3) : distance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>), sDistance(<span class="hljs-number"><span class="hljs-number">0.0f</span></span>) { Plane(v1, v2, v3, SPolygon::CCW); }</code> </pre> <br>  Found? <br><br>  <b>PVS-Studio warning:</b> <a href="https://www.viva64.com/ru/w/v603/">V603</a> The object was not used.  If you wish to call the constructor, 'this-&gt; Plane :: Plane (....)' should be used.  Plane.cpp 29 <br><br>  The author of the code wanted to initialize part of the object's fields using another constructor nested in the main one.  True, instead, he only managed to create a temporary object that would be destroyed when leaving his area of ‚Äã‚Äãvisibility.  Thus, several fields of the object will remain uninitialized. <br><br>  Instead of a nested constructor call, you should use the delegating constructor introduced in C ++ 11.  For example, you could do this: <br><br><pre> <code class="cpp hljs">Plane::Plane(Vec3f&amp; v1, Vec3f&amp; v2, Vec3f&amp; v3) : Plane(v1, v2, v3, SPolygon::CCW) { distance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; sDistance = <span class="hljs-number"><span class="hljs-number">0.0f</span></span>; }</code> </pre> <br>  Then all the required fields would be correctly initialized.  Isn't it great? <br><br><h2>  Ninth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0583/">Perl 5: as in the macros errors were hidden</a> <br><br>  In ninth place, there is a remarkable macro from the Perl 5 source code. <br><br>  Collecting errors for writing an article, my colleague Svyatoslav came across a warning issued by the analyzer to use a macro.  Here it is: <br><br><pre> <code class="cpp hljs">PP(pp_match) { .... MgBYTEPOS_set(mg, TARG, truebase, RXp_OFFS(prog)[<span class="hljs-number"><span class="hljs-number">0</span></span>].end); .... }</code> </pre> <br>  To find out what was wrong, Svyatoslav dug deeper.  He opened the definition of the macro, and saw that it contains several more nested macros, some of which also had nested macros.  To understand this was so difficult that I had to use a preprocessed file.  But, alas, it did not help.  In place of the previous line of code, Svyatoslav discovered this: <br><br><pre> <code class="cpp hljs">(((targ)-&gt;sv_flags &amp; <span class="hljs-number"><span class="hljs-number">0x00000400</span></span>) &amp;&amp; (!((targ)-&gt;sv_flags &amp; <span class="hljs-number"><span class="hljs-number">0x00200000</span></span>) || S_sv_only_taint_gmagic(targ)) ? (mg)-&gt;mg_len = ((prog-&gt;offs)[<span class="hljs-number"><span class="hljs-number">0</span></span>].end), (mg)-&gt;mg_flags |= <span class="hljs-number"><span class="hljs-number">0x40</span></span> : ((mg)-&gt;mg_len = (((targ)-&gt;sv_flags &amp; <span class="hljs-number"><span class="hljs-number">0x20000000</span></span>) &amp;&amp; !__builtin_expect(((((PL_curcop)-&gt;cop_hints + <span class="hljs-number"><span class="hljs-number">0</span></span>) &amp; <span class="hljs-number"><span class="hljs-number">0x00000008</span></span>) ? (<span class="hljs-keyword"><span class="hljs-keyword">_Bool</span></span>)<span class="hljs-number"><span class="hljs-number">1</span></span> :(<span class="hljs-keyword"><span class="hljs-keyword">_Bool</span></span>)<span class="hljs-number"><span class="hljs-number">0</span></span>),(<span class="hljs-number"><span class="hljs-number">0</span></span>))) ? (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span>)Perl_utf8_length( (U8 *)(truebase), (U8 *)(truebase)+((prog-&gt;offs)[<span class="hljs-number"><span class="hljs-number">0</span></span>].end)) : (<span class="hljs-keyword"><span class="hljs-keyword">ssize_t</span></span>)((prog-&gt;offs)[<span class="hljs-number"><span class="hljs-number">0</span></span>].end), (mg)-&gt;mg_flags &amp;= ~<span class="hljs-number"><span class="hljs-number">0x40</span></span>));</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v502/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v502/">V502</a> Perhaps the '?:' Operator works in a different way.  The '?:' Operator has a operator.  pp_hot.c 3036 <br><br>  I think it will be difficult to find such a mistake with my eyes.  To be honest, we meditated on this code for a long time and came to the conclusion that in fact there is no mistake here.  But in any case, this is a rather entertaining example of unreadable code. <br><br>  They say that macros are evil.  Of course, there are moments when they are indispensable, but if you can replace a macro with a function, you should definitely do it. <br><br>  Particularly fraught with nested macros.  Not only because they are difficult to understand, but also because they can give unpredictable results.  If the author of the macro accidentally makes a mistake in such a macro, it will be much more difficult to find it than in the function. <br><br><h2>  Eighth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0559/">Chromium: other errors</a> <br><br>  The following example was taken from a series of articles on the analysis of the Chromium project.  It was covered in the library WebRTC. <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;SdpVideoFormat&gt; StereoDecoderFactory::GetSupportedFormats() <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">vector</span></span>&lt;SdpVideoFormat&gt; formats = ....; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span>&amp; format : formats) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cricket::CodecNamesEq(....)) { .... formats.push_back(stereo_format); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> formats; }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v789/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v789/">V789</a> <a href="https://cwe.mitre.org/data/definitions/672.html">CWE-672</a> iterators  stereocodecfactory.cc 89 <br><br>  The error is that the size of the vector <i>formats</i> changes within the range-based-for loop.  Range-based loops are based on iterators, so resizing a container within such loops can invalidate these iterators. <br><br>  This error will persist if you rewrite the loop with explicit use of iterators.  Therefore, for clarity, you can bring this code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> format = begin(formats), __end = end(formats); format != __end; ++format) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cricket::CodecNamesEq(....)) { .... formats.push_back(stereo_format); } }</code> </pre> <br>  For example, when using the <i>push_back</i> method, vector reallocation can occur - and then iterators will point to an invalid memory area. <br><br>  To avoid such errors, you should follow the rule: never change the size of the container inside the loop, the conditions of which are tied to this container.  This applies to range-based-cycles and cycles using iterators.  You can read about which operations may result in iterator invalidation in the <a href="https://stackoverflow.com/questions/6438086/iterator-invalidation-rules">discussion</a> at StackOverflow. <br><br><h2>  Seventh place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0594/">Godot: Regular use of static code analyzers</a> <br><br>  The first example from the video game industry will be a snippet of code found by us in the Godot game engine.  You may have to sweat to detect a mistake with your eyes, but I am sure that our sophisticated readers will cope with it: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">void</span></span> AnimationNodeBlendSpace1D::add_blend_point( <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> Ref&lt;AnimationRootNode&gt; &amp;p_node, <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> p_position, <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> p_at_index) { ERR_FAIL_COND(blend_points_used &gt;= MAX_BLEND_POINTS); ERR_FAIL_COND(p_node.is_null()); ERR_FAIL_COND(p_at_index &lt; <span class="hljs-number"><span class="hljs-number">-1</span></span> || p_at_index &gt; blend_points_used); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (p_at_index == <span class="hljs-number"><span class="hljs-number">-1</span></span> || p_at_index == blend_points_used) { p_at_index = blend_points_used; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = blend_points_used - <span class="hljs-number"><span class="hljs-number">1</span></span>; i &gt; p_at_index; i++) { blend_points[i] = blend_points[i - <span class="hljs-number"><span class="hljs-number">1</span></span>]; } } .... }</code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v621/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v621/">V621</a> <a href="https://cwe.mitre.org/data/definitions/835.html">CWE-835</a> Consider inspecting the 'for' operator.  It is possible that you will not be executed at all.  animation_blend_space_1d.cpp 113 <br><br>  Let us consider the condition of the cycle in more detail.  The counter variable is initialized with the value <i>blend_points_used - 1</i> .  At the same time, based on the two previous checks (in <i>ERR_FAIL_COND</i> and in <i>if</i> ), it becomes clear that at the time of the execution of the <i>blend_points_used</i> cycle <i>there</i> will always be more than <i>p_at_index</i> .  Thus, either the cycle condition will always be true, or the cycle will not be executed at all. <br><br>  If <i>blend_points_used - 1 == p_at_index</i> , then the loop is not executed. <br><br>  In all other cases, the check <i>i&gt; p_at_index</i> will always be true, since the counter <i>i is</i> incremented at each iteration of the loop. <br><br>  It may seem that the loop will run forever, but it is not. <br><br>  First, an integer overflow occurs for the variable <i>i</i> , which is an undefined behavior.  Therefore, relying on it is not worth it. <br><br>  If <i>i</i> were of the <i>unsigned int</i> type, then after the counter reaches the maximum possible value, the <i>i ++</i> operator would turn it into <i>0</i> .  This behavior is defined by the standard and is called "Unsigned wrapping".  However, be aware that using such a mechanism is also <a href="https://www.viva64.com/ru/b/0589/">not a good idea</a> . <br><br>  This was the first, but there is still the second!  The fact is that the integer overflow will not even reach.  Where before going out of the array.  This means that an attempt will be made to access the memory outside the block allocated for the array.  And this is also an indefinite behavior.  Classic example :) <br><br>  To make it easier to avoid such errors, I can only give a couple of recommendations: <br><br><ol><li>  Write more simple and clear code </li><li>  Perform a more thorough Code Review and write more tests for freshly written code. </li><li>  Use static analyzers;) </li></ol><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e24/4d8/f8b/e244d8f8b0062e5c822e3630b50b26bc.png"></div><br><h2>  Sixth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0574/">Amazon Lumberyard: A Cry from the Heart</a> <br><br>  Another example from the gamedev industry, namely from the Amazon Lumberyard AAA engine source code. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">TranslateVariableNameByOperandType</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Igor: yet another Qualcomm's special case // GLSL compiler thinks that -2147483648 is // an integer overflow which is not if (*((int*)(&amp;psOperand-&gt;afImmediates[0])) == 2147483648) { bformata(glsl, "-2147483647-1"); } else { // Igor: this is expected to fix // paranoid compiler checks such as Qualcomm's if (*((unsigned int*)(&amp;psOperand-&gt;afImmediates[0])) &gt;= 2147483648) { bformata(glsl, "%d", *((int*)(&amp;psOperand-&gt;afImmediates[0]))); } else { bformata(glsl, "%d", *((int*)(&amp;psOperand-&gt;afImmediates[0]))); } } bcatcstr(glsl, ")"); .... }</span></span></code> </pre> <br>  <b>PVS-Studio</b> <a href="https://www.viva64.com/ru/w/v523/">warning</a> <b>:</b> <a href="https://www.viva64.com/ru/w/v523/">V523</a> The 'then' statement is equivalent to the 'else' statement.  toglsloperand.c 700 <br><br>  Amazon Lumberyard is being developed as a cross-platform engine.  Therefore, developers are trying to support as many compilers as possible.  Programmer Igor ran into the Qualcomm compiler, as we are told comments. <br><br>  It is not known whether Igor was able to complete his task and cope with the "paranoid" checks of the compiler, but he left behind a very strange code.  It is strange that both <i>then</i> - and <i>else-</i> branches of the <i>if</i> operator contain absolutely identical code.  Most likely, such an error was made as a result of inaccurate Copy-Paste. <br><br>  I do not even know what can I advise.  Therefore, I simply wish the developers of Amazon Lumberyard success in correcting errors, and Igor, the programmer, good luck! <br><br><h2>  Fifth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0582/">Once again, the PVS-Studio analyzer turned out to be more attentive than a person</a> <br><br>  An interesting story happened to the following example.  My colleague, Andrei Karpov, was preparing an article about another testing of the Qt framework.  During the writing of notable errors, he encountered a warning from the analyzer, which he considered false.  Here is the relevant code snippet and warning: <br><br><pre> <code class="cpp hljs">QWindowsCursor::CursorState QWindowsCursor::cursorState() { <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> { cursorShowing = <span class="hljs-number"><span class="hljs-number">0x1</span></span>, cursorSuppressed = <span class="hljs-number"><span class="hljs-number">0x2</span></span> }; CURSORINFO cursorInfo; cursorInfo.cbSize = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(CURSORINFO); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (GetCursorInfo(&amp;cursorInfo)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cursorInfo.flags &amp; CursorShowing) <span class="hljs-comment"><span class="hljs-comment">// &lt;= V616 .... }</span></span></code> </pre> <br>  <b>PVS-Studio Warning:</b> <a href="https://www.viva64.com/ru/w/v616/">V616</a> <a href="https://cwe.mitre.org/data/definitions/480.html">CWE-480</a> The "CursorShowing" is used in the bitwise operation.  qwindowscursor.cpp 669 <br><br>  That is, PVS-Studio swore at the place in which, obviously, there is no error!  It cannot be that the constant <i>CursorShowing is</i> <i>0</i> , because literally a couple of lines above it is initialized to <i>1</i> . <br><br>  Since an unstable version of the analyzer was used for testing, Andrei doubted the correctness of the warning.  He carefully looked at this piece of code several times, and still did not find an error.  As a result, he wrote out this false triggering in the bugtracker so that other colleagues could correct the situation. <br><br>  And only after a detailed analysis, it turned out that PVS-Studio was again more attentive than a person.  The value <i>0x1 is</i> assigned to the named <i>cursorShowing</i> constant, and the named constant <i>CursorShowing</i> participates in the bitwise operation ‚Äúand‚Äù.  These are completely different constants, because the first begins with a lowercase letter, and the second with a capital letter. <br><br>  The code compiles successfully, because the <i>QWindowsCursor</i> class really contains a constant with that name.  Here is its definition: <br><br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">QWindowsCursor</span></span></span><span class="hljs-class"> :</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QPlatformCursor { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> CursorState { CursorShowing, CursorHidden, CursorSuppressed }; .... }</code> </pre> <br>  If the enum constant is not explicitly assigned, it will be initialized by default.  Since the <i>CursorShowing</i> is the first element of the enumeration, it will be assigned the value <i>0</i> . <br><br>  To prevent such errors, the entities should not be given overly similar names.  One should especially carefully follow this rule if these entities are of the same type or can be implicitly given to each other.  Indeed, in such cases it will be almost impossible to detect an error in the eye, and the incorrect code will successfully compile and live happily ever after inside your project. <br><br><h2>  Fourth place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0599/">Shoot in the leg, processing input</a> <br><br>  We are approaching the top three finalists, and the next step is an error from the FreeSWITCH project. <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">char</span></span></span><span class="hljs-function"> *</span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">basic_gets</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *cnt)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> c = getchar(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (c &lt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fgets(command_buf, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(command_buf) - <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">stdin</span></span>) != command_buf) { <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } command_buf[<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(command_buf)<span class="hljs-number"><span class="hljs-number">-1</span></span>] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">/* remove endline */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } .... }</code> </pre> <br>  <b>PVS-Studio warning:</b> <a href="https://www.viva64.com/ru/w/v1010/">V1010</a> <a href="https://cwe.mitre.org/data/definitions/20.html">CWE-20</a> Unchecked tainted data is used in index: 'strlen (command_buf)'. <br><br>  The analyzer warns that unchecked data <i>is</i> used in the <i>strlen</i> expression <i>(command_buf) - 1</i> .  And really: if <i>command_buf</i> is empty from the point of view of the C language string (containing a single character - '\ 0'), then <i>strlen (command_buf)</i> will return <i>0</i> .  In this case, <i>command_buf [-1]</i> will be accessed, which represents an undefined behavior.  Trouble <br><br>  The sap of this error is not even <b>why</b> it happens, but <b>how</b> it happens.  This error is one of those nice examples that you can ‚Äútouch‚Äù yourself, reproduce.  You can run FreeSwitch, perform some actions that will lead to the execution of the above code, and pass an empty line to the program. <br><br>  As a result, with a slight movement of the hand, the working program turns (yes no, not <a href="https://www.youtube.com/watch%3Fv%3DAFasD29msOc">into elegant shorts</a> ) into a non-working one!  Details on how to reproduce this error can be found in the source article at the link above, but for now I will give a visual result: <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/jSYJirPIK8E" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  Remember that the input data can be anything, and you should always check them.  Then the analyzer will not swear, and the program will be more reliable. <br><br>  Now it's time to deal with our winners: we move to the final! <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2c7/d5f/39e/2c7d5f39edfa5e07639ef95520889b09.png"></div><br><br><h2>  Third place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0591/">NCBI Genome Workbench: Scientific Research Under Threat</a> <br><br>  The top three winners are opened by a section of code from the NCBI Genome Workbench project - a set of tools for studying and analyzing genetic data.  Although it is not necessary to be a genetically modified superman to detect a mistake here, quite a few know about such a possibility of making a mistake. <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Crypt a given password using schema required for NTLMv1 authentication * @param passwd clear text domain password * @param challenge challenge data given by server * @param flags NTLM flags from server side * @param answer buffer where to store crypted password */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tds_answer_challenge</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (ntlm_v == <span class="hljs-number"><span class="hljs-number">1</span></span>) { .... <span class="hljs-comment"><span class="hljs-comment">/* with security is best be pedantic */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(hash, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(hash)); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(passwd_buf, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(passwd_buf)); ... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { .... } }</code> </pre> <br>  <b>PVS-Studio warnings:</b> <br><br><ul><li>  <a href="https://www.viva64.com/ru/w/v597/">V597</a> The compiler couldn‚Äôt delete the memset function call, which is used to flush 'hash' buffer.  The memset_s () function should be used to erase the private data.  challenge.c 365 </li><li>  <a href="https://www.viva64.com/ru/w/v597/">V597</a> The compiler couldn‚Äôt <a href="https://www.viva64.com/ru/w/v597/">need the call memorization</a> function, which is used to flush 'passwd_buf' buffer.  The memset_s () function should be used to erase the private data.  challenge.c 366 </li></ul><br>  Could you find a mistake?  If so, then you - well done! .. well, or still a genetically modified superman. <br><br>  The fact is that modern optimizing compilers can do a lot to make the compiled program run faster.  In particular, compilers are able to track that the buffer passed to <i>memset</i> is not used anywhere else. <br><br>  In this case, they can remove the "unnecessary" call <i>memset</i> , and have the full right to it.  Then the buffer that stores the important data may remain in the memory to the delight of attackers. <br><br>  Against this background, the literary comment ‚Äúwith safety is good to be pedantic‚Äù looks even funnier.  Judging by the very small number of warnings issued for this project, the developers tried very hard to be careful and write safe code.  However, as we can see, it is very easy to miss this security defect.  According to the Common Weakness Enumeration, the defect is classified as <a href="https://cwe.mitre.org/data/definitions/14.html">CWE-14</a> : Compiler Removal. <br><br>  To clear memory safely, use the <i>memset_s ()</i> function.  Not only is it more secure than <i>memset ()</i> , but it also cannot be ‚Äúignored‚Äù by the compiler. <br><br><h2>  Second place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0587/">How PVS-Studio turned out to be more attentive than three and a half programmers</a> <br><br>  The silver medalist of this top was sent to us by one of our clients.  He was sure that the analyzer gave false warnings. <br><br>  The letter was received by Eugene, skimmed it, and sent it to Svyatoslav.  Svetoslav thoughtfully looked at the part of the code sent by the client, and thought ‚Äúhow can the analyzer be so grossly wrong?‚Äù.  Therefore, he went for advice to Andrew.  He also checked the plot and decided: indeed, the analyzer gives false positives. <br><br>  What can you do, it is necessary to correct.  And only when Svetoslav began to make synthetic examples in order to formalize the task as a bugtracker, did he understand what was the matter. <br><br>  Errors were actually present in the code, but none of the programmers could detect them.  Honestly, the author of this article didn‚Äôt do it either. <br><br>  And this is despite the fact that the analyzer clearly issued warnings for erroneous places! <br><br>  Can you find such a nosy mistake?  Check yourself for vigilance and attentiveness. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/002/b12/75b/002b1275be55e7c96131de9f44d02ef7.png"></div><br>  <b>PVS-Studio warning:</b> <ul><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of the conditional expression is always false: (ch&gt; = 0x0FF21).  decodew.cpp 525 </li><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of the conditional expression is always true: (ch &lt;= 0x0FF3A).  decodew.cpp 525 </li><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of the conditional expression is always false: (ch&gt; = 0x0FF41).  decodew.cpp 525 </li><li>  <a href="https://www.viva64.com/ru/w/v560/">V560</a> A part of the conditional expression is always true: (ch &lt;= 0x0FF5A).  decodew.cpp 525 </li></ul><br>  If you succeed - my respect you do not hold! <br><br>  The error lies in the fact that the logical negation operator (!) Does not apply to the whole condition, but only to its first subexpression: <br><br><pre> <code class="cpp hljs">!((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>))</code> </pre> <br>  If this condition is met, then the value of the variable <i>ch</i> lies in the interval [0x0FF10 ... 0x0FF19].  Thus, the four further comparisons no longer make sense: they will always be either true or false. <br><br>  To avoid such errors, it is necessary to adhere to several rules.  Firstly, it is very convenient and visual to align the code with a table.  Secondly, you should not overload the expression with brackets.  For example, this code can be rewritten as: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isLetterOrDigit = (ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span> &amp;&amp; ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 0..9 || (ch &gt;= 0x0FF21 &amp;&amp; ch &lt;= 0x0FF3A) // A..Z || (ch &gt;= 0x0FF41 &amp;&amp; ch &lt;= 0x0FF5A); // a..z if (!isLetterOrDigit)</span></span></code> </pre> <br>  Then, firstly, the number of brackets becomes much smaller, and secondly, the probability of ‚Äúcatching‚Äù an accidental mistake by the eyes increases. <br><br>  And now - cherry: we move to the first place! <br><br><h2>  First place </h2><br>  Source: <a href="https://www.viva64.com/ru/b/0575/">System in shock: interesting errors in the source codes of the legendary System Shock</a> <br><br>  So, the finalist of our today's top becomes a mistake from the legendary System Shock!  This game, released in 1994, became the progenitor and inspirer of such iconic games as Dead Space, BioShock and Deus Ex. <br><br>  But first, I have to confess something.  What I will show you now does not contain any error.  By and large, it is not even a code snippet, but I just could not resist sharing it with you! <br><br>  The fact is that in the process of analyzing the source code of the game, my colleague Victoria found many interesting comments.  Here and there, suddenly there were humorous and ironic remarks, and even poems: <br><br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">// I'll give you fish, I'll give you candy, // I'll give you, everything I have in my hand // that kid from the wrong side came over my house again, // decapitated all my dolls // and if you bore me, you lose your soul to me // - "Gepetto", Belly, _Star_ // And here, ladies and gentlemen, // is a celebration of C and C++ and their untamed passion... // ================== TerrainData terrain_info; // Now the actual stuff... // ======================= // this is all outrageously horrible, as we dont know what // we really need to deal with here // And if you thought the hack for papers was bad, // wait until you see the one for datas... - X // Returns whether or not in the humble opinion of the // sound system, the sample should be politely obliterated // out of existence // it's a wonderful world, with a lot of strange men // who are standing around, and they all wearing towels</span></span></code> </pre><br>  For our Russian-speaking readers, I made an approximate free translation: <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">//    ,    , //    ,       //      //      //     //     ,      // - "Gepetto", Belly, _Star_ //  ,   , //    C  C++     // ================== TerrainData terrain_info; //    ... // ======================= //    ,     , //         //    ,          //      ,      ... - X //       , //         //   ,     //   ,    </span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">These are the comments left by the game developers at the beginning of the distant nineties ... By the way, Dag Church, the chief designer of System Shock, was also writing code. Who knows, maybe some of these comments are written by him personally? I hope about the men in towels - this is not his handiwork :)</font></font><br><br><h2>  Conclusion </h2><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In conclusion, I want to thank </font></font><a href="https://www.viva64.com/ru/team/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">my colleagues</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for looking for new errors and writing articles about them. Thanks guys! Without you, this article would not have turned out so interesting. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">And I also want to tell you a little about our achievements, because for a whole year we have been dealing not only with finding errors. We also developed and improved the analyzer, as a result of which it has undergone significant changes. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, we added support for several new compilers and expanded the list of diagnostic rules. We also implemented initial support for the </font></font><a href="https://www.viva64.com/ru/b/0596/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">MISRA C and MISRA C ++ standards</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> . The most important and time-consuming innovation was the support of a new language. Yes, now we can analyze </font></font><a href="https://www.viva64.com/ru/b/0603/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Java</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> code </font><font style="vertical-align: inherit;">! And we have </font></font><a href="https://www.viva64.com/ru/b/0611/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">updated icon</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">:) </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I also want to thank our readers. </font><font style="vertical-align: inherit;">Thank you for reading our articles and writing to us! </font><font style="vertical-align: inherit;">Your feedback is very pleasant and important to us. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This is where our top 10 C ++ errors for the 2018th year have come to an end. </font><font style="vertical-align: inherit;">Which places did you like the most and why? </font><font style="vertical-align: inherit;">Did you happen to encounter interesting examples in 2018? </font><font style="vertical-align: inherit;">Tell us about it in the comments! </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Until next time!</font></font><br><br><p> <a href="https://habr.com/en/company/pvs-studio/blog/444568/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you want to share this article with an English-speaking audience, then please use the link to the translation: George Gribkov. </font></font><a href="https://habr.com/en/company/pvs-studio/blog/444568/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Top 10 bugs of C ++ projects found in 2018</font></font></a> </div><p>Source: <a href="https://habr.com/ru/post/444570/">https://habr.com/ru/post/444570/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../444552/index.html">TDMS Fairway. Work with expertise</a></li>
<li><a href="../444556/index.html">The color of the moon and sun from space in terms of RGB and color temperature</a></li>
<li><a href="../444560/index.html">We invite you to the conference ‚ÄúClouds. Fashion trends "March 26, 2019</a></li>
<li><a href="../444564/index.html">Digital Product Development with Mental Models</a></li>
<li><a href="../444566/index.html">Sikorsky company held a demonstration of an unmanned helicopter with a man on board</a></li>
<li><a href="../444574/index.html">Miniature Macintosh Plus</a></li>
<li><a href="../444576/index.html">How a type system improves your JavaScript code</a></li>
<li><a href="../444578/index.html">Speakers Top 3D Expo 2019: Yousef Hesuani from 3dbio - 3D-printing of organs and tissues</a></li>
<li><a href="../444580/index.html">FBO Sheremetyevo infrastructure: how light aircraft are prepared for flight</a></li>
<li><a href="../444582/index.html">Palo Alto Networks NGFW Security Policy Optimizer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>