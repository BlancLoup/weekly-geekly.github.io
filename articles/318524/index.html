<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Experience in using self-hosted continuous integration systems</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 


 It's hard to imagine modern development without Continuous Integration. Many companies release several releases a day and run thousan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Experience in using self-hosted continuous integration systems</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br><p>  It's hard to imagine modern development without Continuous Integration.  Many companies release several releases a day and run thousands of tests.  Since the time of <a href="https://jenkins.io/">Jenkins</a> and <a href="https://travis-ci.org/">Travis CI</a> , a wide <a href="https://github.com/ciandcd/awesome-ciandcd">variety of tools</a> have appeared on the market.  Most of them work on the SaaS model - you pay a fixed fee for using the service, or for the number of users. </p><br><p>  But using hosted platforms is not always possible, for example, if you can‚Äôt transfer application code, or don‚Äôt want to depend on external services.  In this case, help out systems that can be installed on their servers (self-hosted).  As a bonus, you have full control over resources and can scale them according to your needs using, for example, <a href="https://aws.amazon.com/ru/ec2/">amazon ec2</a> . </p><br><p>  This article presents a personal experience of using multiple opensource self-hosted continuous integration systems.  If you used other systems, tell us about it in the comments. </p><a name="habracut"></a><br><h3>  Basic concepts </h3><br><p>  The basis of any CI is a build (build) - a single build of your project.  Build can be collected on various triggers - push to the repository, pull-request, according to the schedule.  Build consists of a set of tasks (jobs).  Tasks can be performed both sequentially and in parallel.  A set of tasks is given by listing all tasks or by the build matrix, the characteristics that divide them.  For example, specifying the versions of the programming language and environment variables ‚Äî each task will be created for each version of the language and each variable value. </p><br><p>  In some ci systems there is also a pipeline of tasks (pipeline) - tasks are combined into groups (stage), all tasks in the current group are executed in parallel, the next group is executed only if the previous group has completed successfully.  For example, the test-deploy pipeline: if all the tasks in the test have completed successfully, then you can run tasks from the deploy group. </p><br><p>  For ci to work efficiently, it is important to have a cache - data that is used to speed up assembly.  These can be apt-packages, npm cache, composer.  Without a cache, when each task is started, it will be necessary to download and install all dependencies again, which may take longer than the test run itself.  The closer the cache is to the servers on which tasks are performed, the better, for example, if you use amazon ec2, then a good option would be to store the cache in amazon s3. </p><br><p>  When building a build, artifacts can be generated - build results, clean code reports, logs.  CI-system that allows you to view and download these artifacts, greatly facilitates life. </p><br><p>  If you have a large project with a large number of simultaneously running tasks, then you can not do without scaling.  Scaling is manual and automatic.  With manual scaling, you yourself start and stop runners on free servers.  In the case of automatic scaling, the system decides whether it is necessary to create new virtual machines and in what quantity.  Different ci-systems support different providers - usually amazon, google compute, digital ocean, etc. </p><br><p>  It is important how the system runs the commands specified in the build configuration (executors).  There are several ways: direct execution (on the host where the runner is running), execution in a virtual machine, in a docker container, via ssh.  Each method has features that need to be considered when choosing a ci-system, for example, when starting a task in a docker-container there is no session and terminal, due to which some things will not be able to be tested.  And when running on a host, do not forget about cleaning up resources after the end of execution ‚Äî deleting data from the database, docker images, etc. </p><br><p>  Finally, there are parameters that are not critical, but make working with ci more pleasant.  Log output - does it work in realtime mode, or at some interval?  Is it possible to interrupt the build in case of problems?  Can I see the build configuration and tasks? </p><br><h3>  Drone </h3><br><img src="https://habrastorage.org/files/333/660/72e/33366072e897465ebb62afde58f5010f.png"><br>  <a href="https://github.com/drone/drone">Drone</a> is a continuous integration system based on docker containers.  Written in Go.  The current version is 0.4, version 0.5 is in beta.  The review covers version 0.5. <br><br>  Drone can work with a large number of git-repositories - GitHub, Bitbucket, Bitbucket Server, GitLab, Gogs.  The build configuration is configured in the .drone.yml file in the repository root. <br><br>  The build consists of several steps, each step is executed in parallel in a separate docker-container.  The build matrix is ‚Äã‚Äãset by environment variables.  It is possible to use service containers - for example, if you are testing a web application that works with a database, then you need to specify the docker image of the database in the services section, and it will automatically be available from the build container.  You can use any docker images. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Drone consists of drone server and drone agent.  Drone server performs the role of coordinator, and one or several drone agents launch builds.  Scaling is performed by launching additional drone agents.  There are no opportunities to use cloud resources for autorun agents.  There is no built-in cache support (there are third-party plug-ins to load and save the cache on s3 storage). <br><br>  The commands specified in the build are executed directly in the docker container by the sh interpreter, which creates problems if you need to execute complex commands with conditional logic. <br><br><h3>  Gitlab ci </h3><br><img src="https://habrastorage.org/files/224/ed5/2e6/224ed52e6f644e68a7328963df9fda6c.png"><br><br>  <a href="https://about.gitlab.com/gitlab-ci/">Gitlab CI</a> is part of the Gitlab project, a self-hosted Github equivalent.  Gitlab is written in ruby, and <a href="https://gitlab.com/gitlab-org/gitlab-ci-multi-runner">gitlab runner</a> is written in Go.  The current version of gitlab is 8.15, the gitlab runner is 1.9. <br><br>  Since Gitlab CI is integrated with gitlab, it only uses gitlab as a repository.  You can mirror third-party repositories on gitlab, but in my opinion, this is not very convenient.  Build is organized on the principle of conveyor.  You can customize the type of launch tasks - automatically or manually from the web interface. <br><br>  Gitlab CI consists of a web interface (coordinator) and runners.  The coordinator distributes tasks to runners that perform them.  There is a large selection of executors - shell, docker, docker-ssh, ssh, virtualbox, kubernetes.  The build log is not real-time - the web interface periodically polls the server; if a new part of the log appears, then it is added to the end. <br><br>  There is a built-in cache support, any s3-compatible storage can be used as storage.  There are artifacts - you can view individual files and download the artifact entirely from the web interface. <br><br>  Work with cloud resources is organized using docker mashine.  When a request is received for a new build, if there is no free machine, docker mashine will create a new machine and start the build on it.  In this case, the images required for the build will have to be downloaded again, so gitlab recommends raising a separate docker registry, which would be on the same network as the docker mashine provider. <br><br><h3>  SimpleCI </h3><br><img src="https://habrastorage.org/files/d4f/fd2/bcf/d4ffd2bcf6ad4522abed30cc2352ce78.png"><br><br>  <a href="https://github.com/simpleci/simpleci">SimpleCI</a> is a continuous integration system that was written to maximize the efficient use of resources.  Frontend is written in php (Symfony3, es6), backend is written in java.  The current version is 0.6, is under active development. <br><br>  SimpleCI supports github and gitlab repositories.  Build, also, as well as in gitlab, is organized by the principle of the conveyor.  If all tasks within one stage are completed successfully, then the next stage is started. <br><br>  Supports work with cash.  The cache is poured into the storage only if the cache files have changed within the scope of the task.  Implemented work with two types of storage - s3-compatible and <a href="https://cloud.google.com/storage/">google storage</a> . <br><br>  Build is performed by running the docker containers, connecting to the build container via ssh and running the build script.  The build log is displayed in real time (using websockets and <a href="https://github.com/centrifugal/centrifugo">centrifugo</a> ). <br><br>  It is possible to autoscale by using the resources of cloud providers (so far only <a href="https://cloud.google.com/compute/">google compute engine</a> ).  When setting up scaling, you need to specify a snapshot that will be used when creating a virtual machine.  This allows you to create a snapshot with the necessary docker-images, so as not to download from every time you create a new machine.  Support artifacts yet. <br><br><h3>  Conclusion </h3><br>  The review presents several self-hosted open source continuous integration systems.  In addition to those considered, there are also many hosted, commercial and open systems.  Choosing from all the variety of CI-systems, pay attention to what you need, and the tests will thank you. <br><br><h3>  Links </h3><br><ul><li>  <a href="https://github.com/drone/drone">Drone</a> </li><li>  <a href="https://about.gitlab.com/gitlab-ci/">Gitlab ci</a> </li><li>  <a href="https://github.com/simpleci/simpleci">SimpleCI</a> </li><li>  <a href="https://jenkins.io/">Jenkins</a> </li><li>  <a href="https://github.com/ciandcd/awesome-ciandcd">awersome ci</a> - list of ci systems, testing tools and deployment </li></ul></div><p>Source: <a href="https://habr.com/ru/post/318524/">https://habr.com/ru/post/318524/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../318512/index.html">Do sites fall on holidays more often than usual? Myths, reality and how to protect yourself</a></li>
<li><a href="../318514/index.html">Radiant Chinese machine and painting machine to them. Frankenstein</a></li>
<li><a href="../318518/index.html">Kaggle: Allstate Claims Severity</a></li>
<li><a href="../318520/index.html">How I learned not to worry and fell in love with microservices, part 1: The effects of bad code</a></li>
<li><a href="../318522/index.html">How to update the kernel in the system without restarting the services (step-by-step instruction)</a></li>
<li><a href="../318526/index.html">Machine learning as a new business analysis tool</a></li>
<li><a href="../318528/index.html">How the new design of the PVS-Studio code analyzer developers' website viva64.com was made</a></li>
<li><a href="../318530/index.html">Indecent simple maze generation algorithm</a></li>
<li><a href="../318532/index.html">As my fingers turned out, and I collected a bike for deployment, which saved more than 2 thousand working hours per project.</a></li>
<li><a href="../318534/index.html">Why all these ‚Äúbuns‚Äù: What will IT companies offer you besides salary</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>