<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>nanoCAD and side bows, or program Reversi for the CAD platform</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Some time ago, an article about programming under nanoCAD was published on Habr√© in the Nanosoft blog. And on the same day, an article about ‚ÄúReversi ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>nanoCAD and side bows, or program Reversi for the CAD platform</h1><div class="post__text post__text-html js-mediator-article">  Some time ago, an article about <a href="http://habrahabr.ru/company/nanosoft/blog/">programming under nanoCAD</a> was published on Habr√© in the Nanosoft blog.  And on the same day, an article about <a href="http://habrahabr.ru/blogs/python/87009/">‚ÄúReversi programming in Python‚Äù</a> ran through.  A week later, Reversi was written in <a href="http://habrahabr.ru/blogs/silverlight/87426/">Silverlight</a> , a little later in <a href="http://habrahabr.ru/blogs/crazydev/89822/">Tcl / Tk</a> .  It was safe to say that the game Reversi went to the people.  Just at that time I was studying the possibilities of scripts under nanoCAD.  But learning required practice.  And I thought - why am I worse?  And I decided to write a kind of "nano-boyan."  So 3D Reversi appeared. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/030/96c/81c/03096c81cc3e3d13ab758c0358135832.jpg" alt="Title image"><br><a name="habracut"></a><br>  Script capabilities of CAD platforms have always attracted me.  Using the script, you can screw your own functionality to a large system.  Thereby, using CAD not only as developers have ‚Äúsewn up‚Äù into it, but also for my subjective purposes. <br><br>  For the practice of studying the symbiosis of nanoCAD and JScript, I began to write a "frivolous" script, under the CAD system. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Start </h2><br>  I divided the development of the game mentally into three parts: the development of the game field (interface), the development of interactivity (interaction with the user), and the game algorithms themselves. <br><br>  To develop the playing field, I needed to create objects in the nanoCAD model space.  Without documentation, all attempts to write something for something are probably doomed.  And the first thing I did - I began to look for a description of objects and functions.  I asked Google (almost like a song is sung) and received a large number of links to various sites describing the AutoCAD object model.  For example <a href="http://vbamodel.narod.ru/">this</a> site. <br><br><h2>  Creating objects </h2><br>  Objects are added using the ThisDocument.ModelSpace collection.  Immediately make a reservation that I wrote in JScript, because as I program in C ++, the syntax of JS is closer to me than the syntax of VB Script. <br><br>  The field consists of 64 cells, a grid and chips.  I made the grid and chips with bulky shapes.  And for the cells of the field, I used hatching. <br><br> <code>//    ( shag   ). <br> var polyline; <br> var RefPoly = new Array(0,0,0, shag,0,0, shag,shag,0, 0,shag,0); <br> <br> polyline = ms.AddPolyline(ut.CreateTypedArrayFromJSArray(5, RefPoly)); <br> polyline.Closed = true; <br> <br> //   : <br> hatch = ms.AddHatch(1,"SOLID",false,0); <br> hatch.AppendOuterLoop(polyline);</code> <br> <br>  Then I multiplied the cells and put them in their places. <br><br>  Next I need borders and game chips.  Just copy the game written in Python, it was not interesting.  Needed its own zest.  Since nanoCAD has the ability to display objects in space, this highlight was the volume of the board and gaming chips.  Therefore, I made curbs and tiles 3DMesh objects. <br><br>  Each edge is just a rectangle.  And each chip is a sphere. <br>  Object objects are objects of type 3DMesh.  They are created using the Add3DMesh (...) ModelSpace collection.  This is a network of size M on N cells.  To create it, you need to specify in the array the coordinates of all vertices of the network.  Along the rows: first points of the first row, then the second, and so on until M. <br><br><pre> <code class="hljs django"><span class="xml"><span class="xml">//    : var mesh = new Array(); var n = 0; for (i=-1;i</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">2;</span></span></span></span><span class="xml"><span class="hljs-tag"> ++</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">i</span></span></span></span><span class="xml"><span class="hljs-tag">) </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">for</span></span></span></span><span class="xml"><span class="hljs-tag"> (</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;j</span></span></span></span><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">9</span></span></span></span><span class="xml"><span class="hljs-tag">; ++</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">j</span></span></span></span><span class="xml"><span class="hljs-tag">) { </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mesh</span></span></span></span><span class="xml"><span class="hljs-tag">[</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span></span><span class="xml"><span class="hljs-tag">] =</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">0;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mesh</span></span></span></span><span class="xml"><span class="hljs-tag">[++</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span></span><span class="xml"><span class="hljs-tag">]=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">shag*j;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mesh</span></span></span></span><span class="xml"><span class="hljs-tag">[++</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span></span><span class="xml"><span class="hljs-tag">]=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">shag*i/10;</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">n</span></span></span></span><span class="xml"><span class="hljs-tag">++; } //  ,  ,    </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">YZ.</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">var</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">mesh3d</span></span></span></span><span class="xml"><span class="hljs-tag"> = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">ms.Add3DMesh(3,9,ut.CreateTypedArrayFromJSArray(5,mesh));</span></span></span></span></span></span></code> </pre> <br>  Then I added thickness to the ribs so that the ribs did not disappear when viewed from above. <br><br>  It was more difficult to build a sphere than edges.  I had to remember the analytical geometry of the times of the 1st course.  I did not go to the library.  I went to Wikipedia and found out how spherical coordinates are expressed via Cartesian. <br><pre> <code class="hljs matlab">var Vertexs = new Array(); var idx =<span class="hljs-number"><span class="hljs-number">-1</span></span>; var r =<span class="hljs-number"><span class="hljs-number">22</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">j</span></span> &lt;= <span class="hljs-number"><span class="hljs-number">20</span></span>; ++<span class="hljs-built_in"><span class="hljs-built_in">j</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>=<span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">i</span></span> &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>; ++<span class="hljs-built_in"><span class="hljs-built_in">i</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">beta</span></span> = Math.PI / <span class="hljs-number"><span class="hljs-number">19</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">j</span></span>; alfa = <span class="hljs-number"><span class="hljs-number">2</span></span> * Math.PI / <span class="hljs-number"><span class="hljs-number">20</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">i</span></span>; Vertexs[++idx] = <span class="hljs-number"><span class="hljs-number">25</span></span> + r*(Math.<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(alfa)*Math.<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">beta</span></span>)); Vertexs[++idx] = <span class="hljs-number"><span class="hljs-number">25</span></span> + r*(Math.<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(alfa)*Math.<span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">beta</span></span>)); Vertexs[++idx] = r*Math.<span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">beta</span></span>); } fishka_b = ms.Add3DMesh(<span class="hljs-number"><span class="hljs-number">20</span></span>,<span class="hljs-number"><span class="hljs-number">20</span></span>,ut.CreateTypedArrayFromJSArray(<span class="hljs-number"><span class="hljs-number">5</span></span>,Vertexs));</code> </pre> <br><br>  As a result of these actions, the following playing field has turned out: <br><img src="https://habrastorage.org/getpro/habr/post_images/71d/dcf/608/71ddcf60851fd5373c14722c08c6c433.jpg" alt="picture 1"><br><br><h2>  User interaction </h2><br>  The next step was to organize the interaction of the script with the user.  You need to ask where the player wants to put his chip.  This is what the GetEntity () function does. <br><br><pre> <code class="hljs pgsql">// ,   ,   ,    <span class="hljs-number"><span class="hljs-number">1</span></span>   <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (hatch==<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { ut.GetEntity(RefPoly,<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>," "); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RefPoly.length == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; RefPoly [<span class="hljs-number"><span class="hljs-number">0</span></span>].EntityName == "AcDbHatch") { //     ‚Äì   .    . <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RefPoly[<span class="hljs-number"><span class="hljs-number">0</span></span>].Hyperlinks.Count &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) hatch = RefPoly [<span class="hljs-number"><span class="hljs-number">0</span></span>]; } x = parseInt (hatch.Hyperlinks.Item(<span class="hljs-number"><span class="hljs-number">0</span></span>).URLDescription); y = parseInt (hatch.Hyperlinks.Item(<span class="hljs-number"><span class="hljs-number">0</span></span>).URLNamedLocation); }</code> </pre> <br>  There is a trick here: in order not to calculate the coordinates of each of the hatchings, when creating each of them, I laid out the location information on the field. <br><br> <code>//  i, j ‚Äì    <br> hatch.Hyperlinks.Add("xy",i.toString(),j.toString()); <br> <br> //     ,     : <br> x = parseInt (hatch.Hyperlinks.Item(0).URLDescription); <br> y = parseInt (hatch.Hyperlinks.Item(0).URLNamedLocation);</code> <br> <br>  I will not dwell on the algorithms in more detail.  I did not write super smart AI.  And I made the decision function from the Reversi on Python source.  I must say that I have not seen Python before this day even once.  Everything is quite readable.  Adaptation to JScript took me 10 minutes. <br><br><h2>  Nuances and Tricks </h2><br>  Now about the nuances of scripting under the NanoCAD. <br>  I don‚Äôt know exactly how in VBS, but in JScript all variables are passed to functions by value, not by reference.  What does it mean?  This means that if you specify a JScript variable when calling a method and expect that the result will return to you after the execution of the method, then you will be upset - this will not happen.  The variable will not change.  So, for example, with the GetEntity method (Object, PickedPoint [, Prompt]).  The first parameter in it is a variable, through which the set of selected objects is returned.  But in JS it does not work.  How to bypass this restriction?  It is necessary to transfer an array instead of a variable. <br><br> <code>var RefPoly = new Array(); <br> ut.GetEntity(RefPoly,null," "); <br> var entity = RefPoly[0]; //     .</code> <br> <br>  The second important point is that the methods associated with the coordinates (creating objects, for example) do not accept script arrays.  Since JS and VBS languages ‚Äã‚Äãare weakly typed, their arrays can contain elements of different types.  It is unacceptable.  To cast to a typed array, use the functions of the Utility object CreateTypedArray (varArr, Type, ParamArray) and CreateTypedArrayFromJSArray (Type As Long, varJSArray).  Here Type is an indication of the type of the elements of the array, and JSArray is the array itself. <br><br> <code>//  js      <br> var RefPoly = new Array(0,0,0, shag,0,0, shag,shag,0, 0,shag,0); <br> <br> //  ,     ,   TypedArray. <br> var polyline = ms.AddPolyline(ut.CreateTypedArrayFromJSArray(5,RefPoly));</code> <br> <br><h2>  Running script </h2><br>  To properly display the elements of the game you need to set the style of lighting models.  The style is set in the menu View -&gt; Style.  I set the exact style without showing the edges. <br>  To run the reverse, we write the command ‚ÄúJS‚Äù in the command line of the nanoCAD.  And then we specify the full path to the nanoReversi.js script. <br><br><h2>  Result </h2><br>  After three evenings, I reached the goal I had set myself - the game Reversi earned under nanoCAD. <br><img src="https://habrastorage.org/getpro/habr/post_images/768/999/7ed/7689997ed3aa484a7466a5bb88f8faac.jpg" alt="picture 2"><br><br>  In reversi isomerism look much more unusual.  I was absolutely pleased. <br><img src="https://habrastorage.org/getpro/habr/post_images/94d/3a8/e06/94d3a8e06621016f5dd2010255d6f914.jpg" alt="picture 3"><br><br>  Despite the fact that I wrote a reverse that is called ‚ÄúJust for fun‚Äù, the script demonstrates the capabilities of ActiveX Automation nanoCAD.  And if you remember that you can use other ActiveX servers in scripts, for example ADO to connect to databases, the scripting tasks are no longer as serious as Reversi. <br><br>  The demo script can be downloaded <a href="">here</a> . </div><p>Source: <a href="https://habr.com/ru/post/90742/">https://habr.com/ru/post/90742/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../90734/index.html">On Seopult live Hosting Community talks about Makhost</a></li>
<li><a href="../90735/index.html">Habraicon</a></li>
<li><a href="../90737/index.html">JavaWS found a backdoor</a></li>
<li><a href="../90738/index.html">Realaxy Actionscript Editor</a></li>
<li><a href="../90739/index.html">Analysis of the design and structure of the site "Is everything okay in the Danish kingdom?"</a></li>
<li><a href="../90745/index.html">15 minutes with Dmitry Grishin</a></li>
<li><a href="../90746/index.html">The system of online counseling program 1C for users</a></li>
<li><a href="../90747/index.html">Pension antivirus</a></li>
<li><a href="../90749/index.html">Animated progress bar subjectively speeds up loading</a></li>
<li><a href="../90750/index.html">RACIOS 2.0 beta</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>