<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Become a manager. Part two</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the second day, we already got used to the idea that Debian and Ubuntu love really free software and are already starting to think about how we wou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Become a manager. Part two</h1><div class="post__text post__text-html js-mediator-article">  On the second day, we already got used to the idea that Debian and Ubuntu love really free software and are already starting to think about how we would start to build our first package.  But stop!  And what programs do we know how to use?  What?!  OpenOffice.org Writer and Kopete?  No, well, so it will not work.  Today I will tell you the mandatory minimum that every future accompanying package will need (I decided to accept this term, leaving the overseas word ‚Äúmeinteiner‚Äù only in the title, as a tribute to the first article), and just any ubuntuser will come in handy in life. <br>  (Parts <a href="http://habrahabr.ru/blogs/ubuntu/50540/">1</a> , <a href="http://habrahabr.ru/blogs/ubuntu/50716/">3</a> and <a href="http://habrahabr.ru/blogs/ubuntu/51427/">4</a> ) <br><a name="habracut"></a><br><br><h4>  GPG </h4><br>  And we start with the GnuPG utility or just GPG.  What it is?  GPG is your ID, the ability to demonstrate on the Internet that you are hiding under your name, and not a malicious enemy, it is the ability to encrypt a mail or jabber message, it is the ability to sign the file, keeping the fingerprint in a separate file.  Agree, it is much more reliable than a simple md5-hash - you also make it clear that you (and not someone else) saved the file (or files) in this state.  In general, GPG is a very useful and necessary household tool.  I will not tell all his opportunities, they can be read in mana, and I will tell only the most basic.  So, we put the package in command <br><blockquote><code>$ sudo apt-get install gnupg</code> </blockquote> <br>  Now we need to create our own key pair.  Typing <br><blockquote> <code>$ gpg --gen-key</code> </blockquote> <br>  The standard key type (DSA and ElGamal) is fine with us, the standard size (2048 bits), too.  The term of validity (without limitation) also suits the standard.  Next we need to enter information about yourself.  As an example, Debian offers: ‚ÄúBaba Yaga (pensioner) &lt;yaga@deepforest.ru&gt;‚Äù, where the information in brackets is a comment.  It is not necessary for us to enter it, you can just restrict your name and e-mail: <br><blockquote> <code>  : Ivan Ivanov <br> Email-: ivan@ivanov.iv <br> : <br>    User ID: <br> "Ivan Ivanov &lt;ivan@ivanov.iv&gt;"</code> </blockquote> <br>  If you enter the name and e-mail address specified for your login in / etc / passwd, then this key will by default be used to sign and encrypt everything that is possible. <br>  Next we need to enter a password.  Due to the fact that when signing a package, you will have to enter it more than once, I have often heard statements like ‚ÄúYes, create a separate key without a password, it‚Äôs so secret, nobody will steal it from your laptop, and in general‚Äù .  Do not fall for such provocations.  Your gpg-key is your passport and more.  To create a key without a password is the same as carrying a bag with a broken lightning bolt ‚Äî even if we always keep it in front of us and cross the subway with running only at a run ‚Äî why provoke potential thieves?  Therefore, we come up with a complicated, memorable password, and finally we get a desired pair of keys: <br><blockquote> <code>$ gpg --list-keys <br> /home/user/.gnupg/pubring.gpg <br> ---------------------------------- <br> pub 1024D/3904FAE7 2009-01-30 <br> uid Ivan Ivanov &lt;ivan@ivanov.iv&gt; <br> sub 2048g/2DA010F1 2009-01-30</code> </blockquote> <br>  Next we need to send our public key to some key server so that anyone can import it to himself: <br><blockquote> <code>$ gpg --keyserver subkeys.pgp.net --send-keys 3904FAE7 <br> gpg:   3904FAE7  hkp  subkeys.pgp.net</code> </blockquote> <br>  Now anyone can enter the command <br><blockquote> <code>$ gpg --keyserver subkeys.pgp.net --recv-keys 3904FAE7</code> </blockquote>  and get your public key.  3904FAE7 in this case is your personal key id. <br>  Now add two lines to your ~ / .bashrc: <br><blockquote> <code>export DEBFULLNAME="Ivan Ivanov" <br> export DEBEMAIL="ivan@ivanov.iv"</code> </blockquote>  to be used later when creating and signing packages.  On this we can leave GPG for now and go on to the next part. <br><br><h4>  Apt </h4><br>  Yes, now we will talk about the magic set of utilities APT and its use in the assembly packages.  Unfortunately, many people are familiar with this package rather superficially, but how many problems could we have avoided. <br>  First, remember the <b>apt-key</b> utility.  It will be useful to us if we connect a third-party repository.  This utility manages a list of trusted keys with which different repositories can be signed.  If we execute the command <blockquote> <code>$ sudo apt-key list</code> </blockquote>  then we get a standard list of keys that are signed by the official repository of your distribution.  How to add another repository key there?  For example: <br><blockquote> <code><a href=""></a> $ wget -O - qutim.org/debian/archive.key | sudo apt-key add -</code> </blockquote>  With wget, we will download the qutIM repository public key from the site and pass it on to the apt-key command.  Now packages signed with this key will be considered ‚Äúgood‚Äù and installed without warning. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Go ahead.  I promised to tell you <a href="http://habrahabr.ru/blogs/ubuntu/49957/">why this</a> approach is so terrible.  Of course, if we were true Slackware users, holding all the installed packages with dozens of dependencies in mind, it would have been easy for us to compile and install another program from source (familiar Slackware users say that in recent versions there is even a complete package manager, perhaps even honestly <s>cn ...</s> stolen from Debian, but they still prefer to keep track of all dependencies manually in the old manner).  But we all know what a package distribution is, dependencies, version control in the end.  Putting pidgin into / opt / is uncivilized, even for the simple reason that once forgotten, we tap the pidgin button in the menu and launch the old version, with the broken ICQ. <br>  ‚ÄúYou can after all specify the prefix / usr /,‚Äù you say.  Of course, the very first update package in the repository will rub your patched version.  Who really needs it?  No, we will do everything culturally.  Since pidgin is a big, ugly and heavy package, and in general I don‚Äôt like it, I‚Äôll tell you everything using the example of the ccache package that caches the compiler object files during build. <br>  As is known, this package makes the files ‚Äúgcc‚Äù, ‚Äúg ++‚Äù and a few more similar files with symlinks to its executable file / usr / bin / ccache, while it itself looks at the name of the called file, according to which it substitutes the necessary compiler.  But here's the problem - many sources when compiling refer to the file ‚Äúc ++‚Äù, which should be a symlink to any suitable compiler, but the ccache does not know the ‚Äúc ++‚Äù compiler.  What to do?  I decided not to suffer, not to retrain the source code and not to create unnecessary files, but to do with a dirty hack. <br>  So, to work with source packages, we look at the /etc/apt/sources.list file.  If we see there commented lines beginning with ‚Äúdeb-src‚Äù, we can safely comment them out, these are instructions on where to get the package files with source codes. <br>  Now we take the cherished apt-get command familiar to us almost from childhood and execute it three times with different parameters: <blockquote> <code>$ sudo apt-get update <br> $ sudo apt-get install devscripts lintian <br> $ apt-get source ccache</code> </blockquote>  With the first command we update the list of available packages after editing sources.list, with the second we install the scripts needed to build the packages, and with the third we download the package with the ccache sources.  Notice that in order to download the source package we don‚Äôt even need superuser rights.  Meanwhile, APT informs us: <blockquote> <code><a href="http.us.debian.org/"></a> <a href="http.us.debian.org/"></a> <a href="http.us.debian.org/"></a> :1 http.us.debian.org sid/main ccache 2.4-16 (dsc) [1118B] <br> :2 http.us.debian.org sid/main ccache 2.4-16 (tar) [86,4kB] <br> :3 http.us.debian.org sid/main ccache 2.4-16 (diff) [44,1kB] <br>  132k  2s (51,1k/c) <br> dpkg-source:  ccache  ccache-2.4 <br> dpkg-source: :  ccache_2.4.orig.tar.gz <br> dpkg-source: :  ccache_2.4-16.diff.gz</code> </blockquote> <br>  Please note: the source package consists of three files: the .orig.tar.gz file is an archive with unchanged source codes - such as the developer of the program himself distributes them, the .diff.gz file is a diff file that contains all changes to the source code , including debian assembly instructions (about these instructions next time), and a .dsc file that stores brief information about the package, hashes of the first two files, and the dsc file itself is signed by the GPG signature of the package author.  If desired, we could get the public key and verify this signature, but since we took the package from the official repository, we will not deal with such nonsense.  Therefore, we go into the ccache-2.4 directory and, using our favorite text editor, change the file " <code>x_asprintf(&amp;fname, "%s/%s", tok, name);</code> " in the execute.c file <code>x_asprintf(&amp;fname, "%s/%s", tok, name);</code> "to the lines: <blockquote> <code>if (strcmp(name, "c++") == 0) { <br> x_asprintf(&amp;fname, "%s/%s", tok, "g++"); <br> } else { <br> x_asprintf(&amp;fname, "%s/%s", tok, name); <br> }</code> </blockquote> <br>  It is clear that most of you will never need this program and this patch, but at least the next time if you want to fix the package, for example, replace the icons in it with your favorites or add the line ‚ÄúVasya here‚Äù to ‚ÄúAbout the program‚Äù, you will imagine what to do. <br>  So, we fixed the source code, what should we do next?  That's right, you need to increase the version number of the package.  We type all in the same directory command <blockquote> <code>$ dch -i</code> </blockquote>  This will launch your favorite editor (I have this vim), in which the changelog will already be open, and a template for a record about the new version added.  If you have already restarted your bash by the time of this command execution or simply rediscovered the console, then your name and e-mail, which we added to the ~ .bashrc file, will be substituted as the author of the changes.  For me, for example, the proposed pattern looks like this: <blockquote> <code>ccache (2.4-16.1) unstable; urgency=low <br> <br> * Non-maintainer upload. <br> * <br> <br> -- Vsevolod Velichko &lt;torkvemada@nigma.ru&gt; Fri, 30 Jan 2009 06:05:36 +0300</code> </blockquote> <br>  The ‚ÄúNon-maintainer upload‚Äù post was added automatically to show that this version of the package was created not by the maintainer of the package, but by an outsider.  The proposed version number does not suit us, let's increase it and add a little bit of informativeness to the information about the changes.  As a result, our record takes the following form: <blockquote> <code>ccache (2.4-17) unstable; urgency=low <br> <br> * Non-maintainer upload <br> * Patched for the "c++" as compiler name support <br> <br> -- Vsevolod Velichko &lt;torkvemada@nigma.ru&gt; Fri, 30 Jan 2009 06:05:36 +0300</code> </blockquote>  Save and exit.  Now we need to see if we have everything necessary for building this software package.  Open the file ccache-2.4 / debian / control in your favorite editor and look for the following line in it: <blockquote>  Build-Depends: debhelper (&gt;&gt; 6), autotools-dev, zlib1g-dev </blockquote>  It lists which packages, besides the standard ones, will be required to build the package.  We recruit for warranty: <blockquote> <code>$ sudo apt-get install debhelper autotools-dev zlib1g-dev</code> </blockquote>  make sure that all the required packages have been delivered or are already standing, after which we can proceed to the actual assembly. <br>  Another way to install all the packages you need to build is: <blockquote> <code>$ sudo apt-get build-dep ccache</code> </blockquote>  This method is suitable for you when all your changes are at the patch level and do not add anything to the program that would require new dependencies - some additional libraries, running external programs when building, or something else. <br>  All in the same directory ccache-2.4 type magic command <blockquote> <code>$ debuild --lintian-opts -i</code> </blockquote>  A team with such an inappropriate name as debuild does nothing else but picks up a package, then puts the lintian program on it, which catches badly designed packages, and finally finishes the assembled package with the debsign command, which signs the assembled package (at this stage , if you correctly entered your name and email in the changelog, you will be asked for the password from your gpg-key, which we generated in the first part).  Let's take a look at the lintian output, it tells us which errors were found during the build: <br><blockquote>  Now running lintian ... <br>  W: ccache source: source-nmu-has-incorrect-version-number 2.4-17 <br>  N: <br>  N: A source NMU should have a Debian revision of "-xx" (or "+ nmuX" for a <br>  N: native package).  This is to prevent stealing version numbers from the <br>  N: maintainer. <br>  N: <br>  N: Maybe you didn‚Äôt intend this upload to be a NMU, in that case, please <br>  N: doublecheck thats most recent entry in the changelog is byte-for-byte <br>  N: identical to the maintainer or one of the uploaders.  If this is a local <br>  N: package (not intended for Debian), you can suppress this warning by <br>  N: putting "local" in the version number or "local package" on the first <br>  N: line of the changelog entry. <br>  N: <br>  N: Refer to Debian Developer's Reference section 5.11.2 (NMU version <br>  N: numbering) for details. <br>  N: <br>  N: Severity: normal;  Certainty: certain <br>  N: </blockquote><br>  Is it convenient?  Not only tell you what the error is, but also send to the appropriate section of the Debian developer documentation.  Here I want to point out that in Debian the lintian utility is much stricter on packages than in Ubuntu, so if you want to get the perfect package, build it in Debian, and then port it into ubuntu, the mosquito doesn‚Äôt rub off.  In this case, we were informed that our only mistake was that by deliberately changing the new version number offered to us, we changed it incorrectly.  Now we will exit the directory one level higher and install the assembled package: <blockquote> <code>$ sudo dpkg -i ccache_2.4-17_amd64.deb</code> </blockquote> <br>  What is left for us?  The most attentive reader who has read this far will surely ask himself: what if a new version of ccache is released, with a version number greater than 2.4-17?  There are at least two solutions to this question.  The first point in the build version is not 2.4-17, but obviously a large one, for example, 5.7-99.  But such a decision once turned out to be ineffective when the proftpd patched by me suddenly replaced with a new version, which finally reached the number I specified.  The second solution is a little more elegant.  We collect: <blockquote> <code>$ sudo aptitude hold ccache</code> </blockquote>  This command will set the ccache status to hold, that is, will fix the current installed version and will not install newer ones from the repository. <br><br><h4>  Total </h4><br>  This article actually had to be even more, but due to the late (or even already early) time, as well as the rather large volume of what I already typed, to highlight everything I wanted was not possible.  I decided to drop at least a story about the sed and awk commands, hoping that you would master them if necessary. <br>  What is still behind the scenes?  Create a repository of the packages you have collected.  This story will take more than a few lines, so he stayed the next time. <br>  Maybe someone else will say that the above way to patch a package is also not true, and it will be absolutely right.  If we think about the fact that we have to go through the same procedure of editing files if we want to patch a new version of the package, it becomes clear that our method is only suitable for quick editing - for example, if the developers promised to correct the pidgin in the new version, and we we want to apply it now.  For fixes on an ongoing basis, we will use the diff and dpatch utilities.  But I suggest you to master them yourself as a homework, as well as independently assemble the corrected pidgin package for your needs.  Leave your wishes, what would you like to know, I will try in the following parts to illuminate as much as possible. </div><p>Source: <a href="https://habr.com/ru/post/50631/">https://habr.com/ru/post/50631/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../50623/index.html">Global interactive strategic agencies</a></li>
<li><a href="../50625/index.html">Ruby on Rails step by step. # 3 Controller and View</a></li>
<li><a href="../50626/index.html">Database Script Generation by Entity Framework Data Model</a></li>
<li><a href="../50629/index.html">Working Turing Machine from LEGO</a></li>
<li><a href="../50630/index.html">generation of readable abracadabra</a></li>
<li><a href="../50632/index.html">Google Chrome ad by Google Japan</a></li>
<li><a href="../50634/index.html">Notes about the best hosting: part three, problems and their solutions</a></li>
<li><a href="../50636/index.html">AMD Catalyst 9.1</a></li>
<li><a href="../50637/index.html">Unix for children</a></li>
<li><a href="../50639/index.html">Installing Debian Lenny on Asus eeePC 901</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>