<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>GIF decoding</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time we figured out how JPEG is organized ( JPEG decoding for dummies ). It is logical that the next format was GIF. By the way, it is much easie...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>GIF decoding</h1><div class="post__text post__text-html js-mediator-article">  Last time we figured out how JPEG is organized ( <a href="http://habrahabr.ru/blogs/algorithm/102521/">JPEG decoding for dummies</a> ).  It is logical that the next format was GIF.  By the way, it is much easier.  It, unlike JPEG, can be decoded with only a pen with a piece of paper.  At first, continuing the tradition, I wanted to encode Google's GIFF favicon, but then decided that it was better to paint the process of decoding the entire file on a small image.  Without any "and then by analogy ...".  I had to experiment for a long time, and the picture turned out to be clumsy, but quite visual for study. <br><br>  So, we will pick this picture <img src="https://habrastorage.org/storage1/fde408e9/bf079078/689be284/680f35a7.gif">  .  See you  :) Then it is increased 10 times: <br><img src="https://habrastorage.org/storage1/a09e3d0b/23cbbbda/dfde4235/9fc99301.png"><br><br>  Internals in a hex editor: <br><img src="https://habrastorage.org/storage1/47cedbb6/0a393993/ad1edf5f/89ec5b5a.png"><br><a name="habracut"></a><br><h4>  Headline </h4><br>  <code><b>[47 49 46 38 37 61]</b></code> GIF87a. <br>  There may be GIF89a.  These formats are distinguished by optional additional sections, which we will not consider, they are described in the specification. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Next is the section <br><br><h4>  Logical Screen Descriptor </h4><br>  The image is located in a logical screen and can be shifted relative to the upper left corner of this screen.  All the files I viewed viewed the same size as the screen. <br><br>  <code><b>[04 00] [04 00]</b></code> = 4x4 (logical screen sizes) <br> <code><b>[91] = 10010001b</b></code> <br>  <code><b>(1)</b></code> = 1. A global color table is used. <br>  <code><b>(001)</b></code> = 1. Color resolution.  The number of colors is 2 <sup>n + 1</sup> , in our case 4. <br>  <code><b>(0)</b></code> = 0. Colors are not sorted. <br>  <code><b>(001)</b></code> = 1. Size of the color table.  It takes 3 * 2 <sup>n + 1</sup> bytes.  We have -12. <br>  <code><b>[00]</b></code> = 0. Background color index.  For transparency. <br>  <code><b>[00]</b></code> = 0. Aspect ratio.  (The vast majority of images have this byte 0, that is 1: 1. Otherwise, see the specification) <br><br>  Next is the section <br><br><h5>  Global color table </h5><br>  We read 12 bytes, and form such a table: <br> <code>R  G  B</code> <br>  <code><b>[04 02 04]</b></code> - almost black (this is how the encoder decided) <br>  <code><b>[FC FE FC]</b></code> - almost white <br>  <code><b>[FC 02 04]</b></code> - almost red <br>  <code><b>[00 00 00]</b></code> - in our example is not used. <br><br>  Following bytes <code><b>[2C]</b></code> , which means that the section began <br><br><h5>  Image Descriptor [2C] </h5><br>  <code><b>[00 00] [00 00]</b></code> = (0, 0).  Coordinates of the upper left corner in a logical screen <br>  <code><b>[04 00] [04 00]</b></code> = 4x4.  Image size <br>  <code><b>[00]</b></code> = 00000000. <br>  <code><b>(0)   = 0.</b></code> local color table is not used. <br>  <code><b>(0)   = 0.</b></code> Interlace is not used (if 1, then the row order is changed, see Spec. Appendix E) <br>  <code><b>(0)   = 0.</b></code> local color table is not sorted. <br>  <code><b>(00)  = 0.</b></code> Reserved <br>  <code><b>(000) = 0.</b></code> color resolution of the local color table. <br><br>  Further, there may be additional sections in the file (I wrote below how to define them), but we don‚Äôt have them, and we‚Äôve almost gotten to the coded data, and we are separated from them. <br><br><h4>  2 more bytes </h4><br>  For compression, <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259B%25D0%25B5%25D0%25BC%25D0%25BF%25D0%25B5%25D0%25BB%25D1%258F_%25E2%2580%2594_%25D0%2597%25D0%25B8%25D0%25B2%25D0%25B0_%25E2%2580%2594_%25D0%2592%25D0%25B5%25D0%25BB%25D1%2587%25D0%25B0">the Lempel-Ziv-Welch algorithm is used</a> .  Below I will describe his work in a nutshell. <br><br>  <code><b>[02]</b></code> The minimum length of the LZW code in bits (+1). <br>  <code><b>[07]</b></code> The length of the data section.  You ask: ‚ÄúHow!  Immediately there is only one byte, that is, the maximum length of 255? ".  True, but there are an unlimited number of such sections.  If the file is not over yet, after the end of the section, the byte will again be encountered with the length of the next section.  The code may be cut by this byte.  You need to memorize it to calculate the location of the next one. <br><br><h4>  LZW encoded image data. </h4><br>  The LZW algorithm requires this initialized dictionary.  We have 4 colors in the table, so we add 4 values ‚Äã‚Äã(they will be color indexes): <br>  0: {0} (black) <br>  1: {1} (white) <br>  2: {2} (red) <br>  3: {3} (not used in our example) <br><br>  For the gif version of LZW, 2 more control codes are added to the end (values ‚Äã‚Äãcan be not added, just reserve a place): <br>  4: {clear} <br>  5: {end} <br><br>  We continue.  The following 7 bytes: <code><b>[84 62 18 2A 10 5D 00]</b></code> .  You need to translate them into a binary representation. <br><br>  [84] 10000100 <br>  [62] 01100010 <br>  [18] 00011000 <br>  [2A] 00101010 <br>  [10] 00010000 <br>  [5D] 01011101 <br>  [00] 00000000 <br><br>  These are codes that are simply recorded in succession.  But from right to left!  Just count the number of bits to the right and take that number.  And if the byte is over, then we add the number (with the remaining number of bits) from the second byte to the already partially received value in front.  In practice, it will be clearer. <br>  We learned that the minimum length of the LZW code in bits is 2. But we need to add another 1, i.e.  3. This means that the current size of the code is 3, and initially it will be read in so many bits. <br><br>  Brief description of the algorithm: <br><ol><li>  We read the next code. </li><li>  In the dictionary, under the number equal to the code, take a list of indexes.  These are ready-made color indexes. </li><li>  A list of indexes is added to the dictionary, taken from the dictionary at the previous stage with the first index added taken from the dictionary at the current stage. </li></ol>  <code><b>(100) 4.</b></code> In the dictionary number 4 is the clear code.  So we initialize the dictionary, set the current code size to 3 (in our example, of course).  In files it is more this code to meet often. <br>  <code><b>(000) 0.</b></code> In the dictionary number 0, there is {0}, this is already a ready color index (upper left corner).  We do not add anything to the dictionary. <br>  <code><b>(010) 2.</b></code> In the dictionary number 2 is {2}.  Add {0} + {2} = {0,2} with number 6 (hereinafter I will use a shorter record: 2: {2}, +6: {0,2}) <br>  <code><b>(001) 1.</b></code> In the dictionary number 1 is {1}.  Add {2} + {1} = {2,1} with number 7 (+7: {2,1}) <br><br>  The dictionary has reached the limit for 3-bit codes.  The current code size is increased by 1. <br> <code><b>(0110)</b> 6: {0,2}   +8: {1,0}</code> <br> <code><b>(1000)</b> 8: {1,0}   +9: {0,2,1}</code> <br> <code><b>(0001)</b> 1: {1}     +10:{1,0,1}</code> <br> <code><b>(1010)</b> 10:{1,0,1} +11:{1,1}</code> <br> <code><b>(0010)</b> 2: {2}     +12:{1,0,1,2}</code> <br> <code><b>(0000)</b> 0: {0}     +13:{2,0}</code> <br> <code><b>(0001)</b> 1: {1}     +14:{0,1}</code> <br> <code><b>(1101)</b> 13:{2,0}   +15:{1,2}</code> <br> <br>  The dictionary has reached the limit for 4-bit codes.  The current size of the code is increased by 1 (the length of the code increases to a maximum of 12! When the dictionary reaches size 4096, the code length remains equal to 12, and you do not need to add anything to the dictionary. Usually there is a clear code) <br>  <code><b>(00101)</b> 5:{end}</code> end <br><br>  We write down the obtained indices from left to right, from top to bottom (considering the size of the 4x4 picture) <br> <code><b>0210 <br> 2101 <br> 1012 <br> 0120</b></code> <br> <br>  The picture is already guessed!  It is already clear that it remains to see what color is behind each index and display it on the screen.  And we still have 2 bytes: <br>  <code><b>[00]</b></code> one more end. <br>  <code><b>[3B]</b></code> exactly the end :) <br><br><h4>  Extensions </h4><br>  Between the Image Descriptor section and LZW encoded image data there can be several more sections.  There is information about the animation, commentary, some application data, etc.  They are determined by the marker [21] [XX].  Description see specification.  I described only the very minimum, but the processing of additional sections is not a problem, besides, most can be safely skipped. <br><br><h4>  useful links </h4><br>  <a href="http://ru.wikipedia.org/wiki/%25D0%2590%25D0%25BB%25D0%25B3%25D0%25BE%25D1%2580%25D0%25B8%25D1%2582%25D0%25BC_%25D0%259B%25D0%25B5%25D0%25BC%25D0%25BF%25D0%25B5%25D0%25BB%25D1%258F_%25E2%2580%2594_%25D0%2597%25D0%25B8%25D0%25B2%25D0%25B0_%25E2%2580%2594_%25D0%2592%25D0%25B5%25D0%25BB%25D1%2587%25D0%25B0">Algorithm of Lempel _ ‚Äî _ Ziva _ ‚Äî _ Welch</a> <br>  <a href="http://en.wikipedia.org/wiki/Graphics_Interchange_Format">Graphics Interchange Format</a> <br>  <a href="http://www.w3.org/Graphics/GIF/spec-gif89a.txt">GIF89a specification</a> </div><p>Source: <a href="https://habr.com/ru/post/127083/">https://habr.com/ru/post/127083/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../127075/index.html">We control commits in SVN under Windows</a></li>
<li><a href="../127076/index.html">Functional programming in Java</a></li>
<li><a href="../127079/index.html">Mail.Ru Agent with Odnoklassniki taste</a></li>
<li><a href="../127080/index.html">Technologization of a modern person - the threat of identity</a></li>
<li><a href="../127082/index.html">Free Track DIY</a></li>
<li><a href="../127084/index.html">Interaction of bash-scripts with the user. Part 2</a></li>
<li><a href="../127086/index.html">What gives an ordinary person Federal Law No. 152 On Personal Data?</a></li>
<li><a href="../127088/index.html">Create a font that imitates your handwriting.</a></li>
<li><a href="../127090/index.html">Full replacement of Denwer or deploy Ubuntu-server on VMware (Part 1)</a></li>
<li><a href="../127092/index.html">Reordered text captcha</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>