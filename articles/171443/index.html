<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Qt Models</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Over the past year, I had to work quite a bit with the Qt Framework / View framework. It was necessary to write both own models, and to redo existing ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Qt Models</h1><div class="post__text post__text-html js-mediator-article">  Over the past year, I had to work quite a bit with the Qt Framework / View framework.  It was necessary to write both own models, and to redo existing ones.  And so, after contemplating the next creation, I decided to present to the public some developments. <br><br>  Let's start with the obvious: <br><br><h4>  Do not use widgets </h4> All of these <code>QTableWidget</code> , <code>QListWidget</code> and <code>QTreeWidget</code> are not for you. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Using the MVC framework is not a problem.  In the simplest case, you can use ready-made models that Qt provides.  The amount of code and its complexity does not grow, but it is possible to avoid all sorts of growth problems.  Separating the model and the display from the very beginning makes it easy to add such things as sorting or filtering without rewriting half the code. <br><br>  Some advantages and disadvantages, however, are not noticed. <a name="habracut"></a><br><br><h4>  Use the standard interface for working with models. </h4>  In general, the second point follows directly from the first. <br><br>  See what functions <a href="http://qt-project.org/doc/qt-5.0/qtcore/qabstractitemmodel.html">QAbstractItemModel</a> provides you.  Only their and must use your code that works with the model.  This interface is more than enough.  No amateur performance.  <a href="http://qt-project.org/doc/qt-4.8/qstandarditemmodel.html">QStandardItemModel</a> , for example, contains such a wonderful function as <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">QStandardItem * </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">item</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> row, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> column = </span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">const</span></span></span></span></code> </pre><br>  <i>Do not use it.</i>  All operations in which <code>Item</code> s appear should be only operations of filling the model with data. <br><br>  If you are going to find out the text of the element <code>5</code> 5th row <code>3</code> 3rd column, do not write <br><pre> <code class="cpp hljs">QString text = model-&gt;item(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>)-&gt;text();</code> </pre><br>  Use the standard model interface for this: <br><pre> <code class="cpp hljs">QModelIndex index = model-&gt;index(<span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-number"><span class="hljs-number">3</span></span>); QString text = index.data(Qt::DisplayRole).toString();</code> </pre><br>  This saves a lot of effort later when you want to put a proxy model that performs sorting between the model and the display component, and suddenly find that it does not contain such a wonderful <code>item()</code> function. <br><br><h4>  Avoid QStandardItemModel </h4>  Perhaps this is the most difficult and unobvious point to explain. <br><br>  The <code>QStandardItemModel</code> model provides a universal interface, so that with its help you can quickly make any kind of data presentation structure. <br><br>  However, there are significant drawbacks to its use. <br><br>  First, Qt provides several ready-made simple models for some cases: <a href="http://qt-project.org/doc/qt-5.0/qtcore/qstringlistmodel.html">QStringListModel</a> , <a href="http://qt-project.org/doc/qt-5.0/qtwidgets/qdirmodel.html">QDirModel</a> , <a href="http://qt-project.org/doc/qt-5.0/qtwidgets/qfilesystemmodel.html">QFileSystemModel</a> , <a href="http://qt-project.org/doc/qt-5.0/qtsql/qsqlquerymodel.html">QSqlQueryModel</a> with its relatives - at your service! <br><br>  Unfortunately, in most cases they are not very suitable.  <i>So, develop your own models for each case?</i> <br><br>  Indeed, at first glance, this task looks quite complicated.  In fact, everything is not so scary.  But before moving on to the practical part of writing a model, let's look at a few conceptual questions. <br><br>  How does working with data look like when using <code>QStandardItemModel</code> ? <br><ul><li>  Get data from an external source. </li><li>  Fill the model with the received data. </li><li>  After this process is complete, you can display the model. </li><li>  To synchronize the changes made by the user, we subscribe to signals (for example, <code>itemChanged()</code> ) </li></ul><br>  <i>Looks not so bad?</i>  <i>Not here it was!</i> <br><br>  First, if the amount of data is large, then the construction of the model will take a lot of time.  Moreover, since the model must be fully prepared before we can show it to the user, you will have to read all the data. <br><br>  Secondly, we get, in fact, two data models - one is the data source and the second is the standard Qt model.  And these models need to be synchronized.  This task is not as simple as it seems at first glance. <br><br>  <font color="grey">For example, the user has changed some value in the cell.</font>  <font color="grey">We try to write this value to the source, but nothing comes out (for example, the connection to the data source is lost).</font>  <font color="grey">Now it is necessary to return the old value in order not to break the consistency of the data.</font>  <font color="grey">But it still needs to be taken from somewhere!</font>  <font color="grey">That is, you have to store another, backup, data set.</font> <br><br>  In fact, the whole variety of problems arises from one sad fact: <i>as soon as you start using the standard model, you no longer control your data</i> .  You are already confronted with the facts that <i>have</i> happened, <i>you are forced to correct the mistakes made in the structure of your data, but you cannot avoid them</i> .  You cannot hang any integrity constraints. <br><br>  Therefore, I propose to abandon the standard model for most cases.  In fact, you do not even need to develop your model.  <i>Because your data is your model.</i>  <i>She is ready.</i>  You only need to write a thin wrapper that matches the interface of your model with the interface of Qt MVC models. <br><br>  This will help you standard Qt <a href="http://qt-project.org/doc/qt-5.0/qtcore/qabstractlistmodel.html">presets</a> : <a href="http://qt-project.org/doc/qt-5.0/qtcore/qabstractlistmodel.html">QAbstractListModel</a> , <a href="http://qt-project.org/doc/qt-5.0/qtcore/qabstracttablemodel.html">QAbstractTableModel</a> .  Adapting them for specific cases is usually very simple.  You need to implement only a few functions, and their implementation is usually trivial. <br><br>  In this case, you at once get rid of many problems. <br><ul><li>  No need to "build" a model.  The model is ready after it is created.  In order to start working with it, you do not even need data.  You need only meta-information that you entered into the model at the design stage.  All the rest you need only when asked about it. <br>  <font color="grey">At the same time, if the amount of data in the model is large, then most of them will not be asked, probably never.</font> </li><li>  You can use all the features of Qt MVC technology, such as dynamically loading data or quickly moving rows. </li><li>  You can impose integrity constraints on your data and prevent the user from destroying them. </li><li>  You can use automatically computed data and default values. <br>  <font color="grey">Just try using <code>QStandardItemModel</code> so that cells with odd values ‚Äã‚Äãare displayed with a green background color, and cells with even values ‚Äã‚Äãare displayed with a red one.</font>  <font color="grey">These cells, of course, can be changed by the user.</font> </li></ul><br><h4>  Last tip </h4><br>  What do you think, what function of the model will be called most often?  That's right, this is the <code>index()</code> function. It is called really often.  No, not as often as you thought.  Much more often.  And the <code>index()</code> function will most likely call the <code>rowCount()</code> and <code>columnCount()</code> functions.  This triple should work quickly, especially if there is a lot of data in the model. <br><br>  But the request to update the data, the <code>data()</code> call, will occur only when this data is really needed.  For example, in order to show them to the user.  If part of the data is not visible in the window, then it will not be requested. <br><br>  PS If it is interesting, I can tell about anything in more detail on the topic of working with models.  Proposals are accepted. <br><br>  At the request of workers, removed KDPV. </div><p>Source: <a href="https://habr.com/ru/post/171443/">https://habr.com/ru/post/171443/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../171433/index.html">Designing high-performance systems: what is not told in the books</a></li>
<li><a href="../171435/index.html">Logic - the most interesting news gaming and IT-industry ‚Ññ16</a></li>
<li><a href="../171437/index.html">Object Oriented Design ... in CSS</a></li>
<li><a href="../171439/index.html">Some of the simplest principles of auto-vectorization</a></li>
<li><a href="../171441/index.html">Review of the mechanical mechanical keyboard Neo Zelia KB-87</a></li>
<li><a href="../171447/index.html">The fastest SAX parser for python</a></li>
<li><a href="../171449/index.html">Chrome Super Sync Sports Browser Game</a></li>
<li><a href="../171455/index.html">Europeans and European languages: translate or not translate?</a></li>
<li><a href="../171457/index.html">New builds of Ubuntu Touch are now laid out every day</a></li>
<li><a href="../171459/index.html">SublimeHaskell updated</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>