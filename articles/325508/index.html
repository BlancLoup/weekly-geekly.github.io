<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Posting 3CX on Google Compute Engine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Today, we will explain in detail how the integrator, the 3CX partner, should prepare the Google cloud infrastructure for hosting 3CX entities (instanc...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Posting 3CX on Google Compute Engine</h1><div class="post__text post__text-html js-mediator-article"><p>  Today, we will explain in detail how the integrator, the 3CX partner, should prepare the Google cloud infrastructure for hosting 3CX entities (instances).  Placing the 3CX server on the Google cloud eliminates the need for the integrator (or end user) to invest in server hardware and waste resources on maintaining it.  Google is one of the largest and most reliable cloud providers, and the Google Compute Engine service is great for hosting PBXs for small (and large) companies. </p><br><p>  To place 3CX on Google Compute Engine, you need to follow a few simple steps: </p><br><ul><li>  Create a Google Account (if you don‚Äôt have one) and a new Google Platform Project </li><li>  Create a temporary virtual machine (VM) that will serve as a template for future 3CX virtual machines </li><li>  Create a 3CX VM instance for a customer </li><li>  Install the 3CX software on a VM instance and transfer it to the customer </li></ul><br><h3>  Creating a Google Account and the Google Platform Project </h3><br><p>  If you do not have a Google account, create one.  You can use not only the <a href="https://habrahabr.ru/users/gmail/" class="user_link">gmail</a> domain, but also your own email address.  Please note that in the future, after the trial period expires, this account will be used for billing for the service provided.  After creating an account: </p><br><ul><li>  Go to <a href="https://console.cloud.google.com/">https://console.cloud.google.com</a> </li><li>  Select your country, accept the conditions and click <strong>Accept and continue</strong> . </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/bb9/4a6/a67/bb94a6a675d3b0c2ad42d5c9f593c256.png" alt="image" width="550" height="447"></a> </p><br><ul><li>  Next, enter the information about you, your organization and enter the details of the bank card from which periodic payments for using the service will be charged. </li><li>  You will be taken to <strong>the Google Cloud Platform Control Panel</strong> .  Click the <strong>Create Project</strong> link. </li><li>  Specify the project name, for example, <strong>cloud3cx-247supported-demo</strong> and in a few seconds the project will be created. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/c86/943/cec/c86943cec5385e2a0558f4a2ffac57a1.png" alt="image" width="511" height="219"></a> </p><br><h3>  Creating an instance of a template </h3><br><p>  Create a virtual machine that will serve as a template for new virtual machines, which you then transfer to end users: </p><br><ul><li>  In the left menu, go to the <strong>Compute Engine - VM Instances</strong> section. </li><li>  Create a new instance with the name, for example, <strong>instance-3cx-template-vm</strong> and select <strong>Small machine g1-small</strong> . </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/db5/a47/71d/db5a4771d55e925d1a3fcdc5365b12f7.png" alt="image" width="487" height="437"></a> </p><br><ul><li>  Specify a fixed hard disk size of 25 GB and a Debian GNU / Linux 8 image (jessie). </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/233/c17/e2b/233c17e2bae8e5ab5d8289db9aca0514.png" alt="image" width="467" height="877"></a> </p><br><ul><li>  Select the Compute Engine default service account and Full access to all Cloud APIs. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/c7b/f02/52f/c7bf0252ffc3df227fd3d29ee3e152a6.png" alt="image" width="463" height="180"></a> </p><br><ul><li>  Just below, expand the <strong>Settings Configure Management, Disk, Network, and SSH keys options</strong> and uncheck the <strong>Delete boot disk</strong> check box <strong>when deleting an instance</strong> . </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/1fc/453/f38/1fc453f38dea5ccde43367b51a3f9d21.png" alt="image" width="474" height="348"></a> </p><br><ul><li>  To finish creating an instance, click <strong>Create</strong> . </li></ul><br><h3>  Installing 3CX on a template instance </h3><br><ul><li>  Connect to the VM instance via SSH.  In this case, a connection pop-up window will appear in the browser.  <strong>Allow pop-up windows for this site.</strong> </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/5db/2ca/188/5db2ca188398ccd2082df9bc361b229d.png" alt="image" width="601" height="134"></a> </p><br><ul><li>  Leave yourself root. </li></ul><br><pre>  sudo su - </pre><br><ul><li>  Upgrade your operating system. </li></ul><br><pre>  apt update - updates the list of available packages </pre><br><pre>  apt upgrade - upgrade packages </pre><br><ul><li>  Install the tcpdump package, which may be required to troubleshoot various network problems. </li></ul><br><pre>  apt-get install tcpdump </pre><br><ul><li>  Install the modules required for 3CX operation. </li></ul><br><pre>  wget -O- http://downloads.3cx.com/downloads/3cxpbx/public.key |  apt-key add -
 echo ‚Äúdeb http://downloads.3cx.com/downloads/3cxpbx/ /‚Äù |  tee /etc/apt/sources.list.d/3cxpbx.list
 apt update
 apt-get install -y $ (apt-cache depends 3cxpbx | grep Depends | sed ‚Äús /. ends: \ //‚Äù | tr '\ n' ') </pre><br><ul><li>  Since the Google VM uses the internal and public IP addresses, you need to create the port publishing rules necessary to access the VM instance from the outside. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/554/f83/d3e/554f83d3e0d430632cc5b070c5c3cd4b.png" alt="image" width="180" height="203"></a> </p><br><ul><li>  Configure the rules for accessing instance services in accordance with <a href="https://www.3cx.com/docs/3cx-phone-system-v14-ports/">this table</a> . </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/720/0ea/a22/7200eaa228428faddb81936a9352a278.png" alt="image" width="800" height="391"></a> </p><br><ul><li>  Shut down and delete the VM instance in the management console, saving the virtual disk.  <strong>Please note that during the removal there was no warning about deleting the virtual hard disk.</strong> </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/c21/1a9/89a/c211a989adb087198cea9b567f3ee9ac.png" alt="image" width="511" height="155"></a> </p><br><h3>  Creating an instance of VM 3CX for a customer </h3><br><p>  Now you can create a virtual machine instance to install the 3CX server and transfer it to the customer. </p><br><ul><li>  Go to the <strong>Images</strong> section, at the top, click the <strong>Create image</strong> button and create a new image with the name, for example, <strong>image-3cx-template</strong> .  As the disk, select the previously created virtual disk <strong>instance-3cx-template-vm</strong> </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/c5f/354/efc/c5f354efc40accc53619d802a76212ae.png" alt="image" width="489" height="549"></a> </p><br><ul><li>  Your created image should appear in the list of available images. </li><li>  Select the created image and click on <strong>Create instance</strong> at the top. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/8a5/f0f/7ad/8a5f0f7ad933d3854119159a8daa281f.png" alt="image" width="625" height="209"></a> </p><br><ul><li>  Specify instance parameters: <br><ul><li>  Name, for example <strong>instance-3cx-001</strong> </li><li>  The zone is the closest to the customer to minimize network delays. </li><li>  Machine type: for small installations, you can choose a <strong>micro machine 0.6 GB of memory</strong> </li><li>  Service account: <strong>Compute Engine default service account</strong> </li><li>  Access Scope: <strong>Full access to all Cloud API</strong> </li></ul><br></li><li>  In the section <strong>Configure Management, Disk, Network, and SSH Keys,</strong> and uncheck the <strong>Delete boot disk</strong> check box <strong>when deleting an instance</strong> .  This is recommended in order not to permanently lose data if an administrator or customer accidentally deletes a virtual machine instance. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/dc4/3f1/6a8/dc43f16a8250b5404600c37f4b24e56c.png" alt="image" width="468" height="839"></a> </p><br><ul><li>  Immediately in the <strong>Network</strong> section, specify (or add a new) external static IP address.  The ephemeral address will not be enough. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/083/6fe/6c7/0836fe6c7ad5d1eefba9171d7ce1e42e.png" alt="image" width="456" height="274"></a> </p><br><ul><li>  Click <strong>Create</strong> , and a custom VM instance will be created for the 3CX server. </li></ul><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/a05/77a/782/a0577a782740974e241c9bdc086c729d.png" alt="image" width="645" height="180"></a> </p><br><h3>  Installing 3CX software on a virtual machine </h3><br><ul><li>  Connect to the created entity by pressing the <strong>SSH</strong> button. </li><li>  Install 3CX with the command </li></ul><br><pre>  sudo apt-get install 3cxpbx </pre><br><p> <a href=""><img title="image" src="https://habrastorage.org/getpro/habr/post_images/2d2/812/9c4/2d28129c4effa04afa34006815790658.png" alt="image" width="500" height="394"></a> </p><br><ul><li>  You can select the option <strong>(1) Using a Web Browser</strong> and continue configuring 3CX in <a href="https://www.3cx.ru/docs/manual/configuration-tool/">this guide</a> .  At the same time, you need to connect to the public IP address of the created instance.  In this case, if the address is 104.199.62.254, the connection string will be </li></ul><br><pre>  http://104.199.62.254 ro01 </pre><br><p>  At this point, setting up an instance of VM 3CX is complete.  It can be transferred to the customer. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/325508/">https://habr.com/ru/post/325508/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../325492/index.html">Human face design patterns</a></li>
<li><a href="../325494/index.html">Why in the standard library there are no tools to combat hanging links and how to fix it?</a></li>
<li><a href="../325498/index.html">Facilitating the reversal of Golang binaries or why even write scripts in IDA</a></li>
<li><a href="../325502/index.html">Spectral analysis of signals from non-linear links of ACS in Python</a></li>
<li><a href="../325504/index.html">We automate everything: the new version of OneBox Next (CRM + ERP) is available for free</a></li>
<li><a href="../325510/index.html">Teach TensorFlow to draw Cyrillic</a></li>
<li><a href="../325512/index.html">Report and presentations with Moscow JS in the Superjob office</a></li>
<li><a href="../325514/index.html">Registration and authorization of the user on the site - one click - through the custom Facebook button. 2017</a></li>
<li><a href="../325516/index.html">Conference DUMP-2017: Section "Testing"</a></li>
<li><a href="../325518/index.html">Authenticating OAuth2 in-app using Google Sign-In. Continuous access to Google APIs</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>