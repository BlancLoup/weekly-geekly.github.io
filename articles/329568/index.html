<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Undocumented features of Windows: registration of registry key access events</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Starting with Windows 8, users of the operating system may notice the following message in the system event log: "The access history in hive [...] was...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Undocumented features of Windows: registration of registry key access events</h1><div class="post__text post__text-html js-mediator-article">  Starting with Windows 8, users of the operating system may notice the following message in the system event log: <i>"The access history in hive [...] was cleared updating [...] keys and creating [...] modified pages</i> . <i>"</i>  What is behind this message? <br><a name="habracut"></a><br>  If someone was following the update of the registry structures in debugging symbols, then he could notice that in Windows 8, the Access bits numeric field appeared in the structure responsible for storing the registry key;  The corresponding memory area was reserved since Windows NT 3.5 and was previously used in Windows NT 3.1 for storing the numeric value ‚ÄúTitle index‚Äù.  In the structure description below, the reserved field, under the name ‚ÄúSpare‚Äù, is at offset + 0x00c, its new name in Windows 8 is ‚ÄúAccessBits‚Äù. <br><br><pre><code class="hljs pgsql">+<span class="hljs-number"><span class="hljs-number">0x000</span></span> Signature : Uint2B +<span class="hljs-number"><span class="hljs-number">0x002</span></span> Flags : Uint2B +<span class="hljs-number"><span class="hljs-number">0x004</span></span> LastWriteTime : _LARGE_INTEGER +<span class="hljs-number"><span class="hljs-number">0x00c</span></span> Spare : Uint4B +<span class="hljs-number"><span class="hljs-number">0x010</span></span> Parent : Uint4B +<span class="hljs-number"><span class="hljs-number">0x014</span></span> SubKeyCounts : [<span class="hljs-number"><span class="hljs-number">2</span></span>] Uint4B +<span class="hljs-number"><span class="hljs-number">0x01c</span></span> SubKeyLists : [<span class="hljs-number"><span class="hljs-number">2</span></span>] Uint4B +<span class="hljs-number"><span class="hljs-number">0x024</span></span> ValueList : _CHILD_LIST +<span class="hljs-number"><span class="hljs-number">0x01c</span></span> ChildHiveReference : _CM_KEY_REFERENCE +<span class="hljs-number"><span class="hljs-number">0x02c</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> : Uint4B +<span class="hljs-number"><span class="hljs-number">0x030</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> : Uint4B +<span class="hljs-number"><span class="hljs-number">0x034</span></span> MaxNameLen : Pos <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">16</span></span> Bits +<span class="hljs-number"><span class="hljs-number">0x034</span></span> UserFlags : Pos <span class="hljs-number"><span class="hljs-number">16</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> Bits +<span class="hljs-number"><span class="hljs-number">0x034</span></span> VirtControlFlags : Pos <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-number"><span class="hljs-number">4</span></span> Bits +<span class="hljs-number"><span class="hljs-number">0x034</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Debug</span></span> : Pos <span class="hljs-number"><span class="hljs-number">24</span></span>, <span class="hljs-number"><span class="hljs-number">8</span></span> Bits +<span class="hljs-number"><span class="hljs-number">0x038</span></span> MaxClassLen : Uint4B +<span class="hljs-number"><span class="hljs-number">0x03c</span></span> MaxValueNameLen : Uint4B +<span class="hljs-number"><span class="hljs-number">0x040</span></span> MaxValueDataLen : Uint4B +<span class="hljs-number"><span class="hljs-number">0x044</span></span> WorkVar : Uint4B +<span class="hljs-number"><span class="hljs-number">0x048</span></span> NameLength : Uint2B +<span class="hljs-number"><span class="hljs-number">0x04a</span></span> ClassLength : Uint2B +<span class="hljs-number"><span class="hljs-number">0x04c</span></span> <span class="hljs-type"><span class="hljs-type">Name</span></span> : [<span class="hljs-number"><span class="hljs-number">1</span></span>] Wchar</code> </pre>  <i>The nt! _CM_KEY_NODE structure in Windows 7 (in Windows 8, the ‚ÄúSpare‚Äù field became the ‚ÄúAccessBits‚Äù field)</i> <br><br>  As a result of studying the Windows kernel, it was determined that this field is updated each time the registry key is opened or changed in most registry hives, and the log message quoted at the beginning of the article indicates that the specified field is cleared for all registry keys in a particular cluster by writing a zero value.  The access bits are cleared when the registry hive is connected, if seven days have passed since the previous clearing of the access bits of this hive. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The ‚ÄúAccess bits‚Äù field is updated by writing values ‚Äã‚Äãto it in accordance with the following bit masks: <br><table><tbody><tr><th>  Bit mask </th><th>  Description </th></tr><tr><td>  0x1 </td><td>  The registry key was accessed before the registry was initialized by calling the <i>NtInitializeRegistry ()</i> function at boot time. </td></tr><tr><td>  0x2 </td><td>  Access to the registry key occurred after the registry was initialized by calling the <i>NtInitializeRegistry ()</i> function at boot time </td></tr></tbody></table>  <i>Supported Bit Masks</i> <br><br>  The call to the NtInitializeRegistry () function, which changes the current bitmask (from 0x1 to 0x2), which is written to the registry keys when they are opened or changed, occurs after the operating system considers the boot process to be successful.  Thus, registry keys, for example, opened by services in the process of their launch at the time of loading the operating system, will have access bits with the bit mask set to 0x1.  In addition, if the registry key has not been opened since the access bits were cleared, then this key will have a zero value in this field. <br><br>  This information can be used to select registry keys that could be opened by a malicious program (or any other) running as a service, or opened in general in recent times, as well as to screen out unused registry keys. <br><br>  It should be noted that in the Windows kernel there is not a single function that allows you to get the current value of the access bits for any registry key, which suggests the idea of ‚Äã‚Äãthe debugging nature of the access bits. <br><br><h4>  Demonstration </h4><br>  As an example, we will examine in the hexadecimal editor a registry structure that describes the key "\ ControlSet001 \ Services \ RServer3" (registry hive "SYSTEM") immediately after installing the Radmin software, before rebooting, and after rebooting the operating system. <br><br><img src="https://habrastorage.org/web/031/15b/092/03115b092731473099d790f456eb70cd.png">  <i>Registry key structure (before reboot)</i> <br><br><img src="https://habrastorage.org/web/9c8/52d/f78/9c852df78a8b47d181c5e97052e1535a.png">  <i>Registry key structure (after reboot)</i> <br><br>  In the illustrations above, the bytes in the ‚ÄúAccess bits‚Äù field are underlined in red, which changed when the operating system was restarted (a value of 3 indicates that bit masks 0x1 and 0x2 are set). <br><br><h4>  findings </h4><br>  The access bits are small, undocumented Windows functionality, most likely created for debugging purposes, which can be used to track unused registry keys and to track registry keys opened during the pre-load operation of the operating system. <br><br>  Unfortunately, at present, most programs for viewing an inactive registry do not support the processing and visualization of access bit values. </div><p>Source: <a href="https://habr.com/ru/post/329568/">https://habr.com/ru/post/329568/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329558/index.html">SambaCry critical vulnerability: how to protect</a></li>
<li><a href="../329560/index.html">Almost manifesto design thinking</a></li>
<li><a href="../329562/index.html">Skit, Core, rock'n'roll: how did DotNext 2017 Piter go</a></li>
<li><a href="../329564/index.html">Multichannel communication in ecommerce or how to complete the quest "abandoned basket"?</a></li>
<li><a href="../329566/index.html">Mobile Dimension has developed a "tablet for the consultants of the trading hall" by order of M.Video</a></li>
<li><a href="../329570/index.html">Security Week 21: BlueDoom protects against WannaCry, crypto-fiber threatens medical equipment, subtitles - new attack vector</a></li>
<li><a href="../329572/index.html">Experience of transition from Waterfall to RUP methodology for the implementation of large IT projects</a></li>
<li><a href="../329574/index.html">Smart IDReader SDK - how to add recognition in an iOS application in 5 minutes - now on Github</a></li>
<li><a href="../329576/index.html">Modeling designs. Requirements for the modeler</a></li>
<li><a href="../329578/index.html">Three cycles in the Lorenz attractor</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>