<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Upgrading Windows Network Neighborhood</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Once again, I made a domain controller from samba and it didn‚Äôt work to have a normal network environment on the domain computers. 

 A little googlin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Upgrading Windows Network Neighborhood</h1><div class="post__text post__text-html js-mediator-article">  Once again, I made a domain controller from samba and it didn‚Äôt work to have a normal network environment on the domain computers. <a name="habracut"></a><br><br>  A little googling, solutions are not something that I did not find, but came across <a title="link to competitors website" href="http://opennet.ru/base/net/workgroup_win_perl.txt.html">one article</a> that inspired me a lot.  Unfortunately, I could not realize the content of the article in my office, because  I do not keep office computers in DNS (no need), but there is isc-dhcpd, which has everything that is needed.  As a result, a script was born ( <a href="http://paste.org.ru/%3Faq2szw">link once</a> and <a href="http://pastebin.com/f194ec5de">link two</a> ) that does the following: <ol><li>  scans the network specified in the $ network variable on port 139 with a connection timeout of 0.01 seconds, which allows you to run over / 24 networks from 255 addresses in a few seconds; </li><li>  if it detects the address where the port is open, then it asks information at that address through omshell from isc-dhcpd; </li><li>  if there is information, then add it to samba browse.dat. </li></ol>  As a result, we have: <ul><li>  no garbage in the network environment: all computers of the office network in the same workgroup; </li><li>  lack of brakes when opening the network environment; </li><li>  any refresh rate of the list of computers in the network environment </li></ul>  But there is one drawback: in the network environment will not see descriptions of computers: nowhere to get them.  If anyone has any idea where to get computer descriptions for the network environment, please write in the comments.  As an option, you can take some book and insert random combinations of words from it into the descriptions of computers in the network environment with each new launch.  It will be useless, but funny. <br><br>  In order for all this to take off, you need to enable OMAPI in isc-dhcp.  To do this, add the following lines to the config: <pre> key keyname {algorithm hmac-md5;  secret "keyself";  }
 omapi-port 7911;
 omapi-key keyname;
</pre><br>  You can generate the key itself, for example, using the named generator: <pre>  dnssec-keygen -a HMAC-MD5 -b 256 -n HOST keyname </pre><br>  After restarting dhcpd, this daemon should listen, among other things, also port 7911 using the tcp protocol.  Now, just in case, let's check how OMAPI works: <pre> omshell
 &gt; server 192.168.10.2
 &gt; port 7911
 &gt; key keyname keyself
 &gt; connect
 obj: &lt;null&gt;
 &gt; new lease
 obj: lease
 &gt; set ip-address = 192.168.10.99
 obj: lease
 ip-address = c0: a8: 0a: 63
 &gt; open
 obj: lease
 ip-address = c0: a8: 0a: 63
 state = 00: 00: 00: 02
 dhcp-client-identifier = 01: 00: 21: 63: d1: b2: 54
 client-hostname = "rooot"
 subnet = 00: 00: 00: 03
 pool = 00: 00: 00: 04
 hardware address = 00: 21: 63: d1: b2: 54
 hardware-type = 00: 00: 00: 01
 ends = 4b: 0f: c2: 98
 starts = 4b: 0f: c1: 6c
 tstp = 00: 00: 00: 00
 tsfp = 00: 00: 00: 00
 atsfp = 00: 00: 00: 00
 cltt = 00: 00: 00: 00
</pre>  what is marked with the sign "&gt;" are my commands, the rest is omshell answers.  As you can see, I received a record of information about my computer. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In addition, the above script writes data to utf-8 in browse.dat, which means that in smb.conf there should be this: <pre> display charset = utf-8
 unix charset = utf-8
 dos charset = cp866
</pre>  If in your smb.conf the first two variables have a value different from utf-8, then you need to find the substring "utf-8" in the text of the script and change it to what you use. <br><br>  And lastly, a brief description of the parameters from the script: <table><tbody><tr><td>  $ network = '192.168.10.0/24' </td><td>  the network that the script will scan </td></tr><tr><td>  $ dhcp_server = '192.168.10.2' </td><td>  dhcp address of the server that the script will access through omshell </td></tr><tr><td>  $ dhcp_server_timeout = '1' </td><td>  timeout that is set for responses from dhcpd via omshell </td></tr><tr><td>  $ dhcp_key = 'maverick dhcp_key' </td><td>  the key that we generated using dnssec-keygen </td></tr><tr><td>  $ browser_file = '/var/db/samba/browse.dat' </td><td>  the script in this samba file will add the resulting list of computers for the network environment - this is what it was all about </td></tr><tr><td>  $ browser_domain </td><td>  Your domain name </td></tr><tr><td>  $ browser_head </td><td>  header file browse.dat.  should usually include a description of the domain and its controller </td></tr></tbody></table>  How to configure isc-dhcpd to distribute addresses and samba as a domain controller will not tell.  There are more than enough how-tos on this topic on the net. </div><p>Source: <a href="https://habr.com/ru/post/76578/">https://habr.com/ru/post/76578/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../76566/index.html">Google Wave ?! FFFUUUU-</a></li>
<li><a href="../76569/index.html">Canobuvosti, 15th edition</a></li>
<li><a href="../76571/index.html">8-FZ: I will tell you what should be the site of the authority</a></li>
<li><a href="../76575/index.html">SpeedGeeks LA - October 26, 2009 (Videos + Presentations)</a></li>
<li><a href="../76577/index.html">Should I allow the tag "a" with the attribute "name" in the articles on Habr√©</a></li>
<li><a href="../76579/index.html">Twidiko - post a video on twitter</a></li>
<li><a href="../76582/index.html">Facebook & Jamendo</a></li>
<li><a href="../76584/index.html">Mail.ru overtakes Rambler in profitability</a></li>
<li><a href="../76586/index.html">Alarm clock grenade</a></li>
<li><a href="../76591/index.html">Magic Mouse works under Windows</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>