<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How to rewrite the SDK in TypeScript, upgrade the platform and do not regret anything</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We have a new version of WebSDK - v4. So far this is only a public beta version, but it is already stable for most everyday cases. We tried to maintai...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How to rewrite the SDK in TypeScript, upgrade the platform and do not regret anything</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/68a/0fa/e5e/68a0fae5e2df4028b445b10d561f93ab.jpg" alt="image"><br><p><br clear="all">  We have a new version of WebSDK - v4.  So far this is only a public beta version, but it is already stable for most everyday cases.  We tried to maintain the backward compatibility of the new version. </p><br><p>  And the platform has been updated - v3.  There are many new and interesting things.  Everything works faster and more fun.  For details below. </p><br><p>  As you can see, we have a double strike!  Under the cut - what happened in 6 months of cross debugging, continuous improvement and pain.  Spoiler: no more ancient flash.  Only pure WebRTC + ORTC. </p><a name="habracut"></a><br><h2 id="hovye-shtuki-v-sdk">  New stuff in SDK </h2><br><p>  We rewrote everything in TypeScript.  Literally every line and function of the SDK from scratch.  The main reason was the support.  Typescript is much easier to maintain than Vanilla JS.  With the help of a risky step, we can provide you with updates more often.  In addition, we will soon introduce new tsd files for your favorite language. </p><br><p>  Weight SDK increased by only 12KB.  Such was the price of TypeScript implementation.  This is a small problem if you make voice and video calls.  If you are confused by the volume of 111 KB, I recommend using async download mode.  In general, I advise you to always use it async download our script.  The extra moments of waiting for your users upset us too. </p><br><p>  Putting it all up with a webpack.  The previous version of the SDK was built using Gulp, sh and divine help.  We needed a stable autodetection and easy configuration, auto-build documentation, building npm modules, tsd, automatic versioning ... I could go on forever, and anyone can drop a couple of points into this list from personal DevOps desires.  And so it happened that the Webpack could do anything we wanted.  Yes, he works fast. </p><br><img src="https://habrastorage.org/files/438/f0f/320/438f0f320c07416bb5351a0506e5fa50.png"><br><p><br clear="all">  Make audio calls to and from Microsoft Edge available.  ORTC instead of WebRTC, lack of solutions on StackOverflow (Ctrl + C -&gt; Ctrl + V could not save us), 7 laps of MS support hell, undocumented errors.  You can read about the pain and suffering of an individual programmer with one separate Hedgehog in my previous <a href="https://habrahabr.ru/company/Voximplant/blog/305470/">article</a> .  It took a decent part of the development cycle to forge the gauntlets for our SDK and make you a comfortable API.  As a result, you can talk to users of Edge, they can talk to you.  Soon VP9 will appear in the Edge - you can see it. </p><br><p>  You can prioritize h 264 codec or set priorities of other codecs.  Mobile devices typically have hardware h264 encoding / decoding and VP8 encoding / decoding software.  If you call Chrome with a default priority, you‚Äôll select VP8.  Software rendering.  Who played games with him, immediately knows that this is a pain.  Unfortunately, browsers are often quite the opposite.  This will allow you to make energy-efficient calls to mobile applications with our WebSDK or adjust the priority of codecs for exotic hardware and cases. </p><br><img src="https://habrastorage.org/files/4b3/3db/078/4b33db0784994313b5dab77cf480923d.jpg"><br><p><br clear="all">  You can turn on / off video during a call.  This is a renegotiation, comrades!  Renegotiation is a re-exchange of the capabilities of your browsers at the time when you turned on / off the video.  I will explain in Pavla.  Suppose Paul A. calls Paul B. voice.  The two Pauls happily communicate in browsers.  Now Pavel B. wants to show his new two-headed turtle to Paul A. Without renegotiation, one would have to end the audio call and start the video.  And now Pavla can not be interrupted.  True, they will never know about renegotiation.  Pavel B. presses the button and Pavel A. sees him with the power of our SDK!  In addition, one of Pavlov can show his video, and the second is not.  Just like in Skype. </p><br><p>  Hold / Unhold is made using WebRTC and now works in Peer-To-Peer mode.  Hold is when you place a call from hold and in a magical way sound and video do not go.  Unhold is when you take a call from hold and magically everything goes again.  In the old version of the SDK, there was also such functionality, but our server became the barrier between the streams of sound.  Traffic was going.  Now the traffic does not go.  Your browser will tell the server or another client that you are temporarily suspending the exchange and everyone is happy.  Less traffic and longer battery life. </p><br><img src="https://habrastorage.org/files/8c9/b67/454/8c9b674543484a65815db2a659faa6e5.jpg"><br><p><br clear="all">  Filters and masks for the implementation of your ideas.  You can take the incoming audio stream and make a chipmunk voice.  Get outgoing and send Darth's voice.  At the same time adding compression and mitola!  You can take a video stream, drive it through the canvas and neural network and add a mustache in the style of Picasso.  You decide!  Give your MSQRD in the browser! </p><br><h2 id="novye-shtuki-v-servernoy-chasti">  New things in the server part </h2><br><p>  Delayed sound and video has decreased.  We changed the call pattern.  RTP traffic now goes through one server, and earlier went through a chain to three servers.  Tests showed a reduction in the delay of 180m / s in both directions. </p><br><p>  Improved work on bad networks for Chrome.  Added support for <a href="https://tools.ietf.org/id/draft-alvestrand-rmcat-remb-03.html">REMB</a> technology.  This technology allows you to control the quality of pictures and sound on weak channels.  It helps from stuttering and loss of sound on weak networks.  The technology is smart, it will not degrade the signal quality on a good connection.  And if the quality of the connection jumps, then adjust. </p><br><img src="https://habrastorage.org/files/2d9/362/91c/2d936291c9a14dfcb4afd6d14983b915.jpeg"><br><p><br clear="all"></p><br><p>  Now you can only choose in the server script how the P2P / ViaServer call will go.  Our platform can work in 2 modes: PeerToPeer and through our media server.  In the case of work in Peer-To-Peer media traffic goes from subscriber to subscriber directly.  Neither we nor you will see it and will not be able to record or send to the telephone network, for example.  For the server scenario, everything goes through our server with all the pluses.  Previously, client applications for these two scenarios were different - it was necessary to pass the X-DirectCall flag at the start of the call, and even in the VoxEngine script, everything would be handled correctly.  Now everything is easier.  The decision is made in the VoxEngine script.  When you start a call, you can determine if you need a server call or just enough Peer-To-Peer and correctly connect subscribers. </p><br><p>  Audio / video tracks are now synced in Firefox and Chrome.  On the cloud side, an intelligent selection of the synchronization context occurs, and delays are calculated based on RTCP statistics.  And the browser according to the synchronization context correctly collects pairs of audio-video.  A trifle, but nice - no need to look into the past, but listen to the present. </p><br><h2 id="boevye-poteri">  Battle loss </h2><br><p>  Removed old messaging API.  Little spoilers - we make it better, fresher, faster and sexier.  Soon, when the Timlid resolves, it will fall into the public beta.  In the meantime, in its place is temporarily nothing. </p><br><img src="https://habrastorage.org/files/b2b/267/4f9/b2b2674f96044d31b978ab9aef87868e.jpg" align="left" width="120"><br><p>  We removed Flash.  Not at all from the web, we cannot do this, unlike Google, which is actively involved in this, but only from our SDK.  Although there is no limit to our joy, there is a bit sad about it.  Safari and IE dedicated users will have to use Temasys plugin to simulate WebRTC.  If your users are the very 4.9% of Runet, I recommend to wait a bit until they update, or use the old version of our SDK. <br><br clear="all"></p><br><hr><br><p>  In conclusion, I want to say that we <a href="https://voximplant.com/docs/references/websdk4/">have updated the documentation</a> and opened the <a href="https://gitter.im/voximplant/websdk-edge">gitter channel,</a> where you can quickly get technical support for the new version of sdk.  Test it. </p><br><img src="https://habrastorage.org/files/f8f/f69/9ae/f8ff699ae20949c9b25bdaa9f2f3a02f.jpeg"><br><p><br clear="all"></p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/310740/">https://habr.com/ru/post/310740/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../310730/index.html">We work in the cloud based on Hyper-V, part 1: familiarity with the control panel</a></li>
<li><a href="../310732/index.html">Looking for errors in Mono: hundreds of them</a></li>
<li><a href="../310734/index.html">Lecture by Jimmy Wales, founder of Wikipedia, in Yandex</a></li>
<li><a href="../310736/index.html">BGP protocol in Quagga</a></li>
<li><a href="../310738/index.html">Logging Git revision in Java using Maven</a></li>
<li><a href="../310742/index.html">Getting started in STM32CubeMX. Part 1</a></li>
<li><a href="../310744/index.html">Techniques in Elixir for Beginners: Trial and Error (Translation)</a></li>
<li><a href="../310748/index.html">Y Combinator: female programmers answer sensitive questions</a></li>
<li><a href="../310756/index.html">5 Fellowships in Computer Science</a></li>
<li><a href="../310770/index.html">We connect log4net. Step-by-step instruction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>