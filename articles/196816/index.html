<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Optimization of web environment on the Jelastic platform for PHP projects</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In previous articles, we told you about the launch of the Jelastic.Cloud cloud platform on the Infobox, as well as how we created the CMS directory to...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Optimization of web environment on the Jelastic platform for PHP projects</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/045/c22/d90/045c22d90d67340873393e3b942f6102.png" alt="Free beta testing of the Jelastic cloud platform on Infobox hosting" align="right">  In previous articles, we told you <a href="http://habrahabr.ru/company/infobox/blog/194226/">about the launch of</a> the Jelastic.Cloud cloud platform on the Infobox, as well <a href="http://habrahabr.ru/company/infobox/blog/195504/">as how we created the CMS directory</a> to deploy them in one click on the Jelastic.Cloud platform and what high performance results we achieved by optimizing the web environment. <br><br>  But, of course, in our catalog there are not all existing CMS, so now we will tell you how to independently deploy your PHP project to Jelastic.Cloud and optimize the environment for it.  We will do this on the example of UMI.CMS. <br><a name="habracut"></a><br>  Start by creating an environment.  For most projects, the Apache + MySQL bundle will suffice. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/254/063/7ac/2540637acb18132aff9101a6cec35bd5.jpg">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      How to upload project files to the created environment has been written several times already, so we will limit ourselves to <a href="https://helpdesk.infobox.ru/Default1/Knowledgebase/Article/View/230/96/razvernut-prilodzenie">referring to the instructions</a> .  But with databases, the question is not so obvious.  When creating a MySQL node, the root user password comes to the mail.  The most common mistake is to use this password to connect the site to the database server.  For this, it is better to create a separate user in phpMyAdmin: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/363/0dc/d14/3630dcd146a17eaada101b37263783c4.jpg"><br><br>  Another common mistake is to specify a local host in the Host field.  The fact is that in Jelastic the application server and the database server are separated, which means that user access will be only through the interface PhpMyAdmin and nowhere else.  You can specify ‚ÄúAny host‚Äù in this field, or you can check with the technical support the internal address of your application server and allow access from it. <br><br>  For ease of setup, you can also check "Create a database with a username in the name and grant full privileges to it" or "Grant full privileges to databases matching the pattern (username \ _%)", otherwise you also need to set permissions created by the user. <br><br>  The next difficulty that can be encountered when deploying a project on Jelastic is connecting the site to the database.  To connect, you must first look at the address of the database server: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ffe/7bb/4ab/ffe7bb4ab1a4f160d8024a9f7baa3553.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/77c/d01/850/77cd0185082d294be0f4b717dbdc49a9.jpg"><br><br>  And to use when connecting this address and data of the previously created user: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/776/bac/5ac/776bac5ac507d5b7bbfdba88d5ece24c.jpg"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/91a/e25/f5a/91ae25f5a626d647b4131131875cc7e2.jpg"><br><br>  When the project is placed, you can think about optimizing the environment.  Let's start with MySQL. <br>  In the Jelastic control panel, select the ‚ÄúConfiguration‚Äù item of the MySQL node and open the my.cnf file for editing: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e2e/d84/7fb/e2ed847fb6b5b9cebd19b10ee2bcb64b.png"><br><br>  We have 96 tables on our site.  In order not to waste time opening them, let us keep them all open in the cache by changing the value of the <b>table_open_cache</b> parameter to 100. By setting this parameter to be significantly larger than the number of tables, you increase the amount of RAM reserved for the cache, which leads to increased consumption , which means high costs without any gain in performance. <br><br>  Now let's resolve requests by adding the variable <b>query_cache_size</b> with a value of 16M.  This is an average value, which will be enough for most sites (with the exception of online stores), but a different figure may be optimal for a particular project. <br>  In addition to requests, it is desirable to cache threads.  You can do this by adding the <b>thread_cache_size = 16</b> string (you can use 8 if you do not expect a high attendance of the resource). <br><br>  Since the project in question is using InnoDB, you need to set the frequency of dumping the logs to disk using the <b>innodb_flush_log_at_trx_commit</b> parameter.  At the project debugging stage, you can use the value 1, but after completion of the main work it is better to convert the parameter to 2: this will ensure the maximum speed of the database server. <br><br>  There are 2 more important parameters associated with InnoDB: <br><br>  <b>innodb_flush_method = O_DIRECT</b> allows <b>you</b> to avoid the situation when caching will be performed by the operating system and the MySQL server; <br><br>  <b>innodb_buffer_pool_size</b> is set to 512 MB by default, which is unnecessary for small databases.  With static database contents, this parameter should be set slightly larger than the database size.  If information is constantly added to the database, then the parameter can be 1.5‚Äì2 times the size of the database and be periodically reviewed. <br><br>  Having made all these changes, save the file my.cnf and restart the MySQL server. <br><br>  Now let's move on to optimizing the application server, for this we will open the php.ini on the Apache node in a similar way. <br>  One of the factors why a site does not work well on shared hosting often becomes a PHP accelerator, or rather its absence.  Jelastic already has 4 accelerators preinstalled, all you have to do is enable the needed one by uncommenting the needed line in php.ini.  Practice shows that the inclusion of apc gives the best result, so further we will discuss its use.  At the same time, nothing prevents you from using another accelerator or even installing your own one by downloading the SO file to the modules folder and also connecting it to php.ini. <br><br>  For optimal performance of APC, add the following lines to php.ini: <br><br>  <b>realpath_cache_size = 4M</b> - the amount of memory allocated for caching the real path; <br><br>  <b>apc.ttl = 1800</b> - sets the cache time to 30 minutes (the optimal value may be different depending on the frequency of updating the content on the site); <br><br>  <b>apc.max_file_size = 4M</b> - files larger than the specified value will not be cached in order to avoid an increase in RAM consumption; <br><br>  <b>apc.shm_size = 128M</b> - maximum cache block size (the number of blocks can be increased using <b>apc.shm_segments</b> ); <br><br>  Let's save php.ini and move on to setting up the web server itself.  The settings file is in the conf directory and is called httpd.conf. <br><br>  Most of this file does not affect the performance, we will be interested in only the section: <br><br>  &lt;IfModule prefork.c&gt; <br>  StartServers 1 <br>  MinSpareServers 1 <br>  MaxSpareServers 2 <br>  ServerLimit 256 <br>  MaxClients 256 <br>  MaxRequestsPerChild 100 <br><br><br>  It should be replaced by: <br><br>  &lt;IfModule prefork.c&gt; <br>  <b>StartServers 5</b> <b><br></b>  <b>MinSpareServers 5</b> <b><br></b>  <b>MaxSpareServers 10</b> <b><br></b>  <b>ServerLimit 256</b> <b><br></b>  <b>MaxClients 256</b> <b><br></b>  <b>MaxRequestsPerChild 10000</b> <br><br><br>  In order not to overload the article, we will not describe the value of each of the variables, just note that this configuration increases the speed of work, but at the same time leads to an increased consumption of RAM. <br><br>  After making the changes, you must save httpd.conf and restart Apache: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0e3/94d/e0a/0e394de0a26b4735bf55a623c6d50912.png"><br><br>  The result of not too long work was the ‚Äúexcellent result‚Äù of the UMI.CMS performance index. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/694/922/bdc/694922bdcb84db823e5537a377251784.jpg"><br><br>  We hope that this article will help your projects to work faster!  Well, web applications from our CMS directory for installations in 1 click on Jelastic and so everyone flies. <br><br>  You can see for yourself by <a href="http://infoboxcloud.ru/jelastic/">taking part in the beta testing of the</a> platform before October 15. </div><p>Source: <a href="https://habr.com/ru/post/196816/">https://habr.com/ru/post/196816/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../196806/index.html">2 "simple" questions on Java</a></li>
<li><a href="../196808/index.html">Giant touchscreen Fox News</a></li>
<li><a href="../196810/index.html">Flask Mega-Tutorial, Part 4: Database</a></li>
<li><a href="../196812/index.html">Tablet processor - let's talk about Bay Trail</a></li>
<li><a href="../196814/index.html">A short excursion to the opening of the robotics laboratory at the Lyceum in Moscow or the answer to habraposta</a></li>
<li><a href="../196820/index.html">To entrust the production of electronics: from its own factory to the fabless company</a></li>
<li><a href="../196826/index.html">Lego Specifications Game in Ciklum Odessa, October 16</a></li>
<li><a href="../196828/index.html">We load data in Oracle</a></li>
<li><a href="../196832/index.html">Nissan LEAF robot car first in Japan received a license plate</a></li>
<li><a href="../196834/index.html">Lock-free data structures. Outside: an introduction to libcds</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>