<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Zero Downtime Upgrade for an application in Microsoft Azure. Part 2: IaaS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Last time, we looked at Zero Downtime Upgrade methods that can be applied as part of the PaaS deployment option for the Microsoft Azure application. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Zero Downtime Upgrade for an application in Microsoft Azure. Part 2: IaaS</h1><div class="post__text post__text-html js-mediator-article">  <a href="http://habrahabr.ru/company/epam_systems/blog/226093/">Last time,</a> we looked at Zero Downtime Upgrade methods that can be applied as part of the PaaS deployment option for the Microsoft Azure application.  Today, we will focus on methods that can be applied not only to cloud services, but to ordinary virtual machines as part of an IaaS deployment. <br><br><h5>  Load Balanced Endpoint </h5><br>  As we know, any virtual machine that discusses requests to your application does this through a specific open port (for example, 80, 8080, 443, etc.).  If there are multiple virtual machines, Microsoft Azure‚Äôs internal load balancer distributes traffic between these virtual machines.  Let's think about how you can use this feature for Zero Downtime Upgrade. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cf4/5d1/247/cf45d12475494aaef51776bd32b8bea6.png"><br><a name="habracut"></a><br>  Imagine that we have several virtual machines within a single cloud service.  Let me remind you that the internal load balancer redistributes traffic only within a single DNS, that is, within a single cloud service. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Let these virtual machines use version 1.0 of our application.  The task, as always, is to update the application to version 1.1 imperceptibly for the user. <br><br>  The Load Balanced Endpoint approach offers the following mechanism: you deploy additional virtual machines within an existing cloud service using the same ports and configuration as the original version.  The easiest way to do this is by scaling.  Suppose there were 2 cars, it became 4. It will also avoid the drawdown of the application performance during the update. <br><br>  After that, one after another, you update the version of the application on virtual machines within the cloud service.  Naturally, to avoid redirecting traffic to a virtual machine that is currently being updated, we must disable the corresponding port for it.  After that, the internal load balancer begins to redistribute traffic between the old and new versions of the application. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/dfc/5e5/a6c/dfc5e5a6cca613ba2309b876ecb67175.png"><br><br>  You can update all virtual machines, and you can update, let's say, 2 of 4, and then just delete unnecessary ones with the old version of the application.  Suppose again using scaling down. <br><br>  Let's now look at the pros and cons of this approach. <br><br>  Pros: <br><ul><li>  Simple scaling process </li><li>  Support IaaS deployment </li><li>  No performance drawdown during application update </li><li>  Additional financial costs are needed only at the time of the update. </li></ul><br>  Minuses: <br><ul><li>  The update process is completely manual or requires automation. </li><li>  Additional costs in the update process </li><li>  The configuration of the virtual machines of the old and the new version must match </li><li>  Updating an application within a PaaS deployment is not supported. </li></ul><br><br>  As we see this method is almost a tracing with the Fault / Update domains that Microsoft uses to provide 99.95% SLA for several virtual machines as part of cloud services or availability set.  The only difference is that the update mechanism must be done manually or automated using Microsoft Azure Automation for example. <br><br>  So this update mechanism is quite applicable in practice for applications deployed within IaaS. <br><br><h5>  Traffic manager </h5><br>  All previous methods that we considered suitable for use only in the framework of one approach to the deployment of the application.  However, a logical question arises.  Is there really no such tool that could be used in both PaaS and IaaS deployments? <br><br>  This service really is and it is called - Traffic Manager.  While it‚Äôs not possible to configure an internal load balancer for a specific cloud service, Traffic Manager provides the ability to configure traffic distribution. <br><br>  You can distribute traffic not only between different virtual machines, but also cloud services, as well as determine the algorithm by which this traffic will be distributed. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e3c/5e1/96b/e3c5e196bfb4b3d4a854145585d01216.png"><br><br>  So, in order to implement the Zero Downtime Upgrade script when using Traffic Manager, we need to send user traffic not to the DNS of a specific cloud service, but to the DNS, which is determined when creating the Traffic Manager profile.  It will look like {name} .trafficmanager.net.  Naturally, if necessary, it can be tied to the desired CNAME registrar of names. <br><br>  Suppose version 1.0 of our application is hosted within the cloud service prod.cloudapp.net.  For the new version, we are creating a separate cloud service.  Let's say stage.cloudapp.net.  After deploying a new version of the application, we can redirect traffic from the old version of the application to the new one. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f47/c8f/345/f47c8f345d1d66266a3620e99e7d244c.png"><br><br>  Accordingly, as soon as all traffic has gone to the new version of the application, the old environment can be deleted. <br><br>  Let's now look at the pros and cons of this approach. <br><br>  Pros: <br><ul><li>  Isolated Test Environment </li><li>  Support for virtual machines, cloud services, and Microsoft Azure websites </li><li>  The configuration of the virtual machines of the new and old version of the application may differ </li><li>  If necessary, there is an opportunity to ‚Äúreturn everything back‚Äù </li></ul><br>  Minuses: <br><ul><li>  Additional costs for Traffic Manager service </li><li>  Additional costs in the update process </li><li>  The update process is completely manual or requires automation. </li><li>  DNS Name Cache DNS Update takes time </li></ul><br><br><img src="https://habrastorage.org/getpro/habr/post_images/03d/fd2/c11/03dfd2c116e3de3c74f090fed055e343.png"><br><br>  The described service has several rather serious advantages over all described earlier.  Its use in the production environment is fully justified, but you need to remember about the additional costs when using it. <br><br>  This is all I wanted to tell you about the Zero Downtime Upgrade mechanisms that can be applied on the Microsoft Azure platform.  It is possible that I missed something.  Subscribe in the comments about this! <br><br>  Thank you all for your attention! </div><p>Source: <a href="https://habr.com/ru/post/226763/">https://habr.com/ru/post/226763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../226741/index.html">Solving the problem of sorting trees using a binary Materialized Path</a></li>
<li><a href="../226743/index.html">Overview teXet TM-511R: a secure phone with a 2,700 mAh battery</a></li>
<li><a href="../226749/index.html">ElasticSearch and search vice versa. Percolate API</a></li>
<li><a href="../226755/index.html">Hybrid Cloud FAQ: Good old virtualization in a new financial wrapper</a></li>
<li><a href="../226759/index.html">How to use Routing in Ext JS 5</a></li>
<li><a href="../226765/index.html">Interview. Where to find an investor for your Internet project?</a></li>
<li><a href="../226769/index.html">How to find an idea for a startup in robotics?</a></li>
<li><a href="../226773/index.html">Multicellular processor is what?</a></li>
<li><a href="../226775/index.html">Key parameters and certification of optical SFP modules</a></li>
<li><a href="../226777/index.html">The first development experience for Windows Phone: In-App Purchasing</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>