<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Install and configure a hyper-v server for those who see it for the first time</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 Today I will talk about how to install and configure the hyper-v server hypervisor from Microsoft, as well as about some of the pitfall...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Install and configure a hyper-v server for those who see it for the first time</h1><div class="post__text post__text-html js-mediator-article"><h4>  <i>Introduction</i> </h4><br>  Today I will talk about how to install and configure the hyper-v server hypervisor from Microsoft, as well as about some of the pitfalls and ways to avoid them. <br>  The reason for writing this article was the material of <a href="http://habrahabr.ru/post/79292">this post</a> .  This post is more suitable as a cheat sheet if you have already worked with this hypervisor.  The newcomer will have to face a bunch of nuances and dig up a lot of forums, looking for answers to non-standard questions. <br><br>  This was written from the calculation - as I myself would like to see a similar installation manual.  For newbies, I tried to spell out as much as possible all the actions and their meaning, so that they had the opportunity to start experimenting and inventing something of their own.  For the more savvy, I divided the article into logical blocks and sub-blocks so that you can quickly find the necessary information. <br><br>  Under the cut a lot of text and screenshots <br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <i>Description</i> </h4><br>  The MS hyper-v server is a stripped-down version of MS server 2008 R2 in Core mode (that is, in fact, there is no graphical interface) with the hyper-v role installed and nothing more.  According to Wikipedia, hyper-v server is distributed for free, which, coupled with convenient management and integration with products from MS, makes it a very attractive hypervisor.  In addition, it has a fairly high performance indicators, which means that the resources of the host machine will be spent on the work of the services we need. <br><br><h4>  <i>Installation</i> </h4><br>  Before starting the installation, you need to make sure that your processor supports Intel VT-x or AMD-V hardware virtualization technologies. <br>  First you need to download the <a href="http://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D3512">hyper-v server 2008 R2</a> distribution from the Microsoft website (no need to register).  Next, cut the image to a DVD or make an <a href="http://habrahabr.ru/post/98954">installation flash drive</a> . <br>  Insert the disk / flash drive and boot from it. <br><br><img src="https://habrastorage.org/storage2/6bc/d74/57c/6bcd7457c566804d29fd3d89d4f38436.png"><br>  <sup>Hyper-v server - choose installation wizard language</sup> <br><br>  The installation window prompts us to choose the language of the operating system.  We choose English, then I will explain why it is him. <br><br><img src="https://habrastorage.org/storage2/063/0fa/3d1/0630fa3d16154886232b43d9d179c9a2.png"><br>  <sup>Hyper-v server - select OS language and keyboard layout</sup> <br><br>  The language we chose is English, and the time format is better to choose Russian, so that you don‚Äôt have to worry about setting up the command line. <br>  Next, click the button "Install now".  We read and accept with the license agreement. <br><br><img src="https://habrastorage.org/storage2/530/13d/aa2/53013daa2cb5d1676043cbc08e376f60.png"><br>  <sup>Hyper-v server - select the type of installation</sup> <br><br>  Select the full installation (Custom). <br><br><img src="https://habrastorage.org/storage2/ba9/310/842/ba9310842234fead9a894462234db959.png"><br>  <sup>Hyper-v server - setting hard disk parameters</sup> <br><br>  At this stage the wizard offers to configure the parameters of the hard disk partitions.  It is best to create 2 logical drive.  The first is to install the hypervisor itself, 15 GB is enough for it.  The second is for storing virtual machine containers (VMs).  Thus, it will be much easier to manage, import and migrate VMs. <br>  Click "Next" and go to drink tea.  During installation, the computer will reboot several times. <br><br><h4>  <i>Customization</i> </h4><br><h5>  <i>Basic setup and remote access</i> </h5><br>  After rebooting, the hyper-v server will prompt us to set an administrator password.  Since the default ms windows 2008 server r2 group policy is to require a password complexity, you will have to create a password that is 6 characters or less, necessarily containing a capital letter and a special character or number (for example, ‚ÄúPassword1‚Äù). <br>  As you can see in the screenshots below, I have the management console in Russian, although English was selected during installation, most likely this is because I downloaded the Russian distribution from the official Microsoft website.  This will not adversely affect the operation and configuration of the server.  If you have a console in English - you can do it by analogy, all settings will be easy to understand. <br><br><img src="https://habrastorage.org/storage2/525/465/930/52546593043cd5828612024f5d198f4f.png"><br>  <sup>Hyper-v server - management interface</sup> <br><br>  After loading the working environment, the OS offers us 2 management consoles.  Standard cmd console and console with preset options.  First of all, we need to set a static ip-address and configure remote server management.  In the management console, select item 8. <br><br><img src="https://habrastorage.org/storage2/869/09c/897/86909c8976b88079ddcde181e20a1fef.png"><br>  <sup>Hyper-v server - network adapters</sup> <br><br>  The list will list the network adapters.  Select the desired and enter its index.  Next, select "1 - set the ip-address of the network adapter."  We enter "S" - which means a static ip-address.  For example, let's set the parameters: <br>  ip address is 192.168.1.100 <br>  subnet mask - 255.255.255.0 <br>  default gateway 192.168.1.1 <br>  After applying the parameters, we will return to the submenu, where the settings previously listed will be listed.  If everything is correct, return to the main menu. <br>  Now we will configure remote access.  Select item 7, then turn on the remote desktop by typing the English "E".  On the question of restricting connections from rdp-clients of old versions, choose ‚Äú2‚Äù - connect from any clients. <br><br>  In the main menu, select item 9, and set the current date and time on the server. <br><br><h5>  <i>Network server name and workgroup</i> </h5><br>  Now we set up a working group.  For the hyper-v server to work, I didn‚Äôt include it in the domain, which somewhat complicates the configuration, but for experiments it is an ideal option.  During tests and testing of various configurations, it is better to isolate test machines from the target network. <br><br>  Choose item 1, then ‚Äújoin the working group‚Äù by typing ‚ÄúW‚Äù.  Next, set the name of the working group, for example ‚Äútest‚Äù.  It is very important that the name of the working group on the hyper-v server and the PC from which we plan to manage it coincide.  After that we return to the main menu. <br><br>  It is advisable to set the network name of the server, select item 2 and enter the name, for example, ‚Äúhyper-srv‚Äù.  To use the parameters you need to reboot, agree with the proposal of the OS. <br><br>  Further, all the settings (such as computer name, workgroup, users, ip-address, etc.) I will give those that described during the installation process.  If you set your parameters, do not forget to use them. <br><br>  After the reboot, we can connect to the server using a remote desktop client.  We select start -&gt; execute, enter <code>mstsc</code> .  In the first field we set the ip-address (in my case 192.168.1.100), we connect.  The server will request authorization data, enter the username ‚Äúhyper-srv \ Administrator‚Äù and the password ‚ÄúPassword1‚Äù. <br><br>  So, we are connected, now you need to configure additional remote control settings.  Go to paragraph 4. Now, in order, select the subparagraphs 1, 2 and wait until the end of the settings.  Upon completion, the OS again asks for a reboot.  Upon completion of these settings, we will be able to connect to the server using the mmc console and the hyper-v server manager from the Remote Server Administration Tools (RSAT) package.  In more detail about it I will describe further in the text. <br><br><h5>  <i>Installing RSAT and hyper-v controller</i> </h5><br>  For comfortable remote server management (creating / deleting / importing / setting up a VM, adding / deleting equipment, managing users / group policies, etc.) we need to install RSAT on our PC.  We will install on windows 7. First of all, download it <a href="http://www.microsoft.com/ru-ru/download/details.aspx%3Fid%3D7887">from here</a> .  In this package, we need the ‚Äúhyper-v dispatcher‚Äù component for the mmc console - this is actually the main tool for managing future VMs. <br>  Subsequent settings will need to be made both on the server (for short SRV) and on our control PC (CM). <br><br><h5>  <i>Customize users</i> </h5><br>  The first step is to create a user on whose behalf we will manage.  Usernames and passwords must match for the CC and NRW! <br>  On SRV - in the management console, select item 3 (add local administrator).  Set the name "admin" and the password for it "Qwerty1".  Check whether the add was successfully, in the cmd console, enter the <code>net user admin</code> .  This command will show us that he is in the ‚ÄúAdministrators‚Äù and ‚ÄúUsers‚Äù groups. <br><br>  On the <code>net user admin Qwerty1 /add</code> , we start the cmd console as an administrator and enter the <code>net user admin Qwerty1 /add</code> , add it to the <code>net localgroup  admin /add</code> group Admin <code>net localgroup  admin /add</code> (for the English version of <code>net localgroup Administrators admin /add</code> ).  Check the results again with <code>net user admin</code> . <br><br>  To set up users and security groups there is a wonderful utility <a href="http://archive.msdn.microsoft.com/HVRemote/Release/ProjectReleases.aspx%3FReleaseId%3D3084">‚ÄúHVRemote‚Äù</a> , written by one of Microsoft employees. <br>  Download the utility and copy the file "HVremote.wsf" to the server.  Remember at the very beginning, I wrote that you need to choose English for the OS?  So, for the correct operation of the ‚ÄúHVremote.wsf‚Äù script, it is necessary that the security groups and users be named in English. <br><br>  A small digression: as I wrote before - there is no graphical interface in the hyper-v server.  This is not entirely true; Microsoft simply cut out everything connected with Explorer, but this does not prevent us from running applications that have graphical windows.  For example, you can copy the total commander program to the server disk and run it from the console. <br><br><img src="https://habrastorage.org/storage2/ec3/214/091/ec3214091d4472bca508767baf7a5381.png"><br>  <sup>Hyper-v server - application launch</sup> <br><br>  Let's continue, on the SRV - open the cmd console, go to the folder with the script file (I saved it to the root of the C: drive).  <code>cscript hvremote.wsf /add:domain\account</code> command <code>cscript hvremote.wsf /add:domain\account</code> , where domain is the name of your server (domain), account is the name of the account to manage.  In my case, the command will look like this <code>cscript hvremote.wsf /add:hyper-srv\admin</code> . <br><br><img src="https://habrastorage.org/storage2/6fa/fb5/c2b/6fafb5c2b151cc70e92df3b951603bb7.png"><br>  <sup>Hyper-v server - script execution</sup> <br><br>  As a result, you should get the same as in the screenshot.  The script added the user to the necessary groups and assigned rights to it. <br>  On the CC side, the following <code>cscript hvremote.wsf /anondcom:grant</code> command <code>cscript hvremote.wsf /anondcom:grant</code> and <code>cscript hvremote.wsf /mmc:enable</code> . <br><br>  To use the snap-ins of the Remote Computer Management Console, you must create exception rules in the server's firewall.  First of all, create a rule that allows you to manage logical drives: <br>  <code>Netsh advfirewall firewall set rule group="Remote Volume Management" new enable=yes</code> . <br>  If you get an error like "Group cannot be specified with other identification conditions" - try to reprint the command manually, rather than copy / paste. <br>  The result of the successful execution of the command: <br><pre> <code class="xml hljs">Updated 3 rule(s). Ok.</code> </pre> <br>  Next, allow remote management of the firewall <code>Netsh advfirewall firewall set rule group="Windows Firewall Remote Management" new enable=yes</code> . <br><pre> <code class="xml hljs">Updated 2 rule(s). Ok.</code> </pre> <br>  Enable access for any snap-ins mmc <code>netsh advfirewall firewall set rule group="Remote Administration" new enable=yes</code> . <br><pre> <code class="xml hljs">Updated 3 rule(s). Ok.</code> </pre><br>  Let us use "Windows Management Instrumentation (WMI)" with the following command <br>  <code>netsh advfirewall firewall set rule group="windows management instrumentation (wmi)" new enable=yes</code> . <br><pre> <code class="xml hljs">Updated 4 rule(s). Ok.</code> </pre><br>  Enable the icmp protocol - <code>netsh firewall set icmpsetting 8</code> . <br>  Enable access to shared files and folders <code>netsh firewall set service type=fileandprint scope=subnet</code> . <br>  If for some reason you cannot connect to the server, try disabling the firewall with the <code>netsh firewall set opmode disable</code> .  You may need to create additional access rules. <br><br>  Now we can use mmc snap-ins to manage the server (manage services, users, policies, etc.) and, most importantly, hyper-v dispatcher.  Let's open it: launch the mmc console -&gt; file -&gt; add or remove a snap -&gt; hyper-v dispatcher.  Select the Action menu -&gt; connect to server -&gt; another computer.  Enter your server's network name (hyper-srv) in the field and connect. <br><br><img src="https://habrastorage.org/storage2/4c1/7f5/6cd/4c17f56cd48c7f140ce7c162ffa01f16.png"><br>  <sup>Hyper-v server - VM control manager</sup> <br><br>  That's all, we successfully installed and configured our hyper-v server.  Now you can safely deploy virtual machines and various services. <br><br>  This is my first article on Habr√©, so I‚Äôm waiting for advice and constructive criticism <br><br>  <i>Links to information resources:</i> <br>  <a href="http://ru.wikipedia.org/wiki/Microsoft_Hyper-V_Server">Wikipedia - Hyper-v server</a> <br>  <a href="http://www.curuit.com/managing-windows-2008-server-core-local-settings-2007100993">Useful console commands</a> </div><p>Source: <a href="https://habr.com/ru/post/146303/">https://habr.com/ru/post/146303/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../146293/index.html">Lenovo ThinkPad Tablet Update to Android 4.0.3</a></li>
<li><a href="../146294/index.html">The development of figurative thinking</a></li>
<li><a href="../146297/index.html">Code from which Internet Explorer breaks</a></li>
<li><a href="../146301/index.html">Third practical task from unity3dstudent.com</a></li>
<li><a href="../146302/index.html">Meet the Ukrainian App Store</a></li>
<li><a href="../146304/index.html">Modern school education, part 1</a></li>
<li><a href="../146306/index.html">Cross-functionality, T-people and Bus factor</a></li>
<li><a href="../146307/index.html">MVA has published a new course on private clouds and System Center 2012</a></li>
<li><a href="../146308/index.html">Show me the money! Big Q $ h Contest at PHDays 2012</a></li>
<li><a href="../146311/index.html">% habrauser%, and you already touched RaspberryPi?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>