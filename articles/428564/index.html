<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Search MapKit: Tips & Tricks</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MapKit is a software library that allows you to use Yandex cartographic data and technologies in mobile applications. It has official documentation , ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Search MapKit: Tips & Tricks</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/dq/_i/jl/dq_ijlbhgproad1ydyfpsill35e.png" width="480"></div><br><p>  MapKit is a software library that allows you to use Yandex cartographic data and technologies in mobile applications.  It has <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/about-docpage/">official documentation</a> , which already contains a detailed description of API methods, so today we will talk about something else. </p><br><p>  In this post I will tell Habr readers about the features of the search in MapKit and share recommendations and tricks that may be useful to you. </p><br><p>  <strong>TL; DR</strong> If you do not want to read the entire article, then here are two of the most useful points as compensation for reading the preface: </p><br><ul><li>  Do not forget to save the session, otherwise the search will not work. </li><li>  All the most interesting information is stored in the object metadata.  If you want to know the full address, opening hours or how much a cup of cappuccino costs in a particular cafe, then you will need metadata. </li></ul><br><p>  Links to documentation in the text will be for Android, classes and methods for iOS are called similarly. </p><a name="habracut"></a><br><h2 id="chto-umeet-poisk">  What can search </h2><br><p>  First of all, let's talk about what can search in MapKit.  The search can do what you roughly expect from an application with maps when you want to find something there. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/m0/1g/wv/m01gwvpktgpsipyacy4rj5pi3yw.jpeg" width="720"></div><br><p>  When you type "cafe", "Lev Tolstoy street, 16" or "tram 3" in the search bar, the <strong>search by text</strong> works.  This is the most sophisticated type of search.  Heaped up in the sense that it supports the maximum set of parameters for customization.  You can try to immediately search along the route or an interesting street, specify the desired number of results, set the user's position and so on.  If after the first search you want to move the map or apply filters to the query (‚Äúpharmacies with a swimming pool‚Äù) - these are <strong>requests</strong> . </p><br><p>  <strong>Reverse search is</strong> familiar to most users on the question "What is it?".  It allows you to click on the map to determine which street or house is ‚Äúunder the cursor‚Äù or which organizations are near this point.  <strong>Search by URI is</strong> needed when you want to find a specific object.  It can be used, for example, to create bookmarks in an application.  They found their favorite coffee house, marked it with an asterisk - next time it will be possible to find this organization by URI, wherever the map window is located.  Neither reverse lookup nor URI lookups support re-queries, because there is nothing for them to specify. </p><br><p>  Another possibility that lives in the search is <strong>search hints</strong> that allow you to automatically complete the query while you type it.  But a detailed story about them postponed for another time. </p><br><h2 id="kak-ustroen-zapros">  How the request is arranged </h2><br><p>  Search, like many parts of MapKit, works asynchronously.  The main object for working with this asynchrony is a <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">search session</a> .  Let's look at a small example. </p><br><div class="spoiler">  <b class="spoiler_title">Little about examples</b> <div class="spoiler_text"><p> The examples in the article will be on Kotlin, so that it is easier to work with optional values ‚Äã‚Äãand the boilerplate code is smaller.  MapKit has a <a href="https://github.com/yandex/mapkit-android-demo">demo app</a> .  It can be used to test examples, but for this <a href=""><code>SearchActivity</code></a> worth converting from Java to Kotlin.  <code>showMessage</code> , which from time to time appears in the code, is any convenient way for you to display a line of text on the screen or in the log. </p></div></div><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">// `searchManager`  `searchSession` ‚Äì  .    //    ,     . searchManager = SearchFactory.getInstance().createSearchManager( SearchManagerType.ONLINE ) val point = Geometry.fromPoint(Point(59.95, 30.32)) searchSession = searchManager!!.submit("", point, SearchOptions(), object: Session.SearchListener { override fun onSearchError(p0: Error) { showMessage("Error") } override fun onSearchResponse(p0: Response) { showMessage("Success") } } )</span></span></code> </pre> <br><p>  Immediately after the <code>submit</code> call, the control will return to your code, and when MapKit receives a response from the server, SearchListener will be called. </p><br><p>  The search session allows you to: </p><br><ul><li>  <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">Cancel request</a> .  For example, if the user closes the search screen. </li><li>  <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">Retry request</a> in case of error.  For example, if there were any problems with the network. </li><li>  Continue interaction with the search after the response received.  <strong>Requests</strong> are done through the session. </li></ul><br><p>  Session at destruction is automatically canceled.  This means that if it is not saved on the side of the client code, the search will not work. <br>  <strong>Do not forget to save the session, the session is your friend!</strong> </p><br><h3 id="search-options">  Search options </h3><br><p>  A common way to customize search queries is the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchOptions-docpage/"><code>SearchOptions</code></a> class, which allows you to change query parameters. </p><br><ul><li>  The main of these parameters is <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchType-docpage/"><code>SearchType</code></a> .  It allows you to specify whether you want to see in the response toponyms, organizations or transport (you will most likely not need the other types). </li><li>  Another important query parameter is <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Snippet-docpage/">snippets</a> .  We will talk about them in more detail in the section about the response device. </li><li>  If you want to get the geometry of the toponym (for example, street or region), then you need to order it through <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchOptions-docpage/"><code>setGeometry(true)</code></a> .  Keep in mind that the geometry is quite "heavy" in terms of transmitted data. </li><li>  By default, the search does not return closed (temporarily or permanently) organizations, but if you need them, you need to set <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchOptions-docpage/"><code>setSearchClosed(true)</code></a> . </li></ul><br><p>  In addition to the listed parameters, there are still some that may be useful to you; you can find them in the class documentation.  Please note that not all queries support all combinations of parameters.  The documentation for each <code>SearchManager</code> or <code>Session</code> method indicates which parameters from <code>SearchOptions</code> it understands. </p><br><h2 id="kak-ustroen-otvet">  How does the answer work? </h2><br><p>  Judging by the questions in support, the users are most confused by the format of the search response.  If you look at the class of the answer, then it looks quite simple (at least, the interesting part of us): </p><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Response</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> SearchMetadata </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getMetadata</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">synchronized</span></span></span><span class="hljs-function"> GeoObjectCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCollection</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; <span class="hljs-comment"><span class="hljs-comment">// ... }</span></span></code> </pre> <br><p>  Here, <code>getCollection()</code> returns objects in the response, and <code>getMetadata()</code> some <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchMetadata-docpage/">additional data</a> that includes, for example, information about <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchMetadata-docpage/">the response window</a> , the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchMetadata-docpage/">type of ranking,</a> and the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchMetadata-docpage/">number of results found</a> .  If you look inside the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/GeoObjectCollection-docpage/"><code>GeoObjectCollection</code></a> you can see that there are some <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/GeoObjectCollection.Item-docpage/"><code>Item</code></a> s in it, which can be either other <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/GeoObjectCollection-docpage/"><code>GeoObjectCollection</code></a> or <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/GeoObject-docpage/"><code>GeoObject</code></a> . </p><br><p>  Collections within collections in the search does not happen (at least for now), so let's look at <code>GeoObject</code> .  Inside the object there is a name ( <code>getName()</code> ), a description ( <code>getDescriptionText()</code> ), a frame ( <code>getBoundingBox()</code> ), a set of geometries ( <code>getGeometry()</code> ), and a few other not very clear methods.  Where are the phone numbers of the organization?  How to understand which city the toponym belongs to? </p><br><p>  According to the methods of the object, this is not very clear. </p><br><h3 id="geoobject">  Geoobject </h3><br><p>  It is time to talk more about <code>GeoObject</code> . </p><br><p>  <code>GeoObject</code> is such a basic "card" object.  Inside it can be a traffic event, a separate object from the search result, a maneuver in the route or an object on the map (POI), such as a monument or some conspicuous organization. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_l/ut/15/_lut15ur4w70yz88v1127swd6wg.png"></div><br><p>  All the most interesting thing about an object is stored in metadata.  They can be accessed using the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/GeoObject-docpage/"><code>getMetadataContainer()</code></a> method.  The key in this container is the type of metadata.  If you see in the documentation something that ends with the word <code>Metadata</code> , then you will most likely come here.  In search of different "metadata" pieces 15. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/gd/we/00/gdwe00tnfbshuzugslvjssupja4.png"></div><br><p>  Metadata can be divided into several types.  The first type is metadata that determines what type of object the object is: toponyms ( <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/ToponymObjectMetadata-docpage/"><code>ToponymObjectMetadata</code></a> ), organizations ( <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/BusinessObjectMetadata-docpage/"><code>BusinessObjectMetadata</code></a> ) or transport ( <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/TransitObjectMetadata-docpage/"><code>TransitObjectMetadata</code></a> ).  In the metadata for the toponym, you can find a structured address and detailed geometry.  The organization‚Äôs metadata is the opening hours or company website.  This metadata is determined by the type of search in the query - if you searched for only toponyms, then each object in the response must have corresponding metadata.  If you searched for place names or organizations, then each object will have at least one of the two "metadata". </p><br><p>  Here's how to find phone numbers for a company: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> phones = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">BusinessObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">phones</span></span></span></span></code> </pre> <br><p>  But to find a city in a structured address: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> city = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(<span class="hljs-type"><span class="hljs-type">ToponymObjectMetadata</span></span>::<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">java</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">address</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">components</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">?</span></span></span><span class="hljs-class">.</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">firstOrNull</span></span></span><span class="hljs-class"> </span></span>{ it.kinds.contains(<span class="hljs-type"><span class="hljs-type">Address</span></span>.<span class="hljs-type"><span class="hljs-type">Component</span></span>.<span class="hljs-type"><span class="hljs-type">Kind</span></span>.<span class="hljs-type"><span class="hljs-type">LOCALITY</span></span>) } ?.name</code> </pre> <br><p>  The second type is the metadata that comes with the object, although you did not ask for it.  The main type you need to know about is <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/uri/UriObjectMetadata-docpage/"><code>URIObjectMetadata</code></a> .  Inside the <code>URIObjectMetadata</code> is stored the unique identifier of the object that needs to be passed to the <strong>search by URI</strong> . </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//       ¬´¬ª,     //     val uri = response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(UriObjectMetadata::class.java) ?.uris ?.firstOrNull() ?.value</span></span></code> </pre> <br><p>  And the third type is metadata that will come in response only if you specifically ask for a search about it.  Differently, this metadata is called <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Snippet-docpage/">snippet</a> .  Snippets are small additional pieces of data that either change more often than the main ‚Äúreference‚Äù data or that are not needed by everyone.  This may be a rating, a link to photos or panoramas, the exchange rate or the price of fuel at a gas station.  The list of snippets must be specified using search options.  If the server has an ordered snippet, then it will add it to the corresponding object. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Geometry</span></span>.fromPoint(<span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">59.95</span></span>, <span class="hljs-number"><span class="hljs-number">30.32</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> options = <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>() options.snippets = <span class="hljs-type"><span class="hljs-type">Snippet</span></span>.<span class="hljs-type"><span class="hljs-type">FUEL</span></span>.value searchSession = searchManager!!.submit(<span class="hljs-string"><span class="hljs-string">""</span></span>, point, options, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>) ... <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> fun onSearchResponse(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>) { <span class="hljs-comment"><span class="hljs-comment">//         showMessage(response.collection.children.firstOrNull()?.obj ?.metadataContainer ?.getItem(FuelMetadata::class.java) ?.fuels ?.joinToString("\n") { "Fuel(name=${it.name}, price=${it.price?.text})" } ?: "No fuel" ) }</span></span></code> </pre> <br><p>  All the metadata listed above are added to individual objects in the response.  There is also metadata that is added to the answer entirely.  But they are rendered into <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchMetadata-docpage/"><code>SearchMetadata</code></a> methods and they do not need to be extracted from any special collection. </p><br><pre> <code class="scala hljs"><span class="hljs-comment"><span class="hljs-comment">//            response.metadata.businessResultMetadata?.categories //     (  )     response.metadata.toponymResultMetadata?.responseInfo?.mode</span></span></code> </pre> <br><h2 id="primery-ispolzovaniya">  Examples of using </h2><br><p>  Now let's go through the main methods of search classes, look at usage examples and for some unobvious moments associated with them. </p><br><h3 id="poisk-po-tekstu">  Search by text </h3><br><p>  The main method for searching by text (and for the whole search, probably) is <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchManager-docpage/"><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><ul><li>  The <code>text</code> parameter is expected to contain the text you want to search. </li><li>  The <code>geometry</code> parameter is a bit trickier.  Depending on what kind of geometry is transmitted, the search will behave differently: <br><ul><li>  If you pass the point, the search will be performed in a small window next to this point. </li><li>  If you pass a rectangular window ( <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/geometry/BoundingBox-docpage/"><code>BoundingBox</code></a> ) or a <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/geometry/Polygon-docpage/">polygon</a> of four points, then it will be used as a search window.  A simple example of such a window is the visible area of ‚Äã‚Äãthe map. </li><li>  Finally, if you pass a <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/geometry/Polyline-docpage/">polyline</a> , the window describing it will be used as a search window, and the ranking will be based on this polyline. </li></ul></li><li>  About <code>SearchOptions</code> and <code>SearchListener</code> we already spoke above. </li></ul><br><p>  The server may consider that the correct answer is not in the window in which the initial search was performed (‚Äúcafe in Vladivostok‚Äù, when the search box in Moscow).  In this case, you will need to take the answer window and move the card there so that the results can be seen on the screen (re-querying yourself this is not allowed and the card is not asked to move). </p><br><p>  The <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchManager-docpage/"><code>submit</code></a> method has a <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchManager-docpage/"><code>submit</code></a> brother: </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( String text, Polyline polyline, Geometry geometry, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span>;</code> </pre> <br><p>  with one additional parameter.  This parameter can be used to transfer a large <strong>y</strong> polyline (for example, a route to another city) and a small search box.  Then the search itself will cut out the necessary part of the transferred polyline and will use only it for the query. </p><br><h3 id="perezaprosy">  Requests </h3><br><p>  Requests, unlike other types of requests, are made using a search session, which returns the same <code>submit</code> and his twin brother.  Part of the session methods is simple and clear: </p><br><ul><li>  you can change the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">query window</a> (when the user, for example, moved the map) </li><li>  You can update the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">search options</a> (for example, to update the position of the user) </li><li>  You can change the ranking type - by <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">distance</a> or by <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/">rating</a> . </li></ul><br><p>  To perform a refined search, use the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/"><code>resubmit</code></a> method.  It accepts the same <code>SearchListener</code> as a normal search.  Before calling it, you can change several parameters of the session.  For example, at the same time change the type of ranking and apply filters. </p><br><h4 id="filtry">  Filters </h4><br><p>  Since we are talking about filters.  Filters are when ‚ÄúWi-Fi‚Äù and ‚ÄúItalian cuisine‚Äù.  They probably have the most confusing syntax of all the search interfaces in MapKit.  This is due to the fact that the same <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/BusinessFilter-docpage/">data structures are</a> used to obtain filters from the search response and to specify filters in the re-query. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/7m/51/ky/7m51ky9gytyd1rlubljviboun5k.jpeg" width="360"></div><br><p>  Filters are of two types.  Boolean filters assume only two mutually exclusive values ‚Äã‚Äã- ‚Äúis‚Äù or ‚Äúno‚Äù.  This may be the presence of Wi-Fi in a cafe, a toilet at a gas station or parking next to the organization.  Enum filters assume a variety of values ‚Äã‚Äãthat can be queried together.  This, for example, the type of kitchen for a cafe or types of fuel at the gas station. </p><br><p>  Let's first see how to get the filters available for the current rerouting: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> fun filters(response: <span class="hljs-type"><span class="hljs-type">Response</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span>? { fun enumValues(filter: <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>) = filter .values .enums ?.joinToString(prefix = <span class="hljs-string"><span class="hljs-string">" -&gt; "</span></span>) { e -&gt; e.value.id } ?: <span class="hljs-string"><span class="hljs-string">""</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> response .metadata .businessResultMetadata ?.businessFilters ?.joinToString(separator = <span class="hljs-string"><span class="hljs-string">"\n"</span></span>) { f -&gt; <span class="hljs-string"><span class="hljs-string">"${f.id}${enumValues(f)}"</span></span> } }</code> </pre> <br><p>  In the resulting line for the boolean filters, only the identifier will be shown, and for the enum filters, the identifier of the filter itself and the identifiers of the available values.  Now, armed with knowledge of the available identifiers, we will look for the very cafes of Italian cuisine that have Wi-Fi.  First, add a boolean filter: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> boolFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"wi_fi"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromBooleans( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">BooleanValue</span></span>(<span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span>)) ) )</code> </pre> <br><p>  Now the enum filter: </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> enumFilter = <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"type_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* disabled= */</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* values= */</span></span> <span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">Values</span></span>.fromEnums( listOf(<span class="hljs-type"><span class="hljs-type">BusinessFilter</span></span>.<span class="hljs-type"><span class="hljs-type">EnumValue</span></span>( <span class="hljs-type"><span class="hljs-type">Feature</span></span>.<span class="hljs-type"><span class="hljs-type">FeatureEnumValue</span></span>( <span class="hljs-comment"><span class="hljs-comment">/* id= */</span></span> <span class="hljs-string"><span class="hljs-string">"italian_cuisine"</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* name= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-comment"><span class="hljs-comment">/* imageUrlTemplate= */</span></span> <span class="hljs-string"><span class="hljs-string">""</span></span> ), <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-literal"><span class="hljs-literal">true</span></span> )) ) )</code> </pre> <br><p>  And finally, you can add filters to the session and call <code>resubmit()</code> : </p><br><pre> <code class="scala hljs">searchSession!!.setFilters(listOf(boolFilter, enumFilter)) searchSession!!.resubmit(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  Please note that you cannot set filters for the first query.  First you need to get a search response that lists the available filters.  And only then create a re-request. </p><br><h5 id="dopolnitelnye-rezultaty">  Additional results </h5><br><p>  Another session allows you to check if there are additional search results for your search.  And, if they are, get them.  For example, when you search for a cafe in your city, most likely, all of them will not fit on one page of the search answer.  A couple of methods <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/"><code>hasNextPage</code></a> and <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/Session-docpage/"><code>fetchNextPage</code></a> needed to view the next pages of the list.  Here you need to know that first, calling <code>fetchNextPage</code> will throw an exception if the <code>hasNextPage</code> method returns <code>false</code> .  And secondly, the use of these methods implies that the remaining parameters do not change.  That is, the session is used either to refine the request ( <code>resubmit()</code> ) or to get the next pages ( <code>fetchNextPage()</code> ).  Combine these modes is not necessary. </p><br><h4 id="obratnyy-poisk">  Reverse lookup </h4><br><p>  Reverse search for convenience is also called <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchManager-docpage/"><code>submit</code></a> : </p><br><pre> <code class="java hljs"><span class="hljs-function"><span class="hljs-function">Session </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( Point point, Integer zoom, SearchOptions searchOptions, SearchListener searchListener )</span></span></span></span></code> </pre> <br><p>  It differs from other types of queries in that it <em>requires</em> only one type of search to enter.  Either you pass the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchType-docpage/"><code>GEO</code></a> type and look for place names, or the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/SearchType-docpage/"><code>BIZ</code></a> type and look for organizations.  There is no third. </p><br><p>  In the reverse search with the <code>GEO</code> type, there are moments that require explanation.  Note that the answer will contain several objects in the hierarchy (that is, the answer will be a house, a street, a city, and so on).  In simple cases, you can just take the first object.  In more complex, search for the desired hierarchy. </p><br><p>  The zoom level ( <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit/ref/com/yandex/mapkit/map/CameraPosition-docpage/"><code>zoom</code></a> ) is needed to produce adequate results, depending on what the user sees on the map.  Imagine a user looking at a map across a country.  Then it will be strange for him to click on to show a separate street or house if the user accidentally managed to get into them.  Quite enough cities.  This is what the <code>zoom</code> option is for. </p><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> point = <span class="hljs-type"><span class="hljs-type">Point</span></span>(<span class="hljs-number"><span class="hljs-number">55.734</span></span>, <span class="hljs-number"><span class="hljs-number">37.588</span></span>) <span class="hljs-comment"><span class="hljs-comment">//         ¬´  , 16¬ª searchSession = searchManager!!.submit(point, 16, SearchOptions(), this) //    ‚Äì  " " searchSession = searchManager!!.submit(point, 14, SearchOptions(), this)</span></span></code> </pre> <br><h4 id="poisk-po-uri">  Search by URI </h4><br><p>  Everything is clear enough here - we take the URI from the <code>URIObjectMetadata</code> , remember, after a while we come to the search and using this URI we get exactly the object that we have memorized. </p><br><pre> <code class="scala hljs">searchSession = searchManager!!.resolveURI(uri, <span class="hljs-type"><span class="hljs-type">SearchOptions</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)</code> </pre> <br><p>  Somehow even boring. </p><br><h2 id="poiskovyy-sloy-i-svetloe-buduschee">  Search layer and bright future </h2><br><p>  Next to <code>SearchManager</code> there is still a thing called the <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-search/ref/com/yandex/mapkit/search/search_layer/package-summary-docpage/">search layer</a> .  The layer was conceived for combining a search with a map.  He himself is able to add results to it, move the map so that these results show and make re-queries when the user moves the map.  In many ways, it is similar to the combined <code>SearchManager</code> and <code>Session</code> , but the built-in work with the map adds new features.  And talking about them is beyond the scope of this article.  At the time of the release of MapKit 3.1, we already had time to roll in the search layer in real-world applications, so you can try using it at home.  Perhaps it will make your search work easier. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/ct/tg/g4/cttgg4rh3iffabd5xfm8fc6s_ha.jpeg" width="480"></div><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  I hope that after reading the article, you will have an understanding of how to work with MapKit search in full force.  Surely there are still some subtle and non-trivial moments (for example, we almost did not talk about the tips and the search layer).  Something can be found in the documentation, something to clarify in projects on GitHub or ask our support. </p><br><p>  Try MapKit, use search in it and <a href="https://yandex.ru/jobs/vacancies/dev%3Fservices%3Dmaps">come to Maps</a> to make them even better! </p><br><p>  <strong>PS</strong> And also come to visit us on November 29 to listen about <a href="https://events.yandex.ru/events/meetings/29-November-2018/">how the backend of automotive routing works</a> .  Which, by the way, can also be used in <a href="https://tech.yandex.ru/maps/doc/mapkit/3.x/concepts/android/mapkit-directions/ref/com/yandex/mapkit/directions/driving/package-summary-docpage/">MapKit</a> , but that's another story. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/428564/">https://habr.com/ru/post/428564/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../428552/index.html">Algorithm: How to find the next lexicographic permutation</a></li>
<li><a href="../428556/index.html">‚ÄúProduction environment out of your control‚Äù: Rian Lewis about testing blockchain projects</a></li>
<li><a href="../428558/index.html">How I created a ‚Äúwizard‚Äù for WordPress from my deep laziness</a></li>
<li><a href="../428560/index.html">Unscheduled Friday Announcement</a></li>
<li><a href="../428562/index.html">Droidcon London. How it was</a></li>
<li><a href="../428566/index.html">Arrow functions in JavaScript: why they are needed, how to handle them, when they should be used, and when not</a></li>
<li><a href="../428568/index.html">React Native Web Application Development Guide</a></li>
<li><a href="../428570/index.html">Higher Order Functions in JavaScript</a></li>
<li><a href="../428572/index.html">Higher-order components in React</a></li>
<li><a href="../428574/index.html">We take corporate communication to a new level with Zextras Chat</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>