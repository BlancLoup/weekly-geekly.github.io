<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We get acquainted with Fabric.js. Part 3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the translation of the third part of a series of articles on the open Javascript canvas library Fabric.js. 

 We covered the main part of the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We get acquainted with Fabric.js. Part 3</h1><div class="post__text post__text-html js-mediator-article">  <i>This is the translation of the third part of a series of articles on the open Javascript canvas library Fabric.js.</i> <br><br>  We covered the main part of the basic material on Fabric in the <a href="http://habrahabr.ru/post/162367/">first</a> and <a href="http://habrahabr.ru/post/167119/">second</a> parts of this series.  This article will provide more in-depth material. <br><a name="habracut"></a><br><h2>  Groups </h2><br><img src="https://habrastorage.org/getpro/habr/post_images/017/59c/5b8/01759c5b899401492ecf86d5c92ea9ae.png" alt="image"><br><br>  The first thing we'll talk about is groups.  Object grouping is one of the most powerful tools in Fabric.  Why do we need to group objects?  By itself, in order to work with a variety of objects as a whole. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Remember how we <a href="http://habrahabr.ru/post/162367/">grouped</a> any number of objects with the mouse?  Once grouped, they can simultaneously move, scale, twist, and even change the appearance properties - color, transparency, frame, etc. <br><br>  That is what groups exist for.  Each time you see a selection on canvas (as in the image above), Fabric implicitly, within itself, creates groups so that you can work with them programmatically later.  This is the main meaning of <code>fabric.Group</code> . <br><br>  Create a group of 2 objects, a circle and a text: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circle = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Circle({ <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#eef'</span></span>, <span class="hljs-attr"><span class="hljs-attr">scaleY</span></span>: <span class="hljs-number"><span class="hljs-number">0.5</span></span>, <span class="hljs-attr"><span class="hljs-attr">originX</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> text = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Text(<span class="hljs-string"><span class="hljs-string">'hello world'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">fontSize</span></span>: <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-attr"><span class="hljs-attr">originX</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> group = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Group([ circle, text ], { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">150</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">angle</span></span>: <span class="hljs-number"><span class="hljs-number">-10</span></span> }); canvas.add(group);</code> </pre><br>  First, we created a text object ‚Äúhello world‚Äù.  The <code>originX</code> and <code>originY</code> properties have <code>originX</code> <code>originY</code> to <code>'center'</code> , which will <code>'center'</code> this object within the group.  At initial settings, group members are oriented relative to the upper left corner of the group.  Then a circle with a radius of 100px was filled with the color "#eef" and squeezed vertically (compression ratio - 0.5).  Next, create a <code>fabric.Group</code> object with two parameters.  The first parameter is an array of our 2 objects.  The second parameter set the group position 150/100 and the angle -10.  Finally, they added it using the <code>canvas.add()</code> method like any other object. <br><br>  And voila!  You see an object on the canvas that looks like an ellipse with an inscription.  Note that it is easy to modify it by changing the properties of the group.  You can work with this object as a whole. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6cf/89d/804/6cf89d8047f195b846ec6d4ca4869230.png" alt="image"><br><br>  Now we have a group on canvas.  Let's change it a little bit. <br><br><pre> <code class="javascript hljs">group.item(<span class="hljs-number"><span class="hljs-number">0</span></span>).setFill(<span class="hljs-string"><span class="hljs-string">'red'</span></span>); group.item(<span class="hljs-number"><span class="hljs-number">1</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">text</span></span>: <span class="hljs-string"><span class="hljs-string">'trololo'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'white'</span></span> }); canvas.renderAll();</code> </pre><br>  What's going on here?  We accessed objects within the group using the <code>item()</code> method and changed their properties.  The first object is a compressed circle, the second is text.  Let's see what happened: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/cad/b11/50a/cadb1150ab9a81b978c9d44bb927490c.png" alt="image"><br><br>  The important thing you probably noticed is that the objects of the group are aligned with the center of the group.  When we changed the text-object text, it remained centered, even after changing its width.  This behavior can be canceled by setting the coordinates of the object (left / top). <br><br>  Let's create and group 3 circles so that they are located horizontally one after another. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circle1 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Circle({ <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'red'</span></span>, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circle2 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Circle({ <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span>, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> circle3 = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Circle({ <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'blue'</span></span>, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> }); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> group = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Group([ circle1, circle2, circle3 ], { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }); canvas.add(group);</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/307/c02/ff3/307c02ff3eb5c10ae5481fb4b46033bc.png" alt="image"><br><br>  Working with groups, you need to pay attention to the <b>state of objects</b> .  For example, when forming a group of images, you need to make sure that they are fully loaded.  Fortunately, Fabric has a turnkey solution: <br><br><pre> <code class="javascript hljs">fabric.Image.fromURL(<span class="hljs-string"><span class="hljs-string">'/assets/pug.jpg'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">img</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img1 = img.scale(<span class="hljs-number"><span class="hljs-number">0.1</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span> }); fabric.Image.fromURL(<span class="hljs-string"><span class="hljs-string">'/assets/pug.jpg'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">img</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img2 = img.scale(<span class="hljs-number"><span class="hljs-number">0.1</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">175</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">175</span></span> }); fabric.Image.fromURL(<span class="hljs-string"><span class="hljs-string">'/assets/pug.jpg'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">img</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> img3 = img.scale(<span class="hljs-number"><span class="hljs-number">0.1</span></span>).set({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">250</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">250</span></span> }); canvas.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Group([ img1, img2, img3], { <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">200</span></span> })) }); }); });</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/1d0/26d/533/1d026d533c4cdea73bbcfb81f7b83edc.png" alt="image"><br><br>  There are some more important methods for groups.  The <code>getObjects()</code> method, which also works like <code>fabric.Canvas#getObjects()</code> , and returns an array of all the objects in the group.  There is a <code>size()</code> method that shows the number of all objects in the group.  There is also a <code>contains()</code> method that checks for the presence of a specific object in the group.  The previously mentioned <code>item()</code> method, which allows you to take a specific object from a group.  The <code>forEachObject()</code> method, which works just like <code>fabric.Canvas#forEachObject</code> , with groups only.  And finally, the <code>add()</code> and <code>remove()</code> methods, which respectively add and remove objects from the group. <br><br>  You can add / remove objects from a group in two ways.  With the update position / size of the group and without. <br>  Add a rectangle to the center of the group. <br><br><pre> <code class="javascript hljs">group.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ ... originX: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }));</code> </pre><br>  Add a rectangle 100px from the center of the group: <br><br><pre> <code class="javascript hljs">group.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ ... left: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">originX</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }));</code> </pre><br>  Add a rectangle to the center of the group <b>and</b> update the size of the group: <br><br><pre> <code class="javascript hljs">group.addWithUpdate(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ ... left: group.getLeft(), <span class="hljs-attr"><span class="hljs-attr">top</span></span>: group.getTop(), <span class="hljs-attr"><span class="hljs-attr">originX</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }));</code> </pre><br>  Add a rectangle 100px from the center of the group <b>and</b> update the size of the group: <br><br><pre> <code class="javascript hljs">group.addWithUpdate(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ ... left: group.getLeft() + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: group.getTop() + <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">originX</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span>, <span class="hljs-attr"><span class="hljs-attr">originY</span></span>: <span class="hljs-string"><span class="hljs-string">'center'</span></span> }));</code> </pre><br>  To create a group of objects that already exist on canvas, you need to clone them and then group them: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//     2-  . var group = new fabric.Group([ canvas.item(0).clone(), canvas.item(1).clone() ]); //     . canvas.clear().renderAll(); //    canvas. canvas.add(group);</span></span></code> </pre><br><h2>  Serialization </h2><br>  When you start implementing the functionality in which, for example, you want to allow the user to save the contents of the canvas, or you want to translate it to another client, you will need to <b>serialize the canvas</b> .  How can I send the contents of the canvas?  You can of course export the entire canvas to an image, but uploading the image to the server is cumbersome and inconvenient.  It is much easier to translate content into text than just Fabric can so please us. <br><br><h4>  Methods toObject, toJSON </h4><br>  The basis for serialization in Fabris is the <code>fabric.Canvas#toObject()</code> and <code>fabric.Canvas#toJSON()</code> . <br>  Let's look at an example, serialization of empty canvas. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Canvas(<span class="hljs-string"><span class="hljs-string">'c'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas); <span class="hljs-comment"><span class="hljs-comment">// '{"objects":[],"background":"rgba(0, 0, 0, 0)"}'</span></span></code> </pre><br>  We use the ES5 <code>JSON.stringify()</code> method, which calls the <code>toJSON</code> method on an object if this method exists.  The canvas object in Fabric has this method, it is equivalent to calling <code>JSON.stringify(canvas.toJSON())</code> . <br><br>  Consider a return string that represents an empty canvas.  It is in JSON format, and consists of the '' objects '' and '' background '' properties.  The '' objects '' property is currently empty, since there is nothing on the canvas, and the '' background '' has its initial transparent value (‚Äúrgba (0, 0, 0, 0)‚Äù). <br><br>  Set the canvas to a different background, and see what changes. <br><br><pre> <code class="javascript hljs">canvas.backgroundColor = <span class="hljs-string"><span class="hljs-string">'red'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas); <span class="hljs-comment"><span class="hljs-comment">// '{"objects":[],"background":"red"}'</span></span></code> </pre><br>  As expected, the canvas view now contains a different background.  Now let's try to add some objects. <br><br><pre> <code class="javascript hljs">canvas.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas));</code> </pre><br>  ... will output to the console: <br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'{"objects":[{"type":"rect","left":50,"top":50,"width":20,"height":20,"fill":"green","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0}],"background":"rgba(0, 0, 0, 0)"}'</span></span></code> </pre><br>  Wow!  At first glance, a lot of things have changed, but after a closer look, we will see that this new object has become part of the ‚Äúobjects‚Äù array serialized in JSON.  Please note that its description contains all visual components: coordinates, width, height, fill, etc.  If we add another object, say a red circle, and place it behind the rectangle, the result will change accordingly. <br><br><pre> <code class="javascript hljs">canvas.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Circle({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">radius</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'red'</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas));</code> </pre><br>  ... will output to the console: <br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'{"objects":[{() "type":"rect","left":50,"top":50,"width":20,"height":20,"fill":"green","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0},{() "type":"circle","left":100,"top":100,"width":100,"height":100,"fill":"red","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"radius":50}],"background":"rgba(0, 0, 0, 0)"}'</span></span></code> </pre><br>  I selected <code>"type":"rect"</code> and <code>"type":"circle"</code> to indicate where these objects begin.  It may seem that the string is too long, but it's flowers, compared with the serialization of images.  For comparison, let's look at the 1/10 (!) Line <code>canvas.toDataURL('png')</code> method: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAyAAAAK8CAYAAAAXo9vkAAAgAElEQVR4Xu3dP4xtBbnG4WPAQOQ2YBCLK1qpoQE1/m+NVlCDwUACicRCEuysrOwkwcJgAglEItRQaWz9HxEaolSKtxCJ0FwMRIj32zqFcjm8e868s2fNWo/Jygl+e397rWetk5xf5pyZd13wPwIECBAgQIAAAQIECBxI4F0H++Qb134R/U2fevC8q+5esGWESBAgAABAgQIEFiOwPL/MC5AlvO0OBMCBAgQIECAAAECJxQQICcE9HYCBAgQIECAAAECBPYXECD7W3klAQIECBAgQIAAAQInFBAgJwT0dgIECBAgQIAAAQIE9hcQIPtbeSUBAgQIECBAgAABAicUECAnBPR2AgQIECBAgAABAgT2FxAg+1t5JQECBAgQIECAAAECJxQQICcE9HYCBAgQIECAAAECBPYXECD7W3klAQIECBAgQIAAAQInFBAgJwTc9+3z49yvmNd+dI7PzPHJOW6Y4wNzXD3HlXNc9pZdb85/vzbHK3P8aY7n5vj1HL+Y43dz417f97O9jgABAgQIECBAgMBSBATIKd2JCY5dWNwyx5fn+PwcV5U/6tXZ99M5fjjHk3Mjd6HifwQIECBAgAABAgQWLSBAirdnouP6WXfvHHfOcU1x9T6rXp4XPTLHA3NTX9jnDV5DgAABAgQIECBA4NACAuSE4hMdl8+Kr83xzTmuO+G61ttfnEXfnuN7c4PfaC21hwABAgQIECBAgMBJBQTIJQpOeFw7b71/jtsvccWh3vbYfNB9c6NfOtQH+hwCBAgQIECAAAECFxMQIMd8No7C4+F5283HfOtZv/ypOYG7hMhZ3wafT4AAAQIECBDYtoAA2fP+H/1Vqwd3f4jf8y1Lfdkunu7xV7OWenucFwECBAgQIEBg3QICZI/7O/Fxx7xs9wf3t36r3D3evciX7L7F7+6rIY8u8uycFAECBAgQIE'</span></span></code> </pre><br>  And still <a href="https://gist.github.com/kangax/d11b576ad741614ed73e">~ 17000 characters</a> . <br><br>  At first glance, it is not clear why another <code>fabric.Canvas#toObject</code> method was <code>fabric.Canvas#toObject</code> .  It's simple: <code>toObject</code> returns the same view as <code>toJSON</code> , only as an object.  For example, take a canvas with content in the form of a green rectangle.  <code>canvas.toObject()</code> will output to the console: <br><br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"background"</span></span> : <span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>, <span class="hljs-string"><span class="hljs-string">"objects"</span></span> : [ { <span class="hljs-string"><span class="hljs-string">"angle"</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"fill"</span></span> : <span class="hljs-string"><span class="hljs-string">"green"</span></span>, <span class="hljs-string"><span class="hljs-string">"flipX"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"flipY"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"hasControls"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"height"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-string"><span class="hljs-string">"left"</span></span> : <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-string"><span class="hljs-string">"opacity"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span> : <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-string"><span class="hljs-string">"scaleX"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"scaleY"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"selectable"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"stroke"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span> : <span class="hljs-literal"><span class="hljs-literal">null</span></span>, <span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span> : <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"top"</span></span> : <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span> : <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-string"><span class="hljs-string">"type"</span></span> : <span class="hljs-string"><span class="hljs-string">"rect"</span></span>, <span class="hljs-string"><span class="hljs-string">"width"</span></span> : <span class="hljs-number"><span class="hljs-number">20</span></span> } ] }</code> </pre><br>  As you can see, <code>toJSON</code> output is nothing more than a translated <code>toObject</code> line.  The <code>toObject</code> method <code>toObject</code> interesting and useful in that it is ‚Äúsmart‚Äù and ‚Äúlazy‚Äù.  What you see in the array is the result of iterating over all the canvas objects, and delegating the <code>toObject</code> method to <code>toObject</code> .  The ‚Äúclass‚Äù <code>fabric.Path</code> has its own <code>toObject</code> , which returns an array of '' points ''.  And <code>fabric.Image</code> also has this method; it returns the '' src '' property on images.  Following the OOP pattern, each object knows how to serialize itself. <br><br>  This means that when you create your own "class", or you want to change the serialized representation of an object, then you need a <code>toObject</code> method that you can rewrite or extend its functionality. <br>  Let's look at an example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect(); rect.toObject = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-string"><span class="hljs-string">'trololo'</span></span> }; }; canvas.add(rect); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas));</code> </pre><br>  ... will output to the console: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'{"objects":[{"name":"trololo"}],"background":"rgba(0, 0, 0, 0)"}'</span></span></code> </pre><br>  As you can see, the array ‚Äúobjects‚Äù now has a modified representation of our rectangle.  But overwriting this way is often not very useful, in contrast to the <b>expansion of</b> the <code>toObject</code> functional <code>toObject</code> additional properties. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> rect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect(); rect.toObject = (<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">toObject</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fabric.util.object.extend(toObject.call(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>), { <span class="hljs-attr"><span class="hljs-attr">name</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name }); }; })(rect.toObject); canvas.add(rect); rect.name = <span class="hljs-string"><span class="hljs-string">'trololo'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas));</code> </pre><br>  ... will output to the console: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'{"objects":[{"type":"rect","left":0,"top":0,"width":0,"height":0,"fill":"rgb(0,0,0)","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0,"name":"trololo"}],"background":"rgba(0, 0, 0, 0)"}'</span></span></code> </pre><br>  We extended the existing <code>toObject</code> method on the object with the additional property '' name ''.  It is now present in the result of the method call.  It must be remembered that when extending the functionality in this way, the ‚Äúclass‚Äù of the object (in this case, <code>fabric.Rect</code> ) must contain the newly added property in the '' stateProperties '' array.  Only in this case everything will work correctly. <br><br><h4>  ToSVG ‚Äã‚Äãmethod </h4><br>  Another canvas text view is SVG format.  Fabric specializes in SVG parsing and rendering to canvas.  This makes it possible to convert from canvas to SVG and vice versa.  Add the same rectangle to the canvas and see the <code>toSVG</code> method in action: <br><br><pre> <code class="javascript hljs">canvas.add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Rect({ <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">20</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'green'</span></span> })); <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(canvas.toSVG());</code> </pre><br>  ... will output to the console: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'&lt;?xml version="1.0" standalone="no" ?&gt;&lt;!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20010904//EN" "http://www.w3.org/TR/2001/REC-SVG-20010904/DTD/svg10.dtd"&gt;&lt;svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="800" height="700" xml:space="preserve"&gt;&lt;desc&gt;Created with Fabric.js 0.9.21&lt;/desc&gt;&lt;rect x="-10" y="-10" rx="0" ry="0" width="20" height="20" style="stroke: none; stroke-width: 1; stroke-dasharray: ; fill: green; opacity: 1;" transform="translate(50 50)" /&gt;&lt;/svg&gt;'</span></span></code> </pre><br>  Like <code>toJSON</code> or <code>toObject</code> , <code>toSVG</code> , when called on canvas, delegates its logic to each object, and each of them has its own <code>toSVG</code> method, which is specific to each type of object.  If you need to change or extend the <code>toSVG</code> method, you can do it as well as with the <code>toObject</code> method. <br><br>  The advantage of SVG views in comparison with <code>toObject/toJSON</code> is that you can coordinate with any device capable of SVG rendering (browser, application, printer, camera, etc.).  With the toObject / toJSON methods, you must first load the view onto canvas.  By the way, about loading on canvas.  We can serialize the contents of the canvas into text, and how can we load it back? <br><br><h2>  Deserialization, SVG parser </h2><br>  As in serialization, there are 2 ways to load a canvas from a string: from a JSON and SVG view.  For JSON, there are methods <code>fabric.Canvas#loadFromJSON</code> and <code>fabric.Canvas#loadFromDatalessJSON</code> .  For SVG, the <code>fabric.loadSVGFromURL</code> and <code>fabric.loadSVGFromString</code> . <br>  Notice that the first two methods are invoked on canvas, and the other two directly on the fabric. <br><br>  There is nothing special to say about these methods.  They work exactly as expected.  Take, for example, the previous JSON output and put it on an empty canvas: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> fabric.Canvas(); canvas.loadFromJSON(<span class="hljs-string"><span class="hljs-string">'{"objects":[{"type":"rect","left":50,"top":50,"width":20,"height":20,"fill":"green","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"rx":0,"ry":0},{"type":"circle","left":100,"top":100,"width":100,"height":100,"fill":"red","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":0,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"radius":50}],"background":"rgba(0, 0, 0, 0)"}'</span></span>);</code> </pre><br>  ... Both objects appear on the canvas: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9e1/82b/f7b/9e182bf7b8a363dce4105e1c8085dcf5.png" alt="image"><br><br>  Well, loading the canvas from a string is pretty simple, but what about the seemingly incomprehensible <code>loadFromDatalessJSON</code> method?  What is its fundamental difference from the <code>loadFromJSON</code> that we just used?  To understand why we need this method, we need to look at a more or less complex path object, for example, this one: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c15/12e/a3a/c1512ea3afe2370ba56e2a3912fe7b05.png" alt="image"><br><br>  ... and <code>JSON.stringify(canvas)</code> will output the following: <br><br><pre> <code class="javascript hljs"><span class="hljs-string"><span class="hljs-string">'{"objects":[{"type":"path","left":184,"top":177,"width":175,"height":151,"fill":"#231F20","overlayFill":null,"stroke":null,"strokeWidth":1,"strokeDashArray":null,"scaleX":1,"scaleY":1,"angle":-19,"flipX":false,"flipY":false,"opacity":1,"selectable":true,"hasControls":true,"hasBorders":true,"hasRotatingPoint":false,"transparentCorners":true,"perPixelTargetFind":false,"path":[["M",39.502,61.823],["c",-1.235,-0.902,-3.038,-3.605,-3.038,-3.605],["s",0.702,0.4,3.907,1.203],["c",3.205,0.8,7.444,-0.668,10.114,-1.97],["c",2.671,-1.302,7.11,-1.436,9.448,-1.336],["c",2.336,0.101,4.707,0.602,4.373,2.036],["c",-0.334,1.437,-5.742,3.94,-5.742,3.94],["s",0.4,0.334,1.236,0.334],["c",0.833,0,6.075,-1.403,6.542,-4.173],["s",-1.802,-8.377,-3.272,-9.013],["c",-1.468,-0.633,-4.172,0,-4.172,0],["c",4.039,1.438,4.941,6.176,4.941,6.176],["c",-2.604,-1.504,-9.279,-1.234,-12.619,0.501],["c",-3.337,1.736,-8.379,2.67,-10.083,2.503],["c",-1.701,-0.167,-3.571,-1.036,-3.571,-1.036],["c",1.837,0.034,3.239,-2.669,3.239,-2.669],["s",-2.068,2.269,-5.542,0.434],["c",-3.47,-1.837,-1.704,-8.18,-1.704,-8.18],["s",-2.937,5.909,-1,9.816],["C",34.496,60.688,39.502,61.823,39.502,61.823],["z"],["M",77.002,40.772],["c",0,0,-1.78,-5.03,-2.804,-8.546],["l",-1.557,8.411],["l",1.646,1.602],["c",0,0,0,-0.622,-0.668,-1.691],["C",72.952,39.48,76.513,40.371,77.002,40.772],["z"],["M",102.989,86.943],["M",102.396,86.424],["c",0.25,0.22,0.447,0.391,0.594,0.519],["C",102.796,86.774,102.571,86.578,102.396,86.424],["z"],["M",169.407,119.374],["c",-0.09,-5.429,-3.917,-3.914,-3.917,-2.402],["c",0,0,-11.396,1.603,-13.086,-6.677],["c",0,0,3.56,-5.43,1.69,-12.461],["c",-0.575,-2.163,-1.691,-5.337,-3.637,-8.605],["c",11.104,2.121,21.701,-5.08,19.038,-15.519],["c",-3.34,-13.087,-19.63,-9.481,-24.437,-9.349],["c",-4.809,0.135,-13.486,-2.002,-8.011,-11.618],["c",5.473,-9.613,18.024,-5.874,18.024,-5.874],["c",-2.136,0.668,-4.674,4.807,-4.674,4.807],["c",9.748,-6.811,22.301,4.541,22.301,4.541],["c",-3.097,-13.678,-23.153,-14.636,-30.041,-12.635],["c",-4.286,-0.377,-5.241,-3.391,-3.073,-6.637],["c",2.314,-3.473,10.503,-13.976,10.503,-13.976],["s",-2.048,2.046,-6.231,4.005],["c",-4.184,1.96,-6.321,-2.227,-4.362,-6.854],["c",1.96,-4.627,8.191,-16.559,8.191,-16.559],["c",-1.96,3.207,-24.571,31.247,-21.723,26.707],["c",2.85,-4.541,5.253,-11.93,5.253,-11.93],["c",-2.849,6.943,-22.434,25.283,-30.713,34.274],["s",-5.786,19.583,-4.005,21.987],["c",0.43,0.58,0.601,0.972,0.62,1.232],["c",-4.868,-3.052,-3.884,-13.936,-0.264,-19.66],["c",3.829,-6.053,18.427,-20.207,18.427,-20.207],["v",-1.336],["c",0,0,0.444,-1.513,-0.089,-0.444],["c",-0.535,1.068,-3.65,1.245,-3.384,-0.889],["c",0.268,-2.137,-0.356,-8.549,-0.356,-8.549],["s",-1.157,5.789,-2.758,5.61],["c",-1.603,-0.179,-2.493,-2.672,-2.405,-5.432],["c",0.089,-2.758,-1.157,-9.702,-1.157,-9.702],["c",-0.8,11.75,-8.277,8.011,-8.277,3.74],["c",0,-4.274,-4.541,-12.82,-4.541,-12.82],["s",2.403,14.421,-1.336,14.421],["c",-3.737,0,-6.944,-5.074,-9.879,-9.882],["C",78.161,5.874,68.279,0,68.279,0],["c",13.428,16.088,17.656,32.111,18.397,44.512],["c",-1.793,0.422,-2.908,2.224,-2.908,2.224],["c",0.356,-2.847,-0.624,-7.745,-1.245,-9.882],["c",-0.624,-2.137,-1.159,-9.168,-1.159,-9.168],["c",0,2.67,-0.979,5.253,-2.048,9.079],["c",-1.068,3.828,-0.801,6.054,-0.801,6.054],["c",-1.068,-2.227,-4.271,-2.137,-4.271,-2.137],["c",1.336,1.783,0.177,2.493,0.177,2.493],["s",0,0,-1.424,-1.601],["c",-1.424,-1.603,-3.473,-0.981,-3.384,0.265],["c",0.089,1.247,0,1.959,-2.849,1.959],["c",-2.846,0,-5.874,-3.47,-9.078,-3.116],["c",-3.206,0.356,-5.521,2.137,-5.698,6.678],["c",-0.179,4.541,1.869,5.251,1.869,5.251],["c",-0.801,-0.443,-0.891,-1.067,-0.891,-3.473]'</span></span>...</code> </pre><br>  ... and this is only the 5th (!) Part of the entire text. <br><br>  What's going on here?  The Path object consists of hundreds of symbols of Bezier curves that show how this object should be displayed.  All these parts <code>["c",0,2.67,-0.979,5.253,-2.048,9.079]</code> in JSON format are the coordinates of one of the curves.  And when there are hundreds or thousands of these curves, it is not difficult to guess how huge the string will be. <br><br>  What to do? <br><br>  This is where the <code>fabric.Canvas#toDatalessJSON</code> method comes to the rescue.  Let's try: <br><br><pre> <code class="javascript hljs">canvas.item(<span class="hljs-number"><span class="hljs-number">0</span></span>).sourcePath = <span class="hljs-string"><span class="hljs-string">'/assets/dragon.svg'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(canvas.toDatalessJSON()));</code> </pre><br>  ... will output to the console: <br><br><pre> <code class="javascript hljs">{<span class="hljs-string"><span class="hljs-string">"objects"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"type"</span></span>:<span class="hljs-string"><span class="hljs-string">"path"</span></span>,<span class="hljs-string"><span class="hljs-string">"left"</span></span>:<span class="hljs-number"><span class="hljs-number">143</span></span>,<span class="hljs-string"><span class="hljs-string">"top"</span></span>:<span class="hljs-number"><span class="hljs-number">143</span></span>,<span class="hljs-string"><span class="hljs-string">"width"</span></span>:<span class="hljs-number"><span class="hljs-number">175</span></span>,<span class="hljs-string"><span class="hljs-string">"height"</span></span>:<span class="hljs-number"><span class="hljs-number">151</span></span>,<span class="hljs-string"><span class="hljs-string">"fill"</span></span>:<span class="hljs-string"><span class="hljs-string">"#231F20"</span></span>,<span class="hljs-string"><span class="hljs-string">"overlayFill"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"stroke"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeWidth"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"strokeDashArray"</span></span>:<span class="hljs-literal"><span class="hljs-literal">null</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleX"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"scaleY"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"angle"</span></span>:<span class="hljs-number"><span class="hljs-number">-19</span></span>,<span class="hljs-string"><span class="hljs-string">"flipX"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"flipY"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"opacity"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-string"><span class="hljs-string">"selectable"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasControls"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasBorders"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"hasRotatingPoint"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"transparentCorners"</span></span>:<span class="hljs-literal"><span class="hljs-literal">true</span></span>,<span class="hljs-string"><span class="hljs-string">"perPixelTargetFind"</span></span>:<span class="hljs-literal"><span class="hljs-literal">false</span></span>,<span class="hljs-string"><span class="hljs-string">"path"</span></span>:<span class="hljs-string"><span class="hljs-string">"/assets/dragon.svg"</span></span>}],<span class="hljs-string"><span class="hljs-string">"background"</span></span>:<span class="hljs-string"><span class="hljs-string">"rgba(0, 0, 0, 0)"</span></span>}</code> </pre><br>  Well, much less!  What have we done?  Note that before calling the <code>toDatalessJSON</code> method <code>toDatalessJSON</code> we set the value of "/assets/dragon.svg" in the "sourcePath" property of the path object (dragon shape).  Then we called the <code>toDatalessJSON</code> method, and the whole huge path string was turned into the simple string "/assets/dragon.svg". <br><br>  Working with a large number of complex forms, the <code>toDatalessJSON</code> method allows us to significantly reduce the text representation of the canvas, and replace the large path data with a simple reference to SVG. <br><br>  Returning to the <code>loadFromDatalessJSON</code> method, you probably guessed that it allows you to load a canvas from a dataless view (dataless).  <code>loadFromDatalessJSON</code> can load "path" strings (such as "/assets/dragon.svg") and use them as data for path objects. <br><br>  Look at the methods for loading SVG.  We can use a string or URL: <br><br><pre> <code class="javascript hljs">fabric.loadSVGFromString(<span class="hljs-string"><span class="hljs-string">'...'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">objects, options</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> obj = fabric.util.groupSVGElements(objects, options); canvas.add(obj).renderAll(); });</code> </pre><br>  The first argument is the SVG string, the second is the callback function.  The function is called when the SVG has loaded.  It takes two arguments: <code>objects</code> and <code>options</code> .  <code>objects</code> - an array of objects obtained from SVG - paths, a group of path-objects (for complex objects), images, text, etc.  To group all of these objects into one collection and make them look like they were in an SVG document, we use <code>fabric.util.groupSVGElements</code> for both <code>objects</code> and <code>options</code> .  In the end, we get a <code>fabric.Path</code> or <code>fabric.PathGroup</code> object that we can add to the canvas. <br><br>  <code>fabric.loadSVGFromURL</code> works in the same way, except that you use the string that contains the URL, not the SVG content.  Please note that Fabric will try to get this URL via XMLHttpRequest, so the SVG link must comply with the SOP rules. <br><br><h2>  Subclassing </h2><br>  Since Fabric is built on the principles of OOP, then you can create ‚Äúsubclasses‚Äù and extend the functionality of objects easily and naturally.  As you know from the first part of the series, in Fabric there is a strict hierarchy of objects.  All 2D objects (path, images, text, etc.) inherit from <code>fabric.Object</code> , and some ‚Äúclasses‚Äù - like <code>fabric.PathGroup</code> - even have 3-level inheritance. <br><br>  How about doing a ‚Äúsubclass‚Äù on an existing ‚Äúclass‚Äù in Fabric?  Or maybe create a new "class"? <br><br>  In order to do this, we need the method <code>fabric.util.createClass</code> , which is a simple abstraction of ordinary prototype inheritance in javascript.  First, create a simple "class" Point: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Point = fabric.util.createClass({ <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x = x || <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y = y || <span class="hljs-number"><span class="hljs-number">0</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">toString</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.x + <span class="hljs-string"><span class="hljs-string">'/'</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.y; } });</code> </pre><br>  <code>createClass</code> takes an object and uses its properties as properties of a new ‚Äúclass‚Äù object.  '' initialize '' is used as a constructor.  Therefore, when we initialize Point, we create a new object with the properties '' x '', '' y '' and the method '' toString '': <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> point = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Point(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>); point.x; <span class="hljs-comment"><span class="hljs-comment">// 10 point.y; // 20 point.toString(); // "10/20"</span></span></code> </pre><br>  If we want to create a descendant of a ‚Äúclass‚Äù Point, say, a colored point, we use <code>createClass</code> : <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ColoredPoint = fabric.util.createClass(Point, { <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, color</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'initialize'</span></span>, x, y); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color = color || <span class="hljs-string"><span class="hljs-string">'#000'</span></span>; }, <span class="hljs-attr"><span class="hljs-attr">toString</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'toString'</span></span>) + <span class="hljs-string"><span class="hljs-string">' (color: '</span></span> + <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.color + <span class="hljs-string"><span class="hljs-string">')'</span></span>; } });</code> </pre><br>  Note that the object to inherit is now used as the second argument, and the first is the "class" Point, which becomes the parent for the object.  To avoid duplication, we use the <code>callSuper</code> method, which calls the method on the parent "class".  This means that if we change the Point, the changes will also affect <code>ColoredPoint</code> .  Let's look at an example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> redPoint = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ColoredPoint(<span class="hljs-number"><span class="hljs-number">15</span></span>, <span class="hljs-number"><span class="hljs-number">33</span></span>, <span class="hljs-string"><span class="hljs-string">'#f55'</span></span>); redPoint.x; <span class="hljs-comment"><span class="hljs-comment">// 15 redPoint.y; // 33 redPoint.color; // "#f55" redPoint.toString(); "15/35 (color: #f55)"</span></span></code> </pre><br>  Now we know how to create our own ‚Äúclasses‚Äù and ‚Äúsubclasses‚Äù, but we can also use existing ones in Fabric.  For example, create a "class" <code>LabeledRect</code> , which will be just a rectangle labeled.  When an instance of the ‚Äúclass‚Äù is displayed on canvas, the caption will be displayed inside the rectangle.  Something similar (circle and text) we have already considered in the chapter 'Groups'.  By the way, while working with Fabric you can see that you can create abstractions here using groups as well as ‚Äúclasses‚Äù. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> LabeledRect = fabric.util.createClass(fabric.Rect, { <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'labeledRect'</span></span>, <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ options || (options = { }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'initialize'</span></span>, options); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.set(<span class="hljs-string"><span class="hljs-string">'label'</span></span>, options.label || <span class="hljs-string"><span class="hljs-string">''</span></span>); }, <span class="hljs-attr"><span class="hljs-attr">toObject</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fabric.util.object.extend(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'toObject'</span></span>), { <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.get(<span class="hljs-string"><span class="hljs-string">'label'</span></span>) }); }, <span class="hljs-attr"><span class="hljs-attr">_render</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ctx</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'_render'</span></span>, ctx); ctx.font = <span class="hljs-string"><span class="hljs-string">'20px Helvetica'</span></span>; ctx.fillStyle = <span class="hljs-string"><span class="hljs-string">'#333'</span></span>; ctx.fillText(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.label, -<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.width/<span class="hljs-number"><span class="hljs-number">2</span></span>, -<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.height/<span class="hljs-number"><span class="hljs-number">2</span></span> + <span class="hljs-number"><span class="hljs-number">20</span></span>); } });</code> </pre><br>  The code may seem complicated, but everything is pretty simple. <br><br>  First, we define the parent "class" as <code>fabric.Rect</code> to add its display capabilities.  Then we define the '' type '' property and give it the value of the 'labeledRect' '.  This is done to be consistent with the Fabric architecture, since all the objects there have a '' type '' property (rectangle, circle, path, text, etc.). <br><br>  The constructor ( <code>initialize</code> ) is already familiar to us, in it we call <code>callSuper</code> , which calls <code>initialize</code> on the <code>fabric.Rect</code> .  In addition, we give the object an inscription (label) by taking the value from <code>options</code> . <br><br>  As a result, we have 2 methods left - <code>toObject</code> and <code>_render</code> .  <code>toObject</code> , as we remember from the serialization chapter, is responsible for representing the object. <br><br>  Since <code>LabeledRect</code> has the same properties as a regular rectangle (rect), we expanded the parent method <code>toObject</code> by simply adding a label to it. <br><br>  As for the <code>_render</code> method, it is responsible for the immediate drawing of the object.  It consists of a rectangle display ( <code>callSuper</code> ) and additional text display logic. <br><br>  Now, if we want to show such an object: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> labeledRect = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LabeledRect({ <span class="hljs-attr"><span class="hljs-attr">width</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-attr"><span class="hljs-attr">left</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">top</span></span>: <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'test'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#faa'</span></span> }); canvas.add(labeledRect);</code> </pre><br>  ... we get the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f1a/acf/2b2/f1aacf2b2483d40e84c5ae4c2f45c6a4.png" alt="image"><br><br>  Changing the property (label or any other) will lead to the expected result: <br><br><pre> <code class="javascript hljs">labeledRect.set({ <span class="hljs-attr"><span class="hljs-attr">label</span></span>: <span class="hljs-string"><span class="hljs-string">'trololo'</span></span>, <span class="hljs-attr"><span class="hljs-attr">fill</span></span>: <span class="hljs-string"><span class="hljs-string">'#aaf'</span></span>, <span class="hljs-attr"><span class="hljs-attr">rx</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-attr"><span class="hljs-attr">ry</span></span>: <span class="hljs-number"><span class="hljs-number">10</span></span> });</code> </pre><br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb5/bbd/52a/bb5bbd52a9cb373f4c1243f8ed87ece2.png" alt="image"><br><br>  You can modify the behavior of the "class" as you like.  For example, add default values ‚Äã‚Äãso as not to specify them once in the constructor.  Or make custom properties available on the object.  If you make the additional properties customizable, you can put them in <code>toObject</code> , and <code>initialize</code> : <br><br><pre> <code class="javascript hljs">... initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">options</span></span></span><span class="hljs-function">) </span></span>{ options || (options = { }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.callSuper(<span class="hljs-string"><span class="hljs-string">'initialize'</span></span>, options); <span class="hljs-comment"><span class="hljs-comment">//       /   100/50 this.set({ width: 100, height: 50 }); this.set('label', options.label || ''); } ... _render: function(ctx) { //        ctx.font = this.labelFont; ctx.fillStyle = this.labelFill; ctx.fillText(this.label, -this.width/2, -this.height/2 + 20); } ...</span></span></code> </pre><br>  This ends the third part of our series.  Now you have an idea of ‚Äã‚Äãgroups, ‚Äúclasses‚Äù, ‚Äúsubclasses‚Äù and (de) serialization.  I hope that the material presented in the article will help you to solve more complex problems with Fabric.  More information will be presented in the <a href="http://habrahabr.ru/post/257401/">fourth part of the series</a> . <br><br>  Successes and successful development! <br><br>  <i>The translation was carried out with the consent and direct participation of the authors.</i>  <i><a href="http://fabricjs.com/fabric-intro-part-3/">Link to the source</a></i> . </div><p>Source: <a href="https://habr.com/ru/post/254763/">https://habr.com/ru/post/254763/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../254753/index.html">Determine the weight of chess pieces by regression analysis</a></li>
<li><a href="../254755/index.html">From complex to simple: the evolution of interfaces of mobile trading terminals</a></li>
<li><a href="../254757/index.html">We write the postal address, as humans</a></li>
<li><a href="../254759/index.html">Genetic algorithm - visual implementation</a></li>
<li><a href="../254761/index.html">Universal Remote for Arduino</a></li>
<li><a href="../254765/index.html">Comparative analysis of scanners RSL</a></li>
<li><a href="../254767/index.html">Qooxdoo. Developing a TODO List</a></li>
<li><a href="../254769/index.html">Unfunny April Fool's joke from the developers of Magic Lantern</a></li>
<li><a href="../254771/index.html">New Vapor IO data center concept: versatility and space saving</a></li>
<li><a href="../254773/index.html">Normalization of relationships. Six normal forms</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>