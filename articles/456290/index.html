<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Telegram. Unlimited network drive. Free</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr. 

 Surely many people thought about it, maybe someone has this idea in TODO. She lay with me for about a year, but still managed to implemen...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Telegram. Unlimited network drive. Free</h1><div class="post__text post__text-html js-mediator-article">  Hi, Habr. <br><br>  Surely many people thought about it, maybe someone has this idea in TODO.  She lay with me for about a year, but still managed to implement it in the form of a working prototype. <br><br><h3>  TgCloud: </h3><br><ul><li>  Virtual file system with open source g **** code. </li><li>  On the local disk - only metadata: names, size, folder structure, etc. </li><li>  Data is stored in Telegram and downloaded only when working with a file. </li><li>  The size and type of files is not limited, can be used with any OS. </li></ul><br>  Implementation details and link to the repository under the cut. <br><a name="habracut"></a><br><img src="https://habrastorage.org/webt/nr/0-/mp/nr0-mpe-hiysnb52h67gxnlsbe0.gif">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h3>  Idea </h3><br>  The idea to create a VFS based on Telegram appeared while working on <a href="http://t.me/AudioTubeBot">AudioTubeBot</a> and <a href="http://t.me/VideoTubeBot">VideoTubeBot</a> - after <a href="http://t.me/VideoTubeBot">finding</a> a way <a href="https://habr.com/ru/post/348234/">to get around the 50Mb limit on downloading files for bots</a> - I studied the <a href="https://github.com/telegramdesktop/tdesktop/tree/dev/Telegram/SourceFiles">source code of Telegram</a> - I discovered a lot of interesting things.  For example, the download speed is limited mostly by the client itself, and not by the server. <br><br>  As a result, I increased the download speed to Telegram cloud up to ~ 240 Mb / s per session (it has been working steadily for over a year), which is 15 times faster than the official client. <br><br>  The logical step was to use unlimited file storage with a high download speed as a network drive ‚Äî surely many people do, but the problem is that telegram clients are inconvenient to use for searching and organizing files.  In addition - there is a limit of 1.5 GB per file size. <br><br><h3>  FUSE </h3><br>  To solve these problems, I first decided to make a patch of the Linux kernel and make my virtual file system that would allow us to conveniently group the files uploaded to Telegram, while using only metadata. <br><br>  In the process of studying the issue, it turned out that the patch kernel is not necessarily because  Linux has a special <a href="https://ru.wikipedia.org/wiki/FUSE_(%25D0%25BC%25D0%25BE%25D0%25B4%25D1%2583%25D0%25BB%25D1%258C_%25D1%258F%25D0%25B4%25D1%2580%25D0%25B0)">FUSE kernel module</a> that allows developers to create new types of file systems that can be mounted by users without privileges.  For the module, there are wrappers for almost all popular languages. <br><br><img src="https://habrastorage.org/webt/ug/tx/8v/ugtx8vbaf65so_lja5cqvwguh7k.png"><br><br><h3>  Telethon </h3><br>  To access Telegram, I use the <a href="https://github.com/LonamiWebs/Telethon">Telethon</a> library version 0.19.1 with a modified multi-threaded file download (TelegramClientX). <br><br><h3>  Vfs </h3><br>  Not to write a file system from scratch - <a href="https://github.com/xolox/dedupfs">dedupfs</a> in python is taken as a basis, using fuse and sqlite to store metadata that splits files into blocks, considers sha1 hash and reuses identical blocks - you just need to replace the methods for loading data into the storage with your own. <br><br><h3>  Tgcloud </h3><br>  By combining all this, a working prototype of <a href="https://github.com/SlavikMIPT/tgcloud">tgcloud</a> has turned out, so far without cosmic velocities, but still a worker, I hope to involve the community in the development.  The downloaded files are divided into blocks of 10MB, sha1 is calculated and loaded into SavedMessages, the hash is saved in the local database and the file is found when the block is read.  The blocks are glued together in the correct order and a stream of bytes is issued ‚Äî as if you are reading them from the disk. <br><br><h3>  To run the code </h3><br><ul><li>  You need to get api_hash and api_id on <a href="https://my.telegram.org/">my.telegram.org</a> and insert this data along with the phone number of your account in tg_access.py </li><li>  Create a session by running from the project folder <br><br><pre><code class="bash">python3.6 download_service.py</code></pre> <br>
   </li>
<li> <br>
<br>
<pre><code class="bash">sudo yum install python-fuse</code></pre></li>
<li>    <br>
<br>
<pre><code class="bash">mkdir storage</code></pre></li>
<li> VFS: <br>
  <br>
<br>
<pre><code class="bash">python dedupfs/dedupfs.py -df --block-size 10240000 storage/</code></pre> <br>
  <br>
<br>
<pre><code class="bash">python dedupfs/dedupfs.py --block-size 10240000 storage/</code></pre></li>
<li>,        <a href="https://github.com/filebrowser/filebrowser">filebrowser</a></li>
</ul><br>
  .<br>
<br>
<h4>P.S.    ( <a href="https://habr.com/ru/company/vds/blog/456290/"></a>)</h4><br>
<i>  ‚Äî     ,      .. ‚Äî        ¬´ ¬ª,      ‚Äî        ‚Äî   ,           ,      ‚Äî    ‚Äî        .           ‚Äî   ,    ,   90%    ,    VFS ‚Äî      .<br>
        ‚Äî ,          ‚Äî       ,    Telegram ‚Äî  ¬´           ‚Äî          ..  ..¬ª</i><br>
<blockquote><a href="https://t.me/mediatube_stream">   Telegram</a><br>
<a href="https://t.me/mediatube_chat">  </a><br>
<a href="https://github.com/SlavikMIPT/tgcloud">  GitHub</a><br>
</blockquote><br>
<hr><br>
 <a href="https://dedic.sh/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D456290"><b>DEDIC.SH</b></a>         Intel Scalable 2019 :<br>
<ul>
<li>2x Xeon Silver 4214 ‚Äî  24 </li>
<li>2x Xeon Gold 5218 ‚Äî  32 </li>
<li>2x Xeon Gold 6240 ‚Äî   36 .</li>
</ul><br>
    Xeon Silver 4214 ‚Äî <a href="https://dedic.sh/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D455602"><b> 15210 /</b></a><br>
       <b> </b> ‚Äî <b><a href=""> </a></b>!<br>
<br>
       ‚Äî <b><a href="https://vds.sh/ru/%3Futm_source%3Dhabrahabr%26utm_medium%3Dwidget%26utm_content%3D456290">VDS  150 /</a></b> ‚Äî ,   !</div><p>Source: <a href="https://habr.com/ru/post/456290/">https://habr.com/ru/post/456290/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../45628/index.html">8 tips for job seekers</a></li>
<li><a href="../456280/index.html">Getting started with stm32 or do not repeat my mistakes</a></li>
<li><a href="../456282/index.html">Multidimensional graphics in Python - from three-dimensional to six-dimensional</a></li>
<li><a href="../456288/index.html">MAM: front-end assembly without pain</a></li>
<li><a href="../45629/index.html">Habrabagi</a></li>
<li><a href="../456294/index.html">Differences LabelEncoder and OneHotEncoder in SciKit Learn</a></li>
<li><a href="../456298/index.html">Microelectronics technology on the fingers: "Moore's law", marketing moves, and why nanometers are not the same today. Part 2</a></li>
<li><a href="../4563/index.html">262 thousand Muscovites have paid TV</a></li>
<li><a href="../456300/index.html">Finding zina</a></li>
<li><a href="../456302/index.html">Why do we prefer CSS (- variable) to SASS ($ variable)?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>