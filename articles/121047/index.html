<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LibCanvas basics - practice</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is a continuation of the article about the basics of LibCanvas If the first part touched on theoretical ambushes, then in this part we will move ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LibCanvas basics - practice</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/67d6106e/93a6fa81/6e2bf6bf/aa43a5c8.png"><br><br>  This is a continuation of the <a href="http://habrahabr.ru/blogs/canvas/121046/">article about the basics of LibCanvas</a>  If the first part touched on theoretical ambushes, then in this part we will move on to practice and try to implement very basic and simple things.  The purpose of the article is to master the very basics of LibCanvas, we will write very simple scripts that are of little use in real life, but you can develop them into something great. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  HTML </h2><br>  The structure of the html file is very simple: <br><pre><code class="javascript hljs">&lt;!DOCTYPE html&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">meta</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">charset</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"utf-8"</span></span></span></span><span class="xml"><span class="hljs-tag"> /&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"atom.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"libcanvas.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"application.js"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="undefined"></span><span class="hljs-tag"><span class="xml"><span class="undefined"></span><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">head</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">canvas</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">body</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">html</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre> <br><br>  You need to connect the latest <a href="https://github.com/theshock/atomjs">AtomJS</a> and <a href="https://github.com/theshock/libcanvas">LibCanvas</a> .  Beginners should use the <code>*-full-compiled</code> versions from the repository. <br><br>  Next we will look at the contents of <code>application.js</code> <br><br><h2>  Simple drawing to canvas </h2><br>  We can still draw to the canvas using the context.  You need to wait until the DOM is fully loaded, get the canvas element, its context, and draw two shapes.  I immediately globalized all the contents of LibCanvas.  Later on, when I show examples, only the content of the onready function will be implied. <br><br>  Now we just draw a green rectangle and a red circle on a light coffee canvas: <br><pre> <code class="javascript hljs">LibCanvas.extract(); atom.dom(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> canvas = atom.dom(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>).first; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> context = canvas.getContext(<span class="hljs-string"><span class="hljs-string">'2d-libcanvas'</span></span>); context .fillAll( <span class="hljs-string"><span class="hljs-string">'#efebe7'</span></span> ) .fill( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle( <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">75</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span>, <span class="hljs-number"><span class="hljs-number">30</span></span> ), <span class="hljs-string"><span class="hljs-string">'green'</span></span> ) .fill( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Circle ( <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">50</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span> ) , <span class="hljs-string"><span class="hljs-string">'#c00'</span></span> ); });</code> </pre><br> <a href="http://libcanvas.github.com/lessons/context.html"><img src="https://habrastorage.org/storage/303afb2e/e6199223/0123229a/147065f2.png"></a> <br><br><h2>  Animation </h2><br>  But this approach allows you to draw only some static images.  For something interactive, you need to create a LibCanvas object.  Let's make a very simple application - the black canvas is filled with random green rectangles. <br>  Pay attention to two important points: <br>  1. By default, the canvas is cleared every frame, so you must turn off this default behavior with <code>{ clear: null }</code> <br>  2. The function passed to start belongs to the render phase, so it will not be called without updating the canvas, which we achieved thanks to <code>.addFunc( libcanvas.update )</code> .  In fact, this is a bad decision, but in this case it is suitable. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> libcanvas = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> LibCanvas(<span class="hljs-string"><span class="hljs-string">'canvas'</span></span>, { <span class="hljs-attr"><span class="hljs-attr">clear</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> }); libcanvas.ctx.fillAll(<span class="hljs-string"><span class="hljs-string">'black'</span></span>); libcanvas .start(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx.fill( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle({ <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ctx.rectangle.getRandomPoint(), <span class="hljs-attr"><span class="hljs-attr">size</span></span>: [ <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span> ] }), <span class="hljs-string"><span class="hljs-string">'green'</span></span> ); }) .addFunc( libcanvas.update );</code> </pre><br> <a href="http://libcanvas.github.com/lessons/random-fill.html"><img src="https://habrastorage.org/storage/06dfb793/65799303/ecf666d0/d69e419f.png"></a> <br><br><h2>  Objects </h2><br>  Now add an object.  Let it be a piece of black color that will rotate around one of its points.  This time we need to clear the canvas before rendering the next frame, so we will not cancel clear.  We look at the code and read the comments: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Item = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable ], <span class="hljs-comment"><span class="hljs-comment">//       - // Point -          initialize: function (center, speed) { this.line = new Line( center, //          //         center.clone().move([ 20, 0 ]) ); //    ,      //       "/" this.speed = speed / 1000; }, update: function (time) { //        this.line.to.rotate( //  ,       fps  //     .  fps ,  //   ,       this.speed * time, this.line.from ); //   libcanvas,   //         this.libcanvas.update(); }, draw: function () { //    this.libcanvas.ctx .stroke( this.line, 'black' ); } }); var libcanvas = new LibCanvas('canvas'); //     //     .        //       . //         var item = new Item( new Point(50, 50), (180).degree() ); libcanvas.addElement( item ) //     "" LibCanvas,     "start" .start() //  ,      "item.update",     //   ,      bind  : .addFunc( item.update.bind(item) );</span></span></code> </pre><br><br>  We got a <a href="http://libcanvas.github.com/lessons/rotating-item.html">spinning arrow</a> . <br><br><h2>  Mouse response </h2><br>  Let's take our arrow in the red circle, which can be dragged.  It's quite simple, I will show what has changed, as you see, just a few lines.  Notice that I created the <code>shape</code> property, not the <code>circle</code> .  This is necessary for Draggable. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> Item = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable, Draggable <span class="hljs-comment"><span class="hljs-comment">/*  */</span></span> ], [...] initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">center, speed</span></span></span><span class="hljs-function">) </span></span>{ [...] <span class="hljs-comment"><span class="hljs-comment">//   this.shape = new Circle( center, 25 ); }, [...] draw: function () { [...] .stroke( this.shape, '#c00' ); } }); [...] libcanvas.listenMouse(); item.draggable()</span></span></code> </pre><br><br>  We see <a href="http://libcanvas.github.com/lessons/circle-arrow-wrong.html">that almost everything worked</a> , but there is a mistake when we pull the circle - the arrow changes its length.  The secret is that when we move a circle, the point <code>center</code> also moves, which is the beginning of the segment.  The end of the segment remains in place and begins to turn on a new path.  It must be shifted with the beginning.  This is very easy to do by subscribing to the move event at a point: <br><br><pre> <code class="javascript hljs">initialize: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">center, speed</span></span></span><span class="hljs-function">) </span></span>{ [...] <span class="hljs-comment"><span class="hljs-comment">// ,        center.addEvent('move', function (diff) { this.line.to.move(diff); }.bind(this)) },</span></span></code> </pre><br><br>  <a href="http://libcanvas.github.com/lessons/circle-arrow.html">Now correct</a> <br><br><h2>  Stopwatch </h2><br>  Now add another arrow and implement a stopwatch in this way - the time that has passed since entering the page.  The code will change a little bit, but basically it will be very similar to the previous one, therefore I will comment on only the important sections and give only the class code: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> StopWatch = atom.Class({ <span class="hljs-attr"><span class="hljs-attr">Implements</span></span>: [ Drawable, Draggable ], <span class="hljs-attr"><span class="hljs-attr">initialize</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">center</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.center = center; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.millisec = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.line(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.seconds = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.line(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.minutes = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.line(); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.shape = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Circle( center, <span class="hljs-number"><span class="hljs-number">25</span></span> ); center.addEvent(<span class="hljs-string"><span class="hljs-string">'move'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">diff</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//    "move"   "diff"    [this.millisec.to, this.seconds.to, this.minutes.to].invoke('move', diff); }.bind(this)); }, //      line: function () { return new Line( this.center, this.center.clone().move([0, -20]) ); }, update: function (time) { var full = (360).degree(); //  toSeconds, toMinutes  toHours   LibCanvas.Utils.Math //         this.millisec.to.rotate( full * time.toSeconds(), this.center ); //  -   this.seconds .to.rotate( full * time.toMinutes(), this.center ); //  -   this.minutes .to.rotate( full * time.toHours() , this.center ); this.libcanvas.update(); }, draw: function () { this.libcanvas.ctx .stroke( this.shape , '#c00' ) .stroke( this.millisec, '#999' ) .stroke( this.seconds , '#000' ) .stroke( this.minutes , '#090' ); } });</span></span></code> </pre><br><br>  <a href="http://libcanvas.github.com/lessons/stopwatch.html">Here, it turned out!</a> <br><br><h2>  Conclusion </h2><br>  Yes, the threshold of entry is high.  But in return, you get a highly optimized application, extensibility, good architecture and powerful tools.  I hope the article shed light on LibCanvas. <br><br>  If you still have questions - feel free to write in the comments, on email shocksilien@gmail.com or in jabber shock@jabber.com.ua </div><p>Source: <a href="https://habr.com/ru/post/121047/">https://habr.com/ru/post/121047/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121037/index.html">Mobile guide to Moscow shopping centers for iOS and Android</a></li>
<li><a href="../121038/index.html">How to choose a co-founder</a></li>
<li><a href="../121041/index.html">Fake URL shortening services - an innovation of the Runet</a></li>
<li><a href="../121045/index.html">We are finalizing the video card. By file</a></li>
<li><a href="../121046/index.html">Basics of LibCanvas - Theory</a></li>
<li><a href="../121048/index.html">Startup Jobs by PRUFFI (June 6-10)</a></li>
<li><a href="../121052/index.html">Spam karma wrap offer</a></li>
<li><a href="../121053/index.html">Typical errors on web-studio own sites</a></li>
<li><a href="../121054/index.html">$ 4.7 billion</a></li>
<li><a href="../121055/index.html">RobZone robot vacuum cleaners. Have you heard of these?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>