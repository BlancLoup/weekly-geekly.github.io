<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>EazyPhoto: a cozy photo hosting for your server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the near future, when flickr did not yet offer a terabyte for storing photos, and BitTorrent Sync only appeared on the Internet screens in its inse...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>EazyPhoto: a cozy photo hosting for your server</h1><div class="post__text post__text-html js-mediator-article">  In the near future, when flickr did not yet offer a <a href="http://habrahabr.ru/post/180383/">terabyte</a> for storing photos, and BitTorrent Sync only appeared on the Internet screens in its insecure alpha version, I had a need: to share photos with friends and not only.  But as usual with programmers it happens, under the word ‚Äúshare‚Äù it is worth much more than putting photos into VKontakte.  Namely: <br><ul><li>  Put photos somewhere on your server with a beautiful and simple web-interface. </li><li>  Simply and massively upload and download original images. </li><li>  Have the ability to differentiate access to certain albums. </li><li>  Try to connect it with the local network storage so as not to duplicate photos. </li><li>  If possible, delete the original photos from the server after some time and leave only the resized photos. </li><li>  Maximum <b>free</b> !  :) </li></ul><br>  After such thoughts, the idea begins to emerge in my head: ‚ÄúWe need to create ...‚Äù - and you can no longer stop. <br><a name="habracut"></a><br><h2>  What are photo hosting sites now offering? </h2><br>  Google found a lot of cloud services for uploading photos, intended mainly for photographers (and not only).  The essence of all services comes down to the fact that starting with a certain amount, you need to pay a fixed amount per month.  If for six months the amount does not look big, then after two years it will be an unpleasant reminder.  The analogy can be made with payment of ru-domains for 600 rubles per year in nic.ru and with a constant reminder to yourself that these domains should be transferred to other registrars already :). <br><br>  On the other hand, if you already have a server, then you need to use it to the maximum.  I found two projects that, in principle, would be able to fit my tasks.  These are <a href="http://piwigo.org/">Piwigo</a> (formerly phpWebGallery) and <a href="http://koken.me/">Koken</a> .  The last project was generally very pleased.  But getting to know them better, I realized that this did not suit me either. <br><br>  Dropbox, Skydrive, Google+ (Picasa), Yandeks.Fotki - these guys perfectly fulfilled their functions as long as there was enough space. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Share with friends </h2><br>  I want to tell you more about what the term ‚Äúshare‚Äù means to me.  After some event (whether it is a trip to nature or a walk around the city), in which several people take part, many photos appear.  After processing, pictures (300-700 MB) are sent to the local NAS (Synology DS210j).  And this NAS folder should be put on the Internet so that the very friends who are in the photos download it. <br>  Downloading / downloading through the browser such a volume is not for me. <br><br>  But in the end, I want to have a link to an album that you can throw off to someone else.  Well, the list of albums would also be nice to get.  Simple ordinary process. <br><br>  Most importantly, there must be original photographs and a normal resize without filters (not what VK and others are now offering).  Then, when everyone has a 4K TV (as FullHD is now), it will be very cool to look through your photo archive and enjoy it again. <br><br><h2>  BitTorrent Sync </h2><br>  After I read the news about the release of the first version of BTSync for all platforms - I realized everything.  In my head is clearly lined up the algorithm of work: <br><ol><li>  Initial upload of photos takes place via BitTorrent Sync. </li><li>  The user does not care where he shares the folder and gets the readonly secret key, while he can do it on the NAS or at his place locally. </li><li>  Then the user goes to the web-based management interface and adds the album via the readonly secret key. </li><li>  The web interface sends the BTSync command to download this folder on the server.  Gradually, the download to the server begins. </li><li>  At this time in the crown or else where there is a check whether everything is downloaded or not (a-la indexing files).  All files, for example, are added to the database, and a reduced copy is created to them (i.e. all the meta-information is transferred from the original files to the database). </li><li>  After some time we delete the originals from the server (but! They are saved by users who managed to download). </li></ol><br><br>  BTSync for Linux still has no console API.  But there is a web interface that can act as an API server.  Armed with Go, I wrote a <a href="https://github.com/sergeyfast/btsync-cli">console utility</a> for working with BTSync.  Well, then I made a <a href="https://github.com/sergeyfast/bittorrent-sync-client">class</a> for PHP.  And then the thing is: write everything else;) <br><br><h2>  Eazyphoto </h2><br>  In my main specialty, I am a php programmer.  Layout is the worst thing for me :)  Therefore, taking Foundation, I tried to depict something on it. <br><img src="https://habrastorage.org/storage2/b92/de8/b76/b92de8b76f589737a62bfbecdda9a48b.jpg"><br>  On the main page we see a list of albums with names and dates.  And on the album page - square pictures with a preview, as in dropbox.  If you add a description to each photo and set its serial number, you get something like a blog.  I chose the size of large photos for the web-interface just like marketer - FullHD :) <br><br>  Manage albums and photos within the administrative panel.  This is the enemy‚Äôs way to add a new album: just fill in the title, the start date and ReadOnly Secret. <br><img src="https://habrastorage.org/storage2/2d6/f3b/9d8/2d6f3b9d8dde0975218b48bc9a652eef.png"><br><div class="spoiler">  <b class="spoiler_title">What is it all written on?</b> <div class="spoiler_text">  The project is written on the internal engine <a href="http://wiki.eaze.ru/">Eaze</a> .  It is far from perfect, but allows you to quickly solve certain tasks in a known short period of time.  It does not have normal documentation, but it is written in PHP, so in order to understand something, it‚Äôs enough to look inside (just like in the go-lang ideology :). <br><br>  Database: I chose mysql, because everyone has it.  Basically, these two tablets are interesting here: albums and photos <br><img src="https://habrastorage.org/storage2/163/f7c/3f4/163f7c3f468307725fd97b257133484b.png"><br></div></div><br><br><h2>  File indexing </h2><br>  First, I wrote an indexer for PHP: he ran through new albums, added them to the download queue in BTSync, and then ran through existing ones and added new files found.  Just hang the script in cron every 5 minutes: and that would be enough.  But not me. <br>  It would be cool if the pictures were added to the database as they are downloaded.  And here Go comes to the rescue. <br><br><h3>  eazyphotod </h3><br>  A small daemon that hangs and checks directories for new files.  Creates previews for photos and saves to base.  Communicates with BTSync'om.  Here are its main tasks. <br>  To implement these tasks, I used the following packages: <ul><li>  <a href="http://code.google.com/p/gcfg/">code.google.com/p/gcfg</a> - working with <a href="http://code.google.com/p/gcfg/">gitconfig</a> -style ini-files.  At the exit - a filled structure. </li><li>  <a href="https://github.com/disintegration/imaging">github.com/disintegration/imaging</a> - working with images (resize, crop, fit, etc ..).  Without using gd, clean go. </li><li>  <a href="https://github.com/go-sql-driver/mysql">github.com/go-sql-driver/mysql</a> - driver for mysql. </li><li>  <a href="https://github.com/howeyc/fsnotify">github.com/howeyc/fsnotify</a> - cross-platform package for tracking changes in the file system. </li><li>  <a href="https://github.com/rwcarlsen/goexif/exif">github.com/rwcarlsen/goexif/exif</a> is a package for reading EXIF ‚Äã‚Äãdata. </li><li>  <a href="https://github.com/sergeyfast/btsync-cli/">github.com/sergeyfast/btsync-cli</a> is my package for working with the BTSync API. </li></ul><br>  Having checked all the necessary functions in the demo project, I began to assemble it all into a working version.  It took about two days to get the <a href="https://github.com/sergeyfast/eazyphotod">finished result</a> . <br><div class="spoiler">  <b class="spoiler_title">How it works?</b> <div class="spoiler_text"> eazyphotod is launched via upstart (in the future I plan to redo it under the supervisord).  After launch, it loads all albums into memory and starts scanning directories for new photos.  In parallel with this, a gorutin is launched to monitor changes in the file system and to process HTTP requests (update the album's meta-information and add a new album to the download queue). <br>  All requests (resize, update meta-information, event about a new file) are put in one <a href="">queue</a> : <br><pre><code class="hljs haskell"><span class="hljs-title"><span class="hljs-title">var</span></span> <span class="hljs-type"><span class="hljs-type">SyncQueue</span></span> = make(chan *<span class="hljs-type"><span class="hljs-type">SyncItem</span></span>) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SyncItem</span></span></span><span class="hljs-class"> struct { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Album</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Album</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FsPhotos</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">model</span></span></span><span class="hljs-class">.</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">PhotoList</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FullSync</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">bool</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Filename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">string</span></span></span><span class="hljs-class"> }</span></span></code> </pre> <br>  Therefore, there is no need to track simultaneous access to maps and other important variables.  Everything goes in one common line. <br>  Working with the database also turned out <a href="">pretty simple</a> . <br>  In general, if you thought to write on go, but all did not dare - my advice to you is: take and write something on it already :) <br><br>  And one more thing: <a href="http://golang.org/doc/code.html">according to ideology,</a> my go-projects on github <a href="http://golang.org/doc/code.html">are</a> placed incorrectly, because  Only one src folder should be root in the repository.  And I have a whole project.  I'm somehow not comfortable when next to the source code in the same folder are examples of configs, README.md and other supporting materials. <br></div></div><br><br><h2>  Total </h2><br>  The service copes with its tasks quite well: the repository is always online, BTSync is installed on it.  After the photos are sent to the repository, the folder is added to BTSync and an album is created in the web interface - you can go to bed.  The server with eazyphoto will download the photos and add them to the current album.  In the morning you can go, check, and send the link to friends.  And friends already, if necessary, download the originals to themselves through BitTorrent Sync. <br><br><h2>  Try collect </h2><br>  For those who decided to try to raise it all at home - here are the links: <br><ol><li>  <a href="https://github.com/sergeyfast/eazyphoto-web">github.com/sergeyfast/eazyphoto-web</a> - php-part </li><li>  <a href="https://github.com/sergeyfast/eazyphotod">github.com/sergeyfast/eazyphotod</a> - the demon itself </li></ol><br><div class="spoiler">  <b class="spoiler_title">For those who want to poke and see an example</b> <div class="spoiler_text">  The link to the demo deliberately not publish.  But Yandex will help to find the words on the black plate. </div></div><br>  All instructions <s>(or their similarity)</s> are inside projects (open source such open source :). <br><br><div class="spoiler">  <b class="spoiler_title">Installing auxiliary software on the example of Ubuntu</b> <div class="spoiler_text">  1. Install btsync: <br><pre> <code class="hljs pgsql">sudo <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>-apt-repository ppa:tuxpoldo/btsync sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> <span class="hljs-keyword"><span class="hljs-keyword">update</span></span> sudo apt-<span class="hljs-keyword"><span class="hljs-keyword">get</span></span> install btsync</code> </pre><br>  Port with data = 0. Port for web interface: 8888. IP: 127.0.0.1 <br><br>  2. Install go <br>  I recommend through godeb <a href="http://blog.labix.org/2013/06/15/in-flight-deb-packages-of-go">blog.labix.org/2013/06/15/in-flight-deb-packages-of-go</a> <br>  Min version go: 1.1 <br><br>  3. Install eazyphotod <br><pre> <code class="hljs bash">git <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> git://github.com/sergeyfast/eazyphotod.git <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> eazyphotod <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> GOPATH=`<span class="hljs-built_in"><span class="hljs-built_in">pwd</span></span>` go get code.google.com/p/gcfg github.com/disintegration/imaging github.com/go-sql-driver/mysql github.com/howeyc/fsnotify github.com/rwcarlsen/goexif/exif github.com/sergeyfast/btsync-cli/src/btsync go build -o eazyphotod src/*.go</code> </pre><br>  After that we got a binary. <br>  I recommend to create / usr / local / eazyphotod / (user www-data), copy there eazyphotod + config.gcfg <br>  Throw eazyphotod.conf in / etc / init / and run (after configuring config.gcfg): <br><pre> <code class="hljs pgsql">service eazyphotod <span class="hljs-keyword"><span class="hljs-keyword">start</span></span></code> </pre> <br>  (deb-way: put the config in /etc/eazyphotod.conf, the binary in / usr / bin / eazyphotod, and specify the link to the config via the -config parameter). <br></div></div><br><br><h2>  Further development </h2><br>  I would like not to scare potential users with the admin panel, but to make it a normal web-based management interface and a simple script / installation package.  But all this is relevant only with eazyphotod, because the cron and php process for geeks is clearly not the way out;) <br><br>  If anyone has thoughts on the functionality or how it should all look (or suddenly someone wants to help;) - well. <br><br>  Finally: lyrical digression.  Take pictures, share with friends and parents.  Life passes quickly, but the photo archive remains (preferably in RAID1 and an additional copy in case of an apocalypse :)) ... </div><p>Source: <a href="https://habr.com/ru/post/188968/">https://habr.com/ru/post/188968/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../188956/index.html">First Alpha Python 3.4.0 released</a></li>
<li><a href="../188958/index.html">Elliptical cryptography: theory</a></li>
<li><a href="../188962/index.html">Internet business in Russia: is it possible, is it necessary, is it gentle</a></li>
<li><a href="../188964/index.html">The history of running the game in social networks</a></li>
<li><a href="../188966/index.html">New type of attacks - attacks on cars</a></li>
<li><a href="../188972/index.html">Protection of equipment against surge voltage and switching noise</a></li>
<li><a href="../188974/index.html">Firefox 17 0day via Freedom Hosting</a></li>
<li><a href="../188978/index.html">The history of the creation of a startup for the development of mobile games</a></li>
<li><a href="../188980/index.html">Curiosity - year</a></li>
<li><a href="../188986/index.html">Compiling iOS faster with AIR 4</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>