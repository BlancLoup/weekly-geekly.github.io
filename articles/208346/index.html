<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Undo path changes in AngularJS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Having long been fond of Angular, I just got to the blog of the author framework Dan Wahlin. And in vain - there you can find a lot of interesting and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Undo path changes in AngularJS</h1><div class="post__text post__text-html js-mediator-article">  <i>Having long been fond of Angular, I just got to the blog of the author framework Dan Wahlin.</i>  <i>And in vain - there you can find a lot of interesting and necessary for each application thoughts.</i>  <i>One of them I translated in this article.</i>  <i>In it, you will learn how to stop switching to another page in the Angular application.</i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e17/8bc/c3f/e178bcc3fb86a8ac1e4364ef6a984b32.jpg"><br><br><a name="habracut"></a><br>  Dictionary translator: <br>  - view - template <br>  - route - route <br>  - navigation - transition 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Routing is an excellent tool that allows you to associate templates with AngularJS controllers with the least amount of code needed. <br>  While the user can go straight to a given path, there is a possibility that he initiates the transition before completing some important action (for example, saving data).  In such situations, you may want to cancel the transition and ask the user if he wants to finish his work or warn about the loss of his data.  In this article I want to talk about the reception, which can be used to implement this task. <br><br><h4>  $ LocationChangeStart event </h4><br>  When a transition occurs in the AngularJS application, several events occur.  One of them is called $ locationChangeStart, and the other is $ routeChangeStart (there are actually several more).  Currently (version 1.2) the $ routeChangeStart event does not provide an opportunity to cancel the transition, but $ locationChangeStart is quite suitable for this.  If you look at the AngularJS code, you will find the following section, which shows the occurrence of the $ locationChangeStart event when calling the $ Browser‚Äôs onUrlChange () method: <br><pre><code class="javascript hljs">$browser.onUrlChange(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">newUrl</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($location.absUrl() != newUrl) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($rootScope.$broadcast(<span class="hljs-string"><span class="hljs-string">'$locationChangeStart'</span></span>, newUrl, $location.absUrl()).defaultPrevented) { $browser.url($location.absUrl()); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } $rootScope.$evalAsync(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> oldUrl = $location.absUrl(); $location.$$parse(newUrl); afterLocationChange(oldUrl); }); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$rootScope.$$phase) $rootScope.$digest(); } });</code> </pre> <br>  The most important part of the code is the $ broadcast call.  This call passes the $ locationChangeStart event to all child scope, so that they can be notified of a change in location.  To handle this event, you can use the $ rootScope.on () function.  For example, I added the $ on () call to the function that is called immediately after the controller starts: <br><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//initialize data here.. //Make sure they're warned if they made a change but didn't save it //Call to $on returns a "deregistration" function that can be called to //remove the listener (see routeChange() for an example of using it) onRouteChangeOff = $rootScope.$on('$locationChangeStart', routeChange); }</span></span></code> </pre><br>  This code expects the $ locationChangeStart event and calls the routeChange () function when it occurs.  The return value of the $ on function is the function of ‚Äúcanceling the wait‚Äù, which can be called to stop waiting for the event.  In this example, it is called onRouteChangeOff (available in the controller).  Very soon you will see how it is used. <br><br><h4>  Cancel transition route </h4><br>  The callback function routeChange () is triggered by the $ locationChangeStart event and shows the user‚Äôs warning dialog box: <br><img src="https://habrastorage.org/getpro/habr/post_images/696/6ae/47b/6966ae47be624de2c7235b0daa15b04a.png"><br><br>  Here is the code for the routeChange () function: <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">routeChange</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">event, newUrl</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//Navigate to newUrl if the form isn't dirty if (!$scope.editForm.$dirty) return; var modalOptions = { closeButtonText: 'Cancel', actionButtonText: 'Ignore Changes', headerText: 'Unsaved Changes', bodyText: 'You have unsaved changes. Leave the page?' }; modalService.showModal({}, modalOptions).then(function (result) { if (result === 'ok') { onRouteChangeOff(); //Stop listening for location changes $location.path(newUrl); //Go to page they're interested in } }); //prevent navigation by default since we'll handle it //once the user selects a dialog option event.preventDefault(); return; }</span></span></code> </pre><br>  In the parameters of this function, you can notice the event object and the new route that the user is trying to navigate.  Since you need to remind the user about data loss before changing the template, the event object is used to cancel the transition.  Notice the call to event.preventDefault () at the end of the function. <br>  The dialog box is shown by calling the modalService.showModal () function (take a look at <a href="http://weblogs.asp.net/dwahlin/archive/2013/09/18/building-an-angularjs-modal-service.aspx">my previous post</a> about a personalized modalService that works as a wrapper around the $ modal service from Angular UI Bootstrap). <br>  If the user selects "Ignore Changes", then his changes will be canceled and the application will follow the desired route.  This happens due to disabling the $ locationChangeStart event by calling the onRouteChangeOff () function (remember that this function is returned by calling the $ on function), so we don‚Äôt get stuck in the endless loop of the dialog box when clicking on the Ignore Changes button. <br>  Then $ location.path (newUrl) is called to handle the transition to the specified pattern.  If the user cancels the action, he will remain on the current template. <br><br><h4>  findings </h4><br>  The key to canceling the transition is understanding how to work with the $ locationChangeStart event. <br>  I hope in the future this task can be solved with the help of the $ routeChangeStart event, but at the moment the given code performs this work in full. <br>  You can see an example of how this code works in <a href="https://github.com/DanWahlin/CustomerManagerStandard">the customer management application</a> , which is available on Github (especially the customerEdit template).  Learn more about the <a href="http://weblogs.asp.net/dwahlin/archive/2013/10/25/learning-angularjs-by-example-the-customer-manager-application.aspx">app here</a> . </div><p>Source: <a href="https://habr.com/ru/post/208346/">https://habr.com/ru/post/208346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../208336/index.html">Toyota will sell fuel cell vehicles in 2015</a></li>
<li><a href="../208338/index.html">Jabber moves to full encryption</a></li>
<li><a href="../208340/index.html">CES2014: Transformer Laptop with Two OS from ASUS</a></li>
<li><a href="../208342/index.html">8K 3D TV that does not require glasses from Sharp</a></li>
<li><a href="../208344/index.html">An example of a working application from a web developer: working with a database, layout for Android, publishing to google play</a></li>
<li><a href="../208350/index.html">What is a schoolchild of 10-11 classes and about the future of the IT community in our country?</a></li>
<li><a href="../208352/index.html">Automatic tagging of cache in Yii</a></li>
<li><a href="../208354/index.html">Holidays for "wimps"</a></li>
<li><a href="../208356/index.html">Reboot iOS. Simple and tasteful</a></li>
<li><a href="../208358/index.html">Turning your smartphone into a gaming console Dendy, Sega, PS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>