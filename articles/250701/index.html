<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Dereferencing a null pointer results in undefined behavior.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I didn‚Äôt cause a lot of discussion about whether it is permissible to use the expression & P-> m_foo in C / C ++ if P is a null pointer. Programmers a...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Dereferencing a null pointer results in undefined behavior.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/3f0/867/7bb/3f08677bb95117715550345b6f6a0784.png" alt="Silent NULL (null pointer dereference leads to undefined behavior)" align="left"><br>  I didn‚Äôt cause a lot of discussion about whether it is permissible to use the expression &amp; P-&gt; m_foo in C / C ++ if P is a null pointer.  Programmers are divided into two camps.  Some confidently argued that it was impossible to write this way, others just as confidently asserted that it was possible.  There were various arguments and references.  And I realized that I need to bring final clarity to this question.  To do this, I turned to Microsoft MVP experts and Visual C ++ developers who communicate through a closed mailing list.  They helped prepare this article, and I present it to anyone.  For impatient: this code is not correct. <br><a name="habracut"></a><br><h2>  I will remind the discussion history </h2><br>  It all started with an <a href="http://www.viva64.com/ru/b/0299/">article</a> about checking the Linux kernel with the help of the PVS-Studio analyzer.  But the kernel check itself has nothing to do with it.  The fact is that in the article I gave the following fragment from the Linux code: <br><pre><code class="cpp">static int podhd_try_init(struct usb_interface *interface,
        struct usb_line6_podhd *podhd)
{
  int err;
  struct usb_line6 *line6 = &amp;podhd-&gt;line6;

  if ((interface == NULL) || (podhd == NULL))
    return -ENODEV;
  ....
}</code></pre><br>
    ,   ,     <a href="http://www.viva64.com/ru/t/0066/"> </a>. <br>
<br>
                       . ,         <a href="http://www.viva64.com/go.php%3Furl%3D1481">offsetof</a>,    :<br>
<pre><code class="cpp">#define offsetof(st, m) ((size_t)(&amp;((st *)0)-&gt;m))</code></pre><br>
     ,    .       ,       ,    .<br>
<br>
   ,    .            : "<a href="http://habrahabr.ru/company/pvs-studio/blog/247973/">    </a>".<br>
<br>
  ,    .   .              .<br>
<br>
      ,   ,       .      ,    .      .<br>
<br>
<h2>  </h2> <br>
 '&amp;podhd-&gt;line6'      C   ,  'podhd' ‚Äî  .<br>
<br>
       '&amp;'   C99 ( 6.5.3.2 ¬´    ¬ª):<br>
<br>
<i>   &amp;     ,    []    *,  lvalue-,   ,              .</i> <br>
<br>
 'podhd-&gt;line6'     ,   []  *.    lvalue-. ,   'podhd'  ,     ,    6.3.2.3 ¬´¬ª  :<br>
<br>
<i>       ,   ,  ,          .</i> <br>
<br>
 ¬´lvalue-       ,   ¬ª ( C99,  6.3.2.1 ¬´Lvalue-,    ¬ª):<br>
<br>
<i>lvalue ‚Äî       ,   void; </i> <b><i> lvalue-       ,   .</i></b> <br>
<br>
  :<br>
<br>
  -&gt;    ,    lvalue-,     ,         .<br>
<br>
<h2>  ++</h2> <br>
  ++    .  '&amp;podhd-&gt;line6'      C++   ,  'podhd' ‚Äî  .<br>
<br>
      WG21 (<a href="http://www.viva64.com/go.php%3Furl%3D1484">232. Is indirection through a null pointer undefined behavior?</a>),       .  ,        .           C++,     ¬´poldh-&gt;line6¬ª,  ¬´polhd¬ª ‚Äî  .<br>
<br>
 ¬´polhd¬ª    ( 5.2.5/4,    )  ,      .     C++     nullptr.<br>
<br>
<h2></h2> <br>
<pre><code class="cpp">struct usb_line6 *line6 = &amp;podhd-&gt;line6;</code></pre><br>
        ++,   podhd  0.    0,    .<br>
<br>
,    ,  .     ,  .   ,    ,   .     ,    .<br>
<br>
  .      .<br>
<br>
<h2>  </h2> <br>
<ul>
<li>    <a href="http://www.viva64.com/go.php%3Furl%3D1481">offsetof()</a>  ,          .  ,             offsetof(),   ,         '&amp;podhd-&gt;line6'  , 'podhd'   .</li>
<li>GCC  (  )  ,   ,       ,          ‚Äî      ,     . ,        "<a href="http://www.viva64.com/go.php%3Furl%3D1499">What Every C Programmer Should Know About Undefined Behavior #2/3</a>".</li>
<li>,     ,             TUN/TAP-.      "<a href="http://www.viva64.com/go.php%3Furl%3D1500">Fun with NULL pointers</a>".   ,       ,       :   TUN/TAP-      ,     ,           .      C           .</li>
<li>   - ,   P == nullptr   &amp;P-&gt;m_foo    ? ,       sizeof: sizeof(&amp;P-&gt;m_foo).</li>
</ul> <br>
<h2></h2> <br>
     ,   ,   .         :<ul>
<li><b>  </b> ‚Äî    C/C++       ,     Windows,      .      <a href="http://www.viva64.com/go.php%3Furl%3D1493">StackOverflow</a>,      C  C++ (        C#).  6  Microsoft MVP   Visual C++.</li>
<li><b> '</b> ‚Äî    C++ ()     <a href="http://www.viva64.com/go.php%3Furl%3D1494">StackOverflow</a>.  -        Microsoft (Trustworthy Computing Team).      ,   ,    ‚Äî Malware Bytes  PreEmptive Solutions.</li>
<li><b>  </b> ‚Äî ,     Windows.      C++, OpenGL        .       .   ,      ,   C  C++,   <a href="http://www.viva64.com/go.php%3Furl%3D1495">Microsoft MSDN</a>,     ‚Äî   StackOverflow.  8  Microsoft MVP   Visual C++.</li>
<li><b>   </b> ‚Äî  -  Microsoft.       C++-.         ‚Äî    .  ,    Microsoft,       A&amp;M (Texas A&amp;M University).  2012           (National Science Foundation CAREER Award)               .       C++.</li>
</ul> <br>
<h2> </h2> <br>
<ol>
<li>Wikipedia. <a href="http://www.viva64.com/go.php%3Furl%3D1496"> </a>.</li>
<li>A Guide to Undefined Behavior in C and C++. Part <a href="http://www.viva64.com/go.php%3Furl%3D750">1</a>, <a href="http://www.viva64.com/go.php%3Furl%3D1497">2</a>, <a href="http://www.viva64.com/go.php%3Furl%3D1498">3</a>.</li>
<li>Wikipedia. <a href="http://www.viva64.com/go.php%3Furl%3D1481">offsetof</a>.</li>
<li>LLVM Blog. <a href="http://www.viva64.com/go.php%3Furl%3D1499">What Every C Programmer Should Know About Undefined Behavior #2/3</a>.</li>
<li>LWN. Fun with NULL pointers. Part <a href="http://www.viva64.com/go.php%3Furl%3D1500">1</a>, <a href="http://www.viva64.com/go.php%3Furl%3D1501">2</a>.</li>
</ol></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/250701/">https://habr.com/ru/post/250701/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../250679/index.html">Moscow Django MeetUp Report No. 25</a></li>
<li><a href="../250681/index.html">AdMob 7 for iOS 8</a></li>
<li><a href="../250685/index.html">Buridan's ass and composition configuration</a></li>
<li><a href="../250689/index.html">Make the parallax header in RecyclerView</a></li>
<li><a href="../250699/index.html">The magazine "In Oblaka.RF" looking for talented authors who are well-guided in the clouds</a></li>
<li><a href="../250703/index.html">Creating a mobile game in Construct 2. The path of the inexperienced</a></li>
<li><a href="../250705/index.html">Import Substitution Part 1. Or as I studied Huawei FusionCloud Desktop</a></li>
<li><a href="../250707/index.html">Astra Linux Common Edition 1.10 Review</a></li>
<li><a href="../250709/index.html">Monitoring Methods in DWDM Systems (Part 2)</a></li>
<li><a href="../250711/index.html">Studying the project folder structure in Unity - version control systems</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>