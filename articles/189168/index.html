<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Plugin for webstorm and auto-complement</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I would like to share a simple way to add the missing auto-addition to the IDEA IDE family. In our case, to WebStorm or PhpStrom. 

 We have a require...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Plugin for webstorm and auto-complement</h1><div class="post__text post__text-html js-mediator-article">  I would like to share a simple way to add the missing auto-addition to the IDEA IDE family.  In our case, to WebStorm or PhpStrom. <br><br>  We have a require.js library on the front of our project.  And when working with it, you need to specify the paths to certain files in order to add them depending.  Unfortunately, the paths to these files have to be written by hand or copied in parts. <br>  And I thought that this would need to be corrected, and add auto-complement the path to the files. <br><a name="habracut"></a><br><br>  After that, I began to look for information on how to write plug-ins to Idea and remembered an <a href="http://habrahabr.ru/post/161877/">article</a> about habrayuser <a href="https://habrahabr.ru/users/zenden2k/" class="user_link">zenden2k</a> , in which he told how to make a plugin to resolve links for kohana.  Before reading my article, be sure to read it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Having decided that link resolution is also a very useful feature, I first wrote a plugin for this purpose. <br>  When writing the plug-in, I ran into the problem of the lack of a PSI structure for javascript files in Idea Community Edition, and without this it was not possible to determine the structure of the JS file, which is needed to determine the necessary element for link resolution.  I had to put myself an Idea Ultimate EAP.  In Idea UT, you need to install a plug-in for Javascript, and then in the PSI Viewer (Tools -&gt; View PSI Structure) there will be a choice of PSI structure for Javascript files. <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/7b2/9da/75f/7b29da75f922570a7c62231da4a19349.png" alt="image"><br></div></div><br>  Also due to the fact that since the writing of that article, JetBrains have rolled out openapi for PHP and JS, I have used the binding already to a specific PSI element JSLiteralExpression.  My PsiReferenceContributor began to look like this: <br><div class="spoiler">  <b class="spoiler_title">RequirejsPsiReferenceContributor.java</b> <div class="spoiler_text"><pre><code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> requirejs; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.lang.javascript.psi.JSLiteralExpression; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.patterns.StandardPatterns; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiReferenceContributor; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiReferenceRegistrar; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequirejsPsiReferenceContributor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PsiReferenceContributor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerReferenceProviders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiReferenceRegistrar psiReferenceRegistrar)</span></span></span><span class="hljs-function"> </span></span>{ RequirejsPsiReferenceProvider provider = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequirejsPsiReferenceProvider(); psiReferenceRegistrar.registerReferenceProvider(StandardPatterns.instanceOf(JSLiteralExpression.class), provider); } }</code> </pre> </div></div><br>  As you can see, instead of PsiElement.class, I have already used specifically JSLiteralExpression.class, so that I would not have to handle all the elements in a row. <br>  But in order to be able to use openapi you need to connect it in the plugin project in idea.  To do this, go to the Project Structure, there select Libraries.  Click on + above the central column, select Java and in the file selection window that opens, select the file "/path_to_webstrom/plugins/JavaScriptLanguage/lib/javascript-openapi.jar": <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/cf4/f13/a48/cf4f13a48915a54baa6c49b664a997cc.png" alt="image"></div></div><br>  Then go to Modules, open the Dependencies tab, and there on the vs javascript-openapi we specify Scope as Provided: <br><div class="spoiler">  <b class="spoiler_title">Screenshot</b> <div class="spoiler_text"><img src="https://habrastorage.org/getpro/habr/post_images/6bc/f09/56e/6bcf0956e78921d6ed7ee923df961746.png" alt="image"></div></div><br>  After these manipulations, the IDE will prompt the names of classes and other things that go into openapi for javascript. <br><br>  It was also necessary to change the PsiReferenceProvider, freeing it from reflection, went something like this: <br><div class="spoiler">  <b class="spoiler_title">RequirejsPsiReferenceProvider.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> requirejs; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.ide.util.PropertiesComponent; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.lang.javascript.psi.JSCallExpression; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.project.Project; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.util.TextRange; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.vfs.VirtualFile; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiReference; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiReferenceProvider; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.util.ProcessingContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.annotations.NotNull; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequirejsPsiReferenceProvider</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PsiReferenceProvider</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> PsiReference[] getReferencesByElement(<span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> PsiElement psiElement, <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> ProcessingContext processingContext) { Project project = psiElement.getProject(); PropertiesComponent properties = PropertiesComponent.getInstance(project); String webDirPrefString = properties.getValue(<span class="hljs-string"><span class="hljs-string">"web_dir"</span></span>, <span class="hljs-string"><span class="hljs-string">"webfront/web"</span></span>); VirtualFile webDir = project.getBaseDir().findFileByRelativePath(webDirPrefString); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (webDir == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PsiReference.EMPTY_ARRAY; } <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { String path = psiElement.getText(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (isRequireCall(psiElement)) { PsiReference ref = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequirejsReference(psiElement, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TextRange(<span class="hljs-number"><span class="hljs-number">1</span></span>, path.length() - <span class="hljs-number"><span class="hljs-number">1</span></span>), project, webDir); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PsiReference[] {ref}; } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ignored) {} <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PsiReference[<span class="hljs-number"><span class="hljs-number">0</span></span>]; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isRequireCall</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ PsiElement prevEl = element.getParent(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { prevEl = prevEl.getParent(); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> JSCallExpression) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl.getChildren().length &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (prevEl.getChildren()[<span class="hljs-number"><span class="hljs-number">0</span></span>].getText().toLowerCase().equals(<span class="hljs-string"><span class="hljs-string">"require"</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } } } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (Exception ignored) {} } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre></div></div><br>  Next, you need to implement a method responsible for allowing this link. <br>  And here I had a plug-in associated with very meager information about writing plug-ins to idea.  The fact is that initially I had a desire to start searching for files from directories labeled as ‚ÄúResource Root‚Äù, but alas, I could not find how to get such directories.  Therefore, I decided to take the path to the directory from the settings, for which I implemented the settings page as described in the article <a href="https://habrahabr.ru/users/zenden2k/" class="user_link">zenden2k</a> , so I will not repeat. <br>  After we found out the directory in which we need to search for files along the way, everything was simple.  The VirtualFile class has a findFileByRelativePath method, which accepts a path string as an input, and searches for a file on the given path, and yes, it returns it as an instance of the VirtualFile class.  So it was necessary to take the value of the line from PsiElement, cut out the excess, add the missing and check whether such a file exists.  If it exists, then simply return the reference to it as an instance of PsiElement.  The resolve method looks like this: <br><div class="spoiler">  <b class="spoiler_title">RequirejsReverence.java::resolve ()</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String path = element.getText(); path = path.replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"\""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (path.startsWith(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>)) { path = path.replace(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { path = path.concat(<span class="hljs-string"><span class="hljs-string">".js"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (path.startsWith(<span class="hljs-string"><span class="hljs-string">"./"</span></span>)) { path = path.replaceFirst( <span class="hljs-string"><span class="hljs-string">"."</span></span>, element .getContainingFile() .getVirtualFile() .getParent() .getPath() .replace(webDir.getPath(), <span class="hljs-string"><span class="hljs-string">""</span></span>) ); } VirtualFile targetFile = webDir.findFileByRelativePath(path); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetFile != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PsiManager.getInstance(project).findFile(targetFile); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; }</code> </pre></div></div><br>  By doing this, I received permission from the links and you could start implementing the auto-add-on. <br><br>  In idea, there are two ways to implement an auto-complement.  The first is to implement the PsiReference interface getVariants method, and the second one is to use the CompletionContributor.  I tried both methods, but I didn‚Äôt find any advantages in the CompletionContributor, so I stopped using the first method. <br>  For auto-add-ons, we need to return the list of elements as an array.  This can be an array with strings, LoookupElement or PsiElement. <br>  At the beginning I tried to return the string.  But here I was in for a surprise.  The fact is that the idea line with slashes inserts after the last slash the entire line.  Moreover, if you only output a string with a value after a slash, then idea does not perceive this string as suitable for autocompletion.  This behavior is not entirely clear to me.  And I didn‚Äôt manage to find information on how to make auto-add-ons with slashes or as an option with paths for files. <br>  By this he did his own way. <br>  In order to manage the insertion of a value yourself, you need to implement the InsertHandler interface and perform the necessary actions in the handleInsert method.  And to use it, you need to return not just a string, but a LookupElement, which will contain the InsertHandler we need. <br>  So I extended the LookupElement class like this: <br><div class="spoiler">  <b class="spoiler_title">RequirejsLookupElement.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> requirejs; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.completion.InsertHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.completion.InsertionContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.lookup.LookupElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.annotations.NotNull; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequirejsLookupElement</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LookupElement</span></span></span><span class="hljs-class"> </span></span>{ String path; PsiElement element; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> InsertHandler&lt;LookupElement&gt; insertHandler = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RequirejsLookupElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String path, InsertHandler&lt;LookupElement&gt; insertHandler, PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.path = path; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.insertHandler = insertHandler; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.element = element; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InsertionContext context)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.insertHandler != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.insertHandler.handleInsert(context, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>); } } <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getLookupString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> path; } }</code> </pre> </div></div><br>  The implementation of InsertHandler looks like this: <br><div class="spoiler">  <b class="spoiler_title">RequirejsInsertHandler.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> requirejs; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.completion.InsertHandler; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.completion.InsertionContext; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.lookup.LookupElement; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequirejsInsertHandler</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InsertHandler</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> RequirejsInsertHandler instance = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequirejsInsertHandler(); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InsertionContext insertionContext, LookupElement lookupElement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lookupElement <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> RequirejsLookupElement) { insertionContext.getDocument().replaceString( ((RequirejsLookupElement) lookupElement).element.getTextOffset() + <span class="hljs-number"><span class="hljs-number">1</span></span>, insertionContext.getTailOffset(), ((RequirejsLookupElement) lookupElement).path ); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> RequirejsInsertHandler </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getInstance</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> instance; } }</code> </pre> </div></div><br>  The essence of the handleInsert method is that we take the lookupElement, get the PsiElement for which it was shown and selected, from PsiElement we get its location in the file and replace it with the text from lookupElement.path the entire length of the element.  Of course this is not the best way, but unfortunately I could not find another. <br><br>  After that, I did a search for all matching files, and returned them in the form of a LookupElement array. <br>  Here is the full RequirejsReference listing: <br><div class="spoiler">  <b class="spoiler_title">RequirejsReference.java</b> <div class="spoiler_text"><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> requirejs; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.codeInsight.lookup.LookupElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.project.Project; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.util.TextRange; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.vfs.VirtualFile; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.vfs.newvfs.impl.VirtualDirectoryImpl; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.openapi.vfs.newvfs.impl.VirtualFileImpl; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiElement; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiManager; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.psi.PsiReference; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.intellij.util.IncorrectOperationException; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.annotations.NotNull; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.jetbrains.annotations.Nullable; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.ArrayList; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RequirejsReference</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PsiReference</span></span></span><span class="hljs-class"> </span></span>{ PsiElement element; TextRange textRange; Project project; VirtualFile webDir; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RequirejsReference</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element, TextRange textRange, Project project, VirtualFile webDir)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.element = element; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.textRange = textRange; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.project = project; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.webDir = webDir; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.element; } <span class="hljs-meta"><span class="hljs-meta">@Nullable</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolve</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ String path = element.getText(); path = path.replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"\""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (path.startsWith(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>)) { path = path.replace(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { path = path.concat(<span class="hljs-string"><span class="hljs-string">".js"</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (path.startsWith(<span class="hljs-string"><span class="hljs-string">"./"</span></span>)) { path = path.replaceFirst( <span class="hljs-string"><span class="hljs-string">"."</span></span>, element .getContainingFile() .getVirtualFile() .getParent() .getPath() .replace(webDir.getPath(), <span class="hljs-string"><span class="hljs-string">""</span></span>) ); } VirtualFile targetFile = webDir.findFileByRelativePath(path); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (targetFile != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> PsiManager.getInstance(project).findFile(targetFile); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> getCanonicalText(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSoft</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] getVariants() { ArrayList&lt;String&gt; files = filterFiles(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.element); ArrayList&lt;LookupElement&gt; completionResultSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;LookupElement&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; files.size(); i++) { completionResultSet.add( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequirejsLookupElement( files.get(i), RequirejsInsertHandler.getInstance(), <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.element ) ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> completionResultSet.toArray(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> ArrayList&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllFilesInDirectory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(VirtualFile directory)</span></span></span><span class="hljs-function"> </span></span>{ ArrayList&lt;String&gt; files = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); VirtualFile[] childrens = directory.getChildren(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childrens.length != <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; childrens.length; i++) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childrens[i] <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> VirtualDirectoryImpl) { files.addAll(getAllFilesInDirectory(childrens[i])); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (childrens[i] <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> VirtualFileImpl) { files.add(childrens[i].getPath().replace(webDir.getPath() + <span class="hljs-string"><span class="hljs-string">"/"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> files; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> ArrayList&lt;String&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">filterFiles</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement element)</span></span></span><span class="hljs-function"> </span></span>{ String value = element.getText().replace(<span class="hljs-string"><span class="hljs-string">"'"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"\""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>).replace(<span class="hljs-string"><span class="hljs-string">"IntellijIdeaRulezzz "</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); Boolean tpl = value.startsWith(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>); String valuePath = value.replaceFirst(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>); ArrayList&lt;String&gt; allFiles = getAllFilesInDirectory(webDir); ArrayList&lt;String&gt; trueFiles = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;String&gt;(); String file; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; allFiles.size(); i++) { file = allFiles.get(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.startsWith(valuePath)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tpl &amp;&amp; file.endsWith(<span class="hljs-string"><span class="hljs-string">".html"</span></span>)) { trueFiles.add(<span class="hljs-string"><span class="hljs-string">"tpl!"</span></span> + file); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (file.endsWith(<span class="hljs-string"><span class="hljs-string">".js"</span></span>)) { trueFiles.add(file.replace(<span class="hljs-string"><span class="hljs-string">".js"</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>)); } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> trueFiles; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isReferenceTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PsiElement psiElement)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">bindToElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(@NotNull PsiElement psiElement)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IncorrectOperationException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IncorrectOperationException(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> PsiElement </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleElementRename</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(String s)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> IncorrectOperationException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> IncorrectOperationException(); } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> TextRange </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRangeInElement</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> textRange; } <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getCanonicalText</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> element.getText(); } }</code> </pre> </div></div><br>  I selected the file search method separately, because it is recursive, and I also selected the file filtering method, since templates only need html, and for the rest, js files are needed.  Also, when inserting, templates are inserted with the tpl! Prefix! And js files are inserted without the js extension. <br><br>  <b>UPD</b> : <br>  In the comments, the user <a href="https://habrahabr.ru/users/vistall/" class="user_link">VISTALL</a> , suggested that the creation of the own class of the successor LookupElement was superfluous.  Instead, you can use a LookupElementBuilder, which allows you to specify which insertHandler to use and which PsiElement it refers to. <br>  To use LookupElementBuilder, I modified the RequirejsReference :: getVariants method as follows: <br><div class="spoiler">  <b class="spoiler_title">RequirejsReference :: getVariants</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@NotNull</span></span> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Object[] getVariants() { ArrayList&lt;String&gt; files = filterFiles(element); ArrayList&lt;LookupElement&gt; completionResultSet = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArrayList&lt;LookupElement&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; files.size(); i++) { completionResultSet.add( LookupElementBuilder .create(element, files.get(i)) .withInsertHandler( RequirejsInsertHandler.getInstance() ) ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> completionResultSet.toArray(); }</code> </pre></div></div><br>  In order for the generated LookupElement to know which PsiElement it belongs to, it is enough to call the create method, passing the first parameter to PsiElement, and the second line to use for autocompletion. <br>  I also changed RequirejsInsertHandler :: handleInsert myself so: <br><div class="spoiler">  <b class="spoiler_title">RequirejsInsertHandler :: handleInsert</b> <div class="spoiler_text"><pre> <code class="java hljs"> <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">handleInsert</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(InsertionContext insertionContext, LookupElement lookupElement)</span></span></span><span class="hljs-function"> </span></span>{ insertionContext.getDocument().replaceString( lookupElement.getPsiElement().getTextOffset() + <span class="hljs-number"><span class="hljs-number">1</span></span>, insertionContext.getTailOffset(), lookupElement.getLookupString() ); }</code> </pre></div></div><br>  From it, I removed the check for the lookupElement type and used the methods to get the PsiElement and the replacement string. <br>  After these manipulations, the RequirejsLookupElement class is no longer needed. <br><br>  <b>UPD 2</b> : <br>  The plugin is slightly finished and posted on github: <a href="https://github.com/Fedott/WebStormRequireJsPlugin">github.com/Fedott/WebStormRequireJsPlugin</a> <br>  The same plugin is now available in the jetbrains official repository: <a href="http://plugins.jetbrains.com/plugin/7337">plugins.jetbrains.com/plugin/7337</a> <br>  Wishlist can be sent to write on github or here. <br><br>  That's all. <br>  There are questions or tips on how best to implement, I will be glad to read them. </div><p>Source: <a href="https://habr.com/ru/post/189168/">https://habr.com/ru/post/189168/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../189158/index.html">CloudLinux - divide and conquer</a></li>
<li><a href="../189160/index.html">Quickly create basic vagrant images using veewee</a></li>
<li><a href="../189162/index.html">The story of unsuccessful attempts to introduce open source software in a single state office</a></li>
<li><a href="../189164/index.html">The turning point in the fight against the regime of copyright monopoly is much closer than it seems</a></li>
<li><a href="../189166/index.html">Future digital photography</a></li>
<li><a href="../189170/index.html">Change the appearance of the widget "User Ribbon"</a></li>
<li><a href="../189172/index.html">Video of the first lecture of the IT-workshop: Supercomputers. Internal architecture of enterprise level systems</a></li>
<li><a href="../189174/index.html">I looked around to see if she looked around ... or the story of how I was my provider in the early 2000s</a></li>
<li><a href="../189180/index.html">Programmer's Mortal Sins</a></li>
<li><a href="../189188/index.html">Stand or not stand: decide with 2GIS</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>