<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Meet aspect-oriented programming in PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When developing software, programmers and architects use decomposition - the representation of objects and the relationships between them in the form ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Meet aspect-oriented programming in PHP</h1><div class="post__text post__text-html js-mediator-article">  When developing software, programmers and architects use decomposition - the representation of objects and the relationships between them in the form of classes, objects, their properties and methods. <br><img src="https://habrastorage.org/storage2/711/f84/fa1/711f84fa1ad34582d57349d8ed8b6c66.jpg" align="right"><br><br>  By decomposing, it is possible to obtain a more accurate representation of objects from real life in the form of program code.  Thanks to this principle, object-oriented programming has gained such wide popularity in all programming languages.  The model for representing real-life objects as instances of classes is very convenient: we can endow a class with a set of methods and properties, allowing us to interact with the environment. <br><a name="habracut"></a><br><h5>  But is everything so convenient? </h5><br><br>  The OOP model allows answering the following questions: what or who (object), what type (class), what is similar (inheritance), what is common (abstraction), what it can do (methods), what attributes it has (properties of an object or class) , what functionality implements (interfaces).  Here is a sample list of questions to which we constantly give answers in the form of our code.  The answers to these questions cover <u>almost</u> all the properties and phenomena that occur with objects in real life. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Why practically everything? </h5><br><br>  In real life, there are a lot of nuances in the interaction of objects that are difficult to imagine in the OOP: the order of execution of interrelated actions for different objects, the temporary logic of phenomena, the need to perform additional actions when performing a particular action with an object.  In life, this is described in the form of tips and recommendations: ‚Äúwash your hands before eating‚Äù, ‚Äúbrush your teeth after eating‚Äù, ‚Äúbefore leaving the house - turn off the light‚Äù and others.  These actions are not easy to describe using methods: you need to use different decorators for the classes, or explicitly introduce the logic of interaction into the object method itself.  In both cases, these rules cannot be conveniently formalized in the form of code using standard tools - and this leads to a complication of the system and to a closer connection of components. <br><br><h5>  How can this problem be solved? </h5><br><br>  The solution to this problem was invented long ago - to supplement the existing OOP model with some extension that will allow describing such interactions formally.  The study was conducted by a team of engineers Xerox PARC, as a result of which they proposed a new paradigm - aspect-oriented programming.  The essence of the idea is simple - let the program look at itself ‚Äúfrom the side‚Äù using the reflection mechanism and, if necessary, change the final code.  Having the ability to change the final code, AOP has unlimited access to creating hooks anywhere in the code and to extending this code with the help of tips. <br><br>  In order to describe this behavior, the following terms have been proposed: <br><br>  1. Advice - advice.  This is the action to be performed.  For approval of "washing hands before eating," advice will be "wash your hands."  As you can see, the councils describe quite real actions from the real world, which means that they can be represented as methods, anonymous functions and closures.  Each council knows exactly where it belongs, so almost all information about the action is available. <br><br>  2. Joinpoint - the point of implementation.  This term defines a specific place in the program code to which a tip can be added.  In AspectJ, which is the primary source of AOP, a large number of implementation points are available: accessing a method, executing a method, initializing a class, creating a new object, accessing an object property.  Go Library  can work with calls of public and protected methods, both dynamic and static, including in the final classes and traits;  interception of protected and public properties from the object is supported.  For example, the introduction point for ‚Äúwashing hands before eating‚Äù is ‚Äúthe beginning of food‚Äù, or, in OOP terms, performing the ‚Äúeat‚Äù method of the ‚Äúperson‚Äù class. <br><br>  3. Pointcut - cut-in points.  A slice specifies a set of embedding points at which to apply the tip.  In the world, AOP is an analogue of SELECT from SQL.  The syntax for specifying the cutoff points can be different, as is the implementation itself, but as a rule, these are filters that receive a set of embedding points at the input, from which only suitable ones should be selected.  In the Go! Library  Annotations are mainly used for defining slices, but in the future there will be support for xml, yaml and using code.  The cut of points may look like this: all public methods in a class, all static methods with the name * init (), all methods with a specific annotation, etc. <br><br>  In addition to the signature itself, the slice also defines a relative place for the introduction of the board: before, after, around the point of introduction.  For our case of hand washing, the cut point of the points will determine the single point of implementation: ‚Äúbefore performing the method man-&gt; eat ()‚Äù.  If we want to achieve perfect cleanliness, then we can determine the point of implementation ‚Äúbefore performing the methods man -&gt; * ()‚Äù, which will allow us to indicate our desire to always wash our hands before any action.  However, an attentive reader may realize that the method ‚Äúman-&gt; wash Hands ()‚Äù also falls under this slice.  What it threatens and how to avoid it - will remain for self-study, to whet interest. <br><br>  4. Aspect - the basic unit within AOP, which allows you to put together the cuts of the points with the tips that you need to apply.  Since our case relates to a healthy lifestyle, we can call it HealthyLiveAspect and bring in our section and some tips: wash your hands before eating and brush your teeth after eating.  Let's make a list of what we have at the moment.  We have a ‚Äúperson‚Äù class with understandable methods, there is no additional logic in them that would mix with the main method code.  We have a separate aspect class with the necessary advice.  It remains to do just a little - to combine them into one whole and get the ready code.  This process is called interweaving. <br><br>  5. Weaving - the process of interweaving the tips code into the source code.  This mechanism parses the source code using reflection and applies tips at the point of implementation.  Go Library  uses the PHP-unique technology Load-Time Weaving, which allows you to track the moment of loading the class and change this code before it is parsed by the PHP parser.  This makes it possible to dynamically change the class code, without changes in the source code by the developers.  It all works as follows: at the beginning of the program, we initialize the core of AOP, adding our aspects there, then transfer control to the main program.  When creating a human object, an automatic loading of the class will work, which will determine the desired file name and try to load it.  At this point, the call will be intercepted by the kernel, then a static code analysis and verification of the current aspects will be performed.  The kernel will find that there is a class ‚Äúperson‚Äù in the code and that you need to embed tips into this class, so code transformers in the kernel will change the original class name, create a proxy class with the original class name and redefine the ‚Äúeat‚Äù method, and send a list of tips for given point.  Next, the PHP parser parses this code and loads it into memory, while the decorator class will already be located by the name of the source class, so the usual call to the ‚Äúeat‚Äù method will be wrapped in the connection point with the connected tips. <br><br><h5>  Better to see once than hear a hundred times. </h5><br><br>  Let's describe everything that we discussed with the code.  We realize first of all a class of a rational person who will be able to eat, sleep, work, as well as wash hands and brush teeth.  We will not do the __clone method yet :) <br><br><pre><code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Human class example */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span></span>{     <span class="hljs-comment"><span class="hljs-comment">/** * Eat something */</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">     </span></span>{         <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Eating..."</span></span>, PHP_EOL;     }     <span class="hljs-comment"><span class="hljs-comment">/** * Clean the teeth */</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanTeeth</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">     </span></span>{         <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Cleaning teeth..."</span></span>, PHP_EOL;     }     <span class="hljs-comment"><span class="hljs-comment">/** * Washing up */</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">washUp</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">     </span></span>{         <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Washing up..."</span></span>, PHP_EOL;     }     <span class="hljs-comment"><span class="hljs-comment">/** * Working */</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">work</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">     </span></span>{         <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Working..."</span></span>, PHP_EOL;     }     <span class="hljs-comment"><span class="hljs-comment">/** * Go to sleep */</span></span>     <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">     </span></span>{         <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Go to sleep..."</span></span>, PHP_EOL;     } }</code> </pre> <br><br>  At the moment, everything is written in Feng Shui: each method deals only with its work, there is nothing superfluous in the methods.  But we do not have the logic of washing hands before eating, as well as brushing teeth after eating and before sleeping: <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Human class example */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Human</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-comment"><span class="hljs-comment">/** * Eat something */</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">eat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">    </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;washUp();        <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Eating..."</span></span>, PHP_EOL; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;cleanTeeth();    } <span class="hljs-comment"><span class="hljs-comment">// ....    /** * Go to sleep */    public function sleep()    { $this-&gt;cleanTeeth();        echo "Go to sleep...", PHP_EOL;    } }</span></span></code> </pre><br><br>  A typical programmer without any hesitation will do as above: he will invoke the necessary methods in the code of the ‚Äúeat‚Äù and ‚Äúsleep‚Äù methods, violating the principle of the sole responsibility of each of these methods.  Fortunately, the conditions are simple, you can understand why it was done here.  In real life, everything is much sadder: how often do you come across code that does different things in one place and there is no hint that this piece of code should be here?  This is the most famous metric: WTF / line of code.  I think everyone has such examples in the code). <br><br>  The next category of programmers feels the trick is that they need to change the logic of the method and they go to the other extreme: they make new methods in the classroom that combine the logic of several methods.  Are you familiar with the methods of ‚Äúwashing Hands And Eat ()‚Äù? <br><br>  On the one hand, the main methods will no longer contain this logic, but our class will begin to swell, it will be possible to call the ‚Äúeat ()‚Äù method directly, the class interface will be swamped with unnecessary methods and the number of errors in the code will start to grow.  Again, not an option. <br><br>  I have already considered other options in my article on <a href="http://habrahabr.ru/post/165329/">refactoring with AOP</a> , so I‚Äôll go straight to AOP. <br><br><h5>  Aspect-oriented approach </h5><br><br>  Probably, you already understood that AOP allows you to divide into logical blocks something that cannot be done using OOP.  However, this technique is quite complex, so AOP is designed primarily for those who have comprehended all the subtleties of the object-oriented paradigm and want to discover something new for themselves. <br><br>  The founder of aspect-oriented programming (AOP), Gregor Kikzales, in <a href="http://www.pcweek.ru/themes/detail.php%3FID%3D105538">an interview</a> shared his vision of the essence of AOP: "... AOP is essentially the next stage in the development of structuring mechanisms. Today it is clear that objects do not replace procedures, but are only a way of creating a higher level structuring mechanism And aspects also do not replace objects; they only provide another kind of structuring. " <br><br>  Let's try to describe our case from the perspective of an aspect-oriented paradigm.  To do this, take the ‚Äúclean‚Äù class of the ‚Äúperson‚Äù with our ‚Äúclean‚Äù methods and describe the tips for the necessary methods using the aspect class: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Aspect</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Aop</span></span>\<span class="hljs-title"><span class="hljs-title">Aspect</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Aop</span></span>\<span class="hljs-title"><span class="hljs-title">Intercept</span></span>\<span class="hljs-title"><span class="hljs-title">MethodInvocation</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">After</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Before</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Around</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Lang</span></span>\<span class="hljs-title"><span class="hljs-title">Annotation</span></span>\<span class="hljs-title"><span class="hljs-title">Pointcut</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Healthy live aspect */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">HealthyLiveAspect</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Aspect</span></span></span><span class="hljs-class"> </span></span>{    <span class="hljs-comment"><span class="hljs-comment">/** * Pointcut for eat method * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Pointcut</span></span></span><span class="hljs-comment">("execution(public Human-&gt;eat(*))") */</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">humanEat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{}    <span class="hljs-comment"><span class="hljs-comment">/** * Method that recommends to wash up before eating * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> MethodInvocation $invocation Invocation * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Before</span></span></span><span class="hljs-comment">(pointcut="humanEat()") // Short pointcut name */</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">washUpBeforeEat</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodInvocation $invocation)</span></span></span><span class="hljs-function">    </span></span>{        <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $person \Human */</span></span>        $person = $invocation-&gt;getThis();        $person-&gt;washUp();    }    <span class="hljs-comment"><span class="hljs-comment">/** * Method that recommends to clean teeth after eating * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> MethodInvocation $invocation Invocation * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@After</span></span></span><span class="hljs-comment">(pointcut="Aspect\HealthyLiveAspect-&gt;humanEat()") // Full-qualified pointcut name */</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanTeethAfterEating</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodInvocation $invocation)</span></span></span><span class="hljs-function">    </span></span>{        <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $person \Human */</span></span>        $person = $invocation-&gt;getThis();        $person-&gt;cleanTeeth();    }    <span class="hljs-comment"><span class="hljs-comment">/** * Method that recommends to clean teeth before going to sleep * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> MethodInvocation $invocation Invocation * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@Before</span></span></span><span class="hljs-comment">("execution(public Human-&gt;sleep())") */</span></span>    <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">cleanTeethBeforeSleep</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MethodInvocation $invocation)</span></span></span><span class="hljs-function">    </span></span>{        <span class="hljs-comment"><span class="hljs-comment">/** </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span><span class="hljs-comment"> $person \Human */</span></span>        $person = $invocation-&gt;getThis();        $person-&gt;cleanTeeth();    } }</code> </pre><br><br>  I think this code is quite understandable in itself, but it is better to add some comments. <br><br>  First, we defined a cut of points ‚Äî the empty <code>humanEat()</code> method, marked with the special <code>@Pointcut("execution(public Human-&gt;eat(*))")</code> annotation <code>@Pointcut("execution(public Human-&gt;eat(*))")</code> .  In principle, it was possible not to create a separate slice, but to indicate it before each council separately, but since we have several tips for this slice, we can take it to a separate definition.  The method itself and its code are not used in the definition of the slice and serve only to specify and identify the slice in the aspect itself. <br><br>  Secondly, we described the councils themselves in the form of aspect methods, specifying with the help of the <code>@Before</code> and <code>@After</code> specific place of implementation for the slice.  You can immediately specify the sections in the annotation, as is done in the <code>cleanTeethBeforeSleep</code> method: <code>@Before("execution(public Human-&gt;sleep())")</code> .  Each advice receives as input the necessary information about the execution point due to the <code>MethodInvocation</code> object containing the callee (class for the static method), the arguments of the method being called, as well as information about the point in the program (method reflection).  Similar information can be obtained to refer to the properties of objects. <br><br>  Now run our code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($_GET[<span class="hljs-string"><span class="hljs-string">'original'</span></span>]) ? <span class="hljs-string"><span class="hljs-string">'./autoload.php'</span></span> : <span class="hljs-string"><span class="hljs-string">'./autoload_aspect.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Test case with human $man = new Human(); echo "Want to eat something, let's have a breakfast!", PHP_EOL; $man-&gt;eat(); echo "I should work to earn some money", PHP_EOL; $man-&gt;work(); echo "It was a nice day, go to bed", PHP_EOL; $man-&gt;sleep();</span></span></code> </pre><br><br>  If we run this code in a browser, we can see the following output: <br><br><pre> <code class="html hljs xml">Want to eat something, let's have a breakfast! Washing up... Eating... Cleaning teeth... I should work to earn some money Working... It was a nice day, go to bed Cleaning teeth... Go to sleep...</code> </pre><br><br>  For those interested in other files: <br><div class="spoiler">  <b class="spoiler_title">autoload.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">/** * Show all errors in code */</span></span> ini_set(<span class="hljs-string"><span class="hljs-string">'display_errors'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); <span class="hljs-comment"><span class="hljs-comment">/** * Register PSR-0 autoloader for our code, any components can be used here */</span></span> spl_autoload_register(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($originalClassName)</span></span></span><span class="hljs-function"> </span></span>{ $className = ltrim($originalClassName, <span class="hljs-string"><span class="hljs-string">'\\'</span></span>); $fileName = <span class="hljs-string"><span class="hljs-string">''</span></span>; $namespace = <span class="hljs-string"><span class="hljs-string">''</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($lastNsPos = strripos($className, <span class="hljs-string"><span class="hljs-string">'\\'</span></span>)) { $namespace = substr($className, <span class="hljs-number"><span class="hljs-number">0</span></span>, $lastNsPos); $className = substr($className, $lastNsPos + <span class="hljs-number"><span class="hljs-number">1</span></span>); $fileName = str_replace(<span class="hljs-string"><span class="hljs-string">'\\'</span></span>, DIRECTORY_SEPARATOR, $namespace) . DIRECTORY_SEPARATOR; } $fileName .= str_replace(<span class="hljs-string"><span class="hljs-string">'_'</span></span>, DIRECTORY_SEPARATOR, $className) . <span class="hljs-string"><span class="hljs-string">'.php'</span></span>; $resolvedFileName = stream_resolve_include_path($fileName); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($resolvedFileName) { <span class="hljs-keyword"><span class="hljs-keyword">require_once</span></span> $resolvedFileName; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (bool) $resolvedFileName; }); ob_start(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($content)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> str_replace(PHP_EOL, <span class="hljs-string"><span class="hljs-string">"&lt;br&gt;"</span></span> . PHP_EOL, $content); });</code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">autoload_aspect.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'../src/Go/Core/AspectKernel.php'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">include</span></span> <span class="hljs-string"><span class="hljs-string">'DemoAspectKernel.php'</span></span>; <span class="hljs-comment"><span class="hljs-comment">// Initialize demo aspect container DemoAspectKernel::getInstance()-&gt;init(array( // Configuration for autoload namespaces 'autoload' =&gt; array( 'Go' =&gt; realpath(__DIR__ . '/../src'), 'TokenReflection' =&gt; realpath(__DIR__ . '/../vendor/andrewsville/php-token-reflection/'), 'Doctrine\\Common' =&gt; realpath(__DIR__ . '/../vendor/doctrine/common/lib/') ), // Default application directory 'appDir' =&gt; __DIR__ . '/../demos', // Cache directory for Go! generated classes 'cacheDir' =&gt; __DIR__ . '/cache', // Include paths for aspect weaving 'includePaths' =&gt; array(), 'debug' =&gt; true ));</span></span></code> </pre><br></div></div><div class="spoiler">  <b class="spoiler_title">DemoAspectKernel.php</b> <div class="spoiler_text"><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Aspect</span></span>\<span class="hljs-title"><span class="hljs-title">HealthyLiveAspect</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">AspectKernel</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> <span class="hljs-title"><span class="hljs-title">Go</span></span>\<span class="hljs-title"><span class="hljs-title">Core</span></span>\<span class="hljs-title"><span class="hljs-title">AspectContainer</span></span>; <span class="hljs-comment"><span class="hljs-comment">/** * Demo Aspect Kernel class */</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DemoAspectKernel</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AspectKernel</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">/** * Returns the path to the application autoloader file, typical autoload.php * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> string */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getApplicationLoaderPath</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/autoload.php'</span></span>; } <span class="hljs-comment"><span class="hljs-comment">/** * Configure an AspectContainer with advisors, aspects and pointcuts * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> AspectContainer $container * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span><span class="hljs-comment"> void */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureAop</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(AspectContainer $container)</span></span></span><span class="hljs-function"> </span></span>{ $container-&gt;registerAspect(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HealthyLiveAspect()); } }</code> </pre><br></div></div><br><br>  What have we got?  Firstly, the logic of the methods themselves in the class of "person" does not contain any garbage.  Already excellent, because they will be easier to maintain.  Secondly, there are no methods that duplicate the main functionality of the class methods.  Thirdly, the logic is presented in the form of understandable tips in the aspect, because the tips have real meaning, which means that we have just made a decomposition in functionality and made our application more structured!  Moreover, the aspect class itself describes an understandable goal ‚Äî a healthy lifestyle.  Now everything is in its place and we can easily change both the additional logic and work with the pure logic of the methods themselves. <br><br>  I hope this simple example will help you better understand the concept of the aspect paradigm and try your hand at describing the aspect of the processes in the real world.  For those interested - this example is available in the source code of the library in the folder demos / life.php, you can run it and study it) <br><br>  References: <br><ol><li>  Official site <a href="http://go.aopphp.com/">http://go.aopphp.com</a> </li><li>  Source code <a href="https://github.com/lisachenko/go-aop-php">https://github.com/lisachenko/go-aop-php</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/170021/">https://habr.com/ru/post/170021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../170005/index.html">Buying hosting in China: why you need it and how difficult it is</a></li>
<li><a href="../170007/index.html">Euphoria in the cryptocurrency market</a></li>
<li><a href="../170009/index.html">Useful tips on working with Meteor</a></li>
<li><a href="../170015/index.html">How to connect a third-party browser in a C # application</a></li>
<li><a href="../170019/index.html">Programming template "Flowing Interface" in PHP. A fresh look</a></li>
<li><a href="../170025/index.html">Copyright and Donations</a></li>
<li><a href="../170027/index.html">Yandex shares collapsed by 10% after the publication of the annual report</a></li>
<li><a href="../170039/index.html">Work with Arduino</a></li>
<li><a href="../170043/index.html">Oracle has released another batch of updates for Java</a></li>
<li><a href="../170045/index.html">Visualize the development of a PostgreSQL database.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>