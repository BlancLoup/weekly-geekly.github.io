<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ScadaPy JSON server</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In continuation of the previous articles on the use of python to build your own scada system, I would like to describe the method of organizing the ex...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ScadaPy JSON server</h1><div class="post__text post__text-html js-mediator-article">  In continuation of the previous articles on the use of python to build your own scada system, I would like to describe the method of organizing the exchange between devices and data output through json - a text format for exchanging data. <br><br>  In this case, we will use the client parts of the <i>modbusTCP</i> and <i>OPCUA</i> libraries. <a name="habracut"></a><br>  As a result, we will have an <i>http</i> server that acts as a <i>master</i> for the slave devices, which in turn work in the <i>slave</i> mode. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9da/1cc/fc7/9da1ccfc7ee77aed36c14f486016e41c.png" alt="image">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Modbus master </h2><br>  To configure the <i>modbus TCP</i> wizard, import the necessary libraries: <br><br><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.defines <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> cst <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> modbus_tk.modbus_tcp <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> modbus_tcp</code> </pre> <br>  It is necessary to perform the initialization of the wizard with the indication of the ip address and port, as well as <i>timeout</i> waiting for a response: <br><br><pre> <code class="python hljs">master = modbus_tcp.TcpMaster(host=<span class="hljs-string"><span class="hljs-string">'127.0.0.1'</span></span>, port=<span class="hljs-number"><span class="hljs-number">502</span></span>) master.set_timeout(<span class="hljs-number"><span class="hljs-number">2</span></span>)</code> </pre> <br>  We describe the cyclic function of polling <i>slave</i> devices, with the names of registers and cell addresses: <cut></cut><br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getModbus</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">True</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: data= master.execute(rtu, cst.READ_INPUT_REGISTERS,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: <span class="hljs-keyword"><span class="hljs-keyword">print</span></span> (e) time.sleep(<span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-comment"><span class="hljs-comment">#rtu ‚Äì  RTU modbus # cst.READ_INPUT_REGISTERS ‚Äì  ,       : #cst.READ_INPUT_REGISTERS #cst.READ_DISCRETE_INPUTS #cst.READ_COILS #cst.READ_HOLDING_REGISTERS</span></span></code> </pre><br>  Now you need to run the poll loop in a separate thread <i>thread</i> : <br><br><pre> <code class="python hljs">modb = threading.Thread(target=getModbus) modb.daemon = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> modb.start()</code> </pre><br>  As a result, a cyclic polling of the slave device will be launched using the <i>modbusTCP</i> protocol with the <i>IP address</i> 127.0.0.1 and port 502. The READ_INPUT_REGISTERS register will be <i>read</i> and the value located at the <i>0x00</i> address will be written to the <i>data</i> variable. <br><br><h2>  OPCUA client </h2><br>  To receive data from the <i>OPCUA</i> server, you must connect the library <i>freeopcua</i> <br><br><pre> <code class="python hljs"> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> opcua <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ua, Client</code> </pre>  and create a new client connection: <br><br><pre> <code class="python hljs">url=<span class="hljs-string"><span class="hljs-string">"opc.tcp://127.0.0.1:4840/server/"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: client = Client(url) client.connect() root = client.get_root_node() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(e)</code> </pre> <br>  In OPC servers there is a strict hierarchy of inheritance, there is an exact definition of <i>parent</i> and <i>child</i> , so you can build quite complex systems with a large number of nested objects.  But we, in this case, did not need such a number of functions today, so we limited ourselves to creating a node in the root <i>Objects</i> folder and assigning it a value.  It came out roughly like <i>Objects -&gt; MyNode -&gt; MyNodeValue</i> , but I must admit that this method is not acceptable for building more complex systems. <br><br><pre> <code class="python hljs">obj = root.get_child([<span class="hljs-string"><span class="hljs-string">"0:Objects"</span></span>]) objChild= obj.get_children() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,len(objChild)): unitsChild.append(i) unitsChild[i]=objChild[i].get_children() parName=val_to_string(objChild[i].get_browse_name())[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, len( unitsChild[i] ) ): valName=val_to_string(unitsChild[i][a].get_browse_name())[<span class="hljs-number"><span class="hljs-number">2</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: valData=unitsChild[i][a].get_value() data =unitsChild[i][a].get_data_value() st=val_to_string(data.StatusCode) ts= data.ServerTimestamp.isoformat() tsc= data.SourceTimestamp.isoformat() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(e)</code> </pre> <br>  The variable value itself can be seen in <i>valData</i> , the <i>StatusCode</i> is written to <i>st</i> , the <i>ts and tsc are</i> recorded with the <i>ServerTimestamp</i> and <i>SourceTimestamp timestamps,</i> respectively. <br><br>  To poll the slave devices, cyclic polling is also used, running in a separate thread, although it was more correct to subscribe to the event. <br><br><h2>  Json Web Server </h2><br>  To create a web server, you need libraries: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> http.server <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPRequestHandler, HTTPServer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> json <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> base64</code> </pre>  The server itself is easy to start, just two commands, there are a large number of descriptions and examples on the network. <br><br><pre> <code class="python hljs">server_address = (‚Äú<span class="hljs-number"><span class="hljs-number">127.0</span></span><span class="hljs-number"><span class="hljs-number">.0</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>‚Äù, <span class="hljs-number"><span class="hljs-number">8080</span></span>) httpd = server_class(server_address, handler_class) <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: httpd.serve_forever() <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(e) httpd.server_close()</code> </pre> <br>  The most interesting thing started later, when for testing it became necessary to connect from the Chrome or Firefox browser to the created server. <br><br>  Constantly popped <i>refuse_connect</i> . <br><br>  A little search on the network, we found a solution - you need to add to the do_GET function: <br><br><pre> <code class="python hljs">self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'*'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>)</code> </pre><br>  Now I managed to get access to a working web server, but with open access, but I would like to establish some kind of authorization, access by login and password. <br>  As it turned out, it is not particularly difficult to do using headers. <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_GET</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">global</span></span> key <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> self.headers.get(<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>) == <span class="hljs-keyword"><span class="hljs-keyword">None</span></span>: self.do_AUTHHEAD() response = { <span class="hljs-string"><span class="hljs-string">'success'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'error'</span></span>: <span class="hljs-string"><span class="hljs-string">'No auth header received'</span></span>} self.wfile.write(bytes(json.dumps(response), <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> self.headers.get(<span class="hljs-string"><span class="hljs-string">'Authorization'</span></span>) == <span class="hljs-string"><span class="hljs-string">'Basic '</span></span> + str(key): resp=[] self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Allow'</span></span>, <span class="hljs-string"><span class="hljs-string">'GET, OPTIONS'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">"Cache-Control"</span></span>, <span class="hljs-string"><span class="hljs-string">"no-cache"</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>,<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'null'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>, <span class="hljs-string"><span class="hljs-string">'GET, OPTIONS'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-Request, X-Requested-With'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Headers"</span></span>, <span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>) self.end_headers() req=str(self.path)[<span class="hljs-number"><span class="hljs-number">1</span></span>:] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(req == <span class="hljs-string"><span class="hljs-string">"all"</span></span> ): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,units): resp.append({varName[i]:[reg[i],varNameData[i]]}) i+=<span class="hljs-number"><span class="hljs-number">1</span></span> self.wfile.write(json.dumps( resp ).encode()) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(<span class="hljs-string"><span class="hljs-string">'all'</span></span>,e) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>,units): <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(req == varName[i] ): <span class="hljs-keyword"><span class="hljs-keyword">try</span></span>: resp =json.dumps({ varName[i]:varNameData[i] } ) self.wfile.write(resp.encode()) <span class="hljs-keyword"><span class="hljs-keyword">except</span></span> Exception <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> e: print(e) i+=<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>: self.do_AUTHHEAD() response = { <span class="hljs-string"><span class="hljs-string">'success'</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">False</span></span>, <span class="hljs-string"><span class="hljs-string">'error'</span></span>: <span class="hljs-string"><span class="hljs-string">'Invalid credentials'</span></span>} self.wfile.write(bytes(json.dumps(response), <span class="hljs-string"><span class="hljs-string">'utf-8'</span></span>))</code> </pre> <br></div></div><br>  If you now try to connect using a browser, then authorization is performed and data is transmitted, but getting data from a browser without a parser is not a good idea, we assumed to get data using the GET method using JavaScrypt and the XMLHttpRequest () function using the script in the html page.  But with this implementation, the browser first sends the request not by the GET method, but by the OPTIONS method and must receive a response = 200, only after that the request will be executed by the GET method. <br><br>  Added another function: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">do_OPTIONS</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> self.send_response(<span class="hljs-number"><span class="hljs-number">200</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Credentials'</span></span>, <span class="hljs-string"><span class="hljs-string">'true'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Origin'</span></span>, <span class="hljs-string"><span class="hljs-string">'null'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Methods'</span></span>, <span class="hljs-string"><span class="hljs-string">'GET,OPTIONS'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Access-Control-Allow-Headers'</span></span>, <span class="hljs-string"><span class="hljs-string">'X-Request, X-Requested-With'</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">"Access-Control-Allow-Headers"</span></span>, <span class="hljs-string"><span class="hljs-string">"origin, Authorization, accept"</span></span>) self.send_header(<span class="hljs-string"><span class="hljs-string">'Content-type'</span></span>,<span class="hljs-string"><span class="hljs-string">'application/json'</span></span>) self.end_headers()</code> </pre> <br>  When this function is enabled, the check will be performed via <i>'Access-Control-Allow-Origin'</i> and, if it is not set to <i>'null'</i> , there will be no exchange. <br><br>  Now we have access by login and password, the browser will exchange data according to the script, but it is desirable to organize SSL data encryption.  To do this, create an SSL certificate file and add the following line before starting the server: <br><br><pre> <code class="python hljs">httpd.socket = ssl.wrap_socket (httpd.socket, certfile=pathFolder+<span class="hljs-string"><span class="hljs-string">'json_server.pem'</span></span>,ssl_version=ssl.PROTOCOL_TLSv1, server_side=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br>  Of course, this is a self-signed certificate, but in any case it is better than an open protocol. <br><br>  To process the data in the script on the html page, you can use the above function XMLHttpRequest (): <br><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="javascript hljs">xmlhttp=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); xmlhttp.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>,<span class="hljs-string"><span class="hljs-string">"http://192.168.0.103:8080/all"</span></span>,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); xmlhttp.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, <span class="hljs-string"><span class="hljs-string">"Basic "</span></span> + btoa(login+<span class="hljs-string"><span class="hljs-string">":"</span></span>+password)); xmlhttp.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xmlhttp.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xmlhttp.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlhttp.readyState==<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; xmlhttp.status==<span class="hljs-number"><span class="hljs-number">200</span></span>) { resp= xmlhttp.responseText; parseResp=<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(resp); } }</code> </pre></div></div><br><cut></cut><br><h2>  JSON configurator description </h2><br>  Below is a rough description of configuring the configurator to run scripts. <br><br>  The appearance of the window and the appointment of control buttons: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/0aa/bd4/351/0aabd435156345ca8690f69f7c03c852.png" alt="image"><br><br>  Suppose the task is to receive data from a temperature sensor with parameters: <br>  <b>Protocol:</b> modbusTCP <br>  <b>IP Address:</b> 192.168.0.103 <br>  <b>Port:</b> 502 <br>  <b>RTU:</b> 1 <br>  <b>Register:</b> READ_INPUT_REGISTERS (0x04) <br>  <b>Address:</b> 0 <br>  <b>Variable name:</b> tempSensor_1 <br>  Print this data on the json server: <br>  <b>Format:</b> json <br>  <b>IP Address:</b> 192.168.0.103 <br>  <b>Port:</b> 8080 <br>  <b>Login:</b> 111 <br>  <b>Password:</b> 222 <br><br>  Run <b>json.py</b> , add a new server button (+) at the top left, specify the name and save. <br><br>  Now, you need to arrange the created <i>instance</i> and enter the parameters of the web server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c34/d8c/dbe/c34d8cdbeacd5e48259ee1362d964980.png" alt="image"><br><br>  We write down the parameters for polling the slave, in this case the temperature sensor: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/05d/62d/0d9/05d62d0d927b448aabc395d9be73b855.png" alt="image"><br><br>  After that, when you click the save script button, a file called <i>web_ (our server number in the database) .bat</i> for Windows or <i>web_ (our server number in the database) .sh</i> for Linux appears in the <b>scr</b> folder.  The path to the script will be written in this file. <br><br>  In this case, the example for Windows is the <i>web_15.bat</i> file: <br><br> <code>rem     'ScadaPy Web JSON  v.3.14' <br> rem  Web '  ' <br> rem Http  '192.168.0.103' <br> rem Http  '8080' <br> start c:\Python35\python.exe F:\scadapy\main\source\websrv.py 15 F:\scadapy\main\db\webDb.db <br></code> <br>  You can launch the script immediately for execution by clicking the button located next to the save button (all buttons are provided with tooltips). <br><br>  After launch, a console window will appear with information about startup and connections. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/921/f10/c62/921f10c62d78109ea908d039ea9342b3.png" alt="image"><br><br>  Now, having started the browser, we write the connection string <i>_https: //192.168.0.103: 8080 / all</i> , and after entering the password we see the following in Chrome: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f81/7ae/7ef/f817ae7efcd58e8251e81d6738596c10.png" alt="image"><br><br>  Or in Firefox: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65e/fc3/4f0/65efc34f0a58b30bb8275d69c71bc622.png" alt="image"><br><br>  And in the console of the running server information about connection sessions will be displayed: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/272/297/6f8/2722976f8c4ee8619f0b41f243281838.png" alt="image"><br><br>  In this case, we get data on all variables configured on the server, because in the <b>GET</b> request we entered the parameter <b>all</b> .  This is not entirely correct, since increasing the number of variables will have to receive and process data that is not currently being used, so it‚Äôs better to enter the immediate name of the variable whose value you want to process: <b>tempSensor_1</b> . <br><br>  In this case: <br>  Request - <i>tempSensor_1</i> <br>  The answer is <i>{"tempSensor_1": [2384]}</i> <br><br><h2>  JavaScript processing </h2><br>  I want to describe a little how to embed the formation of the request and the processing of the response in the html page. <br><br>  You can use the <i>XMLHttpRequest ()</i> function to execute a request, although there are currently other ways to connect.  Upon successful connection and getting the status equal to 200, it is enough to execute the <i>JSON.parse ()</i> function. <br>  To establish the cyclical nature of the query, you must start a timer. <br><br><div class="spoiler">  <b class="spoiler_title">Example.</b> <div class="spoiler_text"><pre> <code class="javascript hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getTemp</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dataReq=<span class="hljs-string"><span class="hljs-string">'tempSensor_1'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> login=<span class="hljs-string"><span class="hljs-string">'111'</span></span>, passw=<span class="hljs-string"><span class="hljs-string">'222'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> ip=<span class="hljs-string"><span class="hljs-string">'192.168.0.103'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> port=<span class="hljs-string"><span class="hljs-string">'8080'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.XMLHttpRequest) { xmlhttp=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { xmlhttp=<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">"Microsoft.XMLHTTP"</span></span>); } xmlhttp.open(<span class="hljs-string"><span class="hljs-string">"GET"</span></span>,<span class="hljs-string"><span class="hljs-string">"https://"</span></span>+ip+<span class="hljs-string"><span class="hljs-string">":"</span></span>+port+<span class="hljs-string"><span class="hljs-string">"/"</span></span>+dataReq,<span class="hljs-literal"><span class="hljs-literal">true</span></span>); xmlhttp.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Authorization"</span></span>, <span class="hljs-string"><span class="hljs-string">"Basic "</span></span> + btoa(login+<span class="hljs-string"><span class="hljs-string">":"</span></span>+passw)); xmlhttp.withCredentials = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; xmlhttp.setRequestHeader(<span class="hljs-string"><span class="hljs-string">"Content-type"</span></span>, <span class="hljs-string"><span class="hljs-string">"application/x-www-form-urlencoded"</span></span>); xmlhttp.send(<span class="hljs-literal"><span class="hljs-literal">null</span></span>); xmlhttp.onreadystatechange=<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xmlhttp.readyState==<span class="hljs-number"><span class="hljs-number">4</span></span> &amp;&amp; xmlhttp.status==<span class="hljs-number"><span class="hljs-number">200</span></span>) { resp= xmlhttp.responseText; parseResp=<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.parse(resp); data=parseResp.tempSensor_1[<span class="hljs-number"><span class="hljs-number">0</span></span>]; log(<span class="hljs-string"><span class="hljs-string">"Val :"</span></span> + data +<span class="hljs-string"><span class="hljs-string">"\n"</span></span>); resp=data*<span class="hljs-number"><span class="hljs-number">0.1</span></span>; } } }</code> </pre></div></div><br>  An example of the display of the data in various widgets. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/bb1/973/5aa/bb19735aafcd69b924faa38f4463311d.png" alt="image"><br><br>  When receiving data from the OPCUA server, the structure of the JSON response will change slightly, but only slightly.  In any case, it will not be difficult to figure it out. <br><br>  <a href="https://github.com/scadapy/json">Download link on github</a> </div><p>Source: <a href="https://habr.com/ru/post/343302/">https://habr.com/ru/post/343302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343290/index.html">Creating remakes of games using emulation: proof of concept</a></li>
<li><a href="../343294/index.html">Parser on PHP knee or how I replenished my music collection</a></li>
<li><a href="../343296/index.html">The story of several hard forks: how did the bitcoin network evolve</a></li>
<li><a href="../343298/index.html">Integration tests for Java using TestContainers. Less madness, more order, all automatically</a></li>
<li><a href="../343300/index.html">We compare what is impossible: cheap hosting and cloud on the VMware stack</a></li>
<li><a href="../343304/index.html">Binary Matrix Neural Network</a></li>
<li><a href="../343306/index.html">How to deal with cheaters and not rewrite all code</a></li>
<li><a href="../343308/index.html">Quantum versus classical: why do we need so many digits</a></li>
<li><a href="../343310/index.html">Regular expressions for the smallest</a></li>
<li><a href="../343312/index.html">Setting up an environment for web development in Windows based on VMware Player virtual machine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>