<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java REST at the HeadHunter School of Programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi Habr, we want to tell about one of the projects of the school of programmers HeadHunter 2018. Below is an article of our graduate, in which he will...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java REST at the HeadHunter School of Programmers</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi Habr, we want to tell about one of the projects of the school of programmers HeadHunter 2018. Below is an article of our graduate, in which he will tell about the experience gained during training. </p><br><p><img src="https://habrastorage.org/webt/zr/e-/kz/zre-kzkr6rammklxumiwt8zxer8.jpeg"></p><a name="habracut"></a><br><p>  Hello.  This year I graduated from the <a href="https://school.hh.ru/">School of Programmers hh</a> and in this post I will talk about the educational project in which I participated.  While studying at school, and especially at the project, I lacked an example of a combat application (and even better a guide) in which it would be possible to look at how to properly divide logic and build a scalable architecture.  All the articles I found were difficult to understand for a beginner, because  either they actively used IoC without exhaustive explanations of how to add new components or modify old ones, or they were archaic and contained a ton of configs on xml and frontend on jsp.  I tried to focus on my level before learning, i.e.  almost zero with a few reservations, so this article should be useful for future students of the school, as well as self-taught enthusiasts who have decided to start writing in java. </p><br><h2 id="dano-postanovka-zadachi">  Given (problem statement) </h2><br><p>  Team - 5 people.  Term - 3 months, at the end of each - a demo.  The goal is to make an application that helps HR accompany employees on a trial period, automating all the processes that will work out.  At the entrance, they explained to us how the probationary period (IS) is arranged: as soon as it becomes known that a new employee is coming out, HR begins to kick the future leader so that he sets tasks for the IP, and this should be done before the first working day.  On the day when the employee comes to work, HR conducts a welcome meeting, talks about the company's infrastructure, and handles tasks to the IS.  After 1.5 and 3 months, an intermediate and final meeting of the HR, the manager and the employee are held, where the progress of the discussion is discussed and a form of the results is drawn up.  In case of success, after the final meeting, the employee is handed a printed questionnaire of a novice (questions in the ‚Äúappreciate the pleasure of IP‚Äù style) and turn on the HR task in jira to issue a DMS officer. </p><br><h2 id="design">  Design </h2><br><p>  We decided to make for each employee a personal page on which general information will be displayed (name, department, manager, etc.), a field for comments and a history of changes, attachments (tasks on the IP, questionnaire) and employee‚Äôs workflow reflecting level of passage of IP.  Vorkflou was decided to split into 8 stages, namely: </p><br><ul><li>  1st stage - adding an employee: becomes executed immediately after a new employee is registered in the HR system.  At the same time, three calendars are sent to HRU for a good, intermediate and final meeting. </li><li>  Stage 2 - coordination of tasks on the IS: the head is sent a form for setting tasks on the IS, which after filling out will receive HR.  HR then prints them, signs them, and marks the end of the stage in the interface. </li><li>  Stage 3 - welcome meeting: HR holds a meeting and presses the ‚ÄúStage completed‚Äù button. </li><li>  4th stage - intermediate meeting: similar to the third stage </li><li>  Stage 5 - the results of the interim meeting: HR fills in the results on the employee‚Äôs page and clicks Next. </li><li>  6th stage - final meeting: similar to the third stage </li><li>  7th stage - the results of the final meeting: similar to the fifth stage </li><li>  The 8th stage is the completion of the IP: in case of successful completion of the IP, a link with the form of the questionnaire is sent to the employee by e-mail, and jira automatically creates a task for the design of the VHI (before us the task was started by hands). </li></ul><br><p>  All stages have time after which the stage is considered overdue and is highlighted in red, and a notification arrives by mail.  The end time must be editable, for example, in case an interim meeting falls on a holiday or due to some circumstances it is necessary to postpone the meeting. <br>  Unfortunately, the prototypes painted on the leaflets / boards have not been preserved, but at the end there will be screenshots of the finished application. </p><br><h2 id="ekspluataciya">  Exploitation </h2><br><p>  One of the goals of the school is to prepare students for work in large projects, so the process of releasing tasks was appropriate for us. <br>  At the end of the work on the task, we give it to the review_1 to another student from the team to correct obvious errors / exchange of experience.  Then there is a review_2 - the task is checked by two mentors, who make sure that we don‚Äôt let govnod for a couple with a reviewer_1.  Further testing was supposed, but this stage is not very appropriate, given the scale of the school project.  So after passing the review, we thought the task was ready for release. <br>  Now a few words about the warmth.  The application must always be available on the network from any computers.  To do this, we bought a cheap virtual machine (for 100 rubles / month), but, as I learned later, everything could be arranged for free and in a fashionable way in <a href="https://habr.com/post/310460/">the AWS docker</a> .  For continuous integration, we have chosen Travis.  If someone does not know (I personally never heard of continuous integration before school), it‚Äôs such a cool thing that will monitor your github and when a new commit appears (as configured), collect the code in jar, send it to the server and restart the application automatically.  How exactly to build, is described in the <a href="">Travis yamle</a> in the root of the project, it is quite similar to bash, so I think no comments will be required.  We also bought a domain <a href="http://www.adaptation.host/">www.adaptation.host</a> , so as not to register an ugly IP address in the address bar on a demo.  We also set up postfix (for sending mail), apache (not nginx, since apache was out of the box) and jira (trial) server.  The frontend and backend were made by two separate services that will communicate over http (# 2-18, # microservices).  This part of the article "at school HeadHunter programmers" smoothly ends, and we turn to the java rest service. </p><br><h2 id="bekend">  Backend </h2><br><h3 id="0-vvedenie">  0. Introduction </h3><br><p>  We used the following technologies: </p><br><ul><li>  JDK 1.8; </li><li>  Maven 3.5.2; </li><li>  Postgres 9.6; </li><li>  Hibernate 5.2.10; </li><li>  Jetty 9.4.8; </li><li>  Jersey 2.27. </li></ul><br><p>  As a framework, we took <a href="https://github.com/hhru/nuts-and-bolts">NaB</a> 3.5.0 from hh.  Firstly, it is used in HeadHunter, and secondly, it contains jetty, jersey, hibernate, embedded postgres out of the box, which is written on the githabe.  Let me briefly explain for beginners: jetty is a web server that is engaged in identifying clients and organizing a session for each of them;  jersey - a framework that helps to conveniently create a RESTful service;  hibernate - ORM to simplify work with the database;  maven is a java project builder. <br>  I will show a simple example of how to work with it.  I created a small <a href="https://github.com/derp300/NaB_example">test repository</a> in which I added two entities: a user and a resume, as well as the resources to create and receive them with the OneToMany / ManyToOne connection.  To run it is enough to clone the repository and run mvn clean install exec: java in the project root.  Before commenting on the code, I‚Äôll tell you about the structure of our service.  It looks like this: </p><br><p><img src="https://habrastorage.org/webt/wq/dc/iv/wqdcivebg7w2jiizbj7gede39mi.png"></p><br><p>  Main directories: </p><br><ul><li>  Services is the main directory in the application; all business logic is stored here.  In other places working with data without good reason should not be. </li><li>  Resources - URL handlers, the layer between services and the frontend.  Here validation of incoming data and conversion of outgoing data are allowed, but not business logic. </li><li>  Dao (Data Access Object) - the layer between the database and services.  Tao must contain only fundamental basic operations: add, count, update, delete one / all. </li><li>  Entity - objects that ORM exchanges with the base.  As a rule, they correspond directly to the tables and must contain all the fields as the entity in the database with the corresponding types. </li><li>  Dto (Data Transfer Object) is an analogue of an entity, only for resources (front), it helps to generate json from the data that we want to send / receive. </li></ul><br><h3 id="1-baza">  1. Base </h3><br><p>  I should use the installed postgres side by side, as in the main application, but I wanted the test example to be simple and run with one command, so I took the built-in HSQLDB.  Connecting the database to our infrastructure is done by adding a DataSource to ProdConfig (also remember to <a href="https://github.com/derp300/NaB_example/blob/master/src/etc/coolService/hibernate.properties">tell hibernate</a> which database you are using): </p><br><pre><code class="hljs java"><span class="hljs-meta"><span class="hljs-meta">@Bean</span></span>(destroyMethod = <span class="hljs-string"><span class="hljs-string">"shutdown"</span></span>) <span class="hljs-function"><span class="hljs-function">DataSource </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dataSource</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmbeddedDatabaseBuilder() .setType(EmbeddedDatabaseType.HSQL) .addScript(<span class="hljs-string"><span class="hljs-string">"db/sql/create-db.sql"</span></span>) .build(); }</code> </pre> <br><p>  I created the table creation script in the create-db.sql file.  You can add other scripts that initialize the database.  In our lightweight example with in_memory base, you could do without scripts at all.  If <code>hibernate.hbm2ddl.auto=create</code> specified in the hibernate.properties settings, hibernate will create tables by entity when the application is started.  But if you need to have something in the database that is not in the entity, then you cannot do without a file.  Personally, I‚Äôm used to separating the base and the application, so I usually don‚Äôt trust hibernate to do such things. <br>  <code>db/sql/create-db.sql</code> : </p><br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> employee ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, first_name <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, last_name <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, email <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">resume</span></span> ( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">IDENTITY</span></span> PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span>, employee_id <span class="hljs-built_in"><span class="hljs-built_in">INTEGER</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">position</span></span> <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">128</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, about <span class="hljs-built_in"><span class="hljs-built_in">VARCHAR</span></span>(<span class="hljs-number"><span class="hljs-number">256</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">FOREIGN</span></span> <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (employee_id) <span class="hljs-keyword"><span class="hljs-keyword">REFERENCES</span></span> employee(<span class="hljs-keyword"><span class="hljs-keyword">id</span></span>) );</code> </pre> <br><h3 id="2-entity">  2. Entity </h3><br><p>  <code>entities/employee</code> : </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"employee"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Employee</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">, nullable = false)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer id; <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"first_name"</span></span></span><span class="hljs-meta">, nullable = false)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String firstName; <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"last_name"</span></span></span><span class="hljs-meta">, nullable = false)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String lastName; <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"email"</span></span></span><span class="hljs-meta">, nullable = false)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String email; <span class="hljs-meta"><span class="hljs-meta">@OneToMany(mappedBy = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"employee"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@OrderBy(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> List&lt;Resume&gt; resumes; <span class="hljs-comment"><span class="hljs-comment">//..geters and seters.. }</span></span></code> </pre> <br><p>  <code>entities/resume</code> : </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Entity</span></span> <span class="hljs-meta"><span class="hljs-meta">@Table(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"resume"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Resume</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Id</span></span> <span class="hljs-meta"><span class="hljs-meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer id; <span class="hljs-meta"><span class="hljs-meta">@ManyToOne(fetch = FetchType.LAZY)</span></span> <span class="hljs-meta"><span class="hljs-meta">@JoinColumn(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"employee_id"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Employee employee; <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"position"</span></span></span><span class="hljs-meta">, nullable = false)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String position; <span class="hljs-meta"><span class="hljs-meta">@Column(name = </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"about"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String about; <span class="hljs-comment"><span class="hljs-comment">//..geters and seters.. }</span></span></code> </pre> <br><p>  Entities are not referenced by the class field, but by the parent / heir object entirely.  Thus, we can get recursion when we try to take a resume from the Employee database for which we‚Äôve got resumes for which ... To prevent this from happening, we specified the annotations <code>@OneToMany(mappedBy = "employee")</code> and <code>@ManyToOne(fetch = FetchType.LAZY)</code> .  They will be taken into account in the service, when performing a transaction to read / write from the database.  Setting up <code>FetchType.LAZY</code> is optional, but using lazy communication makes the transaction easier.  So, if in a transaction we receive a resume from the database and do not contact the owner, then the employee entity will not be loaded.  You can see for yourself: remove <code>FetchType.LAZY</code> and see in the debug what is returned from the service along with the resume.  But you should be careful - if we did not load the employee into the transaction, then accessing the employee fields outside the transaction can cause a <code>LazyInitializationException</code> . </p><br><h3 id="3-dao">  3. Dao </h3><br><p>  In our case, EmployeeDao and ResumeDao are almost identical, so here‚Äôs just one of them. <br>  <code>EmployeeDao</code> : </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeDao</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> SessionFactory sessionFactory; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmployeeDao</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(SessionFactory sessionFactory)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.sessionFactory = sessionFactory; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">save</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Employee employee)</span></span></span><span class="hljs-function"> </span></span>{ sessionFactory.getCurrentSession().save(employee); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Employee </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sessionFactory.getCurrentSession().get(Employee.class, id); } }</code> </pre> <br><p>  The <code>@Inject</code> means that in the constructor of our dao, Dependency Injection is used.  In my past life, a physicist who has parsed a file, built graphs based on the results of a number and, at the very least, figured out the OOP, in java guides such constructions seemed something insane.  And at school, perhaps, this topic is the most non-obvious, IMHO.  Fortunately, there are a lot of materials about DI on the Internet.  If you are too lazy to read, then the first month you can follow the rule: register new resources / services / dao in our <a href="">context-config</a> , add the entity to the <a href="">mapping</a> .  If there is a need to use some services / dao in others, they need to be added to the designer with the inject annotation, as shown above, and the spring initializes everything for you.  But then you still have to deal with DI. </p><br><h3 id="4-dto">  4. Dto </h3><br><p>  Dto, like dao, is almost identical for employee and resume.  Consider here only employeeDto.  We will need two classes: <code>EmployeeCreateDto</code> , required when creating an employee;  <code>EmployeeDto</code> , used when receiving (contains additional <code>id</code> and <code>resumes</code> ).  The <code>id</code> field has been added so that in the future, on requests from the outside, we can work with the employee without conducting a preliminary search for the entity via <code>email</code> .  Field <code>resumes</code> to receive an employee along with all his resumes in one request.  It would be possible to manage with one dto for all operations, but then for the list of all resumes of a specific employee we would have to create an additional resource, like getResumesByEmployeeEmail, pollute the code with custom queries to the database and cross out all the conveniences provided by ORM. <br>  <code>EmployeeCreateDto</code> : </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> EmployeeCreateDto { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> lastName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> email; }</code> </pre> <br><p>  <code>EmployeeDto</code> : </p><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> EmployeeDto { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Integer id; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> firstName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> lastName; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> email; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> List&lt;ResumeDto&gt; resumes; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EmployeeDto(){ } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EmployeeDto(Employee employee){ id = employee.getId(); firstName = employee.getFirstName(); lastName = employee.getLastName(); email = employee.getEmail(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (employee.getResumes() != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { resumes = employee.getResumes().stream().map(ResumeDto::<span class="hljs-keyword"><span class="hljs-keyword">new</span></span>).collect(Collectors.toList()); } } }</code> </pre> <br><p>  Once again I draw attention to the fact that it is so indecent to write logic in dto that all fields are denoted as <code>public</code> in order not to use getters and setters. </p><br><h3 id="5-servis">  5. Service </h3><br><p>  <code>EmployeeService</code> : </p><br><pre> <code class="hljs java"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeService</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> EmployeeDao employeeDao; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> ResumeDao resumeDao; <span class="hljs-meta"><span class="hljs-meta">@Inject</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EmployeeService</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EmployeeDao employeeDao, ResumeDao resumeDao)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.employeeDao = employeeDao; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.resumeDao = resumeDao; } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> EmployeeDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createEmployee</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(EmployeeCreateDto employeeCreateDto)</span></span></span><span class="hljs-function"> </span></span>{ Employee employee = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Employee(); employee.setFirstName(employeeCreateDto.firstName); employee.setLastName(employeeCreateDto.lastName); employee.setEmail(employeeCreateDto.email); employeeDao.save(employee); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmployeeDto(employee); } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResumeDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createResume</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ResumeCreateDto resumeCreateDto)</span></span></span><span class="hljs-function"> </span></span>{ Resume resume = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Resume(); resume.setEmployee(employeeDao.getById(resumeCreateDto.employeeId)); resume.setPosition(resumeCreateDto.position); resume.setAbout(resumeCreateDto.about); resumeDao.save(resume); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResumeDto(resume); } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(readOnly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> EmployeeDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getEmployeeById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmployeeDto(employeeDao.getById(id)); } <span class="hljs-meta"><span class="hljs-meta">@Transactional</span></span>(readOnly = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ResumeDto </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getResumeById</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Integer id)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ResumeDto(resumeDao.getById(id)); } }</code> </pre> <br><p>  Those transactions which save us from <code>LazyInitializationException</code> (and not only).  To understand transactions in hibernate, I recommend excellent work on Habr√© ( <a href="https://habr.com/post/271115/">read more ...</a> ), which helped me a lot in due time. </p><br><h3 id="6-resursy">  6. Resources </h3><br><p>  Finally, add the resources to create and retrieve our entities: <br>  <code>EmployeeResource</code> : </p><br><pre> <code class="hljs kotlin"><span class="hljs-meta"><span class="hljs-meta">@Path(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Singleton</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">EmployeeResource</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> EmployeeService employeeService; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> EmployeeResource(EmployeeService employeeService) { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.employeeService = employeeService; } <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Produces(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/json"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/employee/{id}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Response getEmployee(<span class="hljs-meta"><span class="hljs-meta">@PathParam(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">)</span></span> Integer id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.status(Response.Status.OK) .entity(employeeService.getEmployeeById(id)) .build(); } <span class="hljs-meta"><span class="hljs-meta">@POST</span></span> <span class="hljs-meta"><span class="hljs-meta">@Produces(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/json"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/employee/create"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Response createEmployee(<span class="hljs-meta"><span class="hljs-meta">@RequestBody</span></span> EmployeeCreateDto employeeCreateDto){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.status(Response.Status.OK) .entity(employeeService.createEmployee(employeeCreateDto)) .build(); } <span class="hljs-meta"><span class="hljs-meta">@GET</span></span> <span class="hljs-meta"><span class="hljs-meta">@Produces(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/json"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/resume/{id}"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Response getResume(<span class="hljs-meta"><span class="hljs-meta">@PathParam(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"id"</span></span></span><span class="hljs-meta">)</span></span> Integer id) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.status(Response.Status.OK) .entity(employeeService.getResumeById(id)) .build(); } <span class="hljs-meta"><span class="hljs-meta">@POST</span></span> <span class="hljs-meta"><span class="hljs-meta">@Produces(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"application/json"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@Path(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"/resume/create"</span></span></span><span class="hljs-meta">)</span></span> <span class="hljs-meta"><span class="hljs-meta">@ResponseBody</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Response createResume(<span class="hljs-meta"><span class="hljs-meta">@RequestBody</span></span> ResumeCreateDto resumeCreateDto){ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Response.status(Response.Status.OK) .entity(employeeService.createResume(resumeCreateDto)) .build(); } }</code> </pre> <br><p>  <code>Produces(‚Äúapplication/json‚Äù)</code> needed so that json and dto are correctly converted into each other.  It requires the pom.xml dependency: </p><br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span>org.glassfish.jersey.media<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">groupId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span>jersey-media-json-jackson<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">artifactId</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span>${jersey.version}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">version</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dependency</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Other json-converters for some reason expose an invalid mediaType. </p><br><h3 id="7-rezultat">  7. Result </h3><br><p>  Run and check what we got ( <code>mvn clean install exec:java</code> in the project root).  The port on which the application is launched is specified in <a href="https://github.com/derp300/NaB_example/blob/master/src/etc/coolService/service.properties">service.properties</a> .  Create a user and resume.  I do this with curl, but you can use postman if you despise the console. </p><br><pre> <code class="hljs erlang">curl --header <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ --request POST \ --data '{<span class="hljs-string"><span class="hljs-string">"firstName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Jason"</span></span>, <span class="hljs-string"><span class="hljs-string">"lastName"</span></span>: <span class="hljs-string"><span class="hljs-string">"Statham"</span></span>, <span class="hljs-string"><span class="hljs-string">"email"</span></span>: <span class="hljs-string"><span class="hljs-string">"jasonst@t.ham"</span></span>}' \ http://localhost:<span class="hljs-number"><span class="hljs-number">9999</span></span>/employee/create curl --header <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> \ --request POST \ --data '{<span class="hljs-string"><span class="hljs-string">"employeeId"</span></span>: <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">"position"</span></span>: <span class="hljs-string"><span class="hljs-string">"Voditel"</span></span>, <span class="hljs-string"><span class="hljs-string">"about"</span></span>: <span class="hljs-string"><span class="hljs-string">"Opyt raboty perevozchikom 15 let"</span></span>}' \ http://localhost:<span class="hljs-number"><span class="hljs-number">9999</span></span>/resume/create curl --header <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> --request GET http://localhost:<span class="hljs-number"><span class="hljs-number">9999</span></span>/employee/<span class="hljs-number"><span class="hljs-number">0</span></span> curl --header <span class="hljs-string"><span class="hljs-string">"Content-Type: application/json"</span></span> --request GET http://localhost:<span class="hljs-number"><span class="hljs-number">9999</span></span>/employee/<span class="hljs-number"><span class="hljs-number">0</span></span></code> </pre> <br><p>  Everything works perfectly.  Thus, we got a backend providing api.  Now you can start the service with the front-end and draw the appropriate forms.  This is a good foundation of the application, which you can use to start your own, configuring various components as the project progresses. </p><br><h2 id="zaklyuchenie">  Conclusion </h2><br><p>  The <a href="https://github.com/hhru/AdaptationProject">main application</a> code is contained in working condition on a githaba with instructions for launching it in a wiki tab. Screenshots that have been promised: </p><br><p><img src="https://habrastorage.org/webt/er/dl/sx/erdlsxou31urpje17xa_gbusfo8.png"><br><img src="https://habrastorage.org/webt/c7/xu/hc/c7xuhcyhkny_ll6t9p2c02vs8gi.png"></p><br><p>  For a multi-million dollar project, it looks a bit damp, of course, but as an excuse, let me remind you that we worked on it in the evening, after work / study. <br>  If the number of interested ones exceeds the number of slippers, in the future I can turn it into a cycle of articles, where I will tell you about the front, the backdocking and the nuances we encountered when working with mail / grease / dock files. </p><br><p>  PS After some time, having gone through the shock of the school, the team‚Äôs remnants gathered and, after analyzing the flights, decided to make an adaptation of 2.0, taking into account all the errors.  The main objective of the project is the same - to learn how to make serious applications, build a well-thought-out architecture and be in-demand specialists in the market.  You can follow the work in the same repository.  Pool requests are welcome.  Thank you for your attention and wish us good luck! </p><br><h3 id="plyushki">  buns </h3><br><p>  <a href="https://youtu.be/gYkQE8LeXqs">ioc video lecture from hh</a> </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/419599/">https://habr.com/ru/post/419599/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../419587/index.html">Contests that change the world. 1567 - 2035</a></li>
<li><a href="../419589/index.html">Use AMP as a general purpose library for creating fast dynamic sites.</a></li>
<li><a href="../419591/index.html">How to make email-mailing and do not mow: practical advice</a></li>
<li><a href="../419593/index.html">Glasses for color blindness: how it works and what the difficulties of selecting</a></li>
<li><a href="../419597/index.html">Parallels RAS versus Alternative Technologies</a></li>
<li><a href="../419601/index.html">An example of designing a digital device "on the fingers"</a></li>
<li><a href="../419603/index.html">Background: companies that produce robomobils</a></li>
<li><a href="../419611/index.html">From Germany with love: IP Telephony Pioneer Comes to Russia</a></li>
<li><a href="../419613/index.html">Using the Android Studio Debugger to the Maximum</a></li>
<li><a href="../419615/index.html">DJI Osmo Mobile 2 - electronic stabilizer for a phone</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>