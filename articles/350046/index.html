<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Hidden JS-mining in the browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="On the eve of NeoQUEST, we like to share different stories that can indirectly help participants in the course of their assignments. This time, we are...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Hidden JS-mining in the browser</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/gh/qj/od/ghqjodufjvpzuyi30nh0xh8ummo.jpeg"></div><br>  On the eve of <a href="https://neoquest.ru/timeline.php%3Fyear%3D2018%26part%3D1">NeoQUEST,</a> we like to share different stories that can indirectly help participants in the course of their assignments.  This time, we are telling an absolutely real story on the subject of hidden JS mining in the user's browser, desperately hinting that there will be something to remember in <a href="https://neoquest.ru/2018/">NeoQUEST-2018</a> ! <br><br>  The topic has previously <a href="https://habrahabr.ru/post/338586/">been raised on Habr√©</a> , but the fantasy of virus writers is inexhaustible!  Recently, we discovered a more extensive use of mining on JS in the user's browser.  Be vigilant, habrauzer, and welcome under the cat: tell you more about everything! <br><a name="habracut"></a><br>  As is often the case, the search for malware begins with the fact that the user complains that his computer is ‚Äúslowing down‚Äù.  So it was this time.  We have a laptop with Ubuntu, a complaint that "it slows down", and, in general, nothing more. <br><br>  Attempting to track resources (CPU, RAM, etc) did not lead to anything - everything is quiet.  Various browsers were checked, any suspicious programs, extensions were searched, the browser cache was cleared ... Everything is working properly. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After a while, the user again complains about the same thing!  The most interesting thing is that as soon as the laptop came into my hands, all the "symptoms" of poor performance disappeared, and there was no explanation for this, and the owner of the laptop could only wriggle with surprise. <br><br>  The denouement of this problem was ... In the denouement of another, secondary problem!  But first things first. <br><br><h3>  <b>Voracious Safari</b> </h3><br>  At some point, there was a need to go from a personal laptop to the Internet from the same Wi-Fi network in which the ‚Äúbraking‚Äù computer was used.  And here it was noticed that the Safari browser on a personal laptop began to mercilessly ‚Äúdevour‚Äù CPU resources!  It was difficult to assume initially that these performance problems had common causes with a ‚Äúproblem‚Äù laptop running Ubuntu ... <br><br><img src="https://habrastorage.org/webt/ug/to/dm/ugtodmow3f1uisk0ysx6g6witj4.jpeg"><br><br>  The screenshot shows that a certain site includes a script with an obscure name many times, and there are several third-party scripts from two browser extensions.  At first, remembering the <a href="https://habrahabr.ru/post/338586/">above article</a> , it was decided that the site owners simply installed a miner on their site, as in the case of a <a href="http://www.zveruga.net/">pet store</a> from the above-mentioned article. <br><br>  We were almost ready to send a letter to the site owners about how bad they were, but we decided to double-check everything just in case - and not in vain! <br><br><h3>  <b>Is the browser at fault?</b> </h3><br>  All browser extensions were disabled and then deleted, but the problem did not disappear, in any case, the following script was present on the site: <br><br><img src="https://habrastorage.org/webt/p4/ar/p0/p4arp0ud1yj2vg59x6lsgg659eu.jpeg"><br><br>  Further research in the debugger showed that it was the miner of the cryptocurrency <a href="https://ru.wikipedia.org/wiki/Monero">Monero</a> on the <a href="https://en.bitcoin.it/wiki/CryptoNight">CryptoNight</a> algorithm.  It would seem, well, certainly the miner on the site, and not on a laptop ... <br><br>  Then it was noticed that the same script appears on other sites!  Other browsers were used without any extensions and plug-ins.  The result is the same - on some sites the same script appears with a built-in miner. <br><br>  Where does he come from?  Problem in the computer?  The appearance of the script in different browsers and on different sites gives only one thought: the rootkit in the system.  Since the search was already very tedious, and the problem required an immediate solution yesterday, it was decided to reinstall the system. <br><br><h3>  <b>When even reinstalling the OS does not save ...</b> </h3><br>  Reinstalling MacOS decided absolutely nothing!  Everything is exactly the same as before.  This has caused serious doubts in the router, provider, and in general - the cause of mass paranoia.  It was decided to check the Internet connection "for harmfulness."  We used alternative sources of Internet connection (4G), and the results were amazing! <br><br>  Miner did not appear on the same site where he was when using the wired Internet.  Another laptop was also brought in for verification, this time with Windows.  Obviously, the problem is in the Internet connection - but where exactly? <br><br>  We connected the network cable of the provider directly, bypassing the router, and again the script was not found!  Several times we have rechecked everything, and the assumption was confirmed: the router has malicious software installed that performs HTTP + TCP <a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack">MITM</a> and inserts malicious miner code on every page of the site that does not use HTTPS.  Hence, unstable behavior - if the tab with the HTTP site is open, it means that your processor already mines Monero for virus writers! <br><br>  The problem was finally solved by urgent flashing of the router.  What was it all about the router?  Rostelecom Sagemcom F @ st 1744, with firmware under Rostelecom. <br><br>  How did the malware get to the router?  The answer is simple: Rostelecom currently issues a white IP in many (if not all) regions to its users, albeit dynamic, but white. <br><br>  But after all white IP is not enough?  Of course, because in the standard firmware of this router, a lot of ports are open to the outside, including?  and WEB-interface.  Login and password are left default, and here you are - an open door for malware! <br><br>  Unfortunately, there are no samples of Malvari, but the situation itself will remain in the memory for a long time!  We now have to "blow on the water", checking not only the sites, but also their own network equipment. <br><br>  We could not get around such a popular topic cryptocurrency in <a href="https://neoquest.ru/">NeoQUEST</a> !  About what <a href="https://ru.wikipedia.org/wiki/%25D0%2591%25D0%25BB%25D0%25BE%25D0%25BA%25D1%2587%25D0%25B5%25D0%25B9%25D0%25BD">blockchain is</a> , how cool it is, safe and promising, so much has already been written that many dream of finding vulnerability in it and wiping their noses to annoying crypto startups. <br><br>  And NeoQUEST participants will have such a chance!  In addition, they are waiting for the task of competitive intelligence (OSINT), search for vulnerabilities, security of Android and the Web, and not only!  So feel free to <a href="https://neoquest.ru/2018/">register</a> , and write to us at <b>support@neoquest.ru</b> on all issues! </div><p>Source: <a href="https://habr.com/ru/post/350046/">https://habr.com/ru/post/350046/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350034/index.html">Service Workers. Web Push and where they live</a></li>
<li><a href="../350038/index.html">Rake when moving to a virtual platform with physical hardware</a></li>
<li><a href="../350040/index.html">Call Tracking Mango Office: under the hood of the service</a></li>
<li><a href="../350042/index.html">Benchmark of Google's new tensor processor for deep learning</a></li>
<li><a href="../350044/index.html">Announcement of Google Summer of Code 2018 for the project radare2</a></li>
<li><a href="../350048/index.html">Let's Encrypt postponed issuance of wildcard certificates due to security issues.</a></li>
<li><a href="../350050/index.html">CodeFest Frontend: React, Javascript and Best Practices</a></li>
<li><a href="../350052/index.html">Designer, close Sketch! Knowledge of UX / UI is not a guarantee of a successful career</a></li>
<li><a href="../350054/index.html">Anatomy of .NET Core: how we set up NTLM for Linux</a></li>
<li><a href="../350056/index.html">RequireJS for Vue.js + Asp.NETCore + TypeScript applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>