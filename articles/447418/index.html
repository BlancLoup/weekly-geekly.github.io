<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bitcoin process. How is the payment page in B2BinPay</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="B2BinPay is a cryptocurrency payment system with many related backends of applications, analytics, nodes, queues, but only one UI page that the end us...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bitcoin process. How is the payment page in B2BinPay</h1><div class="post__text post__text-html js-mediator-article">  B2BinPay is a cryptocurrency payment system with many related backends of applications, analytics, nodes, queues, but only one UI page that the end user sees.  It has high requirements for ease of use.  Despite the seeming simplicity of the page, the development team would be interested to share how it works from the inside. <br><br>  To understand business processes will need to dive into the subject area.  For readers who do not yet know what cryptocurrency, blockchain and address are, we have made short and clear definitions under the cut. <br><br><img src="https://habrastorage.org/webt/9l/st/fh/9lstfhjhpe676a3t3e8mj3fdu-q.jpeg"><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">To understand the terms, we give an analogy with the fiat world of payments:</b> <div class="spoiler_text">  <b>Blockchain</b> is a decentralized (ideally) database that stores information about addresses, transactions, and balances.  It consists of blocks, each of them contains a limited amount of information.  Blocks are generated by miners using energy-intensive calculations (PoW) or proof of proportion (PoS).  Each next block contains a list of new transactions and a link to the previous one.  Each cryptocurrency has its own blockchain. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <b>The merchant</b> is the same as the store owner, who rents the payment system to receive payments from end users. <br><br>  <b>Wallet</b> - the same as the account in the traditional financial world. <br><br>  <b>Transaction</b> - an entry in the blockchain stating that funds were sent from one purse to another.  Wallet balance is formed from the amount of transactions. <br><br>  <b>The address</b> is the same as the account details.  The difference is that most blockchains allow you to generate an infinite number of addresses for one wallet. <br><br>  <b>A confirmed transaction</b> is such a transaction, after which a safe number of blocks was generated.  One block equals one acknowledgment.  If the transaction has not received 4-8 confirmations, then it is not considered complete. <br><br>  <b>Payment system</b> - software that accepts and processes payments in a cryptocurrency.  It links and aggregates orders, payments, transactions, returns, deposits, withdrawals and other information.  It also informs the merchant system about changes in the context of orders and payments, rather than blockchains and transactions. <br><br>  <b>Explorer</b> - a service or site-browser of data entering the blockchain.  Using this service, you can conveniently get information about addresses, transactions and blocks. <br><br>  <b>A node</b> is a computer that stores a copy of the entire database (blockchain). <br></div></div><br><h3>  The general scheme of work and the requirements for the content of the payment page </h3><br>  The cycle of the payment is as follows: on the store site, the buyer selects the product and payment currency.  The system redirects the user to the payment page.  It contains the following information: currency, address, informational comments.  The user sends the required amount to the specified address and waits for a sufficient number of confirmations of the network to recognize the payment successful.  While waiting, the buyer can monitor the status of payment, without leaving the page on the site-explorer.  As soon as the payment is accepted, the user is forwarded to the successful payment page on the seller‚Äôs website. <br><br><img src="https://habrastorage.org/webt/gz/mu/p8/gzmup8pqrvynkwr7plvc_a3uyqu.png"><br><br>  The payment process is divided into several stages.  Each of them does not require user action, except for the direct transfer of money.  Standard successful script: <br><br><ol><li>  On the merchant site, the user selects a payment method B2BinPay and currency </li><li>  The seller's IP sends a request to create a new payment order, receiving in response a link to the payment page </li><li>  The user is redirected to the payment page, which contains information: currency, amount, address, and additional fields if necessary </li><li>  User pays for the purchase </li><li>  The system detects that a new transaction has arrived at the address and the page enters the tracking state. </li><li>  The status of the transaction is monitored and the information on the page is updated until a secure amount of confirmations is reached. </li><li>  The user is redirected to the successful payment page on the seller‚Äôs website. </li></ol><br>  Accordingly, the payment page can be in two states: view details and wait for confirmation.  When viewing the details, you can enter the address in two ways: scan the QR code or copy the address in text form.  In addition to the basic information, we will add a mini-instruction in text form, which will tell you how to pay, where to download the wallet application and how to buy currency.  In addition to these fields, there is one more, the presence of which depends on the chosen currency.  Sometimes, in order to correctly match a transaction, a payment order and a buyer, it is required to know not only the address, but also additional information.  For example, when sending a Ripple currency, you must specify the destination tag (comment to the transaction). <br><br>  For those who copy the address in text form, rather than scanning the QR code, a copy button has been added.  Also on the page should be the logo of the coin, as many people identify the currency visually, according to the shape and color of the logo, and not by letter designation. <br><br>  The change of state occurs at the moment when an incoming transaction is detected at the billing address.  At this point, the details disappear, since they are no longer required;  the user goes into standby mode, and the page needs a constant flow of information about the status of the transaction.  Now on the page you can find: the waiting time until the completion of the transaction, the current number of confirmations, a short comment explaining further actions. <br><br>  The page should be easy to read, intuitive and at the same time quite informative.  For experienced buyers, you need to focus on the address and amount. <br><br>  From the listed requirements the layout of the future page turned out. <br><br><img src="https://habrastorage.org/webt/zb/v3/nv/zbv3nvvp1jnpyu1h1udaydk1vg8.gif"><br><br><h3>  Backend </h3><br>  <b>The first</b> implementation of the backend is to do completely without it!  When generating a payment page, you know in advance what address the money will be sent to.  You can receive new transactions at this address from the explorer using JS.  Thus, the task is reduced to writing connectors to the explorer and periodically poll the necessary one.  A static class diagram might look like this: <br><br><img src="https://habrastorage.org/webt/eu/h9/k2/euh9k2ahzvxmqe4wyeco836lary.png"><br><br>  <i>Pros:</i> there is no load on our power, it is easy to implement, there are no potential security threats. <br><br>  <i>Disadvantages:</i> unreliable sources and untimely receipt of new information, difficulties in delivering updates to the code base to end customers (uncontrolled caching).  The decisive disadvantage is that many currencies do not have stable explorators with a developed API. <br><br>  <b>The second option</b> (working) is your own microservice, which receives information directly from the pull node, filters and distributes to payment pages.  Using Server Side Events on the client will reduce the level of redundancy and save traffic.  SSE fit into the use case, as the page is passive in its behavior - it only accepts new information. <br><br>  <i>Cons: a</i> lot of the cost of implementation, the additional load on the equipment. <br><br>  <i>Pros: a</i> high level of reliability and independence from third-party services;  order context, not transaction. <br>  Schematic diagram: <br><br><img src="https://habrastorage.org/webt/fm/cx/p2/fmcxp2z1jvfwu0ugtqviirg1ply.png"><br><br>  When a payment page is opened in the customer‚Äôs browser, a request to create an SSE connection is sent to the asynchronous backend of microservice.  The request indicates the address to be monitored, the amount of payment, the lifetime and other minor parameters.  On the backend, it is stored in the in-memory noSQL repository.  Each time a new block appears on any of the blockchain nodes, the application receives and extracts useful information from it on the addresses and transactions stored in the database.  If the next block is useful, then updates are sent to clients.  Connections are closed at the initiative of the server when enough confirmations are received or when the TTL has expired. <br><br>  Thus, the backend performs resource-intensive operations and drives traffic only when new information arrives at the node, and there is no periodic ‚Äúpolling‚Äù for new information.  Thanks to asynchronous, we get high speed with thousands of simultaneous connections. <br><br>  Knowing that for coins with PoW, the delay in obtaining new information within a second is insignificant, the minimum horizontal scaling of such a system will give a large increase in throughput.  On particularly active days, such as Black Friday, the load increases.  In case the system fails or is technically faulty, then the client has a fallback state in which the page remains in the details view mode forever.  For PoS-coins, the stage with monitoring the number of confirmations can be skipped, since the transaction speed often ranges from 2 to 5 seconds. <br><br>  <b>The third</b> implementation of the backend is a hybrid one, when, depending on the speed of the blockchain transaction and information about the current availability of third-party services, either SSE or HTTP interaction with the explorer is used.  It is the most efficient and time-consuming. <br><br>  The frontend technology suitable for the task is vue.js with declarative rendering and the ability to create several component states.  This is a lightweight library with an elegant structure and a reactive change to the DOM.  The data source is an SSE connection that opens when the component is initialized. <br><br><h3>  Design </h3><br><img src="https://habrastorage.org/webt/xm/c3/vs/xmc3vsycxf9ocy26iwqne_qofqq.gif"><br><br>  We develop the product and make it high-quality and reliable to make blockchain payments convenient, massive and affordable.  We love not only money, but also the most advanced technologies, challenges and elegant solutions. <br><br>  In the development of the <a href="https://b2binpay.com/">B2BinPay</a> payment system <a href="https://b2binpay.com/">,</a> we regularly solve problems that, despite their apparent simplicity, require an unconventional approach or a fresh look.  We would be grateful for feedback, comments and suggestions.  If you want to bring new and bold ideas to the payment service that is used throughout the world, see <a href="https://moikrug.ru/companies/b2broker">current vacancies</a> . </div><p>Source: <a href="https://habr.com/ru/post/447418/">https://habr.com/ru/post/447418/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447408/index.html">Independent study of English from Elementary to Intermediate: useful resources and motivation</a></li>
<li><a href="../447410/index.html">Provincial fire or the birth of a nation</a></li>
<li><a href="../447412/index.html">Message monitoring in RabbitMQ</a></li>
<li><a href="../447414/index.html">ML.NET 1.0 RC is released. What's new?</a></li>
<li><a href="../447416/index.html">PHP Enchanting arrangement of points above quotes</a></li>
<li><a href="../447420/index.html">Jumping from the stratosphere</a></li>
<li><a href="../447422/index.html">Interesting video viewing experience: instead of VR - glasses with mirrors Ximmerse Visor-X</a></li>
<li><a href="../447424/index.html">Reaktive - a multiplatform library for reactive Kotlin</a></li>
<li><a href="../447426/index.html">How, to whom and why go to consulting? Personal experience on the example of Big Data</a></li>
<li><a href="../447430/index.html">IntelliJ IDEA 2019.1: Customizing interface themes, switch expressions from Java 12, debugging inside Docker containers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>