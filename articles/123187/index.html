<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Add Pattern Matching and Parameterized Methods in Objective-C</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="More and more articles on the topic ‚Äúadd functional buns to your favorite imperative programming language‚Äù. Here is a recent Java example . 

 In Obje...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Add Pattern Matching and Parameterized Methods in Objective-C</h1><div class="post__text post__text-html js-mediator-article"> More and more articles on the topic ‚Äúadd functional buns to your favorite imperative programming language‚Äù.  <a href="http://habrahabr.ru/blogs/java/122919/">Here is a recent Java example</a> . <br><br>  In Objective-C, blocks (blocks) were added not so long ago, by means of which closures are implemented.  But I want something more.  For example, matching with the image ( <a href="http://en.wikipedia.org/wiki/Pattern_matching">Pattern Matching</a> ) and parameterized methods. <br><br>  Exclusively Just For Fun try to add them to the language without patching the compiler and dancing with the preprocessor, using only the means of the language itself. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What came of it? <br><a name="habracut"></a><br>  Everything described below is an example illustrating the idea and using it in your projects at your own risk. <br><br>  Matching the image allows you to write something like: <br> <code>factorial( 0 ) -&gt; 1 <br> factorial( 1 ) -&gt; 1 <br> factorial( n ) -&gt; n * factorial( n - 1 )</code> <br> <br>  To begin with, we try to make a comparison with the image.  So, we create the NSObject extension and declare the type of the block into which we will wrap additional implementations. <br><blockquote>  <font color="#a61390">typedef</font> <font color="#a61390">id</font> <font color="#002200">(</font> <font color="#002200">^</font> PatternMatchingBlock <font color="#002200">)</font> <font color="#002200">(</font> <font color="#a61390">id</font> obj <font color="#002200">)</font> ; <br><br>  <font color="#a61390">@interface</font> <font color="#400080">NSObject</font> <font color="#002200">(</font> PatternMatching <font color="#002200">)</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> method <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">SEL</font> <font color="#002200">)</font> sel_ withParameter <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> object_ useBlock <font color="#002200">:</font> <font color="#002200">(</font> PatternMatchingBlock <font color="#002200">)</font> block_; <br>  <font color="#a61390">@end</font> </blockquote><br>  Now you need to replace the implementation of the selector to be able to choose the necessary implementation, depending on the actual parameter passed.  This will help the reception method substitution ( <a href="http://www.cocoadev.com/index.pl%3FMethodSwizzling">Method Swizzling</a> ).  Each method is a structure of type <code>objc_method</code> from which we are interested in the field <code>method_imp</code> type <code>IMP</code> .  <code>IMP</code> is a pointer to the C function of the method implementation.  The meaning of the method substitution is in replacing these pointers in 2 methods.  Create a class that will hold a pointer to the original implementation of the method and a dictionary, the keys of which are the objects of ‚Äúimages‚Äù, and the values ‚Äã‚Äãare the implementation blocks: <br><blockquote>  <font color="#a61390">@interface</font> PMImplementation <font color="#002200">:</font> <font color="#400080">NSObject</font> <br>  <font color="#a61390">@property</font> <font color="#002200">(</font> nonatomic, retain <font color="#002200">)</font> <font color="#400080">NSMutableDictionary</font> <font color="#002200">*</font> impls; <br>  <font color="#a61390">@property</font> <font color="#002200">(</font> nonatomic, retain <font color="#002200">)</font> <font color="#400080">NSValue</font> <font color="#002200">*</font> defaultImpl; <br>  <font color="#002200">+</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> implementationWithDefaultImpl <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">IMP</font> <font color="#002200">)</font> impl_; <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> forObject <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> object_ invokeWithParameter <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> parameter_; <br>  <font color="#a61390">@end</font> <br><br>  <font color="#a61390">static</font> <font color="#a61390">char</font> <font color="#002200">*</font> PMimplsKey <font color="#002200">=</font> <font color="#a61390">nil</font> ; <br><br>  <font color="#a61390">@implementation</font> PMImplementation <br>  <font color="#a61390">@synthesize</font> impls <font color="#002200">=</font> _impls; <br>  <font color="#a61390">@synthesize</font> defaultImpl <font color="#002200">=</font> _default_impl; <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> dealloc <font color="#002200">{</font> <br>  <font color="#002200">[</font> _impls release <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> _default_impl release <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> super dealloc <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> initWithDefaultImpl <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">IMP</font> <font color="#002200">)</font> impl_ <font color="#002200">{</font> <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> <font color="#002200">(</font> self <font color="#002200">=</font> <font color="#002200">[</font> super init <font color="#002200">]</font> <font color="#002200">)</font> <font color="#002200">)</font> <br>  <font color="#a61390">return</font> <font color="#a61390">nil</font> ; <br>  self.defaultImpl <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSValue</font> valueWithPointer <font color="#002200">:</font> impl_ <font color="#002200">]</font> ; <br>  self.impls <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSMutableDictionary</font> dictionary <font color="#002200">]</font> ; <br>  <font color="#a61390">return</font> self; <br>  <font color="#002200">}</font> <br>  <font color="#002200">+</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> implementationWithDefaultImpl <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">IMP</font> <font color="#002200">)</font> impl_ <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">[</font> <font color="#002200">[</font> <font color="#002200">[</font> self alloc <font color="#002200">]</font> initWithDefaultImpl <font color="#002200">:</font> impl_ <font color="#002200">]</font> autorelease <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> forObject <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> object_ invokeWithParameter <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> parameter_ <font color="#002200">{</font> <br>  <font color="#a61390">for</font> <font color="#002200">(</font> <font color="#a61390">id</font> key_ <font color="#a61390">in</font> <font color="#002200">[</font> self.impls allKeys <font color="#002200">]</font> <font color="#002200">)</font> <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">[</font> key_ isEqual <font color="#002200">:</font> parameter_ <font color="#002200">]</font> <font color="#002200">)</font> <font color="#002200">{</font> <br>  PatternMatchingBlock block_ <font color="#002200">=</font> <font color="#002200">[</font> self.impls objectForKey <font color="#002200">:</font> key_ <font color="#002200">]</font> ; <br>  <font color="#a61390">return</font> block_ <font color="#002200">(</font> parameter_ <font color="#002200">)</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">IMP</font> impl_ <font color="#002200">=</font> <font color="#002200">[</font> self.defaultImpl pointerValue <font color="#002200">]</font> ; <br>  <font color="#a61390">return</font> impl_ <font color="#002200">(</font> object_, _cmd, parameter_ <font color="#002200">)</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">@end</font> </blockquote><br>  And the actual implementation of the NSObject extension: <br><blockquote>  <font color="#a61390">@implementation</font> <font color="#400080">NSObject</font> <font color="#002200">(</font> PatternMatching <font color="#002200">)</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#400080">NSMutableDictionary</font> <font color="#002200">*</font> <font color="#002200">)</font> impls <font color="#002200">{</font> <br>  <font color="#400080">NSMutableDictionary</font> <font color="#002200">*</font> impls_ <font color="#002200">=</font> objc_getAssociatedObject <font color="#002200">(</font> self, <font color="#002200">&amp;</font> PMImplsKey <font color="#002200">)</font> ; <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> impls_ <font color="#002200">)</font> <font color="#002200">{</font> <br>  impls_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSMutableDictionary</font> dictionary <font color="#002200">]</font> ; <br>  objc_setAssociatedObject <font color="#002200">(</font> self, <font color="#002200">&amp;</font> PMImplsKey, impls_ <br>  , OBJC_ASSOCIATION_RETAIN_NONATOMIC <font color="#002200">)</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">return</font> impls_; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> method <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">SEL</font> <font color="#002200">)</font> sel_ withParameter <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> object_ <br>  useBlock <font color="#002200">:</font> <font color="#002200">(</font> PatternMatchingBlock <font color="#002200">)</font> block_ <font color="#002200">{</font> <br>  <font color="#400080">NSString</font> <font color="#002200">*</font> selector_key_ <font color="#002200">=</font> NSStringFromSelector <font color="#002200">(</font> sel_ <font color="#002200">)</font> ; <br>  PMImplementation <font color="#002200">*</font> impl_ <font color="#002200">=</font> <font color="#002200">[</font> self.impls objectForKey <font color="#002200">:</font> selector_key_ <font color="#002200">]</font> ; <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> impl_ <font color="#002200">)</font> <font color="#002200">{</font> <br>  Method default_ <font color="#002200">=</font> class_getInstanceMethod <font color="#002200">(</font> <font color="#002200">[</font> self class <font color="#002200">]</font> , sel_ <font color="#002200">)</font> ; <br>  <font color="#a61390">IMP</font> default_impl_ <font color="#002200">=</font> method_getImplementation <font color="#002200">(</font> default_ <font color="#002200">)</font> ; <br>  impl_ <font color="#002200">=</font> <font color="#002200">[</font> PMImplementation implementationWithDefaultImpl <font color="#002200">:</font> default_impl_ <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> self.impls setObject <font color="#002200">:</font> impl_ forKey <font color="#002200">:</font> selector_key_ <font color="#002200">]</font> ; <br>  Method swizzed_method_ <font color="#002200">=</font> class_getInstanceMethod <font color="#002200">(</font> <font color="#002200">[</font> self class <font color="#002200">]</font> <br>  , <font color="#a61390">@selector</font> <font color="#002200">(</font> swizzledMethod <font color="#002200">:)</font> ; <font color="#002200">)</font> ; <br>  method_setImplementation <font color="#002200">(</font> default_, method_getImplementation <font color="#002200">(</font> swizzed_method_ <font color="#002200">)</font> <font color="#002200">)</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#002200">[</font> impl_.impls setObject <font color="#002200">:</font> block_ forKey <font color="#002200">:</font> object_ <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br><br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> swizzledMethod <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> obj_ <font color="#002200">{</font> <br>  PMImplementation <font color="#002200">*</font> impl_ <font color="#002200">=</font> <font color="#002200">[</font> self.impls objectForKey <font color="#002200">:</font> NSStringFromSelector <font color="#002200">(</font> _cmd <font color="#002200">)</font> <font color="#002200">]</font> ; <br>  <font color="#a61390">return</font> <font color="#002200">[</font> impl_ forObject <font color="#002200">:</font> self invokeWithParameter <font color="#002200">:</font> obj_ <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">@end</font> </blockquote><br>  All magic is in the [-NSObject method: withParameter: useBlock:] method.  For the passed selector, we create a PMImplementation object that stores the pointer to the implementation.  Then we replace it with the ‚ÄúswizzledMethod:‚Äù method.  The trick is that we can find out which selector was actually called via the _cmd parameter, which is implicitly passed when any selector is called.  Now when calling swizzledMethod, [-PMImplementation forObject: invokeWithParameter:] is called, and then we either find a block on the object and execute it, or use the default implementation. <br>  The [-NSObject impls] method adds a self-dictionary in the runtam that stores PMImplementation objects for different selectors. <br><br>  Now, for the sake of all this, it was started - for example, a class for finding factorial <br><blockquote>  <font color="#a61390">@interface</font> Factorial <font color="#002200">:</font> <font color="#400080">NSObject</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> <font color="#002200">)</font> factorial <font color="#002200">:</font> <font color="#002200">(</font> <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> <font color="#002200">)</font> number_; <br>  <font color="#a61390">@end</font> <br><br>  <font color="#a61390">@implementation</font> Factorial <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> init <font color="#002200">{</font> <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> <font color="#002200">(</font> self <font color="#002200">=</font> <font color="#002200">[</font> super init <font color="#002200">]</font> <font color="#002200">)</font> <font color="#002200">)</font> <br>  <font color="#a61390">return</font> <font color="#a61390">nil</font> ; <br><br>  <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> zero_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">0</font> <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> self method <font color="#002200">:</font> <font color="#a61390">@selector</font> <font color="#002200">(</font> factorial <font color="#002200">:)</font> withParameter <font color="#002200">:</font> zero_ useBlock <font color="#002200">:</font> <font color="#002200">^</font> <font color="#002200">(</font> <font color="#a61390">id</font> obj_ <font color="#002200">)</font> <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">1</font> <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <font color="#002200">]</font> ; <br>  <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> one_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">1</font> <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> self method <font color="#002200">:</font> <font color="#a61390">@selector</font> <font color="#002200">(</font> factorial <font color="#002200">:)</font> withParameter <font color="#002200">:</font> one_ useBlock <font color="#002200">:</font> <font color="#002200">^</font> <font color="#002200">(</font> <font color="#a61390">id</font> obj_ <font color="#002200">)</font> <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">1</font> <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <font color="#002200">]</font> ; <br><br>  <font color="#a61390">return</font> self; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> <font color="#002200">)</font> factorial <font color="#002200">:</font> <font color="#002200">(</font> <font color="#400080">NSDecimalNumber</font> <font color="#002200">*</font> <font color="#002200">)</font> number_ <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">[</font> number_ decimalNumberByMultiplyingBy <font color="#002200">:</font> <br>  <font color="#002200">[</font> self factorial <font color="#002200">:</font> <font color="#002200">[</font> number_ decimalNumberBySubtracting <font color="#002200">:</font> <br>  <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">1</font> <font color="#002200">]</font> <font color="#002200">]</font> <font color="#002200">]</font> <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> </blockquote><br><br>  It works as expected: <br><blockquote>  Factorial <font color="#002200">*</font> factorial_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#002200">[</font> Factorial new <font color="#002200">]</font> autorelease <font color="#002200">]</font> ; <br>  <font color="#400080">NSNumber</font> <font color="#002200">*</font> number_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#400080">NSDecimalNumber</font> numberWithInteger <font color="#002200">:</font> <font color="#2400d9">10</font> <font color="#002200">]</font> ; <br>  NSLog <font color="#002200">(</font> <font color="#bf1d1a">@</font> <font color="#bf1d1a">"factorial% @ =% @"</font> , number_, <font color="#002200">[</font> factorial_ factorial <font color="#002200">:</font> number_ <font color="#002200">]</font> <font color="#002200">)</font> ; </blockquote><br> <code>factorial 10 = 3628800</code> <br> <br>  To parameterize the methods, we write a small wrapper class in which we override the ‚ÄúisEqual:‚Äù method and a convenient macro. <br><blockquote>  <font color="#6e371a">#define PMCLASS (x) [[[PMClass alloc] initWith: [x class]] autorealese]</font> <br>  <font color="#a61390">@interface</font> PMClass <font color="#002200">:</font> <font color="#400080">NSObject</font> &lt;NSCopying&gt; <br>  <font color="#a61390">@property</font> <font color="#002200">(</font> nonatomic, retain <font color="#002200">)</font> <font color="#a61390">Class</font> class; <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> initWith <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">Class</font> <font color="#002200">)</font> class_; <br>  <font color="#a61390">@end</font> <br><br>  <font color="#a61390">@implementation</font> PMClass <br>  <font color="#a61390">@synthesize</font> class <font color="#002200">=</font> _class; <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> dealloc <font color="#002200">{</font> <br>  <font color="#002200">[</font> _class release <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> super dealloc <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> initWith <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">Class</font> <font color="#002200">)</font> class_ <font color="#002200">{</font> <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> <font color="#002200">(</font> self <font color="#002200">=</font> <font color="#002200">[</font> super init <font color="#002200">]</font> <font color="#002200">)</font> <font color="#002200">)</font> <br>  <font color="#a61390">return</font> <font color="#a61390">nil</font> ; <br>  self.class <font color="#002200">=</font> class_; <br>  <font color="#a61390">return</font> self; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">BOOL</font> <font color="#002200">)</font> isEqual <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> object_ <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">[</font> self.class isEqual <font color="#002200">:</font> <font color="#002200">[</font> object_ class <font color="#002200">]</font> <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> copyWithZone <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">NSZone</font> <font color="#002200">*</font> <font color="#002200">)</font> zone_ <font color="#002200">{</font> <br>  <font color="#a61390">return</font> <font color="#002200">[</font> <font color="#002200">[</font> PMClass alloc <font color="#002200">]</font> initWith <font color="#002200">:</font> self.class <font color="#002200">]</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">@end</font> <br></blockquote><br>  Now the implementation can be chosen depending on the type of the argument. <br><blockquote>  <font color="#a61390">@interface</font> Test <font color="#002200">:</font> <font color="#400080">NSObject</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> test <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> obj_; <br>  <font color="#a61390">@end</font> <br><br>  <font color="#a61390">@implementation</font> Test <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> init <font color="#002200">{</font> <br>  <font color="#a61390">if</font> <font color="#002200">(</font> <font color="#002200">!</font> <font color="#002200">(</font> self <font color="#002200">=</font> <font color="#002200">[</font> super init <font color="#002200">]</font> <font color="#002200">)</font> <font color="#002200">)</font> <br>  <font color="#a61390">return</font> <font color="#a61390">nil</font> ; <br>  <font color="#002200">[</font> self method <font color="#002200">:</font> <font color="#a61390">@selector</font> <font color="#002200">(</font> test <font color="#002200">:)</font> withParameter <font color="#002200">:</font> PMCLASS <font color="#002200">(</font> <font color="#400080">NSNull</font> <font color="#002200">)</font> useBlock <font color="#002200">: ^</font> <font color="#002200">(</font> <font color="#a61390">id</font> obj_ <font color="#002200">)</font> <font color="#002200">{</font> <br>  NSLog <font color="#002200">(</font> <font color="#bf1d1a">@</font> <font color="#bf1d1a">"implementation for Null:% @"</font> , <font color="#002200">[</font> obj_ class <font color="#002200">]</font> <font color="#002200">)</font> ; <br>  <font color="#a61390">return</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> <font color="#a61390">nil</font> ; <br>  <font color="#002200">}</font> <font color="#002200">]</font> ; <br>  <font color="#a61390">return</font> self; <br>  <font color="#002200">}</font> <br>  <font color="#002200">-</font> <font color="#002200">(</font> <font color="#a61390">void</font> <font color="#002200">)</font> test <font color="#002200">:</font> <font color="#002200">(</font> <font color="#a61390">id</font> <font color="#002200">)</font> obj_ <font color="#002200">{</font> <br>  NSLog <font color="#002200">(</font> <font color="#bf1d1a">@</font> <font color="#bf1d1a">"default impl for Object:% @"</font> , <font color="#002200">[</font> obj_ class <font color="#002200">]</font> <font color="#002200">)</font> ; <br>  <font color="#002200">}</font> <br>  <font color="#a61390">@end</font> </blockquote><br>  We try: <br><blockquote>  Test <font color="#002200">*</font> test_ <font color="#002200">=</font> <font color="#002200">[</font> <font color="#002200">[</font> Test new <font color="#002200">]</font> autorealese <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> test_ test <font color="#002200">:</font> <font color="#bf1d1a">@</font> <font color="#bf1d1a">"String"</font> <font color="#002200">]</font> ; <br>  <font color="#002200">[</font> test_ test <font color="#002200">:</font> <font color="#002200">[</font> <font color="#400080">NSNull</font> null <font color="#002200">]</font> <font color="#002200">]</font> ; </blockquote><br> <code>default impl for Object: NSCFString <br> implementation for Null: NSNull</code> <br> <br>  What else could be done?  At a minimum, working with methods that have more than one argument, but this would greatly increase the article. <br>  As a result, we obtained implementations of comparison with the image and parameterized methods (albeit with a creepy syntax) in Objective-C. <br><br>  Obvious disadvantages - only objects can be used as parameters and ‚Äúimages‚Äù. <br><br>  I hope this article was at least helpful to someone, and after reading, there was a desire to learn more about Objective-C runtime magic.  If so, then an exciting reading for the night: <br>  <a href="http://developer.apple.com/library/mac/">Objective-C Runtime Programming Guide</a> <br>  <a href="http://developer.apple.com/library/mac/">Objective-C Runtime Reference</a> </div><p>Source: <a href="https://habr.com/ru/post/123187/">https://habr.com/ru/post/123187/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123179/index.html">I want to see</a></li>
<li><a href="../123180/index.html">What is a computer virus?</a></li>
<li><a href="../123182/index.html">IE10 PP2 released: WebWorkers, Drag & Drop, File API, CSS3 Positioned Floats, HTML5 Forms and more</a></li>
<li><a href="../123183/index.html">Google introduced a new tool for creating mobile sites</a></li>
<li><a href="../123186/index.html">PostSharp. Aspect-oriented programming vs Dependency Injection</a></li>
<li><a href="../123188/index.html">RIPE Visits Selectel Holds Training Courses in St. Petersburg</a></li>
<li><a href="../123190/index.html">Canobuvosti, 98th edition</a></li>
<li><a href="../123191/index.html">Mobile web development</a></li>
<li><a href="../123192/index.html">Design is not design</a></li>
<li><a href="../123194/index.html">The history of the confrontation between OpenGL and Direct3D</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>