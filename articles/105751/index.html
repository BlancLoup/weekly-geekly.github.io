<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>XenForo: A brief overview of the architecture of the forum for programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day. 

 In this article I will try to briefly describe the architecture of the new XenForo forum engine, the new competitor VBulletin and IPB, as...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>XenForo: A brief overview of the architecture of the forum for programmers</h1><div class="post__text post__text-html js-mediator-article">  Good day. <br><br>  In this article I will try to briefly describe the architecture of the new XenForo forum engine, the new competitor VBulletin and IPB, as far as I can after a couple of hours of acquaintance with the source.  About XenForo, designed by former authors of VBulletin3, Cyrus and Mike, I already <a href="http://habrahabr.ru/tag/xenforo/">wrote a little</a> . <br><br><img src="https://habrastorage.org/storage/3a826c02/2576f718/dfd06295/b78323d0.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><h4>  Dimensions </h4><br>  The size of the main part of the code XenForo 3.24 MB (3 405 312 bytes).  Another 8.31 MB (8,724,429 bytes) is occupied by the Zend Framework, which comes with the XenForo code. <br><br><h4>  MVC </h4><br>  XenForo is completely based on MVC architecture.  There are separate classes for models, types and controllers.  The root index.php has a size of 467 bytes and ends, as it should be in such cases <br><pre><code class="php hljs">$fc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XenForo_FrontController(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XenForo_Dependencies_Public()); $fc-&gt;run();</code> </pre> <br>  Of course, in the course of the autoloader classes.  Class naming system as in ZF. <br><br>  MVC itself is still using the Zend classes internally, but the fact that XenForo_Controller is not inherited from the corresponding ZF classes suggests that this part will be rewritten. <br><br>  All controllers are inherited in about the same way: class XenForo_ControllerPublic_Forum extends XenForo_ControllerPublic_Abstract.  After symfony with its actions, this approach is somewhat unusual, but you quickly get used to it. <br><br>  The routing system is designed extensible.  Expansion occurs by binding URL prefixes to handler classes.  SEO out of the box, of course.  No plugins required. <br><br><h4>  Content model </h4><br>  The XenForo architecture was built for a long time :) In any case, for the first time in the forum engine I met a more or less intelligible content architecture, slightly reminiscent of Drupal (‚ÄúEverything is a node‚Äù, remember?).  While in XenForo there are four types of content: category, forum section, page and link (normal redirect).  Everyone is also called Node.  Moreover, each instance of a node can be an ancestor / descendant of an instance of another type.  I do not know yet how this explosive mixture, for example, from the page and its affiliate section of the forum, will be displayed, did not try :).  Moreover, some types of content can be slightly expanded right out of the box.  For example, for a page besides, in fact, its HTML content, you can specify a PHP handler, which will receive additional data from the database, change the page design, insert information into it, or spit out an error to the user.  PHP handlers are indicated everywhere not by PHP code, as might be expected, but by class and method names.  When the hook is activated, the class will be loaded by the autoloader (accordingly, it must be correctly located in the file system). <br><br>  Content types are hard-coded for now, you won't be able to add them yourself.  For some reason, even their names are not localized in the admin panel. <br><br><h4>  Using third-party libraries </h4><br>  XenForo uses <a href="http://code.google.com/p/sabredav/">Saber</a> and Zend Framework.  Moreover, the presence in the code of places like <br><pre> <code class="php hljs">............ <span class="hljs-comment"><span class="hljs-comment">/*require_once('Zend/Loader/Autoloader.php'); $autoloader = Zend_Loader_Autoloader::getInstance(); $autoloader-&gt;pushAutoloader(array($this, 'autoload'));*/</span></span> spl_autoload_register(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>, <span class="hljs-string"><span class="hljs-string">'autoload'</span></span>));</code> </pre><br>  Most likely, it means that they will continue to get rid of unnecessary dependencies throughout development, replacing them with something more lightweight and more specialized. <br><br>  From ZF very few classes are used.  Among them, Zend_Registry (as a registry for singleton-like objects like XenForo_Db instance), Zend_Config, Zend_Cache (caches a lot of things, in particular, in the base class of models XenForo_Model). <br><br>  To work with the database, the Zend_DB bundle part (Zend_Db_Adapater_Abstract and Co.) is used, wrapped in the XenForo_DB class, which again indicates that this part will be later rewritten. <br><br>  The query designer is not used, they are built right into the code, as usual (which, of course, makes it difficult to support several databases. But on the other hand, queries are concentrated within the model, so ...) <br><br><h4>  Addons architecture </h4><br>  For the expansion of the forum there are several events where handlers can be hung.  Handlers are specified, as already mentioned, through the name of the class and method, which allows the use of accelerators like APC for add-on caching.  A list of handlers along with basic information about the plugin is placed in a * .xml file.  Writing it with your hands is not necessary.  It is enough to activate the debug mode on the forum and additional features will appear in the admin area.  PHP add-on files, of course, will first need to be unpacked into the appropriate folder.  The XenForo classes are in / library / XenForo, so yours will be in / library / VasyaCorp.  I was pleased, because quite often I searched for remnants of a plugin in the file system when it was deleted from VBulletin. <br><br>  Since virtually every addon must have settings, you can create them directly in the admin panel and export them to the * .xml plugin, along with information about hooks.  They are located in the same place where the settings of the XenForo itself.  You can embed them in arbitrary places in the general XenForo settings section.  Arranged everything about as well as it was in VBulletin.  Very convenient and virtually no need to write code to support them. <br><br>  I was a little surprised by the number of hooks.  I suppose everyone remembers the deafening number of hooks in VBulletin, which even in the head could not be kept?  In XenForo, only 17 hooks!  This number is due to their purpose.  Here are their names: <br><br><ul><li>  container_admin_params </li><li>  container_public_params </li><li>  controller_pre_dispatch </li><li>  front_controller_post_view </li><li>  front_controller_pre_dispatch </li><li>  front_controller_pre_route </li><li>  front_controller_pre_view </li><li>  init_dependencies </li><li>  load_class_bb_code </li><li>  load_class_controller </li><li>  load_class_datawriter </li><li>  load_class_model </li><li>  load_class_route_prefix </li><li>  load_class_search_data </li><li>  load_class_view </li><li>  navigation_tabs </li><li>  visitor_setup </li></ul><br><br>  A small code inspection showed that the load_class_ * family of hooks is intended to dynamically extend the XenForo class system.  Here is the key piece of code: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">resolveDynamicClass</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($class, $type, $fakeBase = false)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!XenForo_Application::autoload($class)) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($fakeBase) { $fakeNeeded = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { $fakeNeeded = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_classCache[$class])) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>::$_classCache[$class]; } $createClass = $class; $extend = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(); XenForo_CodeEvent::fire(<span class="hljs-string"><span class="hljs-string">'load_class_'</span></span> . $type, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>($class, &amp;$extend)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($fakeNeeded) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$extend) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">eval</span></span>(<span class="hljs-string"><span class="hljs-string">'class '</span></span> . $class . <span class="hljs-string"><span class="hljs-string">' extends '</span></span> . $fakeBase . <span class="hljs-string"><span class="hljs-string">' {}'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($extend) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($extend <span class="hljs-keyword"><span class="hljs-keyword">AS</span></span> $dynamicClass) { <span class="hljs-comment"><span class="hljs-comment">// XenForo Class Proxy, in case you're wondering $proxyClass = 'XFCP_' . $dynamicClass; eval('class ' . $proxyClass . ' extends ' . $createClass . ' {}'); XenForo_Application::autoload($dynamicClass); $createClass = $dynamicClass; } } catch (Exception $e) { self::$_classCache[$class] = $class; throw $e; } } self::$_classCache[$class] = $createClass; return $createClass; }</span></span></code> </pre><br><br>  A somewhat unexpected use of the visitor_setup hook to change everything on the page is shown <a href="http://xenforo.com/community/threads/creating-a-simple-modification.3532/">here</a> .  Practically through any hook you can climb into the heart of the system <s>and make a deal</s> . <br><br>  In general, a small number of hooks seem to be quite compensated by their power. <br><br><h4>  Template System </h4><br>  As with all modern forums in XenForo there are a bunch of patterns.  The syntax is quite powerful (see the passages below), however, this will not surprise anyone.  Spetstagi written as in PHPTAL ("neympasirovannyy" XML / HTML).  One template can contain multiple files.  For example, the template forum_list contains forum_list, node_list (it is inserted into forum_list), node_list.css, sidebar.css, sidebar_online_users.  CSS in the template is connected via xen: require, which allows you to cache all CSS files as you like. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:require</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">css</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"node_list.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:if</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">hascontent</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ol</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"nodeList sectionMain"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"forums"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:contentcheck</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$renderedNodes"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$node"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:raw $node}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:contentcheck</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ol</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">fieldset</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:if</span></span></span><span class="hljs-tag">&gt;</span></span> ------------------------------------- <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:edithint</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">template</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"node_link.css"</span></span></span><span class="hljs-tag"> /&gt;</span></span> ------------------------------------- <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:contentcheck</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">loop</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$onlineUsers.records"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$user"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:if</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">is</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{$user.is_moderator} OR {$user.is_admin}"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:avatar</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">user</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"$user"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"s"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">img</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">href</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"{xen:link members, $user}"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"username"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:helper richUserName, $user}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">a</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"muted"</span></span></span><span class="hljs-tag">&gt;</span></span>{xen:helper userTitle, $user}<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">li</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:if</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:foreach</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">xen:contentcheck</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Note the use of helpers in the templates.  A helper, as in symfony, is just a class method.  For example, here's helperUserLink helper code: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">helperUserLink</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(array $user)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'&lt;a href="'</span></span> . XenForo_Link::buildPublicLink(<span class="hljs-string"><span class="hljs-string">'members'</span></span>, $user) . <span class="hljs-string"><span class="hljs-string">'" class="username"&gt;'</span></span> . htmlspecialchars($user[<span class="hljs-string"><span class="hljs-string">'username'</span></span>]) . <span class="hljs-string"><span class="hljs-string">'&lt;/a&gt;'</span></span>; }</code> </pre><br><br><h4>  Search engine </h4><br>  The search engine in XenForo is implemented as a separate class (as opposed to the implementation I hate in VB, in which, in my opinion, the developers themselves have long been confused, they simply do not recognize it) inherited from XenForo_Search_SourceHandler_Abstract.  Currently, there is only one implementation - MySqlFt.php (class XenForo_Search_SourceHandler_MySqlFt extends XenForo_Search_SourceHandler_Abstract), but Sphinx should appear in the near future.  Fashion is now :) Forums are not the same as before.  Growing like yeast ... <br><br>  In the admin there is no option to activate another search engine, but do not forget that it is still Beta. <br><br><h4>  Localization system </h4><br>  The localization system almost completely repeats its counterpart from VBulletin with the exception that there are no phrase groups at all.  Here is the beginning of the English phrase file: <br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phrases</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phrase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1_more_message"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">global_cache</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1000017"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version_string</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0 Alpha 7"</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[1 more message]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phrase</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phrase</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">title</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"about"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">global_cache</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version_id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1000015"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version_string</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0 Alpha 5"</span></span></span><span class="hljs-tag">&gt;</span></span>&lt;![CDATA[About]]&gt;<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">phrase</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Each addon can have its own phrases.  Languages ‚Äã‚Äãcan be exported.  Addons can be translated directly in the admin panel. <br><br>  By the way, the Russian localization of XenForo <a href="http://www.xf-russia.ru/forum/forums/%25D0%25A0%25D1%2583%25D1%2581%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8-%25D0%25B4%25D0%25BB%25D1%258F-xenforo.7/">is almost ready</a> . <br><br><h4>  Style system </h4><br>  I'm not a designer, and generally I have a bad taste.  Everything related to design and its development scares me.  But in XenForo we see a tree-like style system, similar to VB, in which we can take some style as a basis and change some of its settings or patterns.  Only Cyrus and Mike implemented the coolest CSS editor that I had ever seen in my life.  Dreamweaver is resting :).  In XenForo, everything is configured and configured quite visually.  Forget about editing CSS directly, about a sheet with two thousand variables that some bad guy implemented a bad guy in VB.  Here everything is very well grouped so that 99% of the sections fit on one screen.  If you are not as fuzzy in terms of design as I have artistic taste, you can probably dismiss your designer, since you can make the style yourself (in a couple of months, as you play around with the editor). <br><br><h4>  Authentication system </h4><br>  Do you have a database, say from WordPress?  Import users from WP into the XenForo database and save their passwords!  In order for it to work, you just have to expand the XenForo_Authentication_Abstract class to tell XenForo how to verify the password.  User data with your authentication systems is linked to the xf_user_authenticate table. <br><br><h4>  Communication services </h4><br>  Already for a long time on the forums allowed to indicate your contacts in various communication systems such as ICQ.  XenForo has an easily expandable contact service system.  Services can be added to the control panel.  The service support class looks like this: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XenForo_Model_IdentityService_Icq</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">XenForo_Model_IdentityService_Abstract</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_getIdentityServiceId</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">'icq'</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">verifyAccountName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(&amp;$accountName, &amp;$error)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!preg_match(<span class="hljs-string"><span class="hljs-string">'/^\d+$/'</span></span>, $accountName)) { $error = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XenForo_Phrase(<span class="hljs-string"><span class="hljs-string">'please_enter_valid_icq_uin_using_numeric_characters_only'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } }</code> </pre><br><br>  Now no one will be able to enter the line ‚ÄúSelling wool socks‚Äù in the ICQ field of your profile :) <br><br><h4>  The system of rights and privileges </h4><br>  Each user group of the system has permissions by default.  Plus, the rights of each group can be further configured in any type of node.  Of course, privileges are inherited. <br><br>  There are four types of permissions.  Inherit, Allow, Revoke, Deny.  So far I have not managed to understand how Revoke differs from Deny.  Moreover, Revoke is absent in the rights of the group by default, which suggests that this type is associated with the inheritance of rights. <br><br>  After switching the forum to debug mode, you can add new types of privileges to the system (add-ons can also add them).  In the code, they are checked like this: <br><pre> <code class="php hljs">$users[$userId][<span class="hljs-string"><span class="hljs-string">'canCleanSpam'</span></span>] = (XenForo_Permission::hasPermission($visitor[<span class="hljs-string"><span class="hljs-string">'permissions'</span></span>], <span class="hljs-string"><span class="hljs-string">'general'</span></span>, <span class="hljs-string"><span class="hljs-string">'cleanSpam'</span></span>) &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getModelFromCache(<span class="hljs-string"><span class="hljs-string">'XenForo_Model_User'</span></span>)-&gt;couldBeSpammer($users[$userId]));</code> </pre><br><br><h4>  General impressions </h4><br>  In general, the XenForo code made a good impression on me.  It is beautiful, clear, harmonious, full of comments and PLO.  At first, looking at the number of classes, I was going to get scared and postpone the article until better times, but now, getting to the end, I can say that already almost everything is OK, I moved a little, how it all worked.  I hope you have a little too. <br><br>  By the way, I was really looking forward to the release of PHPBB3, I wanted to take them seriously.  But its architecture for me looks much less clear and logical than the XenForo architecture.  Honestly, I never entered PHPBB3.  Let's wait for the four on Symfony2 ... <br><br>  Here, perhaps, that's all.  Questions on plugins for XenForo can be asked <a href="http://www.xf-russia.ru/forum/forums/%25D0%259F%25D0%25BB%25D0%25B0%25D0%25B3%25D0%25B8%25D0%25BD%25D1%258B-%25D0%25B8-%25D0%25BC%25D0%25BE%25D0%25B4%25D0%25B8%25D1%2584%25D0%25B8%25D0%25BA%25D0%25B0%25D1%2586%25D0%25B8%25D0%25B8-%25D0%25B4%25D0%25BB%25D1%258F-xenforo.6/">here</a> .  And on the <a href="http://xenforo.com/community/forums/add-on-releases.32/">official forum</a> there are already a few (18 at the moment), you can download and watch.  I myself have not bought a license for the engine, there was no reason.  Therefore, for the code provided for study, I thank my friends who have already bought the official version. <br><br>  I apologize if this article seems to someone to be incomplete or incorrectly constructed.  This is my first review of the architecture of something, so I‚Äôm happy to accept any criticism in the comments.  Part of the criticism, I suppose, I will immediately see on my karma and rating :) If you are still interested in knowing something, let us know in the comments, if I can figure it out quickly - I‚Äôll add an article. </div><p>Source: <a href="https://habr.com/ru/post/105751/">https://habr.com/ru/post/105751/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../105744/index.html">Review of the Zenithink Zt-180 10 tablet "</a></li>
<li><a href="../105745/index.html">"And I love on the floor" massive flashmob Runet</a></li>
<li><a href="../105746/index.html">Mood lamp</a></li>
<li><a href="../105748/index.html">Microsoft offers 3,500 Visual Studio licenses at a 60% discount.</a></li>
<li><a href="../105749/index.html">Search form in the issue</a></li>
<li><a href="../105752/index.html">Spam from Samsung?</a></li>
<li><a href="../105753/index.html">Google code-in</a></li>
<li><a href="../105755/index.html">DevPoint 2. Results</a></li>
<li><a href="../105756/index.html">IPad Abacus</a></li>
<li><a href="../105758/index.html">Parallels and VMware War, yesterday and today</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>