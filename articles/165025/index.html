<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Simple way to create complex ASP.NET MVC controls</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Surely everyone created their asp.net mvc controls (this is, of course, about asp.net mvc coders). Should you be familiar with the method for creating...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Simple way to create complex ASP.NET MVC controls</h1><div class="post__text post__text-html js-mediator-article">  Surely everyone created their asp.net mvc controls (this is, of course, about asp.net mvc coders).  Should you be familiar with the method for creating controls using <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.tagbuilder%2528v%3Dvs.100%2529.aspx">TagBuilder</a> ?  Tried to write really complex controls (for example, with a large number of javascript or markup, which depends on the options)?  Then surely you are familiar with ad escaping quotes, string concatenation (or calling the .Format () function), etc.  "Inconvenience."  I propose to look at a fairly simple technique that will avoid such things and at the same time focus on the functional side of the controls, and not on the programming of the husk. <br><a name="habracut"></a><br><h4>  Denial of responsibility </h4><br>  Much of what will be said here may turn out to be a wild accordion and govnokodom.  In addition, this post is designed to be quite puzzled by the problems of the people described in the first paragraph.  This is not a tutorial, and not a guide to action.  This is only a description of the campaign, and no more than. <br><h4>  Classic creation of ASP.NET MVC controls </h4><br>  Let's briefly go over how the controls are now molded. <br>  Usually do HtmlHelper extension like this: <br><pre><code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputExControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HtmlHelper @</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { StringBuilder sb = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> StringBuilder(); sb.Append(<span class="hljs-string"><span class="hljs-string">"&lt;input type=\"text\"&gt;.......blablabla.........."</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sb.ToString(); }</code> </pre> <br>  or use TagBuilder for the same purpose: <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputExControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> HtmlHelper @</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span></span><span class="hljs-function">)</span></span> { TagBuilder tagBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> TagBuilder(<span class="hljs-string"><span class="hljs-string">"input"</span></span>); <span class="hljs-comment"><span class="hljs-comment">//.....blablabla.... return tagBuilder.ToString();</span></span></code> </pre><br><br>  Personally, it turns me up from this code: at least this code is difficult to maintain (IMHO), and, moreover, it's not easy to modify it either. <br><br><h4>  Task </h4><br>  Let's set such a task: we need to make the <strong>input</strong> control with AJAX validation on the server side (based on the specified Regexp), an indication of the validation result, and so that the control is in a separate assembly.  This is a simple control that will show the general idea. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  How do others do it? </h4><br>  To begin, consider a few libraries, similar in functionality, to understand how they do it: <br><ul><li>  <a href="http://mvccontrolstoolkit.codeplex.com/">The MVC Controls Toolkit</a> uses the HtmlHelper helper method to return a StringBuilder from a HtmlHelper helper. </li><li>  <a href="http://mvccontrib.codeplex.com/">The MVCContrib project</a> uses TagBuilder. <br></li></ul><br><br>  Other commercial controls mainly use the ‚ÄúStringBuilder.Format ()‚Äù approach (for pure asp.net mvc controls), but may (like DevExpress) pull asp.net webForms controls. <br><br><h4>  Idea </h4><br>  The idea is to use the asp.net mvc partial view asp.net syntax to describe the control in .cshtml, but without dragging the .cshtml files along, of course. <br><br>  Let's create a simple asp.net mvc 4 project in the studio, add to the library solution (let's call it MyControlLib), in which we will reference the main asp.net mvc 4 libs. <br><br>  Add the InputExControl.cshtml file with empty content to MyControlLib.  This will be our View-part of the control that we previously wrote using the TagBuilder technique.  In order to translate this cshtml file into C # code, we will use the <a href="http://razorgenerator.codeplex.com/">Razor Generator</a> .  It will allow us to generate what Razor engines would generate us on the fly in an asp.net mvc application.  It is necessary as a matter of fact in order not to drag .cshtml files behind you and appear as an ‚Äúadult control‚Äù (commercial ones don‚Äôt pull, so we won‚Äôt become).  Okay, let's put the following in InputExControl.cshtml contents: <br><pre> <code class="hljs markdown">@<span class="hljs-bullet"><span class="hljs-bullet">* Generator: MvcView *</span></span>@</code> </pre><br>  , and in its properties we specify the Custom Tool as the RazorGenerator. <br><br>  Received a derived class derived from System.Web.Mvc.WebViewPage.  The generation is not very convenient, because  creates a non-partial class (you can fix it in the source code of the generator or simply by hand in the generated file), i.e.  such a class is hard to expand using the methods we need. <br><br>  Let's create the class <strong>InputExControlSettings</strong> , which will personify the settings of our control.  It will be very simple: <br><pre> <code class="hljs pgsql"> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> InputExControlSettings { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string <span class="hljs-type"><span class="hljs-type">Name</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> dynamic CallbackRouteValues { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //  ajax callback- <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> string ValidationRegexp { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } //   }</code> </pre><br>  For simplicity, I started the Name field, which will impersonate its id in the client code (the property of the DOM element).  Also this field will participate in the generation of the names of the sub-elements needed by our control (validation result indicator). <br><br>  We will need the <strong>CallbackRouteValues</strong> property to get Uri where we send a validation request from client javascript.  It usually indicates the controller and controller method. <br><br>  Now the settings class can be specified as a model for our control-cshtml file: <br><pre> <code class="hljs pgsql">@* Generator: MvcView *@ @model InputExControlSettings @{ //     ,       string controlId = Model.Name; string controlResultId = Model.Name + "_Result"; }</code> </pre><br><br>  In order to write the code, we need to understand one simple thing: the callback will generally pull our control, therefore we need to somehow distinguish the callback from a simple GET request to get the look of the control.  For us, by a simple method of definition, I chose the presence in the headers of a request of ‚Äúspecial‚Äù (our) value.  So  we got a small helper.  In addition, I used it (bad code!) As an assistant to get Uri from <strong>CallbackRouteValues</strong> values: <br><pre> <code class="hljs cs"> <span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputExControlHelper</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">bool</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">IsCallback</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> !<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.IsNullOrEmpty(HttpContext.Current.Request.Headers[<span class="hljs-string"><span class="hljs-string">"InputExControAjaxRequest"</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> MvcHtmlString CallbackHeaderName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MvcHtmlString.Create(<span class="hljs-string"><span class="hljs-string">"InputExControAjaxRequest"</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetUrl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">dynamic</span></span></span></span><span class="hljs-function"><span class="hljs-params"> routeValues</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HttpContext.Current == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> InvalidOperationException(<span class="hljs-string"><span class="hljs-string">"no context"</span></span>); RequestContext context; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (HttpContext.Current.Handler <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> MvcHandler) { context = ((MvcHandler) HttpContext.Current.Handler).RequestContext; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> httpContext = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HttpContextWrapper(HttpContext.Current); context = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RequestContext(httpContext, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouteData()); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> helper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UrlHelper(context, RouteTable.Routes); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> helper.RouteUrl(<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>.Empty, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RouteValueDictionary(routeValues)); } }</code> </pre><br><br>  Okay, it's time to write the code for the presentation of our control: <br><div class="spoiler">  <b class="spoiler_title">view cshtml code</b> <div class="spoiler_text"><pre> <code class="hljs javascript">@* Generator: MvcView *@ @model InputExControlSettings @{ string controlId = Model.Name; string controlResultId = Model.Name + <span class="hljs-string"><span class="hljs-string">"_Result"</span></span>; } @<span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!InputExControlHelper.IsCallback()) { &lt;input type=<span class="hljs-string"><span class="hljs-string">"text"</span></span> id=<span class="hljs-string"><span class="hljs-string">"@controlId"</span></span>/&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"@controlResultId"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">span</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> &lt;script&gt; $(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#@controlId'</span></span>).change(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ $(<span class="hljs-string"><span class="hljs-string">'#@controlResultId'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'validating ...'</span></span>); $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: <span class="hljs-string"><span class="hljs-string">'@InputExControlHelper.GetUrl(Model.CallbackRouteValues)'</span></span>, <span class="hljs-attr"><span class="hljs-attr">headers</span></span>: { <span class="hljs-string"><span class="hljs-string">'@InputExControlHelper.CallbackHeaderName'</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> }, <span class="hljs-attr"><span class="hljs-attr">cache</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">data</span></span>: { <span class="hljs-attr"><span class="hljs-attr">value</span></span>: $(<span class="hljs-string"><span class="hljs-string">'#@controlId'</span></span>).val() }, <span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'POST'</span></span>, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span>, <span class="hljs-attr"><span class="hljs-attr">success</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (data) { $(<span class="hljs-string"><span class="hljs-string">'#@controlResultId'</span></span>).text(<span class="hljs-string"><span class="hljs-string">'Validattion result: '</span></span> + data.result); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { alert(<span class="hljs-string"><span class="hljs-string">'result error?'</span></span>); } }, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ alert(<span class="hljs-string"><span class="hljs-string">'ajax error'</span></span>); } }); }); }); <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">script</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span> } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { System.Web.HttpContext.Current.Response.ContentType = <span class="hljs-string"><span class="hljs-string">"application/json"</span></span>; @(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.InternalValidate(System.Web.HttpContext.Current.Request.Form[<span class="hljs-string"><span class="hljs-string">"value"</span></span>])) }</code> </pre><br></div></div><br><br>  The code is as simple as possible: if we don‚Äôt have a callback, then we display the main View, including javascript, which will do the same callback.  In the case of callback, we set ContentType as JSON and call the <code>InternalValidate(string)</code> control validation method. <br><br>  Actually, the code itself validation and installation of ViewData.Model will be designed as a partial InputExControl method and will be very simple: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">partial</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">InputExControl</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InputExControl</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">InputExControlSettings settings</span></span></span><span class="hljs-function">)</span></span> { ViewData.Model = settings; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> MvcHtmlString </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InternalValidate</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">value</span></span></span></span></span><span class="hljs-function">)</span></span> { Thread.Sleep(<span class="hljs-number"><span class="hljs-number">2000</span></span>); <span class="hljs-comment"><span class="hljs-comment">//long validation emulator... var settings = ViewData.Model; var regexp = new Regex(settings.ValidationRegexp, RegexOptions.Compiled); var res = regexp.IsMatch(value); var scriptSerializer = new JavaScriptSerializer(); var rv = scriptSerializer.Serialize(new { result = res }); return MvcHtmlString.Create(rv); } }</span></span></code> </pre><br><br>  Ok, we wrote a control, but we can't use it in our MVC project yet.  The real boys write the HtmlHelper extender for such controls, which we will do: <br><pre> <code class="hljs pgsql">namespace MyControlLib { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> HtmlExtensions { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> static HtmlString InputEx(this HtmlHelper @this, Action&lt;InputExControlSettings&gt; setupFn) { var <span class="hljs-keyword"><span class="hljs-keyword">options</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> InputExControlSettings(); //   setupFn(<span class="hljs-keyword"><span class="hljs-keyword">options</span></span>); //  var <span class="hljs-keyword"><span class="hljs-keyword">view</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> InputExControl(<span class="hljs-keyword"><span class="hljs-keyword">options</span></span>); //   var tempWriter = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> StringWriter(CultureInfo.InvariantCulture); //       Razor <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.PushContext(<span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WebPageContext(), tempWriter); //   <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.<span class="hljs-keyword"><span class="hljs-keyword">Execute</span></span>(); //  <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> -     <span class="hljs-keyword"><span class="hljs-keyword">view</span></span>.PopContext(); //   <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> MvcHtmlString.<span class="hljs-keyword"><span class="hljs-keyword">Create</span></span>(tempWriter.GetStringBuilder().ToString()); //    <span class="hljs-keyword"><span class="hljs-keyword">View</span></span> } } }</code> </pre><br><br>  Okkay, we now have an expander method.  It's time to integrate our control into the main application.  Simply create a PartialView MyInputCtrlPartial (and an Action method named as well), where enter something like <br><pre> <code class="hljs pgsql">@<span class="hljs-keyword"><span class="hljs-keyword">using</span></span> MyControlLib @Html.InputEx(s=&gt; { s.Name = "MyInputCtrl"; s.CallbackRouteValues = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> { Controller = "Home", Action = "MyInputCtrlPartial" }; s.ValidationRegexp = @"^\d+$"; })</code> </pre><br><br>  and call it (using <a href="https://habrahabr.ru/users/html/" class="user_link">Html</a> .Partial ("MyInputCtrlPartial")) in the main View. <br><br>  We need to describe the control in PartialView, since  the result of the "rendering" will be different - depending on the transferred header indicator that we have a callback to check. <br><br>  It remains only to launch the project for execution and make sure that everything works (or does not work, because someone has nakosyachil) (note: in order to trigger the changed event, you need to poke past the control with the mouse). <br><br><h4>  Total </h4><br>  Bottom line: we were able to write a difficult control, while Intellisense works in the Razor template (including javascript), which is good news. <br><br>  <i>A sample project can be downloaded from <a href="http://rghost.ru/42818685">http://rghost.ru/42818685</a> ( <a href="http://rusfolder.com/34417008">mirror</a> ).</i> <br><br>  Comments are welcome. </div><p>Source: <a href="https://habr.com/ru/post/165025/">https://habr.com/ru/post/165025/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../165011/index.html">The first flash drive for 1 terabyte</a></li>
<li><a href="../165013/index.html">It was evening, echo "there was nothing"</a></li>
<li><a href="../165017/index.html">A complete set of packages for development using NodeJS</a></li>
<li><a href="../165021/index.html">nil, Nil, NULL, NSNull. All is nothing</a></li>
<li><a href="../165023/index.html">Screens Liquavista - left to wait quite a bit?</a></li>
<li><a href="../165027/index.html">Rare Toshiba Satellite Pro 430CDT Laptop</a></li>
<li><a href="../165029/index.html">Does the AVR USB Programmer not work? Set up</a></li>
<li><a href="../165031/index.html">Emulation of the ternary system. Concept version</a></li>
<li><a href="../165035/index.html">Firefox 18 is released</a></li>
<li><a href="../165037/index.html">Correspondence Olympiad FUPM MIPT</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>