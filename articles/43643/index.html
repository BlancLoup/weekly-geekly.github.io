<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We roll into battle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The implementation of the final web product is not the most pleasant procedure for the creator and is often accompanied by terrible stress. The develo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We roll into battle</h1><div class="post__text post__text-html js-mediator-article"><img src="http://img-fotki.yandex.ru/get/2714/sevilli.0/0_2736c_a1e7cdbe_L" alt="To battle!" align="left">  The implementation of the final web product is not the most pleasant procedure for the creator and is often accompanied by terrible stress.  The developer's dislike for releases is associated not only with feelings of responsibility and fear of exploiting the new version, but also with feelings of uncertainty: what will happen after we introduce ourselves? <br><br>  Applications can be developed by a large team of programmers, quality engineers, graphical interfaces, but at the end of the project path, the last of the Mohicans takes responsibility.  The lack of theoretical knowledge makes our hero nervous, because the experience gained through trial and error, under the hour is not enough for a systematically successful implementation.  To figure out how to roll out web projects into battle, let's start with the basics. <a name="habracut"></a><br><br><h2>  General Staff Plan </h2><img src="http://img-fotki.yandex.ru/get/3203/sevilli.0/0_2736b_6520990b_orig" alt="development process">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      After receiving the requirements, specifications, various recommendations and instructions, the developer allocates space for his maneuvers in the source code repository.  This area can be a personal SVN branch, a new module in CVS or a folder on the file system. <br><br>  It makes no sense to talk in detail about the subsequent cycles of ‚ÄúDevelop - Test - Deploy‚Äù: it is written about them and so many useful things.  I will note only important observations: <ul><li>  <b>Each developer's application should use personal databases and file storages.</b>  Use a common "trash" - evil, causing serious errors. </li><li>  <b>The development of autotests is not always justified</b> : their implementation should not take more than 20% of the working time.  <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B0%25D0%25B7%25D1%2580%25D0%25B0%25D0%25B1%25D0%25BE%25D1%2582%25D0%25BA%25D0%25B0_%25D1%2587%25D0%25B5%25D1%2580%25D0%25B5%25D0%25B7_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">Develop through testing</a> - the extreme degree of waste. </li><li>  <b>The more participants in the process, the more often it is necessary to merge</b> and check the collective result.  <a href="http://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B5%25D0%25BF%25D1%2580%25D0%25B5%25D1%2580%25D1%258B%25D0%25B2%25D0%25BD%25D0%25B0%25D1%258F_%25D0%25B8%25D0%25BD%25D1%2582%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B0%25D1%2586%25D0%25B8%25D1%258F">Continuous integration</a> can help, but maintaining it can be expensive - you need to balance between automation and cost. </li></ul>  The final results of the development are recorded in the release candidate (the branches merge, a tag is created, etc.) and transferred to acceptance testing.  A release candidate is an end-to-end monolithic product that cannot be modified.  If you need to correct mistakes, refine the functionality, you need to start from the beginning and make a new candidate. <br><br><h2>  Hard to learn </h2>  It is worth noting that many managers conduct acceptance testing in the development environment, which is fundamentally wrong.  It is clear that to make a separate candidate for nano-bugs is very lazy (and wasteful).  But the procedure of introduction to the test platform, once worked out, will significantly save the developer time and nerves.  Moreover, no one bothers to put small fixes into groups and fix them in one version of the product. <br><br>  The main hints of acceptance testing: <ul><li>  <b>The scenario of the introduction of the candidate should be as close as possible to the scenario of the introduction of the release.</b>  If in the final release it is planned to update the database structure, migrate data, add third-party libraries - all this must be done in the sequence in which the release is supposed to be implemented. </li><li>  <b>The test platform conditions should be as close as possible to the combat conditions.</b>  If the application uses a cluster of 5 memcached servers, prepare&gt; 1 server on the test platform.  If the application uses 1 DBMS master server in RW mode and 2 slave servers in RO mode, reconstruct the complete replication scheme.  To save on equipment for testing distributed systems will help free <a href="http://www.vmware.com/products/server/">VMWare Server</a> (or any other equivalent, except Virtuozzo).  Versions of system libraries, OS kernels, etc. should also coincide with the versions of the corresponding components of the combat platform. </li><li>  <b>Load testing is a floating acceptance testing problem.</b>  It is impossible to completely recreate the release conditions: we do not know what the load will be exactly, we can only assume.  Yes, and create a complete copy of the combat platform is expensive.  For adequate testing, bottlenecks are usually identified in the application, their maximum stability values ‚Äã‚Äãare measured for them and the results are approximated to the expected loads. </li><li>  <b>Testing should be <a href="http://ru.wikipedia.org/wiki/%25D0%25A0%25D0%25B5%25D0%25B3%25D1%2580%25D0%25B5%25D1%2581%25D1%2581%25D0%25B8%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE%25D0%25B5_%25D1%2582%25D0%25B5%25D1%2581%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">regression</a></b> , but you need to balance between quality and cost.  If only cosmetic changes are made to the interface, it makes no sense to run the test plan completely. </li><li>  <b>Do not forget to roll back the application</b> , return to the previous version should be carefully worked out. </li></ul>  The transition from the candidate to the release may take a certain number of iterations "Candidate - Testing - Change".  During the cycle, there will be new bugs, changing requirements and changes.  Ultimately, you have to break the vicious circle and make a release.  And it is extremely rare for a pre-release test report to be 100% complete (developers in such cases are otmazyvatsya prefix <b>beta</b> ). <blockquote>  <i>I once ruled the development of a portal about advertising.</i>  <i>The team then had to roll out ~ 20 candidates before the release was introduced.</i>  <i>The release was implemented from the 10th time.</i>  <i>The final test report was successful at ~ 70%.</i>  <i>Not the most successful project in my life.</i> </blockquote><h2>  To arms </h2>  The order of introduction of the release should be as follows: <ol><li>  <b>We introduce new versions of platform components</b> .  We update libraries, services, etc., while keeping the tool for rolling back to the old versions. </li><li>  <b>We implement a DB and file storage</b> .  If the previous version of the application is working in combat, you need to prepare in advance the old release to support the new storage structure.  The story is this: <ul><li>  We add to the previous release support for a new storage scheme </li><li>  we introduce the changed previous release </li><li>  we introduce a new storage structure and migrate data (the previous release should work in the old logic with the new storage) </li><li>  introducing a new release </li></ul></li><li>  <b>We implement the application</b> . </li><li>  <b>Testing the application</b> . </li><li>  <b>Roll back</b> (if necessary). </li></ol>  In the case of a fackup, we roll back to the previous version in the reverse order: <ol><li>  <b>Roll back the application</b> . </li><li>  <b>Roll back the database and file storage</b> (if necessary). </li><li>  <b>Roll back platform components</b> (if necessary). </li></ol><h2>  Application to battle </h2>  First, the application must be designed in such a way that its folder structure is separated from the file storage. <table><tbody><tr><td>  <font color="green"><b>Right</b></font> <pre> / var / www / myproject /
	 / etc /
	 / lib /
	 / classes /
	 / images /
	 / templates /
	 index.php
 / var / www / userdata /
	 / images /
	 / video /
</pre></td><td>  <font color="red"><b>Not properly</b></font> <pre> / var / www / myproject /
	 / etc /
	 / lib /
	 / classes /
	 / images /
	 / templates /
	 / userdata /
		 / images /
		 / video /
	 index.php
</pre></td></tr></tbody></table>  Secondly, it is necessary to control versions of third-party libraries.  To be sure that the supported version of the Zend Framework library is used in combat, you must either include the library in the folder structure of the application (and keep it in <i>svn</i> ), or present the release as a package (for example, <i>deb</i> ) with which to check dependencies. <br><br>  Thirdly, many developers embed an application into battle with an update from the source code repository ( <i>svn up</i> ).  This approach can only be <i>compared</i> with <i>rm ‚Äìrf /</i> .  The release must be completely removed from the repository and placed in a separate place from the previous release. <table><tbody><tr><td>  <b>Releases are placed in separate folders on the battle platform.</b> <pre> user @ stable: ~ / apps / myproject $ ls -la
 drwxr-xr-x 12 user www-data 4096 Oct 29 11:38.
 drwxr-xr-x 5 user www-data 4096 May 13 23:22 ..
 drwxr-xr-x 8 user www-data 4096 Oct 22 17:11 rel_0.5.1
 drwxr-xr-x 8 user www-data 4096 Oct 27 13:17 rel_0.5.1.1
 drwxr-xr-x 8 user www-data 4096 Oct 28 02:07 rel_0.5.1.2
 drwxr-xr-x 8 user www-data 4096 Oct 29 11:38 rel_0.5.2
 user @ stable: ~ / apps / myproject $ svn co svn + ssh: //user@svn.myproject.ru/myproject/tags/rel_0.5.2.1
 ...
 user @ stable: ~ / apps / myproject $ ls -la
 drwxr-xr-x 12 user www-data 4096 Oct 29 11:38.
 drwxr-xr-x 5 user www-data 4096 May 13 23:22 ..
 drwxr-xr-x 8 user www-data 4096 Oct 22 17:11 rel_0.5.1
 drwxr-xr-x 8 user www-data 4096 Oct 27 13:17 rel_0.5.1.1
 drwxr-xr-x 8 user www-data 4096 Oct 28 02:07 rel_0.5.1.2
 drwxr-xr-x 8 user www-data 4096 Oct 29 11:38 rel_0.5.2
 drwxr-xr-x 8 user www-data 4096 Oct 29 12:31 rel_0.5.2.1
</pre></td></tr></tbody></table>  After extracting the source code, the project is installed (configurable configs, permissions, starting data) and tested next to a working release, for which a separate virtual web server host can be used (for example, <i>www-test.myproject.ru</i> ).  After running the test plan, the previous release is replaced by a new one.  The following options for replacing releases are known: changing the symbolic link, <i>mount_null</i> , changing the web server <i>config</i> , followed by <i>graceful restart</i> . <table><tbody><tr><td>  <b>With a symbolic link we switch the project from one release to another.</b> <b><br></b>  <b>In the same way, you can roll back to the previous version.</b> <pre> user @ stable: ~ / httpdocs / $ ls ‚Äìla
 drwxr-xr-x 3 user www-data 4096 Oct 29 11:40.
 drwxr-xr-x 9 user www-data 4096 Oct 28 21:25 ..
 lrwxrwxrwx 1 user www-data 27 Oct 29 11:40 pro -&gt; ../apps/myproject/rel_0.5.2
 user @ stable: ~ / httpdocs / $ rm pro &amp;&amp; ln ‚Äìs ../apps/myproject/rel_0.5.2.1 pro
 user @ stable: ~ / httpdocs / $ ls ‚Äìla
 drwxr-xr-x 3 user www-data 4096 Oct 29 11:40.
 drwxr-xr-x 9 user www-data 4096 Oct 28 21:25 ..
 lrwxrwxrwx 1 user www-data 27 Oct 30 17:12 pro -&gt; ../apps/myproject/rel_0.5.2.1
</pre></td></tr></tbody></table>  If the application is distributed: <ul><li>  disable some backends by redirecting all traffic from the fronts to the remaining workers </li><li>  On disconnected backends we perform local implementations and tests. </li><li>  switching traffic to fresh backends </li><li>  repeat the procedure for the released backends </li><li>  As a result of block introduction, the front-ends are switched to the normal state and distribute the load across all backends. </li></ul>  The more servers are involved and the more complex the structure of the application, the greater the need for automation tools and implementation control.  However, do not forget the favorite rule of futurologists: do not trust the robots - they were created by people who are prone to make mistakes. <blockquote>  PS If you have enough strength to finish the story, wait for the second part about the virtues of <a href="http://liquibase.org/">LiquiBase</a> , the rsync pitfalls and the migration of file storages. </blockquote><blockquote> PPS In the course of correspondence with one of the habrayuser it was formulated: the main thing in this informational appeal is not to impose one's recommendations, but the fact that I make a person think about the problems that may arise in his particular situation.  General recommendations on * ^ &amp; no one needs.  In the end, everyone makes their own way.  And it is right.  Because every project is unique. </blockquote></div><p>Source: <a href="https://habr.com/ru/post/43643/">https://habr.com/ru/post/43643/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../43637/index.html">parallelizing task execution with stream_select ()</a></li>
<li><a href="../436374/index.html">Trends in the design of UI and UX 2019</a></li>
<li><a href="../43638/index.html">Problem: content window sizing</a></li>
<li><a href="../43639/index.html">"Developer ammunition" -update.</a></li>
<li><a href="../43641/index.html">Opera 9.62</a></li>
<li><a href="../43645/index.html">Brain console</a></li>
<li><a href="../43646/index.html">Rubik's Cube - Hi-tech.</a></li>
<li><a href="../43649/index.html">Jobs and registration on Habr√©</a></li>
<li><a href="../43650/index.html">Ubuntu is beautiful, but still it‚Äôs not Mac OS, but it‚Äôs necessary that they say that Mac OS is beautiful, but still it‚Äôs not Ubuntu</a></li>
<li><a href="../43651/index.html">Perfect scripting language for WEB.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>