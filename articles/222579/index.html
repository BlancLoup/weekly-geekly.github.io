<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Spring from the inside. Context Initialization Stages</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habravchane. For 3 years I have been working on a project in which we use Spring. It has always been interesting to me to deal with how...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Spring from the inside. Context Initialization Stages</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/018/4ac/b7a/0184acb7a7f8b5e457ae788a70b42094.png"><br><br>  Good day, dear habravchane.  For 3 years I have been working on a project in which we use Spring.  It has always been interesting to me to deal with how it is arranged inside.  I looked for articles about Spring's internal device, but, unfortunately, I did not find anything. <br><br>  Anyone who is interested in the internal structure of Spring, please under the cat. <br><a name="habracut"></a><br>  The diagram shows the main steps in raising the ApplicationContext.  In this post we will focus on each of these stages.  Some stage will be considered in detail, and some will be described in general terms. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/0bc/ceb/842/0bcceb8429a61045baa91c6caeb84908.png"><br><br><h4>  1. Parsing the configuration and creating a BeanDefinition </h4><br>  After the release of the fourth version of the spring, we have four ways to configure the context: <br><ol><li>  Xml configuration - ClassPathXmlApplicationContext (‚Äúcontext.xml‚Äù) </li><li>  Configuration via annotations with package for scanning - AnnotationConfigApplicationContext (‚Äúpackage.name‚Äù) </li><li>  Configuration via annotations indicating the class (or array of classes) annotated with @Configuration -AnnotationConfigApplicationContext (JavaConfig.class).  This configuration method is called JavaConfig. </li><li>  Groovy configuration - GenericGroovyApplicationContext (‚Äúcontext.groovy‚Äù) </li></ol><br>  About all four ways very well written <a href="http://habrahabr.ru/company/codefreeze/blog/218203/">here</a> . <br><br>  The purpose of the first stage is to create all <i>BeanDefinition</i> .  <i>BeanDefinition</i> is a special interface through which you can access the metadata of a future bean.  Depending on your configuration, one or another configuration parsing mechanism will be used. <br><br><h5>  Xml configuration </h5><br>  For the Xml configuration, the class is used - <i>XmlBeanDefinitionReader</i> , which implements the <i>BeanDefinitionReader</i> interface.  It's all quite transparent.  <i>The XmlBeanDefinitionReader</i> receives an <i>InputStream</i> and loads a <i>Document</i> via <i>DefaultDocumentLoader</i> .  Then each element of the document is processed and if it is a bin, then a <i>BeanDefinition</i> is created on the basis of the completed data (id, name, class, alias, init-method, destroy-method, etc.).  Each <i>BeanDefinition</i> is placed in a Map.  The map is stored in the <i>DefaultListableBeanFactory</i> class.  In code Map looks like this. <br><br><pre><code class="java hljs"><span class="hljs-comment"><span class="hljs-comment">/** Map of bean definition objects, keyed by bean name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentHashMap&lt;String, BeanDefinition&gt;(<span class="hljs-number"><span class="hljs-number">64</span></span>);</code> </pre> <br><h5>  Configuration via annotations with package for scanning or JavaConfig </h5><br>  Configuration via annotations specifying a package for scanning or JavaConfig is completely different from configuration via xml.  In both cases, the <i>AnnotationConfigApplicationContext</i> class is used. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationConfigApplicationContext(JavaConfig.class);</code> </pre> <br>  or <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AnnotationConfigApplicationContext(‚Äú<span class="hljs-keyword"><span class="hljs-keyword">package</span></span>.name‚Äù);</code> </pre> <br>  If you look inside the AnnotationConfigApplicationContext, you can see two fields. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> AnnotatedBeanDefinitionReader reader; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> ClassPathBeanDefinitionScanner scanner;</code> </pre><br>  <i>ClassPathBeanDefinitionScanner</i> scans the specified package for the classes marked with the annotation <i>@Component</i> (or any other annotation that includes <i>@Component</i> ).  Found classes are parsed and BeanDefinition are created for them. <br>  In order for the scan to be started, the package for scanning must be specified in the configuration. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@ComponentScan</span></span>({<span class="hljs-string"><span class="hljs-string">"package.name"</span></span>})</code> </pre> <br>  or <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:component-scan</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">base-package</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"package.name"</span></span></span><span class="hljs-tag">/&gt;</span></span></code> </pre> <br>  <i>AnnotatedBeanDefinitionReader</i> works in several stages. <br><ol><li>  The first step is to register all <i>@Configurations</i> for further parsing.  If the configuration uses <i>Conditional</i> , then only those configurations will be registered for which <i>Condition</i> returns true.  <i>Conditional</i> abstract appeared in the fourth version of the spring.  It is used when, at the time of raising the context, you need to decide whether to create a bin / configuration or not.  Moreover, the decision is made by a special class, which must implement the <i>Condition</i> interface. </li><li>  The second step is to register a special <i>BeanFactoryPostProcessor</i> , namely, <i>BeanDefinitionRegistryPostProcessor</i> , which uses the <i>ConfigurationClassParser</i> class to parse the JavaConfig and create the <i>BeanDefinition</i> . </li></ol><br><h5>  Groovy configuration </h5><br>  This configuration is very similar to the configuration via Xml, except that Groovy is not XML in the file.  The GroovyBeanDefinitionReader class deals with reading and parsing the groovy configuration. <br><br><h4>  2. Setup created by BeanDefinition </h4><br>  After the first stage, we have a Map in which <i>BeanDefinition is</i> stored.  The architecture of the spring is built in such a way that we have an opportunity to influence what our bins will be before they are actually created, in other words, we have access to the class metadata.  To do this, there is a special interface <i>BeanFactoryPostProcessor</i> , having implemented that, we get access to the created <i>BeanDefinition</i> and can change them.  There is only one method in this interface. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanFactoryPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeanFactory</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(ConfigurableListableBeanFactory beanFactory)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException</span></span>; }</code> </pre><br><br>  The <b>postProcessBeanFactory</b> method accepts a <i>ConfigurableListableBeanFactory</i> parameter.  This factory contains many useful methods, including <b>getBeanDefinitionNames</b> , through which we can get all the BeanDefinitionNames, and only then with a specific name to get <i>BeanDefinition</i> for further metadata processing. <br><br>  Let's analyze one of the native implementations of the <i>BeanFactoryPostProcessor</i> interface.  Usually, the database connection settings are transferred to a separate property file, then with the help of <i>PropertySourcesPlaceholderConfigurer</i> they are loaded and the inject of these values ‚Äã‚Äãis made in the desired field.  Since the inject is done by key, before creating an instance of a bin, it is necessary to replace this key with the actual value from the property file.  This replacement occurs in a class that implements the <i>BeanFactoryPostProcessor</i> interface.  The name of this class is <i>PropertySourcesPlaceholderConfigurer</i> .  This whole process can be seen in the figure below. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd0/940/3bf/fd09403bf3bc3e96c0862386cbbcd721.png"><br><br>  Let's look at what is happening here.  We have a <i>BeanDefinition</i> for the class ClassName.  The class code is shown below. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${host}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String host; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${user}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String user; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${password}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"${port}"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer port; }</code> </pre><br><br>  If <i>PropertySourcesPlaceholderConfigurer</i> does not process this <i>BeanDefinition</i> , then after creating a ClassName instance, the value of $ {host} will be injected into the host field (the corresponding values ‚Äã‚Äãwill be injected into the other fields).  If <i>PropertySourcesPlaceholderConfigurer</i> still processes this <i>BeanDefinition</i> , then after processing, the metadata of this class will look like this. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ClassName</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"127.0.0.1"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String host; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"root"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String user; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"root"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> String password; <span class="hljs-meta"><span class="hljs-meta">@Value</span></span>(<span class="hljs-string"><span class="hljs-string">"27017"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> Integer port; }</code> </pre><br><br>  Accordingly, the correct values ‚Äã‚Äãwill be injected into these fields. <br><br>  In order for the <i>PropertySourcesPlaceholderConfigurer to</i> be added to the configuration loop created by <i>BeanDefinition</i> , you need to do one of the following. <br><br>  For XML configuration. <br><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">context:property-placeholder</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">location</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"property.properties"</span></span></span><span class="hljs-tag"> /&gt;</span></span></code> </pre><br>  For JavaConfig. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Configuration</span></span> <span class="hljs-meta"><span class="hljs-meta">@PropertySource</span></span>(<span class="hljs-string"><span class="hljs-string">"classpath:property.properties"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DevConfig</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Bean</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> PropertySourcesPlaceholderConfigurer </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configurer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PropertySourcesPlaceholderConfigurer(); } }</code> </pre><br><br>  <i>PropertySourcesPlaceholderConfigurer</i> must be declared as static.  Without static, everything will work for you until you try to use <i>@ Value</i> inside the <i>@Configuration</i> class. <br><br><h4>  3. Create custom FactoryBean </h4><br>  <i>FactoryBean</i> is a generic interface to which you can delegate the process of creating type beans.  In those days, when the configuration was exclusively in xml, developers needed a mechanism by which they could manage the process of creating beans.  This is what this interface was made for.  In order to better understand the problem, I will give an example of the xml configuration. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"redColor"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prototype"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java.awt.Color"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"r"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"g"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  At first glance, everything is fine and there are no problems.  And what if you need a different color?  Create another bin?  No problem. <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"redColor"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prototype"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java.awt.Color"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"r"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"g"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"green"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">scope</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"prototype"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"java.awt.Color"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"r"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"g"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"255"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">constructor-arg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"b"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  And what if I want a random color every time?  This is where the <i>FactoryBean</i> interface comes to the rescue. <br><br>  Create a factory that will be responsible for creating all the beans of the type - <i>Color</i> . <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> com.malahov.factorybean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.beans.factory.FactoryBean; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.springframework.stereotype.Component; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.awt.*; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.Random; <span class="hljs-comment"><span class="hljs-comment">/** * User: malahov * Date: 18.04.14 * Time: 15:59 */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ColorFactory</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FactoryBean</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Color</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Color </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getObject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> Exception </span></span>{ Random random = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Random(); Color color = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Color(random.nextInt(<span class="hljs-number"><span class="hljs-number">255</span></span>), random.nextInt(<span class="hljs-number"><span class="hljs-number">255</span></span>), random.nextInt(<span class="hljs-number"><span class="hljs-number">255</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> color; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Class&lt;?&gt; getObjectType() { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Color.class; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">isSingleton</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } }</code> </pre><br><br>  Add it to xml and remove previously declared bins of the type - <i>Color</i> . <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:context</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/context"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"colorFactory"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"com.malahov.temp.ColorFactory"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bean</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">beans</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><br>  Now the creation of a bean of the <i>Color.class</i> type will be delegated to ColorFactory, in which the <b>getObject</b> method will be called each time a new bean is <b>created</b> . <br><br>  For those who use JavaConfig, this interface will be absolutely useless. <br><br><h4>  4. Creating Bin instances </h4><br>  Creating Bean instances is handled by the <i>BeanFactory</i> while, if necessary, delegating this to the custom <i>FactoryBean</i> .  Bean instances are created based on previously created <i>BeanDefinition</i> . <br><br><img src="https://habrastorage.org/getpro/habr/post_images/5c6/9d6/853/5c69d6853d00726067868447d414e478.png"><br><br><h4>  5. Customize created bins </h4><br>  The <i>BeanPostProcessor</i> interface allows <i>you</i> to hook into the process of setting up your beans before they get into the container.  The interface carries several methods. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException</span></span>; <span class="hljs-function"><span class="hljs-function">Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException</span></span>; }</code> </pre><br><br>  Both methods are called for each bean.  Both methods have exactly the same parameters.  The difference is only in the order of their call.  The first is called before the init method, the second, after.  It is important to understand that at this stage an instance of the bean has already been created and it is undergoing customization.  There are two important points: <br><ol><li>  Both methods should eventually return the bin.  If you return null in the method, then when you receive this bean from the context, you will get null, and since all the bins pass through the binpost processor, after raising the context, when you query any bean, you will receive a fig, in the sense of null. </li><li>  If you want to make a proxy over your object, then keep in mind that this is done after calling the init method, in other words, this should be done in the <b>postProcessAfterInitialization</b> method. </li></ol><br><br>  The process of adjusting is shown in the figure below.  The order in which the <i>BeanPostProcessor</i> will be called is not known, but we know for sure that they will be executed sequentially. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/6b1/89c/2a3/6b189c2a39bff01734928d4d408e57de.png"><br><br>  In order to better understand what this is for, let's look at some example. <br><br>  When developing large projects, as a rule, the team is divided into several groups.  For example, the first group of developers is engaged in writing the project's infrastructure, and the second group, using the groundwork of the first group, is writing business logic.  Suppose a second group needs a functional that allows them to inject some values, for example, random numbers. <br><br>  At the first stage, an annotation will be created, which will mark the class fields into which the value should be inserted. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Retention</span></span>(RetentionPolicy.RUNTIME) <span class="hljs-meta"><span class="hljs-meta">@Target</span></span>(ElementType.FIELD) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> InjectRandomInt { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">min</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> 0</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">max</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">default</span></span></span><span class="hljs-function"> 10</span></span>; }</code> </pre><br><br>  By default, the random number range will be from 0 to 10. <br><br>  Then, you need to create a handler for this annotation, namely the <i>BeanPostProcessor</i> implementation to handle the <i>InjectRandomInt</i> annotation. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InjectRandomIntBeanPostProcessor</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BeanPostProcessor</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Logger LOGGER = LoggerFactory.getLogger(InjectRandomIntBeanPostProcessor.class); <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessBeforeInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException </span></span>{ LOGGER.info(<span class="hljs-string"><span class="hljs-string">"postProcessBeforeInitialization::beanName = {}, beanClass = {}"</span></span>, beanName, bean.getClass().getSimpleName()); Field[] fields = bean.getClass().getDeclaredFields(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (Field field : fields) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (field.isAnnotationPresent(InjectRandomInt.class)) { field.setAccessible(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); InjectRandomInt annotation = field.getAnnotation(InjectRandomInt.class); ReflectionUtils.setField(field, bean, getRandomIntInRange(annotation.min(), annotation.max())); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Object </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">postProcessAfterInitialization</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Object bean, String beanName)</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">throws</span></span></span><span class="hljs-function"> BeansException </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> bean; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRandomIntInRange</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> min, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> max)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> min + (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(Math.random() * ((max - min) + <span class="hljs-number"><span class="hljs-number">1</span></span>)); } }</code> </pre><br><br>  The code of this <i>BeanPostProcessor is</i> fairly transparent, so we will not dwell on it, but there is one important point. <br><br>  <i>BeanPostProcessor</i> must be a bin, so we either mark it with the <i>@Component</i> annotation, or register it in the xml configuration as a regular bin. <br><br>  The first group of developers completed their task.  Now the second group can use these developments. <br><br><pre> <code class="java hljs"><span class="hljs-meta"><span class="hljs-meta">@Component</span></span> <span class="hljs-meta"><span class="hljs-meta">@Scope</span></span>(ConfigurableBeanFactory.SCOPE_PROTOTYPE) <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">MyBean</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-meta"><span class="hljs-meta">@InjectRandomInt</span></span> <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value1; <span class="hljs-meta"><span class="hljs-meta">@InjectRandomInt</span></span>(min = <span class="hljs-number"><span class="hljs-number">100</span></span>, max = <span class="hljs-number"><span class="hljs-number">200</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value2; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> value3; <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> String </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toString</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"MyBean{"</span></span> + <span class="hljs-string"><span class="hljs-string">"value1="</span></span> + value1 + <span class="hljs-string"><span class="hljs-string">", value2="</span></span> + value2 + <span class="hljs-string"><span class="hljs-string">", value3="</span></span> + value3 + <span class="hljs-string"><span class="hljs-string">'}'</span></span>; } }</code> </pre><br><br>  As a result, all <i>bans of the MyBean</i> type, obtained from the context, will be created with the already initialized fields value1 and value2.  It is also worth noting that the stage at which the injection of values ‚Äã‚Äãinto these fields will occur will depend on what <i>@ Scope</i> of your bean.  <i>SCOPE_SINGLETON</i> - initialization will occur once at the stage of raising the context.  <i>SCOPE_PROTOTYPE</i> - initialization will be performed each time on request.  And in the second case, your bin will pass through all BeanPostProcessors, which can significantly hit performance. <br><br>  The full program code can be found <a href="https://github.com/amalahov/InjectRandomIntBeanPostProcessor">here</a> . <br><br>  I want to say a special thanks to <a href="https://habrahabr.ru/users/evgenyborisov/" class="user_link">EvgenyBorisov</a> .  Thanks to his <a href="http://xpinjection.com/trainings/spring-3/">course</a> , I decided to write this post. <br><br>  I also advise you to watch his <a href="https://www.youtube.com/watch%3Fv%3DhDpa6m48eC4%26index%3D15%26list%3DPLVe-2wcL84b8qDFSA2rpbpuE3OTkEbAwe">report</a> from JPoint 2014. </div><p>Source: <a href="https://habr.com/ru/post/222579/">https://habr.com/ru/post/222579/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../222569/index.html">Synthesis-2 - domestic clone ZX-Spectrum</a></li>
<li><a href="../222571/index.html">Smart home - cheap and cheerful</a></li>
<li><a href="../222573/index.html">ReactJS in a nutshell. Part 1</a></li>
<li><a href="../222575/index.html">What's new for developers in Concrete5 CMS v5.7</a></li>
<li><a href="../222577/index.html">Algorithm for solving the backpack problem (version 2, revised)</a></li>
<li><a href="../222581/index.html">Atlassian JIRA: setting up the processing of requests using the JJUPIN plugin</a></li>
<li><a href="../222585/index.html">Hackerkast (1) from Silicon Valley. Alexey Fedoseev - former director of product development at Motorola in the United States, from which he left to start a startup 1World Online</a></li>
<li><a href="../222587/index.html">Collar for blogger</a></li>
<li><a href="../222591/index.html">Bestsellers O'Reilly</a></li>
<li><a href="../222593/index.html">Launch of RAD Studio XE6 in Minsk, St. Petersburg and Voronezh</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>