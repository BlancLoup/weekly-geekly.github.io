<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>OPA Amplifier style</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The article consists of 2 blocks: 
 1. Select the rail-to-rail input output (RRIO) of the operational amplifier for a wide range of applications. 
 An...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>OPA Amplifier style</h1><div class="post__text post__text-html js-mediator-article">  The article consists of 2 blocks: <br>  1. Select the rail-to-rail input output (RRIO) of the operational amplifier for a wide range of applications. <br>  And for geeks: <br>  2. Create your own amp.  Example. <br><br>  <b>Goal 1. First block</b> <br><h4>  Choosing the right rail-to-rail input output (RRIO) and low-cost opamp for a wide range of ready-made devices. </h4><br><br>  When creating a <a href="http://supersdr.com/info/rf-fet-amp/low-cost-high-reliability-broadcast-1kw-rf-amplifier/">powerful amplifier for the transceiver</a> , as well as an amplifier for the <a href="http://www.subamp.ru/">SubAMP</a> series <a href="http://www.subamp.ru/">subwoofers</a> , the question of measuring the voltage tightly between the power shelves arose.  Namely, for example, we need to measure the current on a small-signal shunt sensor at a high positive potential of the power source, i.e.  make High Side Current Sense.  Namely, at the very plus, and the power of the operational amplifiers should not exceed it. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      There are already ready current sensors, but we are perverted, we want cheap and original. <a name="habracut"></a><br>  With earth measurements, everything is clear; there is a bunch of especially opamp amplifiers designed for this, such as lm124 (lm324), 2904, comparators 199, 139, 311 and the like with a p-channel differential pair at the input.  Older tl07x and 08x type audiooperations, jrc4558, ne5532 have the same input p-pair for preferred operation near the ground / minus power supply of the operational amplifier. <br><br>  But those who know it are well known that such a pair cannot measure signals close to a positive self-supply due to the voltage reserve necessary for the operation of current mirrors.  In addition, p-channel transistors are less high-frequency.  The inclusion of an opera with an n-channel pair at the input saves, but this is not a complete way out of our situation.  For full kosher, in order to work with any signal level near minus and plus the power supply shelves of the operational amplifier, you need to use the rail-to-rail input structure.  And in order to make it really good, you need to use this chip in input and output, i.e.  Use RRIO OPA -rail-to-rail input output.  There is another name for zamanuhi -beyond the rail OPAmp. <br><br><h5>  How is the rail-to-rail structure made?  OPA inside </h5><br><br>  The N-channel pair within most op-amps ranges from just above the minimum to slightly above the power maximum (but not always), and the p-channel pair from just below the maximum to just below the minimum.  As a result, combining them tokuko, we have a complete overlap on the input not only of the entire power supply bus of the operational amplifier, but also by about 0.2-0.5V beyond its limits in both directions, until the protective stops on the legs of the micrush are triggered. <br>  It was not possible to find n-channel input amplifiers with a swoop.  Posherstiv still managed to dig at a cursory examination of the ancient AD826 and LM360 / 361, and besides, they do not rail on the entrance.  In general, disappointed.  And this, as always with us, leads to the creation of something of our own (see Goal 2). <br>  But then they immediately ran into the district of the opera.  But we are pervert freaks, and this is not enough for us.  Many scanned rail to rail amplifiers had a lot of flaws.  If you even look at the official charts in datasheets, then everything gets worse.  For many, with a large signal, it <s>lays their ears on the</s> front by clicking after exiting the power shelves, on the so-called restoration.  This byak is found in very many even expensive operas, but you want something linear and correct.  And for some, even the fronts of the rectangle are transmitted by a broken line.  This is no good at all. <br>  Also, not everything is nice with load capacity and input currents / drifts.  A truly rail-to-rail structure is rarely found.  Even from the expensive AD operas, almost everyone didn‚Äôt like it, then they had one, then another, and the price was high. <br>  I had to sit and pick, which of the RRIO OPA have tolerable parameters for a wide and high-quality application.  Oddly enough, normal was not enough.  And they were selected solely on datasheets, and even there it‚Äôs full of glitches.  Not to mention the real work, in it all the incidents manifest themselves in full force. <br><br><h6>  <b>Total goal 1</b> .  Selection of a ready-made RRIO operational amplifier for everyday needs. </h6><br><br>  Below is a list of high-quality operational amplifiers with comments that are, in our opinion, worthy of attention for rail-to-rail applications, and it will be supplemented in the course of pushing them. <br><br><div class="spoiler">  <b class="spoiler_title">Prispandoreno-prihabreno</b> <div class="spoiler_text">  Here is a list of true rail-to-rail input output (RRIO) and beyond-the-rail op-amps with a brief description of their advantages and disadvantages so that you can choose the best or quickly estimate what you need and then study it in detail in the datasheet. <br><br>  LMV931,932 1.8-5V, all is well, but the power is low <br>  LMV981,982 1.8-5V, shape forms, low power <br>  NCS7101, 1.8-10V, similar to LMV931, better power <br>  NCS2001,2002 0.9-5V, similar to LMV931 <br>  MC33201 / 2/4 0.9-12V, similar to LMV931, better power, Input Offset Voltage is large, approx.  10mV <br>  LM7301- 1.8 ... 32V, crooked rectangle, single only <br>  ADA4092 3-30V, serifs on the rectangles <br>  MC33201 1.8 ... 12V, crooked rectangle <br>  AD8614 / 8644 5-18V, unprotected 70mA out <br></div></div><br><hr><br>  Preamble to goal 2. <br><br><h5>  Beauty will save the chips </h5><br><br>  When analyzing a huge heap, datasheets noticed an interesting point: the more symmetrically and more beautiful the schematic structure of the operational amplifier looks, the more correct, predictable and similarly more beautiful its parameters.  As well as parameters at different power edges, restrictions and loads are obtained symmetrical and beautiful, understandable from the graphs and behavior. <br>  For example, when you look at it <br><img src="https://habrastorage.org/getpro/habr/post_images/a43/8e5/05e/a438e505e494dabe913fb1e4d18e46ac.png" alt="image"><br><br>  What is in my head immediately appears?  That's right, my eyes would not see him, and even on a sober head.  This is a piece of one widely known opera. <br>  And it is already nice to see this, and the parameters are quite good.  This is AD8614_8644. <br><img src="https://habrastorage.org/getpro/habr/post_images/72f/cb2/6e6/72fcb26e62a818495e9193192918b171.png" alt="image"><br><br><h4>  <b>Goal 2. The second block</b> .  Create your dream operational amplifier with the right parameters. </h4><br>  And what to do if your hands itch? <br>  Right! <h5>  Designing your own rail to rail IO amplifier. </h5><br>  I could not resist and decided to make a dream operational amplifier, and not just rail to rail, but a fully differential differential input and output, such a high-quality operational amplifier of wide application according to the rules of microcircuit design . <br><br><h6>  Fully differential amplifiers.  Fully differential OPA </h6><br>  Such amplifiers can be used both as ordinary single-output OPA (OA), without locking 1 of the outputs, and as normal diff.  amplifiers for almost all modern paths of analog technology.  Fully differential structure is now increasingly needed even in conventional signal processing, not to mention the ADC and DAC, which almost all have full-fledged diff.  structure.  This type of signal transmission allows you to partially eliminate tire interference and optimize current transmission and current flow.  In the end, USB, SATA, PCIE, as well as all the RAM that I saw, and high-speed buses in computers and servers, have a differential structure.  Well, or two-phase, the sound and light of friends.  Differential improvement applies to all electrical systems, analog and digital.  After all, except for currents and voltages there is nothing. <br><br>  Further only electronic pornography goes. <br><br><h5>  Putting it in pieces.  Support </h5><br>  As in good digital technology, it is extremely important to have a high-quality clock (time) support, so here in analog technology it is important to have sources of stable current and / or voltage that are not affected by <a href="http://subamp.ru/blog/how-correctly-to-do-tests/how-correctly-to-do-tests/">different influences</a> .  At least one thing.  Another can be done with <a href="">this</a> . <br>  First, he created a stable temperature-compensated source of stable voltage ‚Äî BandGap in everyday life, a so-called voltage source with a range gap, I mean a stabilizer 1v with voltage kopecks compensated in some temperature region of one sailing by <s>sailing to</s> another. <br>  There is nothing complicated there, it is enough to remake it from the known solutions and finish it for our needs.  Schemes roll in shared Internet. <br>  The whole amplifier is powered from it through current multitranslators and mirrors.  Its stability and noise determine the work and for the most part the temperature stability of the entire amplifier as a whole. <br>  Naturally, this version of BandGap was investigated in a wide temperature &amp; wide range and showed good stability.  Now you can really rely on it. <br><br>  It turned out this scheme.  As they say, the face is terrible, but kind inside.  But it is difficult to simplify. <br><img src="https://habrastorage.org/getpro/habr/post_images/5a7/63b/b7a/5a763bb7a43992f28460c930531c2388.png" alt="image"><br><br>  It contains some heap of current translators for breeding and feeding the amuser and the BandGap element itself (highlighted by a dotted line). <br><br>  Current multipliers and repeaters in stock. <br><img src="https://habrastorage.org/getpro/habr/post_images/9e3/353/0ef/9e33530ef82882d445ad2ac187bd222f.png" alt="image"><br>  Maybe in the following articles I will tell you what and how it works in these amplifiers, and what elements are needed for. <br><br><h5>  Inputs for fully differential rail-to-rail amplifier </h5><br>  Then I calculated the structure of the input fully differential cascade with minimized noise and a rail-to-rail input, and with a fully symmetrical structure. <br>  To minimize the noise, large transistors and long channel lengths are used.  Although the length of the field-effect transistor channel reduces its gain (steepness for correctness), it reduces the potential gradient along the length of the transistor, which also reduces the likelihood of pop corn mud noise and simply facilitates the operation of the transistor. <br><img src="https://habrastorage.org/getpro/habr/post_images/4f0/651/2ca/4f06512caf43e53dbd94502a221d8bdb.png" alt="image"><br><br>  This is similar to a matrix in a camera, where large large pixels with a not large resolution of a sprinkled matrix, say, 3Mpix, give better image quality than small noisy specks of dust in any 7-14 Mpix camera.  I have not seen one that is not very noisy with a small matrix size, and with a wild resolution in it. <br>  And with large pixels in the top prof.  matrices, and not really, the image acquires pixel-by-pixel detailing.  What can not be said about the modern multi-megapixel soap.  I still do not understand why the camera is 14Mpix, if everything is still blurry in the final photo.  I come to the conclusion that the correct is not the size of the image resolution (this is just the amount that can be increased), but the size of the pixel itself, its dimensions.  A pixel in modern cameras is essentially a transistor, more precisely, a phototransistor, but this does not change the essence.  Let's go further. <br><br><h5>  2nd stage amp, csda / vcda-type schematics.  Balanced Current Preamplifier </h5><br>  Then he estimated and realized the structure of the pre-terminal cascade with the balance of currents and the terminal fully differential cascade.  A single frequency band turned out in the region of 50 megahertz, and it is easy at that, even on large 180nm transistors.  For the stability of this band and the phase margin, topological protective rings, shields and internal pockets are provided in the topology. <br><img src="https://habrastorage.org/getpro/habr/post_images/03b/479/590/03b479590d93f2a9e585d47cfdcc4faf.png" alt="image"><br><br>  In the process, we had to study how best to do folded cascode and just good cascode current sources, what is their stability and how to make high-quality mirrors and multichannel correct stable current transformers (cascodes, resistors in the sources). <br><br><h5>  Output stage DIY RRIO Amplifier.  Output stages </h5><br>  As for the terminator, there wasn‚Äôt much fear, there are no switched capacitor solutions, <a href="http://subamp.ru/blog/acessories-and-instruments/class-i-power-amplifier-modulator-design/">class I</a> , voltage additives E, and other modern enhancements.  Only Terry Class AB.  For the power supply, this amp is 3.0-3.6V, since it was made on a 3.3-volt LV library.  The other was not at hand.  And so, there are 140V of LTC6090 opera in the world, and, possibly, more high-voltage ones.  Allowable stress is a problem only of the libraries from which the device is made.  Although you can always stir up the voltage add-on or conversion, if not enough springs. <br>  The complete diagram of the core of the amplifier without the weight and the necessary garden is given below. <br><img src="https://habrastorage.org/getpro/habr/post_images/c4b/2b0/5c3/c4b2b05c383859d4ea50069f3c68034e.png" alt="image"><br><br><h6>  Testing </h6><br>  Testing took place on the torture table, which for ethical reasons is not shown here.  In general, it is a variety of ideal sources / loads / effects that you can imagine only in a nightmare.  While he endured everything, he was made in the chip, and confirmed his parameters. <br>  I checked the layout on numerous parameters, for resistance to technological variations and probabilistic variations.  That is not laziness, not laziness, when you do for yourself and with love. <br>  Each block was tested separately and in the system before inserting it into a block above it. <br><br><h5>  Natural principles of construction </h5><br>  Up to this point, the layout was deliberately pulled up to the necessary input modes using external sources.  Everything was set up according to the most important principle ‚Äî to obtain the most needed readings without general feedback, that is, <b>to obtain the structure initially as linear as possible, and only then introduce external feedback</b> , for research and final measurements.  I think no one will argue here, this is the postulate of all linear electronics and analog circuitry. <br>  Prior to that, these toilets were writing until it began to follow the main principles of design.  Accuracy, beauty and conciseness are our best friends.  And everything starts to work nicely, because it becomes clear.  The reliability of systems increases, because you see every step, it is clear and understandable. <br><br><h5>  Common mode voltage feedback- CMFB for RRIO FD OPAmp </h5><br>  And finally, he covered him with the third entrance of the CMFB, when everything else began to work perfectly.  Then VCL zaklokotal as it should, right already takes the joy! <br>  Who does not know, cmfb is a common mode feedback, settling all the outputs of the operational amplifier relative to the support given to the third input CM.  This is such a negative feedback for the middle point of the amplifier.  Otherwise, how will he know about which line to give a swing at the outputs of the amplifier? <br>  This is the very third input with a bypassing air-conditioner, which is usually needed for the common line of all devices of the path to the amplifier, after, and himself.  Something like that <br><img src="https://habrastorage.org/getpro/habr/post_images/357/e27/6f7/357e276f7295618a438c467c2075c868.png" alt="image"><br>  The level of the common point (or, in a different way, virtual ground, midpoint, common mode) is usually half of the power shelves, but it may be different.  And there can be not only potential, but also current, what a difference to us is the voltage, this is the result of the current on the resistor, the effect of the current, and we always get the voltage when we want. <br>  Here is a system of continious time voltage CMFB of this amplifier. <br><img src="https://habrastorage.org/getpro/habr/post_images/4d1/82b/3de/4d182b3de1241e67334bfa07a7f99c51.png" alt="image"><br>  It connects to its two outputs and its reputation affects the erogenous point in the form of two inputs of a parallel amplifier connected to the output stage.  Something like familiar shunt regulator TL432 series. <br><br>  CMFB is essentially an amplifier in an amplifier, a second loop, which should be faster than the main circuit to provide global stability to the amplifier.  By the way, everything I write about here is a thing of many years ago, I wanted to bring everything together, and to have a look, to remember.  Such an express overview of some of the necessary things. <br><br><h6>  What did we get?  And what can you get? </h6><br>  <b>Results of goal 2</b> <br>  The parameters obtained in this library are not super-duper, but stable, almost the same that I wanted to get, besides, they can always be multiplied to high powers / currents.  Yes, I forgot to say, this opera was planned for internal finishing works in a microcircuit, not for external.  For ekstalki made others and separately.  They are briefly described below. <br><br>  <b>Brief parameters of the resulting OPA.</b> <br>  FEATURES OPA: <br>  Fully Differential Opamp <br>  Supply Voltage Range: 3 V ... 3.6 V <br>  Unity Gain-Bandwidth: 54 MHz <br>  Slew Rate: 129 V / us <br>  Output Current: up to 1 mA sink / source @each channel <br>  DC Voltage Offset: 1.2 mV max <br>  Supply Current: 0.87 mA <br>  Open Loop Gain: 74 dB <br>  This is enough for us to work inside the microcircuits, and he was born for this.  Output Impedance it in the region of 500 Ohm does not confuse the microcircuit neighbors.  For especially zealous there are drivers with low impedance. <br>  Intracircuit electronic products, as it turned out in practice, are easy to do, he himself was surprised, I‚Äôll bring something else to heaps. <br>  Nano-current 1.8 and 3.3-volt devices, as well as switching cap systems, track-hold, ADC, sc comparators, delay, eq, linear phase filters, PGA, DAC, charge pump, vco-pll, mixers, rf pa, limiting amp , multiphase pwm and a lot of rubbish.  Everything basically turned out to be simple. <br><br><h6>  Driving IC PADs </h6><br>  To throw the signal out, to pump the pad of the PAD chip and the external load capacity, a sophisticated version of this amplifier was invented, as well as special analog buffers based on it. <br><img src="https://habrastorage.org/getpro/habr/post_images/b46/0f0/ff1/b460f0ff185eef89351d28ed47a88d4d.png" alt="image"><br>  Here is even wiser, scary kids. <br><img src="https://habrastorage.org/getpro/habr/post_images/39b/4c3/039/39b4c303950b6d7e263af76916fe6df2.png" alt="image"><br><img src="https://habrastorage.org/getpro/habr/post_images/ffc/539/a3a/ffc539a3a21907c005a366b9997d52dd.png" alt="image"><br>  These buffers are not all very beautiful, they were made before the aspen and clearly delirious.  They have a band in the region of 400 MHZ and stable work on the capacitive load. <br>  In general, analog technology is not as scary as it is painted. <br><br>  PDF of the rest of the ready devices I will attach if anyone needs it. <br><br>  Ps.  Thanks for attention. <br><br>  Appendix: homemade simple operational amplifier <br>  <a href="http://diybass.com/wp-content/uploads/2013/FD-RRIO-OPA.pdf">diybass.com/wp-content/uploads/2013/FD-RRIO-OPA.pdf</a> </div><p>Source: <a href="https://habr.com/ru/post/186402/">https://habr.com/ru/post/186402/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../186386/index.html">Mojo Ribbon - the perfect tape or trigonometry in LESS</a></li>
<li><a href="../186388/index.html">Summer sales started on Steam</a></li>
<li><a href="../186392/index.html">Kim Dotcom (Mega, Megaupload) is going to launch a messenger and email protected from wiretapping</a></li>
<li><a href="../186396/index.html">How does the transistor work? Well, very accessible video explanation</a></li>
<li><a href="../186400/index.html">Interview with John Griffith, OpenStack Cinder Project Manager (Block Data Storage)</a></li>
<li><a href="../186406/index.html">State and p2p</a></li>
<li><a href="../186410/index.html">Evidence based planning</a></li>
<li><a href="../186412/index.html">Just5 Press Conference & Art. Lebedev Studio, July 17, 16:30 - ask questions!</a></li>
<li><a href="../186416/index.html">Why I do not climb in cryptography</a></li>
<li><a href="../186422/index.html">Social networks in Russia, summer 2013: numbers, trends, forecasts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>