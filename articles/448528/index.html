<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Free Wireguard VPN service on AWS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For what? 


 With the growth of Internet censorship by authoritarian regimes, an increasing number of useful Internet resources and sites are being b...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Free Wireguard VPN service on AWS</h1><div class="post__text post__text-html js-mediator-article"><h2 id="dlya-chego">  For what? </h2><br><p>  With the growth of Internet censorship by authoritarian regimes, an increasing number of useful Internet resources and sites are being blocked.  Including with technical information. <br>  Thus, it becomes impossible to fully use the Internet and violates the fundamental right to freedom of speech enshrined in the <a href="https://www.un.org/ru/documents/decl_conv/declarations/declhr.shtml">Universal Declaration of Human Rights</a> . </p><br><blockquote>  Article 19 <br>  Everyone has the right to freedom of opinion and expression;  this right includes the freedom to freely adhere to one‚Äôs convictions and the freedom to seek, receive and impart information and ideas by any means and regardless of frontiers </blockquote><p>  In this guide, we will deploy our own free * <a href="https://ru.bmstu.wiki/VPN_(Virtual_Private_Network)">VPN service</a> based on <a href="https://www.wireguard.com/">Wireguard</a> technology, in <a href="https://aws.amazon.com/ru/">Amazon Web Services</a> (AWS) cloud infrastructure, using a free account (for 12 months), on an instance (virtual machine) running <a href="https://www.ubuntu.com/server">Ubuntu Server 18.04</a> in 6 steps <a href="https://www.ubuntu.com/server">Lts</a> . </p><br><p>  I tried to make this walkthrough as friendly as possible to people far from IT.  The only thing required is assiduity in repeating the steps described below. </p><a name="habracut"></a><br><blockquote>  Note <br><ul><li>  AWS provides a <a href="https://aws.amazon.com/ru/free/faqs/">free usage level</a> for a period of 12 months, with a limit of 15 gigabytes of traffic per month. </li><li>  The most current version of this guide is located at <a href="https://wireguard.isystem.io/">https://wireguard.isystem.io</a> </li></ul><br></blockquote><br><h2 id="etapy">  Stages </h2><br><ol><li>  AWS Free Account Registration </li><li>  Create an AWS instance </li><li>  Connect to an AWS instance </li><li>  Configuring Wireguard </li><li>  Configuring VPN Clients </li><li>  Verify VPN installation </li></ol><br><h2 id="poleznye-ssylki">  useful links </h2><br><ul><li>  <a href="https://github.com/isystem-io/wireguard-aws">Wireguard unattended installation scripts on AWS</a> </li></ul><br><h1 id="1-registraciya-akkaunta-aws">  1. Register an AWS Account </h1><br><p>  To register a free AWS account, you need a real phone number and a paying Visa or Mastercard credit card.  I recommend using virtual cards that <a href="https://money.yandex.ru/cards/virtual">Yandex.Money</a> or <a href="https://qiwi.com/cards/qvc">Qiwi wallet</a> provides for free.  To check the validity of the card, at registration 1 $ is deducted which is refunded. </p><br><h2 id="11-otkrytie-konsoli-upravleniya-aws">  1.1.  Opening the AWS Management Console </h2><br><p>  You need to open a browser and go to: <a href="https://aws.amazon.com/ru/">https://aws.amazon.com/ru/</a> <br>  Click on "Register" </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c99/b30/925/c99b309258767bd9c72df8ffee22cb3b.jpg" alt="Amazon AWS Start Page"></p><br><h2 id="12-zapolnenie-personalnyh-dannyh">  1.2.  Filling in personal data </h2><br><p>  Fill in the data and click on the "Continue" button </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ebc/f8d/eec/ebcf8deec53b635bcf599927974672df.jpg" alt="Amazon AWS Account Registration"></p><br><h2 id="13-zapolnenie-kontaktnyh-dannyh">  1.3.  Filling contact information </h2><br><p>  Fill out contact information. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/793/c9f/f67/793c9ff67bdba7d504b2a61cbe94775d.jpg" alt="Specifying contact information when registering an AWS Amazon account"></p><br><h2 id="14-ukazanie-platezhnoy-informacii">  1.4.  Specify billing information. </h2><br><p>  Card number, expiration date and cardholder name. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a17/1a4/242/a171a4242cac644070878d3f8b9b8415.jpg" alt="Specifying Billing Details When Registering Your AWS Amazon Account"></p><br><h2 id="15-podtverzhdenie-akkaunta">  1.5.  Account Verification </h2><br><p>  At this stage, the phone number is confirmed and $ 1 is directly debited from the payment card.  A 4-digit code is displayed on the computer screen, and a call from Amazon is received on the specified phone.  During a call, you must dial the code specified on the screen. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/09b/e32/ce8/09be32ce83ebfa297fad0032c8f5f577.jpg" alt="Amazon AWS Account Verification"></p><br><h2 id="16-vybor-tarifnogo-plana">  1.6.  Select a tariff plan. </h2><br><p>  Choosing - Basic plan (free) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/743/2ad/942/7432ad942629c21527af98517c33c0f7.jpg" alt="Choose AWS Amazon Tariff Plan"></p><br><h2 id="17-vhod-v-konsol-upravleniya">  1.7.  Login to the management console </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0cc/151/703/0cc151703a717fbeaefc55512c0c4fb6.jpg" alt="Log into the AWS Amazon Management Console"></p><br><h2 id="18-vybor-raspolozheniya-data-centra">  1.8.  Choosing the location of the data center </h2><br><p><img src="https://habrastorage.org/getpro/habr/post_images/0bd/b0f/9f3/0bdb0f9f3741b14fd0b78ba49df17e97.jpg" alt="Amazon AWS Management Console"></p><br><h3 id="181-testirovanie-skorosti">  1.8.1.  Speed ‚Äã‚Äãtesting </h3><br><p>  Before choosing a datacenter, it is recommended to test through <a href="https://speedtest.net/">https://speedtest.net the</a> speed of access to the nearest datacenters, in my location such results: </p><br><ul><li>  Singapore <br><img src="https://habrastorage.org/getpro/habr/post_images/43a/a84/ab8/43aa84ab88a4b7e8b3f2180d2291c66f.jpg" alt="Singapore"></li><li>  Paris <br><img src="https://habrastorage.org/getpro/habr/post_images/8ed/0b1/239/8ed0b12395ddfad991f57870525d8acc.jpg" alt="Paris"></li><li>  Frankfurt <br><img src="https://habrastorage.org/getpro/habr/post_images/67a/de2/9d8/67ade29d8d0c379e781eaee5e88feeb9.jpg" alt="Frankfurt"></li><li>  Stockholm <br><img src="https://habrastorage.org/getpro/habr/post_images/a78/506/e65/a78506e6501b87a552a4cedbb52c3929.jpg" alt="Stockholm"></li><li>  London <br><img src="https://habrastorage.org/getpro/habr/post_images/15a/ed1/77e/15aed177e0a9654d519177c106a076c1.jpg" alt="London"></li></ul><br><p>  The best results for speed shows a data center in London.  Therefore, I chose it for further configuration. </p><br><h1 id="2-sozdanie-instansa-aws">  2. Creating an AWS instance </h1><br><h2 id="21-sozdanie-virtualnoy-mashiny-instansa">  2.1 Creating a virtual machine (instance) </h2><br><h3 id="210-zapusk-poshagovogo-mastera-sozdaniya-instansa">  2.1.0.  Launch step-by-step instance creation wizard </h3><br><h4 id="2101-perehod-na-stranicu-zapuska-instansa">  2.1.0.1.  Go to the instance launch page </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/649/07e/1ee/64907e1eee3ae6f9314e2d7f06eaeb86.jpg" alt="Go to the instance launch page"></p><br><h4 id="2102-zapusk-poshagovogo-mastera-sozdaniya-instansa">  2.1.0.2.  Launch step-by-step instance creation wizard </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/322/794/0d1/3227940d161a58918520b6e655df3e80.jpg" alt="Launch step-by-step instance creation wizard"></p><br><h4 id="2103-vybor-tipa-operacionnoy-stistemy-instansa">  2.1.0.3.  Select the type of operating system instance </h4><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f9b/184/50d/f9b18450d8fca676f8a1d7776c215085.jpg" alt="Select the type of operating system"></p><br><h3 id="211-vybor-tipa-instansa">  2.1.1.  Select an instance type </h3><br><p>  The t2.micro instance is selected by default, and we need it, just click the <strong>Next: Configure Instance Detalis button</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/3b0/af5/0a6/3b0af50a69a6461378ce2fb8d316ee9c.jpg" alt="one"></p><br><h3 id="212-nastroyka-parametrov-instansa">  2.1.2.  Setting instance parameters </h3><br><p>  In the future, we will connect a permanent public IP to our instance, so at this stage we disable the automatic assignment of a public IP, and click the <strong>Next</strong> button <strong>: Add Storage</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/57f/50b/da8/57f50bda8627b54a38aa62276f6a9c70.jpg" alt="2"></p><br><h3 id="213-podklyuchenie-hranilischa">  2.1.3.  Connection storage </h3><br><p>  Specify the size of the "hard disk".  For our purposes, 16 gigabytes is enough, and click <strong>Next: Add Tags</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/921/362/7de/9213627deeffbefe16ff9816f558d290.jpg" alt="3"></p><br><h3 id="214-nastroyka-tegov">  2.1.4.  Tag customization </h3><br><p>  If we created several instances, they could be grouped by tags, to facilitate administration.  In this case, this functionality is superfluous, immediately press the <strong>Next</strong> button <strong>: Configure Security Gorup</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e7/d81/191/4e7d81191d0463535a94d3e7a68d6c7f.jpg" alt="four"></p><br><h3 id="215-otkrytie-portov">  2.1.5.  Opening ports </h3><br><p>  At this stage, we configure the firewall by opening the necessary ports.  The open port set is called the Security Group.  We have to create a new security group, give it a name, a description, add a UDP port (Custom UDP Rule), in the Rort Range field you need to assign a port number from the range of <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25BF%25D0%25B8%25D1%2581%25D0%25BE%25D0%25BA_%25D0%25BF%25D0%25BE%25D1%2580%25D1%2582%25D0%25BE%25D0%25B2_TCP_%25D0%25B8_UDP">dynamic ports</a> 49152-65535.  In this case, I chose port number 54321. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/d12/f3c/7dd/d12f3c7dd609bf48f739757bb83d10da.jpg" alt="five"></p><br><p>  After filling in the required data, click on the <strong>Review and Launch</strong> button </p><br><h3 id="216-obzor-vseh-nastroek">  2.1.6.  Overview of all settings </h3><br><p>  On this page, we review all the settings of our instance, check whether all the settings are in order, and click the <strong>Launch</strong> button. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1a5/459/07f/1a545907f6714d976ca0c651664444b9.jpg" alt="6"></p><br><h3 id="217-sozdanie-klyuchey-dostupa">  2.1.7.  Creating access keys </h3><br><p>  Next comes a dialog box that prompts you to either create or add an existing SSH key, with which we will later connect remotely to our instance.  We select the "Create a new key pair" option to create a new key.  Set its name, and click the <strong>Download Key Pair</strong> button to download the generated keys.  Save them to a safe place on the local computer disk.  Once downloaded - click the <strong>Launch Instances</strong> button </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/cc0/1e8/e1e/cc01e8e1ea1656094afd975acd2188b5.jpg" alt="7"></p><br><h3 id="2171-sohranenie-klyuchey-dostupa">  2.1.7.1.  Saving access keys </h3><br><p>  Shown here is the step of saving the generated keys from the previous step.  After we clicked the <strong>Download Key Pair</strong> button, the key is saved as a certificate file with the extension * .pem.  In this case, I named it <strong><em>wireguard-awskey.pem</em></strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/49e/ed5/dd6/49eed5dd6bb2315b653a19f90aafe5fb.jpg" alt="eight"></p><br><h3 id="218-obzor-rezultatov-sozdaniya-instansa">  2.1.8.  Instance Creation Results Overview </h3><br><p>  Next, we see a message about the successful launch of the instance we just created.  We can go to the list of our instances by clicking on the <strong>View instances</strong> button. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a97/a79/7cd/a97a797cddfae65ad45c5a1c272fc6de.jpg" alt="9"></p><br><h2 id="22-sozdanie-vneshnego-ip-adresa">  2.2.  Creating an external IP address </h2><br><h3 id="221-zapusk-sozdaniya-vneshnego-ip">  2.2.1.  Starting external IP creation </h3><br><p>  Next we need to create a permanent external IP address, through which we will connect to our VPN server.  To do this, select the item <strong>Elastic IPs</strong> from the <strong><em>NETWORK &amp; SECTURITY</em></strong> category in the navigation pane on the left side of the screen and click the <strong>Allocate new address</strong> button </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/987/617/173/98761717343305062012b18b1c58d444.jpg" alt="one"></p><br><h3 id="222-nastroyka-sozdaniya-vneshnego-ip">  2.2.2.  Setting up an external IP </h3><br><p>  In the next step, we need to enable the <strong><em>Amazon pool</em></strong> option (enabled by default), and click on the <strong>Allocate</strong> button </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5db/5be/b90/5db5beb90d9ec68ba2cae2380dca6d23.jpg" alt="2"></p><br><h3 id="223-obzor-rezultatov-sozdaniya-vneshnego-ip-adresa">  2.2.3.  Overview of the results of creating an external IP address </h3><br><p>  The next screen will display the external IP address we received.  It is recommended to remember it, and even better to write it down.  it will be useful to us more than once in the process of further configuration and use of the VPN server.  In this guide, as an example, I use the IP address <strong><em>4.3.2.1</em></strong> .  How to write the address, click on the <strong>Close</strong> button </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/faf/951/0c2/faf9510c260fed5c94f8c96231b99d31.jpg" alt="3"></p><br><h3 id="224-spisok-vneshnih-ip-adresov">  2.2.4.  List of external IP addresses </h3><br><p>  Next we have a list of our permanent public IP addresses (elastics IP). </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/eeb/6e3/286/eeb6e328635e48bf81dd721b457b6ed5.jpg" alt="four"></p><br><h3 id="225-naznachenie-vneshnego-ip-instansu">  2.2.5.  Assigning an external IP instance </h3><br><p>  In this list, we select the IP address we received, and click the right mouse button to bring up a drop-down menu.  In it, select the <strong>Associate address</strong> item to assign it to the instance we created earlier. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/88a/2d8/350/88a2d83500e3545f562c150ee9e30ac0.jpg" alt="five"></p><br><h3 id="226-nastroyka-naznacheniya-vneshnego-ip">  2.2.6.  Configure external IP assignment </h3><br><p>  In the next step, select our instance from the drop-down list, and click the <strong>Associate</strong> button. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec5/70c/f51/ec570cf51ac30695418278b9b7c6ec97.jpg" alt="6"></p><br><h3 id="227-obzor-rezultatov-naznacheniya-vneshnego-ip">  2.2.7.  Overview of external IP assignment results </h3><br><p>  After that, we can see our instance and its private IP address is tied to our permanent public IP address. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b8e/ad3/b43/b8ead3b433f5aa357241882e09b0b8af.jpg" alt="7"></p><br><p>  Now we can connect to our newly created instance from outside, from our computer via SSH. </p><br><h1 id="3-podklyuchenie-k-instansu-aws">  3. Connect to an AWS instance </h1><br><p>  <a href="https://ru.wikipedia.org/wiki/SSH">SSH</a> is a secure protocol for remotely managing computer devices. </p><br><h2 id="31-podklyuchenie-po-ssh-c-kompyutera-na-windows">  3.1.  Connecting via SSH from a computer to Windows </h2><br><p>  To connect to a Windows computer, first you need to download and install <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html">Putty</a> . </p><br><h3 id="311-import-privatnogo-klyucha-dlya-putty">  3.1.1.  Import Private Key for Putty </h3><br><p>  3.1.1.1.  After installing Putty, you must run the PuTTYgen utility bundled with it to import the certificate key in the PEM format into a format suitable for use in the Putty program.  To do this, in the top menu, select the item <strong>Conversions-&gt; Import Key</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/566/a08/a67/566a08a670cab781368765877d82cec2.jpg" alt="one"></p><br><h4 id="3112-vybor-klyucha-aws-v-formate-pem">  3.1.1.2.  AWS key selection in PEM format </h4><br><p>  Next, select the key that we previously saved in step 2.1.7.1, in our case, its name is <strong><em>wireguard-awskey.pem</em></strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c1d/88f/5d1/c1d88f5d11299f452b729fbd03623175.jpg" alt="2"></p><br><h4 id="3113-zadanie-parametrov-importa-klyucha">  3.1.1.3.  Setting key import parameters </h4><br><p>  At this step, we need to specify a comment for this key (description) and set a password for security and its confirmation.  It will be requested at each connection.  Thus, we protect the key with a password from unauthorized use.  The password can not be set, but it is less secure if the key falls into the wrong hands.  After press the button <strong>Save private key</strong> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/c45/bce/8ed/c45bce8ed42265fb239f4182ea1874c3.jpg" alt="3"></p><br><h4 id="3114-sohranenie-importirovannogo-klyucha">  3.1.1.4.  Save imported key </h4><br><p> The save file dialog box opens, and we save our private key as a file with the <code>.ppk</code> extension, suitable for use in the <strong><em>Putty</em></strong> program. <br>  Specify the key name (in our case, <code>wireguard-awskey.ppk</code> ) and click the <strong>Save</strong> button. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e7b/905/6f2/e7b9056f2212177b772b4770a3ae09af.jpg" alt="four"></p><br><h3 id="312-sozdanie-i-nastroyka-soedineniya-v-putty">  3.1.2.  Creating and configuring a connection in Putty </h3><br><h4 id="3121-sozdanie-soedineniya">  3.1.2.1.  Making a connection </h4><br><p>  Open the Putty program, select the <strong>Session</strong> category (it is open by default) and enter the public IP address of our server in the <strong>Host Name</strong> field, which we received in step 2.2.3.  In the <strong>Saved Session</strong> field, enter an arbitrary name for our connection (in my case, <em>wireguard-aws-london</em> ), and then click the <strong>Save</strong> button to save the changes we have made. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/81f/f1c/5f0/81ff1c5f0f3fcfa590dd17ef0b7c49dd.jpg" alt="five"></p><br><h4 id="3122-nastroyka-avtologina-polzovatelya">  3.1.2.2.  Setting user autologin </h4><br><p>  Next in the <strong><em>Connection</em></strong> category, select the <strong><em>Data</em></strong> subcategory and in the <strong>Auto-login username</strong> field <strong>, enter the username</strong> <strong>ubuntu</strong> - this is the standard instance user on AWS with Ubuntu. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/ec7/8a0/08a/ec78a008a3c6e1cb6d69ac2034de0b7a.jpg" alt="6"></p><br><h4 id="3123-vybor-privatnogo-klyucha-dlya-soedineniya-po-ssh">  3.1.2.3.  Selecting a private key for an SSH connection </h4><br><p>  Then go to the <strong><em>Connection / SSH / Auth</em></strong> subcategory and click on the <strong>Browse</strong> button next to the <strong>Private key file for authentication</strong> field to select the key certificate file. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/e59/9fb/536/e599fb536b2426d19f46cf265161e1e0.jpg" alt="7"></p><br><h4 id="3124-otkrytie-importirovannogo-klyucha">  3.1.2.4.  Opening an imported key </h4><br><p>  Specify the key that we imported earlier in step 3.1.1.4, in our case, this file is <em>wireguard-awskey.ppk</em> , and click the <strong>Open</strong> button. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/419/5a5/b9e/4195a5b9ee0022f2296c75595ba4665c.jpg" alt="eight"></p><br><h4 id="3125-sohranenie-nastroek-i-zapusk-podklyucheniya">  3.1.2.5.  Saving settings and launching connection </h4><br><p>  Returning to the <strong><em>Session</em></strong> category page, press the <strong>Save</strong> button again, to save the changes we made earlier in the previous steps (3.1.2.2 - 3.1.2.4).  And then we click the <strong>Open</strong> button to open the remote SSH connection we‚Äôve created and configured. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/5c9/ef6/070/5c9ef6070698e59f18ff26c9356f4ddd.jpg" alt="ten"></p><br><h4 id="3127-nastroyka-doveriya-mezhdu-hostami">  3.1.2.7.  Configuring trust between hosts </h4><br><p>  In the next step, when you first try to connect, we are given a warning, we are not configured to trust between two computers, and ask whether to trust the remote computer.  We click <strong>Yes</strong> , thereby adding it to the list of trusted hosts. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/1b4/f36/b9e/1b4f36b9ea9308a528b893abe1865d84.jpg" alt="eleven"></p><br><h4 id="3128-vvod-parolya-dlya-dostupa-k-klyuchu">  3.1.2.8.  Enter the password to access the key </h4><br><p>  After this, a terminal window opens where the key password is requested, if you installed it earlier in step 3.1.1.3.  When entering the password, no action is taken on the screen.  If you make a mistake, you can use the <em>backspace</em> key. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/078/e59/d11/078e59d1183e6cc2a836caa2e300522d.jpg" alt="12"></p><br><h4 id="3129-privetstvennoe-soobschenie-ob-uspeshnom-podklyuchenii">  3.1.2.9.  Welcome message about successful connection </h4><br><p>  After successfully entering the password, the welcome text is displayed to us in the terminal, which informs you that the remote system is ready to execute our commands. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/f7b/9c0/254/f7b9c0254f7fa2d5d3dd59a8b7587c1e.jpg" alt="13"></p><br><h1 id="4-konfigurirovanie-servera-wireguard">  4. Configuring the Wireguard server </h1><br><p>  The most current instructions for installing and using Wireguard using the scripts described below can be viewed in the repository: <a href="https://github.com/isystem-io/wireguard-aws">https://github.com/isystem-io/wireguard-aws</a> </p><br><h2 id="41-ustanovka-wireguard">  4.1.  Install Wireguard </h2><br><p>  In the terminal, enter the following commands (you can copy to the clipboard, and paste in the terminal by pressing the right mouse button): </p><br><h3 id="411-klonirovanie-repozitoriya">  4.1.1.  Repository cloning </h3><br><p>  We clone a repository with Wireguard installation scripts </p><br><pre> <code class="plaintext hljs">git clone https://github.com/pprometey/wireguard_aws.git wireguard_aws</code> </pre> <br><h3 id="412-perehod-v-katalog-so-skriptami">  4.1.2.  Moving to a directory with scripts </h3><br><p>  Go to the directory with the cloned repository </p><br><pre> <code class="plaintext hljs">cd wireguard_aws</code> </pre> <br><h3 id="413--zapusk-skripta-inicializacii">  4.1.3 Starting the initialization script </h3><br><p>  Run the Wireguard installation script as root user </p><br><pre> <code class="plaintext hljs">sudo ./initial.sh</code> </pre> <br><p>  During the installation, you will be prompted for certain data required to configure Wireguard. </p><br><h3 id="4131-vvod-tochki-podklyucheniya">  4.1.3.1.  Input connection point </h3><br><p>  Enter the external IP address and the open port of the Wireguard server.  We received the external IP address of the server in step 2.2.3, and the port was opened in step 2.1.5.  We specify them together, <code>4.3.2.1:54321</code> colon, for example <code>4.3.2.1:54321</code> , and then presses the <strong><em>Enter</em></strong> key <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter the endpoint (external ip and port) in format [ipv4:port] (eg 4.3.2.1:54321): 4.3.2.1:54321</code> </pre> <br><h3 id="4132-vvod-vnutrennego-ip-adresa">  4.1.3.2.  Enter internal IP address </h3><br><p>  Enter the IP address of the Wireguard server in a secure VPN subnet, if you do not know what it is, just press the Enter key to set the default value ( <code>10.50.0.1</code> ) <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter the server address in the VPN subnet (CIDR format) ([ENTER] set to default: 10.50.0.1):</code> </pre> <br><h3 id="4133-ukazanie-servera-dns">  4.1.3.3.  Specify DNS Server </h3><br><p>  Enter the IP address of the DNS server, or simply press the Enter key to set the default value <code>1.1.1.1</code> (Cloudflare public DNS) <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter the ip address of the server DNS (CIDR format) ([ENTER] set to default: 1.1.1.1):</code> </pre> <br><h3 id="4134-ukazanie-wan-interfeysa">  4.1.3.4.  Specifying WAN Interface </h3><br><p>  Next you need to enter the name of the external network interface that will listen to the internal network interface of the VPN.  Just press Enter to set the default for AWS ( <code>eth0</code> ) <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter the name of the WAN network interface ([ENTER] set to default: eth0):</code> </pre> <br><h3 id="4135-ukazanie-imeni-klienta">  4.1.3.5.  Specifying a customer name </h3><br><p>  Enter the VPN username.  The fact is that the Wireguard VPN server cannot start until at least one client is added.  In this case, I entered the name <code>Alex@mobile</code> <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter VPN user name: Alex@mobile</code> </pre> <br><p>  After that, the screen should display the QR code with the configuration of the newly added client, which must be read using the Wireguard mobile client on Android or iOS, to configure it.  And also below the QR code, the text of the configuration file will be displayed in the case of manual configuration of clients.  How to do this will be discussed below. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a4b/22f/66d/a4b22f66d885ebee84bac4b04bbc5369.jpg" alt="Completing the Wireguard installation"></p><br><h2 id="42-dobavlenie-novogo-vpn-polzovatelya">  4.2.  Add new VPN user </h2><br><p>  To add a new user, you need to run the script <code>add-client.sh</code> in the terminal </p><br><pre> <code class="plaintext hljs">sudo ./add-client.sh</code> </pre> <br><p>  The script asks for the username: <br>  <em>Example output:</em> </p><br><pre> <code class="plaintext hljs">Enter VPN user name:</code> </pre> <br><p>  Also, the name can be passed to users as a script parameter (in this case, <code>Alex@mobile</code> ): </p><br><pre> <code class="plaintext hljs">sudo ./add-client.sh Alex@mobile</code> </pre> <br><p>  As a result of the script, in the directory with the client's name on the path <code>/etc/wireguard/clients/{}</code> , a file with the client configuration <code>/etc/wireguard/clients/{}</code> will be created, and QR code to configure mobile clients and configuration file contents. </p><br><h3 id="421-fayl-polzovatelskoy-konfiguracii">  4.2.1.  User configuration file </h3><br><p>  You can display the contents of the .conf file, for manual configuration of the client, using the <code>cat</code> </p><br><pre> <code class="plaintext hljs">sudo cat /etc/wireguard/clients/Alex@mobile/Alex@mobile.conf</code> </pre> <br><p>  result of execution: </p><br><pre> <code class="plaintext hljs">[Interface] PrivateKey = oDMWr0toPVCvgKt5oncLLRfHRit+jbzT5cshNUi8zlM= Address = 10.50.0.2/32 DNS = 1.1.1.1 [Peer] PublicKey = mLnd+mul15U0EP6jCH5MRhIAjsfKYuIU/j5ml8Z2SEk= PresharedKey = wjXdcf8CG29Scmnl5D97N46PhVn1jecioaXjdvrEkAc= AllowedIPs = 0.0.0.0/0, ::/0 Endpoint = 4.3.2.1:54321</code> </pre> <br><p>  Description of client configuration file: </p><br><pre> <code class="plaintext hljs">[Interface] PrivateKey =    Address = IP   DNS =    [Peer] PublicKey =    PresharedKey =      AllowedIPs =     ( - 0.0.0.0/0, ::/0) Endpoint = IP     </code> </pre> <br><h3 id="422-qr-kod-konfiguracii-klienta">  4.2.2.  QR client configuration code </h3><br><p>  The configuration code for a previously created client can be <code>qrencode -t ansiutf8</code> on the terminal‚Äôs QR screen using the <code>qrencode -t ansiutf8</code> (in this example, the client named Alex @ mobile is used): </p><br><pre> <code class="plaintext hljs">sudo cat /etc/wireguard/clients/Alex@mobile/Alex@mobile.conf | qrencode -t ansiutf8</code> </pre> <br><h1 id="5-konfigurirovanie-vpn-klientov">  5. Configuring VPN Clients </h1><br><h2 id="51-nastroyka-mobilnogo-klienta-android">  5.1.  Setting up a mobile client Android </h2><br><p>  The official Wireguard client for Android can be <a href="https://play.google.com/store/apps/details%3Fid%3Dcom.wireguard.android">installed from the official GooglePlay store</a> </p><br><p>  After that, you need to import the configuration by reading the QR code with the client configuration (see clause 4.2.2) and give it a name: </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/861/c38/bba/861c38bba4d89d5569ecf243d7698bc9.jpg" alt="Configuring the Android client Wireguard"></p><br><p>  After successfully importing the configuration, you can enable the VPN tunnel.  On the successful connection will say the little key in the system tray Android </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/a19/5cb/f5d/a195cbf5d352c812bfed9f2a62b4743b.jpg" alt="Android running Wireguard client"></p><br><h2 id="52-nastroyka-klienta-windows">  5.2.  Windows Client Setup </h2><br><p>  Initially, you need to download and install the <a href="https://tunsafe.com/download">TunSafe</a> program <a href="https://tunsafe.com/download">for Windows</a> - this is the Wireguard client for Windows. </p><br><h3 id="521-sozdanie-fayla-konfiguracii-dlya-importa">  5.2.1.  Creating a configuration file for import </h3><br><p>  Right-click to create a text file on the desktop. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fad/09f/54e/fad09f54e4ff9a2482641f869f408a6d.jpg" alt="Creating a text file"></p><br><h3 id="522-kopirovanie-soderzhimogo-fayla-konfiguracii-s-servera">  5.2.2.  Copying the contents of the configuration file from the server </h3><br><p>  Then go back to the Putty terminal and display the contents of the configuration file of the desired user, as described in step 4.2.1. <br>  Next, select the right-click configuration text in the terminal Putty, after the selection is completed, it is automatically copied to the clipboard. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/fc0/937/846/fc0937846ef68a658be436afd63a83cf.jpg" alt="Copying text with configuration"></p><br><h3 id="523-kopirovanie-konfiguracii-v-lokalnyy-fayl-konfiguracii">  5.2.3.  Copying configuration to local configuration file </h3><br><p>  This field is returned to the text file we created earlier on the desktop, and paste the configuration text from the clipboard into it. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/6e4/3f7/095/6e43f7095b1eb48c998fa9f0532f046c.jpg" alt="Copying text with configuration"></p><br><h3 id="524-sohranenie-lokalnogo-fayla-konfiguracii">  5.2.4.  Saving the local configuration file </h3><br><p>  Save the file with the <strong>.conf</strong> extension (in this case with the name <code>london.conf</code> ) </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/4e9/cf6/448/4e9cf64484b951db1a7a19b71e37fcc0.jpg" alt="Save the configuration file"></p><br><h3 id="525-import-lokalnogo-fayla-konfiguracii">  5.2.5.  Import local configuration file </h3><br><p>  Next, you need to import the configuration file into the TunSafe program. </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/944/8f3/a27/9448f3a27ccc04f602592b23f66b5a5a.jpg" alt="Import configuration file into TunSafe"></p><br><h3 id="526-ustanovka-vpn-soedineniya">  5.2.6.  Establishing a VPN connection </h3><br><p>  Select this configuration file and connect by clicking the <strong>Connect</strong> button. <br><img src="https://habrastorage.org/getpro/habr/post_images/39d/c82/6e1/39dc826e150eda422254c55891c037d5.jpg" alt="Connecting to a VPN server through TunSafe"></p><br><h1 id="6-proverka-uspeshnosti-podklyucheniya">  6. Verify successful connection </h1><br><p>  To check the success of the connection through the VPN tunnel, you need to open a browser and go to the site <a href="https://2ip.ua/ru/">https://2ip.ua/ru/</a> </p><br><p><img src="https://habrastorage.org/getpro/habr/post_images/b8c/b93/442/b8cb93442fa9a3d037b753496436026b.jpg" alt="Connecting to a VPN server through TunSafe"></p><br><p>  The displayed IP address must match the one we received in step 2.2.3. <br>  If so, then the VPN tunnel is working successfully. </p><br><p>  From a terminal in Linux, you can check your IP address by entering the command: </p><br><pre> <code class="plaintext hljs">curl http://zx2c4.com/ip</code> </pre> <br><p>  Or you can just go to the pornohab if you are in Kazakhstan. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/448528/">https://habr.com/ru/post/448528/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../448510/index.html">Acer in 2019: what if you remove all the trinkets from the gaming laptops</a></li>
<li><a href="../448516/index.html">Evolving or making a base for a rote cart on the ARDUINO platform, while sensors and video are being driven to a computer via a smartphone</a></li>
<li><a href="../448518/index.html">How to see a black hole?</a></li>
<li><a href="../448522/index.html">Config generation for nginx, history of one pull request</a></li>
<li><a href="../448524/index.html">Israeli scientists for the first time in the world printed a living heart</a></li>
<li><a href="../448530/index.html">How Megaphone burned on mobile subscriptions</a></li>
<li><a href="../448532/index.html">Space data center. Summing up the experiment</a></li>
<li><a href="../448534/index.html">Why do we need industrial switches with improved EMC?</a></li>
<li><a href="../448538/index.html">Building a Failover Solution Based on Oracle RAC and AccelStor Shared-Nothing Architecture</a></li>
<li><a href="../448540/index.html">VMware NSX for the smallest. Part 5. Configuring a Load Balancer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>