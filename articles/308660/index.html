<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Scrapy: collect data and save to database</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 I am interested in this framework for collecting information from sites. There were publications on Scrapy, but since there is not enou...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Scrapy: collect data and save to database</h1><div class="post__text post__text-html js-mediator-article"><h3>  Introduction </h3><br>  I am interested in this <a href="http://scrapy.org/">framework</a> for collecting information from sites.  There were publications on Scrapy, but since there is not enough detailed information in Russian, I would like to tell you about my experience. <br><a name="habracut"></a><br><h3>  Task </h3><br><ol><li>  Go to the page with a list of applicants <a href="http://oreluniver.ru/abits%3Fsrc%3Dall_postupil">oreluniver.ru/abits?src=all_postupil</a> .  Then follow each link and collect data on applicants and points scored. </li><li>  From the very same page, collect data on specialties, which was conducted recruitment. </li><li>  Save all results to database </li></ol><br><h3>  Decision </h3><br>  To solve the problem, I used Python 2.7, Scrapy 1.1 Sqlalchemy 1, Sqlite.  Installed everything as described in the documentation.  The <a href="https://habrahabr.ru/post/115710/">article</a> also describes the installation in Russian, in the same place about the creation of the spider itself.  Here's what I got. <br><br>  Project structure: <br><br><blockquote>  \ spiders <br>  \ spiders \ __ init__.py <br>  \ spiders \ abiturlist.py <br>  \ spiders \ SpecSpider.py <br>  __init__.py <br>  items.py <br>  pipelines.py <br>  settings.py </blockquote><br><div class="spoiler">  <b class="spoiler_title">Items.py file</b> <div class="spoiler_text"><pre><code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.item <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Item, Field <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpecItem</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Item)</span></span></span><span class="hljs-class">:</span></span> spec = Field() SpecName = Field() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GtudataItem</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Item)</span></span></span><span class="hljs-class">:</span></span> family = Field() name = Field() surname = Field() spec = Field() ball = Field() url = Field() pagespec = Field()</code> </pre> </div></div><br>  Here is the spider class for getting the list of applicants. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <div class="spoiler">  <b class="spoiler_title">Abiturlist.py file</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.spiders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CrawlSpider, Rule <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.linkextractors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinkExtractor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.loader.processors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> TakeFirst, Identity <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.loader <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ItemLoader <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.selector <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HtmlXPathSelector, Selector <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gtudata.items <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> GtudataItem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbiturLoader</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(ItemLoader)</span></span></span><span class="hljs-class">:</span></span> default_output_processor = Identity() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbiturlistSpider</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(CrawlSpider)</span></span></span><span class="hljs-class">:</span></span> name = <span class="hljs-string"><span class="hljs-string">"abiturlist"</span></span> allowed_domains = [<span class="hljs-string"><span class="hljs-string">"oreluniver.ru"</span></span>] start_urls = [<span class="hljs-string"><span class="hljs-string">"http://oreluniver.ru/abits?src=all_postupil"</span></span>] rules = ( Rule(LinkExtractor(allow=(<span class="hljs-string"><span class="hljs-string">'spec_id=04.03.01'</span></span>)), callback=<span class="hljs-string"><span class="hljs-string">'parse_item'</span></span>), ) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">parse_item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, response)</span></span></span><span class="hljs-function">:</span></span> hxs = Selector(response) all = hxs.xpath(<span class="hljs-string"><span class="hljs-string">"//tr[position()&gt;1]"</span></span>) pg_spec = hxs.xpath(<span class="hljs-string"><span class="hljs-string">"//div[@class='page-content']/b/div/text()"</span></span>).extract()[<span class="hljs-number"><span class="hljs-number">0</span></span>].strip() <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> fld <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> all: Item = GtudataItem() FIO = fld.xpath(<span class="hljs-string"><span class="hljs-string">"./td[2]/p/text()"</span></span>).extract()[<span class="hljs-number"><span class="hljs-number">0</span></span>].split() Item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>] = FIO[<span class="hljs-number"><span class="hljs-number">0</span></span>] Item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] = FIO[<span class="hljs-number"><span class="hljs-number">1</span></span>] Item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>] = FIO[<span class="hljs-number"><span class="hljs-number">2</span></span>] Item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>] = fld.xpath(<span class="hljs-string"><span class="hljs-string">"./td[last()]/p/text()"</span></span>).extract()[<span class="hljs-number"><span class="hljs-number">0</span></span>] ball = fld.xpath(<span class="hljs-string"><span class="hljs-string">"string(./td[3]/p)"</span></span>).extract()[<span class="hljs-number"><span class="hljs-number">0</span></span>] Item[<span class="hljs-string"><span class="hljs-string">'ball'</span></span>] = ball Item[<span class="hljs-string"><span class="hljs-string">'url'</span></span>] = response.url Item[<span class="hljs-string"><span class="hljs-string">'pagespec'</span></span>] = pg_spec <span class="hljs-keyword"><span class="hljs-keyword">yield</span></span> Item</code> </pre> </div></div><br>  This class describes the spider class to collect a list of specialties.  To determine the fields used Xpath.  To separate the number of a specialty and its name, we use slices; the specialty number takes 9 characters. <br><br><div class="spoiler">  <b class="spoiler_title">SpecSpider.py file</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.spiders <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> CrawlSpider, Rule <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.linkextractors <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> LinkExtractor <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.selector <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> HtmlXPathSelector, Selector <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gtudata.items <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SpecItem <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpecSpider</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(CrawlSpider)</span></span></span><span class="hljs-class">:</span></span> name = <span class="hljs-string"><span class="hljs-string">"speclist"</span></span> allowed_domains = [<span class="hljs-string"><span class="hljs-string">"oreluniver.ru"</span></span>] start_urls = [<span class="hljs-string"><span class="hljs-string">"http://oreluniver.ru/abits?src=all_postupil"</span></span>] <span class="hljs-comment"><span class="hljs-comment"># /abits?src=all_postupil rules = ( Rule(LinkExtractor(allow = ('src=all_postupil')), callback='parse_item'), ) def parse_item(self, response): hxs = Selector(response) all = hxs.xpath('//a[contains(@href, "spec_id")]/text()').extract() # print 'test' for fld in all: txt = fld.strip() Item = SpecItem() Item['SpecName'] = txt[9:] Item['spec'] = txt[:8] yield Item</span></span></code> </pre> </div></div><br>  I would like to mention the possibility of creating several classes for the collected data in the Items.py file.  In my case: <br><br><ul><li>  SpecItem - for the list of specialties; </li><li>  GtudataItem - for these applicants. </li></ul><br><h3>  Saving results to the database </h3><br>  The file pipelines.py describes the steps to save data.  To create a sqlite database with a given table structure, I used sqlalchemy. <br><br>  First, create an instance of the declarative_base () class, from which we will inherit the classes, to describe the database tables in which we will store the found information.  These are classes SpecTable, for saving the list of specialties, and DataTable, for saving data of applicants. <br><br>  In each class, set the attribute __tablename__.  This is the name of the table in the database.  then we set the fields: <br><br><pre> <code class="python hljs">id = Column(Integer, primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>)</code> </pre> <br>  id - integer, primary key. <br><br>  The remaining fields, for example the number of specialty: <br><br><pre> <code class="python hljs">spec = Column(String)</code> </pre> <br>  In the __init __ () method we fill in the fields of the table. <br><br>  The GtudataPipeline class describes how to work with a database.  During initialization, we check for the presence of a database file in the project folder.  If the file is missing, then create a database with a given structure. <br><br><pre> <code class="python hljs">Base.metadata.create_all(self.engine)</code> </pre> <br>  In the process_item method we describe the actual storage to the database.  Check which class is item.  Depending on this, fill in one of the two tables.  To do this, create instances of the DataTable and SpecTabl classes. <br><br><pre> <code class="python hljs">dt = DataTable(item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>],item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'ball'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'url'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'pagespec'</span></span>]) dt = SpecTable(item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>],item[<span class="hljs-string"><span class="hljs-string">'SpecName'</span></span>])</code> </pre> <br>  To ensure the uniqueness of the stored data (applicants in the tables can be repeated) use the fio attribute.  This set, the elements of which are formed by the next line. <br><br><pre> <code class="python hljs">fio = item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>] + item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] + item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>]</code> </pre> <br>  If such an applicant is in the database, the record is not saved. <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fio <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.fio: dt = DataTable(item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>],item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'ball'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'url'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'pagespec'</span></span>]) self.fio.add(fio) self.session.add(dt)</code> </pre> <br>  Add a new entry: <br><br><pre> <code class="python hljs">self.session.add(dt)</code> </pre> <br>  When opening a spider, create a session: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open_spider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spider)</span></span></span><span class="hljs-function">:</span></span> self.session = Session(bind=self.engine)</code> </pre> <br>  When closing the spider we complete the changes: <br><br><pre> <code class="python hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close_spider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spider)</span></span></span><span class="hljs-function">:</span></span> self.session.commit() self.session.close()</code> </pre> <br>  Here's what happened: <br><br><div class="spoiler">  <b class="spoiler_title">Pipelines.py file</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy.ext.declarative <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> declarative_base <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> create_engine, Table, Column, Integer, String, MetaData, ForeignKey <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> sqlalchemy.orm <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> Session <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> os <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> gtudata.items <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> SpecItem, GtudataItem <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> scrapy.exceptions <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> DropItem Base = declarative_base() <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SpecTable</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Base)</span></span></span><span class="hljs-class">:</span></span> __tablename__ = <span class="hljs-string"><span class="hljs-string">'specdata'</span></span> id = Column(Integer, primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) spec = Column(String) spectitle = Column(String) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spec, spectitle)</span></span></span><span class="hljs-function">:</span></span> self.spec= spec self.spectitle = spectitle <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__repr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;Data %s, %s&gt;"</span></span> % (self.spec, self.spectitle) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataTable</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(Base)</span></span></span><span class="hljs-class">:</span></span> __tablename__ = <span class="hljs-string"><span class="hljs-string">'gtudata'</span></span> id = Column(Integer, primary_key=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) family = Column(String) name = Column(String) surname = Column(String) spec = Column(String) ball = Column(Integer) url = Column(String) pagespec = Column(String) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, family, name, surname, spec, ball, url, pagespec)</span></span></span><span class="hljs-function">:</span></span> self.family = family self.name = name self.surname = surname self.spec = spec self.ball = ball self.url = url self.pagespec = pagespec <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__repr__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"&lt;Data %s, %s, %s, %s, %s, %s, %s&gt;"</span></span> % \ (self.family, self.name, self.surname, self.spec, self.ball, self.url, self.pagespec) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">GtudataPipeline</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(object)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__init__</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> basename = <span class="hljs-string"><span class="hljs-string">'data_scraped'</span></span> self.engine = create_engine(<span class="hljs-string"><span class="hljs-string">"sqlite:///%s"</span></span> % basename, echo=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> os.path.exists(basename): Base.metadata.create_all(self.engine) self.fio = set() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">process_item</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, item, spider)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> isinstance(item, GtudataItem): fio = item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>] + item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>] + item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> fio <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> self.fio: dt = DataTable(item[<span class="hljs-string"><span class="hljs-string">'family'</span></span>],item[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'surname'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'ball'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'url'</span></span>], item[<span class="hljs-string"><span class="hljs-string">'pagespec'</span></span>]) self.fio.add(fio) self.session.add(dt) <span class="hljs-keyword"><span class="hljs-keyword">elif</span></span> isinstance(item, SpecItem): dt = SpecTable(item[<span class="hljs-string"><span class="hljs-string">'spec'</span></span>],item[<span class="hljs-string"><span class="hljs-string">'SpecName'</span></span>]) self.session.add(dt) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> item <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">close_spider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spider)</span></span></span><span class="hljs-function">:</span></span> self.session.commit() self.session.close() <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">open_spider</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self, spider)</span></span></span><span class="hljs-function">:</span></span> self.session = Session(bind=self.engine)</code> </pre> </div></div><br>  Run in the project folder: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">scrapy</span></span> crawl speclist scrapy crawl abiturlist</code> </pre> <br>  And we get the result.  The full version of the project is posted on <a href="https://github.com/dmitryzy/gtudata">GitHub</a> <br><br><h3>  List of sources </h3><br><ol><li>  <a href="https://scrapy.readthedocs.io/en/latest/index.html">Scrapy documentation</a> </li><li>  <a href="https://habrahabr.ru/post/115710/">Collect data with Scrapy</a> </li><li>  <a href="http://www.sqlalchemy.org/download.html">Sqlalchemy</a> </li></ol></div><p>Source: <a href="https://habr.com/ru/post/308660/">https://habr.com/ru/post/308660/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../308648/index.html">Acceleration of printing from a terminal session of Windows Server or completion of the EasyPrint file</a></li>
<li><a href="../308652/index.html">Asterisk REST Interface (ARI) Overview</a></li>
<li><a href="../308654/index.html">PHP function speed analysis tool</a></li>
<li><a href="../308656/index.html">Interfaces in the real world: user error insurance</a></li>
<li><a href="../308658/index.html">Facebook is trying to please everyone, constantly changing the "rules of the game"</a></li>
<li><a href="../308662/index.html">To the question about pins</a></li>
<li><a href="../308672/index.html">In the shadow of a random forest</a></li>
<li><a href="../308674/index.html">The digest of interesting materials for the mobile # 168 developer (August 22-28)</a></li>
<li><a href="../308676/index.html">Solve problems with remote connections in 3CX</a></li>
<li><a href="../308680/index.html">15 bugs or html and css tips</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>