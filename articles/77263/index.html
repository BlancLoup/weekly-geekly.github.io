<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Easy way to post pictures in FCKeditor + IMCE + Lightbox2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Drupal is very flexible, which is why I like it. Any problem can be solved in several ways. 

 Before me was the task - to make downloading and publis...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Easy way to post pictures in FCKeditor + IMCE + Lightbox2</h1><div class="post__text post__text-html js-mediator-article">  Drupal is very flexible, which is why I like it.  Any problem can be solved in several ways. <br><br>  Before me was the task - to make downloading and publishing pictures in the text easy and convenient. <br>  I draw your attention to the fact that I am not going to create interactive galleries.  I just want the user to be able to upload pictures through a convenient visual editor and just as convenient to publish them. <br><br>  As an editor, I chose FCKeditor as the image uploader and IMCE file browser. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Now about the problem itself. </h2><br>  Imagine that you uploaded a picture to the server, created its thumbnail, and now you want to insert this thumbnail into your post.  When clicking on it, the thumbnail should open the image in its original size using the Lightbox2 module. <br><br>  To do it manually is inconvenient and long. <br>  On the pages of drupal.ru I found a solution.  The solution was to edit FCKeditor.  So with each update, you would have to re-edit all these files. <br>  So I decided to write my bike, small and not very flexible.  But suitable for my site. <br><a name="habracut"></a><br><h2>  Decision </h2><br><br>  I am the most vehement who doesn‚Äôt like to write plugins - I like to do everything through <code>page.tpl.php</code> or to include my functions directly in <code>index.php</code> . <br><br>  Okay, let's look at the html page code, and see what we have at the moment: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">img</font> <font color="#ff0000">alt</font> <font color="#0000ff">=""</font> <font color="#ff0000">height</font> <font color="#0000ff">="90"</font> <font color="#ff0000">src</font> <font color="#0000ff">="/sites/default/files/img/2-27SP_vorn_small.jpg"</font> <font color="#ff0000">width</font> <font color="#0000ff">="90"</font> <font color="#0000ff">/&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  we need to turn this code into something like this: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">&lt;</font> <font color="#800000">a</font> <font color="#ff0000">href</font> <font color="#0000ff">="/sites/default/files/img/2-27SP_vorn.jpg"</font> <font color="#0000ff">&gt;&lt;</font> <font color="#800000">img</font> <font color="#ff0000">src</font> <font color="#0000ff">="/sites/default/files/img/2-27SP_vorn_small.jpg"</font> <font color="#ff0000">alt</font> <font color="#0000ff">=""</font> <font color="#0000ff">&gt;&lt;/</font> <font color="#800000">a</font> <font color="#0000ff">&gt;</font></font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Let's open our page.tpl.php (this is your theme file). <br>  And write the very first line of our code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (strstr($content, <font color="#A31515">'src='</font> )){ <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  This line will tell us if there are any image elements on the page. <br>  Next, we will write a script that changes the image on the image link that leads to the original. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">$content = preg_replace( <font color="#A31515">'#&lt;img width=\"[0-9a-zA-Z ]*\" height=\"[0-9a-zA-Z ]*\" src=\"([a-zA-Z0-9\/_-]+)*(_small+)\.(jpg|gif|png+)\"([ a-zA-Z="-_.]+)*\/\&gt;#'</font> , <font color="#A31515">"&lt;a href=\"$1.$3\"&gt;&lt;img src=\"$1$2.$3\" $4&gt;&lt;/a&gt;"</font> ,$content);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  + Let's make sure that these changes do not take place on the pages of the visual editor.  To do this, create the following condition: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (!strstr($_SERVER[ <font color="#A31515">'REQUEST_URI'</font> ], <font color="#A31515">'edit'</font> ))</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br><h3>  As a result, we have such a script: </h3><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (!strstr($_SERVER[ <font color="#A31515">'REQUEST_URI'</font> ], <font color="#A31515">'edit'</font> )) <br> { <br> <font color="#0000ff">if</font> (strstr($content, <font color="#A31515">"src="</font> )) <br> { <br> $content = preg_replace( <font color="#A31515">'#&lt;img width=\"[0-9a-zA-Z ]*\" height=\"[0-9a-zA-Z ]*\" src=\"([a-zA-Z0-9\/_-]+)*(_small+)\.(jpg|gif|png+)\"([ a-zA-Z="-_.]+)*\/\&gt;#'</font> , <font color="#A31515">"&lt;a href=\"$1.$3 <br> \"&gt;&lt;img src=\"$1$2.$3\" $4&gt;&lt;/a&gt;"</font> ,$content); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Now this code can be safely inserted into the very beginning of the <code>page.tpl.php</code> file. <br><br><h2>  What have we got? </h2><br>  Now it is enough for any user to upload a picture, create a <strong>thumbnail with the _small suffix</strong> (it is created if you select the item at boot) and add this thumbnail to the node. <br><br><h2>  + Add support for lightbox2 </h2><br>  Go to the admin area, then to the Lightbox page. <br>  Find the tab <code>Automatic image handling</code> . <br>  Go to the item <code>Custom Class Images</code> . <br>  Choose Lightbox, or, for example, Lightbox Groped and specify the name of the picture class. <br>  By default is lb2.  This and I advise you to leave. <br><br>  We change our script so that the picture has this class. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">if</font> (!strstr($_SERVER[ <font color="#A31515">'REQUEST_URI'</font> ], <font color="#A31515">'edit'</font> )) <br> { <br> <font color="#0000ff">if</font> (strstr($content, <font color="#A31515">"src="</font> )) <br> { <br> $content = preg_replace( <font color="#A31515">'#&lt;img width=\"[0-9a-zA-Z ]*\" height=\"[0-9a-zA-Z ]*\" src=\"([a-zA-Z0-9\/_-]+)*(_small+)\.(jpg|gif|png+)\"([ a-zA-Z="-_.]+)*\/\&gt;#'</font> , <font color="#A31515">"&lt;a href=\"$1.$3 <br> \"&gt;&lt;img class=\"lb2\" src=\"$1$2.$3\" $4&gt;&lt;/a&gt;"</font> ,$content); <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  All is ready! <br><br>  <strong><a href="">Download full script</a> [0.5 kb]</strong> <br><br>  <a href="http://new.velo-travel.ru/%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580%25D0%25B0%25D1%2585%25D0%25B0%25D0%25B1%25D1%2580">The result of the script</a> (test site) <br><br></div><p>Source: <a href="https://habr.com/ru/post/77263/">https://habr.com/ru/post/77263/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../77257/index.html">New features from Amazon for EC2 service</a></li>
<li><a href="../77258/index.html">So similar and so different ...</a></li>
<li><a href="../77259/index.html">Triumph Add to cart (GLONASS + GPS) public transport</a></li>
<li><a href="../77261/index.html">MobileNoter - a program for keeping notes and syncing with OneNote</a></li>
<li><a href="../77262/index.html">MS SQL Server 2008 received a certificate of compliance with the requirements of the Russian Federation Law on Personal Data Protection</a></li>
<li><a href="../77265/index.html">Canobuvosti, 16th edition</a></li>
<li><a href="../77267/index.html">How to "honestly" simulate events</a></li>
<li><a href="../77268/index.html">What are robots doing?</a></li>
<li><a href="../77269/index.html">The results of the competition of Internet sites "Electronic Volgograd"</a></li>
<li><a href="../77270/index.html">nullCMS: dokilobaytny engine</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>