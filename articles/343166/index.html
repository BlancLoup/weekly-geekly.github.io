<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>NRF51822 in brief: Quick start</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="1. Introduction 
 Good day. 

 A huge number of programming lessons for various unpretentious (and not so) platforms are walking around the net. Every...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>NRF51822 in brief: Quick start</h1><div class="post__text post__text-html js-mediator-article"><h3>  1. Introduction </h3><br>  Good day. <br><br>  A huge number of programming lessons for various unpretentious (and not so) platforms are walking around the net.  Every year, the same type of tutorials of different degrees of depth on the same microcontroller are stamped in dozens.  And this is wonderful, since the abundance of articles leads to a lower threshold for entering the topic and allows mature programmers not to waste time searching for reads up and down the datasheet, but simply use the working piece of the peripheral initialization code and move on to problems more seriously. <br><br>  However, there is a nuance - a step to the right, a step to the left from the standard selection of STM32 / 8, AVR and others like them or a dimple into more complex interfaces of the same STM32 / 8, and silence.  Only occasionally in a distant, distant forum, someone asks a question that ultimately remains unanswered ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      What I, in fact, lead.  Not so long ago, it became necessary to use the <b>Nordic Semiconductor</b> <b>nRF51822</b> chip with the currently popular Bluetooth low energy theme (hereinafter - BLE) on board. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/07f/e41/3ac/07fe413ac7aafa31d0dc8b30f2173869.png" alt="image"><br><br>  The chip turned out to be so popular on the information component that Google, with a grief in half, issued 2-3 links describing the BLE stack itself and a couple of abstract articles on the implementation of the stack in Nordic and <b>Texas instruments (CC2640) chips</b> .  Experienced programmers will say: "Take examples from the Nordic company (and there they are, by the way, in abundance) and sort it out."  And this is the right approach, if not for one thing, but, for the most part, novice programmers and those who want to get quick results: an abundance of structures, multi-level libraries - all this is fine and logical, but redundant for a quick start or a small project.  All this increases the threshold of entry to unjustified heights. <br><a name="habracut"></a><br>  In view of the foregoing, I propose to consider a simple version of the implementation of the exchange application using the <b>NRF51822</b> chip, which makes it possible in general to understand the main aspects of the development of such systems.  And it will be ... Naturally, the LED.  Running a remote smartphone. <br><br><h3>  2. Required software and hardware </h3><br><ul><li>  NRF51 debug board (I use NRF51 DK); </li><li>  smartphone running the Android operating system; </li><li>  Keil uVision programming environment; </li><li>  15 minutes of free time. </li></ul><br>  You can use a <b>USB dongle</b> instead of a smartphone, but its price <b>($ 77)</b> , compared to the price of the <b>NRF51 DK</b> debugging board <b>($ 49)</b> , pushes a little away.  In this example, its presence is optional, but still do not underestimate its importance. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/308/eb9/a72/308eb9a72feb1f99a49821b64dac113a.png" alt="image"><br><br><h3>  3. Creating a template </h3><br>  The primary task is to create a template in Keil and connect all the necessary library files to use the BLE stack.  The process itself from scratch is quite time consuming, so we will use the standard template that can be found among the many examples that Keil kindly hides in the <i>Pack Installer</i> . <br><br><img src="https://habrastorage.org/webt/qd/0c/wh/qd0cwhq-i9d6vwhdzdf8hd4fzy0.jpeg"><br><br>  The functions implemented in the example are, for the most part, necessary for creating a connection and organizing the reaction of the BLE stack to events that occur (connection, disconnection, etc.).  At the moment, I don‚Äôt see any reason to dwell on them in order not to overload with information, and don‚Äôt touch them yet, as long as there is no common understanding about the process of using the stack (In the draft attached to the article, all functions are uncommented in Russian).  More information about the stack itself can be found at the <a href="https://habrahabr.ru/post/319244/">link</a> .  You can experiment with the connection settings in the future as well as with stack events, but this is not a topic for this article. <br><br><h3>  4. Stack firmware and applications </h3><br>  As it has already been mentioned more than once in other articles on the implementation of the BLE stack on various devices, the BLE stack is sewn into the bottom of the flash memory, after which the user application is loaded.  Fortunately for the uninitiated in this aspect, in the template used, the addressing is already set, and all we need to do is in the <i>Select Target</i> section, select <b>SoftDevice S130</b> and click download. <br><br><img src="https://habrastorage.org/webt/7v/9k/1j/7v9k1j56hv9kksmtmtnafqewjdu.jpeg"><br><br>  Now in the same way we will load the compiled user application. <br><br><h3>  5. Preliminary testing </h3><br>  At the moment, the downloaded application does not perform any useful functions for us, but it is able to send advertising packages with the ability to connect to the device.  Detailed information can be fully obtained in the article that I mentioned earlier. <br>  In order to connect to the received device, we need to download the <b>nRF Connect for Mobile</b> program on an Android smartphone.  We launch, scan the air and find our device - <b>Nordic_Template</b> .  We can connect, check whether everything is correct.  In the future, using this program, we will be able to read and write the characteristics of the device, thereby interacting with it. <br><br><img src="https://habrastorage.org/webt/tg/dd/b0/tgddb0rxal6ryptfw7llzmuumkm.png"><br><br>  As mentioned earlier, at the moment the device does not carry any useful data in itself, with the exception of service parameters.  Interaction with the device in BLE is provided through reading / writing characteristics.  Characteristics are combined into services, they are then combined into profiles, but in general this is quite a serious topic for a separate article.  However, it is still necessary to explain in simple words what kind of function in the first approximation carries the characteristic.  Formally, this is a stack variable that has certain parameters (size, type, access type) that define interaction with it.  For all characteristics, you can enable read, write, notification, etc.  Through a characteristic that has permission to write, you can transfer any data to the device, and through a characteristic with read permission, you can get data. <br><br>  So, for example, you can implement a <i>request-response system</i> .  Imagine a device that has parameters (temperature, humidity, acceleration).  We can create 3 different characteristics and read their values.  Now imagine that we need to receive data for a certain period (for the last month, for example).  In this case, we will create a characteristic with recording resolution and we will write the month number to it, and the device, in turn, will put the requested data into the characteristics. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/042/95a/12f/04295a12fa344470b6910a56fb620bb4.png" alt="image"><br><br>  But back to our task.  In order to control the LED, you must create the appropriate service.  The service will contain 2 features: <br><br><ul><li>  characteristic to control the state of the LED <b>(Write only)</b> ; </li><li>  characteristic to determine the current status of the LED <b>(Read only)</b> . </li></ul><br>  Before you start writing your first service, you need to understand that each service and each characteristic it contains must have its own <b>unique address (UUID)</b> .  Thanks to this address, devices (for example, a smartphone) can determine what needs to be done with specific data.  It is worth noting that a number of profiles, services and characteristics are standard for BLE, have their <b>16-bit addresses</b> registered in Bluetooth SIG and a predetermined set of functions performed.  The smartphone, receiving data from the device on which one of these profiles is implemented, knows exactly the composition of the package and has all the necessary functions for the further implementation of the information received. <br><br>  Only <b>128-bit addresses</b> are available to us.  We assign 3 UUID addresses, one for the service and two for the characteristics.  To do this, we use a special <a href="http://www.onlineuuidgenerator.com/time/3/0/1/">generator</a> designed to form random UUIDs.  I advise you to select <i>Time-based</i> when generating, then UUIDs are generated sequentially with the same main part for all three addresses. <br><br><pre><code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">/*  UUID (  UUID    ) */</span></span> <span class="hljs-meta"><span class="hljs-meta">#</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_BASE_UUID {0x66, 0x9A, 0x0C, 0x20, 0x00, 0x08, 0x1A, 0x8F, 0xE7, 0x11, 0x61, 0xBE, 0x00, 0x00, 0x00, 0x00} </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*  UUID (  UUID    ) */</span></span></span><span class="hljs-meta"> #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> LED_SERVICE_UUID 0x1523 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> CONTROL_CHAR_UUID 0x1524 #</span><span class="hljs-meta-keyword"><span class="hljs-meta"><span class="hljs-meta-keyword">define</span></span></span><span class="hljs-meta"> READ_CHAR_UUID 0x1525 </span><span class="hljs-comment"><span class="hljs-meta"><span class="hljs-comment">/*   UUID     */</span></span></span><span class="hljs-meta"> static ble_uuid_t m_adv_uuids[] = {{LED_SERVICE_UUID, BLE_UUID_TYPE_BLE}};</span></span></code> </pre> <br>  Now let's proceed directly to the creation of the service.  In our template, fill in the <i>services_init</i> function: <br><br><div class="spoiler">  <b class="spoiler_title">services_init</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">uint16_t led_handles; //    (  ) <span class="hljs-type"><span class="hljs-type">void</span></span> services_init(<span class="hljs-type"><span class="hljs-type">void</span></span>){ ble_uuid_t ble_uuid; <span class="hljs-comment"><span class="hljs-comment">/*  128 -  UUID */</span></span> ble_uuid128_t base_uuid = LED_BASE_UUID; uint8_t uuid_type; ble_uuid.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = BLE_UUID_TYPE_VENDOR_BEGIN; ble_uuid.uuid = LED_SERVICE_UUID; sd_ble_uuid_vs_add(&amp;base_uuid, &amp;ble_uuid.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>); sd_ble_gatts_service_add(BLE_GATTS_SRVC_TYPE_PRIMARY, &amp;ble_uuid, &amp;led_handles); }</code> </pre><br></div></div><br>  The next step is to implement a universal function for creating characteristics: <br><br><div class="spoiler">  <b class="spoiler_title">char_add</b> <div class="spoiler_text"><pre> <code class="hljs pgsql"><span class="hljs-comment"><span class="hljs-comment">/*     * UUID -   * handles -    (  ) * n_bytes -    * iswrite, isnotf, isread -   , ,  */</span></span> uint32_t char_add(uint16_t <span class="hljs-type"><span class="hljs-type">UUID</span></span>, ble_gatts_char_handles_t * handles, uint8_t n_bytes, <span class="hljs-type"><span class="hljs-type">bool</span></span> iswrite, <span class="hljs-type"><span class="hljs-type">bool</span></span> isnotf, <span class="hljs-type"><span class="hljs-type">bool</span></span> isread){ ble_gatts_char_md_t char_md; ble_gatts_attr_md_t cccd_md; ble_gatts_attr_t attr_char_value; ble_uuid_t char_uuid; ble_gatts_attr_md_t attr_md; memset(&amp;cccd_md, <span class="hljs-number"><span class="hljs-number">0</span></span>, sizeof(cccd_md)); BLE_GAP_CONN_SEC_MODE_SET_OPEN(&amp;cccd_md.read_perm); BLE_GAP_CONN_SEC_MODE_SET_OPEN(&amp;cccd_md.write_perm); cccd_md.vloc = BLE_GATTS_VLOC_STACK; memset(&amp;char_md, <span class="hljs-number"><span class="hljs-number">0</span></span>, sizeof(char_md)); char_md.char_props.<span class="hljs-keyword"><span class="hljs-keyword">notify</span></span> = isnotf; //   ; char_md.char_props.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span> = iswrite; //   ; char_md.char_props.<span class="hljs-keyword"><span class="hljs-keyword">read</span></span> = isread; //   ; char_md.p_char_user_desc = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; char_md.p_char_pf = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; char_md.p_user_desc_md = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; char_md.p_cccd_md = &amp;cccd_md; char_md.p_sccd_md = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*  UUID - 128 -  */</span></span> char_uuid.<span class="hljs-keyword"><span class="hljs-keyword">type</span></span> = BLE_UUID_TYPE_VENDOR_BEGIN; char_uuid.uuid = <span class="hljs-type"><span class="hljs-type">UUID</span></span>; memset(&amp;attr_md, <span class="hljs-number"><span class="hljs-number">0</span></span>, sizeof(attr_md)); BLE_GAP_CONN_SEC_MODE_SET_OPEN(&amp;attr_md.read_perm); BLE_GAP_CONN_SEC_MODE_SET_OPEN(&amp;attr_md.write_perm); attr_md.vloc = BLE_GATTS_VLOC_STACK; attr_md.rd_auth = <span class="hljs-number"><span class="hljs-number">0</span></span>; attr_md.wr_auth = <span class="hljs-number"><span class="hljs-number">0</span></span>; attr_md.vlen = <span class="hljs-number"><span class="hljs-number">0</span></span>; attr_char_value.p_uuid = &amp;char_uuid; attr_char_value.p_attr_md = &amp;attr_md; attr_char_value.init_len = n_bytes; attr_char_value.init_offs = <span class="hljs-number"><span class="hljs-number">0</span></span>; attr_char_value.max_len = n_bytes; //  ; attr_char_value.p_value = <span class="hljs-keyword"><span class="hljs-keyword">NULL</span></span>; //   ; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> sd_ble_gatts_characteristic_add(led_handles, &amp;char_md, &amp;attr_char_value, handles); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; }</code> </pre><br></div></div><br>  The functions of creating the service and features are ready  Now let's estimate what else we need.  And we need two things: <br><br><ul><li>  write processing function in the characteristic <b>(Write Only)</b> ; </li><li>  the function of updating data in the characteristic <b>(Read Only)</b> . </li></ul><br>  Let's start with the recording processing function.  The stack has one interrupt handler <i>ble_evt_dispatch</i> , which is called in case of any stack events.  From this handler, all other user interrupt handlers are called that respond to an event if they have a defined response.  In this case, we will not write a separate handler, we will write only a function that performs actions in accordance with the data obtained, and we will check the event of interest in one of the standard handlers. <br><br><div class="spoiler">  <b class="spoiler_title">on_ble_evt</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">on_ble_evt</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">ble_evt_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> * p_ble_evt)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> err_code; <span class="hljs-comment"><span class="hljs-comment">/*         */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ble_gatts_evt_write_t</span></span> * p_evt_write = &amp;p_ble_evt-&gt;evt.gatts_evt.params.write; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (p_ble_evt-&gt;header.evt_id) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLE_GAP_EVT_CONNECTED: err_code = bsp_indication_set(BSP_INDICATE_CONNECTED); APP_ERROR_CHECK(err_code); m_conn_handle = p_ble_evt-&gt;evt.gap_evt.conn_handle; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLE_GAP_EVT_DISCONNECTED: m_conn_handle = BLE_CONN_HANDLE_INVALID; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> BLE_GATTS_EVT_WRITE: <span class="hljs-comment"><span class="hljs-comment">/*     (  ) */</span></span> write_handler(p_evt_write-&gt;data); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br></div></div><br>  The function of setting the status of the LED will not be given, it is quite simple, especially in the attached project this will all be implemented. <br><br>  We now turn to the function of updating data in the characteristic.  Our smartphone itself does not know that the state of the LED has changed.  And even in the case of a change in the variable responsible for the state of the LED on the device, reading the characteristic will still show the unchanged value.  To change it, you must register this change in the BLE stack.  Add another function (it is not universal, written for a specific characteristic, but is intuitive and easily rewritten for any needs): <br><br><div class="spoiler">  <b class="spoiler_title">data_update</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> data_update(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> *data, <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> value_handle) { <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> err_code; <span class="hljs-keyword"><span class="hljs-keyword">ble_gatts_value_t</span></span> gatts_value; <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> update_buffer[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-comment"><span class="hljs-comment">/*   (    ) */</span></span> <span class="hljs-built_in"><span class="hljs-built_in">memcpy</span></span>(update_buffer,data,(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(update_buffer)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>))); <span class="hljs-built_in"><span class="hljs-built_in">memset</span></span>(&amp;gatts_value, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(gatts_value)); <span class="hljs-comment"><span class="hljs-comment">/*    */</span></span> gatts_value.len = <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(update_buffer)/<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span>); gatts_value.offset = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> gatts_value.p_value = update_buffer; <span class="hljs-comment"><span class="hljs-comment">/*     */</span></span> err_code = sd_ble_gatts_value_set(m_conn_handle, read_handles.value_handle, &amp;gatts_value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> err_code; }</code> </pre><br></div></div><br>  It remains to be easy: to initialize the service and create characteristics in the main function: <br><br><div class="spoiler">  <b class="spoiler_title">main</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-comment"><span class="hljs-comment">/*    (  ) */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ble_gatts_char_handles_t</span></span> control_handles,read_handles; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> err_code; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> erase_bonds; timers_init(); buttons_leds_init(&amp;erase_bonds); ble_stack_init(); device_manager_init(erase_bonds); gap_params_init(); advertising_init(); <span class="hljs-comment"><span class="hljs-comment">/*   */</span></span> services_init(); <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> char_add(READ_CHAR_UUID,&amp;read_handles,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-comment"><span class="hljs-comment">/*        */</span></span> char_add(CONTROL_CHAR_UUID,&amp;control_handles,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>); conn_params_init(); <span class="hljs-comment"><span class="hljs-comment">/*       */</span></span> err_code = ble_advertising_start(BLE_ADV_MODE_FAST); APP_ERROR_CHECK(err_code); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (;;) { power_manage(); } }</code> </pre><br></div></div><br><h3>  7. Final testing </h3><br>  Compile, <b>upload</b> and run <b>nRF Connect for Mobile</b> again.  We see that we have a service and two characteristics.  They are unknown to the smartphone, since such UUIDs are not listed in its bases, and he does not understand what to do about it.  However, now we can safely control the LED by writing to the characteristic <b>"1"</b> or <b>"0"</b> , as well as read its current value.  This example can be applied to almost any task, for example, taking parameters from sensors.  In the future, you can write an application for Android, which will easily use your services for your purposes. <br><br><img src="https://habrastorage.org/webt/0f/4b/mk/0f4bmk7vah5zy4c1dxzkfnj8e5i.png"><br><h3>  8. Conclusion </h3><br>  This article is designed to simplify the understanding of the data exchange process and allow beginners to take advantage of a ready-made, disassembled example, in order to further in practice to comprehend all the features of the BLE stack from Nordic Semiconductor.  For the sake of simplicity, some features and nuances of implementation have been omitted, and there are quite a few of them in such devices.  However, no article will help to understand without systematic entry into the topic through trial and error.  All of the above will only allow you to start to make mistakes as quickly as possible.  Good luck) <br><br>  <b>PS</b> If the subject and manner of presentation are warmly received, then there is a chance to expand the selection of articles for the sake of modern trends, and in the near future to consider some of the nuances of the BLE stack, the implementation of popular peripherals (ADC, SPI, UART, I2C) using both libraries and in registers, as well as BLE application under android to complete the cycle. <br><br><h3>  X. Useful materials </h3><br><ul><li>  <a href="https://drive.google.com/open%3Fid%3D1vS39w8MTnHJMCvF8aOZZxpYy0MvL64N0">Project source code</a> </li><li>  <a href="https://habrahabr.ru/post/246241/">Getting started with a stack using the nRF51822 chip</a> </li><li>  <a href="https://habrahabr.ru/post/319244/">BLE under the microscope</a> </li><li>  <a href="https://developer.nordicsemi.com/nRF5_SDK/nRF51_SDK_v8.x.x/doc/8.1.0/s130/html/index.html">nRF51 SDK - S130 SoftDevice</a> </li><li>  <a href="https://habrahabr.ru/post/345396/">NRF51822 in brief: Power saving and some peripherals</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/343166/">https://habr.com/ru/post/343166/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../343150/index.html">As "Dadata" looking for duplicates in the lists of outlets. Parse the algorithm</a></li>
<li><a href="../343152/index.html">How I hacked into cryptocurrency companies and earned $ 60,000 from it</a></li>
<li><a href="../343156/index.html">Race to Tallinn data centers</a></li>
<li><a href="../343162/index.html">My company did not take off, 6 lessons at the cost of 4 years of life and $ 150,000</a></li>
<li><a href="../343164/index.html">How cheat traders on cryptocurrency exchanges: the investigation of Business Insider</a></li>
<li><a href="../343168/index.html">// booby, later</a></li>
<li><a href="../343172/index.html">The effect of dithering in a three-dimensional game</a></li>
<li><a href="../343174/index.html">Authorization through Network Policy Server (NPS) for MikroTik</a></li>
<li><a href="../343178/index.html">On fractals, martingales and random integrals. Part one</a></li>
<li><a href="../343180/index.html">Method Lego Serious Play: how to formulate and use the values ‚Äã‚Äãof the team with the help of children's designer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>