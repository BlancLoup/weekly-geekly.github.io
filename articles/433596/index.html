<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Magellan error: Buffer overrun or world expedition using SQLite FTS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Somehow bypassed the recent Magellan error and related vulnerabilities on Habr√©, I will try to correct this omission. 
 A bit of history 


- On Novem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Magellan error: Buffer overrun or world expedition using SQLite FTS</h1><div class="post__text post__text-html js-mediator-article"><p>  Somehow bypassed the recent <a href="https://blade.tencent.com/magellan/index_en.html">Magellan</a> error and related vulnerabilities on Habr√©, I will try to correct this omission. </p><br><h4 id="nemnogo-istorii">  A bit of history </h4><br><ul><li>  On November 1, 2018 a bug report number 900910 flew to Chromium: "Multiple issues in SQLite via WebSQL."  The error is reported by the Wenxiang Qian of the Tencent Blade Team. </li><li>  On November 5, 2018, the <a href="https://www.sqlite.org/src/vinfo/940f2adc8541a838%3Fdiff%3D1">error is closed</a> in the core of the SQLite library (FTS3), where it actually lives almost since the creation of the module, i.e.  since November of 2009. </li><li>  November 28, 2018 it merges into <a href="https://chromium.googlesource.com/chromium/src/%2B/c368e30ae55600a1c3c9cb1710a54f9c55de786e">Chromium</a> </li><li>  A little later, Tencent Blade Team <a href="https://blade.tencent.com/magellan/index_en.html">publishes</a> an error message, giving it the name Magellan, especially without disclosing details, and indicating that the publication of ready-made exploits and PoC is not planned yet. </li><li>  A week later, the Internet is full of PoC, cracking Chrome, Electron dev-framework, etc.  There is still no evidence and any other information that the vulnerability was used for malicious purposes. </li><li>  <abbr title="Dr. D. Richard Hipp, creator of SQLite and author of the fix">DRH</abbr> , confirmed the <a href="https://news.ycombinator.com/item%3Fid%3D18686305">suspicion of Hacker News</a> that a vulnerability exists (at least if the execution of a "foreign" SQL query, or SQL Injection of such a script is allowed). </li></ul><br><h4 id="chto-mozhet-byt-podverzheno-uyazvimosti">  What could be vulnerable? </h4><br><p>  Potentially, all devices and programs using SQLite (with FTS enabled) or using or based on applications (such as Chromium).  The extent to which they can be affected and the effect of a possible ‚Äúdefeat‚Äù depend on whether a suitable attack vector has been found. </p><br><h4 id="nemnogo-podrobnee-o-magellan-sqlite-bughttpsbladetencentcommagellanindex_enhtml">  A little more about <a href="https://blade.tencent.com/magellan/index_en.html">Magellan SQLite BUG</a> </h4><a name="habracut"></a><br><p>  The error is related to the overflow of the sum of integers aka <abbr title="in programming, the sum of the two terms can be suddenly less than the larger of them">integer overflow</abbr> , which can be caused in the <abbr title="built-in SQLite full-text index module">FTS3 / 4</abbr> subsystem by changing the FTS index of the table, which in turn can lead to memory rewriting or completion with an exception. </p><br><p>  Targeted artificial use of this integer overflow, by literally "truncating" the write buffers, leads to memory overflow, and can be used further by specially created SQL queries. </p><br><p>  As a result, in theory, <a href="https://en.wikipedia.org/wiki/SQLite">many applications</a> that use SQLite (with virtual FTS tables), and in particular, popular browsers that support SQLite-based WebSQL with FTS enabled (for example, Google Chrome, Chromium, Opera, Slimjet Browser, SRWare Iron, Torch, Comodo Dragon, CoolNovo, Yandex Browser, Vivaldi, etc.). </p><br><p>  SQLite databases are generally very popular, are provided by means of more than a dozen programming languages, toolchain, frameworks, etc., are used by applications for both mobile devices and full-fledged computers, and are often found even in server solutions.  For example, data in this format is stored in popular web browsers such as Google Chrome, Mozilla Firefox and Yandex Browser, many instant messengers (for example, WhatsApp, Viber, WeChat and others), etc.  etc. </p><br><p>  The same <a href="https://fossil-scm.org/">Fossil SCM</a> , for example, uses the SQLite database for storing revision history and allows using full-text indexing via FTS (and provides access to it from the UI / web snout, for example, it is possible to create your own SQL queries, for example, custom ticket reports etc.). </p><br><p>  <em>Update: DRH, being part-time co-author and developer of Fossil, apparently thought about the same thing, and already ‚Äú <a href="https://fossil-scm.org/index.html/info/e0a6ff0adb3da828">closed the hole</a> ‚Äù with updating SQLite to 3.26.0</em> </p><br><p>  Such a ‚Äúpredictable‚Äù overflow is not a very pleasant thing in and of itself, but if we recall what specifically can be stored in the bank itself (from the contents of the logs to the actual tables) ... <br>  So that comrades are not lazy ..., and we are updated, updated. </p><br><h4 id="gde-vzyat-fiks">  Where to get fix? </h4><br><p>  The fix <a href="https://www.sqlite.org/src/vinfo/940f2adc8541a838%3Fdiff%3D1">[940f2adc8541a838] is</a> provided as part of the SQLite 3.25.3 update (to which Chromium and Co. were also updated, for example, Chrome in version 71.0.3578.80). </p><br><p>  SQLite 3.26 also provides additional security features for FTS containers, for example: </p><blockquote>  support for read-only shadow tables when SQLITE_DBCONFIG_DEFENSIVE option is enabled </blockquote><br><h4 id="kakova-opasnost-etoy-uyazvimosti">  What is the danger of this vulnerability? </h4><br><p>  Critical.  Allows remote code execution.  A memory leak and program crashes are also likely. </p><br><h4 id="est-li-primery-gotovyh-exploit-ov-pozvolyayuschie-ispolzovat-uyazvimost">  Are there any examples of ready-made exploits to exploit the vulnerability? </h4><br><p>  Yes. </p><br><p>  In particular, Tencent Blade Team declares that they have successfully launched an attack on Google Home using this vulnerability (access to the description issue on the Google bug tracker is closed), and as has already been said above, no exploit code is currently planned to be disclosed. </p><br><h4 id="usloviya-ispolzovaniya-uyazvimosti">  Terms of use vulnerability? </h4><br><p>  Vulnerability can be performed remotely, for example, when a certain web page is called in a browser, or in any similar scenario, for example, allowing to execute SQL statements (if the FTS is not disabled, when a possible attack vector and / or the presence or occurrence of some other factors contributing to the exploitation is detected) vulnerabilities). </p><br><p>  By the way, this is not the first error of the type overflow &amp; buffer overrun in SQLite specifically and in the FTS module in particular (for example <a href="https://www.sqlite.org/src/info/56be976859294027">[56be976859294027]</a> ), but it is probably the largest of its kind in terms of significance, theoretical impact and relative ‚Äúscale‚Äù in the ways of possible use and assessment of of this. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/433596/">https://habr.com/ru/post/433596/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../433580/index.html">Roskomnadzor plans to introduce a new blocking system worth 20 billion rubles</a></li>
<li><a href="../433582/index.html">What if the 30/70 profit sharing ceases to be the gamedev standard?</a></li>
<li><a href="../433586/index.html">How we didn't win the hackathon</a></li>
<li><a href="../433588/index.html">The amazing performance of parallel C ++ 17 algorithms. Myth or Reality?</a></li>
<li><a href="../433592/index.html">Background: Yandex. Phone</a></li>
<li><a href="../433600/index.html">Phone Pixel 3 is learning to determine the depth in photos</a></li>
<li><a href="../433602/index.html">The basis of the rate of evolution may be mathematical simplicity.</a></li>
<li><a href="../433604/index.html">Comfortable work with Android Studio</a></li>
<li><a href="../433606/index.html">SIEM depths: out-of-box correlations. Part 3.2. Event Normalization Methodology</a></li>
<li><a href="../433608/index.html">Car of the future. Screens instead of autoglass?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>