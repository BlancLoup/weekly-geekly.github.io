<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How PVS-Studio turned out to be more attentive than three and a half programmers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="PVS-Studio, like other static code analyzers, often produces false positives. But do not hurry to consider strange triggers false. This is a short sto...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How PVS-Studio turned out to be more attentive than three and a half programmers</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/8e1/207/92e/8e120792e15aa808598ab23995db53ab.png" alt="How does the PVS-Studio turn out?"></div><br>  PVS-Studio, like other static code analyzers, often produces false positives.  But do not hurry to consider strange triggers false.  This is a short story about how PVS-Studio again turned out to be more attentive than several people. <br><br>  We wrote in support of the user, claiming that the analyzer generates four false alarms for one line of code at once.  The letter, written in support, initially came to Yevgeny Ryzhkov, who, after reading it fluently and not noticing the anomalous feedback feed, immediately sent it to the lead developer Svyatoslav Razmyslov.  Eugene did not peer into the code, so it would be honest to consider it only for half of the programmer :). <br><a name="habracut"></a><br><br>  Svyatoslav read the letter and doubted that the analyzer could be so blatantly wrong.  Therefore, he came to me for a consultation.  Svyatoslav had a hope that my eye was well-intentioned and I would notice something that would tell you why the analyzer issued all these strange messages.  Unfortunately, I just confirmed that the messages are really very strange and should not be.  However, what caused their occurrence, I could not notice.  It was decided to open the task in the bugtracker and start to figure out what is wrong. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And only when Svyatoslav began to make synthetic examples in order to describe the problem in detail in the bugtracker, an insight descended on him.  Let's now see if you can quickly find the reason why the analyzer generates 4 messages. <br><br>  Here is the text of the letter, published with the permission of the author.  And an explanatory picture that was attached to the letter. <br><br>  V560 warnings here are all false.  Running with most recent version of PVS-Studio for personal use.  Basically, the "IF" statement is correct.  It is true or false. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e83/c09/3d7/e83c093d7e29c109f3ecd693c7941a5d.png" alt="Letter"></div><br><br>  Now, dear reader, your time to check yourself!  See a mistake? <br><br>  Your time to be attentive.  And the unicorn will wait a little while. <br><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/fbc/493/aec/fbc493aec04fd30214afa75a79e6f388.png" alt="Unicorn-waiting"></div><br><br>  After the introductory part of the article, most likely many have found a mistake.  When configured to find the error, it is located.  It is much more difficult to notice a blunder after reading a letter, where it is called ‚Äúfalse positives‚Äù :). <br><br>  Now the explanation for those who are too lazy to look for a bug.  Consider the condition again: <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>)) || ((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF21</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF3A</span></span>)) || ((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF41</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF5A</span></span>)))</code> </pre> <br>  The author of the code planned to check that the symbol does not belong to any of the three ranges. <br><br>  The error is that the logical NOT (!) Operator applies only to the first subexpression. <br><br>  If the condition is met: <br><br><pre> <code class="cpp hljs">!((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>))</code> </pre> <br>  then the evaluation of the expression is interrupted according to the <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation">short-circuit evaluation</a> .  If the condition is not met, then the value of the variable <i>ch</i> lies in the range [0xFF10..0xFF19].  Accordingly, four further comparisons are meaningless.  They will all be false or true. <br><br>  Again.  See, if <i>ch</i> lies in the range <i>[0xFF10..0xFF19]</i> and the expression evaluation continues, then: <br><br><ul><li>  ch&gt; = 0x0FF21 - always false </li><li>  ch &lt;= 0x0FF3A - always true </li><li>  ch&gt; = 0x0FF41 - always false </li><li>  ch &lt;= 0x0FF5A - always true </li></ul><br>  The PVS-Studio analyzer warns about this. <br><br>  So, the static analyzer turned out to be more attentive than the user and two and a half programmers from our team. <br><br>  To fix the situation, add additional brackets: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>)) || ((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF21</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF3A</span></span>)) || ((ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF41</span></span>) &amp;&amp; (ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF5A</span></span>))))</code> </pre> <br>  Or rewrite the condition: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (((ch &lt; <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span>) || (ch &gt; <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>)) &amp;&amp; ((ch &lt; <span class="hljs-number"><span class="hljs-number">0x0FF21</span></span>) || (ch &gt; <span class="hljs-number"><span class="hljs-number">0x0FF3A</span></span>)) &amp;&amp; ((ch &lt; <span class="hljs-number"><span class="hljs-number">0x0FF41</span></span>) || (ch &gt; <span class="hljs-number"><span class="hljs-number">0x0FF5A</span></span>)))</code> </pre> <br>  However, I can not recommend the use of any of these options.  I would write to simplify the reading of the code: <br><br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> isLetterOrDigit = (ch &gt;= <span class="hljs-number"><span class="hljs-number">0x0FF10</span></span> &amp;&amp; ch &lt;= <span class="hljs-number"><span class="hljs-number">0x0FF19</span></span>) <span class="hljs-comment"><span class="hljs-comment">// 0..9 || (ch &gt;= 0x0FF21 &amp;&amp; ch &lt;= 0x0FF3A) // A..Z || (ch &gt;= 0x0FF41 &amp;&amp; ch &lt;= 0x0FF5A); // a..z if (!isLetterOrDigit)</span></span></code> </pre> <br>  Note that I removed some of the brackets.  As we have just seen, a large number of brackets did not at all help to avoid an error.  The brackets should make it easier to read the code, not complicate things.  Programmers remember well that the priority of comparisons = &lt;, =&gt; is higher than that of the &amp;&amp; operator.  Therefore, brackets are not needed here.  But if you ask what is more priority - &amp;&amp; or ||, many will be confused.  Therefore, to specify a sequence of calculations &amp;&amp;, ||  it is better to put brackets. <br><br>  Why is it better to write ||  At the beginning I described in the article " <a href="https://www.viva64.com/ru/b/0391/">The main issue of programming, refactoring, and all that</a> " (see chapter: Align the same type code with a "table"). <br><br>  Thank you all for your attention.  Download and start using <a href="https://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> .  It will help identify many errors and potential vulnerabilities at the earliest stages. <br><p> <a href="https://www.viva64.com/en/b/0587/"><img src="https://habrastorage.org/webt/ts/z9/km/tsz9kmyjtteajhd4x1au60rsrvq.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Andrey Karpov.  <a href="https://www.viva64.com/en/b/0587/">How PVS-Studio Prods to Be More Attentive Than Three and a Half Programmers</a> . </div><p>Source: <a href="https://habr.com/ru/post/427309/">https://habr.com/ru/post/427309/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../427299/index.html">And let's collect something else? The designer 3 in 1 "Lunar fleet"</a></li>
<li><a href="../427301/index.html">DB crash on GitHub</a></li>
<li><a href="../427303/index.html">Slow Windows, Part 2: Creating Processes</a></li>
<li><a href="../427305/index.html">Arkady Volozh refused to sell his stake in Yandex</a></li>
<li><a href="../427307/index.html">The practice of testing backend for Java + Rest-Assured</a></li>
<li><a href="../427311/index.html">How to become datsayntistom if you are over 40 and you are not a programmer</a></li>
<li><a href="../427313/index.html">How SoftBank invests $ 50 billion a year in start-ups, and why it baffles investors</a></li>
<li><a href="../427315/index.html">Hut reading room or a selection of professional literature</a></li>
<li><a href="../427317/index.html">To be successful in IT or what kills IT's?</a></li>
<li><a href="../427319/index.html">Gentlemen‚Äôs UE4 Programmer Kit, Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>