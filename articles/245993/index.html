<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Media storage system with 10G access</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article is a development of the idea of ‚Äã‚Äãcreating a 10G network for image processing . 

 The customer is a small photo studio that actively rem...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Media storage system with 10G access</h1><div class="post__text post__text-html js-mediator-article"> This article is a development of the idea of ‚Äã‚Äãcreating a <a href="http://habrahabr.ru/post/222319/">10G network for image processing</a> . <br><br>  The customer is a small photo studio that actively removes all sorts of events - weddings, meetings, corporate events, etc. <br>  After a day of shooting by one or two photographers, you need to quickly sort up to several thousand photographs, make a preliminary selection of the best ones, process them quickly, and present the first version of the sample of photographs to the customer. <br>  Sometimes video recording of the event is added to this. <br>  Later, more subtle processing of photo and video materials, layout of photo albums and photo books, and preparation of short films are often required. <br>  On the computer system side, high capacity is needed (the studio produces about 10 terabytes of photo-video materials per year) and high speed access to the existing photo and video library from 3-4 computers.  These are mainly computers manufactured by Apple. <br>  A year later, about 90-95% of photo-video content is erased, the remaining 5-10% are stored for several years. <br><br>  Taking into account the wishes of the total amount of stored data, it was proposed to use NAS NAS with a capacity of at least 6 disks.  As a result, 8 disk storage was chosen, but at the initial stage 6 disks of 3TB each were installed into it. <br>  The need for fast access to network resources from Apple computers was implemented in two ways: <br>  wired access via Thunderbolt converter - 10G Ethernet. <br>  Wireless access for laptops has been implemented on the WiFi AC standard. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Network storage was chosen model QNAP TS-870Pro.  I have been working with the equipment of this company for quite a few years, and so far I have only positive experience. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/c5a/003/a7f/c5a003a7f71e354ac680af503b75f07e.jpg" alt="TS-870Pro"><br><br><a name="habracut"></a><br>  Models with the Pro index allow you to install an additional network card, including 10 gigabit ports.  Such models have been produced not for the first year, but for the first time in my project.  Previous solutions, in which there were 10-gigabit backbones, were built on the basis of Windows servers, so it was interesting how the NAS behaves when working in such a high-speed network. <br>  Some limitation was the rather short list of compatible 10G network cards.  Fortunately, the distributor found one of the suitable models - Emulex OCe11102-NX. <br>  The card was installed in the NAS and ‚Äústarted up‚Äù without any problems. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7f0/f33/b45/7f0f33b459b03e6b166fe95db5ccab3d.jpg" alt="Emulex 10G"><br><br>  It was connected via a switch with 10G SFP + ports with a direct connection cable. <br>  One of the computers managed to be connected via a copper SFP + cable, the other one via a multi-mode optics via SFP + transceivers.  Transceivers were used by Chinese, from 10Gtek. <br>  But the tests used only copper cables. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/9dd/05a/483/9dd05a483e66bc8fc74c862f6bf7b7ee.jpg" alt="TS-870Pro back"><br><br>  The latest 4.1.1 firmware version available at the time of testing was installed on the drive. <br>  The configuration based on RAID5 was tested - the one that will work for the customer. <br>  To begin with, several synthetic tests were run. <br>  One of the most famous is Intel NASPT. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d71/0dd/b68/d710ddb68d2ae2eaa01e8de62a73de4c.jpg" alt="NASPT Sum"><br><br>  The value for HD Video Record looks a bit suspicious. It looks like this is a result of caching. <br>  But the result for simultaneous reading and writing is interesting for our case.  And it turned out quite decent. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a93/997/745/a939977458f4b76fc86281992864bdfe.jpg" alt="HD Video 1Play 1Record"><br><br>  The test from Atto showed the following: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/af3/63a/a9e/af363aa9e7f57771bef3020cd17a74e3.jpg" alt="Atto"><br><br>  But all this is synthetic tests. <br>  It was interesting to understand how fast the read / write turned out on real tasks. <br>  This is how the NAS Dashboard looks like.  First there was a read operation from the storage, then read and write (from different computers), then read again: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e13/b0f/d4b/e13b0fd4be810d758caf98cca61ecb15.jpg" alt="Dashboard"><br><br>  As you can imagine, we used all the performance of our disk subsystem.  Only for reading we get a little less than 500 megabytes per second.  Add the write process - and the reading speed drops proportionally. <br>  If we look at I / O operations, we get about 5000-6000 IOPS, latency in the region of 130 ms. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fb1/eee/6ed/fb1eee6ede5be0b742eeaf46227258e4.jpg" alt="Iops"><br><br>  The processor load of the storage does not exceed 50%.  Interestingly, the load is distributed over the 4 cores of the CPU fairly evenly. <br><br>  On reading large files (imitation of working with ‚Äúpuff‚Äù Photoshop files and video files), the speed was about 400-450 megabytes per second. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/8e9/91e/f56/8e991ef56a3403a72964c55bc407c0fb.jpg" alt="Read from NAS"><br><br>  How difficult it is for a SOHO class device is hard for me to say.  It would be interesting to know what results were obtained on other models of network drives of this class. <br><br>  Feels like working in programs that work with a lot of graphic files, such as Lightroom, Premiere Pro, work when ‚Äúscrolling‚Äù the image catalog, caching video files and other operations, in which the reading speed is decisive, as compared to a gigabit connection, the speed increased several times. <br>  Work in tasks for which information processing speed is also important, although it has increased, but not so significantly.  These were the tasks of generating JPG files and slide shows of video clips from RAW files, 30‚Äì50 megabytes each.  In this case, the difference in processor power of the computers used became noticeable.  We can download data quickly, and processing it in our case ‚Äúrests on‚Äù processor performance. <br><br>  For backup, use external drives connected via USB3, and copy to the ‚Äúcloud‚Äù CrashPlan. <br><br>  Who would benefit from such a decision? <br>  In my opinion, these are small studios working with a stream of photo and video materials.  If there are more than one people who process these materials, and they can work from different computers, it makes sense to organize all the media files, often scattered across multiple external disks, on one device.  And the access speed rises (on ordinary external disks I did not see the read-write speed of more than 100-120 megabytes per second), and protection against single-disk failures and automatic backup can be configured. <br>  In addition, this NAS provides many additional features.  For some, its ability to work as a video surveillance server will be important, someone will use it for downloading torrentov, someone will find the possibility of the <a href="http://electronhouse.ru/installer/multiroom/98-qnap_mediaplayer.html">built-in XBMC player</a> useful. <br><br>  But what this system itself is definitely not is a backup system.  Provided that you have one.  RAID5, although it protects against a single disk failure, will not survive the failure of the second disk while the first one is synchronized after replacing the failed one.  No one bothers to organize RAID10 or RAID6, but the loss of usable disk space will be significant, and in the event of flooding or fire it will not help.  In this case, either synchronization with the second same device located in a geographically remote location, or backups to external drives, or backups ‚Äúto the cloud‚Äù, which was implemented in this project. <br><br>  I would be interested to know how the ‚Äúcolleagues in the shop‚Äù solved such a storage task - access to photo-video sources with a non-corporate budget. </div><p>Source: <a href="https://habr.com/ru/post/245993/">https://habr.com/ru/post/245993/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../245979/index.html">Profile the code with Cach√© Monitor</a></li>
<li><a href="../245981/index.html">Entry to the annual program of the Stratoplan School of Managers is open.</a></li>
<li><a href="../245985/index.html">Simple leaderboard on Unity3D with facebook</a></li>
<li><a href="../245987/index.html">We optimize the page with our own social buttons</a></li>
<li><a href="../245991/index.html">webpack: 7 troubles - one answer</a></li>
<li><a href="../245995/index.html">Brave support service against monstrous tickets</a></li>
<li><a href="../245997/index.html">A selection of interesting CSS recipes "Naked Fridays # 4"</a></li>
<li><a href="../246001/index.html">IBM has opened access to Watson Analytics for all</a></li>
<li><a href="../246003/index.html">Not only Yandex. Micromarking on the largest sites of Runet: why it is used and why it is useful to you</a></li>
<li><a href="../246005/index.html">BLE stack from TI. Custom Application Development</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>