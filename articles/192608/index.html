<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>An example of blog development on Zend Framework 2. Part 2. MyBlog module</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This is the second of three parts of an article devoted to the development of a simple application using Zend Framework 2. In the first part I reviewe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>An example of blog development on Zend Framework 2. Part 2. MyBlog module</h1><div class="post__text post__text-html js-mediator-article">  This is the second of three parts of an article devoted to the development of a simple application using Zend Framework 2. <a href="http://habrahabr.ru/post/192522/">In the first part</a> I reviewed the structure of ZendSkeletonApplication, and in this part I will give an example of developing a simple module.  <a href="http://habrahabr.ru/post/192726/">The third part</a> will focus on working with users and the Twig template engine. <br><br><h2>  Installation and configuration of additional modules </h2><br>  First of all I want to note that the installation of a third-party module in the Zend Framework usually consists of about these four steps: <br><ol><li>  add the appropriate line to <em>composer.json</em> to inform Composer about the new module, </li><li>  execute the <em>php composer.phar update</em> command so that Composer loads the new module and, if necessary, regenerates the autoload files, </li><li>  add a new module to the modules list in the <em>config / application.config.php</em> file, </li><li>  if necessary, place the module configuration file (usually an example of such a file is located in the module config folder) in config / autoload and make the necessary edits. </li></ol><br>  Also, I want to emphasize that for all the modules listed below I set the minimum necessary settings for their work, for more information about the settings and the capabilities of each of the modules, see their documentation pages. <br><br>  Let's start by installing the simple but useful Zend Developer Tools module. <br><a name="habracut"></a><br><h3>  Zend Developer Tools </h3><br>  Zend Developer Tools is a handy toolbar containing useful information for the developer about the created page: the number and list of database requests, the list of current user roles used by the Entity, the loaded site configuration, etc.  Of course, the toolbar can be extended with any other supporting information.  You can find it here: <a href="https://github.com/zendframework/ZendDeveloperTools">github.com/zendframework/ZendDeveloperTools</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      To install the toolbar, first add the line: <br><pre><code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"zendframework/zend-developer-tools"</span></span>: <span class="hljs-string"><span class="hljs-string">"dev-master"</span></span>,</code> </pre> <br>  in the <em>composer.json</em> file in the project root and then run the <em>php composer.phar update</em> command in the project root. <br><br>  Then in the modules <em>/ application.config.php</em> file you need to add the ZendDeveloperTools element to the modules array: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'modules'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Application'</span></span>, <span class="hljs-string"><span class="hljs-string">'ZendDeveloperTools'</span></span>, ),</code> </pre><br>  Now it remains to copy the file <em>vendor / zendframework / zend-developer-tools / config / zenddevelopertools.local.php.dist</em> into our project‚Äôs <em>config / autoload</em> folder and rename it, for example, to <em>zenddevelopertools.local.php</em> (part of the name to local.php by to a large account does not matter). <br><br>  Everything, now, by default, at the bottom of all pages displays information about resources spent on page generation, project configuration, etc. <br><br>  I want to draw attention to the fact that by default the toolbar will be available to all site visitors, so you should not use it in the production environment. <br><br>  The current version of the application is available on the github in the project repository with the <em>zenddevelopertools</em> tag: <a href="https://github.com/romka/zend-blog-example/tree/zenddevelopertools">github.com/romka/zend-blog-example/tree/zenddevelopertools</a> <br><br><h3>  Doctrine orm </h3><br>  DoctrineModule and DoctrineORMModule modules ( <a href="https://github.com/doctrine/DoctrineModule">https://github.com/doctrine/DoctrineModule</a> and <a href="https://github.com/doctrine/DoctrineORMModule">github.com/doctrine/DoctrineORMModule</a> ) will be needed to integrate with the Doctrine. <br><br>  Add the following lines to the require section of the composer.json file: <br><pre> <code class="hljs objectivec"><span class="hljs-string"><span class="hljs-string">"doctrine/common"</span></span>: <span class="hljs-string"><span class="hljs-string">"&gt;=2.1"</span></span>, <span class="hljs-string"><span class="hljs-string">"doctrine/doctrine-orm-module"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.7.*"</span></span></code> </pre><br>  and run the <em>php</em> command <em>composer.phar update</em> in the console. <br><br>  The DoctrineModule module can be omitted explicitly in our <em>composer.json</em> , since this dependency is registered at the level of the DoctrineORMModule module. <br><br>  Now, in the <em>config / autoload directory,</em> place the <em>doctrine.local.php</em> file with the database access parameters to be used by the Doctrine, its contents should be approximately like this: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'doctrine'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'connection'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'orm_default'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'driverClass'</span></span></span><span class="php"> =&gt;</span><span class="hljs-string"><span class="php"><span class="hljs-string">'Doctrine\DBAL\Driver\PDOMySql\Driver'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'params'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'host'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'localhost'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'port'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'3306'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'user'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'username'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'password'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'pass'</span></span></span><span class="php">, </span><span class="hljs-string"><span class="php"><span class="hljs-string">'dbname'</span></span></span><span class="php"> =&gt; </span><span class="hljs-string"><span class="php"><span class="hljs-string">'dbname'</span></span></span><span class="php">, ) ) ), ), );</span></span></code> </pre><br>  Now if we reload the page of our site, then at the bottom of the page in the Zend devloper toolbar we will see two new blocks showing the number of completed queries and the list of mappings to the database.  Both values ‚Äã‚Äãare zero, since we have not done the mapping yet and, as a result, there are no queries to the database. <br><br>  In this tutorial, I want to develop a simple blog and now it‚Äôs time to write the first lines of the new module code. <br><br><h2>  MyBlog module </h2><br>  In the <em>modules</em> directory, create the following directories and files: <br><pre> <code class="hljs lua">MyBlog/ <span class="hljs-built_in"><span class="hljs-built_in">config</span></span>/ module.<span class="hljs-built_in"><span class="hljs-built_in">config</span></span>.php src/ MyBlog/ Entity/ BlogPost.php Module.php</code> </pre><br>  The contents of the <em>Module.php</em> file should be like this: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">namespace</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">MyBlog</span></span></span><span class="php">; </span><span class="hljs-class"><span class="hljs-keyword"><span class="php"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span><span class="php"><span class="hljs-class"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-class"><span class="hljs-title">Module</span></span></span></span><span class="php"><span class="hljs-class"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">getAutoloaderConfig</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'Zend\Loader\StandardAutoloader'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-string"><span class="php"><span class="hljs-string">'namespaces'</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">array</span></span></span><span class="php">( </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">__NAMESPACE__</span></span></span><span class="php"> =&gt; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">__DIR__</span></span></span><span class="php"> . </span><span class="hljs-string"><span class="php"><span class="hljs-string">'/src/'</span></span></span><span class="php"> . </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">__NAMESPACE__</span></span></span><span class="php">, ), ), ); } </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">getConfig</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">include</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">__DIR__</span></span></span><span class="php"> . </span><span class="hljs-string"><span class="php"><span class="hljs-string">'/config/module.config.php'</span></span></span><span class="php">; } }</span></span></code> </pre><br>  The file is similar to the one used in the Application module, we tell the framework framework where to look for the module configuration file and source files. <br><br>  The configuration file should now return an empty array, we will set the settings for the new module a little later. <br><br>  The <em>src / MyBlog / Entity / BlogPost.php file</em> is a connection (mapping) between the Doctrine and the database and you need to talk about it in more detail. <br><br><h3>  BlogPost.php </h3><br>  Each blog post in my example will contain the following fields: <br><ul><li>  headline </li><li>  blogpost body, </li><li>  author's id (0 for anonymous), </li><li>  status (published / unpublished) </li><li>  publication date. </li></ul><br>  For simplicity, I will not bother with tags, comments and other blog features inherent in this tutorial. <br><br>  This file declares the BlogPost class, which contains descriptions of the blogpost fields and methods for accessing them.  You can look at the full version of the file on Github ( <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Entity/BlogPost.php">https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Entity/BlogPost.php</a> ), this is how it looks like: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">namespace</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">MyBlog</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">Entity</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">use</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">Doctrine</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">Common</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">Collections</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">ArrayCollection</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">use</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">Doctrine</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">ORM</span></span></span><span class="php">\</span><span class="hljs-title"><span class="php"><span class="hljs-title">Mapping</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">as</span></span></span><span class="php"> </span><span class="hljs-title"><span class="php"><span class="hljs-title">ORM</span></span></span><span class="php">; </span><span class="hljs-class"><span class="hljs-keyword"><span class="php"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span></span><span class="php"><span class="hljs-class"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-class"><span class="hljs-title">BlogPost</span></span></span></span><span class="php"><span class="hljs-class"> </span></span></span><span class="php">{ </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span></span><span class="php"><span class="hljs-comment"> int * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span></span><span class="php"><span class="hljs-comment">\Id * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span></span><span class="php"><span class="hljs-comment">\Column(type="integer") * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span></span><span class="php"><span class="hljs-comment">\GeneratedValue(strategy="AUTO") */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">protected</span></span></span><span class="php"> $id; </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@var</span></span></span></span><span class="php"><span class="hljs-comment"> string * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@ORM</span></span></span></span><span class="php"><span class="hljs-comment">\Column(type="string", length=255, nullable=false) */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">protected</span></span></span><span class="php"> $title; </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * Get id. * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span></span><span class="php"><span class="hljs-comment"> int */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">getId</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;id; } </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * Set id. * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="php"><span class="hljs-comment"> int $id * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span></span><span class="php"><span class="hljs-comment"> void */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">setId</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">($id)</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;id = (int) $id; } </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * Get title. * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span></span><span class="php"><span class="hljs-comment"> string */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">getTitle</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">return</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;title; } </span><span class="hljs-comment"><span class="php"><span class="hljs-comment">/** * Set title. * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span></span><span class="php"><span class="hljs-comment"> string $title * * </span></span><span class="hljs-doctag"><span class="php"><span class="hljs-comment"><span class="hljs-doctag">@return</span></span></span></span><span class="php"><span class="hljs-comment"> void */</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">public</span></span></span><span class="php"> </span><span class="hljs-function"><span class="hljs-keyword"><span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="php"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="php"><span class="hljs-function"><span class="hljs-title">setTitle</span></span></span></span><span class="hljs-params"><span class="php"><span class="hljs-function"><span class="hljs-params">($title)</span></span></span></span><span class="php"><span class="hljs-function"> </span></span></span><span class="php">{ </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;title = $title; } }</span></span></code> </pre><br>  Each variable in this class will become a field in the database, field parameters are specified in the annotations that will be read by the Doctrine (something like this: <a href="http://php.net/manual/en/reflectionclass.getdoccomment.php">php.net/manual/en/reflectionclass.getdoccomment.php</a> , <em>Doctrine \ Common \ Annotations \ AnnotationReader</em> class method getClassAnnotations ( )). <br><br>  Now you can add information about our new Entity, which will be used by the Doctrine, to the <em>config / module.config.php</em> module configuration file: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'doctrine'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'driver'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'myblog_entity'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span> =&gt;<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\Mapping\Driver\AnnotationDriver'</span></span>, <span class="hljs-string"><span class="hljs-string">'paths'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../src/MyBlog/Entity'</span></span>) ), <span class="hljs-string"><span class="hljs-string">'orm_default'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'drivers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'MyBlog\Entity'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'myblog_entity'</span></span>, ) ) ) ), );</code> </pre><br>  And it remains to add the MyBlog module to the list of active modules in <em>application.config.php</em> . <br><br>  We have finished setting up the BlogPost entity and now we need to create the corresponding table in the database, for this we will use the console utility supplied with the Doctrine.  At the root of the project, execute the command: <br><pre> <code class="hljs ruby">./vendor/bin/doctrine-<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">orm</span></span></span><span class="hljs-class">:</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">info</span></span></span></span></code> </pre><br>  And the result should be a message like: <br><pre> <code class="hljs tex">Found 1 mapped entities: [OK] MyBlog<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Entity</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BlogPost</span></span></span></span></code> </pre><br>  Once we have verified that the Doctrine sees our BlogPost object, we will execute the command: <br><pre> <code class="hljs pgsql">./vendor/bin/doctrine-module orm:<span class="hljs-keyword"><span class="hljs-keyword">validate</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span></code> </pre><br>  As a result, the following error should return: <br><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">Mapping</span></span>] OK - The <span class="hljs-keyword"><span class="hljs-keyword">mapping</span></span> files are correct. [<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>] FAIL - The <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sync <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">current</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mapping</span></span> file.</code> </pre><br>  This is logical, since our database is still empty and now we will create the desired table with the command: <br><pre> <code class="hljs pgsql">./vendor/bin/doctrine-module orm:<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span>-tool:<span class="hljs-keyword"><span class="hljs-keyword">update</span></span> <span class="hljs-comment"><span class="hljs-comment">--force</span></span></code> </pre><br>  Its result will be the following output: <br><pre> <code class="hljs erlang-repl">Updating database schema... Database schema updated successfully! <span class="hljs-string"><span class="hljs-string">"1"</span></span> queries were executed</code> </pre><br>  And now the command call: <br><pre> <code class="hljs pgsql">./vendor/bin/doctrine-module orm:<span class="hljs-keyword"><span class="hljs-keyword">validate</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">schema</span></span></code> </pre><br>  will return the result: <br><pre> <code class="hljs pgsql">[<span class="hljs-keyword"><span class="hljs-keyword">Mapping</span></span>] OK - The <span class="hljs-keyword"><span class="hljs-keyword">mapping</span></span> files are correct. [<span class="hljs-keyword"><span class="hljs-keyword">Database</span></span>] OK - The <span class="hljs-keyword"><span class="hljs-keyword">database</span></span> <span class="hljs-keyword"><span class="hljs-keyword">schema</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> sync <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">mapping</span></span> files.</code> </pre><br>  If we now update the page of our site, then in the toolbar at the bottom of the page we will see that the Doctrine is seen by one mapping Myblog \ Entity \ BlogPost. <br><br>  Source codes of the current version of the project can be found in the project repository on Github with the <em>blogpost_entity</em> tag: <a href="https://github.com/romka/zend-blog-example/tree/blogpost_entity">github.com/romka/zend-blog-example/tree/blogpost_entity</a> . <br><br>  Now that we have an entity for working with blogposts, we can proceed to writing our first controller that implements the form for adding a blogpost. <br><br><h3>  Adding a blog post </h3><br>  In the src / MyBlog directory of the module, create two new file directories: <br><pre> <code class="hljs">Controller/ BlogController.php Form/ BlogPostForm.php BlogPostInputFilter.php</code> </pre><br>  Next, in the module configuration file you need to add elements that declare the list of module controllers, routes and the path to the directory with templates: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'controllers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'invokables'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'MyBlog\Controller\BlogPost'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog\Controller\BlogController'</span></span>, ), ), <span class="hljs-string"><span class="hljs-string">'router'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'routes'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'blog'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'segment'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'route'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'/blog[/][:action][/:id]'</span></span>, <span class="hljs-string"><span class="hljs-string">'constraints'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'[a-zA-Z][a-zA-Z0-9_-]*'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'[0-9]+'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'defaults'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'controller'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog\Controller\BlogPost'</span></span>, <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'index'</span></span>, ), ), ), ), ), <span class="hljs-string"><span class="hljs-string">'view_manager'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'template_path_stack'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">__DIR__</span></span> . <span class="hljs-string"><span class="hljs-string">'/../view'</span></span>, ), ),</code> </pre><br><br>  Based on the settings specified above, all pages of our blog will have URLs like <em>blog / [action] / [id]</em> (path elements in square brackets are optional). <br><br>  The <em>BlogPostForm.php</em> file will contain the form that will be used to add / edit the blogpost, let's create this form. <br><br><h3>  BlogPostForm.php </h3><br>  In the simplest case, the form code will look like this (this is not the complete source code of the form, you can see it in its entirety here: <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Form/BlogPostForm.php">github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Form/ BlogPostForm.php</a> ): <br><pre> <code class="hljs php"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlogPostForm</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Form</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct(<span class="hljs-string"><span class="hljs-string">'blogpost'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setAttribute(<span class="hljs-string"><span class="hljs-string">'method'</span></span>, <span class="hljs-string"><span class="hljs-string">'post'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Hidden'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Title'</span></span>, ), <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'min'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">25</span></span> ), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Textarea'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'label'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Text'</span></span>, ), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'state'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Checkbox'</span></span>, )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'submit'</span></span>, <span class="hljs-string"><span class="hljs-string">'type'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Submit'</span></span>, <span class="hljs-string"><span class="hljs-string">'attributes'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'value'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'Save'</span></span>, <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'submitbutton'</span></span>, ), )); } }</code> </pre><br>  Obviously, this code declares the form fields we need, but so far neither filters (allowing the incoming data to be converted) or validators (which will not allow entering the data in the wrong format) into the form are set for them.  We will set them later, but now let's write the controller code that will display the blogpost addition form and save the entered data. <br><br><h3>  BlogController.php </h3><br>  You can view the full controller code in the repository ( <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Controller/BlogController.php">https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Controller/BlogController.php</a> ), below is its key part: <br><pre> <code class="hljs php"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlogController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AbstractActionController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewModel(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \MyBlog\Form\BlogPostForm(); $form-&gt;get(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>)-&gt;setValue(<span class="hljs-string"><span class="hljs-string">'Add'</span></span>); $request = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getRequest(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($request-&gt;isPost()) { $form-&gt;setData($request-&gt;getPost()); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($form-&gt;isValid()) { $objectManager = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getServiceLocator()-&gt;get(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\EntityManager'</span></span>); $blogpost = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \MyBlog\Entity\BlogPost(); $blogpost-&gt;exchangeArray($form-&gt;getData()); $blogpost-&gt;setCreated(time()); $blogpost-&gt;setUserId(<span class="hljs-number"><span class="hljs-number">0</span></span>); $objectManager-&gt;persist($blogpost); $objectManager-&gt;flush(); <span class="hljs-comment"><span class="hljs-comment">// Redirect to list of blogposts return $this-&gt;redirect()-&gt;toRoute('blog'); } } return array('form' =&gt; $form); } }</span></span></code> </pre><br>  The addAction action code is significant for us (the names of all actions must be created using the nameAction () mask).  In it, we first create a form object and replace the text of the submit button on it (we have the same form used to create and edit blog posts, so the text on this button is convenient to have different): <br><pre> <code class="hljs php">$form = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \MyBlog\Form\BlogPostForm(); $form-&gt;get(<span class="hljs-string"><span class="hljs-string">'submit'</span></span>)-&gt;setValue(<span class="hljs-string"><span class="hljs-string">'Add'</span></span>);</code> </pre><br>  Then, if the form is validated (and validation now it will pass anyway, since we still do not have validators), we create an instance of the \ MyBlog \ Entity \ BlogPost () class, which is the connection between our application and the database, fill in the created object data and save them in the database: <br><pre> <code class="hljs php">$blogpost-&gt;exchangeArray($form-&gt;getData()); $blogpost-&gt;setCreated(time()); $blogpost-&gt;setUserId(<span class="hljs-number"><span class="hljs-number">0</span></span>); $objectManager-&gt;persist($blogpost); $objectManager-&gt;flush();</code> </pre><br>  You can see the current version of the template responsible for displaying the form at <a href="https://github.com/romka/zend-blog-example/blob/blogpost_form_1/module/MyBlog/view/my-blog/blog/add.phtml">github.com/romka/zend-blog-example/blob/blogpost_form_1/module/MyBlog/view/my-blog/blog/add.phtml</a> . <br><br>  If now try to save an empty form, the Doctrine will return an error message of the form: <br><pre> <code class="hljs pgsql">An <span class="hljs-keyword"><span class="hljs-keyword">exception</span></span> occurred <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> executing <span class="hljs-string"><span class="hljs-string">'INSERT INTO blogposts (title, text, userId, created, state) VALUES (?, ?, ?, ?, ?)'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> params [<span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">1377086855</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>]: <span class="hljs-built_in"><span class="hljs-built_in">SQLSTATE</span></span>[<span class="hljs-number"><span class="hljs-number">23000</span></span>]: Integrity <span class="hljs-keyword"><span class="hljs-keyword">constraint</span></span> violation: <span class="hljs-number"><span class="hljs-number">1048</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Column</span></span> <span class="hljs-string"><span class="hljs-string">'title'</span></span> cannot be <span class="hljs-keyword"><span class="hljs-keyword">null</span></span></code> </pre><br>  This is correct, because we have only one field, marked as nullable = ‚Äútrue‚Äù - this is the state field, and all the others must be filled.  Let's add filters and validators to the form to intercept such errors before attempting to save data (at the level of our application, and not the database), so that the user has the opportunity to correct the error. <br><br><h3>  Validation of forms </h3><br>  In the previously created <em>BlogPostInputFilter.php</em> file <em>we</em> place the following code (full version on GitHub: <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Form/BlogPostInputFilter.php">github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/Form/BlogPostInputFilter.php</a> ): <br><pre> <code class="hljs php"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BlogPostInputFilter</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">InputFilter</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'title'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'validators'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StringLength'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'min'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-string"><span class="hljs-string">'max'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, ), ), ), <span class="hljs-string"><span class="hljs-string">'filters'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StripTags'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StringTrim'</span></span>), ), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'text'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'validators'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StringLength'</span></span>, <span class="hljs-string"><span class="hljs-string">'options'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'min'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">50</span></span>, ), ), ), <span class="hljs-string"><span class="hljs-string">'filters'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StripTags'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'StringTrim'</span></span>), ), )); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;add(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'state'</span></span>, <span class="hljs-string"><span class="hljs-string">'required'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>, )); } }</code> </pre><br>  I suppose that the meaning of these lines should be intuitive: for the title and text fields we add filters that remove all html tags from the text (StripTags) and trim the spaces around the edges of the strings (StringTrim), and also add validators that define the minimum values and maximum field lengths (StringLength). <br><br>  It remains to add a new filter to the form, adding a line to the form class: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;setInputFilter(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> \MyBlog\Form\BlogPostInputFilter());</code> </pre><br>  Now the form will not pass validation if incorrect data is entered into it. <br><br><h3>  View plugins </h3><br>  After the blogpost is successfully saved (or not saved), we redirect the user to the page / blog, where in the future we will have a full list of blogposts.  I would like not only to make a redirect, but also to display a message about a successful action. <br><br>  You can add such messages using the methods: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addMessage($message); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addErrorMessage($message);</code> </pre><br>  You can extract messages added this way in the controller or in phtml templates in the following way: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;getMessages(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;getErrorMessages();</code> </pre><br>  The problem is that it is inconvenient (and in the Twig-templates, which we will use later, it is completely impossible) to call the PHP-code to display messages.  Therefore, we will write a small View-plugin that can display all messages in one line. <br><br>  To do this, in the src \ MyBlog directory of the module, create the following directories and files: <br><pre> <code class="hljs tex">View<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>Helper<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name"> </span></span></span></span>ShowMessages.php</code> </pre><br>  The contents of <em>ShowMessages.php</em> can be viewed here: <a href="https://github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/View/Helper/ShowMessages.php">github.com/romka/zend-blog-example/blob/master/module/MyBlog/src/MyBlog/View/Helper/ShowMessages.php</a> , it‚Äôs not very interesting, I‚Äôm just getting a list here messages, formatting and returning ready html-code to display them. <br><br>  It remains to do three things: <br><ol><li>  register a view plugin, </li><li>  add its use to the template, </li><li>  and display messages about successful / unsuccessful saving of the form. </li></ol><br>  In order to register the plugin, add the line to the settings of the module in the viewkit =&gt; invokables: <br><pre> <code class="hljs php"><span class="hljs-string"><span class="hljs-string">'view_helpers'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'invokables'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'showMessages'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'MyBlog\View\Helper\ShowMessages'</span></span>, ), ),</code> </pre><br>  Add templates to the templates: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">print</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;showMessages();</code> </pre><br>  To display messages on the screen, add the following lines to the controller: <br><pre> <code class="hljs php">$message = <span class="hljs-string"><span class="hljs-string">'Blogpost succesfully saved!'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addMessage($message);</code> </pre><br>  Now we have the ability to display user system messages. <br><br>  You can find this version of the application in the git repository with the <em>blogpost_form_1</em> tag: <a href="https://github.com/romka/zend-blog-example/tree/blogpost_form_1">github.com/romka/zend-blog-example/tree/blogpost_form_1</a> . <br><br>  At the current stage, we have: <br><ol><li>  an entity for communication between an application and a database, created with the help of the Doctrine, </li><li>  controller service page add blogpost, </li><li>  Add a blog post with filters and validations </li><li>  custom view plugin for displaying messages on the screen. </li></ol><br>  Now let's add the pages of one blog post, a list of blog posts and a post edit / delete form. <br><br><h3>  Blogpost page </h3><br>  Add a new action view to the BlogpostController controller: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">viewAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $id = (int) <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;params()-&gt;fromRoute(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$id) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addErrorMessage(<span class="hljs-string"><span class="hljs-string">'Blogpost id doesn\'t set'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect()-&gt;toRoute(<span class="hljs-string"><span class="hljs-string">'blog'</span></span>); } $objectManager = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getServiceLocator()-&gt;get(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\EntityManager'</span></span>); $post = $objectManager -&gt;getRepository(<span class="hljs-string"><span class="hljs-string">'\MyBlog\Entity\BlogPost'</span></span>) -&gt;findOneBy(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $id)); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!$post) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addErrorMessage(sprintf(<span class="hljs-string"><span class="hljs-string">'Blogpost with id %s doesn\'t exists'</span></span>, $id)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect()-&gt;toRoute(<span class="hljs-string"><span class="hljs-string">'blog'</span></span>); } $view = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewModel(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'post'</span></span> =&gt; $post-&gt;getArrayCopy(), )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; }</code> </pre><br>  This action is available at blog / view / ID.  In it, we first check that the blogpost id is set in the URL, if this is not the case, we return an error and redirect the user to the page with the list of blogposts.  If id is specified, then we retrieve the post from the database and transfer it to the template. <br><br>  The name of the controller is used as the default template name, so now in the directory of the view / my-blog / blog module you need to create a view.phtml file with something like this: <br><pre> <code class="hljs xml"><span class="php"><span class="hljs-meta"><span class="php"><span class="hljs-meta">&lt;?php</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">print</span></span></span><span class="php"> </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">$this</span></span></span><span class="php">-&gt;showMessages(); </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">print</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;h1&gt;'</span></span></span><span class="php"> . $post[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'title'</span></span></span><span class="php">] . </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;/h1&gt;'</span></span></span><span class="php">; </span><span class="hljs-keyword"><span class="php"><span class="hljs-keyword">print</span></span></span><span class="php"> </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;div&gt;'</span></span></span><span class="php"> . $post[</span><span class="hljs-string"><span class="php"><span class="hljs-string">'text'</span></span></span><span class="php">] . </span><span class="hljs-string"><span class="php"><span class="hljs-string">'&lt;/div&gt;'</span></span></span><span class="php">;</span></span></code> </pre><br><br><h3>  Blogpost list </h3><br>  Update our indexAction code to this: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">indexAction</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ $objectManager = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getServiceLocator()-&gt;get(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\EntityManager'</span></span>); $posts = $objectManager -&gt;getRepository(<span class="hljs-string"><span class="hljs-string">'\MyBlog\Entity\BlogPost'</span></span>) -&gt;findBy(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'state'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">1</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'created'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'DESC'</span></span>)); $view = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ViewModel(<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'posts'</span></span> =&gt; $posts, )); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $view; }</code> </pre><br>  Here we select all published blogposts (state == 1), sort them by publication date and transfer them to the <em>index.phtml</em> template <a href="https://github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/view/my-blog/blog/index.phtml">github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/view/my-blog /blog/index.phtml</a> .  The template displays blogpost headers and links to edit and delete them. <br><br><h3>  Small retreat </h3><br>  Above, when creating a form, I forgot to add the userId field, which stores the ID of the blogpost's author.  Since there is no registration / authorization in our blog now, this field is filled with zero by default, but in the future it will come in handy, so now I have added the userId field to the hidden form. <br><br>  In addition, I added a Csrf token to the form (security field), which should protect the form from falsification.  By default, this token is formed based on the user session and salt and lasts 300 seconds ( <em>Zend \ Form \ Element \ Csrf.php</em> ), but it can be (and should be good) redefined and at least the visitor ip dependency should be added to it . <br><br><h3>  Editing a blog post </h3><br>  To edit the post, we will use the already existing form.  In the controller, you need to create an editAction () action that will create the form, fill it with existing data and give it to the user.  This action is a mixture of addAction (), in terms of working with the form, and viewAction (), in terms of data sampling <a href="https://github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/src/MyBlog/Controller/BlogController.php">github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/src/MyBlog/Controller/BlogController .php # L95</a> . <br><br>  Here is the most interesting part of this controller: <br><pre> <code class="hljs php"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($form-&gt;isValid()) { $objectManager = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getServiceLocator()-&gt;get(<span class="hljs-string"><span class="hljs-string">'Doctrine\ORM\EntityManager'</span></span>); $data = $form-&gt;getData(); $id = $data[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { $blogpost = $objectManager-&gt;find(<span class="hljs-string"><span class="hljs-string">'\MyBlog\Entity\BlogPost'</span></span>, $id); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (\<span class="hljs-keyword"><span class="hljs-keyword">Exception</span></span> $ex) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;redirect()-&gt;toRoute(<span class="hljs-string"><span class="hljs-string">'blog'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'action'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'index'</span></span> )); } $blogpost-&gt;exchangeArray($form-&gt;getData()); $objectManager-&gt;persist($blogpost); $objectManager-&gt;flush(); $message = <span class="hljs-string"><span class="hljs-string">'Blogpost succesfully saved!'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;flashMessenger()-&gt;addMessage($message); <span class="hljs-comment"><span class="hljs-comment">// Redirect to list of blogposts return $this-&gt;redirect()-&gt;toRoute('blog'); }</span></span></code> </pre><br>  Here we load a blog post from the database, based on the id that came in the form, we update the data: <br><pre> <code class="hljs php">$blogpost-&gt;exchangeArray($form-&gt;getData());</code> </pre><br>  and put the updated blogpost in the database: <br><pre> <code class="hljs php">$objectManager-&gt;persist($blogpost); $objectManager-&gt;flush();</code> </pre><br><br><h3>  Deleting blog posts </h3><br>  Deleting a blog post is a trivial task; it is enough to display a form to the user with a question like ‚ÄúDo you really want to delete the post?‚Äù And if the user clicks the ‚ÄúYes‚Äù button, perform the appropriate actions. <br><br>  The code for the corresponding controller and template can be viewed at Github: <a href="https://github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/src/MyBlog/Controller/BlogController.php">github.com/romka/zend-blog-example/blob/blogpost_form_2/module/MyBlog/src/MyBlog/Controller/BlogController.php#L161</a> . <br><br>  The sources with the <em>blogpost_form_2</em> tag (https://github.com/romka/zend-blog-example/tree/blogpost_form_2) contain the <em>blogpost</em> editing and deleting forms, the list of posts and the corresponding templates. <br><br>  On this I would like to complete the second part of the article.  <a href="http://habrahabr.ru/post/192726/">In the third part,</a> we will work with users and attach Twig template engine to the project. </div><p>Source: <a href="https://habr.com/ru/post/192608/">https://habr.com/ru/post/192608/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../192592/index.html">The implementation of the site registry of prohibited sites: again, twenty-five!</a></li>
<li><a href="../192594/index.html">Joker java conference: choose reports together!</a></li>
<li><a href="../192596/index.html">myOpenID closes February 1, 2014</a></li>
<li><a href="../192598/index.html">Now push messages and in safari</a></li>
<li><a href="../192604/index.html">Jeff Dean from Google - Chuck Norris of our time</a></li>
<li><a href="../192610/index.html">Jedi - autocompletion library for Python</a></li>
<li><a href="../192612/index.html">The course "DevOps for Internet Projects" will be held September 21-22</a></li>
<li><a href="../192614/index.html">Development cycle through Github</a></li>
<li><a href="../192616/index.html">Unexpected Cisco ASA Feint</a></li>
<li><a href="../192618/index.html">How to write letters to be answered?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>