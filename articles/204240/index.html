<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Introduction to Veritas Volume Manager</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The static partitioning of disks is a thing of the past; various volume managers and their hybrids with file systems have long since replaced it. On A...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Introduction to Veritas Volume Manager</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a1d/b0d/f4a/a1db0df4aa3e2050c4bacced98a2fb16.jpg" alt="image" align="left">  The static partitioning of disks is a thing of the past; various volume managers and their hybrids with file systems have long since replaced it.  On AIX and HP-UX, even quite serious crutches are needed to not use the volume manager.  Linux distributions also now do a default breakdown with LVM tools, indicating that this mechanism is sufficiently stable for use in a corporate environment. <br>  But the product of Symantec (which bought Veritas), which is called the Veritas Storage Foundation (in the latest version of the Storage Foundation High Availability), has been present on the market for a long time.  It includes quite a lot of disk space management tools: starting from the Multipath setting, ending with its own extremely flexible file system, and is available for all modern server operating systems. <br><br>  In practice, engineers most often encounter Veritas products, when they come to a new job, log in to a server, Veritas is there, and they shout ‚ÄúWTF ??‚Äù to the whole room.  I first met him on HP-UX, the acquaintance was very strained, I had to figure it out for a long time. <br>  In this article, I will give some basic understanding of what Veritas Volume Manager (VxVM) is and how it works. <br><a name="habracut"></a><br>  Service advantages over statics, some over LVM: <br>  - Recycling space.  Sections can be expanded and reduced without stopping the service, the allocation of space for new services also passes without affecting the service.  Supported by Thin Provisioning. <br>  - Dedublication and compression.  In a number of tasks helps save space. <br>  - Management paths.  The package contains a means to control the paths to the device (multipath), which allows quite flexible configuration of policies for balancing, availability, etc. <br>  - Tiring (tiering).  Optimization of data placement depending on their classification <br>  - Data migration.  It is useful when you need to transfer disks to another system from any OS.  Only one command on the source and one on the receiver, and the group along with the data is available on another server.  Of course, the disks should be presented on both servers. <br><br>  The main disadvantage is the comparative complexity of administration and payment as an additional product (only with HP-UX it comes in the distribution kit, you can choose between LVM and VxVM).  If in the same LVM the administrator works with only three components of the manager, then two more are added to Veritas.  For basic tasks, these components are not needed, but without understanding how they work, it will be impossible to achieve maximum performance, flexibility, as well as cope with emergency situations. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Installation does not cause issues, the installation script does everything you need.  After installation, you may need to call ‚Äúvxinstall‚Äù to initialize the services and start them. <br>  As input parameters there are several blank disks, from which, ultimately, you need to get file systems.  In Veritas terminology, this is ‚ÄúPhysical disks‚Äù: <br><br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxdisk list DEVICE TYPE DISK GROUP STATUS sda auto:none - - online invalid sdb auto:none - - online invalid sdc auto:none - - online invalid sdd auto:none - - online invalid sde auto:none - - online invalid</span></span></code> </pre> <br><br>  From the output of the command, we see that the system has 5 disks available, but they are not initialized to work with VxVM.  I have a system on ‚Äúsda‚Äù, so I won‚Äôt touch it. <br>  To add a device to the VxVM, you need to write a service area to it using the ‚Äúvxdisksetup‚Äù command with the ‚Äú-i‚Äù key (Initialize the private region): <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /opt/VRTS/bin/vxdisksetup -i sdb # /opt/VRTS/bin/vxdisksetup -i sdc # /opt/VRTS/bin/vxdisksetup -i sdd # /opt/VRTS/bin/vxdisksetup -i sde</span></span></code> </pre><br><br>  It is important to note that Veritas does not prompt the user for the names of the device files, using the entries from the ‚ÄúDEVICE‚Äù field. <br><br>  Now we have another output of the ‚Äúvxdisk list‚Äù command: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxdisk list DEVICE TYPE DISK GROUP STATUS sda auto:none - - online invalid sdb auto:cdsdisk - - online sdc auto:cdsdisk - - online sdd auto:cdsdisk - - online sde auto:cdsdisk - - online</span></span></code> </pre><br><br>  The ‚Äúcdsdisk‚Äù type is used by default for data partitions, and does not support booting.  If you want to boot from a VxVM encapsulated disk, you will need to initialize the disk as ‚Äúsliced‚Äù. <br><br>  Now, on the basis of two initialized disks, create the group dg_first, assigning disk names to the devices: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxdg init dg_first disk1=sdb disk2=sdc # vxdisk list DEVICE TYPE DISK GROUP STATUS sda auto:none - - online invalid sdb auto:cdsdisk disk1 dg_first online sdc auto:cdsdisk disk2 dg_first online sdd auto:cdsdisk - - online sde auto:cdsdisk - - online # vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - -</span></span></code> </pre><br>  The last team showed more detailed information about the group.  The rather important LENGTH field indicates the length in sectors.  Inconvenient, yes ... The sector in this case is 512 bytes, we get 2GB per disk.  When there are many disks in a group, you have to resort to the help of available tools, and you get something like: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxprint -g dg_first|awk 'BEGIN{DGSIZE=0} {DGSIZE=DGSIZE+$5} END{print "DG size:" DGSIZE*512/1024/1024}' DG size:4023.75</span></span></code> </pre><br>  I'll warn you right away that there are plenty of such jokes in Veritas, but over time a habit develops and everything is perceived as it should be. <br><br>  Now we will create a vol1 volume in the dg_first group of 2 GB in size, on which it will be possible to write the file system so that it can be mounted: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxassist -g dg_first make vol1 2G # vxprint -g dg_first -vt vol1 V NAME RVG/VSET/CO KSTATE STATE LENGTH READPOL PREFPLEX UTYPE v vol1 - ENABLED ACTIVE 4194304 SELECT - fsgen</span></span></code> </pre><br><br>  In principle, the described process is similar to the process of creating a partition in LVM, the two layers described above were created automatically: plex and subdisk.  They will be seen in the output of the vxprint command: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - - v vol1 fsgen ENABLED 4194304 - ACTIVE - - pl vol1-01 vol1 ENABLED 4194304 - ACTIVE - - sd disk1-01 vol1-01 ENABLED 4120320 0 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - -</span></span></code> </pre><br>  The output of the command can be interpreted as follows: the dg_first disk group consists of one plex vol1-01, which, in turn, consists of two disk1-01 and disk2-01 subdisks (PLOFFS - plex association offset).  Add another 1 GB volume and see where it will be located: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxassist -g dg_first make vol2 1G # vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - - v vol1 fsgen ENABLED 4194304 - ACTIVE - - pl vol1-01 vol1 ENABLED 4194304 - ACTIVE - - sd disk1-01 vol1-01 ENABLED 4120320 0 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - - v vol2 fsgen ENABLED 2097152 - ACTIVE - - pl vol2-01 vol2 ENABLED 2097152 - ACTIVE - - sd disk2-02 vol2-01 ENABLED 2097152 0 - - -</span></span></code> </pre><br>  The second volume received its plex, which contains one subdisk, and this subdisk fits on the second disk (the first subdisk took a little second disk, apparently due to the presence of service areas).  Graphically, it seems like this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/640/ae6/e52/640ae6e521f3d7ad1f3a331e8807a598.png" alt="image"><br><br>  Detailed information on the location of the plexes and subdisks is given by the vxprint command with the appropriate keys: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxprint -g dg_first -s -t Disk group: dg_first SD NAME PLEX DISK DISKOFFS LENGTH [COL/]OFF DEVICE MODE SV NAME PLEX VOLNAME NVOLLAYR LENGTH [COL/]OFF AM/NM MODE SC NAME PLEX CACHE DISKOFFS LENGTH [COL/]OFF DEVICE MODE sd disk1-01 vol1-01 disk1 0 4120320 0 sdb ENA sd disk2-01 vol1-01 disk2 0 73984 4120320 sdc ENA sd disk2-02 vol2-01 disk2 73984 2097152 0 sdc ENA</span></span></code> </pre><br><br>  During operation, you can operate with plexes and subdisks: create, delete, associate with each other, etc.  This introduces some complexity and possibly confusion, but adds flexibility in data placement. <br><br>  Now you can create a file system on existing volumes vol1 and vol2.  I have already mentioned that the package contains a very flexible and powerful Veritas File System (vxfs) file system.  Create it on the volumes and mount: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># mkfs.vxfs /dev/vx/dsk/dg_first/vol1 version 9 layout 4194304 sectors, 2097152 blocks of size 1024, log size 16384 blocks rcq size 1024 blocks largefiles supported # mkfs.vxfs /dev/vx/dsk/dg_first/vol2 version 9 layout 2097152 sectors, 1048576 blocks of size 1024, log size 16384 blocks rcq size 1024 blocks largefiles supported # mount.vxfs /dev/vx/dsk/dg_first/vol1 /mnt/vol1 # mount.vxfs /dev/vx/dsk/dg_first/vol2 /mnt/vol2</span></span></code> </pre><br><br>  Note the path to the block device file: the constant path to the VxVM device files is ‚Äú/ dev / vx‚Äù, then dsk (block devices) or rdsk (character devices), the group name and the volume names.  Everything is logical.  Check the file system sizes: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># df -h Filesystem Size Used Avail Use% Mounted on /dev/vx/dsk/dg_first/vol1 2.0G 19M 1.9G 1% /mnt/vol1 /dev/vx/dsk/dg_first/vol2 1.0G 19M 943M 2% /mnt/vol2</span></span></code> </pre><br><br>  All perfectly.  But we have 2 more disks: sdd and sde, you can try to add them and expand existing file systems by 2 times: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxdg -g dg_first adddisk disk3=sdd disk4=sde # vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - - dm disk3 sdd - 4120320 - - - - dm disk4 sde - 4120320 - - - - v vol1 fsgen ENABLED 4194304 - ACTIVE - - pl vol1-01 vol1 ENABLED 4194304 - ACTIVE - - sd disk1-01 vol1-01 ENABLED 4120320 0 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - - v vol2 fsgen ENABLED 2097152 - ACTIVE - - pl vol2-01 vol2 ENABLED 2097152 - ACTIVE - - sd disk2-02 vol2-01 ENABLED 2097152 0 - - -</span></span></code> </pre><br><br>  Added only discs.  Resize volumes with file systems: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /usr/lib/vxvm/bin/vxresize -F vxfs -g dg_first vol1 4G # /usr/lib/vxvm/bin/vxresize -F vxfs -g dg_first vol2 2G # vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - - dm disk3 sdd - 4120320 - - - - dm disk4 sde - 4120320 - - - - v vol1 fsgen ENABLED 8388608 - ACTIVE - - pl vol1-01 vol1 ENABLED 8388608 - ACTIVE - - sd disk1-01 vol1-01 ENABLED 4120320 0 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - - sd disk2-03 vol1-01 ENABLED 73984 4194304 - - - sd disk3-01 vol1-01 ENABLED 4120320 4268288 - - - v vol2 fsgen ENABLED 4194304 - ACTIVE - - pl vol2-01 vol2 ENABLED 4194304 - ACTIVE - - sd disk2-02 vol2-01 ENABLED 2097152 0 - - - sd disk4-01 vol2-01 ENABLED 2097152 2097152 - - - # df -h /dev/vx/dsk/dg_first/vol1 4.0G 20M 3.8G 1% /mnt/vol1 /dev/vx/dsk/dg_first/vol2 2.0G 19M 1.9G 1% /mnt/vol2</span></span></code> </pre><br><br>  Expanded volume and file system.  Notice how the subdisks are distributed. <br>  Suppose now we have the task to give sdb, which contains data on a mounted file system.  Attempting to disable it will not work, because  There is a subdisk there, and there would be no place to migrate all the data: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vxdg -g dg_first rmdisk disk1 VxVM vxdg ERROR V-5-1-552 Disk disk1 is used by one or more subdisks. Use -k to remove device assignment.</span></span></code> </pre><br>  Only 1 GB is occupied on disk4, so first we will take a gigabyte from the file system, then free up disk1 (on which the disk1-01 subdisk belonging to the vol1-01 plex of volume vol1 rests) and remove it from VxVM: <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># /usr/lib/vxvm/bin/vxresize -F vxfs -g dg_first vol1 -1G # vxprint Disk group: dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk1 sdb - 4120320 - - - - dm disk2 sdc - 4120320 - - - - dm disk3 sdd - 4120320 - - - - dm disk4 sde - 4120320 - - - - v vol1 fsgen ENABLED 6291456 - ACTIVE - - pl vol1-01 vol1 ENABLED 6291456 - ACTIVE - - sd disk1-01 vol1-01 ENABLED 4120320 0 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - - sd disk2-03 vol1-01 ENABLED 73984 4194304 - - - sd disk3-01 vol1-01 ENABLED 2023168 4268288 - - - v vol2 fsgen ENABLED 4194304 - ACTIVE - - pl vol2-01 vol2 ENABLED 4194304 - ACTIVE - - sd disk2-02 vol2-01 ENABLED 2097152 0 - - - sd disk4-01 vol2-01 ENABLED 2097152 2097152 - - - # vxassist -g dg_first move vol1 '!disk1' # vxdg -g dg_first rmdisk disk1 # vxprint -g dg_first TY NAME ASSOC KSTATE LENGTH PLOFFS STATE TUTIL0 PUTIL0 dg dg_first dg_first - - - - - - dm disk2 sdc - 4120320 - - - - dm disk3 sdd - 4120320 - - - - dm disk4 sde - 4120320 - - - - v vol1 fsgen ENABLED 6291456 - ACTIVE - - pl vol1-01 vol1 ENABLED 6291456 - ACTIVE - - sd disk3-02 vol1-01 ENABLED 2097152 0 - - - sd disk4-02 vol1-01 ENABLED 2023168 2097152 - - - sd disk2-01 vol1-01 ENABLED 73984 4120320 - - - sd disk2-03 vol1-01 ENABLED 73984 4194304 - - - sd disk3-01 vol1-01 ENABLED 2023168 4268288 - - - v vol2 fsgen ENABLED 4194304 - ACTIVE - - pl vol2-01 vol2 ENABLED 4194304 - ACTIVE - - sd disk2-02 vol2-01 ENABLED 2097152 0 - - - sd disk4-01 vol2-01 ENABLED 2097152 2097152 - - -</span></span></code> </pre><br>  We see that subdisk disk3-02 and disk4-02 were added to vol1, i.e.  the system used all free disk3 disk space, then took the required amount of disk4 disk space. <br><br>  For the first article is enough.  I think in general terms how this product works.  I did not describe the commands and keys in detail, in order not to inflate the article any more, I recommend to google ‚Äúvxvm cheat sheet‚Äù, select a label and print it. <br>  If there is interest, in the following articles I will discuss such topics as moon migration, space optimization, the vxfs file system, and others. </div><p>Source: <a href="https://habr.com/ru/post/204240/">https://habr.com/ru/post/204240/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../204228/index.html">Simple publication of geodata on your own map based on 2GIS</a></li>
<li><a href="../204230/index.html">Winners of WEB READY 2013</a></li>
<li><a href="../204234/index.html">Is it worth optimizing image processing in C ++ using SIMD?</a></li>
<li><a href="../204236/index.html">OpenVX: computer vision standard</a></li>
<li><a href="../204238/index.html">60 FPS? Easy! pointer-events: none!</a></li>
<li><a href="../204242/index.html">Openfire + Miranda + Asterisk + Active Directory + pinch php, bash, C # or how to call from Miranda using regular phones</a></li>
<li><a href="../204244/index.html">How software companies die, or How to grow programmers correctly</a></li>
<li><a href="../204248/index.html">Highlighting code on android. My experience</a></li>
<li><a href="../204250/index.html">Service robot Tod. First steps with ROS</a></li>
<li><a href="../204252/index.html">10 months of free clouds on DigitalOcean</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>