<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fukami, part 1: turnips with tentacles</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Grandfather planted a turnip ... and tentacles came crawling out of it. 
 UPD: Gentlemen, please accomplish your goal, what is wrong with the article ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fukami, part 1: turnips with tentacles</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/057/59c/e5b/05759ce5bfe5f41a05829d3f1efc4bf6.gif"><br>  <sub>Grandfather planted a turnip ... and tentacles came crawling out of it.</sub> <br>  <b>UPD:</b> Gentlemen, please accomplish your goal, what is wrong with the article and what can hurt someone.  And then the spit flew into karma, but it is not clear what to fix.  <i>Not for sake, but good deeds for writing ...</i> <br>  <b>Upd 2:</b> forgot to warn ... In debug mode, UnityEditor displays hundreds of messages about invalid values ‚Äã‚Äãof quaternions to the console (apparently they are not normalized).  Because of this, in debugging, it starts to slow down at some point.  I haven‚Äôt yet understood whether my fault or bug is in the release of Unity.  Hands will not reach the post in any way on the Unity3D forum. <br><a name="habracut"></a><br><br><h4>  Introduction </h4><br>  <a href="http://habrahabr.ru/post/204376/">The article by</a> Mr. <a href="https://habrahabr.ru/users/frozmatgames/" class="user_link">FrozmatGames</a> prompted me to hurry up with this article, which deals with the implementation of a prototype for a game on genetics.  I apologize in advance for the possible dampness of the text.  Time is not enough for "combing".  Send anger about ochepyatki and other textual flaws - I will try to fix everything. <br>  In the article I will try to briefly describe the demo concept created with the simulation of organic growth.  In the beginning I will describe the very idea on which the demo was created.  Then I will describe what tools I began to use and on what I stopped in the end.  Well, I‚Äôll finish with a description of some points in implementation, a demonstration, and a list of things that I would like to implement further. <br><br>  <a href="https://github.com/homoluden/fukami">As always, the code is laid out on Github</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Game Idea and Prototype # 1 </h4><br>  The main sources of inspiration for me are the worlds of the Strugatsky brothers (A., B. and J.;), as well as several articles on Habr√© (see list below). <br><br><ul><li>  <a href="http://habrahabr.ru/post/107387/">"Live graphs" - growing graphs on cellular automata with examples in Silverlight</a> </li><li>  <a href="http://habrahabr.ru/post/84015/">Review of neural network evolution methods</a> </li><li>  <a href="http://en.wikipedia.org/wiki/Neuroevolution_of_augmenting_topologies">Neuro Evolution of Augmenting Topologies</a> </li><li>  <a href="http://habrahabr.ru/post/185882/">More about the evolution of racing cars</a> </li></ul><br><br>  The basic idea is a game world in which everything or almost everything is filled with life, is not built, is not going to, is not made, but is born, develops and grows.  In general, a mixture of Terraria with Spore.  This is if in brief about the idea of ‚Äã‚Äãthe game.  In more detail, while I will not tell - before that you need to bring your thoughts in order. <br>  I decided to start with the implementation of the prototype, in which it will be possible to observe the birth and development of a certain abstract plant (the working title in the article title).  The pictures below are sketches of the conceived prototype. <br><img src="https://habrastorage.org/getpro/habr/post_images/b6f/5c4/d93/b6f5c4d9320867f21f4b9cb9178a7339.png"><br>  This sketch shows the initial stage of development of the object.  At this stage, the core "grows" bones and strings connecting them.  Bones and strings can be divided or added new from the core.  As a part of a structure grows, its geometry and physical characteristics may change. <br><img src="https://habrastorage.org/getpro/habr/post_images/8e2/53a/b3e/8e253ab3e4cd9f7cae89f633689b8eb9.png"><br>  Division and inset are two operations that are well described in " <a href="http://en.wikipedia.org/wiki/Neuroevolution_of_augmenting_topologies">Neuro Evolution of Augmenting Topologies</a> ".  They can be encrypted with genes, which will allow me to use genetic algorithms in the future to evolve the world. <br><br><h4>  Physics2D.Net + WPF Render vs Unity3D 4.3.0 </h4><br>  At first, it was decided to implement the prototype using Physics2D.Net.  It seems to be easy to work with him (you can read a simple tutorial on a <a href="http://code.google.com/p/physics2d/wiki/BasicIntroduction">wiki</a> ): <br><pre><code class="cs hljs">PhysicsEngine engine = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhysicsEngine(); engine.BroadPhase = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Physics2DDotNet.Detectors.SelectiveSweepDetector(); engine.Solver = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Physics2DDotNet.Solvers.SequentialImpulsesSolver();</code> </pre> <br>  Simulation is started and stopped through a timer object ( <b>PhysicsTimer</b> ): <br><pre> <code class="cs hljs">PhysicsTimer timer = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> PhysicsTimer(engine.Update, <span class="hljs-number"><span class="hljs-number">.01</span></span>f); timer.IsRunning = <span class="hljs-literal"><span class="hljs-literal">true</span></span>;</code> </pre><br><br>  But the possibilities, of course, are not enough.  In addition, the problem was the rendering of the scene.  As the simplest solution, the rendering on WriteableBitmap was used (see the code <a href="https://github.com/homoluden/fukami/tree/master/FukamiDemo">in the repository</a> ).  Later I refused this approach, because  I suspected that there would be difficulties in replacing rendering with something more productive.  It‚Äôs better to learn something more immediately, I decided.  If it is interesting to someone to read about Physics2D.Net, then write in the comments - I will try to find time for it. <br><br>  After the article about the release of Unity3D 4.3.0, which implements native 2D mode, it was decided to try to implement the demo on it.  Projects on Unity3D differ from the OOP architecture that I am used to by their massive use of the component code organization approach.  Because the code from the branch with Physics2D decided not to use, but to start the implementation from scratch. <br>  As a basis for my concept, I took a 2D demo project ( <a href="https://www.assetstore.unity3d.com/">this one here</a> ).  Created your sprites for the main parts of the game object and behavior scenarios.  Also in the project were added to the implementation of various helperov. <br><br>  I suspected that with the traditional OOP approach in Unity3D it would be difficult.  Polymorphism in behavior scenarios does not work.  But in general, there were not so many problems with the traditional PLO ... maybe for now.  When working with a solution, I use not only Mono Develop, but also Visual Studio 2012, because  C # editor is better and more stable.  Faced Mono Develop's problems with auto-indents, dragging pieces of code, auto-closing parentheses and other trifles, which are quite a lot and they strain.  But debugging through VS, I have not yet learned.  By the way speaking, with debag and Mono Develop problems.  For some reason, the namespaces with <b>enum</b> are unloaded in the debug, which is why the types of game objects are not shown in the debug, they have to be duplicated in string variables, which I really don't like.  Maybe I just do not know any tricks or in vain I endured enums to a separate namespace. <br><br><h4>  Implementation </h4><br>  What is implemented at the moment: <br><ul><li>  Three types of prefabs are added: core (Core), node (Node) and bone (Bone) </li><li>  Nodes and pits are several species, the core is of the same type </li><li>  Implemented loading, decoding and replication of DNA, as well as genes in its composition.  See the Seed, DnaProcessor, GeneProcessor scripts in the <a href="https://github.com/homoluden/fukami/tree/master/Fukami.Unity3D/Assets/Scripts/Plant">repository</a> </li><li>  Decrypted genes are applied to the current part of the game object while satisfying the conditions of applicability. </li><li>  The following conditions of gene applicability have been implemented: the current position in the object element tree (¬± random tolerance);  subtype of parent element;  gene activation time. </li><li>  For genes of bones and nodes the addition of child elements is realized. </li><li>  Scripts that implement various growth stages communicate with each other by sending broadcast messages (GameObject.SendMessage) for components of the current GameObject. </li><li>  Implemented a simple animation when adding nodes. </li><li>  Implemented two single-helper to work with genes (GenesManager) and prefabs in resources (PrefabsManager). </li></ul><br>  Now a little more life cycle in the demo. <br>  The root of the object to be grown is the core (Prefab Core).  This object has a Seed script that loads from dna.txt resources. <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Collections; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Fukami.Helpers; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Seed</span></span> : <span class="hljs-title"><span class="hljs-title">MonoBehaviour</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> Dna; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Start</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dnaAsset = Resources.Load&lt;TextAsset&gt;(<span class="hljs-string"><span class="hljs-string">"dna"</span></span>); Dna = dnaAsset.text.Replace(<span class="hljs-string"><span class="hljs-string">"\r\n"</span></span>,<span class="hljs-string"><span class="hljs-string">"*"</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnSeedDnaStringRequested</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Wrap&lt;</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">&gt; dna</span></span></span><span class="hljs-function">)</span></span> { dna.Value = Dna; dna.ValueSource = <span class="hljs-string"><span class="hljs-string">"Seed"</span></span>; } }</code> </pre> <br><br>  This file contains the complete DNA of the "turnip". <br><pre> // node, [Node type], [Bone Type], [Base depth], [Depth tolerance], [Grow Time]

 node 1,0,0,0,07A
 node 1,0,0,0,080

 node 2,0,0,0,100

 bone 1,0,4,2,190
 bone 1,0,4,2,15E
 node 3,0,3,2,96
 bone, 1,0,0,5, C8
 bone, 1,0,2,1, FA
 bone, 1,0,3,1,12C

 node, 2,0,3,2, Fa
 node 1,0,7,3,80
 bone 1,0,8,2,128 </pre><br><br>  Also, a DnaProcessor script is attached to the kernel, which at the start checks whether the current element has a parent. <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span>() { _age = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f; var dna = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Wrap&lt;string&gt;(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.parent != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { var gen = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Wrap&lt;<span class="hljs-type"><span class="hljs-type">int</span></span>&gt;(); gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.parent.SendMessage("OnDnaGenRequested", gen); _generation = gen.IsSet ? gen.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span>; gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.parent.SendMessage("OnDnaStringRequested", dna); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { SendMessage("OnSeedDnaStringRequested", dna); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (dna.IsSet) { DnaString = dna.<span class="hljs-keyword"><span class="hljs-keyword">Value</span></span>; } }</code> </pre> <br><br>  If there is no parent, then DnaProcessor sends an ‚ÄúOnSeedDnaStringRequested‚Äù message requesting DNA from the Seed script.  Otherwise, the message ‚ÄúOnDnaStringRequested‚Äù will be sent to receive DNA from the same DnaProcessor in the parent element.  DnaProcessor also asks the parent for the current position in the tree (depth, generation) to transfer this value to the genes. <br>  The life cycle of a gene is controlled by the ‚ÄúGeneProcessor‚Äù script.  This script is very simple, it counts the activation time and then sends the message ‚ÄúOnApplyGene‚Äù. <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Update</span></span> () { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (Gene != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { _age += <span class="hljs-type"><span class="hljs-type">Time</span></span>.deltaTime; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (_age &gt;= Gene.GrowTime) { enabled = <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; SendMessage("OnApplyGene", Gene); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } }</code> </pre> <br><br>  The message will be accepted either by ‚ÄúBonesApplicant‚Äù (if the current element is a node), or ‚ÄúNodesApplicant‚Äù in the case of a bone.  Both of these scripts in the ‚ÄúOnApplyGene‚Äù message handler perform the check of conditions and rules of gene applicability. <br><pre> <code class="hljs pgsql"><span class="hljs-type"><span class="hljs-type">bool</span></span> GetIsApplicable(GeneData gene) { // Part <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gene.GeneType != "node" &amp;&amp; gene.GeneType != "stats") { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } // Subtype <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gene.ApplicantSubtype != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; gene.ApplicantSubtype != Subtype) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } // Generation <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> var gen = Generation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gen != gene.BaseDepth) { var actDistance = Mathf.Abs(gen - gene.BaseDepth); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UnityEngine.Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>f, <span class="hljs-number"><span class="hljs-number">1</span></span>f) &lt; actDistance / (gene.DepthTolerance + <span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><pre> <code class="hljs cs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">OnApplyGene</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">GeneData gene</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!GetIsApplicable(gene)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (gene.GeneType.ToLower()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"bone"</span></span>: AddBone(gene); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"joint"</span></span>: AddJoint(gene); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">"stats"</span></span>: AddStats(gene); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre> <br><br>  If everything is in order and there are free slots ( <b>ChildSlot list</b> ), then a child element is created for the gene. <br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> AddBone(GeneData gene) { var slot = Slots.FirstOrDefault(s =&gt; !s.IsOccupied); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (slot == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } slot.IsOccupied = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; var bonePrefab = PrefabsManager.Instance.LoadPrefab(string.Format("{0}{1}", gene.GeneType, gene.Subtype)); var newBody = (GameObject)Instantiate(bonePrefab, gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.position, gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.rotation * Quaternion.AngleAxis(slot.Angle, Vector3.forward)); newBody.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.parent = gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>; newBody.SetActive(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); //var slide = newBody.AddComponent&lt;SliderJoint2D&gt;(); var slide = newBody.AddComponent&lt;HingeJoint2D&gt;(); slide.connectedBody = gameObject.GetComponent&lt;Rigidbody2D&gt;(); slide.connectedAnchor = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector2(slot.X, slot.Y); //slide.limits = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JointTranslationLimits2D { min = <span class="hljs-number"><span class="hljs-number">-0.1</span></span>f, max = <span class="hljs-number"><span class="hljs-number">0.1</span></span>f }; slide.limits = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JointAngleLimits2D { min = <span class="hljs-number"><span class="hljs-number">-1.0</span></span>f, max = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f }; slide.useLimits = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; gameObject.SendMessage("OnChildAdded", newBody, SendMessageOptions.DontRequireReceiver); } <span class="hljs-type"><span class="hljs-type">bool</span></span> GetIsApplicable(GeneData gene) { // Part <span class="hljs-keyword"><span class="hljs-keyword">Type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gene.GeneType != "bone" &amp;&amp; gene.GeneType != "stats" &amp;&amp; gene.GeneType != "joint") { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } // Subtype <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gene.ApplicantSubtype != <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; gene.ApplicantSubtype != Subtype) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } // Generation <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> var gen = Generation; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gen != gene.BaseDepth) { var actDistance = Mathf.Abs(gen - gene.BaseDepth); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (UnityEngine.Random.Range(<span class="hljs-number"><span class="hljs-number">0</span></span>f, <span class="hljs-number"><span class="hljs-number">1</span></span>f) &lt; actDistance / (gene.DepthTolerance + <span class="hljs-number"><span class="hljs-number">1</span></span>)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">false</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; }</code> </pre> <br><pre> <code class="hljs pgsql">private <span class="hljs-type"><span class="hljs-type">void</span></span> AddNode(GeneData gene) { var slot = Slots.FirstOrDefault(s =&gt; !s.IsOccupied); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (slot == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; slot.IsOccupied = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; var nodePrefab = PrefabsManager.Instance.LoadPrefab(string.Format("{0}{1}", gene.GeneType, gene.Subtype)); var newBody = (GameObject)Instantiate(nodePrefab, gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.position, Quaternion.FromToRotation(Vector3.right, Vector3.up) * //Quaternion.AngleAxis(Random.Range(-slot.Angle, slot.Angle), Vector3.forward)); Quaternion.AngleAxis(slot.Angle, Vector3.forward)); newBody.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.parent = gameObject.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>; newBody.SetActive(<span class="hljs-keyword"><span class="hljs-keyword">true</span></span>); var hinge = newBody.AddComponent&lt;HingeJoint2D&gt;(); hinge.connectedBody = gameObject.GetComponent&lt;Rigidbody2D&gt;(); hinge.connectedAnchor = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Vector2(slot.X, slot.Y); hinge.limits = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> JointAngleLimits2D { min = <span class="hljs-number"><span class="hljs-number">-1.0</span></span>f, max = <span class="hljs-number"><span class="hljs-number">1.0</span></span>f }; hinge.useLimits = <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; newBody.AddComponent&lt;HingeSmoothPos&gt;(); gameObject.SendMessage("OnChildAdded", newBody, SendMessageOptions.DontRequireReceiver); }</code> </pre> <br><br>  The child element is instantiated via the PrefabsManager, which selects the prefab by the string type ( <b>bone</b> or <b>node</b> ) and the postfix subtype prefab.  It turns out, for example, "node1", "node2", etc.  The DieIfNoChildren script is additionally attached to the nodes, which simply destroys the node if a child element is not attached to it after a certain time. <br><br>  About many moments there is something to tell separately.  Ask questions - I will try to answer in detail in the comments or even write a separate post.  For now, here's a better demo animation.  Compiled EXE can be <a href="https://github.com/homoluden/fukami/tree/master/Fukami.Unity3D/Build">downloaded in the repository</a> . <br><div class="spoiler">  <b class="spoiler_title">Caution!</b>  <b class="spoiler_title">GIF 8MB</b> <div class="spoiler_text"><img src="http://gifti.me/i/lZqXRQjKkC.gif" alt="image"><br></div></div><br>  <sub><i>Someone tell me pliz convenient and free way to capture video from the screen to send to YouTube</i></sub> <br><br><h4>  What's next </h4><br>  Next, I want to play around with DNA in order to get a less beautiful simulation.  You also need to implement the processing of genes of joints (Joint, an element connecting two nodes), as well as a characteristics modifier (Stats, mass, and other physical coefficients, hit points, etc.).  The next thing that is planned to be implemented is additional elements of bones and nodes (protective cover, some attacking elements, etc.), as well as the ability to destroy bones or replace them with portals.  In the end, I want to get something like a somosbranny house ‚Äúa-la Terraria‚Äù or something like a bunker. <br><br>  <i>!</i>  <i>THANKS FOR ATTENTION !</i> </div><p>Source: <a href="https://habr.com/ru/post/198532/">https://habr.com/ru/post/198532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../198514/index.html">WAMP: before installing a new release</a></li>
<li><a href="../198518/index.html">Performa 475 + Dial-Up Internet</a></li>
<li><a href="../198522/index.html">I invite you to the II All-Russian Linux Administration Olympiad</a></li>
<li><a href="../198526/index.html">GeeXboX is fully ported to Raspberry Pi</a></li>
<li><a href="../198530/index.html">Moscow City Court began to satisfy the first claims of anti-piracy copyright holders</a></li>
<li><a href="../198534/index.html">Hadoop Part 1: Deploying a Cluster</a></li>
<li><a href="../198536/index.html">How I chose SED - what vendors are silent about</a></li>
<li><a href="../198540/index.html">Productive PHP network server</a></li>
<li><a href="../198542/index.html">Developer meeting with students of MIPT or "How to assemble Badoo on the knee"</a></li>
<li><a href="../198544/index.html">PHP RUtils - a small library for processing Russian text</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>