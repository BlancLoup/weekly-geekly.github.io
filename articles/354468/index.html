<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Automating log downloads from Kibana to Redmine</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Typical use for Kibana - we look at logs, we see errors, we create tickets for them. We have quite a lot of logs, there is little space to store them....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Automating log downloads from Kibana to Redmine</h1><div class="post__text post__text-html js-mediator-article">  Typical use for Kibana - we look at logs, we see errors, we create tickets for them.  We have quite a lot of logs, there is little space to store them.  Therefore, simply inserting a link to a document from Elasticsearch / Kibana is not enough, especially for low-priority tasks: until we get to it, the index with the log can already be deleted.  Accordingly, it is necessary to save the document to a file and attach it to the ticket. <br><br>  If you do it once, then it is still all right, but creating ten tickets in a row will be stupidly lazy, so I decided to ‚Äúquickly‚Äù (ha-ha) automate it. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/-z/sa/ir/-zsairmqtpslekcrtwshdwnpuoy.png"></div><br>  Under the cut: an article for Friday, an experimental javascript feature, a couple of dirty hacks, a small regular checkbox, reverse proxy, a loss of security to convenience, crutches, and an obvious xkcd image. <br><a name="habracut"></a><br>  <b>I warn you</b> : I am far from being an expert in web-technologies, and therefore, experts, most likely, my problems will seem very obvious, and solutions - stupid.  But this is not a production decision, but simply a small script ‚Äúfor one‚Äôs own‚Äù.  Everything happens in a trusted local network and therefore the script has many security problems. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  Solution options </h2><br>  Immediately, you can come up with a lot of solutions to the problem.  Firstly, you can push all the logs in RM at once (suddenly, there is even a <a href="https://www.elastic.co/guide/en/logstash/current/plugins-outputs-redmine.html">logstash plugin</a> for this), filtering / aggregating them beforehand - know yourself change the description and the artist.  This is, of course, cool, but it will take a long time to debug / tweak and a lot of new routine work will appear - to give descriptions / delete unnecessary. <br><br>  The second option is to make up some script that receives links to logs, downloads them, asks the user for additional parameters and creates a new ticket through the Redmine API.  But this will need to cut the normal interface, and duplicate some of the functions of RM ... <br><br>  You can pervert and make a clicker or with the help of selenium to prepare a ticket, so that you can add to the usual interface, but you can‚Äôt touch the mouse ... Yes, and editing may suddenly be needed. <br><br>  Browser plugin?  Stay alive, register and maintain it, and even do two browsers. <br><br>  Redmine plugin?  No, this API will have to be studied, and it will not be enough to go into the gut of RM ... A simple additional field. <br><br>  As a result, we arrive at a bookmarklet (executing javascript from bookmarks) and / or a custom script (greasemonkey / tampermonkey, etc.) - with javascript it seems you can draw an interface and download logs via ajax request, and indeed almost everything please do with the page. <br><br><h2>  File upload </h2><br>  For now, the most obscure part is file uploading.  Everything else seems to be easy to do ... The usual <code>&lt;input type="file"&gt;</code> is responsible for uploading files on the RM ticket creation page, when modified, the function <code>addInputFiles(this)</code> called. <br><br>  In theory, you just need to change the list of files for this element and pull this method.  There is only one small <a href="https://stackoverflow.com/questions/5632629/how-to-change-the-file-inputs-filelist">problem</a> : <br><br><img src="https://habrastorage.org/webt/un/zd/it/unzditwwavngudnqdkprhq2iptq.jpeg"><br><br>  This is done in order to not send to the server <code>/etc/passwd</code> , <code>/etc/shadow/</code> or photos of your cat from the desktop.  In principle, it is reasonable, but it is necessary to get around this somehow.  However, if you can not, but really want to, then you can use such a dirty hack, which is based on an experimental feature - <a href="https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API">Clipboard API</a> . <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFileList</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> dt = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClipboardEvent(<span class="hljs-string"><span class="hljs-string">""</span></span>).clipboardData || <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DataTransfer(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">let</span></span> file <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> files) { dt.items.add(file); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dt.files; }</code> </pre> <br>  Those.  here is simulated adding files from the clipboard, which we then get a list.  By itself, a ‚Äúfile‚Äù from the text is created elementarily: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createFile</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">text, fileName</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> blob = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Blob([text], {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'text/plain'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> file = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File([blob], fileName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> file; }</code> </pre> <br><h2>  User interface </h2><br>  Everything is as simple as an ax: we make an inscription in the right place, an input field and a download button.  Since it is done ‚Äúfor one‚Äôs own‚Äù with the input format (and its validation), I didn‚Äôt bother too much - let there be a text field, one line - one log (the link and the name of the file being created separated by spaces). <br><br>  For the bookmarklet, it was still useful to delete yourself by id. <br><br><div class="spoiler">  <b class="spoiler_title">Elementary things</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">removeSelf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> old = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(ui_id); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (old != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) old.remove(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">createUi</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ removeSelf(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ui = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'p'</span></span>); ui.id = ui_id; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> label = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'label'</span></span>); label.innerHTML = <span class="hljs-string"><span class="hljs-string">"Logs data:"</span></span>; ui.appendChild(label); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> textarea = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'textarea'</span></span>); textarea.id = data_id; textarea.cols = <span class="hljs-number"><span class="hljs-number">60</span></span>; textarea.rows = <span class="hljs-number"><span class="hljs-number">10</span></span>; textarea.name = <span class="hljs-string"><span class="hljs-string">"issue[logs_data]"</span></span>; ui.appendChild(textarea); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> button = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.createElement(<span class="hljs-string"><span class="hljs-string">'button'</span></span>); button.type = <span class="hljs-string"><span class="hljs-string">"button"</span></span>; button.onclick = addLogsData; button.innerHTML = <span class="hljs-string"><span class="hljs-string">"Add logs data"</span></span>; ui.appendChild(button); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> attributesBlock = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">"#attributes"</span></span>); attributesBlock.parentNode.insertBefore(ui, attributesBlock); }</code> </pre> <br></div></div><br><h2>  Main job </h2><br>  Everything is also simple here: we divide the text from the input field into pairs ‚Äúlink‚Äù - ‚Äúfile name‚Äù, download everything from elastic, because Kibana will not give up the data so easily, fill it with RM, change the ticket description and that's it.  Fortunately, jquery is already connected to RM and ajax requests are easily created. <br><br><div class="spoiler">  <b class="spoiler_title">Boring code, regular search here</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">addLogsData</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> text = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(data_id).value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> lines = text.split(<span class="hljs-string"><span class="hljs-string">'\n'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> urlsAndNames = lines .filter(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x</span></span></span><span class="hljs-function"> =&gt;</span></span> x.length &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) .map(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">line</span></span></span><span class="hljs-function"> =&gt;</span></span> line.split(<span class="hljs-regexp"><span class="hljs-regexp">/\s+/</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>)); downloadUrlsToFiles(urlsAndNames); } <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> kibana_pattern = <span class="hljs-regexp"><span class="hljs-regexp">/http:\/\/([^:]*):\d+\/app\/kibana#\/doc\/[^\/]*\/([^\/]*)\/([^\/]*)\/?\?id=(.*?)(&amp;.*)?$/</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> es_pattern = <span class="hljs-string"><span class="hljs-string">'http://$1:9200/$2/$3/$4'</span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">downloadUrlsToFiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">urlsAndNames</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> requests = urlsAndNames.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">splitted</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> url = splitted[<span class="hljs-number"><span class="hljs-number">0</span></span>].replace(kibana_pattern, es_pattern); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $.ajax({ <span class="hljs-attr"><span class="hljs-attr">url</span></span>: url, <span class="hljs-attr"><span class="hljs-attr">dataType</span></span>: <span class="hljs-string"><span class="hljs-string">'json'</span></span> }); }); $.when(...requests).done(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">...responses</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> files = responses.map(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">responseRaw, index</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> response = responseRaw[<span class="hljs-number"><span class="hljs-number">0</span></span>]; checkError(response); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fileName = urlsAndNames[index][<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> createFile(<span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(response._source), fileName + <span class="hljs-string"><span class="hljs-string">'.json'</span></span>); }); uploadFiles(files, urlsAndNames); }).fail(<span class="hljs-function"><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">error</span></span></span><span class="hljs-function">) =&gt;</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> errorString = <span class="hljs-built_in"><span class="hljs-built_in">JSON</span></span>.stringify(error); alert(errorString); <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> errorString; }); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uploadFiles</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">files, urlsAndNames</span></span></span><span class="hljs-function">)</span></span>{ pseudoUpload(files); changeDescription(urlsAndNames); removeSelf(); }</code> </pre> <br></div></div><br>  Great, everything is ready!  Making a test run and ... <br><br><img src="https://habrastorage.org/webt/tk/_2/ac/tk_2acnonf8esqtlp0qpcjakdlg.png"><br><br><h2>  Security </h2><br>  For those who do not know, requesting http-data, while on an https resource, is very bad, because you can get left data through an MITM attack.  Moreover, some Firefox, even if you allow it to do so, you will need to ask for permission from him every time - and <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D873349">there will never be a</a> white list.  This is all right and good from the user's point of view, but for the script on the knee, these are only sticks in the wheels. <br><br>  Well, I don‚Äôt want to buy an <a href="https://www.elastic.co/products/x-pack/security">X-Pack</a> for Elasticsearch for the lousy script, so I‚Äôll have to make a proxy https -&gt; http.  He reverse proxy.  There are quite a few options here, from the monstrous squid to the pit script.  The most suitable haproxy seemed to me - it is easy to set up / install, and it does not eat resources. <br><br>  It is enough to generate a self-signed certificate (sorry, let's encrypt, but we are in the trust zone) <br><br><pre> <code class="bash hljs">openssl genrsa -out dummy.key 1024 openssl req -new -key dummy.key -out dummy.csr openssl x509 -req -days 3650 -<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> dummy.csr -signkey dummy.key -out dummy.crt cat dummy.crt dummy.key &gt; dummy.pem</code> </pre> <br>  and, in fact, set up haproxy: <br><br><pre> <code class="hljs pgsql">frontend https-<span class="hljs-keyword"><span class="hljs-keyword">in</span></span> mode tcp bind *:<span class="hljs-number"><span class="hljs-number">9243</span></span> ssl crt /etc/ssl/localcerts/dummy.pem alpn http/<span class="hljs-number"><span class="hljs-number">1.1</span></span> http-response <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">header</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Strict</span></span>-Transport-<span class="hljs-keyword"><span class="hljs-keyword">Security</span></span> "max-age=16000000; includeSubDomains; preload;" default_backend nodes-http backend nodes-http <span class="hljs-keyword"><span class="hljs-keyword">server</span></span> node1 localhost:<span class="hljs-number"><span class="hljs-number">9200</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span></code> </pre><br>  Now on port 9243 there will be a transparent proxy to an elastic (accordingly, we change the port in the regular schedule and add https). <br><br>  However, this will not satisfy our browser, which provides user security.  This time, the problem is that you cannot request data from another domain if it has not resolved it.  This is solved using <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS">the CORS mechanism</a> .  Well at least Elasticsearch <a href="http.html">can</a> do it <a href="http.html">itself</a> : <br><br><pre> <code class="hljs sql">http.cors.allow-headers: X-Requested-<span class="hljs-keyword"><span class="hljs-keyword">With</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Content</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Type</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Content</span></span>-<span class="hljs-keyword"><span class="hljs-keyword">Length</span></span> http.cors.allow-origin: <span class="hljs-string"><span class="hljs-string">"/.*/"</span></span> http.cors.enabled: <span class="hljs-literal"><span class="hljs-literal">true</span></span></code> </pre><br><h2>  Userscript </h2><br>  Let me remind you that we still <s>rubbed</s> did this game in the format of a bookmarklet.  In principle, nothing terrible, but someone even once again click laziness (for example, me).  Therefore, we will do userscript.  Here at the same time there is the problem of updating it (we have been doing something for centuries!).  Therefore, we will use <s>the update mechanism of userscripts for</s> whom I am cheating, of course, with the next crutch: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// ==UserScript== // @name KIBANA_LOGS // @grant none // @include https://&lt;rm-address&gt;/*issues* // ==/UserScript== (function(){document.body.appendChild(document.createElement('script')).src='https://&lt;kibana-address&gt;:4443/kibana_logs_rm.js';})();</span></span></code> </pre> <br>  But in paranoids bookmarklets will be updated.  To distribute this garbage, we need an https server.  Here I was frankly furious and took the <a href="https://gist.github.com/dergachev/7028596">first one</a> (and even in python 2.7) * sprinkle ashes on my head *: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> BaseHTTPServer, SimpleHTTPServer <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> ssl httpd = BaseHTTPServer.HTTPServer((<span class="hljs-string"><span class="hljs-string">'0.0.0.0'</span></span>, <span class="hljs-number"><span class="hljs-number">4443</span></span>), SimpleHTTPServer.SimpleHTTPRequestHandler) httpd.socket = ssl.wrap_socket(httpd.socket, certfile=<span class="hljs-string"><span class="hljs-string">'/etc/ssl/localcerts/dummy.pem'</span></span>, server_side=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) httpd.serve_forever()</code> </pre> <br>  Now users only need to create a user script / bookmarklet, add a certificate to exceptions and everything will work. <br><br><h2>  A couple of bugs </h2><br>  The essence of the first problem is the following: when it is necessary to process the results of several ajax requests at once, as many arguments as there are requests are passed to the function.  But when the request is one, jquery ‚Äúkindly‚Äù opens it in <a href="https://api.jquery.com/jQuery.when/">three arguments</a> .  Therefore, I had to write such a crutch: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> responses; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (requests.length == <span class="hljs-number"><span class="hljs-number">1</span></span>){ responses = [<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { responses = <span class="hljs-built_in"><span class="hljs-built_in">Array</span></span>.from(<span class="hljs-built_in"><span class="hljs-built_in">arguments</span></span>); }</code> </pre> <br>  The second bug is related to the fact that when changing the tracker or changing the status of the request, Redmine saves all the entered data, requests a new interface (directly html with the built-in js), recreates the interface and refills the fields using the <code>replaceIssueFormWith</code> function.  It sounds a bit crazy, but this is done to implement workflow (and there may potentially be different fields at different stages of the input field).  Here, too, had to make a <s>crutch</s> ad-hoc solution: <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">installReplaceHook</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> original = <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.replaceIssueFormWith; <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.replaceIssueFormWith = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">html</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> logs_data = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(data_id).value; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> ret = original(html); createUi(); <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.getElementById(data_id).value = logs_data; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; }; }</code> </pre> <br>  Those.  just do a hook on the original function and do actions similar to it for your field. <br><br><h2>  Conclusion </h2><br>  The full version of the script can be viewed in my <a href="https://gist.github.com/ov7a/aa5b3aca246b575165db34cb77d712d9">gist</a> .  Here is a picture that most should expect by the end of this article: <br><br><img src="https://habrastorage.org/webt/j_/id/sg/j_idsgwf-2pwz8rpb269cw7f6rs.png"><br><br>  In general, automating things is fun and useful, and allows you to learn something new in another area.  The users of the script are satisfied, the creation of tickets for the logs in the kibana is not so annoying now. </div><p>Source: <a href="https://habr.com/ru/post/354468/">https://habr.com/ru/post/354468/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354458/index.html">How much does the compiler cost?</a></li>
<li><a href="../354460/index.html">Testing systems in TPC-C - fast and easy</a></li>
<li><a href="../354462/index.html">Improving opportunities for finding vacancies and specialists at My Circle</a></li>
<li><a href="../354464/index.html">Interfaces in the real world-4: updates to the traditional pieces</a></li>
<li><a href="../354466/index.html">How to improve the quality of their work</a></li>
<li><a href="../354472/index.html">Backup telegram</a></li>
<li><a href="../354474/index.html">Splunk 7.1. What's new? New web interface, integration with Apache Kafka and much more ...</a></li>
<li><a href="../354476/index.html">PDF generation for downloading server configs</a></li>
<li><a href="../354478/index.html">When computers were people ...</a></li>
<li><a href="../354480/index.html">Bobaos - KNX TP / UART, Raspberry Pi and Apple HomeKit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>