<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New in git 3: closures</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Git is a popular version control system. In it, an atomic change of one or several files is called a commit, and several consecutive commits are combi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New in git 3: closures</h1><div class="post__text post__text-html js-mediator-article"><p>  Git is a popular version control system.  In it, an atomic change of one or several files is called a commit, and several consecutive commits are combined into a branch.  Branches are used to implement new ideas (features). </p><br><p></p><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/aa5/222/85a/aa522285a7fd7fd5f8c597050956d878.svg"></div><p></p><br><p>  It happens that the idea turns out to be a dead end, the developer turns the wrong way, and there is a need to roll back to the original version, to do this, forget about the new branch and switch to the main <strong>dev</strong> or <strong>master</strong> , and then continue to work as if nothing had happened.  In this case, the ‚Äúscion‚Äù will hang forever, as will the desire to remove it.  But how to remove if this is part of the story?  This process shows the efforts of the hard-working programmer, albeit in vain.  So it is easier to report to the authorities, because an unfortunate result is also a result! </p><br><p>  I hasten to rejoice: the Git developers in version 3 will introduce a new command to close such homeless branches.  Let me remind you that the current current version is <a href="https://git-scm.com/downloads">2.21.0</a> . </p><br><p>  How to use this command, what does it give and what do IT companies think?  The article answers these and other questions. </p><a name="habracut"></a><br><h2 id="opisanie">  Description </h2><br><p>  Now you can close an unsuccessful branch with one of the previous commits.  Closed arcs are colored in yellow in the pictures below. </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/831/c59/f42/831c59f42a1c28e9316781e918ab5ad2.svg"></div><br><br><p> Here, commit <code>4</code> is the last unsuccessful feature.  He was closed with <code>1</code> , and then returned to the master and went the other way, with a commit <code>5</code> . </p><br><p>  You can also lock a commit into yourself, thus creating <a href="https://ru.wikipedia.org/wiki/%25D0%259F%25D0%25B5%25D1%2582%25D0%25BB%25D1%258F_(%25D1%2582%25D0%25B5%25D0%25BE%25D1%2580%25D0%25B8%25D1%258F_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584%25D0%25BE%25D0%25B2)">loops</a> : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6e2/d3b/c7f/6e2d3bc7f118f60d4e3a05762bda92ea.svg"></div><br><br><p>  You can lock into any commit - smart Git will calculate the difference by itself and combine everything correctly: </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/61f/1e3/7e1/61f1e37e1861b8307f715fd3b003fa2c.svg"></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2 id="kak-polzovatsya">  How to use? </h2><br><p>  The <code>merge</code> command does not hold the functionality of closures, since for the first case the branch will be <a href="https://stackoverflow.com/q/9069061/1046374">fast-ford</a> and will not do anything for the second ( <code>git already up to date</code> ). </p><br><p>  In order not to change the old behavior, the developers decided to enter a command for closure: </p><br><pre> <code class="plaintext hljs">git closure -s $source_commit -d $dest_commit -m $message</code> </pre> <br><p>  The first argument, <code>-s $source_commit</code> sets the hash of the commit from which you want to stretch the "loop", and the second, optional <code>-d $dest_commit</code> , sets the commit to which you want to close the loop.  If it is absent, the closure occurs in the current check-out branch.  The <code>-m $message</code> parameter sets the closure message, such as <code>failed feature, revert to origin</code> .  However, the <code>--allow-empty-message</code> option is also <code>--allow-empty-message</code> , allowing commits without the message text.  By default, Git allows exactly one closure for a pair of commits.  To bypass this restriction, the option <code>--allow-multiple-closures</code> . </p><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d4/735/680/0d4735680312484fdb0f59ee1bf3ec56.svg"></div><br><p>  After the command is executed, the git will calculate the changes itself, and a double diff will be visible in the final commit: from the base and closing branches.  In the general case, this is an n-dimensional diff, that is, it can be closed as many times as desired.  closure-commit is similar to merge-commit with the difference that it contains several messages, not just one. </p><br><p>  Unfortunately, existing GUIs for working with Git do not yet fully support closures.  The preview version of <a href="https://github.com/gitextensions/gitextensions">GitExtensions</a> builds curves like a merge instead of a beautiful arc.  Check out the new fields <code>Closure message</code> and <code>Closure diff</code> : </p><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/w0/pn/ny/w0pnny3xyxyhdhr1pk9h8i03whk.png"></div><br><p>  It is worth noting that the <code>closure</code> team always changes the history (still, now Git is a full-fledged time machine!), So now you can <code>--force</code> branches only with the <code>--force</code> option, or with the help of the safe <code>--force-with-lease</code> . </p><br><p>  Ribeys for hinged branches are also available, but the logic for recalculating commits in them is complicated. </p><br><p>  Also the <code>auto</code> option allows you to automatically close all the old branches.  In this case, the closing commit is the one from which the fork has gone.  With plugins for Git IDE, closures can be run periodically.  In GitExtensions, the similar <strong>Delete obsolete branches</strong> plugin deletes obsolete branches. </p><br><h2 id="mnenie-it-kompaniy">  Opinion IT companies </h2><br><p>  Large IT companies: Google, Facebook, Apple, DeepMind, Positive Technologies, and especially Microsoft, are eagerly awaiting closures, because now it will be possible to formalize the life cycle of branches, including unmerited ones. </p><br><p>  One of Microsoft's top managers, Michael Richter, <a href="https://blogs.microsoft.com/git-closure">writes</a> : </p><br><blockquote>  A new feature of the gita will certainly reduce the chaos in the world of open source development and more.  There are a lot of "hanging" branches in our repositories.  For example, in <a href="https://github.com/Microsoft/vscode">vscode</a> there are more than 200, and in <a href="https://github.com/Microsoft/TypeScript">TypeScript</a> there are generally more than 300!  And this problem is not only Microsoft.  Closures not only improve the organization, but also allow you to track the programmer's reasoning, sometimes completely incomprehensible even to colleagues :) The closures reminded me of the film "Back to the Future" - there the characters traveled to the past and the future.  I love this film, I revised it several times.  And I think I will love git because of this even more :) </blockquote><br><h2 id="na-zametku">  On a note </h2><br><p>  If earlier the commite graph was a <a href="https://ru.wikipedia.org/wiki/%25D0%259D%25D0%25B0%25D0%25BF%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BB%25D0%25B5%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B0%25D1%2586%25D0%25B8%25D0%25BA%25D0%25BB%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B8%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">directed acyclic graph</a> (DAG), then the closures extend it to a generalized <a href="https://ru.wikipedia.org/wiki/%25D0%259E%25D1%2580%25D0%25B8%25D0%25B5%25D0%25BD%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25BD%25D1%258B%25D0%25B9_%25D0%25B3%25D1%2580%25D0%25B0%25D1%2584">directed graph</a> .  With Git, you can describe regular expressions in which the states are commits, and the alphabet is the set of all messages.  But this smacks of the ‚Äúabnormal programming‚Äù hub, and therefore goes beyond the scope of the article.  However, if this is interesting to you, then read the <a href="https://habr.com/post/351158/">article</a> describing how to store family trees inside Git. </p></div><p>Source: <a href="https://habr.com/ru/post/445676/">https://habr.com/ru/post/445676/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../445662/index.html">Tick-tick: the time of smart watches is gone, but now bracelets are pretending to be them</a></li>
<li><a href="../445666/index.html">You need a ready June - teach him yourself, or How we started a course of seminars for students</a></li>
<li><a href="../445668/index.html">Neoquest 2019: ‚ÄúConnection to Heaven‚Äù</a></li>
<li><a href="../445670/index.html">Consequences of rewriting Firefox components on Rust</a></li>
<li><a href="../445672/index.html">Muon catalysis from the point of view of quantum chemistry. Part II: electronic vs. muon chemical bond</a></li>
<li><a href="../445678/index.html">4. Check Point Getting Started R80.20. Installation and Initialization</a></li>
<li><a href="../445682/index.html">PVS-Studio for Java is sent to the path. Next stop - Elasticsearch</a></li>
<li><a href="../445684/index.html">Monoblock vs. modular UPS</a></li>
<li><a href="../445686/index.html">Developing an application for an old PDA (Cybiko Xtreme) in 2019</a></li>
<li><a href="../445692/index.html">An overview of the capabilities of PlayCanvas for creating Web VR applications</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>