<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Comparison of the performance of languages ‚Äã‚Äãon the example of the simplest classifier</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, Habr! 


 My main programming language is D. I always understood that it will lose C ++ because of the collector, some high-level buns, etc....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Comparison of the performance of languages ‚Äã‚Äãon the example of the simplest classifier</h1><div class="post__text post__text-html js-mediator-article">  Good day, Habr! <br><br><img src="https://habrastorage.org/files/d80/6c9/61a/d806c961a07d4ebfaeda1dbf56a621fa.png" align="left"><br>  My main programming language is D. I always understood that it will lose C ++ because of the collector, some high-level buns, etc.  But never got around to check how.  I decided to write a simple classifier (I do not even remember the method as it is called) and check.  I was pleasantly surprised by the result: the C ++ version worked in 5.47 seconds, the D version took 5.55 seconds.  ‚Äú0.08 sec when processing a file in 74MB is not so much‚Äù - I thought.  But, just in case, I decided to try to assemble the code on D with the help of gdc (dmd as frontend, gnu backend) and then doubts crept into my heart that I did everything correctly: the code worked in 4.01 seconds, which is more than 20% faster C ++ version.  Decided to build using ldc2 (dmd frontend, llvm backend): 2.92 (!!) seconds.  Then I decided to figure it out. <br><a name="habracut"></a><br>  First of all, I launched valgrind --tool = callgrind for C ++ version.  As you would expect to read a file, it takes most of the time. <br><br><img src="https://habrastorage.org/files/c40/fce/e12/c40fcee1214b47fb807b7b45dbeea0b5.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unfortunately, for the dmd version, valgrind could not work and ended with an error illegal hardware instruction, apparently the guys from DigitalMars conjured up an assembler strongly, but for gdc and ldc2 everything worked as for version C ++. <br><br><img src="https://habrastorage.org/files/2cd/a2d/4cb/2cda2d4cbfb34e87afdfd9a74f1b6ba1.png"><br><br>  Although valgrind does not demangle'it the names of D functions, but there is a small hack: we call through callgrind.out.NNN through <a href="">this</a> tool and get normal names (not all, but most of them).  And <a href="http://habrahabr.ru/post/260151/">I apologize for gdb</a> , version 7.9.1-13.fc22 fully supports demangle D code. <br><br>  I realized that it was too early to rejoice, you need to figure out the execution time of the algorithm itself.  And for that matter, try different variants of the algorithm: <br><ol><li>  minimal - classifiers are created, points in classes are not saved </li><li>  with preservation of points and merging of classes (the initial algorithm with the initial setup produced many classes) </li></ol><br>  A few words about the algorithm: I did not set myself the task of writing a good classifier and setting it up correctly, just a test code. <br>  Results in seconds, in parentheses related to C ++ code: <br><table><tbody><tr><th></th><th>  c ++ g ++ </th><th>  d dmd </th><th>  d gdc </th><th>  d ldc2 </th><th>  rust rustc </th></tr><tr><td>  one </td><td>  0.577 </td><td>  1.797 (3.11) </td><td>  0.999 (1.73) </td><td>  0.583 (1.01) </td><td>  0.546 (0.933) </td></tr><tr><td>  2 </td><td>  0.628 </td><td>  2.272 (3.617) </td><td>  1.217 (1.937) </td><td>  0.898 (1.429) </td><td>  0.52 (0.935) </td></tr></tbody></table><br>  The second variant of the algorithm uses the garbage collector more actively (which I did not set up in any way).  The best result, of course, was ldc2 - one and a half times slower C ++ with active garbage collection, which, in the end, is not so bad.  And it is even very good if you compare the total runtime of the program: 5.4 seconds (taking into account Comrade <a href="https://habrahabr.ru/users/roman_kashitsyn/" class="user_link">roman_kashitsyn</a> 3.4 seconds) for C ++ versus 2.9 seconds for D on ldc2. <br><br>  Naturally, for the purity of the experiment, I did not specifically optimize the code and made it as equivalent as possible. <br><div class="spoiler">  <b class="spoiler_title">D code</b> <div class="spoiler_text"><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.math; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.<span class="hljs-keyword"><span class="hljs-keyword">format</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> std.datetime; //version=COLLECT_MEASURES; //version=MERGE_CLASSES; struct Measure { <span class="hljs-type"><span class="hljs-type">float</span></span> x=<span class="hljs-number"><span class="hljs-number">0</span></span>, y=<span class="hljs-number"><span class="hljs-number">0</span></span>; auto opBinary(string op)( auto <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> const Measure m ) const <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( op == "+" || op == "-" ) { mixin( "return Measure( x " ~ op ~ " mx, y " ~ op ~ " my );" ); } auto opBinary(string op)( <span class="hljs-type"><span class="hljs-type">float</span></span> m ) const <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( op == "*" || op == "/" ) { mixin( "return Measure( x " ~ op ~ " m, y " ~ op ~ " m );" ); } } unittest { auto a = Measure(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>); auto b = Measure(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); auto <span class="hljs-keyword"><span class="hljs-keyword">add</span></span> = a + b; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>.x == <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">add</span></span>.y == <span class="hljs-number"><span class="hljs-number">8</span></span> ); auto dif = a - b; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( dif.x == <span class="hljs-number"><span class="hljs-number">-3</span></span> &amp;&amp; dif.y == <span class="hljs-number"><span class="hljs-number">-2</span></span> ); auto mlt = a * <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( mlt.x == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; mlt.y == <span class="hljs-number"><span class="hljs-number">9</span></span> ); auto div = b / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( div.x == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; div.y == <span class="hljs-number"><span class="hljs-number">2.5</span></span> ); } <span class="hljs-type"><span class="hljs-type">float</span></span> sqr( <span class="hljs-type"><span class="hljs-type">float</span></span> v ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v * v; } <span class="hljs-type"><span class="hljs-type">float</span></span> dist( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> const Measure a, <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> const Measure b ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> sqrt( sqr(ax - bx) + sqr(ay - <span class="hljs-keyword"><span class="hljs-keyword">by</span></span>) ); } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> { Measure mean; size_t N; version(COLLECT_MEASURES) Measure[] measures; this( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Measure m ) { mean = m; N = <span class="hljs-number"><span class="hljs-number">1</span></span>; version(COLLECT_MEASURES) measures ~= m; } <span class="hljs-type"><span class="hljs-type">void</span></span> append( <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> Measure m ) { mean = ( mean * N + m ) / ( N + <span class="hljs-number"><span class="hljs-number">1</span></span> ); N++; version(COLLECT_MEASURES) measures ~= m; } <span class="hljs-type"><span class="hljs-type">void</span></span> merge( const <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> m ) { mean = ( mean * N + m.mean * mN ) / ( N + mN ); N += mN; version(COLLECT_MEASURES) measures ~= m.measures; } } unittest { auto cls = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>( Measure(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( cls.N == <span class="hljs-number"><span class="hljs-number">1</span></span> ); cls.append( Measure(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) ); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">3</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">assert</span></span>( cls.N == <span class="hljs-number"><span class="hljs-number">2</span></span> ); } <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> Classifier { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>[] list; <span class="hljs-type"><span class="hljs-type">float</span></span> ncls_dist; this( <span class="hljs-type"><span class="hljs-type">float</span></span> mdist ) { ncls_dist = mdist; } <span class="hljs-type"><span class="hljs-type">void</span></span> classificate( <span class="hljs-keyword"><span class="hljs-keyword">ref</span></span> const Measure m ) { <span class="hljs-type"><span class="hljs-type">float</span></span> min_dist = <span class="hljs-type"><span class="hljs-type">float</span></span>.max; <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span> near_cls; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( i; list ) { <span class="hljs-type"><span class="hljs-type">float</span></span> d = dist( m, i.mean ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( d &lt; min_dist ) { min_dist = d; near_cls = i; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( min_dist &lt; ncls_dist ) near_cls.append(m); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> list ~= <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>(m); } <span class="hljs-type"><span class="hljs-type">void</span></span> mergeClasses() { <span class="hljs-keyword"><span class="hljs-keyword">Class</span></span>[] uniq; l: <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( cls; list ) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( trg; uniq ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( dist( cls.mean, trg.mean ) &lt; ncls_dist ) { trg.merge( cls ); <span class="hljs-keyword"><span class="hljs-keyword">continue</span></span> l; } uniq ~= cls; } list = uniq; } } Measure[] readMeasuresFromFile( string <span class="hljs-type"><span class="hljs-type">name</span></span> ) { auto file = File( <span class="hljs-type"><span class="hljs-type">name</span></span>, "r" ); Measure[] list; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( <span class="hljs-type"><span class="hljs-type">line</span></span>; file.byLine() ) { Measure tmp; formattedRead( <span class="hljs-type"><span class="hljs-type">line</span></span>, "%f %f", &amp;tmp.x, &amp;tmp.y ); list ~= tmp; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } <span class="hljs-type"><span class="hljs-type">void</span></span> main( string[] args ) { auto measures = readMeasuresFromFile( args[<span class="hljs-number"><span class="hljs-number">1</span></span>] ); StopWatch sw; sw.<span class="hljs-keyword"><span class="hljs-keyword">start</span></span>(); auto clsf = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Classifier(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( m; measures ) clsf.classificate(m); version(MERGE_CLASSES) clsf.mergeClasses(); sw.stop(); writeln( "work time: ", sw.peek.nsecs / <span class="hljs-number"><span class="hljs-number">1</span></span>_000_000_000<span class="hljs-number"><span class="hljs-number">.0</span></span>f ); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>( cls; clsf.list ) writefln( "[%f, %f]: %d", cls.mean.x, cls.mean.y, cls.N ); }</code> </pre> <br></div></div><br><div class="spoiler">  <b class="spoiler_title">Rust Code</b> <div class="spoiler_text"><pre> <code class="rust hljs"><span class="hljs-meta"><span class="hljs-meta">#![feature(duration)]</span></span> <span class="hljs-meta"><span class="hljs-meta">#![feature(duration_span)]</span></span> <span class="hljs-meta"><span class="hljs-meta">#![feature(append)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::ops::*; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::borrow::Borrow; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::cell::RefCell; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::fs::File; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::io::BufReader; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::io::BufRead; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::time::Duration; <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> std::env; <span class="hljs-meta"><span class="hljs-meta">#[derive(Clone,Copy)]</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Measure</span></span></span></span> { x : <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>, y : <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Measure{ <span class="hljs-meta"><span class="hljs-meta">#[allow(non_snake_case)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>(X:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>,Y:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>) -&gt; Measure{ Measure{ x:X, y:Y } } } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Add <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Measure{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Output</span></span></span></span> = Measure; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, rhs:Measure) -&gt; Measure { Measure{ x: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.x + rhs.x, y: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.y + rhs.y, } } } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Sub <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Measure{ <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Output</span></span></span></span> = Measure; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sub</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, rhs: Measure) -&gt; Measure { Measure{ x: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.x - rhs.x, y: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.y - rhs.y } } } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Div&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Measure { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Output</span></span></span></span> = Measure; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">div</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, rhs: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>) -&gt; Measure { Measure{ x: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.x / rhs, y: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.y / rhs } } } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Mul&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> Measure { <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Output</span></span></span></span> = Measure; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mul</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, rhs: <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>) -&gt; Measure { Measure{ x: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.x * rhs, y: <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.y * rhs } } } <span class="hljs-meta"><span class="hljs-meta">#[inline]</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sqr</span></span></span></span>(v:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>)-&gt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> { v * v } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dist</span></span></span><span class="hljs-function"> </span></span>(a: &amp; Measure, b: &amp; Measure) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> { (sqr(ax - bx) + sqr(ay - by)).sqrt() } <span class="hljs-meta"><span class="hljs-meta">#[derive(Clone)]</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Class</span></span></span></span> { mean: Measure, count: <span class="hljs-built_in"><span class="hljs-built_in">usize</span></span>, <span class="hljs-meta"><span class="hljs-meta">#[cfg(collect_measures)]</span></span> measures: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;Measure&gt; } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Class{ <span class="hljs-meta"><span class="hljs-meta">#[cfg(collect_measures)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>( m: Measure ) -&gt; Class { Class{ mean: m, count: <span class="hljs-number"><span class="hljs-number">1</span></span>, measures: <span class="hljs-built_in"><span class="hljs-built_in">vec!</span></span>[m.clone()] } } <span class="hljs-meta"><span class="hljs-meta">#[cfg(not(collect_measures))]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>( m: Measure ) -&gt; Class { Class{ mean: m, count: <span class="hljs-number"><span class="hljs-number">1</span></span>, } } <span class="hljs-meta"><span class="hljs-meta">#[cfg(collect_measures)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, m: Measure){ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean = ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> + m ) /( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count + <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.measures.push(m.clone()); <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-meta"><span class="hljs-meta">#[cfg(not(collect_measures))]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">append</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, m: Measure){ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean = ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> + m ) /( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count + <span class="hljs-number"><span class="hljs-number">1</span></span>)<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count += <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-meta"><span class="hljs-meta">#[cfg(collect_measures)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">merge</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, m: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Class) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean = ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> + ((m.mean) * m.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> )) / ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count + m.count) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count += m.count; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.measures.append(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> m.measures); } <span class="hljs-meta"><span class="hljs-meta">#[cfg(not(collect_measures))]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">merge</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, m: &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> Class) { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean = ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.mean * <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> + ((m.mean) * m.count <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> )) / ( <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count + m.count) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.count += m.count; } } <span class="hljs-meta"><span class="hljs-meta">#[test]</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_Measure</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> a = Measure::new(<span class="hljs-number"><span class="hljs-number">1f32</span></span>,<span class="hljs-number"><span class="hljs-number">3f32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = Measure::new(<span class="hljs-number"><span class="hljs-number">4f32</span></span>,<span class="hljs-number"><span class="hljs-number">5f32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> add = a + b; <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( add.x == <span class="hljs-number"><span class="hljs-number">5f32</span></span> &amp;&amp; add.y == <span class="hljs-number"><span class="hljs-number">8f32</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> dif = a - b; <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( dif.x == -<span class="hljs-number"><span class="hljs-number">3f32</span></span> &amp;&amp; dif.y == -<span class="hljs-number"><span class="hljs-number">2f32</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mlt = &amp;a * <span class="hljs-number"><span class="hljs-number">3f32</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( mlt.x == <span class="hljs-number"><span class="hljs-number">3f32</span></span> &amp;&amp; mlt.y == <span class="hljs-number"><span class="hljs-number">9f32</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> div = &amp;b / <span class="hljs-number"><span class="hljs-number">2f32</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( div.x == <span class="hljs-number"><span class="hljs-number">2f32</span></span> &amp;&amp; div.y == <span class="hljs-number"><span class="hljs-number">2.5f32</span></span> ); } <span class="hljs-meta"><span class="hljs-meta">#[test]</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_Class</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> cls = Class::new( Measure::new(<span class="hljs-number"><span class="hljs-number">1f32</span></span>,<span class="hljs-number"><span class="hljs-number">2f32</span></span>) ); <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">1f32</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">2f32</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( cls.count == <span class="hljs-number"><span class="hljs-number">1</span></span> ); cls.append( Measure::new(<span class="hljs-number"><span class="hljs-number">3f32</span></span>,<span class="hljs-number"><span class="hljs-number">4f32</span></span>) ); <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">2f32</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">3f32</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">assert!</span></span>( cls.count == <span class="hljs-number"><span class="hljs-number">2</span></span> ); } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Classifier</span></span></span></span> { list:<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;RefCell&lt;Class&gt;&gt;, ncls_dist:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">impl</span></span> Classifier{ <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">new</span></span></span></span>(mdist:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>) -&gt; Classifier{ Classifier{ list:<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(), ncls_dist:mdist } } <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">classificate</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>, m: Measure){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> min_dist:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>::MAX; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> near_cls = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> index:<span class="hljs-built_in"><span class="hljs-built_in">usize</span></span> = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.list.iter() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = dist( &amp;m, &amp; i.borrow().mean); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> d &lt; min_dist { min_dist = d; near_cls = index; } index+=<span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> min_dist &lt; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ncls_dist{ <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.list[near_cls].borrow_mut().append(m); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.list.push(RefCell::new( Class::new(m))); } } <span class="hljs-meta"><span class="hljs-meta">#[allow(dead_code)]</span></span> <span class="hljs-keyword"><span class="hljs-keyword">pub</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">merge_classes</span></span></span></span>(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> uniq: <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;RefCell&lt;Class&gt;&gt;= <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> cls <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.list.iter(){ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> is_uniq = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> trg <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> uniq.iter(){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> dist( &amp;cls.borrow().mean, &amp;trg.borrow().mean) &lt; <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.ncls_dist { trg.borrow_mut().merge(&amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> *cls.borrow_mut()); is_uniq = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> is_uniq { uniq.push(RefCell::new(cls.borrow_mut().clone())); } } <span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.list = uniq; } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">read_measures_from_file</span></span></span></span>( name: <span class="hljs-built_in"><span class="hljs-built_in">String</span></span> ) -&gt; <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;Measure&gt; { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> list:<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;Measure&gt; = <span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> f = File::open(name).unwrap(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> reader = BufReader::new(&amp;f); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> ret_string = <span class="hljs-built_in"><span class="hljs-built_in">String</span></span>::new(); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-literal"><span class="hljs-literal">Ok</span></span>(size ) = reader.read_line( &amp;<span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> ret_string){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> size &gt; <span class="hljs-number"><span class="hljs-number">0</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> len = ret_string.len() - <span class="hljs-number"><span class="hljs-number">1</span></span>; ret_string.truncate(len); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> buffer:<span class="hljs-built_in"><span class="hljs-built_in">Vec</span></span>&lt;&amp;<span class="hljs-built_in"><span class="hljs-built_in">str</span></span>&gt; = ret_string.split(<span class="hljs-string"><span class="hljs-string">' '</span></span>).collect(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> var:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = (buffer[<span class="hljs-number"><span class="hljs-number">0</span></span>]).parse::&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt;().unwrap(); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> var2:<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span> = (buffer[<span class="hljs-number"><span class="hljs-number">1</span></span>]).parse::&lt;<span class="hljs-built_in"><span class="hljs-built_in">f32</span></span>&gt;().unwrap(); list.push(Measure::new(var,var2)); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } ret_string.clear(); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fn</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span></span>() { <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> measures = read_measures_from_file(env::args().skip(<span class="hljs-number"><span class="hljs-number">1</span></span>).next().unwrap()); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-keyword"><span class="hljs-keyword">mut</span></span> clsf = Classifier::new(<span class="hljs-number"><span class="hljs-number">3f32</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> d = Duration::span(||{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> measures{ clsf. classificate(i); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">cfg!</span></span>(merge_classes){ clsf.merge_classes(); } }); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"work time: {}"</span></span>, d.secs() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f64</span></span> + d.extra_nanos()<span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">f64</span></span> / <span class="hljs-number"><span class="hljs-number">1000000000.0f64</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> clsf.list{ <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> i = i.borrow(); <span class="hljs-built_in"><span class="hljs-built_in">println!</span></span>(<span class="hljs-string"><span class="hljs-string">"[{}, {}]: {}"</span></span>,i.mean.x,i.mean.y, i.count); } }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">C ++ Code</b> <div class="spoiler_text"><pre> <code class="hljs lua">#include &lt;vector&gt; #include &lt;cmath&gt; #include &lt;cfloat&gt; #include &lt;iostream&gt; #include &lt;fstream&gt; #include &lt;sstream&gt; #include &lt;<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>&gt; #include &lt;cassert&gt; #include &lt;ctime&gt; using namespace std; //#define COLLECT_MEASURES //#define MERGE_CLASSES class Measure { public: float x, y; Measure(): x(<span class="hljs-number"><span class="hljs-number">0</span></span>), y(<span class="hljs-number"><span class="hljs-number">0</span></span>) {} Measure( float X, float Y ): x(X), y(Y) {} Measure( const Measure&amp; m ): x(mx), y(my) {} Measure operator+( const Measure&amp; m ) const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Measure( x + mx, y + my ); } Measure operator-( const Measure&amp; m ) const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Measure( x - mx, y - my ); } Measure operator*( float v ) const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Measure( x * v, y * v ); } Measure operator/( float v ) const { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Measure( x / v, y / v ); } }; void test_Measure() { Measure a(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">3</span></span>); Measure b(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">5</span></span>); auto add = a + b; <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( add.x == <span class="hljs-number"><span class="hljs-number">5</span></span> &amp;&amp; add.y == <span class="hljs-number"><span class="hljs-number">8</span></span> ); auto dif = a - b; <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( dif.x == <span class="hljs-number"><span class="hljs-number">-3</span></span> &amp;&amp; dif.y == <span class="hljs-number"><span class="hljs-number">-2</span></span> ); auto mlt = a * <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( mlt.x == <span class="hljs-number"><span class="hljs-number">3</span></span> &amp;&amp; mlt.y == <span class="hljs-number"><span class="hljs-number">9</span></span> ); auto div = b / <span class="hljs-number"><span class="hljs-number">2</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( div.x == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; div.y == <span class="hljs-number"><span class="hljs-number">2.5</span></span> ); } inline float sqr( float v ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> v * v; } float dist( const Measure&amp; a, const Measure&amp; b ) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>( sqr(ax - bx) + sqr(ay - by) ); } class Class { public: Measure mean; size_t N; #ifdef COLLECT_MEASURES vector&lt;Measure&gt; measures; #endif Class( const Measure&amp; m ): mean(m) { N = <span class="hljs-number"><span class="hljs-number">1</span></span>; #ifdef COLLECT_MEASURES measures.push_back(m); #endif } void append( const Measure&amp; m ) { mean = ( mean * N + m ) / ( N + <span class="hljs-number"><span class="hljs-number">1</span></span> ); N++; #ifdef COLLECT_MEASURES measures.push_back(m); #endif } void merge( const Class&amp; m ) { mean = ( mean * N + m.mean * mN ) / ( N + mN ); N += mN; #ifdef COLLECT_MEASURES measures.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(measures.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(), m.measures.begin(), m.measures.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>()); #endif } }; void test_Class() { auto cls = Class( Measure(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">2</span></span>) ); <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">2</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( cls.N == <span class="hljs-number"><span class="hljs-number">1</span></span> ); cls.append( Measure(<span class="hljs-number"><span class="hljs-number">3</span></span>,<span class="hljs-number"><span class="hljs-number">4</span></span>) ); <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( cls.mean.x == <span class="hljs-number"><span class="hljs-number">2</span></span> &amp;&amp; cls.mean.y == <span class="hljs-number"><span class="hljs-number">3</span></span> ); <span class="hljs-built_in"><span class="hljs-built_in">assert</span></span>( cls.N == <span class="hljs-number"><span class="hljs-number">2</span></span> ); } class Classifier { public: vector&lt;Class*&gt; list; float ncls_dist; Classifier( float mdist ): ncls_dist(mdist) {} void classificate( const Measure&amp; m ) { float min_dist = FLT_MAX; Class* near_cls; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto i = list.begin(); i != list.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++i ) { float d = dist( m, (*i)-&gt;mean ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( d &lt; min_dist ) { min_dist = d; near_cls = *i; } } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( min_dist &lt; ncls_dist ) near_cls-&gt;append(m); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> list.push_back( new Class(m) ); } void mergeClasses() { vector&lt;Class*&gt; uniq; l: <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto cls = list.begin(); cls != list.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++cls ) { bool is_uniq = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto trg = uniq.begin(); trg != uniq.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++trg ) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( dist( (*cls)-&gt;mean, (*trg)-&gt;mean ) &lt; ncls_dist ) { (*trg)-&gt;merge( **cls ); delete (*cls); is_uniq = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !is_uniq ) <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( is_uniq ) uniq.push_back( *cls ); } list = uniq; } ~Classifier() { <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto i = list.begin(); i != list.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++i ) delete *i; } }; vector&lt;Measure&gt; readMeasuresFromFile( <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* name ) { ifstream file( name ); vector&lt;Measure&gt; list; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( <span class="hljs-built_in"><span class="hljs-built_in">string</span></span> line; getline(file, line); ) { istringstream <span class="hljs-keyword"><span class="hljs-keyword">in</span></span>( line ); Measure tmp; <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> &gt;&gt; tmp.x &gt;&gt; tmp.y; list.push_back( tmp ); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> list; } void runTests() { test_Measure(); test_Class(); } int main( int argc, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span>* args[] ) { //runTests(); auto measures = readMeasuresFromFile( args[<span class="hljs-number"><span class="hljs-number">1</span></span>] ); clock_t start = <span class="hljs-built_in"><span class="hljs-built_in">clock</span></span>(); auto clsf = new Classifier(<span class="hljs-number"><span class="hljs-number">3</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto i = measures.begin(); i != measures.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++i ) clsf-&gt;classificate( *i ); #ifdef MERGE_CLASSES clsf-&gt;mergeClasses(); #endif clock_t <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">clock</span></span>(); cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"work time: "</span></span> &lt;&lt; double(<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> - start) / CLOCKS_PER_SEC &lt;&lt; endl; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( auto i = clsf-&gt;list.begin(); i != clsf-&gt;list.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span>(); ++i ) cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"["</span></span> &lt;&lt; (*i)-&gt;mean.x &lt;&lt; <span class="hljs-string"><span class="hljs-string">", "</span></span> &lt;&lt; (*i)-&gt;mean.y &lt;&lt; <span class="hljs-string"><span class="hljs-string">"]: "</span></span> &lt;&lt; (*i)-&gt;N &lt;&lt; endl; delete clsf; }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Sample Generator Code</b> <div class="spoiler_text"><pre> <code class="hljs cpp"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.stdio; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.<span class="hljs-built_in"><span class="hljs-built_in">string</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.exception; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.random; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.math; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">double</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">normal</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> mu=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">0.0</span></span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">double</span></span></span></span><span class="hljs-function"><span class="hljs-params"> sigma=</span></span><span class="hljs-number"><span class="hljs-function"><span class="hljs-params"><span class="hljs-number">1.0</span></span></span></span><span class="hljs-function"><span class="hljs-params"> )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> deviate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> stored; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( !deviate ) { <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> max = cast(<span class="hljs-keyword"><span class="hljs-keyword">double</span></span>)(ulong.max - <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> dist = <span class="hljs-built_in"><span class="hljs-built_in">sqrt</span></span>( <span class="hljs-number"><span class="hljs-number">-2.0</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">log</span></span>( uniform( <span class="hljs-number"><span class="hljs-number">0</span></span>, max ) / max ) ); <span class="hljs-keyword"><span class="hljs-keyword">double</span></span> angle = <span class="hljs-number"><span class="hljs-number">2.0</span></span> * PI * ( uniform( <span class="hljs-number"><span class="hljs-number">0</span></span>, max ) / max ); stored = dist * <span class="hljs-built_in"><span class="hljs-built_in">cos</span></span>( angle ); deviate = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> dist * <span class="hljs-built_in"><span class="hljs-built_in">sin</span></span>( angle ) * sigma + mu; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { deviate = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> stored * sigma + mu; } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">vec</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x, y; } <span class="hljs-function"><span class="hljs-function">vec </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">randomVec</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( in vec m, in vec s )</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> vec( normal(mx, sx), normal(my, sy) ); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">auto</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">generate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">size_t</span></span></span></span><span class="hljs-function"><span class="hljs-params">[vec] classes )</span></span></span><span class="hljs-function"> </span></span>{ vec[] ret; foreach( pnt, count; classes ) { <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> tmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> vec[]( count ); foreach( i, ref t; tmp ) t = randomVec( pnt, vec(<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>) ); ret ~= tmp; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ret; } <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>.getopt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( </span></span><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-params"><span class="hljs-built_in">string</span></span></span></span><span class="hljs-function"><span class="hljs-params">[] args )</span></span></span><span class="hljs-function"> </span></span>{ uint k; getopt( args, <span class="hljs-string"><span class="hljs-string">"count-multiplier|c"</span></span>, &amp;k ); enforce( args.length == <span class="hljs-number"><span class="hljs-number">2</span></span>, format( <span class="hljs-string"><span class="hljs-string">"wrong number of arguments: use %s &lt;output_file&gt;"</span></span>, args[<span class="hljs-number"><span class="hljs-number">0</span></span>] ) ); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> f = File( args[<span class="hljs-number"><span class="hljs-number">1</span></span>], <span class="hljs-string"><span class="hljs-string">"w"</span></span> ); scope(<span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>) f.close(); <span class="hljs-keyword"><span class="hljs-keyword">auto</span></span> vs = generate( [ vec(<span class="hljs-number"><span class="hljs-number">-8</span></span>,<span class="hljs-number"><span class="hljs-number">8</span></span>): <span class="hljs-number"><span class="hljs-number">20</span></span> * k, vec(<span class="hljs-number"><span class="hljs-number">4</span></span>,<span class="hljs-number"><span class="hljs-number">0</span></span>) : <span class="hljs-number"><span class="hljs-number">10</span></span> * k, vec(<span class="hljs-number"><span class="hljs-number">-6</span></span>,<span class="hljs-number"><span class="hljs-number">-8</span></span>) : <span class="hljs-number"><span class="hljs-number">15</span></span> * k ] ); foreach( v; vs.randomSample(vs.length) ) f.writeln( vx, <span class="hljs-string"><span class="hljs-string">" "</span></span>, vy ); }</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Assembly</b> <div class="spoiler_text">  Test 1 <br><pre> <code class="bash hljs">g++ -O2 -std=c++11 cls.cpp -o cls_cpp &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"c++ g++ builded"</span></span> dmd -O -release cls.d -ofcls_d_dmd &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d dmd builded"</span></span> ldc2 -O2 -release cls.d -ofcls_d_ldc2 &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d ldc2 builded"</span></span> gdc -O2 cls.d -o cls_d_gdc &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d gdc builded"</span></span> rustc -O cls.rs -o cls_rs &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"rust rustc builded"</span></span></code> </pre><br>  Test 2 <br><pre> <code class="bash hljs">g++ -O2 -D COLLECT_MEASURES -D MERGE_CLASSES -std=c++11 cls.cpp -o cls_cpp &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"c++ g++ builded"</span></span> dmd -O -version=COLLECT_MEASURES -version=MERGE_CLASSES -release cls.d -ofcls_d_dmd &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d dmd builded"</span></span> ldc2 -O2 -d-version COLLECT_MEASURES -d-version MERGE_CLASSES -release cls.d -ofcls_d_ldc2 &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d ldc2 builded"</span></span> gdc -O2 -fversion=COLLECT_MEASURES -fversion=MERGE_CLASSES cls.d -o cls_d_gdc &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"d gdc builded"</span></span> rustc -O --cfg collect_measures --cfg merge_classes cls.rs -o cls_rs &amp;&amp; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"rust rustc builded"</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Compiler Versions</b> <div class="spoiler_text">  g ++ (GCC) 5.1.1 20150612 (Red Hat 5.1.1-3) <br>  DMD64 D Compiler v2.067.1 <br>  GNU gdb (GDB) Fedora 7.9.1-13.fc22 <br>  LDC - the LLVM D compiler (0.15.2-beta1) <br>  rustc 1.3.0-nightly (cb7d06215 2015-06-26) <br></div></div><br><br>  Ps.  In the languages ‚Äã‚Äãof Rust and Go is not strong, if someone wants to write an equivalent code (for completeness of the experiment) I will be happy to insert the results here. <br><br>  <b>UPD</b> : thanks comrade.  <a href="https://habrahabr.ru/users/i_am_fake/" class="user_link">I_AM_FAKE</a> for the code on Rust </div><p>Source: <a href="https://habr.com/ru/post/261201/">https://habr.com/ru/post/261201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../261189/index.html">Seven iterations of naivety or as I and a half years wrote my debut game</a></li>
<li><a href="../261191/index.html">Targetix - development of full-stack RTB technology</a></li>
<li><a href="../261195/index.html">StepCTF'15: how we performed CTF on Stepic</a></li>
<li><a href="../261197/index.html">ELK + R as log storage 2. Installation and configuration</a></li>
<li><a href="../261199/index.html">Caution, Modern UI</a></li>
<li><a href="../261205/index.html">WebAssembly: the beginning of a new era</a></li>
<li><a href="../261207/index.html">Business Performance Indicator Module (KPI, MTP) based on WordPress</a></li>
<li><a href="../261209/index.html">Plugin for external comments on Habr and other sites</a></li>
<li><a href="../261215/index.html">Mail.Ru for business news</a></li>
<li><a href="../261219/index.html">QoS configuration on VMWare and Cisco USC</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>