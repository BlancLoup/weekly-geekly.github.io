<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Overlaying text and images onto an image using MagickWand and GD libraries</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="MagickWand is one of the libraries that access the ImageMagic software package for working with images in PHP. Consider the features of the overlay te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Overlaying text and images onto an image using MagickWand and GD libraries</h1><div class="post__text post__text-html js-mediator-article">  <b>MagickWand</b> is one of the libraries that access the ImageMagic software package for working with images in PHP.  Consider the features of the overlay text and graphics in it.  ImageMagic is said to be very fast and gives a better quality result (but not as common as GD).  For one check it out. <br><a name="habracut"></a><br>  The general script code will be as follows: <br><br><pre><code class="php hljs">$new_image = NewMagickWand(); <span class="hljs-comment"><span class="hljs-comment">//  MagickWand MagickReadImage($new_image, 'image.png'); //     $w = MagickGetImageWidth($new_image); //   $h = MagickGetImageHeight($new_image); /* ---   --- */ MagickSetImageFormat($new_image, 'jpeg'); MagickWriteImage($new_image, 'newimage.jpeg'); //  // ClearMagickWand($new_image); //       DestroyMagickWand($new_image);</span></span></code> </pre> <br><br>  Now consider the image processing code in more detail.  For example, we will impose a text copyright on the photo.  This can be done in several ways: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. Apply a pre-prepared translucent copyright image using MagickCompositeImage <br><br><pre> <code class="php hljs">$watermark = NewMagickWand(); MagickReadImage($watermark, <span class="hljs-string"><span class="hljs-string">'copyright.png'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//   $wc = MagickGetImageWidth($watermark); $hc = MagickGetImageHeight($watermark); MagickCompositeImage($new_image, $watermark, MW_OverCompositeOp, $w-$wc, $h-$hc); //     ClearMagickWand($watermark); //      DestroyMagickWand($watermark);</span></span></code> </pre><br><br>  2. Apply a pre-prepared translucent copyright image using DrawComposite <br><br><pre> <code class="php hljs">$watermark = NewMagickWand(); MagickReadImage($watermark, <span class="hljs-string"><span class="hljs-string">'copyright.png'</span></span>); $watermark_drawing = NewDrawingWand(); <span class="hljs-comment"><span class="hljs-comment">//  DrawingWand   DrawSetGravity($watermark_drawing, MW_SouthEastGravity); //       DrawComposite($watermark_drawing, MW_OverCompositeOp, 0, 0, 0, 0, $watermark); //    MagickDrawImage($new_image, $watermark_drawing); //     ClearMagickWand($watermark); DestroyMagickWand($watermark); ClearDrawingWand($watermark_drawing); DestroyDrawingWand($watermark_drawing);</span></span></code> </pre><br>  The result of these two methods is the following: <br><br><img src="http://i.minus.com/iittLQt0SpF5B.jpeg" alt="image"><br><br>  Execution time is similar.  In the first case, it jumps from 20 to 400ms.  Take the abstract mean value of 200ms.  In the second case, it practically does not depend on the size of the image and other factors and amounted to 160ms. <br><br>  3. Generate copyright text and apply using MagickAnnotateImage <br><br><pre> <code class="php hljs"><span class="hljs-comment"><span class="hljs-comment">//   $watermark_drawing = NewDrawingWand(); DrawSetFont($watermark_drawing, 'copyright.ttf'); DrawSetFontSize($watermark_drawing, 12); DrawSetGravity($watermark_drawing, MW_NorthWestGravity); //   $pixel_wand = NewPixelWand(); PixelSetColor($pixel_wand, 'black'); PixelSetOpacity($pixel_wand, 0.6); DrawSetFillColor($watermark_drawing, $pixel_wand); //        MagickAnnotateImage($new_image, $watermark_drawing, $w-15, $h-8, -90,' '); ClearDrawingWand($watermark_drawing); DestroyDrawingWand($watermark_drawing);</span></span></code> </pre><br><br>  4. The same, but with DrawAnnotation <br><br><pre> <code class="php hljs">$watermark_drawing = NewDrawingWand(); DrawSetFont($watermark_drawing, <span class="hljs-string"><span class="hljs-string">'copyright.ttf'</span></span>); DrawSetFontSize($watermark_drawing, <span class="hljs-number"><span class="hljs-number">12</span></span>); DrawSetGravity($watermark_drawing, MW_NorthWestGravity); DrawRotate($watermark_drawing, <span class="hljs-number"><span class="hljs-number">-90</span></span>); $pixel_wand = NewPixelWand(); PixelSetColor($pixel_wand, <span class="hljs-string"><span class="hljs-string">'black'</span></span>); PixelSetOpacity($pixel_wand, <span class="hljs-number"><span class="hljs-number">0.6</span></span>); DrawSetFillColor($watermark_drawing, $pixel_wand); DrawAnnotation($watermark_drawing, <span class="hljs-number"><span class="hljs-number">8</span></span>-$h, $w<span class="hljs-number"><span class="hljs-number">-15</span></span>, <span class="hljs-string"><span class="hljs-string">' '</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    . // ,     90¬∞     ¬´¬ª,      MagickDrawImage($new_image, $watermark_drawing); ClearDrawingWand($watermark_drawing); DestroyDrawingWand($watermark_drawing);</span></span></code> </pre><br>  The result of these two methods is the following: <br><br><img src="http://i.minus.com/iuZwPfUmbJgdH.jpeg" alt="image"><br><br>  The inscription is a little clearer, but it rather indicates that Photoshop is too blurry the text in the source file for the first methods. <br><br>  The speed of the methods are identical.  Time jumps much.  For small images is 20ms and reaches 300ms at 2560 √ó 1600.  Take the average value of 150. Again, abstract. <br><br>  Conclusion: To insert a copyright using MagickWand, the best way to do it is with DrawComposite.  It is universal (you can insert not only text) and it works at a predictable time.  The original image for it can be prepared in 3 or 4 ways. <br><br>  <b>GD Graphics Library is</b> likely to be on any server.  It can do the same in it: <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($w, $h) = getimagesize(<span class="hljs-string"><span class="hljs-string">'image.png'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//    $new_image = imagecreatefrompng('image.png'); //   /* ---   --- */ imagejpeg($new_image, 'newimage.jpeg') // imagedestroy($new_image);</span></span></code> </pre><br><br>  1. Using the prepared image <br><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">list</span></span>($cw, $ch) = getimagesize(<span class="hljs-string"><span class="hljs-string">'copyright.png'</span></span>); $watermark = imagecreatefrompng(<span class="hljs-string"><span class="hljs-string">'copyright.png'</span></span>); imagecopy($new_image, $watermark, $w-$cw, $h-$ch, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, $cw, $ch); <span class="hljs-comment"><span class="hljs-comment">//  imagedestroy($watermark); // </span></span></code> </pre><br><br><img src="http://i.minus.com/iEF5tT8mewVhq.jpeg" alt="image"><br><br>  2. Text Generation by GD <br><br><pre> <code class="php hljs">$color = imagecolorallocatealpha($new_image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">60</span></span>); <span class="hljs-comment"><span class="hljs-comment">//     60% imagettftext($new_image, 10, 90, $w-7, $h-12, $color, 'copyright.ttf', ' '); //       </span></span></code> </pre><br><br><img src="http://i.minus.com/i6kLaVEqyV9y3.jpeg" alt="image"><br><br>  The operation time in the first case was from 0.2 to 0.7 ms, depending on the image size, in the second - 30% longer. <br><br>  Frankly, he was surprised when he saw that GD works almost 1000 times faster.  True, it was the image processing algorithm that measured, without opening, saving and converting to another format.  Also did not take into account the amount of memory occupied, so the data are not very suitable for practical use.  Measuring the performance of entire functions with different file types has shown that GD runs up to 10 times faster on small files.  The most common sizes (3‚Äì8 megapixels) of the library are processed at the same speed (valid only for my hosting).  MagickWand (ImageMagic) is loved for the best quality scaling.  Again, this is true only for complex photos.  Clear MW Contours Blur Too Much <br><br><img src="http://i.minus.com/i75JZhOQNrvOQ.png" alt="image"><img src="http://i.minus.com/ibwqPx0eyYFl24.png" alt="image"><br><br>  Interestingly, the weight of such a png-image (right) turned out to be 1.2 KB against 6 KB in GD.  And all from the fact that GD did not guess to change the palette to 8-bit. <br><br>  So check the speed on your hosting (I tested at McHhost), choose the quality based on your needs and then give preference to one or another library, or rather throw a coin ;-) <br><br><h5>  Bonus </h5>  <b>A little about the quality settings</b> <br><br>  In MagickWand, quality settings are set before saving. <br><br><pre> <code class="php hljs">MagickSetImageCompressionQuality($new_image, $quality); MagickSetImageFormat($new_image, <span class="hljs-string"><span class="hljs-string">'jpeg'</span></span>); MagickWriteImage($new_image, <span class="hljs-string"><span class="hljs-string">'newimage.jpeg'</span></span>); <span class="hljs-comment"><span class="hljs-comment">// </span></span></code> </pre><br>  Here $ quality compression ratio is from 0‚Äì100 for jpeg and 0‚Äì80 for png.  Does not affect gif. <br>  for jpeg: <br>  0, null - default compression ~ 85 <br>  1..100 - gradation from terrible quality to perfect <br><br>  for png, since this is a format without loss of quality, only affects the weight of the image and, accordingly, the time it is processed by the server: <br>  0, null - the default compression is the highest (in this case, the image weight is minimal) <br>  1..80 - gradation from low to high degree of compression (but the greatest compression is at 0) <br><br>  Even in MagickWand, you can specify the type of compression, but in the case of jpeg, png, gif, it does not affect anything. <br>  <s>MagickSetImageCompression ($ image, MW_JPEGCompression);</s> <br><br>  In GD, quality is set in save functions. <br><br><pre> <code class="php hljs">imagejpeg($new_image, <span class="hljs-string"><span class="hljs-string">'newimage.jpeg'</span></span>, $quality) imagepng($new_image, <span class="hljs-string"><span class="hljs-string">'newimage.png'</span></span>, $quality) imagegif($new_image, <span class="hljs-string"><span class="hljs-string">'newimage.gif'</span></span>) <span class="hljs-comment"><span class="hljs-comment">//gif   </span></span></code> </pre><br>  Here $ quality compression ratio is from 0‚Äì100 for jpeg and 0‚Äì9 for png. <br>  For jpeg: <br>  null - default compression 75 <br>  0..100 - gradation from terrible quality to perfect.  Almost the same as MagickWand <br><br>  for png: <br>  null - default compression 0 (bad compression) <br>  0..9 - gradation from low to high degree of compression.  With a value of 9, the weight of the picture is approximately the same as with 0 in MagickWand </div><p>Source: <a href="https://habr.com/ru/post/159209/">https://habr.com/ru/post/159209/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../159189/index.html">How do you set element styles if you do not use ‚Äúforeign‚Äù libraries</a></li>
<li><a href="../159193/index.html">Voluntary limits for cloud servers</a></li>
<li><a href="../159199/index.html">How do you feel about open source software?</a></li>
<li><a href="../159201/index.html">NODE.JS + Windows: look inside</a></li>
<li><a href="../159203/index.html">Configure Nginx + LAMP server at home. Part 1: Configuring the frontend - backend</a></li>
<li><a href="../159215/index.html">How many portable computer devices do you have (smartphones, tablets, laptops)?</a></li>
<li><a href="../159217/index.html">Phalcon - Compiled PHP MVC Framework</a></li>
<li><a href="../159219/index.html">Knock and open you: smartphones will learn to recognize fingers, nails and knuckles</a></li>
<li><a href="../159223/index.html">Running ServerClub USA</a></li>
<li><a href="../159225/index.html">Start OpenSource Project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>