<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>$ mol_time - working with dates and time correctly</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello, my name is Dmitry Karlovsky and I ... are very old. The years are not the same to easily understand the intricacies of tricky interfaces. I wan...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>$ mol_time - working with dates and time correctly</h1><div class="post__text post__text-html js-mediator-article">  Hello, my name is Dmitry Karlovsky and I ... are very old.  The years are not the same to easily understand the intricacies of tricky interfaces.  I want something relatively simple, but also powerful enough not to feel like a cripple, who barely writes the simplest program. <br><br>  In any application, sooner or later there is a need to work with time: parse, somehow modify, calculate something, serialize.  Date and time are quite complex things that adapt to the solar, lunar and terrestrial cycles at the same time.  Moreover, there may be a different number of days in a year, and a different number of hours in a day, even <a href="http://habrahabr.ru/post/146109/">in a minute, not always 60 seconds</a> .  Because of this, working with time requires a heightened accuracy from the programmer and anyway <a href="http://habrahabr.ru/post/239423/">bugs will emerge for a very long time</a> . <br><br>  No, I am too old to consider years as milliseconds - soon my age will amount to billions of seconds already.  It's time to take advantage of something higher.  The fact that our ancestors called the standard <a href="https://en.wikipedia.org/wiki/ISO_8601">ISO8601</a> , but many still do not know what it is and through what place it should be used. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Then you will learn how I got rid of hemorrhoids by changing the city minivan to a sports bike :-) <br><a name="habracut"></a><br>  In any JS engine there is a standard api for working with time - Date.  Let its name not mislead you: Date objects are not dates, but the most time stamps (moments) measured in milliseconds from the beginning <a href="https://ru.wikipedia.org/wiki/UNIX-%25D0%25B2%25D1%2580%25D0%25B5%25D0%25BC%25D1%258F">of the UNIX epoch</a> .  The API provides an object interface that allows you to get various information for the moment: from the time components (year, month, day, hour, minute, second) to the day of the week corresponding to it.  Unfortunately, this information is available either for local time or for UTC.  If you need other time zones, then I have bad news for you - Date can only parse the iso8601 line like "2015-07-20T00: 22: 32 + 01: 00", get a timestamp from it and happily forget about time zones as about a terrible dream.  Well, damn it with him, if not for a couple of nuances: <br><br>  1. Sometimes the time zone matters.  For example, when you write a server application that must understand when the client has morning, and when it is evening, when it is yesterday, and when it is tomorrow.  That is, you need the opportunity to complete work with any time zone. <br><br>  2. Sometimes the time zone only interferes.  For example, when you draw a calendar and operate with dates regardless of time, the intervention of time zones <a href="http://habrahabr.ru/post/240301/">can easily spoil your blood</a> .  That is, you need the opportunity not to specify certain components of time, if they are not necessary. <br><br>  In ISO8601, if you write "2015-07-20", then this is July 20 in any time zone.  The moments of the beginning and end of this day in different time zones will nevertheless be different.  If you use ‚Äúnew Date ('2015-07-20') ', then you will receive a time stamp of the beginning of this date in UTC:‚Äú 2015-07-20T00: 00: 00.000Z ‚Äù, and if you write the seemingly equivalent code‚Äú new Date (2015, 06, 20) ", the result will be" 2015-07-19T21: 00: 00.000Z ".  Date developed spontaneously, like all api in javascript, so you should not be surprised at such a <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">variety</a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date">many ways to do the same thing, but a little differently, as well as a bunch of useless methods</a> . <br><br>  The popular <a href="http://momentjs.com/">MomentJS</a> library tries to solve the messy interface problem while doubling the number of methods you will never use.  No, well, really, why would anyone in a sober mind and healthy memory use <a href="http://momentjs.com/docs/">ASP.NET JSON Date of the</a> form "/ Date (1198908717056-0700) /"?  And despite the fact that it implements a lot of necessary things that are not present in the native Date at all, it still has the same kind of trauma, as it is just a wrapper over the native api, which provides only a time stamp abstraction.  So ‚Äúmoment ('2015-07-20')‚Äù will return the label ‚Äú2015-07-19T21: 00: 00.000Z‚Äù with all the problems arising from this. <br><br>  Another birth injury common to both api is object mutability.  If you are going to somehow change the object, then you must remember to clone it, otherwise somewhere in the other end of the application you may suddenly have everything broken. <br><br>  But the saddest thing is that MomentJS without plug-ins weighs as much as 100 kilobytes and at the same time <a href="https://github.com/eigenmethod/mol/tree/master/time/moment">slows down as a twin dangling at near-light speed</a> , not even looking at <a href="">fifty-fold acceleration</a> : <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-number"><span class="hljs-number">0</span></span> &lt; m.year() &amp;&amp; m.year() &lt;= <span class="hljs-number"><span class="hljs-number">9999</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">'function'</span></span> === <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Date</span></span>.prototype.toISOString) { <span class="hljs-comment"><span class="hljs-comment">// native implementation is ~50x faster, use it when we can return this.toDate().toISOString(); } else { return formatMoment(m, 'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]'); } } else { return formatMoment(m, 'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]'); }</span></span></code> </pre> <br>  Well, do you feel a burning sensation just below your back?  Then proceed to the treatment. <br><br>  First of all, you should decide how to store data inside.  Date can be specified with time and without.  Time can be specified with or without offset.  Both the date and the time can be indicated both in full and cropped form (year-month, for example, or hour-minute).  That is, any component of time may be missing if its value does not make sense.  To code July 2015, we need only two components: a year, a month, and nothing else.  That is, it makes sense to store components in separate fields, which will slightly increase memory consumption, but on the other hand will have a beneficial effect on the speed of work. <br><br>  Further, it is worthwhile to properly understand the <a href="https://en.wikipedia.org/wiki/ISO_8601">format iso8601</a> .  After all, there is no need to reinvent the wheel, when there is a good standard which already provides a lot.  In particular, it allows you to describe time points with different accuracy (from milliseconds to years), time durations in various units of measurement (from seconds to years), time intervals in various forms (start-end, start-duration, end-duration) and even repeated intervals (but they are not very suitable, unfortunately). <br><br>  Now we are ready to write the <a href="https://github.com/eigenmethod/mol/tree/master/time">$ mol_time</a> library, which provides 3 functions that create objects corresponding to their names: <a href="https://github.com/eigenmethod/mol/tree/master/time/moment">$ mol_time_moment</a> , <a href="https://github.com/eigenmethod/mol/tree/master/time/duration"></a>  <a href="https://github.com/eigenmethod/mol/tree/master/time/interval">$ mol_time_duration, interval</a> .  Each of them is capable of accepting parameters for construction in various JSON views: as an iso8601 string or as a configuration object of the form {name_component: value_component}.  In addition, moments can be created from native Date objects and timestamps, and durations from among the milliseconds. <br><br>  To illustrate, let's calculate how many years I have already turned. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">Math</span></span>.floor( <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $mol_time_interval( <span class="hljs-string"><span class="hljs-string">'1984-08-04/'</span></span> ).duration.count( <span class="hljs-string"><span class="hljs-string">'P1Y'</span></span> ) )</code> </pre><br><br>  Let's complicate the task: what day of the week will it be when I hit a billion seconds? <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $mol_time_moment( <span class="hljs-string"><span class="hljs-string">'1984-08-04'</span></span> ).shift({ <span class="hljs-attr"><span class="hljs-attr">second</span></span> : <span class="hljs-number"><span class="hljs-number">1e9</span></span> }).toString( <span class="hljs-string"><span class="hljs-string">'WeekDay'</span></span> )</code> </pre><br>  What time is it in Japan? <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $mol_time_moment().toOffset( <span class="hljs-string"><span class="hljs-string">'+09:00'</span></span> ).toString( <span class="hljs-string"><span class="hljs-string">'hh:mm'</span></span> )</code> </pre><br>  And let's print all the days of the week in the current month in order: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> $mol_time_moment().merge({ <span class="hljs-attr"><span class="hljs-attr">day</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> , <span class="hljs-attr"><span class="hljs-attr">hour</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> , <span class="hljs-attr"><span class="hljs-attr">minute</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> , <span class="hljs-attr"><span class="hljs-attr">second</span></span> : <span class="hljs-number"><span class="hljs-number">0</span></span> }) <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> end = current.shift( <span class="hljs-string"><span class="hljs-string">'P1M'</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">while</span></span>( current &lt; end ) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( current.toString( <span class="hljs-string"><span class="hljs-string">'DD - WD'</span></span> ).toLowerCase() ) current = current.shift( <span class="hljs-string"><span class="hljs-string">'P1D'</span></span> ) }</code> </pre><br>  Further, I will probably leave you with the <a href="https://github.com/eigenmethod/mol/tree/master/time">documentation on $ mol_time</a> and will look forward to harsh criticism, because since I started using this library, I had pretty gray hair on my head, the skin on it became smooth and silky, and without hemorrhoids life has become even a little boring :-) </div><p>Source: <a href="https://habr.com/ru/post/263041/">https://habr.com/ru/post/263041/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263025/index.html">Pro model, logic, OOP, development and the rest</a></li>
<li><a href="../263027/index.html">The principle of separation of responsibility and ORM</a></li>
<li><a href="../263031/index.html">How to make the browser cache not as useless as usual</a></li>
<li><a href="../263033/index.html">Forget about DAO, use the Repository</a></li>
<li><a href="../263035/index.html">How to design and write a full program</a></li>
<li><a href="../263043/index.html">Open Source Virtualization: Report on Innovations and Approaches to Virtualization of Corporate Infrastructure</a></li>
<li><a href="../263045/index.html">What did antivirus think about in the past?</a></li>
<li><a href="../263047/index.html">A selection of current and useful materials on Ruby # 1: articles, reports, podcasts, gems</a></li>
<li><a href="../263051/index.html">Federal Business Intensive Development Program GenerationS has selected IBM Cloud to create an online platform</a></li>
<li><a href="../263053/index.html">How to organize distributed database design?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>