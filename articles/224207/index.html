<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Implementing a quick import from Excel to PHP</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="We continue to talk about the technologies used in our email-marketing service Pechkin-mail.ru . One of the key tasks of any service related to custom...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Implementing a quick import from Excel to PHP</h1><div class="post__text post__text-html js-mediator-article">  We continue to talk about the technologies used in our <a href="http://pechkin-mail.ru/">email-marketing service Pechkin-mail.ru</a> .  One of the key tasks of any service related to customer data is to download this data to the service.  For Pechkin, it is very important to quickly and easily download the address databases containing email addresses, first names, last names and other additional data. <br><img src="https://habrastorage.org/getpro/habr/post_images/436/074/132/436074132316c50f7fa3e000d50458ee.jpg" align="right"><br><h4>  What to use as a tool? </h4><br>  We used Microsoft Excel as the base standard used when importing address databases.  This is explained simply: <br><ul><li>  This is a standard tool that at the basic level is owned by 100% of computer users.  Moreover, in business, it is a de facto corporate standard and is used even if on working Mac or Linux computers. </li><li>  Virtually all CRM, CMS, cloud or desktop systems are exported to Excel or CSV, which is simply converted to XLS or XLSX format. </li><li>  It is also known that ‚Äú90% of software errors are half a meter from the monitor‚Äù.  No offense will be told to ordinary users, but we must take into account the most basic level of training and those.  support for an explanation is enough to say ‚ÄúDownload an Excel file‚Äù and not to explain the procedure for preparing the file in the correct format. </li></ul><br><br>  The problem of users when importing address databases was removed.  But there is already a problem directly developing. <br><a name="habracut"></a><br><br><h4>  Our pain as developers </h4><br>  <b>Excel</b> is not an open-source development, but a proprietary solution.  The data format, especially in newer versions after 2007 (xlsx), is non-trivial.  PHP is used at Pechkin, so we began searching for libraries that will allow us to solve this problem.  But here we encountered the problem that a number of libraries do not allow reading xlsx: <br><ul><li>  <b>php-spreadsheetreader</b> reads a variety of formats (.xls, .ods AND .csv) </li><li>  <b>PHP-ExcelReader</b> (xls only) </li><li>  <b>PHP_Excel_Reader</b> (xls only) </li><li>  <b>PHP_Excel_Reader2</b> (xls only) </li><li>  <b>Xls file reader</b> commercial and xls only </li><li>  <b>SimpleXLSX</b> From the description is able to read xlsx, however, the author refers only to xls </li><li>  <b>PHP Excel Explorer</b> Commercial and xls only </li></ul>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The <a href="http://www.codeplex.com/PHPExcel">PHPExcel</a> library attracted our attention.  We used it several years ago in the <a href="http://sms24x7.ru/">SMS24X7.ru sms-mailing service</a> .  Petya Sokolov ( <a href="https://habrahabr.ru/users/petr_sokolov/" class="user_link">Petr_Sokolov</a> ), our talented developer, wrote a wrapper for this library, correcting a number of its flaws and bugs. <br><br>  The library is certainly interesting and developed.  But for Pechkin, it became impossible to use it in a couple of years, when both we and our customers grew up - its disastrous demands on resources and the huge time of parsing files.  For example, there are frequent cases of loading on the service of address databases&gt; 100,000 lines with a complex structure.  And if the file is already 500,000 lines and ‚Äúweighs‚Äù more than 30MB? <br><br><h4>  And then we let go ... </h4><br>  In the process of searching, we stumbled upon the <a href="http://libxl.com/">libxl</a> commercial library, seeing the <a href="http://stackoverflow.com/questions/18570936/libxl-with-php-excel-read-performance">results of the</a> ‚Äúhandicraft benchmark‚Äù at Stackoverflow. <br><br>  The library is written in C ++, and thanks to the excellent object-oriented extension for PHP from <a href="http://ilia.ws/archives/222-PHP-Excel-Extension.html">Ilia Alshanetsky</a> , it is easy to learn and integrate (for example, it took about 3 hours to rewrite our current solution from PHPExcel to LibXL).  What is very cool, considering that, unfortunately, there is no documentation from the developer, and it is necessary to use the Reflection extension. <br><br>  The installation process is very simple. <br><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /usr/<span class="hljs-built_in"><span class="hljs-built_in">local</span></span>/src/ wget http://libxl.com/download/libxl.tar.gz tar zxfv libxl.tar.gz <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> libxl-3.5.4.1/ ln -s include_c include <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ../ wget https://github.com/iliaal/php_excel/archive/master.zip unzip master.zip <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> php_excel-master/ ./configure --with-excel --with-libxl-libdir=../libxl-3.5.4.1/lib64 --with-libxl-incdir=../libxl-3.5.4.1/include_c make make <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> make install</code> </pre> <br><br>  As a result of the compilation, you will receive the excel.so file in the / usr / lib / php5 / 20090626 / folder.  Now it‚Äôs enough to create the file /etc/php5/conf.d/excel.ini with the contents. <br><pre> <code class="bash hljs">extension=excel.so</code> </pre> <br><br>  Check whether the module is installed and restart the web server. <br><pre> <code class="bash hljs">php -m | grep excel service lighttpd restart</code> </pre><br><br>  In the code, everything is also very simple.  You load the file and read the necessary cells.  For example, like this: <br><pre> <code class="php hljs">$doc = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ExcelBook(); $doc-&gt;loadFile(<span class="hljs-string"><span class="hljs-string">'example.xls'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($r=$sheet-&gt;firstRow();$r&lt;=$sheet-&gt;lastRow();$r++){ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>($c=$sheet-&gt; firstCol();$c&lt;=$sheet-&gt; lastCol();$c++){ <span class="hljs-keyword"><span class="hljs-keyword">echo</span></span> <span class="hljs-string"><span class="hljs-string">': '</span></span>.$r.<span class="hljs-string"><span class="hljs-string">' : '</span></span>.$c.<span class="hljs-string"><span class="hljs-string">' : '</span></span>.$sheet-&gt;read($r,$c).<span class="hljs-string"><span class="hljs-string">'&lt;br /&gt;'</span></span>; } }</code> </pre><br><br><h4>  Performance Results </h4><br>  The absence of the need for RAM (in the process of downloading the file and reading it) was pleasantly pleased. <br><img src="https://habrastorage.org/getpro/habr/post_images/06c/bbe/1e4/06cbbe1e4598038cb5b16350059aa079.png"><br><br>  And here is the increase in the speed of downloading the excel file and its reading on various sizes of address bases. <br><img src="https://habrastorage.org/getpro/habr/post_images/c54/915/9db/c549159dbbee487c12bef0eb5eaa0ae0.png"><br><br>  These tests were carried out on xlsx files with N subscribers in one hundred hundred with email.  The real address bases are even bigger and more complex and the advantage in speed and memory consumption looks even more significant. <br><br>  The cost of the library is $ 199 for a developer license, but believe me, it's worth it.  Of course, we recommend to anyone who is faced with the problem of importing Excel files into their service. </div><p>Source: <a href="https://habr.com/ru/post/224207/">https://habr.com/ru/post/224207/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224193/index.html">Through hardship to the stars. To the imperatives of cosmic colonialism</a></li>
<li><a href="../224195/index.html">Writing a Simple SailsJS Blog: Visual Practice for Beginners (Part 1)</a></li>
<li><a href="../224197/index.html">Sunduk or 10 seconds per name</a></li>
<li><a href="../224199/index.html">RESTful API on Yii framework with RBAC and tests</a></li>
<li><a href="../224205/index.html">When AES (‚ò¢) = ‚ò† - cryptobinary focus</a></li>
<li><a href="../224209/index.html">InterSystems Ensemble 2014 Integration Platform Release</a></li>
<li><a href="../224217/index.html">Announcement - Artem Gavrichenkov from Qrator will tell in Moscow about DDoS attacks</a></li>
<li><a href="../224221/index.html">Learning through lectures is inefficient, scientists say</a></li>
<li><a href="../224223/index.html">[libGDX] Writing a full game for Android. Part 2</a></li>
<li><a href="../224227/index.html">One source and two components of video surveillance</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>