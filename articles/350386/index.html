<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Java 8 and Strategy pattern</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Potentially possible continuation of the book Design Patterns (Elizabeth Freeman and others) . 

 In the yard in 2017. A young student, Martin, joined...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Java 8 and Strategy pattern</h1><div class="post__text post__text-html js-mediator-article">  Potentially possible continuation of the book <a href="https://www.ozon.ru/context/detail/id/20216992/">Design Patterns (Elizabeth Freeman and others)</a> . <br><br>  In the yard in 2017.  A young student, Martin, joined the company where senior developer Joe works.  For a whole year, he carefully studied Java using a modern textbook with an emphasis on functional interfaces, lambda expressions and other innovations. <br><a name="habracut"></a><br>  Joe wondered if Martin knows the design patterns.  Martin did not know, did not know at all.  And Joe understood how he would be practicing Martin.  He will give him the tasks that, in his opinion, without design patterns, will have difficult-to-support solutions.  When Martin writes the application, Joe will first torment him with the expansion of the architecture, and then show him how easy it is to expand it, if the design is initially based on wonderful patterns.  However, he decided to immediately warn Martin about the directions of expansion: what if he himself could accidentally implement design patterns without knowing them?  Young people are very creative. <br><br>  <b>Joe:</b> Listen, Martin, you have a responsible job.  You need to write a prototype of a duck pond simulator.  Create models of ducks, they can quack, fly, swim and do other activities.  Instead of actions, use stubs that display text messages to the console.  Bear in mind that ducks can be of different types, including rubber ducks, wooden, newspaper, hand ducks, ducks with ducklings.  This means that not all species of ducks can, in principle, quack or fly or swim or perform other actions.  Some ducks may eventually acquire new features, or lose them.  Consider that you have to maintain this application for a long time, and the authorities will invent all new types of ducks. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Martin silently set to work. <br><br>  Hm  There are many different types of ducks.  Ducks of different species have different skill sets.  These sets can dynamically change over time, decrease or increase in quantity, be replaced with other ones of the same type.  It would be great to keep duck skills, that is, behavior, that is, functions, in some variables.  This can help lambda expressions.  For example, you can save the behavior as follows: <br><br><pre><code class="java hljs">Runnable fly = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">" "</span></span>);</code> </pre> <br>  And then do it like this: <br><br><pre> <code class="java hljs">fly.run();</code> </pre> <br>  Since we saved the behavior in a variable, it can always be replaced with any other behavior, even dynamically during the lifetime of the object, not to mention inheritance.  And since the number of behaviors can also change, you can not get your variable for each action, but save them in a dynamically changing data structure.  For example, in Set.  Or, better, in Map &lt;T, U&gt;, specifying a text identifier of behavior as a key, otherwise we will not be able to distinguish this behavior from others.  It is probably worth creating your own class for storing and manipulating behaviors and embedding its object in a duck base class field.  Let's start with it: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> patterns.and.lambdas.ducks; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.concurrent.ConcurrentSkipListMap; <span class="hljs-comment"><span class="hljs-comment">/** *    . * * </span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@param</span></span></span><span class="hljs-comment"> &lt;T&gt; *   : Runnable, Callable&lt;V&gt;, Supplier&lt;T&gt;, BooleanSupplier, * Consumer&lt;T&gt;, BiConsumer&lt;T,U&gt;, Predicate&lt;T&gt;, BiPredicate&lt;T,U&gt;, Function&lt;T,R&gt;, * BiFunction&lt;T,U,R&gt;, UnaryOperator&lt;T&gt;, BinaryOperator&lt;T&gt;,    * {</span><span class="hljs-doctag"><span class="hljs-comment"><span class="hljs-doctag">@link</span></span></span><span class="hljs-comment"> java.util.function}       . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BehaviorRegistry</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">T</span></span></span><span class="hljs-class">&gt; </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ConcurrentSkipListMap&lt;String, T&gt; map = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ConcurrentSkipListMap&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">add</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T behaveFunc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertContainsNameNot(behaveName); BehaviorRegistry.assertArgNotNull(behaveFunc); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.put(behaveName, behaveFunc); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contains</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ BehaviorRegistry.assertArgNotNull(behaveName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertMapNotNull(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.containsKey(behaveName) &amp;&amp; (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.get(behaveName) != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> T </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">get</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertContainsName(behaveName); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.get(behaveName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">replace</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> T behaveFunc)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertContainsName(behaveName); BehaviorRegistry.assertArgNotNull(behaveFunc); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.put(behaveName, behaveFunc); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">remove</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertContainsName(behaveName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map.remove(behaveName); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertArgNotNull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Object arg)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((arg <span class="hljs-keyword"><span class="hljs-keyword">instanceof</span></span> String) &amp;&amp; !<span class="hljs-string"><span class="hljs-string">""</span></span>.equals(arg)) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (arg != <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">" ."</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertContainsName</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ BehaviorRegistry.assertArgNotNull(behaveName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertMapNotNull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contains(behaveName)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">" \""</span></span> + behaveName + <span class="hljs-string"><span class="hljs-string">"\"  ."</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertContainsNameNot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ BehaviorRegistry.assertArgNotNull(behaveName); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.assertMapNotNull(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.contains(behaveName)) { <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">" \""</span></span> + behaveName + <span class="hljs-string"><span class="hljs-string">"\"  ."</span></span>); } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">protected</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">assertMapNotNull</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.map == <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> RuntimeException(<span class="hljs-string"><span class="hljs-string">" map."</span></span>); } }</code> </pre> <br>  We will not implement the ability launch method in the BehaviorRegistry class, since this class is generalized, so we do not know which functional interface underlies its specific instance, which means we don‚Äôt know the name of the performing function: run (), call (), accept ( ), test (), apply (), etc., and do not know the number and types of arguments for these functions, and what these functions return. <br><br>  Now use it in the Duck class: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> patterns.and.lambdas.ducks; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Duck</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> BehaviorRegistry&lt;Runnable&gt; behaviors = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> BehaviorRegistry&lt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">perform</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String behaveName)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.behaviors.get(behaveName).run(); } <span class="hljs-comment"><span class="hljs-comment">/** *           . */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">performAll</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.behaviors.map.descendingKeySet().forEach(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>::perform); System.out.println(<span class="hljs-string"><span class="hljs-string">"----------------------------------------------"</span></span>); } }&lt;/nobr&gt;</code> </pre> <br>  Basically, that's all.  Even inheritance and class hierarchy is not needed.  We will simply create Duck objects and, in the behaviors field, save as many different behaviors as needed, and then execute them when necessary.  This is the architecture: <br><br><img src="https://habrastorage.org/webt/rj/bn/9z/rjbn9zztc1-3wlkntio7z1g_xio.png"><br><br>  There is not a single rectangle in the diagram for any behavior, since in this architecture the duck's behavior is the same anonymous value, as the number 6 is an anonymous value for the int number variable.  The architecture does not care what it does and how the behavior is arranged, so long as it satisfies the Runnable functional interface, just as the int number variable doesn‚Äôt matter what number is stored in it, so long as it is integer. <br><br>  It will be easier to operate the architecture if you prepend a reference book of some behaviors in the form of enum: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> patterns.and.lambdas.ducks; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.function.BiConsumer; <span class="hljs-comment"><span class="hljs-comment">/** *    . */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">enum</span></span> EBehaviors { Display(<span class="hljs-string"><span class="hljs-string">""</span></span>, () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">" "</span></span>)), Fly(<span class="hljs-string"><span class="hljs-string">""</span></span>, () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">" "</span></span>)), Sleep(<span class="hljs-string"><span class="hljs-string">""</span></span>, () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"Zzzz"</span></span>)), Quack(<span class="hljs-string"><span class="hljs-string">""</span></span>, () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"--"</span></span>)), Propagate(<span class="hljs-string"><span class="hljs-string">""</span></span>, () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"O_o"</span></span>)); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> String name; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> Runnable func; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">EBehaviors</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String m_name, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Runnable m_func)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name = m_name; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.func = m_func; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BiConsumer&lt;String, Runnable&gt; someApiFunction)</span></span></span><span class="hljs-function"> </span></span>{ someApiFunction.accept(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.func); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">sendTo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> BiConsumer&lt;String, Runnable&gt; someApiFunction, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> Runnable m_func)</span></span></span><span class="hljs-function"> </span></span>{ someApiFunction.accept(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.name, m_func); } }</code> </pre> <br>  Now you can safely begin a specific operation: <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> patterns.and.lambdas.ducks; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> java.util.stream.Stream; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> patterns.and.lambdas.ducks.Duck; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> patterns.and.lambdas.ducks.EBehaviors; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">final</span></span></span></span><span class="hljs-function"><span class="hljs-params"> String[] args)</span></span></span><span class="hljs-function"> </span></span>{ Runnable behaviorFunc = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck mallardDuck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duck(); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">" "</span></span>); EBehaviors.Display.sendTo(mallardDuck.behaviors::add, behaviorFunc); EBehaviors.Fly.sendTo(mallardDuck.behaviors::add); EBehaviors.Quack.sendTo(mallardDuck.behaviors::add); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck redheadDuck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duck(); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); EBehaviors.Display.sendTo(redheadDuck.behaviors::add, behaviorFunc); EBehaviors.Fly.sendTo(redheadDuck.behaviors::add); EBehaviors.Quack.sendTo(redheadDuck.behaviors::add); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck rubberDuck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duck(); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); EBehaviors.Display.sendTo(rubberDuck.behaviors::add, behaviorFunc); EBehaviors.Quack.sendTo(rubberDuck.behaviors::add); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck decoyDuck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duck(); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); EBehaviors.Display.sendTo(decoyDuck.behaviors::add, behaviorFunc); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck exclusiveDuck = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Duck(); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"  "</span></span>); EBehaviors.Display.sendTo(exclusiveDuck.behaviors::add, behaviorFunc); behaviorFunc = () -&gt; System.out.println(<span class="hljs-string"><span class="hljs-string">"   &lt;==  "</span></span>); exclusiveDuck.behaviors.add(<span class="hljs-string"><span class="hljs-string">" "</span></span>, behaviorFunc); <span class="hljs-keyword"><span class="hljs-keyword">final</span></span> Duck[] ducks = { mallardDuck, redheadDuck, rubberDuck, decoyDuck, exclusiveDuck }; <span class="hljs-comment"><span class="hljs-comment">//    . System.out.println("############################################## 1"); Stream.of(ducks).forEachOrdered(Duck::performAll); //      . System.out.println("############################################## 2"); behaviorFunc = () -&gt; System.out.println("! &lt;==   RunTime"); EBehaviors.Display.sendTo(redheadDuck.behaviors::replace, behaviorFunc); redheadDuck.performAll(); //      . System.out.println("############################################## 3"); EBehaviors.Propagate.sendTo(mallardDuck.behaviors::add); EBehaviors.Sleep.sendTo(mallardDuck.behaviors::add); mallardDuck.behaviors.map.forEach((name, func) -&gt; { final Runnable newFunc = () -&gt; { func.run(); System.out.println(" ^^^^^ "); }; mallardDuck.behaviors.replace(name, newFunc); }); mallardDuck.performAll(); //       ,     . System.out.println("############################################## 4"); for (final Duck duck : ducks) { Stream.of(EBehaviors.values()).map(val -&gt; val.name).filter(duck.behaviors::contains) .forEach(duck.behaviors::remove); } Stream.of(ducks).forEachOrdered(Duck::performAll); } }</span></span></code> </pre> <br>  And here is the result: <br><br><pre>  ############################################## one
 I mallard
 I fly
 Quack quack quack
 ----------------------------------------------
 I'm a red headed duck
 I fly
 Quack quack quack
 ----------------------------------------------
 I'm a rubber duck
 Quack quack quack
 ----------------------------------------------
 I'm a wooden duck
 ----------------------------------------------
 I am an exclusive duck
 I spew flame &lt;== exclusive behavior
 ----------------------------------------------
 ############################################## 2
 Kriyaaaaaaaa!  &lt;== replaced in Runtime
 I fly
 Quack quack quack
 ----------------------------------------------
 ############################################## 3
 Zzzz
    ^^^^^ aftermath
 O_o
    ^^^^^ aftermath
 I mallard
    ^^^^^ aftermath
 I fly
    ^^^^^ aftermath
 Quack quack quack
    ^^^^^ aftermath
 ----------------------------------------------
 ############################################## four
 ----------------------------------------------
 ----------------------------------------------
 ----------------------------------------------
 ----------------------------------------------
 I spew flame &lt;== exclusive behavior
 ---------------------------------------------- </pre><br><br>  Martin gives Joe a job ... <br><br>  <b>Joe:</b> What is this?  Is this an application architecture?  Only two rectangles with one link in the diagram.  When I made my version of the program, there were twelve rectangles on my diagram at the very beginning, when ducks could only quack and fly, and they became more than three hundred in six months, when the authorities came up with fifty different aspects of behavior, and for each aspect several different implementations !  I separated the changing from the constant, and created for each group in the architecture its own hierarchy to achieve flexibility and eliminate duplication of code.  And you, I see, the changing is generally brought out beyond the limits of architecture, in the area of ‚Äã‚Äãanonymous and indefinite, you left only the constant in it.  However, your application is at least as flexible and extensible as mine.  And I don‚Äôt see duplication of code very much, except that while creating a mallard and a red-headed duck, the same addition of the ability to quack and fly could be put into a separate method, but these are trifles.  I think you will be expanding this application very quickly, so I have more work for you to do.  How about creating weather monitors for a weather station?  I just received the technical requirements. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/b9/az/u5/b9azu5jr5y-4pgph5gzldk2eyfk.png" width="500"></div></div><p>Source: <a href="https://habr.com/ru/post/350386/">https://habr.com/ru/post/350386/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../350374/index.html">Why I left Google and started working for myself</a></li>
<li><a href="../350378/index.html">ITSM chatbots: what it is and why they are needed</a></li>
<li><a href="../350380/index.html">FastTrack Training. "Network Basics". "Basics of a wireless LAN". Part one. Eddie Martin December 2012</a></li>
<li><a href="../350382/index.html">Testing Services API and RSpec</a></li>
<li><a href="../350384/index.html">Selection: 12 services to protect against DDoS-attacks</a></li>
<li><a href="../350388/index.html">Examining DB and DBMS with T-SQL</a></li>
<li><a href="../350390/index.html">Proper bookmarking: how to work more efficiently and memorize more</a></li>
<li><a href="../350392/index.html">Cuckoo 2.0. We collect the best open source platform for analyzing malicious files</a></li>
<li><a href="../350394/index.html">Network Device Detection</a></li>
<li><a href="../350396/index.html">Implement fast 2D shadows in Unity using 1D shadow mapping</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>