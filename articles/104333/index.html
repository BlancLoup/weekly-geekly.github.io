<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Deleting a digital signature of a PE file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="For signing PE files (exe, dll, sys and others), in most cases, the signtool.exe utility is used, but which utility should be used if the digital sign...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Deleting a digital signature of a PE file</h1><div class="post__text post__text-html js-mediator-article">  For signing PE files (exe, dll, sys and others), in most cases, the signtool.exe utility is used, but which utility should be used if the digital signature needs to be removed from the file?  And there is no such utility officially.  You can only sign or re-sign (put your signature on top of the existing one), but not delete it.  What to do if you need to correct the file in the Hex or PE editor and do not want to leave the file with a deliberately damaged digital signature? <a name="habracut"></a><br><br><h4>  What is it for </h4><ul><li>  If you need to change the signed file, for example, correct the errors in it or localize it.  After any change of the file, the digital signature becomes damaged and invalid, so it is better to remove it completely than to leave it in this form. </li><li>  Learn more about the mechanism of signing files and understand its work. </li></ul>  The article describes a method of manual removal of a digital signature, simple enough that anyone who has used a Hex editor at least once in their life can understand it. <br><habracut><br><h4>  Instruments </h4><br>  To work we need the following utilities: <br>  1. Hex editor.  I prefer <a href="http://x-ways.net/winhex">winhex</a> . <br>  2. Utility to correct the checksum of the PE file <a href="">ModifyPE</a> . <br>  3. Hex calculator is in the system. <br><br><h4>  Example </h4><br>  For example, we will delete the digital signature from the distribution kit of a wonderful open and free program for encrypting <a href="http://diskcryptor.net/wiki/Downloads">DiskCryptor</a> disk partitions (the object is selected randomly).  By the way of this example, it will be seen that deleting a digital signature does not affect the performance of PE files in any way. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Open dcrypt_setup.exe in a Hex editor and look for a 4-byte sequence of 50450000h (in the text you can see it as PE followed by two zero bytes).  This signature identifies the file as a PE format file and immediately follows the MS-DOS header.  In this case, the beginning of the signature is at an offset of 100h: <br><br><img src="https://habrastorage.org/storage/f2a02f4b/d8f48ba6/8dda6219/814cd8c8.png"><br><br>  The next thing you need to fix after removing the digital signature is the checksum of the file.  It is located 58h bytes after the PE-format signature, that is, 100h + 58h = 158h, hence the current checksum (dword type, that is, 4 bytes) of this file is 9F36Ch (bytes are flipped): <br><br><img src="https://habrastorage.org/storage/7df8ed97/f437ae7f/6f56fcc8/f0eb8a32.png"><br><br>  The following two values ‚Äã‚Äãrefer directly to the digital signature.  If they consist of zeros - no signature.  The first is located 40h bytes after the start of the checksum, or 98h bytes after the beginning of the signature - 100h + 98h = 198h: <br><br><img src="https://habrastorage.org/storage/1ef47959/f957cc12/56e78b43/372ec5b2.png"><br><br>  This 4-byte value means the offset at which the beginning of the digital signature is located.  Now it is 8E438h: <br><br><img src="https://habrastorage.org/storage/15b1c6d6/02e63b89/bdeb3b3c/92a89495.png"><br><br>  The second, again 4-byte value, is immediately after the first: <br><br><img src="https://habrastorage.org/storage/5b64d673/1eea55d8/7cee51c9/c141cd49.png"><br><br>  It means the size of the digital signature, which in this case is equal to 1500h or 5376 bytes.  So the end of the signature will be at offset 8E438h + 1500h = 8F938h.  As a rule, a digital signature goes to the end of the file, check: <br><br><img src="https://habrastorage.org/storage/ceb2c67a/4496fa45/2b2b27cc/348a8b28.png"><br><br>  Everything coincides, so this block can be safely removed, after which the end of the file will be 8E437h: <br><br><img src="https://habrastorage.org/storage/7e139fdf/d931bf6d/3d9a039e/a064af00.png"><br><br>  Only a little remains - to wipe with zeroes the offsets and the size of the digital signature: <br><br><img src="https://habrastorage.org/storage/29fc9158/f29c3f0f/13897175/f717a145.png"><br><br>  And adjust the checksum using the ModifyPE utility: <br><br><img src="https://habrastorage.org/storage/a1b3c04a/c4febfe7/2d771079/91445847.png"><br><br>  Checking: <br><br><img src="https://habrastorage.org/storage/f0e7b336/e2722120/e8d0ef75/270006b5.png"><br><br>  Done!  Now the installation package of the program is exactly as it was before the signature, bytes per byte. <br><br>  PS Do not judge strictly, this is the first time, in the future the quality will increase.  Constructive criticism is welcome. <br><br>  PPS The author of the topic is a beginner <a href="http://habrahabr.ru/users/systracer/" class="user_link">systracer</a> habrauser, who asked me to publish his text.  Pluses should be addressed to him, leave me the minuses. </habracut></div><p>Source: <a href="https://habr.com/ru/post/104333/">https://habr.com/ru/post/104333/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../104325/index.html">Cheap SMS for interesting projects and good people</a></li>
<li><a href="../104327/index.html">Conference Patterns & Practices Summit - a look from the other side</a></li>
<li><a href="../104328/index.html">Office 2010 for $ 200 or 280?</a></li>
<li><a href="../104330/index.html">64-bit flash player preview release for all platforms released</a></li>
<li><a href="../104332/index.html">Winners 10k Apart</a></li>
<li><a href="../104334/index.html">Novell is being sold in parts</a></li>
<li><a href="../104340/index.html">Mobile data client virtualization</a></li>
<li><a href="../104342/index.html">Highly available, fault-tolerant web application on Apache2 and MySQL</a></li>
<li><a href="../104345/index.html">Logitech High Definition Portable Web Eye</a></li>
<li><a href="../104348/index.html">Most harmful helpful advice of the month</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>