<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Unity3d Tank Tutorial: Undercarriage (Lesson 1. Basics of vehicle mechanics)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 So you are no longer new to Unity, you can create a scene, arrange objects on the stage, create terrain, make prefabs, etc. ... and mos...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Unity3d Tank Tutorial: Undercarriage (Lesson 1. Basics of vehicle mechanics)</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/a6/e9/a6e94ec81fd5264001ac051a1efa853f.jpg" alt="image"><br><br><h4>  Introduction </h4><br>  So you are no longer new to Unity, you can create a scene, arrange objects on the stage, create terrain, make prefabs, etc. ... and most importantly, work with scripts, or you have already studied the articles: <a href="http://habrahabr.ru/blogs/gdev/112287/">Unity3D for beginners - Tutorial 1</a> and <a href="http://habrahabr.ru/blogs/gdev/113859/">Unity3d script basics</a> .  All this knowledge will be useful to you because in this lesson we will move much further. <br><br>  Namely: in the first part of this lesson you will learn what Wheel Collider is, how to drive a vehicle with it and create realistic car suspension behavior, in the second part of the lesson, on the basis of all this I will show how to make a tank undercarriage with appropriate physics and controllers . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Actually, what you see on the image above (this will be the result of this lesson) you can try out "live" <a href="https://dl.dropbox.com/u/23068733/TankDemo/index.xhtml">directly in the browser</a> .  Want to do it yourself?  Then welcome under the cat <br><a name="habracut"></a><br>  Before you start talking about the basics of modeling the mechanics of a car at Unity, I can not help but note that the official website already has lessons on this topic, for example, <a href="http://unity3d.com/support/resources/tutorials/car-tutorial">here</a> .  However, throughout all of this, only indications are given on which script to attach to which object and only rarely explain something useful, in the third part of the lesson they finally explain how the main script works, although in my opinion it should have been done in the very first part, and to begin To explain from the moment wheel colliders work and how they interact with a rigidbody, I finally concluded that this lesson is not designed for newbies in Unity and I want to fix it. <br><br>  But if you already know what Wheel Collider is and what it is eaten with, then you can skip this lesson. <br><br><h4>  1. Create a "car" </h4><br>  To begin, do the standard procedures, create a scene, create a terrain, or use ready-made ones, then create an empty Game Object (GO), (GameObject-&gt; Create Empty), let's call it something original, for example Car. <br><br>  Then create a cube (GameObject-&gt; Create Other -&gt; Cube) apply some standard material to it to make it more visible.  Imagine that this is the body of our car, and stretch it with Scale in width and length so that the front of this body looks along the Z axis (the blue axis, it is officially considered to be the front in the Unity world) then drag our Cube onto the Car object in the tab Hierarchy so that it becomes a child of Car.  Let's go to the Car object itself and add Rigidbody (Component -&gt; Physics -&gt; Rigidbody) to it.  Assign him the appropriate weight, about 1500 kg., The car body is ready. <br><img src="https://habrastorage.org/storage/habraeffect/e0/7e/e07e82aa2687b9022cdc4af572c88d67.jpg" alt="image"><br><br>  In addition to the car body, there should be wheels, now create a cylinder (GameObject-&gt; Create Other -&gt; Cylinder), use the same Scale, give it a wheel appearance, then turn it on the Z axis 90 degrees (important! Only on the Z axis! ). <br><img src="https://habrastorage.org/storage/habraeffect/40/8c/408c3eb6c811e8d410de56924b486641.jpg" alt="image"><br>  Rename our newly created cylinder to Wheel Forward Left, set the wheel to its place, that is, to the front and left of our cube (I repeat, the positive part of the Z axis is considered to be in Unity). <br><img src="https://habrastorage.org/storage/habraeffect/5b/88/5b8818b9c9048319480b4e5b801bbadb.jpg" alt="image"><br>  Drag Wheel Forward Left to Car.  Assign the wheel texture in more detail to better see the rotation of the wheel.  Now let's copy our wheel (with the Right button on the Wheel Forward Left and Duplicate), call the Wheel Back Left and put it in its rightful place, by analogy act with the other two wheels. <br><img src="https://habrastorage.org/storage/habraeffect/11/80/1180fd95065ce0ec1bdea92a6eb16fa0.jpg" alt="image"><br><br><img src="https://habrastorage.org/storage/habraeffect/6c/d6/6cd69d6997b5ed4d94e9152ef06a0d79.jpg" alt="image"><br><br>  So, our supercar is almost ready!  Lift it a little above the surface of the terrain and press Play, the car will fall to the ground and get a stake on the wheels, he can only dream of a soft suspension, get out of Play mode.  As you can see, our wheels have a component called <a href="http://unity3d.com/support/documentation/Components/class-CapsuleCollider.html">Capsule Collider</a> , and the <a href="http://unity3d.com/support/documentation/Components/class-BoxCollider.html">Box Collider</a> body, I will not tell you in this lesson what collisions are and how to calculate the object's position in space based on them, I will explain it more simply: if the object has any simple colliders (Box, Capsule, Mesh, ...) then this object can interact with other objects containing Rigidbody and one or more colliders, in turn, the object containing Rigidbody will calculate its position based on collisions of all the colliders subordinate to it and their designated physical m  materials. <br><br>  If you do not understand anything from the above, do not bother, understanding will come with practice. <br><br>  In the meantime, select each of our wheels and remove the Capsule Collider (with the Right button on it and Remove Component).  Press Play, now the car is no longer on wheels, they have passed through the terrain and now only the body interacts with the surface. <br><br><h4>  2. Add Wheel Colliders </h4><br>  So what is this mysterious <a href="http://unity3d.com/support/documentation/Components/class-WheelCollider.html">Wheel Collider</a> ?  Let's figure it out.  Create an empty GameObject, name it WCollider Forward Left, now add the Wheel Collider component (Component -&gt; Physics -&gt; Wheel Collider) to it, it looks like a circle with a segment inside, it may be too big or too small compared to your wheel, everything depends on how much you get involved in using scale.  Fortunately, he has the Radius parameter, changing this parameter to fit it to the radius of his wheel, then create a new prefab (Assets -&gt; Create -&gt; Prefab) call it WCollider, then drag WCollider Forward Left to the prefab.  We created a prefab for convenience, since the colliders will have the same number of wheels, and in order not to change the parameters of each, we will change the parameters of the prefab, the other colliders will inherit its properties.  Now we do the standard procedure, drag the WCollider Forward Left onto the Car object and place it in the center of the front left wheel, duplicate it 3 times and rename it to move it according to the other wheels. <br><img src="https://habrastorage.org/storage/habraeffect/b7/d4/b7d4d27c9462dbed5c7393c7ca284bad.jpg" alt="image"><br><br><img src="https://habrastorage.org/storage/habraeffect/8a/4b/8a4bfd1f42963602b7371280b373f135.jpg" alt="image"><br><br>  Press Play, the car will fall and get back on the wheels (by the way, if the wheels still pass through the terrain, this means that the car falls to the ground at a very high speed, and you just need to reduce the distance to the ground, or increase the Drag parameter of Rigidbody).  As you can see, the result is not much different from where Capsule Colliders were on our wheels, everything is correct, because we did not set any parameters to our Wheel Colliders. <br><br>  So, exit Game Mode, select our WCollider prefab, go and change the properties of the Wheel Collider component: <br><ol><li>  Suspension Distanse - in fact, this is the length of the spring of our suspension, set 0.15 </li><li>  Suspension Spring -&gt; Spring - stiffness of the suspension, the greater the weight of our Rigidbody, the greater must be the rigidity, we put 9000 </li><li>  Suspension Spring -&gt; Damper - Suspension softener, greater value makes the spring move more slowly, set 100 </li><li>  Mass - the mass of the wheel, leave 1 </li><li>  Forward Friction - ‚Äúfront‚Äù friction force of the wheel, leave as it is </li><li>  Sideways Friction - ‚Äúlateral‚Äù friction force of the wheel, useful if you want to realize a car drift, leave it as it is </li></ol>  Total we got: <br>  (Do not look at the radius, you may have another one, the main thing is that the circle coincides with your wheel) <br><img src="https://habrastorage.org/storage/habraeffect/41/68/4168e91b2f150d18454fb14850ddcc40.jpg" alt="image"><br><br>  So, click Play now, look, our car behaves now quite differently, now it springs from the surface of the terrain, and if you put it on the slope of some kind of roller coaster, it will roll off of it, that's how Wheel Colliders work with us. <br><br>  But that's not all they can do, let's find out how to drive a car with them and make our wheels spin and react to landscape irregularities.  Begin to script! <br><br><h4>  3. Manage Wheel Colliders </h4><br>  In this tutorial, I‚Äôll write scripts in C #, forgive me, JavaScript, I‚Äôm used to it, I think you will figure it out. <br><br>  Create a new C # script (Assets -&gt; Create -&gt; C Sharp Script), call it CarController, open and write the following: <br><br><pre><code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CarController : MonoBehaviour { //<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColForward; //<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColBack; //<span class="hljs-number"><span class="hljs-number">3</span></span> // Use this <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> initialization <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> () { //<span class="hljs-number"><span class="hljs-number">4</span></span> } <span class="hljs-type"><span class="hljs-type">void</span></span> FixedUpdate () { //<span class="hljs-number"><span class="hljs-number">5</span></span> } }</code> </pre> <br><ol><li>  The main class of the script must be named exactly the same as the script file, otherwise the compiler will generate an error. </li><li>  An array of front colliders. </li><li>  Array of rear colliders. </li><li>  We will use the Start () function for initialization. </li><li>  As in the <a href="http://habrahabr.ru/blogs/gdev/113859/">Unity3d script basics</a> lesson, I said that for physical interaction with objects it is better to use the FixedUpdate () function than the Update () function. </li></ol>  Then drag the script to the Car object, as you can see in the inspector, we have two fields in the script, in fact, these are arrays that we declared, we need to drag our colliders into them as follows. <br><img src="https://habrastorage.org/storage/habraeffect/5d/f6/5df6d921a0175c95ed9d1dd7397c3299.jpg" alt="image"><br><br>  Next we work with our colliders, we supplement the script: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CarController : MonoBehaviour { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColForward; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColBack; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxSteer = <span class="hljs-number"><span class="hljs-number">30</span></span>; //<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxAccel = <span class="hljs-number"><span class="hljs-number">25</span></span>; //<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxBrake = <span class="hljs-number"><span class="hljs-number">50</span></span>; //<span class="hljs-number"><span class="hljs-number">3</span></span> // Use this <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> initialization <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> () { } <span class="hljs-type"><span class="hljs-type">void</span></span> FixedUpdate () { <span class="hljs-type"><span class="hljs-type">float</span></span> accel = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> steer = <span class="hljs-number"><span class="hljs-number">0</span></span>; accel = <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetAxis("Vertical"); //<span class="hljs-number"><span class="hljs-number">4</span></span> steer = <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetAxis("Horizontal"); //<span class="hljs-number"><span class="hljs-number">4</span></span> CarMove(accel,steer); //<span class="hljs-number"><span class="hljs-number">5</span></span> } private <span class="hljs-type"><span class="hljs-type">void</span></span> CarMove(<span class="hljs-type"><span class="hljs-type">float</span></span> accel,<span class="hljs-type"><span class="hljs-type">float</span></span> steer){ //<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColForward){ //<span class="hljs-number"><span class="hljs-number">6</span></span> col.steerAngle = steer*maxSteer; //<span class="hljs-number"><span class="hljs-number">6</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(accel == <span class="hljs-number"><span class="hljs-number">0</span></span>){ //<span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColBack){ //<span class="hljs-number"><span class="hljs-number">7</span></span> col.brakeTorque = maxBrake; //<span class="hljs-number"><span class="hljs-number">7</span></span> } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ //<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColBack){ //<span class="hljs-number"><span class="hljs-number">8</span></span> col.brakeTorque = <span class="hljs-number"><span class="hljs-number">0</span></span>; //<span class="hljs-number"><span class="hljs-number">8</span></span> col.motorTorque = accel*maxAccel; //<span class="hljs-number"><span class="hljs-number">8</span></span> } } } }</code> </pre><br>  Now you can press Play, and using the buttons W, S or the forward and backward arrows, move our ‚Äúformula one‚Äù in motion, and with the buttons A, D, or the left arrows - to the right, rotate. <br><br>  Let's see what this script does: <br><ol><li>  The maximum angle of rotation of the wheels. </li><li>  Maximum torque transmitted to the wheel. </li><li>  Maximum braking torque. </li><li>  The <a href="http://unity3d.com/support/documentation/ScriptReference/Input.html">Input</a> class <a href="http://unity3d.com/support/documentation/ScriptReference/Input.GetAxis.html">GetAxis ()</a> function waits for an event that occurs when we press the movement keys on the controller, or we move the stick of the joystick, the function takes the direction of the virtual axis (for example, ‚ÄúVertical‚Äù is the W, S keys, or the forward movement of the joystick is backward) and returns a number from -1 to 1, where -1 is backward or leftward movement (S key in ‚ÄúVertical‚Äù axis, D in ‚ÄúHorizontal‚Äù) 0 - axes are not active and 1 - forward movement, or right (W key in ‚Äú Vertical "axis, A in" Horizontal ", or the movement of the stick of the joystick to the left - right). </li><li>  Passing the results obtained from the virtual axes to the CarMove () function. </li><li>  For each <a href="http://unity3d.com/support/documentation/ScriptReference/WheelCollider.html">Wheel Collider</a> located in the WColForward array, we change the steerAngle variable, (wheel rotation angle) by multiplying it by the value obtained from the horizontal axis. </li><li>  If we have a vertical axis in a resting position (that is, if we do not press on the W or S keys), then we change the variable of the collider brakeTorque, which is responsible for the braking force, this is necessary so that the car does not move by inertia if we do not press the movement keys. </li><li>  In other cases, (if we press the W or S keys) reset the braking force, and then change the motorTorque variable (wheel torque) by multiplying it by the value obtained from the vertical axis, as a result of which our car begins to accelerate. </li></ol><br>  That's it, just isn't it?  It remains to correct minor defects, firstly, if you try to turn around at high speed, the car will roll on its side, this is due to the fact that the rigidbody calculates the center of gravity of our car based on all the colliders attached to it, secondly, our wheels are still not spinning and do not respond to uneven terrain. <br><br>  Let's do everything in order. <br><br><h4>  4. Center of gravity </h4><br>  It is surprisingly simple, first we need to create an empty GO, call it Center of mass, then drag it onto the Car object, and place it approximately where you think it should be, for example so that my car does not roll over when turning at high speed I had to do it like this: <br><br><img src="https://habrastorage.org/storage/habraeffect/26/36/2636e6c9874da6fb6f2f7e18e84f4a38.jpg" alt="image"><br><br><img src="https://habrastorage.org/storage/habraeffect/d2/12/d212e12a609c007e739f94d9a9097937.jpg" alt="image"><br><br>  You can have it differently, it all depends on the Box Collider‚Äôs geometrical dimensions of our body, so experiment with the center of gravity, but first, complete our script: <br><ol><li>  Declare a variable: public Transform COM. </li><li>  Drag the GO Center of mass onto the COM field in the script. </li><li>  Inside the Start () function, write the following line: rigidbody.centerOfMass = COM.localPosition </li></ol><br>  Now you can click Play and check the result. <br><br><h4>  5. ‚ÄúLiven up‚Äù wheels </h4><br>  Well, we got to the final, in my opinion the most interesting in this lesson and at the same time quite a complex topic. <br><br>  In order to revive the wheel, we need to calculate the position and angle of its rotation in each fixed frame, this will again help us a wonderful WheelCollider, its method <a href="http://unity3d.com/support/documentation/ScriptReference/WheelCollider.GetGroundHit.html">GetGroundHit ()</a> , which is able to return the <a href="http://unity3d.com/support/documentation/ScriptReference/WheelHit.html">WheelHit</a> structure, which in turn contains the contact point of the collider and terrane ( variable point).  Thanks to the GetGroundHit () method, we can calculate the wheel position based on the motion of the suspension spring.  As for the angle of rotation, this is quite simple, in WheelCollider there is a float variable <a href="http://unity3d.com/support/documentation/ScriptReference/WheelCollider-rpm.html">rpm</a> , an abbreviation of rotation per minute, based on which we can determine the angle of rotation of the wheel. <br><br>  Moving on to the script itself, it has grown, has grown stout, and now it looks like this: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> UnityEngine; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Collections; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> CarController : MonoBehaviour { <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColForward; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider[] WColBack; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span>[] wheelsF; //<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span>[] wheelsB; //<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> wheelOffset = <span class="hljs-number"><span class="hljs-number">0.1</span></span>f; //<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> wheelRadius = <span class="hljs-number"><span class="hljs-number">0.13</span></span>f; //<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxSteer = <span class="hljs-number"><span class="hljs-number">30</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxAccel = <span class="hljs-number"><span class="hljs-number">25</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> maxBrake = <span class="hljs-number"><span class="hljs-number">50</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span> COM; <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> WheelData{ //<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span> wheelTransform; //<span class="hljs-number"><span class="hljs-number">4</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> WheelCollider col; //<span class="hljs-number"><span class="hljs-number">5</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> Vector3 wheelStartPos; //<span class="hljs-number"><span class="hljs-number">6</span></span> <span class="hljs-built_in"><span class="hljs-built_in">public</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> rotation = <span class="hljs-number"><span class="hljs-number">0.0</span></span>f; //<span class="hljs-number"><span class="hljs-number">7</span></span> } protected WheelData[] wheels; //<span class="hljs-number"><span class="hljs-number">8</span></span> // Use this <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> initialization <span class="hljs-type"><span class="hljs-type">void</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> () { rigidbody.centerOfMass = COM.localPosition; wheels = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WheelData[WColForward.Length+WColBack.Length]; //<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;WColForward.Length; i++){ //<span class="hljs-number"><span class="hljs-number">9</span></span> wheels[i] = SetupWheels(wheelsF[i],WColForward[i]); //<span class="hljs-number"><span class="hljs-number">9</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-type"><span class="hljs-type">int</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt;WColBack.Length; i++){ //<span class="hljs-number"><span class="hljs-number">9</span></span> wheels[i+WColForward.Length] = SetupWheels(wheelsB[i],WColBack[i]); //<span class="hljs-number"><span class="hljs-number">9</span></span> } } private WheelData SetupWheels(<span class="hljs-keyword"><span class="hljs-keyword">Transform</span></span> wheel, WheelCollider col){ //<span class="hljs-number"><span class="hljs-number">10</span></span> WheelData result = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> WheelData(); result.wheelTransform = wheel; //<span class="hljs-number"><span class="hljs-number">10</span></span> result.col = col; //<span class="hljs-number"><span class="hljs-number">10</span></span> result.wheelStartPos = wheel.<span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.localPosition; //<span class="hljs-number"><span class="hljs-number">10</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result; //<span class="hljs-number"><span class="hljs-number">10</span></span> } <span class="hljs-type"><span class="hljs-type">void</span></span> FixedUpdate () { <span class="hljs-type"><span class="hljs-type">float</span></span> accel = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-type"><span class="hljs-type">float</span></span> steer = <span class="hljs-number"><span class="hljs-number">0</span></span>; accel = <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetAxis("Vertical"); steer = <span class="hljs-keyword"><span class="hljs-keyword">Input</span></span>.GetAxis("Horizontal"); CarMove(accel,steer); UpdateWheels(); //<span class="hljs-number"><span class="hljs-number">11</span></span> } private <span class="hljs-type"><span class="hljs-type">void</span></span> UpdateWheels(){ //<span class="hljs-number"><span class="hljs-number">11</span></span> <span class="hljs-type"><span class="hljs-type">float</span></span> delta = <span class="hljs-type"><span class="hljs-type">Time</span></span>.fixedDeltaTime; //<span class="hljs-number"><span class="hljs-number">12</span></span> <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (WheelData w <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> wheels){ //<span class="hljs-number"><span class="hljs-number">13</span></span> WheelHit hit; //<span class="hljs-number"><span class="hljs-number">14</span></span> Vector3 lp = w.wheelTransform.localPosition; //<span class="hljs-number"><span class="hljs-number">15</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(w.col.GetGroundHit(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> hit)){ //<span class="hljs-number"><span class="hljs-number">16</span></span> lp.y -= Vector3.Dot(w.wheelTransform.position - hit.point, <span class="hljs-keyword"><span class="hljs-keyword">transform</span></span>.up) - wheelRadius; //<span class="hljs-number"><span class="hljs-number">17</span></span> }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ //<span class="hljs-number"><span class="hljs-number">18</span></span> lp.y = w.wheelStartPos.y - wheelOffset; //<span class="hljs-number"><span class="hljs-number">18</span></span> } w.wheelTransform.localPosition = lp; //<span class="hljs-number"><span class="hljs-number">19</span></span> w.rotation = Mathf.Repeat(w.rotation + delta * w.col.rpm * <span class="hljs-number"><span class="hljs-number">360.0</span></span>f / <span class="hljs-number"><span class="hljs-number">60.0</span></span>f, <span class="hljs-number"><span class="hljs-number">360.0</span></span>f); //<span class="hljs-number"><span class="hljs-number">20</span></span> w.wheelTransform.localRotation = Quaternion.Euler(w.rotation, w.col.steerAngle, <span class="hljs-number"><span class="hljs-number">90.0</span></span>f); //<span class="hljs-number"><span class="hljs-number">21</span></span> } } private <span class="hljs-type"><span class="hljs-type">void</span></span> CarMove(<span class="hljs-type"><span class="hljs-type">float</span></span> accel,<span class="hljs-type"><span class="hljs-type">float</span></span> steer){ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColForward){ col.steerAngle = steer*maxSteer; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(accel == <span class="hljs-number"><span class="hljs-number">0</span></span>){ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColBack){ col.brakeTorque = maxBrake; } }<span class="hljs-keyword"><span class="hljs-keyword">else</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span>(WheelCollider col <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> WColBack){ col.brakeTorque = <span class="hljs-number"><span class="hljs-number">0</span></span>; col.motorTorque = accel*maxAccel; } } } }</code> </pre><br><br>  Copy it, paste it into your script, then in the hierarchy tab select our Car object, as you can see in the inspector we have new variables and arrays in the script, we need to pass the front and rear wheels to the wheelsF and wheelsB arrays, respectively (wheels and not Wheel Colliers!) How to do it click Play.  If the wheels go under the terrain then change the value of the wheelRadius variable, it should roughly match the radius of your colliders. <br><br>  So a miracle must happen, your wheels will now rotate and react to uneven terrain just like real ones. <br><br><img src="http://habrastorage.org/storage/habraeffect/fd/e4/fde484cd46d52ec3914955856bed5a7a.jpg" alt="image"><br><br>  If they are spinning along the wrong axis, or in the other direction, then you should read paragraph 1 where we created the car, I said there that it‚Äôs important to turn the wheels exactly Z axis 90 degrees, then I will tell you why.  Let's analyze the script: <br><ol><li>  Create arrays that will store the Transform of our wheels. </li><li>  These variables will be useful to us, below I will explain for what. </li><li>  Let's create a class that will contain the information we need about each of our wheels, namely: </li><li>  Transform wheels; </li><li>  Wheel Collider Wheels; </li><li>  The starting position of the wheel; </li><li>  Angle of rotation of the wheel. </li><li>  We declare an array of wheels with the type WheelData. </li><li>  We pass the data we need to the wheels array, for this I wrote the SetupWheels () function. </li><li>  The SetupWheels () function takes a Transform wheel and its WheelCollider, passes the data we need to the variables contained in the WheelData class and returns it. </li><li>  Let's write the UpdateWheels () function in which the position and angle of rotation of our wheels will be calculated. </li><li>  We remember the <a href="http://unity3d.com/support/documentation/ScriptReference/Time.html">Time</a> class <a href="http://unity3d.com/support/documentation/ScriptReference/Time-fixedDeltaTime.html">fixedDeltaTime</a> variable. <a href="http://unity3d.com/support/documentation/ScriptReference/Time-fixedDeltaTime.html">We</a> need it in order for the wheel rotation to be evenly spread over time. </li><li>  For each element of the wheels array, perform the following operations: </li><li>  Create a class variable WheelHit (I told about it above); </li><li>  We remember the local position of the wheel (the local position is the position relative to the parent coordinates, the global position is relative to the world ones); </li><li>  If WheelCollider wheels collides with the surface of the terrane (or something else); </li><li>  Then, from the local position of the wheel position Y, we subtract <a href="http://unity3d.com/support/documentation/ScriptReference/Vector3.Dot.html">Dot ()</a> between the vector with the beginning at the point where the collider touches the terrain surface (hit.point) and the end at the current wheel position (w.wheelTransform.position) and between the vector directed upwards relative to the Car object (transform.up) and from all this we also subtract the variable wheelRadius so that the wheel takes the right place.  (If you don‚Äôt understand a single word from the above, don‚Äôt get upset most people don‚Äôt understand it the first time, for that you need to know what the <a href="http://en.wikipedia.org/wiki/Dot_product">Dot product is</a> and how it relates to the vectors listed above, or just know that the wheel position should be calculated that way ); </li><li>  If WheelCollider does not touch the surface of the terrain.  We take away the wheelOffset from the Y coordinate of the initial local position of the wheel, thanks to which our wheels do not fly away in an unknown direction when the car falls from a height or lies on the ‚Äúback‚Äù; </li><li>  Apply the modified wheel position to its current position; </li><li>  We calculate the angle of ‚Äúrotation‚Äù of the wheel using the <a href="http://unity3d.com/support/documentation/ScriptReference/Mathf.Repeat.html">Repeat ()</a> function of the <a href="http://unity3d.com/support/documentation/ScriptReference/Mathf.html">Mathf</a> class, this function helps us to keep the angle in the range from 0 to 360 degrees, we calculate the angle itself thanks to a not tricky formula (w.rotation + delta * w.col.rpm * 360.0f / 60.0f) where we actually add the time delta multiplied by the number of turns per minute stored in the collider and multiplied by 360/60 to the current angle of rotation. </li><li>  We apply the resulting result to the current local rotation angles, the <a href="http://unity3d.com/support/documentation/ScriptReference/Quaternion.html">Quaternion</a> class <a href="http://unity3d.com/support/documentation/ScriptReference/Quaternion.Euler.html">Euler ()</a> function helps us in this, which returns the quaternion in the Euler angles (no matter how scary the word quaternion is, I advise you to abstract and perceive it as a structure that stores local and global angles of rotation, it means something completely different, here I will not tell you what it is, it will be so easy to understand).  The first argument (ie the angle around the X axis) we pass our calculated angle of "rotation" of the wheel, the second argument (angle around the Y axis) we pass the angle of rotation of the collider, and the third argument (angle along the Z axis, now you understand why in paragraph 1 it was important turn the wheels exactly around the Z axis) betray the constant 90.0f. </li></ol><br><br><h4>  Conclusion </h4><br>  Well, that's all I can tell you about how to build the mechanics of an ordinary car on Unity3D, after reading and realizing all of the above, you can now go to make a racing simulator. <br><br>  Well, in the next part of the lesson, as I promised, I will talk about how to build the mechanics of the tank tracks, and I will also talk about modeling methods in the 3D editor and a little about exporting the model from it and importing into Unity and of course I will not force you to model what you saw in <a href="https://dl.dropbox.com/u/23068733/TankDemo/index.xhtml">this demo</a> , but give you a ready-made model.  Thanks for attention and good luck in learning Unity3d. <br><br>  <a href="http://habrahabr.ru/blogs/gdev/116088">&gt;&gt; Lesson 2</a> </div><p>Source: <a href="https://habr.com/ru/post/115557/">https://habr.com/ru/post/115557/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../115552/index.html">Replacing images on Times Square monitors using the iPhone</a></li>
<li><a href="../115553/index.html">New logo in Google Chrome Dev channel update</a></li>
<li><a href="../115554/index.html">Gears will no longer be in Chrome</a></li>
<li><a href="../115555/index.html">March application number for UserAndLINUX magazine is available - ‚ÄúMore than USER‚Äù</a></li>
<li><a href="../115556/index.html">Live (again) without boring things.</a></li>
<li><a href="../115558/index.html">Redirection of functions in Mach-O libraries</a></li>
<li><a href="../115559/index.html">Down Silicon Valley Monopoly: Ukrainian ImPAD vs. iPad</a></li>
<li><a href="../115560/index.html">Scalaxi Updates: Windows Cloning and IP Addresses</a></li>
<li><a href="../115562/index.html">Citrix XenClient by the system administrator</a></li>
<li><a href="../115563/index.html">New Ebay tariffs, and also goodbye Buy it Now, hello Add to cart</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>