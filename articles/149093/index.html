<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>From Facebook - to Livejournal, Twitter & Vkontakte, crossposting in source codes and comments</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article, I will talk about my experience in developing crossposting from my Facebook to my Livejournal (hereinafter referred to as LJ), and al...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>From Facebook - to Livejournal, Twitter & Vkontakte, crossposting in source codes and comments</h1><div class="post__text post__text-html js-mediator-article">  In this article, I will talk about my experience in developing <b>crossposting from <a href="http://facebook.com/raufaliev">my Facebook</a> to <a href="http://rauf.livejournal.com/">my Livejournal</a></b> (hereinafter referred to as LJ), and also share source texts ready for launching on your accounts. <br><br>  The reason for writing the scripts was to get the opportunity to <b>search for your records</b> - an opportunity that Facebook could not run as part of its service, as well as the ‚Äúrevitalization‚Äù of its LJ.  Since access to any posts on Facebook requires mandatory authorization, search engines are obviously not allowed to search engines.  Specifically, in my case, this is inconvenient: links, videos and thoughts that I publish on the social network, I often publish "for the future" - and the time often comes when this information becomes necessary, but it is almost impossible to find. <br><br>  Also, using scripts published here, it was possible to <b>transfer the archive of existing Facebook records</b> : more than 2000 archived messages from <a href="http://facebook.com/raufaliev/">my Facebook</a> were transferred to <a href="http://rauf.livejournal.com/">LiveJournal</a> with corresponding dates.  That is, if you have not had LJ, you can immediately fill it with information for all time. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Also in the article I post <b>ready-made Perl scripts</b> with which you can translate Facebook statuses into Livejournal, and from there, with the appropriate settings, in Vkontakte, Twitter and RSS, and using additional web services - in almost all blog engines. <br><a name="habracut"></a><br><br><h1>  Preamble </h1><br>  It so happened that I left <a href="http://facebook.com/raufaliev/">Facebook</a> on <a href="http://facebook.com/raufaliev/">Facebook</a> two years ago.  This was due to a bunch of problems in the LiveJournal itself, a retardation with the development of the service, and, as a result, the mass departure of my friends from there to the blue-and-white social network. <br><br>  At the same time, LJ remains the only open blog site with a flexible post format that does not impose significant technical restrictions on the size of the post or on its design.  In LJ still remains a lot of interesting personalities, of which a lot of my friends. <br><br>  A very big advantage of LJ was its openness to search engines.  What I wrote to the blog, I can then find through the ‚Äúsearch engines‚Äù, and in practice, the Yandex or Google index is updated a few minutes after the post is published.  Understanding that your article, note or find can be useful not only to your friends, motivates well enough to write this useful thing again and again.  However, the same logic works in relation to Habra. <br><br>  I learned crossposting services that allow you to automatically post a message to several social networks.  Unfortunately, nothing sensible of them was found.  Almost everywhere they are forced to write a post in a special interface, or LJ is used as the main place, which is inconvenient for me personally.  The most interesting service was the startup <a href="http://ifttt.com/">IFTTT.com</a> , which allows you to create universal rules of the form ‚Äútweeted on twitter - send by sms‚Äù, ‚Äúappeared on facebook - send on twitter‚Äù, ‚Äúit's going to rain - warn by sms‚Äù, etc.  Yes, it can be adapted for some needs, but he cannot post from Facebook to LiveJournal anyway.  There is one big drawback in all cross-posting services - they are too universal and poorly customizable, and even rare ones include popular Russian social networks.  The same LiveJournal on the list is extremely rare.  And if you can get a post in LiveJournal through RSS, then you can send it there only through the API. <br><br>  There is one more reason.  I want to be able to control what to fast, depending on the content.  For example, I can consider it necessary to automatically publish a photo in LJ, and not a link to it.  Or transfer to Twitter the entire post, and not a link to it, as many services do.  To do this, I should be able to fix the script myself, for my needs. <br><br>  As a result, the goal was to cover the social networks of Twitter, LiveJournal, Facebook and Vkontakte, leaving Facebook a ‚Äúlaunching pad‚Äù for the post.  Since LJ itself can post on Vkontakte and Twitter, as well as export posts to RSS for integration with Drupal, the following scheme was drawn: <br><br> <a href="http://facebook.com/raufaliev"><img src="https://habrastorage.org/getpro/habr/post_images/df2/ea6/721/df2ea67212ff311b79df90e06933d884.png"></a> <a href="http://rauf.livejournal.com/"><img src="https://habrastorage.org/getpro/habr/post_images/325/a34/83f/325a3483fffb95ca3bdf48f7dcaa9a20.png"></a> <a href="http://raufaliev.ru/"><img src="https://habrastorage.org/getpro/habr/post_images/f27/2b9/78a/f272b978a6ace220c40015092ee48da8.png"></a> <a href="http//vk.com/id1140997"><img src="https://habrastorage.org/getpro/habr/post_images/d12/567/809/d12567809b56367b5e15d7a6690caefc.png"></a> <a href="http://twitter.com/r_aliev"><img src="https://habrastorage.org/getpro/habr/post_images/8ff/e27/66c/8ffe2766c342cf911e4673310db603f7.png"></a> <br><br><h1>  About API </h1><br>  Facebook has, in my opinion, the smartest API.  This interface allows you to do anything with the data that you contribute to the social network - get it in a structured form, change or delete it through a lot of convenient mechanisms, FQL, HTTP requests.  Against this background, a relatively small number of third-party applications working with Facebook were surprised. <br><br>  In addition to using the API, I also tried parsing the pages of a simplified mobile version of Facebook ‚Äî this allowed me to pull out more information than the API gives.  In some cases, this is quite a useful mechanism.  In this case, it was possible to completely manage with standard features. <br><br>  In the Perl libraries, everything turned out fine: for Perl on <a href="http://cpan.org/">CPAN, there</a> were several modules that implement work with Facebook, but because of the simplicity of the protocol, there is little need for them.  The request data is transmitted via the URL, the result is returned in JSON.  As for LJ, it has several different APIs, of which the simplest is <a href="http://www.livejournal.com/doc/server/ljp.csp.xml-rpc.protocol.html">LJ XML-RPC</a> .  I used a ready-made module for Perl that implements a fairly stable work with LJ - <a href="">LJ :: Simple</a> . <br><br><h1>  Features of crossposting from Facebook </h1><br>  Access to Facebook via access token, received by an external application for a limited time with limited rights.  The fading time of the session and the received access_token is measured from 2 to 25 hours.  It is possible to get a <a href="http://stackoverflow.com/questions/10467272/get-long-live-access-token-from-facebook">long-live token</a> with a lifetime of up to 60 days.  Logically, you need to update the access_token after fading each time - after 5 days it will happen or after 60. In the above scripts, automatic updating is not provided, as is the notification that the access token is rotten. <br><br>  The second feature is that your messages are available on the wall along with messages from other users, and if you don‚Äôt think that only yours should be cross-posted, other users may be able to publish something wrong with you on Facebook.  By default, on Facebook, all your friends have the opportunity to publish anything to you on the wall, especially the opportunity to receive a cloud of comments from friends to someone else's photo, on which you are ‚Äúmarked‚Äù.  If you do not include the moderation of someone else's messages on the wall, then with the advent of crossposting, these photos will go beyond the limits of Facebook. <br><br>  Some Facebook posts are ‚Äúnon-informative‚Äù - like some messages sent by applications.  Crossposter can filter them and not transfer them to Livejournal, but then everyone adjusts for themselves, of course.  Some posts specifically take a different look: for example, a photo is transformed from a link to Facebook into a large photo embedded in a post on LJ. <br><br>  You must also take into account the need to set the ‚Äúbackdate‚Äù flag when posting backdating on LJ.  For this there is a special constant at the beginning of the script.  The peculiarity lies in the fact that if you publish a post in LiveJournal for March 2011, then it is placed in the friends tape as fresh (albeit with an old date), and when linked up with twitter, it is also published as fresh.  If you put a special tick in the interface, or set the backdate property through an API, then it is excluded from the friends ribbon.  To transfer an archive, installing backdate is a must, then it can be disabled. <br><br>  Well, you need to remove the connection with Facebook, otherwise it will turn out to be a closed loop (protection in the script just in case). <br><br><h1>  What happened </h1><br>  Here I publish scripts developed in the process of research, such proof of concept.  They are also adapted for publication as part of the article - for example, the general parameters for connecting to the database are not transferred to separate files, the code is not broken down by functions and files, unimportant ones are removed, etc. <br><br>  The cross-poster architecture assumes two-stage work: saving intermediate results to the database and exporting records from the database to LiveJournal.  In the future, this database can be used as an independent database, and having local data it is easy to add scripts for export to other social networks, RSS. <br><br>  To save to the database, use the facebook.pl script.  Its purpose is to get a page from the wall from Facebook and, in case there is a next page, give it its identifier, if not, give it ‚Äúall done‚Äù.  The identifier is a script parameter, so to load the next page you need to call a script with this identifier, etc., until we get all done in response. <br><br>  Please note that in order for facebook.pl to work, you need to change the settings for connecting to the database, the identifier of your log in LiveJournal, and enter access_token.  For debugging, you can create a short-lived access token in the <a href="https://developers.facebook.com/tools/explorer">Facebook Graph API Explorer</a> .  In order to get access for 60 days, you need to create an application, get AppId and SecretId, then create an access token using the link provided, selecting this application from the drop-down list.  Pay attention to the list of rights - the lack of some checkboxes may restrict access to entries on your wall: for example, the external application will no longer show reshares from other users or photos or something else.  If you are not afraid to leave extra accesses in the scripts, it is better to put all the checkboxes at all. <br><br>  For posting on LJ from DB, the update_lj.pl script is used.  This article uses its debug version - it takes one vacant post prepared from facebook.pl from the database, sends it to LJ, returns the page identifier to LJ, marks the post as sent.  This is an intermediate version, and I leave it here, because in case of any problems, removing posts created by the script from LJ is massively very, very inconvenient. <br><br>  In case, if after all, LJ has been replenished with a bunch of automatically created erroneous posts, you can perform selective editing, deletion or modification of properties with the lj_change.pl script provided at the end of the post. <br><br>  As a result, to transfer the archive, you need to go through all the pages with a bash script that calls facebook.pl the necessary number of times, and then run updatelj.pl as many times as you have records in the database.  To update facebook.pl regularly, it‚Äôs enough to call krone once an hour or once a day, then call updatelj.pl after such a bash-script. <br><br>  I will be glad to any comments and additions, as well as to those enthusiasts who want or can make an external universal service out of it. <br><br><pre><code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">CREATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">TABLE</span></span> <span class="hljs-string"><span class="hljs-string">`myposts`</span></span> ( <span class="hljs-string"><span class="hljs-string">`id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> AUTO_INCREMENT, <span class="hljs-string"><span class="hljs-string">`ctime`</span></span> datetime <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //   <span class="hljs-string"><span class="hljs-string">`message`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, //   <span class="hljs-string"><span class="hljs-string">`link`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, //    <span class="hljs-string"><span class="hljs-string">`picture_fb`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">text</span></span>, //    <span class="hljs-string"><span class="hljs-string">`posted_to_lj`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //     ? <span class="hljs-string"><span class="hljs-string">`lj_ts`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">timestamp</span></span> <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span> <span class="hljs-keyword"><span class="hljs-keyword">UPDATE</span></span> <span class="hljs-keyword"><span class="hljs-keyword">CURRENT_TIMESTAMP</span></span>, //     <span class="hljs-string"><span class="hljs-string">`lj_item_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //    () <span class="hljs-string"><span class="hljs-string">`lj_anum`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //   ,  item_id  html_id <span class="hljs-string"><span class="hljs-string">`lj_html_id`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>(<span class="hljs-number"><span class="hljs-number">11</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //    (, ,   .html) <span class="hljs-string"><span class="hljs-string">`user`</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">50</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">DEFAULT</span></span> <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>, //  (     ) PRIMARY <span class="hljs-keyword"><span class="hljs-keyword">KEY</span></span> (<span class="hljs-string"><span class="hljs-string">`id`</span></span>) )</code> </pre> <br><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash #   NEXT=`./facebook.pl`; echo $NEXT; while [ "$NEXT" != "all done" ] do NEXT=`$NEXT`; echo $NEXT; done</span></span></code> </pre><br><br><div class="spoiler">  <b class="spoiler_title">Show source for facebook.pl</b> <div class="spoiler_text"><blockquote>  <font color="#666666">#! / usr / bin / perl</font> <br><br>  <font color="#000000">use</font> <font color="#000066">open</font> <font color="#000066">qw</font> <font color="#009900">(</font> <font color="#339933">:</font> std <font color="#339933">:</font> utf8 <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#000000">use</font> LWP <font color="#339933">::</font> <font color="#006600">Simple</font> <font color="#339933">;</font> <br>  <font color="#000000">use</font> YAML <font color="#339933">::</font> <font color="#006600">Tiny</font> <font color="#339933">;</font> <br>  <font color="#000000">use</font> JSON <font color="#339933">;</font> <br>  <font color="#000000">use</font> URI <font color="#339933">;</font> <br>  <font color="#000000">use</font> DBI <font color="#339933">;</font> <br>  <font color="#000000">use</font> DBD <font color="#339933">::</font> <font color="#006600">MySQL</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ DB_LOGIN</font> <font color="#339933">=</font> <font color="#ff0000">"======== DB-USER =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ DB_PASS</font> <font color="#339933">=</font> <font color="#ff0000">"======== DB-PASS =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ DATABASE</font> <font color="#339933">=</font> <font color="#ff0000">"======== DB-NAME =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ USER</font> <font color="#339933">=</font> <font color="#ff0000">'======== YOUR-LJ-USER =========='</font> <font color="#339933">;</font> <br>  <font color="#b1b100">my</font> <font color="#0000ff">$ access_token</font> <font color="#339933">=</font> <font color="#ff0000">'======== YOUR-ACCESS-TOKEN-SEE-GRAPH.FACEBOOK.COM-FOR-THE-DETAILS =========='</font> <font color="#339933">;</font> <br><br>  <font color="#666666">#Argv [0] CGI parameter</font> <br>  <font color="#0000ff">$ until</font> <font color="#339933">=</font> <font color="#0000ff">$ ARGV</font> <font color="#009900">[</font> <font color="#cc66cc">0</font> <font color="#009900">]</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">my</font> <font color="#0000ff">$ dbh</font> <font color="#339933">=</font> DBI <font color="#339933">-&gt;</font> <font color="#006600">connect</font> <font color="#009900">(</font> <font color="#ff0000">"DBI: mysql: database = mysql; host = localhost"</font> <font color="#339933">,</font> <font color="#0000ff">$ DB_LOGIN</font> <font color="#339933">,</font> <font color="#0000ff">$ DB_PASS</font> <font color="#009900">)</font> <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"Error connecting to database: $! n"</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">do</font> <font color="#009900">(</font> <font color="#ff0000">"use $ DATABASE;"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#666666"># next four lines are for facebook graph api request</font> <br>  <font color="#b1b100">my</font> <font color="#0000ff">$ uri</font> <font color="#339933">=</font> <font color="#000000">new</font> URI <font color="#009900">(</font> <font color="#ff0000">'https://graph.facebook.com/me/feed'</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ uri</font> <font color="#339933">-&gt;</font> <font color="#006600">query_form</font> <font color="#009900">(</font> <font color="#009900">{</font> access_token <font color="#339933">=&gt;</font> <font color="#0000ff">$ access_token</font> <font color="#339933">,</font> <font color="#b1b100">until</font> <font color="#339933">=&gt;</font> <font color="#0000ff">$ until</font> <font color="#339933">,</font> base_amount <font color="#339933">=&gt;</font> <font color="#cc66cc">1</font> <font color="#339933">,</font> value <font color="#339933">=&gt;</font> <font color="#cc66cc">1</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">my</font> <font color="#0000ff">$ resp</font> <font color="#339933">=</font> get <font color="#009900">(</font> <font color="#ff0000">"$ uri"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ resp</font> <font color="#339933">=</font> <font color="#000066">defined</font> <font color="#0000ff">$ resp</font> <font color="#339933">?</font>  decode_json <font color="#009900">(</font> <font color="#0000ff">$ resp</font> <font color="#009900">)</font> <font color="#339933">:</font> <font color="#000066">undef</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ next</font> <font color="#339933">=</font> <font color="#0000ff">$ resp</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> paging <font color="#009900">}</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> <font color="#b1b100">next</font> <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ next</font> <font color="#339933">= ~</font> <font color="#009966">/until=(.+)$/</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ until</font> <font color="#339933">=</font> <font color="#0000ff">$ 1</font> <font color="#339933">;</font> <br><br>  <font color="#666666">or the bash command for the next iteration.</font>  <font color="#666666">It looks a bit queer ...</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ until</font> <font color="#339933">! =</font> <font color="#ff0000">""</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#000066">print</font> <font color="#ff0000">"./facebook.pl"</font> <font color="#339933">.</font>  <font color="#0000ff">$ until</font> <font color="#339933">.</font>  <font color="#ff0000">"n"</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#b1b100">else</font> <br>  <font color="#009900">{</font> <br>  <font color="#000066">print</font> <font color="#ff0000">"all done"</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br><br>  <font color="#666666"># updating database</font> <br>  <font color="#b1b100">for</font> <font color="#b1b100">my</font> <font color="#0000ff">$ post</font> <font color="#009900">(</font> <font color="#339933">@</font> <font color="#009900">{</font> <font color="#0000ff">$ resp</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> data <font color="#009900">}</font> <font color="#009900">}</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#0000ff">$ ctime</font> <font color="#339933">=</font> <font color="#0000ff">$ post</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> created_time <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ ctime</font> <font color="#339933">= ~</font> <font color="#009966">/</font> <font color="#339933">(</font> <font color="#0000ff">ddddd)</font> <font color="#339933">- (</font> <font color="#009966">ddd</font> <font color="#0000ff">)</font> <font color="#339933">- (</font> <font color="#009966">ddd).</font> <font color="#339933">(</font> <font color="#0000ff">ddd)</font> <font color="#339933">: (</font> <font color="#009966">ddd</font> <font color="#0000ff">)</font> <font color="#339933">: (</font> <font color="#009966">ddd</font> <font color="#339933">)</font> <font color="#009966">/</font> <font color="#339933">;</font> <br>  <font color="#009900">(</font> <font color="#0000ff">$ y</font> <font color="#339933">,</font> <font color="#0000ff">$ m</font> <font color="#339933">,</font> <font color="#0000ff">$ d</font> <font color="#339933">,</font> <font color="#0000ff">$ h</font> <font color="#339933">,</font> <font color="#0000ff">$ i</font> <font color="#339933">,</font> <font color="#0000ff">$ s</font> <font color="#009900">)</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#0000ff">$ 1</font> <font color="#339933">,</font> <font color="#0000ff">$ 2</font> <font color="#339933">,</font> <font color="#0000ff">$ 3</font> <font color="#339933">,</font> <font color="#0000ff">$ 4</font> <font color="#339933">,</font> <font color="#0000ff">$ 5</font> <font color="#339933">,</font> <font color="#0000ff">$ 6</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ time</font> <font color="#339933">=</font> <font color="#ff0000">"$ h: $ i: $ s"</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ sqltime</font> <font color="#339933">=</font> <font color="#0000ff">$ y</font> <font color="#339933">.</font>  <font color="#0000ff">$ m</font> <font color="#339933">.</font>  <font color="#0000ff">$ d</font> <font color="#339933">.</font>  <font color="#0000ff">$ h</font> <font color="#339933">.</font>  <font color="#0000ff">$ i</font> <font color="#339933">.</font>  <font color="#0000ff">$ s</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ message</font> <font color="#339933">=</font> <font color="#0000ff">$ post</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> message <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ link</font> <font color="#339933">=</font> <font color="#0000ff">$ post</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> <font color="#000066">link</font> <font color="#009900">}</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ picture</font> <font color="#339933">=</font> <font color="#0000ff">$ post</font> <font color="#339933">-&gt;</font> <font color="#009900">{</font> picture <font color="#009900">}</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ sql</font> <font color="#339933">=</font> <font color="#ff0000">"select * from myposts where user = '$ USER' and ctime = '$ sqltime'"</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ sth</font> <font color="#339933">=</font> <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">prepare</font> <font color="#009900">(</font> <font color="#0000ff">$ sql</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ sth</font> <font color="#339933">-&gt;</font> <font color="#006600">execute</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ sth</font> <font color="#339933">-&gt;</font> <font color="#006600">rows</font> <font color="#339933">==</font> <font color="#cc66cc">0</font> <font color="#009900">)</font> <font color="#009900">{</font> <br><br>  <font color="#0000ff">$ sql</font> <font color="#339933">=</font> <font color="#ff0000">"insert into myposts set user = '$ USER', link ="</font> <font color="#339933">.</font>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">quote</font> <font color="#009900">(</font> <font color="#0000ff">$ link</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#ff0000">", picture_fb ="</font> <font color="#339933">.</font>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">quote</font> <font color="#009900">(</font> <font color="#0000ff">$ picture</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#ff0000">", message ="</font> <font color="#339933">.</font>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">quote</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#ff0000">", ctime = '$ sqltime'"</font> <font color="#339933">;</font> <br><br>  <font color="#666666"># the following line is intended for filtering twitter-like posts.</font>  <font color="#666666">I‚Äôve been able to follow your Facebook post.</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#339933">! ~</font> <font color="#339933">/</font> t <font color="#339933">.</font> co <font color="#339933">//</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">do</font> <font color="#009900">(</font> <font color="#0000ff">$ sql</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> </blockquote><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Display source code update_lj</b> <div class="spoiler_text"><blockquote>  <font color="#666666">#! / usr / bin / perl</font> <br><br>  <font color="#000000">use</font> LJ <font color="#339933">::</font> <font color="#006600">Simple</font> <font color="#339933">;</font> <br>  <font color="#000000">use</font> Date <font color="#339933">::</font> <font color="#006600">Manip</font> <font color="#339933">;</font> <br>  <font color="#000000">use</font> DBI <font color="#339933">;</font> <br>  <font color="#000000">use</font> DBD <font color="#339933">::</font> <font color="#006600">MySQL</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ USER</font> <font color="#339933">=</font> <font color="#ff0000">'======== YOUR-LJ-USER =========='</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ DB_LOGIN</font> <font color="#339933">=</font> <font color="#ff0000">"======== DB-USER =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ DB_PASS</font> <font color="#339933">=</font> <font color="#ff0000">"======== DB-PASS =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ LJ_NAME</font> <font color="#339933">=</font> <font color="#ff0000">"======== LJ-USER =========="</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ LJ_PASS</font> <font color="#339933">=</font> <font color="#ff0000">"======== LJ-PASS =========="</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ DATABASE</font> <font color="#339933">=</font> <font color="#ff0000">'facebook'</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ DEBUG</font> <font color="#339933">=</font> <font color="#cc66cc">1</font> <font color="#339933">;</font> <br><br>  <font color="#666666"># it's extremely important to set the following constant to "1"</font> <br>  <font color="#666666"># if you‚Äôve decided to migrate</font> <br>  <font color="#0000ff">$ HIDE_FROM_FRIENDS_WALLS</font> <font color="#339933">=</font> <font color="#cc66cc">0</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">my</font> <font color="#0000ff">$ dbh</font> <font color="#339933">=</font> DBI <font color="#339933">-&gt;</font> <font color="#006600">connect</font> <font color="#009900">(</font> <br>  <font color="#ff0000">"DBI: mysql: database = mysql; host = localhost"</font> <font color="#339933">,</font> <br>  <font color="#0000ff">$ DB_LOGIN</font> <font color="#339933">,</font> <br>  <font color="#0000ff">$ DB_PASS</font> <font color="#339933">,</font> <br>  <font color="#009900">)</font> <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"Error connecting to database: $! n"</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">my</font> <font color="#0000ff">$ lj</font> <font color="#339933">=</font> <font color="#000000">new</font> LJ <font color="#339933">::</font> <font color="#006600">Simple</font> <font color="#009900">(</font> <font color="#009900">{</font> <br>  user <font color="#339933">=&gt;</font> <font color="#0000ff">$ LJ_NAME</font> <font color="#339933">,</font> <br>  pass <font color="#339933">=&gt;</font> <font color="#0000ff">$ LJ_PASS</font> <font color="#339933">,</font> <br>  site <font color="#339933">=&gt;</font> <font color="#ff0000">"livejournal.com:80"</font> <font color="#339933">,</font> <br>  <font color="#009900">}</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">(</font> <font color="#000066">defined</font> <font color="#0000ff">$ lj</font> <font color="#009900">)</font> <br>  <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"$ 0: Failed to log into LiveJournal: $ LJ :: Simple :: errorn"</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ sql</font> <font color="#339933">=</font> <font color="#ff0000">"select ctime, UNIX_TIMESTAMP (ctime), link, message, picture_fb, id from myposts where user = '$ USER' and lj_html_id is NULL order by ctime desc limit 0,1;"</font>  <font color="#339933">;</font> <br>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">do</font> <font color="#009900">(</font> <font color="#ff0000">"use $ DATABASE;"</font> <font color="#009900">)</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">@row_ary</font> <font color="#339933">=</font> <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">selectrow_array</font> <font color="#009900">(</font> <font color="#0000ff">$ sql</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ row_ary</font> <font color="#009900">[</font> <font color="#cc66cc">0</font> <font color="#009900">]</font> <font color="#339933">==</font> <font color="#ff0000">""</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000066">exit</font> <font color="#339933">;</font>  <font color="#009900">}</font> <br><br>  <font color="#009900">(</font> <font color="#0000ff">$ ctime</font> <font color="#339933">,</font> <font color="#0000ff">$ ctime_ts</font> <font color="#339933">,</font> <font color="#0000ff">$ link</font> <font color="#339933">,</font> <font color="#0000ff">$ message</font> <font color="#339933">,</font> <font color="#0000ff">$ picture_fb</font> <font color="#339933">,</font> <font color="#0000ff">$ id</font> <font color="#009900">)</font> <font color="#339933">=</font> <font color="#0000ff">@row_ary</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ message</font> <font color="#339933">= ~</font> <font color="#009966">s / n / &lt;br&gt; &lt;br&gt; / g</font> <font color="#339933">;</font>  <font color="#666666"># preparing CRs for html</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ DEBUG</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000066">print</font> <font color="#0000ff">$ message</font> <font color="#339933">.</font>  <font color="#ff0000">"n"</font> <font color="#339933">;</font>  <font color="#009900">}</font> <br><br>  <font color="#666666"># building the subject from the text of the post</font> <br>  <font color="#0000ff">$ messagelength</font> <font color="#339933">=</font> <font color="#000066">length</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ messagelength</font> <font color="#339933">&gt;</font> <font color="#cc66cc">50</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#0000ff">$ i</font> <font color="#339933">=</font> <font color="#000066">index</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#339933">.</font> <font color="#ff0000">""</font> <font color="#339933">,</font> <font color="#ff0000">""</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">do</font> <font color="#009900">{</font> <br>  <font color="#0000ff">$ j</font> <font color="#339933">=</font> <font color="#0000ff">$ i</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ i</font> <font color="#339933">=</font> <font color="#000066">index</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#339933">.</font> <font color="#ff0000">""</font> <font color="#339933">,</font> <font color="#ff0000">""</font> <font color="#339933">,</font> <font color="#0000ff">$ i</font> <font color="#339933">+</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#b1b100">while</font> <font color="#009900">(</font> <font color="#0000ff">$ i</font> <font color="#339933">&lt;</font> <font color="#cc66cc">50</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ subject</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#000066">length</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#009900">)</font> <font color="#339933">&gt;</font> <font color="#cc66cc">50</font> <font color="#009900">)</font> <font color="#339933">?</font>  <font color="#000066">substr</font> <font color="#009900">(</font> <font color="#0000ff">$ message</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#0000ff">$ j</font> <font color="#009900">)</font> <font color="#339933">.</font>  <font color="#ff0000">"..."</font> <font color="#339933">:</font> <font color="#0000ff">$ message</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ DEBUG</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000066">print</font> <font color="#ff0000">"posting $ subject ... n"</font> <font color="#339933">;</font>  <font color="#009900">}</font> <br><br>  <font color="#b1b100">my</font> <font color="#0000ff">% Entry</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">NewEntry</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#009900">)</font> <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"$ 0: Failed to create new entry: $ LJ :: Simple :: errorn"</font> <font color="#339933">;</font> <br><br>  <font color="#666666"># croppedlink</font> <br>  <font color="#0000ff">$ croppedlink</font> <font color="#339933">=</font> <font color="#009900">(</font> <font color="#000066">length</font> <font color="#009900">(</font> <font color="#0000ff">$ link</font> <font color="#009900">)</font> <font color="#339933">&gt;</font> <font color="#cc66cc">50</font> <font color="#339933">?</font> <br>  <font color="#009900">(</font> <font color="#000066">substr</font> <font color="#009900">(</font> <font color="#0000ff">$ link</font> <font color="#339933">,</font> <font color="#cc66cc">0</font> <font color="#339933">,</font> <font color="#cc66cc">50</font> <font color="#009900">)</font> <font color="#339933">.</font> <font color="#ff0000">"..."</font> <font color="#009900">)</font> <br>  <font color="#339933">:</font> <br>  <font color="#0000ff">$ link</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#666666"># replacing the big picture</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ picture_fb</font> <font color="#339933">= ~</font> <font color="#339933">/</font> https <font color="#339933">: //</font> fbcdn <font color="#339933">/</font> <font color="#009900">)</font> <font color="#009900">{</font> <br>  <font color="#0000ff">$ largepicture</font> <font color="#339933">=</font> <font color="#0000ff">$ picture_fb</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ largepicture</font> <font color="#339933">= ~</font> <font color="#009966">s / _s / _n / g</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ entry</font> <font color="#339933">=</font> <font color="#ff0000">"&lt;a href='$link'&gt;"</font> <font color="#339933">.</font>  <font color="#0000ff">$ croppedlink</font> <font color="#339933">.</font>  <font color="#ff0000">"&lt;/a&gt; &lt;br&gt;"</font> <font color="#339933">.</font> <br>  <font color="#0000ff">$ message</font> <font color="#339933">.</font> <br>  <font color="#ff0000">"&lt;br&gt; &lt;img src = '$ largepicture'&gt;"</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#b1b100">else</font> <font color="#009900">{</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ link</font> <font color="#b1b100">ne</font> <font color="#ff0000">""</font> <font color="#009900">)</font> <br>  <font color="#009900">{</font> <br>  <font color="#0000ff">$ entry</font> <font color="#339933">=</font> <font color="#ff0000">"&lt;table&gt; &lt;tr&gt; &lt;td&gt; &lt;img src ="</font> <font color="#ff0000">". $ picture_fb."</font> <font color="#ff0000">"align = left&gt; &lt;/ td&gt; &lt;td&gt; &lt;a href = '"</font> <font color="#339933">.</font>  <font color="#0000ff">$ link</font> <font color="#339933">.</font>  <font color="#ff0000">"'&gt;"</font> <font color="#339933">.</font> <br>  <font color="#0000ff">$ croppedlink</font> <font color="#339933">.</font> <br>  <font color="#ff0000">"&lt;/a&gt; &lt;br&gt; $ message &lt;br clear=all&gt; &lt;/ td&gt; &lt;/ tr&gt; &lt;/ table&gt;"</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <font color="#b1b100">else</font> <br>  <font color="#009900">{</font> <br>  <font color="#0000ff">$ entry</font> <font color="#339933">=</font> <font color="#ff0000">"$ messagenn &lt;a href='$link'&gt; $ link &lt;/a&gt; &lt;br&gt; &lt;img src ="</font> <font color="#0000ff">$ picture_fb</font> <font color="#ff0000">"&gt;"</font> <font color="#339933">;</font> <br>  <font color="#009900">}</font> <br>  <font color="#009900">}</font> <br>  <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">SetEntry</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#339933">,</font> <font color="#0000ff">$ entry</font> <font color="#009900">)</font> <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"$ 0: Failed to prepare new post - $ LJ :: Simple :: errorn"</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">SetSubject</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#339933">,</font> <font color="#0000ff">$ subject</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">SetDate</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#339933">,</font> <font color="#0000ff">$ ctime_ts</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ HIDE_FROM_FRIENDS_WALLS</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">Setprop_backdate</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#339933">,</font> <font color="#cc66cc">1</font> <font color="#009900">)</font> <font color="#339933">;</font>  <font color="#009900">}</font> <br>  <font color="#b1b100">my</font> <font color="#009900">(</font> <font color="#0000ff">$ item_id</font> <font color="#339933">,</font> <font color="#0000ff">$ anum</font> <font color="#339933">,</font> <font color="#0000ff">$ html_id</font> <font color="#009900">)</font> <font color="#339933">=</font> <font color="#0000ff">$ lj</font> <font color="#339933">-&gt;</font> <font color="#006600">PostEntry</font> <font color="#009900">(</font> <font color="#0000ff">% Entry</font> <font color="#009900">)</font> <font color="#339933">;</font> <br>  <font color="#009900">(</font> <font color="#000066">defined</font> <font color="#0000ff">$ item_id</font> <font color="#009900">)</font> <br>  <font color="#339933">||</font>  <font color="#000066">die</font> <font color="#ff0000">"$ 0: Failed to post journal entry: $ LJ :: Simple :: errorn"</font> <font color="#339933">;</font> <br><br>  <font color="#b1b100">if</font> <font color="#009900">(</font> <font color="#0000ff">$ DEBUG</font> <font color="#009900">)</font> <font color="#009900">{</font> <font color="#000066">print</font> <font color="#ff0000">"created item_id:"</font> <font color="#339933">.</font>  <font color="#0000ff">$ item_id</font> <font color="#339933">.</font>  <font color="#ff0000">", anum:"</font> <font color="#339933">.</font>  <font color="#0000ff">$ anum</font> <font color="#339933">.</font>  <font color="#ff0000">", html_id:"</font> <font color="#339933">.</font>  <font color="#0000ff">$ html_id</font> <font color="#339933">.</font>  <font color="#ff0000">"n"</font> <font color="#339933">;</font>  <font color="#009900">}</font> <br><br>  <font color="#0000ff">$ sql</font> <font color="#339933">=</font> <font color="#ff0000">"update myposts set user = '$ USER', lj_ts = now (), lj_item_id = '$ item_id', lj_anum = '$ anum', lj_html_id = '"</font> <font color="#339933">.</font>  <font color="#0000ff">$ html_id</font> <font color="#339933">.</font>  <font color="#ff0000">"'where id ="</font> <font color="#339933">.</font>  <font color="#0000ff">$ id</font> <font color="#339933">;</font> <br><br>  <font color="#0000ff">$ dbh</font> <font color="#339933">-&gt;</font> <font color="#006600">do</font> <font color="#009900">(</font> <font color="#0000ff">$ sql</font> <font color="#009900">)</font> <font color="#339933">;</font> </blockquote><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Show source for lj_change.pl</b> <div class="spoiler_text"><blockquote>  <font color="#000040">!</font>  <font color="#000040">/</font> usr <font color="#000040">/</font> bin <font color="#000040">/</font> perl <br><br>  use Data <font color="#008080">::</font> <font color="#007788">Dumper</font> <font color="#008080">;</font> <br>  use POSIX <font color="#008080">;</font> <br>  use LJ <font color="#008080">::</font> <font color="#007788">Simple</font> <font color="#008080">;</font> <br>  use Time <font color="#008080">::</font> <font color="#007788">Local</font> <font color="#008080">;</font> <br>  use DBI <font color="#008080">;</font> <br>  use DBD <font color="#008080">::</font> <font color="#007788">MySQL</font> <font color="#008080">;</font> <br><br>  $ LJ_LOGIN <font color="#000080">=</font> <font color="#FF0000">"=========== LJ-LOGIN ============"</font> <font color="#008080">;</font> <br>  $ LJ_PASS <font color="#000080">=</font> <font color="#FF0000">"=========== LJ-PASS ============"</font> <font color="#008080">;</font> <br>  $ DB_LOGIN <font color="#000080">=</font> <font color="#FF0000">"=========== DB-LOGIN ============"</font> <font color="#008080">;</font> <br>  $ DB_PASS <font color="#000080">=</font> <font color="#FF0000">"=========== DB-PASS ============"</font> <font color="#008080">;</font> <br>  $ DATABASE <font color="#000080">=</font> <font color="#FF0000">"=========== DATABASE ============"</font> <font color="#008080">;</font> <br>  $ operation <font color="#000080">=</font> <font color="#FF0000">"..."</font> <font color="#008080">;</font>  <font color="#339900">#setbackdate, purge ...</font> <br><br>  my $ dbh <font color="#000080">=</font> DBI <font color="#000040">-</font> <font color="#000080">&gt;</font> connect <font color="#008000">(</font> <br>  <font color="#FF0000">"DBI: mysql: database = mysql; host = localhost"</font> , <br>  $ DB_LOGIN, <br>  $ DB_PASS, <br>  <font color="#008000">)</font> <font color="#000040">||</font>  die <font color="#FF0000">"Error connecting to database: $! n"</font> <font color="#008080">;</font> <br><br>  $ dbh <font color="#000040">-</font> <font color="#000080">&gt;</font> <font color="#0000ff">do</font> <font color="#008000">(</font> <font color="#FF0000">"use $ DATABASE ;;"</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  $ sql <font color="#000080">=</font> <font color="#FF0000">"select lj_item_id from myposts where lj_html_id is not NULL order by ctime desc;"</font>  <font color="#008080">;</font> <br><br>  $ results <font color="#000080">=</font> $ dbh <font color="#000040">-</font> <font color="#000080">&gt;</font> selectall_hashref <font color="#008000">(</font> $ sql, <font color="#FF0000">'lj_item_id'</font> <font color="#008000">)</font> <font color="#008080">;</font> <br>  foreach my $ id <font color="#008000">(</font> keys <font color="#000040">%</font> $ results <font color="#008000">)</font> <font color="#008000">{</font> <br>  <font color="#339900"># $ id2 = $ results -&gt; {lj_item_id};</font> <br>  push @ids, $ id <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  my $ lj <font color="#000080">=</font> <font color="#0000dd">new</font> LJ <font color="#008080">::</font> <font color="#007788">Simple</font> <font color="#008000">(</font> <font color="#008000">{</font> <br>  user <font color="#000080">=&gt;</font> $ LJ_LOGIN, <br>  pass <font color="#000080">=&gt;</font> $ LJ_PASS, <br>  site <font color="#000080">=&gt;</font> undef, <br>  proxy <font color="#000080">=&gt;</font> undef, <br>  <font color="#008000">}</font> <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#008000">(</font> defined $ lj <font color="#008000">)</font> <br>  <font color="#000040">||</font>  die <font color="#FF0000">"$ 0: Failed to log into LiveJournal: $ LJ :: Simple :: errorn"</font> <font color="#008080">;</font> <br><br>  print <font color="#FF0000">"logged on ... n"</font> <font color="#008080">;</font> <br><br>  my <font color="#000040">%</font> Entries <font color="#000080">=</font> <font color="#008000">(</font> <font color="#008000">)</font> <font color="#008080">;</font> <br><br>  <font color="#0000ff">for</font> <font color="#008000">(</font> @ids <font color="#008000">)</font> <font color="#008000">{</font> <br>  print <font color="#FF0000">"requesting entry $ _... n"</font> <font color="#008080">;</font> <br><br>  <font color="#008000">(</font> defined $ lj <font color="#000040">-</font> <font color="#000080">&gt;</font> GetEntries <font color="#008000">(</font> <font color="#000040">%</font> Entries, undef, <font color="#FF0000">"one"</font> , $ _ <font color="#008000">)</font> <font color="#008000">)</font> or print <font color="#FF0000">"$ 0: Failed to get entries - $ LJ :: Simple :: errorn"</font> <font color="#008080">;</font> <br>  my $ item <font color="#000080">=</font> $ Entries <font color="#008000">{</font> $ _ <font color="#008000">}</font> <font color="#008080">;</font> <br><br>  <font color="#0000ff">if</font> <font color="#008000">(</font> $ operation <font color="#000080">==</font> <font color="#FF0000">'setbackdate'</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  $ lj <font color="#000040">-</font> <font color="#000080">&gt;</font> Setprop_backdate <font color="#008000">(</font> $ item, <font color="#0000dd">1</font> <font color="#008000">)</font> or print <font color="#FF0000">"$ 0: Failed to set back date property - $ LJ :: Simple :: errorn"</font> <font color="#008080">;</font> <br>  $ lj <font color="#000040">-</font> <font color="#000080">&gt;</font> EditEntry <font color="#008000">(</font> $ item <font color="#008000">)</font> or print <font color="#FF0000">"$ 0: Failed to edit entry - $ LJ :: Simple :: errorn"</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  <font color="#0000ff">if</font> <font color="#008000">(</font> $ operation <font color="#000080">==</font> <font color="#FF0000">'purge'</font> <font color="#008000">)</font> <font color="#008000">{</font> <br>  $ lj <font color="#000040">-</font> <font color="#000080">&gt;</font> EditEntry <font color="#008000">(</font> $ item, undef <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  $ sql <font color="#000080">=</font> <font color="#FF0000">"update myposts set ..."</font> <font color="#008080">;</font> <br>  $ dbh <font color="#000040">-</font> <font color="#000080">&gt;</font> <font color="#0000ff">do</font> <font color="#008000">(</font> $ sql <font color="#008000">)</font> <font color="#008080">;</font> <br>  <font color="#008000">}</font> <br>  print <font color="#FF0000">"done.n"</font> <font color="#008080">;</font> <br>  <font color="#0000dd">exit</font> <font color="#008000">(</font> <font color="#0000dd">0</font> <font color="#008000">)</font> <font color="#008080">;</font> </blockquote><br></div></div><br><br>  <i>PS By the way, syntax highlighting by means of a habra editor does not work very well.</i>  <i>In the first script, the backlight works up to the database connection string (DBI-&gt; connect): as soon as it appears, the source tag stops distinguishing Perl syntax.</i>  <i>In the second, it probably also fails.</i>  <i>I had to make the backlight through the font tag.</i> </div><p>Source: <a href="https://habr.com/ru/post/149093/">https://habr.com/ru/post/149093/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../149086/index.html">Pure and deterministic functions</a></li>
<li><a href="../149087/index.html">Automating the build project in Sublime Text 2 using Ant</a></li>
<li><a href="../149090/index.html">Want to be an iOS developer? Be it!</a></li>
<li><a href="../149091/index.html">Python captcha decoding</a></li>
<li><a href="../149092/index.html">7 minutes of horror</a></li>
<li><a href="../149094/index.html">We take out from the chest Native Shell</a></li>
<li><a href="../149095/index.html">RIM is going to license BlackBerry OS for third-party developers</a></li>
<li><a href="../149096/index.html">I probably know OOP. Experience in object-oriented programming and design. The answer is "not knowing OOP."</a></li>
<li><a href="../149097/index.html">AT & T will stop supporting 2G networks in five years</a></li>
<li><a href="../149098/index.html">Cyberpunk, matrices and canvas</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>