<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>CommuniGate Pro Unified Communications Server API</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everyone who installed new complex systems in organizations was faced with the fact that software developers did not anticipate their specific need fo...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>CommuniGate Pro Unified Communications Server API</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/9cb/d17/576/9cbd17576dd35f604b462ee9b4b73f79.gif"><br><br>  Everyone who installed new complex systems in organizations was faced with the fact that software developers did not anticipate their specific need for an administrative or user interface. <br><br>  In the case of communications, the need for additional processing of correspondence, calls and messages is usually added to this, as a rule, for the purpose of security, employee monitoring and statistics collection. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this article, we will look at a set of tools that the CommuniGate Pro server has for <br><ul><li>  Automate administrative tasks </li><li>  Handling letters and calls </li><li>  Connections of third-party programs and scripts </li><li>  Building HTML Interfaces </li><li>  Build UC clients and utilities on various platforms </li></ul><br><a name="habracut"></a><br><h4>  CLI </h4><br>  The command line interface is a standard way to manage many products.  Convenient for automating administrative tasks.  The format and the full description of the commands are beyond the scope of the article, but you can see them in the <a href="http://www.communigate.com/CommunigatePro/russian/CLI.html">manual</a> , we give just a few examples: <br><br><h5>  Poppwd access </h5><br>  The server has several ways to access the CLI.  One of the most convenient for acquaintance with the commands can be considered the PWD module.  With the standard server configuration, it is enough to type in the command line of the OS "telnet server.address 8106" (or "telnet server.address 106", depending on the OS and version).  Initially, this module was simply the implementation of the password change protocol - poppwd: <br><br><pre><code class="bash hljs">$ telnet localhost 8106 Trying 127.0.0.1... Connected to localhost. Escape character is <span class="hljs-string"><span class="hljs-string">'^]'</span></span>. 200 mymac.ru CommuniGate Pro PWD Server 6.0.5 ready &lt;1.1381912847@mymac.ru&gt; user postmaster 300 please send the PASS pass ****** 200 login OK, proceed newpass ****** 200 Password updated</code> </pre> <br><br>  But there is no reason to dwell on one text command: <br><br><pre> <code class="bash hljs">listdomains 200 data follow (mymac.ru) listaccounts mymac.ru 200 data follow { pbx = macnt; postmaster = macnt; user1 = macnt; user2 = macnt; }</code> </pre><br>  The word macnt in this answer means <a href="http://www.communigate.com/CommunigatePro/russian/Accounts.html">Multi-mailbox Account</a> <br><br><h5>  HTTP access </h5><br>  CLI commands can also be executed by sending a simple POST or GET request with the parameter ‚Äúcommand‚Äù to the address server.name:[http port] / CLI /. <br><img src="https://habrastorage.org/getpro/habr/post_images/12b/465/34f/12b46534f44598f874239581dc25b0de.png"><br><br><h5>  Libraries </h5><br>  Since ‚Äúnaked‚Äù text access is not very convenient for practical tasks, we created <a href="http://www.communigate.com/CGPerl/">Perl</a> and <a href="http://www.communigate.com/CGJava/">Java</a> libraries for working with CLI. <br><br>  On our site there is a special <a href="http://communigate.com/ru/main/solutions/scriptrepository.html">section</a> , where examples of CLI scripts for solving common problems are presented. <br><br>  The execution of CLI commands is also possible in the XIMSS protocol (cliExecute command) and in the CG / PL program (the ExecuteCLI () function), which we will discuss in the corresponding sections. <br><br><h4>  Post and Signal Rules </h4><br>  Probably, assigning rules to an API can be called a stretch, but in Communigate Pro, the rules are used not only to redirect letters and calls between accounts and mailboxes, but also send letters to third-party programs (for example, various filters), run CG / PL programs, and even run scripts in the operating system - in general, are actively used for integration both by themselves and in conjunction with other APIs. <br><br><blockquote>  Signals in Communigate Pro call special objects that are used in real-time communications.  A signal is a unit of Real-time communication.  Various participants (SIP, XMPP clients, PBX applications, ...) send signals to each other to organize, terminate and update dialogs and other actions. </blockquote><br><br><h5>  How the rules work </h5><br>  The rules are divided into three levels - server, domain and account level (account).  Each of these levels has separate rules for signals and for mail. <br><br>  Each rule has a name and priority, signal rules have another ‚ÄúWhen‚Äù condition.  The higher the priority - the earlier, under the same other conditions, the rule will work.  The ‚ÄúWhen‚Äù condition determines at what point the rule triggers ‚Äî at what second of signal processing or when an error occurs with a specific code (Not responding, Busy, or other errors): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d95/6fd/d5d/d956fdd5d5559b898750421616ad1234.png"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2f7/ae9/74e/2f7ae974e9e9c8d5a411f594edf60722.png"><br><br>  Mail order: <br><ul><li>  All server rules apply. </li><li>  Those letters that, as a result of routing, fell into local accounts, are processed by domain rules and rules in accounts as follows: <br><ul><li>  Domain rules with priority&gt; 5 </li><li>  Account Rules </li><li>  Domain rules with priority &lt;= 5 </li></ul><br></li></ul><br>  Signal processing order: <br><ul><li>  The server signal rules are applied with an empty ‚ÄúWhen‚Äù field (this means that they are applied immediately) </li><li>  Those signals that, as a result of routing, hit the local accounts, are processed by the remaining server rules (the When not empty field), domain rules and rules in the accounts as follows: <br><ul><li>  Server rules with priority&gt; 5 </li><li>  Domain rules with priority&gt; 5 </li><li>  Account Rules </li><li>  Domain rules with priority &lt;= 5 </li><li>  Server rules with priority &lt;= 5 </li></ul><br></li></ul><br><h5>  Examples of using </h5><br>  Domain forwarding restrictions: <br><img src="https://habrastorage.org/getpro/habr/post_images/b9f/455/2c2/b9f4552c2c574096994af5f2e6410d7e.png"><br>  All calls to recipients outside certain domains are redirected to the specified address: <br><img src="https://habrastorage.org/getpro/habr/post_images/e3e/743/abe/e3e743abe3b4e6644fbe97976681604c.png"><br><br><h4>  Helper </h4><br>  The Communigate Pro implements the Helper protocol, which allows you to use programs external to the server for various tasks. <br><br>  If certain conditions are met, for example, the mail rule runs a filter for the letter that processes or in the domain external authentication is triggered, the server starts the Helper program.  After that, it starts sending the Helper protocol commands via the standard input and reads the answers from the standard output. <br><br>  An example of some generalized session for the helper protocol (I - input to the program, O - output): <br><pre> <code class="bash hljs">O: * My Helper program started I: 00001 INTF 1 O: 00001 INTF 1 I: 00002 COMMAND parameters O: 00002 OK I: 00003 COMMAND parameters I: 00004 COMMAND parameters O: * processing 00003 will take some time O: 00004 ERROR description O: 00003 OK I: 00005 QUIT O: * processed: 5 requests. Quitting. O: 00005 OK</code> </pre><br>  Here, the INTF command coordinates the protocol version, and QUIT ends the session, * is an informational message to which the server does not respond, but writes it to the log. <br><br>  Within this protocol, more specialized ones have been developed for: <br><ul><li>  Processing the body of the letter </li><li>  External authentication </li><li>  Banner System Connections </li><li>  Adding RADIUS Requests to Authentication </li><li>  Cluster load management </li></ul><br><br>  All of them are connected on the Settings-&gt; General-&gt; WebAdmin Assistants interface. <br><br>  All paths to executable files are counted from the base directory of Communigate Pro (directory with user data). <br><br><h5>  Processing the body of the letter </h5><br>  Mail handlers are triggered by a mail rule, for example: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/e37/52b/66a/e3752b66abd53123ade16ab31cfc0b6a.png"><br><br>  A detailed description of the commands of this and other helpers can be found in the <a href="http://communigate.com/communigatepro/russian/Helpers.html">manual</a> .  The article will give only a general description. <br><br>  Helpers of this type are used mainly to connect to the CGPro <a href="http://communigate.com/communigatepro/russian/default.html">anti-virus and anti-spam engines</a> . <br><br><h5>  External authentication </h5><br>  The helper protocol for external authentication is usually used if: <br><ul><li>  I need an authentication method not supported by the server directly </li><li>  Some accounts are located on another system (for example, AD) </li><li>  Need complex routing </li><li>  External management of services \ account settings is needed </li></ul><br><br>  Examples of this type of helpers can be found on <a href="http://www.communigate.com/CGAUTH/">this page</a> . <br><br><h5>  The remaining helpers </h5><br>  Banner system helpers provide the server with banners for XIMSS and other (for example HTTP) clients. <br>  RADIUS helpers allow you to add additional checks to the authentication process using the RADIUS protocol. <br>  Load sharing helpers manage the Load Balancer in <a href="http://habrahabr.ru/company/communigatepro/blog/196660/">the</a> Communigate Pro <a href="http://habrahabr.ru/company/communigatepro/blog/196660/">cluster configuration</a> . <br><br><h4>  WSSP </h4><br>  WSSP (Web Server-side Pages) is a language for Web page templates. <br>  Before talking about WSSP, you need to put in a few words about the organization of Web skins on the server. <br><br>  Each Web skin consists of three types of files: <br><ul><li>  Static files - graphics, styles, ... </li><li>  WSSP files </li><li>  Language and string files </li></ul><br><br>  Together with the Communigate Pro distribution kit comes a small set of standard (stock) Web interfaces.  One of them is nameless (Unnamed), the others are named.  These demonstration skins are stored in the Application folder of the server (the folder in the OS where the executable file is located) and therefore they are replaced when the server is updated.  Administrators <b>should not change the demonstration skins</b> in their configurations, these changes may be lost when installing the update.  Instead, you need to take advantage of the fact that the skin files form a hierarchy. <br><br><h5>  File hierarchy in skins </h5><br>  Each skin can be server, domain or standard. <br><br>  When processing requests from the user's browser, the server usually needs to get files with specific names from the skin.  Moreover, if the file is not found in the domain skin, then it is searched for in the server skin with the same name.  And if not found in the server, then look for in stock.  If the file is still not found and the current skin is named, then the file is searched for in nameless skins. <br><br>  Thus, by uploading your own files to a nameless server skin, the server administrator can ensure that his files will be used, rather than the standard ones. <br><br>  That is, with this approach, you can make small changes in the standard skins, and develop your own from scratch. <br><br><h5>  String files </h5><br>  The .data files contain text data (UFT-8) in the <a href="http://www.communigate.com/CommunigatePro/russian/Data.html">CG / PL</a> format of the <a href="http://www.communigate.com/CommunigatePro/russian/Data.html">dictionary.</a> These data are used by various server modules to form strings in the interface or as setting values. <br><br>  These files also form a hierarchy, but already at the key level in the dictionary, that is, if a key is missing from the domain strings.data file, the server tries to find it in the server level strings.data file, etc. <br><br>  English is the default language for strings in the interface.  If the user's language (session) is different from English, the key values ‚Äã‚Äãfrom the language files (french.data, russian.data) replace the values ‚Äã‚Äãfrom the strings.data file. <br><br>  Such a system allows including slightly modified interfaces (strings.data files) to include only those keys whose values ‚Äã‚Äãhave been changed (for example, company name, brand names), and not their full set. <br><br><h5>  Query Processing </h5><br>  When the browser connects to the server using the HTTP protocol, the server retrieves the host name from the request and searches for a domain with that name.  If the domain is found, the server finds the skin selected as the default Web interface for users of this domain.  The login.wssp page is launched. <br><br>  The wssp files consist of markup code (usually HTML) with some additional elements: <br><ul><li>  text bounded on both sides by a double character% (%% element %%) </li><li>  structures of this format - </li></ul><br>  An example of such a document: <br><pre> <code class="bash hljs">&lt;html&gt; &lt;body&gt; &lt;h1&gt;   %%server%%.   %%ID%%.&lt;/h1&gt; &lt;!--%%IF EXISTS(lastLogin)--&gt;     %%lastLogin%% &lt;!--%%ENDIF--&gt; &lt;/body&gt; &lt;/html&gt;</code> </pre><br>  After processing by the server, all special constructions will be replaced with strings or arrays of strings from the ‚Äúenvironment‚Äù - key values ‚Äã‚Äãfrom .data files in the skin, domain name or other objects in the server, settings values. <br><br>  Any other files are simply given to the client. <br><br>  Basic demonstration web interfaces can be considered as excellent illustrations of the capabilities of WSSP pages.  But WSSP is quite limited in converting data formats or accessing various modules and performing any actions on the server.  And here a more powerful tool comes to the rescue. <br><br><h4>  CG / PL </h4><br>  About the CG / PL language and the development of PBX applications on it, we have already told on Habr√© in <a href="http://habrahabr.ru/company/communigatepro/blog/189854/">this article</a> . <br><br>  In addition to PBX, it is actively used in the development of Communigate Pro Web interfaces.  If you open the list of files even basic Web skin (Users-&gt; Interfaces), then there will be 14 files with small CG / PL programs that process HTTP requests. <br><br>  To call a CG / PL program to process an HTTP request, you need to write it in any text editor, save it as .wcgp and upload to any Web skin. <br><br>  After this request to the URL of the form: <br><br><pre> <code class="html hljs xml">http://domain.name:[port]/programFile.wcgp/?Skin=skin_name</code> </pre><br>  Run the program for execution. <br><br><pre> <code class="html hljs xml">http://domain.name:[port]/auth/programFile.wcgp/?Skin=skin_name</code> </pre><br>  Run on behalf of the account with pre-authentication <br><br><pre> <code class="html hljs xml">http://domain.name:[port]/sys/programFile.wcgp</code> </pre><br>  This request looks for the program only in the server Unnamed skin and runs postmaster (server administrator) on behalf of the user <br><br>  As an example, consider a small script that executes the CLI command "listaccounts" and converts the result to JSON format: <br><br><pre> <code class="bash hljs">entry sysEntry is void(executeCLI(<span class="hljs-string"><span class="hljs-string">"listaccounts mymac.ru"</span></span>)); accountList = Vars().executeCLIResult; SetHTTPResponseCode(200); SetHTTPResponseData(ObjectToJSON(accountList)); end entry;</code> </pre><br><img src="https://habrastorage.org/getpro/habr/post_images/7c3/e46/782/7c3e46782aff7fa594e51d1101030a90.png"><br><br><h4>  Ximss </h4><br>  With such a large amount of functionality on the server side - voice, instant messages (including SMS), calendars, contacts, mail, file server service providers have some difficulties with writing a unified client.  It is necessary to select or develop libraries implementing SIP, a set of * DAV protocols, SMTP, IMAP, XMPP.  At the same time, the load on parsing messages and data formats from these protocols lies with the client. <br><br>  As a solution to these problems, we developed the <a href="http://www.communigate.com/CommunigatePro/XMLAPI.html">XIMSS</a> protocol ‚Äî the XML Interface to Messaging, Scheduling and Signaling. <br><br>  All commands of this protocol are simple XML documents with transparent attributes.  For example, this simple command will fork an incoming call to two users: <br><br><pre> <code class="bash hljs">C:&lt;callRedirect id=<span class="hljs-string"><span class="hljs-string">"A018"</span></span> callLeg=<span class="hljs-string"><span class="hljs-string">"inp003"</span></span> &gt; &lt;To&gt;user1@example.com&lt;/To&gt;&lt;To&gt;user2@example.com&lt;/To&gt; &lt;/callRedirect&gt; S:&lt;response id=<span class="hljs-string"><span class="hljs-string">"A018"</span></span>/&gt;</code> </pre><br><br>  All data formats (MIME, vCard) come to the XIMSS client in an easy-to-use format. <br><br>  Also, this protocol allows you to perform all CLI commands available on the server - through it you can adjust all types of settings, including administrative <br><br>  For a number of platforms, we have developed ready-made <a href="http://www.communigate.com/XIMSSClient/Guide/">XIMSS libraries</a> . <br><br>  As examples of XIMSS client capabilities, we recommend the Pronto! Series of applications, whose Web versions (HTML5 and Flash) can be tried at our booth, <a href="http://www.bestvoip.ru/">bestvoip.ru</a> . <br><br><h4>  Finally </h4><br>  Communigate Pro is a platform whose behavior can be regulated at different levels.  From the client to access to the main communication modules and the development of its own functionality based on standard protocols.  At the same time, the solution is stable and withstands heavy loads. <br><br>  Although the input threshold for all Communigate APIs in aggregate may seem rather large, they cover most of the tasks of the administrators of communication services. </div><p>Source: <a href="https://habr.com/ru/post/197720/">https://habr.com/ru/post/197720/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../197704/index.html">Kickstarter is now available for Australia and New Zealand</a></li>
<li><a href="../197706/index.html">Apple invites you to look at new products on October 22</a></li>
<li><a href="../197708/index.html">Visiting MakeItLab, the first hackspace of Yekaterinburg</a></li>
<li><a href="../197712/index.html">The General Assembly project launched an online course for those who want to master CSS, JavaScript and HTML</a></li>
<li><a href="../197714/index.html">Where to go Russian in Silicon Valley - answer the questions of a person who wants to move to the Valley</a></li>
<li><a href="../197728/index.html">Hacking Counter Strike Server or Security? No, have not heard!"</a></li>
<li><a href="../197730/index.html">Mail.Ru: Russian Developers Cup - accepting applications</a></li>
<li><a href="../197732/index.html">BlackBerry: you can continue to count on us</a></li>
<li><a href="../197736/index.html">How I completed Habrahabr</a></li>
<li><a href="../197738/index.html">Our partners: Powerbot history</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>