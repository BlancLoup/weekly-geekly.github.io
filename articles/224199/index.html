<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>RESTful API on Yii framework with RBAC and tests</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There are many ready-made solutions for implementing the RESTFul API on the Yii framework, but when using these solutions in real projects you underst...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>RESTful API on Yii framework with RBAC and tests</h1><div class="post__text post__text-html js-mediator-article">  There are many ready-made solutions for implementing the RESTFul API on the Yii framework, but when using these solutions in real projects you understand that everything looks beautiful only with examples of dogs and their owners. <br><br>  It is possible that during the preparation and writing of the article, it lost a bit of relevance with the release of Yii2 with a built-in framework for creating a RESTful API.  But the article will still be useful for those who are not familiar with Yii2, or for those who need to quickly and simply implement a full-fledged API for an existing application. <br><br>  To begin with, I‚Äôll give you a list of some features that I really didn‚Äôt have enough for a full-fledged work with the server API when using existing extensions: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <ol><li> One of the first problems I encountered was the preservation of various entities in the same table.  To obtain such records, it is not enough just to specify the model name as suggested, for example, <a href="http://www.yiiframework.com/wiki/175/how-to-create-a-rest-api/">here</a> .  One example of such a mechanism is the <code>AuthItems</code> table, which is used by the framework in the RBAC mechanism (if someone is not familiar with it, there is a wonderful <a href="http://habrahabr.ru/post/177873/">article</a> on this topic).  It contains roles, operations and tasks that are defined by the <code>type</code> flag, and to work with these entities through the API, I wanted to use a different type of url: <br><blockquote> <code>GET: /api/authitems/?type=0 -   </code> <br> <code>GET: /api/authitems/?type=1 -   </code> <br> <code>GET: /api/authitems/?type=2 -   </code> </blockquote> <br>  and this: <br><blockquote> <code>GET: /api/operations -   </code> <br> <code>GET: /api/tasks -   </code> <br> <code>GET: /api/roles -   </code> <br> </blockquote><br>  Agree, the second option looks clearer and clearer, especially for a person not familiar with the framework and the RBAC device in it. <br></li><li>  The second important possibility is the mechanism for searching and filtering data, with the ability to set conditions and combine rules.  For example, I wanted to be able to perform an analogue of such a query: <br><pre> <code class="sql hljs"><span class="hljs-keyword"><span class="hljs-keyword">SELECT</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">FROM</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WHERE</span></span> (age&gt;<span class="hljs-number"><span class="hljs-number">25</span></span> <span class="hljs-keyword"><span class="hljs-keyword">AND</span></span> first_name <span class="hljs-keyword"><span class="hljs-keyword">LIKE</span></span> <span class="hljs-string"><span class="hljs-string">'%alex%'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">OR</span></span> (last_name=<span class="hljs-string"><span class="hljs-string">'shepard'</span></span>);</code> </pre><br></li><li>  Sometimes there is a lack of the ability to create, update, delete collections.  Those.  change the n-th number of records by a single request, again using search and filtering.  For example, it is often necessary to delete or update all records that fall under any condition, and using separate queries is too expensive. <br></li><li>  Another important point was the ability to get related data.  For example: get these roles along with all its tasks and operations. <br></li><li>  Of course, it is impossible to work in any comfortable way with the API without being able to limit the number of records received ( <code>limit</code> ), shift the beginning of the selection ( <code>offset</code> ), and specify the sort order of records ( <code>order by</code> ).  It would also not be bad to be able to group ( <code>group by</code> ). <br></li><li>  It is important to be able to verify user rights for each of the operations (the <code>checkAccess</code> method <code>checkAccess</code> still in the same RBAC). <br></li><li>  Finally, the whole thing needs to be somehow tested. <br></li></ol><br>  As a result of the analysis of about such a list of ‚Äúhotelok‚Äù, my version of the API implementation on this wonderful framework came into being! <br><a name="habracut"></a><br><h4>  For a start on how the API looks for the client. </h4><br>  Consider the example of the same component of RBAC. <br><br><h5>  Receiving records </h5><br>  Everything is as usual: <br><blockquote> <code>GET: /roles -  </code> <br> <code>GET: /roles/42 -   id=42</code> </blockquote> <br><h5>  Search and filtering </h5><br>  Their mechanisms are almost identical, the only difference is that when searching, records with partial coincidence fall into the sample, and when filtering with full ones.  The combination of fields and their values ‚Äã‚Äãis specified in JSON format.  That he seemed to me the most convenient for the implementation of this functionality.  For example: <br><br>  <code>{"name":"alex", "age":"25"}</code> - corresponds to a query of the form: <code>WHERE name='alex' AND age=25</code> <br>  <code>[{"name":"alex"}, {"age":"25"}]</code> - corresponds to a query of the form: <code>WHERE name='alex' OR age=25</code> <br><br>  Those.  the parameters passed in one object correspond to the AND condition, and the parameters specified by the array of objects correspond to the OR condition. <br><br>  Also, in addition to the <b>AND</b> and <b>OR</b> conditions, the following conditions can be specified, which should precede the value: <br><ul><li>  <code>&lt;:</code> less </li><li>  <code>&gt;:</code> more </li><li>  <code>&lt;=:</code> less or equal </li><li>  <code>&gt;=:</code> greater than or equal </li><li>  <code>&lt;&gt;:</code> not equal </li><li>  <code>=:</code> equals </li></ul><br>  A few examples: <br><blockquote>  <code>GET: /users?filter={"name":"alex"}</code> - users with the name <code>alex</code> <br>  <code>GET: /users?filter={"name":"alex", "age":"&gt;25"}</code> - users with the name <code>alex</code> And over the age of <code>25</code> <br>  <code>GET: /users?filter=[{"name":"alex"}, {"name":"dmitry"}]</code> - users with the name <code>alex</code> OR <code>dmitry</code> <br>  <code>GET: /users?search={"name":"alex"}</code> - users with the name containing the substring <code>alex</code> (alexey, alexander, alex, etc.) </blockquote><br><h5>  Work with related data </h5><br>  You can often find the following syntax for working with related data: <br><blockquote>  <code>GET: /roles/42/operations</code> - get all operations belonging to roles with <code>id = 42</code> </blockquote><br>  Initially, I used this approach, but in the process I realized that it has several drawbacks. <br><br><h6>  One to many </h6><br>  If the one-to-many relationship can be used, the approach with the filter described above: <br><blockquote>  <code>GET: operations?filter={"role_id":"42"}</code> - get all operations belonging to roles with <code>id = 42</code> </blockquote><br><h6>  Many to many </h6><br>  It is more convenient to work with a many-to-many connection as with a separate entity due to the fact that often the link table is not limited to the <code>parent_id</code> and <code>child_id</code> .  Consider the example of goods ( <code>products</code> ) and their characteristics ( <code>features</code> ).  The link table must have at least two fields: <code>product_id</code> and <code>feature_id</code> .  But, if you need to set the sorting order of the list of characteristics in the item card, you must also add an <code>ordering</code> field to the table, and also add the value <code>value</code> that characteristic. <br>  Using the url of the form: <br><blockquote>  <code>POST: /products/42/feature/1</code> - link item <code>42</code> to feature <code>1</code> <br>  <code>GET: /products/42/feature/1</code> - get product description <code>1</code> (entry from the <code>features</code> table) </blockquote><br>  There is no possibility to get the same sorting order and value of the characteristic (record from the link table).  On personal experience, I was convinced that for such connections it is better to use a separate entity, for example, <code>productfeatures</code> . <br>  Thus, we get: <br><blockquote>  <code>POST: /productfeatures</code> - passing the parameters of <code>product_id</code> , <code>feature_id</code> , <code>ordering</code> and <code>value</code> in the request body, we will connect the characteristic and product, specifying the value and sorting order. <br>  <code>GET: /productfeatures?filter={"product_id":"42"}</code> - we get all the links of the goods with the characteristics.  The answer might look something like this: <br><pre> <code class="javascript hljs">[ {<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"12"</span></span>,<span class="hljs-string"><span class="hljs-string">"feature_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>,<span class="hljs-string"><span class="hljs-string">"product_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"42"</span></span>,<span class="hljs-string"><span class="hljs-string">"value"</span></span>:<span class="hljs-string"><span class="hljs-string">"33"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"13"</span></span>,<span class="hljs-string"><span class="hljs-string">"feature_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>,<span class="hljs-string"><span class="hljs-string">"product_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"42"</span></span>,<span class="hljs-string"><span class="hljs-string">"value"</span></span>:<span class="hljs-string"><span class="hljs-string">"54"</span></span>} ]</code> </pre><br>  <code>PUT: /productfeatures/12</code> - change connection with <code>id=12</code> </blockquote><br>  Of course, this approach is also not without flaws, since we cannot get, for example, the name of the product and the name of the characteristic without two additional requests.  This is where the mechanism for getting the associated data comes to the rescue. <br><br><h5>  Getting related data </h5><br><blockquote>  <code>GET: /productfeatures/12?with=product,feature</code> ‚Äî getting connected with the product and features.  Example of server response: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"12"</span></span>, <span class="hljs-string"><span class="hljs-string">"feature_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>, <span class="hljs-string"><span class="hljs-string">"product_id"</span></span>:<span class="hljs-string"><span class="hljs-string">"42"</span></span>, <span class="hljs-string"><span class="hljs-string">"value"</span></span>:<span class="hljs-string"><span class="hljs-string">"33"</span></span>, <span class="hljs-string"><span class="hljs-string">"feature"</span></span>:{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"unit"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>}, <span class="hljs-string"><span class="hljs-string">"product"</span></span>:{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"42"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, ...}, }</code> </pre></blockquote><br><br>  In the same way, you can get all the characteristics of the product: <br><blockquote>  <code>GET: /products/42?with=features</code> - getting product data with <code>id=42</code> and all its characteristics in the array.  Example of server response: <br><pre> <code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"42"</span></span>, <span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">"features"</span></span>:[{<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"unit"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>}, {<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>,<span class="hljs-string"><span class="hljs-string">"unit"</span></span>:<span class="hljs-string"><span class="hljs-string">""</span></span>}], ... }</code> </pre></blockquote><br>  Looking ahead, I will say that using <code>with</code> you can get data not only from related tables, but also simply describe an array with values.  This is useful, for example, when you need to transfer a list of possible values ‚Äã‚Äãof its status along with the product data.  The status of the goods is stored in the <code>status</code> field, but the resulting <code>status:0</code> value will not tell us much.  To do this, together with the product data, you can get its possible statuses with their description: <br><pre> <code class="javascript hljs">{ ..., <span class="hljs-string"><span class="hljs-string">"status"</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"statuses"</span></span>:{<span class="hljs-number"><span class="hljs-number">0</span></span>:<span class="hljs-string"><span class="hljs-string">"  "</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>, <span class="hljs-number"><span class="hljs-number">2</span></span>:<span class="hljs-string"><span class="hljs-string">" "</span></span>}, ..., }</code> </pre><br><br><h4>  Data deletion </h4><br><blockquote> <code>DELETE: /role/42 -    id=42</code> <br> <code>DELETE: /role -   </code> </blockquote> <br>  When deleting, you can also use search and filtering: <br><blockquote> <code>DELETE: /role?filter={"name":"admin"} -     "admin"</code> </blockquote> <br><br><h5>  Data creation </h5><br><blockquote> <code>POST: /role -  </code> </blockquote> <br>  One request can create both one record and a collection by passing an array of data in the request body, for example: <br><pre> <code class="javascript hljs">[ {<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"guest"</span></span>} ]</code> </pre><br>  Thus two roles with the corresponding names will be created.  The server response in this case will also be an array of records created. <br><br><h5>  Data change </h5><br>  All by analogy with the creation, it is only necessary to specify the id parameter in the url and the method, of course, PUT: <br><blockquote> <code>PUT: /role/42 -   42</code> </blockquote> <br>  Change multiple entries: <br><blockquote> <code>PUT: /role</code> <br>  passing in the request body <br><pre> <code class="javascript hljs">[ {<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"1"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, {<span class="hljs-string"><span class="hljs-string">"id"</span></span>:<span class="hljs-string"><span class="hljs-string">"2"</span></span>,<span class="hljs-string"><span class="hljs-string">"name"</span></span>:<span class="hljs-string"><span class="hljs-string">"guest"</span></span>} ]</code> </pre><br>  records with id 1 and 2 will be changed. </blockquote><br>  Change records found by filter: <br><blockquote> <code>PUT: /user?filter={"role":"guest"}' -    role=guest</code> <br> </blockquote><br><br><h5>  Limit, offset and order of entries </h5><br>  For partial sampling, the usual <code>limit</code> and <code>offset</code> . <br><br>  <code>offset</code> - starting from zero <br>  <code>limit</code> - number of records <br>  <code>order</code> - sorting order <br><blockquote> <code>GET: /users/?offset=10&amp;limit=10</code> <br> <code>GET: /users/?order=id DESC</code> <br> <code>GET: /users/?order=id ASC</code> </blockquote> <br>  You can combine: <br><blockquote> <code>GET: /users/?order=parent_id ASC,ordering ASC</code> </blockquote> <br><br>  It is important to mention how the limit and offset appear in the response.  I have considered several options, for example, to transmit data in the response body: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">data</span></span>:[ {<span class="hljs-attr"><span class="hljs-attr">id</span></span>:<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"Alex"</span></span>, <span class="hljs-attr"><span class="hljs-attr">role</span></span>:<span class="hljs-string"><span class="hljs-string">"admin"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">id</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">name</span></span>:<span class="hljs-string"><span class="hljs-string">"Dmitry"</span></span>, <span class="hljs-attr"><span class="hljs-attr">role</span></span>:<span class="hljs-string"><span class="hljs-string">"guest"</span></span>} ], <span class="hljs-attr"><span class="hljs-attr">meta</span></span>:{ <span class="hljs-attr"><span class="hljs-attr">total</span></span>:<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">offset</span></span>:<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-attr"><span class="hljs-attr">limit</span></span>:<span class="hljs-number"><span class="hljs-number">10</span></span> } }</code> </pre><br>  On the client side, I used AngularJS.  It seemed to me very convenient implementation of the <code>$resource</code> mechanism in it.  I will not delve into its features, the fact is that for comfortable work with it, it is better to get clean data without too much information.  Therefore, data on the number of selected records were moved to the headers: <br><blockquote> <code>GET: roles?limit=5</code> <br> <code>Content-Range:items 0-4/10 -    0  4,  10.</code> </blockquote> <br>  It is important to note that the heading above indicates that not 4 entries were received, but 5 (zero-based).  Those.  when all 10 entries are received, the header will look like: <br><blockquote> <code>Content-Range:items 0-9/10 -    0  9  10.</code> </blockquote> <br>  Parse such a header on the client is not difficult, and the response body is no longer clogged with ‚Äúredundant‚Äù data. <br><br><h4>  Implementation on the server. </h4><br>  The first step is to create a module.  Of course, this is not a mandatory requirement, but the module fits perfectly for this.  You can also include the API version in the module name. <br><br>  Next, we add several rules to the application config for proper routing according to the url and request method: <br><br><pre> <code class="php hljs"> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/list'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'GET'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/view'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'GET'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/create'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'POST'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/update'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'PUT'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/update'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'PUT'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/delete'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'DELETE'</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'api/&lt;controller&gt;/delete'</span></span>, <span class="hljs-string"><span class="hljs-string">'pattern'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'api/&lt;controller:\w+&gt;'</span></span>, <span class="hljs-string"><span class="hljs-string">'verb'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'DELETE'</span></span>),</code> </pre><br>  I think that for people at least some familiar with the framework, there is nothing to explain. <br>  Next, we include the <code>ApiController.php</code> , <code>Controller.php</code> and <code>ApiRelationProvider.php</code> any convenient way. <br><br><h4>  API module controllers </h4><br>  All API module controllers must extend the <code>ApiController</code> class. <br>  From the settings of the router it is clear that the following <code>actions</code> should be implemented in the controllers: <br><blockquote>  <code>actionView()</code> - getting record <br>  <code>actionList()</code> - getting list of entries <br>  <code>actionCreate()</code> - creating an entry <br>  <code>actionUpdate()</code> - record change <br>  <code>actionDelete()</code> - delete record </blockquote><br>  Consider the example of the user role controller.  As I said earlier, the RBAC framework keeps all entities (roles, operations and tasks) in one table ( <code>authitem</code> ).  The type of an entity is determined by the <code>type</code> flag in this table.  Those.  <code>RolesController</code> , <code>OperationsController</code> , <code>TasksController</code> should work with one model ( <code>AuthItems</code> ), but their scope should be limited to only those records that have the appropriate <code>type</code> value. <br><br>  <b>Controller code:</b> <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">RolesController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, $module = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AuthItem(<span class="hljs-string"><span class="hljs-string">'read'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;baseCriteria = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> CDbCriteria(); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;baseCriteria-&gt;addCondition(<span class="hljs-string"><span class="hljs-string">'type='</span></span>.AuthItem::ROLE_TYPE); <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($id, $module); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'getRole'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getView(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'getRole'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getList(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'createRole'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;setScenario(<span class="hljs-string"><span class="hljs-string">'create'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;priorityData = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'type'</span></span>=&gt;AuthItem::ROLE_TYPE); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;create(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'updateRole'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;setScenario(<span class="hljs-string"><span class="hljs-string">'update'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;priorityData = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'type'</span></span>=&gt;AuthItem::ROLE_TYPE); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;update(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">( )</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'deleteRole'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model-&gt;setScenario(<span class="hljs-string"><span class="hljs-string">'delete'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;delete(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getRelations</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'roleoperations'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'relationName'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'operations'</span></span>, <span class="hljs-string"><span class="hljs-string">'columnName'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'operations'</span></span>, <span class="hljs-string"><span class="hljs-string">'return'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'array'</span></span> ) ); } }</code> </pre><br><br>  First of all, in the constructor method, we specify the model with which the controller will work, assigning the model instance to the model property of the controller. <br><br>  <code>baseCriteria</code> specifying the <code>baseCriteria</code> property and assigning a condition to it ( <code>addCondition('type='.AuthItem::ROLE_TYPE)</code> ), we determine that for any data received from the client, this condition must be met.  Thus, when selecting records for getting, updating and deleting data, records are used that match the condition <code>type=2</code> and even if there is an entry in the table with the required <code>id</code> value, but the <code>type</code> will be different from the one specified in <code>baseCriteria</code> client will receive a 404 error. <br><br>  Also, in the <code>actionCreate()</code> method, the value of the <code>priorityData</code> property is set, which specifies the data set that will override any data received in the request body from the client.  Ie even if the client specified in the request body the <code>type</code> property equal to 42, it will still be redefined to the value <code>AuthItem::ROLE_TYPE</code> (2) and will not allow creating an entity other than a role. <br><br>  Before performing any operation, the user‚Äôs rights are checked using the <code>checkAccess()</code> method and the scripts for working with the model are specified, since any validation rules or triggers can be defined in the model logic depending on the scenario. <br><br>  All action methods ( <code>getView()</code> , <code>getList()</code> , <code>create()</code> , <code>update()</code> , <code>delete()</code> ) by default send data to the user and terminate the execution of the application.  When the first parameter is set to <code>false</code> , the methods will return the response as an array.  This can be useful when you need to clear some attributes (passwords, etc.) in the data obtained from the model before sending it to the user.  The response code in this case can be obtained through the <code>statusCode</code> property, which will be filled after the method is executed. <br><br>  The latter method of the <code>getRelations()</code> controller is used to configure model relationships.  The method must return an array describing the set of links.  In this case, specifying the <code>...?with=roleoperations</code> parameter in the url, we will receive along with the role data all the operations assigned to it: <br><pre> <code class="javascript hljs">{ <span class="hljs-attr"><span class="hljs-attr">bizrule</span></span>: <span class="hljs-literal"><span class="hljs-literal">null</span></span> description: <span class="hljs-string"><span class="hljs-string">"Administrator"</span></span> id: <span class="hljs-string"><span class="hljs-string">"1"</span></span> name: <span class="hljs-string"><span class="hljs-string">"admin"</span></span> operations: [{...}, {...},...] type: <span class="hljs-string"><span class="hljs-string">"2"</span></span> }</code> </pre><br>  In the array returned by the <code>getRelations()</code> method, the array key is the name of the connection that corresponds to the GET parameter (in this case, <code>roleoperations</code> ). <br>  The value of the elements of the array configuring the connection: <br><table><tbody><tr><td width="200"> <code>relationName</code> <br> </td><td width="150"> <code>string</code> <br> </td><td>  The name of the connection in the model.  If the model has no connection with the corresponding.  the name of the framework will try to get a property with that name or execute the method by substituting <code>get</code> with it.  For example, the model method can also act as a connection: to do this, you need to specify the name of the connection, for example, <code>possibleValues</code> and create a <code>getPossibleValues()</code> method in the model that returns an array of data. <br></td></tr><tr><td> <code>columnName</code> <br> </td><td> <code>string</code> <br> </td><td>  The name of the attribute to which the found entries in the server response will be added. <br></td></tr><tr><td> <code>return</code> <br> </td><td> <code>string ('array' | 'object')</code> <br> </td><td>  Return an array of objects (models) or an array of values. <br></td></tr></tbody></table><br><br>  I must say that in most cases, the controllers look much simpler than the one above.  Here is an example of a controller from one of my projects: <br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?php</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TagController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiController</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($id, $module = null)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;model = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Tag(<span class="hljs-string"><span class="hljs-string">'read'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">parent</span></span>::__construct($id, $module); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getView(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getList(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'createTag'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;create(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionUpdate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'updateTag'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;update(); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">actionDelete</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!Yii::app()-&gt;user-&gt;checkAccess(<span class="hljs-string"><span class="hljs-string">'deleteTag'</span></span>)){ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;accessDenied(); } <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;delete(); } }</code> </pre><br><br>  Brief description of the <b><code>ApiController</code></b> class: <br><br>  <b>Properties:</b> <table><tbody><tr><th width="200">  Property <br></th><th width="120">  Type of <br></th><th>  Description <br></th></tr><tr><td> <code>data</code> <br> </td><td>  array <br></td><td>  Data from the request body.  Both the data from the request using <code>Content-Type: x-www-form-urlencoded</code> and the <code>Content-Type: application/json</code> will get into the array. <br></td></tr><tr><td> <code>priorityData</code> <br> </td><td>  array <br></td><td>  The data to be replaced or added to the data from the request body (data) when performing data creation and modification operations. <br></td></tr><tr><td> <code>model</code> <br> </td><td>  CActiveRecord <br></td><td>  An instance of the model for working with data. <br></td></tr><tr><td> <code>statusCode</code> <br> </td><td>  integer <br></td><td>  Server response code.  The original value is <code>200</code> . <br></td></tr><tr><td> <code>criteriaParams</code> <br> </td><td>  array <br></td><td>  Initial sampling parameters ( <code>limit</code> , <code>offset</code> , <code>order</code> ).  The values ‚Äã‚Äãobtained from the GET request parameters override the corresponding values ‚Äã‚Äãin the array. <br>  Initial value: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'limit'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'offset'</span></span> =&gt; <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'id ASC'</span></span> )</code> </pre><br></td></tr><tr><td> <code>contentRange</code> <br> </td><td>  array <br></td><td>  Data on the number of selected records.  Example: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'total'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-string"><span class="hljs-string">'start'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">6</span></span>, <span class="hljs-string"><span class="hljs-string">'end'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">15</span></span> )</code> </pre><br></td></tr><tr><td> <code>sendToEndUser</code> <br> </td><td>  boolean <br></td><td>  Whether to send data to the user after completion of the operation (view, create, modify, delete) or return the result of the action as an array. <br></td></tr><tr><td> <code>criteria</code> <br> </td><td>  CDbCriteria <br></td><td>  An instance of the <code>CDbCriteria</code> class for fetching data.  Configurable based on data from the request (limit, offset, order, filter, search, etc.) <br></td></tr><tr><td> <code>baseCriteria</code> <br> </td><td>  CDbCriteria <br></td><td>  The base instance of the <code>CDbCriteria</code> class for fetching data.  Object conditions take precedence over <code>criteria</code> . <br></td></tr><tr><td> <code>notFoundErrorResponse</code> <br> </td><td>  array <br></td><td>  Server response with no entry found. <br></td></tr></tbody></table><br>  <b>Methods:</b> <br><br><ul><li>  <b>getView ()</b> <br>  Performs a record search according to GET parameters.  Returns an array of write parameters or sends data to the user.  If the record is not found - sends the user an error message with the response code 404 or returns an array with the appropriate information about the error.  Sets the <code>statusCode</code> property to the appropriate value after the query is executed. <br><table><tbody><tr><td colspan="3"> <code>getView(boolean $sendToEndUser = true, integer $id)</code> <br> </td></tr><tr><td width="200">  $ sendToEndUser <br></td><td width="120">  boolean <br></td><td>  Whether to send data to the user after the operation is completed or to return the result of the action as an array. <br></td></tr><tr><td>  $ id <br></td><td>  integer <br></td><td>  Record id parameter.  If not transmitted - filled in from GET parameters. <br></td></tr></tbody></table><br></li><li>  <b>getList ()</b> <br>  Searches for records according to GET parameters.  Returns an array of found records or an empty array. <br><table><tbody><tr><td colspan="3"> <code>getList(boolean $sendToEndUser = true)</code> <br> </td></tr><tr><td width="200">  $ sendToEndUser <br></td><td width="120">  boolean <br></td><td>  Whether to send data to the user after the operation is completed or to return the result of the action as an array. <br></td></tr></tbody></table><br></li><li>  <b>create ()</b> <br>  Creates a new record with data retrieved from the request body.  If the array of attributes is transmitted in the request body, the corresponding number of records will be recognized.  Returns an array with the attributes of the new record. <br>  For example: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Alex'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'25'</span></span> ) <span class="hljs-comment"><span class="hljs-comment">//    . </span></span></code> </pre><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Alex'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'25'</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Dmitry'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'33'</span></span> ) ) <span class="hljs-comment"><span class="hljs-comment">//     . </span></span></code> </pre><br><table><tbody><tr><td colspan="3"> <code>create(boolean $sendToEndUser = true)</code> <br> </td></tr><tr><td width="200">  $ sendToEndUser <br></td><td width="120">  boolean <br></td><td>  Whether to send data to the user after the operation is completed or to return the result of the action as an array. <br></td></tr></tbody></table><br></li><li>  <b>update ()</b> <br>  Updates the record found in accordance with the received GET parameters.  Returns an array of write parameters or sends data to the user.  If the record is not found - sends the user an error message with the response code 404 or returns an array with the appropriate information about the error.  If an array of records is transmitted in the request body, the corresponding number of records will be changed and the array with their values ‚Äã‚Äãwill be returned. <br>  For example: <br><blockquote> <code>PUT: users/1</code> </blockquote> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Alex'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'25'</span></span> ) <span class="hljs-comment"><span class="hljs-comment">//        GET </span></span></code> </pre><br><blockquote> <code>PUT: users</code> </blockquote> <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Alex'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'25'</span></span> ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'id'</span></span>=&gt;<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">'name'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'Dmitry'</span></span>, <span class="hljs-string"><span class="hljs-string">'age'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'33'</span></span> ) ) <span class="hljs-comment"><span class="hljs-comment">//        id     .      url</span></span></code> </pre><br><table><tbody><tr><td colspan="3"> <code>update(boolean $sendToEndUser = true, integer $id)</code> <br> </td></tr><tr><td width="200">  $ sendToEndUser <br></td><td width="120">  boolean <br></td><td>  Whether to send data to the user after the operation is completed or to return the result of the action as an array. <br></td></tr><tr><td>  $ id <br></td><td>  integer <br></td><td>  Record id parameter.  If not transmitted - filled in from GET parameters. <br></td></tr></tbody></table><br></li><li>  <b>delete ()</b> <br>  Deletes the entry found in accordance with the received GET parameters.  Returns an array of remote write parameters or send data to a user.  If the record is not found - sends the user an error message with the response code 404 or returns an array with the appropriate information about the error.  If id parameter is not received, all records will be deleted. <br><table><tbody><tr><td colspan="3"> <code>delete(boolean $sendToEndUser = true, integer $id)</code> <br> </td></tr><tr><td width="200">  $ sendToEndUser <br></td><td width="120">  boolean <br></td><td>  Whether to send data to the user after the operation is completed or to return the result of the action as an array. <br></td></tr><tr><td>  $ id <br></td><td>  integer <br></td><td>  Record id parameter.  If not transmitted - filled in from GET parameters. <br></td></tr></tbody></table><br></li></ul><br><br><h4>  Testing </h4><br>  Studying the question of testing API, I considered a variety of approaches.  Most advised not to use unit testing, but functional.  But having tried several functional testing methods (using <a href="http://docs.seleniumhq.org/">Selenium</a> and even <a href="http://phantomjs.org/">PhantomJs</a> ), with such incredible methods as creating a form with the means of selenium, adding input fields to it, filling them with data and sending them by clicking on the submit button and then analyzing the server response, I realized that so testing will take years! <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Immersed in the search for deeper, and analyzing the experience of other developers, I wrote a class for testing API using curl. To use it, you need to connect a class </font></font><code>ApiTestCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and extend test classes from it. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The first problem I encountered when testing the API was an access problem. During testing, a test base is used. Thus, it is necessary to constantly monitor that it always contains actual data in the tables used by RBAC, otherwise trying to test the creation of an entity, you can get a response </font></font><code>{"error":{"access":"You do not have sufficient permissions to access."}}</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">with the code 403. And besides, you need to teach the tests to authorize and send authorization cookies for the same reason for restricting access rights in the actions of the API controllers. To solve this problem, I decided to use the working base for component operation.</font></font><code>authManager</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> which deals with access rights, specifying the following in the configuration file of the test environment (config / test.php): </font></font><br><pre> <code class="php hljs">... <span class="hljs-string"><span class="hljs-string">'proddb'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'class'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'CDbConnection'</span></span>, <span class="hljs-string"><span class="hljs-string">'connectionString'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'mysql:host=localhost;dbname=yiirestmodel'</span></span>, <span class="hljs-string"><span class="hljs-string">'emulatePrepare'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>, <span class="hljs-string"><span class="hljs-string">'username'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">'charset'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'utf8'</span></span>, ), <span class="hljs-comment"><span class="hljs-comment">//    'db'=&gt;array( 'connectionString' =&gt; 'mysql:host=localhost;dbname=yiirestmodel-test', ), //    'authManager'=&gt;array( 'connectionID'=&gt;'proddb', //   ), ...</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The only limitation of this approach is that you need to ensure that in the user table the id value of the user being logged in is the same in both databases, since if your admin database is on the test database </font></font><code>id=1</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, the administrator is assigned to the user as a working member, </font></font><code>id=42</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">then the component will not consider that user as the administrator!</font></font><br><br>  Test example: <br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UsersControllerTest</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ApiTestCase</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $fixtures = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'users'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'User'</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testActionView</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $user = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;users(<span class="hljs-string"><span class="hljs-string">'admin'</span></span>); $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'api/users/'</span></span>.$user-&gt;id, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAuthCookies())); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($response[<span class="hljs-string"><span class="hljs-string">'code'</span></span>], <span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertNotNull($response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>], $user-&gt;id); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertArrayNotHasKey(<span class="hljs-string"><span class="hljs-string">'password'</span></span>, $response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertArrayNotHasKey(<span class="hljs-string"><span class="hljs-string">'guid'</span></span>, $response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testActionList</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;get(<span class="hljs-string"><span class="hljs-string">'api/users'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAuthCookies())); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($response[<span class="hljs-string"><span class="hljs-string">'code'</span></span>], <span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals(count($response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]), User::model()-&gt;count()); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">testActionCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>{ $response = <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;post( <span class="hljs-string"><span class="hljs-string">'api/users'</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'first_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new_first_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'middle_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new_middle_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'last_name'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new_last_name'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new_user_psw'</span></span>, <span class="hljs-string"><span class="hljs-string">'password_repeat'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'new_user_psw'</span></span>, <span class="hljs-string"><span class="hljs-string">'role'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">'guest'</span></span>, ), <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'cookies'</span></span>=&gt;<span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;getAuthCookies()) ); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertEquals($response[<span class="hljs-string"><span class="hljs-string">'code'</span></span>], <span class="hljs-number"><span class="hljs-number">200</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertNotNull($response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertArrayHasKey(<span class="hljs-string"><span class="hljs-string">'id'</span></span>, $response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertArrayNotHasKey(<span class="hljs-string"><span class="hljs-string">'password'</span></span>, $response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;assertNotNull( User::model()-&gt;findByPk($response[<span class="hljs-string"><span class="hljs-string">'decoded'</span></span>][<span class="hljs-string"><span class="hljs-string">'id'</span></span>]) ); } }</code> </pre><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the beginning we specify the fixtures used in the tests. </font><font style="vertical-align: inherit;">Further, in the test method, we make a request using the method </font></font><code>ApiTestCase::get()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">(performing the request with the GET method) passing the url and authorization cookies to it obtained by calling the method </font></font><code>ApiTestCase::getAuthCookies()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">In order to get these same cookies you need to specify the parameters </font></font><code>$loginUrl</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">and </font></font><code>$loginData</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font><font style="vertical-align: inherit;">I have them listed directly in the class </font></font><code>ApiTestCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">in order not to register them in each class of the test:</font></font><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $loginUrl = <span class="hljs-string"><span class="hljs-string">'api/login'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> $loginData = <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'login'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>);</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I must say that the method </font></font><code>ApiTestCase::getAuthCookies()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">is smart enough not to make an authorization request for each call, but to return cached data. </font><font style="vertical-align: inherit;">To re-run the query, you can pass the first parameters </font></font><code>true</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Method ApiTestCase :: get () (as </font></font><code>ApiTestCase::post()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ApiTestCase::put()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">, </font></font><code>ApiTestCase::delete()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">) returns an array of data executed query with the following structure:</font></font><br><table><tbody><tr><td colspan="3"> <code>body</code> <br> </td><td width="200">  string <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Server response </font></font><br></td></tr><tr><td colspan="3"> <code>code</code> <br> </td><td width="200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> integer </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Response code </font></font><br></td></tr><tr><td colspan="3"> <code>cookies</code> <br> </td><td width="200">  array <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An array of cookies received in response </font></font><br></td></tr><tr><td colspan="3"> <code>headers</code> <br> </td><td width="200">  array <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> An array of headers received in the response (header name =&gt; header value). For example: </font></font><br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'Date'</span></span> =&gt; <span class="hljs-string"><span class="hljs-string">"Fri, 23 May 2014 12:10:37 GMT"</span></span> <span class="hljs-string"><span class="hljs-string">'Server'</span></span> =&gt;<span class="hljs-string"><span class="hljs-string">"Apache/2.4.7 (Win32) OpenSSL/1.0.1e PHP/5.5.9"</span></span> ... )</code> </pre><br></td></tr><tr><td colspan="3"> <code>decoded</code> <br> </td><td width="200">  array <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Array of decoded (json_decode) server response </font></font><br></td></tr></tbody></table><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This data is enough to fully test and analyze the server response. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After receiving the answer to the request, various asserts are checked which are quite obvious and do not need comments. </font><font style="vertical-align: inherit;">Of course, this is not the complete test code for the entity, but this example is enough to understand the principle of working with the class </font></font><code>ApiTestCase</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Brief class description </font></font><b><code>ApiTestCase</code></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">: </font></font><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Properties:</font></font></b> <br><table><tbody><tr><th width="200"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Property </font></font><br></th><th width="120">  Type of <br></th><th>  Description <br></th></tr><tr><td> <code>authCookies</code> <br> </td><td>  array <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Cookies received after authorization (method call </font></font><code>ApiTestCase::getAuthCookies()</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">)</font></font><br></td></tr><tr><td> <code>loginUrl</code> <br> </td><td>  string <br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The address for completing the authorization request for authorization cookies. </font></font><br></td></tr><tr><td> <code>loginData</code> <br> </td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> array () </font></font><br></td><td><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The array that will be transmitted in the body of the authorization request. </font></font> Default: <br><pre> <code class="php hljs"><span class="hljs-keyword"><span class="hljs-keyword">array</span></span>(<span class="hljs-string"><span class="hljs-string">'login'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>=&gt;<span class="hljs-string"><span class="hljs-string">'admin'</span></span>);</code> </pre><br></td></tr></tbody></table><br> <b> :</b> <br><ul><li> <b>getAuthCookies()</b> <br>   . <br><table><tbody><tr><td colspan="3"> <code>getAuthCookies(boolean $reload = false)</code> <br> </td></tr><tr><td width="200"> $reload <br></td><td width="120"> boolean <br></td><td>             . <br></td></tr></tbody></table><br></li><li> <b>get()</b> <br>    GET.      . <br><table><tbody><tr><td colspan="3"> <code>get( string $url, array $params = array(), array $options = array()){</code> <br> </td></tr><tr><td width="200"> $url <br></td><td width="120">  string <br></td><td> Url     <br></td></tr><tr><td width="200"> $params <br></td><td width="120">  array <br></td><td>  GET   <br></td></tr><tr><td width="200"> $options <br></td><td width="120">  array <br></td><td>  ,      <code>curl_setopt_array</code> .       <code>cookies</code> ,      (=&gt;)       . <br></td></tr></tbody></table><br></li><li><a name="ApiTestCase_post"></a> <b>post()</b> <br>    POST.      . <br><table><tbody><tr><td colspan="3"> <code>post( string $url, array $params = array(), array $options = array()){</code> <br> </td></tr><tr><td width="200"> $url <br></td><td width="120">  string <br></td><td> Url     <br></td></tr><tr><td width="200"> $params <br></td><td width="120">  array <br></td><td>        <br></td></tr><tr><td width="200"> $options <br></td><td width="120">  array <br></td><td>  ,      <code>curl_setopt_array</code> .       <code>cookies</code> ,      (=&gt;)       . <br></td></tr></tbody></table><br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">put ()</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Performs a PUT request. </font><font style="vertical-align: inherit;">Returns an array with server response parameters. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter description see </font></font><a href="https://habr.com/ru/post/224199/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApiTestCase :: post ()</font></font></a> <br></li><li> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">delete ()</font></font></b> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Executes a query with the DELETE method. </font><font style="vertical-align: inherit;">Returns an array with server response parameters. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Parameter description see </font></font><a href="https://habr.com/ru/post/224199/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ApiTestCase :: post ()</font></font></a> <br></li></ul><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link to </font></font><a href="https://github.com/goodnickoff/yiirestmodel"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">github</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> .</font></font><br><br><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Of course, problems may arise with large loads, as it is used to work with data </font></font><code>ActiveRecord</code><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">. I think this can be partially solved by caching (good for that in Yii is everything you need). </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I hope that there will be developers who will be useful if not the whole extension, then any parts or just ideas applied in it. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Future plans still have a lot of various improvements and changes, so I will be grateful for any comments and suggestions.</font></font><br><br><h4>  PS </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The article turned out to be large (although it did not work out to describe even half of what was intended) and somewhat "torn". </font><font style="vertical-align: inherit;">If the information will be useful in the future I would like to describe some more points. </font><font style="vertical-align: inherit;">For example, how authorization was implemented, collections were received (a combination of requests into one), etc. </font><font style="vertical-align: inherit;">I would also like to talk about how I interacted with the API on the client side using AngularJS tools and how to create one-page applications search engine friendly (with page rendering through PhantomJs).</font></font></div><p>Source: <a href="https://habr.com/ru/post/224199/">https://habr.com/ru/post/224199/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224187/index.html">WEB-page rendering: what the front-end developer should know about this</a></li>
<li><a href="../224191/index.html">Minification of Ext JS and Sencha Touch applications using ASP.NET</a></li>
<li><a href="../224193/index.html">Through hardship to the stars. To the imperatives of cosmic colonialism</a></li>
<li><a href="../224195/index.html">Writing a Simple SailsJS Blog: Visual Practice for Beginners (Part 1)</a></li>
<li><a href="../224197/index.html">Sunduk or 10 seconds per name</a></li>
<li><a href="../224205/index.html">When AES (‚ò¢) = ‚ò† - cryptobinary focus</a></li>
<li><a href="../224207/index.html">Implementing a quick import from Excel to PHP</a></li>
<li><a href="../224209/index.html">InterSystems Ensemble 2014 Integration Platform Release</a></li>
<li><a href="../224217/index.html">Announcement - Artem Gavrichenkov from Qrator will tell in Moscow about DDoS attacks</a></li>
<li><a href="../224221/index.html">Learning through lectures is inefficient, scientists say</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>