<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Virus analysis for beginners - we analyze Virus.Win32.MTV</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I finally found the time not just to analyze the malware, but also to write another article on this topic. Let's start, perhaps. Today we will analyze...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Virus analysis for beginners - we analyze Virus.Win32.MTV</h1><div class="post__text post__text-html js-mediator-article">  I finally found the time not just to analyze the malware, but also to write another article on this topic.  Let's start, perhaps.  Today we will analyze the virus Virus.Win32.MTV.4608.a, which was discovered back in 2000.  Let the date of detection of the virus does not bother you - never analyze the virus even such old.  You can take it at vx.netlux.org. <br><br>  Required tools: any disassembler or debugger of your choice. <br><a name="habracut"></a><br>  So, load our test file into any disassembler or debugger.  We see quite a pleasant code for analysis - no packaging, no obfuscation, no anti-debugging - everything is clearly visible.  Immediately struck by the line: "Copyright 1989-2000 Borland Inc.  Borland C ++ run-time library ‚Äù, which determines the language and version of the compiler in which this virus was written.  We begin, directly, the analysis of the functionality of the virus in great detail.  Program execution begins at the following location: <br><br>  00401000&gt; MOV ESI, Virus.004032A8 <br>  00401005 MOV ECX, 2D <br>  0040100A&gt; MOV AL, BYTE PTR DS: [ESI] <br>  0040100C XOR AL, 3 <br>  0040100E MOV BYTE PTR DS: [ESI], AL <br>  00401010 INC ESI <br>  00401011 ^ LOOPD SHORT Virus.0040100A 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This cycle performs the decoding of string constants located at 0x004032A8 size 0x2D bytes.  After decryption we get this: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/528/812/d09/528812d095e1710028ebfa864bcc077f.jpg" alt="image"></div><br>  Further the following code will be executed: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e2b/b29/7de/e2bb297dec95a53165949fb3dac53567.jpg" alt="image"></div><br>  It is easy to see that the program determines its location on the disk, opens its own file for reading, finds out its size and loads it into a specially allocated area of ‚Äã‚Äãmemory.  What for?  Let's understand further.  And now we note that for any unfavorable event for a program, it displays a message box and shuts down Windows: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/28c/c81/e32/28cc81e32d4b5044679d1ba861225070.jpg" alt="image"></div><br>  Now pay attention to the following place: <br><br>  004010CD CMP EAX, 1200 <br>  004010D2 JE Virus.004011D2 <br><br>  Here the program compares its physical size with the constant 0x1200 and, depending on this operation, continues its execution in various ways.  The size of the current file is also 0x1200.  You can make the assumption that this instance of the program is the source file of the virus, which will later be confirmed.  See what happens if the file size is different from 0x1200: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/961/1a4/157/9611a4157e9b69af449e92f6b55d09ce.jpg" alt="image"></div><br>  First, the program creates a temporary file, and then decrypts a certain area of ‚Äã‚Äãmemory in the following cycle: <br><br>  00401152&gt; MOV AL, BYTE PTR DS: [ESI] <br>  00401154 XOR AL, 3 <br>  00401156 MOV BYTE PTR DS: [ESI], AL <br>  00401158 INC ESI <br>  00401159 ^ LOOPD SHORT Virus.00401152 <br><br>  Encryption is a simple byte XOR.  What area of ‚Äã‚Äãmemory does the program decode?  This area is the buffer in which the program has previously recorded the contents of the current executable file, and the decryption begins at an offset of 0x1200.  You have not guessed what is happening?  We look further - after this, the program writes the decrypted data into a temporary file and launches the latter for execution, passing the current command line parameters.  Now we can safely say that this program infects executable files in the most primitive way, encrypting their contents and dumping the resulting encrypted data into an overlay of its own file, which is written instead of the program to be infected.  And when it starts, the virus decrypts the overlay, saves it to a temporary file and launches the source program for execution.  Simple and trite. <br>  We now find out what happens next: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/221/fdc/4c4/221fdc4c474a6ec2517500aa796dddf5.jpg" alt="image"></div><br>  Then the program starts another stream and waits for the completion of both the source program and the thread created.  What happens in the created thread? <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7c4/f4a/efd/7c4f4aefd3a005ff19e8c9f01946e530.jpg" alt="image"></div><br>  The program determines whether a copy of the virus is already running on the system by checking the existence of the global identifier ‚ÄúMTV-2‚Äù - if it exists, then a copy of the virus is already running, otherwise this identifier is created, after which another virus function is called.  Let's see what she does: <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/481/89c/9e9/48189c9e9a0c4b5ec2ca75307d9899a2.jpg" alt="image"></div><br>  As expected, this is a recursive crawl of folders on the disk that infects all the executable files found.  I was interested in two points here.  The first - the function proceeds to processing the next file only after 5 seconds due to the WinAPI delay by the Sleep function.  From this it follows that the virus will go through all the files very, very slowly and hang on the task list all the time.  Well, the following code: <br><br>  004013C6 PUSH Virus.004032D6 <br>  004013CB CALL JMP. &amp; KERNEL32.GetSystemTime <br>  004013D0 CMP WORD PTR DS: [4032DC], 0D <br>  004013D8 JNZ SHORT Virus_Wi.004013E6 <br>  004013DA PUSH Virus.004031A6 <br>  004013DF CALL JMP. &amp; KERNEL32.DeleteFileA <br><br>  If today is the 13th of any month, then the function deletes all found files ... This is where all the poor functionality of this virus ends. <br><br>  Conclusions: today we have disassembled a virus simple in the device and fast in writing, the creation of which does not require special knowledge and can be done by almost any novice programmer.  At the same time, the functionality of the virus is also extremely poor.  It can be seen that the programmer had no craving for creativity - everything was aimed at quick results.  Although ... I absolutely can not understand for what purpose this virus, in general, is intended?  After 10 years of malware has taken a big step in its development. </div><p>Source: <a href="https://habr.com/ru/post/136103/">https://habr.com/ru/post/136103/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../136097/index.html">High-quality gps monitoring for $ 150</a></li>
<li><a href="../136098/index.html">Protecting electronics from water - a new unique coating</a></li>
<li><a href="../136100/index.html">3D Life - in search of gliders</a></li>
<li><a href="../136101/index.html">Video review of Android applications and games - kedDroid</a></li>
<li><a href="../136102/index.html">Digital Metawatch WDS112 original debug kit from Texas Instruments</a></li>
<li><a href="../136104/index.html">Lovers of open source ERP systems is dedicated</a></li>
<li><a href="../136109/index.html">We assemble a DECT puzzle based on Spectralink equipment</a></li>
<li><a href="../136110/index.html">We create our own framework based on symfony2. (Part 1)</a></li>
<li><a href="../136114/index.html">ASUS non-existent products</a></li>
<li><a href="../136115/index.html">CES 2012: another ‚Äúatomofon‚Äù, a meeting with Paul Otellini, as well as a number of details about what will be ultrabooks</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>