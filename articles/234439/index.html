<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Run objective-c code on Android devices</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Beginning of the story 
 A draft written on cocos2d came to me for revision. A game for children in which you need to collect puzzles and learn words....">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Run objective-c code on Android devices</h1><div class="post__text post__text-html js-mediator-article"><h4>  Beginning of the story </h4><br>  A draft written on cocos2d came to me for revision.  A game for children in which you need to collect puzzles and learn words.  Work as work, but the main problem was that before me a certain girl from India worked on the project.  And then I started a very fun period.  An example of what I had to look at, what to do and how it all ended will be under the cut. <br><br><a name="habracut"></a><br><div class="spoiler">  <b class="spoiler_title">Indocode provides mood for the whole day.</b> <div class="spoiler_text"><pre><code class="objectivec hljs"><span class="hljs-comment"><span class="hljs-comment">//SelectPuzzle.m - (void)imagePickerController:(UIImagePickerController *)pickerView didFinishPickingMediaWithInfo:(NSDictionary *)info { [[NSUserDefaults standardUserDefaults]setObject:nil forKey:@"cameraImage"]; UIImage *resiZedImage=[info objectForKey:UIImagePickerControllerOriginalImage]; UIInterfaceOrientation interfaceOrientation = [[UIApplication sharedApplication] statusBarOrientation]; if (UIInterfaceOrientationIsPortrait(interfaceOrientation)) { isportrait=YES; resiZedImage=[self ImageResize:resiZedImage]; } else { isportrait=NO; resiZedImage=[self imageByCropping:resiZedImage toRect:CGRectMake(800,300,1006,1258)]; } [[NSUserDefaults standardUserDefaults]setInteger:preDefined6 forKey:imageIndex]; [[NSUserDefaults standardUserDefaults]setObject:[NSData dataWithData:UIImagePNGRepresentation(resiZedImage)] forKey:@"cameraImage"]; [[NSUserDefaults standardUserDefaults]synchronize]; [self performSelector:@selector(dismissCameraView:) withObject:pickerView afterDelay:1.0]; [[CCDirector sharedDirector]replaceScene:[PlayScene scene]]; } //PlayScene.m -(void)init{ self = [super init]; if(self){ //... //... camera = YES; NSData* imageData = [[NSUserDefaults standardUserDefaults] objectForKey:@"cameraImage"]; UIImage* cameraImage = [[[UIImage alloc] initWithData:imageData]autorelease]; puzzleObject=[CCSprite spriteWithCGImage:cameraImage.CGImage key:nil]; //... //... } return self; }</span></span></code> </pre> <br></div></div><br><br>  However, the post is not about errors that I had to fix, but quite about another problem. <br>  After several months of work on the project, when the main problems were solved, the customer asked to build a build for his Android device.  Then there was an amazing conversation about the fact that the first developer had to write for cocos2d-x and the application should run easily on any device.  I had to solve the problem and my choice fell on Apportable. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  Actually the topic </h4><br>  According to the official website, Apportable SDK is a system that allows you to run the same xCode project on iOS and Android devices.  First of all, it concerns the games written on cocos2d.  C porting some system Core frameworks has problems. <br>  Our game was written practically on a pure coconut and only in two places UIKit elements were used. <br>  Well then.  Let's get started <br><br>  The first thing to do is install the SDK on a Mac.  To do this, following the instructions on the site, you just need to enter in the terminal <br><br><pre> <code class="bash hljs"> (<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> PATH=~/.apportable/SDK/bin:<span class="hljs-variable"><span class="hljs-variable">$PATH</span></span>) &gt;&gt; ~/.bash_profile; <span class="hljs-built_in"><span class="hljs-built_in">source</span></span> ~/.bash_profile</code> </pre><br><br>  The SDK requires about 2GB of free disk space and xCode 5 installed. <br><br>  While all this is being downloaded, the necessary code can be added to our project. <br>  First, set the screen emulation mode.  There are several options. <br>  For example: <br>  UIScreenIPhone3GEmulationMode - used if your application does not support graphics from retina devices.  The size of the virtual screen 320px / 480px, scale - 1.0 <br>  UIScreenScaledAspectFitEmulationMode - stretches your application in accordance with the screen size of the Android device.  Uses non-retina graphics. <br>  UIScreenBestEmulatedMode - stretches your application in accordance with the screen size of the Android device.  Uses the most appropriate graphics.  For this mode to work correctly, there must be graphics for all variants of iPhone and iPad screens.  Otherwise, it may not look the best. <br><br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">int</span></span> main(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span> argc, <span class="hljs-keyword"><span class="hljs-keyword">char</span></span> *argv[]) { <span class="hljs-keyword"><span class="hljs-keyword">@autoreleasepool</span></span> { <span class="hljs-meta"><span class="hljs-meta">#ifdef ANDROID [UIScreen mainScreen].currentMode = [UIScreenMode emulatedMode:UIScreenAspectFitEmulationMode]; #endif int retVal = UIApplicationMain(argc, argv, nil, @</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"AppController"</span></span></span><span class="hljs-meta">); return retVal; } }</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">All options</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-built_in"><span class="hljs-built_in">NS_ENUM</span></span>(<span class="hljs-built_in"><span class="hljs-built_in">NSUInteger</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenEmulationMode</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">UIScreenIPhone3GEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenIPhone4EmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenIPhone5EmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenIPadEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenIPadRetinaEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenAspectFitEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenScaledAspectFitEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenBestEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenBestEmulatedMode</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">UIScreenBestEmulationMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenNativeMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenNativeRetinaMode</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">UIScreenBestNativeMode</span></span>, };</code> </pre><br></div></div><br><br>  The next thing that had to be redone was the position of the elements. <br><pre> <code class="objectivec hljs">[item setPosition:ccp(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">600</span></span>)];</code> </pre><br>  on <br><pre> <code class="objectivec hljs">[item setPosition:ccp(puzzle.contentSize.width * <span class="hljs-number"><span class="hljs-number">0.2</span></span>, puzzle.contentSize.height * <span class="hljs-number"><span class="hljs-number">0.772</span></span>)];</code> </pre><br>  The same when tracking clicks. <br><br>  After this, go to the project folder in the terminal and enter: <br><pre> <code class="bash hljs"> apportable load</code> </pre><br>  This command will create an apk file, download it to a connected device, install and launch it.  Ideally.  He is not always.  I will not consider file link errors, they are very individual.  However, there is a situation when the apportable does not see any particular device.  At the office of 7 devices on which I tested the application, I could not install on 3. <br>  What to do in this case?  Everything is very simple.  Apportable first creates an apk file and only then tries to download it to the device.  So this file is somewhere there.  More specifically, here it is: <br><pre> <code class="bash hljs"> /Users/username/.apportable/SDK/Build/android-armeabi-debug/ProjectName</code> </pre><br>  In this folder is an apk file and you can simply transfer it to the device and install it.  For this, I used the Android File Transfer application (in the poppy out of the box you cannot access the memory of Android devices). <br><br>  Everything?  Profit?  Unfortunately not. <br>  There was a problem with the camera.  The camera was called, took a photo, but when you clicked the confirmation button, the application fell.  The problem was not googled and promised to bring big problems, but ... Help came from our android developers.  I learned what the manifesto and the permisena are. <br><div class="spoiler">  <b class="spoiler_title">What is this?</b>  <b class="spoiler_title">For iOS developers</b> <div class="spoiler_text">  Analogue of our info.plist.  The manifest contains the basic settings, all rights and configuration. <br></div></div><br><br>  So.  After creating the build using apportable, a folder ProjectName.aproj appeared in the project directory.  In this folder are configuration files and files that are not compiled (for example, resources). <br>  We are interested in the configuration.json file.  In it, you can change the project's compilation settings for android.  For example, add permisheny.  For the camera need the rights to record. <br>  And row change <br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"FEATURES"</span></span>: [<span class="hljs-string"><span class="hljs-string">"opengles2"</span></span>,<span class="hljs-string"><span class="hljs-string">"landscape"</span></span>]</code> </pre> <br>  on <br><pre> <code class="javascript hljs"> <span class="hljs-string"><span class="hljs-string">"FEATURES"</span></span>: [<span class="hljs-string"><span class="hljs-string">"opengles2"</span></span>,<span class="hljs-string"><span class="hljs-string">"landscape"</span></span>,<span class="hljs-string"><span class="hljs-string">"write_external_storage"</span></span>]</code> </pre><br>  magically solved the problem. <br><br>  There is also a nuance with the localization of the application name on the device screen.  For each language, you must add the file <i>strings.xml</i> and put it in the folder ProjectName / java / res / values- [lang_description] <br><br><div class="spoiler">  <b class="spoiler_title">strings.xml</b> <div class="spoiler_text"><pre> <code class="javascript hljs">&lt;?xml version=<span class="hljs-string"><span class="hljs-string">"1.0"</span></span> encoding=<span class="hljs-string"><span class="hljs-string">"utf-8"</span></span>?&gt; <span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">"app_name"</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">Localization name</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">string</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">resources</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span></span></code> </pre><br></div></div><br><br>  And add in configuration.json: <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//A list of java resource directories "java_res_dirs": ["java/res"]</span></span></code> </pre><br><br>  A few points to last: <br><br><ul><li>  There are a lot of screen ramer on Android devices, and in some places you had to use the following inserts: <br><div class="spoiler">  <b class="spoiler_title">Hidden text</b> <div class="spoiler_text"><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#ifdef ANDROID CGRect frame = [UIScreen mainScreen].applicationFrame;//1.7031 - pad 1.778 - phone CGFloat ratio = frame.size.height / frame.size.width; if (ratio </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">&lt; 1.72) { x = 16; } else{ x = 29; } #endif</span></span></span></span></code> </pre> </div></div></li><li>  If the ‚Äúportrait‚Äù flag is not in the configuration.json file, and the Device Orientation in the xCode settings of the project is checked against ‚ÄúPortrait‚Äù, then portrait orientation will be supported.  Be careful. </li><li>  Official <a href="http://docs.apportable.com/">docs.apportable.com</a> documentation </li><li>  In Apportable many system frameworks are added.  Official documentation contains little information about this.  New .h files with new methods available for android can be viewed in the folder <br>  /Users/username/.apportable/SDK/sysroot/System/Library </li></ul></div><p>Source: <a href="https://habr.com/ru/post/234439/">https://habr.com/ru/post/234439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../234427/index.html">Bookmarklet: Analysis of Essential Points, Part One</a></li>
<li><a href="../234429/index.html">Doctors from Peking University for the first time implanted a vertebra printed on a 3D printer to a man</a></li>
<li><a href="../234431/index.html">Interorbital tug</a></li>
<li><a href="../234433/index.html">A magic object for storing and transmitting heterogeneous data with type and value checking</a></li>
<li><a href="../234437/index.html">Low-cost multi-camera FullHD video recording of the concert with their own hands</a></li>
<li><a href="../234441/index.html">How I built a network in Astrakhan for 9 years</a></li>
<li><a href="../234443/index.html">Running VMWare images on real hardware and other nuances of Zalman VE-300</a></li>
<li><a href="../234447/index.html">How to make background-size work in old IE</a></li>
<li><a href="../234457/index.html">Voice recorder as inbox in GTD system</a></li>
<li><a href="../234459/index.html">Overview of the most interesting materials on data analysis and machine learning ‚Ññ10 (August 18 - 25, 2014)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>