<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Newsstand app. Create iOS Journal</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, I have been developing the iOS version of a single paper magazine. Actually, this is an attempt to uncover this very topic. 

 I'll start wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Newsstand app. Create iOS Journal</h1><div class="post__text post__text-html js-mediator-article">  Recently, I have been developing the iOS version of a single paper magazine.  Actually, this is an attempt to uncover this very topic. <br><br>  I'll start with the entry.  What is the Newsstand?  Where did this entity come from and what did it become?  Reflecting, I came to the following: this version of the magazine, wrapped in an iOS program, differs from pdf by a simply insane size.  One of the reasons is a huge pile of pictures.  However, this bunch creates the gloss of the iOS magazine.  The reason for the emergence of the idea of ‚Äã‚ÄãNewsstand, as I understand it, was Apple‚Äôs position on the ownership of certain content.  Those.  the task was to honestly (often charge) distribute periodicals, so much so that it was difficult to copy-paste.  These guys coped with the task - I suppose there is no electronic publishing house with a large cash flow than Newsstand (if I may say so). <a name="habracut"></a><br><br>  After reading, at the user level, with several magazines, it is time to look for a technical solution.  First, the Newsstand Kit surfaced. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The Newsstand Kit consists of the following things: a special library management mechanism (NKLibrary) of individual issues of the magazine (NKIssue) and their loading (NKAssetDownload), including background loading.  Well cool!  However, at that time it was completely unclear to me how to turn these things into a magazine. <br><br>  Yet.  It is obvious that the program-magazine consists of two parts: the management of journal issues and the display of a separate journal.  Those.  Newsstand Kit is focused on the first component - management.  The second component - the display of a single issue of the magazine - Apple did not burden any patterns.  I'll start with her, the second. <br><br>  Theoretically, we have all the necessary information downloaded from our server and must display it.  Those.  it was about the ‚ÄúApplication Brochure‚Äù.  The downloaded information can, conditionally, be divided into raw materials (images, movies, texts, html-iny, pdf-s) and a config, by which we can put all this together.  I suppose that not everyone will be interested in reading about the Brochure, so I‚Äôm sending these further to the management part. <br><br>  As I mentioned above, Apple doesn‚Äôt limit developers a little to the display of a particular magazine.  However, it is probably taken in a good form, flipping through the magazine with a swipe.  For this, I used the UIScrollView and the idea of ‚Äã‚Äãan infinite scrolling (dev apple -&gt; WWDC -&gt; ScrollView Techniques -&gt; Infinite scrolling).  If briefly, then on all main View it is necessary to put UIScrollView.  At UIScrollView, set the contentSize to three screens in width, and put on it, successively three UIViews (each one the size of one screen).  There are a couple of settings, and we have a beautiful swipe on.  At the finish, it remains to implement the delegate method of UIScrollView - scrollViewDidEndDecelerating: - and, according to it, update the internal UIView.  The complication of the endless scrolling - if you invest in the visible UIVeiw another, similar, UIScrollView - leads to horizontal and vertical scrolling. <br><br>  OK.  The question remains: where do we get the UIView that is currently needed? <br>  Let's start with "this moment".  We can say that its characteristic is the number of the open page of the magazine.  It turns out that we, in the application, need a thing that will store the index of the current page.  Such a thing is needed one for the entire application, and it should be easy access - we need a singleton.  Having an index, the question boils down to something new: where to get UIView adequate index?  Probably the config knows it.  Well and further: why not ask our singleton to read the config and, knowing the index, to issue the desired view?  I will give the singleton interface and go to config <br><pre><code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DataManager</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSObject</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">articleIndex</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pageIndex</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSArray</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">articles</span></span></span><span class="hljs-class">; + (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">sharedManager</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">currentView</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">prevView</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nextView</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">upperView</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lowerView</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastArticleIndex</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">lastPageIndex</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre> <br>  Config in Objective-C is accepted or convenient to see the .plist file.  Actually, you need to collect a plist, which will display the pages of the magazine, some settings of these pages and links to raw materials.  I guess the examples will be clearer <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>class<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>SimplePage<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>properties<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>baseImage<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>1-0.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="xml hljs"> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>class<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>PhotoPage<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>properties<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>baseImage<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>9-0-4.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>photos<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>photo<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>9-1-f1.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>thumbnail<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>9-1-f1m.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  I suppose that you noticed the first property of each page - class.  Yeah, how convenient!  I wrote the class name in the config, and created the necessary page for it.  Fragment of the above singleton <br><pre> <code class="objectivec hljs">- (<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *) currentView { <span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> *article = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>.articles objectAtIndex:articleIndex]; <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *page = [article objectAtIndex:pageIndex]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> viewWithDictionary:page]; } - (<span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *) viewWithDictionary: (<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *) dictionary { Class <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">NSClassFromString</span></span>([dictionary valueForKey:<span class="hljs-string"><span class="hljs-string">@"class"</span></span>]); <span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *pageProperties = [dictionary valueForKey:<span class="hljs-string"><span class="hljs-string">@"properties"</span></span>]; <span class="hljs-built_in"><span class="hljs-built_in">UIView</span></span> *uiView = [[<span class="hljs-keyword"><span class="hljs-keyword">class</span></span> alloc] initWithDictionary:pageProperties]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> uiView; }</code> </pre><br>  What is left to mention?  I will show the interface SimplePage.  The rest of the page classes somehow inherit it. <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@interface</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SimplePage</span></span></span><span class="hljs-class"> : </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIView</span></span></span><span class="hljs-class"> @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">property</span></span></span><span class="hljs-class"> (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">nonatomic</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">strong</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSString</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">imageDirectory</span></span></span><span class="hljs-class">; - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">id</span></span></span><span class="hljs-class">) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">initWithDictionary</span></span></span><span class="hljs-class">: (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> *) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pageProperties</span></span></span><span class="hljs-class">; @</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">end</span></span></span></span></code> </pre><br>  Those.  we create a set of classes that inherit UIView, and according to these classes we write the configuration of one log. <br><br>  Here comes another variable imageDirectory.  The thing is that later we will need to collect the brochure pictures, put plist to them and send it to live on the server.  Therefore, instead of adding pictures to the project, I collected them in the simulator daddy - DocumentsDirectory.  But its initialization <br><pre> <code class="objectivec hljs"><span class="hljs-meta"><span class="hljs-meta">#if IS_LOCAL // doc/img dir imageDirectory = [DocumentsDirectory stringByAppendingPathComponent:@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"img"</span></span></span><span class="hljs-meta">]; #else // issue dir NKIssue *nkCurrentlyReadingIssue = [[NKLibrary sharedLibrary] currentlyReadingIssue]; imageDirectory = [nkCurrentlyReadingIssue.contentURL path]; #endif #if DEBUG NSLog(@</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">"imageDirectory %@"</span></span></span><span class="hljs-meta">, imageDirectory); #endif</span></span></code> </pre><br>  That's all that I wanted to tell you about the implementation of the display of one magazine.  Let's go further? <br><br>  <b>NK Management</b> <br><br>  The word itself suggests that you need something manager.  A collection of something downloaded from the server.  So we come to another structure.  To understand it, you need to superficially consider NKLibrary and NKIssue. <br><br>  Simply put, NKLibrary is a collection for NKIssue-s.  NKLibrary has a number of utilities, i.e.  This collection, sharpened by Newsstand.  This is also a singleton and, perhaps, at this stage, everything. <br><br>  NKIssue stores information about a single log.  Minimally, issue is required to have a name and date.  If I'm not mistaken, the name will be the key, and the date will be sorted. <br><br>  So, something, having looked somewhere, we have issues.plist <br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">plist</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">array</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Name<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>f-2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Title<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>/ 2013<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Date<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">date</span></span></span><span class="hljs-tag">&gt;</span></span>2013-11-28T08:00:00Z<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">date</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Cover<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>http://fo-nt.net/f/f2.png<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span>Content<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">key</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span>http://fo-nt.net/f/f2.zip<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">string</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">dict</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  We download the plist from the server, iterate through it, create NKIssue and add them to the NKLibrary <br><pre> <code class="objectivec hljs">NKLibrary *nkLib = [NKLibrary sharedLibrary]; issuesDictionary = [<span class="hljs-built_in"><span class="hljs-built_in">NSArray</span></span> arrayWithContentsOfFile:issuesPlistFilePath]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> *issueDictionary <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> issuesDictionary) { <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *name = [issueDictionary valueForKey:<span class="hljs-string"><span class="hljs-string">@"Name"</span></span>]; NKIssue *nkIssue = [nkLib issueWithName:name]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(!nkIssue) { [nkLib addIssueWithName:name date:[issueDictionary objectForKey:<span class="hljs-string"><span class="hljs-string">@"Date"</span></span>]]; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *coverPath = [issueDictionary valueForKey:<span class="hljs-string"><span class="hljs-string">@"Cover"</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (IS_RETINA) coverPath = [<span class="hljs-keyword"><span class="hljs-keyword">self</span></span> retinaURLStringForString:coverPath]; <span class="hljs-built_in"><span class="hljs-built_in">NSString</span></span> *coverName = [coverPath lastPathComponent];</code> </pre><br>  I will explain.  Naturally, here we have already imported NewsstandKit.  Otherwise, how could we know about NKLibrary and NKIssue?  With ease in the line, we get an instance of NKLibrary - nkLib.  Going through the array, we ask nkLib to give us a specific log by its name.  If the library says ‚ÄúFIG you‚Äù - it will become clear that there is a journal in the config, but not in the library -&gt; you need to add. <br><br>  In the listing, there is still the line 'if (IS_RETINA)'.  Briefly, the thing is that all the pictures of the magazine are on the server.  Here we already know what our display is.  Well, why download pictures for someone else's display.  Looking ahead, I‚Äôll say that the download kit, for each magazine, is recommended by Apple as an archive.  At the finish, it is logical to make two archives for one magazine: simple and @ 2x. <br><br>  We have the current NKLibrary.  Modestly, but you can already display the UI of existing journals. <br><br>  Visualization of the library display for each magazine is different.  However, there is something settled.  There is NKIssue with a set of properties - we display them.  Among them, especially interesting is the '' status '' property, which can be: none, downloading and available.  This I lead to the fact that the displayed log can be downloaded, wait for the download to finish and read, respectively. <br><br>  You need to download the kit, which was prepared at the stage of creating a brochure.  NKAssetDownload is the third NK thing - a specialized loader for the Newsstand (probably so).  Procedure: using NKIssue and NSURLRequest (obtained from NSURL, which, in turn, is obtained from the URL line for the selected log), create an instance of NKAssetDownload.  It needs to call the downloadWithDelegate method: (id &lt;NSURLConnectionDownloadDelegate&gt;) delegate <br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> *req = [<span class="hljs-built_in"><span class="hljs-built_in">NSURLRequest</span></span> requestWithURL:downloadURL]; NKAssetDownload *assetDownload = [nkIssue addAssetWithRequest:req]; [assetDownload downloadWithDelegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; [assetDownload setUserInfo:[<span class="hljs-built_in"><span class="hljs-built_in">NSDictionary</span></span> dictionaryWithObjectsAndKeys: [<span class="hljs-built_in"><span class="hljs-built_in">NSNumber</span></span> numberWithInt:index], <span class="hljs-string"><span class="hljs-string">@"Index"</span></span>, <span class="hljs-literal"><span class="hljs-literal">nil</span></span>]];</code> </pre><br>  The NKAssetDownload feature is background downloading.  It is required for Newsstand.  This means that the download will continue in the background.  There still have goodies.  However, the bg download interests us because it imposes the obligation, on return, to call the downloadWithDelegate method on all NKAssetDownload instances: <br><pre> <code class="objectivec hljs"><span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (NKAssetDownload *assetDownload <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> [nkIssue downloadingAssets]) { [assetDownload downloadWithDelegate:<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>]; }</code> </pre><br>  Here, it seems, everything.  We reanimate the download with some progress bar and wait for it to end.  When the download is complete, correctly, replace the application icon: [[UIApplication sharedApplication] setNewsstandIconImage: [publisher coverImageForIssue: nkIssue]].  If we used the archive, unzip it.  Ah, yes, the application, after downloading the log, is obliged to write its files along the path of the NKIssue contentURL property (I am not sure if it is obligated. Perhaps there is something optimized). <br><br>  Further, NKIssue accepts the status "available" - it is possible to show the "brochure". <br><br>  The next question: updating the library - comes down to reloading the issues.plist and processing it with the existing method.  Remember, there we checked whether the magazine was added to the library or not.  True, there is a substantive problematics.  For a number of magazines, the user can forget about him, by the time a new one is released.  And here, as inappropriate, at hand APNS.  This is another topic.  I admit, I didn't master it the first time.  And indeed, I did not make these notifications in my journal.  The key stumbling block was the certificate, or rather the need to convert it. <br><br>  However, APNS: firstly, this is the service of sending notifications.  The program can get the id of the device on which it is running and transfer it to your server.  First you need to subscribe to these notifications. <br><pre> <code class="objectivec hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">@implementation</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AppDelegate</span></span></span><span class="hljs-class"> - (</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BOOL</span></span></span><span class="hljs-class">)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UIApplication</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">application</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">didFinishLaunchingWithOptions</span></span></span><span class="hljs-class">:(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">NSDictionary</span></span></span><span class="hljs-class"> *)</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">launchOptions</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// Register device for receiving push notifications [[UIApplication sharedApplication] registerForRemoteNotificationTypes: (UIRemoteNotificationTypeBadge | UIRemoteNotificationTypeAlert)];</span></span></code> </pre><br>  After that, UIApplicationDelegate Protocol has an application: didRegisterForRemoteNotificationsWithDeviceToken: method, in which we have DeviceToken (id) and from which we can merge information to our server.  Next is the application: didReceiveRemoteNotification: method, in which you can do something after receiving the notification. <br><br>  On the server side, you need to accept requests (HTTP) that carry DeviceTokens and store them in the database.  Further, according to the purchased tickets, or rather, according to what is deployed on the server, you need to search for sending messages to APNS.  According to its API, attaching a certificate and password, we connect and send messages that contain both the payload and the DeviceTokens.  There are still nuances, but this is a separate topic. <br><br>  Among other things, two more restrictions are imposed on iOS magazine.  Perovoy - Privacy Policy URL.  On the technical side, it is extremely simple.  The second limitation is the need to distribute content using iTunesConnect in-app purchases.  As I understand it, this means that the user is obliged to buy my free magazine for 0 money. <br><br>  Total, iTunesConnect In-App Purchases means using the Store Kit.  In UserDefaults, I set up the isFreeSubscribed property.  I check it on tapu, and in case of NO I show alert.  By agreement, I sign <br><pre> <code class="objectivec hljs"><span class="hljs-built_in"><span class="hljs-built_in">SKProductsRequest</span></span> *productsRequest = [[<span class="hljs-built_in"><span class="hljs-built_in">SKProductsRequest</span></span> alloc] initWithProductIdentifiers:[<span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span> setWithObject:<span class="hljs-string"><span class="hljs-string">@"FreeSubscription"</span></span>]]; productsRequest.delegate=<span class="hljs-keyword"><span class="hljs-keyword">self</span></span>; [productsRequest start];</code> </pre><br>  Plus, you need to implement the delegate methods and set isFreeSubscribed to YES to forget about In-App Purchases.  ProductProd for SKProductsRequest must be obtained from iTunesConnect, in the Manage In-App Purchases section. <br><br>  At the finish of the story, I believe that there is not even half of the journal needs, however, I want to believe that I managed to outline the most necessary technical issues for the simplest magazine. <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e43/8d1/de0/e438d1de0d842bd83ec0397ea010db2f.png" width="180"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/fbb/9f8/3fd/fbb9f83fd85024938d5ac636d7aa46e6.png" width="180"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/8b7/f74/c6e/8b7f74c6ee15ad7c22ec1437b345ba8f.png" width="180"></a> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/261/8ed/055/2618ed055936bd56ac511062ebed4f9e.png" width="180"></a> </div><p>Source: <a href="https://habr.com/ru/post/212067/">https://habr.com/ru/post/212067/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212055/index.html">Methods of organizing interaction between scripts in Unity3D</a></li>
<li><a href="../212057/index.html">Installing ST-LINK V2 on MAC OS X for development under STM32</a></li>
<li><a href="../212059/index.html">Survival kit for web developer under win *</a></li>
<li><a href="../212061/index.html">A little more about the project ¬´Outernet¬ª</a></li>
<li><a href="../212065/index.html">HMVC pattern in web development</a></li>
<li><a href="../212069/index.html">Fighting familiarity with Leap Motion</a></li>
<li><a href="../212071/index.html">How to choose the right video surveillance system?</a></li>
<li><a href="../212073/index.html">Your success as a programmer depends on you.</a></li>
<li><a href="../212075/index.html">Bionic hand prosthesis returns touch</a></li>
<li><a href="../212077/index.html">PhpStorm - improve performance (keyboard shortcuts). Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>