<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Instantiation of function templates by type list (Part 2)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part, we discussed how to achieve the transfer of the definition of the function template from the header file to the source code if the ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Instantiation of function templates by type list (Part 2)</h1><div class="post__text post__text-html js-mediator-article">  In the first <a href="http://habrahabr.ru/post/235831/">part,</a> we discussed how to achieve the transfer of the definition of the function template from the header file to the source code if the set of types for which the template is to be instantiated is known in advance.  In this part we will see how to achieve this beautifully. <br><a name="habracut"></a><br>  First of all, I will have to do what I planned to do closer to the end, but judging by the comments from the first part, this needs to be done urgently.  Namely, no more lists of types on Alexandrescu.  Now only templates with a variable number of parameters, or variadics, among the people: <br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Types&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TypeList</span></span></span><span class="hljs-class">{</span></span>}; <span class="hljs-comment"><span class="hljs-comment">//       typedef TypeList&lt;int, double, bool, char, const char*&gt; MyTypeList; //       </span></span></code> </pre> <br>  Let us return to the last result from the first part and rewrite it in the manner of variadics: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> T&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomethingDoer</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span>&lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> Head, <span class="hljs-keyword"><span class="hljs-keyword">typename</span></span>... Tail&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">SomethingDoer</span></span></span><span class="hljs-class">&lt;TypeList&lt;Head, Tail...&gt;&gt; {</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">typedef</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">void</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MyClass::*MemFuncType)</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(Head)</span></span></span></span>; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">doSomething</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">volatile</span></span> MemFuncType x = &amp;MyClass::f; (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)(x); SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; <span class="hljs-keyword"><span class="hljs-keyword">template</span></span> &lt;<span class="hljs-keyword"><span class="hljs-keyword">typename</span></span> TList&gt; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Instantiator</span></span></span><span class="hljs-class"> {</span></span> Instantiator() { SomethingDoer&lt;TList&gt;::doSomething(); } }; Instantiator&lt;MyTypeList&gt; a;</code> </pre><br>  Now let's think about how to improve this solution.  Improvement is necessary in two directions: generalization and disposal of trash. <br>  With the second task, it seems easier to understand.  The entire <code>Instantiator</code> class is designed to make the call: <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> <pre> <code class="hljs haskell"><code class="cpp"> <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>::doSomething();. ,      : <br> template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span> { static int doSomething() //  doSomething  ,   ,      . { return <span class="hljs-number"><span class="hljs-number">0</span></span>; } }; template&lt;typename <span class="hljs-type"><span class="hljs-type">Head</span></span>, typename... <span class="hljs-type"><span class="hljs-type">Tail</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Head</span></span>, <span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt; { typedef void (<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::*<span class="hljs-type"><span class="hljs-type">MemFuncType</span></span>)(<span class="hljs-type"><span class="hljs-type">Head</span></span>); static int doSomething() { volatile <span class="hljs-type"><span class="hljs-type">MemFuncType</span></span> x = &amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f; (***) (void)(x); return <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">TypeList</span></span>&lt;<span class="hljs-type"><span class="hljs-type">Tail</span></span>...&gt;&gt;::doSomething(); } }; int a = <span class="hljs-type"><span class="hljs-type">SomethingDoer</span></span>&lt;<span class="hljs-type"><span class="hljs-type">MyTypeList</span></span>&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     <span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f  - ,  <br> <code class="cpp">template&lt;typename <span class="hljs-type"><span class="hljs-type">T</span></span>&gt; struct <span class="hljs-type"><span class="hljs-type">FuncWrapper_MyClass_f</span></span> { typedef decltype(&amp;<span class="hljs-type"><span class="hljs-type">MyClass</span></span>::f&lt;<span class="hljs-type"><span class="hljs-type">T</span></span>&gt;) <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">; static constexpr </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class"> value = &amp;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">::f&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; };</span></span></code><span class="hljs-class"><span class="hljs-class"> ,    </span></span><code><span class="hljs-class"><span class="hljs-class">doSomething</span></span></code><span class="hljs-class"><span class="hljs-class">     </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,     </span></span><code><span class="hljs-class"><span class="hljs-class">f()</span></span></code><span class="hljs-class"><span class="hljs-class">  . </span></span><br><span class="hljs-class"><span class="hljs-class">      ( </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">SomethingDoer</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">    </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> ,   </span></span><code><span class="hljs-class"><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">doSomething</span></span></span><span class="hljs-class">()</span></span></code><span class="hljs-class"><span class="hljs-class"> -  </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> ). </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; //  ,    struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt;&gt; //  ,    { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; //         </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; //      , </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); //        . } };</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">          -  ,         .       </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  -  . ,      </span></span><code><span class="hljs-class"><span class="hljs-class">instantiate()</span></span></code><span class="hljs-class"><span class="hljs-class"> -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::value</span></span></code><span class="hljs-class"><span class="hljs-class">   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">::</span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .    : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Type</span></span></span><span class="hljs-class">&gt; //    -      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class"> struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class"> { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">int</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">(...) { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> 0; } }; template&lt;template&lt;typename&gt;class </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, typename... </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">&gt; struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TypeList</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Tail</span></span></span><span class="hljs-class">...&gt; &gt; </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">pair</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typename</span></span></span><span class="hljs-class"> </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">())&gt; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">() { </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">auto</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class"> = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapperType</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Head</span></span></span><span class="hljs-class">&gt;::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class">; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">return</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">std</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">make_pair</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">headTypeInstantiate</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">TailInstantiator</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">instantiate</span></span></span><span class="hljs-class">()); } }; auto a = </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">&gt;::instantiate(); // ,  ,    </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span><span class="hljs-class">  instantiate(),   .</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">        .         ,       .   </span></span><code><span class="hljs-class"><span class="hljs-class">struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span></span></code><span class="hljs-class"><span class="hljs-class">          myclass.cpp           .      </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp -   </span></span><code><span class="hljs-class"><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_MyClass_f</span></span></span></span></code><span class="hljs-class"><span class="hljs-class"> .     ,           ,        . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">define </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">types</span></span></span><span class="hljs-class">) \ template&lt;typename </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt; \ struct </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName \ { \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">typedef</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">decltype</span></span></span><span class="hljs-class">(&amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;) </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class">; \ </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">static</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">constexpr</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">type</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">value</span></span></span><span class="hljs-class"> = &amp;</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">className</span></span></span><span class="hljs-class">::</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">funcName</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">T</span></span></span><span class="hljs-class">&gt;; \ }; \ volatile auto i_##className_##funcName = detail::</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Instantiator</span></span></span><span class="hljs-class">&lt;</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">FuncWrapper_</span></span></span><span class="hljs-class">##className_##funcName, types&gt;::instantiate();</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">           .  </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">.cpp   : </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><code class="cpp"><span class="hljs-class"><span class="hljs-class">namespace { </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">InstantiateMemFunc</span></span></span><span class="hljs-class">(</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyClass</span></span></span><span class="hljs-class">, </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">f</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">MyTypeList</span></span></span><span class="hljs-class">) }</span></span></code><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .         ,    ,     . </span></span><br><span class="hljs-class"><span class="hljs-class"> </span></span><br><span class="hljs-class"><span class="hljs-class">  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</span></span></code> </pre> <code><code class="cpp"> SomethingDoer::doSomething();. ,      : <br> template&lt;typename T&gt; struct SomethingDoer { static int doSomething() //  doSomething  ,   ,      . { return 0; } }; template&lt;typename Head, typename... Tail&gt; struct SomethingDoer&lt;TypeList&lt;Head, Tail...&gt;&gt; { typedef void (MyClass::*MemFuncType)(Head); static int doSomething() { volatile MemFuncType x = &amp;MyClass::f; (***) (void)(x); return SomethingDoer&lt;TypeList&lt;Tail...&gt;&gt;::doSomething(); } }; int a = SomethingDoer&lt;MyTypeList&gt;::doSomething(); //  ,   ,   .</code> <br> ,    .     (***).        . <br>       ,       .       ,     (***)  -  . .,     MyClass::f  - ,  <br> <code class="cpp">template&lt;typename T&gt; struct FuncWrapper_MyClass_f { typedef decltype(&amp;MyClass::f&lt;T&gt;) type; static constexpr type value = &amp;MyClass::f&lt;T&gt;; };</code> ,    <code>doSomething</code>     <code>MyClass</code> ,     <code>f()</code>  . <br>      ( <code>SomethingDoer</code>    <code>Instantiator</code> ,   <code>doSomething()</code> -  <code>instantiate()</code> ). <br> <code class="cpp">template&lt;typename Head, typename... Tail&gt; //  ,    struct Instantiator&lt;TypeList&lt;Head, Tail...&gt;&gt; //  ,    { typedef Instantiator&lt;TypeList&lt;Tail...&gt; &gt; TailInstantiator; //         static std::pair&lt;typename FuncWrapper_MyClass_f&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapper_MyClass_f&lt;Head&gt;::value; //      , return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); //        . } };</code> <br>          -  ,         .       FuncWrapper_MyClass_f  -  . ,      <code>instantiate()</code> -   <code>FuncWrapper_MyClass_f::value</code>   <code>FuncWrapper_MyClass_f::type</code> .    : <br> <code class="cpp">template&lt;template&lt;typename&gt;class FuncWrapperType, typename Type&gt; //    -      FuncWrapper_MyClass_f struct Instantiator { static int instantiate(...) { return 0; } }; template&lt;template&lt;typename&gt;class FuncWrapperType, typename Head, typename... Tail&gt; struct Instantiator&lt;FuncWrapperType, TypeList&lt;Head, Tail...&gt; &gt; { typedef Instantiator&lt;FuncWrapperType, TypeList&lt;Tail...&gt; &gt; TailInstantiator; static typename std::pair&lt;typename FuncWrapperType&lt;Head&gt;::type, decltype(TailInstantiator::instantiate())&gt; instantiate() { auto headTypeInstantiate = FuncWrapperType&lt;Head&gt;::value; return std::make_pair(headTypeInstantiate, TailInstantiator::instantiate()); } }; auto a = Instantiator&lt;FuncWrapper_MyClass_f, MyTypeList&gt;::instantiate(); // ,  ,    FuncWrapper_MyClass_f  instantiate(),   .</code> <br>        .         ,       .   <code>struct Instantiator</code>          myclass.cpp           .      MyClass.cpp -   <code>FuncWrapper_MyClass_f</code> .     ,           ,        . <br> <code class="cpp">define InstantiateMemFunc(className, funcName, types) \ template&lt;typename T&gt; \ struct FuncWrapper_##className_##funcName \ { \ typedef decltype(&amp;className::funcName&lt;T&gt;) type; \ static constexpr type value = &amp;className::funcName&lt;T&gt;; \ }; \ volatile auto i_##className_##funcName = detail::Instantiator&lt;FuncWrapper_##className_##funcName, types&gt;::instantiate();</code> <br>           .  MyClass.cpp   : <br> <code class="cpp">namespace { InstantiateMemFunc(MyClass, f, MyTypeList) }</code> <br>  .         ,    ,     . <br> <br>  .     ,            .    , ,  -  .   -   ,   -   .     ,   ,  ,  , , -, - . , ++ ,     ,     ...</code> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/235887/">https://habr.com/ru/post/235887/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../235875/index.html">WebMoney updated interfaces</a></li>
<li><a href="../235877/index.html">Physical and biological satellites of the series "Foton" and "Bion"</a></li>
<li><a href="../235879/index.html">Senseit L301 - when the smartphone takes care of you</a></li>
<li><a href="../235881/index.html">ESP8266: A Revolution in the Internet of Things</a></li>
<li><a href="../235883/index.html">E-Ink reader market in Russia: on the way to growth or oblivion?</a></li>
<li><a href="../235889/index.html">A selection of entertaining CSS recipes "Naked Fridays # 2"</a></li>
<li><a href="../235893/index.html">CSS GuideLines, part 2. Commenting code</a></li>
<li><a href="../235895/index.html">The digest of interesting materials for mobile developer # 69 (September 1-7)</a></li>
<li><a href="../235899/index.html">Digest of domestic projects on Kickstarter ‚Ññ 5</a></li>
<li><a href="../235901/index.html">Top Sublime Text Plugins</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>