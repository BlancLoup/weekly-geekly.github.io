<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We check Oracle VM VirtualBox. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Virtual machines are used for various needs. I myself have been using VirtualBox for more than one year to test software and just study various Linux ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We check Oracle VM VirtualBox. Part 2</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/596/070/dee/596070deee5106f20e9bf0abb1bd8df2.png" align="left"><br>  Virtual machines are used for various needs.  I myself have been using VirtualBox for more than one year to test software and just study various Linux distributions, in fact, after prolonged use, periodically encountering uncertain behavior, I decided to use my experience in checking open-source projects and analyze the source code of Oracle VM Virtual Box. <br><br>  In this article I will continue to describe the numerous suspicious sites found in the project. <br><a name="habracut"></a><br>  Link to previous article: <a href="http://habrahabr.ru/company/pvs-studio/blog/237393/">Checking Oracle VM VirtualBox.</a>  <a href="http://habrahabr.ru/company/pvs-studio/blog/237393/">Part 1.</a> <br><br>  <a href="http://www.viva64.com/go.php%3Furl%3D1439">VirtualBox</a> is a cross-platform virtualization application.  What does it mean?  First, it works on computers with Intel or AMD processors running Windows, Mac, Linux, and other operating systems.  Secondly, it expands the capabilities of your computer by allowing multiple operating systems to work simultaneously (inside virtual machines). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Virtual Box was tested with <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> 5.19.  The build system in Windows uses the kBuild build system, so for testing I used the special utility PVS-Studio Standalone, which is described in the article: <a href="http://www.viva64.com/ru/b/0243/">PVS-Studio now supports any build system on Windows and any compiler.</a>  <a href="http://www.viva64.com/ru/b/0243/">Easy and out of the box</a> . <br><br><h2>  Typos in terms of </h2><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions "fVersion"  operator.  applianceimplexport.cpp 1071 <br><pre><code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Called from Appliance::i_buildXML() for each virtual * system (machine) that needs XML written out.*/</span></span> <span class="hljs-keyword"><span class="hljs-keyword">void</span></span> Appliance::i_buildXMLForOneVirtualSystem(....) { .... <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fProduct = .... ; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fProductUrl = .... ; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fVendor = .... ; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fVendorUrl = .... ; <span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> fVersion = .... ; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (fProduct || fProductUrl || fVersion || <span class="hljs-comment"><span class="hljs-comment">//&lt;== fVendorUrl || fVersion) //&lt;== { .... } .... }</span></span></code> </pre> <br>  We see the declaration of five logical variables, the state of which is checked in one conditional expression, but after copy-paste one variable was forgot to be renamed to 'fVendor'. <br><br>  <a href="http://www.viva64.com/ru/d/0090/">V501</a> There are identical sub-expressions'! Module.symspace '||'  operator.  dbgpluginsolaris.cpp 519 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dbgDiggerSolarisProcessModCtl32</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-comment"><span class="hljs-comment">/* Ignore modules without symbols. */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!Module.symtbl || !Module.strings || !Module.symspace || !Module.symspace) <span class="hljs-comment"><span class="hljs-comment">//&lt;== return; //Check that the symtbl and strings points inside the symspace. if (Module.strings - Module.symspace &gt;= Module.symsize) return; if (Module.symtbl - Module.symspace &gt;= Module.symsize) return; .... }</span></span></code> </pre> <br>  All variables in the condition are of the type 'uint32_t' and in the case of zero value of one of them, the function is exited.  Most likely, the name of one of the duplicate variables should be 'Module.symsize'. <br><br>  Similar place in this file: <ul><li>  V501 There are identical sub-expressions'! Module.symspace '||'  operator.  dbgpluginsolaris.cpp 665 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression is always false.  Probably the '||'  operator should be used here.  vboxmanageguestctrl.cpp 2365 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Creates a source root by stripping file names or filters * of the specified source.*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ctrlCopyCreateSourceRoot</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> lenRoot = <span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(pszNewRoot); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( lenRoot &amp;&amp; pszNewRoot[lenRoot - <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; pszNewRoot[lenRoot - <span class="hljs-number"><span class="hljs-number">1</span></span>] == <span class="hljs-string"><span class="hljs-string">'\\'</span></span> &amp;&amp; lenRoot &gt; <span class="hljs-number"><span class="hljs-number">1</span></span> &amp;&amp; pszNewRoot[lenRoot - <span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'/'</span></span> &amp;&amp; pszNewRoot[lenRoot - <span class="hljs-number"><span class="hljs-number">2</span></span>] == <span class="hljs-string"><span class="hljs-string">'\\'</span></span>) { .... } .... }</code> </pre> <br>  One variable cannot be simultaneously equal to two different values, therefore, the condition is always false. <br><br>  <a href="http://www.viva64.com/ru/d/0316/">V682</a> Suspicious literal is present: '//'.  It is possible that a backslash should be used here instead: '\\'.  supr3hardenedmain-win.cpp 936 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Fixes up a path possibly containing one or more alternative * 8-dot-3 style components. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">supR3HardenedWinFix8dot3Path</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> ((wc = *pwszFixEnd) != <span class="hljs-string"><span class="hljs-string">'\0'</span></span> &amp;&amp; wc != <span class="hljs-string"><span class="hljs-string">'\\'</span></span> &amp;&amp; wc != <span class="hljs-string"><span class="hljs-string">'//'</span></span>) pwszFixEnd++; .... }</code> </pre> <br>  The condition for stopping the loop is the end of the line or one of the slashes.  Backslash (\) should be specially screened.  And to the forward slash (/), probably, accidentally added one more slash, getting the wrong value of 0x2F2F. <br><br>  <a href="http://www.viva64.com/ru/d/0186/">V583</a> The '?:' Operator, regardless of its conditional expression, always returns one and the same value: sizeof (uMod.Info64).  dbgplugindarwin.cpp 557 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DECLCALLBACK</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">dbgDiggerDarwinInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PUVM pUVM, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *pvData)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">union</span></span> { OSX64_kmod_info_t Info64; OSX32_kmod_info_t Info32; } uMod; RT_ZERO(uMod); rc = DBGFR3MemRead(pUVM, <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-comment"><span class="hljs-comment">/*idCpu*/</span></span>, &amp;AddrModInfo, &amp;uMod, f64Bit ? <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uMod.Info64) : <span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(uMod.Info64)); .... }</code> </pre> <br>  Probably, the argument of one sizeof () operator should be the variable 'uMod.Info32'. <br><br>  <a href="http://www.viva64.com/ru/d/0106/">V517</a> The use of if (A) {...} else if (A) {...} 'pattern was detected.  There is a possibility of logical error presence.  Check lines: 541, 674. vcicache.cpp 541 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/*Loads the block map from the specified medium and creates all necessary in memory structures to manage used and free blocks.*/</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vciBlkMapLoad</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... rc = vdIfIoIntFileReadSync(....) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (RT_SUCCESS(rc)) <span class="hljs-comment"><span class="hljs-comment">//&lt;== { .... } else if (RT_SECCESS(rc)) //&lt;== rc = VERR_VD_GEN_INVALID_HEADER; .... LogFlowFunc(("returns rc=%Rrc\n", rc)); return rc; }</span></span></code> </pre> <br>  The 'else' branch will never get control and the 'VERR_VD_GEN_INVALID_HEADER' status will not be set in case of an error. <br><br><h2>  Sizeof () arguments </h2><br>  <a href="http://www.viva64.com/ru/d/0163/">V568</a> It's odd that the sizeof () operator is the sizeof (pSh-&gt; Name) 'expression.  ldrpe.cpp 1598 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* @file * IPRT - Binary Image Loader, Portable Executable (PE). */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">IMAGE_SECTION_HEADER</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> Name[IMAGE_SIZEOF_SHORT_NAME]; .... } IMAGE_SECTION_HEADER; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">DECLCALLBACK</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">rtldrPE_EnumSegments</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ PCIMAGE_SECTION_HEADER pSh = pModPe-&gt;paSections; .... szName[<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(pSh-&gt;Name))] = <span class="hljs-string"><span class="hljs-string">'\0'</span></span>; <span class="hljs-comment"><span class="hljs-comment">//&lt;== .... }</span></span></code> </pre> <br>  The sizeof () operator evaluates the type of expression and returns the size of this type.  In this case, the terminal zero will be written not at the end of the line, but in the position ‚Äúsizeof (size_t)‚Äù. <br><br>  <a href="http://www.viva64.com/ru/d/0163/">V568</a> It's odd that the sizeof () operator is the 'pSub-&gt; auBitmap [0] * 8' expression.  mmpagepool.cpp 234 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Allocates a page from the page pool. */</span></span> DECLINLINE(<span class="hljs-keyword"><span class="hljs-keyword">void</span></span> *) mmR3PagePoolAlloc(PMMPAGEPOOL pPool) { .... <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> rc = MMHyperAlloc(pPool-&gt;pVM, RT_OFFSETOF(MMPAGESUBPOOL, auBitmap[cPages / (<span class="hljs-keyword"><span class="hljs-keyword">sizeof</span></span>(pSub-&gt;auBitmap[<span class="hljs-number"><span class="hljs-number">0</span></span>] * <span class="hljs-number"><span class="hljs-number">8</span></span>))]) + ....); .... }</code> </pre> <br>  In this fragment, the sizeof () operator evaluates the type of the expression "pSub-&gt; auBitmap [0] * 8".  Most likely the bracket is out of place. <br><br><h2>  Typos at initialization </h2><br>  <a href="http://www.viva64.com/ru/d/0108/">V519</a> The 'pPool-&gt; aPages [0] .iMonitoredNext' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 300, 301. pgmpool.cpp 301 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">PGMPOOLPAGE</span></span></span><span class="hljs-class"> {</span></span> .... <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> iMonitoredNext; <span class="hljs-keyword"><span class="hljs-keyword">uint16_t</span></span> iMonitoredPrev; .... } PGMPOOLPAGE; <span class="hljs-comment"><span class="hljs-comment">/* Initializes the pool */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">pgmR3PoolInit</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PVM pVM)</span></span></span><span class="hljs-function"> </span></span>{ .... pPool-&gt;aPages[NIL_PGMPOOL_IDX].iModifiedNext = NIL_PGMPOOL_IDX; pPool-&gt;aPages[NIL_PGMPOOL_IDX].iModifiedPrev = NIL_PGMPOOL_IDX; pPool-&gt;aPages[NIL_PGMPOOL_IDX].iMonitoredNext= NIL_PGMPOOL_IDX; pPool-&gt;aPages[NIL_PGMPOOL_IDX].iMonitoredNext= NIL_PGMPOOL_IDX; pPool-&gt;aPages[NIL_PGMPOOL_IDX].iAgeNext = NIL_PGMPOOL_IDX; pPool-&gt;aPages[NIL_PGMPOOL_IDX].iAgePrev = NIL_PGMPOOL_IDX; .... }</code> </pre> <br>  Initialization of the 'iMonitoredPrev' field is missing.  There is such a field in the structure used. <br><br>  Similar place: <ul><li>  V519 The 'pPage-&gt; iMonitoredNext' variable is assigned values ‚Äã‚Äãtwice successively.  Perhaps this is a mistake.  Check lines: 482, 483. pgmpool.cpp 483 </li></ul><br>  <a href="http://www.viva64.com/ru/d/0168/">V570</a> The 'pReq-&gt; cT2ISegs' variable is assigned to itself.  iscsi.cpp 4743 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">iscsiRead</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... pReq-&gt;enmXfer = SCSIXFER_FROM_TARGET; pReq-&gt;cbCDB = cbCDB; pReq-&gt;cbI2TData = <span class="hljs-number"><span class="hljs-number">0</span></span>; pReq-&gt;paI2TSegs = <span class="hljs-literal"><span class="hljs-literal">NULL</span></span>; pReq-&gt;cI2TSegs = <span class="hljs-number"><span class="hljs-number">0</span></span>; pReq-&gt;cbT2IData = cbToRead; pReq-&gt;paT2ISegs = &amp;pReq-&gt;aSegs[pReq-&gt;cI2TSegs]; pReq-&gt;cT2ISegs = pReq-&gt;cT2ISegs; <span class="hljs-comment"><span class="hljs-comment">//&lt;== pReq-&gt;cbSense = sizeof(pReq-&gt;abSense); pReq-&gt;cT2ISegs = cT2ISegs; //&lt;== pReq-&gt;pIoCtx = pIoCtx; pReq-&gt;cSenseRetries = 10; pReq-&gt;rcSense = VERR_READ_ERROR; .... }</span></span></code> </pre> <br>  Suspicious place, because the variable ‚ÄúpReq-&gt; cT2ISegs‚Äù is first assigned its own value, then another value is assigned to the same variable. <br><br><h2>  Invalid I / O </h2><br>  <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider the second printf function.  To print the value of the% p 'should be used.  usbtest.cpp 191 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Remove USB device filter */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">usbMonRemoveFilter</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params"> *aID)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"usblibRemoveFilter %x\n"</span></span>, aID); .... }</code> </pre> <br>  This code is erroneous, since it will work only in 32 systems.  And, for example, in Win64 this code already prints only the lower part of the 'aID' pointer.  The correct code is: <br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">printf</span></span>(<span class="hljs-string"><span class="hljs-string">"usblibRemoveFilter %p\n"</span></span>, aID);</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  A different number of actual arguments is expected while calling the 'swprintf_s' function.  Expected: 4. Present: 5. vboxinstallhelper.cpp 311 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> LONG </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">installBrandingValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (wcsicmp(<span class="hljs-string"><span class="hljs-string">L"General"</span></span>, pwszSection) != <span class="hljs-number"><span class="hljs-number">0</span></span>) swprintf_s(wszKey, RT_ELEMENTS(wszKey), <span class="hljs-string"><span class="hljs-string">L"SOFTWARE\\%s\\VirtualBox\\Branding\\"</span></span>, VBOX_VENDOR_SHORT, pwszSection); <span class="hljs-comment"><span class="hljs-comment">//&lt;== .... }</span></span></code> </pre> <br>  The second argument will not be printed, since there is only one output specifier in the formatted string. <br><br>  <a href="http://www.viva64.com/ru/d/0176/">V576</a> Incorrect format.  Consider checking the fifth argument of the swprintf_s function.  The wchar_t type argument is expected.  vboxinstallhelper.cpp 340 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-function">UINT </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CopyDir</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(MSIHANDLE hModule, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WCHAR *pwszDestDir, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> WCHAR *pwszSourceDir)</span></span></span><span class="hljs-function"> </span></span>{ .... swprintf_s(wszDest, RT_ELEMENTS(wszDest), <span class="hljs-string"><span class="hljs-string">L"%s%c"</span></span>, pwszDestDir, <span class="hljs-string"><span class="hljs-string">'\0'</span></span>); <span class="hljs-comment"><span class="hljs-comment">//&lt;== swprintf_s(wszSource, RT_ELEMENTS(wszSource), L"%s%c", pwszSourceDir, '\0'); //&lt;== .... }</span></span></code> </pre> <br>  The correct option is: <br><pre> <code class="cpp hljs">swprintf_s(wszDest, RT_ELEMENTS(wszDest), <span class="hljs-string"><span class="hljs-string">L"%s%c"</span></span>, pwszDestDir, L'\<span class="hljs-number"><span class="hljs-number">0'</span></span>); swprintf_s(wszSource, RT_ELEMENTS(wszSource), <span class="hljs-string"><span class="hljs-string">L"%s%c"</span></span>, pwszSourceDir, L'\<span class="hljs-number"><span class="hljs-number">0'</span></span>);</code> </pre><br><br>  More places like this: <ul><li>  V576 Incorrect format.  Consider checking the fifth argument of the swprintf_s function.  The wchar_t type argument is expected.  vboxinstallhelper.cpp 341 </li><li>  V576 Incorrect format.  Consider checking the fifth argument of the swprintf_s function.  The wchar_t type argument is expected.  vboxinstallhelper.cpp 370 </li><li>  V576 Incorrect format.  Consider checking the fifth argument of the swprintf_s function.  The wchar_t type argument is expected.  vboxinstallhelper.cpp 399 </li><li>  V576 Incorrect format.  Consider checking the fifth argument of the swprintf_s function.  The wchar_t type argument is expected.  vboxinstallhelper.cpp 400 </li></ul><br><h2>  About pointers </h2><br>  <a href="http://www.viva64.com/ru/d/0111/">V522</a> Dereferencing of the null pointer 'pParent' might take place.  stam.cpp 1135 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Frees empty lookup nodes if it's worth it. */</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">stamR3LookupMaybeFree</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(PSTAMLOOKUP pLookup)</span></span></span><span class="hljs-function"> </span></span>{ .... PSTAMLOOKUP pCur = pLookup-&gt;pParent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pCur) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pCur-&gt;cDescsInTree &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; PSTAMLOOKUP pParent = pCur-&gt;pParent; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pParent) <span class="hljs-comment"><span class="hljs-comment">//&lt;== return; if (pParent-&gt;cDescsInTree == 0 &amp;&amp; pParent-&gt;pParent) //&lt;== { pCur = pParent; pParent = pCur-&gt;pParent; } .... }</span></span></code> </pre> <br>  If you take a closer look at this fragment, you can see that if the 'pParent' pointer is correct, then the function is exited, and then this pointer is used.  Looks like the negation operator is missing.  The correct code is: <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!pParent) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pParent-&gt;cDescsInTree == <span class="hljs-number"><span class="hljs-number">0</span></span> &amp;&amp; pParent-&gt;pParent) { .... }</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0137/">V547</a> Expression 'gCtx.au64LastCpuLoad_Kernel == 0' is always false.  Pointer 'gCtx.au64LastCpuLoad_Kernel'! = NULL.  vboxservicestats.cpp 220 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">uint64_t</span></span> au64LastCpuLoad_Kernel[VMM_MAX_CPU_COUNT]; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">VBoxServiceVMStatsReport</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">void</span></span></span></span><span class="hljs-function"><span class="hljs-params">)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (gCtx.au64LastCpuLoad_Kernel == <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/* first time */</span></span> gCtx.au64LastCpuLoad_Idle[<span class="hljs-number"><span class="hljs-number">0</span></span>] =pProcInfo-&gt;IdleTime.QuadPart; gCtx.au64LastCpuLoad_Kernel[<span class="hljs-number"><span class="hljs-number">0</span></span>]=pProcInfo-&gt;KernelTime.QuadPart; gCtx.au64LastCpuLoad_User[<span class="hljs-number"><span class="hljs-number">0</span></span>] =pProcInfo-&gt;UserTime.QuadPart; Sleep(<span class="hljs-number"><span class="hljs-number">250</span></span>); rc = gCtx.pfnNtQuerySystemInformation(....); Assert(!rc); } .... }</code> </pre> <br>  It does not make sense to check the pointer to the array declared on the stack.  Indeed, in the case of a shortage of allocated memory, an exception is generated. <br><br>  <a href="http://www.viva64.com/ru/d/0205/">V595</a> The 'pImage' pointer was used before it was verified against nullptr.  Check lines: 6299, 6305. vmdk.cpp 6299 <br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">vmdkSetComment</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pImage-&gt;uOpenFlags &amp; VD_VMDK_IMAGE_FLAGS_STREAM_OPTIMIZED) { rc = VERR_NOT_SUPPORTED; <span class="hljs-keyword"><span class="hljs-keyword">goto</span></span> out; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (pImage) rc = vmdkSetImageComment(pImage, pszComment); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> rc = VERR_VD_NOT_OPENED; .... }</code> </pre> <br>  The correctness of the pointer is checked after dereference. <br><br>  Similar places: <ul><li>  V595 The 'pExtent-&gt; pszBasename' pointer has been verified against nullptr.  Check lines: 2900, 2902. vmdk.cpp 2900 </li><li>  V595 The 'pszSymbol' pointer was used before it was verified against nullptr.  Check lines: 202, 213. suplibldr.cpp 202 </li><li>  V595 The 'papLunOld' pointer was used before it was verified against nullptr.  Check lines: 214, 216. vscsidevice.cpp 214 </li><li>  V595 The 'conn' pointer was used before it was verified nullptr.  Check lines: 323, 327. api_msg.c 323 </li><li>  V595 The m_pRefreshAct 'pointer was used before it was verified against nullptr.  Check lines: 2906, 2914. vboxdbgstatsqt4.cpp 2906 </li><li>  V595 The m_pRefreshAct 'pointer was used before it was verified against nullptr.  Check lines: 2929, 2937. vboxdbgstatsqt4.cpp 2929 </li></ul><br><h2>  Priorities for operations </h2><br>  <a href="http://www.viva64.com/ru/d/0131/">V542</a> Consider inspecting an odd type cast: 'bool' to 'wchar_t *'.  qifiledialog.cpp 483 <br><pre> <code class="cpp hljs"><span class="hljs-comment"><span class="hljs-comment">/* Reimplementation of QFileDialog::getSaveFileName() * that removes some oddities and limitations. */</span></span> QString QIFileDialog::getSaveFileName (....) { .... ofn.lpstrFilter = (TCHAR *) winFilters.isNull() ? <span class="hljs-number"><span class="hljs-number">0</span></span> : winFilters.utf16(); .... }</code> </pre> <br>  Here the cast operation has a higher priority than the '?:' Operator.  But, thanks to luck, the code eventually works as intended. <br><br>  <a href="http://www.viva64.com/ru/d/0197/">V593</a> Consider reviewing the A = B&gt; C 'kind.  The expression is calculated as the following: 'A = (B&gt; C)'.  applianceimplimport.cpp 384 <br><pre> <code class="cpp hljs">HRESULT Appliance::interpret() { .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (vsysThis.pelmVBoxMachine) { .... } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">size_t</span></span> cEthernetAdapters = vsysThis.llEthernetAdapters.size() &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cEthernetAdapters &gt; maxNetworkAdapters) .... } .... }</code> </pre> <br>  The priority of the operator '&gt;' is higher than that of the '=', therefore, here the variable 'cEthernetAdapters' takes only two values: 0 and 1. And then the incorrect value is used. <br><br><h2>  Memory leak </h2><br>  <a href="http://www.viva64.com/ru/d/0210/">It‚Äôs</a> a virtual one, although it contains a class with virtual functions.  uiapplianceeditorwidget.cpp 783 <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualSystemModel</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> QAbstractItemModel { .... <span class="hljs-keyword"><span class="hljs-keyword">private</span></span>: ModelItem *m_pRootItem; }; VirtualSystemModel::~VirtualSystemModel() { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (m_pRootItem) <span class="hljs-keyword"><span class="hljs-keyword">delete</span></span> m_pRootItem; <span class="hljs-comment"><span class="hljs-comment">//&lt;== }</span></span></code> </pre> <br>  The analyzer detected a potential error related to the absence of a virtual destructor in the base class.  Having found the description of the ‚ÄúModelItem‚Äù class, we will see how the destructor is declared: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ModelItem</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span>: .... ~ModelItem(); <span class="hljs-comment"><span class="hljs-comment">//&lt;== .... virtual Qt::ItemFlags itemFlags(int) const { return 0; } virtual bool setData(int, const QVariant &amp;, int) {....} .... };</span></span></code> </pre> <br>  Indeed, the destructor is not marked as virtual and here is an example of a class that, because of this, may not be completely removed from memory: <br><pre> <code class="cpp hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VirtualSystemItem</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> ModelItem <span class="hljs-comment"><span class="hljs-comment">//&lt;== { public: VirtualSystemItem(....); virtual QVariant data(int column, int role) const; virtual void putBack(....); private: CVirtualSystemDescription m_desc; //&lt;== };</span></span></code> </pre> <br>  Another suspicious class: <ul><li>  V599 The virtual class contains virtual functions.  performance.h 855 </li></ul><br><h2>  More problem areas </h2><br>  <a href="http://www.viva64.com/ru/d/0119/">V530</a> The return value of the function '_wgetenv' is required to be utilized.  env-generic.cpp 239 <br><pre> <code class="cpp hljs">RTDECL(<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>) RTEnvClone(PRTENV pEnv, RTENV EnvToClone) { .... papwszEnv = (PCRTUTF16 * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>)_wenviron; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!papwszEnv) { _wgetenv(<span class="hljs-string"><span class="hljs-string">L"Path"</span></span>); <span class="hljs-comment"><span class="hljs-comment">/* Force the CRT to initalize it. */</span></span> papwszEnv = (PCRTUTF16 * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>)_wenviron; } .... }</code> </pre> <br><br>  The "_wgetenv" function returns the value of the environment variable, but in this fragment its value is not used and the "papwszEnv" pointer remains zero.  Probably, the code under the condition should be: <br><pre> <code class="cpp hljs">_wenviron = _wgetenv(<span class="hljs-string"><span class="hljs-string">L"Path"</span></span>); papwszEnv = (PCRTUTF16 * <span class="hljs-keyword"><span class="hljs-keyword">const</span></span>)_wenviron;</code> </pre> <br>  <a href="http://www.viva64.com/ru/d/0181/">V579</a>  It is possibly a mistake.  Inspect the third argument.  vboxdispd3dif.cpp 980 <br><pre> <code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">typedef</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">VBOXWDDMDISP_FORMATS</span></span></span><span class="hljs-class"> {</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> cFormstOps; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FORMATOP</span></span></span><span class="hljs-class">* </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paFormstOps</span></span></span><span class="hljs-class">;</span></span> <span class="hljs-keyword"><span class="hljs-keyword">uint32_t</span></span> cSurfDescs; <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">struct</span></span></span><span class="hljs-class"> _</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DDSURFACEDESC</span></span></span><span class="hljs-class"> *</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">paSurfDescs</span></span></span><span class="hljs-class">;</span></span> } VBOXWDDMDISP_FORMATS, *PVBOXWDDMDISP_FORMATS; <span class="hljs-comment"><span class="hljs-comment">//&lt;== static void vboxDispD3DGlobalD3DFormatsInit(PVBOXWDDMDISP_FORMATS pFormats) { memset(pFormats, 0, sizeof (pFormats)); //&lt;== pFormats-&gt;paFormstOps = gVBoxFormatOps3D; pFormats-&gt;cFormstOps = RT_ELEMENTS(gVBoxFormatOps3D); }</span></span></code> </pre> <br>  In this snippet, the 'memset' function does not completely nullify the structure, since sizeof () returns the size of the pointer, rather than the entire structure. <br><br>  <a href="http://www.viva64.com/ru/d/0224/">V609</a> Divide by zero.  Denominator range [0..64].  vboxmpif.h 746 <br><pre> <code class="cpp hljs">DECLINLINE(UINT) vboxWddmCalcWidthForPitch(....) { <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (enmFormat) { .... <span class="hljs-keyword"><span class="hljs-keyword">default</span></span>: { <span class="hljs-comment"><span class="hljs-comment">/* the default is just to calculate it from bpp */</span></span> UINT bpp = vboxWddmCalcBitsPerPixel(enmFormat); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> (Pitch &lt;&lt; <span class="hljs-number"><span class="hljs-number">3</span></span>) / bpp; <span class="hljs-comment"><span class="hljs-comment">//&lt;== } } }</span></span></code> </pre> <br>  Potential division by zero due to lack of verification.  There is no guarantee that the ‚ÄúvboxWddmCalcBitsPerPixel‚Äù function will not return zero now or will not return zero after someone else edits. <br><br><h2>  Conclusion </h2><br>  This is the final article about checking VirtualBox with <a href="http://www.viva64.com/ru/pvs-studio/">PVS-Studio</a> analyzer.  I am more than sure that the authors of the project can find many more dangerous places here, both with the help of this analyzer and others. <br><br>  I hope the article on checking VirtualBox will get the most out of it and such an important product for developers, testers and other active users will be a little better. <br><br>  Using static analysis regularly, you can save a lot of time on solving more useful tasks.  Also, control over the quality of the code can be shifted to others, for example, using the new service: <a href="http://www.viva64.com/go.php%3Furl%3D1440">regular auditing of C / C ++ code</a> . <br><br><h2>  This article is in English. </h2><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Svyatoslav Razmyslov.  <a href="http://www.viva64.com/en/b/0282/">Checking Oracle VM VirtualBox.</a>  <a href="http://www.viva64.com/en/b/0282/">Part 2</a> . <br><br><div class="spoiler">  <b class="spoiler_title">Read the article and have a question?</b> <div class="spoiler_text">  Often our articles are asked the same questions.  We collected the answers to them here: <a href="http://www.viva64.com/ru/a/0085/">Answers to questions from readers of articles about PVS-Studio and CppCat, version 2014</a> .  Please review the list. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/237693/">https://habr.com/ru/post/237693/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../237683/index.html">Conference Tabtabus Days invites partners and speakers in Smolensk on November 7 and 8</a></li>
<li><a href="../237685/index.html">New service from Fortumo.com for carrier billing of purchases in Windows Phone and Windows applications</a></li>
<li><a href="../237687/index.html">Mobile HTML5</a></li>
<li><a href="../237689/index.html">How-to: Creating trading robots in TradeScript vol. 2</a></li>
<li><a href="../237691/index.html">The little robot controls the plane like a real pilot.</a></li>
<li><a href="../237695/index.html">Statistical verification of randomness of binary sequences using NIST methods</a></li>
<li><a href="../237697/index.html">Some interesting and useful things for web developer # 29</a></li>
<li><a href="../237699/index.html">Professions of the future: 3D printing in medicine</a></li>
<li><a href="../237701/index.html">Why can't I reset my password?</a></li>
<li><a href="../237703/index.html">From smart glass to smart home - the wonders of Chinese startups</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>