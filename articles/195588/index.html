<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>[UPD] Chain.js: link synchronous and asynchronous functions in the chain</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Chain.js is a small library made to create chains of synchronous and asynchronous functions. The idea of ‚Äã‚Äãchains was born after getting acquainted wi...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>[UPD] Chain.js: link synchronous and asynchronous functions in the chain</h1><div class="post__text post__text-html js-mediator-article">  <b>Chain.js</b> is a small library made to create chains of synchronous and asynchronous functions.  The idea of ‚Äã‚Äãchains was born after getting acquainted with <a href="http://wiki.commonjs.org/wiki/Promises">Common JS Promises</a> .  The definition of ‚Äúpromises‚Äù itself says that <i>promise</i> is the meaning of performing one operation.  If you want to invent, invent or create something, then you simply must try to link these operations into chains.  Of course, you do not have to, and this is natural, but for me this has become the main motive.  Before that, I did encounter some inconveniences in binding <i>promise</i> operations, although I expected that with this they would help me. <br><a name="habracut"></a><br><h4>  Start </h4><br>  The very existence of <i>Common JS Promises</i> I was known for a long time.  I was pushed to mutual penetration by <a href="http://angularjs.org/">Angular.js</a> , which has its <a href="">promise / deferred</a> implementation.  Having suffered a little with the realization of those promise-based chains, it became clear that <i>promises were</i> not intended for this.  Therefore, it was decided to <s>reinvent the wheel and</s> go on to make the necessary functionality on its own. <br><br><h4>  To business </h4><br>  In the course of thinking about the software interface, <b>Chain.js</b> acquired a list of 5 functions: 1 constructor and 4 methods.  The compressed implementation has a size of 2.03KB, the full (no comment ^ _ ^) implementation has a size of 3.15KB.  You can download these files on a page made specifically for <a href="http://phosor.github.io/chain/">Chain.js</a> .  No direct links, I'm afraid I can break. <br>  Installation is trivial, no different from other scripts. <br><br><pre><code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"js/chain.dev.js"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"text/javascript"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  After that, the library is available in the global scope ( <code>window</code> , apparently) under the name <code>Chain</code> .  <code>Chain</code> is the constructor of the new chain and has two main call options (you can think up additional options yourself): 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> testChain = Chain(); <span class="hljs-comment"><span class="hljs-comment">//  var anotherChain = new Chain;</span></span></code> </pre><br>  Now we can <s>feel all the power to</s> create our chains, for this we have 3 methods: <br><ul><li> <code>.then(Function | Array.&lt;Function&gt;)</code> </li> <li> <code>.defer(Function | Array.&lt;Function&gt;)</code> </li> <li> <code>.when(Chain | Array.&lt;Chain&gt;)</code> </li> </ul><br>  The <code>.then</code> method accepts synchronous functions, <code>.defer</code> - asynchronous, <code>.when</code> - <code>Chain</code> objects.  All 3 methods return a <code>Chain</code> object for which they are invoked (just like <i>jQuery chaining</i> ).  Also, these methods can take either one required argument or an array of such arguments.  For the <code>.then</code> and <code>.defer</code> result of the execution of the previous link is passed to the next in the specified function by the first argument. <br>  The chain is executed only when the <code>.end</code> method is <code>.end</code> , it is the last library method. <br>  Has such a signature: <br><ul><li>  .end ([Function]) </li></ul><br>  The function will be called upon completion of all operations in the chain.  Specifying a function is optional. <br>  Examples for understanding: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calculate = Chain(); calculate. then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//      undefined return 0; }). then(function(result) { //   , result  0 return result + 5; }). then(function(result) { // result  5 return result + 10; }). end(function(result) { console.log(result); }); //  15</span></span></code> </pre><br>  A different entry with the same result: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calculate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Chain; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zero</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plus5</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num + <span class="hljs-number"><span class="hljs-number">5</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plus10</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> num + <span class="hljs-number"><span class="hljs-number">10</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result); } calculate. then([zero, plus5, plus10]). end(log); <span class="hljs-comment"><span class="hljs-comment">//  15</span></span></code> </pre><br>  Let's do the same asynchronously: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calculate = Chain(); calculate. defer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n, done</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">//     undefined, //  - ,        done(0); }). defer(function(result, done) { // result  0 //    setTimeout(function() { done(result + 5); }, 1000); }). defer(function(result, done) { // result  5 done(result + 10); }). end(function(result) { console.log(result); }); //  15</span></span></code> </pre><br>  The same thing, in a different way: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> calculate = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Chain; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">zero</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n, done</span></span></span><span class="hljs-function">) </span></span>{ done(<span class="hljs-number"><span class="hljs-number">0</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plus5</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num, done</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ done(num + <span class="hljs-number"><span class="hljs-number">5</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">plus10</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num, done</span></span></span><span class="hljs-function">) </span></span>{ done(num + <span class="hljs-number"><span class="hljs-number">10</span></span>); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">log</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">result</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(result); } calculate. defer([zero, plus5, plus10]). end(log); <span class="hljs-comment"><span class="hljs-comment">//  15</span></span></code> </pre><br>  Finally, the <code>.when</code> method is used to connect the rest of your chains.  After executing the <code>.when</code> method, the <code>.when</code> to the next link with the result of executing the previous chain links.  Example: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> five = Chain(), ten = Chain(); five.defer(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">n, done</span></span></span><span class="hljs-function">) </span></span>{ setTimeout(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ done(<span class="hljs-number"><span class="hljs-number">5</span></span>); }, <span class="hljs-number"><span class="hljs-number">1000</span></span>); }); ten. when(five). then(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">results</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> results[<span class="hljs-number"><span class="hljs-number">0</span></span>] + <span class="hljs-number"><span class="hljs-number">5</span></span>; }); <span class="hljs-comment"><span class="hljs-comment">// results   [5] Chain(). when([ten, five, ten]). end(function(results) { console.log(results); }); //  [10, 5, 10]</span></span></code> </pre><br><br><h4>  Work features </h4><br>  The chains passed to the <code>.when</code> method <code>.when</code> executed in parallel.  The sequence in the resulting array will correspond to the sequence of connection (addition) of the specified chains, see the last example. <br><br>  All functions transferred to the <code>.end</code> method after the start of the chain will wait for the chain to complete, that is, the chains will not be launched twice.  Insert <code>console.log</code> into each function in the last example, it will become clearer. <br><br>  The result of chain execution is saved and will be returned each time the <code>.end</code> method is <code>.end</code> ; the chain will not be started.  In fact, the <code>.end</code> method can take the second argument, forcing the chain to start again, but this behavior is not brought to mind.  If you <b>like Chain.js</b> , then I pledge to deal with this behavior. <br>  Also, interruption of chain execution is not implemented, although it is possible and easy to implement. <br><br><h4>  the end </h4><br>  Is it the end?  Welcome your comments, suggestions, wishes.  Thanks for attention. <br><br><h4>  <b>Update.</b>  Comparison with solutions in other libraries </h4><br>  After the third comment with a question on what <b>Chain.js</b> is different from other libraries, I was uncomfortable to be silent.  I contacted <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> and asked him to help with the implementation of a simple task in <b>when.js.</b>  <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> agreed to help and very soon showed an approximate solution to the proposed problem.  For example, the following problem was proposed: asynchronously, we get the domain of the service of interest to us, then we generate a link to a specific address, we obtain data at that address, and show the data to the user.  Roughly portray it with this view: <br><ul><li>  get domain name -&gt; generate link -&gt; get data -&gt; display to user </li></ul><br>  After that, I adapted the <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> solution <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">example</a> under <b>Chain.js</b> .  Links to the Github Gist code: <br><ul><li>  <s><a href="https://gist.github.com/vslinko/6743039">example of a solution for <b>when.js</b> and deferred objects</a></s> </li><li>  <s><a href="https://gist.github.com/PhoSor/6743564">sample solution on <b>Chain.js</b></a></s> </li></ul><br>  Now you can compare the examples yourself and make your decision.  If you want to add a solution using another library you can contact me, I will try to help you. <br><br>  Also, during the discussion of the code with <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> , the idea of ‚Äã‚Äãexpanding <b>Chain.js</b> was born in order to make it possible to use <s><a href="https://gist.github.com/PhoSor/ff16d775bb4161656ad8">this</a></s> solution.  Thanks again for your attention. <br><br><h4>  <b>Update number 2.</b>  Continuation </h4><br>  In the continuation of a brief discussion, <a href="https://habrahabr.ru/users/keepyourmind/" class="user_link">KeepYourMind</a> and <a href="https://habrahabr.ru/users/can3p/" class="user_link">can3p</a> explained to me that all the described functionality is already present in the <b>when.js</b> library.  So, I admit that <b>Chain.js</b> is only a bicycle.  However, it remains true that this functionality is not fixed in <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises / A.</a> <br><br>  If you liked the examples of solutions proposed in the article and on the links, I advise you to get acquainted with <a href="https://github.com/cujojs/when/">when.js</a> , which I will definitely do.  Thank you all very much. </div><p>Source: <a href="https://habr.com/ru/post/195588/">https://habr.com/ru/post/195588/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../195578/index.html">GNOME Shell Extensions</a></li>
<li><a href="../195580/index.html">We look at the world through the eyes of a mantis cancer: the near infrared range</a></li>
<li><a href="../195582/index.html">See the invisible, or a little about the secrets of mail.ru</a></li>
<li><a href="../195584/index.html">The author of scientific articles Clive Thompson does not think that technology makes us sillier.</a></li>
<li><a href="../195586/index.html">RailsClub'Moscow 2013. The conference has begun!</a></li>
<li><a href="../195590/index.html">Two hares - SOPA and IP4, one solution</a></li>
<li><a href="../195592/index.html">Running and using OpenWrt in VirtualBox</a></li>
<li><a href="../195594/index.html">Autonomous monitoring system with a small budget</a></li>
<li><a href="../195596/index.html">We test and monitor MSTP in a heterogeneous network</a></li>
<li><a href="../195598/index.html">Curiosity found water!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>