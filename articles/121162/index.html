<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Testing. Start</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. In this series of posts, I will try to tell you about testing python code, in particular, django projects. We will consider unit testing (unit te...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Testing. Start</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/9c1771f8/cfce96c6/2a16a33b/5e5c4cef.png" align="right"><br>  Hey.  In this series of posts, I will try to tell you about testing python code, in particular, django projects.  We will consider unit testing (unit tests), static code analysis and some of the pitfalls of website testing. <br><br>  We omit the introductory part about the benefits of testing - the code covered with tests becomes soft and silky, only lazy has not yet read / written about it. <br><a name="habracut"></a><br><h4>  unittest </h4><br>  A standard module for implementing unit tests (unittest, previously pyunit) appeared in version 2.1 of python and was a JUnit port with Java (even the naming of methods was left by camelCase, contrary to <a href="http://www.python.org/dev/peps/pep-0008/">pep8</a> ).  In python 2.7 (3.2), many new interesting things were added to unittest: additional checks ( <code>assert*</code> ), decorators to skip a single test ( <code>@skip</code> , <code>@skipIf</code> ) or identify broken tests that the developer knows about ( <code>@expectedFailure</code> ), the way run from the command line.  There is also a port of these changes for Python 2.4 and above, called <a href="http://pypi.python.org/pypi/unittest2">unittest2</a> . <br><br>  How this thing works.  Suppose we have a non-humanly complex module, run_once.py: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_once</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" .    . """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> hasattr(_f, <span class="hljs-string"><span class="hljs-string">"_retval"</span></span>): _f._retval = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _f._retval <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _f</code> </pre><br>  <sub>(This is the decorator, which stores the result of the first call to the parameter function and always returns the saved value.)</sub> <br><br>  The test of our module may look something like this: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> unittest <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Test</span></span></span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">(unittest.TestCase)</span></span></span><span class="hljs-class">:</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_run_once</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(self)</span></span></span><span class="hljs-function">:</span></span> @run_once <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">#     inc()... self.assertEqual(inc(7), 8) # ...  --   self.assertEqual(inc(0), 8) if __name__ == "__main__": unittest.main()</span></span></code> </pre><br>  The last two lines are a trigger that will find and run all the tests in this module.  Now in the console we can execute <br><br><pre> <code class="bash hljs">$ python run_once.py</code> </pre><br>  And observe the test result: <br><br><pre> <code class="hljs bash">. --- Ran 1 <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> 0.000s OK</code> </pre><br><h4>  doctest </h4><br>  Since unit tests today will surprise no one, I will show one thing specific to python - the doctests.  It‚Äôs really easier to show than to explain: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">run_once</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(f)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-string"><span class="hljs-string">""" &gt;&gt;&gt; @run_once ... def foo(n): return n + 1 &gt;&gt;&gt; foo(7) 8 &gt;&gt;&gt; foo(0) 8 """</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">_f</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(*args, **kwargs)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> hasattr(_f, <span class="hljs-string"><span class="hljs-string">"_retval"</span></span>): _f._retval = f(*args, **kwargs) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _f._retval <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _f <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> __name__ == <span class="hljs-string"><span class="hljs-string">"__main__"</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> doctest doctest.testmod()</code> </pre><br>  Key to start: <br><br><pre> <code class="hljs ruby">$ python run_once2.py -v <span class="hljs-symbol"><span class="hljs-symbol">Trying:</span></span> @run_once <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">foo</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span></span>: <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n + <span class="hljs-number"><span class="hljs-number">1</span></span> Expecting nothing ok <span class="hljs-symbol"><span class="hljs-symbol">Trying:</span></span> foo(<span class="hljs-number"><span class="hljs-number">7</span></span>) <span class="hljs-symbol"><span class="hljs-symbol">Expecting:</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ok <span class="hljs-symbol"><span class="hljs-symbol">Trying:</span></span> foo(<span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-symbol"><span class="hljs-symbol">Expecting:</span></span> <span class="hljs-number"><span class="hljs-number">8</span></span> ok <span class="hljs-number"><span class="hljs-number">1</span></span> items had no <span class="hljs-symbol"><span class="hljs-symbol">tests:</span></span> __main_<span class="hljs-number"><span class="hljs-number">_</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> items passed all <span class="hljs-symbol"><span class="hljs-symbol">tests:</span></span> <span class="hljs-number"><span class="hljs-number">3</span></span> tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> __main_<span class="hljs-number"><span class="hljs-number">_</span></span>.run_once <span class="hljs-number"><span class="hljs-number">3</span></span> tests <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> items. <span class="hljs-number"><span class="hljs-number">3</span></span> passed <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span> failed. Test passed.</code> </pre><br>  We see that the docstring functions turned into sample code that is equally understandable (hopefully) to both the developer and the interpreter. <br><br>  Compared to classic unit tests, doctoral tests have both advantages (ease of writing, can be copied directly from an interactive python session; documentation always corresponds to the code) and disadvantages (complex code quickly becomes unreadable; the text editor does not highlight such code, but static the analyzer will not find any errors in it).  However, nothing prevents the use of pre-tests for small obvious things (as in the example), and unit tests for more complex tasks. <br><br><h4>  py.test </h4><br>  Along with the tools included in the standard python supply, there are alternative tools, for example, <a href="http://doc.pytest.org/en/latest/">py.test</a> .  Installation takes place as usual <br><br><pre> <code class="bash hljs">easy_install -U pytest <span class="hljs-comment"><span class="hljs-comment">#  pip install -U pytest</span></span></code> </pre><br>  Take the function from the first example.  A modified unit test will look something like this: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">test_run_once</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">:</span></span> @run_once <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">inc</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(n)</span></span></span><span class="hljs-function">:</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> n + <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-comment"><span class="hljs-comment">#     inc()... assert inc(7) == 8 # ...  --   assert inc(0) == 8</span></span></code> </pre><br>  Go: <br><br><pre> <code class="hljs pgsql">$ py.test run_once3.py === test <span class="hljs-keyword"><span class="hljs-keyword">session</span></span> starts === platform darwin <span class="hljs-comment"><span class="hljs-comment">-- Python 2.6.1 -- pytest-2.0.3 collected 1 items run_once3.py . === 1 passed in 0.01 seconds ===</span></span></code> </pre><br>  Key features of py.test (good): no API (in fairness: in exceptional cases, the API is still necessary, but it is very small);  assert checks  This provides a potential opportunity to run the test even without py.test installed, for example, on the production server after the calculation (you never know).  Tests can be designed as classes (in the style of unittest), and simply functions of the type <code>test_*</code> . <br><br>  The lack of an API, however, has a downside: a new developer, having connected to the project, may simply not understand how to run this heap of functions.  However, the new developer will be so short-lived, and it is better to document the way to launch tests in any case, out of harm's way. <br><br><h4>  nose </h4><br>  <a href="http://somethingaboutorange.com/mrl/projects/nose/1.0.0/">nose</a> is a tool for running tests through unittest (and doctest, with the key - with <code>--with-doctest</code> ).  It also has its own API, which is optional.  Successfully fulfills all the above examples: <br><br><pre> <code class="hljs erlang-repl">$ nosetests * -v --with-doctest test_run_once (run_once.Test) ... ok Doctest: run_once2.run_once ... ok run_once3.test_run_once ... ok --- Ran <span class="hljs-number"><span class="hljs-number">3</span></span> tests in <span class="hljs-number"><span class="hljs-number">0.008</span></span>s OK</code> </pre><br>  As <a href="https://habrahabr.ru/users/yur4eg/" class="user_link">Yur4eg</a> suggests (thank you!), Nose automatically collects tests from files of the type <code>test_*</code> , smart enough to look at the tests daddy, if any, can measure code coverage (code coverage) using <a href="http://nedbatchelder.com/code/coverage/">coverage.py</a> ( <nobr><code>--with-coverage</code></nobr> ) .  You can also run only tests that fell off on the last run ( <nobr><code>--failed</code></nobr> ). <br><br>  Behind this otklanivayus.  It remains only to attach the <a href="http://cl.ly/1815320x2a1H3n3D2f0T">source code of examples</a> , three pieces.  Public domain. <br><br>  <i><a href="http://habrahabr.ru/blogs/django/122156/">In the next issue</a> : regular django testing tools and how to deal with them.</i> </div><p>Source: <a href="https://habr.com/ru/post/121162/">https://habr.com/ru/post/121162/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../121154/index.html">I invite everyone to the cinema!</a></li>
<li><a href="../121155/index.html">Etiquette</a></li>
<li><a href="../121157/index.html">QtSpeech, text-to-speech access</a></li>
<li><a href="../121158/index.html">Master class in Kiev, June 18 (Sat)</a></li>
<li><a href="../121159/index.html">Installing Asp.Net on Linux (nginx + mono + xsp)</a></li>
<li><a href="../121165/index.html">Documentary Foundation announces release of LibreOffice 3.4.0</a></li>
<li><a href="../121166/index.html">Without Agents.com - Is it possible to rent / rent an apartment without intermediaries?</a></li>
<li><a href="../121167/index.html">Story about ExecJS or how to execute javascript in Ruby</a></li>
<li><a href="../121169/index.html">Architecture of intelligent transport systems on the example of US DoT ITS</a></li>
<li><a href="../121171/index.html">Yesterday's ban - tomorrow's exclusive</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>