<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Mastering F #: building a colorful Mandelbrot set with navigation and integration with C #</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="opening speech 
 This article is intended for those who are at least a little familiar with the languages ‚Äã‚ÄãC # and F #. In any case, I tried to make ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Mastering F #: building a colorful Mandelbrot set with navigation and integration with C #</h1><div class="post__text post__text-html js-mediator-article"><h4>  opening speech </h4><br>  This article is intended for those who are at least a little familiar with the languages ‚Äã‚ÄãC # and F #.  In any case, I tried to make the code as readable as possible and give a description of each piece.  You can familiarize yourself with the F # language in the following articles: <br><ul><li>  <a href="http://habrahabr.ru/blogs/net/116666/">Introduction to F #, or useful about useless</a> </li><li>  <a href="http://habrahabr.ru/blogs/net/47812/">F #: Hello, World!</a> </li><li>  <a href="http://msdn.microsoft.com/ru-ru/magazine/cc164244.aspx">MSDN: First Introduction to F #</a> </li></ul><br>  On Habr√©, many common words have already been written about the F # language - its history, origin, and features.  I do not want to repeat myself, so I propose to go straight to the point.  So, the action plan is as follows: <br><ol><li>  Construction of the Mandelbrot set; </li><li>  Results visualization; </li><li>  Integration with C # and not only with it. </li></ol>  So let's go. <br><a name="habracut"></a><br><br><h4>  Construction of the Mandelbrot set </h4><br>  An example of building a Mandelbrot set in the F # language <a href="http://habrahabr.ru/blogs/programming/53626/">has already been considered on Habr√©</a> , but we will take a slightly different approach and consider some points in more detail. <br><br><h5>  How is the Mandelbrot set defined? </h5><br>  Consider a sequence of numbers generated by the following equation: <br>  C <sub>n + 1</sub> = C <sub>n</sub> <sup>2</sup> + c <sub>0</sub> <br>  If such a sequence does not go beyond the two complex numbers C <sub>1</sub> (1, 1i) and C <sub>2</sub> (-1, -1i), then the complex number c <sub>0</sub> belongs to the Mandelbrot set.  Therefore, the Mandelbrot set is the set of all such numbers c <sub>0</sub> , for which the sequence considered above remains within C <sub>1</sub> and C <sub>2</sub> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Mandelbrot set and F # </h5><br>  To work with complex numbers in F # there is a library Microsoft.FSharp.Math, which, in turn, is available <a href="http://fsharppowerpack.codeplex.com/">in the FsharpPowerPack package</a> (you can also find the installation guide and other useful information about this package by clicking the link).  Add this library to our project and specify it: <br><br><pre><code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">open</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Microsoft</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.FSharp</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Math</span></span></code> </pre> <br>  Now we can manipulate complex numbers in the program.  Define the minimum and maximum boundaries: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cMax = complex <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cMin = complex -<span class="hljs-number"><span class="hljs-number">1.0</span></span> -<span class="hljs-number"><span class="hljs-number">1.0</span></span></code> </pre><br>  Let's go directly to the function.  We implement the function of checking membership in the set as follows: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rec isInMandelbrotSet (z, <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, iter, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cMin &lt; z) &amp;&amp; (z &lt; cMax) &amp;&amp; (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; iter) then isInMandelbrotSet ( ((z * z) + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, iter, (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span></code> </pre><br>  The recursive <code>isInMandelbrotSet</code> function works until the number to be tested goes beyond cMax and cMin, and the recursion depth does not exceed the number of iterations.  Upon completion, the function returns the number of perfect recursion steps (this will come in handy later when we ‚Äúcolor‚Äù our set). <br><br><h4>  Results visualization </h4><br>  We have already built a lot, it remains only to display it.  But here the fun begins. <br><br>  Since complex numbers consist of two parts, we can create their mapping on a two-dimensional plane.  The Mandelbrot set exists between C <sub>1</sub> (1, 1i) and C <sub>2</sub> (-1, -1i), therefore the coordinate system we need will have a center at the point (0, 0), the abscissa and ordinate axes will be limited to -1.0 and 1.0. <br><img src="http://balloons-saratov.ru/temp/complex_plane.png" alt="image"><br><br>  Therefore, we need to transfer the coordinates of the points from the complex plane to the one used in the construction of the image. <br><br>  We do this as follows: <br><br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> scalingFactor s = s * <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">200.0</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">let</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">mapPlane</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">x, y, s, mx, my</span></span></span><span class="hljs-function">)</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fx = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> x) * scalingFactor s) + mx <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fy = ((<span class="hljs-keyword"><span class="hljs-keyword">float</span></span> y) * scalingFactor s) + my complex fx fy</code> </pre><br>  This function will return the corresponding complex number for each point of the ‚Äúfamiliar‚Äù plane.  We will use the mx and my values ‚Äã‚Äãin the future to implement navigation in our image. <br><br>  Now we can easily draw our entire set on the familiar plane.  To do this, we need to ‚Äúwalk‚Äù through all the coordinates of the plane and check that each point (more precisely, the corresponding complex number) belongs to the Mandelbrot set.  If the point belongs to the set, we will make it black, otherwise - we will color it in another color.  To do this, we will make a special function ‚Äúcoloring‚Äù: <br><br><pre> <code class="hljs swift"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> colorize <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> r = (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> g = (<span class="hljs-number"><span class="hljs-number">6</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = (<span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-type"><span class="hljs-type">Color</span></span>.<span class="hljs-type"><span class="hljs-type">FromArgb</span></span>(r,g,b)</code> </pre><br>  The function will take the number of iterations we received from the isInMandelbrotSet function and determine the RGB color value.  Numerical coefficients can be set any, but in order to achieve a smooth transition of colors, it is desirable to set them with a small difference.  Also, here we need the System.Drawing library: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Drawing</code> </pre><br>  With the help of this library, we will create a new bitmap-image and will add points of a certain color to it.  So, our drawing function will look like this: <br><br><pre> <code class="hljs pgsql">let createImage (s, mx, my, iter) = let image = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Bitmap(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> image.Width - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> image.Height - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> let count = isInMandelbrotSet( Complex.Zero, (mapPlane (x, y, s, mx, my)), iter, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> count = iter <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> image.SetPixel(x,y, Color.Black) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> image.SetPixel(x,y, colorize( count ) ) let <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> Form() <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span>.Paint.<span class="hljs-keyword"><span class="hljs-keyword">Add</span></span>(fun e -&gt; e.Graphics.DrawImage(image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">temp</span></span></code> </pre><br>  Here we use the System.Windows.Forms component: <br><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">System</span></span>.Windows.Forms</code> </pre><br>  It remains only to run our program and enjoy the result.  You can do this as follows: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">do</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Application</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.Run</span></span>(<span class="hljs-selector-tag"><span class="hljs-selector-tag">createImage</span></span> (1<span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span>, <span class="hljs-selector-tag"><span class="hljs-selector-tag">-1</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span>, 20))</code> </pre><br>  We specify the initial parameters: scale, offset in X and Y, as well as the number of iterations.  The greater the number of iterations, the more detailed our image will be (and, accordingly, the longer it will take to create).  Something like this should get the result of the work: <br><img src="http://balloons-saratov.ru/temp/fractal.png" alt="image"><br><br>  So, the full listing of our program: <br><br><pre> <code class="hljs swift">#light <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-type"><span class="hljs-type">Microsoft</span></span>.<span class="hljs-type"><span class="hljs-type">FSharp</span></span>.<span class="hljs-type"><span class="hljs-type">Math</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Drawing</span></span> <span class="hljs-keyword"><span class="hljs-keyword">open</span></span> <span class="hljs-type"><span class="hljs-type">System</span></span>.<span class="hljs-type"><span class="hljs-type">Windows</span></span>.<span class="hljs-type"><span class="hljs-type">Forms</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cMax = complex <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> cMin = complex -<span class="hljs-number"><span class="hljs-number">1.0</span></span> -<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> rec isInMandelbrotSet (z, <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, iter, <span class="hljs-built_in"><span class="hljs-built_in">count</span></span>) = <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (cMin &lt; z) &amp;&amp; (z &lt; cMax) &amp;&amp; (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> &lt; iter) then isInMandelbrotSet ( ((z * z) + <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>), <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>, iter, (<span class="hljs-built_in"><span class="hljs-built_in">count</span></span> + <span class="hljs-number"><span class="hljs-number">1</span></span>) ) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> scalingFactor s = s * <span class="hljs-number"><span class="hljs-number">1.0</span></span> / <span class="hljs-number"><span class="hljs-number">200.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> offsetX = -<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> offsetY = -<span class="hljs-number"><span class="hljs-number">1.0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> mapPlane (x, y, s, mx, my) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fx = ((float x) * scalingFactor s) + mx <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> fy = ((float y) * scalingFactor s) + my complex fx fy <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> colorize <span class="hljs-built_in"><span class="hljs-built_in">c</span></span> = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> r = (<span class="hljs-number"><span class="hljs-number">4</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> g = (<span class="hljs-number"><span class="hljs-number">6</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> b = (<span class="hljs-number"><span class="hljs-number">8</span></span> * <span class="hljs-built_in"><span class="hljs-built_in">c</span></span>) % <span class="hljs-number"><span class="hljs-number">255</span></span> <span class="hljs-type"><span class="hljs-type">Color</span></span>.<span class="hljs-type"><span class="hljs-type">FromArgb</span></span>(r,g,b) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> createImage (s, mx, my, iter) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = new <span class="hljs-type"><span class="hljs-type">Bitmap</span></span>(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span> to image.<span class="hljs-type"><span class="hljs-type">Width</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span> to image.<span class="hljs-type"><span class="hljs-type">Height</span></span> - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = isInMandelbrotSet( <span class="hljs-type"><span class="hljs-type">Complex</span></span>.<span class="hljs-type"><span class="hljs-type">Zero</span></span>, (mapPlane (x, y, s, mx, my)), iter, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> = iter then image.<span class="hljs-type"><span class="hljs-type">SetPixel</span></span>(x,y, <span class="hljs-type"><span class="hljs-type">Color</span></span>.<span class="hljs-type"><span class="hljs-type">Black</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> image.<span class="hljs-type"><span class="hljs-type">SetPixel</span></span>(x,y, colorize( <span class="hljs-built_in"><span class="hljs-built_in">count</span></span> ) ) <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> temp = new <span class="hljs-type"><span class="hljs-type">Form</span></span>() <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> temp.<span class="hljs-type"><span class="hljs-type">Paint</span></span>.<span class="hljs-type"><span class="hljs-type">Add</span></span>(fun e -&gt; e.<span class="hljs-type"><span class="hljs-type">Graphics</span></span>.<span class="hljs-type"><span class="hljs-type">DrawImage</span></span>(image, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>)) temp <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-type"><span class="hljs-type">Application</span></span>.<span class="hljs-type"><span class="hljs-type">Run</span></span>(createImage (<span class="hljs-number"><span class="hljs-number">1.5</span></span>, -<span class="hljs-number"><span class="hljs-number">1.5</span></span>, -<span class="hljs-number"><span class="hljs-number">1.5</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>))</code> </pre><br><br><h5>  Subtotals </h5><br>  As you can see, it took us a little more than 40 lines to create a ‚Äúcolor‚Äù Mandelbrot set and not so much time.  But we cannot yet fully enjoy the beauty of fractal images (we can be more precise, but it is quite inconvenient to change the scale of the image before each compilation).  To overcome this problem, it is necessary to add interface elements - navigation and zoom in / out keys, preferably changing the details. <br><br>  Of course, you can create all interface elements inside F # just as we created the form itself using the System.Windows.Forms library.  But on the other hand, it would be much more interesting (and, perhaps, more logical) to do it in the framework of a full-fledged Windows Forms application!  Well, then we will do it now. <br><br><h4>  Integration with C # and not only with it </h4><br>  After building an F # application, we get a library at the output that contains all the functionality we need.  For convenient access to the necessary functions of this library, we will declare a namespace in the F # code.  This is done as follows: at the very beginning of the code we add <br><br><pre> <code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">module</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Fractal</span></span></span></span></code> </pre><br>  In addition, we no longer need the form, as well as the code that runs it.  Therefore, now the function that we will call from the outside will look like this: <br><br><pre> <code class="hljs vbscript"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> createImage (s, mx, my, iter) = <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> image = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(<span class="hljs-number"><span class="hljs-number">400</span></span>, <span class="hljs-number"><span class="hljs-number">400</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> x = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> image.Width - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> y = <span class="hljs-number"><span class="hljs-number">0</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> image.Height - <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-keyword"><span class="hljs-keyword">let</span></span> count = isInMandelbrotSet( Complex.Zero, (mapPlane (x, y, s, mx, my)), iter, <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> count = iter <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> image.SetPixel(x,y, Color.Black) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> image.SetPixel(x,y, colorize( count ) ) image</code> </pre><br>  The function called createImage returns the generated bitmap-image containing the Mandelbrot set. <br><br><h5>  We use F # -library in Windows Forms </h5><br>  In fact, everything is very simple: you only need to add a ready-made library to a new project (for example, Windows Forms or any other).  Having created a project in MS Visual Studio, you can do this by using the Add Reference command in the Solution Explorer window, selecting the necessary library.  As we previously designated the namespace in the library ( <code>module Fractal</code> ), then in the new project all the functions of this library are available to us.  Now you can call the function that generates the finished image as follows: <br><br><pre> <code class="cs hljs">Bitmap image = Fractal.createImage(<span class="hljs-number"><span class="hljs-number">1.5</span></span>, <span class="hljs-number"><span class="hljs-number">-1.5</span></span>, <span class="hljs-number"><span class="hljs-number">-1.5</span></span>, <span class="hljs-number"><span class="hljs-number">20</span></span>);</code> </pre><br>  The resulting bitmap-image can already be used in any way - for example, add as a background to the element PictureBox. <br><br><h5>  Adding navigation elements </h5><br>  As you can see, we can ‚Äúrequest‚Äù the generation of an image with different parameters: scale, number of iterations, offset relative to X and Y. So, it‚Äôs easy to add navigation.  As a container for our image, we take a PictureBox, navigation is possible with the help of 6 buttons: zoom in / out, move up / down, left / right. <br><br>  For convenience, we will create a separate FractalClass class that will store the state of the current fractal: scale, offsets from the center, level of approximation.  The main class method will query the image of the set with the current parameters. <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Draw</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">int</span></span> iters = iterations + <span class="hljs-number"><span class="hljs-number">2</span></span> * steps; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Fractal.createImage(currSc, currMvX, currMvY, iters); }</code> </pre><br>  The rest of the class methods will change the state of the fractal and call the Draw () method.  So, for example, the approximation method might look like: <br><br><pre> <code class="cs hljs"> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Bitmap </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ZoomIn</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { scale = <span class="hljs-number"><span class="hljs-number">0.9</span></span> * scale; zoomSteps++; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Draw(); }</code> </pre><br>  It remains only to add a call to the corresponding methods of the FractalClass class to the navigation key handling.  The result will be approximately as follows: <br><img src="http://balloons-saratov.ru/temp/fractal_wf.png" alt="image"><br><br>  The ability to transfer to the function the required number of iterations allows you to detail the fractal as it approaches.  Therefore, with each step, the image becomes more and more interesting: <br><img src="http://balloons-saratov.ru/temp/fractal_wf2.png" alt="image"><br><br><h5>  Not only Windows Forms </h5><br>  Just as we used the functions of the connected library in a Windows Forms application, we can use the ready-made library in any other .NET application: be it Silverlight, a web application, or anything else. <br><br>  <b>Materials used:</b> <br><ul><li>  Robert Pickering - Beginning F # </li><li>  <a href="http://outcoldman.ru/ru/blog/show/126">C # and F # Integration</a> </li><li>  <a href="http://habrahabr.ru/blogs/programming/53626/">Falling in love with F #: Dose 2: Building a fractal image</a> </li></ul><br>  Thank you all for your attention, I hope it was interesting! <br><br>  PS: request for errors / inaccuracies in the text to notify personal messages. </div><p>Source: <a href="https://habr.com/ru/post/116775/">https://habr.com/ru/post/116775/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../116768/index.html">Making your Gmail Motion</a></li>
<li><a href="../116769/index.html">We protect the VPS-server based on Windows 2008 R2</a></li>
<li><a href="../116771/index.html">Mono and Windows Forms on the Nokia N900? Sure, not a problem!</a></li>
<li><a href="../116773/index.html">The Mozilla Foundation begins to educate users about how extensions slow down browser loading</a></li>
<li><a href="../116774/index.html">Parsing lincrackme3</a></li>
<li><a href="../116776/index.html">Google has become the most expensive brand of the planet.</a></li>
<li><a href="../116777/index.html">Happy webmasters!</a></li>
<li><a href="../116778/index.html">St. Petersburg Startup Weekend - business in exchange for technology</a></li>
<li><a href="../116779/index.html">Methods to attract customers for the hoster. Inside view</a></li>
<li><a href="../116781/index.html">How to design software to avoid problems: data processing web-form</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>