<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Osiris - the new reincarnation of the Locky Trojan</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Summary 
 At the end of January, Acronis experts discovered the new ransomware Osiris sample, which bypasses the protection of Windows Defender. Here ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Osiris - the new reincarnation of the Locky Trojan</h1><div class="post__text post__text-html js-mediator-article"><h2>  <font color="#00204D">Summary</font> </h2><br>  At the end of January, Acronis experts discovered the new ransomware Osiris sample, which bypasses the protection of Windows Defender.  Here are some details about the Osiris ransomware. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/104/71e/f3a/10471ef3ac67a85bbc5bc19913cbc8af.jpg"><br><a name="habracut"></a><br><ul><li>  Osiris belongs to the seventh generation of Locky family ransomware programs, and is usually distributed through spam; <br><br></li><li>  Osiris is difficult to detect, as it uses standard Windows components to download and execute malicious code (scripts and libraries); 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    </li><li>  Osiris has the ability to detect virtual environments, which makes debugging and debugging on virtual machines difficult;  this algorithm was significantly improved compared with the original version, which appeared in June 2016; <br><br></li><li>  It infects local devices and easily spreads over the network, infecting other computers and network folders; <br><br></li><li>  Osiris can also be distributed <u>through CRM / customer support systems</u> (including cloud) outside the same organization.  An infected user from any organization can send a letter to the CRM address;  its internal parser will analyze the incoming letter and attach the infected attachment to the automatically generated request (ticket).  The customer support engineer will open the application, open the attachment in Excel and infect the network. <br><br></li><li>  As assumed by Acronis experts, the fraudsters began attacking backup solutions.  Osiris directly attacks the Microsoft Volume Shadow Copy Service (VSS) of Windows operating systems, and removes already created shadow copies; <br><br></li><li>  Osiris uses powerful encryption algorithms, so that infected data cannot be decrypted by third-party tools; <br><br></li><li>  It infects devices on Windows, and also, perhaps, on Mac and Android; <br></li></ul><br>  Acronis Active Protection is the only technology that can block all versions of Osiris and at the same time instantly recover encrypted data, if Acronis True Image 2017 New Generation was launched on a computer at the time of a malicious attack. <br><br><h2>  <font color="#00204D">Attacks on backup solutions</font> </h2><br>  To prevent victims of an attack from restoring files from backups, Osiris <a href="https://community.spiceworks.com/topic/1951835-decrypt-files-encrypted-by-osiris-variant-of-locky-ransomware">disables the</a> Microsoft Volume Shadow Copy Service (VSS).  This technology is included in Microsoft Windows and allows you to make backups manually and automatically, or take a snapshot of the data. <br><br>  Osiris also <u>deletes already created shadow copies</u> by running the "vssadmin.exe Delete Shadows / All / Quiet" command in silent mode.  This does not allow the user to restore the system from the saved data on the infected computer. <br><br>  Microsoft VSS does not contain security measures for its protection and creates shadow copies from deleted or modified ones.  Acronis predicted such attacks on backup solutions and implemented self-defense techniques in its own products.  <a href="http://www.acronis.com/en-us/blog/posts/independent-test-acronis-true-image-2017-new-generation-outperforms-competitors-self">Independent tests have already shown</a> that Acronis products are resistant to the attacks used by Osiris. <br><br><h2>  <font color="#00204D">Evolution of the Locky family</font> </h2><br>  Locky ransomware Trojans received another update: the new extortionist coder called Osiris after the Egyptian god of the afterlife.  The malware came out with an updated functionality designed for attacks, including files on backup programs, and is able to avoid detection.  It adds the .orisis extension to the encrypted files and uses the standard ransomware scheme: infection, encryption, extortion.  Osiris, based on the best practices of the Locky family, is one of the most serious security threats that computer users face today. <br><br>  Locky was first discovered in February 2016 and has since undergone at least <a href="https://blogs.forcepoint.com/security-labs/many-evolutions-locky">seven changes</a> , trying to stay one step ahead of computer security solution providers attempting to detect and stop this type of ransomware program.  There are suggestions that Locky was developed in Russia, because early versions of the program did not infect computers with a Russian locale.  Excel tabs also use Russian names, and script functions are called Russian slang words. <br><br><ul><li>  .locky - February 2016 </li><li>  .zepto - June 2016. A month later, Locky began to support offline encryption using the built-in RSA keys in case he could not access his management server. </li><li>  .odin - September 2016 </li><li>  .shit, .thor - October 2016 </li><li>  .aesir - November 2016 </li><li>  .zzzzz, .osiris - December 2016 </li></ul><br>  Acronis security investigates the following example of Osiris extortionist: <br><br><ul><li>  File Name: ekijLpDlRXB.zk </li><li>  Size: 161625 bytes </li><li>  Date: 01/29/2017 </li><li>  MD5: 3545436c22a9a43e29396df87823013d </li></ul><br>  It is important to note that Osiris also infects Apple Mac and Android devices.  Acronis experts are now engaged in the study of this issue, for which it is planned to issue a separate report. <br><br><h2>  <font color="#00204D">Distribution scheme</font> </h2><br>  <b>1. Spam.</b>  Osiris is usually distributed through <a href="http://www.malware-traffic-analysis.net/2016/12/12/index2.html">spam emails</a> with the words "Account" or "Order Confirmation" in the subject line and a compressed attachment containing a malicious script.  This can be an Excel file with a macro on VBA or an executable script.jse (dropper).  When executed, it loads the DLL file and runs it with Rundll32.exe. <br><br>  Osiris authors try to hide the malware without using the .exe extension, instead of using standard Windows components to run their scripts and DLL files. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b2/ae5/f24/1b2ae5f24c3fabcbfb1db8e73ba91108.png"><br>  <i><font color="#999999">An example of a spam letter containing an attachment infected with Osiris (image used with permission from BleepingComputer).</font></i> <br><br>  <b>2. Malicious ads.</b>  Fraudsters using ransomware programs use legitimate ad networks to place special advertisements created for distributing ransomware programs with little or no user involvement.  Among the sites infected last year were the <a href="http://www.theinquirer.net/inquirer/news/2451209/angler-malvertising-ransomware-campaign-is-proving-a-nuisance">BBC, MSN and AOL</a> , with cyber criminals using automated ad networks to achieve their goals, allowing them to place <a href="https://blog.malwarebytes.com/101/2016/06/malvertising-and-ransomware-the-bonnie-and-clyde-of-advanced-threats/">malicious advertisements</a> after their account was first tested. <br><br><h2>  <font color="#00204D">Infection of corporate networks</font> </h2><br>  Osiris, like Locky, is a trojan with <a href="https://www.microsoft.com/security/portal/threat/encyclopedia/entry.aspx%3FName%3DWorm%2525253aWin32%2525252fLocky%26ThreatID%3D-2147420586">a worm</a> propagation method.  It has the ability to be distributed over the network without user intervention.  Some victims of his attacks noted the need to <a href="https://community.spiceworks.com/topic/1951835-decrypt-files-encrypted-by-osiris-variant-of-locky-ransomware%3Fpage%3D2">disable the domain controller</a> to stop the spread of the attack.  Osiris is capable of infecting thousands of shared folders, shared drives over a network, and other devices on the network.  For any business, the damage from the loss of so many devices on one network may be irreparable. <br><br>  Osiris can also be distributed <u>through CRM / customer support systems</u> (including cloud) outside the same organization.  An infected user from any organization can send a letter to the CRM address;  its internal parser will analyze the incoming letter and attach the infected attachment to the automatically generated request (ticket).  The customer support engineer will open the application, open the attachment in Excel and infect the network. <br><br><h2>  <font color="#00204D">Infection</font> </h2><br>  Dropper Osiris.js uses the <i>cheburgen</i> function to download malicious code <i>ekijLpDlRXB.zk.</i>  ( <i>Cheburgen is a compound word referring to the characters of the well-known cartoon Cheburashka and Crocodile Gena).</i> <br><br>  The latest version of the Osiris dropper, dated January 29, 2017, weighs 71 KB, which is twice the previous version released in December 2016. Currently, Windows Defender cannot detect it. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/486/e36/785/486e367855c8ceadb40fc4ab514df185.png"><br>  <i><font color="#999999">In the screenshot of the Monitor API you can see the execution of the cheburgen function.</font></i> <br><br>  The first attempt to download the malicious code was made using a Polish server. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/348/b40/bfd/348b40bfddd5b0b696b0d52bfd9fcdbb.png"><br>  <i><font color="#999999">In the screenshot of Process Monitor you can see how the dropper is trying to contact home.net.pl</font></i> <br><br>  However, the program then switched to the Russian server elixe [.] Net, which is currently blocked by most antivirus programs. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/fd8/6d2/16b/fd86d216bcf6e7251e0c8a72ab1553da.png"><br>  <i><font color="#999999">The Process Monitor screenshot shows the process of downloading malware from elixe [.] Net</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/f0b/5fb/d49/f0b5fbd49fb7a3b09a3440023cfd8a8f.png"><br>  <i><font color="#999999">The process of downloading ekijLpDlRXB.zk to the user‚Äôs temporary files directory.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/ad3/509/082/ad35090825c470a73974f158cc0e0f54.png"><br>  <i><font color="#999999">The Wireshark screenshot shows the download of malicious code of 161894 bytes in size.</font></i>  <i><font color="#999999">IP 92.255.47.9 probably belongs to the pool of IP addresses of the Osiris management server.</font></i> <br><br>  After a successful download, ekijLpDlRXB.zk is activated via rundll32.exe using the following command (for this instance): <br><br>  "C: \ Windows \ System32 \ rundll32.exe C: \ Users \% UserName% \ AppData \ Local \ Temp \ EKIJLP ~ 1.ZK, 0QaQzdZN8Pft5YPfVEdEYu" <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1f5/d40/73b/1f5d4073b7bed48432c1791a18319447.png"><br>  <i><font color="#999999">The Process Monitor screenshot shows the execution process using runndll32.exe</font></i> <br><br>  After activation, Osiris immediately begins to encrypt files and displays a message requesting a ransom using a default browser, for example, Firefox: <br><br><pre><code class="hljs perl">firefox.exe -osint -url <span class="hljs-string"><span class="hljs-string">"%USERPROFILE%\DesktopOSIRIS.htm"</span></span></code> </pre> <br><img src="https://habrastorage.org/getpro/habr/post_images/c6f/040/a4d/c6f040a4dc7720466df70a713e02768f.png"><br>  <i><font color="#999999">Message Osiris demanding redemption.</font></i> <br><br><h2>  <font color="#00204D">Virtual Environment Discovery</font> </h2><br>  Apparently, the detection mechanism of virtual machines, <a href="https://blogs.forcepoint.com/security-labs/locky-returned-new-anti-vm-trick">introduced</a> in July 2016, did not cope with the task.  The authors of Osiris improved the logic by replacing the function GetProcessHeap () with the function <b>GetOEMCP (),</b> updated the criteria for detecting the virtual environment based on CPU cycles (20 instead of 10), and also increased the number of checks (from one to two).  They also changed the detection criteria for virtual machines, reducing the runtime difference in virtual and physical environments from ten to three times. <br><br>  Detection of virtual machines is designed to prevent anti-virus experts from testing this malware inside virtual machines.  This algorithm, however, is inefficient, as Acronis experts were able to successfully test in a virtual environment.  The pseudocode function is presented below: <br><br><pre> <code class="hljs ruby">BOOL passNewImprovedVMCheck() {      unsigned __int64 tsc1;      unsigned __int64 tsc2;      unsigned __int64 tsc3;      BOOL firstPassResult;      BOOL secondPassResult;      int i = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>    <span class="hljs-number"><span class="hljs-number">20</span></span>  (   Locky   <span class="hljs-number"><span class="hljs-number">10</span></span> ) ‚Äî  ,    Locky          <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">20</span></span>; i++)      {       tsc1 = __rdtsc(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      ,  CloseHandle          GetOEMCP();       tsc2 = __rdtsc(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>       ,  GetOEMCP          CloseHandle(<span class="hljs-number"><span class="hljs-number">0</span></span>);       tsc3 = __rdtsc(); <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>         (    Locky  ¬´  ¬ª) /<span class="hljs-regexp"><span class="hljs-regexp">/      CloseHandle    GetOEMCP()? if ( ( LODWORD(tsc3) - LODWORD(tsc2) ) /</span></span> ( LODWORD(tsc2) - LODWORD(tsc1) ) &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>)         firstPassResult = TRUE;      }      <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!firstPassResult)                { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      GetOEMCP  CloseHandle    ‚Äî ,    !        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE;      } /<span class="hljs-regexp"><span class="hljs-regexp">/    ... if ( ( LODWORD(tsc3) - LODWORD(tsc2) ) /</span></span> ( LODWORD(tsc2) - LODWORD(tsc1) ) &gt;= <span class="hljs-number"><span class="hljs-number">3</span></span>)        secondPassResult = TRUE;      }           <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!secondPassResult)      { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span>      GetOEMCP  CloseHandle    ‚Äî ,    !        <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> FALSE;      }      <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> TRUE; }</code> </pre> <br><h2>  <font color="#00204D">How to protect against Osiris</font> </h2><br>  <a href="https://www.bugsfighter.com/remove-osiris-ransomware-decrypt-osiris-files/">Deciphering Osiris files ‚Äúmanually‚Äù is</a> impossible, as it uses strong encryption algorithms.  The probability of the appearance of utilities for decryption is extremely small. <br><br>  At the same time, Acronis Active Protection <b>successfully protects computer systems from Osiris malware</b> .  The basis of the innovative technology used in <a href="http://www.acronis.com/en-us/personal/computer-backup/"><b>Acronis True Image 2017 New Generation</b></a> , which is in the process of obtaining a patent, are behavioral heuristics, due to which it easily identifies and stops the activity of Osiris.  It also allows the user to instantly recover any infected files. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/424/aeb/1a4/424aeb1a44e3dec8d152796bd5702c8f.png"><br>  <i><font color="#999999">Osiris detection on a computer running Acronis True Image 2017 New Generation and Acronis Active Protection protection enabled.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/60e/e13/263/60ee13263cd63bbf2f1aeb58c98b9e1b.png"><br>  <i><font color="#999999">The screenshot shows that the attack was stopped, but several files were encrypted.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/937/9c3/742/9379c37420aa8d33794729887d6e9966.png"><br>  <i><font color="#999999">Four files encrypted with Osiris ransomware.</font></i> <br><br><img src="https://habrastorage.org/getpro/habr/post_images/203/310/2c4/2033102c4601e46d39a742ab336e23fa.png"><br>  <i><font color="#999999">All files were <b>instantly restored</b> to their original state using Acronis Active Protection without paying the ransom.</font></i> <br><br><h2>  <font color="#00204D">Can you afford to lose data in eight years?</font> </h2><br>  According to media reports, the Osiris ransomware program was used to <a href="https://www.theregister.co.uk/2017/01/27/texas_cops_lose_evidence_going_back_eight_years_in_ransomware_attack/">infect the Cockrell Hill Police Department in Texas,</a> which resulted <a href="https://www.scribd.com/document/337573961/Cockrell-Hill-PD-Server-Virus">in the loss of important evidence for eight years</a> . <br><br>  "The official report of the police department said that the malware came from" a cloned address that mimics the address given by the department, "and after a successful infection demanded a ransom in the amount of 4 Bitcoins, which today is about $ 3,600, or the department said, ‚Äúalmost 4,000 US dollars,‚Äù <a href="https://www.theregister.co.uk/2017/01/27/texas_cops_lose_evidence_going_back_eight_years_in_ransomware_attack/">says the Register news site</a> .  Data was lost due to the fact that the department did not use proper backup procedures and active data protection such as Acronis Active Protection. <br><br>  Can you afford to be the next victim of a program of extortionists?  We don‚Äôt think, so we recommend protecting the data on your Windows machines with <a href="http://www.acronis.com/ru-ru/personal/computer-backup/">Acronis True Image 2017 New Generation</a> with the Acronis Active Protection feature. <br><br>  ‚Üí <a href="http://download.acronis.com/pdf/ATI2017NG_whitepaper_active-protection_en-US.pdf">Download White-paper about Acronis Active Protection</a> </div><p>Source: <a href="https://habr.com/ru/post/321112/">https://habr.com/ru/post/321112/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../321102/index.html">"Clock Signal Component Issue" or again a massive marriage in Cisco devices</a></li>
<li><a href="../321104/index.html">Node.js, Express and MongoDB: API in half an hour</a></li>
<li><a href="../321106/index.html">Data Oriented Design in practice</a></li>
<li><a href="../321108/index.html">We start the gas flow rate sensor</a></li>
<li><a href="../321110/index.html">Recursive multiple add IP to lock in the .htaccess file</a></li>
<li><a href="../321114/index.html">The deadline of the Stepik Contest contest is extended until March 31, it's time to create IT tasks</a></li>
<li><a href="../321116/index.html">[Free pizza] Hacking a pizza delivery site, hacking mobidel.ru</a></li>
<li><a href="../321118/index.html">"There is nowhere less": scientists from IBM have stored information in the atom</a></li>
<li><a href="../321120/index.html">"100,000 times faster": ultra-short light pulses in computing</a></li>
<li><a href="../321122/index.html">Digest: DPI technologies and SORM equipment</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>