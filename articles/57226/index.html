<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>InnoDB transactions</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="InnoDB is a transactional, relational engine based on MySQL server. Since 2001, it comes in a standard build, and from version 5.1 it can be installed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>InnoDB transactions</h1><div class="post__text post__text-html js-mediator-article"> InnoDB is a transactional, relational engine based on MySQL server.  Since 2001, it comes in a standard build, and from version 5.1 it can be installed as a plug-in (without the need to recompile the server core).  The syntax is very simple. <br> <code>START TRANSACTION; <br> ... <br> COMMIT; --   ROLLBACK;  -     </code> <br> <h3>  About the definition <br></h3><br>  The definition of transactionality and relationality means, firstly, meaningful coherence of tables through <abbr title="Foreign Key, foreign key table">FK</abbr> and, as a result, data integrity when deleting rows.  With MyIsam, as you know, you had to manually delete the associated data in several tables, in InnoDB - cascading deletion with one query.  Secondly, since for a database parallel versions of data are inconceivable as in SVN and there is no one to combine these versions into one branch, but parallel work of several processes (users) with one data is necessary, then the transaction becomes a solution. <br>  The queue of requests-cars is now replenished with an atomic transaction-bus.  Naturally this is bad, because the longer and longer the transaction is performed, the more parallel processes will wait for it.  To speed up work, stops are created - types and levels of data blocking.  For InnoDB, the default is blocking at the row level (by <abbr title="Primary Key, unique string key">PK</abbr> ), while in MyIsam the atomic operation locks the entire table. <br><br><a name="habracut"></a><br><h3>  Responsiveness = blocking <br></h3><br>  Two engines therefore cannot be compared - InnoDB because of trans activity has to go down to the row level, since the probability of a queue to the same row is lower for two processes, therefore the work will be faster.  But as a result, blocking flags must be made for each line, which means a bit more memory.  Due to the difference in data blocking levels, it is quite difficult to compare InnoDB with MyIsam by performance depending on the number of processes. <br>  There are several types of locks. <br><ul><li>  READ (while I am reading - no one will write) - the default setting is SELECT </li><li>  WRITE (while I am writing - no one will read or write) - the default is UPDATE </li><li>  LOW_PRIORITY WRITE (I will quickly read if someone is waiting) </li></ul><br>  As an educational program, you can manually block the whole table (but not necessary, because for InnoDB this is a slow process that inhibits all processes).  Reblocking removes previous locks.  You can also block virtual tables (view) <br> <code>LOCK TABLES user WRITE, company READ; <br> UNLOCK TABLES;</code> <br> <br><h3>  Isolation levels </h3><br>  In cases where the two processes simultaneously and partially affect the general data, then not all data will be completely blocked.  There are concessions when parallel transactions gain access to incomplete transactions. <br>  The current level can be obtained from the settings, you can <a href="http://dev.mysql.com/doc/refman/5.1/en/set-transaction.html">register in the settings</a> or execute a query - both for the duration of the transaction and for the entire connection. <br> <code>SELECT @@global.tx_isolation; <br> SET TRANSACTION ISOLATION LEVEL READ COMMITED;</code> <br>  According to the degree of accuracy (lock severity) in descending order according to the SQL92 standard, there are: <br><ul><li>  SERIALIZEABLE - complete transaction independence, incl.  your reading </li><li>  REPEATABLE READ (repeated read) is the default value for InnoDB.  Reading shared lines in transactions is allowed, but not changing them. </li><li>  READ COMMITED (fixed reading) - write lock, but general reading.  There is a recurring reading problem, i.e.  in the first transaction, common data is read several times in different ways, because the second transaction changes them. </li><li>  READ UNCOMMITED (‚Äúdirty‚Äù uncommitted reading) - no read / write lock.  With two simultaneous UPDATEs, the field will receive the value of the last change in both transactions.  Many problems are possible, especially if another one reads before the ROLLBACK of one change transaction. </li></ul><br>  In REPEATABLE READ there <a href="http://dev.mysql.com/doc/refman/5.0/en/innodb-next-key-locking.html">is a phantom insert problem</a> .  Since only rows on UPDATE are blocked, but not on INSERT, an insertion can be made in parallel with a repeat-read transaction, which causes a phantom series.  To avoid this, InnoDB uses three locking methods - a string, a range, and the next line in case of insertion (I didn‚Äôt get any deeper) <br>  This whole theory is certainly useful, but in reality they are used by real queries. <br><ol><li>  Read with REPEATABLE READ level (write lock).  Waiting if someone is working on the data. <br> <code>SELECT... LOCK IN SHARE MODE</code> </li> <li>  Read in SERIALIZEABLE mode (read / write lock) <br> <code>SELECT... FOR UPDATE</code> </li> </ol><br>  With these requests for the time of the execution of the transaction, it goes into a new mode. <br><h4>  Deadlock injuries <br></h4><br>  Deadlock and  deadlock of simultaneous processes (threads) that need the same or dependent data often arise in programming.  InnoDB is no exception.  For example, if there are two transactions and each wants to change the resources (lines / range of lines) that are now locked.  It turns out that no transaction can end. <br>  In such situations, InnoDB is forced to roll back one of the transactions and issue an error <br> <code>ERROR 1213 (40001): Deadlock found when trying to get lock; try <br> restarting transaction</code> <br>  Such problems arise when large parallel insertion / modification / deletion of rows by several processes.  MySQL <a href="http://dev.mysql.com/doc/refman/5.0/en/innodb-deadlocks.html">advise</a> all transactions to provide a re-launch of transactions. <br>  On this topic.. <br><ul><li>  <a href="http://www.mysqlperformanceblog.com/2007/01/08/innodb-vs-myisam-vs-falcon-benchmarks-part-1/">Comparison of loads on MyIsam and InnoDB</a> in 2007 </li><li>  <a href="http://ru.wikipedia.org/wiki/%25D0%25A1%25D1%2581%25D1%258B%25D0%25BB%25D0%25BE%25D1%2587%25D0%25BD%25D0%25B0%25D1%258F_%25D1%2586%25D0%25B5%25D0%25BB%25D0%25BE%25D1%2581%25D1%2582%25D0%25BD%25D0%25BE%25D1%2581%25D1%2582%25D1%258C">Referential integrity</a> </li></ul><br><br>  <a href="http://kurapov.name/technology/web/databases/mysql/innodb_transactions">Original article</a> </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/57226/">https://habr.com/ru/post/57226/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../57220/index.html">About the right approach to choosing an engine for an online store</a></li>
<li><a href="../57221/index.html">Takete and Maluma. Practical use of the phenomenon</a></li>
<li><a href="../57222/index.html">Visual Search provider for IE 8 - a task for two tomatoes</a></li>
<li><a href="../57223/index.html">Steve Ballmer</a></li>
<li><a href="../57225/index.html">Dia (in) logs from bloggingheads .tv</a></li>
<li><a href="../57227/index.html">Anticrisis proposal for coworking</a></li>
<li><a href="../57228/index.html">6 must-have Linux distributions</a></li>
<li><a href="../57231/index.html">Another novelty from the Japanese</a></li>
<li><a href="../57233/index.html">Google offers Koreans to change their country of residence</a></li>
<li><a href="../57236/index.html">Use lambdas to animate WPF</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>