<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Flash memory for downloading FreeNAS and other embedded OS</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="annotation 
 Analysis of errors and technical failures is traditionally the least disclosed and the most interesting topic, which just shows how succe...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Flash memory for downloading FreeNAS and other embedded OS</h1><div class="post__text post__text-html js-mediator-article"><h4>  annotation </h4><br>  Analysis of errors and technical failures is traditionally the least disclosed and the most interesting topic, which just shows how successful the engineering idea was.  Having built a <a href="http://habrahabr.ru/post/214707/">NAS server from old hardware</a> some time ago, we begin to analyze the failures that occurred with it.  This article will discuss failures due to a bootable flash drive and their probable causes.  Recommendations on the choice of flash memory.  Partly applicable to other embedded systems, such as home DVRs. <br><br><h4>  Another do-it-yourself NAS, part 2: good memories * </h4><br>  * The advertising slogan of a well-known memory manufacturer sounds ‚ÄúGood memories start here‚Äù. <br><br>  Almost all experts recommend choosing a bootable flash drive not to save or use the popular <i>noname</i> brand.  Despite the Free-nas root file system version 9 in read-only mode, consumer USB flash drives of compact design failed twice in half a year, in both cases approximately after a couple of months of operation.  Moreover, both used brands, in the opinion of some of the industry representatives surveyed, are quite adequate and respected, in the delivery of a frank marriage unnoticed. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/bfb/993/09c/bfb99309c5e857cfcae2b8f2751fc02f.jpg"><br>  In the photo: two quite adequate representatives of tiny flash drives for 8GB and 16GB <br><br>  What is the matter?  Is the flash memory resource endless?  Let's try to figure it out. <br><a name="habracut"></a><br><br><h4>  How it was </h4><br>  The FreeNAS-based system worked well for an average of two months.  Then they stopped receiving daily reports via email, the web-based administrator interface fell behind them.  But the server did not give up so easily: SSH worked, and the network folder services for users bravely kept to the last, continuing to serve Business.  Commendable resilience. <br>  Until the access via SSH fell off, I found a problem page (python script), where I saw quite clearly the <i>replacement of individual letters in the text</i> , in search of the reasons for the failure of the web interface.  It is difficult to describe in words, but as if at strictly equal intervals of characters the programmer's finger fell between the keys.  Then the programmer seemed to move out of the coils completely, or in a panic he pulled out his own stuck finger from the keyboard, but the meaningful script broke off and turned into a random set of bytes.  Is bit flip?  It turned out that other users had a <a href="http://forums.freenas.org/threads/data-corruption-on-usb-flash-drive.15505/">very similar picture</a> .  The flash drive refilling took place without a single error, hid the defect, and many hours of testing with the <a href="http://mikelab.kiev.ua/index_en.php%3Fpage%3DPROGRAMS/chkflsh_en">utility.</a>  <a href="http://mikelab.kiev.ua/index_en.php%3Fpage%3DPROGRAMS/chkflsh_en">Michael</a> did not reveal any errors.  Well, just the perfect flash drive.  The most annoying thing is that I wiped out a sample of corrupted data, which I regret very much.  Devilry some. <br><br><h4>  Who is guilty? </h4><br>  Immediately, I‚Äôll make a reservation that I haven‚Äôt yet managed to find an engineering confirmed answer to <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D1%2582%25D0%25BE_%25D0%25B2%25D0%25B8%25D0%25BD%25D0%25BE%25D0%25B2%25D0%25B0%25D1%2582%253F">question No. 1 of the Russian intelligentsia</a> .  But I want to dispel some myths and explain the role of the notorious human factor.  At least, my problem has a solution, and I give it further. <br><div class="spoiler">  <b class="spoiler_title">offtopic to question number 1</b> <div class="spoiler_text">  ‚ÄúWho is to blame?‚Äù - a novel in two parts of Alexander Ivanovich Herzen. </div></div><br><br><h5>  What is a flash drive </h5><br>  This topic was well developed by the popularizer and author Habr <a href="https://habrahabr.ru/users/tiberius/" class="user_link">Tiberius</a> in the article <a href="http://habrahabr.ru/post/135515/">Inside Look: Flash Memory and RAM</a> .  Who has not read - this is really a look from the inside, bravo!  I will try to set out in a compact way from a different angle.  There are less invasive ways to get inside the flash drive, see, for example, the resource <a href="http://flashboot.ru/iflash/">http://flashboot.ru/iflash/</a> . <br>  So, a modern household flash drive is a tiny computer, with its own processor (microcontroller), a small amount of RAM and ROM, data buses, I / O interface and, in fact, NAND flash memory, usually on separate chips. <br>  The microcontroller communicates with the host via the USB bus, reads, erases, writes blocks (‚Äúsectors‚Äù), can calculate checksums of the blocks, controls the wear of <s>its</s> NAND chip <s>economy</s> (see <a href="http://www.wikipedia.org/wiki/Wear_leveling">wear leveling</a> ) and do a lot of other things that we are mortals, and close have no idea. <br><div class="spoiler">  <b class="spoiler_title">offtopic microcontrollers</b> <div class="spoiler_text">  <s>The magic world of microelectronics,</s> the microcontroller market, by the way, has made a big step in recent years towards amateurs and enthusiasts, which is only the <a href="http://www.wikipedia.org/wiki/Arduino">Arduino</a> platform or the Chelyabinsk project to them.  <a href="http://easyelectronics.ru/">DI HALT</a> , God bless them.  So those who are tired of cars, boats, can try new toys, with such a smell of industrial brutality ;-) </div></div><br><br><h5>  What makes the manufacturer of flash drives </h5><br>  In my opinion, this is a very simple question: the manufacturer assembles the ‚Äúcomputer‚Äù described above from the components, prepares software (microcontroller firmware), puts its brand (brand) on the finished product and sells it on the market.  The reliability of the flash drive depends on the quality of the components and on the firmware.  Sometimes used components of its own production, sometimes - third-party (there are very large plants).  Firm brooms do not knit, as they said once.  But the company values ‚Äã‚Äãits reputation very much, and therefore it checks the <s>brooms of the</s> microcircuit. <br>  There is a widespread version that manufacturers of microcircuits (components) divide manufactured products of the same type into different quality classes, called ‚Äúbaskets‚Äù in the jargon.  Conditionally for developed markets and conditional for all others.  Or for business and consumer use.  Or somehow, but it is very important for the consumer (both at home and business) that the product of the same vendor with the same code <i>does not necessarily</i> mean the same "insides".  Therefore, buying e-bikes <i>on eBay</i> (listen carefully) at half price is the risk of getting goods with chips for Third World markets, despite the complete coincidence of all outdoor codes.  At least, this opinion is shared by local electric power vendors who have to compete with global online commerce. <br><br><h5>  What happens to flash memory </h5><br>  This topic was opened by user <a href="https://habrahabr.ru/users/alexzeynikov/" class="user_link">alexzeynikov</a> in his article <a href="http://habrahabr.ru/post/189294/">A brief excursion into the history of flash memory</a> , you can also see the translated post 2007.  <a href="http://habrahabr.ru/post/30945/">RAM, ROM, NAND, NOR - what do these capital letters mean</a> ? <br>  Household flash drives use NAND memory.  If you take a very quick look at the NAND flash memory market, you can identify the following main types of chip manufacturing (in chronological order of entry to the market): <a href="http://www.wikipedia.org/wiki/Single-level_cell">SLC</a> single-level cells (store 1 bits in each cell), multi-level <a href="http://www.wikipedia.org/wiki/Multi-level_cell">MLCs</a> (most popular, store 2 bits, using 4 levels) and <a href="http://www.wikipedia.org/wiki/Triple-level_cell">TLC</a> gaining popularity (3 bits, 8 charge levels).  This information is compacted by using <i>several</i> conditional charge levels in one microelectronic element (cell) to squeeze in more stored bits into the same physical volume and, most importantly, with approximately the same cost of production.  In order not to break spears on the decoding of MLC and TLC, I recommend the Russian-language Wikipedia article: <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BB%25D0%25B5%25D1%2588-%25D0%25BF%25D0%25B0%25D0%25BC%25D1%258F%25D1%2582%25D1%258C">Flash memory, SLC and MLC devices</a> (thanks to <a href="https://habrahabr.ru/users/a5b/" class="user_link">a5b</a> ).  A 16-tier technology is on the way, so you can still knead the interfaces and cables. <br>  Understandably, density has to be paid for by reliable storage and, therefore, by more sophisticated methods of handling errors.  Well, in <a href="http://www.wikipedia.org/wiki/Claude_Shannon">theory</a> it is sometimes easier to push errors with a powerful ‚Äúmathematics‚Äù, it all depends on the parameters of the system. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/12f/d5c/fa9/12fd5cfa9c1d57ca085adb9db4d6c3b4.jpg"><br>  A piece of the evolution of household flash memory.  From left to right: 2GB, 8GB, 16GB, 32GB <br><br>  In terms of use, you can distinguish between memory for industrial systems (space, energy, high-tech weapons, etc.), for business (servers, professional equipment) and consumer (games, music, and other pictures on a smartphone).  By the way, car DVRs and professional photo and video cameras are almost industrial uses due to the almost continuous recording in fairly wide temperature ranges (but, fortunately, mostly without radiation).  So do not blindly pursue only the volume of the flash drive for your DVR, this is not a radio tape recorder, but potentially an argument in court, with all the consequences.  Take a professional or industrial product. <br><br><h5>  What is the rewriting resource for flash memory </h5><br>  NAND flash memory is well known that it is subject to electrical wear and has a finite resource for write cycles.  For high-quality SLC memory, a resource of 100 thousand write cycles is considered adequate, which is what we see in industrial products.  However, you have to pay for everything, and the amount of data stored in SLC is small compared to MLC and TLC with the same dimensions and cost.  This is where the most interesting begins: manufacturers are actively introducing increasingly capacious products to the market, but they somehow darken about their actual electrical durability, because it harms sales.  At the same time, no one denies that the resource of the MLC is less than that of SLC, but more than that of TLC. <br>  So how much?  Someone <a href="http://www.pcper.com/reviews/Editorial/Taking-Accurate-Look-SSD-Write-Endurance">calls the</a> following numbers. <br><br>  Evaluation of rewriting resource for different types of NAND-memory <table><tbody><tr><th>  Technology </th><th>  Rewrite Resource, cycles </th></tr><tr><td>  SLC 34nm </td><td>  100,000 </td></tr><tr><td>  MLC 34nm </td><td>  10,000 </td></tr><tr><td>  MLC 24nm IMFT </td><td>  5,000 </td></tr><tr><td>  MLC 20nm </td><td>  3,000 </td></tr><tr><td>  TLC 20nm </td><td>  1,000 </td></tr></tbody></table>  Those.  in supercompact TLC (I expect it in a 32GB microSD, but it is better to check with <a href="http://habrahabr.ru/users/tiberius/">Dr. X-Ray</a> ) we can expect ‚Äúonly‚Äù about 1000 rewriting cycles.  However, the reader should not panic right away, and this is usually enough for storing music and photos on a smartphone.  The microcontroller of any modern flash drive should distribute the wear evenly, so there should <s>not be</s> any ‚Äúwashed-up‚Äù and ‚Äústubborn‚Äù blocks, regardless of the file system type.  In theory, in order to ‚Äúwhittle away‚Äù a 8GB flash drive with a 1000 cycle resource, you need to write on it a total of about 8TB of information.  In practice, of course, it will die earlier, but if you use good brands with high-quality chips and do not infect a smartphone with an evil virus-killer of flash drives, everything will be fine and long. <br>  Here you have the engineering paradox: in theory, an old, large-sized 2GB flash drive (probably SLC) even with the rest (!) Of its resource in reliability can plug a completely new supercompact ‚Äú16GB‚Äù crumb (probably made using MLC or TLC technology).  Although I would not check this argument on the "combat" server. <br><br><h5>  (FreeNAS || NAS4free) &amp;&amp; NAND </h5><br>  An attentive reader will, of course, ask: what does it all mean for FreeNAS if its root file system is mounted read-only?  Not in the eyebrow, but in the eye. <br>  The FreeNAS loader requires 2GB, of which approximately 1GB is occupied by the root system, which is actually read-only mounted.  In addition to it, a small / order (read-write) section is created on the same flash drive for storing settings and useful system statistics collected by the <a href="http://collectd.org/">collectd</a> (so as not to ‚Äúforget‚Äù, say, the RAM consumption history for a month when rebooting).  Another 1GB is not used. <br>  By the way, a relative of FreeNAS <a href="http://www.nas4free.org/">NAS4free</a> works a little differently.  It creates a single root partition, where it keeps both the system and the settings (while offering to create a swap on the flash drive, but unobtrusively).  NAS4free's system statistics are rather rudimentary and do not survive when reboots (and there is nothing much to survive there, but for many it is not a critical condition).  More importantly, the NAS4free settings (in the form of XML) are stored in the read-only section, and when they are saved, the entire root file system must be <i>re</i> -installed from read-only to read-write and then back to read-only.  Quite awkward, but it works. <br><br><h5>  Subtotal </h5><br><ul><li>  Given the final flash memory resource, both the FreeNAS and NAS4free projects are a good choice, due to the read-only file system. </li><li>  2GB flash drives for FreeNAS will definitely suffice with a margin, and no other sections on the flash drive can be created by design (you can at NAS4free). </li><li>  Due to the preservation of statistics, FreeNAS regularly writes to the flash drive, although in small portions (about 1 MB <b>once</b> every hour, or about 8 GB per year, but this is a very approximate estimate). </li><li>  NAS4free does not keep any regular writing to the flash drive, but due to the castrated system statistics and the combination of the OS with the settings on the same root partition (with all the consequences: starting in read-only - in read-write - saving settings - and again in read-only , up to the need to reboot). </li><li>  According to external signs, it is unlikely that our refusals occurred due to the wear of the flash drive recording, although this is the first thing that usually comes to mind.  <s>A programmer‚Äôs stuck fingers: a</s> broken web script located on the read-only section is somehow not very well linked to the result of writing. </li><li>  One thing can be said quite definitely: all other things being equal, the smaller the size of a flash drive, the less its resource and reliability. </li></ul><br><br><h5>  Infinite Flash Reader Myth </h5><br>  It is considered that the number of read cycles for flash drives is infinite, however, in the case of NAND memory, this is not quite true, if only because of the <i>read disturb</i> effect described by <i>Jim Cooke</i> in the report <i>The Inconvenient Truths of NAND Flash Memory</i> ( <a href="http://www.micron.com/-/media/Documents/Products/Presentation/flash_mem_summit_jcooke_inconvenient_truths_nand.pdf">direct link</a> ; shift, but the search engine should give the title of the report; see slides 19-20).  However, this effect is electrically reversible and should be removed completely transparently by the built-in microcontroller, using error correction (see below) and block transfer.  I was alerted by the phrase: <br><blockquote>  Disturbed bits are effectively managed with ECC </blockquote><br>  This means that bit flip in NAND is expected and can be corrected "on the fly" with correction codes, but it is too early to panic, because the same thing has been happening for a long time in spindle disks, communication devices and more. <br>  Interestingly, in accordance with the same report, the NAND SLC memory has about 1 million read cycles, and the MLC has 100 thousand cycles.  The microcontroller must take this into account and copy the risk block to the new location in <i>advance</i> , removing the disturbance effect and freeing the old block.  In this case, error control should monitor the integrity of information, and if the block is damaged beyond the capabilities of the correction scheme used, the flash drive <i>should produce a</i> read error. <br>  For a number of reasons in this article, I deliberately avoid explicitly describing ‚Äúfull-fledged‚Äù SSDs, but I assume that something similar happens in them, at different speeds, with coiled logic and stuffed peripherals.  And, since we have touched upon SSD, let me remind you about the notorious 25% of free space ( <a href="http://lifehacker.ru/2013/06/26/veshhi-kotorye-ne-nuzhno-delat-s-ssd/">Things you don‚Äôt need to do with a solid-state drive (SSD)</a> , or <a href="http://www.anandtech.com/show/6489/playing-with-op">Exploring the Relationship in Modern SSDs</a> ). <br>  However, personally, I can only suggest one explanation <s>of the</s> bit flip <s>programmer‚Äôs stuck fingers syndrome</s> described above: could it be the read disturb effect that broke through the parity check due to a bug in the microcontroller firmware or excessive simplification of logic?  This is the most provocative question of this article. <br><br>  By the way: <div class="spoiler">  <b class="spoiler_title">Who cares to know the SSD device</b> <div class="spoiler_text">  Colleagues, go on the subject of research and give it to <a href="https://habrahabr.ru/users/tiberius/" class="user_link">Tiberius</a> ';  perhaps he will postpone his case, split the subject into atoms and write another awesome article.  Only for the disc it will be exactly a one way ticket :) </div></div><br><br><h5>  Who controls errors and how </h5><br>  Warning: <b>ECC is</b> sometimes referred to as <i>Elliptic Curve Cryptography</i> , but in this article it is the <b><a href="http://www.wikipedia.org/wiki/Error_detection_and_correction">Error Correction Code</a></b> . <br>  Data integrity is the concern of the microcontroller, it uses special encoding algorithms for this.  As is known, the bit depth (length) of the checksum affects the maximum number of detected (and sometimes corrected) erroneous bits.  Recall RS232: one extra parity bit can detect if there was one error bit in the block.  But two erroneous bits will go unnoticed, they need more control bits and a smarter algorithm.  And so on: the smarter the algorithm and the more ‚Äúspare‚Äù bits are put into the message, the better the system's ability to eliminate errors without sending (copying) the entire message.  The noise-protected coding is, as they say, our entire information world. <br>  Refer to the document <i>TN-29-17: NAND Flash Design and Use Considerations</i> ( <a href="http://pt.slideshare.net/Flashdomain/tn2917-nand-flash-design-and-use-considerations">link</a> ) of one of the manufacturers of NAND chips, we find a recommendation to the developers of flash drives (ie, "assemblers", which these chips then use as components): <br><blockquote>  <b>Use More Powerful ECC</b> : <br>  It is correct that the correctable limit is true.  The device will begin reading from the new location. </blockquote><br>  Those.  As usual, there are <i>minimum</i> and <i>recommended</i> requirements of the chip manufacturer for the complexity (high cost) of the microcontroller, the choice between which is made by the developer based on, of course, the mode of using the memory.  For example, for industrial tasks, you need to do expensive logic with a long ECC code, and for everyday tasks you can get by with simpler code and cheaper chips. <br>  Finding another document at random, this is the Texas Instruments <a href="http://processors.wiki.ti.com/index.php/Raw_NAND_ECC">Raw NAND ECC</a> wiki page, in which for the MLC it is recommended to use 4, 8 or 16-bit checksums for each 512-byte block: <br><blockquote>  <b>Why is ECC required for NANDs?</b> <br>  Data stored in NANDs can get corrupted (randomly).  The process of the process is subject to an error.  SLC NANDs have less ECC requirements than MLC NANDs.  The NAND datasheet gives the ECC requirement for the NAND device.  For SLC NANDs, 1 / 4bits per 512 bytes are common currently.  <b>For MLC, devices with 4/8/16 bits per 512 bytes ECC requirements are in the market.</b> </blockquote><br>  There are also links to popular algorithms: single-bit errors are ‚Äútreated‚Äù by Hamming codes, it is common to deal with multibit errors using <a href="http://www.wikipedia.org/wiki/BCH_code">Bose-Choudhuri-Okengem</a> codes (BCH), and somewhere in the middle are the Reed-Solomon codes that are popular in the data storage industry special case BCH).  Here is another randomly found document on this topic: <i>What should be used for flash memory?</i>  ( <a href="http://www.spansion.com/Support/Application%2520Notes/Types_of_ECC_Used_on_Flash_AN.pdf">link</a> ). <br>  But let's not soar for too long in the clouds of abstract algebra, it‚Äôs time for us on the solid land of engineering.  If the block had too many hard-wired bits, if the memory manufacturer saved and used a cheaper microcontroller, a simpler error correction algorithm or less skilled developers, then the chances of silent data corruption (that is, without obvious reading failures) in theory are increasing.  Do not forget that it is not the gods who <s>burn pots and</s> write the firmware code. <br>  I used a household flash drive to place an embedded type system that can <i>read</i> certain blocks very intensively (especially when there is a shortage of RAM, like mine).  However, data loss due to the <i>read disturb</i> effect is too serious a charge that requires more careful investigation.  In the meantime, I can derive another criterion for evaluating the reliability of a flash drive: other things being equal, the longer the ECC, the better. <br><br><h4>  What to do? </h4><br>  The answer to <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D1%2582%25D0%25BE_%25D0%25B4%25D0%25B5%25D0%25BB%25D0%25B0%25D1%2582%25D1%258C%253F_(%25D1%2580%25D0%25BE%25D0%25BC%25D0%25B0%25D0%25BD)">question number 2 of the Russian intelligentsia</a> , oddly enough, it turned out to be easier to find. <br><div class="spoiler">  <b class="spoiler_title">offtopic to question number 2</b> <div class="spoiler_text">  ‚ÄúWhat to do?‚Äù Is a novel by a Russian philosopher, journalist and literary critic Nikolai Chernyshevsky, written in solitary confinement at the Peter and Paul Fortress and subsequently prohibited by censorship. </div></div><br>  The question is, why did two identical failures occur?  After the first failure, there was a strong desire to immediately switch to industrial flash memory (you need only 2GB, half of which is used), but finding it with the usual USB connector turned out to be difficult: either the pin ones were on sale (for example, Transcend <a href="http://www.transcendusa.com/support/dlcenter/EDM/UFM-EDM.pdf">TS2GUFM-V</a> ), either Compact Flash or Disk-on-Module with IDE interface in general.  And since my quest for industrial flash memory went in the wrong direction, I bought a consumer USB flash drive for the third time, but no longer a ‚Äúcrumb‚Äù, but a ‚Äústandard‚Äù size with the Kingston brand. <br>  Pondering other options, just in case, I even decided to prepare for the transition to an industrial Compact Flash, according to the canons of the Crepsoondo practice, having loaded the system in a test mode from a card reader (reader, be careful, it can fail on its own).  And, by the way, speaking of SSDs, for a simple bootloader it is <i>relatively</i> expensive and also, oddly enough, <a href="http://forums.freenas.org/threads/intel-passed-power-loss-protected-ssd-tests.17168/">not a panacea</a> . <br><br><img width="200" height="165" src="https://habrastorage.org/getpro/habr/post_images/d9f/e7f/25d/d9fe7f25de70088b3ff0bd492c921ac0.jpg"><br>  Above: crumb on 8GB;  below: Kingston at 8GB <br><br>  The full-size Kingston flash drive on 8GB as a result worked for three months without complaints, and one seller in the store said that already, they say, the year of the bottle opens the same, and nothing.  But for a more sound sleep, I still chose another option, which I will tell you about right now. <br><br><h5>  Meet: industrial memory </h5><br><img src="https://habrastorage.org/getpro/habr/post_images/76d/217/72a/76d21772a707d5124d7db5876cacfc51.jpg"><br>  The representative of industrial memory TS2GUFM-V <br><br>  As a result, it turned out ( <a href="http://www.alldatasheet.com/datasheet-pdf/pdf/330154/TRANSCEND/TS2GUFM-V.html">reference</a> ) that the pin interface "mother" of the very industrial product <a href="http://www.transcendusa.com/support/dlcenter/EDM/UFM-EDM.pdf">TS2GUFM-V</a> is a two-row 10-pin connector with a 2.54mm (1/10 ") pitch, including for fitting into the front "USB ports on a completely domestic motherboard (4 out of 10 contacts are used). Hooray, my quest is over. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/24e/a82/7b0/24ea827b044864ea5b6329db4610a977.jpg"><br>  Connectors "front" USB-cable and flash drives are depicted with positional matching <br><br>  So, the TS2GUFM-V is a 2GB industrial flash memory module with a vertical case (letter V), even equipped with snaps from falling out of the connector during shocks and vibrations.  So if the reader suddenly needs to build the OS into a homing hammer with <a href="http://ru.wikipedia.org/wiki/%25D0%25A7%25D0%259F%25D0%25A3%25E2%2580%258E">CNC</a> , then this is a good option.  There is, however, a horizontal version of the TS2GUFM-H, but it is even more brutal (unpackaged and fixed with three bolts), it is less common for sale, and it is even more difficult to put it on a regular motherboard.  Of course, nothing is impossible, it all depends on the desire, ingenuity and hull design. <br><br>  Product Specifications TS512M ~ 4GUFM-V <table><tbody><tr><th>  Parameter </th><th>  Value </th></tr><tr><td>  Technology </td><td>  SLC </td></tr><tr><td>  Volume </td><td>  from 512MB to 4GB </td></tr><tr><td>  Record resource </td><td>  100,000 cycles </td></tr><tr><td>  Read speed </td><td>  up to 33 MB / s </td></tr><tr><td>  Write speed </td><td>  up to 20Mb / s </td></tr><tr><td>  ECC digits </td><td>  eight </td></tr><tr><td>  Year of launch </td><td>  2006 </td></tr><tr><td>  Price </td><td>  about ‚Ç¨ 25 </td></tr></tbody></table><br>  The product, as you can see, is not new at all, but for industrial options and 10 years is sometimes not age, and the price can fall from military to almost everyday values ‚Äã‚Äãover time (let me remind you that I spent two <i>ordinary</i> flash drives for the same money as in famous proverb).  For comparison: the <i>budget</i> household flash drives have a write speed of only about 5 Mb / s, and TS2GUFM with its 20 Mb / s is an excellent solution according to the canons of Crepsondo philosophy.  Only Compact Flash for professional cameras is cooler: when they ‚Äúshoot‚Äù with <a href="http://www.wikipedia.org/wiki/Raw_image_format">RAW-format</a> bursts, it will not seem like a little.  TS2GUFM-V, however, closes two USB connectors at once, using one, but this can be fixed with adapters if desired. <br>  To <s>get the flight task of the</s> fill in the image of the loader, you need to connect this hard warrior to a sysadmin laptop, the USB connectors of which do not differ in industrial severity.  The reader can use any convenient option (try searching for pictures on the line ‚ÄúUSB 10pin adapter‚Äù, learn a lot of new things).<font style="vertical-align: inherit;"><font style="vertical-align: inherit;">But, by a strange coincidence, in my old Sisadminian trunk there was a crimper pincer (apparently, I had done something like this before, I just don‚Äôt remember what). </font><font style="vertical-align: inherit;">With a crimper, I compressed a pin low-voltage adapter from a disabled cable that was damaged by an office wheel hitch.</font></font><div class="spoiler">  <b class="spoiler_title">By the way</b> <div class="spoiler_text">        -  ,  ,   -     :) </div></div><br><br><img src="https://habrastorage.org/getpro/habr/post_images/d78/644/0ae/d786440aedb09cc3e294d15cdc2b3be7.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Clearing and crimping the crimping device </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/67f/913/f26/67f913f262ddac308750bc95caf6a5c3.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protecting with heat shrinking </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/7d8/1b2/5fd/7d81b25fd86e4cd049559c1d93c4a263.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Take the 2.54mm </font><font style="vertical-align: inherit;">male </font><font style="vertical-align: inherit;">connector (although you can also with a paper clip) </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4d4/e16/bdb/4d4e16bdb143f8f7e2cd5e2e8ef7c867.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Let's </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/2ab/937/851/2ab937851d46cc157e248d59ac6f229d.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">check </font><font style="vertical-align: inherit;">how the </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB flash drive </font><font style="vertical-align: inherit;">sits </font><font style="vertical-align: inherit;">on the cable ready for casting </font><font style="vertical-align: inherit;">The image of FreeNAS is installed in the usual way, install our industrial flash drive into the slot for the front USB ports on the motherboard. </font><font style="vertical-align: inherit;">Do not confuse the pins, there is no ‚Äúanti-fool‚Äù on the product. </font><font style="vertical-align: inherit;">Contact number 9 should get to the place of the "sawed" pin. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f02/26d/893/f0226d893ff39c1690b5c069a159e9b6.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">"Pinout" connector </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ATTENTION:</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">the dimensions of our harsh TS2GUFM-V product can make it difficult to fit into the connector due to electronic components, wires and other connectors sticking out here and there even in very spacious ‚Äútower‚Äù type buildings. For example, squeezing the TS2GUFM-V into the USB4_5 connector on the ASRock P4i65G motherboard between the onboard audio and the LAN without destroying it turned out to be impossible, so send it to the spare USB67 connector. But even there they had to dodge the capacitor banks and the plug of the case tweeters, sticking close to the cherished pins.</font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Therefore, the reader, especially when using compact cases (for example, the well-known Harlampy-Pankrat MicroServer brand), should carefully study the fact of the presence of 10-pin ‚Äúfit‚Äù connectors, as well as the surrounding environment. </font><font style="vertical-align: inherit;">In which case, take action in the form of adapters (google to pictures "USB adapter 10pin"). </font><font style="vertical-align: inherit;">Or choose another flash drive. </font></font><br><br><img src="https://habrastorage.org/getpro/habr/post_images/4dc/71e/a50/4dc71ea50196ea3434b2a8312307ea6a.jpg"><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">USB flash drive sat in the slot and earned</font></font><br><br><h4>  findings </h4><br><br><ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The electrophysical processes occurring inside solid-state drives are far from being as unambiguous and simple as it seems from the outside (thanks, Captain Obvious). </font></font></li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The reliability of flash memory depends both on the NAND memory technology (SLC, MLC, TLC, etc.) and on the complexity of the microcontroller, and during production it can be saved both on the first and on the second. </font></font></li><li>           (ECC,    ):      ,  . </li><li>  ,    ,  -  . </li><li>        -,    MLC (TLC)   . </li><li>           . </li><li>  FreeNAS  ¬´¬ª   ,    ‚Äî     SLC   2. </li></ol><br><br><h4>   </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In the following parts, we will further expand the topic of failures, touch upon corporeal engineering, system tuning, and also show some of the tricks of Unix Kung Fu for beginners. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Other parts of the story about </font></font><i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">another do-it-yourself NAS</font></font></i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> : </font></font><br> <a href="http://habrahabr.ru/post/214707/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part 1: from what was</font></font></a> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> part 2: good memories (Flash memory for downloading FreeNAS and other embedded OS) </font></font><br> <a href="http://habrahabr.ru/post/218387/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part 3: adventures in the old tower </font></font></a> <br> <a href="http://habrahabr.ru/post/217299/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">part 4: the ghost of Chernobyl</font></font></a> <br><br><h4>  Links </h4><br> <a href="http://www.wikipedia.org/wiki/Flash_memory">www.wikipedia.org/wiki/Flash_memory#NAND_flash</a> <br> <a href="http://www.wikipedia.org/wiki/Wear_leveling">www.wikipedia.org/wiki/Wear_leveling</a> <br> <a href="http://www.wikipedia.org/wiki/Single-level_cell">www.wikipedia.org/wiki/Single-level_cell</a> <br> <a href="http://www.wikipedia.org/wiki/Multi-level_cell">www.wikipedia.org/wiki/Multi-level_cell</a> <br> <a href="http://www.wikipedia.org/wiki/Triple-level_cell">www.wikipedia.org/wiki/Triple-level_cell</a> <br> <a href="http://ru.wikipedia.org/wiki/%25D0%25A4%25D0%25BB%25D0%25B5%25D1%2588-%25D0%25BF%25D0%25B0%25D0%25BC%25D1%258F%25D1%2582%25D1%258C">ru.wikipedia.org/wiki/%D0%A4%D0%BB%D0%B5%D1%88-%D0%BF%D0%B0%D0%BC%D1%8F%D1%82%D1%8C#SLC-_.D0.B8_MLC-.D0.BF.D1.80.D0.B8.D0.B1.D0.BE.D1.80.D1.8B</a> <br> <a href="http://www.wikipedia.org/wiki/Error_detection_and_correction">www.wikipedia.org/wiki/Error_detection_and_correction</a> <br> <a href="http://www.wikipedia.org/wiki/BCH_code">www.wikipedia.org/wiki/BCH_code</a> <br> <a href="http://www.pcper.com/reviews/Editorial/Taking-Accurate-Look-SSD-Write-Endurance">www.pcper.com/reviews/Editorial/Taking-Accurate-Look-SSD-Write-Endurance</a> <br> <a href="http://collectd.org/">collectd.org</a> <br> <a href="http://www.transcendusa.com/support/dlcenter/EDM/UFM-EDM.pdf">www.transcendusa.com/support/dlcenter/EDM/UFM-EDM.pdf</a> <br> <a href="http://www.micron.com/-/media/Documents/Products/Presentation/flash_mem_summit_jcooke_inconvenient_truths_nand.pdf">www.micron.com/-/media/Documents/Products/Presentation/flash_mem_summit_jcooke_inconvenient_truths_nand.pdf</a> <br> <a href="http://pt.slideshare.net/Flashdomain/tn2917-nand-flash-design-and-use-considerations">pt.slideshare.net/Flashdomain/tn2917-nand-flash-design-and-use-considerations</a> <br> <a href="http://processors.wiki.ti.com/index.php/Raw_NAND_ECC">processors.wiki.ti.com/index.php/Raw_NAND_ECC</a> <br> <a href="http://www.spansion.com/Support/Application%2520Notes/Types_of_ECC_Used_on_Flash_AN.pdf">www.spansion.com/Support/Application%20Notes/Types_of_ECC_Used_on_Flash_AN.pdf</a> <br> <a href="http://forums.freenas.org/threads/data-corruption-on-usb-flash-drive.15505/">forums.freenas.org/threads/data-corruption-on-usb-flash-drive.15505/#post-80954</a> <br> <a href="http://forums.freenas.org/threads/intel-passed-power-loss-protected-ssd-tests.17168/">forums.freenas.org/threads/intel-passed-power-loss-protected-ssd-tests.17168</a> <br> <a href="http://mikelab.kiev.ua/index_en.php%3Fpage%3DPROGRAMS/chkflsh_en">mikelab.kiev.ua/index_en.php?page=PROGRAMS/chkflsh_en</a> <br> <a href="http://lifehacker.ru/2013/06/26/veshhi-kotorye-ne-nuzhno-delat-s-ssd/">lifehacker.ru/2013/06/26/veshhi-kotorye-ne-nuzhno-delat-s-ssd</a> <br> <a href="http://www.anandtech.com/show/6489/playing-with-op">www.anandtech.com/show/6489/playing-with-op</a> <br> <a href="http://flashboot.ru/iflash/">flashboot.ru/iflash</a> </div><p>Source: <a href="https://habr.com/ru/post/214803/">https://habr.com/ru/post/214803/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../214793/index.html">This post is written by the author who does not read the comments, please do not write them.</a></li>
<li><a href="../214795/index.html">Inside stories Mt. Gox</a></li>
<li><a href="../214797/index.html">The logic of thinking. Part 6. The system of projections</a></li>
<li><a href="../214799/index.html">Creating a game on your eyes - part 5: Subtotal (prototype)</a></li>
<li><a href="../214801/index.html">Mobius Conference: Final Schedule</a></li>
<li><a href="../214807/index.html">Wikipedia will mark writers by request</a></li>
<li><a href="../214811/index.html">SurroundWeb - Microsoft 3D Browser</a></li>
<li><a href="../214813/index.html">Mozilla optimizes jpeg format</a></li>
<li><a href="../214817/index.html">Evernote for Android now supports handwriting.</a></li>
<li><a href="../214819/index.html">EasyEclipse: Eclipse with a Kickstarter human face</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>