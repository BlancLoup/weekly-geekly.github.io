<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Bash scripts, part 10: practical examples</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Bash scripts: start 
 Bash scripts, part 2: loops 
 Bash scripts, part 3: command line options and keys 
 Bash scripts, part 4: input and output 
 Bas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Bash scripts, part 10: practical examples</h1><div class="post__text post__text-html js-mediator-article"><blockquote>  <a href="https://habrahabr.ru/company/ruvds/blog/325522/">Bash scripts: start</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/325928/">Bash scripts, part 2: loops</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326328/">Bash scripts, part 3: command line options and keys</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326594/">Bash scripts, part 4: input and output</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/326826/">Bash Scripts, Part 5: Signals, Background Tasks, Script Management</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327248/">Bash scripts, part 6: functions and library development</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327530/">Bash scripts, part 7: sed and word processing</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327754/">Bash scripts, part 8: awk data processing language</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/327896/">Bash scripts, part 9: regular expressions</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328346/">Bash scripts, part 10: practical examples</a> <br>  <a href="https://habrahabr.ru/company/ruvds/blog/328436/">Bash scripts, part 11: expect and automate interactive utilities</a> </blockquote><br>  In previous articles, we discussed various aspects of the development of bash scripts, talked about useful tools, but so far we have considered only small fragments of code.  The time has come for larger projects.  Namely, here you will find two examples.  The first is a script for sending messages, the second example is a script that displays information about the use of disk space. <br><br> <a href="https://habrahabr.ru/company/ruvds/blog/328346/"><img src="https://habrastorage.org/files/803/892/bfe/803892bfe548499aa763df324d40fd01.png"></a> <br><br>  The main value of these examples for those who study bash is in the development methodology.  When a programmer gets the task of automating anything, his path is rarely direct and fast.  The task should be divided into parts, find the means of solving each of the subtasks, and then assemble a ready-made solution from the parts. <br><a name="habracut"></a><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h2>  <font color="#3AC1EF">Sending messages to the user terminal</font> </h2><br>  Nowadays, rarely one resorts to one of the possibilities of Linux, which allows you to communicate by sending messages to the terminals of logged-in users.  The <code>write</code> command itself, <code>write</code> , is pretty simple.  In order to use it, it is enough to know the username and the name of his terminal.  However, in order to successfully send a message, in addition to the actual data about the user and the terminal, you need to know whether the user has logged in and if he has not prohibited entry to his terminal.  As a result, several checks need to be performed before sending a message. <br><br>  As you can see, the task: ‚Äúsend a message‚Äù, upon closer inspection, turned out to be a task: ‚Äúcheck the possibility of sending a message, and, if there are no obstacles, send it‚Äù.  Let us deal with the solution of the problem, that is, the development of a bash script. <br><br><h3>  <font color="#3AC1EF">WhoWho and mesg commands</font> </h3><br>  The core of the script are several commands that we have not yet discussed.  Everything else should be familiar to you from previous materials. <br><br>  The first thing we need here is the <code>who</code> command.  It allows you to find out information about users working in the system.  In its simplest form, its call looks like this: <br><br><pre> <code class="hljs ruby">$ who</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/5d0/471/094/5d04710940fc2750d0f14b5b14d197d1.png"></div><br>  <i><font color="#999999">The results of the who command</font></i> <br><br>  In each line that the who command displays, we are interested in the first two indicators - the name of the user and information about his terminal. <br><br>  By default, writing to the terminal is allowed, but the user can, with the help of the <code>mesg</code> , prohibit sending messages to him.  Thus, before trying to send something to someone, it would be nice to check whether sending messages is allowed.  If you need to know your own status, just enter the <code>mesg</code> without parameters: <br><br><pre> <code class="hljs ruby">$ mesg</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/675/339/1a3/6753391a3a4aeed1acae38862ac9d883.png"></div><br>  <i><font color="#999999">Mesg command</font></i> <br><br>  In this case, the team displayed ‚Äúis y‚Äù, which means that the user under which we work in the system can receive messages sent to his terminal.  Otherwise, <code>mesg</code> will print ‚Äúis n‚Äù. <br><br>  To check if sending messages to some other user is allowed, you can use the <code>who</code> command that you already know with the <code>-T</code> switch: <br><br><pre> <code class="hljs ruby">$ who -T</code> </pre> <br>  However, verification is only possible for users who are logged in.  If such a command, after the username, displays a dash (-), this means that the user has prohibited entry to his terminal, that is, messages cannot be sent to him.  The fact that the user can send messages, says the plus sign (+). <br><br>  If your message reception is disabled, and you want to allow other users to send you messages, you can use the following command: <br><br><pre> <code class="hljs ruby">$ mesg y</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/f01/eda/2dc/f01eda2dc79b7040fd3d144aa06d676d.png"></div><br>  <i><font color="#999999">Enabling the reception of messages from other users</font></i> <br><br>  After enabling message reception, <code>mesg</code> returns ‚Äúis y‚Äù. <br>  Of course, we need two users to exchange messages, so we, after normal logging in to the system, connected to the computer via ssh.  Now you can experiment. <br><br><h3>  <font color="#3AC1EF">Write write command</font> </h3><br>  The main tool for messaging between logged in users is the <code>write</code> command.  If the reception of messages from the user is allowed, using this command, he can send messages using his name and information about the terminal. <br><br>  Note that using <code>write</code> you can send messages to users logged into the virtual console.  Users who work in a graphical environment (KDE, Gnome, Cinnamon, and so on) cannot receive such messages. <br><br>  So, we, working under the user <code>likegeeks</code> , initiate a communication session with the user <code>testuser</code> , which works in the <code>pts/1</code> terminal, as follows: <br><br><pre> <code class="hljs pgsql">$ <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> testuser pts/<span class="hljs-number"><span class="hljs-number">1</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/511/a39/70a/511a3970ab4a8546fd6ff1f07f87a307.png"></div><br>  <i><font color="#999999">Checking the possibility of sending messages and sending messages</font></i> <br><br>  After executing the above command, we will have an empty line in which you need to enter the first line of the message.  By pressing <code>ENTER</code> , we can enter the next line of the message.  After the text entry is completed, you can end the communication session using the <code>CTRL + D</code> key combination, which allows you to enter <a href="https://habrahabr.ru/company/ruvds/blog/326826/">the end-of-file character</a> . <br><br>  This is what the user to whom we sent the message will see in his terminal. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a95/516/269/a9551626918b606b20c58d9e30ed8ea0.png"></div><br>  <i><font color="#999999">The new message that came to the terminal</font></i> <br><br>  The recipient can understand from whom the message came, see the time when it was sent.  Notice the end-of-file flag, <code>EOF</code> , located at the bottom of the terminal window.  It indicates the end of the message text. <br><br>  We believe that now we have everything we need in order to automate the sending of messages using a command line script. <br><br><h3>  <font color="#3AC1EF">‚ñç Create a script to send messages</font> </h3><br>  Before you send messages, you need to determine whether the user you are interested in logs into the system.  You can do this with the following command: <br><br><pre> <code class="hljs perl">logged_on=$(who | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i -<span class="hljs-keyword"><span class="hljs-keyword">m</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> $1 | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>)</code> </pre> <br>  Here the results of the <code>who</code> command are passed to the <code>grep</code> .  The <code>-i</code> switch of this command allows you to ignore the case of characters.  The <code>-m 1</code> switch is included in the command call in case the user has logged in several times.  This command will either not display anything, or will display the user name (we will specify it when the script is called, it will fall into the position variable <code>$1</code> ) corresponding to the first session found.  The output of <code>grep</code> is the <code>awk</code> .  This command, again, either does not print anything, or displays an element written to its own variable <code>$1</code> , that is, the name of the user.  As a result, what happened is in the variable <code>logged_on</code> . <br><br>  Now we need to check the variable l <code>ogged_on</code> , see if there is anything in it: <br><br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-variable"><span class="hljs-variable">$logged_on</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> is not logged on."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br>  If you are not quite confident working with the <code>if</code> construct, take a look at <a href="https://habrahabr.ru/company/ruvds/blog/325522/">this</a> material. <br>  The script containing the above code will be <code>senderscript</code> in the <code>senderscript</code> file and <code>senderscript</code> , giving it, as a command line parameter, the user name <code>testuser</code> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/761/50b/96e/76150b96e45ce0d0fcb4eb0e536e0d4f.png"></div><br>  <i><font color="#999999">User status check</font></i> <br><br>  Here we check if <code>logged_on</code> variable with zero length.  If this is the case, we will be informed that at the moment the user is not logged in and the script will exit using the <code>exit</code> .  Otherwise, the script will continue. <br><br><h3>  <font color="#3AC1EF">‚ñçCheck of recording capabilities in the user terminal</font> </h3><br>  Now you need to check whether the user accepts messages.  To do this, we need such a construction, similar to the one we used above: <br><br><pre> <code class="hljs bash">allowed=$(who -T | grep -i -m 1 <span class="hljs-variable"><span class="hljs-variable">$1</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ <span class="hljs-variable"><span class="hljs-variable">$allowed</span></span> != <span class="hljs-string"><span class="hljs-string">"+"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$1</span></span></span><span class="hljs-string"> does not allowing messaging."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a3e/08c/f12/a3e08cf12f617fd3ff123265f8342fcc.png"></div><br>  <i><font color="#999999">Checking the possibility of sending messages to the user</font></i> <br><br>  First we call the <code>who</code> command with the <code>-T</code> switch.  In the line of information about the user who can receive messages, there will be a plus sign (+), but if the user cannot receive messages, there will be a dash (-).  What happened after calling <code>who</code> is passed to <code>grep</code> , and then <code>awk</code> , forming the variable <code>allowed</code> . <br><br>  Next, using the conditional operator, we check what is in the <code>allowed</code> variable.  If the plus sign is not in it, we will inform you that sending messages to the user is prohibited and finish the work.  Otherwise, the script will continue. <br><br><h3>  <font color="#3AC1EF">‚ñçCheck script validity</font> </h3><br>  The first parameter of the script is the name of the user to whom we want to send a message.  The second is the text of the message, in this case - consisting of one word.  In order to check whether the message was sent to the script for sending, use the following code: <br><br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z <span class="hljs-variable"><span class="hljs-variable">$2</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"No message parameter included."</span></span> <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">fi</span></span></code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/63b/910/246/63b910246e010ac396f28324de51ce10.png"></div><br>  <i><font color="#999999">Checking the command line parameters specified when invoking the script</font></i> <br><br>  Here, if, when calling the script, the message for sending was not sent to it, we inform about it and finish the work.  Otherwise - go ahead. <br><br><h3>  <font color="#3AC1EF">‚ñçGetting User Terminal Information</font> </h3><br>  Before you send a message to the user, you need to get information about the terminal in which he works and save the terminal name in a variable.  This is done like this: <br><br><pre> <code class="hljs perl">terminal=$(who | <span class="hljs-keyword"><span class="hljs-keyword">grep</span></span> -i -<span class="hljs-keyword"><span class="hljs-keyword">m</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> $1 | awk <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span>)</code> </pre> <br>  Now, after all the necessary data have been collected, it remains only to send a message: <br><br><pre> <code class="hljs perl">echo $2 | <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> $logged_on $terminal</code> </pre> <br>  The call to the finished script looks like this: <br><br><pre> <code class="hljs ruby">$ ./senderscript testuser welcome</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/a22/e36/dd5/a22e36dd5b5c6755fbba9efe3a8e09a7.png"></div><br>  <i><font color="#999999">Successful message sending using bash script</font></i> <br><br>  As you can see, everything works as it should.  However, using such a script, you can only send messages consisting of one word.  It would be nice to be able to send longer messages. <br><br><h3>  <font color="#3AC1EF">‚ñçSend long messages</font> </h3><br>  Let's try to call the <code>senderscript</code> script, passing a message consisting of several words: <br><br><pre> <code class="hljs pgsql">$ ./senderscript likegeeks welcome <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> shell scripting</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a8/062/728/6a8062728f8d848966abbd3bcf95a5ed.png"></div><br>  <i><font color="#999999">Attempt to send a long message</font></i> <br><br>  As you can see, only the first word was sent.  The fact is that each word of the message is perceived inside the script as a separate positional variable.  In order to be able to send long messages, we process the command line parameters passed to the script using <a href="https://habrahabr.ru/company/ruvds/blog/326328/">the</a> <code>shift</code> <a href="https://habrahabr.ru/company/ruvds/blog/326328/">command</a> and the <code>while</code> . <br><br><pre> <code class="hljs pgsql">shift <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ -n "$1" ] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> whole_message=$whole_messag<span class="hljs-string"><span class="hljs-string">e' '</span></span><span class="hljs-meta"><span class="hljs-meta">$1</span></span> shift done</code> </pre> <br>  After that, in the message sending command, we use, instead of the previously used positional variable <code>$2</code> , the variable <code>whole_message</code> : <br><br><pre> <code class="hljs perl">echo $whole_message | <span class="hljs-keyword"><span class="hljs-keyword">write</span></span> $logged_on $terminal</code> </pre> <br>  Here is the full text of the script: <br><br><pre> <code class="hljs mel">#!/bin/bash logged_on=$(who | grep -i -m <span class="hljs-number"><span class="hljs-number">1</span></span> $1 | awk <span class="hljs-string"><span class="hljs-string">'{print $1}'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z $logged_on ] then echo <span class="hljs-string"><span class="hljs-string">"$1 is not logged on."</span></span> echo <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> exit fi allowed=$(who -T | grep -i -m <span class="hljs-number"><span class="hljs-number">1</span></span> $1 | awk <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ $allowed != <span class="hljs-string"><span class="hljs-string">"+"</span></span> ] then echo <span class="hljs-string"><span class="hljs-string">"$1 does not allowing messaging."</span></span> echo <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> exit fi <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> [ -z $2 ] then echo <span class="hljs-string"><span class="hljs-string">"No message parameter included."</span></span> echo <span class="hljs-string"><span class="hljs-string">"Exit"</span></span> exit fi terminal=$(who | grep -i -m <span class="hljs-number"><span class="hljs-number">1</span></span> $1 | awk <span class="hljs-string"><span class="hljs-string">'{print $2}'</span></span>) shift <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> [ -n <span class="hljs-string"><span class="hljs-string">"$1"</span></span> ] <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> whole_message=$whole_message<span class="hljs-string"><span class="hljs-string">' '</span></span>$1 shift done echo $whole_message | write $logged_on $terminal</code> </pre> <br>  Test it: <br><br><pre> <code class="hljs pgsql">$ ./senderscript likegeeks welcome <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> shell scripting</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c85/623/c06/c85623c06f86712b250620ce794d7e6e.png"></div><br>  <i><font color="#999999">Successful long message sending:</font></i> <br><br>  A long message successfully reached the addressee.  Now consider the following example. <br><br><h2>  <font color="#3AC1EF">Script for monitoring disk space</font> </h2><br>  Now we are going to create a command line script that is designed to search in the specified directories of the top ten folders that account for the most disk space.  This will help us <a href="https://likegeeks.com/main-linux-commands-easy-guide/">team</a> <code>du</code> , which displays information about how much disk space are occupied by files and folders.  By default, it displays information only about directories, with the <code>-a</code> option, individual files are <code>-a</code> in the report.  Its <code>-s</code> key allows you to display information about the size of directories.  This command allows, for example, to find out the amount of disk space that is occupied by the data of a certain user.  Here is the call to this command: <br><br><pre> <code class="hljs swift">$ du -s /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log/</code> </pre> <br>  For our purposes, the <code>-S</code> (capital S) key is better suited, since it allows you to get information both on the root folder and on the directories attached to it: <br><br><pre> <code class="hljs swift">$ du -<span class="hljs-type"><span class="hljs-type">S</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log/</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/42b/b5e/8ca/42bb5e8caec726f7d312cf1f9df25a49.png"></div><br>  <i><font color="#999999">Calling du with the -s and -S options</font></i> <br><br>  We need to find the directories that have the most disk space, so the list that <code>du</code> gives out should be sorted using the <code>sort</code> command: <br><br><pre> <code class="hljs swift">$ du -<span class="hljs-type"><span class="hljs-type">S</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log/ | <span class="hljs-built_in"><span class="hljs-built_in">sort</span></span> -rn</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/cff/ef2/9a8/cffef29a8ee74eb8992799d26d56fa16.png"></div><br>  <i><font color="#999999">Sorted list of objects</font></i> <br><br>  The <code>-n</code> switch tells the team to use numeric sorting, the <code>-r ‚Äî</code> switch to reverse the sort order (the largest number will be at the top of the list).  The data obtained is quite suitable for our purposes. <br><br>  In order to limit the resulting list to the first ten entries, use the <a href="https://habrahabr.ru/company/ruvds/blog/327530/">stream editor</a> <code>sed</code> , which will remove all rows from the resulting list, starting with the eleventh.  The next step is to add its number to each received line.  It will also help <code>sed</code> , namely - his team <code>N</code> : <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">sed</span></span> <span class="hljs-string"><span class="hljs-string">'{11,</span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$D</span></span></span><span class="hljs-string">; =}'</span></span> | sed <span class="hljs-string"><span class="hljs-string">'N; s/\n/ /'</span></span> |</code> </pre> <br>  We put the data in order using <code>awk</code> .  Let's pass <code>awk</code> what we got after processing the data with <code>sed</code> , applying, as in other cases, the pipeline, and output the data using the <code>printf</code> command: <br><br><pre> <code class="hljs apache"><span class="hljs-attribute"><span class="hljs-attribute">awk</span></span> '{printf <span class="hljs-number"><span class="hljs-number">$1</span></span> <span class="hljs-string"><span class="hljs-string">":"</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> <span class="hljs-number"><span class="hljs-number">$2</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> <span class="hljs-number"><span class="hljs-number">$3</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>}'</code> </pre> <br>  At the beginning of the line, its number is displayed, then comes a colon and a tab, then the amount of disk space, followed by another tab and the name of the folder. <br><br>  Putting together all of what we said: <br><br><pre> <code class="hljs swift">$ du -<span class="hljs-type"><span class="hljs-type">S</span></span> /<span class="hljs-keyword"><span class="hljs-keyword">var</span></span>/log/ | <span class="hljs-built_in"><span class="hljs-built_in">sort</span></span> -rn | sed '{<span class="hljs-number"><span class="hljs-number">11</span></span>,$<span class="hljs-type"><span class="hljs-type">D</span></span>; =}' | sed '<span class="hljs-type"><span class="hljs-type">N</span></span>; s/\n/ /' | awk '{printf $<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-string"><span class="hljs-string">":"</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> $<span class="hljs-number"><span class="hljs-number">2</span></span> <span class="hljs-string"><span class="hljs-string">"\t"</span></span> $<span class="hljs-number"><span class="hljs-number">3</span></span> <span class="hljs-string"><span class="hljs-string">"\n"</span></span>}'</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/285/7bc/4fb/2857bc4fb85059664b25f99ee26ae472.png"></div><br>  <i><font color="#999999">Display disk space information</font></i> <br><br>  In order to improve the efficiency of the script, the code of which you will very soon see, we implement the possibility of receiving data from several directories at once.  To do this, create the variable <code>MY_DIRECTORIES</code> and list the directories of interest to us: <br><br><pre> <code class="hljs objectivec">MY_DIRECTORIES=<span class="hljs-string"><span class="hljs-string">"/home /var/log"</span></span></code> </pre> <br>  Enumerate the list using a <code>for</code> loop and call the above sequence of commands for each element of the list.  Here is the result: <br><br><pre> <code class="hljs mel">#!/bin/bash MY_DIRECTORIES=<span class="hljs-string"><span class="hljs-string">"/home /var/log"</span></span> echo <span class="hljs-string"><span class="hljs-string">"Top Ten Disk Space Usage"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> DIR <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> $MY_DIRECTORIES <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> echo <span class="hljs-string"><span class="hljs-string">"The $DIR Directory:"</span></span> du -S $DIR <span class="hljs-number"><span class="hljs-number">2</span></span>&gt;/dev/null | <span class="hljs-keyword"><span class="hljs-keyword">sort</span></span> -rn | sed <span class="hljs-string"><span class="hljs-string">'{11,$D; =}'</span></span> | sed <span class="hljs-string"><span class="hljs-string">'N; s/\n/ /'</span></span> | awk <span class="hljs-string"><span class="hljs-string">'{printf $1 ":" "\t" $2 "\t" $3 "\n"}'</span></span> done exit</code> </pre> <br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/c18/68f/d4a/c1868fd4a7092a83026dfee3032b1a80.png"></div><br>  <i><font color="#999999">Getting information about several directories</font></i> <br><br>  As you can see, the script displays, in the form of a convenient list, information about directories, the list of which is stored in <code>MY_DIRECTORIES</code> . <br><br>  The <code>du</code> command in this script can be invoked with other keys, the resulting list of objects may well be filtered out, in general, there opens up a wide scope for independent experiments.  As a result, instead of working with a list of folders, you can, for example, find the largest files with the <code>.log,</code> extension <code>.log,</code> or implement a more complex algorithm for finding the largest (or smallest) files and folders. <br><br><h2>  <font color="#3AC1EF">Results</font> </h2><br>  Today we have analyzed in detail a couple of script development examples.  Here I would like to remind you that our main goal is not to write a script to send messages using the <code>write</code> command, or a script that helps in finding files and folders that take up a lot of disk space, but in describing the development process itself.  Having mastered these examples, experimenting with them, perhaps - by adding them or completely reworking, you will learn something new, improve your skills in developing bash scripts. <br><br>  That's all for today.  Next time we will talk about automating the work with interactive utilities using expect. <br><br> <a href="https://ruvds.com/ru-rub/"><img src="https://habrastorage.org/files/1ba/550/d25/1ba550d25e8846ce8805de564da6aa63.png"></a> <br><br>  Dear readers!  Do you have in mind simple (and maybe complex, but understandable) bash-scripts, the analysis of which will be useful for beginners? </div><p>Source: <a href="https://habr.com/ru/post/328346/">https://habr.com/ru/post/328346/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../328334/index.html">Precision timestamp</a></li>
<li><a href="../328336/index.html">A caring look at IT jobs</a></li>
<li><a href="../328340/index.html">Realistic IT company strategies in crisis</a></li>
<li><a href="../328342/index.html">Researchers have learned to attack industrial robots. Thousands of them are available from the network.</a></li>
<li><a href="../328344/index.html">Startup of the day (April 2017)</a></li>
<li><a href="../328348/index.html">Making any object thread safe</a></li>
<li><a href="../328352/index.html">Top 10 Mistakes Made by Django Developers</a></li>
<li><a href="../328354/index.html">Comparison of PVS-Studio C # and static analyzer built into Visual Studio based on the code of the CruiseControl.NET project</a></li>
<li><a href="../328356/index.html">As we did the third internship in iOS and Android development at Redmadrobot</a></li>
<li><a href="../328358/index.html">Fatty programs - we study the factor of memory part B</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>