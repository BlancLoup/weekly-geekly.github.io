<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Android PC Game Controller</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! In this article I want to talk about how you can make a game controller (in common people - a joystick) from your Adndroid smartphone for a reg...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Android PC Game Controller</h1><div class="post__text post__text-html js-mediator-article">  Hello!  In this article I want to talk about how you can make a game controller (in common people - a joystick) from your Adndroid smartphone for a regular PC, namely the <b>steering wheel</b> . <br><br><h4>  Task Description </h4><br>  The steering behavior will be emulated with an accelerometer.  For this purpose, continuous scanning of spatial coordinates is conducted and boundaries for each direction of movement are selected empirically.  Based on this data, real-time game key combinations are generated.  For example: W - forward, WA - forward and left, etc. <br><br>  To deliver this data to a PC, a server must be running that accepts incoming commands and emulates key presses.  The server can be made single-threaded to connect only one smartphone.  The connection will be via Wi-Fi. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  And now the most interesting ... <br><br><h4>  Server </h4><br>  The server is implemented in C ++ under Windows.  Its main task is to continuously receive incoming messages and press keys.  The following is the basic and simple code for this task: <br><br><blockquote><code><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> <font color="black">Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> <ol> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li></li><li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> <li> <code><font color="black"><a href="http://s-c.me/11012/s"></a> <a href="http://s-c.me/11012/h"></a> Copy Source | Copy HTML while ( <font color="#008000">true</font> ) { std::cout &lt;&lt; <font color="#0000ff">"Wait for connection...\n"</font> ; try { socket = server.Accept(); } catch ( <font color="#008000">const char *error</font> ) { std::cout &lt;&lt; error &lt;&lt; std:: <font color="#0000ff">endl</font> ; exit( <font color="#008000">0</font> ); } bool keepAlive = true; int timeout = <font color="#0000ff">10000</font> ; setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_KEEPALIVE, ( <font color="#008000">char*</font> )&amp;keepAlive, <font color="#ff0000">size</font> of( <font color="#008000">bool</font> )); setsockopt( <font color="#008000">server.getSocket(</font> ), SOL_SOCKET, SO_RCVTIMEO, ( <font color="#008000">char*</font> )&amp;timeout, <font color="#ff0000">size</font> of( <font color="#008000">int</font> )); std::cout &lt;&lt; <font color="#0000ff">"Connected!\n"</font> ; while ( <font color="#008000">true</font> ) { std: <font color="#A31515">:string</font> msg = socket-&gt;ReceiveLine(); if ( <font color="#008000">msg.empty(</font> )) break; processKeys( <font color="#008000">msg.c_str(</font> )); } std::cout &lt;&lt; <font color="#0000ff">"Disconnected.\n\n\n"</font> ; }</font></code> </li> </ol></blockquote><br><br>  Keystrokes: <br><br><blockquote> <code><a href="http://s-c.me/11014/s"></a> <a href="http://s-c.me/11014/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  void pressKeys ( <font color="#008000">char key1, char key2</font> ) { </li><li>  <font color="#008000">// press previous keys</font> </li><li></li><li>  for ( <font color="#008000">std :: map &lt;char, int&gt; :: iterator it = scanCodes.begin (</font> ); it! = scanCodes.end (); it ++) { </li><li>  char curKey = it-&gt; first; </li><li></li><li>  if ( <font color="#008000">curKey! = key1 &amp;&amp; curKey! = key2</font> ) </li><li>  upKey ( <font color="#008000">curKey</font> ); </li><li>  } </li><li></li><li>  downKey ( <font color="#008000">key1</font> ); </li><li>  downKey ( <font color="#008000">key2</font> ); </li><li>  } </li><li></li><li>  void downKey ( <font color="#008000">char key</font> ) { </li><li>  keybd_event ( <font color="#008000">VkKeyScan (key</font> ), scanCodes [key], <font color="#0000ff">0</font> , <font color="#0000ff">0</font> ); </li><li>  } </li><li></li><li>  void upKey ( <font color="#008000">char key</font> ) { </li><li>  keybd_event ( <font color="#008000">VkKeyScan (key</font> ), scanCodes [key], KEYEVENTF_KEYUP, <font color="#0000ff">0</font> ); </li><li>  } </li></ol></blockquote><br><br><h4>  Customer </h4><br>  The client's task is to connect to the server and send key combinations to press.  To do this, use the accelerometer.  Our task is to get the spatial coordinates of the phone.  This is done like this: <br><blockquote> <code><a href="http://s-c.me/11020/s"></a> <a href="http://s-c.me/11020/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">public class</font> MainActivity extends Activity implements SensorEventListener { </li><li></li><li>  <font color="#cc6633">@Override</font> </li><li>  <font color="#0000ff">public void</font> onCreate (Bundle savedInstanceState) { </li><li>  <font color="#008000">// ...</font> </li><li></li><li>  sensorManager = (SensorManager) getSystemService (SENSOR_SERVICE); </li><li>  accelerometer = sensorManager.getDefaultSensor (Sensor.TYPE_ACCELEROMETER); </li><li></li><li>  <font color="#008000">// ...</font> </li><li>  } </li><li></li><li>  <font color="#cc6633">@Override</font> </li><li>  <font color="#0000ff">public void</font> onSensorChanged (SensorEvent <font color="#0000ff">event</font> ) { </li><li>  <font color="#0000ff">if</font> ( <font color="#0000ff">event</font> .sensor.getType () == Sensor.TYPE_ACCELEROMETER) { </li><li>  <font color="#0000ff">long</font> curTime = System.currentTimeMillis (); </li><li></li><li>  <font color="#008000">// read data every 100 ms, otherwise the phone will be bent from the garbage collector</font> </li><li>  <font color="#0000ff">if</font> (lastUpdate == - <font color="#A31515">1</font> || (curTime - lastUpdate)&gt; <font color="#A31515">100</font> ) { </li><li>  lastUpdate = curTime; </li><li></li><li>  x = <font color="#0000ff">event.</font> Values ‚Äã‚Äã[DATA_X]; </li><li>  y = <font color="#0000ff">event.</font> Values ‚Äã‚Äã[DATA_Y]; </li><li>  z = <font color="#0000ff">event.</font> Values ‚Äã‚Äã[DATA_Z]; </li><li></li><li>  xLabel.setText (String.format ( <font color="#A31515">"X:% + 2.5f"</font> , x)); </li><li>  yLabel.setText (String.format ( <font color="#A31515">"Y:% + 2.5f"</font> , y)); </li><li>  zLabel.setText (String.format ( <font color="#A31515">"Z:% + 2.5f"</font> , z)); </li><li></li><li>  <font color="#0000ff">try</font> { </li><li>  sendKeys ();  <font color="#008000">// analysis of coordinates for sending keys to the server</font> </li><li>  } <font color="#0000ff">catch</font> (Exception e) { </li><li>  e.printStackTrace (); </li><li>  } </li><li></li><li>  } </li><li></li><li>  } </li><li></li><li>  } </li><li>  } </li></ol></blockquote><br><br>  The important point is that data should be read from the accelerometer at a certain interval, otherwise your program will instantly suspend from continuous requests to the sensor.  Also, when folding, listeners must be untied from the accelerometer so that system and battery resources are not wasted.  To do this, the following is done in the onResume and onPause methods: <br><br><blockquote> <code><a href="http://s-c.me/11024/s"></a> <a href="http://s-c.me/11024/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#cc6633">@Override</font> </li><li>  <font color="#0000ff">protected void</font> onResume () { </li><li>  super.onResume (); </li><li></li><li>  sensorManager.registerListener ( <font color="#0000ff">this</font> , accelerometer, SENSOR_DELAY_NORMAL); </li><li>  } </li><li></li><li>  <font color="#cc6633">@Override</font> </li><li>  <font color="#0000ff">protected void</font> onPause () { </li><li>  super.onPause (); </li><li>  sensorManager.unregisterListener ( <font color="#0000ff">this</font> ); </li><li>  } </li></ol></blockquote><br><br>  The key generation code is very simple.  All boundaries were determined experimentally. <br><blockquote> <code><a href="http://s-c.me/11022/s"></a> <a href="http://s-c.me/11022/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">private</font> String getKeys () { </li><li>  String keys = <font color="#A31515">""</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (z&gt; <font color="#A31515">7.</font> <font color="#A31515">5</font> ) </li><li>  keys + = <font color="#A31515">"W"</font> ; </li><li>  <font color="#0000ff">else</font> </li><li>  keys + = <font color="#A31515">"S"</font> ; </li><li></li><li>  <font color="#0000ff">if</font> (y &lt;- <font color="#A31515">3</font> ) </li><li>  keys + = <font color="#A31515">"A"</font> ; </li><li>  <font color="#0000ff">else if</font> (y&gt; <font color="#A31515">3</font> ) </li><li>  keys + = <font color="#A31515">"D"</font> ; </li><li></li><li>  <font color="#0000ff">return</font> keys; </li><li>  } </li></ol></blockquote><br><h4>  How it all works </h4><br>  I tested it all at Need For Speed ‚Äã‚ÄãMost Wanted.  Feels like, of course, not like a real steering wheel, but you can play. Unfortunately, the video did not work - there is one camera in the house, and then on the test phone.  In the near future I will definitely post it.  Here's how it looks on the PC and on the smartphone: <br><br><img src="https://habrastorage.org/storage/habraeffect/53/88/5388a4cc464cd1f8baf34b35abce92e4.png" alt="image"><br><br><img src="https://habrastorage.org/storage/habraeffect/32/60/32604d439f31c24e4c40a88d25fbac55.png" alt="image"><br><br><h4>  Conclusion </h4><br>  While the main drawback in the server is a global keystroke, independent of the application.  In the future, will be what to do.  Another problem I encountered is a permanent disconnect.  I did not find a better solution than a constant reconnect when the connection is broken. <br><br><h4>  What to read </h4><br>  Work with accelerometer: <br>  <a href="">github.com/eburke/android_game_examples/blob/9d65f96aff5d60a2e765d8db894b7eb3fd02c315/GameExamples/src/com/stuffthathappens/games/Accel.java</a> <br><br>  Keystroke emulation: <br>  <a href="http://www.codeproject.com/kb/system/keyboard.aspx">www.codeproject.com/kb/system/keyboard.aspx</a> <br><br>  And most importantly - the source: <br>  <a href="">dl.dropbox.com/u/5636452/game_controller.zip</a> </div><p>Source: <a href="https://habr.com/ru/post/111511/">https://habr.com/ru/post/111511/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../111505/index.html">Wine 1.3.11 release</a></li>
<li><a href="../111507/index.html">Ways of visualization in multi-dimensional games</a></li>
<li><a href="../111508/index.html">Clever cache deletion (php 5 + Mongodb + memcached)</a></li>
<li><a href="../111509/index.html">Role information modeling in programming</a></li>
<li><a href="../111510/index.html">A simple implementation of RC4 in C #</a></li>
<li><a href="../111512/index.html">Threats Inside: we initialize channels of leakage of corporate information</a></li>
<li><a href="../111513/index.html">Reverse engineering android applications</a></li>
<li><a href="../111514/index.html">Mt: C language for heavily loaded servers</a></li>
<li><a href="../111515/index.html">Corporate colors of sites and companies</a></li>
<li><a href="../111518/index.html">Where startups are hosted</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>