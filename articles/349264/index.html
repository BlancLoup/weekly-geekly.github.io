<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Ready site template with registration, users and admins on Flask with SQL or MongoDB databases</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Happens, it is necessary to do sites on flask which have users and administrators. Purely for myself, I decided to standardize it somehow and, most im...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Ready site template with registration, users and admins on Flask with SQL or MongoDB databases</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/webt/j8/1u/_v/j81u_vqouw1erkh42rb9blff1no.jpeg" alt="flask"></div><br>  Happens, it is necessary to do sites on <a href="https://habrahabr.ru/post/346306/">flask</a> which have users and administrators.  Purely for myself, I decided to standardize it somehow and, most importantly, not to lose time when such a task appears.  The goal - in a few teams to get a working site that has: <br><br><ul><li>  check in </li><li>  Email Verification </li><li>  Authorization </li><li>  Logout </li><li>  Administrators and Administrator Roles </li><li>  Administrative, user and public part of the site </li><li>  The ability of the user to change the password </li><li>  Password recovery </li><li>  Localization for foreign languages </li></ul><a name="habracut"></a><br><h2>  Screenshots </h2><br>  Here is what comes out of the box: <br><br><img src="https://habrastorage.org/webt/wy/ua/xd/wyuaxd6htn7kxwqeovsczqiuqwe.png">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/zr/ax/3u/zrax3uusebbbgp1--gmc0lfzvz8.png"><br><br><img src="https://habrastorage.org/webt/zk/pn/sh/zkpnshe7sxaeopkmcrfp-dwqfvu.png"><br><br>  User profile after authorization: <br><br><img src="https://habrastorage.org/webt/jp/1_/qm/jp1_qm4ccqijj2dbprsdxc7itma.png"><br><br>  Admin- <a href="https://flask-admin.readthedocs.io/en/latest/">flask admin</a> : <br><br><img src="https://habrastorage.org/webt/z7/px/gy/z7pxgyd_xbxh2mdm1_unc38o0bo.png"><br><br>  You can get this site in two ways: <br><br><h2>  <font color="#cc0000">I Option.</font>  <font color="#cc0000">Using flask-user and SQL database</font> </h2><br><div class="spoiler">  <b class="spoiler_title">Install and Run</b> <div class="spoiler_text"><h2>  Installation </h2><br><pre><code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ <span class="hljs-comment"><span class="hljs-comment">#    virtualenv env #    . env/bin/activate mkdir -p ~/www/my_app cd www git clone https://github.com/Alexmod/Flask-User-and-Flask-admin.git my_app cd my_app/ #    pip install -r requirements.txt #    python manage.py init_db #   py.test tests/ #    ,   python manage.py runserver</span></span></code> </pre> <br>  After these commands, the address <code>http://localhost:5000/</code> should open the site as in the screenshots. <br><br>  User: user@example.com Password: Password1. <br>  Admin: admin@example.com Password: Password1. <br><br>  I ran and tested on linux with Python version 3.4, but I assume that it should "take off" on any 3.x. <br><br>  <a href="https://github.com/Alexmod/Flask-User-and-Flask-admin">Link to github.</a> <br><br>  Console Setup Sample <br><img src="https://habrastorage.org/webt/_b/3m/bb/_b3mbb2lqcafpdmat0r7nopoftq.png"><br></div></div><br><br><div class="spoiler">  <b class="spoiler_title">Details of the first option</b> <div class="spoiler_text"><h2>  Details </h2><br>  I took the <a href="https://github.com/lingthio/Flask-User">Flask-User</a> module as a basis and <a href="https://github.com/lingthio/Flask-User-starter-app">this</a> repository.  What has been added / changed: <br><br><ol><li>  Localization of both templates and flash messages has been added.  Language support: (German, English, Spanish, Farsi, Finnish, French, Italian, Danish, Russian, Swedish, Turkish, Chinese).  If the language is not in the list, then by default, the Russian language is set as default in the config file. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># local_settings.py BABEL_DEFAULT_LOCALE = 'ru'</span></span></code> </pre><br>  In Russian, I made my localization. <br><br><pre> <code class="hljs">app/translations/ru/LC_MESSAGES/flask_user.po</code> </pre> <br>  <a href="https://pythonhosted.org/Flask-Babel/">Flask-Babel</a> did a great job with flash messages, but in order for the templates to work, a Russian translation of the strings like: <br><br><pre> <code class="hljs django"><span class="xml"></span><span class="hljs-template-tag"><span class="xml"></span><span class="hljs-template-tag">{%</span><span class="hljs-name"><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name"><span class="hljs-name">trans</span></span></span></span></span><span class="hljs-template-tag">%}</span></span><span class="xml"><span class="xml">Forgot your Password?</span></span><span class="hljs-template-tag"><span class="hljs-template-tag">{%</span><span class="hljs-name"><span class="hljs-template-tag"><span class="hljs-name">endtrans</span></span></span><span class="hljs-template-tag">%}</span></span><span class="xml"><span class="xml">  </span></span><span class="hljs-template-variable"><span class="hljs-template-variable">{{ _('Sign in') }}</span></span><span class="xml"></span><span class="xml"></span></code> </pre> <br>  I had to sabotage.  Added by: <br><br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> gettext</code> </pre><br>  and this function: <br><br><pre> <code class="python hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_lang</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(lang)</span></span></span><span class="hljs-function">:</span></span> i18n_dir = app.config[<span class="hljs-string"><span class="hljs-string">'BABEL_TRANSLATION_DIRECTORIES'</span></span>] gettext.install(<span class="hljs-string"><span class="hljs-string">'lang'</span></span>, i18n_dir) trans_file = i18n_dir + lang + <span class="hljs-string"><span class="hljs-string">'/LC_MESSAGES/flask_user'</span></span> tr = gettext.translation(trans_file, <span class="hljs-string"><span class="hljs-string">'locale'</span></span>, languages=[lang]) tr.install(<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>) app.jinja_env.install_gettext_translations(tr)</code> </pre> <br></li><li>  Removed the field name and surname during registration.  In my experience it is rarely required, but annoying users. </li><li>  All * .py files are referenced to the pep-8 standard. </li><li>  Cleaned up modules that are loaded but not used. </li><li>  Routes are divided into 3 parts: public, admin and user (public_view.py, members_views.py, about the admin below) </li><li>  The <a href="https://pythonhosted.org/Flask-Bootstrap/">flask_bootstrap</a> module has been <a href="https://pythonhosted.org/Flask-Bootstrap/">added</a> and templates and flash messages have been changed with it. <br><br><pre> <code class="python hljs">{% <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"bootstrap/utils.html"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> utils %} {{ utils.flashed_messages(dismissible=<span class="hljs-keyword"><span class="hljs-keyword">True</span></span>, container=<span class="hljs-keyword"><span class="hljs-keyword">False</span></span>) }}</code> </pre> <br>  In the file layout.html. <br></li><li>  Added admin Flask-Admin ( <a href="https://habrahabr.ru/post/148765/">article on Habr√© about it</a> ).  After simple manipulations, she allowed to activate, deactivate and delete users, gave the opportunity to add roles.  Plus work with static files (upload to the server, delete, create folders, etc.).  No localization yet. <br><br><img src="https://habrastorage.org/webt/bm/ut/qf/bmutqfxokmpuo73oi9d9cvkr3xm.png"><br><br>  Friends Flask-Admin and Flask-User did not want to share when using user_models.py together. <br><br>  I had to create a separate models.py file for Flask-Admin, and I could not figure out why they interfered with each other. <br></li></ol><br></div></div><br><br><h2>  <font color="#cc0000">Option II.</font>  <font color="#cc0000">Using flask-security and MongoDB</font> </h2><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/sb/yo/-a/sbyo-adyptuegbqz34m3y8j0tx8.jpeg"></div><br><br><div class="spoiler">  <b class="spoiler_title">Screenshots</b> <div class="spoiler_text"><h2>  Screenshots </h2><br>  Here is what comes out of the box: <br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_d/nh/4p/_dnh4pxulzrjwzx8r2mahtesdzw.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/lk/a5/j-/lka5j-fkdgaw9geknv6kjyuhoxg.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/_f/ec/u-/_fecu-tu0eko67imn8uj_bssieg.png"></div><br><br><div style="text-align:center;"><img src="https://habrastorage.org/webt/fb/w2/42/fbw242ettd1fay8l4rwt3xtd-ac.png"></div><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Install and Run</b> <div class="spoiler_text"><h2>  Installation </h2><br><br>  I hope you already have git, virtualenv and mongoDB installed. <br><br><pre> <code class="bash hljs"><span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> ~ <span class="hljs-comment"><span class="hljs-comment">#    virtualenv env #   . env/bin/activate #    mkdir -p ~/www/my_app cd www git clone https://github.com/Alexmod/flask-security-flask-admin-mongodb.git my_app cd my_app #     pip install -r requirements.txt #   python manage.py runserver</span></span></code> </pre><br><br>  After these commands, the address <code>http://localhost:5000/</code> should open the site as in the screenshots. <br><br>  User: user@example.com Password: Password1. <br>  Admin: admin@example.com Password: Password1. <br><br>  I ran on linux with Python version 3.6, but I assume that it should "take off" on any 3.x. <br><br>  <a href="https://github.com/Alexmod/flask-security-flask-admin-mongodb">Link to GitHub for MongoDB</a> <br></div></div><br><br><h2>  Depla first and second options </h2><br>  Deploying methods are many.  Here is one of the most simple. <br>  We put gunicorn: <br><pre> <code class="bash hljs">pip install gunicorn</code> </pre><br>  In the folder my_app create a new file wsgi.py with the following content: <br><pre> <code class="python hljs"><span class="hljs-keyword"><span class="hljs-keyword">from</span></span> app <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> create_app app = create_app()</code> </pre><br><br>  And run: <br><pre> <code class="bash hljs">gunicorn wsgi:app</code> </pre> <br><br>  If everything goes smoothly, then at <code>http://127.0.0.1:8000</code> will be a site that can be bolted to nginx or apache.  Next we configure systemd so that it starts automatically, and do not forget to change the line in the local_settings.py file: <br><br><pre> <code class="python hljs">DEBUG = <span class="hljs-keyword"><span class="hljs-keyword">True</span></span> <span class="hljs-comment"><span class="hljs-comment">#   False</span></span></code> </pre> </div><p>Source: <a href="https://habr.com/ru/post/349264/">https://habr.com/ru/post/349264/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../349252/index.html">Release Rust 1.24</a></li>
<li><a href="../349254/index.html">ITSM literacy program: Users and Customers - who is behind these names?</a></li>
<li><a href="../349256/index.html">Journal of the work with the network. Part 2</a></li>
<li><a href="../349260/index.html">Is it a bird? This is a plane? No, this is your user's token flying to a new phone.</a></li>
<li><a href="../349262/index.html">Simulation of dynamic systems: the problem of external ballistics</a></li>
<li><a href="../349266/index.html">PaEndpointBundle - an alternative to symfony controllers</a></li>
<li><a href="../349268/index.html">Issue # 11: IT training - current issues and challenges from leading companies</a></li>
<li><a href="../349270/index.html">Student Insider: Keyhole News</a></li>
<li><a href="../349272/index.html">Basic security practices for iOS applications</a></li>
<li><a href="../349274/index.html">"Calendar tester" for February. Know your customer</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>