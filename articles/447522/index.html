<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What is useful you can get out of the logs of the workstation based on Windows</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The user workstation is the most vulnerable spot of the infrastructure in terms of information security. Users may receive an email from a secure sour...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What is useful you can get out of the logs of the workstation based on Windows</h1><div class="post__text post__text-html js-mediator-article">  The user workstation is the most vulnerable spot of the infrastructure in terms of information security.  Users may receive an email from a secure source, but with a link to an infected site.  It is possible that someone will download a utility that is useful for work from an unknown place.  Yes, you can come up with more than a dozen cases, as through users of malware can be embedded in corporate resources.  Therefore, workstations require special attention, and in the article we will tell where and what events to take to track attacks. <br><br><img src="https://habrastorage.org/webt/n1/5h/lf/n15hlfq8b3n3ka64c-ahfco6ktm.png"><br><a name="habracut"></a><br>  To detect attacks at the earliest stage in Windows, there are three useful event sources: security event log, system monitoring log and Power Shell logs. <br><br><h2>  Security Event Log </h2><br>  This is the main storage location for system security logs.  This includes events for users to sign in / out, access to objects, changes in policies and other security related activities.  Of course, if the appropriate policy is configured. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/webt/_9/eg/ys/_9egysaz3btzcitbobp2gofmcu0.png"><br><br>  <b>Search of users and groups (events 4798 and 4799).</b>  Malicious software at the very beginning of the attack often enumerates local user accounts and local groups on a workstation to find credentials for their dark business.  These events will help detect malicious code before it moves on and, using the collected data, spread to other systems. <br><br>  <b>Creating a local account and changes in local groups (events 4720, 4722‚Äì4726, 4738, 4740, 4767, 4780, 4781, 4794, 5376 and 5377).</b>  An attack can also begin, for example, by adding a new user to the local administrators group. <br><br>  <b>Attempts to login with a local account (event 4624).</b>  Respectable users log in with a domain account and identifying the login under a local account can signify the start of an attack.  Event 4624 also includes entries under the domain account, so when processing events you need to filter events in which the domain is different from the name of the workstation. <br><br>  <b>Attempt to log in with the specified account (event 4648).</b>  This happens when a process runs in the Run as mode.  In the normal operation of the systems this should not be, therefore, such events should be controlled. <br><br>  <b>Lock / unlock the workstation (events 4800-4803).</b>  The category of suspicious events includes any actions that took place on a locked workstation. <br><br>  <b>Firewall configuration changes (events 4944-4958).</b>  Obviously, when installing a new software, the configuration of the firewall configuration may change, which will cause false positives.  To control such changes in most cases is not necessary, but knowing about them will definitely not be superfluous. <br><br>  <b>Connecting devices Plug'n'play (event 6416 and only for WIndows 10).</b>  It is important to keep an eye on this if users usually do not connect new devices to the workstation, and then suddenly once - and connected. <br><br>  Windows includes 9 audit categories and 50 subcategories for fine-tuning.  The minimum set of subcategories that should be included in the settings: <br><br>  <b>Logon / logoff</b> <br><br><ul><li>  Logon; </li><li>  Logoff; </li><li>  Account Lockout; </li><li>  Other Logon / Logoff Events. </li></ul><br>  <b>Account Management</b> <br><br><ul><li>  User Account Management; </li><li>  Security Group Management. </li></ul><br>  <b>Policy Change</b> <br><br><ul><li>  Audit Policy Change; </li><li>  Authentication Policy Change; </li><li>  Authorization Policy Change. </li></ul><br><h2>  System Monitor (Sysmon) </h2><br>  Sysmon is a Windows utility that can write events to the system log.  It is usually required to install it separately. <br><br><img src="https://habrastorage.org/webt/zt/e6/jg/zte6jgkrmzj6evy8vyojwcpo_fy.png"><br><br>  These same events can in principle be found in the security log (by including the required audit policy), but Sysmon gives more details.  What events can be taken from Sysmon? <br><br>  <b>Process creation (event ID 1).</b>  The system security event log can also tell when any * .exe is running and even show its name and startup path.  But unlike Sysmon will not be able to show the application hash.  Malicious software can even be called harmless notepad.exe, but it is the hash that will bring it to light. <br><br>  <b>Network connections (event ID 3).</b>  Obviously, there are a lot of network connections, and not to keep track of everyone.  But it is important to note that, unlike Security Log, Sysmon is able to bind the network connection to the ProcessID and ProcessGUID fields, shows the port and IP addresses of the source and destination. <br><br>  <b>Changes in the registry (event ID 12-14).</b>  The easiest way to add yourself to autostart is to register in the registry.  Security Log can do this, but Sysmon shows who made the changes, when, from where, the process ID and the previous key value. <br><br>  <b>File creation (event ID 11).</b>  Sysmon, unlike Security Log, will show not only the location of the file, but also its name.  It is clear that you will not follow everything, but you can also audit certain directories. <br><br>  And now what the Security Log policies do not have, but it is in Sysmon: <br><br>  <b>Change file creation time (event ID 2).</b>  Some malware can replace the date the file was created to hide it from reports with recently created files. <br><br>  <b>Download drivers and dynamic libraries (event ID 6-7).</b>  Tracking of loading into memory of DLL and device drivers, verification of digital signature and its validity. <br><br>  <b>Creating a thread in a running process (event ID 8).</b>  One type of attack, for which you also need to follow. <br><br>  <b>RawAccessRead events (event ID 9).</b>  Disk read operations with ‚Äú\\. \‚Äù.  In most cases, such activity should be considered abnormal. <br><br>  <b>Creating a named file stream (event ID 15).</b>  An event is registered when a named file stream is created that generates events with a hash of the contents of the file. <br><br>  <b>Creating named pipe and connections (event ID 17-18).</b>  Tracking malicious code that communicates with other components through a named pipe. <br><br>  <b>WMI Activity (event ID 19).</b>  Registration of events that are generated when accessing the system using the WMI protocol. <br><br>  To protect Sysmon itself, you need to track events with ID 4 (stop and start Sysmon) and ID 16 (change Sysmon configuration). <br><br><h2>  Power Shell Magazines </h2><br>  Power Shell is a powerful tool for managing Windows infrastructure, so chances are high that the attacker will choose him.  Two sources can be used to get data about Power Shell events: Windows PowerShell log and Microsoft-Windows PowerShell / Operational log. <br><br><h4>  Windows PowerShell log </h4><br><img src="https://habrastorage.org/webt/ao/zu/r3/aozur3ankpoqqckwf-x2af-ywza.png"><br><br>  <b>A data provider has been loaded (event ID 600).</b>  PowerShell providers are programs that serve as a data source for PowerShell to view and manage.  For example, embedded providers may be Windows environment variables or the system registry.  The emergence of new suppliers should be monitored in order to identify malicious activity in time.  For example, if you see that WSMan has appeared among the suppliers, it means that a remote PowerShell session has been started. <br><br><h4>  Microsoft-WindowsPowerShell / Operational log (or MicrosoftWindows-PowerShellCore / Operational in PowerShell 6) </h4><br><img src="https://habrastorage.org/webt/de/ga/ci/degaci8kfzznwue4ywft7w2zwk8.png"><br><br>  <b>Module logging (event ID 4103).</b>  The events store information about each command executed and the parameters with which it was called. <br><br>  <b>Logging script blocking (event ID 4104).</b>  Script Blocking Logging shows every executed block of PowerShell code.  Even if an attacker tries to hide a command, this type of event will actually show the executed PowerShell command.  Even in this type of event some low-level API calls can be executed, these events are usually recorded as Verbose, but if a suspicious command or script is used in a block of code, it will be recorded as Warning critical. <br><br>  Please note that after setting up the tool to collect and analyze these events, additional time will be needed for debugging to reduce the number of false positives. <br><br>  Tell us in the comments what logs are collected for the audit of information security and what tools for this use.  One of our areas is solutions for auditing information security events.  To solve the problem of collecting and analyzing logs, we can offer a closer look at <a href="https://www.quest.com/products/intrust/">Quest InTrust</a> , which can compress stored data by a factor of 20: 1, and one of its installed instances is capable of processing up to 60,000 events per second from 10,000 sources. </div><p>Source: <a href="https://habr.com/ru/post/447522/">https://habr.com/ru/post/447522/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../447502/index.html">How to create a resume for foreign it-companies</a></li>
<li><a href="../447508/index.html">Sergey Zonov: ‚ÄúI did the first Spectrum because I was interested‚Äù</a></li>
<li><a href="../447510/index.html">GeekUniversity opens a set of design faculty</a></li>
<li><a href="../447512/index.html">And who did this? We automate the audit of information security</a></li>
<li><a href="../447516/index.html">How we dispersed CAD KOMPAS-3D ‚Üí Part 2</a></li>
<li><a href="../447526/index.html">Your bike to sync MariaDB and Sphinx</a></li>
<li><a href="../447528/index.html">Who is responsible for the quality?</a></li>
<li><a href="../447530/index.html">OceanLotus: Malvari update for macOS</a></li>
<li><a href="../447536/index.html">IdM implementation. Preparation for implementation by the customer</a></li>
<li><a href="../447538/index.html">CUBA 7: what's new?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>