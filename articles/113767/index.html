<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Contract programming in Java using the Google COFOJA library</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="What is used for 

 This technique provides verification of preconditions and postconditions when executing methods of classes, user-defined functions...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Contract programming in Java using the Google COFOJA library</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/storage/habraeffect/68/22/68226a35316921c1254d5362f3d121e8.png" alt="image"><br><h4>  What is used for </h4><br><br>  This technique provides verification of preconditions and postconditions when executing methods of classes, user-defined functions. <br><br>  Like any other test, it allows you to increase the reliability of the program, ensuring the correctness of the data on the input and output.  Or, lower (if used incorrectly). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Unlike assertions, checks are performed at runtime, i.e., directly during program execution and are present in the release version. <br><br>  The essence of the method lies in the fact that with each subprogram, as it were, there is a ‚Äúcontract‚Äù to perform certain actions, i.e.  It sets restrictions (conditions) on the range of input and output data.  At the same time, the implementation of the "contract" (conditions) is tightly controlled. <br><br><a name="habracut"></a><br><br><h5>  Example </h5><br>  There is some class Time.  Suppose it is very important, and the functioning of the entire universe depends on its work ... <br><br>  The class has methods: getHours (), getMinutes (), getSeconds () and setHours (), setMinutes (), setSeconds (), respectively. <br><br>  We describe it (part of the language constructs and mechanisms is omitted or simplified for brevity): <br><br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> Time&lt;br&gt;{&lt;br&gt;    intHOURS;&lt;br&gt;    intMINUTES;&lt;br&gt;    intSECONDS;&lt;br&gt;&lt;br&gt;    getHours();&lt;br&gt;    {&lt;br&gt;        returnHOURS;&lt;br&gt;    }&lt;br&gt;    &lt;br&gt;    getMinutes();&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">return</font> MINUTES;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    getSeconds()&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">return</font> SECONDS;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    setHours(newHOURS);&lt;br&gt;    {&lt;br&gt;        HOURS = newHOURS;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    setMinutes(newMINUTES);&lt;br&gt;    {&lt;br&gt;        MINUTES = newMINUTES;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    setSeconds(newSECONDS)&lt;br&gt;    {&lt;br&gt;        SECONDS = newSECONDS;&lt;br&gt;    }&lt;br&gt;}&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  It is necessary to ensure that this class will return correct data, or it will not work at all (on the basis of the principle ‚ÄúDead programs do not lie‚Äù). <br><br>  How can I do that?  Verification of data for correctness. <br><br><h4>  Path 1: Collective Farm </h4><br><br>  For the sake of brevity, we omit some details and repeating constructions of the class Time. <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> Time&lt;br&gt;{&lt;br&gt;    getHours();&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">if</font> (HOURS&lt;0 ||HOURS&gt;23) &lt;br&gt; <font color="#0000ff">throw</font> GREAT_Time_Exception ;&lt;br&gt;&lt;br&gt; <font color="#0000ff">return</font> HOURS;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    setHours(newHOURS);&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">if</font> (newHOURS&lt;0 ||newHOURS&gt;23) &lt;br&gt; <font color="#0000ff">throw</font> GREAT_Time_Exception ;&lt;br&gt;&lt;br&gt;        HOURS = newHOURS;&lt;br&gt;    }&lt;br&gt;}</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>Disadvantages:</b> Non-obviousness of verification.  The need to write a bunch of code manually.  Just now, we tried to apply a contract programming technique.  But, this is PROVAAAAAAL!  Why?  We look further. <br><br><h4>  Path 2: Use a ready-made, elegant solution. </h4><br><br>  Java supports the annotation mechanism (recommendations to the compiler, preprocessor) - metadata that can be added to the program source code without affecting it semantically, i.e.  without changing his behavior.  At the same time, they can be used at the stage of code analysis, compilation and execution. <br><br>  Than some employees of the Google company (David Morgan, Andreas Leitner, Nhat Minh Le - "Contracts for Java 20% Team") used.  In their spare time, they developed the COFOJA annotation preprocessor library, which allows for implementing a contract-based programming methodology in Java. <br><br>  Let's try using it for our Time class: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@Contracted <font color="#008000">//   ,     ‚Äì    IDE</font> &lt;br&gt; <font color="#0000ff">class</font> Time&lt;br&gt;{&lt;br&gt;    @Ensures ({‚Äúresult &gt;= 0‚Äù,‚Äúresult &lt;= 23‚Äù })&lt;br&gt;    getHours();&lt;br&gt;    {&lt;br&gt; <font color="#0000ff">return</font> HOURS;&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    @Requires ({‚ÄúnewHOURS&gt;= 0‚Äù,‚ÄúnewHOURS&lt;= 23‚Äù })&lt;br&gt;    @Ensures (‚ÄúHOURS == newHOURS‚Äù)&lt;br&gt; <font color="#008000">// </font> &lt;br&gt; <font color="#008000">// @Ensures (‚ÄúgetHours()== newHOURS‚Äù)</font> &lt;br&gt;    setHours(newHOURS);&lt;br&gt;    {&lt;br&gt;        HOURS = newHOURS;&lt;br&gt;    }&lt;br&gt;}</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  <b>@Requires</b> - literally means, ‚ÄúTo make sure that BEFORE the subroutine is executed (‚Äú condition is fulfilled ‚Äù)‚Äù. Otherwise, throw an exception. <br><br>  <b>@Ensures</b> - literally means, ‚ÄúTo make sure that AFTER a subroutine is executed (‚Äú condition is fulfilled ‚Äù)‚Äù <br><br>  Here we see that, as in <b>Path1</b> , we check the preliminary and postconditions for our methods.  What is the difference?  The difference is that in the second case it is more obvious and convenient. <br><br>  In addition to these two options, there are quite a large number of libraries and tools that allow using this technique in JAVA, but they are either outdated and not supported / not developed, or not so convenient to use. <br><br><h4>  What the library consists of. </h4><br><br>  <b>com.google.java.contract. *</b> is the main namespace of the COFOJA library. <br><br>  It contains the implementation of the following annotations: <br><br><br>  <b>@Contracted</b> - a hint for the IDE, says that the class uses contracts. <br><br>  <b>@Invariant</b> - Invariants define the global properties of a certain class, which must be observed after its creation throughout its lifetime. <br><br>  <b>@Requires</b> - defines preconditions - what should be true BEFORE entering a method or function. <br><br>  <b>@Ensures</b> - defines postconditions - what should be true AFTER exiting a method or function. <br><br>  <b>@ThrowEnsures</b> - allows you to generate a specified exception when performing postconditions. <br><br><br><h5>  What to look for. </h5><br><br>  <b>@Ensures</b> and <b>@Requires</b> each method can have only one.  If you need to check several conditions, use the condition record in {}: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@Ensures    ( { ‚Äú1‚Äù, ‚Äú ‚Ä¶ ‚Äù, ‚ÄúN‚Äù } )&lt;br&gt;&lt;br&gt;@Requires    ( { ‚Äú1‚Äù, ‚Äú ‚Ä¶ ‚Äù, ‚ÄúN‚Äù } )&lt;br&gt;</font> &lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  If the contract is not observed (violation of the necessary conditions), the library throws a <b>PreconditionError</b> exception - a precondition error that can be caught and processed. <br><br>  Also, it is possible to generate your own exceptions when checking postconditions. <br>  The annotation <b>@ThrowEnsures is used</b> for this.  Its syntax is: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black">@ThrowEnsures    ({ <font color="#A31515">""</font> , <font color="#A31515">""</font> })&lt;br&gt;&lt;br&gt;@ThrowEnsures    ({&lt;br&gt; <font color="#A31515">"1"</font> , <font color="#A31515">"1"</font> ,&lt;br&gt;                    ...&lt;br&gt; <font color="#A31515">"N"</font> , <font color="#A31515">"N"</font> ,&lt;br&gt;                })</font> &lt;br&gt;&lt;br&gt; <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><br>  Contracts should not be used in order to check the data entered by the user for correctness - this is what the contracts were not intended for.  They should only be used between software modules.  Instead, implement validation of user input separately. <br><br><h4>  Configuring IDE for automatic work with contracts. </h4><br><br><h5>  Eclipse * </h5><br><br>  <b>Training:</b> <br><ol><li>  We download / extract in any available way (up to compilation from source codes) package <i>cofoja.jar</i> . </li><li>  We start <i>IDE Eclipse</i> , we create the new project. </li><li>  Copy the file <i>cofoja.jar</i> to the root folder of the project. </li></ol><br><br>  <b>Now we are going to configure the project:</b> <br><br><ol><li>  <i>Project -&gt; Properties-&gt; Java Build Path</i> , <i>Libraries</i> tab <i>-&gt; Add JARs</i> , in the appeared window select our file <i>cofoja.jar</i> </li><li>  At this point, the <i>Eclipse IDE</i> will begin to recognize contract annotations.  But that is not all.  You need to tell the <i>Eclipse IDE</i> that when compiling our project, you need to use the <b>EXTERNAL</b> preprocessor of annotations. <br><br>  To do this: go to the project menu <i>Project -&gt; Properties-&gt; Java Compiler-&gt; Annotation Processing</i> , put all the checkboxes, add <i>(key)</i> two keys <i>(Processor Options)</i> : <br><br>  <i>com.google.java.contract.classpath</i> - the absolute path to the file with the user annotation handler - <i>cofoja.jar</i> . <br>  <i>com.google.java.contract.classoutput</i> is the absolute path to the folder into which all classes of the project are compiled ( <i>bin</i> folder). <br><br>  <b>Example</b> : <br><br>  <i>com.google.java.contract.classpath = C: \ java \ eclipseWorkspace \ JavaContractsTest \ ccofoja.jar</i> <br>  <i>com.google.java.contract.classoutput = C: \ java \ eclipseWorkspace \ JavaContractsTest \ bin</i> <br><br>  In the <i>Factory Path</i> subcategory, we tick the <i>Enable Project Specific Settings</i> checkbox, then - <i>Add JARs</i> -&gt; select our <i>cofoja.jar</i> annotation <i>processor</i> . </li><li>  After that, when compiling the project, the external annotation processor that we just configured should be used.  But that is not all. </li><li>  It remains to add one parameter of the virtual machine to run our code with the verification of contracts.  To do this, in <i>Run Configurations -&gt; Arguments</i> in the <i>VM Arguments</i> field specify: <i>-javaagent: cofoja.jar</i> </li><li>  Format: </li><li>  ( <i>-javaagent: &lt;Contract_handle_file_name&gt; .jar</i> ) </li><li>  Is done.  You can start writing code.  After that, when compiling the project, errors in the annotations of contracts will be issued directly to the <i>IDE</i> . </li></ol><br><br><h5>  NetBeans * ** </h5><br><br><br>  <b>1.</b> Downloading / mining in any available way (up to compiling from source codes) package <i>cofoja.jar</i> . <br><br>  <b>2.</b> Launch <i>NetBeans IDE</i> , create a new project. <br><br>  <b>3.</b> Copy the file <i>cofoja.jar</i> to the root folder of the project. <br><br>  <b>4.</b> Now proceed to the configuration of the project. <br><br>  <b>a.</b>  <i>Project -&gt; Properties-&gt; Libraries</i> <br><br>  In the tabs <i>Compile, Processor, Run</i> add our file <i>cofoja.jar</i> (button <i>Add JARs</i> ) <br><br>  <b>b.</b>  Go to <i>Build -&gt; Compiling</i> <br><br>  Check the boxes for <i>Enable Annotation Processing, Enable Annotation Processing in Editor,</i> then click on the <i>Add</i> button, and add the following line: <i>com.google.java.contract.classpath</i> <br><br>  <b>c.</b>  Go to the <i>Run</i> tab <br>  Add the following to <i>VM Options</i> : <i>-javaagent: cofoja.jar</i> (the name of our contract-handler file) <br>  Format: <br>  ( <i>-javaagent: &lt;Contract_handle_file_name&gt; .jar</i> ) <br><br>  <b>d.</b>  Is done.  You can start writing code.  After that, when compiling the project, errors in the annotations of contracts will be issued directly to the <i>IDE</i> . <br><br><br><h5>  Javac - compile manually with annotations </h5><br><br><br>  <b>1.</b> Downloading / mining in any available way (up to compiling from source codes) package <i>cofoja.jar</i> . <br><br>  <b>2.</b> Put the file <i>cofoja.jar</i> in one folder with the classes that we are going to compile, or specify the full path to it. <br><br>  <b>3.</b> In the command line type: <i>javac -cp cofoja.jar MyClass.java</i> <br><br>  Compile.  Analyze error messages, if any, fix, re-compile. <br><br>  The <i>-cp</i> compiler <i>key</i> allows <i>you</i> to specify annotation preprocessor.  The following are the names of the files with the classes of your program. <br><br>  The syntax is: <br>  <i>javac -cp &lt;annotation_file_processor_name&gt; &lt;Class1.java&gt; &lt;ClassN.java&gt;</i> <br><br><br>  <b>* Note:</b> If after the done actions you encounter an error message, which says that it is impossible to find a compiler ( <i>JavaBuilder</i> ), add the <i>javac</i> compiler directory <i>(JDK \ bin) to the</i> <i>PATH</i> system variable.  After modifying this variable, it is necessary to reboot to make the changes take effect (for <i>Windows 2k / XP, Windows 7</i> doesn‚Äôt need it. <i>Linux</i> may have to be re-logged depending on the <i>shell</i> used). <br><br>  <b>** Note:</b> If there are no such menu items in your <i>NetBeans</i> , you may be using the old version.  In <i>NetBeans 6.9</i> , annotation support is definitely present ‚Äî download and use it. <br><br><h4>  Links </h4><br><ul><li>  [0] <a href="http://depositfiles.com/files/eoh5i634s">depositfiles.com/files/eoh5i634s</a> is the cofoja.jar annotation processor file that I used. </li><li>  [1] <a href="http://code.google.com/p/cofoja/">code.google.com/p/cofoja</a> is the official COFOJA project page on Google Code. </li><li>  [2] <a href="http://www.huoc.org/~minh/cofoja/">http://www.huoc.org/~minh/cofoja/</a> - here you can get compiled COFOJA packages </li><li>  [3] <a href="http://ru.wikipedia.org/wiki/%25D0%259A%25D0%25BE%25D0%25BD%25D1%2582%25D1%2580%25D0%25B0%25D0%25BA%25D1%2582%25D0%25BD%25D0%25BE%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25BE%25D0%25B3%25D1%2580%25D0%25B0%25D0%25BC%25D0%25BC%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25B0%25D0%25BD%25D0%25B8%25D0%25B5">en.wikipedia.org/wiki/Contract_programming</a> - Wikipedia page </li><li>  [4] <a href="http://fsteeg.com/2011/02/07/setting-up-contracts-for-java-in-eclipse/">fsteeg.com/2011/02/07/setting-up-contracts-for-java-in-eclipse</a> - the Fabian Steeg article in English on setting up the Eclipse IDE for working with contracts.  Description working.  But!  It should be remembered that you need to add to the PATH variable the path to the bin folder of your JDK. </li></ul></div><p>Source: <a href="https://habr.com/ru/post/113767/">https://habr.com/ru/post/113767/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../113759/index.html">Java / Python SDKs 1.4.2 have been released, and Roadmap has been updated.</a></li>
<li><a href="../113761/index.html">Geohot replied to Sony ... song</a></li>
<li><a href="../113763/index.html">I write in pseudocode, it works in PHP</a></li>
<li><a href="../113764/index.html">Review of Kopini in pictures</a></li>
<li><a href="../113766/index.html">"Locked in Las Vegas" - Phantom Flex shoots 2564 HD-frames per second</a></li>
<li><a href="../113768/index.html">Oracle Essbase - Integration Services Overview</a></li>
<li><a href="../113771/index.html">Tom should stay thin</a></li>
<li><a href="../113775/index.html">3D-smartphone, tablet and other news from LG in the video</a></li>
<li><a href="../113776/index.html">Communication of the future</a></li>
<li><a href="../113777/index.html">Need experts</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>