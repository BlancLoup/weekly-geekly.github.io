<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Minus one data analytics system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The number of analytics and data visualization systems necessary for everyday work has long exceeded all reasonable limits. With the advent of Firebas...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Minus one data analytics system</h1><div class="post__text post__text-html js-mediator-article">  The number of analytics and data visualization systems necessary for everyday work has long exceeded all reasonable limits.  With the advent of Firebase, their camp was replenished by one.  In this article we will explain how to make friends with Google‚Äôs mobile platform with another, more familiar analytics tool - Google Analytics.  The platform for experiments was our new product Tviggo (mobile application + a set of instant messenger bots for international calls via GSM - www tviggo. Net). <br><br><img src="https://habrastorage.org/files/bbc/c3c/fd4/bbcc3cfd402d449aa745315a9872a4de.jpg"><br><a name="habracut"></a><br>  As you know, Google Tag Manager (GTM) in December 2016 released an update - GTM V5 for iOS and Android, sharpened for work with Firebase.  At present, there are practically no real examples of use code for version 5, therefore, in addition to a rather meager parting word, you need to collect information bit by bit on the Quick Start page.  So, one of the important differences from v4 and earlier versions is the GTM initialization order.  Now the developer is not required to write any boilerplate of the initialization code and you need to forget about loadContainerPreferNonDefault.  At the same time, you can focus only on sending events to Firebase, while not forgetting to place a JSON file in the assets / containers with the base container version, which can be downloaded from GTM right after the first publication. <br><br>  Firebase can transmit any event name and parameters to GTM (in addition to all <a href="https://support.google.com/firebase/answer/6317485%3Fhl%3Dru">standard ones</a> that are automatically generated by the application) for collecting analytical data on the application. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Through GTM logic, these events can be broadcast to external systems, such as Google Analytics. <br>  To carry out such a manipulation, it is necessary in the code, in places that are critical for analytics control, to arrange the parameters for uploading data to Firebase (for example, sending the ‚ÄúStart‚Äù event with the parameters A = 1, B = 2). <br><br>  Next, in GTM, you need to create variables A and B, set up the configuration of the variable, then start a trigger (for example, ‚Äúlaunch application‚Äù), and create a tag (for example, as soon as Firebase triggers the Start event, you must upload the specified content to GA). <br><br>  Now visually and step by step: <br><br>  1. Set up a custom variable <br><br><img src="https://habrastorage.org/files/886/f41/f35/886f41f356b64faa875d6a2b8de2ec8f.png"><br><br>  2. Register the variable configuration <br><br><img src="https://habrastorage.org/files/12e/3d2/106/12e3d2106dbc4373896080dc2d07b0c5.png"><br><br>  3. Start the trigger <br><br><img src="https://habrastorage.org/files/0a6/abd/72b/0a6abd72b7a74448be695ee5226f8d9f.png"><br><br>  4. Create a tag <br><br><img src="https://habrastorage.org/files/9c4/633/6ff/9c46336ff2384ab69d83f31478b3b1c3.jpg"><br><br>  In the application code, we similarly describe the parameters and events generated in GTM in a convenient wrapper for further use: <br><br><pre><code class="hljs kotlin"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">TviggoAnalytics</span></span></span></span>(context: Context) { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> TviggoStart = Event(<span class="hljs-string"><span class="hljs-string">"TviggoStart"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">object</span></span> Params { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> call_uid = Param(<span class="hljs-string"><span class="hljs-string">"call_uid"</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> call_medium = Param(<span class="hljs-string"><span class="hljs-string">"call_medium"</span></span>) } <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> firebase: FirebaseAnalytics = FirebaseAnalytics.getInstance(context) <span class="hljs-keyword"><span class="hljs-keyword">inner</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Event</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String) { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Pair</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Param</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any?&gt;)</span></span></span></span> { push(HashMap&lt;Param, Any&gt;() + params) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(baseParams: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Param</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any?&gt;, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">vararg</span></span></span></span><span class="hljs-function"><span class="hljs-params"> params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Pair</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Param</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any?&gt;)</span></span></span></span> { push(baseParams + params) } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">push</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(params: </span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Map</span></span></span></span><span class="hljs-function"><span class="hljs-params">&lt;</span></span><span class="hljs-type"><span class="hljs-function"><span class="hljs-params"><span class="hljs-type">Param</span></span></span></span><span class="hljs-function"><span class="hljs-params">, Any?&gt;)</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> bundle = Bundle() params.forEach { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (it.value != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">when</span></span> (it.value) { <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> String -&gt; bundle.putString(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> String) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span> -&gt; bundle.putInt(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Int</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span> -&gt; bundle.putLong(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Long</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span> -&gt; bundle.putFloat(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Float</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Byte</span></span> -&gt; bundle.putByte(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Byte</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Short</span></span> -&gt; bundle.putShort(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Short</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span> -&gt; bundle.putDouble(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Double</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span> -&gt; bundle.putBoolean(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Boolean</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Char</span></span> -&gt; bundle.putChar(it.key.name, it.value <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> <span class="hljs-built_in"><span class="hljs-built_in">Char</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> -&gt; bundle.putString(it.key.name, it.value.toString()) } } } firebase.logEvent(name, bundle) } } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Param</span></span></span></span>(<span class="hljs-keyword"><span class="hljs-keyword">val</span></span> name: String) }</code> </pre> <br>  And further, for example, in the Application class, when creating an application instance, we prescribe sending events to Firebase with the Call ID parameter equal to 2. <br><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> analytics = TviggoAnalytics(applicationContext) <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">fun</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onCreate</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> { <span class="hljs-keyword"><span class="hljs-keyword">super</span></span>.onCreate() analytics.TviggoStart.push( TviggoAnalytics.Params.call_uid to <span class="hljs-number"><span class="hljs-number">2</span></span>, TviggoAnalytics.Params.call_medium to <span class="hljs-string"><span class="hljs-string">"GSM"</span></span> ) }</code> </pre><br><br>  The parameter ‚Äúcall identifier‚Äù is used for an example - in fact, there is still no call identifier at the time of launch. <br><br>  What we get in the end: <br><br>  1. Some action was performed in the application, a report on the implementation of which we see in GA, through the transformation of the original Firebase event through the Google Tag Manager container. <br><br><img src="https://habrastorage.org/files/976/7f9/684/9767f9684bc74fffa01f4deaee59ed83.png"><br><br>  2. If we analyze even deeper, we will see that the parameter we created with the value 2 is displayed in the Label (exactly as indicated in the tag). <br><br><img src="https://habrastorage.org/files/735/29e/bca/73529ebcac694db794294c91d12fe8e5.png"><br><br>  3. At the same time, all original events in the initial form are also loaded into Firebase. <br><br>  Thus, through GTM you get a mechanism that allows you to save analytics in any convenient system and analyze the entire stream of data coming from Firebase. <br><br>  Such a system allows you to quickly manage unloading in GA without rebuilding the application. <br><br>  I hope the explanation was clear and useful for the habro-community. <br><br>  <b>PS</b> Yes, our project is written in Kotlin, so the Android code will not look quite familiar, but I think you can do it :) <br><br>  We are happy to answer your questions! </div><p>Source: <a href="https://habr.com/ru/post/319504/">https://habr.com/ru/post/319504/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../319492/index.html">A simple and terrifying story about encryption</a></li>
<li><a href="../319496/index.html">100th edition of Digest MBLTdev - fresh for iOS developers</a></li>
<li><a href="../319498/index.html">IHS Markit study: 145 companies control 40% of the global data center market</a></li>
<li><a href="../319500/index.html">Redmine on MySQL with RocksDB is faster than with InnoDB, from 20% to 3 times</a></li>
<li><a href="../319502/index.html">Security Week 01-02: vulnerability in box.com, password phishing in PDF, attacks on MongoDB</a></li>
<li><a href="../319506/index.html">Linkedin recently redesigned and I intend to discuss it.</a></li>
<li><a href="../319510/index.html">Ref attributes and DOM in React</a></li>
<li><a href="../319512/index.html">Skype for Business plugin release and new build 3CX Client for Windows</a></li>
<li><a href="../319514/index.html">Translation of Nuxt.JS documentation</a></li>
<li><a href="../319516/index.html">My home data center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>