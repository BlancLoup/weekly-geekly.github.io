<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Photo and video files in the home collection - processing and storage</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Foreword 
 I think every amateur photographer like me has come up with the choice of the optimal way to process and store your photos. In this article...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Photo and video files in the home collection - processing and storage</h1><div class="post__text post__text-html js-mediator-article"><h5>  Foreword </h5><br>  I think every amateur photographer like me has come up with the choice of the optimal way to process and store your photos.  In this article I want to touch on this topic and offer my own version.  I really want to hear other uses. <br>  It so happened that it was comfortable for me to be and perform tasks in Linux-systems, therefore, all the Linux scripts.  But the axis is not the main thing, the main thing is the correct approach. <br><br><a name="habracut"></a>  I take pictures on an amateur SLR in RAW, then I translate everything into JPG, which are stored on the NAS along with the originals.  Everything is sorted by date, individual events are tagged for easy future search.  Also rented on videkameru in 1080p. <br>  The SD card from the camera / camcorder is inserted into the nettop on Linux, working around the clock, which is the main actor.  Further, through udev, the device name is assigned so that you can call the card in your own way and execute a script prepared in advance (for more details on creating udev rules, see <a href="http://www.reactivated.net/writing_udev_rules.html">here</a> ).  My version of the rules is as follows: <br>  $ cat /etc/udev/rules.d/81-local.rules <br><br><pre><code class="bash hljs">KERNEL==<span class="hljs-string"><span class="hljs-string">"sdb1"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span>, ATTR{size}==<span class="hljs-string"><span class="hljs-string">"63395840"</span></span>, NAME=<span class="hljs-string"><span class="hljs-string">"SDcard_camcorder"</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/usr/bin/zprocess_sd.sh"</span></span> KERNEL==<span class="hljs-string"><span class="hljs-string">"sdb1"</span></span>, SUBSYSTEM==<span class="hljs-string"><span class="hljs-string">"block"</span></span>, ATTR{size}==<span class="hljs-string"><span class="hljs-string">"7919616"</span></span>, NAME=<span class="hljs-string"><span class="hljs-string">"SDcard_camera"</span></span>, RUN+=<span class="hljs-string"><span class="hljs-string">"/usr/bin/zprocess_sd.sh"</span></span></code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I assign different names (NAME) to cards, depending on their size (ATTR {size}), after which the script (RUN) is launched.  Device parameters can be found using udevinfo or udevadm (depending on the distribution): <br> <code>udevadm info -a -p `udevadm info -q path -n /dev/sdb`</code> <br>  (instead of / dev / sdb put your device) <br>  When drawing up rules, <b>it is important to</b> unambiguously identify the device, otherwise the command specified after RUN + = will be launched more than once, which will introduce confusion. <br>  Udev runs a simple /usr/bin/zprocess.sh script that transfers information from the SD card and sorts: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/bash { sleep 10 su igor -c "/home/igor/scripts/move_from_sd.pl"; umount /dev/SDcard_cam*; su igor -c "/home/igor/scripts/sort.pl"; } &amp;</span></span></code> </pre> <br><br>  move_from_sd.pl moves the contents of the card to the to_sort folder on the NAS, writes to the log, sings five times at the end of the work - you can pull out the card: <br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; use File::Copy; use File::Find; my $today = `date +%F_%T`; my $logfile = "/mnt/tank/media/move_from_sd_$today.log"; my @mount_string = split /\s+/, `mount|grep -i sdcard`; my $to_sort_folder = "/mnt/tank/media/to_sort/"; open LOGFILE, "&gt;&gt;$logfile" or die "Cannot create logfile: $!"; select LOGFILE; if (defined $mount_string[2]) { print "SD card is mounted on $mount_string[2]\n"; find(\&amp;movefiles, $mount_string[2]); } else { print "SD card is not mounted!\n"; } sub movefiles { if (/(\.CR2$|\.MTS$)/) { print "Old file: $_\n"; my $newfile = $to_sort_folder . $_; print "New file: $newfile\nMoving file...\n"; if (-e $newfile) { $newfile = "$newfile"."_1"; move ($_, $newfile); print "Done! Had to rename to $newfile\n"; } elsif (move ($_, $newfile)) { print "Done!\n"; } else { print "moving $_ to $newfile failed: $!\n"; } } } `beep -D 300 -l 700 -r 5`;</span></span></code> </pre> <br><br>  With this script, I also drop AVCHD files from the camcorder.  Put your file types instead of CR2 and MTS.  I'm not a programmer, so do not rashly for the code. <br><br>  sort.pl sorts files into folders by date, month and year using exiftool: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; my $today = `date +%F_%T`; my $logfile = "/mnt/tank/media/sort_$today.log"; my $raw_video_dir = "/mnt/tank/media/AVCHD"; my $video_dir = "/mnt/tank/media/Videos"; my $raw_photo_dir = "/mnt/tank/media/RAW"; my $photo_dir = "/mnt/tank/media/Pictures"; my $to_sort_dir = "/mnt/tank/media/to_sort"; open LOGFILE, "&gt;&gt;$logfile" or die "Cannot create logfile: $!"; select LOGFILE; foreach (&lt;$to_sort_dir/*.MTS&gt;) { if (! /\d+_\d+\.MTS/) { print "Renaming file $_..\n"; `exiftool '-FileName&lt;DateTimeOriginal' -d %Y%m%d_%H%M%S%%-c.%%e $_`; } } foreach (&lt;$to_sort_dir/*.MTS&gt;) { chdir($raw_video_dir); print "Copying video file $_ into AVCHD ($raw_video_dir) folder..\n"; `exiftool -o . '-Directory&lt;DateTimeOriginal' -d %Y/%m/%d $_`; chdir($video_dir); print "Moving video file $_ into Videos ($video_dir) folder..\n"; `exiftool '-Directory&lt;DateTimeOriginal' -d %Y/%m/ $_`; } foreach (&lt;$to_sort_dir/*.CR2&gt;) { chdir($raw_photo_dir); print "Copying photo file $_ into RAW ($raw_photo_dir) folder..\n"; `exiftool -o . '-Directory&lt;DateTimeOriginal' -d %Y/%m/%d $_`; chdir($photo_dir); print "Moving photo file $_ into Pictures ($photo_dir) folder..\n"; `exiftool '-Directory&lt;DateTimeOriginal' -d %Y/%m/ $_`; }</span></span></code> </pre> <br><br>  First, I rename the files from the camcorder to YYYYMMDD_HHMMSS.  All originals from to_sort - RAW and AVCHD files - I copy in accordance with the date of the DateTimeOriginal snapshot per year / month / day, the RAW and AVCHD folders, respectively.  Then I move everything to the Pictures and Video folders in the same way, but in a year / month.  It turns out about the distribution of files in folders: <br>  -&gt; RAW -&gt; 2011 -&gt; 11 -&gt; 12 <br>  IMG1234.CR2 <br>  IMG1236.CR2 <br>  -&gt; AVCHD -&gt; 2011 -&gt; 11 -&gt; 10 <br>  20111110_112323.MTS <br>  -&gt; Pictures -&gt; 2011 -&gt; 11 <br>  IMG1234.CR2 <br>  IMG1236.CR2 <br>  -&gt; Videos -&gt; 2011--11 <br>  20111110_112323.MTS <br>  The conversion will be done inside the Pictures and Videos folders, but I will not touch the originals. <br><br><h5>  Conversion </h5><br>  The photo is converted in the Pictures folder.  I use <a href="http://www.rawtherapee.com/">RAWTherapee</a> for RAW processing. <br>  In the program settings there is ‚ÄúSave Processing Parameters next to file‚Äù, therefore after changing the RAW file the same file with pp3 extension appears, which is a conversion profile.  Conversion to JPG occurs 3 times a day across the krone by the following script, the RAW file itself is deleted upon completion: <br><br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#/usr/bin/perl use strict; use warnings; use File::Find; my $today = `date +%F_%T`; my $logfile = "/mnt/tank/media/raw_conversion_$today.log"; my $photo_dir = "/mnt/tank/media/Pictures/"; my $rt_path = "/home/igor/RawTherapee/rawtherapee"; open LOGFILE, "&gt;&gt;$logfile" or die "Cannot create logfile: $!"; select LOGFILE; find(\&amp;convert, $photo_dir); sub convert { if (/\.CR2$/) { print "----"x7 . "\n"; print "Converting $_ into jpeg..\n"; print (my $result = `$rt_path/rawtherapee -o . -S -j67 -c $_ 2&gt;&amp;1`); (my $picture = $_) =~ s/CR2/jpg/; my $pp3 = $_ . ".pp3"; if (-e "$picture") { unlink $_; unlink $pp3; } } }</span></span></code> </pre> <br><br>  The conversion itself is the <b>rawtherapee -o</b> command <b>.</b>  <b>-S -j67 -c</b> <br>  converting to JPG with compression 67 in the same directory (-o.), in batch mode (-c).  The -S option means that rawtherapee will skip the RAW file if there is no corresponding pp3 file (-S) (i.e., only viewed / modified RAW files).  You can set the -s flag and specify through -p the name of the profile that will be used for conversion. <br><br>  Video is converted in the Videos folder - all existing MTS files are converted to MKV using <a href="http://handbrake.fr/">HandBrakeCLI</a> .  Runs twice a day on the krone. <br><pre> <code class="perl hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/perl -w use strict; use File::Find; my $today = `date +%F_%T`; my $logfile = "/mnt/tank/media/mts_conversion_$today.log"; my $video_dir = "/mnt/tank/media/Videos"; open LOGFILE, "&gt;&gt;$logfile" or die "Cannot create logfile: $!"; select LOGFILE; find(\&amp;convert, $video_dir); sub convert { if (/MTS$/) { (my $outfile = $_) =~ s/MTS/mkv/; print "Converting $_ into $outfile ...\n"; `HandBrakeCLI -e x264 -q 20 -f mkv -i $_ -o $outfile`; unlink $_; } }</span></span></code> </pre> <br><br>  As a result, in the Pictures and Videos folders are JPG and MKV. <br>  Further viewing and rating, tagging and uploading to Picasa / Flickr is <a href="http://yorba.org/shotwell/">done</a> in <a href="http://yorba.org/shotwell/">Shotwell</a> . <br><br><h5>  Conclusion </h5><br>  In this way, I unloaded my working laptop, now all the conversion is done automatically on another host in the home network.  All my photos and videos are stored on NAS on RAID-6, so I don‚Äôt worry if anything happens to my laptop. <br>  As they say, Tim Towdy, so I will be glad to hear how you process and store your photo and video files, especially using the GNU / Linux OS. </div><p>Source: <a href="https://habr.com/ru/post/132492/">https://habr.com/ru/post/132492/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../132486/index.html">CPU</a></li>
<li><a href="../132487/index.html">Integrating MATLAB into C # .NET</a></li>
<li><a href="../132489/index.html">The experience of creating image loader</a></li>
<li><a href="../132490/index.html">Video player from scrap materials</a></li>
<li><a href="../132491/index.html">Google refused to remove popular MP3 Music Download Pro from Android Market</a></li>
<li><a href="../132493/index.html">Universal NMEA 0183 Parser / Formatter on C # (+ port on JAVA)</a></li>
<li><a href="../132494/index.html">Using drivers in CodeIgniter</a></li>
<li><a href="../132495/index.html">Building ffmpeg on CentOS 6.0 x64 for Web video mp4, webm, ogv</a></li>
<li><a href="../132498/index.html">Fear has big eyes, or HDD cloning with MAC OS and Win XP in the classroom</a></li>
<li><a href="../132499/index.html">Russian translation of the official PHP documentation has become available again!</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>