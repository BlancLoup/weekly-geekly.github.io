<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using drag-and-drop between different Activities in Android 7 Nougat</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this article I want to talk about the new ability to drag and drop data between different Activities in the joint display mode, which appeared with...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using drag-and-drop between different Activities in Android 7 Nougat</h1><div class="post__text post__text-html js-mediator-article">  In this article I want to talk about the new ability to drag and drop data between different Activities in the joint display mode, which appeared with the release of Android 7 Nougat.  Previously, data could only be dragged within one Activity. <br><a name="habracut"></a><br><h3>  Description of technology and analysis of the example </h3><br>  For data transfer while dragging, the ClipData and DragEvent classes are used.  In an application that initiates a drag and drop operation, the data is packed using ClipData.  ClipData is a complex type that contains one or more copies of the transmitted data.  ClipData is used to place data on the clipboard.  The following data types are available for dragging: <br><br><blockquote>  - MIMETYPE_TEXT_HTML: required to transfer HTML text; <br>  - MIMETYPE_TEXT_INTENT: required for transferring the intent; <br>  - MIMETYPE_TEXT_PLAIN: required for the transmission of plain text; <br>  - MIMETYPE_TEXT_URILIST: required for submitting a URL. </blockquote><br>  In the receiver application, a drag listener is installed on the corresponding interface element, which accepts DragEvent events. <br><br>  Let's look at an example of using the drag and drop function.  The example presents two applications: an initializer (DragNDropExample) and a drag receiver (DragNDropReceiver). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In order for an application to be displayed in multi-window mode, you need to set the following parameter in AndroidManifest in the Application or Activity section: <br><br><pre><code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">activity</span></span></span><span class="hljs-tag"> ‚Ä¶ </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">android:resizeableActivity</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"true"</span></span></span><span class="hljs-tag"> ‚Ä¶ &lt;/</span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">activity</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br>  DragNDropExample application implements dragging images and text.  The image file is stored in the Downloads folder.  When you drag an image to another process, the URI of the image file is transferred.  Initialization of dragging occurs by long pressing on the corresponding elements. <br><br><div style="text-align:center;"><img width="240" height="480" src="https://habrastorage.org/files/a0a/29a/b12/a0a29ab123bd402d88288d66c75a1412.png" alt="image"></div><br>  Install the listener long press. <br><br><pre> <code class="java hljs"> imageView.setOnLongClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnLongClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLongClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ File downloadFolder = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS); String[] filNames = downloadFolder.list();</code> </pre><br>  We get the file URI to pass to another process.  In the new version of Android, you need to use FileProvider to access files placed in multimedia folders. <br><br><pre> <code class="java hljs">Uri uri = FileProvider.getUriForFile(MainActivity.<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>, BuildConfig.APPLICATION_ID + <span class="hljs-string"><span class="hljs-string">".provider"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(downloadFolder, filNames[<span class="hljs-number"><span class="hljs-number">0</span></span>]));</code> </pre><br>  Create a ClipData object and package the URI into it.  When creating a ClipData object, the type of packed data is indicated.  The type MIMETYPE_TEXT_URILIST indicates that they are packaged. <br><br><pre> <code class="java hljs"> ClipData.Item item = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClipData.Item(uri); ClipData clip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClipData(<span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{ ClipDescription.MIMETYPE_TEXT_URILIST}, item);</code> </pre><br>  Initialize the drag by passing the ClipData object, the dragShadowBuilder object and setting the appropriate flags.  Flag View.DRAG_FLAG_GLOBAL allows dragging between operations.  The View.DRAG_FLAG_GLOBAL_URI_READ and View.DRAG_FLAG_GLOBAL_URI_WRITE flags allow reading and writing of URIs respectively.  DragShadowBuilder is used to create the shadow while dragging.  In this example, the shadow is the interface element itself: <br><br><pre> <code class="java hljs"> View.DragShadowBuilder dragShadowBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.DragShadowBuilder(view); imageView.startDragAndDrop(clip, dragShadowBuilder, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, View.DRAG_FLAG_GLOBAL | View.DRAG_FLAG_GLOBAL_URI_READ | View.DRAG_FLAG_GLOBAL_URI_WRITE); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } });</code> </pre> <br>  Everything is similar for dragging text: <br><br><pre> <code class="java hljs"> textView = (TextView) findViewById(R.id.text_view); textView.setOnLongClickListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnLongClickListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onLongClick</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View view)</span></span></span><span class="hljs-function"> </span></span>{ ClipData.Item item = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClipData.Item(textView.getText()); ClipData clip = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ClipData(<span class="hljs-string"><span class="hljs-string">"text"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> String[]{ ClipDescription.MIMETYPE_TEXT_PLAIN}, item); View.DragShadowBuilder dragShadowBuilder = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.DragShadowBuilder(view); textView.startDragAndDrop(clip, dragShadowBuilder, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, View.DRAG_FLAG_GLOBAL); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } });</code> </pre><br>  The OnDragListener listeners are installed in the receiver application: <br><br><pre> <code class="java hljs">imageView.setOnDragListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnDragListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, DragEvent event)</span></span></span><span class="hljs-function"> </span></span>{</code> </pre><br>  The listener defines actions for specific drag and drop events.  In this example, actions are set for the following events: <br><br>  - ACTION_DRAG_STARTED: dragging started; <br>  - ACTION_DROP: the user has released the dragged item. <br><br><pre> <code class="java hljs"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DragEvent.ACTION_DRAG_STARTED: Toast toast = Toast.makeText(getApplicationContext(), R.string.drop_started, Toast.LENGTH_SHORT); toast.show(); imageView.setBackgroundResource(R.color.grey_200); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DragEvent.ACTION_DROP: requestDragAndDropPermissions(event); ClipData.Item item = event.getClipData().getItemAt(<span class="hljs-number"><span class="hljs-number">0</span></span>);</code> </pre><br>  In order to insert an image made only in the ImageView, and the text in the TextView requires the appropriate verification.  In this section of the code, the type of the dragged data is checked and compared with the necessary one. <br><br><pre> <code class="java hljs"> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getClipDescription().getMimeType(<span class="hljs-number"><span class="hljs-number">0</span></span>).equals(MIMETYPE_TEXT_URILIST)) { Uri uri = item.getUri(); imageView.setImageURI(uri); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } });</code> </pre><br>  To drag and drop text, everything happens in a similar way. <br><br><pre> <code class="java hljs"> textView.setOnDragListener(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> View.OnDragListener() { <span class="hljs-meta"><span class="hljs-meta">@Override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">boolean</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">onDrag</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(View v, DragEvent event)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (event.getAction()) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DragEvent.ACTION_DRAG_STARTED: Toast toast = Toast.makeText(getApplicationContext(), R.string.drop_started, Toast.LENGTH_SHORT); toast.show(); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> DragEvent.ACTION_DROP: requestDragAndDropPermissions(event); ClipData.Item item = event.getClipData().getItemAt(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (event.getClipDescription().getMimeType(<span class="hljs-number"><span class="hljs-number">0</span></span>).equals(MIMETYPE_TEXT_PLAIN)) { CharSequence text = item.getText(); textView.setText(text); } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">true</span></span>; } });</code> </pre><br><h5>  Below are screenshots of the screen while dragging. </h5><br>  In the process of dragging an image: <br><br><div style="text-align:center;"><img width="240" height="480" src="https://habrastorage.org/files/c2c/958/837/c2c9588373db430299086ac083524c32.png" alt="image"></div><br>  After dragging text and image: <br><br><div style="text-align:center;"><img width="240" height="480" src="https://habrastorage.org/files/20c/e71/df3/20ce71df33bb4ca085b089da678ab7b8.png" alt="image"></div><br><h4>  Conclusion </h4><br>  The ability to drag and drop information between different processes allows you to speed up the exchange of data between applications, to make it more convenient and intuitive for the user. <br><br><h4>  Links </h4><br><ul><li>  1. Link to the official Google documentation on <a href="https://developer.android.com/guide/topics/ui/drag-drop.html">Drad-n-Drop</a> </li><li>  2. Link to official Google documentation on <a href="https://developer.android.com/guide/topics/ui/multi-window.html">Multi-Window Support</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/311250/">https://habr.com/ru/post/311250/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../311236/index.html">New NetApp Storage Systems Running ONTAP 9.1</a></li>
<li><a href="../311238/index.html">Google Photos can not delete files from the SD card</a></li>
<li><a href="../311240/index.html">Change the paradigm of decision making in the IT business or pity your liver</a></li>
<li><a href="../311242/index.html">Microsoft introduced Windows Defender Application Guard protection technology for the Edge web browser</a></li>
<li><a href="../311248/index.html">VIPER Book</a></li>
<li><a href="../311252/index.html">Applicants for the Nobel Prize 2016</a></li>
<li><a href="../311254/index.html">‚ÄúGoing onto the stage is my way of keeping up with the technologies‚Äù: interview with Baruh Sadogursky from JFrog</a></li>
<li><a href="../311256/index.html">Using a single IoC Container as part of an HTTP request between the Web API and the OWIN Middleware</a></li>
<li><a href="../311258/index.html">Raising the stakes: Who should get a share in your startup and which one?</a></li>
<li><a href="../311262/index.html">JSON serializer on fast templates</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>