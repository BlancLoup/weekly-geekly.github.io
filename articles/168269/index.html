<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The official edition of Age of Empires Collector's Edition on DVD uses online cracks.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The first parts of the game Age of Empires have long become a sort of classic. This game still has a lot of fans. In 2007, the official collector's ed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The official edition of Age of Empires Collector's Edition on DVD uses online cracks.</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/d8c/c7a/ce1/d8cc7ace1c64bbba732bb53f74cda840.jpg" alt="image" align="left">  The first parts of the game Age of Empires have long become a sort of classic.  This game still has a lot of fans.  In 2007, the official collector's edition of the game came out, which includes the first and second parts with additions.  And in all countries except the USA, it was released on one DVD instead of four CDs.  Then I was already doing a bit of <a href="http://habrahabr.ru/post/51857/">reverse-engineering of this game</a> and I knew that the original versions of executable files would not want to work with one common disk, because checking the label of the corresponding disk is protected in the code of each part and their additions.  Obviously, one DVD cannot have four different labels at once, and after buying a Russian DVD edition, I expected to see versions of files recompiled by developers with a modified disk check code or without it.  But everything turned out to be much more interesting. <br><a name="habracut"></a><br><h4>  All in the worst traditions of pirate anthologies: </h4><br><ul><li>  all stylized (original) installers with beautiful graphics are replaced with standard ones; </li><li>  part of the original music lies on the DVD in the form of an inaccurate rip with the file names of the form ‚Äú01-AudioTrack 01.wav‚Äù; </li><li>  during the game we don‚Äôt hear the original music - nobody told the game that the music should be taken from wav files and not from the Audio CD, as it was in the original version; </li><li>  after installing the latest official updates from the Microsoft website, the game does not recognize the DVD as native and refuses to run. </li></ul><br><h4>  Nobody was involved in adapting the game for the DVD edition! </h4><br>  Lost the source code?  Did not find a suitable developer for a couple of minor edits and compilation of a new executable file?  Or maybe a terrible bureaucracy at Microsoft, because of which even minor and easily fixable errors are <a href="http://habrahabr.ru/post/89763/">simply declared a</a> feature of the application architecture? <br><br>  All executable files are installed in decrypted form without <a href="http://ru.wikipedia.org/wiki/SafeDisc">SafeDisc</a> (copy protection), which was used on the original CD.  Ok, the publisher may well have the decrypted versions of executable files.  But then what about the disc label verification code? <br><br><h4>  As it turned out, the whole thing is in the crack! </h4><br>  Yes, all the facts indicate that the hacked versions of the executable files for this edition were taken from the Internet and ... a little bit edited, perhaps to hide this fact. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Consider this on the example of Age of Empires II: The Conquerors 1.0c.  Take the original encrypted executable file <a href="">age2_x1.icd</a> - the entire structure of the PE file is perfectly visible, and only some parts of the machine code are encrypted.  Using the well-known SafeDisc removal methods, we get the decrypted file <a href="">age2_x1.exe</a> .  Now we have a reference file.  Further, for research, we take the well-known NoCD network for this version of the game, apparently created in the depths of the already non-existent Berserkers clan based on the <a href="http://en.wikipedia.org/wiki/Myth_%2528warez%2529">Myth</a> patch at the end of 2001 ( <a href="">age2_x1_bsk.exe</a> ).  Also, from the DVD of the collector's edition, install the English version of The Conquerors (/AOE2CONQ/EN/setup.exe) and take the installed executable file of the game ( <a href="">age2_x1_dvd.exe</a> ). <br><br><h4>  So let's get down to research. </h4><br>  Compare files with each other.  The first is the difference in the description of the sections of the exe file: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d4a/350/891/d4a3508911532a05687b2b9ea20f9e69.png" alt="0001e0"><br><br>  As you know, the section names do not affect the execution of the program and are for informational purposes only.  However, usually compilers give all sections familiar names like ".code", ".data", etc.  But in the original executable file, some sections have atypical names "THIS_COD", "THIS_DAT" and "Inf32Dat".  Most likely, such specific section names are associated with the use of SafeDisc.  In the DVD file, these sections are renamed to the more familiar ‚Äú.code‚Äù, ‚Äú.data2‚Äù and ‚Äú.idata‚Äù, and it is obvious that manually - the extra characters are filled with spaces (code <code>20h</code> ), not zeros.  That is, clearly someone opened the executable file in the HEX editor and manually corrected the section names.  It is possible to make the executable file more typical. <br><br>  We also see that BSK left some service information for SafeDisc from the encrypted file age2_x1.icd before the start of the first section: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1d2/171/a5f/1d2171a5f666d28655f5aa7c364c4900.png" alt="000fc0"><br><br>  And at the end of the file: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/efa/fb9/902/efafb990273a82ef3e9edfa067d20dbe.png" alt="292ff0"><br><br>  This information is stored in insignificant parts of the file and is not used by the game.  As you can see, there is no service information in the DVD version, indicating that the file was previously protected by SafeDisc.  But at the end of each section there is one small lead: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/7da/7d0/0e2/7da7d00e2d2618926b50cf81f0e81657.png" alt="228fe8"><br><br>  After the SafeDisc decoder is working, a label appears in the form of a sequence of bytes <code>00 05 43 1F</code> at the end of each section.  In the source icd file there are zeros.  Since this is the end of the section, it also means nothing to the main program.  In the version of the file from BSK, we see that no one deleted them (they do not interfere - well, okay).  In the DVD version, we see that they also have not gone away. <br><br><h4>  Well, the most interesting thing is to compare the machine code. </h4><br>  Immediately we find a section of machine code that is responsible for checking for the presence of a CD: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/09d/fa4/f20/09dfa4f206742b851ed485cfcd9e743e.png" alt="0486b8"><br><br>  This function starts with an offset of <code>485A0h</code> and I already talked about it in an article about <a href="http://habrahabr.ru/post/51857/">modifying this game</a> .  It describes a rather complicated logic for checking the presence of a disk, but as a result, the function simply returns 0 in case of failure and 1 in case of success.  I suggested for the patch to replace the code of all this healthy function with a simple sequence, always returning 1: <br><br><pre> <code class="hljs perl"><span class="hljs-keyword"><span class="hljs-keyword">xor</span></span> eax, eax inc eax retn <span class="hljs-number"><span class="hljs-number">4</span></span></code> </pre><br>  But BSK approached the case with a soul.  A trained eye and without disassembling sees that they replaced a pair of conditional transitions <code>jz (74h)</code> and <code>jnz (75h)</code> with unconditional <code>jmp (EBh)</code> and many more :) And if you disassemble this section, you can trace a small miscalculation of the cracker from BSK - if the registry will not write to the drive letter where the game is installed from - the code will return 0, and the game will require you to insert a disk. <br><br>  And now the most important thing is that in the executable file installed from the official DVD collection, the entire machine code is up to the byte version from BSK, including (a surprise for AoC fans) several other strange code patches, which seem to be not related to the disk check in general ( this has yet to be resolved): <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2dd/021/044/2dd0210444f8d5c5fe52138a81cd5860.png" alt="0ff230"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/11a/c73/777/11ac73777516278d3dd278c96cdadc64.png" alt="1eb2c0"><br><br><img src="https://habrastorage.org/getpro/habr/post_images/f05/f48/794/f05f487940f5c8879405da1f8fe0e02c.png" alt="281038"><br><br>  That is, there is no doubt that the patched file from BSK was based on the executable file for the collector's edition.  Speaking strictly, it simply removed the remnants of service information for SafeDisc and changed the names of the sections. <br><br><h4>  And finally </h4><br>  I want to note that I have only the <a href="http://www.nd.ru/prod.asp%3Frazd%3Ddescr%26prod%3Dageofempiresplatinum">official Russian edition</a> from ‚ÄúNew Disc‚Äù in my hands.  But there is every reason to believe that in <a href="http://www.mobygames.com/game/windows/age-of-empires-collectors-edition/cover-art">other collection editions the</a> problem of incompatibility of games with DVD is solved in a similar way. <br><br>  With this post, I just wanted to emphasize the whole comic situation, when even the official publisher is forced to use the cracks created as ‚Äúbad uncles‚Äù for ‚Äúbad purposes‚Äù. <br>  By the way, yes, all files are provided for informational purposes.  After studying them you must remove them. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/168269/">https://habr.com/ru/post/168269/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../168259/index.html">Lecture videos of the entire course of the first Yandex Interface Development School</a></li>
<li><a href="../168261/index.html">API based IT job opener widget</a></li>
<li><a href="../168263/index.html">Reminiscence - an elegant platformer for Windows Phone</a></li>
<li><a href="../168265/index.html">Kotlin M5 released</a></li>
<li><a href="../168267/index.html">Secrets of fast coding in WebStorm</a></li>
<li><a href="../168271/index.html">Guest from the Future - Integrated Graphics (Intel GPU) in Intel Haswell</a></li>
<li><a href="../168273/index.html">HINT.css - CSS tooltips</a></li>
<li><a href="../168277/index.html">Spices for beginners cooks</a></li>
<li><a href="../168279/index.html">Organization of power and low-current wiring in office premises</a></li>
<li><a href="../168281/index.html">Steganography: bottomless containers and reusable keys</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>