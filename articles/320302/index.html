<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Creating an encrypted Kali Linux Encrypted Persistence flash drive</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This article describes the method of creating a bootable flash drive with Kali Linux system, the functionality of which allows you to create an encryp...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Creating an encrypted Kali Linux Encrypted Persistence flash drive</h1><div class="post__text post__text-html js-mediator-article">  This article describes the method of creating a bootable flash drive with Kali Linux system, the functionality of which allows you to create an encrypted partition where all its parameters, installed programs and data will be stored.  Encryption is performed using the 256-bit key aes algorithm (you can customize encryption by studying the cryptsetup command). <br><br><h2>  1. Creating a bootable flash drive </h2><br>  To record the image, use the program <b>Rufus</b> .  Select the device on which the image will be unpacked, then select the system iso-image and select the DD-image from the drop-down list. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/00c/86a/7ec/00c86a7ecc731d3d5db7488429a33abd.jpg" alt="image"></div><br>  After the image is deployed, the partition structure of the flash drive will look as follows: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/getpro/habr/post_images/724/af3/ab7/724af3ab784992c3cd0935aab24db6d7.jpg" alt="image"><br><a name="habracut"></a><br>  Section structure: <br><br>  - 2.80 GB - Kali Linux system image; <br>  - 102 MB - bootloader; <br>  - 11.42 GB - unallocated area to be used for encryption. <br><br><h2>  2. Creating an encrypted partition and setting its parameters </h2><br>  Boot from the flash drive and select the <b>Live</b> menu item <b>(686-pae)</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/3dc/187/9b0/3dc1879b063e7743bb71e4cf4046a193.jpg" alt="image"></div><br>  Start the terminal and execute the <b>gparted</b> command to start the partition editor. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/a34/bd8/ac4/a34bd8ac42490bc619e52b7ec346214d.jpg" alt="image"><br><br>  In the window that opens, select the USB flash drive from the drop-down list. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/abb/363/2ef/abb3632ef36e7a97a7930bd0b29c1e9c.jpg" alt="image"><br><br>  Next, select unallocated disk space and create a new partition (ext4). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/998/e97/a94/998e97a94555d33c655431443398df77.jpg" alt="image"><br><br>  After creating the partition, open the terminal and run the command <b>fdisk ‚Äìl |</b>  <b>grep / dev /</b> to display available devices.  We are interested in the device <b>/ dev / sdb3</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/50e/908/49f/50e90849f596cdcc24dca1ffe8ece996.jpg" alt="image"></div><br>  To encrypt the partition, enter the <b>cryptsetup --verbose --verify-passphrase luksFormat / dev / sdb3 command</b> , then enter <b>YES</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/763/c04/fe6/763c04fe63aaf8be1dc6f11081aa1cc1.jpg" alt="image"></div><br>  After that, the program will require you to enter a password, under which the section will be encrypted and will offer to confirm it. <br><br>  Connect the encrypted partition <b>using the</b> command <b>cryptsetup luksOpen / dev / sdb3 usb_part_open</b> , enter the password.  The partition is initialized as a device named <b>usb_part_open</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/2f9/02c/886/2f902c8868af7500d1575658a0de0c17.jpg" alt="image"></div><br>  Run the <b>fdisk ‚Äìl |</b>  <b>grep / dev /</b> and make sure the device <b>/ dev / mapper / usb_part_open is</b> connected. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/914/7d6/9d9/9147d69d9ce02bd87b6e3180cc8afae1.jpg" alt="image"></div><br>  Fill the device with random, pseudo-random numbers or zeros by executing one of the commands at your discretion: <br><br>  - <b>dd if = / dev / random of = / dev / mapper / usb_part_open</b> - this command will fill the device with random numbers.  The operation will be performed for a long time (count in days); <br><br>  - <b>dd if = / dev / urandom of = / dev / mapper / usb_part_open</b> - this command will fill the device with pseudo-random numbers.  The operation will be performed for a long time (count in hours); <br><br>  - <b>dd if = / dev / zero of = / dev / mapper / usb_part_open</b> - filling with zeros. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/93d/a81/f4d/93da81f4dcc5b2b506007a87f1cdc48f.jpg" alt="image"></div><br>  Format the randomly-filled partition with the <b>mkfs.ext4 / dev / mapper / usb_part_open command</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/dc4/698/82d/dc469882dc2cc804fbdc5dc3f749407d.jpg" alt="image"></div><br>  Name the section <b>‚Äúpersistence‚Äù with the</b> command <b>e2label / dev / mapper / usb_part_open persistence</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/315/28b/2d7/31528b2d7d07597be0e61126140e3ac2.jpg" alt="image"></div><br>  Mount this partition to a previously created folder, for example, <b>/ mnt / usb_part</b> with <b>mount / dev / mapper / usb_part_open / mnt / usb_part</b> (usually in new versions of the system, this command is not required, the partition is automatically connected after formatting and is defined in Explorer). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1c5/6e7/69d/1c56e769d1d36eaa55f08391d5ca85e5.jpg" alt="image"></div><br>  Create a configuration file in the root of the encrypted partition <b>using the echo ‚Äú/ union‚Äù&gt; /mnt/usb_part/persistence.conf command</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/e66/277/08b/e6627708bab273a66bf9ad89ac4e60ca.jpg" alt="image"></div><br>  Close the encrypted partition with the <b>cryptsetup</b> command <b>luksClose / dev / mapper / usb_part_open</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/669/e02/dcb/669e02dcb1d63cd9ad2acf950334ce67.jpg" alt="image"></div><br>  Reboot the system and log in to <b>Live USB Encrypted Persistence</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/1ea/94e/cca/1ea94ecca4930429acece0509611dfa3.jpg" alt="image"></div><br>  When downloading, you will need to enter the password from the encrypted partition (when entering the password, the characters are not displayed). <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/4f3/723/00b/4f372300b0764b289dfe62260d933d44.jpg" alt="image"></div><br>  Creating an encrypted system is complete. <br><br><h2>  3. Functional check </h2><br>  When you first boot the OS in <b>Encrypted Persistence</b> mode, system files and folders are created on the encrypted partition, to view them follow these steps: <br><br>  - Restart the system in unencrypted <b>Live</b> mode <b>(686-pae)</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/b5f/327/5c9/b5f3275c9e532054876f4deceb075bbf.jpg" alt="image"></div><br>  - mount the encrypted partition as a device using the command <b>cryptsetup luksOpen / dev / sdb3 usb_part_open</b> . <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/d30/aaf/600/d30aaf60049b859dc39cac1ac336ef5a.jpg" alt="image"></div><br>  - Open the explorer and select the connected <b>persistence</b> device.  You will see the previously created persistence.conf configuration file and system folders.  In the <b>rw</b> folder is our encrypted system, under which we boot.  Therefore, in the rw folder, all changes made to the system loaded in encrypted mode are saved. <br><br>  If you boot in normal (unencrypted) mode, after the reboot, all changes and files are deleted. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/83f/875/8be/83f8758bee34533760871c583609715e.jpg" alt="image"></div><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/320302/">https://habr.com/ru/post/320302/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../320292/index.html">How I created a SaaS service that brings me $ 1000 a month</a></li>
<li><a href="../320294/index.html">Migrant workers from Siberia. Or how we built a quest in Slovakia in 4.5 days</a></li>
<li><a href="../320296/index.html">How designers manage luck in games</a></li>
<li><a href="../320298/index.html">The book "To work with the head. Patterns of success from IT-specialist "</a></li>
<li><a href="../320300/index.html">How we created a hosting provider with our own data center</a></li>
<li><a href="../320304/index.html">RGB color model history</a></li>
<li><a href="../320306/index.html">Async / await is a step back for javascript?</a></li>
<li><a href="../320308/index.html">It's time to play fair, Microsoft</a></li>
<li><a href="../320310/index.html">JunOS update on EX4500 switches in VirtualChassis - what could go wrong? Part 2</a></li>
<li><a href="../320314/index.html">Technotrack: from college to leading IT-companies</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>