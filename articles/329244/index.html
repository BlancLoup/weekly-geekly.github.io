<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>What addresses do we see in traceroute</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hey. This is a short note about exactly what IP we see in your favorite tracert / traceroute, and how it depends on the label on the boxes in the hard...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>What addresses do we see in traceroute</h1><div class="post__text post__text-html js-mediator-article">  Hey.  This is a short note about exactly what IP we see in your favorite tracert / traceroute, and how it depends on the label on the boxes in the hardware of your ISP and its upstream. <br><br>  I think everyone knows that the router, as a rule, has multiple IP addresses (or at least more than 1).  In the face of such diversity, the router is faced with a difficult choice: which of its IP addresses must be chosen as the source of the ICMP TTL Exceeded message, which is the basis for the trace output? <br><br>  If you have never thought about this issue before, then here are some options that may come to mind first: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      1. The IP address of the interface that was inbound for the original packet. <br>  2. The IP address of the interface that should be outgoing for the original packet. <br>  3. The IP address of the interface that will be outgoing for the ICMP message. <br>  4. Lupback IP address. <br><br>  If you still thought about this before, then do not rush to give a definite answer :) <br><a name="habracut"></a><br>  To answer the question from the title of the publication, I put together such a lab in GNS3: <br><br><img src="https://habrastorage.org/web/bd7/d86/81e/bd7d8681e75f4d2a9d9488bf7c567ca5.png"><br><br>  Some explanations for the topology: <br><br>  1. Tracing will be done from PC1 to PC2. <br>  2. Each router has a loopback type XXXX <br>  3. OSPF Area 0 is running on all routers and all interfaces. <br>  4. OSPF Interface Cost is distributed in such a way that traffic from any router to 60.0.0.0/24 (PC2 network) goes ‚Äúvertically‚Äù, i.e.  through the chain of remaining routers.  Conversely, traffic up to 10.0.0.0/24 (PC1 network) from any router other than Cisco1 will go through SW1 (which corresponds to the network 123.0.0.0/24).  Thus, we achieve a situation in which the incoming interface of the original packet and the outgoing interface of the ICMP message do not match. <br><br>  <b>Someone will say:</b> why do we need such a far from reality topology, in my company all traffic goes in both directions strictly symmetrically. <br><br>  <b>Answer:</b> For OSPF, this is really not the most typical situation, it was used solely to simplify the configuration.  In reality, BGP is mainly responsible for the asymmetry of your traffic paths. <br><br><h3>  Run tracing </h3><br><img src="https://habrastorage.org/web/4c2/33b/3dc/4c233b3dccfb4dc7aebd2b9d97b81358.png"><br><br>  As you can see, Cisco and Juniper responded from the IP of the incoming interface, whereas Debian Linux and Mikrotik (having the same Linux in the roots of their operating system) responded from the IP interface that was outgoing for the ICMP packet (123.0.0.X). <br><br>  Record Route for comparison: <br><br><img src="https://habrastorage.org/web/926/8e2/ddd/9268e2ddded34df8847ed7b2356b6159.png"><br><br><h3>  Conclusion </h3><br>  The behavior of Linux and Mikrotik is explained in the <a href="https://tools.ietf.org/html/rfc1812">RFC 1812</a> clause.  This clause indicates that the source address of the ICMP message must be the address of the interface through which the ICMP packet is to be sent. <br><br>  At the same time, industry giants such as Cisco and Juniper allow themselves to ignore the RFC directive, apparently relying on their not a lot of experience.  Indeed, to observe in the trace the IP addresses of the interfaces through which the original packet must pass, in my opinion, seems to be a better solution than to detect in the same IP trace from subnets that, strictly speaking, have no direct relationship to the actual packet path. </div><p>Source: <a href="https://habr.com/ru/post/329244/">https://habr.com/ru/post/329244/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../329234/index.html">8 skills required in the profession of Data Scientist</a></li>
<li><a href="../329236/index.html">Games and gameplay: different types of players</a></li>
<li><a href="../329238/index.html">We do GraphQL API on PHP and MySQL. Part 2: Mutations, Variables, Validation and Security</a></li>
<li><a href="../329240/index.html">JSF 2 + Maven + Jetty. Training</a></li>
<li><a href="../329242/index.html">Avoiding Hell with Monads</a></li>
<li><a href="../329246/index.html">Loading real landscapes in unity 3d</a></li>
<li><a href="../329248/index.html">Clever blocking bypass in Ukraine</a></li>
<li><a href="../329250/index.html">Artists map, awkward search for links in the data and how to reinvent the wheel</a></li>
<li><a href="../329252/index.html">Golos - study in practice. First conclusions</a></li>
<li><a href="../329254/index.html">Passing type map to function</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>