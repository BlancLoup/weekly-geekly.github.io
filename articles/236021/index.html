<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Analysis of rendering through Skia Debugger: how to find the most expensive elements to draw</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, I recently solved the problem of slowing down scrolling on the Mail.Ru Mail pages. Especially this problem was noticeable on retina-displays...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Analysis of rendering through Skia Debugger: how to find the most expensive elements to draw</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/132/6cc/b6a/1326ccb6a13c4b3eb8e72d5b4872b306.png" hspace="8" vspace="8" align="left">  Good day, I recently solved the problem of slowing down scrolling on the Mail.Ru Mail pages.  Especially this problem was noticeable on retina-displays.  After a simple analysis, I came to the conclusion that one of the main problems is slow page rendering. <br><br>  In this article, I‚Äôll tell you how you can use the Skia Debugger tool included in the Chrome toolkit for step-by-step analysis of the page rendering process, as well as how it can be used to get data on how long it takes to draw each element. <br><br>  Like many such optimization problems, this problem can be solved in many ways.  I took up the optimization of rendering, as it took a significant amount of time.  Thus, I could quickly get a performance boost and, accordingly, improve the smoothness of the scroll by speeding up the rendering. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="http://habrahabr.ru/company/mailru/blog/236021/"><img src="https://habrastorage.org/files/133/e28/4d6/133e284d6c2c4a77b5743f1aa7d71a78.png"></a> <br><a name="habracut"></a><br>  In the beginning, I decided to see how long it takes to render the page.  To do this, you can use the <b>devtools</b> ‚ÄúEnable continuos page repainting‚Äù setting.  This option causes the browser to constantly redraw the page without any user action.  In this mode, the panel also displays the page rendering time.  About this and other features <b>devtools</b> perfectly described in <a href="http://habrahabr.ru/post/173141/">this</a> article, so I will not focus on it.  Let me just say that after taking measurements, it turned out that the analyzed page on the retine is rendered for about <b>100 milliseconds</b> , which creates a slowdown when the page is scrolled.  The data that I can see when recording the timing in <b>devtools</b> was not very informative, since it contained only the time to render the whole page, and I had to find the culprit of the problems. <br><br><img src="https://habrastorage.org/files/153/dd4/e13/153dd4e130534a688e6b0b005207b796.png" hspace="8" vspace="8" align="left">  Therefore, I began to search for which component of the browser is responsible for rendering, and which logs will be able to help me understand what is slowing down.  I started by studying this <a href="http://habrahabr.ru/post/173141/">article</a> and the <b>Chromium</b> <a href="http://www.chromium.org/developers/design-documents">architecture</a> , which is available in the public domain and is not conceptually different from the <b>Chrome</b> architecture. <br><br>  In these articles I was interested in what component is responsible for rendering and what logs it provides.  From the chapters describing the graphic components, I learned that basically all the work lies with the Skia library.  To my joy, the Skia Debugger debugger was developed for it, which, judging by the screenshots on the project site, was necessary for me.  But, unfortunately, installing it was a nontrivial task for me (it was necessary to build the debugger itself and rebuild Chrome). <br><br>  Searching some more, I found a link to <a href="http://www.youtube.com/watch%3Fv%3DbMZZOzuJCgk">this</a> video.  From it, I learned that this debugger was built into <b>Chrome Canary</b> , and you can use it by running the browser with the <b>--enable-skia-benchmarking</b> option, on a Mac you can do this with the following command: <br> <code>/Applications/Google\ Chrome\ Canary.app/Contents/MacOS/Google\ Chrome\ Canary --enable-skia-benchmarking</code> <br> <br>  Starting the browser with this parameter, go to <i>chrome: // tracing</i> .  You should see the following tab: <br><br><img src="https://habrastorage.org/files/cdb/a78/806/cdba788065e146c29c2e15c28c40cf6d.png"><br><br>  Open another tab with the page that we want to analyze.  In my case, it was the mailing list page.  Go back to the <i>chrome: // tracing</i> tab and click Record, the popup should open.  In it you need to select the item ‚ÄúFrame Viewer‚Äù from the list and click on Record.  After that, the recording will begin, and you can perform any actions on the analyzed tab, I recommend keeping open no more than one tab, since the recording buffer is very limited, and a relatively small piece of data fits into it. <br><br>  Once you have completed the actions you are interested in, go back to the tracing tab and click Stop.  After that, you will construct a diagram containing information about what happened in the system during recording.  All data is grouped by browser processes.  I am interested in the process with a list of messages, it is easy to find by the title.  In this process, we look at the section ss :: Picture, in which the circles display the final images rendered by the browser. <br><br><img src="https://habrastorage.org/files/f92/862/1f2/f928621f269848e9b71223568a9e458c.png"><br><br>  Find among them one that contains the entire page.  Now a window with a picture of the page is displayed at the bottom of the screen.  In the upper right corner, a diagram is displayed that shows how much total time each drawing function takes.  On the left, the timeline is displayed with the sequence of drawing the page elements and the time spent on each of them. <br><br><img src="https://habrastorage.org/files/f08/8cb/cee/f088cbcee153444796c63ab7e03ee7c2.png"><br><br>  Scrolling through the timeline, I found that the main culprit of such a long page rendering is the container of the list of messages with a shadow.  This element takes about 45% of the total page rendering time. <br><br><img src="https://habrastorage.org/files/ddb/531/995/ddb531995a5f4cb7ac77413c4b09e228.png"><br><br>  After I replaced <b>box-shadow</b> with a regular <b>border</b> and re-recorded the page, I saw that the amount of time for drawing had decreased from 45% to 6.5%, and also that another Skia function was used now. <br><br><img src="https://habrastorage.org/files/7c4/f1c/7ee/7c4f1c7eeab84ed48127bd57738fe90d.png"><br><br><img src="https://habrastorage.org/files/064/490/462/06449046247144e7b76da07a98c7b7c2.png" hspace="8" vspace="8" align="left">  Acceleration of rendering was also confirmed after viewing the optimized page in the ‚ÄúEnable continuos page repainting‚Äù mode. <br><br>  To many, it may seem that the problem with box-shadow was obvious, and it could be found by simply changing the styles on the pages through devtools.  But in this article I wanted to talk about how to use alternative tools.  How can they be used to understand the sequence in which elements are drawn on a page and how long it takes. <br><br>  This tool has a lot of great opportunities that I did not describe in the article, because they are beautifully described in the video I mentioned earlier. <br><br>  Understanding the processes occurring in the browser is a very important knowledge that is necessary for the effective optimization of web applications.  But optimization also requires tools that will allow us to measure the acceleration that this or that optimization has given, as well as to understand the cause of the problem. <br><br>  <i>"If we are talking about performance, there can be no" probably. "</i>  <i>Without measuring performance, you just won‚Äôt be able to find out if your changes helped or hurt the program. ‚Äù</i> <br>  Steve McConel "Perfect Code" 2nd.  edition, p. 579 "Code Optimization Strategies" <br><br>  Determining the most difficult to draw elements is an important step in optimizing a web application.  The knowledge gained about new features in Chrome will help not only to debug and find the bottlenecks of rendering, but also to understand how any of the components of the page affect the whole process of rendering the stream as a whole.  I will try to tell about other features of this tool in the following articles. <br><br><h1>  Links </h1><ul><li>  <a href="https://docs.google.com/document/d/13FAQ9ckY7RDihv6aW5ehz15Pm2aheQFR7cY6FPdBmIQ/edit">Draft with description of Skia Debugger implementation in chrome: // tracing</a> </li><li>  <a href="http://www.chromium.org/developers/design-documents/graphics-and-skia">A document describing the architecture of drawing graphics in Chromium</a> </li><li>  <a href="http://archrometects.files.wordpress.com/2009/10/assignment-01-conceptual-architecture-of-google-chrome-archrometects.pdf">Chrome Conceptual Architecture (2009)</a> </li><li>  <a href="https://github.com/google/skia">Skia project repository</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/236021/">https://habr.com/ru/post/236021/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../236003/index.html">Accelerator QIWI Universe. Start</a></li>
<li><a href="../236005/index.html">The history of the evolution of the office</a></li>
<li><a href="../236007/index.html">1,000,000 already broken passwords are publicly available. How we protect users of Yandex</a></li>
<li><a href="../236009/index.html">Startup Country</a></li>
<li><a href="../236011/index.html">Reprinting books from the New Science series</a></li>
<li><a href="../236023/index.html">Fujitsu Improves Protection and Quality Management of Disk Arrays</a></li>
<li><a href="../236027/index.html">Marketing: what is not taught in school</a></li>
<li><a href="../236029/index.html">Client-server work with tabular data for beginners</a></li>
<li><a href="../236031/index.html">Group order of printed circuit boards - myths and reality</a></li>
<li><a href="../236033/index.html">The third annual Russian AI Cup championship has begun.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>