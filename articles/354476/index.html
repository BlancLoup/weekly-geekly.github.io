<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PDF generation for downloading server configs</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="There is a wonderful project hiqpdf . 

 Can html quality in pdf or convert pictures 

 But by default it does not take into account the fact that js ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PDF generation for downloading server configs</h1><div class="post__text post__text-html js-mediator-article">  There is a <a href="http://www.hiqpdf.com/demo/ConvertHtmlToPdf.aspx">wonderful project hiqpdf</a> . <br><br>  Can html quality in pdf or convert pictures <br><br>  But by default it does not take into account the fact that js / iframe can be inserted into html, which can be used for other purposes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Well, without any hesitation I tried it on their own website. <br><a name="habracut"></a><br>  Here so in the browser console iframes <br><br><pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> str = <span class="hljs-string"><span class="hljs-string">""</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">8000</span></span>; i &lt;= <span class="hljs-number"><span class="hljs-number">9000</span></span>; i++) { str += <span class="hljs-string"><span class="hljs-string">"#"</span></span> + i; str += <span class="hljs-string"><span class="hljs-string">"&lt;iframe src='http://localhost:"</span></span> + i + <span class="hljs-string"><span class="hljs-string">"' height='60' width='300'&gt;&lt;/iframe&gt;&lt;br/&gt;"</span></span>; } str;</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">It turned out something like this</b> <div class="spoiler_text"><img src="https://habrastorage.org/webt/ih/dg/np/ihdgnpesa7pnov43iehlqi1nf1m.png"><br></div></div><br>  Here is such a self port of ports. <br><br>  I found a splash (of course, nmap is also easy to find and even more <i>-p [8000-9000] -T4 -A -v hiqpdf.com</i> , but this is more interesting). <br><br><img src="https://habrastorage.org/webt/ms/d0/ro/msd0roue_dgs004at2mlkxdym-e.png"><br><br>  But it didn‚Äôt work out with them quickly, because at the end I‚Äôll demonstrate vulnerability by the example of other guys, and to understand the mechanics of the process I made <a href="https://github.com/SanSYS/FailPdfDemo">my own small demo</a> . <br><br>  There is api on .net, which simply gives a string and all + there is code that can generate pdf on this server.  The code is taken directly from hiqpdf.com, without unnecessary gestures. <br><br><img src="https://habrastorage.org/webt/jd/5l/vi/jd5lvimngzcinuu0qyfwzim99ju.png"><br><br>  Now 4 iframe <a href="http://localhost/api/def/get">localhost / api / def / get</a> <br><br><img src="https://habrastorage.org/webt/of/l1/jj/ofl1jjidmu-kc2fodynez2ojis8.png"><br><br>  Ok, check that this is exactly .net on Windows <br><br>  <a href="http://localhost/api/con.aspx">localhost / api / con.aspx</a> - if not up to date, files named con / aux and others are prohibited for Windows.  Feet grow <a href="https://blogs.msdn.microsoft.com/oldnewthing/20031022-00/%3Fp%3D42073">from the antiquities of the dos</a> when they were specific devices. <br><br>  For example - I like the <a href="https://dotnetfiddle.net/">site</a> very much, especially if I have only a phone at hand, and I want to type some code: <br><br>  <a href="">dotnetfiddle.net/con1.asmx</a> - processed error and the corresponding 404 page <br>  <a href="">dotnetfiddle.net/con.asmx</a> - this is not the fate before the managed code in the pool is reachable <br>  <a href="https://dotnetfiddle.net/con.txt">dotnetfiddle.net/con.txt</a> - and this is the way to get to the directory (Physical Path E: \ sitesroot \ 0 \ con.txt) <br><br><img src="https://habrastorage.org/webt/mt/sz/dq/mtszdqofu2plejgba10wochovos.png"><br><br>  In fact, without a clue why I need a version, in theory, it can help if there is an old one and you know zero-day vulnerabilities for them.  Lan, now the most interesting thing is to find out the directory, by localhost my 404 errors are not closed and I get them as they are. <br><br><img src="https://habrastorage.org/webt/0k/jy/fl/0kjyflghvw8mdshmiainhkxlzi8.png"><br><br>  Since this is a site on .net - the web.config file is in the root: <br><br><img src="https://habrastorage.org/webt/de/hf/zf/dehfzff-yue4zaugfk__6qne0l4.png"><br><br>  Actually, it was a lightweight demo. <br><br>  And now on the real data (someone's food, they have already covered the shop;) <br><br><img src="https://habrastorage.org/webt/st/tv/cm/sttvcmzbwzswsg_gkliv6o3zff0.png"><br><br>  Oh, there the section is included from the file connections.config, conveniently, outside the box, downloads perfectly: <br><br><img src="https://habrastorage.org/webt/7b/mv/c5/7bmvc5jcnu5nlzlordduszpovdy.png"><br><br>  And some more data: <br><br><img src="https://habrastorage.org/webt/9d/sm/-c/9dsm-cwq6tvphnfdag5tu1gk_di.png"><br><br>  I think everything is clear here and there is no point in continuing to pour screenshots. <br>  Sorry the whole database is closed outside. <br>  And from JS, I don‚Äôt know how to do that (yes, there you can use not only the iframe, but also js). <br><br>  Immediately make a reservation - hiqpdf has nothing to do with it, the problem of the configuration of the application, the code to send to print pdf data (if you know that there will be html clearly, then you need to do htmlencode), as well as any other lib, for example, the standard WebBrowser component can also. <br><br>  Actually a continuation - it turns out that some people like not PDF, not even HTML, but an image, say png.  And they use the WebBrowser component to get a picture (they kindly shared a piece of code with me, but asked not to disclose the name of the product where it is used). <br><br>  Essence - you can write js, which was executed in the default System.Windows.Forms.WebBrowser component: <br><br><img src="https://habrastorage.org/webt/d-/nq/fo/d-nqfoj9smuaggwintiefednniy.png"><br><br><div class="spoiler">  <b class="spoiler_title">Here is the source</b> <div class="spoiler_text"><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (WebBrowser br = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WebBrowser()) { AutoResetEvent loadingWaiter = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> AutoResetEvent(<span class="hljs-literal"><span class="hljs-literal">false</span></span>); br.AllowNavigation = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; br.ScrollBarsEnabled = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; br.ScriptErrorsSuppressed = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; br.DocumentText = <span class="hljs-string"><span class="hljs-string">"0"</span></span>; br.Width = <span class="hljs-number"><span class="hljs-number">1024</span></span>; br.Document.OpenNew(<span class="hljs-literal"><span class="hljs-literal">true</span></span>); br.Document.Write(htmlCode); br.Refresh(); br.DocumentCompleted += (a, b) =&gt; loadingWaiter.Set(); loadingWaiter.WaitOne(<span class="hljs-number"><span class="hljs-number">590</span></span>); br.Height = (<span class="hljs-keyword"><span class="hljs-keyword">int</span></span>)(br.Document.Body.ScrollRectangle.Height * scale + <span class="hljs-number"><span class="hljs-number">1</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> (Bitmap bmp = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Bitmap(br.Width, br.Height)) { br.DrawToBitmap(bmp, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Rectangle(<span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, br.Width, br.Height)); bmp.Save(stream, ImageFormat.Png); } }</code> </pre> <br></div></div><br>  I cannot say anything about his insanity, because I was not interested in the problem of creating an arbitrary image from html. <br><br>  At the time of discovery, it was enough to send 1k requests to the API (yes, it happened on IIS and alerts, as I understand it, if there were, then on the same server, if, of course, log in under the account from which the pool is running). <br><br>  How to edit it - WebBrowser is IE and you need to disable it on the windows JS server.  In my experience this is by default, and I was very lucky that it turned out differently. <br><br>  But it sucks and in a good way - of course you can‚Äôt insert data into such components as it is.  If you know that you use a similar component, and the client can contain control characters - they need to be escaped. <br><br>  For HTML / JS, <a href="https://referencesource.microsoft.com/">HtmlEncode is sufficient</a> . <br><br>  But if that, then HiqPdf through <i>htmlToPdfConverter.RunJavaScript = false</i> perfectly knows how to <i>disable</i> JS. <br><br>  All this is not as impressive <a href="https://habr.com/post/353504/">as last time</a> , but, as you can see, it can also help in retrieving server configs. </div><p>Source: <a href="https://habr.com/ru/post/354476/">https://habr.com/ru/post/354476/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../354464/index.html">Interfaces in the real world-4: updates to the traditional pieces</a></li>
<li><a href="../354466/index.html">How to improve the quality of their work</a></li>
<li><a href="../354468/index.html">Automating log downloads from Kibana to Redmine</a></li>
<li><a href="../354472/index.html">Backup telegram</a></li>
<li><a href="../354474/index.html">Splunk 7.1. What's new? New web interface, integration with Apache Kafka and much more ...</a></li>
<li><a href="../354478/index.html">When computers were people ...</a></li>
<li><a href="../354480/index.html">Bobaos - KNX TP / UART, Raspberry Pi and Apple HomeKit</a></li>
<li><a href="../354484/index.html">Block the entire Internet, or a monkey with a grenade</a></li>
<li><a href="../354486/index.html">Apache Kafka - my summary</a></li>
<li><a href="../354488/index.html">As an entrepreneur to submit reports on the simplified taxation system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>