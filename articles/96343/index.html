<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Nuances and algorithms of programming engine for online marketing research</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Good day, dear habravchane. It has long been tempting me to write such a manual, and now, I decided to force myself to sit down and write it - to shar...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Nuances and algorithms of programming engine for online marketing research</h1><div class="post__text post__text-html js-mediator-article">  Good day, dear habravchane.  It has long been tempting me to write such a manual, and now, I decided to force myself to sit down and write it - to share some experience that I gained during my programming research in the field of marketing and about some algorithms embedded in the engine, on which more than one project was implemented. <a name="habracut"></a><br><br>  It would seem that what could be simpler than the TZ in the form of a spiked Word questionnaire for 30-40 questions, which the customer wants to see in the programmed form in the window of his browser, and he also gives four whole days to everything?  As my friend used to say, until he began working with me: <br><br>  - Yes, there is something for about four hours!  I sat down in the morning, and by the evening everything was ready and tested.  I do not understand why you are kolupaetsya ... 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But everything, unfortunately, is far from being as simple as he imagined, and he programmed his first questionnaire in the next job for two days (followed by a twist for two or three days), constantly receiving new and new comments by phone and email.  And the point is not in reassessing one's capabilities or professional insolvency (and comrade, I must say, with a rich experience of website builder), but in the field itself, which is very specific and has its pitfalls and subtle points.  Just about some of these pitfalls and fine points, as well as how to avoid them, I would like to tell. <br><br><h4>  ‚ÄúI want red, but blue‚Äù or code modifiability </h4><br>  I don‚Äôt know why it happened, but for some reason in marketing, customers like to change their application requirements several times a day.  Apparently, this is due to the internal organization, where the left hand does not always know what the right hand is doing and, at times, wants a completely different one.  But this is not the essence, but the essence is that it all turns into a programmer‚Äôs headache (by the way, there was a case not so long ago when the final version of the CATI questionnaire was listed as ‚ÄúV.13.3_final_final‚Äù, and this is after the approval ‚Äú final "TZ). <br><br>  The idea of ‚Äã‚Äãcreating an engine that would ease the work, shortened the development time and minimized the influence of the human factor on possible errors, came somewhere after the fourth questionnaire and it was decided to program the engine immediately and for centuries.  The basis was a naive idea of ‚Äã‚Äãthe possibility of ‚Äúprogramming‚Äù questionnaires without knowing this very programming and the ease of modifying existing projects. <br><br>  The idea was, in essence, not so bad, but the key role was played by the lack of resources for implementation (man-hours) and the wrong approach: it was assumed that the questionnaire would be an Excel file whose columns would be responsible for certain commands for module constructor: <br><ul><li>  The sequence number of the question </li><li>  Question code </li><li>  Possible answers </li><li>  Unique answer codes </li><li>  Themselves answers </li><li>  Type of question (checkbox, radio, text and mixed) </li><li>  Terms of question </li><li>  Stop polling conditions </li><li>  Additional function calls </li></ul><br>  Resolved - done.  But the first pancake, as usual, lumpy ... <br><br><h4>  Failure theory </h4><br>  The engine was tested on small projects, but after the sixth or seventh, it became clear that the chosen path of development was a dead end due to the immensely growing functionality.  It got to the point that I and my partner, the developers, themselves have already become confused about what functionality is laid.  The reasons: <br><ul><li>  There are a lot of possible options for the types of questions presented on the page (as well as their combinations) and each project is somewhat unique (i.e., the customer‚Äôs imagination plays a strong role) </li><li>  The logic of the survey, sometimes, is extremely strained and its description in the cells of Excel'a poured into crazy indigestible formulas </li></ul><br>  There were other, but secondary reasons. <br><br>  The solution was to create a wizard, which would form a template of a future questionnaire in the form of a ‚Äúsurvey-response‚Äù, and the template would later be brought to mind in the built-in editor.  But all this is a new man-clock, endless code modifications, constant updates and ... as a result, a kind of Frankenstein monster.  So it was decided to abandon this approach. <br><br>  The ideas of writing an internal scripting language, programming a C ++ daemon (due to wider possibilities), a parser for Word documents (written in a certain format), and many others were considered.  But all of them were swept away either because of their absurdity, or because of the complexity of implementation.  It was necessary to find some simple, but at the same time, a flexible solution ... <br><br><h4>  Problem statement and solution </h4><br>  A competent formulation of the problem is, if not a pledge, then a good help on the way to the successful realization of the idea. <br><br>  Having already had enough experience in programming online research and faced with a bunch of pitfalls and nuances in this business, I identified several key (in my opinion) points that the system had to answer: <br><ul><li>  Ability to connect various designs and change them "on the fly" </li><li>  Maximum acceleration of the programming process </li><li>  Ease of writing and modifying logic </li><li>  Fast extensibility of functionality </li><li>  Stability of work at high loads </li><li>  Using the file system to store data </li></ul><br>  Also, in order to minimize possible difficulties, it was decided to follow a few simple rules: <br><ul><li>  Take out the logic in a separate file </li><li>  Each question is also placed in a separate file. </li><li>  Check the correctness of filling on the client side </li><li>  To check the completion of all required fields, use js-functions that are minimally dependent on the structure of a specific question. </li><li>  Use structured programming </li></ul><br>  As a result, the output was not a monolithic engine, but a complex from a module that displays questions to the user, as well as js and php libraries of functions. <br><br>  It is time to paint in more detail some of the points I mentioned above: <br><br>  <b>Ability to connect various designs and change them "on the fly"</b> <br><br>  Customers often require the use of their own design in marketing research, even if they order the research itself from a third-party company.  This is especially true for brands or when a link to the questionnaire is posted on the client‚Äôs site (to create the impression that the user has not left the site). <br><br>  Because  the overwhelming majority of polls saw one common point - information changes only in one area, the solution was to use two php functions: initialize the main variables when loading the questionnaire and display the necessary data in a div.  It looks like this: <br><pre> <code class="hljs erlang-repl">&lt;?php session_start(); include(<span class="hljs-string"><span class="hljs-string">'./php/funcs.php'</span></span>); //    if (!$_SESSION[<span class="hljs-string"><span class="hljs-string">'user_ID'</span></span>]){ //         $user_id = md5(date(<span class="hljs-string"><span class="hljs-string">'ymd H:i:s'</span></span>).rand()); $_SESSION[<span class="hljs-string"><span class="hljs-string">'user_ID'</span></span>] = $user_id; $_SESSION[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] = setUserPosition($user_id); //      ,            ( <span class="hljs-string"><span class="hljs-string">"start"</span></span>) } else { $_SESSION[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] = setUserPosition($_SESSION[<span class="hljs-string"><span class="hljs-string">'user_ID'</span></span>]); //   ,        ,        } ?&gt; ... // html- &lt;div id=<span class="hljs-string"><span class="hljs-string">"workDiv"</span></span> class=<span class="hljs-string"><span class="hljs-string">"workDiv"</span></span> &gt; &lt;?php showQuest($_SESSION[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>]); // ,      div' ?&gt; &lt;/div&gt; ... // html-    (<span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>, <span class="hljs-string"><span class="hljs-string">""</span></span>) &lt;input type=<span class="hljs-string"><span class="hljs-string">"button"</span></span> style=<span class="hljs-string"><span class="hljs-string">"width: 75px;"</span></span> id=<span class="hljs-string"><span class="hljs-string">"backBtn"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"request('back');"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> style=<span class="hljs-string"><span class="hljs-string">"width: 75px;"</span></span> id=<span class="hljs-string"><span class="hljs-string">"submitBtn"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"request('forvard');"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; &lt;input type=<span class="hljs-string"><span class="hljs-string">"submit"</span></span> style=<span class="hljs-string"><span class="hljs-string">"width: 75px; display: none;"</span></span> id=<span class="hljs-string"><span class="hljs-string">"endBtn"</span></span> onclick=<span class="hljs-string"><span class="hljs-string">"endOfSurvey();"</span></span> value=<span class="hljs-string"><span class="hljs-string">""</span></span>&gt; <br></code> </pre> <code>&lt;?php session_start(); include('./php/funcs.php'); //    if (!$_SESSION['user_ID']){ //         $user_id = md5(date('ymd H:i:s').rand()); $_SESSION['user_ID'] = $user_id; $_SESSION['user_position'] = setUserPosition($user_id); //      ,            ( "start") } else { $_SESSION['user_position'] = setUserPosition($_SESSION['user_ID']); //   ,        ,        } ?&gt; ... // html- &lt;div id="workDiv" class="workDiv" &gt; &lt;?php showQuest($_SESSION['user_position']); // ,      div' ?&gt; &lt;/div&gt; ... // html-    ("", "", "") &lt;input type="button" style="width: 75px;" id="backBtn" onclick="request('back');" value=""&gt; &lt;input type="submit" style="width: 75px;" id="submitBtn" onclick="request('forvard');" value=""&gt; &lt;input type="submit" style="width: 75px; display: none;" id="endBtn" onclick="endOfSurvey();" value=""&gt; <br></code> <br>  This is enough to meet the requirements of 3/4 of all possible variations of polls.  For the remaining 1/4, nothing prevents you from adding a couple of tags / functions. <br><br>  The problem with the design change is solved. <br><br>  <b>Maximum acceleration of the programming process</b> <br><br>  Due to the fact that everything is implemented in the form of a set of functions and the main tasks of data exchange with the server and their interpretation are solved and are on the engine, programming the questionnaires themselves is reduced to writing a file with logic, writing a js-script of correspondences to which question what kind of check and semi-automatically create question templates in the following form: <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"form"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"post"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span>  :<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">b</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"radio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Z0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Z0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"textAssociationDiv"</span></span></span><span class="hljs-tag"> &gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"radio"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Z0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Z0"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">class</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"textAssociationDiv"</span></span></span><span class="hljs-tag"> &gt;</span></span>  <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">div</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">br</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">form</span></span></span><span class="hljs-tag">&gt;</span></span> <br></code> </pre> <code>&lt;form name="form" method="post"&gt; &lt;b&gt;  :&lt;/b&gt; &lt;br /&gt;&lt;br /&gt; &lt;input type="radio" name="Z0" id="Z0" value="1" /&gt; &lt;div class="textAssociationDiv" &gt;  &lt;/div&gt; &lt;br /&gt; &lt;input type="radio" name="Z0" id="Z0" value="2" /&gt; &lt;div class="textAssociationDiv" &gt;  &lt;/div&gt; &lt;br /&gt; &lt;/form&gt; <br></code> <br><br>  There are several divs in the code with the class ‚ÄútextAssociationDiv‚Äù - this is used to associate a click on the text, like on a certain checkbox or radio button.  If anyone is interested, here is the code of the js-function that does this: <br><pre> <code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">associateTextToElement</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ $(<span class="hljs-string"><span class="hljs-string">".textAssociationDiv"</span></span>).click(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.forms[<span class="hljs-string"><span class="hljs-string">'form'</span></span>].elements[$(<span class="hljs-string"><span class="hljs-string">".textAssociationDiv"</span></span>).index($(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>)[<span class="hljs-number"><span class="hljs-number">0</span></span>])].click();}); } <br></code> </pre> <code>function associateTextToElement(){ $(".textAssociationDiv").click(function(){document.forms['form'].elements[$(".textAssociationDiv").index($(this)[0])].click();}); } <br></code> <br>  Also, the code uses the same id, since  This simplifies the analysis of page elements if more than one question is displayed on it.  If it is necessary to display a question of the type of small-set (multiple choice), then the names and id take the following form: S9.1, S9.2, S9.3, S9.4, S9.5, S9.97, where the digit after the point - response code. <br><br>  When the user clicks the ‚ÄúNext‚Äù or ‚ÄúBack‚Äù buttons, javascript collects all the entered data and Ajax sends them to the php script in the following format: variable_code = value.  The variable code is taken from the id of the element, because they are the same in single-questions, and different in multi-sets - it is so easy.  The script, receiving them by the POST method (it is important to hide such information from the user), writes them to a log file with the name stored in $ _SESSION ['user_ID']. <br><br>  <b>Using the file system to store data</b> <br><br>  There were several reasons for refusing to use the database, the main of which was the need to quickly add / remove variables in the survey process.  Also, this approach solved the difficulties with the number of fields in the user response table when using MySQL (the total number of different variables in some studies sometimes reached one and a half to two thousand). <br><br>  When using the same file system, all difficulties disappeared, because  Absolutely all the data that was sent to the server was recorded in the corresponding file log.  And in order to add several new answers, simply add a couple of lines with the necessary input'ami to the appropriate question file and ... wahl - all the data is saved, and the time spent on it was only a few seconds.  For ease of interpretation of logs, both computer and human, they have the following format: <br><br>  userID = 1cb3761177ec8846fe8ae35392017e36 <br>  userIP = 192.168.1.34 <br>  startTime = 04/19/10 12:50:21 <br>  S4 = 33 <br>  S5 = 3 <br>  S9_8 = 8 // so the small-set sets are recorded (S9.8, S9.10, etc.) <br><br>  <b>Bringing logic to a separate file</b> <br><br>  The problem with the recording of logic was solved by itself, when it was decided that the programmer was programming the questionnaire, and the manager only gave the TK ‚Äî that is,  you do not need to ‚Äúsimplify‚Äù someone‚Äôs life with a visual editor / wizard (complicating the life of a programmer), and the person with an idea of ‚Äã‚Äãjs and php will work with the engine and libraries.  Even it was not necessary to reinvent the wheel - when analyzing tons of implemented projects, it was noted that ‚Äúdirect‚Äù logic can satisfy all customer needs and to implement branching of any complexity, just a couple of functions, two variables, and an if operator are enough: <br><br><ul><li>  <b>$ _SESSION ['user_ID']</b> - contains the user ID, it is also the name of its log file </li><li>  <b>$ _SESSION ['user_position']</b> - contains the question code that the user has just answered </li><li>  <b>checkAnswer ($ qCode, array (1, 2, 3))</b> - checks in the log the presence of a record qCode = array [0], qCode = array [1] or qCode = array [n], where $ qCode is the question code (for example, " S12 "), and array contains the desired values, and since  in multi-sets, the response index in the question variable after the point always corresponds to the response code, then using the "_n = n" autosubstitution to the question code (where n is the answer option), we get the string that we are looking for in the file - if there is one, so this answer was given </li><li>  <b>checkQuotas ($ qCode)</b> - checks the quotas for the question code that the user has just answered (since the quotas are coherent and disconnected, the function has different implementations and for each project the quotas are programmed separately) </li></ul><br><br>  If we take into account the fact that in online questionnaires the polling vector always goes in one direction, and there are only two possible branching options from the computer point of view (either a condition has passed or not), then all the logic is simplified to the limit and reduces to the following format (php ): <br><pre> <code class="hljs bash"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] == <span class="hljs-string"><span class="hljs-string">'S9'</span></span> &amp;&amp; checkAnswer(<span class="hljs-string"><span class="hljs-string">'S9'</span></span>,1)){ //    S9     1-  <span class="hljs-variable"><span class="hljs-variable">$question_contents</span></span> = file_get_contents(<span class="hljs-string"><span class="hljs-string">'../qst/Z6.php'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> iconv(<span class="hljs-string"><span class="hljs-string">"cp1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-variable"><span class="hljs-variable">$question_contents</span></span>); //include_once(<span class="hljs-string"><span class="hljs-string">'../qst/Z6.php'</span></span>); //<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> iconv(<span class="hljs-string"><span class="hljs-string">"cp1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, showQuest()); <span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] = <span class="hljs-string"><span class="hljs-string">'Z6'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>; } //   ,      php (,            ) <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] == <span class="hljs-string"><span class="hljs-string">'A1'</span></span>){ //    A1 //<span class="hljs-variable"><span class="hljs-variable">$question_contents</span></span> = file_get_contents(<span class="hljs-string"><span class="hljs-string">'../qst/A3.php'</span></span>); //<span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> iconv(<span class="hljs-string"><span class="hljs-string">"cp1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, <span class="hljs-variable"><span class="hljs-variable">$question_contents</span></span>); include_once(<span class="hljs-string"><span class="hljs-string">'../qst/A3.php'</span></span>); <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> iconv(<span class="hljs-string"><span class="hljs-string">"cp1251"</span></span>, <span class="hljs-string"><span class="hljs-string">"UTF-8"</span></span>, showQuest()); <span class="hljs-variable"><span class="hljs-variable">$_SESSION</span></span>[<span class="hljs-string"><span class="hljs-string">'user_position'</span></span>] = <span class="hljs-string"><span class="hljs-string">'A3'</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span>; } <br></code> </pre> <code>if ($_SESSION['user_position'] == 'S9' &amp;&amp; checkAnswer('S9',1)){ //    S9     1-  $question_contents = file_get_contents('../qst/Z6.php'); echo iconv("cp1251", "UTF-8", $question_contents); //include_once('../qst/Z6.php'); //echo iconv("cp1251", "UTF-8", showQuest()); $_SESSION['user_position'] = 'Z6'; exit; } //   ,      php (,            ) if ($_SESSION['user_position'] == 'A1'){ //    A1 //$question_contents = file_get_contents('../qst/A3.php'); //echo iconv("cp1251", "UTF-8", $question_contents); include_once('../qst/A3.php'); echo iconv("cp1251", "UTF-8", showQuest()); $_SESSION['user_position'] = 'A3'; exit; } <br></code> <br>  As can be seen from the above code, both options are almost identical and the conditions for all other checks look similar.  Proceeding from this, we simply load the list of questions into the corresponding script in the order in which they are followed, and at the output we get the generated logic, which we will only have to correct a little with our hands (uncomment the relevant blocks in the conditions and add, if necessary, some additional functions and / or conditions).  If you need to put a condition on a whole block of questions - this is also solved by if (for example, open question A1, and close A8). <br><br>  Having such a file, we simply add to its beginning the function of recording the data transferred from js to the log and that's it.  The logic is ready and the questions are replaced one by one.  And the thing is that for the sake of simplicity, the request from js is sent straight to this script, which writes data, and then just continues to be executed until it meets a suitable condition, and the script will send the necessary content to js and complete the work.  Js, in turn, inserts the received data into the aforementioned div with id = ‚ÄúworkDiv‚Äù and the cycle repeats: the user marks the answers, js sends them to the logic file, php writes data to the log and returns the contents of the next question, js replaces the contents of the working div with the received data . <br><br>  After receiving data from the server and replacing the contents of the working div, js performs another function ‚Äî it calls the binding function to check the validity of the question. <br><br>  <b>Js-check filling questions</b> <br><br>  Most of the questions that are used in online research can be divided into several types: <br><ul><li>  Single selection (radio) </li><li>  Single selection (select) </li><li>  Semi-closed (radio + text) </li><li>  Semi-closed (checkbox + text) </li><li>  Semi-closed (checkbox + text + unique codes) </li><li>  Open </li><li>  Multiple selection (checkbox) </li><li>  Multiple choice (select) </li><li>  Multiple selection with unique codes (checkbox) </li><li>  Multiple selection (table of statements / characteristics from the checkbox) </li><li>  Scales (table of evaluation of abstracts from radio) </li></ul><br>  Based on this, a library of functions was written that automatically bind the corresponding checks on each of the input elements. <br><br>  When you first enter the questionnaire, as well as updating the block with a question, the questsChecks () js function is called, the essence of which, in brief, is as follows: block the Next button (this is a new question and the data has not yet been entered) From the php script, the value of $ _SESSION ['user_position'] (i.e. the current question), run the switch: <br><pre> <code class="hljs mel"><span class="hljs-keyword"><span class="hljs-keyword">switch</span></span>(quest){ <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'S2'</span></span>: disableNext(); radioMultCheck(); <span class="hljs-keyword"><span class="hljs-keyword">progressBar</span></span>(<span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'S4'</span></span>: disableNext(); checkAgeText(<span class="hljs-number"><span class="hljs-number">10</span></span>, <span class="hljs-number"><span class="hljs-number">99</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">progressBar</span></span>(<span class="hljs-number"><span class="hljs-number">7</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'S12'</span></span>: disableNext(); radioTextCheck(); <span class="hljs-keyword"><span class="hljs-keyword">progressBar</span></span>(<span class="hljs-number"><span class="hljs-number">14</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-comment"><span class="hljs-comment">// ...    default: break; } </span></span><br></code> </pre> <code>switch(quest){ case 'S2': disableNext(); radioMultCheck(); progressBar(0); break; case 'S4': disableNext(); checkAgeText(10, 99); progressBar(7); break; case 'S12': disableNext(); radioTextCheck(); progressBar(14); break; // ...    default: break; } <br></code> <br><br>  Depending on the code of the question, the corresponding library function is called for us, which hangs up checks.  Here is an example of one of them (multiple choice + text) and two related ones: <br><pre> <code class="hljs markdown">// ----------------------------------------------------------------------------- function checkboxText(check,text){ disableNext(); if (!check){ $("div[<span class="hljs-string"><span class="hljs-string">id='workDiv'</span></span>] input[<span class="hljs-string"><span class="hljs-string">type='checkbox'</span></span>]").click(function(){checkboxText('true');}); $("div[<span class="hljs-string"><span class="hljs-string">id='workDiv'</span></span>] input[<span class="hljs-string"><span class="hljs-string">type='text'</span></span>]").keyup(function(){checkboxText('true',this);}); } if (check){ if (!text &amp;&amp; $("div[<span class="hljs-string"><span class="hljs-string">id='workDiv'</span></span>] input[<span class="hljs-string"><span class="hljs-string">type='text'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">value!=''</span></span>]").length &gt; 0) enableNext(); if (!text &amp;&amp; $("div[<span class="hljs-string"><span class="hljs-string">id='workDiv'</span></span>] input[<span class="hljs-string"><span class="hljs-string">type='text'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">value!=''</span></span>]").length == 0) checkCheckbox(); if (text &amp;&amp; !checkCheckbox()){ checkText(text); } } } // ----------------------------------------------------------------------------- function checkCheckbox(uniqCodes){ if (!uniqCodes){ uniqText = getUniqTextObj(); if ($("div[<span class="hljs-string"><span class="hljs-string">id='workDiv'</span></span>] input[<span class="hljs-string"><span class="hljs-string">type='checkbox'</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">name!='toggleOther'</span></span>]:checked").length &gt; 0){ enableNext(); return true; } if ($("div[id='workDiv'] input[type='checkbox']:checked").length == 0 &amp;&amp; !uniqText) disableNext(); if ($("div[id='workDiv'] input[type='checkbox']:checked").length == 0 &amp;&amp; uniqText) checkText(uniqText); } if (uniqCodes){ for (var key in uniqCodes){ $(document.getElementById(getQuest()+'.'+uniqCodes[key])).attr("checked", ""); } checkCheckbox(); } } // ----------------------------------------------------------------------------- function checkText(text,uniqCodes){ if (!uniqCodes){ if (text.value) enableNext(); else disableNext(); } if (uniqCodes){ for (var key in uniqCodes){ $(document.getElementById(getQuest()+'.'+uniqCodes[key])).attr("checked", ""); } if (!checkCheckbox()) checkText(text); } } <br></code> </pre> <code>// ----------------------------------------------------------------------------- function checkboxText(check,text){ disableNext(); if (!check){ $("div[id='workDiv'] input[type='checkbox']").click(function(){checkboxText('true');}); $("div[id='workDiv'] input[type='text']").keyup(function(){checkboxText('true',this);}); } if (check){ if (!text &amp;&amp; $("div[id='workDiv'] input[type='text'][value!='']").length &gt; 0) enableNext(); if (!text &amp;&amp; $("div[id='workDiv'] input[type='text'][value!='']").length == 0) checkCheckbox(); if (text &amp;&amp; !checkCheckbox()){ checkText(text); } } } // ----------------------------------------------------------------------------- function checkCheckbox(uniqCodes){ if (!uniqCodes){ uniqText = getUniqTextObj(); if ($("div[id='workDiv'] input[type='checkbox'][name!='toggleOther']:checked").length &gt; 0){ enableNext(); return true; } if ($("div[id='workDiv'] input[type='checkbox']:checked").length == 0 &amp;&amp; !uniqText) disableNext(); if ($("div[id='workDiv'] input[type='checkbox']:checked").length == 0 &amp;&amp; uniqText) checkText(uniqText); } if (uniqCodes){ for (var key in uniqCodes){ $(document.getElementById(getQuest()+'.'+uniqCodes[key])).attr("checked", ""); } checkCheckbox(); } } // ----------------------------------------------------------------------------- function checkText(text,uniqCodes){ if (!uniqCodes){ if (text.value) enableNext(); else disableNext(); } if (uniqCodes){ for (var key in uniqCodes){ $(document.getElementById(getQuest()+'.'+uniqCodes[key])).attr("checked", ""); } if (!checkCheckbox()) checkText(text); } } <br></code> <br>  I will not comment on each line, because  this sweeps up too much text, but I will briefly explain the algorithm: we attach a call to the same function for each element of type input at the click () or keyup () event, but with the ‚Äúcheck‚Äù parameter and object transfer (for text fields).  When calling a check (when clicking), the function runs over all elements within the working div in accordance with a predefined algorithm (which is based on the type of question), collects field values, analyzes them and, if required, calls for more specialized check functions. <br><br>  In this example, the multi-choice validation function with text may trigger the launch of the simple multiple-choice validation function, since  simple multiple choice is a simplified version of the multiple choice with the text and is included in it.  All verification functions of primitive types (these include: multiple choice, single choice, open-ended question) are designed in such a way that only types of primitive fields are checked.  Thus, by automatically sorting out complex types of questions into simple ones and performing checks on them, we get the desired result - true or false - whether the test passed or not.  And, if so, remove the lock from the Next button, if not, we do nothing, or we block it if it is available. <br><br>  If the check is successful, a new cycle begins: sent, received, filled, checked, sent, etc. <br><br>  <b>Using structured programming</b> <br><br>  Using bare functions, instead of classes and objects, in this case (in my opinion) is more preferable in terms of performance.  With a large flow of users, creating an object with a bunch of properties just for the sake of using one specific method is, at least, not reasonable.  Manipulations with five to ten objects are more costly in terms of resources than similar actions with functions. <br><br>  Besides, due to the simplicity of the engine architecture, in the OOP, I simply don‚Äôt see the point. <br><br><h4>  Summing up </h4><br><br>  This engine architecture worked out with a bang in one of the studies, in which the number of users who received invitations to participate was about 120-130 thousand people, with loyal users being customers of the customer, and the mailing itself was on behalf of the customer - while about 22k successful interviews, and the total number of visits was about 45k. <br><br>  Smaller studies have been carried out a great many. <br><br>  Statistics say that this architecture is reliable and highly productive.  In addition, it is also convenient (in my opinion) and quite flexible. <br><br>  If there is enough free time, I may still return to the revision of this engine and, again, maybe I will put all the sources in the public domain, along with a detailed description of the functionality and all sorts of buns.  But all this is only ‚Äúpossible‚Äù ... <br><br>  At one time, when I was just beginning to dive into this area, the lack of information on the topic was catastrophic and all the tasks had to be solved, often with a trial and error method. <br><br>  I hope that this manual and my personal experience, which I reflected in it, somehow helped you. <br><br>  And I also hope that this material will somehow fill the informational vacuum around a topic such as programming online questionnaires in marketing research. <br><br>  But, unfortunately, such topics as quota programming, conditioner, or programming of questionnaires and / or the engine for CATI (actually, as well as the organization of the technical base of CATI-studio itself) are not covered.  And much more‚Ä¶ <br><br>  But these are all topics for individual FAQs and manuals. <br><br>  Thanks for attention. </div><p>Source: <a href="https://habr.com/ru/post/96343/">https://habr.com/ru/post/96343/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../96337/index.html">Domestic design education. Senseless and merciless</a></li>
<li><a href="../96338/index.html">Installing the ATI driver on Debian GNU / Linux</a></li>
<li><a href="../96339/index.html">Taxes are inevitable as death</a></li>
<li><a href="../96340/index.html">Twitter client for ZX Spectrum</a></li>
<li><a href="../96341/index.html">Sync notes in Google Chrome</a></li>
<li><a href="../96346/index.html">Update Habrex to version 1.3.8</a></li>
<li><a href="../96347/index.html">StrengthsFinder 2.0</a></li>
<li><a href="../96349/index.html">Follow Dalai Lama and Ugo Chaves</a></li>
<li><a href="../96350/index.html">Habrafutbol: play tomorrow</a></li>
<li><a href="../96354/index.html">Substitutions for nginx (Web Sockets)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>