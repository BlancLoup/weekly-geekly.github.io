<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Create a C ++ application using Tesseract-ocr, MinGW and a file</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It so happened that it took us to embed text recognition in our application, so we began the search for a suitable library. In the end, they settled o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Create a C ++ application using Tesseract-ocr, MinGW and a file</h1><div class="post__text post__text-html js-mediator-article">  It so happened that it took us to embed text recognition in our application, so we began the search for a suitable library.  In the end, they settled on two open source projects, <a href="https://launchpad.net/cuneiform-linux">CuneiForm Linux</a> and <a href="http://code.google.com/p/tesseract-ocr/">Tesseract-ocr</a> .  A careful study of the CuneiForm project showed that this is just the port of the product of Cognitive Technologies, the source code of which they opened in 2008 and successfully scored having received their portion of attention (in any case, this was the impression).  In fact, the whole project consisted in porting, and there was no even talk of new features.  All this, coupled with the <a href="https://launchpad.net/cuneiform-linux/%2Bannouncement/8374">sad news</a> on the page of the project, forced us to abandon CuneiForm in favor of Tesseract, which is currently owned by Google, which gives some confidence in the future of the project.  Under the cut, the experience of building Tesseract-ocr under Windows using MinGW and then creating the simplest C ++ application. <a name="habracut"></a><br><br><h4>  Training </h4><br>  I will try to describe everything that needs to be done to put together a tesseract with a minimal headache, while at the same time I will try not to go deep into banality. <br><br><h5>  Install and configure MinGW </h5><br>  Download and install the latest available installer from the <a href="http://sourceforge.net/projects/mingw/files/Automated%2520MinGW%2520Installer/mingw-get-inst/">official site of the project</a> , do not forget to tick for C ++ Compiler and MSYS Basic System.  After that we go into MinGW Shell and install additional packages that we will need later with the following command: <br> <code>mingw-get install mingw32-automake mingw32-autoconf mingw32-autotools mingw32-libz</code> <br>  Immediately, we note that the directory in which MinGW is installed is mounted in <i>/ mingv</i> , this will also be useful to us when building libraries. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h5>  Installing the Leptonica library </h5><br>  Tesseract-ocr uses the <a href="http://leptonica.org/">Leptonica</a> library for working with images, I will describe how to build and install it from the source code that can be taken from the <a href="">official site</a> , but before that we need to install the libraries <a href="http://www.ijg.org/">libJpeg</a> , <a href="http://www.libpng.org/">libPng</a> and <a href="http://www.libtiff.org/">libTiff</a> , which in turn uses Leptonica it is also an assembly from source codes). <br><br><h6>  Build libJpeg </h6><br>  Download the archive with source codes from the <a href="">official site</a> and unpack it into a separate directory (for simplicity, we assume that it is <i>D: \ lib \ jpeg</i> ).  Back in MinGW Shell and with a slight movement of the hand, we assemble and install the library into directories in which gcc is looking for by default.  Flags are overridden to disable debug output. <br> <code>cd /D/lib/jpeg <br> ./configure CFLAGS='-O2' CXXFLAGS='-O2' --prefix=/mingw <br> make <br> make install</code> <br> <br><h6>  Build libPng </h6><br>  We also download the archive with source codes from the <a href="">project page</a> and unpack it into the <i>D: \ lib \ png</i> directory (you, of course, can choose another one).  Go back to the MinGW Shell and repeat the same thing as for libJpeg. <br><br><h6>  LibTiff build </h6><br>  We take archive with source codes from <a href="">recommended ftp</a> and unpack in <i>D: \ lib \ tiff</i> .  And collect the same as the previous two. <br><br><h6>  Build Leptonica </h6><br>  We already have an archive with source codes, it remains to unpack it in D: \ lib \ leptonica.  And then it is time to remember about the file, the assembly with Zlib support will not succeed because of a <a href="http://code.google.com/p/leptonica/issues/detail%3Fid%3D56">small bug</a> , which, however, is easy to fix by yourself.  To do this, open the file <i>src / pngio.c</i> , located in the directory where we unpacked the source code Leptonica.  There you need to find the line <b>#include "png.h"</b> and insert directives after it, so that you can get something like this: <br> <code>#include "png.h" <br> <br> #ifdef HAVE_LIBZ <br> #include "zlib.h" <br> #endif <br> <br> /* ----------------Set defaults for read/write options ----------------- */</code> <br>  After that we collect Leptonica as well as the previous libraries. <br><br><h4>  Assembling and installing Tesseract-ocr </h4><br>  Now we have all the necessary dependencies.  This time we will download the sources from the svn trunk of the developers: <br> <code>svn checkout ht tp://tesseract-ocr.googlecode.com/svn/trunk/ tesseract-ocr-read-only</code> <br>  * the space between t is intended exclusively for habrapriser, remove it. <br><br>  Then again we take up the file, but I pre-exported the source code to <i>D: \ lib \ tesseract</i> . <br>  I will write the paths to the files relative to the directory in which the tesseract sources are located (recall that in my case it is <i>D: \ lib \ tesseract</i> ). <br><ul><li>  Editing the file <i>ccutil / platform.h</i> .  We need to comment out the re-declaration of the <b>BLOB</b> type, which already exists in <i>winsock2.h</i> .  It should be something like: <br> <code>/*typedef struct _BLOB { <br> unsigned int cbSize; <br> char *pBlobData; <br> } BLOB, *LPBLOB;*/</code> </li> <li>  From <i>vs2008 / port,</i> copy the <i>strtok_r.h</i> and <i>strtok_r.cpp</i> files to the <i>ccutil</i> directory and add <i>strtok_r.cpp</i> to the <b>libtesseract_ccutil_la_SOURCES</b> variable in the <i>ccutil / Makefile.am</i> file. </li><li>  We comment on the <b>PBLOB</b> class <b>declaration</b> in <i>api / baseapi.h</i> . </li><li>  In the <i>api / Makefile.am</i> file, we supplement the <b>AM_CPPFLAGS</b> variable <b>with</b> the <b>-I $ (top_srcdir) / vs2008 / port variable</b> <br>  or simply copy the file <i>vs2008 / port / version.h</i> to the <i>api</i> directory </li><li>  <b>We supplement the AM_CPPFLAGS</b> variable in the <i>viewer / Makefile.am</i> file with the value <b>-I $ (top_srcdir) / ccutil</b> </li></ul><br>  After these manipulations, you can go to the MinGW Shell and start building the library directly: <br> <code>cd /D/lib/tesseract <br> ./runautoconf <br> ./configure CFLAGS='-D__MSW32__ -O2' CXXFLAGS='-D__MSW32__-O2' LIBS='-lws2_32' LIBLEPT_HEADERSDIR='/mingw/include' --prefix=/mingw <br> make <br> make install</code> <br>  While he was going, I had time to drink tea, and after I discovered a stack of header files in <i>/ mingw / include / tesseract</i> , the <i>Leptonica</i> header files were located in <i>/ mingw / include / leptonica</i> , all the libraries were naturally in <i>/ mingw / lib</i> . <br><br><h4>  Simple application </h4><br>  I will give the whole code, as it is very small: <br> <code>#include &lt;stdio.h&gt; <br> #include &lt;string.h&gt; <br> #include &lt;tesseract/baseapi.h&gt; <br> #include &lt;leptonica/allheaders.h&gt; <br> <br> int main(int argc, char* argv[]) { <br> tesseract::TessBaseAPI tessApi; <br> tessApi.Init("data", "rus");//  <i>data</i>      <i>*.traineddata</i> , <br> //  <i>rus</i>       <br> if(argc &gt; 1) { <br> PIX *pix = pixRead(argv[1]);//      , <br> //   ,   Leptonica <br> tessApi.SetImage(pix);//  tesseract,      <br> char *text = tessApi.GetUTF8Text();// <br> //---         <br> char *fileName = NULL; <br> long prefixLength; <br> const char* lastDotPosition = strrchr(argv[1], '.'); <br> if(lastDotPosition != NULL) { <br> prefixLength = lastDotPosition - argv[1]; <br> fileName = new char[prefixLength + 5]; <br> strncpy(fileName, argv[1], prefixLength); <br> strcpy(fileName + prefixLength, ".txt\0"); <br> } else { <br> exit(1); <br> } <br> //--- <br> FILE *outF = fopen(fileName, "w"); <br> fprintf(outF, "%s", text); <br> fclose(outF); <br> //--- <br> pixDestroy(&amp;pix); <br> delete [] fileName; <br> delete [] text; <br> } <br> return 0; <br> }</code> <br>  You can build our application with the command: <br> <code>g++ -O2 test.cpp -o test.exe -ltesseract_api -ltesseract_main -ltesseract_textord -ltesseract_wordrec -ltesseract_ccstruct -ltesseract_ccutil -ltesseract_classify -ltesseract_dict -ltesseract_image -ltesseract_viewer -ltesseract_cutil -ltesseract_cube -ltesseract_neural -llept -lws2_32</code> <br>  The link is static because the current version of tesseract does not support creating a DLL. <br><br><h4>  Conclusion </h4><br>  I know from my own experience that the hardest thing to start is, so I hope that my story will be useful to someone, especially considering that Tesseract's online documentation is criminally small and the main one can perhaps be pulled from the source itself using doxygen. <br>  PS: some ideas for fixes were gathered in <a href="http://markmail.org/message/kwncjvi5nn3ovtsz">this post</a> for which many thanks to the author. </div><p>Source: <a href="https://habr.com/ru/post/126834/">https://habr.com/ru/post/126834/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126828/index.html">Tokens vs Passwords</a></li>
<li><a href="../126829/index.html">We continue to review submitted applications for the competition Web Ready</a></li>
<li><a href="../126831/index.html">OmniGraffle for iPad - describe business processes</a></li>
<li><a href="../126832/index.html">MySQL sandbox</a></li>
<li><a href="../126833/index.html">Console for CodeIgniter</a></li>
<li><a href="../126835/index.html">Software sound generation</a></li>
<li><a href="../126836/index.html">A modest wish for Windows 8 - system spell checker</a></li>
<li><a href="../126837/index.html">All-terrain vehicle from China</a></li>
<li><a href="../126839/index.html">Everything about Chrome OS on OsByGoogle.com</a></li>
<li><a href="../126840/index.html">A simple way to get around local proxy restrictions</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>