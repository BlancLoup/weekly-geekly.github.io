<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>P4 programming language</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="P4 is a programming language designed to program packet routing rules. Unlike a general purpose language such as C or Python, P4 is a domain-specific ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>P4 programming language</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img width="670" height="330" src="https://habrastorage.org/webt/hb/w7/o-/hbw7o-cd3zovgayloqdt6cfirjg.png"></div><br>  P4 is a programming language designed to program packet routing rules.  Unlike a general purpose language such as C or Python, P4 is a domain-specific language with a number of constructs optimized for network routing. <br><br>  P4 is an open source language, licensed and supported by a non-profit organization called the P4 Language Consortium.  It is also supported by the Open Networking Foundation (ONF) and the Linux Foundation (LF) - the two largest umbrella organizations in open source projects in the field of network technologies. <a name="habracut"></a><br>  The language was originally coined in 2013 and described in 2014 in a SIGCOMM CCR document called ‚ÄúProtocol Independent Programming of the Package Routing Processor‚Äù. <br><br>  Since its inception, P4 has grown exponentially and developed, quickly becoming the standard for describing packet transmission by network devices, including network adapters, switches and routers. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      ‚ÄúSDN has transformed the networking industry, and P4 takes SDN to a new level, providing programmability in the field of Marshutization,‚Äù said Guru Parulkar, executive director of the Open Networking Foundation. <br><br>  The P4 language was originally created by a group of engineers and researchers from Google, Intel, Microsoft Research, Barefoot, Princeton and Stanford.  The goal was simple: create an easy-to-use language that a software developer can learn in a day, and use it to accurately describe how packets are sent over the network. <br><br>  From the outset, the P4 was developed as a target independent (i.e., a program written in P4 could be compiled without modification to be performed on various purposes, such as ASIC, FPGA, CPU, NPU and GPU). <br><br>  Also, the language is protocol independent (i.e., the P4 program can describe existing standard protocols or be used to specify new custom addressing modes). <br><br>  In industry, the P4 is used for programming devices.  Perhaps in the future, Internet-RFC and IEEE standards will also include the P4 specification. <br><br>  P4 can be used for both programmable and fixed-function devices.  For example, it is used to accurately record the switch pipeline behavior in the switch abstraction interface (SAI) APIs used by the switch OS with the open source SONiC.  P4 is also used in the ONF Stratum project to describe switching behavior across multiple stationary and programmable devices. <br><br>  Describing the behavior of the switch and network adapters for the first time allows you to create an exact executable model of the entire network before deployment.  Large cloud providers can fully test and debug the network using software, which significantly reduces the time and cost of testing the interaction in the laboratory without requiring expensive equipment. <br><br>  Using P4, network equipment providers can rely on a common basic routing behavior across all products, which allows reuse of testing infrastructure, simplifies management software development and, ultimately, ensures compatibility. <br><br>  Of course, P4 can be used to write programs that describe completely new routing methods.  For example, P4 is widely used for telemetry and measurements in data centers, networks of enterprises and service providers. <br><br>  The research community has also stepped up.  Several leading academic research groups on networking technologies have published interesting new applications based on P4 programs, including load balancing, consistent protocols, and key-value caching.  A new programming paradigm is being created, innovations are being transferred from hardware to software, which allows many unexpected, new and ingenious ideas to emerge. <br><br>  The developer community has made significant contributions to code development, including compilers, pipeline programs, behavioral models, APIs, test environments, applications, and more.  Devoted developers are in companies like Alibaba, AT &amp; T, Barefoot, Cisco, Fox Networks, Google, Intel, IXIA, Juniper Networks, Mellanox, Microsoft, Netcope, Netronome, VMware, Xilinx and ZTE;  from universities including BUPT, Cornell, Harvard, MIT, NCTU, Princeton, Stanford, Technion, Tsinghua, UMass, and USI;  and open source projects, including CORD, FD.io, OpenDaylight, ONOS, OvS, SAI and Stratum, underline the fact that P4 is an independent public project. <br><br>  Typical controller generation for the P4 language: <br><br><div style="text-align:center;"><img width="602" height="409" src="https://habrastorage.org/webt/7q/07/am/7q07amo-jzmkmtiut50ptueiesu.png"></div><br><br><h2>  <font color="#1B469F">Application prospects</font> </h2><br><div style="text-align:center;"><img width="467" height="300" src="https://habrastorage.org/webt/eq/h0/e2/eqh0e289qu_lsq8-cgx_jprgwjw.png"></div><br>  Since the language is intended for routing applications, the list of requirements and design options is different compared to general-purpose programming languages.  The main features of the language are: <br><br><ol><li>  Independence from the target implementation; </li><li>  Independence from the protocol (s) used; </li><li>  Reconfigurability fields. </li></ol><br>  <b>Independence from target implementation</b> <br><br>  P4 programs are designed to be implementation-independent, that is, they can be compiled for many different types of execution machines, such as general-purpose processors, FPGAs, on-chip systems, network processors, and ASICs.  These different types of machines are known as P4 targets, and a compiler is needed for each target in order to convert the P4 source code into the target switch model.  The compiler can be embedded in the target device, external software or even a cloud service.  Since many of the original targets for the P4 programs were used for simple packet switching, it is often possible to hear the term ‚ÄúP4 switch‚Äù, even if the use of ‚ÄúP4 target‚Äù is more true. <br><br>  <b>Independence from the protocol (s) used</b> <br><br>  P4 is protocol independent.  This means that the language does not have native support for common protocols such as IP, Ethernet, TCP, VxLAN, or MPLS.  Instead, the P4 programmer describes the header formats and the field names of the required protocols in the program, which in turn are interpreted and processed by the compiled program and the target device. <br><br>  <b>Field Configurability</b> <br><br>  Protocol independence and the abstract language model allow for reconfigurability ‚Äî P4 goals should be able to modify the processing of packets after the system is deployed.  This feature is traditionally associated with routing through general-purpose processors or network processors, rather than integrated circuits with fixed functions. <br><br>  Although there is no language that could prevent the optimization of a specific set of protocols, these optimizations are invisible to the author of the language and may ultimately reduce the flexibility of the system and the goals and their reconfigurability. <br><br>  These characteristics of the language were originally laid by its creators with a focus on its widespread use in the network infrastructure. <br><br>  Already, the language is used in many companies: <br><br>  <b>1) Hyper-scale data centers;</b> <br><br>  Chinese company Tencent is the largest investment company in the world and one of the largest venture capital companies.  Tencent subsidiaries, both in China and in other countries of the world, specialize in various areas of high-tech business, including various Internet services, developments in the field of artificial intelligence and electronic entertainment. <br><br>  P4 and programmable routing are advanced technologies used in the company's network architecture. <br><br>  As one of the creators, Google is proud to note the rapid introduction of P4 in the networking industry and, in particular, in the architectural design of the data center. <br><br>  <b>2) Commercial companies;</b> <br><br>  Using the benefits of working with the open source community and developing common standards and solutions, Goldman Sachs brings innovation to the network infrastructure and provides better solutions for customers. <br><br>  <b>3) Production;</b> <br><br>  The entire network industry will benefit from a language such as P4, which uniquely identifies redirection behavior.  They also consider Cisco, transferring their product lines to the use of this language. <br><br>  Juniper Networks has incorporated the P4 and P4 Runtime into a range of products, and provides programmatic access to the Juniper embedded processor and its software code. <br><br>  Ruijie Networks is a strong supporter of P4 and the benefits it brings to networks.  With P4, a company can create and deliver best-in-class solutions for a wide range of customers. <br><br>  <b>4) Telecommunication providers;</b> <br><br>  AT &amp; T was one of the first supporters of P4, one of the first to use P4 to determine the behavior it wanted to see on networks, and to use P4 programmable forwarding devices on its network. <br><br>  At Deutsche Telekom, the language is used to create prototypes of key network functions within the Access 4.0 program. <br><br>  <b>5) Semiconductor industry;</b> <br><br>  The language allowed Barefoot to implement a new paradigm of transferring software capabilities to the network routing plane. <br><br>  Xilinx was one of the founders of P4.org and was actively involved in the development of the P4 language and implemented it in FPGA-based programmable platforms for SmartNIC and NFV equipment, releasing one of the first P4 <sub>16</sub> compilers as part of SDNet design. <br><br>  <b>6) Software.</b> <br><br>  VMware believes that P4 creates tremendous energy, innovation and community, which leads to meaningful and necessary transformations in the network.  VMware was originally part of this industry movement, as the new wave of innovation is driven by programmatic approaches that expand the capabilities of the infrastructure and implement it in the latest products. <br><br>  Thus, P4 is a goal-independent and protocol-independent programming language that is used by industry and the scientific community to uniquely define the behavior of packet routing as a program, which, in turn, can be compiled for several purposes.  Today's goals include hardware and software switches, hypervisor switches, NPU, graphics processors, FPGA, SmartNIC, and ASIC. <br><br>  The main features of the language significantly expand the scope of its application and ensure its rapid implementation in network architectures. <br><br><h2>  <font color="#1B469F">Where to begin</font> </h2><br>  P4 is an open project, all relevant information is on the website <a href="https://p4.org/">P4.org</a> <br><br>  Link to the repository <a href="https://github.com/p4lang">https://github.com/p4lang</a> , where you can get source codes of examples and training materials. <br><br>  <a href="https://marketplace.eclipse.org/content/p4eclipse">Plugin</a> for Eclipse with P4 support, but we can recommend <a href="https://www.barefootnetworks.com/products/brief-p4-studio/">P4 Studio</a> from Barefoot. <br><br><div style="text-align:center;"><img width="602" height="358" src="https://habrastorage.org/webt/b0/62/dv/b062dvii5juvwxcnulh4pfrxbj0.jpeg"></div><br><br>  Let us analyze the main abstractions of the kernel: <br><br>  <b>Definition of headers</b> - with their help protocol headers are defined. <br><br>  In the definition of headers is given: <br><br><ul><li>  description of packet formats and header field names </li><li>  fixed and variable permitted fields </li></ul><br>  for example <br><br> <code><b>header</b> Ethernet_h{ <br> <b>bit</b> &lt;48&gt;  dstAddr; <br> <b>bit</b> &lt;48&gt;  srcAddr; <br> <b>bit</b> &lt;16&gt;  etherType; <br> } <br></code> <br><br> <code><b>header</b> IPv4_h{ <br> <b>bit</b> &lt;4&gt;  version; <br> <b>bit</b> &lt;4&gt;  ihl; <br> <b>bit</b> &lt;8&gt;  diffserv; <br> <b>bit</b> &lt;16&gt;  totalLen; <br> <b>bit</b> &lt;16&gt;  identification; <br> <b>bit</b> &lt;3&gt;  flags; <br> <b>bit</b> &lt;13&gt;  fragOffset; <br> <b>bit</b> &lt;8&gt;  ttl; <br> <b>bit</b> &lt;8&gt;  protocol; <br> <b>bit</b> &lt;16&gt;  hdrChecksum; <br> <b>bit</b> &lt;32&gt;  srcAddr; <br> <b>bit</b> &lt;32&gt;  dstAddr; <br> <b>varbit</b> &lt;320&gt;  options; <br> } <br></code> <br><br>  <b>Parsers</b> - their task is to parse the headers. <br><br>  The following example of the parser will determine the transition of the final state of the machine from one initial state to one of two final states: <br><br><div style="text-align:center;"><img width="400" height="200" src="https://habrastorage.org/webt/mm/hc/8w/mmhc8wkkyn1jkvlldtyszv6q8om.png"></div><br><br> <code><b>parser</b> MyParser(){ <br> state  start{transition parse_ethernet;} <br> state  parse_ethernet{ <br> packet.extract(hdr.ethernet); <br> transition select(hdr.ethernet.etherType){ <br> TYPE_IPV4: parse_ipv4; <br> default: accept; <br> } <br> }‚Ä¶ <br> } <br></code> <br><br>  <b>Tables</b> ‚Äî contain machine states that associate user keys with actions.  <b>Actions</b> - a description of how the package should be manipulated. <br><br>  Tables contain states (defined at the management level) for packet forwarding, describe the Match-Action unit of action. <br><br>  Comparison of packages is made by: <br><br><ul><li>  Exact match </li><li>  Longest Match with Prefix (LPM) </li><li>  Triple mapping </li></ul><br> <code><b>table</b> ipv4_lpm{ <br> <b>reads</b> { <br> ipv4.dstAddr: lpm; <br> } <b>actions</b> { <br> forward(); <br> } <br> }</code> <br> <br>  All possible actions should be defined in the tables in advance. <br><br>  Actions consist of code and data.  Data is received at a management level (for example, IP addresses / port numbers).  Certain, cyclic-free primitives can be specified directly in action, but the number of commands must be predictable.  Therefore, actions cannot contain any cycles or conditional statements. <br><br> <code><b>action</b> ipv4_forward(macAddr_t dstAddr, egressSpec_t port){ <br> standard_metadata.egress_spec = port; <br> hdr.ethernet.srcAddr = hdr.ethernet.dstAddr; <br> hdr.ethernet.dstAddr = dstAddr; <br> hdr.ipv4.ttl = hdr.ipv4.ttl - 1; <br> } <br></code> <br><br>  <b>Modules Match-Action</b> - actions to create a search key, search the table, perform actions. <br><br>  A typical example of a module is shown in the figure: <br><br><div style="text-align:center;"><img width="602" height="389" src="https://habrastorage.org/webt/wu/fs/xo/wufsxojasau1t4jrpnyljydudyg.png"></div><br><br>  <b>Control flow</b> - indicates the order of application of the Match-Action modules.  This is an imperative program that defines high-level logic and a Match-Action sequence.  The control flow connects all objects by specifying the control level. <br><br>  <b>External objects</b> are specific objects with a clearly defined architecture and APIs.  For example, checksum calculation, registers, counters, counters, etc. <br><br> <code><b>extern</b> register{ <br> register(bit&lt;32&gt; size); <br> <b>void</b> read(out T result, in bit&lt;32&gt; index); <br> <b>void</b> write(in bit&lt;32&gt; index, in T value); <br> } <br></code> <br><br> <code><b>extern</b> Checksum16{ <br> Checksum16();    //constructor <br> <b>void</b> clear();    //prepare unit for computation <br> <b>void</b> update(in T data);    //add data to checksum <br> <b>void</b> remove(in T data);  /remove data from existing checksum <br> <b>bit</b> &lt;16&gt; get(); //get the checksum for the data added since last clear <br> } <br></code> <br>  <b>Metadata</b> - data structures associated with each package. <br><br>  There are 2 types of metadata: <br><br>  <b>Custom metadata (empty structure for all packages)</b> <br>  You can put everything you want here. <br>  Available throughout the pipeline <br>  convenient for use for their own purposes, for example, to store the package hash <br><br>  <b>Internal metadata - provided by architecture</b> <br>  Input port, output port are defined here. <br>  The timestamp when the packet was queued, the queue depth <br>  multicast hash / multicast queue <br>  Package priority, package importance <br>  Output port specification (for example, output queue) <br><br><h2>  <font color="#1B469F">P4 compiler</font> </h2><br>  P4 compiler (P4C) generates: <br><br><ol><li>  Data plane runtime </li><li>  API to manage the state of the machine in the data plane </li></ol><br><div style="text-align:center;"><img width="602" height="252" src="https://habrastorage.org/webt/py/6u/ub/py6uubwvudieedqy31iuica4w4u.png"></div><br><h2>  <font color="#1B469F">An example of a software switch in the P4 language</font> </h2><br>  Source codes can be downloaded from the repository. <br><br>  p4lang / p4c-bm: creates a JSON configuration for bmv2 <br>  p4lang / bmv2: softswitch that understands bmv2 version JSON configurations <br><br>  The figure shows the project compilation scheme: <br><br><div style="text-align:center;"><img width="602" height="292" src="https://habrastorage.org/webt/um/ai/gi/umaigihuirmpetawiiozcyupug4.png"></div><br><br>  Manipulations with tables, registers of reading, counter: <br><br><ul><li> <code>table_set_default &lt;table name&gt; &lt;action name&gt; &lt;action parameters&gt; table_add &lt;table name&gt; &lt;action name&gt; &lt;match fields&gt; =&gt; &lt;action <br> parameters&gt; [priority] table_delete &lt;table name&gt; &lt;entry handle&gt;</code> </li> <li> <code>table_set_default &lt;table name&gt; &lt;action name&gt; &lt;action parameters&gt; table_add &lt;table name&gt; &lt;action name&gt; &lt;match fields&gt; =&gt; &lt;action <br> parameters&gt; [priority] table_delete &lt;table name&gt; &lt;entry handle&gt;</code> </li> <li> <code>table_set_default &lt;table name&gt; &lt;action name&gt; &lt;action parameters&gt; table_add &lt;table name&gt; &lt;action name&gt; &lt;match fields&gt; =&gt; &lt;action <br> parameters&gt; [priority] table_delete &lt;table name&gt; &lt;entry handle&gt;</code> </li> </ul><br>  The source code contains the program simple_switch_CLI for convenient use of the software switch API. <br><br>  This and other examples you can download in the repository. <br><br><div style="text-align:center;"><img width="511" height="286" src="https://habrastorage.org/webt/fu/xv/dd/fuxvdd-cq7g1h8nrhcz6qyj5iqw.png"></div><br><br>  <b>PS</b> In early summer, Intel signed an agreement to acquire Barefoot Networks, with a view to quickly meeting the needs of Hyperscale Cloud users.  According to Navin Shenoy (executive director at the Intel Corporation), this will allow Intel to provide greater workloads and more opportunities for data center customers. <br><br>  In my personal opinion, we should not forget that Intel is the leader in the production of FPGA chips and it has an excellent Quartus environment.  So you can expect that with the arrival at Intel, Barefoot will not only replenish the product line, but also Quartus and P4 Studio will have major updates and line-ups with the Toffino and Toffino 2 line. <br><br>  The official member of the P4 community is the <a href="https://www.fgts.ru/">Factor Group</a> Company. </div><p>Source: <a href="https://habr.com/ru/post/460439/">https://habr.com/ru/post/460439/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../460423/index.html">PostgreSQL WAL: 3. Checkpoint</a></li>
<li><a href="../46043/index.html">Baseball cap with opener</a></li>
<li><a href="../460431/index.html">Building an automated testing pipeline on Azure DevOps</a></li>
<li><a href="../460433/index.html">Risks and threats in the Internet of things</a></li>
<li><a href="../460437/index.html">How we put out a tech bike</a></li>
<li><a href="../46044/index.html">The British company requires you to give Odnoklassniki and income from them.</a></li>
<li><a href="../460441/index.html">Gleb Nitsman: ‚ÄúI found the very end of an era when people had not yet chased the gold contained in radio elements‚Äù</a></li>
<li><a href="../460443/index.html">Designers vs developers: about the history of creating the application "My smart city"</a></li>
<li><a href="../460445/index.html">Lecture course "Basics of digital signal processing"</a></li>
<li><a href="../46045/index.html">Linux Teacher Test</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>