<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>LINQ for PHP: speed matters</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="If you don‚Äôt know what LINQ is and why it gave up on PHP, see the previous article on YaLinqo . 

 With the rest we continue. Immediately I warn you: ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>LINQ for PHP: speed matters</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/a88/804/a0d/a88804a0d87bfaf21b6817ade48e772b.png" align="right">  If you don‚Äôt know what LINQ is and why it gave up on PHP, see the <a href="http://habrahabr.ru/post/229763/">previous article on YaLinqo</a> . <br><br>  With the rest we continue.  Immediately I warn you: if you think that iterators are an unnecessary thing that dragged in PHP for some reason, that performance because of all these newfangled things with anonymous functions sags so badly that you need to die out every microsecond, that nothing is better than good old things not invented - then pass by.  Library and article is not for you. <br><br>  With the rest we continue.  LINQ is great, but how good is performance from using it?  If you compare with bare cycles, then the speed is less than 3-5 times.  If to compare with functions for arrays to which anonymous functions are transferred, then 2-4 times.  Since it is assumed that with the help of the library small data arrays are processed, and complex data processing is outside the script (in the database, in a third-party web service), in fact, the losses in the script are small.  The main thing is readability. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Since, since the creation of my <a href="https://github.com/Athari/YaLinqo">YaLinqo</a> library, two more competitors have appeared, which are really LINQ (that is, they support lazy calculations and other basic features), the library has a <a href="https://github.com/Athari/YaLinqo">desire</a> to compare.  The simplest and most logical is to compare functionality and performance.  At least it will not be a beating of babies, as in the <a href="http://habrahabr.ru/post/147612/">past comparison</a> . <br><br>  (And also the emergence of competitors finally motivated me to post the <a href="http://athari.github.io/YaLinqo">YaLinqo documentation online</a> .) <br><br>  <i>Disclaimer:</i> these are ‚Äúon the knee‚Äù tests.  They do not give an estimate of all losses in performance.  In particular, I absolutely do not consider memory consumption.  Partly because I do not know how to do it normally.  If that, <a href="https://github.com/Athari/YaLinqoPerf">pull requests are welcome</a> , that is called. <br><a name="habracut"></a>  <b>Competitors</b> <br>  <a href="https://github.com/Athari/YaLinqo"><b>YaLinqo</b></a> - <i>Yet Another LINQ to Objects for PHP</i> .  Supports queries only to objects: arrays and iterators.  It has two versions: for PHP 5.3+ (without yield) and for PHP 5.5+ (with yield).  The latest version relies solely on yield and arrays for all operations.  In addition to anonymous functions, it supports "string lambdas".  The most minimalistic of the libraries presented: it contains only 4 classes.  Of the features - a very <a href="https://github.com/Athari/YaLinqoPerf">massive documentation, adapted from MSDN</a> . <br><br>  <a href="https://github.com/akanehara/ginq"><b>Ginq</b></a> - <i>'LINQ to Object' inspired DSL for PHP</i> .  Similarly, it only supports queries on objects.  Based on SPL iterators, therefore in PHP 5.3+ requirements.  In addition to anonymous functions, it supports ‚Äúproperty access‚Äù from symfony.  Medium-sized library: ported collections, comparers, key-value pairs and other stuff from .NET;  total 70 classes.  Documentation of average scall: at best, signatures are indicated.  The main feature is iterators, which allows the library to be used both by building queries in the form of a chain of methods, and using nested iterators. <br><br>  <a href="https://github.com/TimeToogo/Pinq"><b>Pinq</b></a> - <i>PHP Integrated Query, a real LINQ library for PHP</i> .  The only library that allows you to work with objects and databases (well ... <i>theoretically</i> allows).  It supports only anonymous functions, but can parse code with <a href="https://github.com/nikic/PHP-Parser">PHP-Parser</a> .  The documentation is not the most detailed (if any), but it has a nice site.  The most massive library of the following: more than 500 classes, not counting 150 classes of tests (to be honest, I didn‚Äôt even climb into the code, because it‚Äôs scary). <br><br>  All the libraries presented with tests and other signs of quality are fine.  Permissive licenses: BSD, MIT.  All support Composer and are presented on Packagist. <br><br>  <b>Tests</b> <br><br>  Hereinafter, an array of functions is passed to the <code>benchmark_linq_groups</code> function: for bare PHP, YaLinqo, Ginq and Pinq, respectively. <br><br>  Tests chasing PHP 5.5.14, Windows 7 SP1.  Since the tests are ‚Äúon the knee‚Äù, I do not cite iron specs - the task is to evaluate the loss by eye, and not to measure everything up to a millimeter.  If you want accurate tests, then the source code is available on the githab, you can improve, pull-requests are accepted. <br><br>  Let's start with the bad - pure overhead projector. <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Iterating over $ITER_MAX ints"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $j = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $ITER_MAX; $i++) $j = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $j; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $j = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i) $j = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $j; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $j = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (E::range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i) $j = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $j; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $j = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (G::range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i) $j = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $j; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $j = <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> (P::from(range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>)) <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $i) $j = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $j; }, ]);</code> </pre> <br>  The generating function <code>range</code> in Pinq is missing, the documentation says to use the standard function.  What, in fact, we are doing. <br><br>  And the results: <br><br><pre>  Iterating over 1000 ints
 ------------------------
   PHP [for] 0.00006 sec x1.0 (100%)
   PHP [array functions] 0.00011 sec x1.8 (+ 83%)
   YaLinqo 0.00041 sec x6.8 (+ 583%)
   Ginq 0.00075 sec x12.5 (+ 1150%)
   Pinq 0.00169 sec x28.2 (+ 2717%) </pre><br>  Iterators mercilessly eat up speed. <br><br>  But the terrible subsidence in speed at the last library is 30 times more noticeable.  I must warn you: this library still has time to scare numbers, so it is too early to be surprised. <br><br>  Now instead of a simple iteration, we will generate an array of consecutive numbers. <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Generating array of $ITER_MAX integers"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'consume'</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ $a = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ($i = <span class="hljs-number"><span class="hljs-number">0</span></span>; $i &lt; $ITER_MAX; $i++) $a[] = $i; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX)-&gt;toArray(); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>)-&gt;toArray(); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($ITER_MAX)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from(range(<span class="hljs-number"><span class="hljs-number">0</span></span>, $ITER_MAX - <span class="hljs-number"><span class="hljs-number">1</span></span>))-&gt;asArray(); }, ]);</code> </pre> <br>  And the results: <br><br><pre>  Generating array of 1000 integers
 ---------------------------------
   PHP [for] 0.00025 sec x1.3 (+ 32%)
   PHP [array functions] 0.00019 sec x1.0 (100%)
   YaLinqo 0.00060 sec x3.2 (+ 216%)
   Ginq 0.00107 sec x5.6 (+ 463%)
   Pinq 0.00183 sec x9.6 (+ 863%) </pre><br>  Now YaLinqo loses only twice as far as the solution in the forehead on the cycle.  Other libraries have worse results, but you can live. <br><br>  Now let's calculate the test data: calculate orders with more than five items of the order;  calculate orders that have more than two items with more than five items. <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Counting values in arrays"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $numberOrders = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;orders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $order) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) $numberOrders++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $numberOrders; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count( array_filter( $DATA-&gt;orders, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; } ) ); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;count(<span class="hljs-string"><span class="hljs-string">'$o ==&gt; count($o["items"]) &gt; 5'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;orders) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) -&gt;count(); }, ]); benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Counting values in arrays deep"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $numberOrders = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;orders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $order) { $numberItems = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) $numberItems++; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($numberItems &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>) $numberOrders++; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $numberOrders; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count( array_filter( $DATA-&gt;orders, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count( array_filter( $order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; } ) ) &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }) ); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;count(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;orders) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) -&gt;count() &gt; <span class="hljs-number"><span class="hljs-number">2</span></span>; }) -&gt;count(); }, ]);</code> </pre> <br>  Noticeably three nuances.  First, the functional style on standard array functions turns the code into a fun unreadable ladder.  Secondly, it is not possible to use string lambdas, because shielding the code inside the shielded code is the removal of the brain.  Third, Pinq does not provide a <code>count</code> function that accepts a predicate, so you have to build a chain of methods.  As it turns out later, this is far from the only limitation of Pinq: there are very few methods and they are very limited. <br><br>  See the results: <br><br><pre>  Counting values ‚Äã‚Äãin arrays
 -------------------------
   PHP [for] 0.00023 sec x1.0 (100%)
   PHP [array functions] 0.00052 sec x2.3 (+ 126%)
   YaLinqo 0.00056 sec x2.4 (+ 143%)
   YaLinqo [string lambda] 0.00059 sec x2.6 (+ 157%)
   Ginq 0.00129 sec x5.6 (+ 461%)
   Pinq 0.00382 sec x16.6 (+ 1561%)<font></font>
<font></font>
 Counting values ‚Äã‚Äãin arrays deep
 ------------------------------
   PHP [for] 0.00064 sec x1.0 (100%)
   PHP [array functions] 0.00323 sec x5.0 (+ 405%)
   YaLinqo 0.00798 sec x12.5 (+ 1147%)
   Ginq 0.01416 sec x22.1 (+ 2113%)
   Pinq 0.04928 sec x77.0 (+ 7600%) </pre><br>  The results are more or less predictable, except for the frightening result of Pinq.  I looked at the code.  The entire collection is generated there, and then <code>count()</code> is called on it ... But it's still too early to be surprised! <br><br>  Let's do the filtering.  Just like last time, but instead of counting we generate collections. <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Filtering values in arrays"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'consume'</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $filteredOrders = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;orders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $order) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) $filteredOrders[] = $order; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $filteredOrders; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_filter( $DATA-&gt;orders, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; } ); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;where(<span class="hljs-string"><span class="hljs-string">'$order ==&gt; count($order["items"]) &gt; 5'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;orders) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }); }, ]); benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Filtering values in arrays deep"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($e)</span></span></span><span class="hljs-function"> </span></span>{ consume($e, [ <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ]); }, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $filteredOrders = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;orders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $order) { $filteredItems = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $item) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>) $filteredItems[] = $item; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (count($filteredItems) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { $order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>] = $filteredItems; $filteredOrders[] = [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; $filteredItems, ]; } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $filteredOrders; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> array_filter( array_map( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; array_filter( $order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; } ) ]; }, $DATA-&gt;orders ), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; } ); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; E::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) -&gt;toArray() ]; }) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; E::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>])-&gt;where(<span class="hljs-string"><span class="hljs-string">'$v["quantity"] &gt; 5'</span></span>)-&gt;toArray() ]; }) -&gt;where(<span class="hljs-string"><span class="hljs-string">'count($v["items"]) &gt; 0'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; G::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) -&gt;toArray() ]; }) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;orders) -&gt;select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'id'</span></span> =&gt; $order[<span class="hljs-string"><span class="hljs-string">'id'</span></span>], <span class="hljs-string"><span class="hljs-string">'items'</span></span> =&gt; P::from($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($item)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $item[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">5</span></span>; }) -&gt;asArray() ]; }) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($order)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> count($order[<span class="hljs-string"><span class="hljs-string">'items'</span></span>]) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }); }, ]);</code> </pre> <br>  The code on functions for arrays is already beginning to smack.  Last but not least, due to the fact that <code>array_map</code> and <code>array_filter</code> arguments in different order, as a result, it is difficult to understand what happens <code>array_filter</code> . <br><br>  Code using queries is intentionally less optimal: objects are generated, even if they are later filtered.  This is, in general, the LINQ tradition, which involves the creation of ‚Äúanonymous types‚Äù along the way with intermediate results of calculations. <br><br>  The results, when compared with previous tests, are quite even: <br><br><pre>  Filtering values ‚Äã‚Äãin arrays
 --------------------------
   PHP [for] 0.00049 sec x1.0 (100%)
   PHP [array functions] 0.00072 sec x1.5 (+ 47%)
   YaLinqo 0.00094 sec x1.9 (+ 92%)
   YaLinqo [string lambda] 0.00094 sec x1.9 (+ 92%)
   Ginq 0.00295 sec x6.0 (+ 502%)
   Pinq 0.00328 sec x6.7 (+ 569%)<font></font>
<font></font>
 Filtering values ‚Äã‚Äãin arrays deep
 -------------------------------
   PHP [for] 0.00514 sec x1.0 (100%)
   PHP [array functions] 0.00739 sec x1.4 (+ 44%)
   YaLinqo 0.01556 sec x3.0 (+ 203%)
   YaLinqo [string lambda] 0.01750 sec x3.4 (+ 240%)
   Ginq 0.03101 sec x6.0 (+ 503%)
   Pinq 0.05435 sec x10.6 (+ 957%) </pre><br>  Let's proceed to sorting: <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Sorting arrays"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'consume'</span></span>, [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $orderedUsers = $DATA-&gt;users; usort( $orderedUsers, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ $diff = $a[<span class="hljs-string"><span class="hljs-string">'rating'</span></span>] - $b[<span class="hljs-string"><span class="hljs-string">'rating'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($diff !== <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -$diff; $diff = strcmp($a[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], $b[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($diff !== <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $diff; $diff = $a[<span class="hljs-string"><span class="hljs-string">'id'</span></span>] - $b[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $diff; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $orderedUsers; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;users) -&gt;orderByDescending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'rating'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;users)-&gt;orderByDescending(<span class="hljs-string"><span class="hljs-string">'$v["rating"]'</span></span>)-&gt;thenBy(<span class="hljs-string"><span class="hljs-string">'$v["name"]'</span></span>)-&gt;thenBy(<span class="hljs-string"><span class="hljs-string">'$v["id"]'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;users) -&gt;orderByDesc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'rating'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }); }, <span class="hljs-string"><span class="hljs-string">"property path"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;users)-&gt;orderByDesc(<span class="hljs-string"><span class="hljs-string">'[rating]'</span></span>)-&gt;thenBy(<span class="hljs-string"><span class="hljs-string">'[name]'</span></span>)-&gt;thenBy(<span class="hljs-string"><span class="hljs-string">'[id]'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;users) -&gt;orderByDescending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'rating'</span></span>]; }) -&gt;thenByAscending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;thenByAscending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }); }, ]);</code> </pre> <br>  The code comparing functions for <code>usort</code> ugly, but, <code>usort</code> adjusted, you can write such functions without thinking.  Sorting with LINQ looks almost perfectly clean.  This is also the first time that you can take advantage of the pleasures of ‚Äúaccess to properties‚Äù in Ginq - the code can no longer be made more beautiful. <br><br>  The results are surprising: <br><br><pre>  Sorting arrays
 --------------
   PHP 0.00037 sec x1.0 (100%)
   YaLinqo 0.00161 sec x4.4 (+ 335%)
   YaLinqo [string lambda] 0.00163 sec x4.4 (+ 341%)
   Ginq 0.00402 sec x10.9 (+ 986%)
   Ginq [property path] 0.01998 sec x54.0 (+ 5300%)
   Pinq 0.00132 sec x3.6 (+ 257%) </pre><br>  First of all, Pinq takes the lead, albeit slightly.  Spoiler: it happened the first and last time. <br><br>  Secondly, access to properties in Ginq terrifyingly sagging performance, that is, in the real code of this feature will not take advantage.  Syntax is not worth the loss of speed 50 times. <br><br>  Go to the fun - joints, aka the connection of two collections by key. <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Joining arrays"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-string"><span class="hljs-string">'consume'</span></span>, [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $usersByIds = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;users <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $user) $usersByIds[$user[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]][] = $user; $pairs = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;orders <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $order) { $id = $order[<span class="hljs-string"><span class="hljs-string">'customerId'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($usersByIds[$id])) { <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($usersByIds[$id] <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $user) { $pairs[] = [ <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; $order, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $user, ]; } } } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $pairs; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;join($DATA-&gt;users, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $o[<span class="hljs-string"><span class="hljs-string">'customerId'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o, $u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; $o, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $u, ]; }); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;orders) -&gt;join($DATA-&gt;users, <span class="hljs-string"><span class="hljs-string">'$o ==&gt; $o["customerId"]'</span></span>, <span class="hljs-string"><span class="hljs-string">'$u ==&gt; $u["id"]'</span></span>, <span class="hljs-string"><span class="hljs-string">'($o, $u) ==&gt; [ "order" =&gt; $o, "user" =&gt; $u, ]'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;join($DATA-&gt;users, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $o[<span class="hljs-string"><span class="hljs-string">'customerId'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o, $u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; $o, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $u, ]; }); }, <span class="hljs-string"><span class="hljs-string">"property path"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;orders) -&gt;join($DATA-&gt;users, <span class="hljs-string"><span class="hljs-string">'[customerId]'</span></span>, <span class="hljs-string"><span class="hljs-string">'[id]'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o, $u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; $o, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $u, ]; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;orders) -&gt;join($DATA-&gt;users) -&gt;onEquality( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $o[<span class="hljs-string"><span class="hljs-string">'customerId'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $u[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; } ) -&gt;to(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($o, $u)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [ <span class="hljs-string"><span class="hljs-string">'order'</span></span> =&gt; $o, <span class="hljs-string"><span class="hljs-string">'user'</span></span> =&gt; $u, ]; }); }, ]);</code> </pre> <br>  Pinq syntactically stood out, where one function is essentially divided into several calls.  This is probably more readable, but for LINQ methods that are used to chaining, this syntax may be less common. <br><br>  And ... the results: <br><br><pre>  Joining arrays
 --------------
   PHP 0.00021 sec x1.0 (100%)
   YaLinqo 0.00065 sec x3.1 (+ 210%)
   YaLinqo [string lambda] 0.00070 sec x3.3 (+ 233%)
   Ginq 0.00103 sec x4.9 (+ 390%)
   Ginq [property path] 0.00200 sec x9.5 (+ 852%)
   Pinq 1.24155 sec x5,911.8 (+ 591084%) </pre><br>  No, there is no error.  Pinq really kills speed six thousand times.  At first, I thought the script was hanging, but in the end it ended, and I gave this unimaginable number.  I did not find where in the Pinq source code is the code for this set of functions, but I have a feeling that there is for-for-if without arrays of dictionaries.  So much for the OOP. <br><br>  Consider another simple test - aggregation (or accumulation, or convolution - whatever you like): <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Aggregating arrays"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [ <span class="hljs-string"><span class="hljs-string">"for"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $p) $sum += $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; $avg = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $p) $avg += $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; $avg /= count($DATA-&gt;products); $min = PHP_INT_MAX; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $p) $min = min($min, $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]); $max = -PHP_INT_MAX; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $p) $max = max($max, $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, <span class="hljs-string"><span class="hljs-string">"array functions"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = array_sum(array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }, $DATA-&gt;products)); $avg = array_sum(array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }, $DATA-&gt;products)) / count($DATA-&gt;products); $min = min(array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }, $DATA-&gt;products)); $max = max(array_map(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }, $DATA-&gt;products)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = E::from($DATA-&gt;products)-&gt;sum(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $avg = E::from($DATA-&gt;products)-&gt;average(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $min = E::from($DATA-&gt;products)-&gt;min(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $max = E::from($DATA-&gt;products)-&gt;max(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = E::from($DATA-&gt;products)-&gt;sum(<span class="hljs-string"><span class="hljs-string">'$v["quantity"]'</span></span>); $avg = E::from($DATA-&gt;products)-&gt;average(<span class="hljs-string"><span class="hljs-string">'$v["quantity"]'</span></span>); $min = E::from($DATA-&gt;products)-&gt;min(<span class="hljs-string"><span class="hljs-string">'$v["quantity"]'</span></span>); $max = E::from($DATA-&gt;products)-&gt;max(<span class="hljs-string"><span class="hljs-string">'$v["quantity"]'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = G::from($DATA-&gt;products)-&gt;sum(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $avg = G::from($DATA-&gt;products)-&gt;average(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $min = G::from($DATA-&gt;products)-&gt;min(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $max = G::from($DATA-&gt;products)-&gt;max(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, <span class="hljs-string"><span class="hljs-string">"property path"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = G::from($DATA-&gt;products)-&gt;sum(<span class="hljs-string"><span class="hljs-string">'[quantity]'</span></span>); $avg = G::from($DATA-&gt;products)-&gt;average(<span class="hljs-string"><span class="hljs-string">'[quantity]'</span></span>); $min = G::from($DATA-&gt;products)-&gt;min(<span class="hljs-string"><span class="hljs-string">'[quantity]'</span></span>); $max = G::from($DATA-&gt;products)-&gt;max(<span class="hljs-string"><span class="hljs-string">'[quantity]'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $sum = P::from($DATA-&gt;products)-&gt;sum(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $avg = P::from($DATA-&gt;products)-&gt;average(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $min = P::from($DATA-&gt;products)-&gt;minimum(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); $max = P::from($DATA-&gt;products)-&gt;maximum(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-string"><span class="hljs-string">"$sum-$avg-$min-$max"</span></span>; }, ]); benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Aggregating arrays custom"</span></span>, <span class="hljs-number"><span class="hljs-number">100</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">null</span></span>, [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $mult = <span class="hljs-number"><span class="hljs-number">1</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $p) $mult *= $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $mult; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;products)-&gt;aggregate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a * $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }, <span class="hljs-number"><span class="hljs-number">1</span></span>); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;products)-&gt;aggregate(<span class="hljs-string"><span class="hljs-string">'$a * $v["quantity"]'</span></span>, <span class="hljs-number"><span class="hljs-number">1</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;products)-&gt;aggregate(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a * $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;products) -&gt;select(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($p)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $p[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }) -&gt;aggregate(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $q)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $a * $q; }); }, ]);</code> </pre> <br>  There is nothing special to explain in the first set of functions.  The only thing is that I divided the calculation into separate passes in all cases. <br><br>  In the second set, the product is calculated.  Pinq failed again: it does not provide an overload that accepts a starting value, instead it always takes the first element (and returns null if there are no elements, and does not throw an exception ...), as a result, you have to add values ‚Äã‚Äãfurther. <br><br>  Results: <br><br><pre>  Aggregating arrays
 ------------------
   PHP [for] 0.00059 sec x1.0 (100%)
   PHP [array functions] 0.00193 sec x3.3 (+ 227%)
   YaLinqo 0.00475 sec x8.1 (+ 705%)
   YaLinqo [string lambda] 0.00515 sec x8.7 (+ 773%)
   Ginq 0.00669 sec x11.3 (+ 1034%)
   Ginq [property path] 0.03955 sec x67.0 (+ 6603%)
   Pinq 0.03226 sec x54.7 (+ 5368%)<font></font>
<font></font>
 Aggregating arrays custom
 -------------------------
   PHP 0.00007 sec x1.0 (100%)
   YaLinqo 0.00046 sec x6.6 (+ 557%)
   YaLinqo [string lambda] 0.00057 sec x8.1 (+ 714%)
   Ginq 0.00046 sec x6.6 (+ 557%)
   Pinq 0.00610 sec x87.1 (+ 8615%) </pre><br>  Pinq and string properties in Ginq showed awful results, YaLinqo saddened, built-in functions saddened no less.  For taxis. <br><br>  Well, for dessert, an example from ReadMe YaLinqo - request with all the functions combined: <br><br><pre> <code class="php hljs">benchmark_linq_groups(<span class="hljs-string"><span class="hljs-string">"Process data from ReadMe example"</span></span>, <span class="hljs-number"><span class="hljs-number">5</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($e)</span></span></span><span class="hljs-function"> </span></span>{ consume($e, [ <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">null</span></span> ]); }, [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ $productsSorted = [ ]; <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($DATA-&gt;products <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $product) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($product[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">empty</span></span>($productsSorted[$product[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]])) $productsSorted[$product[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]] = [ ]; $productsSorted[$product[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]][] = $product; } } <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($productsSorted <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $catId =&gt; $products) { usort($productsSorted[$catId], <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ $diff = $a[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] - $b[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($diff != <span class="hljs-number"><span class="hljs-number">0</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> -$diff; $diff = strcmp($a[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], $b[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $diff; }); } $result = [ ]; $categoriesSorted = $DATA-&gt;categories; usort($categoriesSorted, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($a, $b)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> strcmp($a[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], $b[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]); }); <span class="hljs-keyword"><span class="hljs-keyword">foreach</span></span> ($categoriesSorted <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $category) { $categoryId = $category[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; $result[$category[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]] = [ <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $category[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">isset</span></span>($productsSorted[$categoryId]) ? $productsSorted[$categoryId] : [ ], ]; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $result; }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;categories) -&gt;orderBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;groupJoin( from($DATA-&gt;products) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }) -&gt;orderByDescending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat, $prods)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; $prods ); } ); }, <span class="hljs-string"><span class="hljs-string">"string lambda"</span></span> =&gt; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> E::from($DATA-&gt;categories) -&gt;orderBy(<span class="hljs-string"><span class="hljs-string">'$cat ==&gt; $cat["name"]'</span></span>) -&gt;groupJoin( from($DATA-&gt;products) -&gt;where(<span class="hljs-string"><span class="hljs-string">'$prod ==&gt; $prod["quantity"] &gt; 0'</span></span>) -&gt;orderByDescending(<span class="hljs-string"><span class="hljs-string">'$prod ==&gt; $prod["quantity"]'</span></span>) -&gt;thenBy(<span class="hljs-string"><span class="hljs-string">'$prod ==&gt; $prod["name"]'</span></span>), <span class="hljs-string"><span class="hljs-string">'$cat ==&gt; $cat["id"]'</span></span>, <span class="hljs-string"><span class="hljs-string">'$prod ==&gt; $prod["catId"]'</span></span>, <span class="hljs-string"><span class="hljs-string">'($cat, $prods) ==&gt; [ "name" =&gt; $cat["name"], "products" =&gt; $prods ]'</span></span>); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> G::from($DATA-&gt;categories) -&gt;orderBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;groupJoin( G::from($DATA-&gt;products) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }) -&gt;orderByDesc(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }) -&gt;thenBy(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }), <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat, $prods)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; $prods ); } ); }, ], [ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">use</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($DATA)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> P::from($DATA-&gt;categories) -&gt;orderByAscending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) -&gt;groupJoin( P::from($DATA-&gt;products) -&gt;where(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>] &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>; }) -&gt;orderByDescending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'quantity'</span></span>]; }) -&gt;thenByAscending(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'name'</span></span>]; }) ) -&gt;onEquality( <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $cat[<span class="hljs-string"><span class="hljs-string">'id'</span></span>]; }, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($prod)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> $prod[<span class="hljs-string"><span class="hljs-string">'catId'</span></span>]; } ) -&gt;to(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($cat, $prods)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">array</span></span>( <span class="hljs-string"><span class="hljs-string">'name'</span></span> =&gt; $cat[<span class="hljs-string"><span class="hljs-string">'name'</span></span>], <span class="hljs-string"><span class="hljs-string">'products'</span></span> =&gt; $prods ); }); }, ]);</code> </pre> <br>  The code on PHP naked is written by common efforts here on Habr√©. <br><br>  Results: <br><br><pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Process data from ReadMe example
</font></font> --------------------------------<font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  PHP 0.00620 sec x1.0 (100%)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  YaLinqo 0.02840 sec x4.6 (+ 358%)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  YaLinqo [string lambda] 0.02920 sec x4.7 (+ 371%)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Ginq 0.07720 sec x12.5 (+ 1145%)</font></font><font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
  Pinq 2.71616 sec x438.1 (+ 43707%) </font></font></pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GroupJoin killed Pinq performance. </font><font style="vertical-align: inherit;">The rest showed more or less expected results. </font></font><br><br> <b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">More about libraries</font></font></b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Since Pinq is the only library presented that can generate SQL queries using PHP, the article will be incomplete if you do not consider this possibility. </font><font style="vertical-align: inherit;">Unfortunately, as it turned out, the only provider is for MySQL, while it is in the form of a ‚Äúdemonstration‚Äù. </font><font style="vertical-align: inherit;">In fact, this feature is declared and can be implemented on the basis of Pinq, but in fact it is impossible to use it.</font></font><br><br>  <b>findings</b> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If you need to quickly filter a hundred or two of the results obtained from a web service, the LINQ libraries are quite capable of satisfying the need. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Among libraries, the undisputed performance winner is YaLinqo. If you need to filter objects using queries, then this is the most logical choice. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ginq may appeal to those who prefer not to use chains of methods, but nested iterators. I do not know if there are such lovers of SPL iterators. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pinq turned out to be a monstrous library, in which some of the features are implemented disgustingly, despite the many layers of abstraction. This library has potential due to the support of queries to the database, but at the moment it remains unfulfilled.</font></font><br><br>     ,        ‚Äî PHPLinq.        ,     ORM . <br><br>  <b>Links</b> <br><br><ul><li> <a href="https://github.com/Athari/YaLinqo"><b>YaLinqo</b></a> ‚Äî  YaLinqo </li><li> <a href="http://athari.github.io/YaLinqo"><b>YaLinqo Docs</b></a> ‚Äî    YaLinqo </li><li> <a href="https://github.com/Athari/YaLinqoPerf">YaLinqo Perf</a> ‚Äî    YaLinqo, Ginq, Pinq </li><li> <a href="https://github.com/akanehara/ginq">Ginq</a> ‚Äî  Ginq </li><li> <a href="https://github.com/TimeToogo/Pinq">Pinq</a> ‚Äî  Pinq </li></ul></div><p>Source: <a href="https://habr.com/ru/post/259155/">https://habr.com/ru/post/259155/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../259145/index.html">Prototype OOP for Lua</a></li>
<li><a href="../259147/index.html">Network Evolution - New 25/50/100 GbE Standard</a></li>
<li><a href="../259149/index.html">SonarQube. We check the code for quality</a></li>
<li><a href="../259151/index.html">Unicorn in search of extraterrestrial intelligence: an analysis of the SETI @ home code</a></li>
<li><a href="../259153/index.html">A few tips on OpenMP</a></li>
<li><a href="../259161/index.html">How to make a portable repair server</a></li>
<li><a href="../259163/index.html">DevConf 2015: Interview with the author - there will be no PHP6! Meet PHP7</a></li>
<li><a href="../259165/index.html">Making a Callback from the site using Askozia PBX</a></li>
<li><a href="../259167/index.html">XSD Design Patterns</a></li>
<li><a href="../259169/index.html">A way to make iptables write to your log and not duplicate to the system</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>