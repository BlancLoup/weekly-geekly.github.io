<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Object versioning in S3</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hello! 

 Today I want to share the results of my research on the versioning of objects in S3. I heard about this feature for a long time, but did not...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Object versioning in S3</h1><div class="post__text post__text-html js-mediator-article">  Hello! <img src="https://habrastorage.org/storage2/de2/8d5/cd3/de28d5cd30892edd8b0d669b656dfede.png" alt="image" align="right"><br><br>  Today I want to share the results of my research on the versioning of objects in S3.  I heard about this feature for a long time, but did not know much.  And even now I don‚Äôt really know much - I‚Äôll tell you how to enable versioning in bucket and getting objects of different versions. <br><br>  My research has shown that this function is not particularly in demand, and there are no ready-made free tools for versioning at all.  But there are libraries that have this functionality.  Need - develop, they say. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, for versioning, in the bucket we first need to enable it.  There are 2 ways to do this, and both are tied to the API. <br><ul><li>  Net REST / SOAP Request </li><li>  Through the library </li></ul><br>  I will use the Ruby library <b>aws-sdk</b> , which we will install: <br><pre><code class="bash hljs">$ gem install aws-sdk</code> </pre> <a name="habracut"></a><br>  After that, log in to the Ruby console: <br><pre> <code class="bash hljs">$ irb</code> </pre><br>  Next, log in and enable versioning for the bucket: <br><pre> <code class="ruby hljs"><span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">'aws-sdk'</span></span> s3 = AWS::S3.new( <span class="hljs-symbol"><span class="hljs-symbol">:access_key_id</span></span> =&gt; ENV[<span class="hljs-string"><span class="hljs-string">'AMAZON_ACCESS_KEY_ID'</span></span>], <span class="hljs-symbol"><span class="hljs-symbol">:secret_access_key</span></span> =&gt; ENV[<span class="hljs-string"><span class="hljs-string">'AMAZON_SECRET_ACCESS_KEY'</span></span>] ) my_bucket=s3.buckets[<span class="hljs-string"><span class="hljs-string">'epamcccctesting'</span></span>] my_bucket.enable_versioning</code> </pre><br>  I think that you know what the environment variables AMAZON_ACCESS_KEY_ID and AMAZON_SECRET_ACCESS_KEY mean - we will not dwell on them. <br><br>  So, in the console, we will see that versioning is enabled: <br><img src="https://habrastorage.org/storage2/41f/344/79f/41f34479ff7d9ae50388f2ced592f579.png" alt="image"><br><br>  So, how does the versioning happen?  Yes, just.  AWS, when trying to replace a file, does not replace it, but assigns a new version, which is given in the POST requester headers.  Well, or in the parameters in the library. <br><br>  Versions look like this: <br><pre> <code class="ruby hljs">x-amz-version-<span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> mHYT.SyFXgHoG6xCy5yQVk6n6riJct4u x-amz-version-<span class="hljs-symbol"><span class="hljs-symbol">id:</span></span> .KSpevNIkZSgBoCz4vU3iTBttGWXWqIc</code> </pre><br><br>  After this GET request, you can access the version of the file of interest by inserting in the getter parameters versionId.  Without this parameter, we will get the latest version of this file. <br><br>  <b>Example:</b> I uploaded 3 versions of the file into the bakt and received different versions in headers.  You can get these versions from the following links: <br><ul><li>  <a href="http://hurl.quickblox.com/hurls/cacbcc38f80428f52158cda58ac82403199c02be/5343347e7b0590b7f82f9c0bd446735db143daa8">6Txnrqbcb4LaXo2MGYP9gn61Em0UIrUq</a> </li><li>  <a href="http://hurl.quickblox.com/hurls/f99258c9c10b0ef06d1187f2fbae76a37ce66ffb/1e57adfcadf6122f8b9e9162cd47979eef8831f3">s73raBjbDF2pZpQT9o4qPu4Yn0piy1wL</a> </li><li>  <a href="http://hurl.quickblox.com/hurls/7e5366df809238151d734b774910b9c3fcee10d8/09a394fecc223d827163c06f860033de38269778">NQc0gba0nv6znIfSHRaxR0fT3I.ZaUQ5</a> </li></ul><br>  It's pretty simple.  Deleting a file is also done with the versionId parameter. <br><br>  In general, it is clear that the functionality is there, but it is not clear why it is still not widely used and there is no normal and convenient implementation for the CLI.  For example, backup storage would be convenient.  You can also find a dozen examples where file versioning would be a very convenient and simple solution. <br><br>  Maybe you use versioning somewhere?  Tell something interesting? <br><br>  <b>UPD</b> : For example, displaying versions of an object with dates and sizes: <br><pre> <code class="ruby hljs">my_bucket=s3.buckets[<span class="hljs-string"><span class="hljs-string">'epamcccctesting'</span></span>] file = my_bucket.objects[<span class="hljs-string"><span class="hljs-string">"file"</span></span>] file.versions.each <span class="hljs-keyword"><span class="hljs-keyword">do</span></span> <span class="hljs-params"><span class="hljs-params">|version|</span></span> puts version.head[<span class="hljs-symbol"><span class="hljs-symbol">:last_modified</span></span>].to_s + <span class="hljs-string"><span class="hljs-string">' '</span></span> + version.version_id + <span class="hljs-string"><span class="hljs-string">' '</span></span> + version.head[<span class="hljs-symbol"><span class="hljs-symbol">:content_length</span></span>].to_s + <span class="hljs-string"><span class="hljs-string">' bytes'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">end</span></span> <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">15</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">11</span></span> +<span class="hljs-number"><span class="hljs-number">0200</span></span> NQc0gba0nv6znIfSHRaxR0fT3I.ZaUQ5 <span class="hljs-number"><span class="hljs-number">4</span></span> bytes <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">14</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">52</span></span> +<span class="hljs-number"><span class="hljs-number">0200</span></span> s73raBjbDF2pZpQT9o4qPu4Yn0piy1wL <span class="hljs-number"><span class="hljs-number">3</span></span> bytes <span class="hljs-number"><span class="hljs-number">2012</span></span>-<span class="hljs-number"><span class="hljs-number">12</span></span>-<span class="hljs-number"><span class="hljs-number">20</span></span> <span class="hljs-number"><span class="hljs-number">16</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">13</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-number"><span class="hljs-number">59</span></span> +<span class="hljs-number"><span class="hljs-number">0200</span></span> <span class="hljs-number"><span class="hljs-number">6</span></span>Txnrqbcb4LaXo2MGYP9gn61Em0UIrUq <span class="hljs-number"><span class="hljs-number">2</span></span> bytes</code> </pre><br><br>  UPD: Recently, versioning can be enabled via the console: <br><img src="https://habrastorage.org/storage2/a1e/e22/0a8/a1ee220a8b1c652f105f08e886ccf608.png" alt="image"></div><p>Source: <a href="https://habr.com/ru/post/163361/">https://habr.com/ru/post/163361/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../163343/index.html">Appnique debuts with a new service that will help developers with ASO</a></li>
<li><a href="../163345/index.html">Recursive Zopo Zp500 + Review, God Forgive Libero</a></li>
<li><a href="../163353/index.html">Contest LG Smart TV Apps Contest 2012 extended for 2 months</a></li>
<li><a href="../163355/index.html">A bit about hosting users and their needs</a></li>
<li><a href="../163357/index.html">HP 655 laptop video review</a></li>
<li><a href="../163365/index.html">Creating a convenient CAE system based on pre / post-processor GiD and any calculation program</a></li>
<li><a href="../163369/index.html">Help, we are captured</a></li>
<li><a href="../163371/index.html">High Frequency Trading (HFT) using FPGA</a></li>
<li><a href="../163373/index.html">Its game with JavaScript and Canvas</a></li>
<li><a href="../163375/index.html">Store on Guideman - discount for Habrahabra</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>