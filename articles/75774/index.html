<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Making a Twitter mash-up and Google Maps in 20 minutes on Grails</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 For many Java developers, it is often synonymous with badly boring enterprise applications. It is associated with numerous XML configur...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Making a Twitter mash-up and Google Maps in 20 minutes on Grails</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  For many Java developers, it is often synonymous with badly boring enterprise applications.  It is associated with numerous XML configuration files, sample code, etc.  Therefore, as a rule, instead of it, developers use dynamic languages ‚Äã‚Äã(such as Ruby, Python, PHP) to develop their projects, especially for simple utilities, mesh-ups, etc. <br><br>  However, in the Java environment, much has changed in the last few years.  There are a lot of frameworks that free the developer from the burden of corporate ("enterprise") applications.  Grails is probably one of the best.  It is based on Groovy, a dynamic language on the Java platform.  Groovy is designed specifically for Java programmers and the transition to it is as painless as possible.  Grails uses well-known, reliable, and efficient Java libraries (Spring, Hibernate, etc.) to do all the hard work.  There is also a plugin system and plugins for almost all widely used Java libraries. <br><br>  In this post I will explain how to make a mash-up from Twitter and Google Maps in just 20 minutes.  The end result will look something like this: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5c9/a52/4b4/5c9a524b4e66252571dc2e3b9d9cd7f2.png" alt="Geo Twitter Complete"></a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br><h4>  Preparing the development environment </h4><br>  First, it would be nice to make sure that the correct version of the JDK is installed.  It's best to just download the latest version of the JDK <a href="http://java.sun.com/javase/downloads/index.jsp">here</a> . <br>  Install it and set the <code>JAVA_HOME</code> environment variable so that it points to the installation directory. <br><br>  Then download the latest Grails release <a href="http://grails.org/Download">from here</a> . <br>  Unpack the archive in any place, and then set the environment variable <code>GRAILS_HOME</code> so that it points to the directory in which the archive was unpacked.  Also make sure that the <code>bin/</code> directory of the Grails installation directory is mentioned in the PATH environment variable. <br><br>  After completing the above steps, it will be possible to run the Grails commands in the console.  You can type <code>grails help</code> to check it out.  A list of available commands should appear. <br><br><h4>  Basic concepts </h4><br>  Grails is based on <a href="http://en.wikipedia.org/wiki/Model%25E2%2580%2593view%25E2%2580%2593controller">the MVC design pattern</a> .  The model is presented in domain-classes, controllers by controller classes, mapping by GSP pages.  In this project, only the controller classes and GSP are used, since the model is provided by the Twitter API. <br><br>  It does not hurt to read the <a href="http://grails.org/Quick%2BStart">quick</a> start <a href="http://grails.org/Quick%2BStart">guide</a> .  Additional information is available in <a href="http://grails.org/doc/latest/">the user manual</a> .  In particular, this post is useful information about the <a href="http://grails.org/doc/latest/guide/6.%2520The%2520Web%2520Layer.html">controllers</a> and <a href="http://grails.org/doc/latest/guide/6.%2520The%2520Web%2520Layer.html">GSP</a> . <br><br><h4>  Creating an application framework </h4><br>  One of the capabilities of Grails that frees a developer from the ‚Äúenterprise‚Äù burden of Java is the ability to automatically generate the framework of the main application. <br>  To do this just type: <br><br> <code>grails create-app geo_twitter</code> <br> <br>  This will create the <code>geo_twitter</code> application in the current working directory.  Go to this directory for all further steps. <br><br><h4>  Getting Started with Google Maps </h4><br>  <a href="http://code.google.com/intl/ru/apis/maps/documentation/">Google Maps integration</a> is simple and well supported by Google.  However, you first need to <a href="http://code.google.com/intl/ru/apis/maps/signup.html">get an API key</a> to access all services.  Do not worry - it's easy, fast and free. <br><br>  To begin with, it would be nice to clean up the main layout template (layout) - you can remove the Grails logo, etc.  Open <code>grails-app/views/layout/main.gsp</code> and fix it to look like this: <br><br><blockquote> <code><font color="#008000"><strong>&lt;html&gt;</strong></font> <br> <font color="#008000"><strong>&lt;head&gt;</strong></font> <br> <font color="#008000"><strong>&lt;title&gt;&lt;g:layoutTitle</strong></font> <font color="#7D9029">default=</font> <font color="#BA2121">"Grails"</font> <font color="#008000"><strong>/&gt;&lt;/title&gt;</strong></font> <br> <font color="#008000"><strong>&lt;link</strong></font> <font color="#7D9029">rel=</font> <font color="#BA2121">"stylesheet"</font> <font color="#7D9029">href=</font> <font color="#BA2121">"${resource(dir:'css',file:'main.css')}"</font> <font color="#008000"><strong>/&gt;</strong></font> <br> <font color="#008000"><strong>&lt;link</strong></font> <font color="#7D9029">rel=</font> <font color="#BA2121">"shortcut icon"</font> <font color="#7D9029">href=</font> <font color="#BA2121">"${resource(dir:'images',file:'favicon.ico')}"</font> <font color="#7D9029">type=</font> <font color="#BA2121">"image/x-icon"</font> <font color="#008000"><strong>/&gt;</strong></font> <br> <font color="#008000"><strong>&lt;g:layoutHead</strong></font> <font color="#008000"><strong>/&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/head&gt;</strong></font> <br> <font color="#008000"><strong>&lt;body&gt;</strong></font> <br> <font color="#008000"><strong>&lt;g:layoutBody</strong></font> <font color="#008000"><strong>/&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/body&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/html&gt;</strong></font> <br></code> </blockquote><br><br>  Then edit <code>grails-app/views/index.gsp</code> to integrate Google Maps like this: <br><br><blockquote> <code><a href="http://www.google.com/jsapi%3Fkey%3DYOUR_GOOGLE_MAPS_API_KEY%2522"></a> <font color="#008000"><strong>&lt;html&gt;</strong></font> <br> <font color="#008000"><strong>&lt;head&gt;</strong></font> <br> <font color="#008000"><strong>&lt;title&gt;</strong></font> Welcome to GeoTwitter! <font color="#008000"><strong>&lt;/title&gt;</strong></font> <br> <font color="#008000"><strong>&lt;meta</strong></font> <font color="#7D9029">name=</font> <font color="#BA2121">"layout"</font> <font color="#7D9029">content=</font> <font color="#BA2121">"main"</font> <font color="#008000"><strong>/&gt;</strong></font> <br> <br> <font color="#008000"><strong>&lt;script</strong></font> <font color="#7D9029">src=</font> <font color="#BA2121">"www.google.com/jsapi?key=YOUR_GOOGLE_MAPS_API_KEY"</font> <font color="#7D9029">type=</font> <font color="#BA2121">"text/javascript"</font> <font color="#008000"><strong>&gt;&lt;/script&gt;</strong></font> <br> <br> <font color="#008000"><strong>&lt;script</strong></font> <font color="#7D9029">type=</font> <font color="#BA2121">"text/javascript"</font> <font color="#008000"><strong>&gt;</strong></font> <br> google.load("maps", "2.x"); <br> google.load("jquery", "1.3.1"); <br> <br> google.setOnLoadCallback(function() { <br> $(document).ready(function() { <br> var map = new GMap2(document.getElementById('map')); <br> var vinnitsa = new GLatLng(49.2325477, 28.4744695); // Replace this by coordinates of your own city ;) <br> map.setCenter(vinnitsa, 8); <br> map.addControl(new GLargeMapControl()); <br> }); <br> }); <br> <font color="#008000"><strong>&lt;/script&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/head&gt;</strong></font> <br> <font color="#008000"><strong>&lt;body&gt;</strong></font> <br> <font color="#008000"><strong>&lt;div</strong></font> <font color="#7D9029">id=</font> <font color="#BA2121">"map"</font> <font color="#7D9029">style=</font> <font color="#BA2121">"width:800px; height:600px"</font> <font color="#008000"><strong>&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/div&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/body&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/html&gt;</strong></font> <br></code> </blockquote><br><br>  The end result will look something like this: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/d4b/0c1/78a/d4b0c178aecdf6126d18d5fec6eb8868.png" alt="Geo Twitter Start"></a> <br><br><h4>  Twitter form and layout </h4><br>  Add a simple username form to the <code>index.gsp</code> page. <br><br><blockquote> <code><font color="#008000"><strong>&lt;div</strong></font> <font color="#7D9029">class=</font> <font color="#BA2121">"form"</font> <font color="#008000"><strong>&gt;</strong></font> <br> <font color="#008000"><strong>&lt;form</strong></font> <font color="#7D9029">action=</font> <font color="#BA2121">""</font> <font color="#7D9029">id=</font> <font color="#BA2121">"twitter"</font> <font color="#008000"><strong>&gt;</strong></font> <br> <font color="#008000"><strong>&lt;p&gt;</strong></font> <br> <font color="#008000"><strong>&lt;label&gt;</strong></font> twitter id: <font color="#008000"><strong>&lt;/label&gt;</strong></font> <br> <font color="#008000"><strong>&lt;input</strong></font> <font color="#7D9029">type=</font> <font color="#BA2121">"text"</font> <font color="#7D9029">id=</font> <font color="#BA2121">"name"</font> <font color="#7D9029">name=</font> <font color="#BA2121">"name"</font> <font color="#7D9029">value=</font> <font color="#BA2121">""</font> <font color="#008000"><strong>/&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/p&gt;</strong></font> <br> <font color="#008000"><strong>&lt;p</strong></font> <font color="#7D9029">class=</font> <font color="#BA2121">"submit"</font> <font color="#008000"><strong>&gt;</strong></font> <br> <font color="#008000"><strong>&lt;input</strong></font> <font color="#7D9029">type=</font> <font color="#BA2121">"submit"</font> <font color="#7D9029">value=</font> <font color="#BA2121">"Map my friends!"</font> <font color="#008000"><strong>&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/p&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/form&gt;</strong></font> <br> <font color="#008000"><strong>&lt;/div&gt;</strong></font> <br></code> </blockquote><br><br>  Then replace the main styles in <code>web-app/css/main.css</code> with something like this: <br><br><blockquote> <code><font color="#008000"><strong>body</strong></font> { <br> <font color="#008000"><strong>font-family</strong></font> <font color="#666666">:</font> Verdana <font color="#666666">,</font> Helvetica <font color="#666666">,</font> <font color="#008000"><strong>sans-serif</strong></font> ; <br> <font color="#008000"><strong>margin</strong></font> <font color="#666666">:</font> <font color="#666666">1em</font> ; <br> } <br> <br> <font color="#0000FF">#map</font> { <br> <font color="#008000"><strong>position</strong></font> <font color="#666666">:</font> <font color="#008000"><strong>absolute</strong></font> ; <br> <font color="#008000"><strong>width</strong></font> <font color="#666666">:</font> <font color="#666666">800px</font> ; <br> <font color="#008000"><strong>height</strong></font> <font color="#666666">:</font> <font color="#666666">600px</font> ; <br> <font color="#008000"><strong>left</strong></font> <font color="#666666">:</font> <font color="#666666">19em</font> ; <br> <font color="#008000"><strong>top</strong></font> <font color="#666666">:</font> <font color="#666666">1em</font> ; <br> } <br> <br> <font color="#0000FF"><strong>.form</strong></font> { <br> <font color="#008000"><strong>border</strong></font> <font color="#666666">:</font> <font color="#666666">1px</font> <font color="#008000"><strong>dashed</strong></font> <font color="#008000">gray</font> ; <br> <font color="#008000"><strong>width</strong></font> <font color="#666666">:</font> <font color="#666666">15em</font> ; <br> <font color="#008000"><strong>padding</strong></font> <font color="#666666">:</font> <font color="#666666">0.5em</font> ; <br> } <br> <br> <font color="#0000FF"><strong>.form</strong></font> <font color="#008000"><strong>label</strong></font> { <br> <font color="#008000"><strong>width</strong></font> <font color="#666666">:</font> <font color="#666666">7em</font> ; <br> <font color="#008000"><strong>display</strong></font> <font color="#666666">:</font> <font color="#008000"><strong>block</strong></font> ; <br> <font color="#008000"><strong>float</strong></font> <font color="#666666">:</font> <font color="#008000"><strong>left</strong></font> ; <br> } <br> <br> <font color="#0000FF"><strong>.form</strong></font> <font color="#008000"><strong>input</strong></font> { <br> <font color="#008000"><strong>width</strong></font> <font color="#666666">:</font> <font color="#666666">10em</font> ; <br> } <br> <br> <font color="#0000FF"><strong>.form</strong></font> <font color="#0000FF"><strong>.submit</strong></font> { <br> <font color="#008000"><strong>padding-left</strong></font> <font color="#666666">:</font> <font color="#666666">7em</font> ; <br> } <br></code> </blockquote><br><br>  You will get something like this: <br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/e62/0b0/46b/e620b046b947b42cd2bdd9b419c7ca24.png" alt="Geo Twitter Login Form"><br></a> <br><br><h4>  Some <s>special Grails magic of</s> server logic </h4><br>  To make something really work, you need to add server logic.  First install the <a href="http://grails.org/plugin/twitter">Grails plugin to work with Twitter</a> . <br><br> <code>grails install-plugin twitter</code> <br> <br>  Now we need to create a controller that will give out a list of friends from Twitter with information about their location, etc. <br><br> <code>grails create-controller Twitter</code> <br> <br>  The command above will generate the <code>grails-app/controllers/TwitterController.groovy</code> file with the controller skeleton.  It should be replaced with a controller implementation that will display information about friends in JSON format.  He will also contact the geocoding service to get coordinates on the map by the name of the area. <br><br><blockquote> <code><a href="http://maps.google.com/maps/geo%3Fq%3D"></a> <font color="#008000"><strong>import</strong></font> <font color="#0000FF"><strong>grails.converters.*</strong></font> <br> <br> <font color="#008000"><strong>class</strong></font> <font color="#0000FF"><strong>TwitterController</strong></font> <font color="#666666">{</font> <br> <font color="#408080"><em>// Google Maps API key <br></em></font> <font color="#008000"><strong>static</strong></font> def API_KEY <font color="#666666">=</font> <font color="#BA2121">"Insert your Google Maps API key here"</font> <br> <br> <font color="#408080"><em>// TwitterService instance will be injected into this variable by Spring <br></em></font> def twitterService <br> <br> def friendsJson <font color="#666666">=</font> <font color="#666666">{</font> <br> <font color="#408080"><em>// Get friends of given user <br></em></font> def friends <font color="#666666">=</font> getFriends <font color="#666666">(</font> params <font color="#666666">.</font> <font color="#7D9029">name</font> <font color="#666666">)</font> <br> <font color="#408080"><em>// Render friends list as JSON <br></em></font> render <font color="#666666">(</font> friends as JSON <font color="#666666">)</font> <br> <font color="#666666">}</font> <br> <br> <font color="#008000"><strong>private</strong></font> def <font color="#0000FF">getFriends</font> <font color="#666666">(</font> String userName <font color="#666666">)</font> <font color="#666666">{</font> <br> def friends <font color="#666666">=</font> twitterService <font color="#666666">.</font> <font color="#7D9029">getFriends</font> <font color="#666666">(</font> params <font color="#666666">.</font> <font color="#7D9029">name</font> <font color="#666666">)</font> <br> <br> <font color="#408080"><em>// Return only the needed fields for each user and retrieve coordinates for location <br></em></font> friends <font color="#666666">.</font> <font color="#7D9029">collect</font> <font color="#666666">{</font> it <font color="#666666">-&gt;</font> <br> <font color="#666666">[</font> <br> <font color="#A0A000">screenName:</font> it <font color="#666666">.</font> <font color="#7D9029">screenName</font> <font color="#666666">,</font> <br> <font color="#A0A000">name:</font> it <font color="#666666">.</font> <font color="#7D9029">name</font> <font color="#666666">,</font> <br> <font color="#A0A000">pictureUrl:</font> it <font color="#666666">.</font> <font color="#7D9029">profileImageUrl</font> as String <font color="#666666">,</font> <br> <font color="#A0A000">bio:</font> it <font color="#666666">.</font> <font color="#7D9029">description</font> <font color="#666666">,</font> <br> <font color="#A0A000">status:</font> it <font color="#666666">.</font> <font color="#7D9029">status</font> <font color="#666666">?.</font> <font color="#7D9029">text</font> <font color="#666666">,</font> <br> <font color="#A0A000">coords:</font> getCoordsFromLocation <font color="#666666">(</font> it <font color="#666666">.</font> <font color="#7D9029">location</font> <font color="#666666">)</font> <br> <font color="#666666">]</font> <br> <font color="#666666">}</font> <br> <font color="#666666">}</font> <br> <br> <font color="#408080"><em>/** <br> * This method gets coordinates on map for given location string. <br> */</em></font> <br> <font color="#008000"><strong>private</strong></font> def <font color="#0000FF">getCoordsFromLocation</font> <font color="#666666">(</font> String location <font color="#666666">)</font> <font color="#666666">{</font> <br> <font color="#008000"><strong>if</strong></font> <font color="#666666">(</font> location <font color="#666666">)</font> <font color="#666666">{</font> <br> <font color="#008000"><strong>if</strong></font> <font color="#666666">(</font> location <font color="#666666">.</font> <font color="#7D9029">contains</font> <font color="#666666">(</font> <font color="#BA2121">"iPhone:"</font> <font color="#666666">))</font> <font color="#666666">{</font> <br> <font color="#408080"><em>// There can be coords specified in location <br></em></font> <font color="#408080"><em>// like iPhone: 39.035248,-77.138687 <br></em></font> location <font color="#666666">=</font> location <font color="#666666">.</font> <font color="#7D9029">replace</font> <font color="#666666">(</font> <font color="#BA2121">"iPhone: "</font> <font color="#666666">,</font> <font color="#BA2121">""</font> <font color="#666666">)</font> <br> def parts <font color="#666666">=</font> location <font color="#666666">.</font> <font color="#7D9029">split</font> <font color="#666666">(</font> <font color="#BA2121">","</font> <font color="#666666">)</font> <br> <font color="#008000"><strong>return</strong></font> <font color="#666666">[</font> <font color="#A0A000">latitude:</font> parts <font color="#666666">[0],</font> <font color="#A0A000">longitude:</font> parts <font color="#666666">[1]]</font> <br> <font color="#666666">}</font> <font color="#008000"><strong>else</strong></font> <font color="#666666">{</font> <br> <font color="#408080"><em>// Encode location as URL <br></em></font> def encodedLocation <font color="#666666">=</font> URLEncoder <font color="#666666">.</font> <font color="#7D9029">encode</font> <font color="#666666">(</font> location <font color="#666666">)</font> <br> <font color="#408080"><em>// Call web service by retrieving URL content <br></em></font> def response <font color="#666666">=</font> <br> <font color="#BA2121">"maps.google.com/maps/geo?q=${encodedLocation}&amp;output=xml&amp;key=${API_KEY}"</font> <font color="#666666">.</font> <font color="#7D9029">toURL</font> <font color="#666666">().</font> <font color="#7D9029">getText</font> <font color="#666666">()</font> <br> <font color="#408080"><em>// Parse response XML <br></em></font> def root <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> XmlSlurper <font color="#666666">().</font> <font color="#7D9029">parseText</font> <font color="#666666">(</font> response <font color="#666666">)</font> <br> <font color="#008000"><strong>if</strong></font> <font color="#666666">(</font> root <font color="#666666">.</font> <font color="#7D9029">Response</font> <font color="#666666">.</font> <font color="#7D9029">Placemark</font> <font color="#666666">.</font> <font color="#7D9029">size</font> <font color="#666666">()</font> <font color="#666666">==</font> <font color="#666666">1)</font> <font color="#666666">{</font> <br> def coords <font color="#666666">=</font> root <font color="#666666">.</font> <font color="#7D9029">Response</font> <font color="#666666">.</font> <font color="#7D9029">Placemark</font> <font color="#666666">.</font> <font color="#7D9029">Point</font> <font color="#666666">.</font> <font color="#7D9029">coordinates</font> <font color="#666666">.</font> <font color="#7D9029">text</font> <font color="#666666">()</font> <br> def parts <font color="#666666">=</font> coords <font color="#666666">.</font> <font color="#7D9029">split</font> <font color="#666666">(</font> <font color="#BA2121">","</font> <font color="#666666">)</font> <br> <font color="#008000"><strong>if</strong></font> <font color="#666666">(</font> parts <font color="#666666">.</font> <font color="#7D9029">size</font> <font color="#666666">()</font> <font color="#666666">&gt;</font> <font color="#666666">1)</font> <font color="#666666">{</font> <br> <font color="#008000"><strong>return</strong></font> <font color="#666666">[</font> <font color="#A0A000">latitude:</font> parts <font color="#666666">[1]</font> as Double <font color="#666666">,</font> <font color="#A0A000">longitude:</font> parts <font color="#666666">[0]</font> as Double <font color="#666666">]</font> <br> <font color="#666666">}</font> <br> <font color="#666666">}</font> <br> <font color="#666666">}</font> <br> <font color="#666666">}</font> <br> <br> <font color="#408080"><em>// No coordinates are determined <br></em></font> <font color="#008000"><strong>return</strong></font> <font color="#008000"><strong>null</strong></font> <br> <font color="#666666">}</font> <br> <font color="#666666">}</font> <br></code> </blockquote><br><br><h4>  Using AJAX to get data from the server </h4><br>  After we wrote the controller logic, we need to write the JS code that will receive data from the server and display it on the map.  This code can be placed in the form submission handler, but first you need to set the correct action for the form: <br> <code>action="${createLink(controller: 'twitter', action: 'friendsJson'}"</code> <br> <br>  Then add the handler to <code>index.gsp</code> , like: <br><br><blockquote> <code>google.load( <font color="#BA2121">"maps"</font> , <font color="#BA2121">"2.x"</font> ); <br> google.load( <font color="#BA2121">"jquery"</font> , <font color="#BA2121">"1.3.1"</font> ); <br> <br> google.setOnLoadCallback( <font color="#008000"><strong>function</strong></font> () { <br> $( <font color="#008000">document</font> ).ready( <font color="#008000"><strong>function</strong></font> () { <br> <font color="#408080"><em>// Create and configure Google Map control <br></em></font> <font color="#008000"><strong>var</strong></font> map <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> GMap2( <font color="#008000">document</font> .getElementById( <font color="#BA2121">"map"</font> )); <br> <font color="#008000"><strong>var</strong></font> vinnitsa <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> GLatLng( <font color="#666666">49.2325477</font> , <font color="#666666">28.4744695</font> ); <br> map.setCenter(vinnitsa, <font color="#666666">4</font> ); <br> map.addControl( <font color="#008000"><strong>new</strong></font> GLargeMapControl()); <br> <font color="#408080"><em>// Add form submit handler <br></em></font> <font color="#008000"><strong>var</strong></font> form <font color="#666666">=</font> $( <font color="#BA2121">"#twitter"</font> ); <br> form.submit( <font color="#008000"><strong>function</strong></font> () { <br> $.getJSON(form.attr( <font color="#BA2121">"action"</font> ) <font color="#666666">+</font> <font color="#BA2121">"?"</font> <font color="#666666">+</font> form.serialize(), <font color="#008000"><strong>function</strong></font> (data) { <br> <font color="#408080"><em>// Clear all markers <br></em></font> map.clearOverlays(); <br> <font color="#408080"><em>// Loop through friends list and add markers to map <br></em></font> $.each(data, <font color="#008000"><strong>function</strong></font> (i, item) { <br> <font color="#008000"><strong>if</strong></font> (item.coords) { <br> <font color="#008000"><strong>var</strong></font> marker <font color="#666666">=</font> <font color="#008000"><strong>new</strong></font> GMarker( <font color="#008000"><strong>new</strong></font> GLatLng(item.coords.latitude, item.coords.longitude)); <br> map.addOverlay(marker); <br> <font color="#008000"><strong>var</strong></font> popup <font color="#666666">=</font> <font color="#BA2121">'&lt;img style="width: 48px; height:48px;" src="'</font> <font color="#666666">+</font> item.pictureUrl <font color="#666666">+</font> <font color="#BA2121">'"&gt;'</font> <font color="#666666">+</font> <br> item.name <font color="#666666">+</font> <font color="#BA2121">' ('</font> <font color="#666666">+</font> item.screenName <font color="#666666">+</font> <font color="#BA2121">') &lt;br&gt;'</font> <font color="#666666">+</font> <br> item.bio <font color="#666666">+</font> <font color="#BA2121">'&lt;br&gt;'</font> <font color="#666666">+</font> item.status; <br> GEvent.addListener(marker, <font color="#BA2121">"click"</font> , <font color="#008000"><strong>function</strong></font> () { <br> marker.openInfoWindowHtml(popup); <br> }); <br> } <br> }); <br> }); <br> <font color="#408080"><em>// Indicate that form should not actually be submitted <br></em></font> <font color="#008000"><strong>return</strong></font> <font color="#008000"><strong>false</strong></font> ; <br> }); <br> }); <br> }); <br></code> </blockquote><br><br>  Now, when you enter a name and click on the button "Map my friends!" Get the following picture: <br><br> <a href=""><img src="https://habrastorage.org/getpro/habr/post_images/5c9/a52/4b4/5c9a524b4e66252571dc2e3b9d9cd7f2.png" alt="Geo Twitter Complete"></a> <br><br><h4>  Demo and source </h4><br><ul><li>  Sources of the demo project can be taken in <a href="http://github.com/vgrichina/geo_twitter">the GitHub repository</a> </li><li>  The demo can be viewed on our demo server (see the link in the blog in English), if it does not fall, but it still falls :) </li></ul><br><br><h4>  It is useful to read more </h4><br><ul><li>  <a href="http://grails.org/plugin/twitter">Grails twitter plugin</a> </li><li>  <a href="http://marcgrabanski.com/article/jquery-google-maps-tutorial-basics">jQuery and Google Maps Tutorial</a> </li><li>  <a href="http://www.ibm.com/developerworks/java/library/j-snw/index.html%3Fca%3Ddgr-twtrGroovySocialdth-J%26amp%3BS_TACT%3D105AGY83%26amp%3BS_CMP%3DTWDW">Social mashups with Groovy</a> </li><li>  <a href="http://www.ibm.com/developerworks/java/library/j-grails11188/index.html">Mastering Grails: Asynchronous Grails with JSON and Ajax</a> </li><li>  <a href="http://www.ibm.com/developerworks/java/library/j-grails05208/index.html">Mastering Grails: Grails services and Google Maps</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/75774/">https://habr.com/ru/post/75774/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../75765/index.html">Perfect CRM</a></li>
<li><a href="../75766/index.html">I am looking for a designer</a></li>
<li><a href="../75771/index.html">We are launching a software business in Russia</a></li>
<li><a href="../75772/index.html">Camera "do it yourself"</a></li>
<li><a href="../75773/index.html">Press release of the new ion nettop Wexler VisION-2</a></li>
<li><a href="../75775/index.html">Knoppix 6.2 release</a></li>
<li><a href="../75776/index.html">PHP, MS SQL Server and UTF-8</a></li>
<li><a href="../75777/index.html">Bing ‚ù§ Wolfram Alpha</a></li>
<li><a href="../75779/index.html">Lawlessness in hell. Raider seizure of the city portal?</a></li>
<li><a href="../75780/index.html">Gource - visualize the history of the project</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>