<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ASP.NET Core RC2: Integrated Modularity Support (application parts)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being historically immersed in the issues of developing modular applications on ASP.NET, the first thing I did when ASP.NET Core RC2 came out was to t...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ASP.NET Core RC2: Integrated Modularity Support (application parts)</h1><div class="post__text post__text-html js-mediator-article">  Being historically immersed in the issues of developing modular applications on ASP.NET, the first thing I did when ASP.NET Core RC2 came out was to try to translate my ExtCore modular framework into it.  And it turned out that in the new version everything changed and the old approaches from RC1 no longer work, but there were new interesting features, which I want to tell about. <br><br>  In short, the development of modular applications in RC2 is very simplified.  Thanks to the new feature ‚Äúapplication parts‚Äù (application parts), you can easily divide your large project into several smaller ones and then freely assemble them.  This is especially convenient when working with areas (areas), which already isolate a set of controllers, views and other resources - each area can now be divided into a separate project.  As I understand it (in particular, from <a href="https://github.com/aspnet/Mvc/issues/4089">aspnet / Mvc # 4089</a> ), the implementation is focused on dividing a large project into small ones and only in MVC.  The rest still have to write yourself. <br><br><a name="habracut"></a><br><h2>  Implementation </h2><br>  For example, create a small application and see how everything works (it is assumed that you have already come <a href="https://www.microsoft.com/net/core">here</a> and installed everything you need).  So, create a project: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/files/334/066/7e0/3340667e08e345378e4531e54fa1a45d.png"><br><br>  In the next step, select ‚ÄúWeb application‚Äù so that Visual Studio creates an application that is ready for testing: <br><br><img src="https://habrastorage.org/files/51b/089/fb2/51b089fb2df04fc1819385a1d979e2f7.png"><br><br>  That's all.  Now let's launch our new application: <br><br><img src="https://habrastorage.org/files/985/685/2cb/9856852cbb8e44ae9e903a2b914c13f0.png"><br><br>  I will not dwell on the structure of the project and on the differences in structure from what we are used to in RC1.  If you wish, you can see <a href="https://docs.asp.net/en/latest/migration/rc1-to-rc2.html">this</a> . <br><br>  Now add another project to our solution, this time the class library: <br><br><img src="https://habrastorage.org/files/ab9/7ff/859/ab97ff85915143879e6007d83f47a4e5.png"><br><br>  Since we want to look at the work of the controller and the view from our assembly, we will add a link to MVC in the project.json file.  We also need the views in this project to be added to the assembly as resources.  This is done using the appropriate settings in the buildOptions section of the project.json file.  As a result, we get the following file: <br><br><pre><code class="javascript hljs">{ <span class="hljs-string"><span class="hljs-string">"buildOptions"</span></span>: { <span class="hljs-string"><span class="hljs-string">"embed"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"Views/**"</span></span> ] }, <span class="hljs-string"><span class="hljs-string">"dependencies"</span></span>: { <span class="hljs-string"><span class="hljs-string">"Microsoft.AspNetCore.Mvc"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-rc2-final"</span></span>, <span class="hljs-string"><span class="hljs-string">"NETStandard.Library"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.5.0-rc2-24027"</span></span> }, <span class="hljs-string"><span class="hljs-string">"frameworks"</span></span>: { <span class="hljs-string"><span class="hljs-string">"netstandard1.5"</span></span>: { <span class="hljs-string"><span class="hljs-string">"imports"</span></span>: <span class="hljs-string"><span class="hljs-string">"dnxcore50"</span></span> } }, <span class="hljs-string"><span class="hljs-string">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"1.0.0-*"</span></span> }</code> </pre> <br><br>  Now we will create in our project a new controller with a single method (for consistency, it is advisable to place the file with the controller class in the Controllers folder, although this is not necessary): <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleAController</span></span> : <span class="hljs-title"><span class="hljs-title">Controller</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> ActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Index</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.View(); } }</code> </pre><br><br>  Now in the \ Views \ ModuleA folder we will create an Index.cshtml view with the content you like. <br><br>  The project is ready.  Let's collect it.  In the folder with the project folder will appear (as in previous versions of ASP.NET), and in it - our assembly.  It remains only to tell about it to the main application. <br><br>  Open the Startup class of our application and go to the ConfigureServices method.  First of all, let's load our build with the controller and view: <br><br><pre> <code class="cs hljs">Assembly assembly = AssemblyLoadContext.Default.LoadFromAssemblyPath(<span class="hljs-string"><span class="hljs-string">@"   "</span></span>);</code> </pre><br><br>  Next, add the loaded assembly as part of the application in MVC: <br><br><pre> <code class="cs hljs">services.AddMvc().AddApplicationPart(assembly);</code> </pre><br><br>  Almost everything.  If we start the application now and go to the address / modulea, we will get an exception: InvalidOperationException: The view 'Index' was not found.  To explain MVC that you need to look for views inside our assembly, we will add the appropriate file provider in the Razor settings.  Modify the previous line of code to make it like this: <br><br><pre> <code class="cs hljs">services.AddMvc().AddApplicationPart(assembly).AddRazorOptions( o =&gt; { o.FileProviders.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmbeddedFileProvider(assembly, assembly.GetName().Name)); } );</code> </pre><br><br>  Our application, consisting of two parts, is ready.  Run it, go to the address / modulea: <br><br><img src="https://habrastorage.org/files/bd9/998/65f/bd999865fd7a44f3b005715aaf040b21.png"><br><br>  Very good.  Back in RC1, this would require more code.  But this is enough only as long as you do not want to use strongly typed representations.  If we add a view model class to our project, and then specify it as a model for our view, we‚Äôll get an exception at runtime: The AspNetCoreApplicationParts 'ModuleA' doesn‚Äôt exist.  This is due to the fact that our assembly is not included in the assembly set, in which Razor is looking for types when compiling views.  Fortunately, there is a <a href="https://github.com/aspnet/Mvc/issues/4087">fairly simple way</a> to fix this.  In addition, in the near future, this step will not be necessary, since assemblies added as parts of the application will automatically participate in Razor compilation. <br><br>  We modify the call to the AddRazorOptions function that we used in the previous step, thus: <br><br><pre> <code class="cs hljs">.AddRazorOptions( o =&gt; { o.FileProviders.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> EmbeddedFileProvider(assembly, assembly.GetName().Name)); Action&lt;RoslynCompilationContext&gt; previous = o.CompilationCallback; o.CompilationCallback = c =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (previous != <span class="hljs-literal"><span class="hljs-literal">null</span></span>) { previous(c); } c.Compilation = c.Compilation.AddReferences(reference); }; } );</code> </pre><br><br>  It remains to declare the reference variable somewhere before loading the assembly: <br><br><pre> <code class="cs hljs">PortableExecutableReference reference = MetadataReference.CreateFromFile(<span class="hljs-string"><span class="hljs-string">@"   "</span></span>);</code> </pre><br><br>  That's all.  Now we can use our view model.  Run the application and go to the / modulea address: <br><br><img src="https://habrastorage.org/files/047/ca8/a43/047ca8a438c7410e86e2fabbe53630e2.png"><br><br>  By the way, even in RC1 it was possible to use a preliminary compilation of representations and not have problems with resolving the types of view models at run time.  Unfortunately, preliminary compilation is not supported in RC2 (as far as I understood, due to the complexity of the implementation), but it <a href="https://github.com/aspnet/Mvc/issues/3993">will be returned in the future</a> . <br><br><h2>  Result </h2><br>  Perhaps the application parts are exactly what ASP.NET has long lacked.  I spent a lot of time to achieve a similar result in previous versions (even before ASP.NET Core).  I hope this example is quite enough to start using this feature.  And thanks to the guys from our chat in Gitter, with whom we dealt with RC2. <br><br>  The entire project (in a slightly simplified form) is available on <a href="https://github.com/DmitrySikorsky/AspNetCoreApplicationParts">GitHub</a> . </div><p>Source: <a href="https://habr.com/ru/post/301336/">https://habr.com/ru/post/301336/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../301320/index.html">How we drew road shields on the map</a></li>
<li><a href="../301324/index.html">Generating classes from a database using DataGrip</a></li>
<li><a href="../301330/index.html">Calling Java code from Love2D</a></li>
<li><a href="../301332/index.html">So you think you know Const?</a></li>
<li><a href="../301334/index.html">We study Bootmgr. Part 1 - tools and basic principles of debugging the initial stages of loading Windows</a></li>
<li><a href="../301338/index.html">Effective dependency injection when scaling Ruby applications</a></li>
<li><a href="../301340/index.html">The growth of hockey players: analyze the data of all world championships in the current century</a></li>
<li><a href="../301344/index.html">Python: Thinking Programmer</a></li>
<li><a href="../301346/index.html">Informational hiding in PDF documents</a></li>
<li><a href="../301350/index.html">Bootstrapping is a business from scratch. Part 1</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>