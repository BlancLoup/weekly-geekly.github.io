<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Building Oracle Data Guard 12c infrastructure from Oracle RAC databases using Far Sync</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 
 The goal of this work was to build a demo stand for exploring the capabilities of Oracle Data Guard from Oracle RAC 12.1.0.2.0 nodes. 
...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Building Oracle Data Guard 12c infrastructure from Oracle RAC databases using Far Sync</h1><div class="post__text post__text-html js-mediator-article"><h4>  Introduction </h4><br>  The goal of this work was to build a demo stand for exploring the capabilities of Oracle Data Guard from Oracle RAC 12.1.0.2.0 nodes. <br><br>  Since I didn‚Äôt have a server at hand, on which I could place all the virtual machines I needed (7 pieces), we will build using office PCs. <br><br>  Total we have: <br><ol><li>  3 PCs with these features: CPU i5, 16 GB RAM </li><li>  Normal office network 1Gbit / s </li></ol><br>  Two PCs will house two Oracle Data Guard sites, each with 2 Oracle RAC 12c nodes and one Far Sync instance in separate virtual machines. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      On the third PC there will be one management virtual with Oracle Enterprise Manager Cloud Control 12c Release 5 (12.1.0.5).  As for EM, I‚Äôm not going to mention it further, since this is a separate topic in this case no longer associated with the construction of the Data Guard stand, but with its use. <br><br>  The necessary Oracle software is downloaded from their website, and I chose Fedora 22 with qemu-kvm + libvirt + openvswitch as the main operating system.  As a guest OS we use Oracle Linux 6.6. <br><a name="habracut"></a><br><h4>  Preparing Fedora for Virtual Machine Hosting </h4><br>  Each of the virtual machines will have 4 network interfaces.  Assignment of networks: <br><table><tbody><tr><td>  192.168.100.0/24 </td><td>  #VLAN 100 Public Clusterware network </td></tr><tr><td>  192.168.101.0/24 </td><td>  #VLAN 101 Interconnect 1 </td></tr><tr><td>  192.168.102.0/24 </td><td>  #VLAN 101 Interconnect 2 </td></tr><tr><td>  192.168.103.0/24 </td><td>  #VLAN 103 Data Guard </td></tr></tbody></table><br>  The cluster interconnect will be duplicated with us, a separate network is allocated for Data Guard traffic.  There is also an external network and one port Open vSwitch on each PC uses a physical interface, which receives an IP address via DHCP from this network. <br><br>  We will distribute IP addresses as follows: <br><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># cat /etc/hosts</span></span></code> </pre> <br><table><tbody><tr><td>  192.168.100.1 </td><td>  prmy.example.com </td><td>  prmy </td><td>  # PC1 Primary RAC Database </td></tr><tr><td>  192.168.100.2 </td><td>  sby.example.com </td><td>  sby </td><td>  # PC2 Standy RAC Database </td></tr><tr><td>  192.168.100.3 </td><td>  em.example.com </td><td>  em </td><td>  # PC3 EM 12c </td></tr><tr><td>  192.168.100.11 </td><td>  prmy1.example.com </td><td>  prmy1 </td><td>  # PC1 VM1 Node 1 Primary RAC Database </td></tr><tr><td>  192.168.100.12 </td><td>  prmy2.example.com </td><td>  prmy2 </td><td>  # PC1 VM2 Node 2 Primary RAC Database </td></tr><tr><td>  192.168.100.13 </td><td>  prmy3.example.com </td><td>  prmy3 </td><td>  # PC1 VM3 Primary Far Sync </td></tr><tr><td>  192.168.100.21 </td><td>  sby1.example.com </td><td>  sby1 </td><td>  # PC2 VM1 Node 1 Standy RAC Database </td></tr><tr><td>  192.168.100.22 </td><td>  sby2.example.com </td><td>  sby2 </td><td>  # PC2 VM2 Node 2 Standy RAC Database </td></tr><tr><td>  192.168.100.23 </td><td>  sby3.example.com </td><td>  sby3 </td><td>  # PC2 VM3 Standy Far Sync </td></tr></tbody></table><br>  we will generate names on each of the computers: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># hostnamectl set-hostname prmy.example.com [root@sby ~]# hostnamectl set-hostname sby.example.com [root@em ~]# hostnamectl set-hostname em.example.com</span></span></code> </pre><br>  Getting rid of GNOME on every single person: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># systemctl set-default multi-user.target</span></span></code> </pre><br>  Let's configure HugeMem for virtualok at the rate of 4300M each. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># echo "vm.nr_hugepages=6450" &gt; /etc/sysctl.d/hugepages.conf</span></span></code> </pre><br>  Enable routing: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># echo "net.ipv4.ip_forward = 1" &gt; /etc/sysctl.d/forward.conf</span></span></code> </pre><br>  Clusters need time synchronization, so on prmy we configure chronyd: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># echo "allow 192.168.100/24" &gt;&gt; /etc/chrony.conf [root@prmy ~]# systemctl enable chronyd</span></span></code> </pre><br>  On prmy we configure a DHCP server to distribute IP addresses to virtual clients: <br><pre> <code class="bash hljs">root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># dnf install dhcp [root@prmy ~]# systemctl enable dhcpd [root@prmy ~]# vi /etc/dhcp/dhcpd.conf</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Contents of the /etc/dhcp/dhcpd.conf file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># # DHCP Server Configuration file. # see /usr/share/doc/dhcp/dhcpd.conf.example # see dhcpd.conf(5) man page # authoritative; ddns-domainname "example.com"; ddns-rev-domainname "in-addr.arpa."; ddns-update-style interim; ddns-updates on; ignore client-updates; default-lease-time 21600; max-lease-time 43200; # Public subnet 192.168.100.0 netmask 255.255.255.0 { option routers 192.168.100.1; option subnet-mask 255.255.255.0; option broadcast-address 192.168.100.255; option domain-name-servers 192.168.100.1; option ntp-servers 192.168.100.1; option domain-name "example.com"; option ip-forwarding on; pool { range 192.168.100.100 192.168.100.254; } group { host prmy1 { hardware ethernet 00:16:3e:00:01:01; fixed-address 192.168.100.11; } host prmy2 { hardware ethernet 00:16:3e:00:01:02; fixed-address 192.168.100.12; } host prmy3 { hardware ethernet 00:16:3e:00:01:03; fixed-address 192.168.100.13; } host sby1 { hardware ethernet 00:16:3e:00:02:01; fixed-address 192.168.100.21; } host sby2 { hardware ethernet 00:16:3e:00:02:02; fixed-address 192.168.100.22; } host sby3 { hardware ethernet 00:16:3e:00:02:03; fixed-address 192.168.100.23; } } } # Interconnect 1 subnet 192.168.101.0 netmask 255.255.255.0 { option subnet-mask 255.255.255.0; option broadcast-address 192.168.101.255; range 192.168.101.100 192.168.101.254; } # Interconnect 2 subnet 192.168.102.0 netmask 255.255.255.0 { option subnet-mask 255.255.255.0; option broadcast-address 192.168.102.255; range 192.168.102.100 192.168.102.254; } # Data Guard subnet 192.168.103.0 netmask 255.255.255.0 { option subnet-mask 255.255.255.0; option broadcast-address 192.168.103.255; pool { range 192.168.103.100 192.168.103.254; } group { host prmy1-dg { hardware ethernet 00:16:3e:00:01:31; fixed-address 192.168.103.11; } host prmy2-dg { hardware ethernet 00:16:3e:00:01:32; fixed-address 192.168.103.12; } host prmy3-dg { hardware ethernet 00:16:3e:00:01:33; fixed-address 192.168.103.13; } host sby1-dg { hardware ethernet 00:16:3e:00:02:31; fixed-address 192.168.103.21; } host sby2-dg { hardware ethernet 00:16:3e:00:02:32; fixed-address 192.168.103.22; } host sby3-dg { hardware ethernet 00:16:3e:00:02:33; fixed-address 192.168.103.23; } } }</span></span></code> </pre><br></div></div><br>  Configuring DNS <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># dnf install bind [root@prmy ~]# systemctl enable named</span></span></code> </pre><br>  Add the following lines to the standard /etc/named.conf: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># vi /etc/named.conf</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The lines added to the vi /etc/named.conf file</b> <div class="spoiler_text"><pre> <code class="bash hljs">listen-on port 53 { 192.168.100.1; }; allow-query { localhost; 192.168.100.0/24; }; allow-query-cache { localhost; 192.168.100.0/24; }; allow-recursion { localhost; 192.168.100.0/24; }; zone <span class="hljs-string"><span class="hljs-string">"example.com"</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> master; file <span class="hljs-string"><span class="hljs-string">"dynamic/example.zone"</span></span>; allow-update { key <span class="hljs-string"><span class="hljs-string">"rndc-key"</span></span>; }; notify yes; }; zone <span class="hljs-string"><span class="hljs-string">"100.168.192.in-addr.arpa"</span></span> IN { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> master; file <span class="hljs-string"><span class="hljs-string">"dynamic/192.168.100.zone"</span></span>; allow-update { key <span class="hljs-string"><span class="hljs-string">"rndc-key"</span></span>; }; notify yes; }; zone <span class="hljs-string"><span class="hljs-string">"103.168.192.in-addr.arpa"</span></span> IN { <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> master; file <span class="hljs-string"><span class="hljs-string">"dynamic/192.168.103.zone"</span></span>; allow-update { key <span class="hljs-string"><span class="hljs-string">"rndc-key"</span></span>; }; notify yes; };</code> </pre><br></div></div><br>  Create zones: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># vi /var/named/dynamic/example.zone</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Contents of the /var/named/dynamic/example.zone file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> . <span class="hljs-variable"><span class="hljs-variable">$TTL</span></span> 86400 ; 1 day example.com IN SOA dns.example.com. sysadmin.example.com. ( 59 ; serial 28800 ; refresh (8 hours) 7200 ; retry (2 hours) 2419200 ; expire (4 weeks) 86400 ; minimum (1 day) ) IN NS dns.example.com. <span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> example.com. <span class="hljs-variable"><span class="hljs-variable">$TTL</span></span> 10800 ; 3 hours <span class="hljs-variable"><span class="hljs-variable">$TTL</span></span> 86400 ; 1 day dns A 192.168.100.1 prmy CNAME dns prmy1 A 192.168.100.11 prmy2 A 192.168.100.12 prmy3 A 192.168.100.13 sby A 192.168.100.2 sby1 A 192.168.100.21 sby2 A 192.168.100.22 sby3 A 192.168.100.23 prmy1-dg A 192.168.103.11 prmy2-dg A 192.168.103.12 prmy3-dg A 192.168.103.13 sby1-dg A 192.168.103.21 sby2-dg A 192.168.103.22 sby3-dg A 192.168.103.23 em A 192.168.100.3 <span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> clu-prmy.example.com. @ IN NS Oracle-GNS.clu-prmy.example.com. IN NS dns.example.com. Oracle-GNS IN A 192.168.100.51</code> </pre><br></div></div><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># vi /var/named/dynamic/192.168.100.zone</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The contents of the file /var/named/dynamic/192.168.100.zone</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> . <span class="hljs-variable"><span class="hljs-variable">$TTL</span></span> 86400 ; 1 day 100.168.192.in-addr.arpa IN SOA dns.example.com. sysadmin.example.com. ( 40 ; serial 28800 ; refresh (8 hours) 7200 ; retry (2 hours) 2419200 ; expire (4 weeks) 86400 ; minimum (1 day) ) NS dns.example.com. <span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> 100.168.192.in-addr.arpa. 1 PTR dns.example.com. 11 PTR prmy1.example.com. 12 PTR prmy2.example.com. 13 PTR prmy3.example.com. 2 PTR sby.example.com. 21 PTR sby1.example.com. 22 PTR sby2.example.com. 23 PTR sby3.example.com. 3 PTR em.example.com. 51 PTR Oracle-GNS.clu-prmy.example.com.</code> </pre><br></div></div><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># vi /var/named/dynamic/192.168.103.zone</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The contents of the /var/named/dynamic/192.168.103.zone file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> . <span class="hljs-variable"><span class="hljs-variable">$TTL</span></span> 86400 ; 1 day 103.168.192.in-addr.arpa IN SOA dns.example.com. sysadmin.example.com. ( 42 ; serial 28800 ; refresh (8 hours) 7200 ; retry (2 hours) 2419200 ; expire (4 weeks) 86400 ; minimum (1 day) ) NS dns.example.com. <span class="hljs-variable"><span class="hljs-variable">$ORIGIN</span></span> 103.168.192.in-addr.arpa. 11 PTR prmy1-dg.example.com. 12 PTR prmy2-dg.example.com. 13 PTR prmy3-dg.example.com. 21 PTR sby1-dg.example.com. 22 PTR sby2-dg.example.com. 23 PTR sby3-dg.example.com.</code> </pre><br></div></div><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># chown named:named /var/named/dynamic/*</span></span></code> </pre><br>  We will have our own DHCP and DNS servers and in order not to interfere with the rest of the office network, we will configure our subnets in separate VLANs for the stand to work. <br><br>  Install Open vSwitch: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># dnf install openvswitch # systemctl enable openvswitch # systemctl disable NetworkManager # systemctl enable network</span></span></code> </pre><br>  We create a separate switch for the public network of the cluster: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-ovsbr0 DEVICE=ovsbr0 DEVICETYPE=ovs TYPE=OVSBridge ONBOOT=yes OVSBOOTPROTO="dhcp" OVSDHCPINTERFACES="enp3s0" DELAY=0 HOTPLUG=no NOZEROCONF=yes</span></span></code> </pre><br>  Together with the bridge, an internal port is created and on it an internal interface named after the bridge has the name ovsbr0.  This interface will receive the IP address from the office DHCP via the physical interface enp3s0. <br><br>  In turn, the physical interface enp3s0 is connected to this bridge: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-enp3s0 DEVICE="enp3s0" DEVICETYPE=ovs TYPE=OVSPort OVS_BRIDGE=ovsbr0 ONBOOT=yes HWADDR=60:a4:4c:3c:93:06 IPV4_FAILURE_FATAL=no IPV6INIT=no NM_CONTROLLED=no USERCTL=no NOZEROCONF=yes HOTPLUG=no</span></span></code> </pre><br>  We configure the port (VLAN 100) and the interface on the Open vSwitch for the public network of clusters.  Through it we will distribute IP addresses, DNS and NTP for virus clusters and EM 12c. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-pub0 DEVICE=pub0 TYPE="OVSIntPort" DEVICETYPE="ovs" OVS_BRIDGE="ovsbr0" OVS_OPTIONS="tag=100" OVS_EXTRA="set Interface $DEVICE external-ids:iface-id=$(hostname -s)-$DEVICE-vif" ONBOOT=yes BOOTPROTO=static IPADDR=192.168.100.1 PREFIX=24 IPV6INIT=no DELAY=0 HOTPLUG=no NOZEROCONF=yes</span></span></code> </pre><br>  We configure a separate switch, port (VLAN 101) and interface on the Open vSwitch for the first inetrconnect of the cluster. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-iconn1 DEVICE=iconn1 DEVICETYPE=ovs TYPE=OVSBridge OVS_EXTRA="set port $DEVICE tag=101" ONBOOT=yes BOOTPROTO=none IPADDR=192.168.101.1 PREFIX=24 DELAY=0 HOTPLUG=no NOZEROCONF=yes</span></span></code> </pre><br>  We configure a separate switch, a port (VLAN 102) and an interface on the Open vSwitch for the second inetrconnect of the clusters. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-iconn2 DEVICE=iconn2 DEVICETYPE=ovs TYPE=OVSBridge OVS_EXTRA="set port $DEVICE tag=102" ONBOOT=yes BOOTPROTO=none IPADDR=192.168.102.1 PREFIX=24 DELAY=0 HOTPLUG=no NOZEROCONF=yes</span></span></code> </pre><br>  We configure a separate switch, port (VLAN 103) and an interface on Open vSwitch for Data Guard traffic. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-dg0 DEVICE=dg0 DEVICETYPE=ovs TYPE=OVSBridge OVS_EXTRA="set port $DEVICE tag=103" ONBOOT=yes BOOTPROTO=none IPADDR=192.168.103.1 PREFIX=24 DELAY=0 HOTPLUG=no NOZEROCONF=yes</span></span></code> </pre><br>  We create the same interface definitions on sby by changing the HWADDR to the current and last digit in the IP addresses for sby by 2. <br>  The iconn1, iconn2 and dg0 switches turned out to be isolated from us and their traffic does not go outside.  In order for prmy virtual machines to exchange data across all internal networks with virtual machines on sby and vice versa, we connect these switches to ovsbr0, which has an external physical port. <br><br>  We realize this by connecting all switches with the ‚Äútrain‚Äù using Patch ports on switches. <br><br>  The definitions of the following interfaces are identical on prmy and sby: <br><div class="spoiler">  <b class="spoiler_title">Connecting Switches with Patch Ports</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/network-scripts/ifcfg-patch-ovsbr0-iconn1 DEVICE=patch-ovsbr0-iconn1 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=ovsbr0 OVS_PATCH_PEER=patch-iconn1-ovsbr0 # vi /etc/sysconfig/network-scripts/ifcfg-patch-iconn1-ovsbr0 DEVICE=patch-iconn1-ovsbr0 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=iconn1 OVS_PATCH_PEER=patch-ovsbr0-iconn1 # vi /etc/sysconfig/network-scripts/ifcfg-patch-iconn1-iconn2 DEVICE=patch-iconn1-iconn2 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=iconn1 OVS_PATCH_PEER=patch-iconn2-iconn1 # vi /etc/sysconfig/network-scripts/ifcfg-patch-iconn2-iconn1 DEVICE=patch-iconn2-iconn1 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=iconn2 OVS_PATCH_PEER=patch-iconn1-iconn2 # vi /etc/sysconfig/network-scripts/ifcfg-patch-iconn2-dg0 DEVICE=patch-iconn2-dg0 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=iconn2 OVS_PATCH_PEER=patch-dg0-iconn2 # vi /etc/sysconfig/network-scripts/ifcfg-patch-dg0-iconn2 DEVICE=patch-dg0-iconn2 ONBOOT=yes DEVICETYPE=ovs TYPE=OVSPatchPort OVS_BRIDGE=dg0 OVS_PATCH_PEER=patch-iconn2-dg0</span></span></code> </pre><br></div></div><br>  Now restart prmy and sby. <br><br>  Check the resulting openvswitch configuration: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># ovs-vsctl show</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The result of the command ovs-vsctl show</b> <div class="spoiler_text"><pre> <code class="bash hljs">3d20f852-5b67-4a1c-b983-e2a8caa27de1 Bridge <span class="hljs-string"><span class="hljs-string">"dg0"</span></span> Port <span class="hljs-string"><span class="hljs-string">"patch-dg0-iconn2"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-dg0-iconn2"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-iconn2-dg0"</span></span>} Port <span class="hljs-string"><span class="hljs-string">"dg0"</span></span> tag: 103 Interface <span class="hljs-string"><span class="hljs-string">"dg0"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: internal Bridge <span class="hljs-string"><span class="hljs-string">"iconn1"</span></span> Port <span class="hljs-string"><span class="hljs-string">"iconn1"</span></span> tag: 101 Interface <span class="hljs-string"><span class="hljs-string">"iconn1"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: internal Port <span class="hljs-string"><span class="hljs-string">"patch-iconn1-iconn2"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-iconn1-iconn2"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-iconn2-iconn1"</span></span>} Port <span class="hljs-string"><span class="hljs-string">"patch-iconn1-ovsbr0"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-iconn1-ovsbr0"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-ovsbr0-iconn1"</span></span>} Bridge <span class="hljs-string"><span class="hljs-string">"iconn2"</span></span> Port <span class="hljs-string"><span class="hljs-string">"iconn2"</span></span> tag: 102 Interface <span class="hljs-string"><span class="hljs-string">"iconn2"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: internal Port <span class="hljs-string"><span class="hljs-string">"patch-iconn2-iconn1"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-iconn2-iconn1"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-iconn1-iconn2"</span></span>} Port <span class="hljs-string"><span class="hljs-string">"patch-iconn2-dg0"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-iconn2-dg0"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-dg0-iconn2"</span></span>} Bridge <span class="hljs-string"><span class="hljs-string">"ovsbr0"</span></span> Port <span class="hljs-string"><span class="hljs-string">"pub0"</span></span> tag: 100 Interface <span class="hljs-string"><span class="hljs-string">"pub0"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: internal Port <span class="hljs-string"><span class="hljs-string">"ovsbr0"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"ovsbr0"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: internal Port <span class="hljs-string"><span class="hljs-string">"enp3s0"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"enp3s0"</span></span> Port <span class="hljs-string"><span class="hljs-string">"patch-ovsbr0-iconn1"</span></span> Interface <span class="hljs-string"><span class="hljs-string">"patch-ovsbr0-iconn1"</span></span> <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>: patch options: {peer=<span class="hljs-string"><span class="hljs-string">"patch-iconn1-ovsbr0"</span></span>} ovs_version: <span class="hljs-string"><span class="hljs-string">"2.3.2"</span></span></code> </pre><br></div></div><br>  The configuration should be the same on all computers. <br><br>  We check IP addresses: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># ip addr show</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">The result of the command ip addr show</b> <div class="spoiler_text"><pre> <code class="bash hljs">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UP group default qlen 1000 link/ether 60:a4:4c:3c:93:06 brd ff:ff:ff:ff:ff:ff inet6 fe80::62a4:4cff:fe3c:9306/64 scope link valid_lft forever preferred_lft forever 3: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default link/ether 0a:91:1b:82:ce:a9 brd ff:ff:ff:ff:ff:ff 4: iconn1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether d6:22:60:7e:9f:48 brd ff:ff:ff:ff:ff:ff inet 192.168.101.1/24 brd 192.168.101.255 scope global iconn1 valid_lft forever preferred_lft forever inet6 fe80::d422:60ff:fe7e:9f48/64 scope link valid_lft forever preferred_lft forever 5: ovsbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether 60:a4:4c:3c:93:06 brd ff:ff:ff:ff:ff:ff inet 192.168.118.16/26 brd 192.168.118.63 scope global dynamic ovsbr0 valid_lft 62646sec preferred_lft 62646sec inet6 fe80::62a4:4cff:fe3c:9306/64 scope link valid_lft forever preferred_lft forever 6: pub0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether f2:c2:ba:85:a2:6e brd ff:ff:ff:ff:ff:ff inet 192.168.100.1/24 brd 192.168.100.255 scope global pub0 valid_lft forever preferred_lft forever inet6 fe80::f0c2:baff:fe85:a26e/64 scope link valid_lft forever preferred_lft forever 7: iconn2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether f2:e6:e8:93:f0:43 brd ff:ff:ff:ff:ff:ff inet 192.168.102.1/24 brd 192.168.102.255 scope global iconn2 valid_lft forever preferred_lft forever inet6 fe80::f0e6:e8ff:fe93:f043/64 scope link valid_lft forever preferred_lft forever 8: dg0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether ae:bb:09:25:5c:4e brd ff:ff:ff:ff:ff:ff inet 192.168.103.1/24 brd 192.168.103.255 scope global dg0 valid_lft forever preferred_lft forever inet6 fe80::acbb:9ff:fe25:5c4e/64 scope link valid_lft forever preferred_lft forever [root@sby ~]<span class="hljs-comment"><span class="hljs-comment"># ip addr show 1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever 2: enp3s0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UP group default qlen 1000 link/ether 10:bf:48:e2:58:5e brd ff:ff:ff:ff:ff:ff inet6 fe80::12bf:48ff:fee2:585e/64 scope link valid_lft forever preferred_lft forever 3: ovs-system: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc noop state DOWN group default link/ether 66:9a:f8:af:48:b4 brd ff:ff:ff:ff:ff:ff 4: iconn1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether da:85:ce:d4:36:4f brd ff:ff:ff:ff:ff:ff inet 192.168.101.2/24 brd 192.168.101.255 scope global iconn1 valid_lft forever preferred_lft forever inet6 fe80::d885:ceff:fed4:364f/64 scope link valid_lft forever preferred_lft forever 5: ovsbr0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether 10:bf:48:e2:58:5e brd ff:ff:ff:ff:ff:ff inet 192.168.118.28/26 brd 192.168.118.63 scope global dynamic ovsbr0 valid_lft 64250sec preferred_lft 64250sec inet6 fe80::12bf:48ff:fee2:585e/64 scope link valid_lft forever preferred_lft forever 6: pub0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether d6:2e:c7:82:d5:8c brd ff:ff:ff:ff:ff:ff inet 192.168.100.2/24 brd 192.168.100.255 scope global pub0 valid_lft forever preferred_lft forever inet6 fe80::d42e:c7ff:fe82:d58c/64 scope link valid_lft forever preferred_lft forever 7: iconn2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether aa:e2:ca:f4:76:4c brd ff:ff:ff:ff:ff:ff inet 192.168.102.2/24 brd 192.168.102.255 scope global iconn2 valid_lft forever preferred_lft forever inet6 fe80::a8e2:caff:fef4:764c/64 scope link valid_lft forever preferred_lft forever 8: dg0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UNKNOWN group default link/ether ca:cc:91:bd:20:47 brd ff:ff:ff:ff:ff:ff inet 192.168.103.2/24 brd 192.168.103.255 scope global dg0 valid_lft forever preferred_lft forever inet6 fe80::c8cc:91ff:febd:2047/64 scope link valid_lft forever preferred_lft forever 9: vnet0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UNKNOWN group default qlen 500 link/ether fe:16:3e:00:02:01 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc16:3eff:fe00:201/64 scope link valid_lft forever preferred_lft forever 10: vnet1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UNKNOWN group default qlen 500 link/ether fe:16:3e:00:02:11 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc16:3eff:fe00:211/64 scope link valid_lft forever preferred_lft forever 11: vnet2: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UNKNOWN group default qlen 500 link/ether fe:16:3e:00:02:21 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc16:3eff:fe00:221/64 scope link valid_lft forever preferred_lft forever 12: vnet3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel master ovs-system state UNKNOWN group default qlen 500 link/ether fe:16:3e:00:02:31 brd ff:ff:ff:ff:ff:ff inet6 fe80::fc16:3eff:fe00:231/64 scope link valid_lft forever preferred_lft forever</span></span></code> </pre><br></div></div><br>  We check that ping is on all addresses. <br><br><h4>  Creating virtual machines </h4><br>  Cooking libvirt: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># systemctl start libvirtd # systemctl enable libvirtd</span></span></code> </pre><br>  Remove the default libvirt network: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-destroy default # virsh net-undefine default</span></span></code> </pre><br>  Create your own network definitions: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#vi ovsbr0.xml</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>public<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">forward</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'bridge'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bridge</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ovsbr0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualport</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'openvswitch'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'public'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'yes'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'100'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-define ovsbr0.xml # virsh net-start public # virsh net-autostart public</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#vi interconnect1.xml</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>interconnect1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">forward</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'bridge'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bridge</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'iconn1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualport</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'openvswitch'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'yes'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'101'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-define interconnect1.xml # virsh net-start interconnect1 # virsh net-autostart interconnect1</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#vi interconnect2.xml</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>interconnect2<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">forward</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'bridge'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bridge</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'iconn2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualport</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'openvswitch'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect2'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'yes'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'102'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-define interconnect2.xml # virsh net-start interconnect2 # virsh net-autostart interconnect2</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#vi dataguard.xml</span></span></code> </pre><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>dataguard<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">forward</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'bridge'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">bridge</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'dg0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">virtualport</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'openvswitch'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'dataguard'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">default</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'yes'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">tag</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">id</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'103'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vlan</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">portgroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">network</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-define dataguard.xml # virsh net-start dataguard # virsh net-autostart dataguard</span></span></code> </pre><br>  Checking: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># virsh net-list Name State Autostart Persistent ---------------------------------------------------------- dataguard active yes yes interconnect1 active yes yes interconnect2 active yes yes public active yes yes</span></span></code> </pre><br>  Create disks for prmy1: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># mkdir /var/lib/libvirt/images/prmy1 [root@prmy ~]# qemu-img create -f qcow2 /var/lib/libvirt/images/prmy1/system.qcow2 20G [root@prmy ~]# qemu-img create -f qcow2 /var/lib/libvirt/images/prmy1/u01.qcow2 16G</span></span></code> </pre><br>  I did not manage to make qemu + kvm work correctly with shared disks in qcow2 format, therefore we create shared disks in raw format. <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># qemu-img create -f raw /var/lib/libvirt/images/df.img 33G [root@prmy ~]# qemu-img create -f raw /var/lib/libvirt/images/dg.img 11G</span></span></code> </pre><br>  Take the Oracle Linux 6.6 64bit distribution and put it in its place: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># cp V52218-01.iso /var/lib/libvirt/images</span></span></code> </pre><br>  Configuring NFS server: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># mkdir /stage [root@prmy ~]# echo '/stage 192.168.100.0/24(ro)' &gt; /etc/exports.d/stage.exports [root@prmy ~]# systemctl start nfs-server [root@prmy ~]# systemctl enable nfs-server</span></span></code> </pre><br>  In / stage, download distributions Grid Infrastructure, Oracle Database 12.1.0.2 and unpack them. <br><pre> <code class="bash hljs">[root@prmy stage]<span class="hljs-comment"><span class="hljs-comment"># cd /stage [root@prmy ~]# unzip -q linuxamd64_12102_database_1of2.zip [root@prmy ~]# unzip -q linuxamd64_12102_database_2of2.zip [root@prmy ~]# unzip -q linuxamd64_12102_grid_1of2.zip [root@prmy ~]# unzip -q linuxamd64_12102_grid_2of2.zip</span></span></code> </pre><br>  Create the prmy1 virtual machine definition: <br><pre> <code class="bash hljs">[root@prmy stage]<span class="hljs-comment"><span class="hljs-comment"># mkdir prmy1 [root@prmy stage]# cd prmy1 [root@prmy prmy1]# vi prmy1.xml</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Contents of the prmy1.xml file</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'kvm'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span>prmy1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memory</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'MiB'</span></span></span><span class="hljs-tag">&gt;</span></span>4300<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currentMemory</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'MiB'</span></span></span><span class="hljs-tag">&gt;</span></span>4300<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">currentMemory</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memoryBacking</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">hugepages</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memoryBacking</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">placement</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'static'</span></span></span><span class="hljs-tag">&gt;</span></span>1<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vcpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">os</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">arch</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'x86_64'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">machine</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pc-i440fx-2.3'</span></span></span><span class="hljs-tag">&gt;</span></span>hvm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">type</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">os</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">features</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">acpi</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">apic</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pae</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">features</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'host-model'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">fallback</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'allow'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">cpu</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clock</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">offset</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'utc'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'rtc'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tickpolicy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'catchup'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pit'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">tickpolicy</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'delay'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">timer</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'hpet'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">present</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'no'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">clock</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_poweroff</span></span></span><span class="hljs-tag">&gt;</span></span>destroy<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_poweroff</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_reboot</span></span></span><span class="hljs-tag">&gt;</span></span>restart<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_reboot</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_crash</span></span></span><span class="hljs-tag">&gt;</span></span>restart<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">on_crash</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pm</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">suspend-to-mem</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'no'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">suspend-to-disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">enabled</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'no'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">pm</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">devices</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">emulator</span></span></span><span class="hljs-tag">&gt;</span></span>/usr/bin/qemu-kvm<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">emulator</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'file'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'disk'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">driver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qemu'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qcow2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/images/prmy1/system.qcow2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dev</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'vda'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">boot</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">order</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x06'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'file'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'disk'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">driver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qemu'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qcow2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/images/prmy1/u01.qcow2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dev</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'vdb'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x07'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'file'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'disk'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">driver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qemu'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'raw'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/images/df.img'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dev</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'vdc'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shareable</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x08'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'file'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'disk'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">driver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qemu'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'raw'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/images/dg.img'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dev</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'vdd'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">shareable</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x09'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'file'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">device</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'cdrom'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">driver</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qemu'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'raw'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">file</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/images/V52218-01.iso'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">dev</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'hda'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ide'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">readonly</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">boot</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">order</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'drive'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">target</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">unit</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">disk</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'usb'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ich9-ehci1'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x05'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x7'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'usb'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ich9-uhci1'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">master</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startport</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x05'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">multifunction</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'on'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'usb'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ich9-uhci2'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">master</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startport</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x05'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'usb'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ich9-uhci3'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">master</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">startport</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'4'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x05'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci-root'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio-serial'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x04'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ide'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">index</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x01'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">controller</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'network'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'00:16:3e:00:01:01'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">network</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'public'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">portgroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'public'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x03'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'network'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'00:16:3e:00:01:11'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">network</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect1'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">portgroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0b'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'network'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'00:16:3e:00:01:21'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">network</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect2'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">portgroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'interconnect2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0c'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'network'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">mac</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">address</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'00:16:3e:00:01:31'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">network</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'dataguard'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">portgroup</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'dataguard'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0d'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">interface</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serial</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pty'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">serial</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">console</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pty'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'serial'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">console</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'unix'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">source</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">mode</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'bind'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">path</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'/var/lib/libvirt/qemu/channel/target/prmy1.org.qemu.guest_agent.0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'org.qemu.guest_agent.0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio-serial'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'spicevmc'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">target</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'com.redhat.spice.0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio-serial'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">controller</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">port</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">channel</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'tablet'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'usb'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'mouse'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ps2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">input</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'keyboard'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ps2'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">graphics</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'spice'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">autoport</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'yes'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">model</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'qxl'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">ram</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'65536'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vram</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'65536'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">vgamem</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'16384'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">heads</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'1'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x02'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memballoon</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">model</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'virtio'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">address</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'pci'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">domain</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bus</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x00'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">slot</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0a'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">function</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'0x0'</span></span></span><span class="hljs-tag">/&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">memballoon</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">devices</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">domain</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br></div></div><br>  Create a virtual machine: <br><pre> <code class="bash hljs">[root@prmy prmy1]<span class="hljs-comment"><span class="hljs-comment"># virsh define prmy1.xml</span></span></code> </pre><br>  Run Virtual Machine Manager and install the operating system in any way convenient for you.  Network interfaces must obtain their IP addresses from our DHCP.  200MB give for / boot, 8GB for swap and the rest for /.  We use, for example, ext3 as a file system for / and / boot. <br><br>  We will include the following groups in the package for installation: <br><pre> <code class="bash hljs">@core @base @x11 @basic-desktop @general-desktop @guest-agents</code> </pre><br>  as well as packages: <br><pre> <code class="bash hljs">oracleasm-support oracle-rdbms-server-12cR1-preinstall nscd ntp</code> </pre><br><h4>  Configuring Oracle Linux 6 </h4><br>  Connect to the created virtual machine and configure it: <br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># ssh -X root@prmy1.example.com</span></span></code> </pre><br>  Getting rid of GNOME: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># vi /etc/inittab id:3:initdefault:</span></span></code> </pre><br>  We get rid of questions when the root user deletes a file: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># sed -i -e 's/alias/#&amp;/gi' /root/.bashrc</span></span></code> </pre><br>  We get rid of running unnecessary services like cups and others with the chkconfig command: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># chkconfig cups off ‚Ä¶</span></span></code> </pre><br>  The ntpd and nscd services, on the contrary, include: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># chkconfig ntpd on [root@prmy1 ~]# chkconfig nscd on</span></span></code> </pre><br>  After the reboot, I got the following: <br><div class="spoiler">  <b class="spoiler_title">The result of the chkconfig command --list |</b>  <b class="spoiler_title">grep: on</b> <div class="spoiler_text"><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># chkconfig --list | grep :on acpid 0:off 1:off 2:on 3:on 4:on 5:on 6:off atd 0:off 1:off 2:off 3:on 4:on 5:on 6:off auditd 0:off 1:off 2:on 3:on 4:on 5:on 6:off blk-availability 0:off 1:on 2:on 3:on 4:on 5:on 6:off cpuspeed 0:off 1:on 2:on 3:on 4:on 5:on 6:off crond 0:off 1:off 2:on 3:on 4:on 5:on 6:off haldaemon 0:off 1:off 2:off 3:on 4:on 5:on 6:off irqbalance 0:off 1:off 2:off 3:on 4:on 5:on 6:off mcelogd 0:off 1:off 2:off 3:on 4:off 5:on 6:off messagebus 0:off 1:off 2:on 3:on 4:on 5:on 6:off netfs 0:off 1:off 2:off 3:on 4:on 5:on 6:off network 0:off 1:off 2:on 3:on 4:on 5:on 6:off nfslock 0:off 1:off 2:off 3:on 4:on 5:on 6:off nscd 0:off 1:off 2:on 3:on 4:on 5:on 6:off ntpd 0:off 1:off 2:on 3:on 4:on 5:on 6:off oracle-rdbms-server-12cR1-preinstall-firstboot 0:off 1:off 2:on 3:on 4:on 5:on 6:off oracleasm 0:off 1:off 2:on 3:on 4:on 5:on 6:off portreserve 0:off 1:off 2:on 3:on 4:on 5:on 6:off qemu-ga 0:off 1:off 2:on 3:on 4:on 5:on 6:off rpcbind 0:off 1:off 2:on 3:on 4:on 5:on 6:off rpcgssd 0:off 1:off 2:off 3:on 4:on 5:on 6:off rsyslog 0:off 1:off 2:on 3:on 4:on 5:on 6:off spice-vdagentd 0:off 1:off 2:off 3:off 4:off 5:on 6:off sshd 0:off 1:off 2:on 3:on 4:on 5:on 6:off sysstat 0:off 1:on 2:on 3:on 4:on 5:on 6:off udev-post 0:off 1:on 2:on 3:on 4:on 5:on 6:off</span></span></code> </pre><br></div></div><br>  Configuring ntpd: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># vi /etc/sysconfig/ntpd # Drop root to id 'ntp:ntp' by default. OPTIONS="-x -u ntp:ntp -p /var/run/ntpd.pid -g" # Set to 'yes' to sync hw clock after successful ntpdate SYNC_HWCLOCK=no # Additional options for ntpdate NTPDATE_OPTIONS=""</span></span></code> </pre><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># vi /etc/ntp.conf</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Contents of the / etc / ntp.conf file</b> <div class="spoiler_text"><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># For more information about this file, see the man pages # ntp.conf(5), ntp_acc(5), ntp_auth(5), ntp_clock(5), ntp_misc(5), ntp_mon(5). driftfile /var/lib/ntp/drift # Permit time synchronization with our time source, but do not # permit the source to query or modify the service on this system. restrict default kod nomodify notrap nopeer noquery restrict -6 default kod nomodify notrap nopeer noquery # Permit all access over the loopback interface. This could # be tightened as well, but to do so would effect some of # the administrative functions. restrict 127.0.0.1 restrict -6 ::1 # Hosts on local network are less restricted. #restrict 192.168.1.0 mask 255.255.255.0 nomodify notrap # Use public servers from the pool.ntp.org project. # Please consider joining the pool (http://www.pool.ntp.org/join.html). server 192.168.100.1 server 127.127.1.0 # local clock fudge 127.127.1.0 stratum 10 broadcastdelay 0.008 # Key file containing the keys and key identifiers used when operating # with symmetric key cryptography. keys /etc/ntp/keys</span></span></code> </pre><br></div></div><br>  Configuring limits: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># vi /etc/security/limits.conf</span></span></code> </pre><br><div class="spoiler">  <b class="spoiler_title">Added lines to the /etc/security/limits.conf file</b> <div class="spoiler_text"><pre> <code class="bash hljs">oracle soft nofile 131072 oracle hard nofile 131072 oracle soft nproc 131072 oracle hard nproc 131072 oracle soft core unlimited oracle hard core unlimited oracle soft memlock 3828161 oracle hard memlock 3828161 grid soft nofile 131072 grid hard nofile 131072 grid soft nproc 131072 grid hard nproc 131072 grid soft core unlimited grid hard core unlimited grid soft memlock 3828161 grid hard memlock 3828161 <span class="hljs-comment"><span class="hljs-comment"># Recommended stack hard limit 32MB for oracle installations # oracle hard stack 32768</span></span></code> </pre><br></div></div><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># cd /etc/profile.d [root@prmy1 profile.d]# vi oracle.sh if [ $USER = "oracle" ] || [ $USER = "grid" ]; then if [ /bin/bash = "/bin/ksh" ]; then ulimit -p 16384 ulimit -n 65536 else ulimit -u 16384 -n 65536 fi umask 022 fi</span></span></code> </pre><br><pre> <code class="bash hljs">[root@prmy1 profile.d]<span class="hljs-comment"><span class="hljs-comment"># ln -s oracle.sh oracle.csh</span></span></code> </pre><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e 's/(tmpfs.*)(defaults)/\1size=3800M,rw,exec/gi' /etc/fstab</span></span></code> </pre><br>  eth0, eth3 - public eth1, eth2 - interconnect <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># echo "net.ipv4.conf.eth0.rp_filter = 1" &gt;&gt; /etc/sysctl.conf [root@prmy1 ~]# echo "net.ipv4.conf.eth3.rp_filter = 1" &gt;&gt; /etc/sysctl.conf [root@prmy1 ~]# echo "net.ipv4.conf.eth1.rp_filter = 2" &gt;&gt; /etc/sysctl.conf [root@prmy1 ~]# echo "net.ipv4.conf.eth2.rp_filter = 2" &gt;&gt; /etc/sysctl.conf</span></span></code> </pre><br>  Create groups for Oracle: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># groupadd oper [root@prmy1 ~]# groupadd asmdba [root@prmy1 ~]# groupadd asmoper [root@prmy1 ~]# groupadd asmadmin</span></span></code> </pre><br>  We include the user oracle in the groups dba, oper and asmdba <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># usermod -G dba,oper,asmdba oracle [root@prmy1 ~]# passwd oracle</span></span></code> </pre><br>  Create a user grid: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># useradd -m -g oinstall -G asmdba,asmoper,asmadmin grid [root@prmy1 ~]# passwd grid</span></span></code> </pre><br>  For convenience, we will display the Oracle instance name at the bash prompt: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># echo 'export PS1="[\u@\h-\`echo \$ORACLE_SID\` \W]$ "' &gt;&gt; /home/oracle/.bashrc [root@prmy1 ~]# echo 'export PS1="[\u@\h-\`echo \$ORACLE_SID\` \W]$ "' &gt;&gt; /home/grid/.bashrc [root@prmy1 ~]# echo 'export PS1="[\u@\h-\`echo \$ORACLE_SID\` \W]# "' &gt;&gt; /root/.bashrc</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a partition and file system on a disk designed to install Oracle software. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It should turn out like this:</font></font><br><pre> <code class="bash hljs">[root@sby1- ~]<span class="hljs-comment"><span class="hljs-comment"># fdisk -u -c -l /dev/vdb Disk /dev/vdb: 17.2 GB, 17179869184 bytes 3 heads, 2 sectors/track, 5592405 cylinders, total 33554432 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0xf12e0427 Device Boot Start End Blocks Id System /dev/vdb1 2048 33554431 16776192 83 Linux</span></span></code> </pre><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># mkfs.ext3 -L u01 /dev/vdb1</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> I want to mount partitions not by uuid, but by LABEL: </font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># tune2fs -L boot /dev/vda1 [root@prmy1 ~]# tune2fs -L root /dev/vda3 [root@prmy1 ~]# swapoff [root@prmy1 ~]# mkswap -L swap /dev/vda2 [root@prmy1 ~]# vi /etc/fstab LABEL=root / ext3 defaults 1 1 LABEL=boot /boot ext3 defaults 1 2 LABEL=swap swap swap defaults 0 0 tmpfs /dev/shm tmpfs defaults 0 0 devpts /dev/pts devpts gid=5,mode=620 0 0 sysfs /sys sysfs defaults 0 0 proc /proc proc defaults 0 0 LABEL=u01 /u01 ext3 defaults 0 0</span></span></code> </pre><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># mount -a [root@prmy1 ~]# mkdir -p /u01/app/12.1.0/grid [root@prmy1 ~]# mkdir -p /u01/app/grid [root@prmy1 ~]# mkdir -p /u01/app/oracle [root@prmy1 ~]# chown -R grid:oinstall /u01 [root@prmy1 ~]# chown oracle:oinstall /u01/app/oracle [root@prmy1 ~]# chmod -R 775 /u01/</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We cut sections for ASM disks, at me it turned out so: </font></font><br><pre> <code class="bash hljs">[root@sby1- ~]<span class="hljs-comment"><span class="hljs-comment"># fdisk -l -u -c /dev/vdc Disk /dev/vdc: 35.4 GB, 35433480192 bytes 16 heads, 63 sectors/track, 68656 cylinders, total 69206016 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x8cee7a8e Device Boot Start End Blocks Id System /dev/vdc1 2048 5656927 2827440 83 Linux /dev/vdc2 5656928 11311807 2827440 83 Linux /dev/vdc3 11311808 16966687 2827440 83 Linux /dev/vdc4 16966688 69206015 26119664 5 Extended /dev/vdc5 16968736 22623615 2827440 83 Linux /dev/vdc6 22625664 28280543 2827440 83 Linux /dev/vdc7 28282592 33937471 2827440 83 Linux /dev/vdc8 33939520 39594399 2827440 83 Linux /dev/vdc9 39596448 45251327 2827440 83 Linux /dev/vdc10 45253376 50908255 2827440 83 Linux /dev/vdc11 50910304 56565183 2827440 83 Linux /dev/vdc12 56567232 62222111 2827440 83 Linux /dev/vdc13 62224160 67879039 2827440 83 Linux</span></span></code> </pre><br><pre> <code class="bash hljs">[root@sby1- ~]<span class="hljs-comment"><span class="hljs-comment"># fdisk -u -c -l /dev/vdd Disk /dev/vdd: 11.8 GB, 11811160064 bytes 1 heads, 32 sectors/track, 720896 cylinders, total 23068672 sectors Units = sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes Disk identifier: 0x3416c855 Device Boot Start End Blocks Id System /dev/vdd1 2048 5656927 2827440 83 Linux /dev/vdd2 5656928 11311807 2827440 83 Linux /dev/vdd3 11311808 16966687 2827440 83 Linux /dev/vdd4 16966688 22621567 2827440 83 Linux</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> From the Oracle website, download the oracleasmlib-2.0.4-1.el6.x86_64 package, put it on the prmy on / stage and install it: </font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># mount prmy:/stage /stage [root@prmy1 ~]# rpm -Uvh oracleasmlib-2.0.4-1.el6.x86_64.rpm [root@prmy1 ~]# rpm -Uvh /stage/grid/rpm/cvuqdisk-1.0.9-1.rpm [root@prmy1 ~]# umount /stage</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configure oracleasm: </font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># /usr/sbin/oracleasm configure -e -u grid -g asmadmin -sy</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create ASM disks: </font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># oracleasm createdisk ASMDISK1P1 /dev/vdc1 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P2 /dev/vdc2 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P3 /dev/vdc3 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P4 /dev/vdc5 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P5 /dev/vdc6 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P6 /dev/vdc7 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P7 /dev/vdc8 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P8 /dev/vdc9 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P9 /dev/vdc10 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P10 /dev/vdc11 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P11 /dev/vdc12 [root@prmy1 ~]# oracleasm createdisk ASMDISK1P12 /dev/vdc13 [root@prmy1 ~]# oracleasm createdisk ASMDISK2P1 /dev/vdd1 [root@prmy1 ~]# oracleasm createdisk ASMDISK2P2 /dev/vdd2 [root@prmy1 ~]# oracleasm createdisk ASMDISK2P3 /dev/vdd3 [root@prmy1 ~]# oracleasm createdisk ASMDISK2P4 /dev/vdd4</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">At this configuration virtualka can be considered complete, now turn it off to proceed to its cloning. </font><font style="vertical-align: inherit;">But before that, to facilitate cloning, let's copy files from it, which will be different in each virtual machine.</font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># ssh prmy mkdir /stage/prmy1 [root@prmy1 ~]# scp /etc/sysconfig/network prmy:/stage/prmy1 [root@prmy1 ~]# scp /etc/sysconfig/network/scripts/ifcfg-eth* prmy:/stage/prmy1 [root@prmy1 ~]# scp /etc/udev/rules.d/70-persistent-net.rules prmy:/stage/prmy1 [root@prmy1 ~]# poweroff</span></span></code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Virtual machine cloning </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Copy shared disks to sby: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># scp /var/lib/libvirt/images/*.img sby:/var/lib/libvirt/images</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create directories for virtualok: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># mkdir /var/lib/libvirt/images/prmy2 [root@prmy ~]# mkdir /var/lib/libvirt/images/prmy3 [root@prmy ~]# ssh sby mkdir /var/lib/libvirt/images/sby1 [root@prmy ~]# ssh sby mkdir /var/lib/libvirt/images/sby2 [root@prmy ~]# ssh sby mkdir /var/lib/libvirt/images/sby3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We copy our "reference" images of system.qcow and u01.qcow2 on sby. </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># scp /var/lib/libvirt/images/prmy1/system.qcow sby:/var/lib/libvirt/images [root@prmy ~]# scp /var/lib/libvirt/images/prmy1/ u01.qcow2 sby:/var/lib/libvirt/images/sby1 [root@prmy ~]# scp /var/lib/libvirt/images/prmy1/ u01.qcow2 sby:/var/lib/libvirt/images/sby2 [root@prmy ~]# scp /var/lib/libvirt/images/prmy1/ u01.qcow2 sby:/var/lib/libvirt/images/sby3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We clone the virtual disk system.qcow2 on prmy: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># mv /var/lib/libvirt/images/prmy1/system.qcow2 /var/lib/libvirt/images [root@prmy ~]# qemu-img create -f qcow2 -o backing_file=/var/lib/libvirt/images/system.qcow2 /var/lib/libvirt/images/prmy1/system.qcow2 [root@prmy ~]# qemu-img create -f qcow2 -o backing_file=/var/lib/libvirt/images/system.qcow2 /var/lib/libvirt/images/prmy2/system.qcow2 [root@prmy ~]# qemu-img create -f qcow2 -o backing_file=/var/lib/libvirt/images/system.qcow2 /var/lib/libvirt/images/prmy3/system.qcow2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Disk u01.qcow2 just copy: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># cp /var/lib/libvirt/images/prmy1/u01.qcow2 /var/lib/libvirt/images/prmy2/u01.qcow2 [root@prmy ~]# cp /var/lib/libvirt/images/prmy1/u01.qcow2 /var/lib/libvirt/images/prmy3/u01.qcow2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Preparing files for replacement in virtuals: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># mkdir /stage/{prmy2, prmy3} [root@prmy ~]# cd /stage/prmy1 [root@prmy prmy1]# cp ifcfg-eth* network 70-persistent-net.rules ../prmy2 [root@prmy prmy1]# cp ifcfg-eth* network 70-persistent-net.rules ../prmy3 [root@prmy prmy1]# scp ifcfg-eth* network 70-persistent-net.rules sby:/stage/sby1 [root@prmy prmy1]# scp ifcfg-eth* network 70-persistent-net.rules sby:/stage/sby2 [root@prmy prmy1]# scp ifcfg-eth* network 70-persistent-net.rules sby:/stage/sby3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> There we also copy the definition of the prmy1 virtual machine: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy1]<span class="hljs-comment"><span class="hljs-comment"># cp prmy1.xml /stage/prmy2/prmy2.xml [root@prmy prmy1]# cp prmy1.xml /stage/prmy3/prmy3.xml [root@prmy prmy1]# scp prmy1.xml sby:/stage/sby1/sby1.xml [root@prmy prmy1]# scp prmy1.xml sby:/stage/sby2/sby3.xml [root@prmy prmy1]# scp prmy1.xml sby:/stage/sby3/sby3.xml [root@prmy prmy1]# cd ../prmy2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Editing files: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/prmy2/gi" network [root@prmy prmy2]# sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\11\32/gi' ifcfg-eth* 70-persistent-net.rules</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Copy them to the prmy2 virtual machine image: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># guestfish &lt;&lt; EOF add /var/lib/libvirt/images/prmy2/system.qcow2 run mount /dev/sda3 / copy-in network /etc/sysconfig copy-in ifcfg-eth0 /etc/sysconfig/network-scripts copy-in ifcfg-eth1 /etc/sysconfig/network-scripts copy-in ifcfg-eth2 /etc/sysconfig/network-scripts copy-in ifcfg-eth3 /etc/sysconfig/network-scripts copy-in 70-persistent-net.rules /etc/udev/rules.d umount / exit EOF</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Edit the definition of the prmy2 virtual machine. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">change names:</font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/prmy2/gi" prmy2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> change mac addresses: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\11\32/gi' prmy2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remove the cdrom: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># sed -i "/&lt;disk.*cdrom/,/&lt;\/disk&gt;/ {; d; }" prmy2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> remove the IDE controller: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># sed -i "/&lt;controller.*ide/,/&lt;\/controller&gt;/ {; d; }" prmy2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And create a prmy2 virtual machine: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy2]<span class="hljs-comment"><span class="hljs-comment"># virsh define prmy2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We continue in the same vein with prmy3. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Names change team:</font></font><br><pre> <code class="bash hljs">[root@prmy prmy3]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/prmy3/gi" network prmy3.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Mac addresses respectively: </font></font><br><pre> <code class="bash hljs">[root@prmy prmy3]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\11\33/gi' ifcfg-eth* 70-persistent-net.rules prmy3.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start virtual computers: </font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># virsh start prmy1 [root@prmy ~]# virsh start prmy2 [root@prmy ~]# virsh start prmy3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We connect to them, we check that they have the correct name, the neighbors on the network, the DNS and NTP server they see, the disks are in place: </font></font><br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># hostname # ping # df -h # oracleasm listdisks</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">A similar procedure needs to be done with virtual machines on sby.example.com. </font></font><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">For example, the names and Mac addresses in the files for sby1 are changed as follows:</font></font><br><pre> <code class="bash hljs">[root@sby sby1]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/sby1/gi" network sby1.xml [root@sby sby1]# sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\12\31/gi' ifcfg-eth* 70-persistent-net.rules sby1.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sby2: </font></font><br><pre> <code class="bash hljs">[root@sby sby2]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/sby2/gi" network sby2.xml [root@sby sby2]# sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\12\32/gi' ifcfg-eth* 70-persistent-net.rules sby2.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> sby3: </font></font><br><pre> <code class="bash hljs">[root@sby sby2]<span class="hljs-comment"><span class="hljs-comment"># sed -i -r -e "s/prmy1/sby3/gi" network sby3.xml [root@sby sby2]# sed -i -r -e 's/(00:16:3E:00:0)(.)(:.)(1)/\12\33/gi' ifcfg-eth* 70-persistent-net.rules sby3.xml</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We also start them: </font></font><br><pre> <code class="bash hljs">[root@sby ~]<span class="hljs-comment"><span class="hljs-comment"># virsh start sby1 [root@sby ~]# virsh start sby2 [root@sby ~]# virsh start sby3</span></span></code> </pre><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Grid Infrastructure Installation </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The process is quite long and boring. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install the Grid Infrastructure on prmy:</font></font><br><pre> <code class="bash hljs">[root@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># ssh -X grid@prmy1 [grid@prmy1- ~]$ su - [root@prmy1 ~]# mount prmy:/stage /stage [root@prmy1 ~]# exit [grid@prmy1- ~]$ /stage/grid/runInstaller</span></span></code> </pre><br><img src="https://habrastorage.org/files/6b5/ee1/8d4/6b5ee18d4be1467e81234d458b9ddc6b.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We do not need Flex Cluster. </font></font><br><img src="https://habrastorage.org/files/888/e87/e6a/888e87e6ae134999b6c2e3ff412f86e5.png"><br><img src="https://habrastorage.org/files/2dc/d9f/056/2dcd9f05643649ef8b6bcdac4993cebd.png"><br><img src="https://habrastorage.org/files/b12/8e2/244/b128e2244c564da18544e31e30492493.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will configure GNS on the domain specified in DNS when delegating a zone. </font></font><br><img src="https://habrastorage.org/files/686/307/620/686307620b534c769edb3c2116e15628.png"><br><img src="https://habrastorage.org/files/1a6/b21/50d/1a6b2150d65f4ebc8705c38cb6b87d82.png"><br><img src="https://habrastorage.org/files/bb0/d5a/647/bb0d5a64754d4a208077342629b9cbd9.png"><br><img src="https://habrastorage.org/files/ae6/2b6/aa7/ae62b6aa737844b8bb6a806089a824b7.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will configure the Flex ASM, although by and large it is not needed here. </font><font style="vertical-align: inherit;">However, this is a stand for exploring the possibilities and you can limit the number of nodes on which ASM starts to two. </font><font style="vertical-align: inherit;">With standard ASM, you could save on memory ‚Äî its minimum requirements are 300M instead of 1G for Flex ASM. </font></font><br><img src="https://habrastorage.org/files/3bf/f12/880/3bff1288001f42ac86f9deec63178332.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We take the first 8 disks. </font></font><br><img src="https://habrastorage.org/files/1c5/073/3f5/1c50733f59fb4068ab6d02e484e47c50.png"><br><img src="https://habrastorage.org/files/1d9/4c1/6e0/1d94c16e093d4a67a89b6055cb0a9fbc.png"><br><img src="https://habrastorage.org/files/25f/d17/3cd/25fd173cd6244a358c8072d0fdfa5ff1.png"><br><img src="https://habrastorage.org/files/72e/79b/dfb/72e79bdfb4984deab711c2bd443a6117.png"><br><img src="https://habrastorage.org/files/be2/bec/f3f/be2becf3ff4440bb801ef321368f3bc0.png"><br><img src="https://habrastorage.org/files/107/c51/961/107c5196185d4585847545fec4303007.png"><br><img src="https://habrastorage.org/files/e4a/535/670/e4a535670a7e4d1bb95b337907d7808c.png"><br><img src="https://habrastorage.org/files/f9a/18d/671/f9a18d671a4c49f1a0a66d130ff7f465.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">If they did everything like mine, then the checks and the installation should go without comment. </font></font><br><img src="https://habrastorage.org/files/f45/cde/d8d/f45cded8d76748e4bfc04c35a6fe7e58.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the installation is complete, unload GNS data to connect the client:</font></font><br><pre> <code class="bash hljs">[grid@prmy ~]<span class="hljs-comment"><span class="hljs-comment"># su - [root@prmy1 ~]# . oraenv ORACLE_SID = [root] ? +ASM1 The Oracle base has been set to /u01/app/grid [root@prmy1 ~]# srvctl export gns -clientdata /tmp/gnsclientdata root@prmy1 ~]# scp /tmp/gnsclientdata sby1:/tmp/gnsclientdata</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">GNS will be in one copy. </font><font style="vertical-align: inherit;">The backup cluster will use GNS primary. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Installing Grid Infrastructure on sby is similar to what we have already done with the exception of node names and GNS.</font></font><br><pre> <code class="bash hljs">[root@sby ~]<span class="hljs-comment"><span class="hljs-comment"># ssh -X grid@sby1 [grid@sby1- ~]$ su - [root@sby1 ~]# mount prmy:/stage /stage [root@sby1 ~]# exit [grid@sby1- ~]$ /stage/grid/runInstaller</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> If we chose to install Flex Cluster, we would not be able to use the GNS of the neighboring cluster. </font></font><br><img src="https://habrastorage.org/files/c4c/97c/b1d/c4c97cb1dc6b40cfa2a5a3893205de79.png"><br><img src="https://habrastorage.org/files/e7e/146/e37/e7e146e37b064c81b7d8697a9a0dc5c7.png"><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating additional ASM disk groups </font></font></h4><br>        : <br> FRA ‚Äî Fast Recovery Area <br> ACFS ‚Äî   Oracle Home Oracle Database. <br><br>       4  , redundancy external. <br><br>  ACFS      acfs       Oracle Database.             ‚Äî         .            Data Duard. <br><br>    acfs: <br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># mkdir -p /u01/app/oracle/acfsmounts/acfs_db1 [root@prmy1 ~]# ssh prmy2 mkdir -p /u01/app/oracle/acfsmounts/acfs_db1 [root@prmy1 ~]# ssh prmy3 mkdir -p /u01/app/oracle/acfsmounts/acfs_db1 [root@prmy1 ~]# chown -R oracle:oinstall /u01/app/oracle/acfsmounts [root@prmy1 ~]# ssh prmy2 chown -R oracle:oinstall /u01/app/oracle/acfsmounts [root@prmy1 ~]# ssh prmy3 chown -R oracle:oinstall /u01/app/oracle/acfsmounts</span></span></code> </pre><br><pre> <code class="bash hljs">[grid@prmy1-+ASM1 ~]$ asmca</code> </pre><br><img src="https://habrastorage.org/files/ea9/409/215/ea940921593f4f658a283edd7be86f68.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We will not have other software versions, so we are changing the compatibility version of compatible.rdbms and compatible.asm of the DATA group to 12.1.0.2.0. </font></font><br><img src="https://habrastorage.org/files/d9d/75e/b67/d9d75eb677d74539a59ef5b3f6f1d19e.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">FRA is also created with compatible.rdbms and compatible.asm 12.1.0.2.0. </font></font><br><img src="https://habrastorage.org/files/f1f/80d/70f/f1f80d70f3954ef8a0b46244964ca3f1.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">On ACFS, we additionally set compatible.advm = 12.1.0.2.0. </font></font><br><img src="https://habrastorage.org/files/e20/470/97f/e2047097f8984cc6843da98aadf873e2.png"><br><img src="https://habrastorage.org/files/632/005/e9d/632005e9d0f34697acac9ffa103d91dd.png"><br><img src="https://habrastorage.org/files/393/f33/a5d/393f33a5d4b2487980b91d9ee44f6274.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We are asked to execute the script as root:</font></font><br><img src="https://habrastorage.org/files/580/b46/45b/580b4645ba414282adaab7cce452778c.png"><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># /u01/app/grid/cfgtoollogs/asmca/scripts/acfs_script.sh ACFS file system /u01/app/oracle/acfsmounts/acfs_db1 is mounted on nodes prmy1,prmy2,prmy3</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Similarly, we configure disk groups on the sby cluster. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Installing Oracle Database Software </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Install the Oracle Database software. </font><font style="vertical-align: inherit;">The base itself will be created separately using dbca. </font><font style="vertical-align: inherit;">Install on all 3 cluster nodes. </font></font><br><br><img src="https://habrastorage.org/files/aa1/07c/0a3/aa107c0a3b754fba8257fbc8c88dd7a5.png"><br><img src="https://habrastorage.org/files/ce5/eb3/46c/ce5eb346c30a499d9f86700af8dc7ff8.png"><br><img src="https://habrastorage.org/files/a77/b4d/114/a77b4d114a754b61a8ae654a147870f3.png"><br><img src="https://habrastorage.org/files/638/43f/2da/63843f2da0d54df8b6c3c755a9f0e3b1.png"><br><img src="https://habrastorage.org/files/f6b/328/759/f6b32875906a4f5bb2957e067e71f690.png"><br><img src="https://habrastorage.org/files/9b5/29c/b24/9b529cb240d84ec5b4886691ee2fee3c.png"><br><img src="https://habrastorage.org/files/1f5/1a0/fed/1f51a0feda0841b49a8d9c93180cfcda.png"><br><img src="https://habrastorage.org/files/1f8/159/3b7/1f81593b77cf481b8119ebdd7e485a2e.png"><br><img src="https://habrastorage.org/files/7e3/f41/c1e/7e3f41c1e8f74325841b352dcf0a2b99.png"><br><img src="https://habrastorage.org/files/678/a06/3c4/678a063c41b24d51af3db093095766ba.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When checking, for some reason, he does not see the hard memlock = 3828161 parameter set to the desired value. </font><font style="vertical-align: inherit;">It creates a fixup script, and when it is executed, it reinstalls the parameter to the same value, but still gets offended by this parameter. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">In short, safely ignore it. </font></font><br><img src="https://habrastorage.org/files/14a/217/296/14a2172965b84a58a9f449c33a3d6e57.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Similarly, install the software on the sby cluster. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">After the installation is completed on sby, we run the following command:</font></font><br><pre> <code class="bash hljs">[root@sby1-sby ~]<span class="hljs-comment"><span class="hljs-comment"># /u01/app/12.1.0/grid/bin/setasmgidwrap o=/u01/app/oracle/acfsmounts/acfs_db1/bin/oracle</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Otherwise, our stanby database will not get access to files on ASM. </font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating the main cluster database </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The database can be created and policy or administrator managed. </font><font style="vertical-align: inherit;">In any case, for this database we will use only 2 cluster nodes. </font><font style="vertical-align: inherit;">The third is for Far Sync. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I created the administrator managed database:</font></font><br><pre> <code class="bash hljs">[oracle@prmy1- ~]$ . oraenv ORACLE_SID = [oracle] ? prmy ORACLE_HOME = [/home/oracle] ? /u01/app/oracle/acfsmounts/acfs_db1 The Oracle base has been <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to /u01/app/oracle [oracle@prmy1-prmy ~]$ dbca</code> </pre><br><img src="https://habrastorage.org/files/2b7/d9f/632/2b7d9f63200e46a0b53c483d5c606a11.png"><br><img src="https://habrastorage.org/files/942/048/318/9420483180a348d595cb9f9ecb8f2c34.png"><br><img src="https://habrastorage.org/files/35f/a92/2a5/35fa922a547b42779b7ed501137d7a3c.png"><br><img src="https://habrastorage.org/files/97c/0ae/54b/97c0ae54b03d4d4db508f08ee146f2d9.png"><br><img src="https://habrastorage.org/files/367/6d7/1ea/3676d71ea10243e8a9e4d08815784a72.png"><br><img src="https://habrastorage.org/files/12f/4a5/be7/12f4a5be7a1446f6a8bd4b70fc0b90a8.png"><br><img src="https://habrastorage.org/files/36b/7c4/5c8/36b7c45c86814ff9b0ea64bfb8c1ad7a.png"><br><img src="https://habrastorage.org/files/547/e6a/cf2/547e6acf2e3746f7960acd6260dd31ee.png"><br><img src="https://habrastorage.org/files/188/12e/cc5/18812ecc5b674d129bf9c2d5a4c7bcc5.png"><br><img src="https://habrastorage.org/files/8e0/b3d/a14/8e0b3da14e96432ea9f291e1b2f9306c.png"><br><img src="https://habrastorage.org/files/cb2/631/deb/cb2631deb57b40ac9b0f0d8ac05b1fee.png"><br><img src="https://habrastorage.org/files/523/108/5d1/5231085d18ae4d598a7b7c15e80c530e.png"><br><img src="https://habrastorage.org/files/11d/2a5/5a8/11d2a55a85bd4131999783921e47cd3e.png"><br><img src="https://habrastorage.org/files/588/fb2/ce9/588fb2ce977742a18f01f491830b0c1b.png"><br><img src="https://habrastorage.org/files/103/3e3/e1e/1033e3e1e8364b34852a8c7d798e47cf.png"><br><img src="https://habrastorage.org/files/71c/19e/058/71c19e0589854b0cb4d3ce162b07b1af.png"><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/dbs [oracle@prmy1-prmy dbs]$ mv initprmy1.ora initprmy.ora [oracle@prmy1-prmy dbs]$ rm initprmy2.ora [oracle@prmy1-prmy dbs]$ ln -s initprmy.ora initprmy1.ora [oracle@prmy1-prmy dbs]$ ln -s initprmy.ora initprmy2.ora</code> </pre><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Configuring Oracle Net for Data Guard </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Configure the main cluster. </font><font style="vertical-align: inherit;">First, use the remaining unused network 192.168.103.0/24 for Data Guard.</font></font><br><pre> <code class="bash hljs">[root@prmy1 ~]<span class="hljs-comment"><span class="hljs-comment"># . oraenv ORACLE_SID = [root] ? +ASM1 The Oracle base has been set to /u01/app/grid [root@prmy1-+ASM1 ~]# oifcfg setif -global eth3/192.168.103.0:public [root@prmy1-+ASM1 ~]# crsctl stop cluster -all [root@prmy1-+ASM1 ~]# crsctl start cluster -all</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Check those networks that are already configured: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># crsctl stat res -t | grep network ora.net1.network</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Then I will do the second public dhcp network, although I </font></font><b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">don‚Äôt even have to do this on the stand</font></font></b><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , and the documentation for the srvctl add network command explicitly says: </font></font><br><br> <i><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Oracle only supports DHCP </font></font></i> <br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">So, in the srvctl add network command, use the -nettype static option to allocate static VIP addresses, well, and further on the documentation. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Nevertheless, we will be allowed to make such a network and outwardly everything will work for some time. </font><font style="vertical-align: inherit;">But when I started the VIP address, I had a storm of DHCP requests to this address.</font></font><br><pre> <code class="bash hljs">Jul 30 06:55:05 prmy.example.com dhcpd[14785]: DHCPDISCOVER from 00:00:00:00:00:00 via dg0 Jul 30 06:55:05 prmy.example.com dhcpd[14785]: DHCPOFFER on 192.168.103.124 to 00:00:00:00:00:00 via dg0 Jul 30 06:55:05 prmy.example.com dhcpd[14785]: reuse_lease: lease age 49 (secs) under 25% threshold, reply with unaltered, existing lease Jul 30 06:55:05 prmy.example.com dhcpd[14785]: DHCPREQUEST <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 192.168.103.124 (192.168.103.1) from 00:00:00:00:00:00 via dg0 Jul 30 06:55:05 prmy.example.com dhcpd[14785]: DHCPACK on 192.168.103.124 to 00:00:00:00:00:00 via dg0 Jul 30 06:55:06 prmy.example.com dhcpd[14785]: reuse_lease: lease age 50 (secs) under 25% threshold, reply with unaltered, existing lease Jul 30 06:55:06 prmy.example.com dhcpd[14785]: DHCPDISCOVER from 00:00:00:00:00:00 via dg0 Jul 30 06:55:06 prmy.example.com dhcpd[14785]: DHCPOFFER on 192.168.103.124 to 00:00:00:00:00:00 via dg0 Jul 30 06:55:06 prmy.example.com dhcpd[14785]: reuse_lease: lease age 50 (secs) under 25% threshold, reply with unaltered, existing lease Jul 30 06:55:06 prmy.example.com dhcpd[14785]: DHCPREQUEST <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> 192.168.103.124 (192.168.103.1) from 00:00:00:00:00:00 via dg0 Jul 30 06:55:06 prmy.example.com dhcpd[14785]: DHCPACK on 192.168.103.124 to 00:00:00:00:00:00 via dg0 Jul 30 06:55:07 prmy.example.com dhcpd[14785]: reuse_lease: lease age 51 (secs) under 25% threshold, reply with unaltered, existing lease ...</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">All this did not prevent me from bringing the creation of the Data Guard configuration to the end (the VIP agent did not have time to fill the file system with its DHCP request logs). </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">The next free network number is -2, we configure it:</font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl add network -netnum 2 -subnet 192.168.103.0/255.255.255.0/eth3 -nettype dhcp -verbose Successfully added Network. [root@prmy1-+ASM1 ~]# crsctl stat res -t | grep network ora.net1.network ora.net2.network</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add VIP addresses: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl add vip -node prmy1 -netnum 2 [root@prmy1-+ASM1 ~]# srvctl add vip -node prmy2 -netnum 2 [root@prmy1-+ASM1 ~]# srvctl add vip -node prmy3 -netnum 2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start them: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl start vip -node prmy1 -netnum 2 [root@prmy1-+ASM1 ~]# srvctl start vip -node prmy2 -netnum 2 [root@prmy1-+ASM1 ~]# srvctl start vip -node prmy3 -netnum 2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Add SCAN LISTENERs: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl add scan_listener -netnum 2 -listener DG -endpoints TCP:12001</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Unlike those in the public network, these listen to port 12001. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Add the SCAN address to this network. </font><font style="vertical-align: inherit;">Its purpose is the same as the analogous SCAN in the public network:</font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl add scan -scanname prmy-dg-scan -netnum 2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start them: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl start scan_listener -netnum 2 [root@prmy1-+ASM1 ~]# srvctl start scan -netnum 2</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Everything we have just created should appear in GNS: </font></font><br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl config gns -list</span></span></code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Result of running srvctl config gns -list</font></font></b> <div class="spoiler_text"> Net-X-1.oraAsm SRV Target: 192.168.101.100.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-1.oraAsm SRV Target: 192.168.101.103 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-2.oraAsm SRV Target: 192.168.101.102 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-2.oraAsm SRV Target: 192.168.101.106.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-3.oraAsm SRV Target: 192.168.101.101 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-3.oraAsm SRV Target: 192.168.101.105.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-4.oraAsm SRV Target: 192.168.102.100.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-4.oraAsm SRV Target: 192.168.102.103 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-5.oraAsm SRV Target: 192.168.102.101 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-5.oraAsm SRV Target: 192.168.102.106.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-6.oraAsm SRV Target: 192.168.102.102 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-6.oraAsm SRV Target: 192.168.102.105.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Oracle-GNS A 192.168.100.51 Unique Flags: 0x115 <br> prmy-cluster-scan A 192.168.100.127 Unique Flags: 0x81 <br> prmy-cluster-scan A 192.168.100.128 Unique Flags: 0x81 <br> prmy-cluster-scan A 192.168.100.129 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan1-net2-vip A 192.168.103.103 Unique Flags: 0x1</font> <br> prmy-cluster-scan1-vip A 192.168.100.128 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan2-net2-vip A 192.168.103.104 Unique Flags: 0x1</font> <br> prmy-cluster-scan2-vip A 192.168.100.129 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan3-net2-vip A 192.168.103.105 Unique Flags: 0x1</font> <br> prmy-cluster-scan3-vip A 192.168.100.127 Unique Flags: 0x81 <br> prmy-cluster.Oracle-GNS SRV Target: Oracle-GNS Protocol: tcp Port: 42325 Weight: 0 Priority: 0 Flags: 0x115 <br> prmy-cluster.Oracle-GNS TXT CLUSTER_NAME=¬´prmy-cluster¬ª, CLUSTER_GUID=¬´f1d4ab3f48f1df86bf83ea440ea13327¬ª, NODE_NAME=¬´prmy3¬ª, SERVER_STATE=¬´RUNNING¬ª, VERSION=¬´12.1.0.2.0¬ª, DOMAIN=¬´clu-prmy.example.com¬ª Flags: 0x115 <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.103 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.104 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.105 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy1-2-vip A 192.168.103.100 Unique Flags: 0x1</font> <br> prmy1-vip A 192.168.100.139 Unique Flags: 0x81 <br> <font color="#ff0000">prmy2-2-vip A 192.168.103.101 Unique Flags: 0x1</font> <br> prmy2-vip A 192.168.100.140 Unique Flags: 0x81 <br> <font color="#ff0000">prmy3-2-vip A 192.168.103.102 Unique Flags: 0x1</font> <br> prmy3-vip A 192.168.100.141 Unique Flags: 0x81 <br> sby-cluster-scan.sby-cluster A 192.168.100.145 Unique Flags: 0x1 <br> sby-cluster-scan.sby-cluster A 192.168.100.149 Unique Flags: 0x1 <br> sby-cluster-scan.sby-cluster A 192.168.100.150 Unique Flags: 0x1 <br> sby-cluster-scan1-vip.sby-cluster A 192.168.100.150 Unique Flags: 0x1 <br> sby-cluster-scan2-vip.sby-cluster A 192.168.100.149 Unique Flags: 0x1 <br> sby-cluster-scan3-vip.sby-cluster A 192.168.100.145 Unique Flags: 0x1 <br> sby1-vip.sby-cluster A 192.168.100.148 Unique Flags: 0x1 <br> sby2-vip.sby-cluster A 192.168.100.151 Unique Flags: 0x1 <br> sby3-vip.sby-cluster A 192.168.100.138 Unique Flags: 0x1 <br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we will create a database listener on this network with the name LISTENER_DG and port 12001. </font></font><br><pre> <code class="bash hljs">[grid@prmy1-+ASM1 ~]$ netca</code> </pre><br><img src="https://habrastorage.org/files/6bb/2a3/921/6bb2a392196842079059281d2a1bdf16.png"><br><img src="https://habrastorage.org/files/dd4/60d/d6a/dd460dd6a7214baf8f54d1fe3a38fd2a.png"><br><img src="https://habrastorage.org/files/9db/487/1b7/9db4871b768f4be2bccf239e4e876202.png"><br><img src="https://habrastorage.org/files/380/dcc/9f2/380dcc9f2da24faca2fa9f0983825528.png"><br><img src="https://habrastorage.org/files/ce8/b50/49c/ce8b5049c46246fb8746f1257e4dd313.png"><br><img src="https://habrastorage.org/files/0b3/60e/b5d/0b360eb5d48e41aca8963b232cfd2ef0.png"><br><img src="https://habrastorage.org/files/ec2/1b0/bf8/ec21b0bf8337491da7f4adcb61f51769.png"><br><img src="https://habrastorage.org/files/11d/0e4/cac/11d0e4cac0ad41dd856b7f2cb0f2e2ef.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This listener is intended exclusively for Data Guard and requires additional configuration on each cluster node and it will also register a static service for Data Guard. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">I will configure in 2 steps, first through netmgr in order not to be mistaken in the syntax: </font></font><br><br> <b><u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">prmy1:</font></font></u></b> <br><pre> <code class="bash hljs">[grid@prmy1-+ASM1 ~]$ netmgr</code> </pre><br><img src="https://habrastorage.org/files/108/363/281/108363281df7451ebed570a5d983a442.png"><br><img src="https://habrastorage.org/files/fdc/de0/319/fdcde0319db44275821d5cd8ff814b9c.png"><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> And then with my hands, because netmgr does not understand the large values ‚Äã‚Äãof the parameters * _BUF_SIZE. </font></font><br><pre> <code class="bash hljs">[grid@prmy1-+ASM1 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = prmy_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = prmy1) ) )</code> </pre><br>  : <br><pre> <code class="bash hljs">[grid@prmy1-+ASM1 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br> <b><u>prmy2:</u></b> <br><pre> <code class="bash hljs">[grid@prmy2-+ASM2 ~]$ netmgr [grid@prmy2-+ASM2 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = prmy_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = prmy2) ) )</code> </pre><br><pre> <code class="bash hljs">[grid@prmy2-+ASM2 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br> <b><u>prmy3:</u></b> <br><pre> <code class="bash hljs">[grid@prmy3-+ASM3 ~]$ netmgr [grid@prmy3-+ASM3 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = prmy_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = prmy3) ) )</code> </pre><br><pre> <code class="bash hljs">[grid@prmy3-+ASM3 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br><br> <u>  sby   :</u> <br><pre> <code class="bash hljs">[root@sby1 ~]<span class="hljs-comment"><span class="hljs-comment"># . oraenv ORACLE_SID = [root] ? +ASM1 The Oracle base has been set to /u01/app/grid [root@sby1-+ASM1 ~]# oifcfg setif -global eth3/192.168.103.0:public [root@sby1-+ASM1 ~]# crsctl stop cluster -all [root@sby1-+ASM1 ~]# crsctl start cluster -all [root@sby1-+ASM1 ~]# srvctl add network -netnum 2 -subnet 192.168.103.0/255.255.255.0/eth3 -nettype dhcp -verbose Successfully added Network. [root@sby1-+ASM1 ~]# srvctl add vip -node sby1 -netnum 2 [root@sby1-+ASM1 ~]# srvctl add vip -node sby2 -netnum 2 [root@sby1-+ASM1 ~]# srvctl add vip -node sby3 -netnum 2 [root@sby1-+ASM1 ~]# srvctl start vip -node sby1 -netnum 2 [root@sby1-+ASM1 ~]# srvctl start vip -node sby2 -netnum 2 [root@sby1-+ASM1 ~]# srvctl start vip -node sby3 -netnum 2 [root@sby1-+ASM1 ~]# srvctl add scan_listener -netnum 2 -listener DG -endpoints TCP:12001 [root@sby1-+ASM1 ~]# srvctl add scan -scanname sby-dg-scan -netnum 2 [root@sby1-+ASM1 ~]# srvctl start scan_listener -netnum 2 [root@sby1-+ASM1 ~]# srvctl start scan -netnum 2</span></span></code> </pre><br><br>    (   prmy1): <br><pre> <code class="bash hljs">[root@prmy1-+ASM1 ~]<span class="hljs-comment"><span class="hljs-comment"># srvctl config gns -list</span></span></code> </pre><br><div class="spoiler"> <b class="spoiler_title">   srvctl config gns -list</b> <div class="spoiler_text"> Net-X-1.oraAsm SRV Target: 192.168.101.100.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-1.oraAsm SRV Target: 192.168.101.103 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-2.oraAsm SRV Target: 192.168.101.102 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-2.oraAsm SRV Target: 192.168.101.106.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-3.oraAsm SRV Target: 192.168.101.101 Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-3.oraAsm SRV Target: 192.168.101.105.sby-cluster Protocol: tcp Port: 1522 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-4.oraAsm SRV Target: 192.168.102.100.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-4.oraAsm SRV Target: 192.168.102.103 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-5.oraAsm SRV Target: 192.168.102.101 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-5.oraAsm SRV Target: 192.168.102.106.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-6.oraAsm SRV Target: 192.168.102.102 Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Net-X-6.oraAsm SRV Target: 192.168.102.105.sby-cluster Protocol: tcp Port: 1523 Weight: 0 Priority: 0 Flags: 0x101 <br> Oracle-GNS A 192.168.100.51 Unique Flags: 0x115 <br> prmy-cluster-scan A 192.168.100.127 Unique Flags: 0x81 <br> prmy-cluster-scan A 192.168.100.128 Unique Flags: 0x81 <br> prmy-cluster-scan A 192.168.100.129 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan1-net2-vip A 192.168.103.103 Unique Flags: 0x1</font> <br> prmy-cluster-scan1-vip A 192.168.100.128 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan2-net2-vip A 192.168.103.104 Unique Flags: 0x1</font> <br> prmy-cluster-scan2-vip A 192.168.100.129 Unique Flags: 0x81 <br> <font color="#ff0000">prmy-cluster-scan3-net2-vip A 192.168.103.105 Unique Flags: 0x1</font> <br> prmy-cluster-scan3-vip A 192.168.100.127 Unique Flags: 0x81 <br> prmy-cluster.Oracle-GNS SRV Target: Oracle-GNS Protocol: tcp Port: 42325 Weight: 0 Priority: 0 Flags: 0x115 <br> prmy-cluster.Oracle-GNS TXT CLUSTER_NAME=¬´prmy-cluster¬ª, CLUSTER_GUID=¬´f1d4ab3f48f1df86bf83ea440ea13327¬ª, NODE_NAME=¬´prmy3¬ª, SERVER_STATE=¬´RUNNING¬ª, VERSION=¬´12.1.0.2.0¬ª, DOMAIN=¬´clu-prmy.example.com¬ª Flags: 0x115 <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.103 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.104 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy-dg-scan A 192.168.103.105 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy1-2-vip A 192.168.103.100 Unique Flags: 0x1</font> <br> prmy1-vip A 192.168.100.139 Unique Flags: 0x81 <br> <font color="#ff0000">prmy2-2-vip A 192.168.103.101 Unique Flags: 0x1</font> <br> prmy2-vip A 192.168.100.140 Unique Flags: 0x81 <br> <font color="#ff0000">prmy3-2-vip A 192.168.103.102 Unique Flags: 0x1</font> <br> <font color="#ff0000">prmy3-vip A 192.168.100.141 Unique Flags: 0x81</font> <br> sby-cluster-scan.sby-cluster A 192.168.100.145 Unique Flags: 0x1 <br> sby-cluster-scan.sby-cluster A 192.168.100.149 Unique Flags: 0x1 <br> sby-cluster-scan.sby-cluster A 192.168.100.150 Unique Flags: 0x1 <br> <font color="#0000ff">sby-cluster-scan1-net2-vip.sby-cluster A 192.168.103.106 Unique Flags: 0x1</font> <br> sby-cluster-scan1-vip.sby-cluster A 192.168.100.150 Unique Flags: 0x1 <br> <font color="#0000ff">sby-cluster-scan2-net2-vip.sby-cluster A 192.168.103.107 Unique Flags: 0x1</font> <br> sby-cluster-scan2-vip.sby-cluster A 192.168.100.149 Unique Flags: 0x1 <br> <font color="#0000ff">sby-cluster-scan3-net2-vip.sby-cluster A 192.168.103.108 Unique Flags: 0x1</font> <br> sby-cluster-scan3-vip.sby-cluster A 192.168.100.145 Unique Flags: 0x1 <br> <font color="#0000ff">sby-dg-scan.sby-cluster A 192.168.103.106 Unique Flags: 0x1</font> <br> <font color="#0000ff">sby-dg-scan.sby-cluster A 192.168.103.107 Unique Flags: 0x1</font> <br> <font color="#0000ff">sby-dg-scan.sby-cluster A 192.168.103.108 Unique Flags: 0x1</font> <br> <font color="#0000ff">sby1-2-vip.sby-cluster A 192.168.103.109 Unique Flags: 0x1</font> <br> sby1-vip.sby-cluster A 192.168.100.148 Unique Flags: 0x1 <br> <font color="#0000ff">sby2-2-vip.sby-cluster A 192.168.103.110 Unique Flags: 0x1</font> <br> sby2-vip.sby-cluster A 192.168.100.151 Unique Flags: 0x1 <br> <font color="#0000ff">sby3-2-vip.sby-cluster A 192.168.103.111 Unique Flags: 0x1</font> <br> sby3-vip.sby-cluster A 192.168.100.138 Unique Flags: 0x1 <br><br>     GNS      sby. <br></div></div><br>    . <br><pre> <code class="bash hljs">[grid@sby1-+ASM1 ~]$ netca</code> </pre><br> <b><u>sby1:</u></b> <br><pre> <code class="bash hljs">[grid@sby1-+ASM1 ~]$ netmgr</code> </pre><br><br><img src="https://habrastorage.org/files/108/363/281/108363281df7451ebed570a5d983a442.png"><br><img src="https://habrastorage.org/files/91c/04f/d1c/91c04fd1c9604a17b052294befd0bf28.png"><br><br>     prmy         ‚Äî sby.example.com.       .   Data Guard Broker     . <br><br><img src="https://habrastorage.org/files/79e/e62/5bd/79ee625bd7a5442eb6836bad63185861.png"><br><br><pre> <code class="bash hljs">[grid@sby1-+ASM1 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = sby_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = sby1) ) (SID_DESC = (GLOBAL_DBNAME = sby.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = sby) ) ) [grid@sby1-+ASM1 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br> <b><u>sby2:</u></b> <br><pre> <code class="bash hljs">[grid@sby2-+ASM2 ~]$ netmgr [grid@sby2-+ASM2 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = sby_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = sby2) ) ) [grid@sby2-+ASM2 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br> <b><u>sby3:</u></b> <br><pre> <code class="bash hljs">[grid@sby3-+ASM3 ~]$ netmgr [grid@sby3-+ASM3 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora LISTENER_DG = (DESCRIPTION = (ADDRESS = (PROTOCOL = IPC)(KEY = LISTENER_DG)(SEND_BUF_SIZE = 10485760)(RECV_BUF_SIZE = 10485760)) ) SID_LIST_LISTENER_DG = (SID_LIST = (SID_DESC = (GLOBAL_DBNAME = sbyfs_dgmgrl.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = sbyfs1) ) ) [grid@sby3-+ASM3 ~]$ lsnrctl reload listener_dg Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=LISTENER_DG)(SEND_BUF_SIZE=10485760)(RECV_BUF_SIZE=10485760))) The <span class="hljs-built_in"><span class="hljs-built_in">command</span></span> completed successfully</code> </pre><br>    tnsnames.ora. <br><pre> <code class="bash hljs">[oracle@prmy1- ~]$ . oraenv ORACLE_SID = [oracle] ? prmy The Oracle base has been <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to /u01/app/oracle [oracle@prmy1-prmy ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/tnsnames.ora</code> </pre><br><div class="spoiler"> <b class="spoiler_title">  /u01/app/oracle/acfsmounts/acfs_db1/network/admin/tnsnames.ora</b> <div class="spoiler_text"><pre> <code class="bash hljs">PRODSERV1 = (DESCRIPTION = (FAILOVER=on) (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-cluster-scan.clu-prmy.example.com)(PORT = 1521)) (ADDRESS = (PROTOCOL = TCP)(HOST = sby-cluster-scan.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = prodserv.example.com) ) ) PRMY = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-cluster-scan.clu-prmy.example.com)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = prmy.example.com) ) ) SBY = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = sby-cluster-scan.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = sby.example.com) ) ) PRMYFS = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-cluster-scan.clu-prmy.example.com)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = prmyfs.example.com) ) ) SBYFS = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = sby-cluster-scan.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = sbyfs.example.com) ) ) PRMY_DG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-dg-scan.clu-prmy.example.com)(PORT = 12001)) ) (SDU = 65535) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = prmy.example.com) ) ) PRMYFS_DG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-dg-scan.clu-prmy.example.com)(PORT = 12001)) ) (SDU = 65535) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = prmyfs.example.com) ) ) SBY_DG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = sby-dg-scan.sby-cluster.clu-prmy.example.com)(PORT = 12001)) ) (SDU = 65535) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = sby.example.com) ) ) SBYFS_DG = (DESCRIPTION = (ADDRESS_LIST = (ADDRESS = (PROTOCOL = TCP)(HOST = sby-dg-scan.sby-cluster.clu-prmy.example.com)(PORT = 12001)) ) (SDU = 65535) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = sbyfs.example.com) ) ) PRMY1_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy1-vip.clu-prmy.example.com)(PORT = 1521)) ) PRMY1_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy1-2-vip.clu-prmy.example.com)(PORT = 12001)) ) PRMY2_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy2-vip.clu-prmy.example.com)(PORT = 1521)) ) PRMY2_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy2-2-vip.clu-prmy.example.com)(PORT = 12001)) ) PRMY3_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy3-vip.clu-prmy.example.com)(PORT = 1521)) ) PRMY3_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy3-2-vip.clu-prmy.example.com)(PORT = 12001)) ) SBY1_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby1-vip.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) SBY1_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby1-2-vip.sby-cluster.clu-prmy.example.com)(PORT = 12001)) (SDU = 65535) (CONNECT_DATA = (SERVER = DEDICATED) (SERVICE_NAME = sby.example.com) ) ) SBY2_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby2-vip.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) SBY2_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby2-2-vip.sby-cluster.clu-prmy.example.com)(PORT = 12001)) ) SBY3_LOCAL_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby3-vip.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) SBY3_LOCAL_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = sby3-2-vip.sby-cluster.clu-prmy.example.com)(PORT = 12001)) ) REMOTE_NET1 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-cluster-scan.clu-prmy.example.com)(PORT = 1521)) (ADDRESS = (PROTOCOL = TCP)(HOST = sby-cluster-scan.sby-cluster.clu-prmy.example.com)(PORT = 1521)) ) REMOTE_NET2 = (DESCRIPTION = (ADDRESS = (PROTOCOL = TCP)(HOST = prmy-dg-scan.clu-prmy.example.com)(PORT = 12001)) (ADDRESS = (PROTOCOL = TCP)(HOST = sby-dg-scan.sby-cluster.clu-prmy.example.com)(PORT = 12001)) )</code> </pre><br></div></div><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ scp <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/tnsnames.ora sby1:<span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin</code> </pre><br><h4>       </h4><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ srvctl status database -d prmy Instance prmy1 is running on node prmy1 Instance prmy2 is running on node prmy2 [oracle@prmy1-prmy ~]$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ORACLE_SID=prmy1 [oracle@prmy1-prmy1 ~]$ srvctl stop database -d prmy</code> </pre><br>     Flashback Database. <br><pre> <code class="bash hljs">[oracle@prmy1-prmy1 ~]$ sqlplus / as sysdba Connected to an idle instance. SQL&gt; startup mount ORACLE instance started. Total System Global Area 1048576000 bytes Fixed Size 2932336 bytes Variable Size 717226384 bytes Database Buffers 322961408 bytes Redo Buffers 5455872 bytes Database mounted. SQL&gt; alter database archivelog; Database altered. SQL&gt; alter database flashback on; Database altered. SQL&gt; shutdown immediate ORA-01109: database not open Database dismounted. ORACLE instance shut down. SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> [oracle@prmy1-prmy1 ~]$ srvctl start database -d prmy [oracle@prmy1-prmy1 ~]$ sqlplus / as sysdba SQL&gt; alter database force logging; SQL&gt; select GROUP<span class="hljs-comment"><span class="hljs-comment">#,BYTES,MEMBERS,THREAD# from v$log; GROUP# BYTES MEMBERS THREAD# ---------- ---------- ---------- ---------- 1 52428800 2 1 2 52428800 2 1 3 52428800 2 2 4 52428800 2 2 SQL&gt; alter database add standby logfile thread 1 ('+DATA', '+FRA' ) size 52428800; SQL&gt; alter database add standby logfile thread 1 ('+DATA', '+FRA' ) size 52428800; SQL&gt; alter database add standby logfile thread 2 ('+DATA', '+FRA' ) size 52428800; SQL&gt; alter database add standby logfile thread 2 ('+DATA', '+FRA' ) size 52428800; SQL&gt; alter system set log_archive_dest_1='location=USE_DB_RECOVERY_FILE_DEST valid_for=(ALL_LOGFILES,ALL_ROLES) db_unique_name=prmy' scope=both sid ='*'; SQL&gt; alter system set log_archive_dest_state_1='enable' scope=both sid ='*'; SQL&gt; alter system set fal_server='sby' scope=both sid='*'; SQL&gt; alter system set log_archive_max_processes=4 scope=both sid ='*'; SQL&gt; alter system set log_archive_config='dg_config=(prmy,prmyfs,sby,sbyfs)' scope=both sid ='*'; SQL&gt; alter system set standby_file_management='auto' scope=both sid ='*'; SQL&gt; alter pluggable database all open instances=all; SQL&gt; alter pluggable database all save state instances=all;</span></span></code> </pre><br><h4>     </h4><br><pre> <code class="bash hljs">[oracle@sby1- ~]$ mkdir -p /u01/app/oracle/admin/sby/adump [oracle@sby1- ~]$ ssh sby2 mkdir -p /u01/app/oracle/admin/sby/adump [oracle@sby1- ~]$ ssh sby3 mkdir -p /u01/app/oracle/admin/sbyfs/adump [oracle@sby1- ~]$ . oraenv ORACLE_SID = [oracle] ? sby ORACLE_HOME = [/home/oracle] ? /u01/app/oracle/acfsmounts/acfs_db1 The Oracle base has been <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to /u01/app/oracle</code> </pre><br>    . <br><pre> <code class="bash hljs">[oracle@sby1-sby ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'DB_NAME=sby'</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/dbs/initsby.ora [oracle@sby1-sby ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'DB_DOMAIN=example.com'</span></span> &gt;&gt; <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/dbs/initsby.ora</code> </pre><br>    ,      DUPLICATE. <br><pre> <code class="bash hljs">[oracle@sby1-sby ~]$ orapwd file=<span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/dbs/orapwsby password=oracle_4U</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start a copy: </font></font><br><pre> <code class="bash hljs">[oracle@sby1-sby ~]$ sqlplus / as sysdba SQL&gt; startup nomount pfile=<span class="hljs-string"><span class="hljs-string">'$ORACLE_HOME/dbs/initsby.ora'</span></span> ORACLE instance started. Total System Global Area 243269632 bytes Fixed Size 2923000 bytes Variable Size 184550920 bytes Database Buffers 50331648 bytes Redo Buffers 5464064 bytes SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Database cloning </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Preparing a script for RMAN. </font><font style="vertical-align: inherit;">Do not forget that our database is clustered.</font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ vi cr_phys_sby.txt run { allocate channel prmy1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> disk; allocate auxiliary channel sby1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> disk; duplicate target database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> standby from active database spfile parameter_value_convert <span class="hljs-string"><span class="hljs-string">'prmy'</span></span>,<span class="hljs-string"><span class="hljs-string">'sby'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> db_unique_name=<span class="hljs-string"><span class="hljs-string">'sby'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> control_files=<span class="hljs-string"><span class="hljs-string">'+DATA'</span></span>,<span class="hljs-string"><span class="hljs-string">'+FRA'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_config=<span class="hljs-string"><span class="hljs-string">'dg_config=(prmy,prmyfs,sby,sbyfs)'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> fal_server=<span class="hljs-string"><span class="hljs-string">'prmy'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_dest_1=<span class="hljs-string"><span class="hljs-string">'location=USE_DB_RECOVERY_FILE_DEST valid_for=(ALL_LOGFILES,ALL_ROLES) db_unique_name=sby'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> instance_number=<span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> thread=<span class="hljs-string"><span class="hljs-string">'1'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> undo_tablespace=<span class="hljs-string"><span class="hljs-string">'UNDOTBS1'</span></span>; }</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Start the script: </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ rman target sys/oracle_4U@prmy auxiliary sys/oracle_4U@sby1_local_net2 RMAN&gt; @cr_phys_sby.txt</code> </pre><br><div class="spoiler"> <b class="spoiler_title"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Script result</font></font></b> <div class="spoiler_text"><pre> <code class="bash hljs">RMAN&gt; run { 2&gt; allocate channel prmy1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> disk; 3&gt; allocate auxiliary channel sby1 <span class="hljs-built_in"><span class="hljs-built_in">type</span></span> disk; 4&gt; 5&gt; duplicate target database <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> standby from active database 6&gt; spfile 7&gt; parameter_value_convert <span class="hljs-string"><span class="hljs-string">'prmy'</span></span>,<span class="hljs-string"><span class="hljs-string">'sby'</span></span> 8&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> db_unique_name=<span class="hljs-string"><span class="hljs-string">'sby'</span></span> 9&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> control_files=<span class="hljs-string"><span class="hljs-string">'+DATA'</span></span>,<span class="hljs-string"><span class="hljs-string">'+FRA'</span></span> 10&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_config=<span class="hljs-string"><span class="hljs-string">'dg_config=(prmy,prmyfs,sby,sbyfs)'</span></span> 11&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> fal_server=<span class="hljs-string"><span class="hljs-string">'prmy'</span></span> 12&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_dest_1=<span class="hljs-string"><span class="hljs-string">'location=USE_DB_RECOVERY_FILE_DEST valid_for=(ALL_LOGFILES,ALL_ROLES) db_unique_name=sby'</span></span> 13&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> instance_number=<span class="hljs-string"><span class="hljs-string">'1'</span></span> 14&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> thread=<span class="hljs-string"><span class="hljs-string">'1'</span></span> 15&gt; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> undo_tablespace=<span class="hljs-string"><span class="hljs-string">'UNDOTBS1'</span></span>; 16&gt; } using target database control file instead of recovery catalog allocated channel: prmy1 channel prmy1: SID=91 instance=prmy1 device <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DISK allocated channel: sby1 channel sby1: SID=28 device <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DISK Starting Duplicate Db contents of Memory Script: { backup as copy reuse targetfile <span class="hljs-string"><span class="hljs-string">'+DATA/PRMY/PASSWORD/pwdprmy.277.886095621'</span></span> auxiliary format <span class="hljs-string"><span class="hljs-string">'/u01/app/oracle/acfsmounts/acfs_db1/dbs/orapwsby'</span></span> ; restore <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> from service <span class="hljs-string"><span class="hljs-string">'prmy'</span></span> spfile to <span class="hljs-string"><span class="hljs-string">'/u01/app/oracle/acfsmounts/acfs_db1/dbs/spfilesby.ora'</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set spfile= ''/u01/app/oracle/acfsmounts/acfs_db1/dbs/spfilesby.ora''"</span></span>; } executing Memory Script Starting backup Finished backup Starting restore channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: restoring SPFILE output file name=/u01/app/oracle/acfsmounts/acfs_db1/dbs/spfilesby.ora channel sby1: restore complete, elapsed time: 00:00:05 Finished restore sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> spfile= <span class="hljs-string"><span class="hljs-string">''</span></span>/u01/app/oracle/acfsmounts/acfs_db1/dbs/spfilesby.ora<span class="hljs-string"><span class="hljs-string">''</span></span> contents of Memory Script: { sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set audit_file_dest = ''/u01/app/oracle/admin/sby/adump'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set dispatchers = ''(PROTOCOL=TCP) (SERVICE=sbyXDB)'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set db_unique_name = ''sby'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set control_files = ''+DATA'', ''+FRA'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set log_archive_config = ''dg_config=(prmy,prmyfs,sby,sbyfs)'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set fal_server = ''prmy'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set log_archive_dest_1 = ''location=USE_DB_RECOVERY_FILE_DEST valid_for=(ALL_LOGFILES,ALL_ROLES) db_unique_name=sby'' comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set instance_number = 1 comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set thread = 1 comment= '''' scope=spfile"</span></span>; sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set undo_tablespace = ''UNDOTBS1'' comment= '''' scope=spfile"</span></span>; shutdown <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> immediate; startup <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> nomount; } executing Memory Script sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> audit_file_dest = <span class="hljs-string"><span class="hljs-string">''</span></span>/u01/app/oracle/admin/sby/adump<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dispatchers = <span class="hljs-string"><span class="hljs-string">''</span></span>(PROTOCOL=TCP) (SERVICE=sbyXDB)<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> db_unique_name = <span class="hljs-string"><span class="hljs-string">''</span></span>sby<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> control_files = <span class="hljs-string"><span class="hljs-string">''</span></span>+DATA<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>+FRA<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_config = <span class="hljs-string"><span class="hljs-string">''</span></span>dg_config=(prmy,prmyfs,sby,sbyfs)<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> fal_server = <span class="hljs-string"><span class="hljs-string">''</span></span>prmy<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> log_archive_dest_1 = <span class="hljs-string"><span class="hljs-string">''</span></span>location=USE_DB_RECOVERY_FILE_DEST valid_for=(ALL_LOGFILES,ALL_ROLES) db_unique_name=sby<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> instance_number = 1 comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> thread = 1 comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> undo_tablespace = <span class="hljs-string"><span class="hljs-string">''</span></span>UNDOTBS1<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span><span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile Oracle instance shut down connected to auxiliary database (not started) Oracle instance started Total System Global Area 1048576000 bytes Fixed Size 2932336 bytes Variable Size 750780816 bytes Database Buffers 222298112 bytes Redo Buffers 72564736 bytes allocated channel: sby1 channel sby1: SID=40 instance=sby device <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DISK contents of Memory Script: { sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">"alter system set control_files = ''+DATA/SBY/CONTROLFILE/current.276.886160849'', ''+FRA/SBY/CONTROLFILE/current.256.886160853'' comment= ''Set by RMAN'' scope=spfile"</span></span>; restore <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> from service <span class="hljs-string"><span class="hljs-string">'prmy'</span></span> standby controlfile; } executing Memory Script sql statement: alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> control_files = <span class="hljs-string"><span class="hljs-string">''</span></span>+DATA/SBY/CONTROLFILE/current.276.886160849<span class="hljs-string"><span class="hljs-string">''</span></span>, <span class="hljs-string"><span class="hljs-string">''</span></span>+FRA/SBY/CONTROLFILE/current.256.886160853<span class="hljs-string"><span class="hljs-string">''</span></span> comment= <span class="hljs-string"><span class="hljs-string">''</span></span>Set by RMAN<span class="hljs-string"><span class="hljs-string">''</span></span> scope=spfile Starting restore channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: restoring control file channel sby1: restore complete, elapsed time: 00:00:12 output file name=+DATA/SBY/CONTROLFILE/current.278.886160863 output file name=+FRA/SBY/CONTROLFILE/current.258.886160865 Finished restore contents of Memory Script: { sql <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> <span class="hljs-string"><span class="hljs-string">'alter database mount standby database'</span></span>; } executing Memory Script sql statement: alter database mount standby database contents of Memory Script: { <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> tempfile 1 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> tempfile 2 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> tempfile 3 to new; switch <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> tempfile all; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 1 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 3 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 4 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 5 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 6 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 7 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 8 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 9 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 10 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 11 to new; <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> newname <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile 12 to new; restore from service <span class="hljs-string"><span class="hljs-string">'prmy'</span></span> <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> database ; sql <span class="hljs-string"><span class="hljs-string">'alter system archive log current'</span></span>; } executing Memory Script executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME renamed tempfile 1 to +DATA <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> control file renamed tempfile 2 to +DATA <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> control file renamed tempfile 3 to +DATA <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> control file executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME executing <span class="hljs-built_in"><span class="hljs-built_in">command</span></span>: SET NEWNAME Starting restore channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00001 to +DATA channel sby1: restore complete, elapsed time: 00:00:56 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00003 to +DATA channel sby1: restore complete, elapsed time: 00:00:57 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00004 to +DATA channel sby1: restore complete, elapsed time: 00:00:27 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00005 to +DATA channel sby1: restore complete, elapsed time: 00:00:15 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00006 to +DATA channel sby1: restore complete, elapsed time: 00:00:10 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00007 to +DATA channel sby1: restore complete, elapsed time: 00:00:47 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00008 to +DATA channel sby1: restore complete, elapsed time: 00:00:04 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00009 to +DATA channel sby1: restore complete, elapsed time: 00:00:27 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00010 to +DATA channel sby1: restore complete, elapsed time: 00:00:46 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00011 to +DATA channel sby1: restore complete, elapsed time: 00:00:01 channel sby1: starting datafile backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> restore channel sby1: using network backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> from service prmy channel sby1: specifying datafile(s) to restore from backup <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> channel sby1: restoring datafile 00012 to +DATA channel sby1: restore complete, elapsed time: 00:01:16 Finished restore sql statement: alter system archive <span class="hljs-built_in"><span class="hljs-built_in">log</span></span> current contents of Memory Script: { switch <span class="hljs-built_in"><span class="hljs-built_in">clone</span></span> datafile all; } executing Memory Script datafile 1 switched to datafile copy input datafile copy RECID=18 STAMP=886161275 file name=+DATA/SBY/DATAFILE/system.279.886160903 datafile 3 switched to datafile copy input datafile copy RECID=19 STAMP=886161275 file name=+DATA/SBY/DATAFILE/sysaux.280.886160957 datafile 4 switched to datafile copy input datafile copy RECID=20 STAMP=886161276 file name=+DATA/SBY/DATAFILE/undotbs1.281.886161013 datafile 5 switched to datafile copy input datafile copy RECID=21 STAMP=886161276 file name=+DATA/SBY/1BC6D0646EC94B23E0530B64A8C0D5EA/DATAFILE/system.282.886161039 datafile 6 switched to datafile copy input datafile copy RECID=22 STAMP=886161276 file name=+DATA/SBY/DATAFILE/users.283.886161061 datafile 7 switched to datafile copy input datafile copy RECID=23 STAMP=886161277 file name=+DATA/SBY/1BC6D0646EC94B23E0530B64A8C0D5EA/DATAFILE/sysaux.284.886161065 datafile 8 switched to datafile copy input datafile copy RECID=24 STAMP=886161277 file name=+DATA/SBY/DATAFILE/undotbs2.285.886161113 datafile 9 switched to datafile copy input datafile copy RECID=25 STAMP=886161277 file name=+DATA/SBY/1BC752209CF679EBE0530B64A8C0EE64/DATAFILE/system.286.886161117 datafile 10 switched to datafile copy input datafile copy RECID=26 STAMP=886161277 file name=+DATA/SBY/1BC752209CF679EBE0530B64A8C0EE64/DATAFILE/sysaux.287.886161143 datafile 11 switched to datafile copy input datafile copy RECID=27 STAMP=886161277 file name=+DATA/SBY/1BC752209CF679EBE0530B64A8C0EE64/DATAFILE/users.288.886161189 datafile 12 switched to datafile copy input datafile copy RECID=28 STAMP=886161277 file name=+DATA/SBY/1BC752209CF679EBE0530B64A8C0EE64/DATAFILE/example.289.886161191 Finished Duplicate Db released channel: prmy1 released channel: sby1 RMAN&gt; **end-of-file**</code> </pre><br></div></div><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Although RMAN captured the parameter file and even allowed some of them to be changed, the syntax of the DUPLICATE command does not allow setting the parameters as needed for the cluster database. </font><font style="vertical-align: inherit;">It is necessary to install manually.</font></font><br><pre> <code class="bash hljs">[oracle@sby1-sby dbs]$ sqlplus / as sysdba SQL&gt; alter system reset instance_number scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> instance_number=1 scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby1'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> instance_number=2 scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby2'</span></span>; SQL&gt; alter system reset thread scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> thread=1 scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby1'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> thread=2 scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby2'</span></span>; SQL&gt; alter system reset undo_tablespace scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> undo_tablespace=<span class="hljs-string"><span class="hljs-string">'UNDOTBS1'</span></span> scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby1'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> undo_tablespace=<span class="hljs-string"><span class="hljs-string">'UNDOTBS2'</span></span> scope=spfile sid=<span class="hljs-string"><span class="hljs-string">'sby2'</span></span>; SQL&gt; create pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initsby.ora'</span></span> from spfile; SQL&gt; create spfile=<span class="hljs-string"><span class="hljs-string">'+DATA/sby/spfilesby.ora'</span></span> from pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initsby.ora'</span></span>; SQL&gt; host <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"SPFILE='+DATA/sby/spfilesby.ora'"</span></span> &gt; <span class="hljs-variable"><span class="hljs-variable">${ORACLE_HOME}</span></span>/dbs/initsby.ora SQL&gt; shutdown immediate SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We place the parameter file and password file, add information about the database and its samples to the cluster OCR. </font></font><br><pre> <code class="bash hljs">[oracle@sby1-sby ~]$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/dbs [oracle@sby1-sby dbs]$ ln -s initsby.ora initsby1.ora [oracle@sby1-sby dbs]$ ln -s initsby.ora initsby2.ora [oracle@sby1-sby dbs]$ rm spfilesby.ora [oracle@sby1-sby dbs]$ orapwd input_file=<span class="hljs-string"><span class="hljs-string">'orapwsby'</span></span> file=<span class="hljs-string"><span class="hljs-string">'+DATA/SBY/orapwdb'</span></span> dbuniquename=<span class="hljs-string"><span class="hljs-string">'sby'</span></span> [oracle@sby1-sby dbs]$ rm orapwsby [oracle@sby1-sby dbs]$ srvctl add database -db sby -oraclehome <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> -dbtype RAC -domain example.com -spfile +DATA/sby/spfilesby.ora -role PHYSICAL_STANDBY -startoption MOUNT -pwfile +DATA/SBY/orapwdb -dbname prmy -diskgroup <span class="hljs-string"><span class="hljs-string">"DATA,FRA"</span></span> -policy AUTOMATIC -acfspath <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> [oracle@sby1-sby dbs]$ srvctl add instance -db sby -node sby1 -instance sby1 [oracle@sby1-sby dbs]$ srvctl add instance -db sby -node sby2 -instance sby2 [oracle@sby1-sby dbs]$ srvctl start database -d sby [oracle@sby1-sby dbs]$ srvctl status database -d sby -verbose Instance sby1 is running on node sby1. Instance status: Mounted (Closed). Instance sby2 is running on node sby2. Instance status: Mounted (Closed).</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Create Far Sync </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">With Far Sync, database instances are much simpler and faster. </font><font style="vertical-align: inherit;">To create them, we need a parameter file, a password file and a special control file from the main database. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Extract the parameter file and create a control file for far sync.</font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ORACLE_SID=prmy1 [oracle@prmy1-prmy1 ~]$ sqlplus / as sysdba SQL&gt; create pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initprmyfs.ora'</span></span> from spfile; SQL&gt; alter database create far sync instance controlfile as <span class="hljs-string"><span class="hljs-string">'/tmp/prmyfs.ctl'</span></span>; SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We find where we have the password file in ASM, extract it and copy all the files. </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy1 ~]$ srvctl config database -d prmy | grep -i password Password file: +DATA/PRMY/PASSWORD/pwdprmy.276.885980759 [oracle@prmy1-prmy1 ~]$ asmcmd --privilege sysdba pwcopy +DATA/PRMY/PASSWORD/pwdprmy.276.885980759 /tmp/orapwprmyfs copying +DATA/PRMY/PASSWORD/pwdprmy.276.885980759 -&gt; /tmp/orapwprmyfs [oracle@prmy1-prmy1 ~]$ scp /tmp/{initprmyfs.ora,orapwprmyfs,prmyfs.ctl} prmy3:/tmp [oracle@prmy1-prmy1 ~]$ scp /tmp/initprmyfs.ora sby3:/tmp/initsbyfs.ora [oracle@prmy1-prmy1 ~]$ scp /tmp/orapwprmyfs sby3:/tmp/orapwsbyfs [oracle@prmy1-prmy1 ~]$ scp /tmp/prmyfs.ctl sby3:/tmp/sbyfs.ctl</code> </pre><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create Far Sync prmyfs:</font></font></u> <br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Edit the parameters file:</font></font><br><pre> <code class="bash hljs">[oracle@prmy3- ~]$ mkdir -p /u01/app/oracle/admin/prmyfs/adump [oracle@prmy3- ~]$ sed -i <span class="hljs-string"><span class="hljs-string">'s/prmy/prmyfs/gi'</span></span> /tmp/initprmyfs.ora [oracle@prmy3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">'s/(db_name=.*)(prmyfs)/\1prmy/gi'</span></span> /tmp/initprmyfs.ora [oracle@prmy3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">"s/(dg_config=)(.*$)/\1(prmy,prmyfs,sby,sbyfs)\'/gi"</span></span> /tmp/initprmyfs.ora [oracle@prmy3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">'s/(fal_server.*)(sby)/\1prmy/gi'</span></span> /tmp/initprmyfs.ora [oracle@prmy3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">"s/(control_files=)(.*$)/\1\'+DATA\',\'+FRA\'/gi"</span></span> /tmp/initprmyfs.ora [oracle@prmy3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'*.db_unique_name=prmyfs'</span></span> &gt;&gt; /tmp/initprmyfs.ora [oracle@prmy3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*.log_file_name_convert='prmy','prmyfs'"</span></span> &gt;&gt; /tmp/initprmyfs.ora [oracle@prmy3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /u01/app/oracle/acfsmounts/acfs_db1/dbs [oracle@prmy3- dbs]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"SPFILE='+DATA/prmyfs/spfileprmyfs.ora'"</span></span> &gt; initprmyfs.ora [oracle@prmy3- dbs]$ ln -s initprmyfs.ora initprmyfs1.ora</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Place the parameter file on ASM: </font></font><br><pre> <code class="bash hljs">[oracle@prmy3- ~]$ . oraenv ORACLE_SID = [oracle] ? prmyfs1 ORACLE_HOME = [/home/oracle] ? /u01/app/oracle/acfsmounts/acfs_db1 The Oracle base has been <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to /u01/app/oracle [oracle@prmy3-prmyfs1 ~]$ sqlplus / as sysdba SQL&gt; startup nomount pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initprmyfs.ora'</span></span> SQL&gt; create spfile=<span class="hljs-string"><span class="hljs-string">'+DATA/prmyfs/spfileprmyfs.ora'</span></span> from pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initprmyfs.ora'</span></span>; SQL&gt; shutdown immediate SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">We place control files on ASM. </font><font style="vertical-align: inherit;">And since we do this with RMAN, it will change the value in the parameter file to their actual location in ASM.</font></font><br><pre> <code class="bash hljs">[oracle@prmy3-prmyfs1 ~]$ rman target / RMAN&gt; startup nomount RMAN&gt; restore controlfile from <span class="hljs-string"><span class="hljs-string">'/tmp/prmyfs.ctl'</span></span>; Starting restore using target database control file instead of recovery catalog allocated channel: ORA_DISK_1 channel ORA_DISK_1: SID=36 device <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DISK channel ORA_DISK_1: copied control file copy output file name=+DATA/PRMYFS/CONTROLFILE/current.303.886006117 output file name=+FRA/PRMYFS/CONTROLFILE/current.281.886006121 Finished restore RMAN&gt; shutdown immediate; Statement processed released channel: ORA_DISK_1 RMAN&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span></code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Register the database in Oracle Clusterware: </font></font><br><pre> <code class="bash hljs">[oracle@prmy3-prmyfs1 ~]$ srvctl add database -db prmyfs -oraclehome <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> -dbtype RAC -domain example.com -spfile +DATA/prmyfs/spfileprmyfs.ora -role FAR_SYNC -startoption MOUNT -dbname prmy -policy AUTOMATIC -diskgroup <span class="hljs-string"><span class="hljs-string">"DATA,FRA"</span></span> -acfspath <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> [oracle@prmy3-prmyfs1 ~]$ srvctl add instance -db prmyfs -node prmy3 -instance prmyfs1 [oracle@prmy3-prmyfs1 ~]$ srvctl start database -d prmyfs [oracle@prmy3-prmyfs1 dbs]$ asmcmd --privilege sysdba pwcopy --dbuniquename prmyfs /tmp/orapwprmyfs +DATA/prmyfs/orapwdb</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> The attempt to transform RAC Far Sync into RAC One Node was unsuccessful: </font></font><br><pre> <code class="bash hljs">[oracle@prmy3-prmyfs1 ~]$ srvctl convert database -db prmyfs -dbtype RACONENODE -instance prmyfs1 PRCD-1242 : Unable to convert RAC database prmyfs to RAC One Node database because the database had no service added [oracle@prmy3-prmyfs1 ~]$ srvctl add service -db prmyfs -service prmyfarsync -preferred prmyfs1 PRCD-1306 : Services cannot be created <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> the far sync database prmyfs.</code> </pre><br> <u><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create Far Sync sbyfs:</font></font></u> <br><pre> <code class="bash hljs">[oracle@sby3- ~]$ mkdir -p /u01/app/oracle/admin/sbyfs/adump [oracle@sby3- ~]$ sed -i <span class="hljs-string"><span class="hljs-string">'s/prmy/sbyfs/gi'</span></span> /tmp/initsbyfs.ora [oracle@sby3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">'s/(db_name=.*)(sbyfs)/\1prmy/gi'</span></span> /tmp/initsbyfs.ora [oracle@sby3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">"s/(dg_config=)(.*$)/\1(prmy,prmyfs,sby,sbyfs)\'/gi"</span></span> /tmp/initsbyfs.ora [oracle@sby3- ~]$ sed -i -r <span class="hljs-string"><span class="hljs-string">"s/(control_files=)(.*$)/\1\'+DATA\',\'+FRA\'/gi"</span></span> /tmp/initsbyfs.ora [oracle@sby3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">'*.db_unique_name=sbyfs'</span></span> &gt;&gt; /tmp/initsbyfs.ora [oracle@sby3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"*.log_file_name_convert='prmy','sbyfs'"</span></span> &gt;&gt; /tmp/initsbyfs.ora [oracle@sby3- ~]$ <span class="hljs-built_in"><span class="hljs-built_in">cd</span></span> /u01/app/oracle/acfsmounts/acfs_db1/dbs [oracle@sby3- dbs]$ <span class="hljs-built_in"><span class="hljs-built_in">echo</span></span> <span class="hljs-string"><span class="hljs-string">"SPFILE='+DATA/sbyfs/spfilesbyfs.ora'"</span></span> &gt; initsbyfs.ora [oracle@sby3- dbs]$ ln -s initsbyfs.ora initsbyfs1.ora [oracle@sby3- dbs]$ . oraenv ORACLE_SID = [oracle] ? sbyfs1 ORACLE_HOME = [/home/oracle] ? /u01/app/oracle/acfsmounts/acfs_db1 The Oracle base has been <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> to /u01/app/oracle [oracle@sby3-sbyfs1 dbs]$ sqlplus / as sysdba SQL&gt; startup nomount pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initsbyfs.ora'</span></span> SQL&gt; create spfile=<span class="hljs-string"><span class="hljs-string">'+DATA/sbyfs/spfilesbyfs.ora'</span></span> from pfile=<span class="hljs-string"><span class="hljs-string">'/tmp/initsbyfs.ora'</span></span>; SQL&gt; shutdown immediate SQL&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> [oracle@sby3-sbyfs1 dbs]$ rman target / RMAN&gt; startup nomount RMAN&gt; restore controlfile from <span class="hljs-string"><span class="hljs-string">'/tmp/sbyfs.ctl'</span></span>; Starting restore using target database control file instead of recovery catalog allocated channel: ORA_DISK_1 channel ORA_DISK_1: SID=39 instance=sbyfs1 device <span class="hljs-built_in"><span class="hljs-built_in">type</span></span>=DISK channel ORA_DISK_1: copied control file copy output file name=+DATA/SBYFS/CONTROLFILE/current.301.886016175 output file name=+FRA/SBYFS/CONTROLFILE/current.274.886016179 Finished restore RMAN&gt; shutdown immediate; RMAN&gt; <span class="hljs-built_in"><span class="hljs-built_in">exit</span></span> [oracle@sby3-sbyfs1 dbs]$ srvctl add database -db sbyfs -oraclehome <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> -dbtype RAC -domain example.com -spfile +DATA/sbyfs/spfilesbyfs.ora -role FAR_SYNC -startoption MOUNT -dbname prmy -policy AUTOMATIC -diskgroup <span class="hljs-string"><span class="hljs-string">"DATA,FRA"</span></span> -acfspath <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span> [oracle@sby3-sbyfs1 dbs]$ srvctl add instance -db sbyfs -node sby3 -instance sbyfs1 [oracle@sby3-sbyfs1 dbs]$ srvctl start database -d sbyfs [oracle@sby3-sbyfs1 dbs]$ asmcmd --privilege sysdba pwcopy --dbuniquename sbyfs /tmp/orapwsbyfs +DATA/sbyfs/orapwdb</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Setting registration of database services in listeners </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> First, remove the static registration of the sby.example.com service in the LISTENER_DG listener on sby1: </font></font><br><pre> <code class="bash hljs">[grid@sby1-+ASM1 ~]$ vi <span class="hljs-variable"><span class="hljs-variable">$ORACLE_HOME</span></span>/network/admin/listener.ora</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> This needs to be removed: </font></font><br><pre> <s><code class="bash hljs">(SID_DESC = (GLOBAL_DBNAME = sby.example.com) (ORACLE_HOME = /u01/app/oracle/acfsmounts/acfs_db1) (SID_NAME = sby) )</code></s> </pre> <s><br></s> <br><pre> <code class="bash hljs">[grid@sby1-+ASM1 ~]$ lsnrctl reload listener_dg</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now we set the parameters related to the registration of services in each of the databases: </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@prmy as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> local_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> remote_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=PRMY1_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=PRMY1_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'prmy1'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=PRMY2_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=PRMY2_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'prmy2'</span></span>; SQL&gt; connect sys/oracle_4U@prmyfs as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> local_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> remote_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=PRMY3_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=PRMY3_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'prmyfs1'</span></span>; SQL&gt; connect sys/oracle_4U@sby as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> local_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> remote_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=SBY1_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=SBY1_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'sby1'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=SBY2_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=SBY2_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'sby2'</span></span>; SQL&gt; connect sys/oracle_4U@sbyfs as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> local_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> remote_listener=<span class="hljs-string"><span class="hljs-string">''</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> listener_networks=<span class="hljs-string"><span class="hljs-string">'((NAME=network1)(LOCAL_LISTENER=SBY3_LOCAL_NET1)(REMOTE_LISTENER=REMOTE_NET1))'</span></span>,<span class="hljs-string"><span class="hljs-string">'((NAME=network2)(LOCAL_LISTENER=SBY3_LOCAL_NET2)(REMOTE_LISTENER=REMOTE_NET2))'</span></span> SCOPE=BOTH SID=<span class="hljs-string"><span class="hljs-string">'sbyfs1'</span></span>;</code> </pre><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating Data Guard Configuration </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We start the broker on each database: </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@prmy as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file1=<span class="hljs-string"><span class="hljs-string">'+DATA/prmy/dg_broker1.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file2=<span class="hljs-string"><span class="hljs-string">'+FRA/prmy/dg_broker2.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_start=TRUE scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; connect sys/oracle_4U@prmyfs as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file1=<span class="hljs-string"><span class="hljs-string">'+DATA/prmyfs/dg_broker1.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file2=<span class="hljs-string"><span class="hljs-string">'+FRA/prmyfs/dg_broker2.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_start=TRUE scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; connect sys/oracle_4U@sby as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file1=<span class="hljs-string"><span class="hljs-string">'+DATA/sby/dg_broker1.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file2=<span class="hljs-string"><span class="hljs-string">'+FRA/sby/dg_broker2.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_start=TRUE scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; connect sys/oracle_4U@sbyfs as sysdba SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file1=<span class="hljs-string"><span class="hljs-string">'+DATA/sbyfs/dg_broker1.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_config_file2=<span class="hljs-string"><span class="hljs-string">'+FRA/sbyfs/dg_broker2.dat'</span></span> scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>; SQL&gt; alter system <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> dg_broker_start=TRUE scope=both sid=<span class="hljs-string"><span class="hljs-string">'*'</span></span>;</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> We are convinced that we can connect to each db via the following descriptors: * _dg: </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@prmy_dg as sysdba [oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@prmyfs_dg as sysdba [oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@sby_dg as sysdba [oracle@prmy1-prmy ~]$ sqlplus sys/oracle_4U@sbyfs_dg as sysdba</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Now you can create a Data Guard configuration. </font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ <span class="hljs-built_in"><span class="hljs-built_in">export</span></span> ORACLE_SID=prmy1 [oracle@prmy1-prmy1 ~]$ dgmgrl / DGMGRL&gt; create configuration RAC_DG as primary database is prmy connect identifier is prmy_dg; DGMGRL&gt; edit instance prmy1 on database prmy <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> PROPERTY StaticConnectIdentifier = <span class="hljs-string"><span class="hljs-string">'(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=prmy1-2-vip.clu-prmy.example.com)(PORT=12001))(CONNECT_DATA=(SERVICE_NAME=prmy_DGMGRL.example.com)(INSTANCE_NAME=prmy1)(SERVER=DEDICATED)))'</span></span>; DGMGRL&gt; edit instance prmy2 on database prmy <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> PROPERTY StaticConnectIdentifier = <span class="hljs-string"><span class="hljs-string">'(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=prmy2-2-vip.clu-prmy.example.com)(PORT=12001))(CONNECT_DATA=(SERVICE_NAME=prmy_DGMGRL.example.com)(INSTANCE_NAME=prmy2)(SERVER=DEDICATED)))'</span></span>; DGMGRL&gt; add far_sync prmyfs as connect identifier is prmyfs_dg; DGMGRL&gt; add database sby as connect identifier is sby_dg; DGMGRL&gt; edit instance sby1 on database sby <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> PROPERTY StaticConnectIdentifier = <span class="hljs-string"><span class="hljs-string">'(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=sby1-2-vip.sby-cluster.clu-prmy.example.com)(PORT=12001))(CONNECT_DATA=(SERVICE_NAME=sby_DGMGRL.example.com)(INSTANCE_NAME=sby1)(SERVER=DEDICATED)))'</span></span>; DGMGRL&gt; edit instance sby2 on database sby <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> PROPERTY StaticConnectIdentifier = <span class="hljs-string"><span class="hljs-string">'(DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=sby2-2-vip.sby-cluster.clu-prmy.example.com)(PORT=12001))(CONNECT_DATA=(SERVICE_NAME=sby_DGMGRL.example.com)(INSTANCE_NAME=sby2)(SERVER=DEDICATED)))'</span></span>; DGMGRL&gt; add far_sync sbyfs as connect identifier is sbyfs_dg; DGMGRL&gt; edit far_sync prmyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property maxfailure=1; DGMGRL&gt; edit far_sync sbyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property maxfailure=1; DGMGRL&gt; edit far_sync prmyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property nettimeout=8; DGMGRL&gt; edit far_sync sbyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property nettimeout=8; DGMGRL&gt; edit far_sync prmyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property reopensecs=5; DGMGRL&gt; edit far_sync sbyfs <span class="hljs-built_in"><span class="hljs-built_in">set</span></span> property reopensecs=5; DGMGRL&gt; <span class="hljs-built_in"><span class="hljs-built_in">enable</span></span> configuration</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Set up routes: </font></font><br><pre> <code class="bash hljs">DGMGRL&gt; edit far_sync prmyfs SET PROPERTY RedoRoutes = <span class="hljs-string"><span class="hljs-string">'(prmy:sby ASYNC)'</span></span>; DGMGRL&gt; edit database prmy SET PROPERTY RedoRoutes = <span class="hljs-string"><span class="hljs-string">'(prmy:prmyfs SYNC alt=(sby async fallback))'</span></span>; DGMGRL&gt; edit far_sync sbyfs SET PROPERTY RedoRoutes = <span class="hljs-string"><span class="hljs-string">'(sby:prmy ASYNC)'</span></span>; DGMGRL&gt; edit database sby SET PROPERTY RedoRoutes = <span class="hljs-string"><span class="hljs-string">'(sby:sbyfs SYNC alt=(prmy async fallback))'</span></span>; DGMGRL&gt; show configuration verbose Configuration - rac_dg Protection Mode: MaxPerformance Members: prmy - Primary database prmyfs - Far sync instance sby - Physical standby database sby - Physical standby database (alternate of prmyfs) Members Not Receiving Redo: sbyfs - Far sync instance Properties: FastStartFailoverThreshold = <span class="hljs-string"><span class="hljs-string">'30'</span></span> OperationTimeout = <span class="hljs-string"><span class="hljs-string">'30'</span></span> TraceLevel = <span class="hljs-string"><span class="hljs-string">'USER'</span></span> FastStartFailoverLagLimit = <span class="hljs-string"><span class="hljs-string">'30'</span></span> CommunicationTimeout = <span class="hljs-string"><span class="hljs-string">'180'</span></span> ObserverReconnect = <span class="hljs-string"><span class="hljs-string">'0'</span></span> FastStartFailoverAutoReinstate = <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span> FastStartFailoverPmyShutdown = <span class="hljs-string"><span class="hljs-string">'TRUE'</span></span> BystandersFollowRoleChange = <span class="hljs-string"><span class="hljs-string">'ALL'</span></span> ObserverOverride = <span class="hljs-string"><span class="hljs-string">'FALSE'</span></span> ExternalDestination1 = <span class="hljs-string"><span class="hljs-string">''</span></span> ExternalDestination2 = <span class="hljs-string"><span class="hljs-string">''</span></span> PrimaryLostWriteAction = <span class="hljs-string"><span class="hljs-string">'CONTINUE'</span></span> Fast-Start Failover: DISABLED Configuration Status: SUCCESS</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, REDO from the main database is synchronously written to far sync prmyfs, and from it is already asynchronously written to the physical standy sby. </font><font style="vertical-align: inherit;">If prmyfs cannot receive this data, then an alternative asynchronous route is switched from prmy to sby. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">When changing database roles, the interaction scheme is the same, but with the main route sby-&gt; sbyfs-&gt; prmy and the alternative sby-&gt; prmy.</font></font><br><br><h4><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Creating a productive service </font></font></h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">It remains to create something for which everything was started - a productive service, the resiliency of which is provided by RAC and Data Guard technologies. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Create a service in a container database orcl. </font><font style="vertical-align: inherit;">This service is activated only if the prmy database is the main one.</font></font><br><pre> <code class="bash hljs">[oracle@prmy1-prmy ~]$ srvctl add service -db prmy -service prodserv1.example.com -role PRIMARY -failovermethod BASIC -failovertype SELECT -failoverdelay 1 -failoverretry 180 -preferred prmy1,prmy2 -pdb orcl -notification TRUE [oracle@prmy1-prmy ~]$ srvctl start service -db prmy -service prodserv1.example.com [oracle@prmy1-prmy ~]$ sqlplus system/oracle_4U@prodserv1 SQL&gt; show con_id CON_ID ------------------------------ 3</code> </pre><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> After we create this service in the sby database, it will be accessible via the PRODSERV1 descriptor from tnsnames.ora, regardless of the role change. </font></font><br><pre> <code class="bash hljs">[oracle@sby1-sby ~]$ srvctl add service -db sby -service prodserv1.example.com -role PRIMARY -failovermethod BASIC -failovertype SELECT -failoverdelay 1 -failoverretry 180 -preferred sby1,sby2 -pdb orcl -notification TRUE.</code> </pre><br><h4>  Conclusion </h4><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">As a result, we got a demo stand for training with RAC and Data Guard technologies. </font><font style="vertical-align: inherit;">It can be used before doing something on the "real" hardware with expensive data. </font></font><br><br><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">This stand turned out to be very simple, for example, there is no Logical Standby in it, there is not enough Enterprise Manager and topology without complex cascading, but it is easy to build from any cheap equipment and get all these features.</font></font></div><p>Source: <a href="https://habr.com/ru/post/263723/">https://habr.com/ru/post/263723/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../263713/index.html">Evolution of the Top Story application interface</a></li>
<li><a href="../263715/index.html">HP Software - a modern approach to building an IT and business services monitoring system</a></li>
<li><a href="../263717/index.html">Landing Page and lead generation</a></li>
<li><a href="../263719/index.html">MyOffice: First Steps</a></li>
<li><a href="../263721/index.html">OpenSource project can develop and make a profit?</a></li>
<li><a href="../263725/index.html">Going to the record: how we optimized the attachment of images in Mail.Ru for iOS</a></li>
<li><a href="../263727/index.html">GPS relieves stress</a></li>
<li><a href="../263729/index.html">MBTI personality types: impact on advertising perception</a></li>
<li><a href="../263739/index.html">Nutanix Cloud Connect - Backup to the AWS Cloud</a></li>
<li><a href="../263741/index.html">Angular.js persistent storage</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>