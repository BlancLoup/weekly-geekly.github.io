<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ZigBee wireless networks. Part 2 [Working with ETRX35X radio modules]</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction 



 In the last article , the main features of ZigBee wireless technology were discussed. In this part we will talk about how to quickly...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ZigBee wireless networks. Part 2 [Working with ETRX35X radio modules]</h1><div class="post__text post__text-html js-mediator-article"><h1>  Introduction </h1><br><img align="left" width="400" src="https://habrastorage.org/files/760/21a/8ef/76021a8ef5fc430594284d70fca188b5.png"><br><p>  In the <a href="https://habrahabr.ru/company/efo/blog/281048/">last article</a> , the main features of ZigBee wireless technology were discussed.  In this part we will talk about how to quickly start working with this technology in practice.  For this purpose, the ETRX357 modules were selected, which have built-in firmware that allows you to work with network functions and control analog and digital peripherals using a set of AT commands.  Also, the article will discuss in more detail the issues related to the types of devices in the ZigBee network and network security.  At the end, we will collect a data collection network that will receive temperature information from several wireless devices. </p><a name="habracut"></a><br><hr><br><h1>  1. Modules ETRX357 </h1><br><img align="right" width="300" src="https://habrastorage.org/files/fcc/7a2/f49/fcc7a2f494814b5c8d70cf9688f94066.JPG"><br><p>  Let's get acquainted with the selected hardware platform.  The <a href="http://www.wless.ru/technology/%3Faction%3Ddetails%26id%3D255%26pf%3Dtech%26pf_id%3D1%26prod%3D5%26tech%3D1%26type%3D60">ETRX357</a> modules <a href="http://www.wless.ru/technology/%3Faction%3Ddetails%26id%3D255%26pf%3Dtech%26pf_id%3D1%26prod%3D5%26tech%3D1%26type%3D60">are</a> based on the <a href="http://www.wless.ru/technology/%3Faction%3Ddetails%26id%3D183%26pf%3Dtech%26pf_id%3D1%26prod%3D24%26tech%3D1%26type%3D4">EM357</a> chip from Silicon Labs.  This microcircuit is a system-on-a-chip ‚Äî the Cortex-M3 processor core ‚Äî a RF transceiver operating at 2.4 GHz. </p><br><p>  <a href="http://www.wless.ru/technology/%3Faction%3Ddetails%26id%3D255%26pf%3Dtech%26pf_id%3D1%26prod%3D5%26tech%3D1%26type%3D60">ETRX357</a> modules <a href="http://www.wless.ru/technology/%3Faction%3Ddetails%26id%3D255%26pf%3Dtech%26pf_id%3D1%26prod%3D5%26tech%3D1%26type%3D60">are</a> available in 4 versions: </p><br><ul><li>  ETRX357 - module with integrated chip antenna.  The maximum radio signal output power is +8 dBm. </li><li>  The ETRX357HR is a module with a u.FL connector for connecting an external antenna.  The maximum radio signal output power is +8 dBm. </li><li>  The ETRX357-LRS is a module with an integrated antenna chip and an integrated power amplifier.  The maximum radio signal output power is +20 dBm. </li><li>  The ETRX357HR-LRS is a module with a u.FL connector for connecting an external antenna and a built-in power amplifier.  The maximum radio signal output power is +20 dBm. </li></ul><br><p>  Experimental measurements of the communication range for the ETRX357 and ETRX357-LRS modules in direct visibility conditions: </p><br><ul><li>  ETRX357 - confident reception at a distance of ~ 300 meters </li><li>  ETRX357-LRS - confident reception at a distance of ~ 900 meters </li></ul><br><p>  Below is a summary table of the main characteristics of the module: </p><br><table><thead><tr><th>  Specifications </th><th>  Description </th></tr></thead><tbody><tr><td>  <strong>CPU core</strong> </td><td>  ARM Cortex-M3 </td></tr><tr><td>  <strong>RF transceiver</strong> </td><td>  2.4 GHz </td></tr><tr><td>  <strong>Flash / RAM volume, Kb</strong> </td><td>  192/12 </td></tr><tr><td>  <strong>power usage</strong> </td><td>  <strong>TX:</strong> 42 mA @ +8 dBm </td></tr><tr><td></td><td>  <strong>RX:</strong> 26.5 mA </td></tr><tr><td></td><td>  <strong>"Dream":</strong> 400 nA </td></tr><tr><td>  <strong>Working voltage range</strong> </td><td>  2.1 - 3.6 V </td></tr><tr><td>  <strong>Operating temperature range</strong> </td><td>  -40 ... + 85 ¬∞ C </td></tr></tbody></table><br><p>  More detailed information on the technical characteristics can be obtained in the documentation for the modules [ <a href="http://www.wless.ru/files/ZigBee/ETRX3/TG-ETRX35x-PM-010-107.pdf">1</a> ]. </p><br><hr><br><h1>  2. Firmware </h1><br><p>  All modules come with firmware from the manufacturer, and to get started, just power up the module, connect the TxD and RxD lines of the UART serial interface, through which the module communicates with AT commands.  All teams can be divided into 2 types: </p><br><ol><li>  Work with network functions.  For example: <br><ul><li>  Networking / connecting to an existing network </li><li>  Sending targeted / multicast / broadcast messages </li><li>  Read / write remote node registers </li></ul></li><li>  Work with the periphery of the module.  For example: <br><ul><li>  Configure I / O Ports </li><li>  RF transceiver power control </li><li>  Enable / disable the output of information messages on the serial interface </li></ul></li></ol><br><p>  Also, the standard firmware includes a set of functions, which allow in some cases to do without an external microcontroller or control device.  A complete list of commands can be found in the manual [ <a href="http://www.wless.ru/files/ZigBee/Firmware/TG-ETRXn-R309-Commands.pdf">2</a> ], only the most frequently used ones are listed below.  We will need some of the commands in this list to create our data collection system. </p><br><div class="spoiler">  <b class="spoiler_title">Work with network</b> <div class="spoiler_text"><table><thead><tr><th>  Team </th><th>  Description </th></tr></thead><tbody><tr><td>  AT + PANSCAN </td><td>  Scan the air for available networks </td></tr><tr><td>  AT + EN </td><td>  Networking </td></tr><tr><td>  AT + JN </td><td>  Connect to any available network </td></tr><tr><td>  AT + DASSL </td><td>  Leave current network </td></tr><tr><td>  AT + DASSR: &lt;device address&gt; </td><td>  Send a command to the remote device to exit the network </td></tr></tbody></table></div></div><br><div class="spoiler">  <b class="spoiler_title">Sending messages</b> <div class="spoiler_text"><table><thead><tr><th>  Team </th><th>  Description </th></tr></thead><tbody><tr><td>  AT + UCAST: &lt;device address&gt; = &lt;message&gt; </td><td>  Sending an address message </td></tr><tr><td>  AT + MCAST: &lt;max.  the number of relays&gt;, &lt;group ID&gt;, &lt;message&gt; </td><td>  Networking </td></tr><tr><td>  AT + BCAST: &lt;max.  number of retransmissions&gt;, &lt;message&gt; </td><td>  Connect to any available network </td></tr><tr><td>  AT + SCAST: &lt;message&gt; </td><td>  Send data to Sink-site </td></tr></tbody></table><br><p>  <strong>Maximum message length</strong> : 72 bytes. </p><br><p>  <strong>Important</strong> : multicast messages are a special case of broadcast messages, so do not send them with a high repetition rate (the documentation indicates no more than 8 multicast / broadcast messages within 8 seconds).  In addition, it is worth paying attention to the fact that multicast messages are not accepted by sleeping end devices. </p></div></div><br><div class="spoiler">  <b class="spoiler_title">Work with radio module registers</b> <div class="spoiler_text"><table><thead><tr><th>  Team </th><th>  Description </th></tr></thead><tbody><tr><td>  ATSXX? </td><td>  Reading the contents of the SXX register </td></tr><tr><td>  ATSXX = YYYY </td><td>  Writing to the SXX register value YYYY </td></tr><tr><td>  ATREMS: &lt;device address&gt;, XX? </td><td>  Reading the contents of the remote node's SXX register </td></tr><tr><td>  ATREMS: &lt;device address&gt;, XX = YYYY </td><td>  Writing to the SXX register of the remote node the value YYYY </td></tr></tbody></table><br><p>  Bitwise access to embedded S-registers is possible.  To do this, the read / write command, after XX, you need to specify the number of the bit to be addressed.  For example: </p><br><pre><code class="python hljs">ATS001? <span class="hljs-comment"><span class="hljs-comment">#   1    S00 ATS001=1 #  1  1   S00 ATS1812? #   18    S18 ATREMS:0000,0AE? #   14    S0A      0000</span></span></code> </pre> </div></div><br><img align="right" width="300" src="https://habrastorage.org/files/1ab/df8/21c/1abdf821c9f94886acc672d3d6372ffc.png"><br><p>  We now turn to a more detailed consideration of the process of building a ZigBee network.  We will work with the debug boards on which the mezzanine radio module and the ZigBee USB gateway are installed.  There are several analog sensors on the debug boards, which will be discussed later.  We will take readings from them and send them to the central data collection center, where all this will be processed.  Step by step, we will create our data collection system and analyze the main difficulties that may arise in the process. </p><br><p>  We describe the future data collection system: </p><br><ul><li>  The ZigBee USB Gateway is the network coordinator and is connected to the PC. </li><li>  The ZigBee USB Gateway is the central data collection hub. </li><li>  Two radio modules collect the data from the temperature and light sensor and transmit them to the central data collection center every 10 seconds. </li><li>  On the PC, a program is running that converts the digitized temperature values ‚Äã‚Äãto degrees Celsius and outputs to the console. </li></ul><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/4ba/f1a/d0a/4baf1ad0a1db4a8c87658652f8e3c54a.jpg"></div><br><hr><br><h1>  3. Creating a ZigBee Network </h1><br><p>  Above, the <strong>AT + EN</strong> command was mentioned, which allows you to organize a network.  The device to which this command was sent over the serial interface becomes the network coordinator.  By default, the coordinator independently selects the most suitable frequency channel, generates a short and long network address. </p><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="python hljs">AT+EN JPAN:<span class="hljs-number"><span class="hljs-number">24</span></span>,<span class="hljs-number"><span class="hljs-number">949</span></span>D,<span class="hljs-number"><span class="hljs-number">56370</span></span>DE37E0DC0FF <span class="hljs-comment"><span class="hljs-comment"># 24 -   # 949D -    # 56370DE37E0DC0FF -   </span></span></code> </pre> </div></div><br><p>  Below is a list of registers, the value of which affects the process of creating a ZigBee network: </p><br><ul><li><p>  Channel Mask - Register <strong>S00</strong> .  This mask determines which channels can be used.  Recall, the ZigBee technology specification defines 16 frequency channels (numbering from 11 to 26).  The register is 2 byte, so by setting 0/1, you can enable / disable the use of the corresponding channel.  This setting is valid both for the coordinator when creating a network, and for all other devices that want to join an available network. </p><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="python hljs"> ATS00=<span class="hljs-number"><span class="hljs-number">0001</span></span> <span class="hljs-comment"><span class="hljs-comment">#    11   ATS00=FFFF #      </span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li><p>  Transceiver output power - register <strong>S01</strong> .  This parameter applies to the radio when creating a network or connecting to an available network, and is valid <strong>for the entire time</strong> the device is on the network.  In the process of working in the ZigBee network, this parameter cannot be changed.  The only way to do this is to leave the network, change the value in the register to a new one, leave the network and reconnect.  All possible values ‚Äã‚Äãthat can be written to the register S01 are listed in the documentation [2]. </p><br><div class="spoiler">  <b class="spoiler_title">Example</b> <div class="spoiler_text"><pre> <code class="python hljs"> ATS01=<span class="hljs-number"><span class="hljs-number">8</span></span> <span class="hljs-comment"><span class="hljs-comment">#    +8  # (   ETRX357.  LRS-  #      )</span></span></code> </pre> <br></div></div><br></li></ul><br><ul><li>  Preferred values ‚Äã‚Äãfor short and long identifiers are registers <strong>S02</strong> and <strong>S03</strong> .  By default, the registers are written 0. For the coordinator, this means that when the network is organized, it will automatically generate the appropriate values.  For all other devices - connect to any available network.  Otherwise, if the value of the registers is different from 0, then the following rules apply: <br><ul><li>  the coordinator will try to assign the appropriate identifiers to the new network </li><li>  all other devices will try to connect to the network with the specified identifiers </li></ul></li></ul><br><p>  <em>There is one important point for the coordinator:</em> if you try to create a network with predefined identifiers, there is already a network with the same parameters, then matching identifiers will be generated automatically. </p><br><ul><li>  The device type is the upper 4 bits in the <strong>S0A</strong> register.  Types of devices will be discussed later.  Now we say that the type of device is determined when connected to the network and can be changed in a similar way with a change in the output power of the transceiver. </li></ul><br><hr><br><h1>  4. Network security </h1><br><p>  In ZigBee networks, a special node, the Trust Center, is responsible for security.  The default coordinator is the Trust Center.  A trust center can also be any router (FFD device), if the network was created in the mode of a distributed trust center (this will be discussed at the end of this chapter). </p><br><p>  List of responsibilities of the Trust Center: </p><br><ol><li>  permission to connect other devices </li><li>  working with encryption keys (periodically updating keys, notifying other nodes about updating a key) </li></ol><br><p>  ZigBee networks use two keys: </p><br><ol><li>  <strong>Link Key</strong> - this key is used to establish a secure connection between two devices on the network to exchange data.  The key that the device receives at the time of connecting to the network is called the Trust Center Link Key, and all other keys that can be obtained during device operation are Application Layer Link Keys.  By default, the Trust Center Link Key is transmitted in the clear, which represents a security hole, since this key can be intercepted when a new device is connected to the network. </li><li>  <strong>Network Key</strong> - this key is used to encrypt data on the network level of the ZigBee stack.  It is generated by the Trust Center and updated periodically.  All devices in a single ZigBee network have a single Network Key.  It is used to encrypt all network packets.  By default, the Trust Center transfers the Network Key encrypted using the Link Key </li></ol><br><p>  To prevent the potential compromise of data transmitted over the network, you can use several options: </p><br><ul><li>  Transmit Link Key via non-standard communication channel / other communication protocol </li><li>  use the pre-installed key </li><li>  use the connection resolution mechanism on the side of the Trust Center (this method will not protect against compromise, but other people's devices will not be able to participate in the network accidentally or intentionally) </li></ul><br><p>  In this article we will look at the option with the Link Key preinstalled.  The disadvantage of this approach is the need to write the appropriate configuration to all modules.  But for our small network it is not critical.  In the standard firmware of the modules, the ETRX357 Link Key can be set by writing the corresponding value to register <strong>S09</strong> .  In addition, the following bits must be set to 1 in the <strong>S0A</strong> register: </p><br><ul><li>  bit 2 - setting to 1 forces the node to transmit the Network Key encrypted with the Link Key when trying to reconnect any devices </li><li>  bit 4 - - // - when trying to connect new nodes </li><li>  bit 8 - setting to 1 causes the node to use the preset Link Key </li></ul><br><div class="spoiler">  <b class="spoiler_title">Node configuration example</b> <div class="spoiler_text"><pre> <code class="python hljs">ATS09=ABCDEFFEDCBACBAFEDDEFABCBAFEDCFF:password <span class="hljs-comment"><span class="hljs-comment">#  Link Key # :password -       ATS0A8=1 ATS0A4=1 ATS0A2=1</span></span></code> </pre> </div></div><br><p>  Setting bits 2 and 4 on all nodes except the coordinator is an optional procedure.  Advantages of this approach: </p><br><ul><li>  There is no need to record the preferred identifier (short and / or long) of the network that the nodes will try to use to connect.  Devices can only connect to a network with a Link Key installed. </li><li>  the attacker will not be able to get the Link Key, as it will not be transmitted in the clear </li><li>  to the network will not be able to connect the "alien" device </li></ul><br><p>  Let us point out another interesting possibility: in the S0A register, 9 bits are responsible for enabling a special function ‚Äî create a network in the mode of a distributed Trust Center.  In this mode of operation, any router (FFD device) can allow new devices to connect to the current network.  Distributed Trust Center mode is used when deploying large networks to avoid delays in connecting all wireless nodes.  After the network is deployed, a Trust Center is selected by <strong>AT + BECOMETC</strong> , which will manage security policy.  To ensure the safety of the network in this mode of operation, it is also necessary to take care of the pre-installation / acquisition of the Link Key.  Otherwise, until the Trust Center is selected, any ZigBee device will potentially be able to seamlessly connect to the network. </p><br><hr><br><h1>  5. Types of ZigBee Devices </h1><br><p>  In the <a href="https://habrahabr.ru/company/efo/blog/281048/">previous article</a> , the main types of ZigBee devices were considered.  Recall the main features and dwell on the types of end devices: </p><br><ul><li><p>  <strong>coordinator (COO)</strong> - the device that organized the network.  Participates in the process of routing network traffic, performs the duties of the Trust Center (except in the case of the distributed Trust Center mode).  Does not go into sleep mode, so this device must have a stationary power source </p><br></li><li>  <strong>A router (FFD)</strong> is a device that when connected was of the type FFD (full-featured device).  Like the coordinator, such a device participates in the routing of network traffic, and all comments for the coordinator regarding the sleep mode are valid for the router. </li></ul><br><p>  The listed devices act as parent nodes for the end devices.  The maximum number of child nodes at a router or coordinator can reach 32. Parent devices are responsible for receiving and storing (*) messages for end devices that are connected to them.  The end devices, in turn, communicate with the network through parents.  Each time a new end device connects to the network or when the old one reconnects, a parent is defined for it, which makes an entry in a special table of child devices.  This table stores the short and long address of the child node and its type.  Consider the available types of end devices: </p><br><ul><li><p>  <strong>end device (ZED)</strong> - a device that does not participate in the network's work in routing traffic, connecting new devices, etc.  For this type, the ZigBee technology specification does not provide for a sleep mode.  Therefore, when describing a parent (*) it meant that they do not store messages for ZED devices.  It is assumed that the ZED device always includes the receiver and the parent node sends it to the addressee immediately after receiving the address message.  So these devices must also have a stationary power source. </p><br></li><li><p>  <strong>Sleeping End Device (SED)</strong> - Network duties for this type of device are similar to the previous type.  The only difference is in the support for sleep mode, which is announced in the ZigBee technology specification.  Such devices spend most of their time in sleep mode and can operate on a battery-powered power supply for a long time.  The definition of ‚Äúlong time‚Äù here depends on the application, but if we consider the example of a wireless ZigBee switch, the lifetime of such a device from one set of disk batteries can be 2-3 years [3].  Such devices come out of sleep mode only by some external event (by a timer interrupt, in order to digitize the sensor readings; by pressing a button, etc.) or when it is time to send a data packet.  In order to receive messages from the parent node, sleeping nodes use the <strong>Polling mechanism</strong> .  We will talk about it a bit later. </p><br></li><li>  <strong>Mobile end device (MED)</strong> is an analogue of a sleeping end device (SED), with the only exception that the record about it is stored in the child table of the parent node for a short time - from several seconds to several minutes (for a sleeping end device, the record storage time can be up to 48 days).  This is done, based on the type name, so that such a device can move around the room / object without causing collisions when sending a message.  A collision may occur if several parents have an entry for the same node.  This type of device is not described in the ZigBee specification and is a type of extension of the functions of the SED device in the implementation of the ZigBee stack from Silicon Labs. </li></ul><br><p>  <em>ZigBee Network Example</em> </p><br><img width="350" align="left" src="https://habrastorage.org/files/dfa/28d/42e/dfa28d42e5a941c09f98126fd49c4c82.png"><br><p>  End devices are always connected via an FFD device, which at the time of connection had the best indicator of the quality of communication.  In the process of work, a situation may arise when the router has failed or it has been taken for service.  In this case, after several attempts to reconnect with the parent, the end device will start searching for a new parent node.  In the figure, the connection between the mobile node and the parent is indicated by a dotted line.  After a certain period of time, the MED device can join the network through another parent. <br><br><br></p><br><h3>  Polling mechanism </h3><br><p>  This mechanism is used for several purposes: </p><br><ol><li><p>  Mobile and end devices can thus receive messages that are stored for them in the parent node. </p><br></li><li>  Preventing deletion of an entry about yourself from the child device table. </li></ol><br><p>  According to the ZigBee specification for sleeping end devices, address messages are stored by the parent ~ <strong>7.68</strong> seconds.  Moreover, if the frequency of following address messages for SED / MED devices is higher than the specified value, then the messages will be overwritten.  Therefore, to ensure reliable data delivery, the sleeping endpoint device must poll the parent node frequently enough.  In this regard, there are two polling intervals for sleeping end devices: <strong>Short Poll</strong> and <strong>Long Poll</strong> intervals. </p><br><p>  The Short Poll interval is used when waiting for confirmation of a successful transaction, for example, when sending a packet with data on sensor readings.  Usually this interval is set to 1 second.  After confirmation is received, the device goes into sleep mode and then the Long Poll interval is used. </p><br><p>  Long poll interval is usually set in a fairly large - from several minutes to several days.  This allows the sleeping end device to save space in the child table of the parent.  A parent can delete the end device from its table if it has not been contacted in time.  In this case, the end device that slept through its time must be reconnected to the network. </p><br><p>  For more information about the Polling mechanism, see the ZigBee stack manual from Silicon Labs.  In the standard firmware for ETRX357 modules, the parent node is polled by a timer / counter interrupt 0. </p><br><hr><br><h1>  6. Creating a data collection network </h1><br><p>  The basic theory is told, let's move on to practice.  A <a href="https://github.com/vpetrigo/etrx35x-utils">module in Python</a> will be used to work with radio modules ETRX357.  All recommendations for its use are given in the accompanying README file. </p><br><h2>  6.1 Configuring ZigBee Devices </h2><br><p>  We write in each node the appropriate configuration.  All three devices ‚Äî a USB gateway and two debug boards ‚Äî were connected to a computer and each was configured accordingly: </p><br><ul><li>  for the USB gateway, the coordinator branch ("COO") from the configuration file was used </li><li>  for modules on debug boards - a branch of sleeping end devices ("SED") from the configuration file </li></ul><br><div class="spoiler">  <b class="spoiler_title">Sample configurator program</b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 # coding=utf-8 import rfconf import serial.tools.list_ports def main(): #     sensor_nwk.xml configurator = rfconf.ModuleConfigReader("sensor_nwk.xml") supp_nodes = configurator.get_avail_nodes() supp_nodes = dict(enumerate(supp_nodes)) if len(supp_nodes) &gt; 0: print("Configuration XML file support {} nodes:".format(len(supp_nodes))) print(supp_nodes) #        "Telegesis" for com in serial.tools.list_ports.comports(): if com.description.split()[0] == "Telegesis": tgmodule = rfconf.ModuleInterface(com.device) usr_choice = int(input("How would you like to configure that node: ")) tgmodule.set_node_type(supp_nodes[usr_choice]) tgmodule.write_config(configurator) else: print("There is nothing to do") if __name__ == "__main__": main()</span></span></code> </pre> </div></div><br><div class="spoiler">  <b class="spoiler_title">configuration file</b> <div class="spoiler_text"><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rfconfig</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"COO"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Link Key --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S09"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span> 12341234123412341234123412341234 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S0A"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 0114 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S01"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag">&gt;</span></span> 3 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  Sink- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 10 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"SED"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!-- Link Key --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S09"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"string"</span></span></span><span class="hljs-tag">&gt;</span></span> 12341234123412341234123412341234 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S0A"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">password</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"password"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 0114 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S01"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag">&gt;</span></span> 3 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    Sink- --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S10"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 100 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    PB5 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S15"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"n"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 2000 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   / --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S13"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 00FF7EFB <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S16"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 00008204 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     S16,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S17"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 00008204 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--   / --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S18"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 00FD58E7 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--     S18,      --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S19"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 00FD58E7 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--  / 7 --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S37"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag">&gt;</span></span> 40 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S38"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 8110 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--       --&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    2     --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S28"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"int"</span></span></span><span class="hljs-tag">&gt;</span></span> 0003 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    0     1 (PA0) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S23"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 0001 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-comment"><span class="hljs-comment">&lt;!--    2     2 (PA1) --&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"S24"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">overwrite</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"y"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"hex"</span></span></span><span class="hljs-tag">&gt;</span></span> 0003 <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">reg</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">node</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">rfconfig</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> </div></div><br><p>  A few comments about setting up sleeping end devices.  In order to minimize the power consumption of the radio module, you must turn off all unused peripherals: the LED display and the power of the light sensor.  In addition, all unused pins must be configured to be configured with a pull-up or exit.  Several 32-bit registers are responsible for configuring I / O ports: </p><br><ul><li>  register <strong>S13</strong> auxiliary register, which allows to determine the direction of the output (Hi-Z, input with pull-up, push-pull output, output with open collector) </li><li>  Register <strong>S16</strong> configures a specific pin as an input (record 0) or as an output (record 1).  The radiosodule has 3 ports A, B, C with 8 conclusions each.  Recording settings can be made either by recording a separate bit, changing each output separately, or making changes at once for the whole group.  The register is not non-volatile, so if you need a permanent application of a particular configuration, then it must be written to the register <strong>S17</strong> .  The value of this register is automatically transferred to the register when power is applied or when reset. </li><li>  Register <strong>S18</strong> sets the logical level at the output of the output.     ,   0/1       .       ,   0/1        .  S18    S16    .        <strong>S19</strong> ,       . </li></ul><br><p>        /      AT-[2].        ,           ,     ,   .  ,        <strong>S15</strong>   13  1 (    PB5).       <a href="http://www.ti.com.cn/cn/lit/ds/symlink/lm61.pdf">LM61</a> . </p><br><div class="spoiler"> <b class="spoiler_title">  LM61</b> <div class="spoiler_text"><img width="300" src="https://habrastorage.org/files/0dd/d26/3ed/0ddd263ed9e9433592942f88e464b3bb.png"></div></div><br><h2> 6.2        </h2><br><p>  ,          ,   ,        .             .       ,      .    / 7    10 .     / 7   S37.        : </p><br><div style="text-align:center;"><img width="500" src="https://habrastorage.org/files/f7a/b2f/612/f7ab2f612e044f3a8c911d09a9b9ba00.png"></div><br><p>      / 7     <strong>S38</strong> .      0110,        /,        Sink-.  ,     ,    (S38F)   S38   1.  ,    ‚Äì 8110.         [3].      ,   Sink-. </p><br><h3> Sink- </h3><br><p>     ZigBee      (PANID).      0000          . ,  ,    ,     (UART, SPI  ..)        -  .    ‚Äì   ,    ETRX357,    ,       .  Disadvantages of this approach: </p><br><ul><li>          : <br><ul><li>                  </li><li>        .          ,          </li></ul></li><li>          : <br><ul><li>               ,    .          </li></ul></li></ul><br><p>  ,          ,     ETRX357    ‚Äî  Sink- ‚Äî       .    Sink-, 4    <strong>S10</strong>    .   ,    ,    Sink,           Sink,   8    <strong>S10</strong>    <strong>AT+SSINK</strong>     Sink-. Sink-         ,  ,      .    ,   Sink-,      . ,    Sink-,       ,     .      ,       ,          Sink-    . </p><br><p>       Sink    <strong>AT+SCAST</strong> : </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#    Sink AT+SCAST:Hello # ( )     AT+UCAST:CAFE=Hello AT+UCAST:000D6F00024CBCCC=Hello</span></span></code> </pre> <br><h2> 6.3     </h2><br><p>         0,    .                - . </p><br><p> <em>    </em> </p><br><div style="text-align:center;"><img src="https://habrastorage.org/files/362/3d4/9ec/3623d49ec6464bf6bef5f358b7c6f1dd.png"></div><br><p>        2     ( <strong>S28</strong> ).  ,  ,    2-4,    ,     UART.            0  ,  ,             . ,             UART (  .   S11).     4 ,          .     1  2 ( PA0  PA1).     : </p><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># ,     0 - 0001 # ,     2 - 0003 #    2     ATS28=0003 #    0    1 ATS23=0001 #    2    2 ATS24=0003</span></span></code> </pre> <br><p>            : </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/5e6/795/518/5e67955187984b0091f6b4d4f5651564.png"></div></div><br><div class="spoiler"> <b class="spoiler_title"> 2,  LM61 </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/f5f/d71/9b8/f5fd719b801e460b94ae834427d8e4d4.png"></div></div><br><div class="spoiler"> <b class="spoiler_title"> 0,  LM61 </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/c2c/22f/833/c2c22f833ebd4367af0d02126c62c461.png"></div></div><br><div class="spoiler"> <b class="spoiler_title"> 2,  LM61 </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/d6d/1d5/a1c/d6d1d5a1c9994abbbe3094042aaac6c3.png"></div></div><br><p> ,    1 ,   Polling-.       ,    ,      .   1          .  Polling-    ,        . </p><br><div class="spoiler"> <b class="spoiler_title">   2, poll=1024 ,  LM61 </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/e52/ebf/e4b/e52ebfe4b926480cbbf3755073364ff8.png"></div></div><br><h2> 6.4   </h2><br><p>  ,   ,       .  <a href="https://github.com/vpetrigo/etrx35x-utils">  GitHub</a> ,   <strong>examples</strong> ,   <strong>sensor_nwk.py</strong> .           ,   .            .            .         -  ,        . </p><br><div class="spoiler"> <b class="spoiler_title">    </b> <div class="spoiler_text"><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment">#!/usr/bin/env python3 # coding=utf-8 import rfconf import serial.threaded class TemperatureReader(rfconf.ETRXModuleReader): TEMP_POS = 2 NODEID_POS = 0 def handle_line(self, data): if not data: #    return #      : # SDATA: &lt;Long ID&gt;,&lt;GPIO state&gt;,&lt;ADC0&gt;,&lt;ADC1&gt;,&lt;SeqNO&gt;,&lt;VCC&gt; info, *payload = rfconf.response_split(data) if info == "SDATA": nodeid = payload[self.NODEID_POS] temp = int(payload[self.TEMP_POS], 16) #       #   LM61 temp = (temp / 10 - 600) / 10 print("Node: {} - Temperature: {:.2f}".format(nodeid, temp)) def leave_network(node): LEAVE_NWK_CMD = "AT+DASSL" node.write_command(LEAVE_NWK_CMD) resp = node.read_resp() #    AT+DASSL    "OK" #    ,      "LeftPAN" if resp[-1] == "OK": msg = "" while not msg: msg = node.readline() print(msg) else: print(resp[-1]) def get_network_info(coordinator): NWK_INFO_POS = 1 GET_NWK_INFO_CMD = "AT+N" coordinator.write_command(GET_NWK_INFO_CMD) resp = coordinator.read_resp() if resp[-1] == "OK": nwk_info = resp[NWK_INFO_POS] *nused, ch, txpower, panid, longid = rfconf.response_split(nwk_info) print("network already created - ", end="") print("ch: {}, PANID: {}, EUI64: {}".format(ch, panid, longid)) def create_network(coordinator): NWK_INFO_POS = 1 NWK_PARAMS_POS = 1 CREATE_NWK_CMD = "AT+EN" coordinator.write_command(CREATE_NWK_CMD) resp = coordinator.read_resp() if resp[-1] == "OK": #    nwk_info = resp[NWK_INFO_POS] info, ch, sid, lid = rfconf.response_split(nwk_info) print("network is created - ", end="") print("ch: {}, PANID: {}, EUI64: {}".format(ch, sid, lid)) else: #     -     , #          get_network_info(coordinator) def main(): coo_node = rfconf.ETRXModule("&lt;COMXX  (Windows)  /dev/&lt;ttyUSBXX&gt; (Linux)&gt;", node_type="COO") reader = TemperatureReader(coo_node) #      create_network(coo_node) ser = coo_node.get_serial_interface() reader_thread = serial.threaded.ReaderThread(ser, reader) #      with reader_thread as protocol: reader_thread.join() if __name__ == "__main__": main()</span></span></code> </pre> </div></div><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/b95/77b/9ab/b9577b9ab6e349528c97d49db7811ea6.png"></div></div><br><hr><br><h1> 7.  </h1><br><p>           ,           .      ZigBee-      .    ,    Polling-        ~250 .     1 ,         4000  (~160 ).     ,       .      ,         . </p><br><p>  ,       ,       .       .     ,     <a href=""></a>    . </p><br><p> PS           Energy Profiler,     <a href="http://www.silabs.com/products/mcu/Pages/simplicity-studio.aspx">Simplicity Studio</a> ,    <a href="http://mymcu.ru/support/otsenochnie-nabori-efm32-starter-kit.html">EFM32GG-STK3700</a>  Advanced Energy Monitor.     <a href="http://www.silabs.com/Support%2520Documents/TechnicalDocs/an0027.pdf">Application Note</a>  Silicon Labs.     ,     STK3700,             .         SWO    . </p><br><div class="spoiler"> <b class="spoiler_title">   </b> <div class="spoiler_text"><img src="https://habrastorage.org/files/6a1/7d8/169/6a17d8169bd143b98dd0b45c6a2355d1.JPG"></div></div><br><hr><br><h1>  Bibliography </h1><br><ol><li>   ETRX357 <a href="http://www.wless.ru/files/ZigBee/ETRX3/TG-ETRX35x-PM-010-107.pdf"> </a>  <a href="http://www.wless.ru/files/ZigBee/ETRX3/TG-ETRX35x-LRS-PM-015-105.pdf"> </a> </li><li> <a href="http://www.wless.ru/files/ZigBee/Firmware/TG-ETRXn-R309-Commands.pdf">  AT-    ETRX357</a> </li><li> <a href="http://www.silabs.com/products/wireless/Pages/battery-life-in-connected-wireless-iot-devices.aspx"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> of a Silicon Labs </font><a href="http://www.silabs.com/products/wireless/Pages/battery-life-in-connected-wireless-iot-devices.aspx"><font style="vertical-align: inherit;">ZigBee Battery Operated Switch</font></a></font></li><li> <a href="http://www.wless.ru/files/ZigBee/ETRX3DVKA/TG-ETRX35xDVK-PM-012-108.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Description of the debug kit ETRX3DVKA357</font></font></a> </li></ol><br><h1>  List of articles </h1><br><ol><li> <a href="https://habrahabr.ru/company/efo/blog/281048/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZigBee wireless networks. </font><font style="vertical-align: inherit;">Part 1 [introductory]</font></font></a> </li><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZigBee wireless networks. </font><font style="vertical-align: inherit;">Part 2 [Working with ETRX35X radio modules]</font></font></li></ol><br><h1>  useful links </h1><br><ul><li> <a href="https://www.youtube.com/watch%3Fv%3DaHEA7qi_YFc%26list%3DPL8l4z24uB4CNoQ2IHGBCNVvPcN22onzLE"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">ZigBee technology video</font></font></a> </li><li> <a href="https://github.com/vpetrigo/etrx35x-utils"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Python module</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> for working with firmware ETRX357</font></font></li></ul></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/306062/">https://habr.com/ru/post/306062/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../306052/index.html">How to "make" a service for mailing manually</a></li>
<li><a href="../306054/index.html">PDF report in 4 minutes</a></li>
<li><a href="../306056/index.html">A little bit about designing self-timed circuits</a></li>
<li><a href="../306058/index.html">Impressions of the best presentations at the SQA Days conference</a></li>
<li><a href="../306060/index.html">Stroke a lizard or network load testing with cisco trex</a></li>
<li><a href="../306066/index.html">Trainee - a find for a spy</a></li>
<li><a href="../306068/index.html">5 unusual ways to fulfill promises</a></li>
<li><a href="../306070/index.html">In a nutshell about NEXUS</a></li>
<li><a href="../306072/index.html">API for managing players on sites</a></li>
<li><a href="../306074/index.html">Forwarding a USB printer to an LXD container</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>