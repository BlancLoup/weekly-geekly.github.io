<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>oAuth for iOS apps</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It was getting dark. Warm August Saturday predisposed to the implementation of oAuth authorization on Google and Facebook for iOS client of the club o...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>oAuth for iOS apps</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/613/a6b/153/613a6b15349d01bbfd2f367e2962d6f5.png" alt="Screen greeting club Trellj for iPhone" align="left"><br>  It was getting dark.  Warm August Saturday predisposed to the implementation of oAuth authorization on Google and Facebook for iOS client of the <a href="http://trellis-club.com/ru/">club of</a> intellectual games. <br><br>  A superficial web search hinted to us that both companies provide tools for developers to automate this routine as quickly as possible and to return to more interesting tasks of directly programming the gameplay. <br><br>  Quick links to the libraries themselves: <b>Google</b> - <a href="http://code.google.com/p/gtm-oauth2/">gtm-oauth2</a> , <b>Facebook</b> - <a href="http://github.com/facebook/facebook-ios-sdk">facebook-ios-sdk</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      About the nuances of integration under the cat. <br><a name="habracut"></a><br><br><h2>  Google </h2><br>  First of all, go to the <a href="https://code.google.com/apis/console">API Console</a> and get Client ID and Client Secret there.  The procedure is quick and free. <br><br>  We connect to the project library gtm-oauth2.  On the google authorization button we hang something like: <br><br><pre><code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"GTMOAuth2ViewControllerTouch.h"</span></span> ... - (void)onGoogleAuth:(id)sender { GTMOAuth2ViewControllerTouch *viewController; viewController = [[[GTMOAuth2ViewControllerTouch alloc] initWithScope:@<span class="hljs-string"><span class="hljs-string">"https://www.googleapis.com/auth/userinfo#email"</span></span> clientID:<span class="hljs-meta"><span class="hljs-meta">@OAUTH_GOOGLE_CLIENT_ID</span></span> clientSecret:<span class="hljs-meta"><span class="hljs-meta">@OAUTH_GOOGLE_CLIENT_SECRET</span></span> keychainItemName:@<span class="hljs-string"><span class="hljs-string">"OAuth2 MYAPP: Google"</span></span> delegate:self finishedSelector:<span class="hljs-meta"><span class="hljs-meta">@selector(viewController:finishedWithAuth:error:)</span></span>] autorelease ]; [[self navigationController] pushViewController:viewController animated:YES]; }</code> </pre> <br>  This will open the ViewController with a browser and a standard web authentication request from Google.  After the user passes the email and password entry procedure, the following function is called, where you can already receive a confirmed email from the logged in user and respond to the fact of a successful login: <br><br><pre> <code class="hljs lua">- (void)viewController:(GTMOAuth2ViewControllerTouch *)viewController finishedWithAuth:(GTMOAuth2Authentication *)auth <span class="hljs-built_in"><span class="hljs-built_in">error</span></span>:(NSError *)<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">error</span></span> != <span class="hljs-literal"><span class="hljs-literal">nil</span></span>) { // Authentication failed } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (auth.canAuthorize){ // auth.userEmail } } }</code> </pre><br>  In our task this was enough, but the Google API is not limited to this, and through different scope you can request rights to work with many Google services.  Including youtube and buzz. <br><br><h2>  Facebook </h2><br>  Facebook is a bit more complicated.  First, as usual, you need to register your ‚Äúapplication‚Äù <a href="https://www.facebook.com/developers/apps.php">here</a> , if, of course, you have not done this before. <br><br>  Next, install the facebook-ios-sdk project, add the implementation of the FBSessionDelegate and FBRequestDelegate protocols to the delegate of your application class. <br><br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"FBConnect.h"</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> AppDelegate : NSObject &lt;UIApplicationDelegate, FBSessionDelegate, FBRequestDelegate&gt; { UIWindow *window; .... Facebook* facebook; } .... - (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url; - (void)fbDidLogin; - (void)request:(FBRequest *)request didLoad:(id)result; &lt;/pre&gt;&lt;/code&gt;      : &lt;code&gt;&lt;pre&gt; - (void)facebookLogin { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!facebook) facebook = [[Facebook alloc] initWithAppId:<span class="hljs-meta"><span class="hljs-meta">@FACEBOOK_APP_ID</span></span>]; [facebook authorize:nil delegate:self]; } - (BOOL)application:(UIApplication *)application handleOpenURL:(NSURL *)url { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> [facebook handleOpenURL:url]; } - (void)fbDidLogin { [facebook requestWithGraphPath:@<span class="hljs-string"><span class="hljs-string">"me"</span></span> andDelegate:self]; } - (void)request:(FBRequest *)request didLoad:(id)result { <span class="hljs-comment"><span class="hljs-comment">// result - NSDictionary };</span></span></code> </pre><br><br>  Visually, it looks like a way out of the application, opening a separate Safari process, a web login and confirmation form from Facebook, closing the browser and reopening the application with an already logged in user.  Indeed, the browser is executed as a separate process from the application.  But how does the application intercept the return from the browser?  Casket opens relatively simple.  In the info.plist of your application, we register the type of URL that intercepts your application, after which Safari becomes ‚Äúin the know‚Äù where to transfer control.  We do this from Xcode as follows (instead of YOUAPPID, we write our application ID on Facebook): <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/0d7/0c7/850/0d70c7850ffa518e1a9716ac66aeaa6b.png" alt="Editing info.plist to handle external URLs"></div><br><br>  Voila, it remains in the request didLoad function to make a reaction to the user's Facebook input, and the trick is done. <br><br>  Facebook request of rights, storage of session keys in KeyChains, and other goodies are described in detail in the documentation.  For our purposes (simple authentication), the above described was enough, but the API capabilities are quite wide there.  Up to "post a photo on the wall" and "send a message to a friend on xmpp in the end." <br><br><h2>  Friday the 13th </h2><br>  No, we are not a maniac in a hockey mask and with a huge cleaver.  It will be a question of a small fly in the ointment, which was expressed in the fact that everyone, for some reason, consider it their duty to shove into their ‚Äúlibrary‚Äù of two classes, ELSE one JSON implementation.  Citizens, when will it stop?  Moreover, both Google and Facebook use the same implementation.  Namely SBJSON, with different versions and incompatible interfaces.  A simple file, of course, solves the problem, but, I'm afraid, because of the lack of a regular Apple implementation, iOS is time for developers to come up with a new term Json-Hell. <br><br>  Keep the JSON implementation in the project (as well as zlib, and other stuff) in a single copy, and may the force be with you. </div><p>Source: <a href="https://habr.com/ru/post/126258/">https://habr.com/ru/post/126258/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../126247/index.html">Antipattern presentation of itself ‚ÄúMBA interested in friends‚Äù</a></li>
<li><a href="../126248/index.html">Using semantic annotation to identify requirements</a></li>
<li><a href="../126250/index.html">Practice interviewing or how I moved to the capital</a></li>
<li><a href="../126251/index.html">Work with WebMoney API</a></li>
<li><a href="../126255/index.html">Watchman syndrome</a></li>
<li><a href="../126260/index.html">Tenacious programs</a></li>
<li><a href="../126261/index.html">Video Tour to the Data Center: Heat Recovery</a></li>
<li><a href="../126262/index.html">Library to simplify HTTP requests</a></li>
<li><a href="../126265/index.html">Euclideon responds to Unlimited Detail criticism, shows a new demo and answers questions in a 40-minute interview</a></li>
<li><a href="../126266/index.html">Silicon Cocktail</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>