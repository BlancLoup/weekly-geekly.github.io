<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Speech analytics for call centers based on SOLR</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I want to talk about our experience in developing applications based on the Apache Solr full-text search platform. 

 Our task was to develop a speech...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Speech analytics for call centers based on SOLR</h1><div class="post__text post__text-html js-mediator-article">  I want to talk about our experience in developing applications based on the Apache Solr full-text search platform. <br><br>  Our task was to develop a speech analytics system for contact centers.  The system is based on two basic technologies: speech recognition and indexed search.  For recognition, we used our engines, and for indexing and searching we chose Solr. <br><br>  Why choose Solr?  We did not conduct our own comparative studies of indexed search engines, but carefully read the <a href="https://www.google.ru/search%3Fq%3D%25D1%2581%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5%2BSolr%2B%25D1%2581%2BElasticsearch%26oq%3D%25D1%2581%25D1%2580%25D0%25B0%25D0%25B2%25D0%25BD%25D0%25B5%25D0%25BD%25D0%25B8%25D0%25B5%2BSolr%2B%25D1%2581%2B%2BElasticsearch%26aqs%3Dchrome..69i57.6796j0j7%26sourceid%3Dchrome%26ie%3DUTF-8">opinions of our colleagues</a> .  Of course, the choice could take place in favor of Elasticsearch or Sphinx, but, apparently, the stars in our project were in favor of Solr, and we ‚Äúsawed‚Äù him.  Already in the course of the project, we determined that the settings available in Solr are sufficient for configuring for our tasks. <br><a name="habracut"></a><br><h3>  Features of our project </h3><br>  The system was developed for analyzing customer calls, which are recorded in the contact center to monitor the quality of service.  It is not the sound that is analyzed, but the text obtained as a result of automatic recognition of the dialogue.  The texts of recognized speech are fundamentally different from the texts that we regularly encounter on websites or e-mail.  Even with 100% recognition accuracy, the texts of recognized spontaneous speech may seem to be devoid of any meaning. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      This is due to two main factors.  First, nonverbal and mimic means are often used in oral speech, which are not recognized in the text, but are important for understanding what has been said.  Secondly, in speech, abbreviations and omissions of language structures are constantly used, which can be restored from the context of a communicative situation.  This phenomenon in linguistics is called ellipsis. <br><br>  To see with your own eyes the text of a recognized speech with all its features, look at the automatic subtitles for the video on youtube with the sound turned off.  That's about the content of this material is fed to the input of speech analytics. <br><br><h3>  Complex queries </h3><br>  Although Solr supports standard <a href="http://lucene.apache.org/solr/guide/6_6/the-standard-query-parser.html">conditional operators</a> and <a href="http://lucene.apache.org/solr/guide/6_6/the-standard-query-parser.html">groupings</a> , often these capabilities are not enough to implement all the analytics work scenarios. <br><br>  Often, the analyst needs to build a query with parameters that are not part of the Solr index.  For example, find all the words ‚Äúthank you‚Äù that are spoken in the last 30 seconds of the conversation.  Words are indexed by Solr, but temporary positions are not words.  We call such queries ‚Äúcomplex‚Äù - queries that include both the parameters of the Solr index and any other data selection parameters that are not included in the Solr index. <br><br><h3>  How does the analyst form queries? </h3><br>  The analyst has no idea about the composition of the Solr index, it is important for him to search and cut across all the attributes of the phonograms of calls and their text transcripts.  Therefore, the concept of ‚Äúcomplex query‚Äù for the analyst is purely pragmatic: there are queries in which there are many selection parameters, or queries are arranged in a hierarchy. <br><br>  Describing the actions of the analyst in the language of set theory, it can be said that with the help of queries, the analyst explores the relationship between various subsets: intersections, differences, and additions.  Using hierarchical queries, the analyst parses the data array to the required level of detail of its structure. <br><br><img src="https://habrastorage.org/webt/9r/ts/cy/9rtscyivdzpyd30v4i3yomz2bt4.png"><br>  <i>Figure 1. Hierarchical queries</i> <br><br>  Figure 2 shows a classic example of a complex query that contains both textual and numerical selection criteria. <br><br><img src="https://habrastorage.org/webt/e1/_o/_x/e1_o_xjd89bemvnaot6i4av9wly.png"><br>  <i>Figure 2. A complex query containing quantitative and lexical parameters for selecting data</i> <br><br><h3>  What are the queries for Solr? </h3><br>  Consider the general mechanism for executing a query in Solr using the example of query <b>B</b> in Figure 1. As we can see, query <b>B</b> has a parent query <b>A</b> , in other words, <b>B‚äÜA</b> .  In speech analytics, a request cannot be executed until at least one of his ‚Äúparents‚Äù is unfulfilled.  Thus, the query <b>A</b> is executed first and then <b>B.</b>  Obviously, <b>B</b> must contain the terms of query <b>A.</b> <br><br>  The first thing that comes to mind is to combine the conditions of both queries through <code>AND</code> and insert in the <code>query</code> : <br><br> <code>q=key:A AND key:B</code> <br> <br>  However, if we simply combine all consecutive queries into one <code>query</code> , it will be large, for each query it will be different and will be calculated entirely.  Also, conditions <b>A</b> will affect the relevance of the results of query <b>B</b> , which we would not want. <br><br>  Let's try adding parent queries like <code>FilterQuery</code> .  In this case, query <b>A</b> will not be affected by irrelevance, and we can expect that it has already been completed and its results are in the cache.  Thus, Solr will have to calculate only query <b>B</b> , while Solr will sort the resulting sample in the necessary way: <br><br> <code>q=keyword:B &amp;fq=keyword:A</code> <br> <br>  If we look at the format of the request to Solr schematically, then we can distinguish two main entities: <br><br><ol><li>  <code>MainQuery</code> - the main query with a set of parameters that must be satisfied by the desired document.  For example, a request to search for polite operators would look like this: <code>text_operator: ‚Äù ‚Äù</code> . <br>  This means that the text_operator field of the document being searched for must contain the phrase <code>‚Äú ‚Äù</code> <br></li><li>  <code>FilterQuery</code> is a set of additional filters that limit the resulting selection.  <code>FilterQuery</code> format matches <code>MainQuery</code> <br></li></ol><br>  Separating the request into <code>Main</code> and <code>Filter</code> allows you to: <br><br><ol><li>  Explicitly indicate which query parameters should affect the rank of the document in the sample, and which serve only for selection in the resulting sample.  The relevance for building the rank of the documents is calculated when the part of the query is executed MainQuery, and when the part of the query is <code>FilterQuery</code> out the documents that do not satisfy the conditions of the query </li><li>  significantly reduce the load on the search engine, since the resulting sample obtained after the <code>FilterQuery</code> calculations is completely cached, whereas the results of the <code>MainQuery</code> calculation are stored in the cache only for the first 50 values ‚Äã‚Äãin the rank </li></ol><br>  <code>MainQuery</code> and <code>FiletrQuery</code> affect Solr functions in different ways.  For example, for <a href="http://lucene.apache.org/solr/guide/6_6/highlighting.html">highlighting</a> ‚Äî the function responsible for highlighting relevant fragments of a document ‚Äî only <code>MainQuery</code> , and the <code>FilterQuery</code> parameters <code>FilterQuery</code> not affect <code>highlighting</code> .  This is logical, since relevance is calculated precisely in the part of the <code>MainQuery</code> query.  Here is the result of <code>highlighting</code> in a real text search query with the words ‚Äúhello‚Äù and ‚Äúservices‚Äù. <br><br><img src="https://habrastorage.org/webt/95/h5/py/95h5py4psgllol-p6tqa3vkhkhc.png"><br>  <i>Figure 3. <code>highlighting</code> for relevant words after executing a <code>MainQuery</code> query.</i> <i><br></i> <br><h3>  Complicated requests to Solr </h3><br>  Let's return to the example of a polite operator.  In this example, we identified suitable calls based on the presence of the phrase ‚Äúgood afternoon‚Äù in the operator's speech, but did not specify the time period in which you need to search for keywords relative to the beginning or end of the conversation. <br><br>  It seems that for this there is everything you need - the text decoding of the telephone conversation contains a timestamp timestamp for each word, as well as information about which of the participants in the dialogue it belongs to.  This data can also be used when searching. <br><br><img src="https://habrastorage.org/webt/tw/wp/sh/twwpsh4y4ahynhwptbjkycefpwa.png"><br>  <i>Figure 4. Fragment of textual interpretation with markup, not included in the Solr index: belonging to the speaker, time stamps.</i> <br><br>  But how to process a search query to Solr, if non-indexable parameters participate in the query - the time the word is pronounced? <br><br>  This suggests two obvious ways to solve this problem: <br><br><ol><li>  add non-indexed parameters to the Solr index.  At the same time, memory consumption will increase slightly, but significantly weighted index </li><li>  the selection of data on non-indexable parameters is carried out with the help of your service, and in the collection of documents obtained after such selection, you can search using the Solr index.  In this case, the memory consumption will be much more than in the first case, but the performance will be predictable </li></ol><br>  We have chosen the second option.  To do this, we have developed a service that performs the calculation of collections for queries containing any logical and numeric parameters that are not part of the Solr index.  As a result of this service, a part of the collection that did not satisfy the request was marked with a special tag (‚Äúscreened‚Äù) and then did not participate in the calculation of the query results. <br><br>  Imagine that we want to impose on the already familiar to us query <b>B</b> restriction on the search only in the first 30 seconds of the dialogue.  At the first stage, we execute <b>B</b> as a simple query, then ‚Äúscreen‚Äù words that go beyond the selected range so that they do not fall into the Solr index, but at the same time, we can recover the original document from them.  The resulting documents are placed in a separate Solr collection, and the search for query <b>B is</b> restarted on it. <br><br>  Here it must be said that the restrictions on the beginning or end of a conversation are flowers, berries are restrictions on the results of the parent request.  Consider the execution of a similar request. <br><table><tbody><tr><td>  Imagine that our documents consist of balls with numbers.  Let's try to find all the balls ‚Äú6‚Äù that are not more than two balls to the right of ‚Äú5‚Äù. <br>  You have already understood that the numbers of the balls are included in the Solr index, but the distance between the balls is not. <br></td><td width="220"><img src="https://habrastorage.org/webt/vg/qk/b9/vgqkb9zlunaa4_uqh25u3qhdzio.png"></td></tr><tr><td>  Find all documents with balls ‚Äú6‚Äù and ‚Äú5‚Äù.  As the <code>MainQuery</code> , <code>MainQuery</code> use the query for balls ‚Äú5‚Äù, and the query for ‚Äú6‚Äù will be <code>FilterQuery</code> to <code>FilterQuery</code> .  As a result, Solr will highlight the balls ‚Äú5‚Äù in the search results, which will greatly simplify our lives in the next step. </td><td><img src="https://habrastorage.org/webt/vg/yu/d1/vgyud1tpttqcanutybl81rccj40.png"></td></tr><tr><td>  We screen all the balls except those that are at the desired distance from the ‚Äú5‚Äù.  The received documents (documents with the required balls) will be placed in a separate collection. </td><td><img src="https://habrastorage.org/webt/s3/z3/ug/s3z3ugwju6mnzxphfsfaavgrkic.png"></td></tr><tr><td>  Let's execute <code>FilterQuery</code> by balls ‚Äú6‚Äù in the resulting collection, the result is the documents we are <code>FilterQuery</code> for. </td><td><img src="https://habrastorage.org/webt/ie/nr/de/ienrdekwhhbhjfvrw8jkhg8awna.png"></td></tr></tbody></table><br>  In practice, behind balls 5 and 6, requests that occupy several screens in their textual representation are usually hidden.  I am glad that we have implemented such a search for good reason - analysts often use queries with restrictions from the parent. <br><br><h3>  Conclusion </h3><br>  What did we learn, what did we learn and what did we achieve as a result of the project? <br><br>  We know how to effectively use Solr to work with data of different types, we can ‚Äúteach‚Äù Solr to process queries with parameters that are not included in its search index. <br><br>  We have developed a high-load industrial speech analytics system: complex analytics search queries are calculated for samples of up to five million text documents.  It is possible and more, but there was no practical need.  The usual working sample of the analyst is approximately up to 500 thousand texts of recognized telephone calls, and the total number of calls can reach 15 million. <br><br>  For our clients in contact centers, the system provides unprecedented opportunities for analytics of a very different nature: analysis of topics and reasons for calls, analysis of customer satisfaction, and many others. <br><br>  Now we are connecting to our analytics new sources - text chat clients with operators.  We are implementing a single application for analyzing client requests through all channels of the contact center: telephone, chat, forms on websites, etc. <br><br>  We are pleased to answer your questions. <br><br>  Thank. <br><br>  PS Solr is a very difficult thing and requires good setup to get good results.  We will tell about our experience in this field in the following articles. </div><p>Source: <a href="https://habr.com/ru/post/429590/">https://habr.com/ru/post/429590/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../429580/index.html">Microinteractions in iOS. Yandex lecture</a></li>
<li><a href="../429582/index.html">Analog indicator of computer load</a></li>
<li><a href="../429584/index.html">Yandex launched a rating of Russian sites: the audience is calculated by a mathematical model on machine learning</a></li>
<li><a href="../429586/index.html">How to determine the best time for a transaction on the exchange</a></li>
<li><a href="../429588/index.html">The whole truth about the RTOS. Article # 20. Semaphores: helper services and data structures</a></li>
<li><a href="../429592/index.html">How bank cards affect the economy and why the cue ball does not soar</a></li>
<li><a href="../429594/index.html">Analysis of the speed of molecular micromotors for HIV diagnosis</a></li>
<li><a href="../429596/index.html">What does Java need to do to fully support machine learning</a></li>
<li><a href="../429598/index.html">RFID UHF inventory. How to find all tags?</a></li>
<li><a href="../429600/index.html">Glitter and poverty 1C for an online store. Gold glitter for franchisees and functional poverty for the user</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>