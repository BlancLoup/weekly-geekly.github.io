<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Portable prism</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Dedicated to fans of the Microsoft Patterns & Practices group and just to fans of such a useful thing as Microsoft PRISM . 

 Developers who, in their...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Portable prism</h1><div class="post__text post__text-html js-mediator-article">  Dedicated to fans <a href="http://pnp.azurewebsites.net/en-us/">of the Microsoft Patterns &amp; Practices group</a> and just to fans of such a useful thing as <a href="http://compositewpf.codeplex.com/">Microsoft PRISM</a> . <br><br>  Developers who, in their practice, met with Microsoft PRISM, probably have a mixed opinion about this framework.  On the one hand, in its number 4, and in order of the 3rd, the version is a very powerful and flexible tool for creating composite applications, and on the other hand, a rather incomprehensible and confusing library.  But you can take a look at PRISM and simply as an implementation of the MVVM pattern, which is what PRISM for Windows Phone is. <br><a name="habracut"></a><br>  I really like this MVVM implementation and when I met the Portable Class Library, I realized that I needed a portable PRISM.  Fortunately, PRISM source code is available and it was not a very difficult task to convert it to a Portable Library. <br><br><h4>  Porting </h4><br>  The task itself was to bring everything in common to the portable part and everything else to the platform-specific.  But, besides the fact that I like PRISM, I still like to use it with MEF, and <a href="http://mef.codeplex.com/">MEF</a> just with the advent of PCL2.0 appeared for WinRT in the form of <a href="http://nuget.org/packages/Microsoft.Composition/">Microsoft.Composition</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      <i>By the way, who does not know, Microsoft.Composition is built on PCL and, if desired, it can be built for PCL and used on Windows Phone 8 or directly in a portable library.</i>  <i>It is true that I didn‚Äôt find the latest version of the source code for which the NuGet Microsoft.Composition package was built, on <a href="http://mef.codeplex.com/SourceControl/list/changesets">the project site on Codeplex</a> .</i> <br><br>  So the MEF extensions for PRISM for WinRT had to be thoroughly modified so that PRISM could work with Microsoft.Composition.  However, the majority of unit tests were left behind by making small changes. <br><br><h4>  Abstraction and Fody </h4><br>  Who fundamentally understood how PRISM works knows that there are composite events that require Dispatcher, but it‚Äôs different on different platforms.  In addition, the version for .NET used the <a href="http://msdn.microsoft.com/en-us/library/system.weakreference.aspx">WeakReference</a> type, which is not available on some platforms.  And I would not like to force someone who will use Portable PRISM every time to write some kind of initialization code that would implement these dependencies. <br><br>  And then I learned that each .NET assembly has an initializer - in fact a static constructor that runs once when the assembly is loaded into the application, but you can‚Äôt just write it ... And then the great tool of the Australian Simon Cropp came to my rescue, <a href="http://visualstudiogallery.msdn.microsoft.com/074a2a26-d034-46f1-8fe1-0da97265eb7a">Fody</a> . <br><br>  <i>This project was born from the extension project for Visual Studio <a href="http://visualstudiogallery.msdn.microsoft.com/bd351303-db8c-4771-9b22-5e51524fccd3">Notify Property Weaver</a> , which allowed, using Mono.Cecil after construction, to rewrite the properties of classes that were inherited from INotifyPropertyChanged so that they themselves would trigger a property change event when its value changes.</i> <br><br>  <a href="http://visualstudiogallery.msdn.microsoft.com/074a2a26-d034-46f1-8fe1-0da97265eb7a">Fody has</a> become a more universal extension of <a href="http://visualstudiogallery.msdn.microsoft.com/bd351303-db8c-4771-9b22-5e51524fccd3">Notify Property Weaver</a> , to which you can connect different plug-ins that will overwrite a specific part of the assembly.  For <a href="http://visualstudiogallery.msdn.microsoft.com/074a2a26-d034-46f1-8fe1-0da97265eb7a">Fody</a> , many <a href="http://nuget.org/packages%3Fq%3Dfody">useful modules</a> have already been <a href="https://github.com/Fody">written</a> that can be put through NuGet into a specific project.  One of these plugins is <a href="http://nuget.org/packages/ModuleInit.Fody/">ModuleInit.Fody</a> , which can write a call to the Initialize method of the static class ModuleInitializer in the assembly initializer. <br><br><pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">internal</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">ModuleInitializer</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Initialize</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { InitializeCompositePresentationEvent(); InitializeWeakEventHandlerManager(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeCompositePresentationEvent</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> dispatcher = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Lazy&lt;IDispatcherFacade&gt;(() =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> DefaultDispatcher()); EventBase.InitializeDispatcher(dispatcher); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">InitializeWeakEventHandlerManager</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { EventHandlerManager.Current = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> WeakEventHandlerManager(); } }</code> </pre> <br>  Than I safely and took advantage. <br><br>  <i>Funny, but <a href="https://connect.microsoft.com/VisualStudio/feedback/details/775602/wp7-1-1-module-initializers-are-not-executed-for-assemblies">ModuleInitalizers don't work on Windows Phone 7</a> .</i>  <i>And the impression that no one is going to fix this bug.</i>  <i>Well now, at least <a href="https://connect.microsoft.com/VisualStudio/feedback/details/722944/windows-phone-static-constructor-is-not-executed-for-class-in-separate-assembly">static constructors work in plug-in assemblies</a> .</i> <br><br><h4>  Port Features </h4><br>  <b>Winrt</b> <br>  The version for WinRT does not include <a href="http://msdn.microsoft.com/en-us/library/ff921098(v%3Dpandp.40).aspx">regions</a> .  I didn‚Äôt need them, but writing an adapter for Frame is not possible, so I decided not to transfer this functionality.  Nevertheless, the source code in the project is.  So, suddenly someone needs to add them, you can do it. <br><br>  <b>Windows Phone 8</b> <br>  In PRISM for Windows Phone 8, I generally copied the PRISM functionality for Windows Phone 7 by adding only WeakEvent, since it is now available in the Windows Phone SDK 8.0 and removed the classes related to AppBar since they are implemented there extremely crookedly.  I think it's much better to use the <a href="http://cimbalino.org/">Cimbalino</a> library to work with <a href="http://cimbalino.org/">AppBar</a> . <br><br><h4>  What is available now? </h4><br>  And so what are the NuGet packages there are: <br><ul><li>  <a href="https://nuget.org/packages/PortablePrism.Portable/">Portable PRISM - Portable</a> </li><li>  <a href="https://nuget.org/packages/PortablePrism.Portable.Interactivity/">Portable PRISM - Portable - Interactivity</a> </li><li>  <a href="https://nuget.org/packages/PortablePrism.WinRT/">Portable PRISM - WinRT</a> </li><li>  <a href="https://nuget.org/packages/PortablePrism.WinRT.MEF/">Portable PRISM - WinRT MEF extensions</a> </li><li>  <a href="https://nuget.org/packages/PortablePrism.WP8/">Portable PRISM - Windows Phone 8</a> </li><li>  <a href="https://nuget.org/packages/PortablePrism.WP8.Interactivity/">Portable PRISM - Windows Phone 8 - Interactivity</a> </li></ul><br><br><h4>  What's next? </h4><br>  I hope that my packages will be useful to those who like PRISM or who want to implement something using PRISM to a new platform. <br><br>  If someone needs other parts of PRISM in the form of a portable version, for example, extensions for Unity for WinRT, you can clone <a href="https://github.com/xperiandri/PortablePrism">the Portable PRISM project on GitHub</a> and add them.  If you can not build a project, write.  I have not figured out how to configure .gitignore so that information about NuGet packages is committed, but the packages themselves are not, and they can be downloaded again.  So, who knows how to do it, tell me, please. </div><p>Source: <a href="https://habr.com/ru/post/169471/">https://habr.com/ru/post/169471/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../169457/index.html">Kickstarter in your pocket. With love!</a></li>
<li><a href="../169461/index.html">Manga "Entertaining statistics", "The Mystery of Disasters" and other similar books</a></li>
<li><a href="../169463/index.html">Configure IPSec VPN server through strongSwan and On-Demand on iOS</a></li>
<li><a href="../169467/index.html">Android Application Development with C #</a></li>
<li><a href="../169469/index.html">Perl recurrence calculation</a></li>
<li><a href="../169481/index.html">In iOS 6.1, password bypass is possible</a></li>
<li><a href="../169483/index.html">Digital equipment sales statistics in Russia</a></li>
<li><a href="../169485/index.html">Review of the antique computer company NEXT</a></li>
<li><a href="../169487/index.html">The hierarchy of design principles, or the most important words for engineers</a></li>
<li><a href="../169489/index.html">The Start-Up Visa Program is a new emigration program to Canada for startups and research participants.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>