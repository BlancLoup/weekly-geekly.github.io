<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>AJAX Client Storage Study - From Dojo Surgery to Fullajax Storage's own implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="With the intensive development of web applications, storing large amounts of data on the client side is becoming increasingly popular. This does not j...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>AJAX Client Storage Study - From Dojo Surgery to Fullajax Storage's own implementation</h1><div class="post__text post__text-html js-mediator-article">  With the intensive development of web applications, storing large amounts of data on the client side is becoming increasingly popular.  This does not just simplify the application ‚Äî often by using client data storage, you can significantly extend the functionality of the application being created, allowing it to do something that otherwise would not be possible. <br><a name="habracut"></a><br>  At the same time, it should not be taken as a ‚Äúwhim‚Äù of developers of some special and exotic web services - according to the latest data, even such a grandeur among the mass Western social services, like the MySpace network, will apply the solution from Google - Google Gears (more details - <a href="http://gearsblog.blogspot.com/2008/05/myspace-message-center-is-now-searching.html">gearsblog. blogspot.com/2008/05/myspace-message-center-is-now-searching.html</a> ).  The network has a number of publications on the use of local repositories, for example, the following publications that we studied in preparing the material can be noted: <br><br>  <a href="http://browserpersistence.ru/">browserpersistence.ru</a> <br>  <a href="http://abrdev.com/%3Ftag%3Dstorage">abrdev.com/?tag=storage</a> <br>  <a href="http://pablotron.org/software/persist-js/">pablotron.org/software/persist-js</a> <br><br>  If you do not have a clue what a local repository is, or you are not very familiar with this, you will find comprehensive information on storages and its areas of application using the links above. <br>  Having explored all possible options for implementing local data warehouses, the most attractive at this time is Flash-based storage.  Notice that we are talking about persistent data storages, that is, saving any data there, we expect to be able to access it on the client computer after the page is closed in the browser, and updated, and even after the computer is restarted.  This article will analyze the implementation of Flash-based storage. <br>  Let's look at the clear advantages of Flash Storage: <br><ul><li>  Maximum cross-browser (for obvious reasons, we do not consider exotic versions of browsers that do not support the usual web technologies). </li><li>  Maximum prevalence: Flash installed on more than ~ 95% of browsers. </li><li>  The ability to store a virtually unlimited amount of data (although with some reservations, for example, that the user must explicitly allow storage of the specified volume or establish permission to store an unlimited amount of information). </li></ul><br>  Some developers tend to attribute the disadvantage to this method that users allegedly block Flash because of banners, but I think this problem is more contrived.  If so, then they will turn off the graphics, and the scripts - which means, as they say in one maxim, ‚ÄúBuratino themselves‚Äù - Flash is now often an integral part of many sites and the only acceptable technology for implementing multimedia in the web environment. <br>  It should be noted that among all the Flash storages analyzed by us, the most attractive in terms of functionality turned out to be the stack that is included in the Dojo library (dojotoolkit.org).  Moreover, by and large, this is the first industrial implementation of this technology. <br>  Distinctive advantages: <br><ul><li>  Ability to store JS-objects, automatic serialization and deserialization (of course, in JSON format). </li><li>  Some bugs of the Flash ExternalInterface operation are taken into account. </li><li>  Powerful and versatile data warehouse API. </li><li>  Built-in support for the namespace for stored data, work with multiple repositories simultaneously. </li><li>  PENDING status. </li><li>  When the current storage size limit is exceeded - automatic display of the permission request dialog to increase the size. </li></ul><br><img src="https://habrastorage.org/getpro/habr/olpictures/364/03f/718/36403f718b1f28b09cfe67adc707b4f6.png" width="218" height="141" alt="permission dialog to increase size" hspace="10" vspace="10">
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Of course, this solution, for all its merits, is not without flaws: <br><ul><li>  Large distribution volume (meaning that if you use Dojo only for the sake of the Storage system). </li><li>  When initializing the repository, download extra code that may not be necessary when the application is running. </li><li>  Crash when running a script from file: // local file system </li></ul><br>  Test example <a href="http://download.dojotoolkit.org/release-1.1.0/dojo-release-1.1.0/dojox/storage/tests/test_storage.html%3FforceStorageProvider%3Ddojox.storage.FlashStorageProvider">download.dojotoolkit.org/release-1.1.0/dojo-release-1.1.0/dojox/storage/tests/test_storage.html?forceStorageProvider=dojox.storage.FlashStorageProvider</a> loads 13 (!) Scripts.  All of them are loaded using AJAX, and even with explicit instructions to use Flash Storage, a bunch of additional files are still being loaded that are not needed for this storage to work. <br><br>  The simplest example of helloworld is <a href="http://download.dojotoolkit.org/release-1.1.0/dojo-release-1.1.0/dojox/storage/demos/helloworld.html">download.dojotoolkit.org/release-1.1.0/dojo-release-1.1.0/dojox/storage/demos/helloworld.html</a> loads at least a few JS scripts.  Therefore, we can conclude that if your application does not use any Dojo Toolkit functionality, using it for implementation only of Storage is rather resource-intensive and inefficient. <br><br>  Since the ‚Äúroot of the shortcomings‚Äù is the same, we decided to get rid of these shortcomings, or at least minimize their influence.  After downloading the Dojo 1.1 distribution, I had to sit down to analyze its architecture in order to isolate Flash Storage only.  This is where the first difficulty turned out to be.  Subjectively, Dojo's internal architecture is very nontrivial and complex (well, of course, because this is the most powerful framework from all, probably implemented in JS, using several programming paradigms, for example, recently added a module to implement aspect-oriented programming).  Therefore, it was not possible to quickly and easily separate Flash Storage.  But the desire to eliminate these shortcomings turned out to be more of the difficulties encountered. <br><br>  The first stage of work took several hours of work, and this version (without changing the internal architecture of the code) weighed more than 100 KB (the Dojo core + the Storage module).  Having made an in-depth analysis, we realized that there was still a lot of excess left.  The second stage, in order to shrink this super-minimized version even more, took several days and this implementation takes only 15 Kb, which was at the cost of a huge number of edits to the Dojo Toolkit source code. <br><br>  Even more detailed tests of Flash Storage showed another advantage: the storage is the same for all browsers on a computer, i.e.  The data saved using Firefox is easily obtained from Internet Explorer and vice versa. <br><br>  An additional flaw was also identified: it is necessary to wait for Flash Storage to initialize.  That is, the use of storage is possible only in asynchronous mode, after the flash movie is loaded.  Accordingly, web applications using Flash Storage need to be designed with this feature in mind. <br><br>  But the ability to simply store some data on the client and get it for the application to work is not the only functionality.  I would very much like to be able to control the data in such a cache and automatically update it from the server. <br><br>  When using local storage, a very important point is the implementation of the data update algorithm on the client side.  We offer you three different options for implementation. <br><br>  <b>Global versioning site method</b> <br><br>  The algorithm of this method is similar to the implementation of SVN.  The site has a global version number.  Any changes to individual content or a group change of content increases the version number.  When the site is initially loaded, the version number on the client side is sent to the server.  The server checks the sent version on the client with the current version on the server and, if there are differences, the list of changed content identifiers-keys is generated in response to the difference between the client and server versions of the site.  In other words, when content changes on the server, a list of content keys is sent to the client, which must be deleted in the repository.  This list corresponds to the difference in changes between the client site version and the current version on the server.  At the same time, the content itself is not sent to the client.  Content is sent only when the client side requests specific data and, upon successful loading, enters the repository. <br><img src="https://habrastorage.org/getpro/habr/olpictures/61d/6bc/000/61d6bc0000dabdaec81df072902e67a3.jpg" width="450" height="601" alt="Global versioning site method" hspace="10" vspace="10"><br>  The original image of the algorithm <a href="">fullajax.ru/doc/storage/Storage-Algorithm-1.jpg</a> <br><br>  The considered algorithm reduces the number of connections to the server and the total amount of information transmitted.  This method is convenient to use with a large number of content units. <br><br>  <b>The method of versioning individual content units</b> <br><br>  The algorithm is based on identifying the uniqueness of each individual content item specifically.  The bottom line is that during the initial loading of the site, a list of value pairs {key: novelty identifier} comes from the server.  The client script checks the coincidence of the identifiers of novelty in the repository.  If there are differences, the old values ‚Äã‚Äãof the novelty identifiers and the data corresponding to the updated content key are deleted from the storage.  Immediately in the repository recorded new values ‚Äã‚Äãof identifiers of novelty.  As in the previously discussed method, the content is sent to the client only when the client side requests specific data and, with a successful download, enters the repository. <br><img src="https://habrastorage.org/getpro/habr/olpictures/5f2/0de/256/5f20de2560c6dd6c224ac7dded36cd76.png" width="450" height="601" alt="The method of versioning individual content units" hspace="10" vspace="10"><br>  The original image of the algorithm <a href="">fullajax.ru/doc/storage/Storage-Algorithm-2.png</a> <br><br>  The considered algorithm reduces the number of connections to the server and the total amount of information transmitted.  This algorithm is simple to implement and its use is effective with a small amount of content units.  With a large number of content units, the list of value pairs {key: novelty identifier} may be too large, which reduces the effectiveness of this algorithm. <br><br>  <b>Standard Method for Using Etag</b> <br><br>  The method is based on sending the content identifier to the Etag server.  If the sent identifier on the client matches the current server identifier, the server responds with a response of <b>304 Not modified</b> and the client takes data from the storage.  When identifiers are different, the server responds with new content.  The client has successfully uploaded the new content, replaces the old data in the storage with new ones and writes its etag with the novelty identifier. <br><br>  The considered algorithm reduces only the total amount of information transmitted.  The method is simple to implement, but in terms of the number of connections to the server, it is less efficient than the previously discussed algorithms. <br><br>  The choice of using one approach or another depends on the specific situation. <br><br>  <b>Application examples</b> <br><br>  Using Flash Storage is convenient not only for storing configuration data and web application objects, but also for storing scripts, styles, images, and even the content itself.  An example of the use of storage is implemented on the site <a href="http://fullajax.ru/">fullajax.ru</a> already known to you.  On this site, for the update of data on the client side, the aforementioned <b>‚ÄúMethod of Versioning Separate Content‚Äù has been applied</b> .  Scripts and content are saved in the storage, i.e.  once having downloaded the page of this site, the subsequent times it gets from the repository until a newer version of the page appears on the server. <br><br>  AJAX + Storage is particularly effective.  The Fullajax library includes a module for implementing Flash Storage.  For those users who already use the Fullajax library, it is enough to connect an additional script and when requesting data using AJAX (dax or hax methods), the data will automatically get into the repository.  It only remains to take care of the mechanism for updating data on the client side. <br><br>  Of course, this implementation is not the only one.  And in many cases, it will be very lacking of certain functionalities.  I will not hide - indeed the best option now will be the built-in database from Google Gears, but this solution is quite exclusive and can be effectively used only in special cases of web applications.  Well, for mass use, including on ordinary websites, it is really best to use either the solution described above or one of the universal ones, for example, Browserpersistense or PersistJS. <br><br>  The author of the material: Ruslan Sinitsky (sirus, <a href="http://fullajax.ru/">fullajax.ru</a> ), co-author - Alexander Lozovyuk (aleks_raiden, <a href="http://abrdev.com/">abrdev.com</a> ). </div><p>Source: <a href="https://habr.com/ru/post/26784/">https://habr.com/ru/post/26784/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../26783/index.html">Do you need employee exchange service?</a></li>
<li><a href="../267831/index.html">About the features of geolocation technology in MDK</a></li>
<li><a href="../267833/index.html">Audit of system events in Linux</a></li>
<li><a href="../267837/index.html">Todoist transition to Material Design</a></li>
<li><a href="../267839/index.html">Ready assembly of the news portal NewsModxBox</a></li>
<li><a href="../267841/index.html">Deploying your own OpenVPN</a></li>
<li><a href="../267843/index.html">Using NSOperation and NSOperationQueue in Swift</a></li>
<li><a href="../267845/index.html">Automation of development in ZeptoLab</a></li>
<li><a href="../267847/index.html">How do we do without 1C?</a></li>
<li><a href="../267849/index.html">September 29, we invite you to view AzureCon and meet with experts at Microsoft Technology Center</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>