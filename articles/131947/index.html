<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Wean the touch screen to shift the coordinates of the touch a couple of mm up</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I think very few people have noticed that the physical coordinates of the touch of a finger and their program display in iOS are slightly different: i...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Wean the touch screen to shift the coordinates of the touch a couple of mm up</h1><div class="post__text post__text-html js-mediator-article">  I think very few people have noticed that the physical coordinates of the touch of a finger and their program display in iOS are slightly different: iOS gives a point displaced by about 1.5 mm upwards relative to the real touch.  This is done in the interest of usability - a point close to the nail seems more realistic than lying below the pad of the finger.  In addition, you can better see the area of ‚Äã‚Äãthe screen where you click. <br>  To make it clearer what you are talking about, you can download any drawing artist (for example, <a href="http://itunes.apple.com/ru/app/id443131313%3Fmt%3D8">Bamboo Paper</a> , the <i>app is not mine, free</i> ), block the screen auto-rotate, draw a small horizontal line, then turn the device upside down (always when blocking the auto-rotate) and try to continue the drawn line.  Most likely the continued line will be lower than the original. <br><a name="habracut"></a><br>  In most applications, this behavior is invisible, but in some it can be harmful.  For example, in pictures, where auto-rotate is disabled and it is assumed that the user can rotate the device as he pleases, it is necessary to ensure identical handling of touches, regardless of the current rotation of the device.  Or in a board game, such as chess, where the displacement of coordinates can lead to the player playing black (and for which the interface in portrait mode is upside down), when you try to move a piece, it will miss and take the piece from the cage below. <br><br>  According to my tests on the first generation iPad, the shift was about 7 pixels.  Naturally, on other devices, the result will be different, it is necessary to test. <br><br>  I did not find an open software interface for managing this shift in the Apple documentation, and therefore I had to look for workarounds. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In the case of drawing painters, you can simply introduce an amendment to the logic of methods <i>touchesMoved</i> and the like: <br><pre><code class="hljs objectivec">- (<span class="hljs-keyword"><span class="hljs-keyword">void</span></span>)touchesMoved:(<span class="hljs-built_in"><span class="hljs-built_in">NSSet</span></span> *)touches withEvent:(<span class="hljs-built_in"><span class="hljs-built_in">UIEvent</span></span> *)event { <span class="hljs-comment"><span class="hljs-comment">//... CGPoint point = [[touches anyObject] locationInView:self]; //    , ..  y    point.y = point.y + 7; //... }</span></span></code> </pre> <br>  However, this is not always acceptable, especially if there is a certain amount of ready-made code that you want to reuse without changes. <br><br>  As a radical solution in the first version of this article, I showed an example with an amendment to absolutely all the calls of <i>locationInView</i> and <i>previousLocationInView</i> in <i>UITouch</i> instances: <br><pre> <code class="hljs kotlin">#<span class="hljs-keyword"><span class="hljs-keyword">import</span></span> <span class="hljs-string"><span class="hljs-string">"objc/runtime.h"</span></span> <span class="hljs-meta"><span class="hljs-meta">@interface</span></span> UITouch (Adjusted) -(CGPoint)adjustedLocationInView:(UIView *)view; -(CGPoint)adjustedPreviousLocationInView:(UIView *)view; <span class="hljs-meta"><span class="hljs-meta">@end</span></span> <span class="hljs-meta"><span class="hljs-meta">@implementation</span></span> UITouch (Adjusted) -(CGPoint)adjustedLocationInView:(UIView *)view{ CGPoint point = [self adjustedLocationInView:view]; point.y = point.y + <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> point; } -(CGPoint)adjustedPreviousLocationInView:(UIView *)view{ CGPoint point = [self adjustedPreviousLocationInView:view]; point.y = point.y + <span class="hljs-number"><span class="hljs-number">7</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> point; } +(void)load{ Class <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> = [</span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UITouch</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class</span></span></span><span class="hljs-class">]; </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Method</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">locInViewMethod</span></span></span><span class="hljs-class"> = </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">class_getInstanceMethod</span></span></span></span>(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">@selector</span></span></span></span>(locationInView:)); Method adjLocInViewMethod = class_getInstanceMethod(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">@selector</span></span></span></span>(adjustedLocationInView:)); method_exchangeImplementations(locInViewMethod, adjLocInViewMethod); Method prevLocInViewMethod = class_getInstanceMethod(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">@selector</span></span></span></span>(previousLocationInView:)); Method adjPrevLocInViewMethod = class_getInstanceMethod(<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class">, </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">@selector</span></span></span></span>(adjustedPreviousLocationInView:)); method_exchangeImplementations(prevLocInViewMethod, adjPrevLocInViewMethod); NSLog(@<span class="hljs-string"><span class="hljs-string">"UITouch class is adjusted now."</span></span>); } <span class="hljs-meta"><span class="hljs-meta">@end</span></span></code> </pre><br>  Here, using the runtime function method_exchangeImplementations, the implementations of the default <i>UITouch</i> methods are <i>exchanged</i> for our corrections.  Please note that the file with the created category does not have to be imported into any other .h or .m file.  Just add it to the project, and the <i>+ load</i> method will be called automatically, because  the <i>+ load</i> message is automatically sent to each class and category when added to the runtime. <br>  <b>Upd.</b>  <i>However, as <a href="http://habrahabr.ru/blogs/macosxdev/131947/">it turned out in the comments</a> , starting with iOS 5, Apple <a href="http://stackoverflow.com/questions/7720947/method-swizzling-in-ios-5">asks not to use</a> method_exchangeImplementations in applications.</i>  <i>Thanks <a href="http://habrahabr.ru/users/wicharek/" class="user_link">wicharek</a> for the info.</i>  <i>Therefore, to amend, it is better to use any other method to your taste, for example, one of those proposed in the comments.</i> <br><br>  So, after the introduction of the amendment, drawing on the view will work identically for any orientation of the device.  However, this does not solve problems with chess pieces: in determining which view to send a touch event, the point with a shift will still be used, and we can get into the wrong figure. <br>  To determine which view should handle the touch, use the <i>hitTest: withEvent:</i> method of <i>UIView</i> , which works like this: <br><ul><li>  <i>pointInside</i> is <i>called: withEvent:</i> <i>self</i> ; </li><li>  if the result is <i>NO</i> , then <i>hitTest: withEvent:</i> returns <i>nil</i> , i.e.  view does not respond to touch; </li><li>  if the result is <i>YES</i> , the method recursively sends <i>hitTest: withEvent: to</i> all of its subviews; </li><li>  if one of the subview returned a <i>non-nil</i> object, then the root <i>hitTest: withEvent:</i> returns this object; </li><li>  if all subview returned <i>nil</i> , or view has no subview, then <i>self is</i> returned; </li></ul><br>  Thus, for the correct hit of the touches in the chess figures, it is enough to override <i>hitTest: withEvent</i> at the root view, which contains all the subviews for which we need to introduce an amendment: <br><pre> <code class="hljs mel">@implementation ChessBoardView - (UIView*)<span class="hljs-keyword"><span class="hljs-keyword">hitTest</span></span>:(CGPoint)point withEvent:(UIEvent *)<span class="hljs-keyword"><span class="hljs-keyword">event</span></span> { point.y = point.y + <span class="hljs-number"><span class="hljs-number">7</span></span>; UIView *hitView = [super <span class="hljs-keyword"><span class="hljs-keyword">hitTest</span></span>:point withEvent:<span class="hljs-keyword"><span class="hljs-keyword">event</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> hitView; } @end</code> </pre><br>  After that, the player who plays black gets into the chess pieces as comfortably as the player who plays white. </div><p>Source: <a href="https://habr.com/ru/post/131947/">https://habr.com/ru/post/131947/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../131937/index.html">Quick Attach to Process</a></li>
<li><a href="../131943/index.html">Algorithm for the application to the API VKontakte</a></li>
<li><a href="../131944/index.html">Release node.js 0.6.0</a></li>
<li><a href="../131945/index.html">The history of the development of speech recognition systems: how we came to Siri</a></li>
<li><a href="../131946/index.html">YouTube remains the most popular video hosting, Facebook loses ground</a></li>
<li><a href="../131948/index.html">Yahoo is closer to selling its assets than before</a></li>
<li><a href="../131949/index.html">UNIX way and task generator for computer network architecture</a></li>
<li><a href="../131951/index.html">Effective use of Vim</a></li>
<li><a href="../131952/index.html">Service engineer or computer repair on the road</a></li>
<li><a href="../131954/index.html">Meeting users Sphinx search '11</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>