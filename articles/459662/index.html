<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>PVS-Studio wanted, but could not find bugs in robots.txt</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The other day, Google published the source code for the robots.txt parser. Why not get rid of the project already tested by everyone up and down throu...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>PVS-Studio wanted, but could not find bugs in robots.txt</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/6a4/303/c49/6a4303c496535ce7c7fc9ff84f2608ee.png" alt="Picture 1"></div><br>  The other day, Google published the source code for the robots.txt parser.  Why not get rid of the project already tested by everyone up and down through PVS-Studio and, possibly, find an error.  No sooner said than done.  It is a pity that nothing significant was found.  Well, then let it be just an excuse to praise the developers of Google. <br><br>  robots.txt - an index file that contains the rules for search engines.  It is valid for https, http and FTP protocols.  Google has made its robots.txt parser available to everyone.  You can read more about this news here: <a href="https://m.habr.com/ru/post/458428/">Google opens the source code of the robots.txt parser</a> <br><a name="habracut"></a><br>  I think most of those who read our articles know what PVS-Studio does.  But in case you are new to our blog, we will give a brief reference.  PVS-Studio is a static code analyzer that allows you to find a variety of errors, vulnerabilities and shortcomings in projects written in C, C ++, C # and Java.  In other words, PVS-Studio is a <a href="https://www.viva64.com/ru/sast/">SAST</a> solution and can work both on user machines or build servers, and in the <a href="https://www.viva64.com/ru/b/0636/">cloud</a> .  Moreover, the PVS-Studio team loves to write <a href="https://www.viva64.com/ru/inspections/">articles</a> about checking various projects.  So let's get down to business and try to find errors in the source code of the parser from Google. <br><br>  To our regret, and, to the joy of everyone else, no errors were found.  Found only a couple of minor flaws, which we will tell.  It is necessary because at least something to write :).  The absence of errors is due to the small size of the project and the high quality of the code itself.  This does not mean that there are no errors hiding there, but the static analysis was currently impotent. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In general, this article turned out in the spirit of our other publication " <a href="https://www.viva64.com/ru/b/0246/">The shortest article on checking nginx</a> ". <br><br>  There was a possibility of a small optimization: <br><br>  <a href="https://www.viva64.com/ru/w/v805/">V805</a> Decreased performance.  It is not necessary to identify the string by using 'strlen (str)&gt; 0' construct.  A more efficient way is to check: str [0]! = '\ 0'.  robots.cc 354 <br><br><pre><code class="cpp hljs"><span class="hljs-keyword"><span class="hljs-keyword">bool</span></span> RobotsTxtParser::GetKeyAndValueFrom(<span class="hljs-keyword"><span class="hljs-keyword">char</span></span> **key, ....) { .... *key = line; .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">strlen</span></span>(*key) &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; }</code> </pre> <br>  Calling the <i>strlen</i> function to find out if a string is non-empty is an inefficient way.  Such a check can be made much simpler: <i>if (* key [0]! = '\ 0')</i> , and you will not need to go through all the elements of a string if it is non-empty. <br><br>  <a href="https://www.viva64.com/ru/w/v808/">V808</a> 'path' object of the 'basic_string' type was created but was not used.  robots.cc 123 <br><br><pre> <code class="cpp hljs"><span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-function"><span class="hljs-built_in"><span class="hljs-function"><span class="hljs-built_in">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetPathParamsQuery</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(....)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">string</span></span> path; .... }</code> </pre> <br>  The <i>path</i> string is declared, but not used further.  In some cases, unused variables may indicate an error.  But here it seems that before this variable was somehow used, but after making changes, it was no longer needed.  Thus, the analyzer often also helps to make the code cleaner and help avoid errors by simply removing the prerequisites for their appearance. <br><br>  In the following case, the analyzer, in fact, recommends adding a default <i>return</i> after the entire <i>main has</i> been processed.  Perhaps it would be worth adding a <i>return</i> at the very end so that you can understand that everything really worked.  However, if this behavior was intended, and nothing needs to be changed, and the analyzer would not want to see the message, then in the case of PVS-Studio, you can suppress this warning and never see it again :). <br><br>  <a href="https://www.viva64.com/ru/w/v591/">V591</a> The 'main' function doesn‚Äôt return a value, which is equivalent to 'return 0'.  It is possible that this is an unintended behavior.  robots_main.cc 99 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">main</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">int</span></span></span></span><span class="hljs-function"><span class="hljs-params"> argc, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">** argv)</span></span></span><span class="hljs-function"> </span></span>{ .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (filename == <span class="hljs-string"><span class="hljs-string">"-h"</span></span> || filename == <span class="hljs-string"><span class="hljs-string">"-help"</span></span> || filename == <span class="hljs-string"><span class="hljs-string">"--help"</span></span>) { ShowHelp(argc, argv); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (argc != <span class="hljs-number"><span class="hljs-number">4</span></span>) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { .... <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>; } .... <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (....) { <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">cout</span></span> &lt;&lt; <span class="hljs-string"><span class="hljs-string">"...."</span></span> &lt;&lt; <span class="hljs-built_in"><span class="hljs-built_in">std</span></span>::<span class="hljs-built_in"><span class="hljs-built_in">endl</span></span>; } }</code> </pre> <br>  It was also found that the following two functions with different names have the same implementation.  Perhaps this is the result of the fact that earlier these functions had different logic, but they came to one.  Or it may be that a typo crept in somewhere, so such warnings should be carefully checked. <br><br>  <a href="https://www.viva64.com/ru/w/v524/">V524</a> It is odd that the body of the MatchDisallow function is fully equivalent.  robots.cc 645 <br><br><pre> <code class="cpp hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MatchAllow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(absl::string_view path, absl::string_view pattern)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Matches(path, pattern) ? pattern.length() : <span class="hljs-number"><span class="hljs-number">-1</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">int</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">MatchDisallow</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(absl::string_view path, absl::string_view pattern)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Matches(path, pattern) ? pattern.length() : <span class="hljs-number"><span class="hljs-number">-1</span></span>; }</code> </pre> <br>  This is the only place that makes me suspicious.  It is worth checking out the authors of the project. <br><br>  Thus, checking the robots.txt parser from Google showed that the project, which is so actively used and, most likely, repeatedly checked for errors, has a high quality code.  And the found flaws can not spoil the impression of what cool coders from Google were involved in this project :). <br><br>  We offer you to <a href="https://www.viva64.com/ru/pvs-studio-download/">download and try PVS-Studio</a> on the project you are interested in. <br><br><p> <a href="https://www.viva64.com/en/b/0638/"><img src="https://habrastorage.org/getpro/habr/post_images/c78/30f/70c/c7830f70c5577c3d6704f254d7cad6a3.png" align="left"></a> </p><br><br>  If you want to share this article with an English-speaking audience, then please use the link to the translation: Victoria Khanieva.  <a href="https://habr.com/en/company/pvs-studio/blog/459658/">PVS-Studio couldn‚Äôt find bugs in robots.txt</a> </div><p>Source: <a href="https://habr.com/ru/post/459662/">https://habr.com/ru/post/459662/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../459644/index.html">Dimmers for LED lamps</a></li>
<li><a href="../459650/index.html">How not to lose money in a black box: billing testing methods</a></li>
<li><a href="../459652/index.html">Automated regression testing approach</a></li>
<li><a href="../459656/index.html">OData service without writing code</a></li>
<li><a href="../45966/index.html">MySQL file storage and distribution</a></li>
<li><a href="../459668/index.html">How to recognize a text with a photo: new possibilities of the Vision framework</a></li>
<li><a href="../45967/index.html">Problem when using OutputCache in CustomControl</a></li>
<li><a href="../459670/index.html">GOTO Amsterdam</a></li>
<li><a href="../459672/index.html">Python underline</a></li>
<li><a href="../459674/index.html">Epic Intelligence Intelligence Saga</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>