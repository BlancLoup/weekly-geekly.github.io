<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we connected DigitalOcean under Christmas</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The Christmas period for us turned out to be filled and interesting. For a month and a half, we were able to prepare a second release of Deploy4Me and...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we connected DigitalOcean under Christmas</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/d04/16f/318/d0416f318ef34666b79dc94b80a16088.png"><br><br>  The Christmas period for us turned out to be filled and interesting.  For a month and a half, we were able to prepare a second release of Deploy4Me and usher in the New Year with new plans.  The Deploy4Me release has brought significant replenishment for the service.  We added support for DigitalOcean, got hold of beautiful pictures and slightly changed the visual accompaniment.  Now try the service and get your server in the cloud just got easier. <br><br>  Integration with DigitalOcean was not as elegant as we expected and not as simple as stated by the creators of this cloud platform.  As it turned out, not all tested APIs were tested the same.  I want to share this knowledge - suddenly someone will help when choosing a site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a><br><br>  Let me remind you that Deploy4Me is a business software deployment service in the clouds.  Knowledge of cloud providers and integration with them is our bread and urgent need.  Among the tasks that the service solves, there are the tasks of creating virtual machines, network configuration and security.  That's why the experience of integration with DigitalOcean is connected with these three tasks.  But first things first. <br><br>  It all started with the publication of the previous <a href="http://habrahabr.ru/company/d4m/blog/245565/">article</a> , when kind people asked for more clouds.  Choosing one of the most popular providers, we decided to connect DigitalOcean.  The company is young, ambitious, as it seemed to us, and rapidly growing.  They declare attention to the developers and provide an API almost under all programming languages.  Documentation is available, and OAuth support was very tempting.  From experience integrating with Amazon, searching for user credentials can be a very repulsive moment.  So, the work began to boil. <br><br><h2>  About OAuth </h2><br>  For developers, DigitalOcean offers, in addition to connecting via a login / password pair, OAuth tokens for working with the API.  In the control panel, you can register the URL of your application and get a unique pair of Client ID / Client Secret and a link for the user.  Under the link, the user will allow the connection, and the application will receive an authorization code.  This code and the Client ID / Client Secret pair will allow you to get an OAuth token.  The token allows you to connect to the site on behalf of the user for 30 days and create virtual machines.  Together with the token is given Refresh Token to extend the validity of the token.  So, the connection to DigitalOcean can be kept active and extended indefinitely until the user revokes the rights. <br><br>  The OAuth token, by the way, is transmitted when calling the API in clear text as an HTTP header.  We did not notice any restrictions on its use.  So all hope is https. <br><br>  For ourselves, we registered three applications, one for each of the test environments.  We downloaded the client, developed the integration, and ... started communication with support. <br><br><h2>  About API </h2><br>  DigitalOcean is actively developing.  There is much to develop, since the API interface is a dozen REST methods for the main tasks of the cloud.  In general, it is surprising how short API will turn out, if you remove the mention of security from the hosting site.  By comparison, 80% of our Amazon code is dedicated to setting up security, network, firewall, and DNS. <br><br>  The development of the API leads to annoying errors in the official DigitalOcean client.  So the release of API version 2 affected the stability of client libraries.  Fortunately, the code is open and after three hours of intensive documentation study, we <a href="">forked</a> and fixed the client under .NET and wrote one scary <a href="https://github.com/rmoriz/knife-digital_ocean/issues/57">crutch</a> for Ruby. <br><br>  It should be said that support was at a height even on Catholic Christmas - there is help from the community, and this is the most important thing. <br><br><h2>  About CloudFlare </h2><br>  Three days we tested without surprises.  On the fourth, all Wednesdays collapsed.  Both the stable OAuth and the young API stopped working.  Went denial of service and authorization errors.  Support persistently asked for details and poked a finger at us.  We understood - here it is, a turning point.  Then either a victory or a complete rejection of integration. <br><br>  After a meaningless wandering around the provider's site, an unexpected window flared up.  CloudFlare notified that the page was about to load and offered to be checked instead of whether you are a robot.  Perplexedly glancing at this message, we climbed to read about this newfangled service.  It turned out that a few days before the new year DO decided to connect CloudFlare.  I don‚Äôt know if they had DDOS or just wanted a CDN.  But it had a detrimental effect on API interfaces. <br><br>  Having found the cause of all evil, with victorious shouts, we began to encourage support staff from the country of Kaa and Sher Khan to turn off their art and quickly.  Do not believe it.  They called for help from the country of bald eagles.  Those for two calls did disable CloudFlare for the API and we breathed a sigh of relief. <br><br>  In the course of communication, a strange fact emerged.  The guys from DO are somehow close to Rackspace.  Someone worked there, someone wrote comments to them, someone commited the code.  Adding to this almost identical error messages, we hit the conspiracy.  There was a feeling that DO is a beautiful rebranding of Rackspace for the American market.  There is no evidence of this; therefore, nothing can be proved. <br><br><h1>  About security </h1><br>  Cloud security DO is from the field of amateur.  That is, it is up to you.  The provider does not provide a firewall, does not provide network gateways and does not close the server from the Internet.  Of the solutions proposed in the documentation, the only sound grain is to configure iptables on each server and send all requests through a separate machine with a proxy server. <br><br>  But they have cheap hosting ... <br><br>  And lastly: <br><br><h2>  How to connect DigitalOcean to a project on Deploy4Me? </h2><br>  To put the server in DO, go to <a href="http://deploy4me.com/">Deploy4Me</a> , log in, click <b>Start New Deployment</b> .  Having come up with a sonorous project name, we connect the cloud: <br><br clear="all"><img src="https://habrastorage.org/files/0b9/9b7/6e2/0b99b76e2d904fe5a9629c00e70c389b.png"><br><br clear="all"><br clear="all">  OAuth is a great thing that makes life a lot easier.  It is easier to click on the three screens than to look for the keys in the provider‚Äôs depth.  But everything has its price: simpler is not always safer. <br><br clear="all"><img src="https://habrastorage.org/files/58a/2ac/d35/58a2acd351eb4f578b64ea627410b518.png"><br><br clear="all"><br clear="all">  After closing the connection window to DO, an authorization code is immediately added, which can be seen on the screen from below.  This is the code we use to get the OAuth token. <br><br clear="all"><img src="https://habrastorage.org/files/d88/9df/118/d889df118967448c9aad18322e88d851.png"><br><br clear="all"><br clear="all">  Last required action - click the Contune button.  It will save and check the correct connection.  Then you can continue to install the project. <br><br clear="all"><img src="https://habrastorage.org/files/c5c/974/3e1/c5c9743e10a646b2802466f28b85a96e.png"><br><br clear="all"><br clear="all"><h2>  What's next? </h2><br>  As always, more - more software and cloud providers.  We have updated the system of suggestions and wishes, so we will be happy to vote for software and feature suggestions <a href="http://kb.deploy4me.com/">there</a> or here in the comments. <br><br><div class="spoiler">  <b class="spoiler_title">Thanks for reading</b> <div class="spoiler_text">  We also have free credits for registration and for the community.  Write articles, send a link to the <a href="https://deploy4me.com/en/community-access.html">community</a> and get free credits to the servers. <br></div></div></div><p>Source: <a href="https://habr.com/ru/post/248301/">https://habr.com/ru/post/248301/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../248287/index.html">Critical Vulnerability in PolarSSL</a></li>
<li><a href="../248289/index.html">Smart alarm clock for smart home</a></li>
<li><a href="../248291/index.html">Grape: no single rails, part 2</a></li>
<li><a href="../248293/index.html">The digest of interesting materials from the world of Drupal # 3</a></li>
<li><a href="../248295/index.html">Flurry retention rates: very important and very incomprehensible</a></li>
<li><a href="../248303/index.html">Publish configuration 1C on GitHub</a></li>
<li><a href="../248305/index.html">The tale of the development of active wireless speakers HiFi. And about. Part 1</a></li>
<li><a href="../248307/index.html">As we now do children's lesson about programmers and programming with broadcast</a></li>
<li><a href="../248309/index.html">Behavioral factors in Yandex. The nuances of the filter, which every webmaster should know</a></li>
<li><a href="../248311/index.html">Guide to the best letters</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>