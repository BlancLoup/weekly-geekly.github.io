<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Using Tomoyo Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Block suspicious program behavior? Mitigate exploitation of vulnerabilities? Exclude the execution of unauthorized code? 
 TOMOYO Linux - implementati...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Using Tomoyo Linux</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/27b/cfc/563/27bcfc5631c8886a6f19f7925f196e94.png"><br><br>  Block suspicious program behavior?  Mitigate exploitation of vulnerabilities?  Exclude the execution of unauthorized code? <br>  TOMOYO Linux - implementation of mandatory access control for the Linux operating system.  Built into the kernel by default.  Allows you to take control of the behavior of the system and severely restrict the framework of a given policy. <br><a name="habracut"></a><br>  The creation of policies for both individual applications and the entire system as a whole will be described below. <br>  The examples will be based on the Debian Wheezy and Tomoyo 2.5 available in the kernel. <br><br><h5>  The basics </h5><br>  <b>1. Domains.</b> <br>  Tomoyo in its work is guided by such a concept as <b>Domains</b> .  Domains are processes and interrelationships between domain transition processes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Base domain is always <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> file execute /bin/ls -   ls <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> file execute /bin/ls task.uid=0 -   ls  . <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> initialize_domain /usr/bin/midori from any <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> network inet stream connect 0.0.0.0-255.255.255.255 80-443 //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> tomoyo-savepolicy -d    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> &gt;&gt; /etc/tomoyo/domain_policy.conf   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> /etc/tomoyo/domain_policy.conf <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></b></code> <div class="spoiler_text"> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </div></div> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> file read/write/append/unlink/truncate @Midoi_Allow <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </h5> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> /etc/tomoyo/profile.conf 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></b></code> <div class="spoiler_text"> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </div> </div> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> /etc/tomoyo/exception_policy.conf <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></b></code> <div class="spoiler_text"> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </div></div> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <div class="spoiler"> <code><b class="spoiler_title"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> /etc/tomoyo/domain_policy.conf <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></b></code> <div class="spoiler_text"> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre></div></div> <code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            . <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0 <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> keep_domain any from &lt;kernel&gt; <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> initialize_domain /usr/bin/midori from any <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code><code class="bash"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code></code> </pre> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <h5> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </h5> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> <pre> <code class="hljs tex"><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect <span class="hljs-tag"><span class="hljs-tag">\</span></span>000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read/write/append/unlink/truncate /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file create/chmod /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> 0-0666 file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file rename /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> /home/home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /etc/fonts/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /usr/share/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> file read /var/cache/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/midory/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span>/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group Midoi_Allow /home/home/.config/midori/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span></code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>medit<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /bin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /etc/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sbin/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /sys/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /boot/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /usr/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC /run/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">{</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">}</span></span></span></span>/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /lib64/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /home/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /opt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /tmp/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /var/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /mnt/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> path_group ALLOW_EXEC_ROOT /media/<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">*</span></span></span></span> keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">-</span></span></span></span>midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code><code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </pre> <code><code><code class="bash"><br>     . <br> &lt;kernel&gt; -  &lt;kernel&gt; /sbin/init -  &lt;kernel&gt; /sbin/init /etc/rc.d/rc -   &lt;kernel&gt; /etc/init.d/gdm3 /sbin/start-stop-daemon /usr/sbin/gdm3 - </code> <br> <br>   ,        . <br> <br>     /bin/bash,     ,     sshd    . <br>    -    . <br> /sbin/init ..... /bin/bash <br> /sbin/init ..... /usr/sbin/sshd /bin/bash <br> <br>        . <br> ,  bash   - .   bash   - ,  .    Tomoyo. <br> <br>          tomoyo-editpolicy. <br> <br>       tomoyo-editpolicy <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/9b5/671/0de/9b56710deef6a76cdbbd0c6879de1d49.png"> <br> <br>     .     . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/926/d25/234/926d25234c57d4d7a0505d210b465c7d.png"> <br> <br>       <b>W</b> ,      <b>D</b> (w &amp; d). <br> <br> <b>2. </b> <br> <br>      .  , ,   ,   .    . <br> <br> <code class="bash">file execute /bin/ls -   ls</code> <br> <br>  ,     <i></i>  . <br> <br> <code class="bash">file execute /bin/ls task.uid=0 -   ls  .</code> <br> <br> <b>3. .</b> <br>   ,  ,     . <br> <br>  4  . <br> 0 -  ,    . <br> 1 -  ,         . <br> 2 -  ,      0 <br> 3 -  ,  ,      . <br> <br>       tomoyo-editpolicy (w &amp; p) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/832/ac4/34a/832ac434a24b736a8b739ff603627bb4.png"> <br> <br>      -        3 <br> <br> <b>4. .</b> <br>  , -    .   .      .    -  ,   .          . <br> <br>       tomoyo-editpolicy (w &amp; e) <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c11/d2d/8a1/c11d2d8a13eedad7bc8db5cb7d501941.png"> <br> <br> <b>5. </b> <br> <br>      : <br> <br> /etc/tomoyo/domain_policy.conf -     <br> /etc/tomoyo/profile.conf -  <br> /etc/tomoyo/exception_policy.conf -  <br> <br>  ,     tomoyo-editpolicy    ,  .       .   ! <br> <br>       . <br> <br> <b>6. </b> <br> <br> tomoyo-editpolicy -    .         . <br> tomoyo-loadpolicy -           . <br> tomoyo-savepolicy -  ,     .  !   -       tomoyo-editpolicy.       ,   . <br> tomoyo-checkpolicy -     . <br> <br>    ,     . <br> <br> <i>    Tomoyo: <a href="">tomoyo.sourceforge.jp/2.5/chapter-4.html.en</a></i> <br> <br> <i>  : <a href="">tomoyo.sourceforge.jp/2.5/man-pages/index.html.en</a></i> <br> <br>  Tomoyo. <br> 1.  GRUB /etc/default/grub <br> GRUB_CMDLINE_LINUX_DEFAULT="quiet security=tomoyo" <br>   <br> update-grub <br> <br> 2.  : <br> aptitude install tomoyo-tools <br> <br> 3.  : <br> /usr/lib/tomoyo/init_policy <br>    . <br> <br> 4. ! <br>        Tomoyo,     .  ,    e   grub  : <br> security=tomoyo <br>  <br> security=none <br> <br>     <br>      midori. <br>   ,     ,    ,     . <br>       ,      midori. <br> <br>       initialize_domain. <br> <br>  tomoyo-editpolicy. <br>    Exeption Policy Editor (w &amp; e)     <b>A</b>  : <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/d2e/1dd/d3a/d2e1ddd3a6d702f9f29390695ec6a750.png"> <br> <br> <i>     . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-5.html.en</a></i> <br> <br>      Domain Transition Editor (w &amp; d) <br> <br>     /usr/bin/midori   * <br> <br>  <b>S</b>     ,   1. <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c0e/91e/0f2/c0e91e0f2961a00acf12d64db967dbaa.png"> <br> <br>  midori      ,   .   ,  ,     . <br>  midori. <br> <br>   Domain Transition Editor  Enter        Domain Policy Editor,      midori   . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/c31/201/c89/c31201c895ed3eca0b8153a4e4614257.png"> <br> <br>       . <br> <br>   @        .       . <br> <br>      .       . <br> <br>           . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/ac0/21b/c67/ac021bc671e3b92cb1ac90cdd412f764.png"> <br> <br>        /home/home/.config/midori/ <br> <br>   <b></b> (append)  . <br> <br> <code class="bash">file read/write/unlink/truncate/rename /home/home/.config/midori/\*</code> <br> <br>      . <br> <br>  <b></b>     ,   <b>D</b>       ,  . <br> <br>  , ,            /home/home/.config/midori/ <br> <br> <code class="bash">file read/write/append/unlink/truncate /home/home/.config/midori/\{\*\}/\*</code> <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/expression-rules.html.en#wildcard</a> <br>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en</a></i> <br> <br>       . <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/a8d/720/90a/a8d72090ac67277f1b965c9d0dbbfb58.png"> <br> <br>        ,    . <br> <br> <code class="bash">network inet stream connect 0.0.0.0-255.255.255.255 80-443</code> //    <br> <br>      ,    (O &amp; D). <br> <br> <i>     <br> <a href="">tomoyo.sourceforge.jp/2.5/policy-specification/domain-policy-syntax.html.en#network_inet</a></i> <br> <br>   ,      . <br> <br> ,   ,  midori  /etc/passwd <br> <br> <img src="https://habrastorage.org/getpro/habr/post_images/528/7e0/3a1/5287e03a1fd85d06509b823a355ed6db.png"> <br> <br>       . <br> <br>  D,    . <br>    Domain Transition Editor (w &amp; d),  <b>S</b>     1    3. <br>  . <br>  ?     .   ?        . <br> <br>        . <br> <br> <code class="bash">tomoyo-savepolicy -d | tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori' &gt;&gt; /etc/tomoyo/domain_policy.conf</code> <br> <br> : <br> <code class="bash">tomoyo-savepolicy -d</code>    . <br> <code class="bash">tomoyo-selectpolicy -r '&lt;kernel&gt; /usr/bin/midori'</code>    ,   . <br> <code class="bash">&gt;&gt; /etc/tomoyo/domain_policy.conf</code>   . <br> <br>        midori <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0 misc env GNOME_KEYRING_PID misc env USER misc env SSH_AGENT_PID misc env HOME misc env DESKTOP_SESSION misc env XDG_SESSION_COOKIE misc env DBUS_SESSION_BUS_ADDRESS misc env GNOME_KEYRING_CONTROL misc env LOGNAME misc env USERNAME misc env WINDOWPATH misc env PATH misc env DISPLAY misc env LANG misc env XAUTHORITY misc env SSH_AUTH_SOCK misc env SHELL misc env GDMSESSION misc env PWD misc env XDG_DATA_DIRS misc env GNOME_DESKTOP_SESSION_ID misc env SESSION_MANAGER misc env GPG_AGENT_INFO misc env GIO_LAUNCHED_DESKTOP_FILE misc env GIO_LAUNCHED_DESKTOP_FILE_PID misc env DESKTOP_STARTUP_ID file read proc:/filesystems file read /usr/lib/locale/locale-archive file read /usr/lib/x86_64-linux-gnu/gconv/gconv-modules.cache network unix stream connect /var/run/nscd/socket file read /etc/nsswitch.conf network unix stream connect \000/tmp/.X11-unix/X0 file read /run/gdm3/auth-for-home-WxYaIE/database file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/engines/libclearlooks.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/modules/libcanberra-gtk-module.so network unix stream connect \000/tmp/dbus-BKDp9V4Rww file read /usr/lib/x86_64-linux-gnu/gio/modules/giomodule.cache file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognomeproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiolibproxy.so file read /usr/lib/x86_64-linux-gnu/gio/modules/libdconfsettings.so file read /etc/xdg/midori/search file read /usr/lib/x86_64-linux-gnu/gio/modules/libgiognutls.so file read proc:/sys/crypto/fips_enabled file read /dev/urandom file read /etc/pkcs11/modules/gnome-keyring-module file read /usr/lib/x86_64-linux-gnu/pkcs11/gnome-keyring-pkcs11.so network unix stream connect /home/home/.cache/keyring-XULOQY/pkcs11 file read /etc/ssl/certs/ca-certificates.crt file read /usr/lib/x86_64-linux-gnu/gio/modules/libgvfsdbus.so file read /usr/lib/x86_64-linux-gnu/gvfs/libgvfscommon.so file read /usr/lib/midori/libaddons.so file read /usr/lib/midori/libtoolbar-editor.so file read /usr/lib/midori/libtab-panel.so file read /usr/lib/midori/libadblock.so file read /usr/lib/midori/libcookie-manager.so file read /usr/lib/midori/libstatusbar-features.so file read /usr/lib/midori/libweb-cache.so file read /usr/lib/midori/libshortcuts.so file read /usr/lib/midori/libformhistory.so file read /usr/lib/midori/libstatus-clock.so file read /usr/lib/midori/libcolorful-tabs.so file read /usr/lib/midori/libfeed-panel.so file read /usr/lib/midori/libhistory-list.so file read /usr/lib/midori/libmouse-gestures.so file read /usr/lib/midori/libcopy-tabs.so file read /usr/lib/midori/libtabs-minimized.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders.cache file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/module-files.d/libpango1.0-0.modules file read /etc/fonts/fonts.conf file read /usr/lib/x86_64-linux-gnu/pango/1.6.0/modules/pango-basic-fc.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-svg.so file read /usr/lib/x86_64-linux-gnu/gtk-2.0/2.10.0/gtk.immodules file read /usr/lib/enchant/libenchant_hspell.so file read /usr/lib/enchant/libenchant_aspell.so file read /usr/lib/enchant/libenchant_myspell.so file read /usr/lib/enchant/libenchant_ispell.so file read /usr/lib/x86_64-linux-gnu/gconv/KOI8-R.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-png.so file read /usr/lib/x86_64-linux-gnu/gdk-pixbuf-2.0/2.10.0/loaders/libpixbufloader-ico.so file read /etc/host.conf file read /etc/resolv.conf file read /etc/hosts file ioctl socket:[family=2:type=2:protocol=17] 0x541B file read /etc/gai.conf file read /usr/lib/x86_64-linux-gnu/gio/modules/libgioremote-volume-monitor.so file ioctl anon_inode:inotify 0x541B file read /etc/gnome/defaults.list file read /usr/lib/libreoffice/share/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\{\*\}/\* file read/write/append/unlink/truncate /home/home/\* file create/chmod /home/home/\* 0-0666 file create/chmod /home/home/\{\*\}/\* 0-0666 file rename /home/home/\* /home/home/\* file rename /home/home/\{\*\}/\* /home/home/\{\*\}/\* file rename /home/\{\*\}/\* /home/home/\{\*\}/\* file read /etc/fonts/\{\*\}/\* file read /usr/share/\{\*\}/\* file read /var/cache/\{\*\}/\* network inet stream connect 0.0.0.0-255.255.255.255 80-443 network inet dgram send 192.168.1.1 53</code> <br> <br> <br>    . <br> <br> <code class="bash">tomoyo-savepolicy -e &gt; /etc/tomoyo/exception_policy.conf</code> <br> <br>  ,  ,       . <br> <br>          exception_policy.conf <br> <br> <code class="bash">path_group Midoi_Allow /home/\*/midory/\{\*\}/\* path_group Midoi_Allow /home/\*/.config/midori/\{\*\}/\* path_group Midoi_Allow /home/home/.config/midori/\*</code> <br> <br>     domain_policy.conf,    . <br> <br> <code class="bash">file read/write/append/unlink/truncate @Midoi_Allow</code> <br> <br>     ,     ,       Tomoyo. <br> <br> <code class="bash">tomoyo-checkpolicy d &lt; /etc/tomoyo/domain_policy.conf tomoyo-checkpolicy e &lt; /etc/tomoyo/exception_policy.conf</code> <br> <br>   ,        -   - ,      . <br> <br>      <i>tomoyo-auditd</i>     ,   /var/log/tomoyo      . <br> <br> <i>     <br> <a href="https://wiki.archlinux.org/index.php/skype">wiki.archlinux.org/index.php/skype#TOMOYO</a> <br> <a href="https://wiki.archlinux.org/index.php/Adobe_Reader">wiki.archlinux.org/index.php/Adobe_Reader</a></i> <br> <br>    <br>  Tomoyo    ,    . <br> <br>         /home  /tmp       root. <br>       . <br> <br>        . <br> <br> <b class="spoiler_title">/etc/tomoyo/profile.conf</b> 4-COMMENT=-----Enforcing file::execute only----- <br> 4-PREFERENCE={ max_audit_log=1024 max_learning_entry=2048 } <br> 4-CONFIG={ mode=disabled grant_log=yes reject_log=yes } <br> 4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes } <br> <br>     . <br> <br> <b class="spoiler_title">/etc/tomoyo/exception_policy.conf</b> <code class="bash">path_group ALLOW_EXEC /\* path_group ALLOW_EXEC /bin/\{\*\}/\* path_group ALLOW_EXEC /etc/\{\*\}/\* path_group ALLOW_EXEC /sbin/\{\*\}/\* path_group ALLOW_EXEC /sys/\{\*\}/\* path_group ALLOW_EXEC /boot/\{\*\}/\* path_group ALLOW_EXEC /usr/\{\*\}/\*\-medit\-midori path_group ALLOW_EXEC /run/\{\*\}/\* path_group ALLOW_EXEC /bin/\* path_group ALLOW_EXEC /etc/\* path_group ALLOW_EXEC /sbin/\* path_group ALLOW_EXEC /sys/\* path_group ALLOW_EXEC /boot/\* path_group ALLOW_EXEC /usr/\* path_group ALLOW_EXEC /run/\* path_group ALLOW_EXEC_ROOT /lib/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib64/\{\*\}/\* path_group ALLOW_EXEC_ROOT /home/\{\*\}/\* path_group ALLOW_EXEC_ROOT /opt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /tmp/\{\*\}/\* path_group ALLOW_EXEC_ROOT /var/\{\*\}/\* path_group ALLOW_EXEC_ROOT /mnt/\{\*\}/\* path_group ALLOW_EXEC_ROOT /media/\{\*\}/\* path_group ALLOW_EXEC_ROOT /lib/\* path_group ALLOW_EXEC_ROOT /lib64/\* path_group ALLOW_EXEC_ROOT /home/\* path_group ALLOW_EXEC_ROOT /opt/\* path_group ALLOW_EXEC_ROOT /tmp/\* path_group ALLOW_EXEC_ROOT /var/\* path_group ALLOW_EXEC_ROOT /mnt/\* path_group ALLOW_EXEC_ROOT /media/\* keep_domain any from &lt;kernel&gt; initialize_domain /usr/bin/midori from any</code> <br> <br> <br>   : <br> <br> <b class="spoiler_title">/etc/tomoyo/domain_policy.conf</b> <code class="bash">&lt;kernel&gt; use_profile 4 use_group 0 file execute @ALLOW_EXEC file execute @ALLOW_EXEC_ROOT task.uid=0 file execute /usr/bin/medit file execute /usr/bin/midori &lt;kernel&gt; /usr/bin/midori use_profile 3 use_group 0</code> <br> <br>  . <br> <br> 1. <br>      midori   <i>\-midori</i> ,       <i>file execute /usr/bin/medit</i> ? <br> <br>     Tomoyo.     ,               .           ,     . <br> <br>   <i>initialize_domain /usr/bin/midori from any</i>     medit,            <code class="bash">. <br> <br> 2. <br> file execute @ALLOW_EXEC_ROOT task.uid=0</code> <br>    <i></i>  ,  ,          . <br> <br> <i>  . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-10.html.en</a></i> <br> <br> 3. <br> <code class="bash">keep_domain any from &lt;kernel&gt;</code> <br>     .          . <br> <br> <code class="bash">initialize_domain /usr/bin/midori from any</code> <br>     ,      .        keep_domain. <br> <br> 4. <br> <code class="bash">4-CONFIG::file::execute={ mode=enforcing grant_log=no reject_log=yes }</code> <br>       .  use_profile 4,     . <br> <br> <i>    . <br> <a href="">tomoyo.sourceforge.jp/2.5/chapter-9.html.en</a></i> <br> <br>  <br> Tomoyo    ,     . <br>           . <br> <br> ps.    mac.    Tomoyo,       - <a href="http://caitsith.sourceforge.jp/">caitsith.sourceforge.jp</a> <br> <br> Update! <br> <br>      Tomoyo     . <br>     ld-linux.so.2    . <br> <br>            . <br> <br> : <br> <br> <code class="bash">&lt;kernel&gt; /lib/x86_64-linux-gnu/ld-2.13.so use_profile 3 use_group 0 initialize_domain /lib/x86_64-linux-gnu/ld-2.13.so from any</code> <br> ,         .</code></code> </div><p>Source: <a href="https://habr.com/ru/post/224335/">https://habr.com/ru/post/224335/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../224325/index.html">The master / slave terminology in the django framework was replaced with leader / follower for reasons of political correctness</a></li>
<li><a href="../224327/index.html">An example of saving on a license when implementing an enterprise 1C server</a></li>
<li><a href="../224329/index.html">Review AdvoCam-FD8 Profi-GPS Red: DVR with LDWS and other "buns" + "inside"</a></li>
<li><a href="../224331/index.html">Take a look at your page through the eyes of Googlebot.</a></li>
<li><a href="../224333/index.html">Work on HTTP 2.0 is offered to start over.</a></li>
<li><a href="../224337/index.html">How does Cloud4Y tech support work</a></li>
<li><a href="../224339/index.html">Automatic label highlighting</a></li>
<li><a href="../224341/index.html">Appintop - automated mobile application promotion service</a></li>
<li><a href="../224343/index.html">Problem with mongorestore between mongodb2.4 and mongodb2.6</a></li>
<li><a href="../224345/index.html">About the correlation and not only</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>