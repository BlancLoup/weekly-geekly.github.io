<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Visual windows configurator written in one hour</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Solved an interesting task - to make a visual editor-configurator of windows. 

 I will share the details of the development process with you, colleag...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Visual windows configurator written in one hour</h1><div class="post__text post__text-html js-mediator-article">  Solved an interesting task - to make a visual editor-configurator of windows. <br><br>  I will share the details of the development process with you, colleagues. <br><br><br>  UPD.  Added screenshots. <br>  UPD2.  <b>We are talking about offline, glazed, wooden or plastic windows - through which they look out of the house</b> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Thanks for the feedback! <br><a name="habracut"></a><br><br><h1>  Business requirements </h1><br>  Interview customer. <br><br>  1. This is a module for a site that should work in arbitrary popular cases. <br>  2. In editing mode, the program should allow you to specify the number and location of openings in the windows. <br>  3. In the editing mode, the program should allow you to specify the way of opening openings in the windows, five options: no opening, left, right, left and leans back, right and leans. <br>  4. In the display mode, the program should display the window configuration in an arbitrary scale. <br>  5. No need to store and work with information about the size, proportions, color and other characteristics of the window.  Pictures should be colored and understandable.  ESKD in this case is not in the business. <br>  6. Should not be buggy, stupid, should be cross-browser, should work on tablet PC browsers and smartphones, etc. <br><br>  At this stage, we, together with the customer, search Google for images on the interface of similar products.  Searching sites we find window sellers, and we visit dozens of sites to look at the interface of online configurators and in general an assortment of window configurations.  We are discussing what we should have and what should not be. <br><br><h1>  TU and TZ </h1><br>  Now we supplement the business requirements with technical specifications in order to finally form a technical task. <br>  1. Based on the requirement of arbitrary scaling - there is an understanding that the graphics should be vector.  A cross-browser solution that will satisfy - HTML5 canvas. <br>  2. Obviously, there should be two modes: edit mode and display mode. <br>  3. In edit mode, the data should be saved to input type = hidden.  I will not make changes to the CMS - why do I need extra smut?  Just add one field to the forms for adding and editing, to the DBMS and to the corresponding models (for me it really happens in one action, if you don‚Äôt, then it probably makes sense to revise the structure of the program). <br>  4. In the edit mode, the previously created visual configuration of the window should be restored from the data located and automatically inserted into the input type = hidden field. <br>  5. In the display mode, CMS will give the data as a property of some div, and my program should have this data: a) detect, b) draw a window using it. <br>  In this case, I will not do the specification, but I will follow the path of least resistance.  A good part of the vision of the solution is already present at the moment, so I will start the implementation immediately. <br><br><h1>  Development </h1><br>  Harsh programmer reality: I do not want to complicate my life, and therefore I initially create scalable and accompanied solutions.  Therefore DRY, therefore abstractions and layers - right away, by default. <br><br>  When I looked through the varieties of windows, I sketched a small catalog in my notebook with my pencil in order to understand what was to be drawn.  When I made these sketches, it came to be understood that I did not want to do it on CSS (probably in vain), and continue to work with &lt;canvas /&gt;. <br>  I'm going to look for a library to work with canvas.  I find <a href="http://calebevans.me/projects/jcanvas/">calebevans.me/projects/jcanvas</a> , skim through the documentation, evaluate the quality of the source code and understand that this is what I need now. <br>  I understand that drawing will be the lowest-level function.  And in general, I have long wanted to draw.  I try several documentation functions, find examples online in the sandbox.  Everything works, everything suits. <br><br><h1>  Start drawing </h1><br>  I will create a function-basis for drawing the window. <br><pre><code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows_init</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">selector</span></span></span><span class="hljs-function">) </span></span>{ window_canvas = $(<span class="hljs-string"><span class="hljs-string">'&lt;canvas&gt;&lt;/canvas&gt;'</span></span>). attr(<span class="hljs-string"><span class="hljs-string">'width'</span></span>,window_width). attr(<span class="hljs-string"><span class="hljs-string">'height'</span></span>,window_height). attr(<span class="hljs-string"><span class="hljs-string">'background'</span></span>,<span class="hljs-string"><span class="hljs-string">'blue'</span></span>). insertAfter(selector); }</code> </pre> <br>  Naturally, functions do not store parameters (this is called data).  Inside the functions are variables. <br>  At that moment, conscience did not wake up, so they are in the global scope.  If she wakes up - just put everything in the classroom.  If I wake up simultaneously with laziness (or common sense), I will write in CoffeeScript.  Now the stars have risen to a certain position, and there is some understanding that the final product will be a small program consisting of a dozen jQuery functions, and therefore the expediency of such actions is simply not considered at the moment.  First to make it work.  Refactoring - then. <br>  Looking at my sketches, I see that I can draw window openings, like rectangles, and mark the opening with the help of smooth broken lines inside them. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_leaf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x,y, width, height, window</span></span></span><span class="hljs-function">) </span></span>{ canvas.drawRect({ <span class="hljs-attr"><span class="hljs-attr">layer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeStyle</span></span>: window_silver, <span class="hljs-attr"><span class="hljs-attr">fillStyle</span></span>: window_blue, <span class="hljs-attr"><span class="hljs-attr">strokeWidth</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: y, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: width, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: height, <span class="hljs-attr"><span class="hljs-attr">fromCenter</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, }); }</code> </pre><br><br>  Now - lines denoting the opening.  Left - to the left, right - to the right, tilt - tilting.  There is no case with transom down (I asked again when I interviewed the customer), so I won't bother now.  If the need arises, then it will be easy to add it. <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// window opening draw function open_left(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x, y1: y, x2: x + width, y2: y + (height / 2), x3: x, y3: y + height, }); } function open_right(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x + width, y1: y, x2: x, y2: y + (height / 2), x3: x + width, y3: y + height, }); } function tilt(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x, y1: y + height, x2: x + (width / 2), y2: y, x3: x + width, y3: y + height, }); }</span></span></code> </pre><br><br>  I am writing some very quick tests to try this.  Everything works, so move on. <br><br><h1>  Types of windows </h1><br>  Actually, by the configuration of the openings all windows can be divided into ‚Äúvertical‚Äù (as they usually do in apartments), T-shaped.  Less common are "horizontal" - in the hallways and in institutions. <br>  First draw something simpler.  The leafs parameter is the number of openings. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_vertical</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x, y, width, height, leafs, window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf = width / leafs; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; leafs; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_x = x + (leaf * i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_y = y; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_width = leaf; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_height = height; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_num = i; make_leaf(canvas, leaf_x, leaf_y, leaf_width, leaf_height, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, leaf_num); } }</code> </pre><br><br>  Through a small debugging and a series of small tests I bring the function to the working form. <br>  I hand over the parameters and call the functions that draw the opening - in order to display broken lines from above. <br>  I rotate 90 degrees and get a ‚Äúhorizontal‚Äù window. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_horisontal</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x, y, width, height, leafs, window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf = height / leafs; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; leafs; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_x = x; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_y = y + (leaf * i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_width = width; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_height = leaf; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_num = i; make_leaf(canvas, leaf_x,leaf_y,leaf_width, leaf_height, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, leaf_num); } }</code> </pre><br><br>  I'm testing, working hard. <br>  A beautiful proportion is 1 to 2. Since there are instructions in the business requirements not to bother with the proportions, for a T-shaped window I will make this design. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_t</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x,y,width, height,leafs, window</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> w = width / leafs; make_leaf(canvas, x, y, width, height / <span class="hljs-number"><span class="hljs-number">3</span></span>, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; leafs; i++) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_x = x + (w * i); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_y = y + (height / <span class="hljs-number"><span class="hljs-number">3</span></span> ); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_width = w; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_height = height * <span class="hljs-number"><span class="hljs-number">2</span></span> / <span class="hljs-number"><span class="hljs-number">3</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leaf_num = i + <span class="hljs-number"><span class="hljs-number">1</span></span>; make_leaf(canvas, leaf_x,leaf_y,leaf_width, leaf_height, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, leaf_num); } }</code> </pre><br><br>  I do tests, make everything work smoothly, without jerks. <br><br><h1>  Catalog </h1><br>  I will draw all kinds of windows with which the program should work. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows_catalog</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ window_horisontal( window_canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, padding, catalog_height, catalog_height, <span class="hljs-number"><span class="hljs-number">1</span></span>, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'single'</span></span>, <span class="hljs-attr"><span class="hljs-attr">leafs</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'catalog'</span></span>}); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> offset = catalog_height + padding; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">2</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">5</span></span>; i++) { window_vertical( window_canvas, offset, padding, catalog_height * (i / <span class="hljs-number"><span class="hljs-number">2</span></span>), catalog_height, i, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'vertical'</span></span>, <span class="hljs-attr"><span class="hljs-attr">leafs</span></span>: i, <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'catalog'</span></span>}); offset += padding + (catalog_height * (i / <span class="hljs-number"><span class="hljs-number">2</span></span>)); } window_horisontal( window_canvas, offset, padding, catalog_height, catalog_height, <span class="hljs-number"><span class="hljs-number">2</span></span>, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'horisontal'</span></span>, <span class="hljs-attr"><span class="hljs-attr">leafs</span></span>: <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'catalog'</span></span>}); offset += padding + catalog_height; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">3</span></span>; i++) { window_t( window_canvas, offset, padding, catalog_height, catalog_height, i + <span class="hljs-number"><span class="hljs-number">2</span></span>, {<span class="hljs-attr"><span class="hljs-attr">type</span></span>: <span class="hljs-string"><span class="hljs-string">'t'</span></span>, <span class="hljs-attr"><span class="hljs-attr">leafs</span></span>: i + <span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-attr"><span class="hljs-attr">from</span></span>: <span class="hljs-string"><span class="hljs-string">'catalog'</span></span>}); offset += padding + catalog_height } }</code> </pre><br><br>  The seventh parameter and understanding of its content was added later.  Just ignore him now. <br>  And I will add to the function, those responsible for drawing the casement window, callback per click.  The intermediate version of the code was not preserved - by taking a good overclocking, I forgot to do frequent commits, so I‚Äôll show the final version. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">make_leaf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x,y, width, height, window, leaf_num</span></span></span><span class="hljs-function">) </span></span>{ canvas.drawRect({ <span class="hljs-attr"><span class="hljs-attr">layer</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">strokeStyle</span></span>: window_silver, <span class="hljs-attr"><span class="hljs-attr">fillStyle</span></span>: window_blue, <span class="hljs-attr"><span class="hljs-attr">strokeWidth</span></span>: <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-attr"><span class="hljs-attr">x</span></span>: x, <span class="hljs-attr"><span class="hljs-attr">y</span></span>: y, <span class="hljs-attr"><span class="hljs-attr">width</span></span>: width, <span class="hljs-attr"><span class="hljs-attr">height</span></span>: height, <span class="hljs-attr"><span class="hljs-attr">fromCenter</span></span>: <span class="hljs-literal"><span class="hljs-literal">false</span></span>, <span class="hljs-attr"><span class="hljs-attr">click</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">layer</span></span></span><span class="hljs-function">) </span></span>{ leaf_clicked(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>, leaf_num) } }); }</code> </pre><br><br>  And a function that catches a click on the sash of a large window or a small window in the directory. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">leaf_clicked</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">window, leaf_num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } window_canvas.clearCanvas(); windows_catalog(); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.size == <span class="hljs-string"><span class="hljs-string">'big'</span></span>) { trigger_opening(leaf_num); } big_window(<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.type, <span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.leafs); }</code> </pre><br><br>  There was an idea to make separate callbacks, but in the process I did not find any reasons for doing extra work. <br>  Added dispatcher function for convenience. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">opening</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">canvas, x, y, width, height, num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (window_opening[num]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'left'</span></span>: open_left(canvas, x, y, width, height); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'left tilt'</span></span>: open_left(canvas, x, y, width, height); tilt(canvas, x, y, width, height); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'right'</span></span>: open_right(canvas, x, y, width, height); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'right tilt'</span></span>: open_right(canvas, x, y, width, height); tilt(canvas, x, y, width, height); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><br><h1>  Sash opening switch </h1><br>  The opening of the leaves will switch by clicking.  What could be easier? <br>  I will save the list of valves in the array, and define the possibilities for opening them in the second array. <br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">// window opening var window_opening = []; var opening_order = ['none', 'left tilt', 'right tilt', 'left', 'right'];</span></span></code> </pre><br>  Fill the array with default data.  Not the best option, but at the time of writing I was thinking about something else - about the likely preservation of data. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">set_opening</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">leaf_count</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; leaf_count; i++) { window_opening.push(opening_order[<span class="hljs-number"><span class="hljs-number">0</span></span>]); } }</code> </pre><br><br>  At the click, the opening of the sash should change.  In the cycle of the possibilities of opening: no, left, right, left and leans back, right and leans back. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">trigger_opening</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">num</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> current = opening_order.indexOf(window_opening[num]); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((current + <span class="hljs-number"><span class="hljs-number">2</span></span>) &gt; opening_order.length) { current = <span class="hljs-number"><span class="hljs-number">0</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { current++; } window_opening[num] = opening_order[current]; window_data(); }</code> </pre><br><br>  And then, without going far ... <br><br><h1>  Preservation </h1><br>  Data after editing must be saved. <br>  I will do serialization by hand. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_data</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> string = order.type + <span class="hljs-string"><span class="hljs-string">'|'</span></span> + order.leafs; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> window_opening) { string += <span class="hljs-string"><span class="hljs-string">'|'</span></span> + window_opening[i]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> select = $(<span class="hljs-string"><span class="hljs-string">'input[name="window_type"]'</span></span>); select.val(string); }</code> </pre><br><br>  And now no one bothers to draw windows from saved data. <br><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">window_from_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">string</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! string.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = string.split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { window_opening[i] = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; } big_window(data[<span class="hljs-number"><span class="hljs-number">0</span></span>],data[<span class="hljs-number"><span class="hljs-number">1</span></span>]); }</code> </pre><br><br>  The configuration of windows can be drawn in the lists of orders, it is very convenient.  Small pictures. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">small_window_from_string</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">element, string, width, height</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ( ! string.length) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> small_canvas = $(<span class="hljs-string"><span class="hljs-string">'&lt;canvas&gt;&lt;/canvas&gt;'</span></span>). attr(<span class="hljs-string"><span class="hljs-string">'width'</span></span>,width). attr(<span class="hljs-string"><span class="hljs-string">'height'</span></span>,height). appendTo(element); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> data = string.split(<span class="hljs-string"><span class="hljs-string">'|'</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">var</span></span> i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i &lt; <span class="hljs-number"><span class="hljs-number">10</span></span>; i++) { window_opening[i] = data[i + <span class="hljs-number"><span class="hljs-number">2</span></span>]; } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> leafs = data[<span class="hljs-number"><span class="hljs-number">1</span></span>]; <span class="hljs-keyword"><span class="hljs-keyword">switch</span></span> (data[<span class="hljs-number"><span class="hljs-number">0</span></span>]) { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'single'</span></span>: window_vertical(small_canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, leafs, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'vertical'</span></span>: window_vertical(small_canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, leafs, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'horisontal'</span></span>: window_horisontal(small_canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, leafs, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-string"><span class="hljs-string">'t'</span></span>: window_t(small_canvas, <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>, width, height, leafs, <span class="hljs-literal"><span class="hljs-literal">false</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">break</span></span>; } }</code> </pre><br><br><h1>  When to draw? </h1><br>  The program must somehow understand that it is time to draw windows. <br>  Based on the TK, there are two options - the form field and &lt;div /&gt; in an arbitrary place. <br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows_handler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// add or edit var select = $('input[name="window_type"]'); if (select.length) { select.hide(); windows_init(select); window_from_string(select.val()); } // show small window $('.magic_make_window').each(function() { small_window_from_string($(this),$(this).attr('window'), $(this).width(), $(this).height()) }); }</span></span></code> </pre><br><br>  Perhaps input [name = "window_type"] is not the best solution.  Just for this moment I had a goal to launch the program into work, and I didn‚Äôt want to modify CMS at all - so I taught the plugin to search for its field by its name: windows_type. <br><br>  If you make a library out of this program, you need to put the selector in a variable.  And be sure to wrap it in a class to close the namespace, etc. <br><br><h1>  Total </h1><br>  Here is the revised code.  This is beta, and she went into production without any changes. <br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ set_opening(<span class="hljs-number"><span class="hljs-number">10</span></span>); }); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">windows_handler</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-comment"><span class="hljs-comment">// add or edit var select = $('input[name="window_type"]'); if (select.length) { select.hide(); windows_init(select); window_from_string(select.val()); } // show small window $('.magic_make_window').each(function() { small_window_from_string($(this),$(this).attr('window'), $(this).width(), $(this).height()) }); } function small_window_from_string(element, string, width, height) { if ( ! string.length) { return; } var small_canvas = $('&lt;canvas&gt;&lt;/canvas&gt;'). attr('width',width). attr('height',height). appendTo(element); var data = string.split('|'); for (var i = 0; i &lt; 10; i++) { window_opening[i] = data[i + 2]; } var leafs = data[1]; switch (data[0]) { case 'single': window_vertical(small_canvas, 0, 0, width, height, leafs, false); break; case 'vertical': window_vertical(small_canvas, 0, 0, width, height, leafs, false); break; case 'horisontal': window_horisontal(small_canvas, 0, 0, width, height, leafs, false); break; case 't': window_t(small_canvas, 0, 0, width, height, leafs, false); break; } } function window_from_string(string) { if ( ! string.length) { return; } var data = string.split('|'); for (var i = 0; i &lt; 10; i++) { window_opening[i] = data[i + 2]; } big_window(data[0],data[1]); } var window_width = 900; var window_height = 350; var catalog_height = window_width / 18; var padding = 15; var window_canvas; var window_blue = '#8CD3EF'; var window_silver = 'white'; var window_gray = 'black'; var order = {type: undefined, leafs: undefined}; function window_data() { var string = order.type + '|' + order.leafs; for (var i in window_opening) { string += '|' + window_opening[i]; } var select = $('input[name="window_type"]'); select.val(string); } function windows_init(selector) { window_canvas = $('&lt;canvas&gt;&lt;/canvas&gt;'). attr('width',window_width). attr('height',window_height). attr('background','blue'). insertAfter(selector); windows_catalog(); } function windows_catalog() { window_horisontal( window_canvas, 0, padding, catalog_height, catalog_height, 1, {type: 'single', leafs: 1, from: 'catalog'}); var offset = catalog_height + padding; for (var i = 2; i &lt; 5; i++) { window_vertical( window_canvas, offset, padding, catalog_height * (i / 2), catalog_height, i, {type: 'vertical', leafs: i, from: 'catalog'}); offset += padding + (catalog_height * (i / 2)); } //~ for (var i = 2; i &lt; 6; i++) //~ { window_horisontal( window_canvas, offset, padding, catalog_height, catalog_height, 2, {type: 'horisontal', leafs: 2, from: 'catalog'}); offset += padding + catalog_height; //~ } for (var i = 0; i &lt; 3; i++) { window_t( window_canvas, offset, padding, catalog_height, catalog_height, i + 2, {type: 't', leafs: i + 2, from: 'catalog'}); offset += padding + catalog_height } } function window_t(canvas, x,y,width, height,leafs, window) { var w = width / leafs; make_leaf(canvas, x, y, width, height / 3, window, 0); for (var i = 0; i &lt; leafs; i++) { var leaf_x = x + (w * i); var leaf_y = y + (height / 3 ); var leaf_width = w; var leaf_height = height * 2 / 3; var leaf_num = i + 1; make_leaf(canvas, leaf_x,leaf_y,leaf_width, leaf_height, window, leaf_num); if (window.from != 'catalog') { opening(canvas, leaf_x,leaf_y,leaf_width, leaf_height, leaf_num); } } } function window_vertical(canvas, x, y, width, height, leafs, window) { var leaf = width / leafs; for (var i = 0; i &lt; leafs; i++) { var leaf_x = x + (leaf * i); var leaf_y = y; var leaf_width = leaf; var leaf_height = height; var leaf_num = i; make_leaf(canvas, leaf_x, leaf_y, leaf_width, leaf_height, window, leaf_num); if (window.from != 'catalog') { opening(canvas, leaf_x, leaf_y, leaf_width, leaf_height, leaf_num); } } } function window_horisontal(canvas, x, y, width, height, leafs, window) { var leaf = height / leafs; for (var i = 0; i &lt; leafs; i++) { var leaf_x = x; var leaf_y = y + (leaf * i); var leaf_width = width; var leaf_height = leaf; var leaf_num = i; make_leaf(canvas, leaf_x,leaf_y,leaf_width, leaf_height, window, leaf_num); if (window.from != 'catalog') { opening(canvas, leaf_x,leaf_y,leaf_width, leaf_height, leaf_num); } } } function make_leaf(canvas, x,y, width, height, window, leaf_num) { canvas.drawRect({ layer: true, strokeStyle: window_silver, fillStyle: window_blue, strokeWidth: 1, x: x, y: y, width: width, height: height, fromCenter: false, click: function(layer) { leaf_clicked(window, leaf_num) } }); } function big_window(window_type, leafs) { var padding_top = catalog_height + (padding * 2); if (window_width &gt; window_height) { var segment = window_height - padding_top; } //~ else //~ { //~ var segment = (window_width - catalog_height - (padding * 3)) / 2; //~ } order.type = window_type; order.leafs = leafs; window_data(); switch (window_type) { case 'single': window_vertical( window_canvas, 0, padding_top, segment, segment, leafs, {type: 'single', leafs: 1, size: 'big'}); break; case 'vertical': window_vertical( window_canvas, 0, padding_top, segment /2 * leafs, segment, leafs, {type: 'vertical', leafs: leafs, size: 'big'}); break; case 'horisontal': window_horisontal( window_canvas, 0, padding_top, (segment * 2) / leafs, segment, leafs, {type: 'horisontal', leafs: leafs, size: 'big'}); break; case 't': window_t( window_canvas, 0, padding_top, segment, segment, leafs, {type: 't', leafs: leafs, size: 'big'}); break; } } function leaf_clicked(window, leaf_num) { if ( ! window) { return; } window_canvas.clearCanvas(); windows_catalog(); if (window.size == 'big') { trigger_opening(leaf_num); } big_window(window.type, window.leafs); } function opening(canvas, x, y, width, height, num) { switch (window_opening[num]) { case 'left': open_left(canvas, x, y, width, height); break; case 'left tilt': open_left(canvas, x, y, width, height); tilt(canvas, x, y, width, height); break; case 'right': open_right(canvas, x, y, width, height); break; case 'right tilt': open_right(canvas, x, y, width, height); tilt(canvas, x, y, width, height); break; } } // window opening draw function open_left(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x, y1: y, x2: x + width, y2: y + (height / 2), x3: x, y3: y + height, }); } function open_right(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x + width, y1: y, x2: x, y2: y + (height / 2), x3: x + width, y3: y + height, }); } function tilt(canvas, x, y, width, height) { canvas.drawLine({ strokeStyle: window_gray, strokeWidth: 1, x1: x, y1: y + height, x2: x + (width / 2), y2: y, x3: x + width, y3: y + height, }); } // window opening var window_opening = []; var opening_order = ['none', 'left tilt', 'right tilt', 'left', 'right']; function set_opening(leaf_count) { for (var i = 0; i &lt; leaf_count; i++) { window_opening.push(opening_order[0]); } } function trigger_opening(num) { var current = opening_order.indexOf(window_opening[num]); if ((current + 2) &gt; opening_order.length) { current = 0; } else { current++; } window_opening[num] = opening_order[current]; window_data(); }</span></span></code> </pre><br><br>  What is not shown in the article.  The windows_handler function is triggered by another JS component, based on two events: document.ready and successful loading of the Ajax data.  Thus, the windows are drawn immediately after the page loads, and redrawn if interactive data refresh occurs (‚Äúlive mode‚Äù). <br>  All user cases are performed.  I made a simple test with a lot of redrawing without rebooting, left the car running with chrome and mobile for a while - the memory is not burning.  I drove the same test for several hours in chrome and in a safari on the iPad and MacBook.  No problems detected. <br><br><h1>  Screenshots </h1><br>  A small picture is created on the client on the fly (it prints perfectly) <br><img src="//habrastorage.org/files/023/9be/430/0239be4304754c688b516791d83297c1.png"><br><br>  Big picture.  Dimensions can be adjusted, someday. <br><img src="//habrastorage.org/files/d05/6ca/059/d056ca059300409880cab51ec33e8be5.png"><br><br>  In edit mode.  Clicking on a small window in the directory changes the configuration of a large (and immediately the data in input type = hidden). <br><img src="//habrastorage.org/files/8d0/9d8/141/8d09d814127b4c478f8a638ae95f2f98.png"><br><br>  Clicking on the sash of a large window changes the sash opening. <br><img src="//habrastorage.org/files/945/28d/04e/94528d04e17a4fd8a5904d7206d43a94.png"><br><br><h1>  Beauty! </h1><br>  There were no changes in the CMS.  The window is added and edited in a hidden field, drawn in a div.  It turns out that the window configurator can be thrown into an arbitrary WordPress - just by connecting this script. <br><br>  At the moment, thanks to this decision, a lot of new windows have been sold, ordered and installed. <br><br>  It would be nice to put this code in some sandbox, along with the tests.  How do you think? <br><br>  Report remarks in lichku. <br><br>  Thank! </div><p>Source: <a href="https://habr.com/ru/post/238065/">https://habr.com/ru/post/238065/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../238053/index.html">How to produce PLA for 3d-printers. Report from the workshop</a></li>
<li><a href="../238055/index.html">Spain considers Bitcoin an electronic payment system</a></li>
<li><a href="../238057/index.html">Future of Virgin Galactic transorbital flights: 45 minutes from London to New York, an hour and a half from London to Sydney</a></li>
<li><a href="../238059/index.html">Virtualization¬≤</a></li>
<li><a href="../238063/index.html">The Dude. Setting up email notifications for toner level in network printers</a></li>
<li><a href="../238069/index.html">Deploying Rails Applications with Docker</a></li>
<li><a href="../238071/index.html">About creating platformer on Unity. Part Three, the long-awaited</a></li>
<li><a href="../238073/index.html">Customs duties on the package still to be, and soon</a></li>
<li><a href="../238075/index.html">How does friendship begin with Active Directory</a></li>
<li><a href="../238077/index.html">Expandable mappings of any type of value without using macros</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>