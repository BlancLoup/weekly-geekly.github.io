<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Recognize barcodes on images using Python and OpenCV</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="From the translator: we at Enterra are very fond of computer vision algorithms. We work most often with OpenCv. From time to time different developers...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Recognize barcodes on images using Python and OpenCV</h1><div class="post__text post__text-html js-mediator-article">  <i>From the translator: we at <a href="http://www.enterra.ru/">Enterra are</a> very fond of computer vision algorithms.</i>  <i>We work most often with OpenCv.</i>  <i>From time to time different developers write to us with the questions: ‚ÄúWhat is the best way to start working with OpenCv?‚Äù Or ‚ÄúWhat interesting task can you just solve with OpenCv?‚Äù In connection with which we decided to translate a very good article that will be useful to everyone interested in computer vision.</i> <br><br><img src="https://habrastorage.org/files/c3e/8ef/0e4/c3e8ef0e415d46cd81d8e4f6c29b33c1.jpg"><br><br>  Black Friday is near. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Crowds of evil buyers.  A swarm of identical middle-aged aunts who are ready to gobble up almost anything in the nearest supermarket - the main thing is that with a 75% discount.  They will line up in front of the shops at midnight of Thanksgiving.  They will burst inside, knock on locked doors with their fists and heads until they flatten each other and smash their hands into blood, becoming like the zombies from "28 days later."  But instead of human flesh, they are eager to satisfy the buyer's instinct.  Their battle cries for discounts and sales reach heaven.  And their thunder can lead to an earthquake on the Great Plain. <br><br>  Naturally, do not expect help from the media - they will savor every detail.  From frostbitten families who spent the night in a tent in the cold, to an old lady trampled by hunters for a discount at the moment when the doors opened.  Something similar happened to Gallimus in the Jurassic Park.  And she just wanted to buy Halo for nine-year-old grandson Timmy, whose parents forgot to do it last year.  In Wal-Mart.  During Black Friday. <br><br>  And I have to ask: is all this chaos and bedlam worth it? <br><br>  <b>Damn it, no!</b> <br><br>  Any purchase I make on this Black Friday will be made completely safe with a laptop.  But if you decide to go into the real world and start a fight with the bounty hunters, <b>you first need to download the code from the <a href="http://www.pyimagesearch.com/2014/11/24/detecting-barcodes-images-python-opencv/">original post</a></b> . <br><br>  Just imagine how stupid you will look when standing in line waiting for a free ticket office - just to find out after scanning the last season's ‚ÄúGame of Thrones‚Äù barcode that you can buy it at $ 5 cheaper at Target? <br><br>  Actually, then I will show how you can detect a barcode on an image using only Python and OpenCV. <a name="habracut"></a><br><br><h3>  We recognize streakhod on images on Pyhton and OpenCv </h3><br>  The goal of this post is to show a simple application of computer vision and image processing technologies for barcode recognition.  My algorithm is a variation on the topic from here <a href="http://stackoverflow.com/questions/9013703/how-to-find-the-location-of-red-region-in-an-image-using-matlab/9014569">with StackOverflow</a> .  I looked through the original code and added a number of updates and improvements to it.  It is worth noting that this code will not work for all bar codes, but in any case, you will get an idea of ‚Äã‚Äãwhat methods you need to use. <br><br>  It is important to note that the algorithm will not work for <i>all bar codes</i> , but it will give a basic intuitive understanding of what techniques should be used for this. <br><br>  For example, we will define a barcode from the following image: <br><br><img src="https://habrastorage.org/files/5aa/4dc/e1a/5aa4dce1a6fd417e8b9df368d6c93842.jpg"><br><br>  Let's go to the code.  Open a new file, call it <code>detect_barcode.py</code> - and go: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># import the necessary packages import numpy as np import argparse import cv2 # construct the argument parse and parse the arguments ap = argparse.ArgumentParser() ap.add_argument("-i", "--image", required = True, help = "path to the image file") args = vars(ap.parse_args())</span></span></code> </pre><br>  First of all, you need to import the necessary packages.  We need NumPy for working with numbers, <code>agparse</code> for parsing command line arguments, and <code>cv2</code> for communicating with OpenCV. <br><br>  Next, we process the command line arguments.  We will use the single argument <code>--image</code> to specify the path to the image with a barcode. <br><br>  Now let's proceed to the immediate image processing: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># load the image and convert it to grayscale image = cv2.imread(args["image"]) gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY) # compute the Scharr gradient magnitude representation of the images # in both the x and y direction gradX = cv2.Sobel(gray, ddepth = cv2.cv.CV_32F, dx = 1, dy = 0, ksize = -1) gradY = cv2.Sobel(gray, ddepth = cv2.cv.CV_32F, dx = 0, dy = 1, ksize = -1) # subtract the y-gradient from the x-gradient gradient = cv2.subtract(gradX, gradY) gradient = cv2.convertScaleAbs(gradient)</span></span></code> </pre>  We load the image <code>image</code> and convert its color mode to shades of gray. <br><br>  Then, we use the Sobel operator (with <code>ksize = -1</code> ) to calculate the gradient value of the gray image in the vertical and horizontal directions. <br><br>  After that, we subtract the y-gradient of the Sobel operator from the x-gradient.  After subtraction, we get an image with a high horizontal gradient value and a low vertical value. <br><br>  And now our image looks like this: <br><br><img src="https://habrastorage.org/files/785/ffa/307/785ffa307e5146d5a877d90da6c28474.jpg"><br><br>  <b>Notice that the barcode area was determined using gradient operations.</b>  The next step is to eliminate the noise in the image and focus exclusively on the area with the barcode. <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># blur and threshold the image blurred = cv2.blur(gradient, (9, 9)) (_, thresh) = cv2.threshold(blurred, 225, 255, cv2.THRESH_BINARY)</span></span></code> </pre>  And the first thing we do is use average blur with a 9x9 core.  This will help smooth out the high-frequency noise in our picture with gradients. <br><br>  Then we will binarize the blurred image.  Each pixel of an image with a value not higher than 225 we will turn into 0 (black), and the rest - into 255 (white).  As a result, we get: <br><br><img src="https://habrastorage.org/files/7ef/d42/f37/7efd42f3779b49d7a42b335c7bff2f82.jpg"><br>  However, as you can see in the original image, there is space between the vertical bars of the barcode.  To close it and make it easier for our algorithm to determine the barcode area, we need to perform a series of simple morphological operations: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># construct a closing kernel and apply it to the thresholded image kernel = cv2.getStructuringElement(cv2.MORPH_RECT, (21, 7)) closed = cv2.morphologyEx(thresh, cv2.MORPH_CLOSE, kernel)</span></span></code> </pre>  We start by creating a rectangle with <code>cv2.getStructuringElement</code> .  The width of the core is greater than its height, which allows us to cover the space between the vertical bars of the barcode. <br><br>  Next, we perform our morphological operation by applying the core to the binarized image, glossing over the space between the stripes.  And you can see for yourself that the ‚Äúgaps‚Äù are almost completely closed compared to the images above: <br><br><img src="https://habrastorage.org/files/bb7/80e/48b/bb780e48b2d84779a279ca9dedacfb3b.jpg"><br><br>  Of course, some light spots remained on the picture, which are not related to the barcode and can interfere with the exact definition of its contour. <br><br>  Let's try to get rid of these stains: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># perform a series of erosions and dilations closed = cv2.erode(closed, None, iterations = 4) closed = cv2.dilate(closed, None, iterations = 4)</span></span></code> </pre><br>  Here we do four iterations of erosion, followed by four iterations of dilation.  Erosion will remove white pixels from the image, removing small blobs, and dilatation will not allow large white areas to decrease.  Removed during blurring small spots during stretching will not appear again. <br><br>  After a series of erosions and dilations, one can see that small spots were successfully removed, only the barcode area remained: <br><br><img src="https://habrastorage.org/files/ace/9c5/a78/ace9c5a789ab4710994308ebeb911b76.jpg"><br><br>  Finally, let's find the outlines of the barcode area on the image: <br><br><pre> <code class="python hljs"><span class="hljs-comment"><span class="hljs-comment"># find the contours in the thresholded image, then sort the contours # by their area, keeping only the largest one (cnts, _) = cv2.findContours(closed.copy(), cv2.RETR_EXTERNAL, cv2.CHAIN_APPROX_SIMPLE) c = sorted(cnts, key = cv2.contourArea, reverse = True)[0] # compute the rotated bounding box of the largest contour rect = cv2.minAreaRect(c) box = np.int0(cv2.cv.BoxPoints(rect)) # draw a bounding box arounded the detected barcode and display the # image cv2.drawContours(image, [box], -1, (0, 255, 0), 3) cv2.imshow("Image", image) cv2.waitKey(0)</span></span></code> </pre><br>  Fortunately, it is quite simple.  We find the largest contour in the image using <code>cv2.findContours</code> , which (if processed correctly) corresponds exactly to the barcode area. <br><br>  Then we define the minimum bounding box in which we enclose this largest contour, after which we finally display the barcode found. <br><br>  As you can see, we successfully found the barcode: <br><br><img src="https://habrastorage.org/files/8a9/68d/90e/8a968d90ea904b25b5782c92bb4f0234.jpg"><br>  Trying to do this with a few more images? <br><br><h3>  Successful Barcode Detection </h3><br>  To get similar results, use my code (you can download it entirely on the original page) and the images shown here.  Once you have the code and images, open a terminal and run the following command: <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> detect_barcode.py --<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> images/barcode_02.jpg</code> </pre><br><img src="https://habrastorage.org/files/ca1/49c/e84/ca149ce84a3746ea83cfde3a2557c50c.jpg">  No problem found barcode of coconut oil.  We try again: <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> detect_barcode.py --<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> images/barcode_03.jpg</code> </pre><img src="https://habrastorage.org/files/362/ccc/fb2/362cccfb28194416879d4d8a2c1fe7e0.jpg">  And on this image we successfully found a barcode!  But what are we all about food, let's move on to the books. <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> detect_barcode.py --<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> images/barcode_04.jpg</code> </pre><img src="https://habrastorage.org/files/2a9/3cd/7fc/2a93cd7fc6fe40cd8ebede0638e9c5f6.jpg">  And again - no problem!  Can we identify the tracking number for the parcel? <br><br><pre> <code class="hljs mel"><span class="hljs-number"><span class="hljs-number">1</span></span> $ <span class="hljs-keyword"><span class="hljs-keyword">python</span></span> detect_barcode.py --<span class="hljs-keyword"><span class="hljs-keyword">image</span></span> images/barcode_05.jpg</code> </pre><img src="https://habrastorage.org/files/ffc/add/618/ffcadd61855d444fb555435ab3d055ae.jpg"><br><br>  And again, our algorithm successfully detected a barcode. <br><br><h3>  Conclusion </h3><br>  In this post, we looked at the necessary steps to detect bar codes on images using computer vision technology.  We applied an algorithm using the Python programming language and the OpenCV library. <br><br>  Our algorithm is based on the following actions: <ol><li>  Calculate the size of the gradient along the x and y axes. </li><li>  Separate the vertical gradient from the horizontal to reveal the barcode area. </li><li>  Apply blur and binarization. </li><li>  Apply the core to the binarized image to remove the ‚Äúgaps‚Äù between the stripes. </li><li>  Produce a series of erosions and dilations. </li><li>  Find the largest contour in the image, which will be the barcode area. </li></ol>  It is worth noting that, since the method is based on the representation of an image in the form of a gradient, it will work correctly only for horizontal bar codes. <br><br>  If you want to use a more reliable barcode detection algorithm, you should take into account the orientation of the image, and even better - use self-learning systems, such as the Haar or HOG + Linear SVM cascades, to ‚Äúscan‚Äù the image for areas with a barcode. </div><p>Source: <a href="https://habr.com/ru/post/244163/">https://habr.com/ru/post/244163/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../244151/index.html">OpenVZ, Quagga and LiveMigration</a></li>
<li><a href="../244153/index.html">Facebook launches data center with new network architecture</a></li>
<li><a href="../244155/index.html">Multitasking in the Linux kernel: workqueue</a></li>
<li><a href="../244159/index.html">ATM attack with Raspberry Pi</a></li>
<li><a href="../244161/index.html">Trader trader competitor?</a></li>
<li><a href="../244165/index.html">Beta new Opera Mini for Android with sync</a></li>
<li><a href="../244169/index.html">Amazon will compete for the creation of a "green Internet"</a></li>
<li><a href="../244171/index.html">A golden age of design</a></li>
<li><a href="../244175/index.html">Responsive images in practice (Part 1)</a></li>
<li><a href="../244177/index.html">Responsive images in practice (Part 2)</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>