<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Migrating with Ruby</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="I am sure that a huge number of users live in Habr√©, licked while reading descriptions of technologies and architectures used in young, dynamic and, m...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Migrating with Ruby</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/geektimes/post_images/d39/194/c4c/d39194c4c35ae23f1cc877843ad951e1.jpg" alt="image" align="left">  I am sure that a huge number of users live in Habr√©, licked while reading descriptions of technologies and architectures used in young, dynamic and, most importantly, fast-growing companies in their user base.  Unfortunately, a relatively small number of our compatriots work in such companies around the world, and those who still work in the domestic kitchen are bound by various conditions of employment contracts or commonplace NDAs that prohibit the public from disclosing the most interesting details.  Nevertheless, I personally know a large number of specialists, especially those interested in high loads and who do not know where to get this information first-hand. <br><br>  This problem can be solved in the only way - to give the floor to one of the managers of the development department or to any other person who is in an adequately high position and knowledgeable in development, and after that - pull, pull all the details out of it.  Something like the <a href="http://infoq.com/">Information Queue</a> did, interviewing one of Twitter‚Äôs engineers, Evan Weaver, about why the company had been developing on the rails for so long, decided to switch to using other technologies and what consequences it had. <br><br>  In this article I will fully refer to the words of Evan, explaining the essence of migration and the benefits derived from the use of JVM, first of all - performance and, all the same, scalability.  But as we will find out a little later, the decision was also dictated by the desire to isolate individual services, as well as slightly change the overall architecture of the product. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      So, the story begins last year, when Twitter announced changes in the backend architecture (message queue), and also announced its intention to rewrite Twitter Storage on Scala, and in the spring, work began on rewriting the entire search engine.  As part of these changes, the MySQL database (underlying the search) was replaced by <a href="http://lucene.apache.org/">Lucene</a> .  And, finally, quite recently, the development team <a href="http://engineering.twitter.com/2011/04/twitter-search-is-now-3x-faster_1656.html">announced the replacement of</a> Ruby on Rails in the search area - in its place was a Java server, which they call Blender.  The result of this replacement was a threefold reduction in the delay in executing a search query. <br><a name="habracut"></a><br><h4>  Overview </h4><br>  One of the first conclusions that can be made by looking at the overall architecture of Twitter is that many of the decisions of its developers seem perfectly pragmatic.  For example, in the backend of the product, both MySQL and the distributed <a href="http://cassandra.apache.org/">Cassandra database are used</a> .  Few people know about Twitter‚Äôs own development: <a href="https://github.com/twitter/gizzard">Gizzard</a> is the framework used to create distributed repositories based on MySQL databases.  According to Weaver, "it is mainly used for highly structured data (SLA-data) because it is not relatively flexible." <br><br>  All real-time data is obtained from either Gizzard / MySQL or Cassandra.  Also, the architecture actively uses the stack for distributed Hadoop computing for offline costing, while the system built using the key-value <a href="http://redis.io/">Redis</a> database and the aforementioned Gizzard is used online. <br><br>  The relationship between the frontend and backend levels is realized through the development of Facebook - <a href="http://thrift.apache.org/">Thrift</a> (interface description language, used as <a href="http://en.wikipedia.org/wiki/Apache_Thrift">RPC</a> ) and the JSON REST API used in all ‚Äúofficial‚Äù clients from Twitter and the new product site. <br><br><h4>  Languages </h4><br>  A similar, pragmatic approach is seen in the choice of programming languages ‚Äã‚Äãused in the company.  Level 1 languages: JavaScript, Ruby, Scala and Java.  The same work is partially supported in C, but new services are not written on it.  In general, Evan talks about the transition to Scala of developers with knowledge of Ruby and the use of Java by those who have previously been spinning in the field of C / C ++. <br><br>  As for the search engine team, here the tools dictate the choice of languages.  Since Lucene is built in Java, programmers have to operate primarily in this language. <br><br>  In order to allow developers to choose the ideal work language for them, Twitter has put a lot of effort and money into writing internal frameworks that encapsulate the common efforts of all teams.  <a href="http://twitter.github.com/finagle/">Finagle</a> (written in Scala), for example, is a library for creating asynchronous RPC servers and clients in Java, Scala, or any other language on the JVM platform. <br><br>  While the whole backend is gradually moving towards the JVM, the front-end (client) code is increasingly leaning towards using browser-based JavaScript, reducing the share of the Ruby language. <br><br><h4>  Search: From Ruby to Java </h4><br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/84a/72c/1c9/84a72c1c969956f8c69f0533fa21035d.jpg" alt="image"><br><br>  The transition from Ruby to the Java-based Blender framework was accomplished in two steps.  The first was to replace the existing MySQL back-end with a reversed index in real time, based on Lucene and named Earlybird.  Its commissioning doubled the efficiency of the memory used, as well as the flexibility to add various search filters to help support the rapidly growing demand for search by product.  A more detailed description of the mechanism of operation of this part of the system was <a href="http://engineering.twitter.com/2011/05/engineering-behind-twitters-new-search.html">described by Twitter engineers</a> . <br><br>  In order to solve the problem of poor front-end performance, the development team built a Java Blender server.  Blender is the Thrift and HTTP API service already mentioned, built on <a href="http://www.jboss.org/netty">Netty</a> and the NEW I / O (NIO) scalable client / server library written in Java and allows you to develop various server protocols.  Netty allows the company to create fully asynchronous aggregation services that can collect results from several back-end services (such as real-time indices, top tweets, and geo-data). <br><br>  This made it possible to avoid high I / O queues, optimizing CPU performance and processing current requests faster.  In addition, many requests in the backend can be processed in parallel, which significantly reduces latency. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/cdb/0f6/ec7/cdb0f6ec78ba4cbb11bc45d385ae2e70.jpg" alt="image"><br><br>  Twitter's search engine is one of the busiest in the world, processing about a billion queries per day.  The result of the transition to Blender was simply fantastic: 95% of requests were processed three times faster, the delay decreased from 800ms to 250ms, and the load on the processors at both ends (front-end) of the product was reduced by half.  Today's facilities allow the product to process 10 times more requests for a machine than it was before applying these technologies in architecture.  Thus, the company reduces the cost of services required to maintain the entire architecture in a high-performance state. <br><br>  And although performance and scalability were important problems, due to which it was necessary to increase the use of JVM - Evan says that encapsulation is still the key point of this transition, because  Twitter's current architecture, in general, is doing well.  The transition to JVM was largely dictated by the fact that the productivity of developers on it is higher and, as a result, the productivity of the entire product. <br><br>  The combination of the Ruby on Rails framework along with the MySQL database has been very popular for Western startups over the past years.  The advantages are clear: developers could quickly test new and simple ideas in order to test their returns in terms of working in a real market, where supply is dictated by user demand.  However, the disadvantages of such a bundle are also quite obvious - problems of scalability and performance, as well as some immaturity of libraries and tools, as regards RoR in the first place. <br><br>  Thanks for the help in precise wording to ivaxer <a href="http://geektimes.ru/users/ivaxer/" class="user_link">Habrawer</a> <br><br>  <a href="http://www.infoq.com/articles/twitter-java-use">InfoQ</a> via <a href="http://www.readwriteweb.com/hack/2011/07/twitter-java-scala.php">RRW</a> </div><p>Source: <a href="https://habr.com/ru/post/123778/">https://habr.com/ru/post/123778/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../123767/index.html">Learn Haskel for good! Applicative Functors</a></li>
<li><a href="../123768/index.html">On the specifics of children's perception and peculiarities of mental development by the console and igraham</a></li>
<li><a href="../123771/index.html">The long-awaited release of Centos 6.0</a></li>
<li><a href="../123776/index.html">The ‚ÄúGoogle +1‚Äù button is more popular than the Twitter button.</a></li>
<li><a href="../123777/index.html">Virtual fitting room based on Kinect</a></li>
<li><a href="../123779/index.html">About homemade brand disc envelopes</a></li>
<li><a href="../123781/index.html">Final Cut Pro X: Causes of Hysteria</a></li>
<li><a href="../123782/index.html">What you need to know Android developer</a></li>
<li><a href="../123783/index.html">Online store. Semi-automatic add goods</a></li>
<li><a href="../123784/index.html">Which of the new C ++ 0x features would you most like to see in Visual C ++ 2012?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>