<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Writing a web service on Scalatra</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Scalatra is a lightweight, high-performance web framework close to Sinatra , which can make your life a lot easier when switching from Ruby to Scala. ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Writing a web service on Scalatra</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://github.com/scalatra/scalatra"><i>Scalatra</i></a> is a lightweight, high-performance web framework close to <i>Sinatra</i> , which can make your life a lot easier when switching from Ruby to Scala.  In this article, I want to fill the gap in the absence of manuals in Russian for this interesting framework using the example of creating a simple application with the ability to authenticate. <br><a name="habracut"></a><br><h2>  Installation </h2><br>  <a href="http://scalatra.org/2.4/getting-started/installation.html">Official documentation</a> suggests creating a project using <a href="https://github.com/n8han/giter8">giter8</a> from a previously prepared template.  However, if you want to do without extra tools, you can simply create a sbt project, as follows: <br><br>  <u>project \ plugins.sbt</u> <br><br><pre><code class="scala hljs">addSbtPlugin(<span class="hljs-string"><span class="hljs-string">"com.earldouglas"</span></span> % <span class="hljs-string"><span class="hljs-string">"xsbt-web-plugin"</span></span> % <span class="hljs-string"><span class="hljs-string">"1.1.0"</span></span>)</code> </pre> <br>  This plugin will allow you to run a web service using a special <i>sbt</i> command: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre> <code class="bash hljs">$ sbt &gt; container:start</code> </pre><br>  <u>build.sbt</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scalatraVersion = <span class="hljs-string"><span class="hljs-string">"2.4.0-RC2-2"</span></span> resolvers += <span class="hljs-string"><span class="hljs-string">"Scalaz Bintray Repo"</span></span> at <span class="hljs-string"><span class="hljs-string">"https://dl.bintray.com/scalaz/releases"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> root = (project in file(<span class="hljs-string"><span class="hljs-string">"."</span></span>)).settings( organization := <span class="hljs-string"><span class="hljs-string">"com.example"</span></span>, name := <span class="hljs-string"><span class="hljs-string">"scalatra-auth-example"</span></span>, version := <span class="hljs-string"><span class="hljs-string">"0.1.0-SNAPSHOT"</span></span>, scalaVersion := <span class="hljs-string"><span class="hljs-string">"2.11.6"</span></span>, scalacOptions ++= <span class="hljs-type"><span class="hljs-type">Seq</span></span>(<span class="hljs-string"><span class="hljs-string">"-unchecked"</span></span>, <span class="hljs-string"><span class="hljs-string">"-deprecation"</span></span>, <span class="hljs-string"><span class="hljs-string">"-feature"</span></span>), libraryDependencies ++= <span class="hljs-type"><span class="hljs-type">Seq</span></span>( <span class="hljs-string"><span class="hljs-string">"org.scalatra"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scalatra-auth"</span></span> % scalatraVersion, <span class="hljs-string"><span class="hljs-string">"org.scalatra"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scalatra"</span></span> % scalatraVersion, <span class="hljs-string"><span class="hljs-string">"org.scalatra"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scalatra-json"</span></span> % scalatraVersion, <span class="hljs-string"><span class="hljs-string">"org.scalatra"</span></span> %% <span class="hljs-string"><span class="hljs-string">"scalatra-specs2"</span></span> % scalatraVersion % <span class="hljs-string"><span class="hljs-string">"test"</span></span>, <span class="hljs-string"><span class="hljs-string">"org.json4s"</span></span> %% <span class="hljs-string"><span class="hljs-string">"json4s-jackson"</span></span> % <span class="hljs-string"><span class="hljs-string">"3.3.0.RC2"</span></span>, <span class="hljs-string"><span class="hljs-string">"javax.servlet"</span></span> % <span class="hljs-string"><span class="hljs-string">"javax.servlet-api"</span></span> % <span class="hljs-string"><span class="hljs-string">"3.1.0"</span></span> % <span class="hljs-string"><span class="hljs-string">"provided"</span></span> ) ).settings(jetty(): _*)</code> </pre><br>  The purpose of the added libraries can be understood from their name, if you do not need <i>json</i> or authentication - you can safely remove unnecessary. <br><br><h2>  Routing </h2><br>  In order for the service to start responding to requests, you first need to specify which controllers will respond to requests.  Create this file for this: <br><br>  <u>src \ main \ webapp \ WEB-INF \ web.xml</u> <br><br><pre> <code class="xml hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.5"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xmlns:xsi</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">xsi:schemaLocation</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>user<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> org.scalatra.example.UserController <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-class</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span>user<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-name</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span>/user/*<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">url-pattern</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">servlet-mapping</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">web-app</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  If you have an aversion to xml, you can describe the same more compactly in this way: <br><br>  <u>src / main / scala / ScalatraBootstrap.scala</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.example._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.<span class="hljs-type"><span class="hljs-type">ServletContext</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScalatraBootstrap</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">LifeCycle</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">init</span></span></span></span>(context: <span class="hljs-type"><span class="hljs-type">ServletContext</span></span>) { context.mount(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">UserController</span></span>, <span class="hljs-string"><span class="hljs-string">"/user"</span></span>) } }</code> </pre><br>  Here we have determined that <i>org.scalatra.example.UserController</i> will respond to requests starting from the path <a href="http://yoursite.example/user">yoursite.example / user</a> .  Let's see how this file works: <br><br>  <u>src \ main \ scala \ org \ scalatra \ example \ UserController.scala</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.scalatra.example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.json4s.{<span class="hljs-type"><span class="hljs-type">DefaultFormats</span></span>, <span class="hljs-type"><span class="hljs-type">Formats</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra._ <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.json.<span class="hljs-type"><span class="hljs-type">JacksonJsonSupport</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> scala.util.{<span class="hljs-type"><span class="hljs-type">Failure</span></span>, <span class="hljs-type"><span class="hljs-type">Success</span></span>, <span class="hljs-type"><span class="hljs-type">Try</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">UserController</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScalatraServlet</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthenticationSupport</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">JacksonJsonSupport</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jsonFormats: <span class="hljs-type"><span class="hljs-type">Formats</span></span> = <span class="hljs-type"><span class="hljs-type">DefaultFormats</span></span> before() { contentType = formats(<span class="hljs-string"><span class="hljs-string">"json"</span></span>) basicAuth() } get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) { <span class="hljs-type"><span class="hljs-type">DB</span></span>.getAllUsers } get(<span class="hljs-string"><span class="hljs-string">"/:id"</span></span>) { <span class="hljs-type"><span class="hljs-type">Try</span></span> { params(<span class="hljs-string"><span class="hljs-string">"id"</span></span>).toInt } <span class="hljs-keyword"><span class="hljs-keyword">match</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Success</span></span>(id) =&gt; <span class="hljs-type"><span class="hljs-type">DB</span></span>.getUserById(id) <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-type"><span class="hljs-type">Failure</span></span>(ex) =&gt; pass() } } }</code> </pre><br>  Let's sort this code in more detail.  To begin with, all controllers in <i>Scalatra</i> must inherit from <i>ScalatraServlet</i> .  To determine the paths that the servlet will respond to, you need to add a get, post, put, or delete block (depending on the type of request), for example: <br><br><pre> <code class="scala hljs"> get(<span class="hljs-string"><span class="hljs-string">"/"</span></span>) { <span class="hljs-comment"><span class="hljs-comment">/*...*/</span></span> }</code> </pre><br>  will respond to requests to <a href="http://yoursite.example/user">yoursite.example / user</a> .  If any of the parameters are part of the URL, you need to describe your parameters like this: <br><br><pre> <code class="scala hljs"> get(<span class="hljs-string"><span class="hljs-string">"/:id"</span></span>) { params(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) }</code> </pre><br>  As a result, inside the get block, you can use the id parameter using the <i>params ()</i> method.  Similarly, you can get the rest of the query parameters.  If you are a <s>pervert,</s> you want to pass several parameters with the same name, for example <i>/ user / 52? Foo = uno &amp; bar = dos &amp; baz = three &amp; foo = anotherfoo</i> (note that the parameter foo occurs 2 times), you can use the <i>multiParams ()</i> function that allows you to process parameters, for example: <br><br><pre> <code class="scala hljs"> multiParams(<span class="hljs-string"><span class="hljs-string">"id"</span></span>) <span class="hljs-comment"><span class="hljs-comment">// =&gt; Seq("52") multiParams("foo") // =&gt; Seq("uno", "anotherfoo") multiParams("unknown") // =&gt; an empty Seq</span></span></code> </pre><br>  I note that the <i>User</i> <i>(Control)</i> method uses the <i>pass ()</i> method.  It allows you to skip processing along this route and go to the following routes (although in this case, there are no more handlers for which this path falls).  If you want to interrupt the processing of the request and show the user an error page, use the <i>halt ()</i> method, which can accept various parameters, such as the return code and the error text. <br>  Another possibility provided by the framework is to set pre- and post-handlers, for example, by writing: <br><br><pre> <code class="scala hljs"> before() { contentType = formats(<span class="hljs-string"><span class="hljs-string">"json"</span></span>) basicAuth() }</code> </pre><br>  You can specify the type of response (in this case <i>json</i> ) and request authentication from the user (authentication and working with json will be discussed in the following sections). <br><br>  More information about routing can be found in the <a href="http/routes.html">official documentation</a> . <br><br><h2>  Work with DB </h2><br>  In the previous section, the objects received from the BD class are used as the controller's response.  However, <i>Scalatra</i> does not have a built-in framework for working with a database, and therefore I left only the imitation of working with the database. <br><br>  <u>src \ main \ scala \ org \ scalatra \ example \ DB.scala</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.scalatra.example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.example.models.<span class="hljs-type"><span class="hljs-type">User</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">object</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">DB</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> users = <span class="hljs-type"><span class="hljs-type">List</span></span>( <span class="hljs-type"><span class="hljs-type">User</span></span>(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-string"><span class="hljs-string">"scalatra"</span></span>, <span class="hljs-string"><span class="hljs-string">"scalatra"</span></span>), <span class="hljs-type"><span class="hljs-type">User</span></span>(<span class="hljs-number"><span class="hljs-number">2</span></span>, <span class="hljs-string"><span class="hljs-string">"admin"</span></span>, <span class="hljs-string"><span class="hljs-string">"admin"</span></span>)) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getAllUsers</span></span></span></span>: <span class="hljs-type"><span class="hljs-type">List</span></span>[<span class="hljs-type"><span class="hljs-type">User</span></span>] = users <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserById</span></span></span></span>(id: <span class="hljs-type"><span class="hljs-type">Int</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">User</span></span>] = users.find(_.id == id) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserByLogin</span></span></span></span>(login: <span class="hljs-type"><span class="hljs-type">String</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">User</span></span>] = users.find(_.login == login) }</code> </pre><br>  <u>src \ main \ scala \ org \ scalatra \ example \ models \ User.scala</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.scalatra.example.models <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">User</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">id: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">Int</span></span></span></span><span class="hljs-class"><span class="hljs-params">, login:</span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span><span class="hljs-class"><span class="hljs-params">, password: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">)</span></span></code> </pre><br>  However, do not think that there are any difficulties with this - the official <a href="http://scalatra.org/2.4/guides/persistence/introduction.html">documentation</a> describes how to make friends with <i>Scalatra</i> with the most popular databases and ORM: <a href="http://scalatra.org/2.4/guides/persistence/slick.html">Slick</a> , <a href="http://scalatra.org/2.4/guides/persistence/mongodb.html">MongoDB</a> , <a href="http://scalatra.org/2.4/guides/persistence/squeryl.html">Squeryl</a> , <a href="http://scalatra.org/2.4/guides/persistence/riak.html">Riak</a> . <br><br><h2>  Json </h2><br>  Please note that the controller returns directly the <i>case class User</i> , and more specifically even Option [User] and List [User].  By default, <i>Scalatra</i> converts the return value to a string and uses it as a response to the request, that is, for example, the answer to the / user request is: <br><br><pre> <code class="html hljs xml">List(User(1,scalatra,scalatra), User(2,admin,admin)).</code> </pre><br>  In order for the servlet to start working with json, you need to: <br><ul><li>  Mix the treasure of <i>JacksonJsonSupport</i> </li><li>  Specify the conversion format to json.  <i>Scalatra</i> uses json4s to work with json, which allows you to create custom conversion rules in json and back.  In our case, the default format will suffice: <br><br><pre> <code class="scala hljs"> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> <span class="hljs-keyword"><span class="hljs-keyword">lazy</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> jsonFormats: <span class="hljs-type"><span class="hljs-type">Formats</span></span> = <span class="hljs-type"><span class="hljs-type">DefaultFormats</span></span></code> </pre></li><li>  Add header with return type: <br><br><pre> <code class="scala hljs">contentType = formats(<span class="hljs-string"><span class="hljs-string">"json"</span></span>)</code> </pre> </li></ul><br>  After performing these simple steps, the answer to the same query / user will become like this: <br><br><pre> <code class="html hljs xml">[{"id":1,"login":"scalatra","password":"scalatra"},{"id":2,"login":"admin","password":"admin"}]</code> </pre><br><br><h2>  Authentication </h2><br>  Finally, I would like to touch on a topic such as user authentication.  For this, it is proposed to use the <i>Scentry</i> framework, which is the <a href="https://github.com/hassox/warden"><i>Warden</i></a> framework ported to Scala, which can also make life easier for people familiar with Ruby. <br>  If you look closely at the <i>UserController</i> class, you can find that authentication has already been implemented in it.  To do this, the <i>AuthenticationSupport</i> treit is mixed into the class and the <i>basicAuth ()</i> method is called in the <i>before ()</i> filter.  Take a look at the implementation of <i>AuthenticationSupport</i> . <br><br>  <u>src \ main \ scala \ org \ scalatra \ example \ AuthenticationSupport.scala</u> <br><br><pre> <code class="scala hljs"><span class="hljs-keyword"><span class="hljs-keyword">package</span></span> org.scalatra.example <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.auth.strategy.{<span class="hljs-type"><span class="hljs-type">BasicAuthStrategy</span></span>, <span class="hljs-type"><span class="hljs-type">BasicAuthSupport</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.auth.{<span class="hljs-type"><span class="hljs-type">ScentrySupport</span></span>, <span class="hljs-type"><span class="hljs-type">ScentryConfig</span></span>} <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.example.models.<span class="hljs-type"><span class="hljs-type">User</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> org.scalatra.<span class="hljs-type"><span class="hljs-type">ScalatraBase</span></span> <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> javax.servlet.http.{<span class="hljs-type"><span class="hljs-type">HttpServletResponse</span></span>, <span class="hljs-type"><span class="hljs-type">HttpServletRequest</span></span>} <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">OurBasicAuthStrategy</span></span></span><span class="hljs-class">(</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">protected override val app: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">ScalatraBase</span></span></span></span><span class="hljs-class"><span class="hljs-params">, realm: </span></span><span class="hljs-type"><span class="hljs-class"><span class="hljs-params"><span class="hljs-type">String</span></span></span></span></span><span class="hljs-class">) </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicAuthStrategy</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">](</span><span class="hljs-params"><span class="hljs-class"><span class="hljs-params">app, realm</span></span></span><span class="hljs-class">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">validate</span></span></span></span>(userName: <span class="hljs-type"><span class="hljs-type">String</span></span>, password: <span class="hljs-type"><span class="hljs-type">String</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> request: <span class="hljs-type"><span class="hljs-type">HttpServletRequest</span></span>, response: <span class="hljs-type"><span class="hljs-type">HttpServletResponse</span></span>): <span class="hljs-type"><span class="hljs-type">Option</span></span>[<span class="hljs-type"><span class="hljs-type">User</span></span>] = { <span class="hljs-type"><span class="hljs-type">DB</span></span>.getUserByLogin(userName).filter(_.password == password) } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getUserId</span></span></span></span>(user: <span class="hljs-type"><span class="hljs-type">User</span></span>)(<span class="hljs-keyword"><span class="hljs-keyword">implicit</span></span> request: <span class="hljs-type"><span class="hljs-type">HttpServletRequest</span></span>, response: <span class="hljs-type"><span class="hljs-type">HttpServletResponse</span></span>): <span class="hljs-type"><span class="hljs-type">String</span></span> = user.id.toString } <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">trait</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">AuthenticationSupport</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">extends</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ScentrySupport</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">] </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">with</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">BasicAuthSupport</span></span></span><span class="hljs-class">[</span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">User</span></span></span><span class="hljs-class">] </span></span>{ self: <span class="hljs-type"><span class="hljs-type">ScalatraBase</span></span> =&gt; <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> realm = <span class="hljs-string"><span class="hljs-string">"Scalatra Basic Auth Example"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">fromSession</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> id: <span class="hljs-type"><span class="hljs-type">String</span></span> =&gt; <span class="hljs-type"><span class="hljs-type">DB</span></span>.getUserById(id.toInt).get } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">toSession</span></span></span><span class="hljs-function"> </span></span>= { <span class="hljs-keyword"><span class="hljs-keyword">case</span></span> usr: <span class="hljs-type"><span class="hljs-type">User</span></span> =&gt; usr.id.toString } <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-keyword"><span class="hljs-keyword">val</span></span> scentryConfig = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">ScentryConfig</span></span> {}.asInstanceOf[<span class="hljs-type"><span class="hljs-type">ScentryConfiguration</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">configureScentry</span></span></span></span>() = { scentry.unauthenticated { scentry.strategies(<span class="hljs-string"><span class="hljs-string">"Basic"</span></span>).unauthenticated() } } <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">def</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">registerAuthStrategies</span></span></span></span>() = { scentry.register(<span class="hljs-string"><span class="hljs-string">"Basic"</span></span>, app =&gt; <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> <span class="hljs-type"><span class="hljs-type">OurBasicAuthStrategy</span></span>(app, realm)) } }</code> </pre><br>  The first thing to do is to define an authentication strategy ‚Äî a class that implements the <i>ScentryStrategy</i> interface.  In this case, we used the <i>BasicAuthStrategy [User] stub that</i> implements some standard methods.  After that, we need to define 2 methods - <i>validate ()</i> , which in case of a successful login should return Some [User], or None in case of invalid data and <i>getUserId ()</i> , which should return a string in order to further add it to the response headers. <br><br>  The next thing to do is to merge <i>OurBasicAuthStrategy</i> and <i>ScentrySupport</i> into the <i>AuthenticationSupport</i> treit, which we will mix with the controller.  In it, we registered our authentication strategy and implemented (in the simplest way) ways to get a user object from a session and, conversely, add its id to the session. <br><br>  As a result, if a non-logged-in user enters a page that <i>UserController</i> is responsible for handling, he will first need to enter a login and password. <br><br><h2>  Conclusion </h2><br>  This article showed only a few, the selective features of <i>Scalatra</i> .  Although this framework is not very popular in the Russian-speaking community, a wide range of implemented functionality and ease of development make it very promising for writing both small web services and large sites. <br><br>  If after reading the article you have any questions, I am ready to answer them in the comments or in the following articles. <br><br>  All source code is available on <a href="https://github.com/pozharko/scalatra-auth/tree/habr">github</a> . <br>  Have a good learning! </div><p>Source: <a href="https://habr.com/ru/post/262603/">https://habr.com/ru/post/262603/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../262589/index.html">Japanese fool</a></li>
<li><a href="../262593/index.html">Gaming News Digest: June</a></li>
<li><a href="../262595/index.html">Sentiment text analysis</a></li>
<li><a href="../262597/index.html">Cortana as a public analytics service and other announcements of the Microsoft World Partner Conference</a></li>
<li><a href="../262601/index.html">Deviation transformation and its use to determine the coordinate system for a set of distances</a></li>
<li><a href="../262605/index.html">Migrate data from Oracle to PostgreSQL</a></li>
<li><a href="../262607/index.html">We give the right to choose access to the page using the Rules</a></li>
<li><a href="../262611/index.html">Mail.Ru Rating Launches Website Scan For Viruses</a></li>
<li><a href="../262613/index.html">Mail collector (making simple things difficult)</a></li>
<li><a href="../262615/index.html">iOS Developer Tools</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>