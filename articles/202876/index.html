<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Upgrading Nexus 4 to Android 4.4 on Linux</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Probably, I'm not alone in my unwillingness to wait for the OTA update of the phone. It is interesting to see what's new in the version of Android 4.4...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Upgrading Nexus 4 to Android 4.4 on Linux</h1><div class="post__text post__text-html js-mediator-article">  Probably, I'm not alone in my unwillingness to wait for the OTA update of the phone.  It is interesting to see what's new in the version of Android 4.4.  Below I will try to describe in as much detail as possible the process of updating the firmware in Linux systems.  I hope this can be useful to someone, since most of the instructions are almost exclusively for Windows.  I will also try to describe the unobvious rake for some revisions of the Nexus 4. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/784/a5d/08f/784a5d08f16a4f1536734b73b3f69e27.jpg" alt="image"><br><a name="habracut"></a><br><h4>  We come on a rake in Windows 7 x64 / x86 </h4><br>  After reading the manuals, I pulled out the Kitkat image for the Nexus 4 and the Android SDK with all the tools.  However, to my surprise, the problem arose where I did not expect it - the drivers for Windows 7 x64 were not detected.  First I tried to install the driver package from the Android SDK (just mention the Google USB Driver Package for installation).  Not recognized.  Then I tried to pull out the driver package only from <a href="http://developer.android.com/sdk/win-usb.html">developer.android.com/sdk/win-usb.html</a> .  The result is the same.  To clear my conscience, I installed Universal Naked Driver 0.72 from here <a href="">w3bsit3-dns.com/forum/dl/post/3529212/Universal_Naked_Driver_0.72.zip</a> .  In a 32-bit system, the result is the same. <br>  The phone was purchased directly during the attraction of unprecedented generosity on Google Play through a forwarder.  It was bought 2 phones 8 Gb version for me (well, I do not have the need to store large amounts of multimedia) and 16 Gb version for my brother.  I was extremely surprised when his phone was immediately identified in the system.  Immediately there was a thought about the device ID. <br><br><h4>  A couple of words about USB identifiers </h4><br>  Each USB device has its own unique Vendor ID.  These identification numbers are issued by the non-profit organization USB Implementers Forum (USB-IF).  Inside the Vendor device IDs are categorized by Product ID.  So, as the manufacturer of Nexus is Google, all its devices have a VID of 18d1.  PID was a bit more complicated.  If you look inside android_winusb.inf, on which the operating system is oriented, we can see the list of devices for which this driver is intended. <br><pre><code class="dos hljs">;Google Nexus One <span class="hljs-variable"><span class="hljs-variable">%SingleAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_0D02 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_0D02&amp;MI_01 <span class="hljs-variable"><span class="hljs-variable">%SingleAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E11 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E12&amp;MI_01 ;Google Nexus S <span class="hljs-variable"><span class="hljs-variable">%SingleAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E21 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E22&amp;MI_01 <span class="hljs-variable"><span class="hljs-variable">%SingleAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E23 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E24&amp;MI_01 ;Google Nexus <span class="hljs-number"><span class="hljs-number">7</span></span> <span class="hljs-variable"><span class="hljs-variable">%SingleBootLoaderInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E40 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E42&amp;MI_01 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4E44&amp;MI_01 ;Google Nexus Q <span class="hljs-variable"><span class="hljs-variable">%SingleBootLoaderInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_2C10 <span class="hljs-variable"><span class="hljs-variable">%SingleAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_2C11 ;Google Nexus (generic) <span class="hljs-variable"><span class="hljs-variable">%SingleBootLoaderInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4EE0 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4EE2&amp;MI_01 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4EE4&amp;MI_02 <span class="hljs-variable"><span class="hljs-variable">%CompositeAdbInterface%</span></span> = USB_Install, USB\VID_18D1&amp;PID_4EE6&amp;MI_01</code> </pre> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Nexus 4 is not mentioned, but the 16 Gb version matches the ID numbers with Google Nexus (generic).  However, everything turned out wrong with my phone.  The VID was d001, which prevented the system from seeing the driver for it. <br><br><h4>  We are looking for a new rake in Linux </h4><br>  This was followed by a somewhat illogical decision to try updating the firmware in a Linux environment, since the kernel already includes the necessary drivers for the phone.  Deployed Kubuntu 13.10 to get a fresher core.  Further, all the instructions below: <br>  1) On the phone, in the ‚ÄúFor Developers‚Äù section, we enable USB debugging. <br>  2) Determine the PID: device VID <br><pre> <code class="bash hljs">meklon@meklon-kubuntu:~$ lsusb Bus 007 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 002 Device 002: ID 18d1:d001 Google Inc. Bus 002 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 006 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 005 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 001 Device 001: ID 1d6b:0002 Linux Foundation 2.0 root hub Bus 004 Device 003: ID 09da:9033 A4 Tech Co., Ltd X-718BK Optical Mouse Bus 004 Device 005: ID 046d:c225 Logitech, Inc. G11/G15 Keyboard / G keys Bus 004 Device 004: ID 046d:c221 Logitech, Inc. G11/G15 Keyboard / Keyboard Bus 004 Device 002: ID 046d:c223 Logitech, Inc. G11/G15 Keyboard / USB Hub Bus 004 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub Bus 003 Device 001: ID 1d6b:0001 Linux Foundation 1.1 root hub</code> </pre><br>  We are interested in this particular fragment - <b>18d1: d001 Google Inc.</b> <br>  2) Linux won't just give us access to our device.  First you need to create rules for udev (more about the system <a href="http://ru.wikipedia.org/wiki/Udev">ru.wikipedia.org/wiki/Udev</a> ). <br>  Create a file with the rules for our Nexus: <br><pre> <code class="bash hljs">sudo nano /etc/udev/rules.d/51-android.rules</code> </pre><br>  We enter there the following lines: <br>  #Nexus 4 <br> <code>SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", ATTR{idProduct}=="d001", MODE="0660", GROUP="androiddev", SYMLINK+="android%n"</code> <br>  3) Change the attributes: <br><pre> <code class="bash hljs">chmod a+r /etc/udev/rules.d/51-android.rules</code> </pre><br>  4) Restart udev: <br><pre> <code class="bash hljs">sudo service udev restart</code> </pre><br>  5) Create the androiddev group and add the current user: <br><pre> <code class="bash hljs">sudo groupadd androiddev &amp;&amp; sudo useradd -G androiddev username</code> </pre><br>  This is necessary for full access to the recording and execution of our device. <br>  6) Add the necessary tools to work (you do not need a full-featured SDK if you do not plan to develop on the phone) <br><pre> <code class="bash hljs">sudo add-apt-repository ppa:nilarimogard/webupd8 sudo apt-get update sudo apt-get install android-tools-adb android-tools-fastboot</code> </pre><br>  7) For normal operation, starting from version 4.2, you need to confirm on the phone itself that this PC is trusted for debugging.  When you start working with adb, do not forget to positively answer this question on your phone.  Check the visibility of the device: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adb devices List of devices attached xxxxxxxxxxxxxxx device</span></span></code> </pre><br>  Everything went well.  Otherwise (the old version of adb, untrusted PC, etc.) will be something like: <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment"># adb devices List of devices attached xxxxxxxxxxxxxxx offline</span></span></code> </pre><br>  8) Restart the phone in fastboot mode.  On the Nexus 4, this is achieved by pressing simultaneously the increase and decrease of sound along with power.  You can also send from the console adb restart fastboot.  Check the list of connected devices using lsusb and find that the product id has changed!  So again you need to edit /etc/udev/rules.d/51-android.rules.  In my case it was 4ee0. <br><pre> <code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#Nexus 4 SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", ATTR{idProduct}=="d001", MODE="0660", GROUP="androiddev", SYMLINK+="android%n" SUBSYSTEM=="usb", ATTR{idVendor}=="18d1", ATTR{idProduct}=="4ee0", MODE="0660", GROUP="androiddev", SYMLINK+="android%n"</span></span></code> </pre><br>  Reboot udev. <br>  9) In fastboot mode, adb does not work, so we check the list of connected devices as follows: <br><pre> <code class="bash hljs">fastboot devices</code> </pre><br>  If instead of your device, Waiting for devices is hanging, then you need to choose the correct Vendor ID / Product ID in the udev config. <br>  10) Downloading the very latest image from <a href="https://developers.google.com/android/nexus/images">developers.google.com/android/nexus/images</a> <br>  Unpack  In my case there should be the following files: <br><blockquote>  bootloader-mako-makoz20i.img <br>  radio-mako-m9615a-cefwmazm-2.0.1700.84.img <br>  image-occam-krt16o.zip <br>  flash-all.sh </blockquote><br>  11) Next we have two ways.  The first is unlocking the bootloader with a system wipe and full firmware.  The second is an update of the existing system. <br><br><h5>  First option: </h5><br>  1) Phone in fastboot mode. <br>  2) Check that the phone is visible fastboot devices <br>  3) Unlock the bootloader: <br><pre> <code class="bash hljs">fastboot oem unlock</code> </pre><br>  We agree on the phone with the data wipe <br>  4) Full firmware.  The easiest way is to run a ready-made flash-all.sh script. <br><pre> <code class="bash hljs">sudo sh flash-all.sh</code> </pre><br>  5) If everything went well, the phone eventually turns on pristine clean with a new version. <br><br><h5>  The second option: </h5><br>  1) Switch to the bootloader mode from fastboot.  To do this, select the corresponding item with the volume rocker and turn it on with the power button. <br>  2) As a result, we admire the picture of the nailed android with an open stomach and ... Everything.  In my version did not work further.  The idea at this stage is to simultaneously press the volume up and power to open the menu where ‚ÄúApply update from ADB‚Äù is selected.  My phone just turned on.  But let's say you succeeded. <br>  3) On the computer in the command window, enter the following command: <br><pre> <code class="bash hljs">adb sideload xxxxxxxx.zip</code> </pre><br>  where xxxxxxxx.zip is the name of the zip file with the firmware.  After that, a regular update will take place. <br><br><h4>  Epilogue </h4><br>  Successfully switched to ART from Dalvik.  It seems that everything has become much faster to open, but he hasn‚Äôt conducted accurate measurements.  The sensor has become nicer and more accurate.  In general, there are no obvious changes on the surface.  ART should be tested, but so far nothing is falling.  Recompilation took about 20 minutes for 120+ applications. <br><br>  Ps.  Remember that any careless actions can lead to a ‚Äúbrick‚Äù state.  The author is not responsible for incorrect user actions.  Please always read the instructions on the relevant resources. </div><p>Source: <a href="https://habr.com/ru/post/202876/">https://habr.com/ru/post/202876/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../202864/index.html">Minimize apps to dock for lazy using AppleScript</a></li>
<li><a href="../202866/index.html">Meet Dependency Injection with the Dagger example</a></li>
<li><a href="../202868/index.html">Testing: a clear career choice</a></li>
<li><a href="../202870/index.html">Automate subtitle uploading from * .mkv files</a></li>
<li><a href="../202874/index.html">Tiny Tron on JS (30 lines of code)</a></li>
<li><a href="../202878/index.html">What do bad security managers do?</a></li>
<li><a href="../202880/index.html">Git to help admin lokalkhost</a></li>
<li><a href="../202884/index.html">Overcoming the hidden dangers of KVO in Objective C</a></li>
<li><a href="../202888/index.html">Asteroids javascript implementation</a></li>
<li><a href="../202890/index.html">PHP creator Rasmus Lerdorf - about anarchy and democracy in language development, PHP 5.6 and complaining programmers</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>