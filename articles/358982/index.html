<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How do I want to invest in cryptocurrency or venture projects?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Crazy HYIP around cryptocurrency and all sorts of technological startups pushes people to pay special attention to these two topics. Someone is attrac...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How do I want to invest in cryptocurrency or venture projects?</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/53b/aef/030/53baef0308a49f3bd7a220f1e99df92e.jpg" alt="image"></div><br>  Crazy HYIP around cryptocurrency and all sorts of technological startups pushes people to pay special attention to these two topics.  Someone is attracted by the opportunity to make multiple money in a short time, for others participation in venture projects using modern technologies is an opportunity to join modern trends and, perhaps, even boast about it. <br><br>  But as in the case of the <a href="https://ru.wikipedia.org/wiki/%25D0%25A1%25D0%25B8%25D1%2581%25D1%2582%25D0%25B5%25D0%25BC%25D0%25B0%25D1%2582%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D0%25BE%25D1%2588%25D0%25B8%25D0%25B1%25D0%25BA%25D0%25B0_%25D0%25B2%25D1%258B%25D0%25B6%25D0%25B8%25D0%25B2%25D1%2588%25D0%25B5%25D0%25B3%25D0%25BE">systematic error of the survivor</a> , you need to pay attention not only to success stories that are constantly given as an example, but also to stories where people have lost a lot of time and money trying to develop their project, wrote tons of code, and as a result got nothing.  And quite often the lost money belongs to investors.  Of course, everyone would like to make money on early investments in companies like facebook, but unfortunately 9 out of 10 such companies go bust. <br><a name="habracut"></a><br>  Venture investment is a very interesting type of business, but for most small private investors, the entrance is simply closed.  This happens mainly because of the enormous risk involved in investing in start-ups, investing in one or two projects is like death.  Therefore, even the smallest venture funds have at least 20-30 projects in their portfolio.  If at least one of their portfolio companies fires, it will cover the costs of other projects.  But projects do not want to take from investors 100 thousand.  Investments in each of them are at least one million.  Simple arithmetic shows that if you have no capital in the amount of 15-20 million in your pocket, you can forget about it. <br><br>  At the same time, there is another scheme for investing in startups - crowdfunding.  You can invest as much as you want, but no one will talk to you as an investor.  Again, in most cases, a startup, having collected the necessary amount of funds, relaxes, since it does not bear any responsibility before small investors, who invest in it for good luck.  Startups are crumbling not only because of the laziness and irresponsibility of their initiators, but also because of unforeseen factors that it is almost impossible to foresee at the start. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      With the advent of ethereum and smart contracts, I became infected with the idea of ‚Äã‚Äãwriting a system that would allow small investors to monitor the progress of startups and thereby increase the percentage of profitable investments for themselves.  In essence, this is a crowdfunding platform, but with one significant difference - the project does not have access to all the funds raised, but only to a small part of them, and an investor can at any time pick up untapped funds if the project does not pass the stages stated at the start.  The guarantor of this will be not a system, but a smart contract. <br><br>  The business model of the platform itself implies that it will receive as a commission 5% of the broadcast collected by each project (read, in cash) and 5% of the shares of the future enterprise.  The platform itself is essentially a joint-stock company, and you can become its owner by purchasing a share of its shares and receiving these same 5 + 5 percent in the future, automatically becoming an investor of all projects that will attract investments based on this platform. <br><br>  If such a system existed, I would love to invest in it myself, and in projects, realizing that I can always get out of them, if something in my opinion goes wrong.  And since there is no such system, I decided to write it myself. <br><br>  Further in the article I will disassemble ‚Äúby the bones‚Äù the smart contract for solidity, which is the prototype of the future system. <br><br>  The contract is uploaded to the address <a href="https://etherscan.io/address/0x15797a704628907dd2622d3e5711d4ea62cd5072">https://etherscan.io/address/0x15797a704628907dd2622d3e5711d4ea62cd5072#code</a> and has open code, which excludes the possibility of its substitution. <br><br>  I will not discuss the technical aspects in detail, but will only focus on the essential details that are important from the point of view of the operation of the contract itself.  If someone has any questions, comments on the code, I will gradually complement. <br><br>  I wrote the article on Habr because hardly anyone other than people close to IT can appreciate the idea. <br><br>  As one of the developers said, ‚Äúwords are bullshit, show me the code‚Äù.  So, let's go: <br><br><div class="spoiler">  <b class="spoiler_title">Chunks of code with extended comments</b> <div class="spoiler_text"><pre><code class="hljs lua">pragma solidity ^<span class="hljs-number"><span class="hljs-number">0.4</span></span><span class="hljs-number"><span class="hljs-number">.19</span></span>; library itMaps {..} -    . contract ERC20 {..} - ,    ,       contract TakeMyEther is ERC20{ //    ? .. uint private initialSupply = <span class="hljs-number"><span class="hljs-number">2800000</span></span>; //     uint public soldTokens = <span class="hljs-number"><span class="hljs-number">0</span></span>; //     .. address public TakeMyEtherTeamAddress; //  itMaps.itMapAddressUint tokenBalances; //    mapping (address =&gt; uint256) weiBalances; //    ,    . mapping (address =&gt; uint256) weiBalancesReturned; //   ,     uint public percentsOfProjectComplete = <span class="hljs-number"><span class="hljs-number">0</span></span>; //   uint public lastStageSubmitted; //        uint public lastTimeWithdrawal; //         uint public constant softCapTokensAmount = <span class="hljs-number"><span class="hljs-number">500000</span></span>; //      uint public constant hardCapTokensAmount = <span class="hljs-number"><span class="hljs-number">2250000</span></span>; //    uint public constant lockDownPeriod = <span class="hljs-number"><span class="hljs-number">1</span></span> weeks; //             ,           uint public constant minimumStageDuration = <span class="hljs-number"><span class="hljs-number">2</span></span> weeks; //      . bool public isICOfinalized = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; //      bool public projectCompleted = <span class="hljs-literal"><span class="hljs-literal">false</span></span>; //    modifier onlyTeam { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (msg.sender == TakeMyEtherTeamAddress) { _; } } mapping (address =&gt; mapping (address =&gt; uint256)) allowed; event StageSubmitted(uint last); //      event etherPassedToTheTeam(uint weiAmount, uint when); //    event etherWithdrawFromTheContract(address tokenHolder, uint numberOfTokensSoldBack, uint weiValue); //    event Burned(address indexed from, uint amount); //      event DividendsTransfered(address to, uint tokensAmount, uint weiAmount); //         ... /*     .      ,           */ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transfer</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address to, uint value)</span></span></span></span> public returns (bool success) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenBalances.get(msg.sender) &gt;= value &amp;&amp; value &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (to == address(this)) { // <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> you send even <span class="hljs-number"><span class="hljs-number">1</span></span> token back to the contract, it will <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> all available funds to you returnAllAvailableFunds(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> transferTokensAndEtherValue(msg.sender, to, value, getAverageTokenPrice(msg.sender) * value); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } ... //  : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public payable { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (!projectCompleted); uint weiToSpend = msg.value; //recieved value uint currentPrice = getCurrentSellPrice(); //<span class="hljs-number"><span class="hljs-number">0.5</span></span> ETH <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> ETH <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-number"><span class="hljs-number">1000</span></span> tokens uint valueInWei = <span class="hljs-number"><span class="hljs-number">0</span></span>; uint valueToPass = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weiToSpend &lt; currentPrice) {// <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ETH back <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> nothing to buy <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!tokenBalances.contains(msg.sender)) tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(msg.sender, <span class="hljs-number"><span class="hljs-number">0</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (soldTokens &lt; softCapTokensAmount) { uint valueLeftForSoftCap = softCapTokensAmount - soldTokens; valueToPass = weiToSpend / currentPrice; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valueToPass &gt; valueLeftForSoftCap) valueToPass = valueLeftForSoftCap; valueInWei = valueToPass * currentPrice; weiToSpend -= valueInWei; soldTokens += valueToPass; weiBalances[address(this)] += valueInWei; transferTokensAndEtherValue(address(this), msg.sender, valueToPass, valueInWei); } currentPrice = getCurrentSellPrice(); //renew current price <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weiToSpend &lt; currentPrice) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (soldTokens &lt; hardCapTokensAmount &amp;&amp; soldTokens &gt;= softCapTokensAmount) { uint valueLeftForHardCap = hardCapTokensAmount - soldTokens; valueToPass = weiToSpend / currentPrice; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (valueToPass &gt; valueLeftForHardCap) valueToPass = valueLeftForHardCap; valueInWei = valueToPass * currentPrice; weiToSpend -= valueInWei; soldTokens += valueToPass; weiBalances[address(this)] += valueInWei; transferTokensAndEtherValue(address(this), msg.sender, valueToPass, valueInWei); } <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (weiToSpend / <span class="hljs-number"><span class="hljs-number">10</span></span>**<span class="hljs-number"><span class="hljs-number">17</span></span> &gt; <span class="hljs-number"><span class="hljs-number">1</span></span>) { //<span class="hljs-keyword"><span class="hljs-keyword">return</span></span> unspent funds <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> they are greater than <span class="hljs-number"><span class="hljs-number">0.1</span></span> ETH msg.sender.transfer(weiToSpend); } } //     <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returnAllAvailableFunds</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (tokenBalances.contains(msg.sender)); //you need to be a tokenHolder <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (!projectCompleted); //you can <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> tokens after project is completed uint avPrice = getAverageTokenPrice(msg.sender); weiBalances[msg.sender] = getWeiAvailableToReturn(msg.sender); //depends on project completeness level uint amountOfTokensToReturn = weiBalances[msg.sender] / avPrice; <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (amountOfTokensToReturn&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>); uint valueInWei = weiBalances[msg.sender]; transferTokensAndEtherValue(msg.sender, address(this), amountOfTokensToReturn, valueInWei); emit etherWithdrawFromTheContract(msg.sender, amountOfTokensToReturn, valueInWei); weiBalances[address(this)] -= valueInWei; soldTokens -= amountOfTokensToReturn; msg.sender.transfer(valueInWei); } // View functions //      https://etherscan.<span class="hljs-built_in"><span class="hljs-built_in">io</span></span>/address/<span class="hljs-number"><span class="hljs-number">0x15797a704628907dd2622d3e5711d4ea62cd5072</span></span>#readContract      // Team functions    ? //    <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">finalizeICO</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public onlyTeam { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(!isICOfinalized); // this <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">be</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">called</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">only</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">once</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">if</span></span></span><span class="hljs-function"> </span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(soldTokens &lt; hardCapTokensAmount)</span></span></span></span> <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (lastStageSubmitted + minimumStageDuration &lt; now); // ICO duration is at least <span class="hljs-number"><span class="hljs-number">2</span></span> weeks <span class="hljs-built_in"><span class="hljs-built_in">require</span></span>(soldTokens &gt;= softCapTokensAmount); //means, that the softCap Reached uint tokensToPass = passTokensToTheTeam(); //but without weiValue, so the team can <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> withdraw ether by returning tokens to the contract burnUndistributedTokens(tokensToPass);//tokensToPass); // undistributed tokens are destroyed lastStageSubmitted = now; emit StageSubmitted(lastStageSubmitted); increaseProjectCompleteLevel(); // Now, team can withdraw <span class="hljs-number"><span class="hljs-number">10</span></span>% of funds raised to begin the project passFundsToTheTeam(); isICOfinalized = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } //      <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">submitNextStage</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public onlyTeam returns (bool success) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastStageSubmitted + minimumStageDuration &gt; now) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; //Team submitted the completeness of previous stage more <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-number"><span class="hljs-number">2</span></span> weeks before. lastStageSubmitted = now; emit StageSubmitted(lastStageSubmitted); increaseProjectCompleteLevel(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } /*             */ <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">unlockFundsAndPassEther</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public onlyTeam returns (bool success) { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (lastTimeWithdrawal&lt;=lastStageSubmitted); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (lastStageSubmitted + lockDownPeriod &gt; now) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; //funds can <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> be passed <span class="hljs-keyword"><span class="hljs-keyword">until</span></span> lockDownPeriod ends <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (percentsOfProjectComplete == <span class="hljs-number"><span class="hljs-number">100</span></span> &amp;&amp; !projectCompleted) { projectCompleted = <span class="hljs-literal"><span class="hljs-literal">true</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenBalances.get(address(this))&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { uint toTransferAmount = tokenBalances.get(address(this)); tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(TakeMyEtherTeamAddress, tokenBalances.get(address(this)) + tokenBalances.get(TakeMyEtherTeamAddress)); tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(address(this), <span class="hljs-number"><span class="hljs-number">0</span></span>); emit Transfer(address(this), TakeMyEtherTeamAddress, toTransferAmount); } } passFundsToTheTeam(); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } // Receive dividends //       <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">topUpWithEtherAndTokensForHolders</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address tokensContractAddress, uint tokensAmount)</span></span></span></span> public payable { uint weiPerToken = msg.value / initialSupply; uint tokensPerToken = <span class="hljs-number"><span class="hljs-number">100</span></span> * tokensAmount / initialSupply; //Multiplication <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> more precise amount uint weiAmountForHolder = <span class="hljs-number"><span class="hljs-number">0</span></span>; uint tokensForHolder = <span class="hljs-number"><span class="hljs-number">0</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (uint i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt; tokenBalances.size(); i += <span class="hljs-number"><span class="hljs-number">1</span></span>) { address tokenHolder = tokenBalances.getKeyByIndex(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenBalances.get(tokenHolder)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { weiAmountForHolder = tokenBalances.get(tokenHolder)*weiPerToken; tokensForHolder = tokenBalances.get(tokenHolder) * tokensPerToken / <span class="hljs-number"><span class="hljs-number">100</span></span>; // Dividing because of the previous multiplication tokenHolder.transfer(weiAmountForHolder); //This will pass a certain amount of ether to TakeMyEther platform tokenHolders <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokensContractAddress.call(bytes4(keccak256(<span class="hljs-string"><span class="hljs-string">"authorizedTransfer(address,address,uint256)"</span></span>)), msg.sender, tokenHolder, tokensForHolder)) //This will pass a certain amount of tokens to TakeMyEther platform tokenHolders emit DividendsTransfered(tokenHolder, tokensForHolder, weiAmountForHolder); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passUndistributedEther</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> public { <span class="hljs-built_in"><span class="hljs-built_in">require</span></span> (projectCompleted); uint weiPerToken = (address(this).balance * <span class="hljs-number"><span class="hljs-number">100</span></span>) / initialSupply; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> (uint i = <span class="hljs-number"><span class="hljs-number">0</span></span>; i&lt; tokenBalances.size(); i += <span class="hljs-number"><span class="hljs-number">1</span></span>) { address tokenHolder = tokenBalances.getKeyByIndex(i); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenBalances.get(tokenHolder)&gt;<span class="hljs-number"><span class="hljs-number">0</span></span>) { uint weiAmountForHolder = (tokenBalances.get(tokenHolder)*weiPerToken)/<span class="hljs-number"><span class="hljs-number">100</span></span>; tokenHolder.transfer(weiAmountForHolder); //This will pass a certain amount of ether to TakeMyEther platform tokenHolders emit DividendsTransfered(tokenHolder, <span class="hljs-number"><span class="hljs-number">0</span></span>, weiAmountForHolder); } } } // When project is finished <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> Dividends are passed to the tokenHolders, there is some wei, left on the contract. Gradually, there can be a large amount of wei left, so it should be also distributed among tokenHolders. // Internal functions //  : <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">transferTokensAndEtherValue</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(address from, address to, uint value, uint weiValue)</span></span></span></span> internal returns (bool success){ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (tokenBalances.contains(from) &amp;&amp; tokenBalances.get(from) &gt;= value) { tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(to, tokenBalances.get(to) + value); tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(from, tokenBalances.get(from) - value); weiBalances[from] -= weiValue; weiBalances[to] += weiValue; emit Transfer(from, to, value); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">true</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">false</span></span>; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passFundsToTheTeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> internal { uint weiAmount = getAvailableFundsForTheTeam(); TakeMyEtherTeamAddress.transfer(weiAmount); emit etherPassedToTheTeam(weiAmount, now); lastTimeWithdrawal = now; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passTokensToTheTeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span> internal returns (uint tokenAmount) { //This <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">passes</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tokens</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">team</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">without</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">weiValue</span></span></span><span class="hljs-function">, </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">so</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">team</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">can</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">not</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">withdraw</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ether</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">by</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">returning</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tokens</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">to</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">the</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">contract</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">uint</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">tokensToPass</span></span></span><span class="hljs-function"> = </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getNumberOfTokensForTheTeam</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span></span>; tokenBalances.<span class="hljs-built_in"><span class="hljs-built_in">insert</span></span>(TakeMyEtherTeamAddress, tokensToPass); weiBalances[TakeMyEtherTeamAddress] = <span class="hljs-number"><span class="hljs-number">0</span></span>; // those tokens don<span class="hljs-string"><span class="hljs-string">'t cost any ether emit Transfer(address(this), TakeMyEtherTeamAddress, tokensToPass); return tokensToPass; } function increaseProjectCompleteLevel() internal { if (percentsOfProjectComplete&lt;60) percentsOfProjectComplete += 10; else percentsOfProjectComplete = 100; } function burnUndistributedTokens(uint tokensToPassToTheTeam) internal { uint toBurn = initialSupply - (tokensToPassToTheTeam + soldTokens); initialSupply -= toBurn; tokenBalances.insert(address(this), 0); emit Burned(address(this), toBurn); } }</span></span></code> </pre> <br></div></div><br><h3>  So what? </h3><br>  A logical question that may arise at the end of reading the notes. <br>  The main goal, as I see it, consists of several parts: <br><br>  1) Informing the community about the business opportunities offered by the blockchain. <br><br>  2) Review the project and / or code, get feedback from the community, as this is one of the best ways to test a hypothesis.  Maybe I'm just wasting my time and these ideas are not interesting to anyone? <br><br>  3) <br><pre> <code class="hljs objectivec"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (    == <span class="hljs-literal"><span class="hljs-literal">false</span></span>) {  ();  ();  (-); }</code> </pre> <br>  Thank you for your attention, all good! </div><p>Source: <a href="https://habr.com/ru/post/358982/">https://habr.com/ru/post/358982/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../358970/index.html">Cross-platform SNMP traffic monitoring utility without dependencies and GUI availability</a></li>
<li><a href="../358972/index.html">Maraquia - ORM for MongoDB</a></li>
<li><a href="../358974/index.html">How update Rust 1.26 sped up my code more than three times</a></li>
<li><a href="../358976/index.html">Cofree Will Tear Us Apart</a></li>
<li><a href="../358978/index.html">The digest of fresh materials from the world of the frontend for the last week No. 315 (May 14 - 20, 2018)</a></li>
<li><a href="../358984/index.html">How databases are arranged</a></li>
<li><a href="../358986/index.html">How to train juniors inside the company: the experience of the company Lodoss Team</a></li>
<li><a href="../358988/index.html">Why we live inside space, but on the side of time. The difference in perception of time and space</a></li>
<li><a href="../358990/index.html">Announcement of the mitap of RubyRoars # 1 in Kharkov</a></li>
<li><a href="../358992/index.html">11 best fonts for programming</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>