<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The home campaign</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="This year, we repeatedly wrote about malicious Apache modules and the compromise of legitimate web servers, which led to redirection of users to malic...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The home campaign</h1><div class="post__text post__text-html js-mediator-article">  This year, we repeatedly wrote about malicious Apache modules and the compromise of legitimate web servers, which led to redirection of users to malicious sites.  It was found that the various cases of compromise of these web servers have similar properties and belong to the same campaign for the distribution of malicious software, which we called the <b>"Home Campaign"</b> .  Here are some facts about this campaign: <ul><li>  The campaign has been going on since February 2011. </li><li>  The compromised web servers were managed by cPanel and Plesk. </li><li>  More than 40 thousand domains participated in the campaign. </li></ul><a name="habracut"></a>  <b>Campaign</b> In general, a user's infection in Home Campaign can be described in the following pattern. <img src="https://habrastorage.org/storage2/44f/bea/a17/44fbeaa17daa48795dc477e136e8e5d1.png">  Of course, the initial stage is the compromise of the web server itself, as a result of which a malicious Apache module ( <b>Darkleech</b> ) will be installed on it.  The Darkleech component is sold in underground cybercriminal forums and is defined by us as <a href="http://habrahabr.ru/company/eset/blog/169297/">Linux / Chapro</a> .  When a user accesses the website of an infected server, the malicious code adds a special IFRAME to the code of the requested page, through which the malicious content is loaded.  This uses the URL format <i>hxxp: //129.121.xx.xxx/9bd5113b9edfc221e46f6983ab334927/q.php</i> .  Our telemetry data shows that this link redirected from 270 web pages. Through a malicious IFRAME, the user is redirected to the Blackhole exploit kit page, which attempts to exploit vulnerabilities in the browser or in its installed plugins.  If one of the exploits is successfully applied, the malicious code is installed on the user's computer, including <b>Pony Loader</b> (Fareit), <a href="http://www.virusradar.com/en/Win32_TrojanDownloader.Nymaim/detail">Nymaim</a> and <a href="http://www.welivesecurity.com/tag/sirefef/">Sirefef</a> .  The subject in the message varies depending on the location of the victim‚Äôs computer.  The figure below shows a message for computers located in the United States. <img src="https://habrastorage.org/storage2/657/32b/bc0/65732bbc0654335c23b0fd8ab27a48af.png">  This campaign has been going on for a long time.  According to our data, the Blackhole pages used have been active for more than two years.  At the beginning of the campaign, the malicious code used the / Home / template when forming the URL, for example, <i>hxxp: //64.247.xxx.xxx/Home/index.php</i> , so we gave the name ‚ÄúHome‚Äù for this campaign.  In October 2012, this template was changed using q.php and adding a directory name that was randomly generated.  The current configuration of the URL generated by the Darkleech module uses the /Home/index.php template. <img src="https://habrastorage.org/storage2/eda/fd4/2ac/edafd42ac81c9f69760fd2361577f83c.png">  Our telemetry data shows that the campaign used about 40 thousand different IP addresses and domains for the Blackhole exploit kit.  In May 2013, 15,000 of these IP addresses and domains were used for Blackhole at the same time.  The screenshot below shows the network 129.121.0.0/16, in which more than five thousand addresses were used in this campaign. <img src="https://habrastorage.org/storage2/599/853/f83/599853f830aac8464b8e27de85230140.png">  The question arises of how the attackers managed to control so many IP addresses and domains.  The fact is that many web hosting companies use Plesk and CPanel control panels to manage their networks as well as websites, and there are hundreds or thousands of websites.  The specialists of our anti-virus laboratory identified another modification of Darkleech, which was used for installation on compromised servers.  This version contains an additional handler for sending requests to Blackhole. <img src="https://habrastorage.org/storage2/7c6/2b8/d4f/7c62b8d4f917e96d16170d60d88b3bc1.png">  The handler uses a different encryption algorithm, different from the one used in the original Darkleech version.  After he gets control, four lines are decrypted.  For incoming requests, the function calculates a hash based on the Host HTTP header field.  At the same time, if such a hash is contained in the URL request string, the handler continues execution of its code, otherwise the request is processed as usual through Apache. <img src="https://habrastorage.org/storage2/52f/49a/c3d/52f49ac3dab95641bd4398c1cbf93e2a.png">  The handler code also checks the User-Agent field in the request and rejects requests that do not contain ‚ÄúMSIE‚Äù or ‚ÄúJava‚Äù. <img src="https://habrastorage.org/storage2/40f/3d3/e91/40f3d3e91bd02001a907e21e6e366f5a.png">  After the malicious code has modified the request, it will be redirected to linuxkernelup.com using mod_proxy.  The X-HOSTNAME-MD5 header is added to the request that contains the host name hash. <img src="https://habrastorage.org/storage2/01e/377/e9c/01e377e9cdef9ea3e36d89fac1d993d3.png">  The following image shows what the final request looks like, which is sent to the Blackhole server. <img src="https://habrastorage.org/storage2/c70/d90/a10/c70d90a107a67a5c45a71e9fd1c42438.png">  We still do not know the way in which attackers gain access to servers.  It is possible using information about accounts that were stolen using Fareit, which has a mechanism to steal FTP and HTTP accounts. </div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/185592/">https://habr.com/ru/post/185592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../185582/index.html">Statistics of space launches in the USSR and Russia according to Roscosmos</a></li>
<li><a href="../185584/index.html">Fedora 19 Schr√∂dinger's cat</a></li>
<li><a href="../185586/index.html">Spectralink KIRK KWS400. Budget, professional DECT solution</a></li>
<li><a href="../185588/index.html">Cloud Facts and Myths</a></li>
<li><a href="../185590/index.html">Connect to the online conference "Creating Modern Applications with Visual Studio 2013" today at 10:00 (Moscow time)</a></li>
<li><a href="../185594/index.html">Unity3D and MySQL</a></li>
<li><a href="../185596/index.html">High load application architecture. Scaling of distributed systems. Part two</a></li>
<li><a href="../185598/index.html">Internal cuisine: a recipe for effective work with a remote employee. Part 2</a></li>
<li><a href="../185604/index.html">We saw Pan / Tilt webcam (which is spinning) + the ability to connect all sorts of sensors for ~ $ 15</a></li>
<li><a href="../185606/index.html">A little more automatic music generation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>