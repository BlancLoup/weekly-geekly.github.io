<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We control the computer through a browser</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="A computer has long been replaced by many for television, and what is missing from a computer for comfortable watching movies, TV shows and other thin...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We control the computer through a browser</h1><div class="post__text post__text-html js-mediator-article">  A computer has long been replaced by many for television, and what is missing from a computer for comfortable watching movies, TV shows and other things?  I, personally, did not have enough remote control. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/habr/post_images/7ec/705/5d3/7ec7055d31f69cdeb878555e68bfff54.png" alt="image"></div><br>  I am a little keen on web programming in my free time.  It was decided to write my bike, and at the same time combine business with pleasure.  The possibility of using a console to control a computer was studied, and first of all I was interested in the following minimum amount of tasks (which increased slightly afterwards): <br><br><ul><li>  Ability to send a PC to sleep </li><li>  Ability to turn off the volume </li></ul><br>  With the help of a well-known search engine I found a console program, <a href="http://www.nirsoft.net/utils/nircmd.html">NirCmd</a> , the program allows you to perform quite a lot of actions other than those mentioned above.  With the main part, we decided.  As I said, I study php a bit, my web server is usually constantly running, so I didn‚Äôt think of anything specific in terms of the server.  The server is written in php and consists of two classes: Control, which represents the methods that execute console commands, and Route, which validates incoming requests and executes methods of the Control class. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Control looks like this (the code is of the same type, so I have shortened it): <br><a name="habracut"></a><br><pre><code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Control</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionControl</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $Path; <span class="hljs-comment"><span class="hljs-comment">//   nirCmd; function __construct($p = 'C:/nircmd/nircmd.exe') { $this-&gt;Path = $p; } function standby() { `{$this-&gt;Path} standby`; } function hibernate() { `rundll32 powrprof.dll,SetSuspendState 0,1,0`; } function reboot() { `{$this-&gt;Path} exitwin reboot`; } function turnOff() { `{$this-&gt;Path} exitwin poweroff`; } function logout() { `{$this-&gt;Path} exitwin logoff`; } }</span></span></code> </pre> <br>  Second class - Route.  Actually, the client refers to it.  The class first validates the request, and, if the request is correct, calls the methods of the Control class. <br>  It looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">Route</span></span></span><span class="hljs-class"> </span><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">implements</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">ActionRoute</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $possible = []; <span class="hljs-keyword"><span class="hljs-keyword">protected</span></span> $ControlObj; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__construct</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($obj)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;possible = get_class_methods($obj); <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ControlObj = $obj; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">route</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($arr)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">forEach</span></span>($arr <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> $key =&gt; $value) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (in_array($key, <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;possible) &amp;&amp; $value == <span class="hljs-string"><span class="hljs-string">'true'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;execute($key); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { Message::sent(<span class="hljs-string"><span class="hljs-string">'wrong method'</span></span>); } } } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">execute</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($c)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">$this</span></span>-&gt;ControlObj-&gt;$c(); Message::sent(<span class="hljs-string"><span class="hljs-string">'executed'</span></span>); } }</code> </pre> <br>  To succeed in which case it is easy to expand the number of methods in the Control class, validation in the Route class is not rigidly tied to a specific list of methods of the Control class, more precisely tied, but all possible methods are extracted from the object itself, and the incoming data is compared with them. <br><br>  The file itself that the client accesses looks like this: <br><br><pre> <code class="php hljs"><span class="hljs-meta"><span class="hljs-meta">&lt;?</span></span> define(<span class="hljs-string"><span class="hljs-string">"PATH"</span></span>, <span class="hljs-string"><span class="hljs-string">"C:/nircmd/nircmd.exe"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">__autoload</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">($name)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">require</span></span> <span class="hljs-string"><span class="hljs-string">"class/$name.class.php"</span></span>; } $obj = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Control(PATH); $route = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Route($obj); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ($_GET) { $route-&gt;route($_GET); } <span class="hljs-meta"><span class="hljs-meta">?&gt;</span></span></code> </pre><br>  If a GET request arrives, then we give the entire array to the route method. <br><br>  The client part is a control button and one handler, by which we send data using ajax to the server. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> wrapper = <span class="hljs-built_in"><span class="hljs-built_in">document</span></span>.querySelector(<span class="hljs-string"><span class="hljs-string">".wrapper"</span></span>); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">getXmlHttpRequest</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.XMLHttpRequest) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> XMLHttpRequest(); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e){ } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">window</span></span>.ActiveXObject) { <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">'Msxml2.XMLHTTP'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e){} <span class="hljs-keyword"><span class="hljs-keyword">try</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ActiveXObject(<span class="hljs-string"><span class="hljs-string">'Microsoft.XMLHTTP'</span></span>); } <span class="hljs-keyword"><span class="hljs-keyword">catch</span></span> (e){} } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } wrapper.addEventListener(<span class="hljs-string"><span class="hljs-string">'click'</span></span>, <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">e</span></span></span><span class="hljs-function">)</span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> target = e.target; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>(target.tagName!= <span class="hljs-string"><span class="hljs-string">'BUTTON'</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (target.getAttribute(<span class="hljs-string"><span class="hljs-string">'data'</span></span>)==<span class="hljs-string"><span class="hljs-string">'qestion'</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> yn = confirm(<span class="hljs-string"><span class="hljs-string">"?"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!yn) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> ajaxf(target.id); } ajaxf(target.id); }) <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ajaxf</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">$com</span></span></span><span class="hljs-function">) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> command = $com+<span class="hljs-string"><span class="hljs-string">'=true'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> xhr = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> getXmlHttpRequest(); xhr.open(<span class="hljs-string"><span class="hljs-string">'GET'</span></span>, <span class="hljs-string"><span class="hljs-string">'remote.php?'</span></span>+command, <span class="hljs-literal"><span class="hljs-literal">true</span></span>); xhr.send(); xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.readyState != <span class="hljs-number"><span class="hljs-number">4</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (xhr.status != <span class="hljs-number"><span class="hljs-number">200</span></span>) { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(xhr.status + <span class="hljs-string"><span class="hljs-string">': '</span></span> + xhr.statusText); } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(xhr.responseText); } } }</code> </pre> <br>  At present, the following management functionality has been implemented: <br><br><ul><li>  sleep mode </li><li>  hibernation </li><li>  will reboot </li><li>  turn off </li><li>  go out </li><li>  turn off the monitor </li><li>  enable / disable trigger sound </li><li>  more volume </li><li>  volume less </li><li>  Media buttons, stop / play next / prev </li></ul><br>  Everything I wanted to get, I got, but, as they say, appetite comes with eating.  I would like to have feedback from the server, i.e.  When you first enter the page, make a request for the current volume level, for example.  Unfortunately, nirCmd does not return values ‚Äã‚Äãwhen executed, so with what we have now, I do not know how to accomplish this. <br><br>  A safety issue.  Although this is all spinning on the local machine, it will be very sad if the attacker has access to the execution of the nirCmd commands, since  You can create a lot of destructive actions. <br><br>  Ready project on <a href="https://github.com/DmtryJS/WebRemotePC">GIthub</a> . </div><p>Source: <a href="https://habr.com/ru/post/307340/">https://habr.com/ru/post/307340/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307330/index.html">How to hire programmers. Interview with Katerina Gavrilova from DigitalHR</a></li>
<li><a href="../307332/index.html">Code samples from the summer school on Node.js and JavaScript in KPI</a></li>
<li><a href="../307334/index.html">Threejs editor</a></li>
<li><a href="../307336/index.html">Physicists from the Delft University of Technology have created an atomic data warehouse</a></li>
<li><a href="../307338/index.html">Setting up wifi authorization via sms under ubuntu 16.04</a></li>
<li><a href="../307342/index.html">Kerio Control 9.1 opens up new next-generation firewall (NGFW) capabilities for SMB companies</a></li>
<li><a href="../307344/index.html">Ecosystem support. Automate user registration with Golang</a></li>
<li><a href="../307346/index.html">CodeRush for Roslyn: Part 3 - an overview of the possibilities for learning code</a></li>
<li><a href="../307348/index.html">How to gain courage and open a store</a></li>
<li><a href="../307350/index.html">How I went to the States in 2000 and what happened next</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>