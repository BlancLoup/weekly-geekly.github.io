<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ECMAScript 6. Regular expressions with Unicode support</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="ECMAScript 6 introduces two new flags for regular expressions: 


1. y turns on sticky matching mode. 
2. u includes various options related to Unicod...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ECMAScript 6. Regular expressions with Unicode support</h1><div class="post__text post__text-html js-mediator-article"><p>  ECMAScript 6 introduces two new flags for regular expressions: </p><br><ol><li> <code>y</code> turns on <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/sticky">sticky matching</a> mode. </li><li>  <code>u</code> includes various options related to Unicode. </li></ol><br>  This article explains the effect of the <code>u</code> flag.  This article will be useful to you if you are familiar with <a href="https://mathiasbynens.be/notes/javascript-unicode">Unicode-problems in Javascript</a> . <br><br><img src="https://habrastorage.org/web/560/950/c49/560950c49f82435fa3e1076df84b5b6f.jpg"><a name="habracut"></a><br>  <b>NB!</b>  Since an attempt to publish an article revealed problems with displaying some Unicode characters used in the article, some of the code was replaced with images with links to JSFiddle. <br><br><h3>  Impact on syntax </h3><br>  Setting the <code>u</code> flag in a regular expression allows the <a href="https://mathiasbynens.be/notes/javascript-escapes">escape sequences of ES6 Unicode code points</a> ( <code>\u{...}</code> ) in the pattern. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
     <a href="https://jsfiddle.net/ollazarev/012g9w5p/"><img src="https://habrastorage.org/web/0ff/9a3/422/0ff9a3422d174d278f89acf852344e5b.jpg"></a> <br><br>  In the absence of the <code>u</code> flag, things like <code>\u{1234}</code> may technically still occur in patterns, but they will not be interpreted as Unicode code point escape sequences.  <code>/\u{1234}/</code> equivalent to writing <code>/u{1234}/</code> , which corresponds to <code>1234</code> consecutive <code>u</code> characters instead of the character corresponding to the <a href="https://codepoints.net/U%2B1234">U + 1234</a> code points escape sequence. <br><br>  The Javascript engine does this for compatibility reasons.  But with the <code>u</code> flag set and things like <code>\a</code> (where <code>a</code> not an escape sequence) will no longer be equivalent to <code>a</code> .  Therefore, even if <code>/\a/</code> processed as <code>/a/</code> , <code>/\a/u</code> throws an error, since  <code>\a</code> not a reserved escape sequence.  This allows extending the functionality of the <code>u</code> flag of regular expressions in a future version of ECMAScript.  For example, <code>/\p{Script=Greek}/u</code> throws an exception for ES6, but can become a regular expression matching all the characters of the Greek alphabet according to the Unicode database when the corresponding <a href="https://github.com/mathiasbynens/es-regexp-unicode-property-escapes">syntax</a> is added to the specification. <br><br><h3>  Effect on the operator ' <code>.</code>  ' </h3><br>  In the absence of the flag <code>u</code>  matches any BMP character (Basic Multilingual Plane) with the exception of <a href="http://ecma-international.org/ecma-262/6.0/">line terminators</a> .  When the flag is set ES6 <code>u</code> ,.  also corresponds to astral symbols. <br><br> <a href="https://jsfiddle.net/ollazarev/wojd7tzo/"><img src="https://habrastorage.org/web/e18/e4e/822/e18e4e822f294540812a36da32f6bd37.jpg"></a> <br><br><h3>  Impact on quantifiers </h3><br>  The following quantifiers are available in Javascript regular expressions (as well as their variations): <code>*</code> , <code>+</code> <code>?</code>  , and <code>{2}</code> , <code>{2,}</code> , <code>{2,4}</code> .  In the absence of the <code>u</code> flag, if the quantifier follows the astral symbol, it applies only to the <i>low surrogate of</i> this symbol. <br><br> <a href="https://jsfiddle.net/ollazarev/6uzdzauk/"><img src="https://habrastorage.org/web/ba0/f0f/a31/ba0f0fa315744ab5a11d02ab9e731de5.jpg"></a> <br><br>  With the ES6 flag, quantifiers are applied to the characters as a whole, which is true even for astral characters. <br><br> <a href="https://jsfiddle.net/ollazarev/72dL8n4c/"><img src="https://habrastorage.org/web/177/0fa/161/1770fa1610794143a556f9c17902eaba.jpg"></a> <br><br><h3>  Effect on character classes </h3><br>  In the absence of the <code>u</code> flag, any given character class can only match BMP characters.  Things like <code>[bcd]</code> work as we expect: <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> regex = <span class="hljs-regexp"><span class="hljs-regexp">/^[bcd]$/</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( regex.test(<span class="hljs-string"><span class="hljs-string">'a'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// false regex.test('b'), // true regex.test('c'), // true regex.test('d'), // true regex.test('e') // false );</span></span></code> </pre><br>  However, when the astral symbol is used in the character class, the Javascript engine processes it as two separate ‚Äúcharacters‚Äù: one for each of its surrogate halves. <br><br> <a href="https://jsfiddle.net/ollazarev/qjmftk4z/"><img src="https://habrastorage.org/web/a03/f3b/24a/a03f3b24a0a54e28838010ddc54647aa.jpg"></a> <br><br>  The ES6 <code>u</code> flag allows you to use solid astral symbols in character classes. <br><br> <a href="https://jsfiddle.net/ollazarev/b2cdLd8n/"><img src="https://habrastorage.org/web/e32/0a5/2b4/e320a52b407a4426a18a3cdd5af415fe.jpg"></a> <br><br>  Therefore, solid astral symbols can also be used in <b>ranges of character classes</b> , and everything will work as we expect, while the <code>u</code> flag is set. <br><br> <a href="https://jsfiddle.net/ollazarev/zw1p6pmq/"><img src="https://habrastorage.org/web/7aa/ae6/ca7/7aaae6ca7f4643a4b6be06496d65a57c.png"></a> <br><br>  The <code>u</code> flag also affects <b>excluding character classes</b> .  For example, <code>/[^a]/</code> equivalent to <code>/[\0-\x60\x62-\uFFFF]/</code> , which matches any BMP character except <code>a</code> .  But with the flag <code>u</code> <code>/[^a]/u</code> corresponds to a much larger set of all Unicode characters except <code>a</code> . <br><br> <a href="https://jsfiddle.net/ollazarev/qznudq5h/"><img src="https://habrastorage.org/web/45c/61e/3ea/45c61e3eaf3c413bbfaec25454b08953.jpg"></a> <br><br><h3>  Effect on escape sequences </h3><br>  The <code>u</code> flag affects the value of the <code>\D</code> , <code>\S</code> , and <code>\W</code> escape sequences.  In the absence of the flag <code>u</code> , <code>\D</code> , <code>\S</code> , and <code>\W</code> correspond to any BMP characters that do not correspond to <code>\d</code> , <code>\s</code> and <code>\w</code> , respectively. <br><br> <a href="https://jsfiddle.net/ollazarev/xr9fbtu5/"><img src="https://habrastorage.org/web/ee2/5fc/735/ee25fc735870474b839125ee764f1f36.jpg"></a> <br><br>  The <code>u</code> , <code>\D</code> , <code>\S</code> , and <code>\W</code> flags also correspond to astral symbols. <br><br> <a href="https://jsfiddle.net/ollazarev/e04t7rvx/"><img src="https://habrastorage.org/web/109/72e/08d/10972e08da9b4086bdae37814bc4cac8.png"></a> <br><br>  The <code>u</code> flag does not refer to their inverse analogues <code>\d</code> , <code>\s</code> and <code>\w</code> .  It was suggested that <code>\d</code> and <code>\w</code> (and <code>\b</code> ) be more Unicode-compatible, but <a href="https://github.com/mathiasbynens/es-regexp-unicode-character-class-escapes">this proposal</a> was rejected. <br><br><h3>  Impact on flag <code>i</code> </h3><br>  When the <code>i</code> and <code>u</code> flags are set, all characters are implicitly <a href="http://unicode.org/Public/UCD/latest/ucd/CaseFolding.txt">converted</a> to a single register using a <a href="http://unicode.org/Public/UCD/latest/ucd/CaseFolding.txt">simple conversion</a> provided by the Unicode standard, immediately before matching them. <br><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> es5regex = <span class="hljs-regexp"><span class="hljs-regexp">/[az]/i</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> es6regex = <span class="hljs-regexp"><span class="hljs-regexp">/[az]/iu</span></span>; <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( es5regex.test(<span class="hljs-string"><span class="hljs-string">'s'</span></span>), es6regex.test(<span class="hljs-string"><span class="hljs-string">'s'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// true true es5regex.test('S'), es6regex.test('S'), // true true // Note: U+017F   `S`. es5regex.test('\u017F'), es6regex.test('\u017F'), // false true // Note: U+212A   `K`. es5regex.test('\u212A'), es6regex.test('\u212A') // false true );</span></span></code> </pre><br>  Case-folding is applied to characters in a regular expression pattern, as well as characters in a matching string. <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-regexp"><span class="hljs-regexp">/\u212A/iu</span></span>.test(<span class="hljs-string"><span class="hljs-string">'K'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// true /\u212A/iu.test('k'), // true /\u017F/iu.test('S'), // true /\u017F/iu.test('s') // true );</span></span></code> </pre><br>  This case-casting logic also applies to the <code>\w</code> and <code>\W</code> escape sequences, which also affects the <code>\b</code> and <code>\B</code> escape sequences.  <code>/\w/iu</code> corresponds to <code>[0-9A-Z_a-z]</code> , but also <a href="https://codepoints.net/U%2B017F">U + 017F</a> , because U + 017F from the matched regular expression string is converted (canonicalizes) to <code>S</code>  The same goes for <a href="https://codepoints.net/U%2B212A">U + 212A</a> and <code>K</code>  Thus, <code>/\W/iu</code> equivalent to <code>/[^0-9a-zA-Z_\u{017F}\u{212A}]/u</code> . <br><br><pre> <code class="javascript hljs"><span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log( <span class="hljs-regexp"><span class="hljs-regexp">/\w/iu</span></span>.test(<span class="hljs-string"><span class="hljs-string">'\u017F'</span></span>), <span class="hljs-comment"><span class="hljs-comment">// true /\w/iu.test('\u212A'), // true /\W/iu.test('\u017F'), // false /\W/iu.test('\u212A'), // false /\W/iu.test('s'), // false /\W/iu.test('S'), // false /\W/iu.test('K'), // false /\W/iu.test('k'), // false /\b/iu.test('\u017F'), // true /\b/iu.test('\u212A'), // true /\b/iu.test('s'), // true /\b/iu.test('S'), // true /\B/iu.test('\u017F'), // false /\B/iu.test('\u212A'), // false /\B/iu.test('s'), // false /\B/iu.test('S'), // false /\B/iu.test('K'), // false /\B/iu.test('k') // false );</span></span></code> </pre><br><h3>  Impact on HTML documents </h3><br>  Believe it or not, the <code>u</code> flag also affects HTML documents. <br><br>  <a href="https://html.spec.whatwg.org/multipage/forms.html">The pattern attribute</a> for <code>input</code> and <code>textarea</code> elements allows you to specify a regular expression to validate user input.  The browser then provides you with styles and scripts to create behavior based on the validity of the input. <br><br> <a href="https://jsfiddle.net/ollazarev/5xbfd4cv/"><img src="https://habrastorage.org/web/f74/30e/c1b/f7430ec1bdfe4723a8e16b32f87b8346.jpg"></a> <br><br>  The <code>u</code> flag is always enabled for regular expressions compiled using the HTML attribute <code>pattern</code> .  Here is a <a href="https://mathiasbynens.be/demo/pattern-u">demo</a> . <br><br><h3>  Support </h3><br>  Currently, the ES6 <code>u</code> flag for regular expressions is available in stable versions of all major browsers.  Browsers are gradually starting to use this functionality for the HTML attribute <code>pattern</code> . <br><table><tbody><tr><th>  Browser (s) </th><th>  JavaScript engine </th><th>  <code>u</code> flag </th><th>  <code>u</code> flag for <code>pattern</code> attribute </th></tr><tr><th>  Edge </th><th>  Chakra </th><td>  <a href="https://connect.microsoft.com/IE/feedback/details/1102227/regexp-u-flag-support-is-flaky"><font color="green">issue # 1102227</font></a> + <a href="https://github.com/Microsoft/ChakraCore/issues/517"><font color="green">issue # 517</font></a> + <a href="https://github.com/Microsoft/ChakraCore/issues/1181"><font color="green">issue # 1181</font></a> </td><td>  <a href="https://developer.microsoft.com/en-us/microsoft-edge/platform/issues/7113940/"><font color="red">issue # 7113940</font></a> </td></tr><tr><th>  Firefox </th><th>  Spidermonkey </th><td>  <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1135377"><font color="green">bug # 1135377</font></a> + <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1281739"><font color="green">bug # 1281739</font></a> </td><td>  <a href="https://bugzilla.mozilla.org/show_bug.cgi%3Fid%3D1227906"><font color="green">bug # 1227906</font></a> </td></tr><tr><th>  Chrome / Opera </th><th>  V8 </th><td>  <a href="https://code.google.com/p/v8/issues/detail%3Fid%3D2952"><font color="green">V8 issue # 2952</font></a> + <a href="https://bugs.chromium.org/p/v8/issues/detail%3Fid%3D5080"><font color="green">issue # 5080</font></a> </td><td>  <a href="https://code.google.com/p/chromium/issues/detail%3Fid%3D535441"><font color="green">issue # 535441</font></a> </td></tr><tr><th>  Webkit </th><th>  Javascriptore </th><td>  <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D154842"><font color="green">bug # 154842</font></a> + <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D151597"><font color="green">bug # 151597</font></a> + <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D158505"><font color="green">bug # 158505</font></a> </td><td>  <a href="https://bugs.webkit.org/show_bug.cgi%3Fid%3D151598"><font color="red">bug # 151598</font></a> </td></tr></tbody></table><br><h3>  Recommendations for developers </h3><br><ul><li>  From now on, use the <code>u</code> flag for every regular expression you write. </li><li>  ... but do not blindly add the <code>u</code> flag to existing regular expressions, as this may implicitly change their meaning. </li><li>  Avoid combining the <code>u</code> and <code>i</code> flags.  It is better to explicitly include in the regular expression the characters of all registers than to suffer from the implicit programmatic reduction of characters to one register. </li><li>  Use transpiler to make sure your code works everywhere, including outdated environments. </li></ul><br><h3>  Transforming (transpiling) Unicode ES6 regular expressions in ES5 </h3><br>  I created <a href="https://github.com/mathiasbynens/regexpu"><i>regexpu</i></a> , a <a href="https://github.com/mathiasbynens/regexpu"><i>transpiler</i></a> that transforms Unicode ES6 regular expressions into the equivalent ES5 code that works today.  This will allow you to play with new, evolving functionality. <br><br> <a href="https://mothereff.in/regexpu"><img src="https://habrastorage.org/web/b9f/b88/ab1/b9fb88ab1f76442db0d3cbefd47054e1.png"></a> <br><br>  Full-scale ES6 / ES7 transpilers, such as Traceur and Babel, depend on regexpu for <code>u</code> transpilation.  <a href="https://github.com/mathiasbynens/regexpu/issues">Let me know</a> if you can break it. </div><p>Source: <a href="https://habr.com/ru/post/338366/">https://habr.com/ru/post/338366/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338354/index.html">The category "Indie" appeared in the App Store. But it's not about that.</a></li>
<li><a href="../338356/index.html">The art of creating process diagrams</a></li>
<li><a href="../338358/index.html">Alien among his own: how to recruit to become part of the IT community</a></li>
<li><a href="../338360/index.html">Approximate search methods for nearest neighbors</a></li>
<li><a href="../338362/index.html">Create an ‚Äúexternal outline‚Äù of an ecosystem with independent developers: the results of the Skyeng API contest</a></li>
<li><a href="../338374/index.html">As I wrote a book on almost sotsinzhiniringu</a></li>
<li><a href="../338378/index.html">Computer forensics (forsensik): a selection of useful links</a></li>
<li><a href="../338380/index.html">Abstraction of the network layer using "strategies"</a></li>
<li><a href="../338382/index.html">Our method of calculating the stack of printed circuit boards</a></li>
<li><a href="../338384/index.html">First-line support bikes: great work if you have strong nerves</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>