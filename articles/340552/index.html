<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we updated the search tips in Yandex and found the correct metric for them</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Search tips in Yandex for almost 10 years. At first glance, they seem to be rather simple fichey - many are still sure that the sadjest only takes int...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we updated the search tips in Yandex and found the correct metric for them</h1><div class="post__text post__text-html js-mediator-article"><p>  Search tips in Yandex for almost 10 years.  At first glance, they seem to be rather simple fichey - many are still sure that the sadjest only takes into account how often people enter certain requests.  Several years ago we <a href="https://habrahabr.ru/company/yandex/blog/160749/">told on Habr√©</a> how much complex mathematics is in order to find the right next word and help a person to formulate his question.  Then we even calculated that search tips save people about 60 years. </p><br><p>  To some extent, the sadjest even outstripped his time: now, when the search is increasingly used from mobile, the speed with which a person enters a request and receives an answer has become a critical factor.  The value of hints in the changed world has grown, and in order to continue to bring happiness to users, we also need to constantly move forward. </p><br><p>  I started the topic of search prompts in Yandex in early 2016.  The goal, facing the team of sadjest at the time, sounded very ambitious: ‚ÄúMake the best sadzhest on mobile‚Äù, no more and no less! </p><br><p> <a href="https://habrahabr.ru/company/yandex/blog/340552/"><img src="https://habrastorage.org/webt/59/e3/72/59e372023720d898202272.png" alt="image"></a> </p><br><p>  Remembering what has been done since then in the field of search tips in Yandex, it is difficult to get rid of two sensations.  First: how much we have done!  Second: did all this have happened before?  Indeed, a lot has been done, but these things often seem so simple and obvious that it is hard to believe that they have not existed. </p><br><p>  Under the cut is an exciting drama about how technology, design and product have changed, and how we looked for a metric to which we can orient ourselves.  This is an instructive story that if you feel that the product is well made, but the metrics say the opposite, then something is wrong with them and not with you. </p><a name="habracut"></a><br><h2 id="1-poslovnyy-sadzhest">  1. The word sjest </h2><br><p>  By the beginning of 2016, the search for Yandex on mobile came up with the so-called tap-ahead version of the sadjest.  If we both showed and continue to show the usual ‚Äúlower case‚Äù version of the sadjest on the desktop, in which when you click on a line with a hint, the query is immediately set, the tangent ahead option of the sadzhesta is more difficult. </p><br><p><img src="https://habrastorage.org/webt/59/e9/d7/59e9d70d12c2e489691838.png"></p><br><p>  The idea is this.  Desktop keyboards are comfortable and, as a rule, users type texts using them rather quickly.  On mobile, the situation is different and therefore, if the prompts do not have the option the user needs, it is much more difficult for him to simply add the missing part of the query.  Therefore, they decided to accompany the first word of each request with a plus sign and specially mark it.  When you click on this selection, the word was added to the already typed text of the query, and the transition to the search did not occur.  So it was possible to type the necessary query word by word. </p><br><p>  The problem with tap-ahead sadgets is that users don't understand it.  Frankly, I also do not understand him, even after a year and a half of work in the event.  How to memorize which places you can press and which places you don‚Äôt, it‚Äôs easier just to enter the entire query.  So the users did that too. </p><br><p>  It would be much easier for them to visually spread the elements with different functionality.  This is how the word-by-word summon appeared, which has been working in Yandex mobile search since February 2016.  At that time, he looked like this: </p><br><p><img src="https://habrastorage.org/webt/59/ea/35/59ea352d94e9b296404433.png" alt="Word for wordpress"></p><br><p>  In this embodiment, the possibility of immediately setting up a long query as a whole has completely disappeared.  It can be said that it was conceived: there is extremely little space on mobile screens, and the ends of long requests were inevitably lost sight of.  As a result, users did not understand at all what they were asking, and they often had to change the text of an already entered query. </p><br><h2 id="2-metriki">  2. Metrics </h2><br><p>  In the desktop version with sadjest metrics, everything is more or less clear: the more often users click on sadjest, the better.  Therefore, the main metrics were: </p><br><ol><li>  Offline: coverage.  What percentage of requests made on a particular day could users find in the event? </li><li>  Online: What is the proportion of queries entered with the help of sadgetsta? </li></ol><br><p>  On the mobile situation was more difficult.  Since we assume that the request can be entered "in parts", it is important to know not only the entire request, but also all its parts.  What is the ‚Äúquery entered using sadjest‚Äù is also unclear: after all, it was possible to click once on the word-by-word hint in the process, but you can - five.  The second is somewhat better. </p><br><p>  Therefore, for mobile, we had to make new metrics on which we could accept changes in search prompts. </p><br><h3 id="21-oflayn">  2.1.  Offline </h3><br><p>  Offline metrics are metrics for which real users are not required.  They can be calculated using logs, assessors, or simply mathematical formulas. </p><br><p>  In the case of sadgest, it immediately comes to mind creating a kind of ‚Äúuser model‚Äù.  Suppose a user has entered the first few characters of the query.  In response, Yandex showed him some word-by-word clues.  Some of them continue his query in the right way.  We will assume that in such a situation, he acts greedily and immediately clicks on the corresponding hint, or continues to type the query by letter if none of the hints are right for him.  This continues until the request is fully specified.  At the end, we will measure the total number of actions (keystrokes and prompts) that the user performed.  This will be our metric, which we call ExpectedActionsCount (EAC). </p><br><p>  One important aspect can be distinguished from this metric: how often does the user not have to start entering the next word, since it already exists among the word-by-word hints?  Take the total number of correctly predicted next words and divide by their total number - we get the GuessProbability metric. </p><br><p>  As a rule, two metrics change unidirectionally: a decrease in the ExpectedActionsCount is usually accompanied by an increase in GuessProbability. </p><br><p>  With the help of these metrics, we made the first noticeable change in the word by word sadzhesta: we rolled out the ability to combine pairs of words into digrams.  So, a rare user will want to enter the query ‚ÄúEiffel Height‚Äù, it‚Äôs more likely that he will like the query ‚ÄúEiffel Tower Height‚Äù.  Criteria for displaying bigrams are easy to set up, having offline metrics - so they are designed to go through a large number of options in order to check only the best of them on users. </p><br><p>  Interestingly, the EAC with disabled sadgetsta is approximately 19: in fact, this is the average length in the characters of requests to Yandex.  Using the sajest, EAC was initially equal to 13.5, i.e.  saved almost a third of the actions to enter a request.  Currently, the EAC is approximately 11.5. </p><br><h3 id="22-onlayn">  2.2.  Online </h3><br><p>  However, offline models will never tell the full truth about user behavior, since any models are inaccurate. </p><br><p>  It immediately seemed to us that the main goal of the event is to make the input of requests convenient, therefore the speed of entering requests should be the main quality criterion.  Therefore, we invented simple metrics on the move: the percentage of queries entered faster than in X seconds for different X. </p><br><p>  Having built a graph for these metrics from the beginning of the year, we were horrified: it turned out that they had deteriorated sharply when introducing the word-by-word sadget!  Immediately after its inclusion in the production, users began to enter more slowly.  However, then the input speed gradually grew, and by August surpassed the February figures.  Here, for example, the graph of the share of requests that are entered in less than 15 seconds, from January to July 2016.  The graph is normalized so that the unit is taken as the value at the very beginning of the observations. <br><img src="https://habrastorage.org/webt/59/ef/1d/59ef1da205116346053744.png" alt="Change in the proportion of quickly entered queries"></p><br><p>  It turns out that at the time of implementation, the share of quickly entered queries fell by more than six percent! </p><br><p>  During the period under review, we had only one major introduction - the very union of words into digrams, and the corresponding discord that occurred in May is clearly visible.  It is surprising that the input speed grew and at a time when we did not launch anything new.  In other words, users gradually get used to the new input method and the input speed grows by itself! </p><br><p>  A more detailed study of the graphs revealed some other patterns: </p><br><ul><li>  on weekends, users enter faster than on weekdays; </li><li>  In the summer, the input speed variability disappears. </li></ul><br><p>  Not much time has passed since the introduction of new metrics, but autumn was already approaching - a time when many indicators are strongly influenced by seasonality.  The input speed did not become an exception: the share of quickly entered queries fell sharply! <br><img src="https://habrastorage.org/webt/59/ef/1e/59ef1ec3f1118744540860.png" alt="Change in the proportion of quickly entered queries"></p><br><p>  The first time was very scary: the input slowed down very much, for sure we broke something and did not notice it!  The answer, however, was much simpler.  With the onset of autumn, users began to ask much longer requests.  Here is a graph of the share of requests of more than seven words: it has grown by more than a third! <br><img src="https://habrastorage.org/webt/59/e9/ce/59e9ce9641a56110168032.png" alt="Change in the proportion of long requests"></p><br><p>  It became clear that the ‚Äúshare of quickly entered queries‚Äù is a good, but seasonally sensitive metric.  For a long time we were looking for a metric that would notice our releases and at the same time was resistant to seasonality.  This metric was ‚Äúinput time per request character‚Äù.  Here is what her schedule looks like for the period in question: <br><img src="https://habrastorage.org/webt/59/e9/ce/59e9ce9645e54105303033.png" alt="Change in the proportion of quickly entered queries"></p><br><p>  Thus, six months after the introduction of the word-by-word sadget, users began to enter queries about 5% faster when compared with the beginning of the year when tap-ahead was used.  It remains only to add that from January 2016 to October 2017, Yandex mobile search users started asking queries 17% faster - an impressive demonstration of the effectiveness of our efforts! </p><br><p>  It is worth mentioning that the spontaneous increase in the speed of input continues to this day.  Every day, our users are entering requests faster and faster.  However, we, of course, help them with this and our releases. </p><br><h3 id="3-poslovnyy-i-polnotekstovyy-vvod">  3. Verbal and full-text input </h3><br><p>  After metrics are thought up and checked up, opportunities for imaginations open.  Let's think about how you could speed up the input?  Well, we can always improve the data and it is better and better to choose options for continuations of requests.  But what can we do with the purely visual part? </p><br><p>  The answer is quite simple: let's combine the old and the new approaches.  In addition to the word-by-word hints, we‚Äôll show old, lowercase, or full-text.  Then, if the necessary request has already appeared on the screen, the user will immediately be able to select it, and this will save several actions and time.  The difference between the word-by-word and word-by-full sadzhest is easy to understand from the following illustration: </p><br><p><img src="https://habrastorage.org/webt/59/ea/36/59ea3641ba8da643859460.png"></p><br><p>  It is seen that the changes here are somewhat more substantial than one might expect.  For example, now the page with search results is not visible at all.  On the other hand, are they needed if the user has already decided to enter a new query? </p><br><p>  It turned out not really needed.  Users reacted as expected to this introduction: the input speed increased, as well as the number of users who ever use the sajest. </p><br><p>  Sujest was an interesting and controversial way.  Once we had only full-text hints, then only word-by-words, in the end we came to a combined version.  But this combined version was very different from the previous iteration (tap-ahead) in that now the various functional elements with different behavior are separated by interface.  This made it much easier to understand the purpose of each element and use the result more efficiently. </p><br><h2 id="4-drugie-eksperimenty-s-dizaynom">  4. Other design experiments. </h2><br><p>  When it became clear that design changes in search prompts can significantly affect the metrics, imagination could not be stopped. </p><br><p>  To begin with, let's try to enhance the effect of full-text tooltips.  If all the word forms are pulled out in one line (with the possibility of scrolling), there will be more space for full-text prompts and, possibly, the input will become even faster. <br><img src="https://habrastorage.org/webt/59/ea/35/59ea35235ab45260775330.png" alt="Scrolling for WordTips"></p><br><p> On the other hand, you can try something very very strange.  Let's always suggest possible continuations for the most likely next word in a separate column!  Thus was born the variant that we call the ‚Äúsadest as a graph‚Äù: <br><img src="https://habrastorage.org/webt/59/ea/35/59ea3522ebb65643837885.png" alt="Sujest as a graph"></p><br><p>  Sajest in the form of a graph made a splash on all UX studies.  All users who saw it for the first time, literally said the following: ‚Äúoooh, finally help me to enter a request!‚Äù.  Those who still did not suspect that there are clues in the search, finally noticed them.  The one who knew about their existence, began to use them more often. </p><br><p>  In addition, we also tried to change the size of the buttons in the word prompts and their color.  In general, the idea was clear: you need to somehow increase the visibility of the prompts, because they are useful and they need to be used more often! </p><br><p>  However, when checking online both hypotheses were discarded.  The differences between the metrics ‚Äúshare of sajest use‚Äù and ‚Äúinput speed‚Äù were immediately found out.  Unfortunately, too noticeable prompts harm users: they start too often to skip their eyes between the sajest and the keyboard, and as a result they enter too slowly.  In addition, it was one of the rare cases where the total success on UX research is accompanied by an equally disastrous performance online. </p><br><h2 id="5-setevye-istorii">  5. Network stories </h2><br><p>  We already understood that the input speed is made up of data quality and presentation quality.  However, it turned out that there is another aspect of the problem - the network. </p><br><p> Historically, the source of search clues lived on <code>suggest.yandex.net</code> , to which the search layout made asynchronous requests during user input. </p><br><p>  By the end of the summer of 2016, it became clear that this scheme was outdated.  Many services have already lived behind the ‚Äúsingle domain‚Äù <code>yandex.ru</code> : for example, images <code>yandex.ru/images</code> , video <code>yandex.ru/video</code> and so on.  What for?  To save network interaction.  We have one single balancer for all services available on the <code>yandex.ru</code> domain.  This means that without leaving this domain, the user only needs to establish a network connection once.  In the case of sadgest, this was not the case: for a hike with sadgest from the <code>yandex.ru</code> domain, it was necessary to establish a new network connection, which on the 2G-Internet sometimes took a few seconds to wait. </p><br><p>  Another interesting point is the behavior of ad blockers.  It turned out that some of them block cross-domain queries.  In our case, this led to the fact that some users had a sadst for several days completely non-functional! </p><br><p>  Therefore, we decided to conduct an experiment in which the alarm is transferred for a single balancer for Yandex services. </p><br><p>  It is worth noting what the sadjest differs from other services.  The fact is that each search request requires approximately as many requests to the sjest source as there are characters in it.  Therefore, it is not surprising that the typical RPS for a sajestovogo source is orders of magnitude greater than the RPS of other services, including  large search.  100k RPS is the norm, a sadjest is one of the most highly loaded Yandex services that directly interact with users (some internal services withstand <em>millions of</em> RPS). </p><br><p>  For a single balancer, this means a very significant increase in load, so in order to meet the needs of search hints, we had to significantly invest in hardware, and we didn‚Äôt want to do this without confirming the user benefit hypothesis. </p><br><p>  As a result, the experiment was one of the most successful of all time.  Its steepness was manifested even in the fact that users started <em>to ask queries</em> to the search system <em>more often</em> , not to mention the increase in usability of the sadget and the input speed by units of percent. </p><br><h2 id="buduschee">  Future </h2><br><p>  At this historical moment, we realized that the full development of input on mobile is associated with many different aspects: the quality of data, the interface, and the network.  Further development should be carried out in all these areas and, possibly, in some more new ones that we have not yet noticed. </p><br><p>  In addition, the prompts are present not only in the search, but also in our applications, in the browser, in services other than Search, and with them, too, had to do something.  In addition, input is not required to be text only. </p><br><p>  And we did all this in 2017.  About what it led to, we'll talk in the next article. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/340552/">https://habr.com/ru/post/340552/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../340536/index.html">Tired of writing PropertyDrawer in Unity? There is a better way</a></li>
<li><a href="../340538/index.html">UFADEVCONF 2017 Conference Overview</a></li>
<li><a href="../340540/index.html">Russian AI Cup 2017 - to all fans of StarCraft and C & C is dedicated</a></li>
<li><a href="../340544/index.html">A dozen Linux tricks that really save a lot of time</a></li>
<li><a href="../340550/index.html">Code review humanly (part 1)</a></li>
<li><a href="../340554/index.html">Determination of the stability of automatic control systems for industrial robots</a></li>
<li><a href="../340556/index.html">First TypeScript Demo</a></li>
<li><a href="../340558/index.html">Why do you need to stop using git rebase</a></li>
<li><a href="../340562/index.html">We need to go deeper: bypass the script that bypasses the adblock</a></li>
<li><a href="../340564/index.html">Work with videos in Full Throttle Remastered</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>