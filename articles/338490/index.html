<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>The first version of SignalR for ASP.Net Core 2.0 has been released.</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Habr! On September 14, it was announced the release of the first version of SignalR for ASP.Net Core, in connection with which I decided to transl...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>The first version of SignalR for ASP.Net Core 2.0 has been released.</h1><div class="post__text post__text-html js-mediator-article"><p>  Hi, Habr!  On September 14, it was announced the release of the first version of SignalR for ASP.Net Core, in connection with which I decided to translate a note on this event, adding it a bit.  The original note is available on the <a href="https://blogs.msdn.microsoft.com/webdev/2017/09/14/announcing-signalr-for-asp-net-core-2-0/">MSDN</a> blog. </p><br><h1 id="chto-novogo">  What's new? </h1><br><p>  SignalR for ASP.Net Core is a rewritten from scratch version of the original SignalR.  The new SignalR is simpler, more reliable and easier to use.  Despite these internal changes, we tried to make the library API closest to previous versions. </p><a name="habracut"></a><br><h1 id="javascripttypescript-klient">  Javascript / typeScript client </h1><br><p>  SignalR for ASP.Net Core has a completely new JavaScript client.  It is written using TypeScript and is no longer dependent on jQuery.  The client can also be used from Node.js with a few additional dependencies. </p><br><p> The client is distributed as an npm module, which contains the Node.js version of the client (connects via require), and also the browser version, which can be embedded using the <code>&lt;script&gt;</code> .  TypeScript header files built into the module make it easy to use a client from TypeScript applications. </p><br><p>  The client supports the latest versions of Chrome, FireFox, Edge, Safari, Opera, and Internet Explorer from version 9 (but not all transport protocols are compatible with each of the browsers). </p><br><h1 id="podderzhka-dvoichnyh-protokolov">  Binary protocol support </h1><br><p>  SignalR for ASP.Net Core offers two embedded protocols - text based on JSON and binary protocol based on <a href="http://msgpack.org/">MessagePack</a> .  Messages using the MessagePack protocol are usually smaller than the same messages in JSON.  For example, a hub message containing an integer unit value will consume 43 bytes when using JSON and only 16 bytes in a MessagePack.  (Note that the difference in size may vary depending on the type of message, its contents and the transport protocol used - binary messages sent via Server-Sent Events (SSE) will be encoded in base64, since SSE is a text transport). </p><br><h1 id="podderzhka-polzovatelskih-protokolov">  Custom protocol support </h1><br><p>  The SignalR hub protocol is <a href="">documented on GitHub</a> and now contains extension points that allow you to connect custom implementations. </p><br><h1 id="potokovaya-peredacha">  Streaming </h1><br><p>  Now it is possible to transfer data from the server to the client.  Unlike normal hub method calls, streaming means that the server can send results to the client before the call ends. </p><br><h1 id="ispolzovanie-signalr-s-chistymi-veb-soketami">  Using SignalR with clean web sockets </h1><br><p>  The process of connecting to SignalR has been simplified to the moment when, in the case of using web sockets, it is possible to connect to the server using a single request without using a client. </p><br><h1 id="uproschyonnoe-gorizontalnoe-masshtabirovanie">  Simplified horizontal scaling </h1><br><p>  Unfortunately, there is no ‚Äúsilver bullet‚Äù for horizontal scaling of applications - each application has its own requirements that must be considered when scaling.  We have done some work to simplify horizontal scaling and provide a Redis-based horizontal scaling component in this alpha version.  Support for other providers, for example, service bus, is being tested for the final release. </p><br><h1 id="chto-izmenilos">  What changed? </h1><br><p>  We added a number of new features to SignalR for ASP.Net Core, but at the same time we decided to remove support for some existing or change their behavior, as a result of which the new version of SignalR is not compatible with previous ones.  This means that you cannot use the old server with new clients or old clients with a new server.  Below are the functions that were excluded or the behavior of which has changed in the new version. </p><br><h1 id="uproschyonnaya-model-podklyucheniy">  Simplified Connection Model </h1><br><p>  In the existing version of SignalR, the client, in case of unsuccessful connection, tries to connect using another transport.  The client will not establish a connection if it cannot connect to the server by any of the available transports.  In the new version of SignalR, this functionality is no longer supported. </p><br><p>  Also, automatic reconnection is no longer available.  In the previous version, SignalR tried to restore the connection when the connection with the server was lost.  Now, if the client has disconnected, the user needs to explicitly establish a new connection.  It should be noted that this was required before - the client stopped trying to automatically restore the connection if it was not possible to restore it during a certain timeout.  Another reason for getting rid of this functionality was the high cost of storing messages sent to clients.  By default, the server saved the last 1000 messages, so that it could re-send them to the client with which the connection was lost.  Since each connection had its own buffer, storing these messages caused high memory consumption. </p><br><h1 id="obyazatelnost-privyazannyh-sessiy-sticky-sessions">  Binding Sessions (Sticky Sessions) </h1><br><p>  Using the horizontal scaling approach of the previous version of SignalR, clients could reconnect or send messages to any server in the farm.  Due to changes in this approach and the rejection of automatic reconnections, the client should exchange messages only with the server with which the connection was established. </p><br><h1 id="odin-hab-na-podklyuchenie">  One hub to connect </h1><br><p>  The new version of SignalR does not support the use of multiple hubs within the same connection.  Thanks to this, a simplification of the client API was achieved and the application of additional authentication policies and other middleware to the hub connection was simplified.  Also no longer required to subscribe to the methods of the hub before the start of the connection. </p><br><h1 id="drugie-izmeneniya">  Other changes </h1><br><p>  The ability to transfer an arbitrary state between clients and the hub (HubState), as well as support for state messages (Progress messages) has been removed.  Also in this version a replacement for the hub proxy was not added. </p><br><h1 id="nachalo-raboty">  Beginning of work </h1><br><p>  Installing SignalR is relatively simple.  After creating a new ASP.Net Core application, you need to add a dependency on the Microsoft.AspNetCore.SignalR nuget package as shown in the example </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk.Web"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp2.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.All"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"2.0.0"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.SignalR"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0-alpha1-final"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Folder</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"wwwroot\scripts\"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  and your hub class </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> System.Threading.Tasks; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.SignalR; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Sample</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Chat</span></span> : <span class="hljs-title"><span class="hljs-title">Hub</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Send</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> message</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Clients.All.InvokeAsync(<span class="hljs-string"><span class="hljs-string">"Send"</span></span>, message); } } }</code> </pre> <br><p>  This hub contains a method that, when called, will in turn call the Send method on each of the clients. </p><br><p>  After adding the hub class, you need to configure the server to process the sent requests as follows </p><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.AspNetCore.Builder; <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> Microsoft.Extensions.DependencyInjection; <span class="hljs-keyword"><span class="hljs-keyword">namespace</span></span> <span class="hljs-title"><span class="hljs-title">Sample</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">Startup</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">ConfigureServices</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { services.AddSignalR(); } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Configure</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IApplicationBuilder app</span></span></span><span class="hljs-function">)</span></span> { app.UseSignalR(routes =&gt; { routes.MapHub&lt;Chat&gt;(<span class="hljs-string"><span class="hljs-string">"chat"</span></span>); }); } } }</code> </pre> <br><p>  After setting the necessary settings, you can call the hub methods from clients and vice versa.  To use the JavaScript client in the browser, you need to install an npm package containing the SignalR client with the following command <br> <code>npm install @aspnet/signalr-client</code> <br>  Now you can copy signalr-client.js to the scripts folder of your project and connect it to the page </p><br><pre> <code class="html hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">src</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"scripts/signalr-client.min.js"</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"></span><span class="hljs-tag"><span class="undefined"></span><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  Connecting the script will allow you to start connecting to the server and exchange commands with it. </p><br><pre> <code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">let</span></span> connection = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> signalR.HubConnection(<span class="hljs-string"><span class="hljs-string">'/chat'</span></span>); connection.on(<span class="hljs-string"><span class="hljs-string">'send'</span></span>, data =&gt; { <span class="hljs-built_in"><span class="hljs-built_in">console</span></span>.log(data); }); connection.start() .then(<span class="hljs-function"><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function"> =&gt;</span></span> connection.invoke(<span class="hljs-string"><span class="hljs-string">'send'</span></span>, <span class="hljs-string"><span class="hljs-string">'Hello'</span></span>));</code> </pre> <br><p>  To use the managed client, you need to add a link to the <em>Microsoft.AspNetCore.SignalR.Client</em> package </p><br><pre> <code class="xml hljs"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Sdk</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.NET.Sdk"</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span>Exe<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">OutputType</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span>netcoreapp2.0<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TargetFramework</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PropertyGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">PackageReference</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Include</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"Microsoft.AspNetCore.SignalR.Client"</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Version</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">"1.0.0-alpha1-final"</span></span></span><span class="hljs-tag"> /&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ItemGroup</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Project</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre> <br><p>  after which it will be possible to access the methods of the hub and handle calls to client methods. </p><br><p>  If you want to take advantage of streaming, you need to create a hub method that will return <code>ReadableChannel&lt;T&gt;</code> or <code>IObservable&lt;T&gt;</code> .  The following is the hub method from the <a href="https://github.com/aspnet/SignalR-samples">StockTimer</a> example, which transmits the stock value in the stream </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IObservable&lt;Stock&gt; </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StreamStocks</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> _stockTicker.StreamStocks(); }</code> </pre> <br><p>  JavaScript code called by this method looks like this. </p><br><pre> <code class="javascript hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">startStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>) </span></span>{ connection.stream(<span class="hljs-string"><span class="hljs-string">"StreamStocks"</span></span>).subscribe({ <span class="hljs-attr"><span class="hljs-attr">next</span></span>: displayStocks, <span class="hljs-attr"><span class="hljs-attr">error</span></span>: <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function"> (</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class="hljs-function">) </span></span>{ logger.log(err); } }); }</code> </pre> <br><p>  Each time a server sends a stream item, the <em>displayStocks</em> client method will be called. <br>  The hub method call from C # code is as follows </p><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">async</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">StartStreaming</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> channel = connection.Stream&lt;Stock&gt;(<span class="hljs-string"><span class="hljs-string">"StreamStocks"</span></span>, CancellationToken.None); <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">await</span></span> channel.WaitToReadAsync()) { <span class="hljs-keyword"><span class="hljs-keyword">while</span></span> (channel.TryRead(<span class="hljs-keyword"><span class="hljs-keyword">out</span></span> <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> stock)) { Console.WriteLine(<span class="hljs-string"><span class="hljs-string">$"</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stock.Symbol}</span></span></span><span class="hljs-string"> </span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">{stock.Price}</span></span></span><span class="hljs-string">"</span></span>); } } }</code> </pre> <br><h1 id="perehod-s-suschestvuyuschey-versii-signalr">  Transition from the existing version of SignalR </h1><br><p>  In the coming weeks, migration documentation from the previous version of SignalR will be released. </p><br><h1 id="izvestnye-problemy">  Known Issues </h1><br><ul><li>  A connection through an SSE transport may be lost after two minutes of inactivity if the server is started via IIS </li><li>  Web sockets do not work when using IIS server on Windows 7 or Windows Server 2008 R2 </li><li>  Using SSE in a C # client may cause the client to freeze if it is closed while data is being received from the server. </li><li>  Stream calls cannot be canceled by the client. </li><li>  Building a production version is not possible with angular-cli, since UglifyJS does not support the ES6 standard.  A workaround for this problem is presented in this <a href="https://github.com/aspnet/SignalR/issues/867">comment.</a> </li></ul><br><h1 id="ot-avtora-perevoda">  From the author of the translation </h1><br><p>  From myself I want to add a small example of using the TypeScript version of the client in the SPA application on Angular.  After completing all the steps above in the Getting Started section, in the Angular component it is enough to import the <code>HubConnection</code> class and use its methods.  In the base application example created using the <code>dotnet new angular</code> command, in the <code>fetchdata.component.ts</code> component I added the functionality of displaying the number of clicks from the <code>counter</code> component as follows </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Component, Inject } from <span class="hljs-string"><span class="hljs-string">'@angular/core'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { Http } from <span class="hljs-string"><span class="hljs-string">'@angular/http'</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> { HubConnection } from <span class="hljs-string"><span class="hljs-string">"@aspnet/signalr-client"</span></span>; <span class="hljs-meta"><span class="hljs-meta">@Component({ selector: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'fetchdata'</span></span></span><span class="hljs-meta">, templateUrl: </span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'./fetchdata.component.html'</span></span></span><span class="hljs-meta"> })</span></span> export <span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">class</span></span></span><span class="hljs-class"> </span><span class="hljs-title"><span class="hljs-class"><span class="hljs-title">FetchDataComponent</span></span></span><span class="hljs-class"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> forecasts: WeatherForecast[]; <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> count: number; <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> notificationHub: HubConnection; <span class="hljs-keyword"><span class="hljs-keyword">constructor</span></span>(http: Http, <span class="hljs-meta"><span class="hljs-meta">@Inject(</span><span class="hljs-meta-string"><span class="hljs-meta"><span class="hljs-meta-string">'BASE_URL'</span></span></span><span class="hljs-meta">)</span></span> baseUrl: string) { http.<span class="hljs-keyword"><span class="hljs-keyword">get</span></span>(baseUrl + <span class="hljs-string"><span class="hljs-string">'api/SampleData/WeatherForecasts'</span></span>).subscribe(result =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.forecasts = result.json() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> WeatherForecast[]; }, error =&gt; console.error(error)); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notificationHub = new HubConnection(<span class="hljs-string"><span class="hljs-string">"/notifications"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notificationHub.on(<span class="hljs-string"><span class="hljs-string">"send"</span></span>, (<span class="hljs-keyword"><span class="hljs-keyword">data</span></span>) =&gt; { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.count = <span class="hljs-keyword"><span class="hljs-keyword">data</span></span>; }); <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notificationHub.start(); } }</code> </pre> <br><p>  The hub addresses specified in the constructor call must match the one specified in the Startup class of the ASP.Net Core application (in the example from the translation, this address is "chat").  The hub's Send method is called from the <code>counter</code> component as follows. </p><br><pre> <code class="hljs kotlin"><span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.notificationHub.invoke(<span class="hljs-string"><span class="hljs-string">"send"</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.currentCount);</code> </pre> <br><p>  PS This is my first post and at the same time a translation, for this I ask for comments on its quality to send to me in BOS. </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/338490/">https://habr.com/ru/post/338490/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../338478/index.html">"Invisible design": we design together with cars</a></li>
<li><a href="../338480/index.html">Kali Linux: filtering traffic using netfilter</a></li>
<li><a href="../338482/index.html">Comodo Group reports a fourfold increase in the number of cyber threats</a></li>
<li><a href="../338484/index.html">Fujitsu will build a supercomputer for the study of artificial intelligence</a></li>
<li><a href="../338488/index.html">IT Championship "Racing Heroes", or the first project LANIT on the military ground "Alabino"</a></li>
<li><a href="../338492/index.html">How I wrote my CMS, and why I do not recommend you do the same.</a></li>
<li><a href="../338494/index.html">How Android works, part 3</a></li>
<li><a href="../338496/index.html">VMworld 2017 Europe Conference. Day 2, 3</a></li>
<li><a href="../338498/index.html">Using Zabbix to monitor MS SQL Server database</a></li>
<li><a href="../338502/index.html">Full-stack-developers. New trend or real need of companies?</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>