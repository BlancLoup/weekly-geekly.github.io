<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>php and nodejs, the difference on the fingers</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Being a regular user of the nodejs.ru forum, I often observe a picture when people starting to learn nodejs compare it with php, and sometimes try to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>php and nodejs, the difference on the fingers</h1><div class="post__text post__text-html js-mediator-article">  Being a regular user of the <a href="http://forum.nodejs.ru/">nodejs.ru</a> forum, I often observe a picture when people starting to learn nodejs compare it with php, and sometimes try to work with it as with php.  I would like to explain ‚Äúon fingers‚Äù the difference between php and nodejs in relation to the work of the site.  This article is intended for beginners.  I will deliberately speak in a very simplified way, without going into deep details, in order to show the differences in technologies as simply as possible. <br><a name="habracut"></a><br>  It is always better to explain something by a clear example with pictures.  Therefore, let's invent a small ‚Äúspherical site in a vacuum‚Äù and accept some conditions. <br><br>  Suppose we have a site that understands only two requests: <br>  Request A is executed in 1 second, it does not require access to the database. <br>  Request B is executed in 5 seconds, and 4 of them, it spends waiting for the response of the database. <br>  We also agree that the time between requests is at least 1 second. <br><br><h4>  Php </h4><br>  Let's take a look at how this works on php. <br>  In its most simplified form, the server architecture looks like this: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/331/ddd/b5b/331dddb5b1ab5fdb8f416a8f24ee3175.png"><br><br>  The following is important here, the web server receiving a request from the client sends it to the php process.  In turn, the php process can process one request at a time, upon completion of the work, the result is returned to the web server, and the process itself ceases to exist.  The web server receiving the response sends the result to the client and closes the connection. <br><br>  If there is only one php process, the work of our server can be displayed on this scheme: <br><br><img src="https://habrastorage.org/storage2/dc4/d0b/49c/dc4d0b49c5057f10c0661510ff58f6d5.png"><br><br>  It is clear from the diagram that as long as only requests come to us, our server responds to them vigorously and generally performs its tasks, but as soon as request B comes to us, the server stops responding to requests until the answer to request B is ready. Also on the diagram you can see that most of the time query B, ‚Äúeveryone‚Äù waits for the result of the database operation. <br><br>  To solve this problem, we have to increase the number of php processes, let's increase to 2x, as a result, the scheme takes the following form: <br><br><img src="https://habrastorage.org/storage2/50c/d69/f21/50cd69f21cb514974be3e2a06cb47155.png"><br><br>  From this scheme, it is clear that request B ‚Äúhangs‚Äù in processing in the first php process, while the server continues to respond to other requests.  Everything will go well until the moment when two requests B come to us, then both php processes will ‚Äúhang‚Äù waiting for the base to respond, and the server as a whole will stop responding until one of them is free. <br><br>  Well, we already know what to do?  That's right, let's take and increase the number of php processes, immediately to 20 or 30 and the problem seems to be gone, although in fact the problem just drifted away a bit and the moment when 30 requests came B comes.  The whole trouble is that we can not create infinitely many php processes and the way to increase them in exorbitant quantities is incorrect. <br><br>  The most important thing that should be taken out of these schemes is that the operations of working with the database in php are performed synchronously.  In our case, the process that performed the query to the database is unable to process other requests and is forced to ‚Äúhang‚Äù (without doing anything) expecting a response from the database. <br><br><h4>  nodejs </h4><br>  What does nodejs give us? <br>  First, let's see how a simple server looks like: <br><br><img src="https://habrastorage.org/storage2/220/eaa/95d/220eaa95da826a6b14ec7e3c2a5c484f.png"><br><br>  Immediately striking is the fact that the server includes the processors of requests A and B directly, as well as the Web server itself.  All this stuff turns in one node process and constantly hangs in memory. <br><br>  Let's look at the scheme of work: <br><br><img src="https://habrastorage.org/storage2/ddb/a7e/71c/ddba7e71c3d13c4dccb2802a1721d2c1.png"><br><br>  The diagram clearly shows that requests B do not cause the server to ‚Äúhang‚Äù while waiting for the base to respond.  The server receiving the request B, simply generates and sends the request to the database, and will continue to respond to other requests, as soon as the response from the database is received, the server will return the result to the client.  In the case of nodejs, it doesn‚Äôt matter how or how many B requests come in, none of them will lead to ‚Äúhanging‚Äù waiting for the base to respond. <br><br><h4>  Conclusion </h4><br>  And the conclusion is simple. <br>  Having come to nodejs do not try to do something the way you did in php. <br>  Remember that you are working in an asynchronous environment, do not use blocking operations, you are killing the idea of ‚Äã‚Äãnodejs. <br>  Remember that nodejs handles many requests in one process that are constantly hanging in memory, so watch your variables and how you use memory. <br>  You should not run 50 node processes for one site, and generally you should not run them more than the number of cores on the processor, more of them only slow down the work as a whole. <br>  A nodejs is not a silver bullet and its use alone will not solve the problems of scaling and work under heavy loads. </div><p>Source: <a href="https://habr.com/ru/post/140066/">https://habr.com/ru/post/140066/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../140055/index.html">Sysadmin and the path of the sword</a></li>
<li><a href="../140058/index.html">Writing compiler LALR (1) -parser. Basic theory</a></li>
<li><a href="../140060/index.html">25 useful shortcuts for Photoshop</a></li>
<li><a href="../140062/index.html">WebRTC in Mail.Ru Agent and ICQ - pros, cons and prospects</a></li>
<li><a href="../140064/index.html">Sony rolled out Ice Cream Sandwich release for Xperia smartphones</a></li>
<li><a href="../140067/index.html">Windows paging file</a></li>
<li><a href="../140068/index.html">Nginx balancing of static files</a></li>
<li><a href="../140069/index.html">How many servers are in the Amazon EC2 cloud?</a></li>
<li><a href="../140070/index.html">Why did I leave Google?</a></li>
<li><a href="../140072/index.html">Google Summer of Code Participation</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>