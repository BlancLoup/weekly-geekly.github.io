<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>New .NET 4.0 Features: C # 4.0</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="After the release of Visual Studio 2010 beta 1 - the first thing you need to figure out what gives us new C # 4.0 (since this is my main programming l...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>New .NET 4.0 Features: C # 4.0</h1><div class="post__text post__text-html js-mediator-article">  After the release of Visual Studio 2010 beta 1 - the first thing you need to figure out what gives us new C # 4.0 (since this is my main programming language - for me it is important).  First of all I should recommend you examples of C # 4.0, which can be downloaded <a href="http://code.msdn.microsoft.com/csharpfuture/Release/ProjectReleases.aspx%3FReleaseId%3D1686">from here</a> (there is also a document New Features in C # 4.0, which served as the basis for this topic).  Documentation on the .Net Framework 4.0 beta 1 can be viewed <a href="http://msdn.microsoft.com/en-us/library/w0x726c2(VS.100).aspx">in MSDN</a> .  My little experience of acquaintance with the new version of .NET will follow on. <br><a name="habracut"></a><br>  <strong>1. Dynamic Language Runtime</strong> <br><br>  Initially, take a look at the following diagram, which illustrates the DLR architecture: <br> <a href="http://pics.livejournal.com/outcoldman/pic/0001fh6c/"><img width="320" height="150" src="https://habrastorage.org/getpro/habr/post_images/8d5/832/688/8d5832688ff5b6c45cbc150d54dc782b.png"></a> <br>  Exactly!  Now in .net you can also use scripting languages ‚Äã‚Äãsuch as <em>IronRuby</em> and <em>IronPython</em> .  I do not think that I will use it, but I give links to exotic lovers: <ul><li>  <a href="http://www.codeplex.com/IronPython">IronPython</a> .  - open-source project on <em>CodePlex</em> . </li><li>  <a href="http://rubyforge.org/projects/ironruby">IronRuby</a> .  - open-source project on <em>RubyForge</em> . </li></ul>  Moreover, the <a href="http://dlr.codeplex.com/">DLR</a> source code is provided, with which you can probably create your own dynamic language for .NET if you need it <br>  . <br>  So DLR includes <em>Expression Trees</em> , which are simply a representation of method calls or binary operations in the form of a tree, their functionality can be seen in the following example: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000">Expression&lt;Func&lt; <font color="#0000ff">int</font> , <font color="#0000ff">bool</font> &gt;&gt; exprTree = num =&gt; num &lt; 5; <br> <font color="#008000">// Decompose the expression tree.</font> <br> ParameterExpression param = (ParameterExpression)exprTree.Parameters[0]; <br> BinaryExpression operation = (BinaryExpression)exprTree.Body; <br> ParameterExpression left = (ParameterExpression)operation.Left; <br> ConstantExpression right = (ConstantExpression)operation.Right; <br> <font color="#2b91af">Console</font> .WriteLine( <font color="#a31515">"Decomposed expression: {0} =&gt; {1} {2} {3}"</font> , <br> param.Name, left.Name, operation.NodeType, right.Value);</font> <br> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  In this example, we first describe the lambda expression <em>num =&gt; num &lt;5</em> , and then use the objects from the Expression Trees to parse the expression. <br><br>  <em>Call Site caching</em> in DLR is, as I understand it, and there is a dynamic representation of calls to methods of dynamic objects or operations on dynamic objects.  DLR caches the characteristics of the objects (about the types of objects), as well as about the operation, and if this operation has already been performed before, then all the necessary information will be received from the cache (this is how it is). 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      And the last thing in DLR is a set of classes, interfaces: <em>IDynamicMetaObjectProvider, DynamicMetaObject, DynamicObject and ExpandoObject.</em>  Let's look again at an example of how it can be useful to us, and why we need this DLR at all: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000"><font color="#0000ff">class</font> Test1 <br> { <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> dynamic t = <font color="#0000ff">new</font> Test1(); <br> <font color="#0000ff">string</font> str = t.Hello(); <font color="#008000">// Error 1</font> <br> <br> dynamic d = 7.0; <br> <font color="#0000ff">int</font> i = d; <font color="#008000">// Error 2</font> <br> }</font> <br> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  Surprisingly, this code will compile and run.  It's all about the magic word <strong><em>dynamic</em></strong> , it allows us to call any properties or methods by name, and also to cast an object to any type.  During Runtime (code execution) errors will crash, Error 1: that the method was not found, Error 2: that it is impossible to result in a double to int.  Let's try to fix them: to fix the first error, our Test1 class is inherited from the System.Dynamic.DynamicObject type and overload one of the methods, to fix the second one just explicitly specify the type conversion: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000"><font color="#0000ff">class</font> Test1 : DynamicObject <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">override</font> <font color="#0000ff">bool</font> TryInvokeMember(InvokeMemberBinder binder, <font color="#0000ff">object</font> [] args, <font color="#0000ff">out</font> <font color="#0000ff">object</font> result) <br> { <br> <font color="#0000ff">if</font> (binder.Name == <font color="#a31515">"Hello"</font> ) <br> { <br> result = <font color="#a31515">"Test1 is Dynamic Object!"</font> ; <br> <font color="#0000ff">return</font> <font color="#0000ff">true</font> ; <br> } <br> <font color="#0000ff">return</font> <font color="#0000ff">base</font> .TryInvokeMember(binder, args, <font color="#0000ff">out</font> result); <br> } <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> dynamic t = <font color="#0000ff">new</font> Test1(); <br> <font color="#0000ff">string</font> str = t.Hello(); <br> <br> dynamic d = 7.0; <br> <font color="#0000ff">int</font> i = ( <font color="#0000ff">int</font> ) d; <br> }</font> <br> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  Now our code will work.  The variable <em>str</em> get the value <em>"Test1 is a dynamic object!"</em>  , and <em>i</em> value is <em>7</em> . <br><br>  Of course, you do not need to inherit from the <em>DynamicObject</em> class, you can also inherit from the <em>IDynamicMetaObjectProvider</em> interface, but then you will need to implement the <em>DynamicMetaObject GetMetaObject (Expression parameter)</em> method <em>yourself</em> , and moreover you will have to implement your own type inherited from <em>DynamicMetaObject</em> , well, in any case, there is a way to do it. to adopt. <br><br>  <strong>2. Named and optional parameters in methods</strong> <br><br>  This is a fairly simple functionality and has already been specified in many places, it is well described by the author of <a href="https://habrahabr.ru/users/syntezzz/" class="user_link">syntezzz</a> <a href="http://habrahabr.ru/blogs/net/43814/">here</a> .  If in a couple of words, it is an opportunity to set default values ‚Äã‚Äãfor method parameters, as well as the ability to set a parameter value by name when calling a method.  In general, an example would be the best explanation: <br><br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000"><font color="#0000ff">class</font> Test1 <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Method( <font color="#0000ff">int</font> a = 0, <font color="#0000ff">string</font> b = <font color="#a31515">"Hello"</font> , <font color="#0000ff">bool</font> c = <font color="#0000ff">true</font> ) <br> { <br> <font color="#2b91af">Console</font> .WriteLine( <font color="#a31515">"{0}, {1}, {2}"</font> , a, b, c); <br> } <br> } <br> <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main( <font color="#0000ff">string</font> [] args) <br> { <br> Test1 o = <font color="#0000ff">new</font> Test1(); <br> <font color="#008000">//    </font> <br> o.Method(1, <font color="#a31515">"Hello"</font> , <font color="#0000ff">true</font> ); <br> <font color="#008000">//     </font> <br> o.Method(b: <font color="#a31515">"hello"</font> , c: <font color="#0000ff">true</font> , a: 1); <br> <font color="#008000">//     </font> <br> <font color="#008000">// (      )</font> <br> o.Method(); <br> <font color="#008000">//     </font> <br> o.Method(1, <font color="#a31515">"Hello"</font> ); <br> <font color="#008000">//     </font> <br> o.Method(c: <font color="#0000ff">false</font> ); <br> }</font> <br> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  Now, because of the renaming of a parameter of a method, the code may not compile if someone has used the setting value by name, so you need to be careful.  I am happy with default values, and I will try not to use the functionality of the named parameters. <br>  In addition, I want to say that if all the same class <em>Test1 has a</em> method <em>void Method (int a)</em> , then when calling <em>o.Method (1)</em> , it is he who will be called, and not the method from the example with default values. <br><br>  <strong>3. Features for COM Interop</strong> <br><br>  DLR also gave new opportunities for COM Interop, now it is possible to define COM objects as dynamic (more precisely, they are already mostly dynamic types) and not to constantly get objects to certain types for calling methods or properties. <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000">excel.Cells[1, 1].Value = <font color="#a31515">"Hello"</font> ; <br> <font color="#008000">// </font> <br> ((Excel.Range)excel.Cells[1, 1]).Value2 = <font color="#a31515">"Hello"</font> ; <br></font> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  This example is taken from the New Futures in C # 4.0 document. On the one hand, it's nice that now you don‚Äôt have to suffer and find what type you need to bring an object to call its property or method, but on the other hand, IntelliSense is lost. <br><br>  <strong>4. New generic</strong> <br><br>  Now enriched and generic new functionality.  Now it is possible for interfaces and delegates to write <em><strong>out</strong></em> and <em><strong>in</strong></em> before defining generic types, why this is a little further, but first consider an example. <br>  When working with generic, you often want to do something like this: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000">IList&lt; <font color="#0000ff">string</font> &gt; strings = <font color="#0000ff">new</font> <font color="#2b91af">List</font> &lt; <font color="#0000ff">string</font> &gt;(); <br> IList&lt; <font color="#0000ff">object</font> &gt; objects = strings; <br></font> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  But it is impossible.  Because you can write next: <blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000">objects[0] = 5; <br> <font color="#0000ff">string</font> s = strings[0]; <br></font> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  That is, initially we had a list of strings, then we designated it as a list of objects, and we want to work with it as objects, setting any other object to it, although the list is still a list of strings. <br>  But, if you think about it, you can imagine that if the list were read-only, we would not be able to break anything, and there the logic would be clear, because the following code in C # 4.0 would work: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="#000000"><font color="#2b91af">IEnumerable</font> &lt; <font color="#0000ff">object</font> &gt; objects = strings;</font> <br> <br> <font color="#808080">* This source code was highlighted with <font color="#808080">Source Code Highlighter</font> .</font></code> </blockquote>  This functionality will bring great utility in working with linq, there are often problems that return objects of one type, and you need to get a list of another type (base). <br>  So, how is it possible.  First consider the word <em><strong>out</strong></em> .  Now the <em>IEnumerable &lt;T&gt;</em> interface is declared as <em>IEnumerable &lt;out T&gt;</em> , where <em><strong>out</strong></em> indicates that type <em>T</em> can only be used to return values, otherwise the compiler will swear, well, moreover, it gives us that <em>IEnumerable</em> interface <em>&lt;A&gt;</em> there is also an <em>IEnumerable &lt;B&gt;</em> , if <em>A</em> has the ability to cast a type to <em>B</em> , if by a simple example, then <em>IEnumerable &lt;string&gt;</em> , there is now an <em>IEnumerable &lt;object&gt;</em> .  Here is an example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> <font color="#2b91af">IEnumerable</font> &lt; <font color="#0000ff">out</font> T&gt; : <font color="#2b91af">IEnumerable</font> <br> { <br> IEnumerator&lt;T&gt; GetEnumerator(); <br> } <br> <font color="#0000ff">public</font> <font color="#0000ff">interface</font> IEnumerator&lt; <font color="#0000ff">out</font> T&gt; : IEnumerator <br> { <br> <font color="#0000ff">bool</font> MoveNext(); <br> T Current { <font color="#0000ff">get</font> ; } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  There is another word <em><strong>in</strong></em> .  It can also be used in the description of generic delegates and interfaces.  It carries the same meaning as the word <em><strong>out</strong></em> , only in this case the described type can be used only in the transfer of parameters, here is an example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">interface</font> IComparer&lt; <font color="#0000ff">in</font> T&gt; <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> Compare(T left, T right); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  That is, in this case, if <em>IComparer &lt;object&gt;</em> can be considered as <em>IComparer &lt;string&gt;</em> , because if it can compare objects of type <em>object</em> , then <em>string</em> can also. <br><br>  Just as I said, the words <em><strong>out</strong></em> and <em><strong>in</strong></em> can be applied to interfaces as well, for example: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">delegate</font> TResult Func&lt; <font color="#0000ff">in</font> TArg, <font color="#0000ff">out</font> TResult&gt;(TArg arg);</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote>  <strong>Conclusion</strong> <br><br>  Also in .NET 4.0 there are a lot of innovations, such as <em>Lazy Initialiation</em> - memory is allocated for an object when it really becomes necessary.  There are new types, such as <a href="http://msdn.microsoft.com/en-us/library/system.numerics.biginteger(VS.100).aspx"><em>BigInteger</em></a> - now, for laboratory work, students do not need to write their classes for working with large numbers;), <a href="http://msdn.microsoft.com/en-us/library/dd412070(VS.100).aspx"><em>SortedSet &lt;T&gt;</em></a> - a class is an independent balanced tree that stores data in sorted order after insertion, deletion and search.  In general, there is still something to learn. </div><p>Source: <a href="https://habr.com/ru/post/60206/">https://habr.com/ru/post/60206/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../602/index.html">Experts at bybanner.com</a></li>
<li><a href="../6020/index.html">Tomsk region intends to actively promote its concept of digital television and radio broadcasting</a></li>
<li><a href="../60201/index.html">The order on the "desktop": two thoughts</a></li>
<li><a href="../60203/index.html">Universal pump</a></li>
<li><a href="../60205/index.html">Two kitchen concepts from Electrolux</a></li>
<li><a href="../60207/index.html">Wikipedia Launches Creative Commons License</a></li>
<li><a href="../60208/index.html">NSD Powerball Review</a></li>
<li><a href="../60209/index.html">Inheritance graduate, or the last d / s in computer science</a></li>
<li><a href="../60210/index.html">World of Tanks swung to the holy. Orcs :)</a></li>
<li><a href="../60211/index.html">Windows 7 logo</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>