<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Conditional dependency injection in ASP.NET Core. Part 2</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In the first part of the article, we showed the dependency injection settings for implementing conditional dependency injection using the Environment ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Conditional dependency injection in ASP.NET Core. Part 2</h1><div class="post__text post__text-html js-mediator-article"><div style="text-align:center;"><img src="https://habrastorage.org/files/7c6/59d/e60/7c659de60a1242f8bcc64c60515e0ead.png"></div><br><br>  In the <a href="https://habrahabr.ru/post/306996/">first part of the</a> article, we showed the dependency injection settings for implementing conditional dependency injection using the Environment and Configuration mechanisms, as well as getting the service as part of an HTTP request based on the request data. <br><br>  In the second part, you will see how you can expand the capabilities of the dependency injector, using the example of selecting the necessary implementation by identifier during the execution of the application. <br><a name="habracut"></a><br><h2>  Receiving service by identifier (Resolving service by ID) </h2><br>  Many popular IoC frameworks provide roughly the following functionality that allows you to assign names to specific types that implement interfaces: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">var</span></span> container = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> UnityContainer(); <span class="hljs-comment"><span class="hljs-comment">//     Unity... container.RegisterType&lt;IService, LocalService&gt;("local"); container.RegisterType&lt;IService, CloudService&gt;("cloud"); IService service; if (context.IsLocal) { service = container.Resolve&lt;IService&gt;("local"); } else { service = container.Resolve&lt;IService&gt;("cloud"); }</span></span></code> </pre> <br>  or so: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">LocalController</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LocalController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Dependency(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"local"</span></span></span></span></span><span class="hljs-function">)] IService service)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.service = service; } } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">CloudController</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">CloudController</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[Dependency(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"cloud"</span></span></span></span></span><span class="hljs-function">)] IService service)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.service = service; } }</code> </pre><br>  This allows us to choose the implementation we need, depending on the context. <br><br>  The dependency injector built into ASP.NET Core supports multiple implementations, but unfortunately it does not have the ability to assign identifiers for a separate implementation.  Fortunately :) you can implement the service resolution yourself by identifier by writing some code. <br><br>  One way to implement this functionality was to extend the <code>ServiceDescriptor</code> class with the <code>ServiceName</code> property and use it to get a service.  But after studying the source codes, it became clear that access to the <code>ServiceProvider</code> implementation is closed (the access modifier class is internal), and we will not be able to change the logic of the <code>GetService</code> method. <br><br>  Having abandoned the idea of ‚Äã‚Äãusing reflection, as well as writing our own <code>ServiceProvider</code> , we decided to store the structure of matching the name and type of service directly in the container to use it when getting the service.  How to influence the logic of the service, described in the first part of the article. <br><br>  To begin with, we will create a structure that will contain a mapping of identifiers and corresponding implementations for each interface. <br><br>  This will be a dictionary of this kind: <br><br><pre> <code class="cs hljs">Dictionary&lt;Type, Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt;&gt;</code> </pre><br>  Here, the key of the dictionary is the type of interface, and the value is the dictionary in which (I apologize for the tautology) the key is the identifier, and the value is the type of interface implementation. <br><br>  We will add services to this structure as follows: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> Dictionary&lt;Type, Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt;&gt; serviceNameMap = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;Type, Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt;&gt;(); <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">RegisterType</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">Type service, Type implementation, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceNameMap.ContainsKey(service)) { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceNames = ServiceNameMap[service]; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serviceNames.ContainsKey(name)) { <span class="hljs-comment"><span class="hljs-comment">/* overwrite existing name implementation */</span></span> serviceNames[name] = implementation; } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { serviceNames.Add(name, implementation); } } <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceNameMap.Add(service, <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> Dictionary&lt;<span class="hljs-keyword"><span class="hljs-keyword">string</span></span>, Type&gt; { [name] = implementation }); } }</code> </pre><br>  And this is how we will get the service from the container (as you remember from the <a href="https://habrahabr.ru/post/306996/">previous article</a> , the IoC container in ASP.NET Core is represented by the <code>IServiceProvider</code> interface): <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">object</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Resolve</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceProvider serviceProvider, Type serviceType, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service = serviceType; <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (service.GetTypeInfo().IsGenericType) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ResolveGeneric(serviceProvider, serviceType, name); } <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceExists = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceNameMap.ContainsKey(service); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> nameExists = serviceExists &amp;&amp; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceNameMap[service].ContainsKey(name); <span class="hljs-comment"><span class="hljs-comment">/* Return `null` if there is no mapping for either service type or requested name */</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (!(serviceExists &amp;&amp; nameExists)) { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-literal"><span class="hljs-literal">null</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serviceProvider.GetService(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceNameMap[service][name]); }</code> </pre><br>  It now remains to write a set of extension methods for conveniently configuring the container, for example: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> IServiceCollection AddScoped&lt;TService, TImplementation&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IServiceCollection services, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TService : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">where</span></span> <span class="hljs-title"><span class="hljs-title">TImplementation</span></span> : <span class="hljs-title"><span class="hljs-title">class</span></span>, <span class="hljs-title"><span class="hljs-title">TService</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> services.Add(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TService), <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(TImplementation), ServiceLifetime.Scoped, name); }</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> IServiceCollection </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Add</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IServiceCollection services, Type serviceType, Type implementationType, ServiceLifetime lifetime, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> name</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> namedServiceProvider = services.GetOrCreateNamedServiceProvider(); namedServiceProvider.RegisterType(serviceType, implementationType, name); services.TryAddSingleton(namedServiceProvider); services.Add(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ServiceDescriptor(implementationType, implementationType, lifetime)); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> services; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> NamedServiceProvider </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetOrCreateNamedServiceProvider</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">this</span></span></span></span><span class="hljs-function"><span class="hljs-params"> IServiceCollection services</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> services.FirstOrDefault(descriptor =&gt; descriptor.ServiceType == <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(NamedServiceProvider))?.ImplementationInstance <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> NamedServiceProvider ?? <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> NamedServiceProvider(); }</code> </pre><br>  In the code above, we add an identifier to the type and name matching structure, and the type of implementation is simply put in a container.  Method of obtaining service by identifier: <br><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">static</span></span> TService GetService&lt;TService&gt;(<span class="hljs-keyword"><span class="hljs-keyword">this</span></span> IServiceProvider serviceProvider, <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> name) <span class="hljs-keyword"><span class="hljs-keyword">where</span></span> TService : <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> serviceProvider .GetService&lt;NamedServiceProvider&gt;() .Resolve&lt;TService&gt;(serviceProvider, name); }</code> </pre><br>  Everything is ready for use: <br><br><pre> <code class="cs hljs">services.AddScoped&lt;IService, LocalhostService&gt;(<span class="hljs-string"><span class="hljs-string">"local"</span></span>); services.AddScoped&lt;IService, CloudService&gt;(<span class="hljs-string"><span class="hljs-string">"cloud"</span></span>); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> service1 = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceProvider.GetService&lt;IService&gt;(<span class="hljs-string"><span class="hljs-string">"local"</span></span>); <span class="hljs-comment"><span class="hljs-comment">// resolves LocalhostService var service2 = this.serviceProvider.GetService&lt;IService&gt;("cloud"); // resolves CloudService</span></span></code> </pre><br>  You can go a little further and create an attribute that allows you to inject an action parameter, like the MVC Core attribute <code>[FromServices]</code> , with this syntax: <br><br><pre> <code class="cs hljs"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> IActionResult </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">Local</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">[FromNamedServices(</span></span><span class="hljs-string"><span class="hljs-function"><span class="hljs-params"><span class="hljs-string">"local"</span></span></span></span></span><span class="hljs-function">)] IService service)</span></span> { ... }</code> </pre><br>  In order to implement this approach, you need a little deeper understanding of the process of <a href="https://docs.asp.net/en/latest/mvc/models/model-binding.html">binding the model (Model binding) in ASP.NET Core</a> . <br><br>  In short, the parameter attribute determines which ModelBinder (the class that implements the <code>IModelBinder</code> interface) will create the parameter object.  For example, the <code>[FromServices]</code> attribute included in ASP.NET Core MVC indicates that the IoC container will be used to bind the model, therefore the <code>ServicesModelBinder</code> class will be used for this parameter, which will try to get the parameter type from the IoC container. <br><br>  In our case, we will create two additional classes.  The first is the <code>ModelBinder</code> , which will receive the service from the IoC container by identifier, and the second is its own <code>FromNamedServices</code> attribute, which will accept the service identifier in the constructor, and which will indicate that you should use the specific <code>ModelBinder</code> to bind . <br><br><pre> <code class="cs hljs">[<span class="hljs-meta"><span class="hljs-meta">AttributeUsage(AttributeTargets.Parameter)</span></span>] <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">FromNamedServicesAttribute</span></span> : <span class="hljs-title"><span class="hljs-title">ModelBinderAttribute</span></span> { <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">FromNamedServicesAttribute</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">string</span></span></span></span><span class="hljs-function"><span class="hljs-params"> serviceName</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.ServiceName = serviceName; <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.BinderType = <span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(NamedServicesModelBinder); } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">string</span></span> ServiceName { <span class="hljs-keyword"><span class="hljs-keyword">get</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">set</span></span>; } <span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">override</span></span> BindingSource BindingSource =&gt; BindingSource.Services; }</code> </pre><br><pre> <code class="cs hljs"><span class="hljs-keyword"><span class="hljs-keyword">public</span></span> <span class="hljs-keyword"><span class="hljs-keyword">class</span></span> <span class="hljs-title"><span class="hljs-title">NamedServicesModelBinder</span></span> : <span class="hljs-title"><span class="hljs-title">IModelBinder</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">private</span></span> <span class="hljs-keyword"><span class="hljs-keyword">readonly</span></span> IServiceProvider serviceProvider; <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">NamedServicesModelBinder</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">IServiceProvider serviceProvider</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceProvider = serviceProvider; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">public</span></span></span><span class="hljs-function"> Task </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">BindModelAsync</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBindingContext bindingContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (bindingContext == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">throw</span></span> <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ArgumentNullException(<span class="hljs-keyword"><span class="hljs-keyword">nameof</span></span>(bindingContext)); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> serviceName = GetServiceName(bindingContext); <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (serviceName == <span class="hljs-literal"><span class="hljs-literal">null</span></span>) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.FromResult(ModelBindingResult.Failed()); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> model = <span class="hljs-keyword"><span class="hljs-keyword">this</span></span>.serviceProvider.GetService(bindingContext.ModelType, serviceName); bindingContext.Model = model; bindingContext.ValidationState[model] = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ValidationStateEntry { SuppressValidation = <span class="hljs-literal"><span class="hljs-literal">true</span></span> }; bindingContext.Result = ModelBindingResult.Success(model); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> Task.CompletedTask; } <span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">private</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">string</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">GetServiceName</span></span></span><span class="hljs-function">(</span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">ModelBindingContext bindingContext</span></span></span><span class="hljs-function">)</span></span> { <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> parameter = (ControllerParameterDescriptor)bindingContext .ActionContext .ActionDescriptor .Parameters .FirstOrDefault(p =&gt; p.Name == bindingContext.FieldName); <span class="hljs-keyword"><span class="hljs-keyword">var</span></span> fromServicesAttribute = parameter ?.ParameterInfo .GetCustomAttributes(<span class="hljs-keyword"><span class="hljs-keyword">typeof</span></span>(FromServicesAttribute), <span class="hljs-literal"><span class="hljs-literal">false</span></span>) .FirstOrDefault() <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> FromServicesAttribute; <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> fromServicesAttribute?.ServiceName; } }</code> </pre><br>  That's all :) The source code for the examples can be downloaded here: <br><br>  <a href="https://github.com/nix-user/AspNetCoreDI">github.com/nix-user/AspNetCoreDI</a> </div><p>Source: <a href="https://habr.com/ru/post/307034/">https://habr.com/ru/post/307034/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../307022/index.html">Cheburashka and torrents (fairy tale)</a></li>
<li><a href="../307024/index.html">Deep Learning - what to do, whom to beat</a></li>
<li><a href="../307026/index.html">Work with Facebook API from UWP applications</a></li>
<li><a href="../307028/index.html">Budget "data center" at Nutanix CE</a></li>
<li><a href="../307032/index.html">Installing any software using WSUS - 2</a></li>
<li><a href="../307038/index.html">Activity tracking using the phone and MATLAB</a></li>
<li><a href="../307040/index.html">Why OOP is not encapsulation, inheritance and polymorphism, or how I learned not to worry and fell in love with markup</a></li>
<li><a href="../307042/index.html">Five practices for organizing lifelong learning in a team</a></li>
<li><a href="../307044/index.html">PYCONRU-2016: video of all reports and presentations</a></li>
<li><a href="../307046/index.html">The long-awaited check CryEngine V</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>