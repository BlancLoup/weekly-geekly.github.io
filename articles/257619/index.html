<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We write bot for browser game agar.io</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Everything is probably in the know about such a great web game like agar.io. 
 Once again, having lost a more lucky opponent in it, I silently cursed ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We write bot for browser game agar.io</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/6a3/c00/08e/6a3c0008ec034eb5b7e8ffcff3d7a79e.png"><br><br>  Everything is probably in the know about such a great web game like <a href="http://agar.io/">agar.io.</a> <br>  Once again, having lost a more lucky opponent in it, I silently cursed to myself and decided to somehow hack this toy in order to get an advantage in it at last!  As a result, I managed to create a squad of gaming bots for myself, which are trying to find me on the map in order to join my game cell. <br><a name="habracut"></a><br><h2>  We get into the game client </h2><br>  At first it was necessary to understand how everything works. <br>  The game is written in javascript and communicates with the game server via a web socket. <br><br>  The main game script is in the <a href="">main_out.js</a> file. <br>  The code there is of course obfuscated and in every way tries not to let itself be run from where it should not be: 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <pre><code class="javascript hljs"><span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-string"><span class="hljs-string">"agar.io"</span></span> != h.location.hostname &amp;&amp; <span class="hljs-string"><span class="hljs-string">"localhost"</span></span> != h.location.hostname &amp;&amp; <span class="hljs-string"><span class="hljs-string">"10.10.2.13"</span></span> != h.location.hostname) h.location = <span class="hljs-string"><span class="hljs-string">"http://agar.io/"</span></span>;</code> </pre> <br>  Expanding the file into a readable form through Chrome's debugger, the question arose: how to get into the logic of the game? <br><br>  At first, I decided to create a local copy of the files and connect to the server by turning off the cross-domain check in the browser: <br><br><pre> <code class="hljs pgsql">#  /css/bootstrap.min.css /js/jquery.js /<span class="hljs-keyword"><span class="hljs-keyword">index</span></span>.html /main_out.js /quadtree.js #   same origin <span class="hljs-keyword"><span class="hljs-keyword">policy</span></span> chrome.exe <span class="hljs-comment"><span class="hljs-comment">--disable-web-security</span></span></code> </pre><br>  This worked for AJAX requests from gaming regions, but further attempts to connect using a web socket were rejected.  A different approach was needed. <br><br><h2>  We replace url files </h2><br>  The working solution was to download a real game client, but replacing the browser with the necessary files for your own.  To do this, install the wonderful program <a href="http://www.telerik.com/fiddler">Fiddler Web Debugger</a> and specify the necessary paths in the AutoResponder tab: <br><br><img src="https://habrastorage.org/files/2e9/842/943/2e98429432d84633be826356207b57cc.png"><br><br>  This approach obviously requires keeping Fiddler running during a game session. <br><br><h2>  Trying to trick the server </h2><br>  I want to praise the authors of the game - nothing is sent to the server that could be changed in its favor (for example: its size :)).  The client sends only the coordinates of the mouse, where he would like to move his cell and reports the desired actions (for example: split). <br><br>  The server, in turn, does not send ‚Äúextra‚Äù data to the client.  For example, when I increased the scale of the game map, the server would still send only the window of objects that I should have seen within my cell: <br><br><img src="https://habrastorage.org/files/83a/2c3/0a2/83a2c30a2b574df08991c53ddaadf9a6.png"><br><br>  It would seem that all ways are closed: the server does not trust clients with any important information and calculates everything on its own. <br><br>  But then you can deceive the server within its rules: create a flock of bots that will constantly sacrifice themselves, increasing my mass.  But how can bots find my cell on the map?  Rescued the server API itself: if you constantly send for example coordinates (0, 0), then the game cell will always follow this part of the map without stopping until it reaches the goal.  Instead of zeros, you just need to send the bots my current coordinates and they will come to me for dinner! <br><br><h2>  We write bots in the current window </h2><br>  Client code simultaneously receives data and redraws objects on the screen.  It would be possible to open 20 tabs managed by bots and one of my game tabs.  But then it would be necessary to somehow transfer my coordinates to neighboring tabs.  Plus, drawing each tab would slow down the entire browser (I tried it - it does).  Therefore, it was decided to create new game sessions directly in the current tab, but turn off the link with the display for them: <br><br><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//    var isBot = true; for (i = 0; i &lt; botsCount; i++) { //     , //       setTimeout(function(){ game(window, r, isBot, botsUrl, M); }, 500); } //       function paint() { if(bot) return; //... }</span></span></code> </pre><br>  It was also necessary to add the code so that when the bot dies, it automatically starts a new session. <br><br><h2>  Work results </h2><br>  Bots are created.  And find me on the map! <br><br><img src="//habrastorage.org/files/f12/69f/465/f1269f465d8d42c1a0d83563166d433d.gif"><br><br>  However, things are not so bright. <br><br>  First, the server throws players around the game rooms.  Therefore, with me on the card of 50 bots fall 2-3.  The rest "play" in other rooms, following the coordinates from the neighboring Universe. <br><br>  Secondly, bots can be eaten by someone else!  Therefore, they manage to come to me somewhere a couple of times a minute. <br><br>  And finally, third, the bots are small.  Going to me, they do not gain a special mass.  Therefore, from a certain stage, their contribution to my victory becomes minimal. <br><br><h2>  findings </h2><br>  The authors of the game managed to create a wonderful network code that does not break from banal hacking.  However, the game is not protected from botovodstvo and a little by understanding the client's code, you can create yourself a slight technical advantage over the others. <br><br>  If, however, the issue is resolved so that the bots connect to the correct card, then there is an opportunity to seriously press down their less technically-savvy rivals. <br><br>  I reached my small goal: <br><br><img src="//habrastorage.org/files/e4f/229/5c7/e4f2295c71db41c99dcb719183165e86.png"><br>  Maybe thanks to bots, maybe I was lucky myself. <br><br>  [ <a href="https://gist.github.com/edolganov/bda5ba88512bbc6a1f2c">Client's total code</a> ] <br><br>  Thank you for your attention and good luck in the game! </div><p>Source: <a href="https://habr.com/ru/post/257619/">https://habr.com/ru/post/257619/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../257609/index.html">How to translate an entire site to permanent HTTPS for all</a></li>
<li><a href="../257611/index.html">Unknown Smalltalk</a></li>
<li><a href="../257613/index.html">Test data for HL7 messages</a></li>
<li><a href="../257615/index.html">The best reports. NEXT 2014 Moscow (video inside). Part 1: Places 6 to 10</a></li>
<li><a href="../257617/index.html">Three features of JavaScript, which is useful to know every Java / C developer</a></li>
<li><a href="../257621/index.html">Intel Edison. Work with Intel IoT Analytics cloud: register and send data</a></li>
<li><a href="../257625/index.html">Easy debugging with PHPixie Debug</a></li>
<li><a href="../257627/index.html">Restoring damaged Innodb tables</a></li>
<li><a href="../257629/index.html">A series of freelance texts written by industry professionals</a></li>
<li><a href="../257631/index.html">Introducing OsmocomBB: 0x01 Introduction</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>