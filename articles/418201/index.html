<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Can we revive the "Duck Hunt"?</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Most people rejoice when they manage to bring old things back to life. The infinite desire to relive the experience of youth leads us in ways that we ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Can we revive the "Duck Hunt"?</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/getpro/habr/post_images/ed1/ff3/c40/ed1ff3c40f21f321eadf88ad634941f0.jpg"><br><br>  Most people rejoice when they manage to bring old things back to life.  The infinite desire to relive the experience of youth leads us in ways that we have long forgotten.  And along the way, we sometimes encounter forgotten memories, evoking other forgotten memories, allowing us to relive happy moments that we have not thought about for years, or even decades.  Someone back to high school, to the <a href="https://www.kinopoisk.ru/film/amerikanskie-graffiti-1973-7332/">evening avtoprokulkami</a> with the volume of the radio turned out to its fullest, returns the roar of the engine <a href="https://en.wikipedia.org/wiki/Ford_Windsor_engine">Ford Windsor</a> .  For those born in the 80s and 90s, such memories can trigger video games.  Who can forget the first meeting with the Microsoft Office assistant clip, elegant music from Final Fantasy, or <a href="http://mentalfloss.com/article/56401/23-places-where-konami-code-lives">up-up-down-down-left-left-right-left-right-ba-select-start</a> ? <br><br>  Progress in processor technology has allowed us to re-spend time with our favorite games through emulators - programs that emulate the processors of old computers.  Games are downloaded from ROM chips to files.  These files can then be downloaded to the emulator, and play the game as if you were playing it on the original system. <br><a name="habracut"></a><br><img src="https://habrastorage.org/getpro/habr/post_images/317/cc1/f6b/317cc1f6bae300da4eba190071a1b668.jpg"><br>  <i><a href="https://en.wikipedia.org/wiki/NES_Zapper">NES Zapper</a> insides</i> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      Technology is a beautiful thing.  It allows us to move forward and do today what was impossible yesterday.  However, in some cases, this paradigm is incorrect.  One of them is the NES game console, the Nintendo Entertainment System, and its gun controller, the Zapper.  At the time, NES has become the most popular game console, and for good reason.  Nintendo‚Äôs engineers, programmers, and audio experts have managed to generate some of the best video games ever created.  Unfortunately, some of these games cannot be played on your favorite emulator on the Raspberry Pi, since the Zapper is incompatible with modern digital monitors.  Hardly anyone can forget how fun it was to play <a href="https://ru.wikipedia.org/wiki/Duck_Hunt">Duck Hunt</a> .  This game was bundled with all NES systems, so we all played it.  But the nostalgia connected with it is buried because of unresolved technological features. <br><br>  I can tell you how a hacker hacker - this can no longer be tolerated.  So first, we'll figure out how the Zapper works, and why it doesn't work with digital displays.  And then we will think about how to fix it. <br><br><h2>  Problem </h2><br>  The Zapper gun is just a photocell with a switch.  When the trigger (switch) is pressed, the NES performs certain screen manipulations in order to understand where the gun is going.  Which ones - we will discuss later.  But first we need to understand that they only work on analogue <a href="https://ru.wikipedia.org/wiki/%25D0%25AD%25D0%25BB%25D0%25B5%25D0%25BA%25D1%2582%25D1%2580%25D0%25BE%25D0%25BD%25D0%25BD%25D0%25BE-%25D0%25BB%25D1%2583%25D1%2587%25D0%25B5%25D0%25B2%25D1%258B%25D0%25B5_%25D0%25BF%25D1%2580%25D0%25B8%25D0%25B1%25D0%25BE%25D1%2580%25D1%258B">CRT</a> TVs.  If you connect your emulator to this TV, you will not have problems.  The problem is that no one else has a CRT TV.  All have digital flat-screen TVs and monitors.  When connected to such a monitor, the game will not work.  We need to understand why this is so. <br><br><h2>  Debunk Myths </h2><br>  Regarding where the NES knows where the Zapper is going, there is a lot of confusion, even among people with a little knowledge of electronics.  Some of them believe, and continue to spread this myth, that the NES reads scan lines from a CRT.  The CRT draws scan lines from top to bottom of the screen at regular intervals.  By comparing the start time of drawing and the time when Zapper sees the line, NES can find out where Zapper is pointing.  And since the modern monitor shows all the lines at the same time, it‚Äôs impossible to calculate exactly where the Zapper points.  It is possible that some older photocell pistols worked this way, but the NES does not work that way.  Totally. <br><br><h2>  How does NES Zapper work </h2><br>  The system is quite clever.  When you pull the trigger, NES draws a solid black frame on the TV.  NES draws 60 frames per second, so one frame is approximately 0.0166 on the screen, or 17 ms.  In the next frame, a white rectangle appears in place of the duck, and the prefix interrogates the state of the photocell in the gun.  The output of the photodiode is very different depending on whether it is directed to a black screen or a white rectangle.  And all this happens during the demonstration of two frames, 34 ms.  The man barely notices this.  The next frame draws the playing field again and you are hit or missed.  Brilliant! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/c3tBk-LYyzo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br><br>  ‚ÄúBut wait, how does this system work when there are two goals on the screen?‚Äù Good question.  NES engineers deal with this problem by simply repeating the whole process.  The first frame will be black, followed by a frame with a white rectangle in place of a single target and a photocell survey.  If there is another target on the screen, the third frame will be with a rectangle around the second target.  All three frames are about half a second, so you will not be able to shoot two ducks at once.  You can only shoot one, and this technique lets the NES know which one. <br><br>  ‚ÄúIf the NES simply polls the state of the photocell, can I just point the gun at a bright light and record my hit each time?‚Äù Another good question.  NES engineers got rid of this deception by interrogating the photocell state while the first black frame appeared.  If the photocell sees something that is different from the black screen, the prefix counts you a miss.  There are rumors that in the very early versions of the game this error was not corrected, but so far no one has demonstrated such a bug. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/2dd/07c/1db/2dd07c1db164ff90e5b4e428511bd7e8.jpg"><br><br><h2>  Another look at the problem </h2><br>  Now, knowing how the Zapper works, we can move on to solving problems with a digital monitor.  If the game just measures the difference between black and white, then the gun should work fine on digital monitors.  But he obviously does not work.  Some argue that the photocell is sensitive to infrared CRT, and the digital monitor does not emit infrared rays.  But look at this video: Zapper works great! <br><br><iframe width="560" height="315" src="https://www.youtube.com/embed/8D624JADDOw" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe><br>  <i>[The video shows a modified Zapper / approx.</i>  <i>transl.]</i> <br><br>  We know that the scan lines have nothing to do with it, and that the Zapper can distinguish the contrast between white and black on a digital screen.  We can conclude that our problem is related to time.  Apparently, a CRT can display an image much faster than a digital colleague.  In NES, the need to check for a white rectangle after 16 ms is hardcoded.  If your digital screen is not able to process the NES output with sufficient speed, then the console will search for a white rectangle while the game is still visible on the screen. <br><br>  The output resolution of the NES is 256 x 240 pixels.  The digital monitor needs to scale each frame to the working resolution.  This process creates a delay that can go up to 70 ms, seriously exceeding our figure of 16 ms. <br><br><h2>  How to fix it </h2><br>  It will not be easy.  If a digital monitor is inherently too slow, the only solution would be to slow down the NES. <br><br><h3>  Option 1: reduced clock frequency </h3><br>  We all heard about the overclocking of the processor through an increase in the clock frequency.  What about braking?  Can we slow down the time in the NES processor without speeding it up to a tangible fraction of the speed of light?  At the same time, it is necessary that the game was played at a normal speed, but when the trigger was pressed, it switched to slow motion and, in fact, increased the delay time.  Remember that NES displays a black screen for 16 ms, and then draws a white rectangle.  By slowing down the processor, we can increase this delay and give the digital monitor time to react. <br><br><h3>  Option 2: ROM editing </h3><br>  ROM can be edited only in a hexadecimal editor.  What if we studied the emulator and found where the delay value is set after pressing the trigger?  We could just make it bigger, and hope that nothing broke. <br><br><h3>  Option 3: your option </h3><br>  Now that you know how the NES Zapper works, and why it doesn‚Äôt work with modern digital monitors, you are already halfway to solving this problem and freeing nostalgia that our cruel technological fate has deprived us of.  What would you do to make Zapper work with a digital monitor and become a hero of the Internet? <br><br>  The scheme of work is not so difficult - for sure we can all together figure out how to make Zapper stop shooting idle in our digital world.  Share your decisions in the comments. <br><br>  <a href="https://hackaday.com/2015/11/16/resurrecting-duckhunt/"><i>Original article</i></a> </div><p>Source: <a href="https://habr.com/ru/post/418201/">https://habr.com/ru/post/418201/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../418191/index.html">Analogs in Python and JavaScript. Part three</a></li>
<li><a href="../418193/index.html">How does it feel to create a game for Game Boy in 2017</a></li>
<li><a href="../418195/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 1</a></li>
<li><a href="../418197/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 2</a></li>
<li><a href="../418199/index.html">How to make a simple technical task and not lose money and nerves</a></li>
<li><a href="../418203/index.html">GraphQL API (CRUD) on Go</a></li>
<li><a href="../418205/index.html">Cosmic language, Part 2: Welcome, GJ273b</a></li>
<li><a href="../418207/index.html">Review of gaming laptops ASUS ROG Strix GL504GS SCAR II and ASUS ROG Strix GL504GM HERO II</a></li>
<li><a href="../418209/index.html">Receive data from the counters Mercury 203.2T via RS-485</a></li>
<li><a href="../418211/index.html">MIT course "Computer Systems Security". Lecture 4: "Separation of privileges", part 3</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>