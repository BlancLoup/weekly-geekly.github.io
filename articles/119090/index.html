<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Google testing framework (gtest)</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="When I got a question about testing the code, I did not hesitate to use boost :: test. To expand the horizons I tried the Google Test Framework. In ad...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Google testing framework (gtest)</h1><div class="post__text post__text-html js-mediator-article"><img align="left" width="210" height="139" src="https://habrastorage.org/storage/1e47a3d4/0d9c5cc7/2a3df7b2/a7e2f4a7.jpg">  When I got a question about testing the code, I did not hesitate to use boost :: test.  To expand the horizons I tried the Google Test Framework.  In addition to any bonuses available in it, unlike boost :: test, the project is booming.  I would like to share the acquired knowledge.  Anyone interested is asking <br><a name="habracut"></a><br><h2>  Key Concepts </h2><br><br>  The key concept in the Google test framework is the concept of assertion.  <em>An assertion</em> is an expression that can result in success (success), non-critical failure (nonfatal failure) and critical failure (fatal failure).  Critical failure causes the completion of the test, in other cases, the test continues.  The <em>test</em> itself is a set of statements.  In addition, tests can be grouped into <em>sets</em> (test case).  If it is difficult to customize a group of objects to be used in different tests, you can use fixture.  Combined test suites are a <em>test program</em> . <br><br><h2>  Assertions </h2><br>  Statements generating in the case of their falsity critical failures begin with ASSERT_, non-critical ones - EXPECT_.  It should be borne in mind that in the event of a critical failure, an immediate return is made from the function in which the assertion that caused the failure occurred.  If this statement is followed by some kind of memory-cleansing code or some other final procedure, you can get a memory leak. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      The following statements are true (non-critical ones start not with ASSERT_, but with EXPECT_): <br><br><h4>  Simplest logical </h4><br><ul><li>  ASSERT_TRUE (condition); </li><li>  ASSERT_FALSE (condition); </li></ul><br><br><h4>  Comparison </h4><br><ul><li>  ASSERT_EQ (expected, actual);  - = </li><li>  ASSERT_NE (val1, val2);  -! = </li><li>  ASSERT_LT (val1, val2);  - &lt; </li><li>  ASSERT_LE (val1, val2);  - &lt;= </li><li>  ASSERT_GT (val1, val2);  -&gt; </li><li>  ASSERT_GE (val1, val2);  -&gt; = </li></ul><br><br><h4>  String comparison </h4><br><ul><li>  ASSERT_STREQ (expected_str, actual_str); </li><li>  ASSERT_STRNE (str1, str2); </li><li>  ASSERT_STRCASEEQ (expected_str, actual_str);  - case-insensitive </li><li>  ASSERT_STRCASENE (str1, str2);  - case-insensitive </li></ul><br><br><h4>  Check for exceptions </h4><br><ul><li>  ASSERT_THROW (statement, exception_type); </li><li>  ASSERT_ANY_THROW (statement); </li><li>  ASSERT_NO_THROW (statement); </li></ul><br><br><h4>  Predicate Verification </h4><br><ul><li>  ASSERT_PREDN (pred, val1, val2, ..., valN);  - N &lt;= 5 </li><li>  ASSERT_PRED_FORMATN (pred_format, val1, val2, ..., valN);  - works similar to the previous one, but allows you to control the output </li></ul><br><br><h4>  Floating point comparison </h4><br><ul><li>  ASSERT_FLOAT_EQ (expected, actual);  - inaccurate float comparison </li><li>  ASSERT_DOUBLE_EQ (expected, actual);  - inaccurate comparison double </li><li>  ASSERT_NEAR (val1, val2, abs_error);  - the difference between val1 and val2 does not exceed the error abs_error </li></ul><br><br><h4>  Challenge failure or success </h4><br><ul><li>  SUCCEED (); </li><li>  FAIL (); </li><li>  ADD_FAILURE (); </li><li>  ADD_FAILURE_AT (‚Äúfile_path‚Äù, line_number); </li></ul><br><br>  You can write your own function that returns AssertionResult <br><br><pre><code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:testing</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:AssertionResult</span></span> IsTrue(bool foo) { <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (foo) <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:testing</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:AssertionSuccess</span></span>(); <span class="hljs-keyword"><span class="hljs-keyword">else</span></span> <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> <span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:testing</span></span><span class="hljs-symbol"><span class="hljs-symbol">:</span></span><span class="hljs-symbol"><span class="hljs-symbol">:AssertionFailure</span></span>() &lt;&lt; foo &lt;&lt; <span class="hljs-string"><span class="hljs-string">" is not true"</span></span>; } TEST(MyFunCase, TestIsTrue) { EXPECT_TRUE(IsTrue(<span class="hljs-literal"><span class="hljs-literal">false</span></span>)); }</code> </pre> <br><br>  You can control data types using the :: testing :: StaticAssertTypeEq &lt;T1, T2&gt; () function.  The compilation will fail with an error if there is a mismatch between types T1 and T2. <br><br>  In the case of a false statement, the data used in the statement is issued.  In addition, you can set your own comment: <br><pre> <code class="hljs lisp">ASSERT_EQ(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"1 is not equal 0"</span></span><span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre><br><br>  You can use extended character sets (wchar_t) both in comments and in statements regarding strings.  In this case, the issue will be in UTF-8 encoding. <br><br><h2>  Tests </h2><br><br>  To define a test, use the TEST macro.  It defines a void function in which statements can be used.  As noted earlier, a critical failure causes an immediate return from a function. <br><pre> <code class="hljs cmake"><span class="hljs-keyword"><span class="hljs-keyword">TEST</span></span>(test_case_name, test_name) { ASSERT_EQ(<span class="hljs-number"><span class="hljs-number">1</span></span>, <span class="hljs-number"><span class="hljs-number">0</span></span>) &lt;&lt; <span class="hljs-string"><span class="hljs-string">"1 is not equal 0"</span></span>; }</code> </pre><br><br>  TEST takes 2 parameters that uniquely identify the test ‚Äî the name of the test suite and the name of the test.  Within the same test suite, the test names should not be the same.  If the name starts with DISABLED_, it means that you have marked the test (test suite) as temporarily unused. <br><br>  You can use statements not only as part of a test, but also call them from any function.  There is only one limitation - statements generating critical failures cannot be called from non-void functions. <br><br><h2>  Fixtures </h2><br><br>  It happens that the objects involved in testing are difficult to configure for each test.  You can set up the setup process once and execute it for each test automatically.  In such situations, fixings are used. <br><br>  The fixation is a class inherited from :: testing :: Test, inside which all the objects necessary for testing are declared, while in the constructor or the SetUp () function, they are set, and the TearDown () function releases resources.  The tests themselves, in which commitments are used, must be declared using the macro TEST_F, the first parameter of which is not the name of the test set, but the name of the fixation. <br><br>  For each test, a new fixation will be created, configured with SetUp (), a test started, resources released with TearDown (), and the fixation object removed.  Thus, each test will have its own copy of the fixation ‚Äúnot corrupted‚Äù by the previous test. <br><br><pre> <code class="hljs rust">#include &lt;gtest/gtest.h&gt; #include &lt;iostream&gt; class Foo { public: Foo() : i(<span class="hljs-number"><span class="hljs-number">0</span></span>) { std::cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"CONSTRUCTED"</span></span> &lt;&lt; std::endl; } ~Foo() { std::cout &lt;&lt; <span class="hljs-string"><span class="hljs-string">"DESTRUCTED"</span></span> &lt;&lt; std::endl; } int i; }; class TestFoo : public ::testing::Test { protected: void SetUp() { foo = new Foo; foo-&gt;i = <span class="hljs-number"><span class="hljs-number">5</span></span>; } void TearDown() { delete foo; } Foo *foo; }; TEST_F(TestFoo, test1) { ASSERT_EQ(foo-&gt;i, <span class="hljs-number"><span class="hljs-number">5</span></span>); foo-&gt;i = <span class="hljs-number"><span class="hljs-number">10</span></span>; } TEST_F(TestFoo, test2) { ASSERT_EQ(foo-&gt;i, <span class="hljs-number"><span class="hljs-number">5</span></span>); } int main(int argc, <span class="hljs-built_in"><span class="hljs-built_in">char</span></span> *argv[]) { ::testing::InitGoogleTest(&amp;argc, argv); <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> RUN_ALL_TESTS(); }</code> </pre><br><br>  In some cases, creating test objects is a very expensive operation, and tests do not make any changes to objects.  In this case, you can not create a new commit for each test, and use a distributed commit with global SetUp () and TearDown ().  A fixation automatically becomes distributed if there is at least one static member in the class.  The static functions SetUpTestCase () and TearDownTestCase () will be called to set up the object and free the resources, respectively.  Thus, the test suite before the first test will call SetUpTestCase (), and after the last test TearDownTestCase (). <br><br>  If there is a need for SetUp () and TearDown () for the entire test program, and not just for the test set, you need to create a descendant class for :: testing :: Environment, override SetUp () and TearDown () and register it using AddGlobalTestEnvironment. <br><br><h2>  Running tests </h2><br><br>  Having declared all the necessary tests, we can run them using the RUN_ALL_TESTS () function.  The function can only be called once.  It is desirable that the test program returns the result of the RUN_ALL_TESTS () function, since some automated testing tools determine the result of the test program execution according to what it returns. <br><br><h2>  Flags </h2><br><br>  The InitGoogleTest (argc, argv) function called before RUN_ALL_TESTS () makes your test program not just an executable file that displays test results.  This is a holistic application that accepts input parameters that change its behavior.  As usual, the -h, --help options will give you a list of all supported options.  I will list some of them (for a complete list, you can refer to the documentation). <br><ul><li>  ./test --gtest_filter = TestCaseName. * - TestCaseName.SomeTest - run all TestCaseName tests with the exception of SomeTest </li><li>  ./test --gtest_repeat = 1000 --gtest_break_on_failure - run the testing program 1000 times and stop at the first failure </li><li>  ./test --gtest_output = "xml: out.xml" - in addition to issuing to std :: out, an out.xml - XML ‚Äã‚Äãreport will be created with the results of the test program </li><li>  ./test --gtest_shuffle - run tests in random order </li></ul><br>  If you use any parameters all the time, you can set the appropriate environment variable and run the executable file without parameters.  For example, setting the GTEST_ALSO_RUN_DISABLED_TESTS variable to a non-zero value is equivalent to using the --gtest_also_run_disabled_tests flag. <br><br><h2>  Instead of conclusion </h2><br><br>  In this post, I briefly ran through the main functions of the Google Test Framework.  For more information, refer to the <a href="http://code.google.com/p/googletest/wiki/V1_6_AdvancedGuide">documentation</a> .  From there, you can learn about the ASSERT_DEATH used when the program crashes, about keeping additional logs, about parameterized tests, setting up output, testing private class members, and more. <br><br>  <strong>UPD:</strong> By fair note, <a href="https://habrahabr.ru/users/nikel/" class="user_link">nikel</a> added brief information about the use of flags. <br>  <strong>UPD 2:</strong> Correction of markup after changes on Habr√© (native tag source). </div><p>Source: <a href="https://habr.com/ru/post/119090/">https://habr.com/ru/post/119090/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../119084/index.html">Extreme programming or IT in the modern penitentiary system</a></li>
<li><a href="../119086/index.html">Music in Runet became free. Totally. Forever and ever</a></li>
<li><a href="../119087/index.html">Google asks to put unmanned vehicles on public roads</a></li>
<li><a href="../119088/index.html">There is something to learn</a></li>
<li><a href="../119089/index.html">Another swallow of modern cultural industry - ThankYou.ru</a></li>
<li><a href="../119091/index.html">Saving gasoline with the Google Prediction API</a></li>
<li><a href="../119093/index.html">Steps of experience when working with freelancers. How to choose an artist?</a></li>
<li><a href="../119094/index.html">Cross-language programming</a></li>
<li><a href="../119096/index.html">Rise and fall. Market price of $ 50 million per month</a></li>
<li><a href="../119097/index.html">Moreynis at the unit</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>