<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>MIPSfpga and in-circuit debugging</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Supplied as part of the MIPSfpga package, the documentation, software, and configuration files assume the use of Bus Bluster as a hardware debugger. T...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>MIPSfpga and in-circuit debugging</h1><div class="post__text post__text-html js-mediator-article"><p>  Supplied as part of the MIPSfpga package, the documentation, software, and configuration files assume the use of Bus Bluster as a hardware debugger.  The article contains instructions for using for this purpose virtually any USB-UART adapter built on an FTDI chip with support for MPSSE (FT232H, FT2232H, FT4232H, FT2232D).  Briefly describes the integration of the Visual Studio Code development environment and the GNU GDB debugger. </p><br><p>  All configuration files described in the article, as well as part of the documentation are available <a href="https://github.com/zhelnio/memos">on github</a> . </p><br><h3 id="elementy-sistemy">  System elements </h3><br><p><img src="https://habrastorage.org/files/b65/6b0/051/b656b005118b46b18f8e2bd2d29bfc79.png" alt="image"></p><a name="habracut"></a><br><p>  MIPSfpga is the industrial processor core of the MIPS microAptiv, the source codes of which are available under academic licenses [ <a href="https://habrahabr.ru/post/275215/">L1</a> ].  MIPSfpga-plus is a system-on-a-chip design based on the MIPSfpga [ <a href="https://github.com/MIPSfpga/mipsfpga-plus">L2</a> ] core.  In my case, the system is deployed on a Terasic DE10-Lite board with an Altera MAX10 FPGA on board [ <a href="http://de10-lite.terasic.com/">L3</a> ]. </p><br><p>  The adapter (programmer, debugger) between the MIPSfpga-plus and PC is the Pinboard II [ <a href="http://shop.easyelectronics.ru/index.php%3FcategoryID%3D102">L4</a> ] board with the FT22I [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D1_DS_FT2232D.pdf">D1</a> ] chip from FTDI [ <a href="http://www.ftdichip.com/Products/ICs.htm">L5</a> ].  Physically, the boards are interconnected by the UART and JTAG [ <a href="https://habrahabr.ru/post/190012/">L6</a> ] interfaces.  The first is used for console access to the system being debugged.  The second is the basic debugging interface using EJTAG [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">D7</a> ].  The difference between JTAG and EJTAG is very well shown in [ <a href="https://geektimes.ru/post/245066/">L7</a> ]. </p><br><p>  The key technology that greatly simplifies the construction of programmers and debuggers based on FTDI chips is the Multi-Protocol Synchronous Serial Engine (MPSSE) [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D2_AN_135_MPSSE_Basics.pdf">D2</a> , <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D3_AN_108_Command_Processor_for_MPSSE_and_MCU_Host_Bus_Emulation_Modes.pdf">D3</a> , <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D4_D2XX_Programmer%27s_Guide(FT_000071).pdf">D4</a> ].  MPSSE support is a crucial point for the configuration described in the article.  You can get similar results only on USB adapters based on the following FTDI chips: FT232H, FT2232H, FT4232H, FT2232D. </p><br><p>  On the PC side, the interaction with the USB board is carried out: for the UART channel ‚Äî using the usual FTDI drivers and any terminal program; for the MPSSE channel, the WinUSB driver is used (the work was done on a Windows-based system). </p><br><p>  For compilation, the Codescape GNU Tools [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D9_gcc.pdf">D9</a> ] is used, for debugging, the traditional bundle of OpenOCD [ <a href="http://microsin.net/programming/ARM/openocd-manual-part1.html">L8</a> , <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D8_OpenOCD_User%25E2%2580%2599s_Guide.pdf">D8</a> ] and GNU GDB [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D5_gdb.pdf">D5</a> ].  These software packages are included with the Codescape MIPS SDK [ <a href="https://community.imgtec.com/developers/mips/tools/codescape-mips-sdk/">L12</a> ].  Their interaction with each other is carried out using the gdbserver [ <a href="https://en.wikipedia.org/wiki/Gdbserver">L9</a> ] protocol. </p><br><p>  Visual Studio Code (VSCode) [ <a href="https://code.visualstudio.com/docs/editor/debugging">L10</a> ] with the vscode-cpptools extension [ <a href="https://code.visualstudio.com/docs/languages/cpp">L11</a> ] installed is used as a GUI for debugging.  Due to the fact that this extension is focused on high-level development (C / C ++), the interface lacks such views as viewing assembler instructions, viewing memory, direct access to registers. </p><br><h3 id="kratko-ob-mpsse-i-ftdi">  Briefly about MPSSE and FTDI </h3><br><p>  MPSSE is a hardware-implemented set of primitive functions that greatly simplify the implementation of serial interfaces (SPI, I2C, JTAG).  For example: send N bits on the clock edge, read M bits on the decay, set the X output to zero, etc. </p><br><p>  Until 2014, Chinese on a substantial scale riveted counterfeit FTDI chips, for this reason USB-UART converters based on them were one of the most common on sites like ebay or aliexpress.  And the developers were happy to build their solutions on them, to take at least the same support from OpenOCD.  The list of USB adapter adapters manufactured by FTDI is shown below, with support for MPSSE - marked in color. </p><br><p>  In 2014, FTDI releases updated drivers that refuse to work with counterfeit devices [ <a href="https://geektimes.ru/post/258842/">L13</a> , <a href="https://geektimes.ru/post/258848/">L14</a> ].  The number of offers for these USB-UART adapters has since declined somewhat, but they still remain one of the most common developers on hand. </p><br><p>  Even FTDI, despite the excellent chips, sometimes blamed for the quality of software for them. <del>  Maybe it's my hands crooked, but </del>  Having suffered a lot from working with libMPSSE from under .NET, I wrote my analogue of this library in C # [ <a href="https://github.com/zhelnio/MPSSELight">L15</a> ]. </p><br><p>  If any reader knows an adequate alternative for FTDI chips, an inexpensive and yet correctly supported OpenOCD, I will be grateful for the information. </p><br><p><img src="https://habrastorage.org/files/728/009/6cc/7280096ccf2443c5b76883d8e7129813.png" alt="image"></p><br><h3 id="shema-usb-modulya">  USB module diagram </h3><br><p>  Below is a fragment of the Pinboard II debug board circuit, in your case the module circuit may be different.  The main determining parameter for us is the ability to directly access the ports of the chip: one free MPSSE channel (for TCK, TDI, TDO, TMS) + 1 GPIO output for the reset signal (SRSTn) is enough for operation.  For the second channel of the chip, the MPSSE functionality is not mandatory, and it is convenient to use it for UART interaction with the system being debugged. </p><br><p>  The outputs of the FTDI chip are directly connected to the FPGA ports.  Strictly speaking, this is a violation of [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">D7</a> , <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D6_MIPS32_microAptiv_UP_Processor_Core_Family_Integrator%25E2%2580%2599s_Guide.txt">D6</a> ], since  it is assumed that there should be installed pull-up, pull-down or series-connected resistors.  Everything works without them for me: carefully check the setting of the ports for input-output, check the maximum current limit on the FPGA ports involved for EJTAG. </p><br><p>  The voltage at the terminals of the adapter is set to 3.3V.  In the case of Pinboard II, a separate jumper (VCCIO_PWR_SEL) is provided for selecting this voltage.  For other boards, be guided by their schemes and FPGA settings, in some cases it may be necessary to refine the adapter (which is simpler) and / or the level conversion circuit [ <a href="http://we.easyelectronics.ru/Shematech/soglasovanie-logicheskih-urovney-5v-i-33v-ustroystv.html">L16</a> ] (which is more difficult and can lead to interference or reduced speed). <br><img src="https://habrastorage.org/files/f12/ec6/f29/f12ec6f295a649d9b231b3d1135bb721.png" alt="image"></p><br><h3 id="tipovoe-podklyuchenie-ejtag">  Typical EJTAG connection </h3><br><p>  A typical wiring diagram for the EJTAG interface is obtained from [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D6_MIPS32_microAptiv_UP_Processor_Core_Family_Integrator%25E2%2580%2599s_Guide.txt">D6</a> ].  The optional DINT and TRSTn inputs are not used in this configuration.  Compliance of the rest is given in the table. <br><img src="https://habrastorage.org/files/b16/507/5ea/b165075ea3ea45fab7cda46721aa37c4.png" alt="image"></p><br><p>  Table of connecting the USB module to the FPGA </p><br><p><img src="https://habrastorage.org/files/eda/d34/6f9/edad346f97d147b6898d53d2ff7c14ae.png" alt="image"></p><br><h3 id="konfiguracionnye-fayly-na-githubhttpsgithubcomzhelniomemostreemasterpublic00_mips_ftdi_debugsrc">  Configuration files ( <a href="https://github.com/zhelnio/memos/tree/master/public/00_mips_ftdi_debug/src">on github</a> ) </h3><br><div class="spoiler">  <b class="spoiler_title">mipsfpga_ftdi.cfg</b> <div class="spoiler_text"><pre><code class="hljs pgsql"># # OpenOCD config <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> FT2232D that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected # <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> FPGA <span class="hljs-keyword"><span class="hljs-keyword">as</span></span> MIPSfpga EJTAG debugger # <span class="hljs-keyword"><span class="hljs-keyword">Any</span></span> FTDI USB IC <span class="hljs-keyword"><span class="hljs-keyword">with</span></span> MPSSE support (required) can be used # # <span class="hljs-number"><span class="hljs-number">2017</span></span>, Stanislav Zhelnio # # ########################################################## # interface part # ########################################################## # interface, transport <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> channel setup # (use zadig <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> install WinUSB driver <span class="hljs-keyword"><span class="hljs-keyword">instead</span></span> <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> FTDI one) interface ftdi transport <span class="hljs-keyword"><span class="hljs-keyword">select</span></span> jtag ftdi_channel <span class="hljs-number"><span class="hljs-number">0</span></span> ftdi_vid_pid <span class="hljs-number"><span class="hljs-number">0x0403</span></span> <span class="hljs-number"><span class="hljs-number">0x6010</span></span> # ftdi MPSSE initial <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> direction # <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> detailed description <span class="hljs-keyword"><span class="hljs-keyword">of</span></span> Magic Numbers look at # <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">table</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> FTDI AppNote AN_108: # chapter <span class="hljs-number"><span class="hljs-number">2.1</span></span> Data <span class="hljs-type"><span class="hljs-type">bit</span></span> Definition ftdi_layout_init <span class="hljs-number"><span class="hljs-number">0x0018</span></span> <span class="hljs-number"><span class="hljs-number">0x081b</span></span> # special signals # described <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> OpenOCD <span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'s Guide: # chapter 8.2 Interface Drivers (ftdi) # chapter 9 Reset Configuration # nTRST is not used ftdi_layout_signal nSRST -data 0x0010 -oe 0x0020 ftdi_layout_signal LED -ndata 0x0800 -oe 0x0800 # speed setup # decrease when errors adapter_khz 10000 # ########################################################## # target part # ########################################################## # reset delays # described in OpenOCD User'</span></span>s Guide: # chapter <span class="hljs-number"><span class="hljs-number">9</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Reset</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Configuration</span></span> adapter_nsrst_delay <span class="hljs-number"><span class="hljs-number">100</span></span> jtag_ntrst_delay <span class="hljs-number"><span class="hljs-number">100</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> sygnal config # nSRST <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> directly connected <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> MIPSfpga (~SI_ColdReset) wire reset_config srst_only separate srst_nogate srst_push_pull # <span class="hljs-keyword"><span class="hljs-keyword">To</span></span> <span class="hljs-keyword"><span class="hljs-keyword">check</span></span> <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> scan EJTAG chain uncomment this # <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> <span class="hljs-keyword"><span class="hljs-keyword">comment</span></span> <span class="hljs-keyword"><span class="hljs-keyword">all</span></span> that <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> bellow <span class="hljs-keyword"><span class="hljs-keyword">then</span></span> <span class="hljs-string"><span class="hljs-string">'shutdown'</span></span> command. # Use IDCODE <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> detect <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> errors: # IDCODE that was <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> RTL config should be identical # <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> -expected-id result <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> <span class="hljs-string"><span class="hljs-string">'shutdown'</span></span> output. # The IDCODE structure <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> described <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> EJTAG Specification: # chapter <span class="hljs-number"><span class="hljs-number">6.5</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span> Device Identification (ID) Register #shutdown # tap connector <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> target creation # change -expected-id <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> your IDCODE <span class="hljs-keyword"><span class="hljs-keyword">value</span></span> # <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> other arguments see at OpenOCD <span class="hljs-keyword"><span class="hljs-keyword">User</span></span><span class="hljs-string"><span class="hljs-string">'s Guide jtag newtap auto0 tap -expected-id 0x000f1005 -irlen 5 -ircapture 0x1 -irmask 0x1f target create auto0.tap mips_mAptiv -endian little -chain-position auto0.tap # tap configuration # change params acording to compile and memory settings # for details see at OpenOCD User'</span></span>s Guide auto0.tap configure -<span class="hljs-keyword"><span class="hljs-keyword">work</span></span>-area-phys <span class="hljs-number"><span class="hljs-number">0xa0003ff00</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">work</span></span>-area-size <span class="hljs-number"><span class="hljs-number">256</span></span> -<span class="hljs-keyword"><span class="hljs-keyword">work</span></span>-area-backup <span class="hljs-number"><span class="hljs-number">0</span></span> # EJTAG scan perion mips32 scan_delay <span class="hljs-number"><span class="hljs-number">20000</span></span> # run the debugger process <span class="hljs-keyword"><span class="hljs-keyword">and</span></span> wait <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> gdb <span class="hljs-keyword"><span class="hljs-keyword">connection</span></span> init</code> </pre> </div></div><br><ul><li>  the main and only configuration file for OpenOCD; </li><li>  conditionally, it can be divided into 2 parts: one describes the connection of the programmer and the target system (interface part), the second - the settings specific to the kernel being debugged (target part).  Inside the OpenOCD catalog, they are usually placed in different folders, here - for simplicity, they are combined into one. </li></ul><br><div class="spoiler">  <b class="spoiler_title">c_cpp_properties.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"configurations"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Mac"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"includePath"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"/usr/include"</span></span>, <span class="hljs-string"><span class="hljs-string">"/usr/local/include"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"browse"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"limitSymbolsToIncludedHeaders"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"databaseFilename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Linux"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"includePath"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"/usr/include"</span></span>, <span class="hljs-string"><span class="hljs-string">"/usr/local/include"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"browse"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"limitSymbolsToIncludedHeaders"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"databaseFilename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"Win32"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"includePath"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"C:/Program Files (x86)/Microsoft Visual Studio 14.0/VC/include/*"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"browse"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"limitSymbolsToIncludedHeaders"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"databaseFilename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"mips-mti-elf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"includePath"</span></span>: [ <span class="hljs-string"><span class="hljs-string">"D:/Codescape/Toolchains/mips-mti-elf/2016.05-03/lib/gcc/mips-mti-elf/4.9.2/include/*"</span></span> ], <span class="hljs-attr"><span class="hljs-attr">"browse"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"limitSymbolsToIncludedHeaders"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"databaseFilename"</span></span>: <span class="hljs-string"><span class="hljs-string">""</span></span> } } ] }</code> </pre> </div></div><br><ul><li>  vscode-cpptools extension configuration file; </li><li>  contains information about the location of the header files, which is necessary to simplify navigation through the sources and the work of the completion function in the VSCode editor window. </li></ul><br><div class="spoiler">  <b class="spoiler_title">launch.json</b> <div class="spoiler_text"><pre> <code class="hljs json">{ <span class="hljs-attr"><span class="hljs-attr">"version"</span></span>: <span class="hljs-string"><span class="hljs-string">"0.2.0"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"configurations"</span></span>: [ { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIPS Load"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"cppdbg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"launch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"program"</span></span>: <span class="hljs-string"><span class="hljs-string">"${fileDirname}/program.elf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cwd"</span></span>: <span class="hljs-string"><span class="hljs-string">"${fileDirname}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"miDebuggerPath"</span></span>: <span class="hljs-string"><span class="hljs-string">"d:/CODESC~1/TOOLCH~1/mips-mti-elf/2016.05-03/bin/mips-mti-elf-gdb.exe"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"setupCommands"</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"file 'D:/mipsfpga-plus/programs/00_counter/program.elf'"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"target remote localhost:3333"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"set endian little"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"monitor reset halt"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"load"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"br main"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"monitor continue"</span></span>} ], <span class="hljs-attr"><span class="hljs-attr">"customLaunchSetupCommands"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"launchCompleteCommand"</span></span>: <span class="hljs-string"><span class="hljs-string">"None"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"targetArchitecture"</span></span>: <span class="hljs-string"><span class="hljs-string">"mips"</span></span> //Uncomment this to debug //,<span class="hljs-attr"><span class="hljs-attr">"logging"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"engineLogging"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } //or this for verbose debug //,<span class="hljs-attr"><span class="hljs-attr">"logging"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"engineLogging"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"trace"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"traceResponse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } }, { <span class="hljs-attr"><span class="hljs-attr">"name"</span></span>: <span class="hljs-string"><span class="hljs-string">"MIPS Attach"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"type"</span></span>: <span class="hljs-string"><span class="hljs-string">"cppdbg"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"request"</span></span>: <span class="hljs-string"><span class="hljs-string">"launch"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"program"</span></span>: <span class="hljs-string"><span class="hljs-string">"${fileDirname}/program.elf"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"cwd"</span></span>: <span class="hljs-string"><span class="hljs-string">"${fileDirname}"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"miDebuggerPath"</span></span>: <span class="hljs-string"><span class="hljs-string">"d:/CODESC~1/TOOLCH~1/mips-mti-elf/2015.06-05/bin/mips-mti-elf-gdb.exe"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"setupCommands"</span></span>: [ {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"file 'D:/mipsfpga-plus/programs/00_counter/program.elf'"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"target remote localhost:3333"</span></span>}, {<span class="hljs-attr"><span class="hljs-attr">"text"</span></span>: <span class="hljs-string"><span class="hljs-string">"set endian little"</span></span>} ], <span class="hljs-attr"><span class="hljs-attr">"customLaunchSetupCommands"</span></span>: [], <span class="hljs-attr"><span class="hljs-attr">"launchCompleteCommand"</span></span>: <span class="hljs-string"><span class="hljs-string">"None"</span></span>, <span class="hljs-attr"><span class="hljs-attr">"targetArchitecture"</span></span>: <span class="hljs-string"><span class="hljs-string">"mips"</span></span> //Uncomment this to debug //,<span class="hljs-attr"><span class="hljs-attr">"logging"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"engineLogging"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } //or this for verbose debug //,<span class="hljs-attr"><span class="hljs-attr">"logging"</span></span>: { <span class="hljs-attr"><span class="hljs-attr">"engineLogging"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"trace"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span>, <span class="hljs-attr"><span class="hljs-attr">"traceResponse"</span></span>: <span class="hljs-literal"><span class="hljs-literal">true</span></span> } } ] }</code> </pre> </div></div><br><ul><li>  VSCode configuration file containing the settings for running the program being debugged; </li><li>  in this case, describes two launch profiles: "MIPS Load" - load the firmware into the system's memory, then proceed to debugging;  "MIPS Attach" - connect to the already-stitched system. </li></ul><br><h3 id="pervichnaya-nastroyka">  Primary setup </h3><br><ul><li>  connect the USB module to the PC; </li><li>  wait until the FTDI drivers are installed using the Zadig program, perform a driver change on the channel from MPSSE to WinUSB; </li><li>  copy the <strong>mipsfpga_ftdi.cfg</strong> configuration file to the directory with OpenOCD; </li><li>  In case your connection scheme differs for some reason from the one shown in the table, you need to recalculate the initialization parameters of OpenOCD, in particular, the arguments of the <strong>ftdi_layout_init</strong> and <strong>ftdi_layout_signal commands</strong> . </li><li><p>  Consider the order in which they are received for the above connection table: <br>  <strong>0x0018</strong> - set 1 as the initial value on the ports ADBUS3 and ADBUS4 (bits 3 and 4, respectively); <br>  <strong>0x081b</strong> - configure ports ADBUS0,1,3,4, ACBUS3 on the output (bits 0-3,4, 11). </p><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">ftdi_layout_init</span></span> 0x0018 0x081b</code> </pre> <br></li><li>  for the <strong>ftdi_layout_signal</strong> command <strong>, the</strong> logic is the same, the matching arguments of the <strong>-data</strong> and <strong>-oe</strong> (output enable) parameters mean that the connection is made directly, without any buffer.  Using <strong>-ndata</strong> allows you to invert the output. </li><li>  pin assignment to specific bits is given in section 2.1 of the applet [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D3_AN_108_Command_Processor_for_MPSSE_and_MCU_Host_Bus_Emulation_Modes.pdf">D3</a> ]. </li></ul><br><h3 id="nastroyki-na-storone-mipsfpga">  Settings on the MIPSFpga side </h3><br><ul><li>  When the EJTAG connection is initialized, the device being debugged sends the IDCODE register value to the PC, which is specified by the developer in the RTL code.  I recommend to set any arbitrary (nonzero) values ‚Äã‚Äãin this register, since  this will help in determining connection errors: if the IDCODE received during connection does not match the one specified in the code, then an error has crept in somewhere. </li><li>  The format of this register [ <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">D7</a> ] is as follows: <br><img src="https://habrastorage.org/files/fb3/729/7c1/fb37297c19db4dafb37fee48e277d4bd.png" alt="image"></li><li>  The EJ_ManufID and EJ_PartNumber parameters are set in the mfp_system.v file; </li><li>  check and set the values ‚Äã‚Äãof EJ_DINT and EJ_TRST_N.  In the configuration in question, they are not used for connection: </li></ul><br><pre> <code class="hljs scala">assign <span class="hljs-type"><span class="hljs-type">EJ_DINT</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b0</span></span>; assign <span class="hljs-type"><span class="hljs-type">EJ_TRST_N</span></span> = <span class="hljs-number"><span class="hljs-number">1</span></span><span class="hljs-symbol"><span class="hljs-symbol">'b1</span></span>;</code> </pre> <br><h3 id="nastroyki-kompilyacii">  Compilation settings </h3><br><ul><li>  make sure that the compiler settings in terms of memory usage do not contradict the parameters of the <strong>configure</strong> command in the <strong>mipsfpga_ftdi.cfg</strong> file; </li><li>  add debug symbols - <strong>-g -gdwarf-2</strong> parameters </li><li>  set the optimization level to <strong>-O0</strong> or <strong>-O1</strong> .  With <strong>-O2</strong> debugging will also work, but the execution of the code may not be consistent: the pointer of the current executed line of code will "jump". </li></ul><br><h3 id="test-podklyucheniya">  Connection test </h3><br><ul><li>  open the file <strong>mipsfpga_ftdi.cfg</strong> and comment out all the commands that go after setting the reset signal (after <strong>reset_config</strong> ).  Uncomment the <strong>shutdown command</strong> .  In this configuration, OpenOCD will connect to the device being debugged, receive IDCODE and disconnect; </li><li>  execute the <strong>openocd-0.9.2.exe</strong> command in the console <strong>-f mipsfpga_ftdi.cfg</strong> </li><li><p>  the result of its correct execution is the following output, where <strong>0x000f1005</strong> is the previously defined IDCODE </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">On</span></span>-Chip Debugger <span class="hljs-number"><span class="hljs-number">0.9</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>-dev-microAptiv-dirty (<span class="hljs-number"><span class="hljs-number">2015</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>) Licensed under GNU GPL v2 <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> bug reports, <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> http://openocd.sourceforge.net/doc/doxygen/bugs.html adapter speed: <span class="hljs-number"><span class="hljs-number">10000</span></span> kHz adapter_nsrst_delay: <span class="hljs-number"><span class="hljs-number">100</span></span> jtag_ntrst_delay: <span class="hljs-number"><span class="hljs-number">100</span></span> srst_only separate srst_nogate srst_push_pull connect_deassert_srst shutdown command invoked <span class="hljs-keyword"><span class="hljs-keyword">Info</span></span> : clock speed <span class="hljs-number"><span class="hljs-number">10000</span></span> kHz Warn : There are <span class="hljs-keyword"><span class="hljs-keyword">no</span></span> enabled taps. AUTO PROBING MIGHT <span class="hljs-keyword"><span class="hljs-keyword">NOT</span></span> <span class="hljs-keyword"><span class="hljs-keyword">WORK</span></span>!! Warn : AUTO auto0.tap - use "jtag newtap auto0 tap -expected-id 0x000f1005 ..." Warn : AUTO auto0.tap - use "... -irlen 5" Warn : gdb services need one <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> more targets defined</code> </pre> <br></li><li>  check that exactly the value that was previously specified in the RTL code ( <strong>mfp_system.v</strong> ) was <strong>received</strong> ; </li><li>  in case the values ‚Äã‚Äãdiverge, it is necessary to find and fix the connection error.  It is possible that you should slow down.  In my case, for example, the probes of the connected logic analyzer made noise; </li><li>  after the correct IDCODE value is successfully received, the file can be returned to the initial state. </li></ul><br><h3 id="otladka-v-konsolnom-rezhime">  Debug in console mode </h3><br><ul><li>  run <strong>openocd-0.9.2.exe -f mipsfpga_ftdi.cfg</strong> .  Sometimes, with a sudden loss of communication, OpenOCD may hang, so I prefer to run it in a separate terminal window. </li><li><p>  The following output is correct, after which OpenOCD does not interrupt the operation and waits for a connection from gdb: </p><br><pre> <code class="hljs pgsql"><span class="hljs-keyword"><span class="hljs-keyword">Open</span></span> <span class="hljs-keyword"><span class="hljs-keyword">On</span></span>-Chip Debugger <span class="hljs-number"><span class="hljs-number">0.9</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span>-dev-microAptiv-dirty (<span class="hljs-number"><span class="hljs-number">2015</span></span><span class="hljs-number"><span class="hljs-number">-05</span></span><span class="hljs-number"><span class="hljs-number">-08</span></span><span class="hljs-number"><span class="hljs-number">-15</span></span>:<span class="hljs-number"><span class="hljs-number">32</span></span>) Licensed under GNU GPL v2 <span class="hljs-keyword"><span class="hljs-keyword">For</span></span> bug reports, <span class="hljs-keyword"><span class="hljs-keyword">read</span></span> http://openocd.sourceforge.net/doc/doxygen/bugs.html adapter speed: <span class="hljs-number"><span class="hljs-number">10000</span></span> kHz adapter_nsrst_delay: <span class="hljs-number"><span class="hljs-number">100</span></span> jtag_ntrst_delay: <span class="hljs-number"><span class="hljs-number">100</span></span> srst_only separate srst_nogate srst_push_pull connect_deassert_srst scan delay: <span class="hljs-number"><span class="hljs-number">20000</span></span> nsec running <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> fast queued mode <span class="hljs-keyword"><span class="hljs-keyword">Info</span></span> : clock speed <span class="hljs-number"><span class="hljs-number">10000</span></span> kHz <span class="hljs-keyword"><span class="hljs-keyword">Info</span></span> : JTAG tap: auto0.tap tap/device <span class="hljs-built_in"><span class="hljs-built_in">found</span></span>: <span class="hljs-number"><span class="hljs-number">0x000f1005</span></span> (mfg: <span class="hljs-number"><span class="hljs-number">0x002</span></span>, part: <span class="hljs-number"><span class="hljs-number">0x00f1</span></span>, ver: <span class="hljs-number"><span class="hljs-number">0x0</span></span>)</code> </pre> <br></li><li><p>  in a separate terminal window, run gdb: <strong>mips-mti-elf-gdb -q program.elf</strong> and perform several debugging operations </p><br><pre> <code class="hljs css">&gt; <span class="hljs-selector-tag"><span class="hljs-selector-tag">mips-mti-elf-gdb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-q</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">program</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.elf</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">Reading</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">symbols</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">from</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">program</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.elf</span></span>..<span class="hljs-selector-class"><span class="hljs-selector-class">.done</span></span>.</code> </pre> <br></li><li><p>  connection to the system being debugged </p><br><pre> <code class="hljs cs">(gdb) target remote localhost:<span class="hljs-number"><span class="hljs-number">3333</span></span> Remote debugging <span class="hljs-keyword"><span class="hljs-keyword">using</span></span> localhost:<span class="hljs-number"><span class="hljs-number">3333</span></span> <span class="hljs-number"><span class="hljs-number">0xbfc00000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> ?? ()</code> </pre> <br></li><li><p>  setting the target byte order </p><br><pre> <code class="hljs sql">(gdb) <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endian</span></span> <span class="hljs-keyword"><span class="hljs-keyword">little</span></span> The target <span class="hljs-keyword"><span class="hljs-keyword">is</span></span> assumed <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> be <span class="hljs-keyword"><span class="hljs-keyword">little</span></span> <span class="hljs-keyword"><span class="hljs-keyword">endian</span></span></code> </pre> <br></li><li><p>  system shutdown </p><br><pre> <code class="hljs pgsql">(gdb) monitor <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> halt JTAG tap: auto0.tap tap/device <span class="hljs-built_in"><span class="hljs-built_in">found</span></span>: <span class="hljs-number"><span class="hljs-number">0x000f1005</span></span> (mfg: <span class="hljs-number"><span class="hljs-number">0x002</span></span>, part: <span class="hljs-number"><span class="hljs-number">0x00f1</span></span>, ver: <span class="hljs-number"><span class="hljs-number">0x0</span></span>) target state: <span class="hljs-keyword"><span class="hljs-keyword">reset</span></span> entered <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span> state at PC <span class="hljs-number"><span class="hljs-number">0xbfc00000</span></span>, target-&gt;state: halted target state: halted target halted <span class="hljs-keyword"><span class="hljs-keyword">in</span></span> MIPS32 mode due <span class="hljs-keyword"><span class="hljs-keyword">to</span></span> <span class="hljs-keyword"><span class="hljs-keyword">debug</span></span>-request, pc: <span class="hljs-number"><span class="hljs-number">0xbfc00000</span></span></code> </pre> <br></li><li><p>  firmware download </p><br><pre> <code class="hljs sql">(gdb) <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .text_ram, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x260</span></span> lma <span class="hljs-number"><span class="hljs-number">0x80001000</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .init, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x24</span></span> lma <span class="hljs-number"><span class="hljs-number">0x80001260</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .fini, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x1c</span></span> lma <span class="hljs-number"><span class="hljs-number">0x80001284</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .eh_frame, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x4</span></span> lma <span class="hljs-number"><span class="hljs-number">0x800012a0</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .data, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0xc</span></span> lma <span class="hljs-number"><span class="hljs-number">0x800012a4</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .ctors, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x8</span></span> lma <span class="hljs-number"><span class="hljs-number">0x800012b0</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .dtors, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x8</span></span> lma <span class="hljs-number"><span class="hljs-number">0x800012b8</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .jcr, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x4</span></span> lma <span class="hljs-number"><span class="hljs-number">0x800012c0</span></span> Loading <span class="hljs-keyword"><span class="hljs-keyword">section</span></span> .reset, <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">0x280</span></span> lma <span class="hljs-number"><span class="hljs-number">0x9fc00000</span></span> <span class="hljs-keyword"><span class="hljs-keyword">Start</span></span> address <span class="hljs-number"><span class="hljs-number">0xbfc00000</span></span>, <span class="hljs-keyword"><span class="hljs-keyword">load</span></span> <span class="hljs-keyword"><span class="hljs-keyword">size</span></span> <span class="hljs-number"><span class="hljs-number">1348</span></span> Transfer rate: <span class="hljs-number"><span class="hljs-number">12</span></span> KB/sec, <span class="hljs-number"><span class="hljs-number">149</span></span> <span class="hljs-keyword"><span class="hljs-keyword">bytes</span></span>/write.</code> </pre> <br></li><li><p>  setting a breakpoint to enter the main function </p><br><pre> <code class="hljs vhdl">(gdb) b main Breakpoint <span class="hljs-number"><span class="hljs-number">1</span></span> at <span class="hljs-number"><span class="hljs-number">0</span></span>x800011e0: <span class="hljs-keyword"><span class="hljs-keyword">file</span></span> main.c, <span class="hljs-literal"><span class="hljs-literal">line</span></span> <span class="hljs-number"><span class="hljs-number">14</span></span>.</code> </pre> <br></li><li><p>  code execution </p><br><pre> <code class="hljs perl">(gdb) c Continuing. entered debug <span class="hljs-keyword"><span class="hljs-keyword">state</span></span> at PC <span class="hljs-number"><span class="hljs-number">0x800011e0</span></span>, target-&gt;<span class="hljs-keyword"><span class="hljs-keyword">state</span></span>: halted [Remote target] <span class="hljs-comment"><span class="hljs-comment">#1 stopped. main () at main.c:14 warning: Source file is more recent than executable. 14 {</span></span></code> </pre> <br></li><li>  getting register values ‚Äã‚Äãafter shutdown <br><pre> <code class="hljs lisp">(<span class="hljs-name"><span class="hljs-name">gdb</span></span>) ir zero at v0 v1 a0 a1 a2 a3 R0 <span class="hljs-number"><span class="hljs-number">00000000</span></span> deadbeef <span class="hljs-number"><span class="hljs-number">800011e0</span></span> <span class="hljs-number"><span class="hljs-number">00000010</span></span> <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">00000002</span></span> <span class="hljs-number"><span class="hljs-number">80001000</span></span> <span class="hljs-number"><span class="hljs-number">00000000</span></span> t0 t1 t2 t3 t4 t5 t6 t7 R8 deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef s0 s1 s2 s3 s4 s5 s6 s7 R16 deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef deadbeef t8 t9 k0 k1 gp sp s8 ra R24 deadbeef deadbeef deadbeef deadbeef <span class="hljs-number"><span class="hljs-number">800092</span></span>a8 <span class="hljs-number"><span class="hljs-number">80040000</span></span> <span class="hljs-number"><span class="hljs-number">00000000</span></span> <span class="hljs-number"><span class="hljs-number">9</span></span>fc00274 status lo hi badvaddr cause pc <span class="hljs-number"><span class="hljs-number">00400000</span></span> <span class="hljs-number"><span class="hljs-number">00000100</span></span> <span class="hljs-number"><span class="hljs-number">00000000</span></span> c0000000 <span class="hljs-number"><span class="hljs-number">00000008</span></span> <span class="hljs-number"><span class="hljs-number">800011e0</span></span> (<span class="hljs-name"><span class="hljs-name">gdb</span></span>)</code> </pre> </li></ul><br><h3 id="nastroyka-vscode">  VSCode Setup </h3><br><ul><li>  download and install Visual Studio Code [ <a href="https://code.visualstudio.com/">L17</a> ]; </li><li>  run, go to the extensions section, install the extension vscode-cpptools [ <a href="https://code.visualstudio.com/docs/languages/cpp">L11</a> ]; </li><li>  open in VSCode a directory (so-called workspace directory), which contains the source code of the program being debugged; </li><li>  At the root of the workspace directory, create a .vscode folder, download and place the <strong>c_cpp_properties.json</strong> and <strong>launch.json</strong> files into it; </li><li>  open these files and adjust the paths to the header files, gdb, as well as to the elf file that is supposed to be uploaded to the system being debugged; </li><li>  I ran into a small bug, because of which I had to explicitly specify the full path to the elf file. </li></ul><br><h3 id="otladka-v-vscode">  Debugging in vscode </h3><br><ul><li>  it is assumed that the compilation has already been done and the elf file is located where it is set by <strong>launch.json</strong> ; </li><li>  run <strong>openocd-0.9.2.exe -f mipsfpga_ftdi.cfg in the</strong> same way as described above; </li><li>  in the VSCode interface, go to the "Debug" panel, select the debug profile <strong>MIPS Load</strong> ; </li><li>  run debugging; </li><li>  if everything is configured correctly, then the VSCode window will look approximately the same as shown in the screenshot below; </li><li>  Although the VSCode interface lacks specialized views for viewing assembler instructions, memory and registers, this information can be obtained from the debugging console by directly accessing gdb.  To do this, use the <strong>-exec</strong> command.  For example: <strong>-exec ir</strong> </li><li>  if something went wrong, you should uncomment the "logging" section in the <strong>launch.json</strong> file and perform error analysis in the debugging console (opens with a keyboard shortcut ( <strong>ctrl + `</strong> ); </li></ul><br><p><img src="https://habrastorage.org/files/cb5/6e7/3e7/cb56e73e7edc451e981ffe04815db81d.png" alt="image"></p><br><h3 id="blagodarnosti">  Thanks </h3><br><p>  The author is grateful to the team of translators from David Harris and Sarah Harris, <a href="https://habrahabr.ru/post/259505/">Digital Circuit Design and Computer Architecture</a> , by <a href="https://www.imgtec.com/">Imagination Technologies</a> for the academic license for a modern processor core, personally Yuri Panchul <a href="https://habrahabr.ru/users/yuripanchul/" class="user_link">YuriPanchul</a> for his work on promoting MIPSfpga, and <a href="https://habrahabr.ru/users/dihalt/" class="user_link">DIHALT</a> for a debugging fee, which is which year does not leave the surface of my table. </p><br><h3 id="ssylki">  Links </h3><br><p>  [L1] - <a href="https://habrahabr.ru/post/275215/">How to start working with MIPSfpga</a> ; <br>  [L2] - <a href="https://github.com/MIPSfpga/mipsfpga-plus">MIPSfpga-plus project on github</a> ; <br>  [L3] - <a href="http://de10-lite.terasic.com/">Terasic DE10-Lite FPGA board</a> ; <br>  [L4] - <a href="http://shop.easyelectronics.ru/index.php%3FcategoryID%3D102">Pinboard II debug board</a> ; <br>  [L5] - <a href="http://www.ftdichip.com/Products/ICs.htm">FTDI website</a> ; <br>  [L6] - <a href="https://habrahabr.ru/post/190012/">JTAG interface?</a>  <a href="https://habrahabr.ru/post/190012/">- It's very easy!</a> <br>  [L7] - <a href="https://geektimes.ru/post/245066/">EJTAG: an attraction for hackers</a> ; <br>  [L8] - <a href="http://microsin.net/programming/ARM/openocd-manual-part1.html">OpenOCD: user manual (translation)</a> ; <br>  [L9] - <a href="https://en.wikipedia.org/wiki/Gdbserver">Wikipedia.</a>  <a href="https://en.wikipedia.org/wiki/Gdbserver">gdbserver</a> ; <br>  [L10] - <a href="https://code.visualstudio.com/docs/editor/debugging">VSCode Documentation: Debugging</a> ; <br>  [L11] - <a href="https://code.visualstudio.com/docs/languages/cpp">VSCode Documentation: C / C ++ for VS Code</a> ; <br>  [L12] - <a href="https://community.imgtec.com/developers/mips/tools/codescape-mips-sdk/">Codescape MIPS SDK</a> ; <br>  [L13] - <a href="https://geektimes.ru/post/258842/">FTDI strikes back</a> ; <br>  [L14] - <a href="https://geektimes.ru/post/258848/">Resurrect FTDI in pictures</a> ; <br>  [L15] - <a href="https://github.com/zhelnio/MPSSELight">MPSSELight.</a>  <a href="https://github.com/zhelnio/MPSSELight">Lightweight .net MPSSE library</a> ; <br>  [L16] - <a href="http://we.easyelectronics.ru/Shematech/soglasovanie-logicheskih-urovney-5v-i-33v-ustroystv.html">Coordination of logical levels of 5V and 3.3V devices</a> <br>  [L17] - <a href="https://code.visualstudio.com/">Visual Studio Code</a> ; </p><br><h3 id="dokumentaciya">  Documentation </h3><br><p>  [D1] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D1_DS_FT2232D.pdf">FTDI FT2232D Datasheet</a> ; <br>  [D2] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D2_AN_135_MPSSE_Basics.pdf">FTDI Application Note AN 135. FTDI MPSSE Basics</a> ; <br>  [D3] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D3_AN_108_Command_Processor_for_MPSSE_and_MCU_Host_Bus_Emulation_Modes.pdf">FTDI Application Note AN 108. Command Processor for MPSSE and MCU Host Bus Emulation Modes</a> ; <br>  [D4] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D4_D2XX_Programmer%27s_Guide(FT_000071).pdf">FTDI Software Application Development.</a>  <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D4_D2XX_Programmer%27s_Guide(FT_000071).pdf">D2XX Programmer's Guide</a> ; <br>  [D5] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D5_gdb.pdf">Debugging with gdb.</a>  <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D5_gdb.pdf">Codescape GNU Tools 2016.05-03 for MIPS MTI Bare Meta</a> ; <br>  [D6] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D6_MIPS32_microAptiv_UP_Processor_Core_Family_Integrator%25E2%2580%2599s_Guide.txt">MIPS32 microAptiv UP Processor Core Family Integrator's Guide</a> ; <br>  [D7] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">EJTAG Specification.</a>  <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">Document Number: MD00047</a> ; <br>  [D8] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D8_OpenOCD_User%25E2%2580%2599s_Guide.pdf">OpenOCD User's Guide for release 0.8.0</a> ; <br>  [D9] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D9_gcc.pdf">Using the GNU Compiler Collection.</a>  <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D9_gcc.pdf">Codescape GNU Tools 2016.05-03 for MIPS MTI Bare Metal</a> ; <br>  [D10] - <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D10_MIPSfpga_Getting_Started_Guide.txt">MIPSfpga Getting Started Guide</a> ; </p><br><h3 id="izobrazheniya">  Images </h3><br><p>  [P1] <a href="">The main elements of the system</a> ; <br>  [P2] <a href="">FTDI USB Adapter Chip Specs</a> (source: <a href="http://www.ftdichip.com/Products/ICs.htm">L5</a> ); <br>  [P3] <a href="">Fragment of the Pinboard II debugging circuit</a> (source: <a href="http://shop.easyelectronics.ru/index.php%3FcategoryID%3D102">L4</a> ); <br>  [P4] <a href="">Typical connection scheme via EJTAG interface</a> (source: <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D6_MIPS32_microAptiv_UP_Processor_Core_Family_Integrator%25E2%2580%2599s_Guide.txt">D6</a> ); <br>  [P5] <a href="">Table of connecting the USB module to the FPGA</a> ; <br>  [P6] <a href="">IDCODE register</a> (source: <a href="https://github.com/zhelnio/memos/blob/master/public/00_mips_ftdi_debug/doc/D7_MD00047-2B-EJTAG-SPC-03.10.pdf">D7</a> ); <br>  [P7] <a href="">Visual Studio Code in debug mode (screenshot)</a> . </p></div>
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <p>Source: <a href="https://habr.com/ru/post/322442/">https://habr.com/ru/post/322442/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../322430/index.html">BBR system: congestion control directly by congestion</a></li>
<li><a href="../322432/index.html">Welcome to Lua in Moscow 2017 March 5</a></li>
<li><a href="../322434/index.html">IOS Localization Guide</a></li>
<li><a href="../322438/index.html">Neural networks in pictures: from one neuron to deep architectures</a></li>
<li><a href="../322440/index.html">Full automation of the ‚Äúdevelopment‚Äù environment using docker-compose</a></li>
<li><a href="../322444/index.html">Tete-a-tete: ask the right questions</a></li>
<li><a href="../322446/index.html">Emoji.prototype.length - a story about emotional characters in Unicode</a></li>
<li><a href="../322448/index.html">About spaghetti, or how to explore the business processes of an organization</a></li>
<li><a href="../322450/index.html">Immunitable data in C ++. Part 2</a></li>
<li><a href="../322452/index.html">How to conduct A / B testing on Twitch</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>