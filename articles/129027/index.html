<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Removing unused assemblies from a .NET project</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Sometime while studying at university, a teacher, checking a laboratory work on C ++, suddenly suddenly asked me a question: ‚ÄúWhy do you need #include...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Removing unused assemblies from a .NET project</h1><div class="post__text post__text-html js-mediator-article">  Sometime while studying at university, a teacher, checking a laboratory work on C ++, suddenly suddenly asked me a question: ‚ÄúWhy do you need #include‚Äú% library_name% ‚Äùhere?  Can you clarify for which parts of the code each include directive is needed? ‚ÄùThe directive that‚Äú caught his eye ‚Äùwas added when trying to use a class.  The class apparently did not take root in the laboratory and its use was safely removed, but the remained remained ... <br><br>  When programming in C # using Visual Studio, we also encounter unused using directives.  But Visual Studio can help deal with the problem, it‚Äôs enough for the .cs file to call the command ‚ÄúRemove Unused Usings‚Äù.  True, there is another place that also would not hurt from time to time to clean.  These are references (References) of the project.  Sadly, for the C # project there is no such command.  MS Connect even created a <a href="http://connect.microsoft.com/VisualStudio/feedback/details/510326/project-properties-references-tab-for-c-projects">bug</a> about this.  But for VB.NET projects there is such a function (you can find it in the project properties), but by evil irony of fate for VB.NET projects there is no command to delete unused Imports (usings in C #) :) <br><br>  Fueled by a thirst to make useful to colleagues, independent developers decided to write small extensions for Visual Studio.  And here is also the Extension Manager from Visual Studio 2010 so simplified the process of distributing extensions.  An example of such extensions can be found <a href="http://visualstudiogallery.msdn.microsoft.com/9811e528-cfa8-4fe7-9dd1-4021978b5097">here</a> and <a href="http://visualstudiogallery.msdn.microsoft.com/36a6eb45-a7b1-47c3-9e85-09f0aef6e879/">here</a> .  It is impossible to judge the algorithms used in these extensions.  Although I will not hide the fact that after the first extension shamelessly removed from the project a decent part of the assemblies that were really needed for compilation, we still looked at it with a reflector ... We didn‚Äôt deal with the second anymore.  In general, the problem is the same, but the key phrase can be found in the previous sentence: necessary for compilation. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <a name="habracut"></a>  Consider a simple example.  Suppose there are 3 projects - 3 assemblies.  The Assembly_A assembly defines the Class_A class, the Assembly_B assembly defines the Class_B class inherited from the Class_A class from the Assembly_A assembly.  Each class has different methods, say the class_A class method is Method_A, and the class_B class method is Method_B.  In the third assembly (Assembly_C) we want to use the class Class_B.  To do this, we add references to Assembly_A and Assembly_B assemblies in the project, then in one of the classes we create an instance of the Class_B class, call the Method_B ‚Äã‚Äãmethod and compile the project.  Assembly Assembly_C is ready, let's open it with ildasm.exe and take a look at the manifest: <br><blockquote><code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Metadata version: v4.0.30319</font> <br> .assembly <font color="#0000ff">extern</font> mscorlib <br> { <br> .publickeytoken = (B7 7A 5C 56 19 34 E0 89 ) <font color="#008000">// .z\V.4..</font> <br> .ver 4:0:0:0 <br> } <br> .assembly <font color="#0000ff">extern</font> Assembly_B <br> { <br> .ver 1:0:0:0 <br> } <br> .assembly Assembly_C <br> { <br> <font color="#008000">//    </font> <br> } <br> .module Assembly_C.exe <br> <font color="#008000">// MVID: {B387984A-3515-4B26-9450-592FCF5FB6FA}</font> <br> .imagebase 0x00400000 <br> .file alignment 0x00000200 <br> .stackreserve 0x00100000 <br> .subsystem 0x0003 <font color="#008000">// WINDOWS_CUI</font> <br> .corflags 0x00000003 <font color="#008000">// ILONLY 32BITREQUIRED</font> <br> // Image <font color="#0000ff">base</font> : 0x014C0000</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This is what happens?  Assembly_A we added to the project, but it is not needed?  Open Visual Studio and delete Assembly_C link for Assembly_A assembly.  Compile and ... get the error ‚ÄúThe type 'Assembly_A.Class_A' is referenced.  You must add a reference to assembly 'Assembly_A, Version = 1.0.0.0, Culture = neutral, PublicKeyToken = null'. ‚Äù <br><br>  It is important to understand the reason for this behavior.  There is no explicit reference to Assembly_A assembly types in the project, so the reference to this assembly is not included in the project assembly manifest (Assembly_C).  At the same time, one of the assembly types Assembly_B is used in the project.  In fact, it turns out that for the runtime (runtime) it is enough to have a reference to the Assembly_B assembly.  And the builds on which it depends, the CLR will receive from its manifest and also load it.  But for the compiler (compile time) it is important to have in the Assembly_C project both references to Assembly_B and Assembly_A, because he should know everything about the class_B used, including its ancestors.  A good article about build dependencies was published in MSDN Magazine, you can read it <a href="http://msdn.microsoft.com/en-us/magazine/cc163641.aspx">here</a> . <br><br>  It does not matter where your project uses a class: as a field of a class, as a parameter of a method, as an attribute, etc.  It is important to understand that the compiler should be able to get complete information about all types used in the project.  We have to clearly indicate the assembly we want to use, because the class can exist in different versions of the same assembly (even if the compiler can find the assembly (say in the GAC), how can he choose the right one if there are several of them?).  This is what should be the main idea when developing a program capable of finding unused assemblies in a project, i.e.  assemblies that are not required for compilation. <br><br>  The study of project class dependencies serves as the basis for the <a href="http://refassistant.codeplex.com/">Reference Assistant</a> extension, which we developed at the <a href="http://lardite.blogspot.com/">Lardite Group</a> .  This is a free extension available in <a href="http://visualstudiogallery.msdn.microsoft.com/fc504cc6-5808-4da8-ae86-8d3f9ed81606">Visual Studio Gallery</a> , in addition, you can download the Reference Assistant source code from the project page on CodePlex. <br><br>  It was with the analysis of the class hierarchy that Reference Assistant began.  Gradually, an analysis of the interface hierarchy, an analysis of attributes and types of their parameters, an analysis of imported types (for example, from a COM library), and <a href="http://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.typeforwardedtoattribute.aspx">types of objects moved</a> to another assembly were added to it.  Yes, there are those!  A simple example - <a href="http://msdn.microsoft.com/en-us/library/ms668604%2528v%3DVS.100%2529.aspx">ObservableCollection</a> migrated from the WindowsBase.dll assembly (fx3.5) to System.dll (fx4.0). <br><br>  I like the example of analyzing overloaded methods.  Suppose that in the Assembly_B assembly the class Class_B is defined, in which the SetCode method is overloaded.  Let two of its overload take one parameter at a time: one of type System.Int32, the other Assembly_A.Class_A.  In the project assembly (Assembly_C), one of the overloaded SetCode methods of class Class_B is called which takes one parameter.  In this case, the compiler must know everything about the types of parameters of both methods in order to choose the most appropriate one.  This means that assemblies with definitions of types participating in the hierarchy should be in the project links.  Those.  in our case, references to the Assembly_C project should contain a reference to the Assembly_A and Assembly_B assemblies.  The described example is in the form of code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#008000">// Assembly_A.dll</font> <br> <font color="#0000ff">namespace</font> Assembly_A <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Class_A <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">int</font> Code { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br> } <br> <br> <font color="#008000">// Assembly_B.dll</font> <br> <font color="#0000ff">using</font> Assembly_A; <br> <font color="#0000ff">namespace</font> Assembly_B <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Class_B <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> SetCode( <font color="#0000ff">int</font> code) <br> { <br> <font color="#008000">// some actions‚Ä¶</font> <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> SetCode(Class_A code) <br> { <br> <font color="#008000">// some actions‚Ä¶</font> <br> } <br> } <br> } <br> <br> <font color="#008000">// Assembly_C.dll (,   Assembly_B)</font> <br> <font color="#0000ff">using</font> Assembly_B; <br> <font color="#0000ff">namespace</font> Assembly_C <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> Class_C <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">void</font> Run() <br> { <br> <font color="#008000">// some actions‚Ä¶</font> <br> <font color="#0000ff">var</font> classB = <font color="#0000ff">new</font> Class_B(); <br> classB.SetCode(1); <br> <font color="#008000">// some actions‚Ä¶</font> <br> } <br> } <br> }</font> <br> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  This is the main thing that I wanted to tell.  Of course, during development, we were faced with a lot of nuances, which would be a brute force to describe in one article.  But about the most interesting, we will certainly try to write in other articles.  In conclusion, I want to say a few words about using Reference Assistant. <br><br>  As I said earlier, you can download Reference Assistant either from <a href="http://refassistant.codeplex.com/">CodePlex</a> or from <a href="http://visualstudiogallery.msdn.microsoft.com/fc504cc6-5808-4da8-ae86-8d3f9ed81606">Visual Studio Gallery</a> .  There is a slight difference between them - the extension laid out in the Gallery cannot be used in the Express edition of Visual Studio (this is a limitation of the Visual Studio Gallery), but the extension from CodePlex is possible. <br><br>  The easiest way to install is to use Extension Manager, a Visual Studio utility. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/d3d/69c/2c4/d3d69c2c43e2663797f9625cc54ee997.png" alt="image"><br><br>  To remove unused assemblies in the context menu of a project or project links (References folder), select ‚ÄúRemove Unused References‚Äù. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/65e/fa2/78e/65efa278e88aa4eaa0a4d769b0bce1d0.jpg" alt="image"><br><br>  Before deleting unused assemblies, a window will be displayed to confirm the list.  You can edit this list if you are sure that the assembly is needed for some reason (for example, it is dynamically connected to the application depending on the settings in the configuration file). <br><br><img src="https://habrastorage.org/getpro/habr/post_images/1b0/20b/72a/1b020b72a6f085c7fb49b121523db8b3.png" alt="image"><br><br>  You can also turn off the display of the ‚ÄúUnused References List‚Äù window using the ‚ÄúDon't show this dialog next time‚Äù option.  You can enable it again in the extension configuration: Tools -&gt; Options ... -&gt; Reference Assistant menu. <br><br><img src="https://habrastorage.org/getpro/habr/post_images/922/0da/579/9220da579e2fcd511ffe992b705fab49.png" alt="image"><br><br>  More information can be found in the documentation at <a href="http://refassistant.codeplex.com/">http://refassistant.codeplex.com</a> in the Downloads section.  User's guide describes how to work with the Reference Assistant.  It also describes how to enable error logging.  You can send us the error description to RefAssistant [at] lardite.com or register it in the <a href="http://refassistant.codeplex.com/workitem/list/basic">error tracker</a> .  Developer's guide describes the criteria for evaluating the assembly referenced by the project, and also gives an idea of ‚Äã‚Äãthe overall architecture of the extension. </div><p>Source: <a href="https://habr.com/ru/post/129027/">https://habr.com/ru/post/129027/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../129018/index.html">We sort XML by means of Oracle database</a></li>
<li><a href="../129019/index.html">Developing a cross-platform editor with syntax highlighting based on wxStyledTextCtrl</a></li>
<li><a href="../129021/index.html">The cat in the bag of the company Samsung</a></li>
<li><a href="../129024/index.html">The existence of a malware business as proof of the incapacity of the security industry</a></li>
<li><a href="../129026/index.html">Canobuvosti, 110th edition</a></li>
<li><a href="../129028/index.html">Learn about the new generation of System Center 2012 solutions from the developers themselves at Tech ‚àô Ed Russia 2011</a></li>
<li><a href="../129029/index.html">Over a million users are registered on Github.</a></li>
<li><a href="../129030/index.html">Scientists were able to get an image of what a person sees by scanning the brain.</a></li>
<li><a href="../129031/index.html">Creation of modules for PHPShop.CMS Free - Tips (Part 1)</a></li>
<li><a href="../129032/index.html">Kodak Zx5 - the updated iron in the updated case</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>