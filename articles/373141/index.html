<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>We connect the "domestic" LCD 16x2 MT-16S2S by SPI. Part 2. Program</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Continuing the theme of working with the indicator from the company MELT MT-16S2S on ST7070. 

 → The first part. 

 In this part the main library com...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">🔎</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">📜</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">⬆️</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">⬇️</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>We connect the "domestic" LCD 16x2 MT-16S2S by SPI. Part 2. Program</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/246/bc1/f9e/246bc1f9e3fb4d1aa8f5b4d1ecc5aca2.jpg"><br><br>  Continuing the theme of working with the indicator from the company MELT <a href="http://www.melt.com.ru/docs/MT-16S2S.pdf">MT-16S2S</a> on ST7070. <br><br>  → <a href="https://geektimes.ru/post/280946/">The first part.</a> 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      In this part the main library commands will be disassembled  Namely: initialization, command transfer (shift, cleaning, cursor), character output, line output, creating your character. <br><a name="habracut"></a><br>  Here is what we got from the manufacturer: <br><br><pre><code class="hljs pgsql">Main: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Init16S2S clr CS mov A,#<span class="hljs-number"><span class="hljs-number">80</span></span>h ;<span class="hljs-keyword"><span class="hljs-keyword">Set</span></span> DDRAM address <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»_ « mov A,#<span class="hljs-number"><span class="hljs-number">3</span></span>Ch ;<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;EXT=<span class="hljs-number"><span class="hljs-number">1</span></span> mov A,#<span class="hljs-number"><span class="hljs-number">83</span></span>h ;<span class="hljs-keyword"><span class="hljs-keyword">Set data</span></span> length <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;  <span class="hljs-number"><span class="hljs-number">4</span></span>   mov A,#<span class="hljs-string"><span class="hljs-string">'M'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»M_ « mov A,#<span class="hljs-string"><span class="hljs-string">'E'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»ME_ « mov A,#<span class="hljs-string"><span class="hljs-string">'L'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»MEL_ « mov A,#<span class="hljs-string"><span class="hljs-string">'T'</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»MELT_ « mov A,#<span class="hljs-number"><span class="hljs-number">38</span></span>h ;<span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;EXT=<span class="hljs-number"><span class="hljs-number">0</span></span>    mov A,#<span class="hljs-number"><span class="hljs-number">14</span></span>h ;<span class="hljs-keyword"><span class="hljs-keyword">Cursor</span></span> <span class="hljs-keyword"><span class="hljs-keyword">or</span></span> display shift <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;»MELT _ « setb CS</code> </pre> <br><div class="spoiler">  <b class="spoiler_title">Init16S2S</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Init16S2S: clr PSB ;   <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Delay40ms setb SCL ;    clr CS ;    mov A,#<span class="hljs-number"><span class="hljs-number">38</span></span>h ; <span class="hljs-keyword"><span class="hljs-keyword">Function</span></span> <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ;DL=<span class="hljs-number"><span class="hljs-number">1</span></span>, EXT=<span class="hljs-number"><span class="hljs-number">0</span></span> mov A,#<span class="hljs-number"><span class="hljs-number">06</span></span>h ; Entry mode <span class="hljs-keyword"><span class="hljs-keyword">set</span></span> <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ; I/D=<span class="hljs-number"><span class="hljs-number">1</span></span>,SH=<span class="hljs-number"><span class="hljs-number">0</span></span> mov A,#<span class="hljs-number"><span class="hljs-number">0</span></span>Eh ; Display <span class="hljs-keyword"><span class="hljs-keyword">ON</span></span>/<span class="hljs-keyword"><span class="hljs-keyword">OFF</span></span> control <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte ; D=<span class="hljs-number"><span class="hljs-number">1</span></span>,C=<span class="hljs-number"><span class="hljs-number">1</span></span>,P=<span class="hljs-number"><span class="hljs-number">0</span></span> mov A,#<span class="hljs-number"><span class="hljs-number">01</span></span>h ; Clear display <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Byte setb CS ;    <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Wait1<span class="hljs-number"><span class="hljs-number">.5</span></span>ms ret</code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Byte</b> <div class="spoiler_text"><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">Byte</span></span>: <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.7</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.6</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.5</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.4</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.3</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.2</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">ACC</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.0</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">clr</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">mov</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SI</span></span>,<span class="hljs-selector-tag"><span class="hljs-selector-tag">C</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">setb</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">SCL</span></span></code> </pre><br></div></div><br><div class="spoiler">  <b class="spoiler_title">Delay</b> <div class="spoiler_text"><pre> <code class="hljs pgsql">Wait40us: mov A,#<span class="hljs-number"><span class="hljs-number">20</span></span> ;  <span class="hljs-number"><span class="hljs-number">12</span></span>   djnz ACC,$ ret Wait1<span class="hljs-number"><span class="hljs-number">.5</span></span>ms: mov R0,#<span class="hljs-number"><span class="hljs-number">38</span></span> <span class="hljs-meta"><span class="hljs-meta">$1</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">call</span></span> Wait40us djnz R0,<span class="hljs-meta"><span class="hljs-meta">$1</span></span> ret</code> </pre><br></div></div><br>  In general, not a lot. <br>  But the main thing - there is a sequence and description of commands.  So initialization looks like this: <br><br><img src="https://habrastorage.org/files/84a/31a/629/84a31a6290c84be78cbe538c2fb93bf8.PNG"><br>  It is required to set CS to 0 and transfer 4 bytes: 38h, 0Eh, 01h, 06h.  And then again set CS to 1. This is for inclusion with default options.  Here you can take into account the control commands listed in the data sheet. <br><br><img src="https://habrastorage.org/files/ae1/dc8/ed1/ae1dc8ed12a64939861fa1fea4ddee06.PNG" alt="image"><br><br>  The first command 38h is a transition to the Function Set - Settings mode.  EXT = 0, DL is not important to us, since the serial mode is set by the output of the PSB. <br><br><img src="https://habrastorage.org/files/9c9/553/0f2/9c95530f2af346a2a5baa232a7f4d91e.PNG"><br><br>  The second command 0Eh turns on the display and the cursor, sets the zero page of the character generator: <br><br><img src="https://habrastorage.org/files/02e/cab/e2d/02ecabe2d5c4452fbb26eba03d0ddda9.PNG"><br><br>  The third 01h clears the display.  The fourth 06h translates into the Entry Mode Set mode and at the same time sets the direction of the shift to the right. <br><br><img src="https://habrastorage.org/files/5ef/c8e/f3a/5efc8ef3a0ab4e2fb7d00865e8d97dbc.PNG"><br><br>  All commands after reset require 40 µs delay.  Cleaning the display - 1.52 ms.  Therefore, in order to eliminate flickering, it is better to fill the display with spaces instead of cleaning.  Or display only the changed characters.  And the cleaning command to use only when turned on.  Or "menu page change" when the complete disappearance of the image is allowed.  It may seem that 1.5 ms is imperceptible to the eye, but the use of the cleaning command invariably causes the image to flicker (perhaps I do not know how to use it). <br><br>  In fact, initialization is just a transfer of the command to the display, so I did not make it a separate procedure.  In addition, the command for setting the character generator page and turning on the cursor is transmitted along with the command for turning on the display itself.  (Display ON / OF). <br><br>  Created several flags to pass commands.  Flags are grouped according to which of them can be transmitted simultaneously.  For example, the first six one by one of a pair are transmitted in one command (Display ON / OF) <br><br><pre> <code class="hljs rust"><span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_CUR_OFF = <span class="hljs-number"><span class="hljs-number">0x8000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_CUR_ON = <span class="hljs-number"><span class="hljs-number">0x4000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_DISP_OFF = <span class="hljs-number"><span class="hljs-number">0x2000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_DISP_ON = <span class="hljs-number"><span class="hljs-number">0x1000</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_SetPage_0 = <span class="hljs-number"><span class="hljs-number">0x0800</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_SetPage_1 = <span class="hljs-number"><span class="hljs-number">0x0400</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_CUR_SHIFT = <span class="hljs-number"><span class="hljs-number">0x200</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_DISP_SHIFT = <span class="hljs-number"><span class="hljs-number">0x100</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_SHIFT_LEFT = <span class="hljs-number"><span class="hljs-number">0x80</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_SHIFT_RIGHT = <span class="hljs-number"><span class="hljs-number">0x40</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_Home = <span class="hljs-number"><span class="hljs-number">0x0002</span></span>; <span class="hljs-keyword"><span class="hljs-keyword">const</span></span> <span class="hljs-built_in"><span class="hljs-built_in">u16</span></span> LCD_cmd_ClrScr = <span class="hljs-number"><span class="hljs-number">0x0001</span></span>;</code> </pre> <br>  And then the procedure for transferring the initialization command (and this inclusion, setting the cursor, shift, etc., described in the data sheet) is as follows. <br><br><pre> <code class="hljs dos">void LCD_Cmd(u16 <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>) { uint8_t toSend ; toSend = <span class="hljs-number"><span class="hljs-number">0</span></span>x8; GPIO_ResetBits(CS_Port, CS_Bit); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0</span></span>x38); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_ClrScr) &gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0</span></span>x01);Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); }; //   <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_Home) &gt;<span class="hljs-number"><span class="hljs-number">0</span></span>){SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0</span></span>x02);Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); }; //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>x3ff){ toSend = toSend+((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_CUR_ON) &gt;&gt; <span class="hljs-number"><span class="hljs-number">13</span></span>)+ //  ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_DISP_ON) &gt;&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>)+ //  ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_SetPage_1) &gt;&gt; <span class="hljs-number"><span class="hljs-number">10</span></span>); //   <span class="hljs-number"><span class="hljs-number">1</span></span> SPI_Send_byte(toSend);Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); }; <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> = <span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;<span class="hljs-number"><span class="hljs-number">0</span></span>x3ff; toSend = <span class="hljs-number"><span class="hljs-number">0</span></span>x10; //  <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span> &gt; <span class="hljs-number"><span class="hljs-number">0</span></span>x3f){ toSend += ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_DISP_SHIFT) &gt;&gt; <span class="hljs-number"><span class="hljs-number">5</span></span>)+ //   ((<span class="hljs-built_in"><span class="hljs-built_in">cmd</span></span>&amp;LCD_cmd_SHIFT_RIGHT) &gt;&gt; <span class="hljs-number"><span class="hljs-number">4</span></span>); //  SPI_Send_byte(toSend); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); }; SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0</span></span>x38); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); GPIO_SetBits(CS_Port, CS_Bit); }</code> </pre> <br>  The command to turn on the display will look like this: <br><br><pre> <code class="hljs lisp">LCD_Cmd(<span class="hljs-name"><span class="hljs-name">LCD_cmd_CUR_OFF</span></span> | LCD_cmd_DISP_ON | LCD_cmd_SetPage_0)<span class="hljs-comment"><span class="hljs-comment">;</span></span></code> </pre> <br>  The procedure for outputting a character to an arbitrary position (requires three bytes: a string, a column, a character code).  The output of "its" character, when it is already recorded, is carried out by the same procedure.  The sequence is as follows: the first byte (x) is the address of the position in which the character will be displayed. <br><br><img src="https://habrastorage.org/files/f70/5f9/e63/f705f9e63a8c40b5b8782430deae545c.PNG"><br><br>  Consider the unit in the high-order address setting command. <br><br><img src="https://habrastorage.org/files/3af/b1e/73f/3afb1e73fd05423798cffb19ea135b25.PNG"><br><br>  The second byte - transition to the advanced mode (EXT = 1) <br>  The third byte is 80h + (the number of characters is 1), in this case there is only one character, therefore 80h. <br>  The fourth byte is the actual character code from the character generator page set above (this is where the ambush is) <br>  Fifth - return to normal mode (EXT = 0). <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_SET_PUTChar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> y,</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> x, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code)</span></span></span><span class="hljs-function"> </span></span>{ x+=<span class="hljs-number"><span class="hljs-number">0x80</span></span><span class="hljs-number"><span class="hljs-number">-1</span></span>+(y<span class="hljs-number"><span class="hljs-number">-1</span></span>)*<span class="hljs-number"><span class="hljs-number">0x40</span></span>; GPIO_ResetBits(CS_Port, CS_Bit); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(x); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x3c</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x80</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(code); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x38</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); GPIO_SetBits(CS_Port, CS_Bit); }</code> </pre> <br>  The procedure for writing your character.  Writes 8 bytes for a single character.  While not optimal, it is worth remaking by analogy with the output of a whole line. <br><br><pre> <code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">LCD_SET_CustomChar</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(</span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">uint8_t</span></span></span></span><span class="hljs-function"><span class="hljs-params"> code, </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">const</span></span></span></span><span class="hljs-function"><span class="hljs-params"> </span></span><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-params"><span class="hljs-keyword">char</span></span></span></span><span class="hljs-function"><span class="hljs-params">* simbol)</span></span></span><span class="hljs-function"> </span></span>{ <span class="hljs-keyword"><span class="hljs-keyword">uint8_t</span></span> a, adr; <span class="hljs-keyword"><span class="hljs-keyword">for</span></span>( j=<span class="hljs-number"><span class="hljs-number">0</span></span>; j&lt;<span class="hljs-number"><span class="hljs-number">8</span></span>; j++){ adr =<span class="hljs-number"><span class="hljs-number">0x40</span></span>+j+(code&lt;&lt;<span class="hljs-number"><span class="hljs-number">3</span></span>); GPIO_ResetBits(CS_Port, CS_Bit); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(adr); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x3c</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x80</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(simbol[j]);Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); SPI_Send_byte(<span class="hljs-number"><span class="hljs-number">0x38</span></span>); Delay_mks(<span class="hljs-number"><span class="hljs-number">50</span></span>); GPIO_SetBits(CS_Port, CS_Bit); }; }</code> </pre> <br>  Address to write from 0 to 7. As a character, an array of 8 bytes is transmitted - a graphic representation of a character.  Of course, it can be obtained manually, but you can use one of the many ready-made generators.  For example: <br><br><img src="https://habrastorage.org/files/fa3/d89/15c/fa3d8915cb9447a998f50edab8c94d78.PNG"><br><br>  And finally, the text output.  Also from the row-column position. <br>  Also, the address of the first character, then the transition to the advanced mode, the number of bytes, the bytes themselves, return to EXT = 0. <br><br><blockquote>  void LCD_print_text (uint8_t y, uint8_t x, char * text) <br>  { <br>  u8 nBytes; <br>  if (! text) return; <br>  nBytes = strlen (text); <br>  if (nBytes&gt; 80) return; <br>  x + = 0x80-1 + (y-1) * 0x40; <br>  GPIO_ResetBits (CS_Port, CS_Bit);  Delay_mks (50); <br><br>  SPI_Send_byte (x);  Delay_mks (50); <br>  SPI_Send_byte (0x3c);  Delay_mks (50); <br>  SPI_Send_byte (0x80 + nBytes-1);  Delay_mks (50); <br>  for (j = 0; j &lt;nBytes; j ++) { <br>  SPI_Send_byte (text [j]);  Delay_mks (50);  }; <br>  SPI_Send_byte (0x38);  Delay_mks (50); <br>  GPIO_SetBits (CS_Port, CS_Bit); <br>  } </blockquote><br>  The code is written in Keil for STM32.  The default setting for the periphery for ARM controllers. <br><br>  <b>PS</b> And I am not a real welder, I have found a book on programming on the Internet ... </div><p>Source: <a href="https://habr.com/ru/post/373141/">https://habr.com/ru/post/373141/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../373131/index.html">Hackers have published tools Cellebrite for hacking iOS</a></li>
<li><a href="../373133/index.html">DJI Phantom 4 Pro: review from Madrobots</a></li>
<li><a href="../373135/index.html">Ilyich lamp - retro print armature on a 3D printer with a filament LED lamp</a></li>
<li><a href="../373137/index.html">Spring is coming, spring is the way</a></li>
<li><a href="../373139/index.html">Hacker hacked 150 thousand printers available on the web</a></li>
<li><a href="../373143/index.html">Grammarly service overview to improve writing in English</a></li>
<li><a href="../373145/index.html">Young over the years, yes old mind: the story of the brand FiiO</a></li>
<li><a href="../373147/index.html">Backpack for geek: several options from Madrobots</a></li>
<li><a href="../373149/index.html">Richard Feynman: The nature of physical law. Lecture # 4. Symmetry of physical laws</a></li>
<li><a href="../373151/index.html">Internet around the world: Africa</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>