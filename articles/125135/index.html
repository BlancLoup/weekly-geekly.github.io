<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Fluent NHibernate and Oracle</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In this topic, I would like to highlight the Fluent NHibernate library in conjunction with Oracle and give a small example. There are few articles on ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Fluent NHibernate and Oracle</h1><div class="post__text post__text-html js-mediator-article">  In this topic, I would like to highlight the <a href="http://fluentnhibernate.org/">Fluent NHibernate</a> library in conjunction with <strong>Oracle</strong> and give a small example.  There are few articles on this topic now (mentioned <a href="http://habrahabr.ru/blogs/net/38178/">in Habr√©</a> ), even fewer descriptions of interaction with Oracle.  Naturally, most are not in Russian.  However, the library deserves attention. <br><a name="habracut"></a><br>  The authors set themselves the task to rid <strong>NHibernate</strong> of XML (xmlless, so to speak).  Therefore, in our project it will not be.  Totally.  Instead, a fluent (‚Äúfluid‚Äù or ‚Äúflexible‚Äù) interface is provided that uses lambda expressions and method chains for setting up a database and mapping entities. <br><br><h3>  Requisites </h3><br>  We will need: <br><ul><li>  Oracle Server (in my case 11.2.0.1.0) </li><li>  Oracle DAC (Data Access Components, in my case 11.2.0.2.1), Oracle Client or any other provider of your access to the Oracle database. </li></ul><br>  To avoid problems in the future, make sure that you can connect to the database, for example, using third-party utilities.  Client settings are located at: <br><br> <code>%Oracle DAC/Client%\product\11.2.0\client_1\Network\Admin\tnsnames.ora</code> <br> <br>  In my case, the file has the form: <br> <code>ORCL = <br> (DESCRIPTION = <br> (ADDRESS = (PROTOCOL = TCP)(HOST = orasrvxp)(PORT = 1521)) <br> (CONNECT_DATA = <br> (SERVER = DEDICATED) <br> (SERVICE_NAME = orcl) <br> ) <br> ) <br></code> <br><h3>  Create a project </h3><br>  Create a new console project in Visual Studio 2010 and name it FluentExample.  I use the NuGet Package Manager to quickly find, get, and install the necessary packages.  Library installation can be done <a href="http://wiki.fluentnhibernate.org/Getting_started">manually</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      We right-click on the project file and click "Add Library Package Reference ...".  In the Online tab, in the search field, enter ‚Äúfluent‚Äù: <br><br><img alt="Add links" src="https://habrastorage.org/getpro/habr/post_images/11b/e38/46d/11be3846d2ec894c7ca6a7e29d21f8db.png"><br><br>  In addition to Fluent NHibernate itself, all dependencies will be loaded (Castle.Core, Iesi.Collections, NHibernate, NHibernate.Castle). <br><br>  I will build on the native <a href="http://wiki.fluentnhibernate.org/Getting_started">example from the</a> library <a href="http://wiki.fluentnhibernate.org/Getting_started">site</a> , it simply and fairly fully illustrates the capabilities of the library.  The scheme has the form: <br><img src="https://habrastorage.org/getpro/habr/post_images/483/0df/ecf/4830dfecfd80dd6a669efad17f16ec48.png"><br>  In the project, create two subfolders: Entities and Mappings, which will contain the entities and, accordingly, the display. <br><br><h3>  Describe entities </h3><br>  The first entity is an employee.  The employee has a name, surname and place of work - the store.  In the Entities folder, add a new class with the following code: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Employee <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">int</font> Id { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">string</font> FirstName { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">string</font> LastName { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> Store Store { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I draw your attention to two things: <br><ul><li>  Hereinafter, the <code>Id</code> property and list (one-to-many) properties are declared with the private setter.  Only NHibernate will set the values ‚Äã‚Äãfor <code>Id</code> (through reflection), and we initialize the lists in the constructor. </li><li>  All properties are declared with the <code>virtual</code> modifier, since NHibernate will create proxy classes for our entities, and you must enable property overloading. </li></ul><br>  Next in line is the product that has the name, price and list of stores selling them: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Product <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">int</font> Id { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">string</font> Name { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">double</font> Price { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> IList&lt;Store&gt; StoresStockedIn { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> Product() <br> { <br> StoresStockedIn = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt;Store&gt;(); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The list has a private setter and initialization occurs in the constructor, as described above. <br><br>  The class of the store, which has a name, as well as lists of goods and staff: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> Store <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">int</font> Id { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">string</font> Name { <font color="#0000ff">get</font> ; <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> IList&lt;Product&gt; Products { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> IList&lt;Employee&gt; Staff { <font color="#0000ff">get</font> ; <font color="#0000ff">private</font> <font color="#0000ff">set</font> ; } <br> <br> <font color="#0000ff">public</font> Store() <br> { <br> Products = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt;Product&gt;(); <br> Staff = <font color="#0000ff">new</font> <font color="#2B91AF">List</font> &lt;Employee&gt;(); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> AddProduct(Product product) <br> { <br> product.StoresStockedIn.Add( <font color="#0000ff">this</font> ); <br> Products.Add(product); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">virtual</font> <font color="#0000ff">void</font> AddEmployee(Employee employee) <br> { <br> employee.Store = <font color="#0000ff">this</font> ; <br> Staff.Add(employee); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In this class, we describe a little bit of logic, since NHibernate requires that both sides of the relationship be defined before saving related entities. <br><br>  This is where the description of our entities ends.  The linking table for the realization of the many-to-many relationship between the product and the store will be discussed below. <br><br><h3>  Mappim entity </h3><br>  Further, when using the classic NHibernate, you should start writing xml mapping files and base configurations.  But it is here that Fluent NHibernate takes effect. <br><br>  All the mapping classes described below are located in the Mappings folder.  Let's start by displaying the <code>Employee</code> class. <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">using</font> FluentExample.Entities; <br> <font color="#0000ff">using</font> FluentNHibernate.Mapping; <br> <br> <font color="#0000ff">namespace</font> FluentExample.Mappings <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">class</font> EmployeeMap : ClassMap&lt;Employee&gt; <br> { <br> <font color="#0000ff">public</font> EmployeeMap() <br> { <br> <br> } <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The mapping code itself will be placed in the class constructor inherited from <code>ClassMap</code> from the FluentNHibernate library.  In order for Fluent NHibernate to find mappings, it is necessary to declare classes with the <code>public</code> modifier.  Immediately consider the full mapping: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> EmployeeMap() <br> { <br> Table( <font color="#A31515">"Employee"</font> ); <br> Id(e =&gt; e.Id) <br> .GeneratedBy.Sequence( <font color="#A31515">"Employee_seq"</font> ); <br> Map(e =&gt; e.FirstName); <br> Map(e =&gt; e.LastName); <br> References(e =&gt; e.Store); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  The first line, <code>Table()</code> , is responsible for the name of the table that is being mapped.  Below we will see why you specify the name explicitly. <br><br>  In the <code>Id()</code> method, we specify which field identifies the object (NHibernate: <code>&lt;id&gt;</code> ).  If we used an auto-increment database, Fluent NHibernate would automatically recognize the type and assign the identity generator (NHibernate: <code>&lt;generator&gt;</code> ).  But, since there is no auto-increment in Oracle, we will use sequences (sequence), which is indicated later in the method chain. <br><br>  The next two lines indicate the display of scalar properties (NHibernate: <code>&lt;property&gt;</code> ), where the type and name are determined automatically.  This is implemented using the property naming convention.  The column name can also be specified manually using the <code>Column()</code> method, but I still recommend using the default conventions or setting your own.  <a href="http://wiki.fluentnhibernate.org/Conventions">Read more about agreements</a> . <br><br>  The next line shows that our object refers to the <code>Store</code> class in the singular, that is, it implements the ‚Äúmany‚Äù side in relation to many-to-one.  The name of the foreign key, again, following the conventions, is assumed to be Store_id.  The foreign key column can be overridden by the <code>Column()</code> method.  The <code>References()</code> method is used on the ‚Äúmany‚Äù side, on the other side of the relationship (‚Äúone‚Äù), the <code>HasMany()</code> method (NHibernate: <code>&lt;bag&gt;</code> ) will be applied, and the corresponding method of renaming the key field will be <code>KeyColumn()</code> . <br><br>  Let's go back to the <code>Table()</code> method.  The point here is that Fluent NHibernate defaults to quoting table names when displaying table names (this is the agreement), that is, our table now should have the name ‚ÄùEmployee‚Äù, along with quotes.  In Oracle, case-only names are surrounded by quotes.  In our example, I would not like to use quotes and leave the table names case-insensitive and without quotes, so I indicated them explicitly. <br><br>  Let's go to the mapping store: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> StoreMap : ClassMap&lt;Store&gt; <br> { <br> <font color="#0000ff">public</font> StoreMap() <br> { <br> Table( <font color="#A31515">"Store"</font> ); <br> Id(x =&gt; x.Id) <br> .GeneratedBy.Sequence( <font color="#A31515">"Store_seq"</font> ); <br> Map(x =&gt; x.Name); <br> HasMany(x =&gt; x.Staff) <br> .Inverse() <br> .Cascade.All(); <br> HasManyToMany(x =&gt; x.Products) <br> .Cascade.All() <br> .Table( <font color="#A31515">"StoreProduct"</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  We see here the symmetric call <code>HasMany()</code> for the <code>Employee</code> class, which we discussed above.  It also uses the <code>HasManyToMany()</code> method, which implements the many-to-many relationship between the store and the product through an intermediate table, whose name is specified in the chain by the <code>Table()</code> method. <br><br>  The <code>Inverse()</code> method shows that the collection owner is the other end of the relationship, that is, the <code>Employee</code> class, and it will be saved first.  <code>Cascade.All()</code> transfers events to related elements.  That is, if we, for example, delete a store, then all links with products and all the staff of this store will also be deleted.  For more information, see the NHibernate documentation. <br><br>  Finally, let's display our product: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">public</font> <font color="#0000ff">class</font> ProductMap : ClassMap&lt;Product&gt; <br> { <br> <font color="#0000ff">public</font> ProductMap() <br> { <br> Table( <font color="#A31515">"Product"</font> ); <br> Id(x =&gt; x.Id) <br> .GeneratedBy.Sequence( <font color="#A31515">"Product_seq"</font> ); <br> Map(x =&gt; x.Name); <br> Map(x =&gt; x.Price); <br> HasManyToMany(x =&gt; x.StoresStockedIn) <br> .Cascade.All() <br> .Inverse() <br> .Table( <font color="#A31515">"StoreProduct"</font> ); <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  I hope that from the experience of the previous mappings you will not find anything new here.  <a href="http://wiki.fluentnhibernate.org/Fluent_mapping">More on fluent mappings</a> . <br><br>  Now it's time to configure a connection to Oracle. <br><br><h3>  Connect to Oracle </h3><br>  We will connect using connectionString.  Add a new file, App.config, to the project, and enter our connection string for the user fluent with the password nhibernate: <br><blockquote> <code><a href="http://s-c.me/22538/s"></a> <a href="http://s-c.me/22538/h"></a> <font color="black">Copy Source | Copy HTML</font></code> <ol> <li>  <font color="#0000ff">&lt;?</font>  <font color="#800000">xml</font> <font color="#ff0000">version</font> <font color="#0000ff">= "1.0"</font> <font color="#ff0000">encoding</font> <font color="#0000ff">= "utf-8"</font> ?  <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">configuration</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">connectionStrings</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;</font> <font color="#800000">add</font> <font color="#ff0000">name</font> <font color="#0000ff">= "Oracle"</font> </li><li>  <font color="#ff0000">connectionString</font> <font color="#0000ff">= "DATA SOURCE = orcl; PASSWORD = nhibernate; PERSIST SECURITY INFO = True; USER ID = fluent"</font> </li><li>  <font color="#ff0000">providerName</font> <font color="#0000ff">= "Oracle.DataAccess.Client" /&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">connectionStrings</font> <font color="#0000ff">&gt;</font> </li><li>  <font color="#0000ff">&lt;/</font> <font color="#800000">configuration</font> <font color="#0000ff">&gt;</font> </li><li></li></ol></blockquote><br>  Next, you need to add a link to the <code>Oracle.DataAccess</code> assembly that comes with your chosen provider: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/779/780/e40/779780e401cb0dbd2415b8df3dbcf1fd.png"><br><br>  The adding links dialog will most likely be different - I use <a href="http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef">Productivity Power Tools</a> . <br><br>  Set the link to the property <code>Copy Local = True</code> , this indicates that this library should be copied to the folder with the output binary files of our project: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/647/12b/5d3/64712b5d33574792e544c47bd93c9020.png"><br><br>  For convenience, we will use a small helper to open a session in Fluent NHibernate: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">using</font> FluentExample.Entities; <br> <font color="#0000ff">using</font> FluentNHibernate.Cfg; <br> <font color="#0000ff">using</font> FluentNHibernate.Cfg.Db; <br> <font color="#0000ff">using</font> NHibernate; <br> <font color="#0000ff">using</font> NHibernate.Driver; <br> <br> <font color="#0000ff">namespace</font> FluentExample <br> { <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">class</font> FluentNHibernateHelper <br> { <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> ISessionFactory _sessionFactory; <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> ISessionFactory SessionFactory <br> { <br> <font color="#0000ff">get</font> <br> { <br> <font color="#0000ff">if</font> (_sessionFactory == <font color="#0000ff">null</font> ) <br> { <br> <font color="#0000ff">var</font> dbConfig = OracleDataClientConfiguration.Oracle10 <br> .ConnectionString(c =&gt; c.FromConnectionStringWithKey( <font color="#A31515">"Oracle"</font> )) <br> .Driver&lt;OracleDataClientDriver&gt;() <br> .ShowSql(); <br> <br> _sessionFactory = Fluently.Configure() <br> .Database(dbConfig) <br> .Mappings(m =&gt; m.FluentMappings.AddFromAssemblyOf&lt;Employee&gt;()) <br> .BuildSessionFactory(); <br> } <br> <font color="#0000ff">return</font> _sessionFactory; <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> ISession OpenSession() <br> { <br> <font color="#0000ff">return</font> SessionFactory.OpenSession(); <br> } <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  In the database configuration, we use the <code>OracleDataClientConfiguration</code> predefined class from the <code>OracleDataClientConfiguration</code> namespace and configure it to use the connection string we created and the NHibernate driver.  You can also enable the option to display the generated SQL queries.  <a href="http://wiki.fluentnhibernate.org/Database_configuration">Learn more about database configuration</a> . <br><br>  Next, perform the very configuration of NHibernate.  We substitute our database configuration, indicate the source of mappings and ask for the session factory.  <a href="http://wiki.fluentnhibernate.org/Fluent_configuration">Read more about fluent configuration</a> . <br><br>  At this stage, the session should succeed: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">class</font> Program <br> { <br> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main() <br> { <br> <font color="#0000ff">using</font> (FluentNHibernateHelper.OpenSession()) <br> { <br> <br> } <br> } <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br><h3>  Test our base </h3><br>  Now your project should have a structure similar to this: <br><br><img src="https://habrastorage.org/getpro/habr/post_images/4bd/fad/c33/4bdfadc33d1adc808917721cf4d26e8c.png"><br><br>  It's time to run a real test: <br><blockquote> <code><a href="http://virtser.net/blog/post/source-code-highlighter.aspx"></a> <font color="black"><font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> Main() <br> { <br> <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> session = FluentNHibernateHelper.OpenSession()) <br> { <br> <font color="#0000ff">using</font> ( <font color="#0000ff">var</font> transaction = session.BeginTransaction()) <br> { <br> <font color="#0000ff">var</font> barginBasin = <font color="#0000ff">new</font> Store { Name = <font color="#A31515">"Bargin Basin"</font> }; <br> <font color="#0000ff">var</font> superMart = <font color="#0000ff">new</font> Store { Name = <font color="#A31515">"SuperMart"</font> }; <br> <br> <font color="#0000ff">var</font> potatoes = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Potatoes"</font> , Price = 3.60 }; <br> <font color="#0000ff">var</font> fish = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Fish"</font> , Price = 4.49 }; <br> <font color="#0000ff">var</font> milk = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Milk"</font> , Price = 0.79 }; <br> <font color="#0000ff">var</font> bread = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Bread"</font> , Price = 1.29 }; <br> <font color="#0000ff">var</font> cheese = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Cheese"</font> , Price = 2.10 }; <br> <font color="#0000ff">var</font> waffles = <font color="#0000ff">new</font> Product { Name = <font color="#A31515">"Waffles"</font> , Price = 2.41 }; <br> <br> <font color="#0000ff">var</font> daisy = <font color="#0000ff">new</font> Employee { FirstName = <font color="#A31515">"Daisy"</font> , LastName = <font color="#A31515">"Harrison"</font> }; <br> <font color="#0000ff">var</font> jack = <font color="#0000ff">new</font> Employee { FirstName = <font color="#A31515">"Jack"</font> , LastName = <font color="#A31515">"Torrance"</font> }; <br> <font color="#0000ff">var</font> sue = <font color="#0000ff">new</font> Employee { FirstName = <font color="#A31515">"Sue"</font> , LastName = <font color="#A31515">"Walkters"</font> }; <br> <font color="#0000ff">var</font> bill = <font color="#0000ff">new</font> Employee { FirstName = <font color="#A31515">"Bill"</font> , LastName = <font color="#A31515">"Taft"</font> }; <br> <font color="#0000ff">var</font> joan = <font color="#0000ff">new</font> Employee { FirstName = <font color="#A31515">"Joan"</font> , LastName = <font color="#A31515">"Pope"</font> }; <br> <br> <font color="#008000">//  .   ,   </font> <br> <font color="#008000">//       many-to-many.</font> <br> AddProductsToStore(barginBasin, potatoes, fish, milk, bread, cheese); <br> AddProductsToStore(superMart, bread, cheese, waffles); <br> <br> <font color="#008000">//        </font> <br> AddEmployeesToStore(barginBasin, daisy, jack, sue); <br> AddEmployeesToStore(superMart, bill, joan); <br> <br> <font color="#008000">//         </font> <br> session.SaveOrUpdate(barginBasin); <br> session.SaveOrUpdate(superMart); <br> <br> transaction.Commit(); <br> } <br> <br> <font color="#008000">//   </font> <br> <font color="#0000ff">using</font> (session.BeginTransaction()) <br> { <br> <font color="#0000ff">var</font> stores = session.CreateCriteria( <font color="#0000ff">typeof</font> (Store)). <font color="#2B91AF">List</font> &lt;Store&gt;(); <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> store <font color="#0000ff">in</font> stores) <br> WriteStorePretty(store); <br> } <br> <br> <font color="#2B91AF">Console</font> .ReadKey(); <br> } <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> AddProductsToStore(Store store, <font color="#0000ff">params</font> Product[] products) <br> { <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> product <font color="#0000ff">in</font> products) <br> store.AddProduct(product); <br> } <br> <br> <font color="#0000ff">public</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> AddEmployeesToStore(Store store, <font color="#0000ff">params</font> Employee[] employees) <br> { <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> employee <font color="#0000ff">in</font> employees) <br> store.AddEmployee(employee); <br> } <br> <br> <font color="#0000ff">private</font> <font color="#0000ff">static</font> <font color="#0000ff">void</font> WriteStorePretty(Store store) <br> { <br> <font color="#2B91AF">Console</font> .WriteLine(store.Name); <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">" Products:"</font> ); <br> <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> product <font color="#0000ff">in</font> store.Products) <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"  "</font> + product.Name); <br> <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">" Staff:"</font> ); <br> <font color="#0000ff">foreach</font> ( <font color="#0000ff">var</font> employee <font color="#0000ff">in</font> store.Staff) <br> <font color="#2B91AF">Console</font> .WriteLine( <font color="#A31515">"  "</font> + employee.FirstName + <font color="#A31515">" "</font> + employee.LastName); <br> <br> <font color="#2B91AF">Console</font> .WriteLine(); <br> } <br></font> <br> <font color="gray">* This source code was highlighted with <font color="gray">Source Code Highlighter</font> .</font></code> </blockquote> <br>  That's all. <br>  I also provide a <a href="http://pastebin.com/jqL4Uu8R">script</a> for generating a schema in Oracle. <br><br><h3>  What's next? </h3><br><h4>  <a href="http://wiki.fluentnhibernate.org/Current_NHibernate_Features_Not_Supported_In_Fluent">Unrealized functionality</a> </h4><br>  The authors support a large part of the capabilities of the native library, but some features of NHibernate are not yet available, for example, <code>&lt;sql-insert&gt;</code> . <br><br><h4>  <a href="http://wiki.fluentnhibernate.org/Auto_mapping">Automapping</a> </h4><br>  Fluent NHibernate allows you to do mapping automatically, just follow the entered agreements or define your own. <br><br><h4>  <a href="http://wiki.fluentnhibernate.org/Persistence_specification_testing">Testing mappings</a> </h4><br>  The library allows you to quickly and in the same style to test created mappings. <br><br><h4>  <a href="http://">Full API documentation</a> </h4></div><p>Source: <a href="https://habr.com/ru/post/125135/">https://habr.com/ru/post/125135/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../125126/index.html">WM> Bank = Technical Overdraft</a></li>
<li><a href="../125129/index.html">The final version of symfony2 has been released. Hooray!</a></li>
<li><a href="../125131/index.html">Dropbox rented a huge office for 400 employees</a></li>
<li><a href="../125132/index.html">Microsoft¬Æ SQL Server¬Æ 2008 R2 Service Pack 1</a></li>
<li><a href="../125133/index.html">Happy System Administrator Day 2011!</a></li>
<li><a href="../125137/index.html">Google opens LevelDB: another internal development</a></li>
<li><a href="../125139/index.html">Giant claw for a game a la crane machine with Ardunio controller</a></li>
<li><a href="../125142/index.html">Trojan changes numbers in online banking</a></li>
<li><a href="../125144/index.html">Catch good luck with Radmin: a contest for system administrators!</a></li>
<li><a href="../125145/index.html">Innovative laboratory comments on the information that officials will be taken from iPad</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>