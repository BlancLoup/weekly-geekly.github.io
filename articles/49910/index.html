<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>HPC: nVidia, AMD, Sony Cell, x86</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Many have heard of mythical words - nVidia CUDA , AMD Brook , IBM / Sony Cell ... It is rumored that the mere mention of these forces your program to ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>HPC: nVidia, AMD, Sony Cell, x86</h1><div class="post__text post__text-html js-mediator-article">  Many have heard of mythical words - <b>nVidia CUDA</b> , <b>AMD Brook</b> , <b>IBM / Sony Cell</b> ... It is rumored that the mere mention of these forces your program to work hundreds of times faster.  Let's try to figure out what they are, what this magical high-performance programming looks like in general terms, and what benefits they can provide in comparison with the good old <b>x86 processors</b> . <br><br><a name="habracut"></a><br>  I recently got carried away with high-performance computing (language can be broken, HPC - High-performance computing), and I want to share a brief overview of how things are now with the programming and performance of various hardware platforms, namely nVidia CUDA, AMD Brook +, Sony / Toshiba / IBM Cell (the main power of the PS3), well, for comparison - the old x86 in the face of Core2Quad / i7, AMD Phenom / Phenom II.  Just want to note that there are many nuances affecting performance - the sizes and latencies of caches of different levels, the combinability of commands of various types and put it all in one article will not work out, so now I will show the situation in general terms. <br><br>  The conversation goes everywhere about 32-bit numbers.  For evaluation: 64-bit numbers, the GTX285 performance drops by about 10-12 times, AMD 4870 - by 4 times, x86 and Cell- by 2 times. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      At the seed I immediately show the result: <br><br><table width="638" border="2"><tbody><tr><td>  ... </td><td>  <font>nVidia GTX285</font> </td><td>  <font>AMD 4870</font> </td><td>  <font>Sony cell</font> </td><td>  <font>X86 i7 3.2Ghz</font> </td></tr><tr><td>  <font>Real speed, GFLOP *</font> </td><td>  <font>500</font> </td><td>  <font>600</font> </td><td>  <font>153</font> </td><td>  <font>153</font> </td></tr><tr><td>  <font>Crystal area</font> </td><td>  <font>470mm <sup>2</sup></font> </td><td>  <font>256mm <sup>2</sup></font> </td><td>  <font>120mm <sup>2</sup></font> </td><td>  <font>263mm <sup>2</sup></font> </td></tr><tr><td>  <font>Technical process</font> </td><td>  <font>55nm</font> </td><td>  <font>55nm</font> </td><td>  <font>65nm</font> </td><td>  <font>45nm</font> </td></tr></tbody></table>  * GFLOP - billions of operations per second <br><br>  PS: Cell at 45nm still as follows <br>  not launched, and it is not used in Sonya <br>  until. <br><br><h1>  nVidia CUDA </h1><br>  nVidia is perhaps the most effort to promote its technology.  I heard the magic word CUDA long before I decided to try what it is.  CUDA - This is a C ++ compiler (fairly straightforward and stable), which a specially written program compiles for execution by SIMD processors inside a video card.  For example, in GTX285 - 240 processors that do 1-3 (multiplication + addition + special, 2-3 graphic shaders are real, but in conventional calculations it‚Äôs better to focus on 1.5) operations per clock at a frequency of 1476Mhz, marketing performance just above 1 TFLOP (a trillion operations per second), the real achievable speed of about 500 GFLOP. <br><br>  The program looks like this: <br><br>  __device__ unsigned int * data_d; <br>  __global__ void gpu_thing (int somevalue) <br>  { <br>  const <br>  int ix = blockDim.x * blockIdx.x + threadIdx.x; <br><br>  data_d [ix] <br>  * = somevalue; <br>  } <br><br>  Runs on the GPU like this: <br><br>  dim3 <br>  threads (256); <br>  dim3 grid (256); <br>  int <br>  src [256 * 256], result [256 * 256];  // copy the data to the memory of the video card <br>  cudaMemcpyAsync (data_d, src, sizeof (int) * 256 * 256, cudaMemcpyHostToDevice, 0);  // Run on the video card, 256 * 256 threads <br>  at the same time <br>  gpu_thing &lt;&lt;&lt; grid, threads &gt;&gt;&gt; (125);  // Get the result from memory <br>  cudaMemcpyAsync (result, data_d, sizeof (int) * 256 * 256, cudaMemcpyDeviceToHost, <br>  NULL); <br><br>  <b>Limitations:</b> <br>  Threads are executed in groups of 16, all instructions must be the same (otherwise performance is reduced, the compiler / hardware keeps an eye on this). <br><br>  The start time of the streams is not 1ms, of course, but noticeable, so it‚Äôs better not to shift small tasks to the video card.  During the program <br>  on the video card to which the monitor is connected, windows cannot refresh the screen, even the mouse cursor does not move - the problem is solved by selecting the workload by 10-20ms so that the user is not too bad.  If the kernel timeout exceeds 5 seconds, Windows decides that the driver is frozen, and restarts it - the results are bad for your program (again, this is true only if a monitor is connected to the video card) :-) Linux and MacOS are supported.  Support for multiple video cards - works only if the SLI mode is disabled.  It supports all video cards from 8400GS (although it usually turns out slower than the processor).  Formally, video cards of different types are not required to work, but in practice any combinations work (requires manual separation of tasks). <br><br><h1>  AMD Brook + </h1><br>  AMD tried its best with iron - its 4870 has 160 processors, each of which can do 5 operations (with minor restrictions) per clock at a frequency of 750 Mhz.  Theoretical and practical performance - 600GFlop.  AMD fans - do not read the next paragraph, but be aware - on real applications (if you can write them), the 4870 makes the GTX285 10-20%.  And now about the bad: C Brook + just pitchfork.  You need to be a very calm person to work with him.  The C compiler (without ++), and therefore we meet again both with long-forgotten restrictions (like defining local variables only at the beginning of the function body), and with completely unfamiliar ones: local arrays are not supported, structures are supported, but the compiler almost never ok compile it (crash / issue <br>  wrong code - this is true for Stream SDK 1.3).  In general, get ready that the version is called 1.3 and works like 0.3alpha :-D Despite the fact that we have the VLIW architecture and it would be useful to be able to unfold cycles (for example, as in Intel C ++ - pragma unroll (5)), this cannot be done. <br>  Yes, there is no preprocessor either, screw your own.  Well, it completes all the inability to work with several video cards (or rather, one process (not a thread) - one video card).  It is worth paying tribute to AMD CAL - programming at a low level (not machine code, but almost) - there are almost no problems, but the drawbacks are obvious.  The program looks like this: <br><br>  kernel void gpu_thing (int input &lt;&gt;, <br>  int somevalue, out int output &lt;&gt;) <br>  { <br><br>  output <br>  = somevalue * input; <br><br>  unsigned int md5_dim [] = {800 * 256}; <br>  :: brook :: Stream &lt;int&gt; input (1, size); <br>  :: brook :: Stream &lt;int&gt; result (1, size); <br><br>  int src [800 * 256], dst [800 * 256]; <br><br>  input.read (src);  // prepare the data for the video card <br>  hello_brook_check (input, 45, output);  // run 800 * 256 threads <br>  output.write (dst); <br><br>  <b>Restrictions:</b> the start time is also significant, again everything stops except the mouse cursor, again 5 seconds the maximum execution time under windows. <br>  Iron is supported by HD 2xxx (with limitations), HD3xxx and 4xxx. <br><br><h1>  Sony cell </h1><br>  Many are delighted with the performance of Sony Cell.  It is certainly impressive, if we forget that x86 is also advanced (not to mention the video cards).  Cell consists of the usual Power-core called PPE (with a slight performance compared to the above-mentioned monsters) and 8 SPE cores, of which 1 is potentially defective (non-defective chips are sold separately for much larger <br>  money), and 1 is reserved by the operating system (if you change the console to Linux, you can get access to 7, but this is difficult for end users ;-)), there are 6 in total. Each of the cores does 8 operations per clock (2 * 4) on the frequency 3.2Ghz, which gives a total real <br>  performance 153.6 GFLOP.  With programming here I will not tell you, because  these 153 GFLOPs are impractical enough to use, and therefore not <br>  tried (in terms of the release of the program is not for domestic consumption). <br><br><h1>  x86 </h1><br>  Already dumped x86?  But it can still shake the old days: On i7 / Core2Quad, each of the 4 cores can perform 3 SSE2 operations on 4 numbers per clock, for a total of 48 operations per clock (and it was relatively recently thought that it was difficult / impossible to overcome 1 operation per clock , and started to go in the direction of VLIW / RISC), which gives us 153.6 GFLOP (ops, exactly the same amount as Cell) Phenom / PhenomII can also, but it has SSE2 specialized modules (one multiplication, one addition, one universal), therefore Productivity is 20-40% lower.  If it seems to someone that it is difficult to use 48 operations per clock, here is an example: <br><br>  int data [1024 * 1024 * 12]; <br>  const int value1 = 123; <br>  for (int i = 0; i &lt;1024 * 1024 * 12; i ++) data [i] ^ = value1; <br><br>  If this is compiled in Intel C ++, and run in 4 threads (however, he now sometimes can even guess to start the threads himself), he will combine the operations into groups convenient for SSE2 (it is necessary to admit that it does not always work smoothly for everyone, you can suggest numerous # pragma or use SSE-intrinsics, but this is a topic for a separate article) <br><br>  What can be concluded?  Of course, video cards now show phenomenal performance on a fairly narrow category of tasks (especially dual-chip ones), about 8 times faster than good code on a regular x86 processor.  8 is far from 30-100 as advertised, but still enough to sometimes make the impossible possible.  In addition, a motherboard for 4 video cards is much cheaper than a board for 4 processors.  The euphoria about the performance of the Cell in the PS3 should already subside, since the serial x86 processors caught up with it in performance. <br><br>  And the habr parser does not want to validly display the &lt;code&gt; tag, so I will remove it.  :( </div><p>Source: <a href="https://habr.com/ru/post/49910/">https://habr.com/ru/post/49910/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../49900/index.html">Do not be a slave! Change the world, and do not bend over him.</a></li>
<li><a href="../49901/index.html">PageRank predicts Nobel laureates</a></li>
<li><a href="../49905/index.html">Universal admin</a></li>
<li><a href="../49907/index.html">Self-identification</a></li>
<li><a href="../49908/index.html">HOWTO: How to determine the letter of a CD / DVD in WinPE</a></li>
<li><a href="../49911/index.html">Flexible methodologies. Retrospective</a></li>
<li><a href="../49913/index.html">Other morals</a></li>
<li><a href="../49916/index.html">[Task] Where did 10 rubles go?</a></li>
<li><a href="../49922/index.html">Perl CMS: Development Experience</a></li>
<li><a href="../49924/index.html">Philosopher - new free font</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>