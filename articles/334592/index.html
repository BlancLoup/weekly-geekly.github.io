<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>In a section: the news aggregator on Android with backend. Assembly system</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Introduction (with links to all articles) 

 About 10-15 years ago, when the programs consisted of source codes and a small number of binary files wit...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>In a section: the news aggregator on Android with backend. Assembly system</h1><div class="post__text post__text-html js-mediator-article">  <a href="https://habrahabr.ru/post/334510/">Introduction (with links to all articles)</a> <br><br>  About 10-15 years ago, when the programs consisted of source codes and a small number of binary files with the work of assembling the final programs, all kinds of "? Make" did an excellent job.  However, now modern programs and approaches to development have changed a lot - these are: <br>  many different files (I don‚Äôt consider source) - styles, templates, resources, configurations, scripts, binary data, etc.; <br><br><ul><li>  preprocessors; </li><li>  systems for checking the source style or the entire project (lint, checkstyle, etc.); </li><li>  development techniques based on tests, with their launch during assembly; </li><li>  various types of stands; </li><li>  cloud-based deployment systems, etc.  etc. </li></ul><a name="habracut"></a><br>  Moreover, the average developer has to go through several times a day through the stages of assembling the final or intermediate artifacts using the listed tools and techniques.  Launching command files with hands (with possible verification of results) is too burdensome in this case: you need a tool that tracks changes in your project data and runs the necessary tools depending on the detected changes. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      My way of using build systems was incomprehensible_number * make -&gt; <a href="http://ant.apache.org/">ant</a> -&gt; <a href="http://maven.apache.org/">maven</a> -&gt; <a href="https://gradle.org/">gradle</a> (the fact that the android Studio under the hood uses gradle pleased me a lot). <br><br>  Gradle attracted me: <br><br><ul><li>  its simple model (from which the truth can grow a monster, commensurate with the product being created); </li><li>  flexibility (both in terms of setting up the scripts themselves, and in organizing their distribution within large projects); </li><li>  constant development (as with all other things in the development - here we must constantly learn something new); </li><li>  ease of adaptation (knowledge of groovy and gradle DSL is required); </li><li>  the presence of plugin systems developed by the community includes various preprocessors, code generators, delivery and publication systems, etc., etc. (see <a href="https://login.gradle.org/">login.gradle.org</a> ) </li></ul><br>  You can familiarize yourself with the features of Gradle on the developers website in <a href="https://docs.gradle.org/current/userguide/userguide.html">the documentation section (you can find out everything!)</a> .  For those who want to compare gradle and maven there is an <a href="https://youtu.be/6tnefehAmj0">interesting video from JUG</a> . <br><br>  In my case, the build scripts look like this: <br><br><div style="text-align:center;"><img src="https://habrastorage.org/web/bde/f77/a99/bdef77a9902e48cf90dc5c1d979523dd.png" alt="image"></div>  , <br>  Where: <br><br><ul><li>  build_scripts / build-tasks.gradle - all tasks for the build with their dependencies; </li><li>  build_scripts / dependencies.gradle - description of dependencies and methods of publishing; </li><li>  build.gradle - the main script, which defines dependent modules, libraries and includes other build scripts; </li><li>  settings.gradle - the list of dependent modules and the settings of the script itself (you can override the gradle launch arguments). </li></ul><br>  In this configuration, all changes to the build script are made in centralized files (not given to each project) and can / should be adjusted centrally by the person responsible for building the project. <br><br><h3>  Tips </h3><br>  Of the interesting things / tips that I would like to share, when setting up a gradle in my project there are the following: <br><br><ul><li><p>  Removal of artifact versions (scrolling in blocks of modules was a boring task) </p><br>  We declare a block with dependencies: <br><pre><code class="hljs bash">// project dependencies ext { COMMONS_POOL_VER=<span class="hljs-string"><span class="hljs-string">'2.4.2'</span></span> DROPWIZARD_CORE_VER=<span class="hljs-string"><span class="hljs-string">'1.1.0'</span></span> DROPWIZARD_METRICS_VER=<span class="hljs-string"><span class="hljs-string">'3.2.2'</span></span> DROPWIZARD_METRICS_INFLUXDB_VER=<span class="hljs-string"><span class="hljs-string">'0.9.3'</span></span> JSOUP_VER=<span class="hljs-string"><span class="hljs-string">'1.10.2'</span></span> STORM_VER=<span class="hljs-string"><span class="hljs-string">'1.0.3'</span></span> ... GROOVY_VER=<span class="hljs-string"><span class="hljs-string">'2.4.7'</span></span> // <span class="hljs-built_in"><span class="hljs-built_in">test</span></span> TEST_JUNIT_VER=<span class="hljs-string"><span class="hljs-string">'4.12'</span></span> TEST_MOCKITO_VER=<span class="hljs-string"><span class="hljs-string">'2.7.9'</span></span> TEST_ASSERTJ_VER=<span class="hljs-string"><span class="hljs-string">'3.6.2'</span></span> }</code> </pre> <br>  And we use it in the project: <br><pre> <code class="hljs perl">project(<span class="hljs-string"><span class="hljs-string">':crawler_scripts'</span></span>) { javaProject(it) javaLogLibrary(it) javaTestLibrary(it) dependencies { testCompile <span class="hljs-string"><span class="hljs-string">"org.codehaus.groovy:groovy:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${GROOVY_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"edu.uci.ics:crawler4j:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${CRAWLER4J_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.jsoup:jsoup:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${JSOUP_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"joda-time:joda-time:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${JODATIME_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.apache.commons:commons-lang3:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${COMMONS_LANG_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"commons-io:commons-io:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${COMMONS_IO_VER}</span></span></span><span class="hljs-string">"</span></span> } }</code> </pre><br></li><li>  Transferring settings to an external file <br>  Create or already have a configuration file: <br><pre> <code class="hljs rust">--- # presented - <span class="hljs-keyword"><span class="hljs-keyword">for</span></span> test/development only - <span class="hljs-keyword"><span class="hljs-keyword">use</span></span> artifact from <span class="hljs-string"><span class="hljs-string">""</span></span>/provision/artifacts<span class="hljs-string"><span class="hljs-string">" directory storyline_components: crawler_scripts: version: "</span></span><span class="hljs-number"><span class="hljs-number">0.5</span></span><span class="hljs-string"><span class="hljs-string">" crawler: version: "</span></span><span class="hljs-number"><span class="hljs-number">0.6</span></span><span class="hljs-string"><span class="hljs-string">" server_storm: version: "</span></span>presented<span class="hljs-string"><span class="hljs-string">" server_web: version: "</span></span><span class="hljs-number"><span class="hljs-number">0.1</span></span><span class="hljs-string"><span class="hljs-string">"</span></span></code> </pre><br>  And we use it in the project: <br><pre> <code class="hljs coffeescript"><span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.databind.ObjectMapper <span class="hljs-keyword"><span class="hljs-keyword">import</span></span> com.fasterxml.jackson.dataformat.yaml.YAMLFactory buildscript { repositories { jcenter() } dependencies { <span class="hljs-regexp"><span class="hljs-regexp">//</span></span> reading YAML classpath <span class="hljs-string"><span class="hljs-string">"com.fasterxml.jackson.core:jackson-databind:2.8.6"</span></span> classpath <span class="hljs-string"><span class="hljs-string">"com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:2.8.6"</span></span> } } .... def loadArtifactVersions(type) { Map result = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> HashMap() def name = <span class="hljs-string"><span class="hljs-string">"${projectDir}/deployment/${type}/hieradata/version.yaml"</span></span> println <span class="hljs-string"><span class="hljs-string">"Reading artifact versions from ${name}"</span></span> <span class="hljs-keyword"><span class="hljs-keyword">if</span></span> (<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> File(name).exists()) { ObjectMapper mapper = <span class="hljs-keyword"><span class="hljs-keyword">new</span></span> ObjectMapper(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> YAMLFactory()); result = mapper.readValue(<span class="hljs-keyword"><span class="hljs-keyword">new</span></span> FileInputStream(name), HashMap.class); } <span class="hljs-keyword"><span class="hljs-keyword">return</span></span> result[<span class="hljs-string"><span class="hljs-string">'storyline_components'</span></span>]; }</code> </pre><br></li><li>  Use of templates <br><br>  This is my favorite part - it allows you to create the necessary configuration files from templates. <br>  We create templates: <br><pre> <code class="hljs ruby"><span class="hljs-symbol"><span class="hljs-symbol">version:</span></span> <span class="hljs-string"><span class="hljs-string">'2'</span></span> <span class="hljs-symbol"><span class="hljs-symbol">services:</span></span> ... <span class="hljs-symbol"><span class="hljs-symbol">server_storm:</span></span> <span class="hljs-symbol"><span class="hljs-symbol">domainname:</span></span> story-line.ru <span class="hljs-symbol"><span class="hljs-symbol">hostname:</span></span> server_storm <span class="hljs-symbol"><span class="hljs-symbol">build:</span></span> ./server_storm <span class="hljs-symbol"><span class="hljs-symbol">depends_on:</span></span> - zookeeper - elasticsearch - mongodb <span class="hljs-symbol"><span class="hljs-symbol">links:</span></span> - zookeeper - elasticsearch - mongodb <span class="hljs-symbol"><span class="hljs-symbol">ports:</span></span> - <span class="hljs-string"><span class="hljs-string">"${server_storm_ui_host_port}:8082"</span></span> - <span class="hljs-string"><span class="hljs-string">"${server_storm_logviewer_host_port}:8083"</span></span> - <span class="hljs-string"><span class="hljs-string">"${server_storm_nimbus_host_port}:6627"</span></span> - <span class="hljs-string"><span class="hljs-string">"${server_storm_monit_host_port}:3000"</span></span> - <span class="hljs-string"><span class="hljs-string">"${server_storm_drpc_host_port}:3772"</span></span> <span class="hljs-symbol"><span class="hljs-symbol">volumes:</span></span> - ${logs_dir}<span class="hljs-symbol"><span class="hljs-symbol">:/data/logs</span></span> - ${data_dir}<span class="hljs-symbol"><span class="hljs-symbol">:/data/db</span></span> ....</code> </pre><br>  And we use it in the project: <br><pre> <code class="hljs pgsql">//       task copyTemplates (<span class="hljs-keyword"><span class="hljs-keyword">type</span></span>: <span class="hljs-keyword"><span class="hljs-keyword">Copy</span></span>, dependsOn: [<span class="hljs-string"><span class="hljs-string">'createStandDir'</span></span>]){ description "  " <span class="hljs-keyword"><span class="hljs-keyword">from</span></span> "${projectDir}/deployment/docker_templates" <span class="hljs-keyword"><span class="hljs-keyword">into</span></span> project.ext.stand.deploy_dir expand(project.ext.stand) filteringCharset = <span class="hljs-string"><span class="hljs-string">'UTF-8'</span></span> }</code> </pre> <br>  As a result, you get a configuration file whose data is filled with variable values ‚Äã‚Äãthat received values ‚Äã‚Äãduring the script operation. However, it should be noted that if you need more complex logic with variables (for example, hiding if there are no values), you will need another template engine in the assembly system.  I bypassed this situation using the YAML format in the course of the project. <br><br></li><li>  Using groovy lists and closures for specific processing of specific modules <br><br>  This is actually the usual use of groovy in the build script, but it helped me solve a couple of non-trivial tasks. <br><br>  We declare or get multiple value variables: <br><pre> <code class="hljs python">ext { // ,  docke<span class="hljs-string"><span class="hljs-string">r' docker_machines = ['</span></span>elasticsearch<span class="hljs-string"><span class="hljs-string">', '</span></span>zookeepe<span class="hljs-string"><span class="hljs-string">r', '</span></span>mongod<span class="hljs-string"><span class="hljs-string">b', '</span></span>crawle<span class="hljs-string"><span class="hljs-string">r', '</span></span>server_storm<span class="hljs-string"><span class="hljs-string">', '</span></span>server_we<span class="hljs-string"><span class="hljs-string">b'] // ,  docker'</span></span>      docker_machines_w_artifacts = [<span class="hljs-string"><span class="hljs-string">'crawler'</span></span>, <span class="hljs-string"><span class="hljs-string">'server_storm'</span></span>, <span class="hljs-string"><span class="hljs-string">'server_web'</span></span>] }</code> </pre><br>  And we use them in the project: <br><pre> <code class="hljs haskell">//     docker    docker_machines.each { machine -&gt; task <span class="hljs-string"><span class="hljs-string">"copyProvisionScripts_${machine}"</span></span> (<span class="hljs-class"><span class="hljs-keyword"><span class="hljs-class"><span class="hljs-keyword">type</span></span></span><span class="hljs-class">: </span><span class="hljs-type"><span class="hljs-class"><span class="hljs-type">Copy</span></span></span><span class="hljs-class">, dependsOn: ['createStandDir']){ ... } }</span></span></code> </pre><br></li><li>  Integration with maven repositories is a painfully cumbersome description for inclusion in the article (and the work itself is quite useless given the presence of examples in the documentation) <br><br></li><li>  Possibility of the task of dependency blocks for modules, copying and pasting of which is absent for each module <br><br>  We declare blocks: <br><pre> <code class="hljs perl">def javaTestLibrary(project) { project.dependencies { testCompile <span class="hljs-string"><span class="hljs-string">"org.apache.commons:commons-lang3:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${COMMONS_LANG_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"commons-io:commons-io:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${COMMONS_IO_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"junit:junit:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${TEST_JUNIT_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.mockito:mockito-core:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${TEST_MOCKITO_VER}</span></span></span><span class="hljs-string">"</span></span> testCompile <span class="hljs-string"><span class="hljs-string">"org.assertj:assertj-core:</span><span class="hljs-subst"><span class="hljs-string"><span class="hljs-subst">${TEST_ASSERTJ_VER}</span></span></span><span class="hljs-string">"</span></span> } }</code> </pre><br>  And we use them in the project: <br><pre> <code class="hljs erlang"><span class="hljs-function"><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">project</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(':token')</span></span></span><span class="hljs-function"> { </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">javaProject</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(it)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">javaLogLibrary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(it)</span></span></span><span class="hljs-function"> </span><span class="hljs-title"><span class="hljs-function"><span class="hljs-title">javaTestLibrary</span></span></span><span class="hljs-params"><span class="hljs-function"><span class="hljs-params">(it)</span></span></span><span class="hljs-function"> }</span></span></code> </pre></li></ul><br>  Running all this rich functionality from the console with one command, which identifies the base fragments of the project, updates the necessary dependencies, performs the necessary checks and generates the required artifacts, let us speak of assembly systems as tools that, if properly configured, can radically change the speed of delivery of your project to the finished consumers. <br><br>  Thanks for attention! </div><p>Source: <a href="https://habr.com/ru/post/334592/">https://habr.com/ru/post/334592/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../334582/index.html">Roslyn analyzers: habits and habitats</a></li>
<li><a href="../334584/index.html">Interplanetary File System - Switch your site to localhost (local IPFS gateway)</a></li>
<li><a href="../334586/index.html">Microservices and Actor Model</a></li>
<li><a href="../334588/index.html">Comprehensive online marketing guide. Day 67. Retargeting and what it is eaten with.</a></li>
<li><a href="../334590/index.html">How to refactor 2 500 000 lines of code and not go crazy</a></li>
<li><a href="../334594/index.html">‚ÄúBad advice‚Äù: How to lose a customer or the 7 best farewell phrases</a></li>
<li><a href="../334596/index.html">ZFS is the best file system (yet)</a></li>
<li><a href="../334598/index.html">Features of migration from RISC to x86 in Russia: now we are kept by the old banking software of the DOS and Netware times</a></li>
<li><a href="../334604/index.html">Hack Sleep. Repeat</a></li>
<li><a href="../334608/index.html">In the second quarter, a 40% increase in the number of attacked devices was recorded.</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>