<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>ONLYOFFICE. Naked Truth About Cloud Office Source Code</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="In early July, Teamlab was renamed ONLYOFFICE and fully opened the source code of its application, including online document editors, collaborative ed...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>ONLYOFFICE. Naked Truth About Cloud Office Source Code</h1><div class="post__text post__text-html js-mediator-article"><img src="https://habrastorage.org/files/c01/8df/90e/c018df90e4e94472a6bf29ca0842680e.png"><br>  In early July, Teamlab was <a href="http://www.onlyoffice.com/blog/2014/07/teamlab-birthday-2/%3Flang%3Dru">renamed</a> ONLYOFFICE and fully opened the source code of its application, including online document editors, collaborative editing, Gantt chart and billing functionality. <br>  In two weeks we received a lot of questions on this topic, therefore, as an employee of the company, I will undertake to explain what is what.  If you do not have time to read the post, simply <a href="http://sourceforge.net/projects/teamlab/files/ONLYOFFICE%25207.7/">download the</a> ONLYOFFICE installation from Sourceforge.  Deploy on your server.  Done!  You have your own cloud office.  You are wonderful. <br><a name="habracut"></a><br><h4>  <b>Why Teamlab became ONLYOFFICE</b> </h4>  The idea of ‚Äã‚Äãrebranding existed for a long time.  In our blog, we wrote a whole <a href="http://www.onlyoffice.com/blog/2014/07/new_brand/%3Flang%3Dru">post</a> about why we chose ONLY as a new set-top box for our office, however, there were very specific reasons.  First, the name Teamlab has ceased to reflect the idea of ‚Äã‚Äãa product, because the ‚Äúteam‚Äù is associated with a small team, while among our customers there are more and more companies with 300 and 400 people.  Secondly, besides us, unfortunately, this word was chosen by designers of interactive hangers from Japan. <br><br><h4>  <b>Why we opened the source code (Honesty is the best policy because)</b> </h4>  The main reason is, of course, trust.  Not only from clients, but also from our <a href="https://partners.onlyoffice.com/ru">partners</a> .  In today's situation, we get quite a lot of questions about the security of corporate data storage, especially from foreign customers.  By publishing the ONLYOFFICE code on <a href="http://sourceforge.net/projects/teamlab/files/ONLYOFFICE%25207.7/">Sourceforge</a> and <a href="https://github.com/search%3Fq%3Donlyoffice">GitHub</a> , we take another step towards them. <br><br><h4>  <b>License selection</b> </h4>  Publishing the source codes of our product, we pursued several goals: <br><ul><li>  Attract the attention of the opensource community. </li><li>  Secure the authorship of the product. </li><li>  Strengthen the confidence of foreign customers and partners. </li></ul><br>  After weighing all the pros and cons, we chose <b>AGPL v3</b> .  In a nutshell, it means the following: you can use ONLYOFFICE in your company for free and without restrictions, but if you want to embed our code in your own application, you will have to open the source codes of your product under the same license.  Read more <a href="http://www.onlyoffice.com/ru/license-faq.aspx">here</a> . 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  <b>What our programmers say</b> </h4>  Go to the most interesting part of our post.  The Open Source version of ONLYOFFICE has been preparing for release for quite a while - the text editor alone contains over 500,000 lines of code!  Of course, we have something to talk about: <br><br><h5>  Special attention to Internet Explorer </h5><blockquote>  The basis of the rasterization algorithm is taken from freetype, as this is a high-quality, time-tested open font engine.  The algorithms themselves changed a bit so that the execution speed was higher exactly in the browser, since we write in javascript. <br><br>  But, for example, we had to write a cache of letters in two versions: for Internet Explorer and for all others.  Due to the specifics of the browser in IE, the first implementation was slow. </blockquote>  <i>Oleg, lead programmer</i> <br><br><h5>  What do you know about the width of columns in Excel? </h5><blockquote>  There are two main scenarios for using Excel: <br><ul><li>  financial calculations </li><li>  creating forms (invoices) for further filling and printing. </li></ul><br>  A large number of forms were created before the appearance of our table editor, so our task was not only to learn how to open them correctly, but also correctly calculate column widths and row heights.  Otherwise, when printing, the form might not get on the sheet. <br>  For example, the standard column width in Microsoft Excel is 8.43 characters.  It is calculated from the default width of 8 characters, which is converted to pixels depending on the Normal style.  Then, as it turned out, the resulting number is rounded to the nearest multiple of 8. <br>  Another feature is the height of the line.  In Excel, you cannot set the line spacing, as, for example, in Word, so the calculation of the height of a line in Excel is different from the calculation of the height of a line in Word.  For example, the comparison in the Cambria Math 11 font: <br><img src="https://habrastorage.org/files/c69/267/71f/c6926771f1184028a53914adea94810c.jpg"><br>  As a result, we implemented the calculation so that not a single character was cut off. </blockquote>  <i>Alexander, leading programmer</i> <br><br><h5>  How we linked a dependency tree and topological sorting </h5><blockquote>  Most of the spreadsheets one way or another contains the formula.  To solve the problems of parsing and counting formulas, a parser and a calculator were implemented.  Also in the work with formulas, the construction of dependencies between cells deserves special attention.  For this purpose, a <a href="http://ru.wikipedia.org/wiki/%25D0%25A2%25D0%25BE%25D0%25BF%25D0%25BE%25D0%25BB%25D0%25BE%25D0%25B3%25D0%25B8%25D1%2587%25D0%25B5%25D1%2581%25D0%25BA%25D0%25B0%25D1%258F_%25D1%2581%25D0%25BE%25D1%2580%25D1%2582%25D0%25B8%25D1%2580%25D0%25BE%25D0%25B2%25D0%25BA%25D0%25B0">topological sorting</a> algorithm was used, which allows building a dependency tree traversal order. </blockquote>  <i>Dmitry, programmer</i> <br><br><h5>  Fifteen thousand tests and 80 cars </h5><blockquote>  To test the ONLYOFFICE installation, we deployed it and started the familiar process.  In total, about 15,000 tests ran, which run on 80 machines.  By the way, we host them now on the Digital Ocean and in the near future we will tell how the entire test structure was transferred there. </blockquote>  <i>Stas, Head of Testing</i> <br><br><h5>  Hopes &amp; Fears </h5><blockquote>  Are we afraid of someone borrowing our code for personal gain?  Not.  The use of the ONLYOFFICE code is clearly stated in the license, and here we are protected by international law. <br>  Do we think that someone will ‚Äúwatch‚Äù and make a similar product?  Of course, we think.  But the guys will take at least 3 years to do this, so we don‚Äôt really worry too much.  However, we have long been accustomed to be and survive in a highly competitive environment. </blockquote>  <i>Alexandra, head of the promotion department</i> <br><br><h5>  What do you need to build your editor on the canvas? </h5><blockquote>  Any text editor begins with splitting the text into lines and rendering.  The first working version consisted of 150 lines of code and was implemented as follows: </blockquote><br><pre><code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ParaText function ParaText(value) { this.Value = value; this.Type = para_Text; this.Width = 0; this.Height = 0; } ParaText.prototype.Draw = function(X, Y, Context); ParaText.prototype.Measure = function(Context);</span></span></code> </pre> <br><div class="spoiler">  <b class="spoiler_title">140 more lines of code</b> <div class="spoiler_text"><pre> <code class="javascript hljs"><span class="hljs-comment"><span class="hljs-comment">//  ParaSpace function ParaSpace() { this.Type = para_Space; this.Width = 0; this.Height = 0; } ParaSpace.prototype.Draw = function(X,Y, Context); ParaSpace.prototype.Measure = function(Context); //  ParaNewLineRendered function ParaNewLineRendered() { this.Type = para_NewLineRendered; this.Width = 0; this.Height = 0; } ParaNewLineRendered.prototype.Draw = function(); ParaNewLineRendered.prototype.Measure = function(); //  Paragraph function CParagraph() { //................... //   this.X = 0; this.Y = 0; //   this.XLimit = 0; //  ,     ParaText, ParaSpace  ParaNewLineRendered this.Content = new Array(); //  .          this.dLineHeight = 0; //................... } CParagraph.prototype.Recalculate = function() { //    .      ParaNewLineRendered //.............................. //     var X = this.X, Y = this.Y; //   var CurLine = 0; var bNewLine = false; var bFirstItemOnLine = true; var bWord = false; var nWordStartPos = 0; var dWordLen = 0; for ( var nPos = 0; nPos &lt; this.Content.length; nPos++ ) { var Item = this.Content[nPos]; switch( Item.Type ) { case para_Text: { var dLetterLen = Item.Measure( Context ).Width; if ( !bWord ) { //    ,        ,         . if ( !bFirstItemOnLine ) { if ( X + dLetterLen &gt; this.XLimit ) { //          -    this.Content.splice( nPos, 0, new ParaNewLineRendered() ); bNewLine = true; } } if ( !bNewLine ) { nWordStartPos = nPos; dWordLen = dLetterLen; bWord = true; } } else { if ( X + dWordLen + dLetterLen &gt; this.XLimit ) { if ( bFirstItemOnLine ) { //         //   .      . X += dWordLen; this.Content.splice( nPos, 0, new ParaNewLineRendered() ); bNewLine = true; } else { //           this.Content.splice( nWordStartPos, 0, new ParaNewLineRendered() ); nPos = nWordStartPos; bNewLine = true; } } if ( !bNewLine ) { dWordLen += dLetterLen; } } break; } case para_Space: { bFirstItemOnLine = false; var dSpaceLen = Item.Measure( Canvas ).Width; if ( bWord ) { //   ,    -       X += dWordLen; bWord = false; dWordLen = 0; } if ( X + dSpaceLen &gt; this.XLimit ) { bNewLine = true; } else X += dSpaceLen; break; } } //     if ( bNewLine ) { bNewLine = false; bFirstItemOnLine = true; bWord = false; dWordLen = 0; //      ,         X = this.X; Y += this.dLineHeight; CurLine++; } } } CParagraph.prototype.Draw = function(Context) { var Y = this.Y; var X = this.X; var nCount = this.Content.length; for ( var nPos = 0; nPos &lt; nCount; nPos++ ) { var Item = this.Content[nPos]; Item.Draw( X, Y, Context ); X += Item.Width; if ( para_NewLineRendered == Item.Type ) { Y += this.dLineHeight; X = this.X; } } }</span></span></code> </pre><br></div></div><br>  <i>Ilya, leading programmer</i> <br><br>  Two weeks after the start of development, the first test case was ready: <br><img src="https://habrastorage.org/files/c42/8fa/33f/c428fa33f84148ec81edaf9b63900697.png"><br><br>  Download and test an example <a href="">here</a> . <br>  There is nothing more pleasant than comparing it with what we have achieved in a few years.  <s>And so, at what stage are the editors of competitors.</s> <br><img src="https://habrastorage.org/files/4fd/cfb/0b9/4fdcfb0b9efd496798f0b442b1bb3166.png"><br><br>  You can test all editors without registering on <a href="http://personal.teamlab.com/">personal.teamlab.com</a> .  By the way, they generally can be actively used - it is free. <br><br><h4>  <b>Our goal?</b>  <b>ONLYOFFICE users worldwide</b> </h4>  We really have a lot of plans.  Already, we are actively working on mobile and desktop applications, in addition to this, office editors 3.0 will be released by the fall, and we are also thinking about committing development on <a href="https://github.com/ONLYOFFICE/ONLYOFFICE-OnlineEditors">GitHub</a> in real time. <br><br>  It seems everything.  We move discussion in the comment) </div><p>Source: <a href="https://habr.com/ru/post/231747/">https://habr.com/ru/post/231747/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../231735/index.html">Connecting the display of the DVD player to the microcontroller</a></li>
<li><a href="../231739/index.html">Classes in Swift [Part 1]</a></li>
<li><a href="../231741/index.html">Microsoft case: how to avoid contradictions by working with personal data in Europe and the USA?</a></li>
<li><a href="../231743/index.html">3D printer without a computer</a></li>
<li><a href="../231745/index.html">Highly loaded sites and applications in PHP / Symfony</a></li>
<li><a href="../231749/index.html">Huawei Ascend P7: tested in humans</a></li>
<li><a href="../231751/index.html">The life of the data center after commissioning</a></li>
<li><a href="../231755/index.html">The program and course materials "Multicore programming in Java"</a></li>
<li><a href="../231757/index.html">General Structured Data Editor</a></li>
<li><a href="../231763/index.html">Experiment on probability theory in life</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>