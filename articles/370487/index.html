<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Most budget video surveillance in the country</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Hi, Geektimes! I want to share my experience in organizing a very low-cost video surveillance at a country house with 3G with the ability to view onli...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>Most budget video surveillance in the country</h1><div class="post__text post__text-html js-mediator-article">  Hi, Geektimes!  I want to share my experience in organizing a very low-cost video surveillance at a country house with 3G with the ability to view online and save the archive. <br><a name="habracut"></a><br>  Since I had never come across video surveillance before, I decided to start with a simple one - buy only one 2M camera and then test and see what happens. <br><br>  I read reviews in the internet, my choice fell on <a href="https://www.aliexpress.com/item/Newest-Security-Camera-CCTV-3PCS-Array-LED-Waterproof-Outdoor-Surveillance-IP-Camera-FULL-HD-1080P-2MP/32610214250.html%3Fspm%3D2114.13010608.0.0.uoyhyi">this</a> copy of the Chinese production.  The device broadcasts over rtsp 1920 * 1080 with compression h264 main stream and 540 * 340 second stream. <br><br><div style="text-align:center;"><img src="https://habrastorage.org/getpro/geektimes/post_images/051/177/7d4/0511777d4d9fb00f20fb7a9b1046288e.jpg" alt="image"></div><br>  Buying a device, I assumed that I would find a program for recording video from a camera without any problems even though under Windows, even under Linux.  In life, everything was much more complicated. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      I had a computer with Intel Pentium D (2 core), 1 GB RAM, built-in vidyuha, 250 GB hard.  At the time of receiving the camera, lived on this old PC windows XP x86. <br><br>  There is also an MTS whistle (at the dacha catches 3G), there is a hosting with a VDS server.  It is clear that there is no need to talk about high-quality video surveillance with this kind of luggage, but you have to start with something. <br><br>  So, I started home tests.  The first thing that came to mind was to try the well-known service <a href="https://ru.ivideon.com/">ivideon</a> .  Quickly register, put the soft, one-two-three everything is ready, convenient and simple.  It is a pity that such a service imposes significant restrictions on free use, in principle, you can live, but not conveniently.  The most sadness is the huge amount of data transmitted by outgoing uplink, for 3G it's a bit too much, you need a good Internet, but it is not and will not be. <br><br>  <b><a href="https://zoneminder.com/">ZoneMinder</a></b> <br><br>  Once upon a time, they put this software at work, the impression is very good, many settings work well. <br><br>  Unfortunately, it didn‚Äôt come to the installation of this software, since, according to people familiar with the situation, the service is very demanding of resources and on my old computer simply couldn‚Äôt take off, and I didn‚Äôt want to reinstall Windows.  Left in case of emergency, if I find nothing suitable. <br><br>  <b><a href="http://www.itv.ru/products/axxon_next/">Axxon next</a></b> <br><br>  Apparently harsh software for harsh companies.  In the free version up to 4 cameras and more, no restrictions.  In the test mode, the entire functionality with all cameras, writes only from 8-00 to 20-00 (or what it is). <br><br>  To be honest, the usability of the program is very inconvenient, but yes figs with it, we will get used to it.  Faced problems: Writes video in one archive in its own format - the video cannot be accessed just like that, it does not work on a PDA (opengl&gt; 1.4 is required).  The last 4th version does not work in HP wines, the 3rd one works, but, damn it only from the console, it will not work on the RDP. <br><br>  <b><a href="http://felenasoft.com/ru/">Xeoma</a></b> <br><br>  Softina installed on the old hardware, earned. <br><br><img src="https://habrastorage.org/getpro/geektimes/post_images/542/19f/531/54219f531b0ba5f105d671e612e24419.jpg" alt="image"><br><br>  In general, the software is not very convenient, but you can get used to it, it's a matter of time. <br><br>  From the "constructor" you can collect different schemes, logic, add some handlers, actions when an event occurs.  But all this makes no sense in the free version, where only 3 modules are available (in the paid cheapest version of these modules already 6).  One of them is a camera, one entry in the archive.  You can fasten the motion detector, but unfortunately this is not my case - the iron will not pull out, it will not be viewed online (more on this later - it was decided to issue a static image upon request, rather than drive all traffic to the Internet). <br><br>  The opportunity to edit the frame rate on the screen was also useful for me.  Since the rdp + 3g uplink is not fast, the output of the real image simply puts on the dull channel.  In the software I set the output to 1 frame per minute, you can set another one more often / rarely <br><br>  <b>FFMPEG</b> <br><br>  The latest working version of ffmpeg for Windows XP is <a href="https://sourceforge.net/projects/ffmpegwindowsbi/files/">here</a> . <br><br>  In general, it is very nice when the process is fully controlled, but you need to write a lot of things yourself.  Reconnection, rotation, check for freezing and so on.  I didn't really want to write myself.  But the command, who can use it to capture a stream and write to a file: <br><br><pre><code class="hljs tex">D:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ffmpeg</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">ffmpeg</span></span></span></span> -i rtsp://192.168.1.10:554/user=admin_password=tlJwpbo6_channel=1_stream=0.sdp?real_stream -reset_timestamps 1 -vcodec copy -acodec copy -y -f segment -segment_time 60 -segment_format mp4 "d:<span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">Xeoma</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">video</span></span></span></span><span class="hljs-tag"><span class="hljs-tag">\</span><span class="hljs-name"><span class="hljs-tag"><span class="hljs-name">vid</span></span></span></span>-<span class="hljs-comment"><span class="hljs-comment">%%05d.mp4"</span></span></code> </pre> <br>  Sadness melancholy with software gentlemen.  Sadness ... <br><br>  But let's go back to the scheme of including all this disgrace and see what the principle we want and what can we do? <br><br>  We have: 3g whistle.  In fact, all mobile operators for a long time no longer provide dynamic IPs for whistles, but give gray addresses and pull.  To get through the Internet on a computer with 3G is possible only through VPN. <br><br>  But we want to do everything cheaper.  Which tariff to choose?  Which operator to choose (catches 3G at my dacha with all operators - lucky)?  There is no desire to pay for 600 rubles per month for the whistle.  I looked at the tariffs of all operators - about all the same. <br><br>  The solution was simple.  It turns out that my MTS has a ‚ÄúShare an Internet‚Äù option or something like that.  The point is that you pay 100 rubles per month and share your Internet on the tariff with a different number.  This is the path I took. <br><br>  Setting up a vpn server on debian is <a href="https://www.ylsoftware.com/news/407">very easy</a> . <br><br>  In the BIOS of the company, we set up auto power-up when power returns, tune the MTS connection via standard means (like a dial-up modem with a call to * 99 #) and set up raising vpn after raising the MTS connection.  READY!  There is a connection, VPN holds.  You can work. <br><br>  To administer the server, it is enough to connect through the sss server tunnel to port 3389 (rdp) and there is no need to set 3389 from the WinHP to the outside with port forwarding through the hosting. <br><br>  Since it was decided that we will not upload the entire archive, the question remains - how to organize online viewing. <br><br>  I did this: <br><br>  On the computer with the Windows set the recording of the main stream continuously, and an additional I rake every 30 seconds.  This is done in order to quickly find a sample time of interest, and then slowly and slowly pull video files on 3G.  Apache installed on the server, php set it on the directory with the video photo and turned on the option to index the contents of the directory. <br>  On the hosting receiver (where we connect on vpn) we configure port forwarding: <br><br><pre> <code class="hljs pgsql">ProxyPreserveHost <span class="hljs-keyword"><span class="hljs-keyword">On</span></span> #ProxyRequests <span class="hljs-keyword"><span class="hljs-keyword">Off</span></span> ProxyPass / http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span>/ ProxyPassReverse / http://<span class="hljs-number"><span class="hljs-number">192.168</span></span><span class="hljs-number"><span class="hljs-number">.1</span></span><span class="hljs-number"><span class="hljs-number">.30</span></span>/</code> </pre> <br>  Where <a href="http://192.168.1.30/">192.168.1.30</a> is the address we received from pptpd. <br><br>  To display files from a stream, I chose the following concept: <br><br>  Online we will miss one frame with additional stream in quality below 2MP.  To view the picture in high definition, we can rotate the main stream files once a minute (later it will also be easier to download files) and we will capture the frame from the last completed video.  Thus, the maximum lag of HD pictures will be 2 minutes, which is normal. <br><br>  To get snapshots from a video file, use the following php code: <br><br><pre> <code class="hljs nginx"><span class="hljs-attribute"><span class="hljs-attribute">shell_exec</span></span> (<span class="hljs-string"><span class="hljs-string">"D:\scripts\convert.cmd </span><span class="hljs-variable"><span class="hljs-string"><span class="hljs-variable">$file</span></span></span><span class="hljs-string">"</span></span>);</code> </pre> <br>  Well, the process of getting snapshots: <br><br><pre> <code class="hljs css"><span class="hljs-selector-tag"><span class="hljs-selector-tag">D</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">ffmpeg</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">ffmpeg</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-y</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-loglevel</span></span> 0 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-i</span></span> %1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-ss</span></span> 00<span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:00</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:1.1</span></span> <span class="hljs-selector-tag"><span class="hljs-selector-tag">-r</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">-vframes</span></span> 1 <span class="hljs-selector-tag"><span class="hljs-selector-tag">D</span></span>:\<span class="hljs-selector-tag"><span class="hljs-selector-tag">Xeoma</span></span>\<span class="hljs-selector-tag"><span class="hljs-selector-tag">last</span></span><span class="hljs-selector-class"><span class="hljs-selector-class">.jpeg</span></span></code> </pre><br>  Total cost: <br><br>  - Camera 2500 <br>  - Inet 100r / month <br>  - Consumption of electricity by the computer 24/7 = 100W * 24 * 30 * 4p / kWh = 288p / month <br>  - Old comp (was available) = 3000r <br>  - VDS Hosting with the ability to receive vp (was) = ‚Äã‚Äã2400 / year <br>  Probably not cheaper :) <br><br>  I hope this article will be useful to anyone. </div><p>Source: <a href="https://habr.com/ru/post/370487/">https://habr.com/ru/post/370487/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../370475/index.html">Session warm lamp "magic" exposing</a></li>
<li><a href="../370479/index.html">Wires are good, but better without them. Wireless charges are coming</a></li>
<li><a href="../370481/index.html">Most particles disintegrate - but why?</a></li>
<li><a href="../370483/index.html">"How rock and roll sounded": the story of the brand Marshall</a></li>
<li><a href="../370485/index.html">How to send Push notifications from the smart home controller</a></li>
<li><a href="../370489/index.html">Roaming Abroad: How Do Prices for Mobile Internet Different in Europe?</a></li>
<li><a href="../370491/index.html">DJI Spark - quadrocopter spark placed in the palm</a></li>
<li><a href="../370493/index.html">Most particles disintegrate, and some do not.</a></li>
<li><a href="../370495/index.html">Scientists have identified 52 genes associated with intelligence</a></li>
<li><a href="../370497/index.html">Telekino</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>