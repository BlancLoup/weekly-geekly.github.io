<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>A simple version of the backup system in Python, Bash and Git</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="Recently, there is some discomfort when I start work. The feeling was not so strong, but the concentration hindered. I thought laziness. It turned out...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>A simple version of the backup system in Python, Bash and Git</h1><div class="post__text post__text-html js-mediator-article">  Recently, there is some discomfort when I start work.  The feeling was not so strong, but the concentration hindered.  I thought laziness.  It turned out that everything is a little more difficult :) The laptop I work for is almost 3 years old;  Mac OS X 10.6.1 is on it, but there are no apples on it anywhere, and there is no periodic backup system on it as a class.  In general, there was no sense of stability and reliability, so I took up this issue closely.  Actually, then I will describe the result that my subconscious mind satisfied :) Maybe something will be useful to someone. <br><br><a name="habracut"></a><br><h3>  Task </h3><br><h4>  What we backup </h4><br><ul><li>  Catalogs with various sources.  Some projects are Git-repositories, respectively, I want to save the repository, and not just the latest version of the source code.  NB: I was somehow not used to run make clean or analogs at the end of the day, so we add the requirement that binaries are not copied. </li><li>  Catalogs with configs and parameters. </li><li>  Directories with TeX sources.  In fact, one could add to the first paragraph. </li></ul><br>  Of course, I sometimes have photos that I would like to keep, and other binaries, but we will not touch on the issue of backup, because I don‚Äôt have a safe place to stuff more than 10 GB with scripts, and more often than once per month they do not change normally. <br><br><h4>  Where to backup </h4><br><ul><li>  Actually, file storage.  A free <a href="http://www.getdropbox.com/">Dropbox</a> account was chosen, because copying with the cp command is easy and convenient. </li><li>  Mail to Gmail.  All the same, 7 gigs are not used, and there has been no reason to doubt the reliability yet. </li></ul><br>  Perhaps in the near future, this list will expand, but for now, as it seems to me, this is more or less sufficient. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <h4>  What are the features </h4><br><ul><li>  <b>Simplicity.</b>  The main feature :) No need for complex and large programs, I myself am able to decide which files from where I need to copy.  It is easier to be confident in the correctness of the work of a small program. </li><li>  <b>History of changes.</b>  The first feature you want is a change history, so as not to swear on the topic ‚Äúwhat this file prevented me from!‚Äù </li><li>  <b>Compression.</b>  Git, of course, presses, but because  it is still more convenient to store backups in one file, so let someone else do it. </li><li>  <b>Encryption</b> I do not doubt the honesty and sekyurnosti Internet providers and storage providers.  However, I don‚Äôt want that what I do is transmitted and it is not clear where in open form. </li></ul><br><br><h3>  Decision </h3><br>  By my requests, Google did not give anything worthwhile and satisfying to my requests, so I had to write it myself.  At the same time I touched Python, I‚Äôve been looking for a suitable occasion for a long time. <br><br><h4>  Copying </h4><br>  The option "copy all" does not work due to lack of space.  In addition, it somehow seems silly to keep a bunch of backup copies of unnecessary files (object logs, build logs, etc.).  In the end, so to speak, the terms of reference were as follows: <br><ul><li>  The list of directories and files to copy is stored in a separate file. </li><li>  For each directory, you can specify the file masks that you want to copy from it.  If the mask is not specified, copy all. </li><li>  The original directory structure is maintained. </li><li>  The script copies (and only copies) files into the specified folder. </li><li>  If the file already exists in the target folder, copy only if the modification time of the source file is longer. </li></ul><br><br>  The copy script is written in Python and takes slightly less than 200 lines (including indents, comments, etc.).  Additionally, it uses one fuzzy module to convert absolute paths into relative paths and vice versa. <br>  Using: <br><pre>  sn-backup.py &lt;file with list&gt; &lt;base directory&gt; &lt;backup directory&gt; </pre><br>  Limitations: <br><ol><li>  Strict file format with a list.  Line format: <br><pre>  &lt;path relative to base directory&gt; [\ t &lt;masks separated by commas&gt;] </pre><br>  More than one tab is not allowed.  Masks are separated by commas without spaces. </li><li>  Virtually no fool protection. </li></ol><br><br>  Example list (with base directory ~): <br><pre> .emacs
 Documents / Programming * .c, *. H, *. Cpp, *. Pro, *. Py, .git
 Scripts
</pre><br><br>  Source codes (probably, it is more convenient when they lie on file hosting than when those same 200 lines litter the text): <br>  <b><a href="http://dl.dropbox.com/u/233593/sn-backup.py">sn-backup.py</a></b> ( <a href="http://dumpz.org/14127/">look at dumpz.org</a> ) <br>  <b><a href="http://dl.dropbox.com/u/233593/relpath.py">relpath.py</a></b> ( <a href="http://dumpz.org/14128/">view on dumpz.org</a> ) <br><br>  relpath.py was taken <a href="http://code.activestate.com/recipes/208993/">from here</a> , from the first comment, and slightly corrected. <br><br><h4>  Compression and encryption </h4><br>  Compression and encryption require one line at a time, so it would be somehow strange to write them in Python.  How to compress - a matter of taste.  I prefer 7-zip.  The command line here, accordingly, will be simple (the archive name is backup.7z, the folder name is .backup): <br><pre>  7za a -mx7 backup.7z .backup </pre><br>  I chose openssl for encryption, since, in theory, almost everywhere is and works out of the box, without the need to generate anything.  The command looks like this: <br><pre>  openssl enc -aes-256-cbc -salt -in backup.7z -out backup.aes256cbc -pass file: &lt;pass path&gt; </pre><br>  Accordingly, the name of the source file backup.7z, the name of the output file backup.aes256cbc (in case I suddenly forget what the encryption algorithm is called).  The password is stored in a file and can be of any length.  Better, though, at least 32 characters. <br><br><h4>  Sending </h4><br>  Due to the potential variety of methods, I first wanted to send it through a highly customizable Python script, but then I decided that copying to a small number of hosts is much easier manually, and copying to a large number of hosts smacks of paranoia.  Therefore, sending is implemented in the sh-script.  The Copybox command on Dropbox, when the client is installed, is of no interest, so consider only the command to send to the mail (it is even less common): <br><pre>  uuencode &lt;path to encrypted archive&gt; $ (basename &lt;path to encrypted archive&gt;) |  mail -s "[BACKUP] $ (date)" &lt;address&gt; </pre><br>  Attention: for this command to work, you need to configure an SMTP server on your local machine.  My provider provides it. The team attaches an encrypted archive to a message with the subject ‚Äú[BACKUP] &lt;current date and time&gt;‚Äù and sends a message to &lt;address&gt;.  I have this command in the sn-upload.sh script, which takes the name of the encrypted archive file as the only argument. <br><br><h4>  Together </h4><br>  Everything is going together by the backup.sh script, which looks like this: <br> <code># ~/.backup - ,      . <br> #       .git-. <br> cd ~/.backup <br> <br> #     . <br> ~/Scripts/sn-backup.py ./list ~ . <br> <br> # ,    git. <br> git add . <br> git commit -m "Backup at $(date)" <br> <br> #    . <br> cd .. <br> 7za a -mx7 backup.7z .backup &gt; /dev/null <br> <br> # . <br> openssl enc -aes-256-cbc -salt -in backup.7z -out backup.aes256cbc -pass file:///${SECRET_PATH}/.password <br> <br> # . <br> ~/Scripts/sn-upload.sh ./backup.aes256cbc <br> <br> # ??? <br> rm backup.7z <br> # PROFIT! <br></code> <br><br><h3>  Directions for further development </h3><br>  At leisure, perhaps, I will make such improvements: <br><ol><li>  Translate all bash scripts to Python. </li><li>  It is possible to switch to pylzma and Python built-in cryptography (for cross-platform). </li><li>  Make the file format list softer and more decent. </li></ol><br><br><h3>  Conclusion </h3><br>  I do not exclude the possibility that I invented the bicycle.  But I didn‚Äôt spend much time on it, and got a little experience.  I want to note that above all in, ahem, the design of this system laid simplicity.  I know what files and from where I need to copy.  I know what to do with them then.  I need a script only to make it all on the machine.  In my opinion, he performs his tasks completely. <br><br>  Thank you for attention! <br></div><p>Source: <a href="https://habr.com/ru/post/74532/">https://habr.com/ru/post/74532/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../74527/index.html">What are waves and what are they for us</a></li>
<li><a href="../74528/index.html">FSUE Russian Post vs client (1: 0)</a></li>
<li><a href="../74529/index.html">Linux bugs and flaws</a></li>
<li><a href="../74530/index.html">Raindrop. What does Mozilla cook for us?</a></li>
<li><a href="../74531/index.html">Flex + Netbeans IDE on Linux</a></li>
<li><a href="../74534/index.html">Remote device access</a></li>
<li><a href="../74535/index.html">Beeline hidden withdraws money for visiting sites</a></li>
<li><a href="../74536/index.html">My version of the rules HabraWars</a></li>
<li><a href="../74537/index.html">DIY speakers</a></li>
<li><a href="../74538/index.html">Cap of happiness</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>