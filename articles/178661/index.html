<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>TP-Link TL-WR703N. Small but useful mod</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="The TP-Link TL-WR703N miniature router became the successor to the famous D-Link DIR-320 - you can find many designs based on this device, like robots...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>TP-Link TL-WR703N. Small but useful mod</h1><div class="post__text post__text-html js-mediator-article">  The TP-Link TL-WR703N miniature router became the successor to the famous D-Link DIR-320 - you can find many designs based on this device, like robots with a webcam and control via a web interface, Internet radio receivers, etc. d.  I ordered it for use for its intended purpose, but my hands still itched to make some change to the design - and the idea was born to embed a display into the case for displaying system information.  Under the cut - a little text and a lot of photos) <br><br><img src="https://habrastorage.org/storage2/390/649/742/3906497428509d1ca4ed5d2096effce2.jpg"><br><br><a name="habracut"></a><br>  We disassemble the router with the most suitable tool for this - an old credit card, remove the card. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
    <img src="https://habrastorage.org/storage2/d9c/ff6/2ec/d9cff62ec8518bea29dcc0866645a255.jpg"><br><br>  Next to the ethernet connector there is a free area, here we place the connector to which we will display the UART from the TP_IN and TP_OUT, +5 and +3.3 volts for the display, and the ground. <br><br><img src="https://habrastorage.org/storage2/b7f/060/606/b7f060606e904463bc87d612ebea6e5f.jpg"><br><br>  According to the <a href="http://squonk42.github.io/TL-WR703N/">scheme of the router is</a> easy to find where to power. <br><br><img src="https://habrastorage.org/storage2/af1/20a/fcc/af120afccc84843d622533eed1d301df.jpg"><br><br>  And the display itself, on Ebay, is searched for on the Nokia 5110 LCD Module. <br><br><img src="https://habrastorage.org/storage2/443/745/290/443745290b53e16fb2321e934b16cbfd.jpg"><br><br>  But even such a small display won't fit in just like that.  Part of the board along with two of the four LED backlights will have to be cut. <br><br><img src="https://habrastorage.org/storage2/bdb/523/8c7/bdb5238c7687d55afbb8edbbc62b7afe.jpg"><br><br>  Try on in the case ... <br><br><img src="https://habrastorage.org/storage2/3a2/388/f53/3a2388f53d25728bc83b495a1c47e0e1.jpg"><br><br>  ... and we cut out the window for the display in the lid, and at the same time we check its performance <br><br><img src="https://habrastorage.org/storage2/374/224/7bd/3742247bdc23507518a2f2151d828b3d.jpg"><br><br>  We will connect the display to the ATmega48p controller, and it will already read the characters from the UART router.  The schematic diagram does not see the point of view because of its extreme simplicity.  The port and pins to which the display is connected can be viewed in the lcd_nokia3310pin.h file from the archive at the end of the article.  The library itself is taken <a href="http://chipenable.ru/index.php/how-connection/item/22-podklyuchenie-lcd-ot-telefona-nokia3310.html">from here.</a> <br><br>  Printed circuit board. <br><br><img src="https://habrastorage.org/storage2/782/d4f/a98/782d4fa98406142181b1b742e15c5d94.png"><br><br>  We are flashing the controller ... <br><br><img src="https://habrastorage.org/storage2/c47/0d3/925/c470d3925f2c2b369170fcba3ce2623e.jpg"><br><br>  ... and solder the board on the reverse side of the display. <br><br><img src="https://habrastorage.org/storage2/731/2c7/35c/7312c735c112a11815321ba41990049d.jpg"><br><br>  We connect with the router.  Connector pins are bent - otherwise the display will not fit. <br><br><img src="https://habrastorage.org/storage2/a93/2f5/909/a932f590971bcbda82ea3f3ab3046a23.jpg"><br><br>  Everyone is here.  You can collect. <br>  The display is pressed against the usb-connector on the board with a cover, not very much, but it is enough that it is fixed. <br><br><img src="https://habrastorage.org/storage2/20a/fca/2b3/20afca2b3a74ecfd723a7153cc83c4b7.jpg"><br><br>  The display with the controller is understood by only three commands: <br>  <b>! s00Test ^</b> - display ‚ÄúTest‚Äù on the first line, starting with the first character; <br>  <b>! c</b> - clear the display; <br>  <b>! b</b> - turn on / off the backlight. <br>  The router is loaded for quite a long time, and until the first line arrives on the UART, the fake text progress bar is filled in on the display. <br><br><img src="https://habrastorage.org/storage2/da6/136/ea4/da6136ea4a33161beef2e1f7cacde745.jpg"><br><br>  The firmware of the router is, of course, <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr703n">OpenWRT</a> , although I had to use a slightly modified <a href="http://whirlpool.net.au/wiki/router_openwrt">build</a> , in which I managed to get a Huawei E3276 modem.  Add a new UMTS / GPRS / EV-DO connection (‚ÄúMTS‚Äù in my case) <br><br> <a href=""><img src="https://habrastorage.org/storage2/8d0/b6d/84a/8d0b6d84a536c91b6b517e5119f905eb.png"></a> <br><br>  And in the convenient directory we will create a script that will send the current time, uptime, the number of clients connected via Wi-Fi, traffic statistics of the connection created by us and load average to the serial port (/ dev / ATH0).  To set the port speed (9600 baud), you will need to install the <b>stty</b> package, because  At the standard speed of 115200, the controller did not want to receive any data. <br><div class="spoiler">  <b class="spoiler_title">script text</b> <div class="spoiler_text"><pre><code class="bash hljs"><span class="hljs-comment"><span class="hljs-comment">#!/bin/sh port="/dev/ttyATH0" speed="9600" stty -F /dev/ttyATH0 raw speed $speed -crtscts cs8 -parenb -cstopb lcdwrite() { echo "!s0${1}$2^" &gt; $port } while [ : ] do s=`date | tail -c 18 | head -c 12` lcdwrite 0 "$s" sleep 1 s=`uptime` s=`expr "$s" : '.*up.\(.*\), l'` lcdwrite 1 "uptime: $s" sleep 1 s=`iw dev wlan0 station dump | grep Station | wc -l` lcdwrite 2 "wifi cl: $s" sleep 1 s=`ifconfig 3g-mts` s=`expr "$s" : '.*(\(.*\)).'` lcdwrite 3 "DL: $s" sleep 1 s=`ifconfig 3g-mts` s=`expr "$s" : '.*(\(.*\))'` lcdwrite 4 "UP: $s" sleep 1 s=`uptime | tail -c 17 | head -c 10` lcdwrite 5 "LA: $s" sleep 1 done</span></span></code> </pre> </div></div><br>  Make the script executable and add to autoload in <b>System&gt; Startup&gt; Local Startup</b> , reboot the router and get the result shown in the first photo) <br><br>  Archive with firmware, PCB file and script - <a href="http://rghost.ru/45733310">rghost.ru/45733310</a> <br>  (Caution! The source code of the firmware can cause panic attacks, fear and various pains.) </div><p>Source: <a href="https://habr.com/ru/post/178661/">https://habr.com/ru/post/178661/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../178649/index.html">Usability: let your mom try</a></li>
<li><a href="../178651/index.html">About Unite Nordic and Motivation</a></li>
<li><a href="../178653/index.html">Do not write comments to the code!</a></li>
<li><a href="../178655/index.html">Bitcoin scene awaits major shocks</a></li>
<li><a href="../178657/index.html">Zero distortion wide angle lens modeled on insect eyes</a></li>
<li><a href="../178665/index.html">Manage database migrations with Liquibase</a></li>
<li><a href="../178667/index.html">Who is Brian Krzhanich, the new director of Intel?</a></li>
<li><a href="../178671/index.html">Acer introduced new hybrid devices on Windows and cheap Android-tablet</a></li>
<li><a href="../178673/index.html">How to deal with low-quality Android applications</a></li>
<li><a href="../178675/index.html">Postgraduate program Automotive Systems Design in the Netherlands</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>