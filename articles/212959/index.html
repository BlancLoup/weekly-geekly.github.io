<!doctype html>
<html class="no-js" lang="en">

<head>
  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-134931760-1"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'UA-134931760-1');
  </script>

  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>How we: hover on iOS won ...</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <meta name="description" content="It's not a secret for anyone, I think, that touch-devices handle mouse events a little differently, not the way it happens on desktop browsers ... 

 ...">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <link rel="stylesheet" href="../../css/main.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="../../js/vendors/jquery-3.3.1.min.js"><\/script>')</script>

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
       (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-6974184241884155",
            enable_page_level_ads: true
       });
  </script>
</head>

<body>
  <!--[if lte IE 9]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->
  <header class="page-header js-page-header">
    <a class="page-header-logo-container" href="https://weekly-geekly.github.io/index.html"></a>
    <div class="page-header-text">Geekly Articles each Day</div>
  </header>
  <nav class="page-headings-container js-page-headings-container"></nav>
  <div class="tools-bar js-tools-bar">
    <!-- <a href="../../search.html" title="Search">üîé</a> -->
    <a class="js-list-of-headings-button" data-state="closed" href="#" title="Headings">üìú</a>
    <a class="js-go-to-top-button" href="#" title="Go to Top">‚¨ÜÔ∏è</a>
    <a class="js-go-to-bottom-button" href="#" title="Go to Bottom">‚¨áÔ∏è</a>
  </div>
  <a href="http://bit.ly/donateToWeeklyGeekly" class="donate-btn">DONATE</a>
  <section class="page js-page"><h1>How we: hover on iOS won ...</h1><div class="post__text post__text-html js-mediator-article"> It's not a secret for anyone, I think, that touch-devices handle mouse events a little differently, not the way it happens on desktop browsers ... <br><br>  The most vivid example for me is the processing of a pseudo-class <code>:hover</code> .  For starters, iOS7, for example, will not respond to hover unless the element, or its parent, has clicked event handling.  This is clearly seen here in this example: <a href="http://jsfiddle.net/H8EmG/">jsfiddle.net/H8EmG</a> - you don‚Äôt see any underscores with your finger on the text.  In this example, <a href="http://jsfiddle.net/H8EmG/1/">jsfiddle.net/H8EmG/1</a> ‚Äúpoking‚Äù with your finger in the text will lead to its underlining.  An interesting fact - until we push another element, the text will sit under the hover ... <br><br>  Another interesting example is handling hovering elements: <a href="http://jsfiddle.net/ASRm9/1/">jsfiddle.net/ASRm9/1</a> Try clicking on the text.  First you will see the text "HOVER!", Which appeared inside the line, but the second click will call <code>alert('click')</code> .  This is because iOS understands that for <code>:hover</code> something is hidden, and tries not to break the behavior laid down by the author of the site. 
      <br>
        <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
        <ins class="adsbygoogle"
          style="display:block; text-align:center;"
          data-ad-layout="in-article"
          data-ad-format="fluid"
          data-ad-client="ca-pub-6974184241884155"
          data-ad-slot="8945601208"></ins>
        <script>
          (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
      <br>
      But once we encountered such a bug, which we could not explain until now, and its localization required more than one debugging day on the iPad ... Those who wanted details, as well as a tricky, I think, solution of probably all problems with: hover at once - I ask under the cat ... <br><br><a name="habracut"></a><br><br>  SUDDENLY, after the next update of the service, the developer of the ‚Äúplatform‚Äù of which I am, there was an unpleasant problem - on the iPad you cannot select a single line in almost all the ‚Äútables‚Äù that are on the service.  "Click" just does not work!  It should be noted that the "table" is not just lines and columns.  In our case, this is a fairly ‚Äúrich‚Äù UI element with note marks, sorting, grouping, filters, all sorts of ‚Äúladders‚Äù for printing and exporting to PDF and Excel ... <br><br>  After a long and tedious localization of the problem, we identified an isolated, simple piece of HTML + CSS that gave a similar result ... <br><br><ul><li>  HTML table, multiple rows, multiple columns </li><li>  In one of the columns there is a ‚Äúcheckbox‚Äù - a <code>div</code> that is hidden by default and is shown when you hover over the line.  Implemented through <code>:hover</code> </li><li>  Clicked on line </li><li>  The table is larger than its container. </li><li>  The container has a fixed size and has <code>overflow: scroll</code> enabled <code>overflow: scroll</code> </li></ul><br><br>  Here is an example: <a href="http://jsfiddle.net/822eG/4/">jsfiddle.net/822eG/4</a> .  Try clicking on the rows of the table.  Hover will work (you will see the "checkbox"), but <code>click</code> (and <code>alert</code> ) you will not see how not to try to make a line. <br><br>  On this topic, I even started a post on SO at <a href="http://stackoverflow.com/questions/21786375/ios-7-hover-click-issue-no-click-triggered-in-some-cases">stackoverflow.com/questions/21786375/ios-7-hover-click-issue-no-click-triggered-in-some-cases</a> which did not bring much profit, except the proposal to include (it is not clear why ) <code>-webkit-overflow-scrolling: touch</code> on the container of the label that really helped with the example from jsFiddle, but did not help with the real application. <br><br>  In the process of thinking about this mess, the following decision came (my own answer to the question on SO) - and what if <code>:hover</code> replaced with a CSS class that ‚Äúthrows‚Äù in code, catching <code>mouseenter</code> / <code>mouseleave</code> ?  This simple fix actually solves everything.  Even begins to work "more fun" - no need to click twice.  From the first click, we get both alert and checkbox: <a href="http://jsfiddle.net/822eG/10/">jsfiddle.net/822eG/10</a> <br><br>  For lack of a better option, they began to think about this ... In fact, we have a very large code base.  There are a lot of both ‚Äúplatform‚Äù code and ‚Äúapplication‚Äù code based on this platform.  And who knows who, where and when, under what conditions he wants to use: hover and whether he wants to hide or show something.  In general, it is necessary to have ‚Äúeverything by itself (c)‚Äù and the average developer did not think about problems on iOS. <br><br>  The result was the following solution: <br><br><ul><li>  With the help of <code>MutationObserver</code> (which is in iOS 6-7), we monitor the insertion of <code>link</code> tags into the <code>head</code> document ‚Äî we can afford it, because  All styles we obviously connect using <a href="http://requirejs.org/">require.js</a> and in Safari this is guaranteed to be a new <code>link</code> </li><li>  When adding a new <code>link</code> let's go over <code>document.styleSheets</code> and analyze them ... </li><li>  Let's look through all the rules and find among them those whose selector is present <code>:hover</code> </li><li>  Let's look at styles for such selectors, check if there is a <code>display</code> other than <code>none</code> and <code>visibility</code> other than <code>visible</code> </li><li>  If there are any, rewrite the selector, replace <code>:hover</code> with. <code>.hover</code> (i.e., pseudo-class with a regular class) ... </li><li>  And on the body we will add via delegate the processing of <code>mouseenter</code> / <code>mouseleave</code> for the found selector, more precisely for the part that is located before <code>:hover</code> </li></ul><br><br>  Fortunately, it turned out to be quite simple ... Each <code>styleSheet</code> contains a collection of <code>rules</code> , in which the rules themselves lie.  Each rule has the property <code>selectorText</code> which can be changed on the go.  And also has a collection of <code>style</code> where firstly contains a set of properties specified in this style - they are stored as an "array".  The <code>style</code> has <code>.length</code> , going through the length we get all the properties that are changed in this style.  Secondly, the <code>style</code> contains the values ‚Äã‚Äãof the changed properties.  At the index equal to the name of the property the value of the property is stored. <br><br>  That is, if we have, say, a CSS code: <br><br><pre> <code class="css hljs"><span class="hljs-selector-class"><span class="hljs-selector-class">.myClass</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.block</span></span>, <span class="hljs-selector-class"><span class="hljs-selector-class">.myItem</span></span><span class="hljs-selector-pseudo"><span class="hljs-selector-pseudo">:hover</span></span> <span class="hljs-selector-class"><span class="hljs-selector-class">.element</span></span> { <span class="hljs-attribute"><span class="hljs-attribute">color</span></span>: red; <span class="hljs-attribute"><span class="hljs-attribute">display</span></span>: block; }</code> </pre><br><br>  then this rule has <code>selectorText == '.myClass:hover .block, .myItem:hover .element'</code> , <code>style.length == 2</code> , <code>style[0] == 'color'</code> , <code>style[1] == 'display'</code> , <code>style.color == 'red'</code> and <code>style.display == 'block'</code> . <br><br>  Everything else is a matter of technology ... <br><br>  Unfortunately, it turned out that the primary bypass of rules works (on our volumes of styles and link tags) not very quickly ... Profiling showed that turning to <code>rules</code> takes the lion's share of time.  Perhaps WebKit initializes this property lazily and the first call initiates some deep parsing of styles into a set of objects. <br><br>  Here's what happened: <br><br><pre> <code class="javascript hljs">$(<span class="hljs-built_in"><span class="hljs-built_in">document</span></span>).ready(<span class="hljs-function"><span class="hljs-keyword"><span class="hljs-function"><span class="hljs-keyword">function</span></span></span><span class="hljs-function">(</span><span class="hljs-params"></span><span class="hljs-function"><span class="hljs-params"></span>)</span></span>{ <span class="hljs-comment"><span class="hljs-comment">// ,    ,     if (!$ws._const.browser.isMobileSafari) { return; } var $body = $('body'); //     function addPseudoHover() { this.classList.add('ws-pseudo-hover'); } //     "" function removePseudoHover() { this.classList.remove('ws-pseudo-hover'); } //   [].filter(...) function uniq(item, index, array) { return array.indexOf(item, index + 1) == -1; } function trimHoverBase(selector) { return selector.substr(0, selector.indexOf(':hover')).trim(); } function filterHoverSelectors(selector) { return selector.indexOf(':hover') != -1; } function createBodyDelegate(hoverSelector){ $body.delegate(hoverSelector, 'mouseenter', addPseudoHover); $body.delegate(hoverSelector, 'mouseleave', removePseudoHover); } function processMutationRecord(mutationRecord) { var needRefresh = false; if (mutationRecord.addedNodes) { for(var i = 0, l = mutationRecord.addedNodes.length; i &lt; l; i++) { if (mutationRecord.addedNodes[i].nodeName == 'LINK') { needRefresh = true; break; } } } if (needRefresh) { checkStylesheetSetDebonuced(); //       } } function checkStylesheetSet() { var allHoverSelectors = [], allRules = [], sheet, sheetCheckResult; for(var i = 0, l = document.styleSheets.length; i &lt; l; i++) { sheet = document.styleSheets[i]; // ,      if (sheet.processed || sheet.rules.length === 0) { continue; } sheetCheckResult = checkCSSRuleSet(sheet); if (sheetCheckResult.rules.length &gt; 0 &amp;&amp; sheetCheckResult.selectors.length &gt; 0) { Array.prototype.push.apply(allHoverSelectors, sheetCheckResult.selectors); Array.prototype.push.apply(allRules, sheetCheckResult.rules); } //           sheet.processed = true; } //   allRules.forEach(function(aRule){ aRule.selectorText = aRule.selectorText.replace(':hover', '.ws-pseudo-hover'); }); //   ,    body allHoverSelectors.map(trimHoverBase).filter(uniq).forEach(createBodyDelegate); } var checkStylesheetSetDebonuced = checkStylesheetSet.debounce(420); function checkCSSRuleSet(sheet) { var result = { selectors: [], rules: [] }; for(var i = 0, l = sheet.rules.length; i &lt; l; i++) { var rule = sheet.rules[i]; if (rule.styleSheet &amp;&amp; rule.href /* instanceof CSSImportRule*/) { //    @import checkCSSRuleSet(rule.styleSheet); } else if (rule.selectorText /* instanceof CSSStyleRule*/) { var hoverSelectors = getHoverSelectors(rule); if (hoverSelectors.length &gt; 0) { if (checkStyles(rule)) { Array.prototype.push.apply(result.selectors, hoverSelectors); result.rules.push(rule); } } } } return result; } function checkStyles(rule) { for(var i = 0, l = rule.style.length; i &lt; l; i++) { var styleItem = rule.style[i]; if (styleItem == 'display' &amp;&amp; rule.style.display !== 'none') { return true; } if (styleItem == 'visibility' &amp;&amp; rule.style.visibility !== 'hidden') { return true; } } return false; } function getHoverSelectors(rule) { return rule.selectorText.split(',').filter(filterHoverSelectors); } //      head new MutationObserver(function(mutationRecords){ mutationRecords.forEach(processMutationRecord); }).observe(document.getElementsByTagName('head')[0], { childList: true }); });</span></span></code> </pre><br><br>  A few links: <br><ul><li>  MutationObserver Support - <a href="http://caniuse.com/">caniuse.com/#feat=mutationobserver</a> </li><li>  A useful classList property is <a href="http://caniuse.com/">caniuse.com/#feat=classlist</a> </li></ul></div><p>Source: <a href="https://habr.com/ru/post/212959/">https://habr.com/ru/post/212959/</a></p>
<section class="more-articles-navigation-panel js-more-articles-navigation-panel">
<h4>More articles:</h4>
<nav class="list-of-articles-container js-list-of-articles-container"><ul class="list-of-pages js-list-of-pages">
<li><a href="../212943/index.html">Jacques Arsac. 1929-2014</a></li>
<li><a href="../212947/index.html">Briefly about the perfect 7-port USB 3.0 hub ORICO</a></li>
<li><a href="../212953/index.html">Simple monitoring of DFS Replication in Zabbix</a></li>
<li><a href="../212955/index.html">Why do we need all these functors and monads?</a></li>
<li><a href="../212957/index.html">Whatsapp came out on the warpath</a></li>
<li><a href="../212963/index.html">Our IT market in pictures by segment</a></li>
<li><a href="../212965/index.html">Free codecs won the Wikipedia vote</a></li>
<li><a href="../212969/index.html">About the features of the introduction of open source software in small business</a></li>
<li><a href="../212975/index.html">Rethinking Zephir</a></li>
<li><a href="../212977/index.html">A passion for programming. Chapter 23. Be in Your Place</a></li>
</ul></nav>
</section><br />
<a href="../../allArticles.html"><strong>All Articles</strong></a>
<script src="../../js/main.js"></script>

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
  (function (d, w, c) {
      (w[c] = w[c] || []).push(function() {
          try {
              w.yaCounter52496797 = new Ya.Metrika({
                  id:52496797,
                  clickmap:true,
                  trackLinks:true,
                  accurateTrackBounce:true,
                  webvisor:true
              });
          } catch(e) { }
      });

      var n = d.getElementsByTagName("script")[0],
          s = d.createElement("script"),
          f = function () { n.parentNode.insertBefore(s, n); };
      s.type = "text/javascript";
      s.async = true;
      s.src = "https://mc.yandex.ru/metrika/watch.js";

      if (w.opera == "[object Opera]") {
          d.addEventListener("DOMContentLoaded", f, false);
      } else { f(); }
  })(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="https://mc.yandex.ru/watch/52496797" style="position:absolute; left:-9999px;" alt="" /></div></noscript>

<!-- Google Analytics -->
  <script>
    window.ga = function () { ga.q.push(arguments) }; ga.q = []; ga.l = +new Date;
    ga('create', 'UA-134931760-1', 'auto'); ga('send', 'pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>

</section>

  <footer class="page-footer">
    <div class="page-footer-legal-info-container page-footer-element">
      <p>
        Weekly-Geekly | <span class="page-footer-legal-info-year js-page-footer-legal-info-year">2019</span>
      </p>
    </div>
    <div class="page-footer-counters-container page-footer-element">
      <a class="page-footer-counter-clustrmap" href='#'  title='Visit tracker'><img src='https://clustrmaps.com/map_v2.png?cl=698e5a&w=271&t=t&d=6iCFw7uJz0zcOaoxz5k5PcLCJUzv2WG8G5V8M3U6Rc4&co=3a3a3a&ct=ffffff'/></a>
    </div>
  </footer>
</body>

</html>